function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.225912650137100e-01   -2.438958174333418e-01   -1.827170912188402e-01   -7.357063456545027e-02   -2.293874759141793e-01   -3.171717729266996e-01   +5.562398048377346e-02   +3.407112190215884e-01   -3.138099174925563e-02   -2.388566125229321e-02   +6.517210664608794e-02   +4.535391189809952e-01   -2.998989505464772e-01   +6.220393144156369e-02   +1.963148822711457e-01   -1.484815277842470e-01; +1.259488746929729e-01   +1.008349624000547e-01   +3.990656932649245e-01   -1.483956096844004e-01   +3.490155582420125e-01   -1.942535289777548e-01   +1.473018273878725e-01   -1.248536623172804e-02   -6.549690568339410e-02   -2.251894914716020e-01   -1.635052174780379e-01   -1.232985922152247e-01   -2.015109253233070e-01   -2.601184813470657e-02   +1.695568557882156e-01   -1.098586531516764e-01; -2.613817222979658e-01   -3.123203971611349e-01   +2.954234538133559e-01   +9.047626132383160e-02   +1.075220065515348e-02   +7.879025536352485e-02   +2.618727631794662e-01   -1.034994479924946e-02   -3.280822939585968e-01   +1.656992726869817e-01   -1.766131365602284e-01   +3.056240101638643e-01   +8.034547522179900e-03   -2.886513821871333e-01   +3.165657043911201e-01   -1.170107703098853e-01; -3.809058404835340e-01   +4.633933579650453e-01   +1.556850223425196e-01   +3.359243797235181e-01   +6.332123992649807e-02   -1.294469927513707e-01   +2.078510584264072e-01   +3.527193582199799e-01   +1.808761950274456e-01   +2.109610013605850e-01   -3.413858166107850e-01   +6.537981491612320e-02   -2.341189220025921e-01   +5.088533984969361e-01   -6.561600477468965e-02   +5.640500635697365e-02; -5.621129074017114e-02   +8.366336112327193e-02   +3.444278515583737e-01   -1.106445749225834e-01   +1.875610887998406e-01   +5.065952215761014e-01   -9.098701946860920e-02   +4.694145637177312e-01   +7.766476443183193e-03   +1.963982424251073e-01   +1.319164640151869e-02   -2.433588248079208e-01   -3.429793720949771e-01   -4.001147586482661e-01   -3.456733144819729e-01   -3.819161000259308e-01; -1.535149448399026e-01   -2.439284669395284e-01   -3.252614492351742e-01   +3.923681399098398e-02   +4.611352386540520e-02   +1.570135671788979e-01   +2.706586726452168e-02   +4.503376514746884e-01   +2.083180714631143e-01   -3.940401607051981e-01   +2.414280973591599e-01   -2.477221595846893e-01   +4.511280562638259e-02   -3.260676806544630e-02   -4.244290189590214e-01   -2.648269112300249e-01; +1.386358481032856e-01   -2.694157652958204e-02   -1.327712822139039e-01   -1.385166678301182e-01   +2.532763339003409e-01   +8.647487848427912e-02   -1.267567914434270e-01   +4.873183537929548e-03   -2.731829500028249e-01   -4.162093099980410e-02   -5.173853299000074e-02   +8.820311543173842e-02   -3.067832164347878e-01   -5.351186545161522e-02   +7.762315163731139e-02   +2.857410329966901e-01; -4.384409052310535e-02   +1.016457270446890e-01   +1.120113330991142e-01   -2.323998295540503e-02   -2.029950516960955e-01   -8.281091856819189e-03   +1.546092055172729e-01   +3.404131771992638e-01   +2.935173040889219e-02   +2.959809420659201e-01   -4.168716591456996e-01   -1.385274533967544e-01   +2.133678357181973e-01   -2.085801545025745e-02   -1.692424144017800e-01   -8.618575597724995e-02; +2.111413415133990e-01   -5.327338388393092e-02   +1.801442437470707e-01   -2.211225941900739e-01   -1.529169923764961e-01   -1.850797918401779e-01   +2.006268184464877e-01   +3.790862446887068e-01   +1.641198738962513e-01   +1.406945637372277e-02   -1.394787366686285e-01   +1.036939352173455e-02   -2.137144883184454e-01   +4.308557395045814e-02   -4.111794075472804e-01   +2.616536138012310e-02; -4.326888102292772e-01   -8.266198331783353e-03   -5.517069023988691e-02   +1.566191816569585e-01   -1.791547003381245e-02   -2.075238827225675e-01   +5.087708538827126e-02   -4.320352440269392e-01   +3.228989501929436e-02   -2.143065871236681e-01   +1.544849112500855e-01   -3.296099948571649e-01   +4.198850910216231e-02   +1.739892118712066e-01   +4.605633553473040e-02   -2.315050641190874e-01; -1.702743192096624e-01   -1.934631094408351e-01   -2.041914732250960e-01   +2.537989592417139e-01   -6.892740816984917e-02   -1.525634057439168e-01   +2.056386045112086e-01   +1.575842726187933e-01   -7.337514652700858e-02   +1.015237171766183e-01   -1.489287239602745e-01   +1.469978925617731e-01   -4.927449675399493e-01   +3.357384254237487e-02   -1.511702710880998e-01   -2.396780760152946e-01; -4.923266362445844e-02   -1.273130985925253e-01   -3.766384834956900e-01   -2.129579123440706e-01   +2.093181818789986e-01   +2.763001896080343e-01   -1.559683966748328e-01   -2.365110997005999e-01   +7.808298916428182e-03   -9.785750412318370e-02   -4.513021967184224e-01   -5.261598052241523e-02   +1.306043081548253e-01   +2.363391268862738e-02   -4.268248223121074e-01   +1.777154827799522e-01; +2.793682912050691e-01   +4.160266131052740e-01   +4.079685438741517e-01   -1.049526290601559e-03   +3.553090049943486e-01   -1.368388074945912e-01   +7.240553580453188e-02   -7.576107190259881e-02   -2.127375150129373e-01   +8.375684047292822e-02   -1.727914537440013e-01   +4.005799034668058e-01   +2.268480747710881e-01   +3.225895342758460e-01   -3.404661293357547e-02   +1.765079453799005e-01; +1.757042699539028e-01   +1.109932342330135e-01   -9.065540706968356e-02   +2.873363494519874e-01   +7.870103838486797e-03   -3.076790458941914e-01   -2.877407274917590e-01   +2.322142337199119e-01   -1.977492273561584e-01   -2.346908601939165e-02   +2.925925246913482e-01   +2.974937276099417e-01   -3.648701535359317e-01   -2.984911404628952e-01   +2.494026629599491e-01   -1.187884959944305e-01; -2.871311676665367e-01   +6.132836677763856e-02   -8.924494384996629e-02   -6.456420039262296e-02   -7.398628853912378e-02   +3.486478851257768e-02   +1.065422260654268e-01   +1.392128946599812e-01   -1.577209206951838e-01   -1.460416988995339e-01   -1.130721003548328e-01   -1.645291261950003e-02   -5.485157956447884e-03   +3.792338331449571e-02   -1.577219840051221e-01   +3.157167473914696e-02; -1.868537126197026e-02   +2.867919555240853e-02   -5.414398400179695e-01   -5.558653961119042e-03   -2.007751918087853e-01   +6.103160080068962e-02   +2.864520226284462e-02   -1.503618351882252e-01   +1.156707264604817e-01   -5.192977498887145e-02   -1.586800407988317e-01   +7.550162638634442e-02   -2.758466632282442e-01   -3.804805820084712e-01   +1.248220932487579e-02   +9.634533362146130e-02];
L1E_L1I_iGABA_netcon = [+8.087297673813555e-02   +1.442319365625211e-01   -3.029906827755678e-01   -8.038024435407083e-02   -2.429011493959769e-01   +7.809909475233243e-02   -1.318109453113630e-01   +3.317589763482776e-02   -1.143894008763840e-01   -1.521672116327424e-01   +2.506642940460819e-01   -4.413097659041403e-01   +7.270801280610117e-02   -3.464820639037023e-01   -1.448970841517739e-01   +2.335450170949946e-01; -2.338105722746125e-01   +7.427634361872731e-02   +6.805366074843849e-02   +1.136123902119406e-01   -1.547294736187877e-01   +1.943146326286412e-01   +1.458777636762072e-01   +2.683735026865722e-01   -2.573250679055730e-01   +1.443034317261941e-01   -9.430785676545654e-02   -5.237600934551510e-01   -7.203242342659538e-02   -8.726792825243994e-02   +8.641115554326226e-02   +2.712979596632243e-01; +2.222909649510426e-01   +3.369469436760769e-02   -2.603008779672985e-01   +5.127459147574386e-02   +5.654300437910723e-02   +1.842637334262798e-01   -9.579015385632286e-02   -1.090346956488043e-01   -3.749502732403489e-01   +1.347547936894563e-01   -2.357279396653555e-01   +2.193118236867239e-01   +5.862383549925310e-02   +2.492826106276409e-01   -2.840984519333336e-01   -2.352380654750190e-01; +9.909212853020259e-02   -3.545386845589420e-01   -1.460389442821979e-02   -2.987657733541941e-01   -1.767434577464425e-01   +1.169629559292354e-01   -4.491296680294642e-01   -3.542178002539443e-01   +5.346771644615946e-02   -5.586642311505197e-02   -3.430692429829795e-01   +9.402341936682838e-02   +1.310394268105672e-01   -1.182668534657326e-02   +5.230532373121480e-02   +9.882022837487611e-02; -5.446447209811695e-02   +1.848937657967251e-01   -4.165359912516271e-02   +2.942948104861546e-01   -5.409703808064559e-02   +4.029127484447718e-01   +1.830293262170337e-01   -2.115778675796866e-01   -2.628180017687626e-01   +1.203899680464193e-01   -3.449629787960305e-02   +3.199650724646032e-01   +1.268938096618810e-01   +1.427557268585233e-01   -2.177207050586976e-01   -2.031613510447011e-01; -4.135450043874538e-02   -1.733527511472009e-01   +1.406731272681859e-02   +8.254333876494560e-02   -4.650135370082698e-02   +1.158171851368671e-01   -5.599051124040868e-01   -2.141642012671145e-01   +2.082822421144640e-01   -4.046760206136956e-02   -1.830787936304557e-01   +2.416178838812764e-01   -3.506109087398768e-01   +3.649129021226473e-01   +3.938135723782000e-01   +1.997584493330561e-01; +5.856662375565757e-02   +1.145600059236456e-01   +2.842280756170195e-01   -4.950215167728562e-01   -1.844075514520354e-02   -2.157410217395320e-01   +1.102444347712898e-01   +1.008770350814089e-01   +1.271292848182958e-01   -3.169426487788382e-01   -1.303527889996369e-01   +2.265398284371699e-01   +1.348240886343038e-02   +1.136077167268913e-01   -3.066233338496543e-01   -6.029723135726686e-02; +2.801124867776314e-01   -2.115490706071227e-01   +2.950220076922190e-01   +2.540786318439080e-01   -7.978608798881068e-02   -8.108908255931288e-02   -1.103691817955630e-01   -3.544266120772100e-01   -3.217391651407672e-01   +3.013968330495519e-01   -9.920945765713871e-02   +2.935752210327928e-01   -1.933417872373279e-01   -3.761176461343814e-02   -2.144050964570793e-01   -2.002245252713236e-01; +3.522137625198590e-01   +1.579972070684205e-02   +2.576648787492140e-01   -1.032253760430915e-02   -8.428255826217412e-02   +5.218583477212177e-02   -4.882343931572694e-01   -4.683518217039210e-02   +2.005676372324484e-01   -2.034172353432634e-01   -3.668768409747709e-01   +2.678162820341350e-01   +1.197825985086782e-01   +3.626897221266523e-03   -2.162876270853887e-01   -3.510784236039248e-01; +2.400703270277895e-01   -9.961282054178129e-03   -1.089655161730922e-01   +3.341346372120391e-01   -5.450471307660564e-01   -1.584711901557160e-01   -2.198782151430512e-01   -1.880626322141904e-01   +5.056531389758943e-01   -5.978790149683617e-02   -2.930707531403975e-01   -6.596823560282000e-02   -1.577830273226928e-01   +1.239358319934558e-01   -2.134623504866196e-01   +5.141789215334146e-02; +4.189512633750144e-01   -1.814715493081979e-01   -1.594636107321022e-01   -2.392498034405033e-01   -1.720862276861060e-01   -1.686844582676826e-01   -1.062609302750108e-01   -2.916488175109808e-01   +1.055157320116063e-01   +4.203510158357366e-01   -1.627792693812483e-01   -1.369841276316724e-01   +3.232080923948180e-01   +2.097376928182493e-01   +1.298594417167988e-01   +4.040999933496985e-01; -2.513138316975879e-01   -2.291265193046066e-03   -4.428311707566054e-02   +1.969136885037424e-01   -4.157688442979093e-01   +2.010637306330204e-01   +2.118745835428276e-01   +4.633090173193018e-02   +3.192992119871326e-01   -1.895931426243788e-01   +5.147612184954511e-02   +2.025534807900453e-01   -2.138757676485729e-01   -3.311471601980231e-01   -1.546577084134616e-01   +6.300332964444738e-02; +3.136463796289828e-01   -3.902528592140431e-01   -7.251088658355198e-02   +2.804066534601369e-01   -1.872142893775463e-01   -1.907101709918522e-01   +3.066449129080656e-01   -1.766447399657649e-01   -2.361459812452429e-01   -1.718249097834115e-01   +1.680542230860614e-01   -1.243464724335166e-01   +2.524294528458408e-01   +1.274192162833759e-01   +2.792510785317009e-01   +1.212137436711176e-01; +1.358145361981211e-01   +4.382745807254070e-01   +9.326658427938192e-02   +3.687570612824452e-01   +2.268465040094378e-01   -2.476885166688652e-01   -2.354692420329754e-01   -1.010199987257321e-01   +4.626409833689651e-01   +1.465226201123824e-01   -2.474453249197904e-01   +3.585007951695821e-01   +2.357557434561759e-01   -1.616042905204515e-02   -3.206829666565619e-02   +2.049776423939081e-03; -1.183850660809799e-01   -1.193515463969772e-01   +2.428629309632856e-01   +1.753882873668651e-01   +8.787600649075888e-02   -1.854354464498827e-01   -1.602090810229221e-02   +2.994897631098304e-01   -1.450155219082646e-01   +2.981697580419416e-01   +3.668276187736275e-01   -1.323900559153995e-01   +1.439443294875912e-01   +6.032897630682287e-02   -2.531331620311849e-01   -2.506312079678005e-02; -2.290043902596860e-02   -2.450539186031370e-01   +3.849819086604787e-01   -6.904571863487287e-02   +4.126132595432314e-01   -3.630593854625931e-01   -1.497181869480119e-01   -7.545926119312125e-02   -2.446794738044762e-01   -3.028972843946071e-01   -1.870610886178475e-01   -2.251671975409678e-02   +5.513469847077902e-02   +2.293418143287313e-01   -3.112858617370184e-01   -9.054090923467793e-02];
L2I_L1I_iGABA_netcon = [-4.727047700144757e-01   +9.992661032889012e-02   +3.032808360978676e-01   +2.259615481762573e-01   +2.587072339844082e-01   +1.306406946767528e-01   -4.468542677477794e-02   +3.424427093188449e-01; +1.712443770824314e-01   +7.028567727202333e-02   -2.388209724779577e-01   -3.235223014035615e-04   -2.912157447060121e-02   +7.514509775115030e-04   +1.023542172285906e-01   +6.614037927983860e-02; -7.666455034559594e-02   +2.327829407526739e-01   -1.927514477562823e-01   +1.448315550538167e-01   -2.611047450061768e-02   -9.853872042618067e-02   +3.453432628113801e-01   +4.024607275041714e-02; -2.657897415084285e-01   +1.498691538981678e-02   -1.450839341251685e-01   +1.972610505120870e-01   -2.775764659382624e-01   -6.692375591178802e-02   -6.510862112987933e-02   -1.443367319439781e-01; -7.931195802067120e-02   +1.640843140410198e-02   +3.585847712294337e-01   +1.585142266746858e-01   +1.073948200953939e-03   -3.451083477029759e-02   +2.778002225231778e-01   -2.759819865375674e-01; -1.259248403773708e-01   +3.015141706530855e-01   +1.645846724365183e-01   +9.339992504014177e-02   +3.132920050099447e-02   +8.999472317381157e-03   -4.109470630750427e-01   +1.529041763167222e-01; -2.331045416010979e-01   -1.564558501993835e-01   +8.971600887121635e-02   -9.760871593576126e-02   +4.162129597464390e-02   +1.070323660460877e-01   +2.819201215648354e-01   +1.480914073050046e-02; -1.522956399048528e-01   -1.523062895766455e-01   -2.776212187973104e-01   +7.184482303457840e-02   -2.762646393164498e-01   -7.459161728316838e-02   -1.759529362260634e-01   -7.043681434601777e-02; -5.062799157139872e-01   -1.684890674999192e-01   -3.398998972853855e-01   +3.554430820692399e-01   -4.302343501474686e-02   -2.271427952868010e-01   +1.776009627918023e-01   -2.166344730795362e-01; -4.018171370620162e-01   -8.523077789274452e-02   -1.429412001617339e-01   +1.607589819364605e-01   +2.260559155344724e-01   -9.696014340739716e-02   -1.385975293185070e-01   -4.931570766713910e-01; +1.864283350663138e-01   -2.957443869957027e-01   +1.327616942716797e-02   +2.464790884359326e-01   -7.002316617158894e-02   -5.637095568236575e-02   -1.264095984485803e-02   -4.319340370236951e-02; +2.521848798333987e-02   -1.314157825884872e-01   +3.259065980924326e-01   +5.987018075865463e-03   -1.104017100873375e-01   -1.105524836691050e-01   +3.354897637097715e-01   +1.123779622874708e-01; +1.297457262251848e-01   +3.589409063409507e-01   -4.381040366341604e-01   +4.202425168936219e-01   +1.854453122179439e-01   -2.370423103817532e-01   -5.095203743189221e-01   +5.232891222937913e-02; -2.930194028893530e-01   +3.348723372882439e-02   +4.884678301259334e-01   +1.156675622163561e-01   -9.092746042935967e-02   +1.062190911209853e-01   +1.700793460688721e-01   +1.071877668475761e-01; +2.969149218004485e-01   -2.592171669983286e-01   +3.691637107161445e-02   -1.641351253771101e-01   +1.571809200929589e-01   -9.528824855464882e-02   -1.477226088735293e-01   -8.931153216861144e-02; -2.125759839230373e-01   +9.380510517513202e-02   +3.519471709713797e-01   -2.895026154639471e-01   +1.742322213795110e-01   +5.563016633282944e-03   +8.349825344268277e-02   +5.721521228832226e-02];
L1I_L2I_iGABA_netcon = [-5.524909687246704e-02   -2.359687934627466e-01   -2.043546525662472e-01   -1.447091073421784e-01   +1.128617164904834e-01   -1.238065584225537e-01   +9.138187606713977e-04   +6.276014196446467e-02   -1.102972634969689e-01   +2.434070593789249e-01   -8.669112738615815e-02   -2.204172453477120e-01   +2.754522933883383e-01   +8.617278036637406e-02   +2.215989634614403e-01   -3.865828675159835e-01; -5.297933359834630e-01   +5.565530705040350e-01   +3.035482874142970e-01   +3.756458665484476e-01   -1.516428698980193e-01   -2.426252080969549e-02   -1.198187149849951e-01   +3.811212771855544e-01   +3.004245493991731e-01   -4.218526126337527e-01   +9.857021196851490e-02   +1.239834918537818e-01   -5.244771583737388e-01   +3.622940504593008e-01   +3.420359896260570e-01   -3.472391287079602e-01; +1.984386187180947e-01   +1.048556534406227e-01   +2.217578600465392e-01   +2.119874163105353e-01   +1.715888432045234e-01   -2.707502523630229e-01   +2.232552748839294e-01   +1.423678502625396e-01   -3.809380544689822e-01   -3.958012577411860e-02   -8.242426467652553e-03   +1.947344383108958e-01   -1.112813086304047e-02   -1.414800763971091e-01   +1.262052554561438e-02   -2.946436238271523e-01; -2.065214763102063e-01   +2.671135688006787e-02   +1.952724509245859e-01   -2.260626916083116e-01   -3.142231879183079e-02   +1.812241413433850e-01   +5.083423103843797e-02   -1.726592058062134e-01   +9.349619233160088e-02   +4.302179169418472e-01   -1.579029394510135e-01   +2.188320435501793e-01   +1.253141353572105e-01   -6.507521584022238e-02   +9.377565176548945e-02   +4.656150251462140e-01; +1.280112219276202e-01   +2.684717467591519e-01   +1.126787273925797e-02   +8.345258979806083e-02   +1.062900761949290e-01   -8.954455388483185e-02   +4.394994452019790e-01   +1.557172321819295e-01   +2.004809424309922e-01   -6.777148582649900e-02   -1.820704890967833e-01   -1.805794550462694e-01   -2.280347365845020e-01   -9.329243909553192e-02   -5.595263814800598e-02   -1.554633052596778e-01; -3.015705256182272e-02   +2.217817301821240e-01   +2.284037369699193e-01   -1.815351331988759e-01   -2.651569453646130e-02   +2.579121934907552e-01   +2.842381698186677e-02   -4.356080608496173e-01   -2.754245907499916e-01   -2.771971246183801e-01   -1.097753815753923e-01   -9.322467409848306e-02   +5.499108903876362e-02   +1.061167126802297e-01   -4.237272568988011e-01   -1.875836411474572e-01; -2.899108152358915e-01   +3.285003282081358e-01   +9.402906111640494e-02   +9.704193579398335e-03   -2.859149504288839e-01   -4.420307580218289e-01   -1.575256648543591e-01   +3.288763546069254e-02   +3.273870142426447e-01   -1.454122364171335e-01   +3.372508596538620e-02   -8.781904296542102e-02   +1.334235816891637e-01   -3.479797239868689e-01   -1.704311082341628e-02   -1.884454569915980e-01; -2.235275375384908e-01   -1.054702266077852e-01   -1.975088146737022e-01   +1.987888959089788e-02   -2.992296310790466e-03   -6.988693976833685e-02   -8.539157732206826e-02   +1.423272692428790e-01   +5.202978889108742e-02   -2.253830357632638e-01   +6.788712565979663e-02   +5.477272836344993e-01   -5.109959410561303e-02   +2.511778505091998e-01   +2.301079745395056e-02   -2.386974550200170e-01];
L2E_L1E_iAMPA_netcon = [-1.882536011483273e-01   +2.821642379072117e-01   +3.063708754735101e-01   +5.731397994514020e-02   +7.097413369263006e-03   -2.904737553889207e-01   -4.036696092893396e-01   -1.381150947369030e-01; +9.856552026955544e-02   -1.666231566126912e-01   -4.116643566868045e-01   -9.365289256005158e-02   -1.517818345290861e-01   +3.781454566917441e-01   -1.137427425515072e-01   -1.920339228344157e-01; -5.666309817920412e-01   +2.907290558535325e-01   +3.433479432040878e-01   +2.984422396973956e-01   +6.093451178144993e-02   -3.697611796211290e-01   -2.620694375251362e-02   +4.387626651705122e-01; -1.484260584423241e-01   -1.962079723957249e-01   +7.839585362361313e-02   -3.118243100061105e-01   +1.013149547932851e-01   +1.044674054029692e-01   +9.455693120502842e-02   +3.134502786194273e-01; -4.939686187444403e-02   -8.113864691547401e-03   +4.969772756805874e-02   +2.039829516960242e-01   -2.268646232772816e-01   -3.795879919396515e-01   +1.455954211827204e-01   +9.060453613150135e-02; -2.312671701713178e-01   +3.372570781888348e-01   +3.483116728761372e-01   +2.407883361080552e-01   +1.933903791928350e-01   -1.571991657754150e-01   -3.153340516781263e-01   +4.023365390524417e-01; +3.769031593585521e-02   +1.798365965285051e-01   -1.769478935033431e-01   +1.581443298590701e-01   +7.001964035081294e-02   +1.274850180944506e-01   -4.004777426218896e-01   -1.640708969922167e-01; +9.410882183921862e-02   +2.297074038286553e-01   +1.406492548881516e-01   -3.137702336367819e-01   +3.851535310063422e-01   -1.794659023430650e-01   -3.283191893664090e-01   +9.662716707675846e-02; -2.821967423296033e-01   +1.951282907660976e-01   -1.542436016681051e-01   -1.310517503090534e-01   +1.979965680240448e-01   +1.137976916476153e-01   +3.253096528749776e-01   +5.786990479410278e-02; -2.176900741045468e-02   +2.421688972736940e-01   -2.582472868278035e-02   +6.613184624748625e-02   +7.879686012571499e-02   +3.331681587784286e-01   +2.785248925182278e-01   -1.680392815851574e-01; -1.927360183371138e-01   +2.862212483960100e-01   +2.151980909061304e-01   -1.666939338093083e-02   +6.559599161980906e-02   +3.269387440400192e-01   -3.458380164887811e-01   +2.625470992476732e-01; +6.761081482662515e-02   -2.659121584714375e-01   +1.037070062847944e-01   -3.127133548137828e-02   -1.783790264560958e-01   -1.764389848587837e-01   -2.690247801123519e-01   -8.025021467389284e-02; +1.771256189332342e-01   +8.180459350041014e-02   -2.040864663910081e-01   -6.414878850931283e-03   -2.851518932723783e-01   -1.714807612570297e-01   -7.116311246177257e-02   +2.624920367892602e-01; -1.941465465311449e-01   -3.894750622677443e-01   -4.943677527331883e-01   -1.179274663279994e-01   +2.969763015022188e-01   -8.247143152682448e-03   +1.689899463124489e-01   +3.256214484478301e-02; -2.863277018598791e-01   +4.892340004493128e-02   +4.399808736804730e-01   -1.480510534798946e-01   +2.721195095939544e-01   -4.286975109256908e-01   +2.240502583772057e-02   +8.497394855614401e-02; +1.531537157308906e-02   +3.355998619509947e-02   -2.852887468195923e-01   -1.619135126997611e-01   -2.238296906582818e-01   +1.987341261077144e-01   +2.399042137083151e-01   -5.172199478580001e-01];
L1E_L2E_iAMPA_netcon = [-3.370118447581310e-01   -1.761218889482790e-01   -1.823156880325800e-01   +1.930140676660506e-01   -1.119331025136642e-01   -3.546122755909378e-01   -3.713685913627774e-02   -3.726364631412621e-01   -1.254207963541185e-01   -2.557415930430985e-01   +1.481239743155660e-01   +3.636762979300129e-01   -6.145245499993401e-02   +3.530618580099518e-01   +3.322275714140449e-02   -8.856692990514747e-02; +1.323395533102586e-01   +4.243062385474115e-01   +2.429607974297661e-01   -1.558182366550168e-02   -2.167864100809329e-01   +1.347519152115692e-01   +1.841448117975638e-02   +1.446434844714007e-01   -7.119707096766328e-02   +1.526749796242984e-01   -4.546565425883601e-01   -1.036645420936836e-01   -6.687254537270013e-02   -1.257155596130486e-01   -2.162071218333114e-01   +1.026461701980632e-01; -3.509065687894777e-01   -3.300420223681622e-02   -2.673741392199438e-01   -2.838623311555162e-01   +4.181687756890574e-01   +8.881623039838363e-02   -2.216122705408287e-01   +8.285103747733066e-02   -1.804383937128889e-01   -2.280002890982701e-01   -1.039592647851037e-01   +1.699928798459460e-01   -3.060506283717992e-01   -1.016358018236274e-01   +1.933903560435155e-01   +2.415524098267365e-01; +2.124644185295145e-02   +2.526275354087256e-01   -2.042998903640131e-01   +1.108436278264366e-01   +1.218690894147294e-01   +2.554110790155981e-01   +4.913932418515020e-02   +2.395456565889359e-01   -1.353558931012077e-01   +9.680318234811976e-02   +1.188352520760949e-01   -3.150332340144301e-01   -1.035464680629160e-01   +6.766105700554656e-02   -3.288772175230227e-01   -6.248655030703254e-02; -1.097867740664941e-01   -7.512309808308246e-02   -2.349719296733870e-01   -2.068964241742976e-01   +1.801442912448270e-03   +1.644471915351848e-01   -9.025322046448142e-02   +3.597391820847642e-01   +9.992217661832370e-02   -9.787641447122297e-03   +3.184892802580616e-02   -3.789284704371347e-02   +1.389593282846062e-02   +1.174576056802042e-01   +8.163673645853053e-02   +1.427339533646892e-01; -4.157670765895515e-01   +8.577196898824144e-02   +2.753936152716029e-02   +7.267865140869965e-02   +3.640584154846376e-01   -7.618552349743692e-02   +3.636638305562805e-01   -2.387813274358007e-01   +9.014022627435674e-02   +1.580462774470227e-01   +2.686235098922711e-01   +1.387630887274341e-01   -8.374040460284875e-02   +5.029975109115579e-01   +1.194824593953714e-01   +3.102634517251029e-01; -3.396975493619304e-01   +8.563355156177618e-02   +5.503064701521072e-01   +4.168069971717709e-02   -2.459475397417368e-01   -9.429057759192899e-02   +1.191272700279864e-01   +2.451385095241991e-01   +5.264124134386242e-02   +1.527220568182444e-01   +2.493698880667530e-01   +3.957952384905636e-02   -2.874778837261616e-02   -3.538514142572431e-01   -3.349004453873579e-01   -1.170692231617618e-01; -1.839965370557102e-01   -9.344783622308458e-02   -3.421202315607241e-01   -2.692604089952459e-01   -3.466317617594008e-02   +1.255141170984974e-01   +2.793222081149408e-01   +8.235500830080635e-02   +1.294150896661947e-01   -3.280452975337242e-01   +1.351103782376107e-01   -7.816615660143311e-02   -1.425926991360513e-02   +6.160084593053089e-03   -1.101333449428997e-01   -1.936769652895547e-01];
L2I_L2E_iAMPA_netcon = [+4.086478078443442e-01   +3.271581560715291e-01   -2.737978927719610e-01   +1.251396407900785e-01   +1.840283459925660e-01   +3.746918372724192e-02   +2.037604654338504e-01   -1.708087765618535e-01; -1.066213126294201e-03   +3.611020352236413e-01   -1.759077671522923e-01   +1.818113845994398e-01   -1.871375001475394e-01   -7.264700439707709e-02   +2.368521426297207e-01   +5.726664990807928e-02; +5.372294371445885e-02   -1.331368725467502e-01   +2.991661801164842e-01   +2.097228072423423e-01   +2.112963229369659e-01   +2.774983305096200e-02   -3.051035171476497e-02   +7.010446360824651e-02; -1.844803972867464e-02   +3.633801328875440e-02   +1.462684011593152e-01   +1.761551518262665e-01   -3.794578758826690e-02   -2.643795242588923e-01   +2.179623549688636e-01   -2.447656024469433e-01; -1.705921083999752e-01   -2.129137221114404e-01   +1.421628956589326e-02   +2.362371967069749e-01   +2.593622337807205e-01   +1.498181537705702e-01   +8.561277609928675e-02   +1.243254120631491e-01; +3.781664071356580e-02   +2.574410732698651e-03   +1.186175227222411e-01   +3.092624369640905e-02   -6.888891401639449e-02   +1.500363079116003e-03   -1.045210809609803e-01   -2.663239087257512e-01; -1.961087964925643e-01   +3.825100481440180e-01   +4.155145261425870e-01   +1.505513085865010e-01   +1.215775501722232e-01   +4.537677437584056e-03   -2.541683577966326e-02   +2.160261058992206e-01; +1.229635196403466e-01   +1.730030597162145e-01   -2.354387545361566e-01   -3.154659045535940e-01   -4.134447663684322e-01   +2.094499633933689e-01   -8.140898093408511e-03   +1.521934651228960e-01];
L2E_L2I_iGABA_netcon = [+1.802469532804732e-01   -5.084752074031779e-03   +6.013729488315056e-02   -1.325616149218796e-01   +1.761494039560635e-01   -2.602142538800108e-01   +1.804179883228973e-01   -7.834352729201477e-02; -2.108350586369831e-01   +3.141615658449283e-01   -1.870870607911479e-01   -7.621085921530593e-02   +6.103106060259859e-02   -1.698388128993813e-01   -2.138992355323635e-01   +2.273268540364368e-01; -1.229161149675829e-01   +1.890538165373629e-01   -4.230878075863601e-03   -1.780941037069846e-01   -2.263020871022867e-01   -3.058859482449194e-02   -1.519271058654485e-01   -1.800093877790608e-01; +9.389413151840086e-02   -4.291846543542149e-01   -1.014923883264576e-02   -2.834799739003768e-02   +2.201631019380940e-02   +2.571591331333953e-01   +5.187974530087718e-01   +1.489793532826360e-01; +1.192140933388519e-01   +3.720658877546545e-02   +2.135913743087551e-01   -2.201947607634303e-01   -1.520701394063462e-01   -4.898585217273564e-01   -1.388575972895154e-01   +2.526379805240886e-01; +2.929666863337201e-01   +1.117787119471843e-01   +2.319000685752790e-01   +6.074355403471743e-02   -4.547574056431229e-02   +3.599064174025347e-01   -5.076863872920168e-03   -7.007931812272410e-02; +2.758074719700970e-01   -6.785110814465478e-03   +5.616542873786336e-02   -2.603437771547716e-01   +7.973490103793340e-02   +1.466203449902733e-01   -4.875441564837166e-01   -1.647817668127032e-01; +6.349643921412802e-02   -1.940426056989226e-01   +1.451820355956917e-01   -2.705490082312078e-01   -2.389105557376098e-02   +8.343291842796546e-02   -2.443116642757940e-01   +4.067216789393328e-01];
L3E_L2E_iAMPA_netcon = [+8.153503281047086e-02   -3.785887683526210e-01   +1.469481711342062e-01   -2.698853580708464e-02   +7.085733003356054e-02   +1.109160238177087e-01   -1.953173758560131e-02   -3.508035708066926e-01   -2.141062398070209e-01   +3.260350827996085e-01   -3.421501427974108e-02   +1.105160601186167e-01; +1.298824188690690e-01   -1.737731475222254e-01   -5.488047105307337e-02   +1.795385229873656e-01   -1.300377547558193e-01   +2.964201711883859e-01   +2.971166166597224e-01   -4.260642247377765e-01   -2.814407114056705e-01   +3.587038240887521e-01   +2.857014617214874e-01   -4.554683611150728e-01; +1.566257039928060e-01   +8.188078806902252e-02   -3.610747393349042e-01   +3.229260356944104e-01   -2.233370296489980e-01   -3.251856728741861e-01   +1.580776102495404e-01   -9.756469494653700e-02   +3.109505423614726e-01   -3.778997852655698e-01   +8.858162828631233e-02   -3.971568498094367e-01; -4.137032152332300e-02   -2.444791660945993e-01   -8.144484800306184e-02   -5.092523806399546e-03   +2.521181564621906e-01   +1.785582097560162e-03   -1.958607989961108e-01   -1.281784711642609e-01   -1.911999782850851e-01   +1.726216045424814e-01   +1.070726745761614e-01   +2.564368444047826e-01; +3.173218779245849e-01   -9.219672434814466e-02   -1.765948566057933e-01   +2.312127502226080e-01   +2.818009493459439e-01   +2.677403696869013e-01   +1.603731294559898e-01   -1.321526937665464e-01   -5.502819574408603e-02   -1.300497245619794e-01   +3.173417855274832e-01   +4.724467734473276e-01; -2.404441616351142e-01   +3.018108470840993e-01   +5.070478601963355e-02   -2.716668641011231e-01   +2.418440759755405e-01   -8.822939343654755e-02   -8.569974690053545e-02   -1.692056846230132e-01   -1.341955030550530e-01   -4.335062307492435e-02   -1.874223945240534e-01   -1.324331200161649e-01; -3.870761619165722e-02   +1.546018864707133e-01   -1.631420903919264e-01   -3.541332226533077e-01   -2.502308567185236e-01   +6.267552875527814e-02   +2.912793043405643e-01   +6.345333681127308e-02   +3.704076128938788e-01   -3.496116549461889e-02   -4.521825312510818e-01   -2.800635934564031e-01; -4.621461972002102e-01   -1.382012155650126e-01   -3.549585032075599e-01   -3.479808859180932e-01   -1.788213738675488e-01   -2.832303950282715e-01   +2.807753877342795e-02   +2.526862431541189e-01   -3.180606937165532e-01   +5.577153424799339e-02   -2.575470887421739e-01   +6.820157962731777e-03];
L3I_L2I_iGABA_netcon = [+2.586041947854292e-01   -2.199338712755966e-01   -2.348430934479905e-01   -1.104627456251322e-01   +7.838814006204795e-02   -1.279280294557822e-01   +1.681099670215314e-01   -1.985709515528947e-01   -1.151146241980169e-01   -6.536821442611139e-02   +1.201018540960794e-01   +1.192787355558132e-01; +2.566792079595404e-01   -2.065765991670439e-01   -9.615905914075648e-02   +1.500995979718357e-01   +3.044467394373966e-01   +4.497173882907927e-01   -4.533226126741738e-01   -1.529761938445220e-01   +2.510967381962459e-01   +1.950972355397105e-01   -9.350727402809821e-02   +1.412128690279739e-01; +1.758870425153964e-01   -1.687279400589831e-01   +9.130066536907250e-02   -1.587039068886044e-01   +3.493425447491224e-01   +9.286491819988515e-02   -2.643819629421536e-02   +1.048028415785711e-01   -1.267045476471608e-02   +1.222965395227528e-01   -3.001790046743036e-01   -2.550338596739236e-01; +2.176387131026153e-02   +1.922926371538521e-01   +5.146593668979633e-01   -2.743144753747428e-01   -1.327649788712237e-01   -2.662072814560393e-01   +1.801024639467582e-01   -9.316245518465345e-02   +3.534223745443368e-01   +2.209940303845034e-01   +8.142320480721149e-02   -5.865531948185276e-01; +4.527897664124058e-01   +1.256815986596523e-01   +7.951029065674337e-02   -6.417957180230591e-02   +1.333684753893300e-01   -3.366598647913464e-01   -4.092237228677079e-01   +1.751656636222998e-01   -1.733267120113274e-02   +2.898971340527582e-01   -6.754346508908894e-02   +2.304749964389154e-01; -6.094761643587163e-02   -2.568105659579679e-01   +1.653647746006329e-02   +5.627391053258499e-02   +4.166670178110570e-01   -2.025297307804597e-01   +1.069524223769628e-01   -3.710417843494725e-01   -1.785246689852463e-01   -2.464525260191185e-01   -2.778755011253756e-01   -1.476519357252262e-02; +1.538863641925107e-01   -1.214254540523773e-01   +1.996494452857063e-01   -8.508518166863932e-02   -2.564207065344588e-02   -4.826570550302821e-01   +2.257222290413944e-01   +2.277262177423668e-01   +1.878337415571849e-01   -2.893996528820817e-01   -1.379104883073599e-02   +2.196717679881710e-01; +4.514655343555640e-01   -3.203587033882532e-01   -2.231409122188124e-02   -3.722402424579848e-01   +1.180332373262182e-01   -2.306943819983413e-01   +1.162861914953903e-02   +3.104984912211101e-01   -2.776015343898725e-01   -8.517662390344732e-02   +1.241826949862192e-01   +9.106801366125386e-02];
L2E_L3E_iAMPA_netcon = [+1.772067012116926e-01   -1.610768612217107e-02   +2.693865583869644e-01   -1.382551767944087e-01   +2.288077505024450e-02   +4.617730254190229e-01   -1.011808273845353e-01   +2.930631037708896e-01; -7.602881130578297e-02   -1.554204666401016e-02   -2.591532878814517e-01   +7.920938693384189e-02   +3.067596303331709e-01   -7.784851368398904e-02   -4.430688494257371e-01   -2.581239032288435e-03; -1.565223662676318e-01   -3.191908773022178e-02   -2.023336587820571e-01   -3.077883332084743e-01   +7.476930334384542e-02   -1.065821358216306e-01   +1.265200239561480e-01   -6.394428352882356e-02; +2.891492409804873e-01   +3.948452143953630e-01   -1.716383481694480e-01   +3.015437185355305e-01   +1.104170650275912e-02   -1.718884683584508e-01   -3.126013529308680e-01   +2.505197966698990e-01; +1.656106074209069e-01   +6.903883228859246e-02   +9.921234267038793e-02   -2.015863146580744e-01   +2.443664240050451e-01   +2.650742856587243e-01   +1.414224777667367e-01   +1.469584804065210e-01; +2.190932003342932e-01   +2.849702058601259e-01   -4.892065492922162e-03   -2.908557160895605e-01   -2.266767286749699e-01   -2.264137131846904e-02   +2.775431522019470e-01   +1.079599629593474e-01; +1.269044387494714e-01   -9.512503262060747e-02   -9.594780972412324e-02   -1.416288884973071e-01   +1.641070434949009e-02   +2.277877708665675e-01   -5.143414970164176e-02   +3.476398047534782e-01; +1.188993770483962e-01   +3.282895630987082e-01   -2.697149707493620e-01   +5.522609590617629e-01   +2.529273420045199e-01   +2.055774655807622e-01   +3.422141225516485e-01   +2.141258865640648e-01; +4.461716324479461e-01   +4.177746463283865e-01   +5.161076871565858e-01   +1.021418500120099e-01   +1.595485089171614e-01   +4.578777447463776e-01   -6.665200113379774e-02   +1.145496098538640e-01; -6.074194230486503e-03   +5.429591907575210e-02   -2.475860720318522e-01   -7.976317564541924e-03   +4.238465155864520e-01   +5.484084610409411e-02   +4.005868573788001e-01   +8.299169295777695e-02; +4.101547284148155e-01   +2.440607294792775e-01   +9.990892516110864e-02   +4.697537681829839e-02   -2.178955987108944e-01   +1.362096013870535e-01   +2.482297448041193e-01   +6.227221618837506e-02; +1.517369796438704e-01   -9.989520467813481e-02   -1.181367244279224e-01   -1.371806047403789e-01   -4.953082980476291e-02   +4.019285850899295e-02   -1.309847871155577e-01   +2.145629580548327e-01];
L2I_L3I_iGABA_netcon = [-3.868595564885562e-01   -2.056093896109427e-01   -1.204198897629965e-01   -1.501576406810723e-02   +1.951964586012326e-01   -1.234270884670723e-01   +2.768789364247104e-02   -2.771000514475648e-01; +9.676470883183799e-02   +8.345721137009018e-02   +2.952368185407583e-02   -2.972934568210828e-02   +2.148139622979609e-01   +8.101593087405705e-03   -3.258393419067970e-02   +1.669304997462254e-01; -1.573576665816237e-01   +1.750584979210613e-01   +9.265600343873753e-02   +2.897725810601599e-01   +4.221147774237320e-01   -3.089031062241950e-01   +2.889812708797696e-01   +1.649013375046831e-01; -5.221863208116445e-02   +2.631760761935205e-01   +1.241378277736114e-01   +2.613306075426293e-01   +5.697358759227875e-02   -4.513721762683395e-02   -1.411763866416849e-01   -4.569061337465474e-01; -2.120769948843597e-01   +3.063516671998715e-01   -2.266448431862751e-01   +2.211321135164268e-01   -1.250680686572775e-01   +7.301162195454478e-02   +4.265308851426244e-01   -4.880723469494801e-01; +1.355234957474787e-02   -5.849113648164346e-02   +3.349949681228729e-01   -2.950471919146608e-01   -4.379239342825816e-03   +1.177934651697579e-01   -1.352047419406101e-01   -1.056115258933759e-01; -1.185410992871861e-01   +1.728163393031054e-01   -2.748839261735011e-01   -3.194776231065861e-01   -1.865181808610339e-01   +1.682983017259004e-02   +2.977363717744648e-01   -2.603942649605245e-01; -5.221755538440229e-02   +6.423078594426260e-02   -7.705169377988290e-02   +2.433490389144666e-01   +4.284818733641216e-02   +2.670788909282348e-01   +9.910365676135612e-02   +2.404194968764772e-01; -5.057857606307709e-02   +1.517654401855541e-01   +1.345171030152752e-01   -1.775952717387246e-01   -4.100816691767791e-01   -2.524870649888426e-01   -1.160486124204931e-02   +3.035648505103886e-01; -2.880009437117901e-01   -1.489707682959135e-01   +1.708792752640204e-01   -1.995888203465829e-01   -1.337600400953908e-02   -6.041393812506742e-02   +3.965550134253497e-01   -9.604971903587868e-02; -2.618513295914203e-01   +2.686867191522130e-01   -1.253408735484113e-02   +2.906904928580268e-01   +3.139991606109890e-02   -7.903238275812692e-02   +4.566335063889708e-01   -1.898998436934710e-01; -3.777611107653726e-02   +3.407237780712121e-01   +2.825098903649945e-02   -6.281952808184359e-02   -3.776954885608132e-01   +7.916026612941442e-02   -1.284815237645399e-01   -3.703530779111781e-01];
L3I_L3E_iAMPA_netcon = [-1.272649615029686e-01   +4.500869828743870e-03   +9.580066306520441e-02   +2.343881778235828e-01   +1.522171799661632e-01   -2.041448302469513e-03   -6.708596485938384e-03   -1.553059202085628e-02   -3.919436429202599e-02   +2.377271870391283e-01   -1.560300021901867e-01   +1.389500125906848e-01; +5.406220548588698e-02   -1.825057555172135e-02   -4.492941551431172e-01   -4.032898735679384e-01   +1.772047668071065e-01   -4.278965167398148e-01   +4.635548343403350e-02   +3.729667376511479e-01   +1.063825153622262e-01   -1.659528471338262e-01   +2.246806759315242e-02   +3.665701282212702e-01; -4.360137696940585e-01   +1.549325259744087e-01   -4.511734758294900e-01   -1.173234204952231e-01   +2.784316464568127e-01   -3.569370595689673e-01   -2.490054343551919e-01   -3.853162934562304e-01   -4.393367451643882e-01   -3.472548340252394e-01   -3.418412351376292e-02   -2.184765288561772e-01; -1.499138428011612e-01   +2.482998230255027e-01   +2.827946057957543e-01   +2.951814386779142e-02   +4.156880139955503e-02   +1.222387065613398e-01   -2.959359428793266e-01   -3.481190300171333e-02   -2.802535025239745e-01   +7.217302863268674e-03   -8.219342357740686e-02   -1.845932814564335e-01; +1.174469795616857e-01   -2.243560947790231e-01   +1.226781730617584e-01   -1.619161981831218e-01   -5.642255106450427e-01   -8.486488785316125e-02   -2.181065815959413e-01   -1.565097640796326e-01   -2.583345891801866e-02   +2.848475607437767e-01   -4.856395209977521e-02   -6.417615435488171e-02; -1.191459833005983e-01   -3.157819574800412e-01   +1.721946708539572e-01   +7.003262633641012e-02   +2.825583984765737e-01   -6.338087158778104e-03   -5.452620484675010e-02   +5.315163414780338e-02   +2.039908464094843e-01   -4.032108483097595e-01   +5.537900101864199e-02   +8.280252759442687e-02; -2.943058519184193e-01   -3.304928304094923e-02   +4.713497491259357e-02   +1.119051895625615e-01   -7.571999136614219e-02   +1.846226412500959e-02   -9.615603370881107e-02   -3.547413880791021e-01   +2.022053622401490e-01   +1.579400727408287e-02   +2.702691487179742e-02   -1.900314253014019e-01; +7.583296660908741e-03   +1.296792556696252e-01   -1.016564517376279e-01   +7.554448209857276e-02   +1.809287230221984e-01   -1.325774648003525e-02   -3.391880731711062e-01   -5.656752033195480e-01   -1.461382960884132e-01   -1.077200515480529e-01   -2.292448740219316e-01   -3.732829227133004e-01; -2.096371098603626e-01   +4.338377367928522e-01   -2.378865882706775e-01   +2.620828094151309e-02   +2.651210551428331e-01   -6.776807867949958e-02   -1.694974803435830e-01   -6.980765682000195e-02   -1.913205770237627e-01   -1.424785861057049e-01   -6.619970305120869e-02   -8.987489672944787e-02; -2.373790322683871e-01   +2.419678065277955e-01   -7.295404409494673e-03   -1.076450091990584e-01   +3.087548458284810e-01   +2.187835147660471e-01   +2.306881053869921e-01   +2.485761943115873e-01   -1.102370827384533e-01   +2.862348909804839e-01   -9.672370422718742e-02   +1.382529993113531e-02; -2.259945840813149e-01   -2.154070569120707e-01   -3.938402766752055e-02   -2.460539911644529e-02   +9.976138212855166e-02   +8.536076389182620e-03   -1.824852198652202e-01   +3.302795727566585e-01   +2.439177548204508e-01   +2.664488513015009e-01   -1.555240377490261e-01   -9.433251473926110e-02; -4.033167933912346e-01   +2.471341598156967e-02   +2.117764032556727e-02   -3.828588355037250e-01   +1.153671969393449e-02   -4.385759603887081e-01   -2.956924513636874e-01   +3.006597880776737e-01   -1.266655669281568e-01   -2.675295834589684e-01   +1.194999946566682e-01   +6.324889833119056e-01];
L3E_L3I_iGABA_netcon = [+1.037918697897575e-01   +1.093846211171842e-01   -1.078654271859529e-01   +3.647540431867916e-02   +3.610870533706843e-01   +1.694879790014258e-01   -4.047937685232067e-01   -7.215365112838391e-02   +2.275107281450726e-02   +4.646087424126433e-02   +3.672793666968926e-01   -3.486297544993507e-02; -1.653057241275254e-01   +4.853205411557365e-02   +6.504751527622078e-02   +1.328528564725588e-01   +1.584788272430062e-01   -4.385583408493722e-02   -1.736889425340234e-01   -1.694718333488394e-01   -2.551981409938617e-01   +2.202879853114090e-01   -2.114399276970702e-02   -1.862948760003631e-01; -9.814958238201116e-02   -3.856710359490592e-01   -9.550433236422085e-02   -1.049319193619044e-01   +2.099789506588310e-01   +2.412959416975838e-01   -1.343379188602213e-02   -2.031150091537419e-01   +2.085672385819516e-01   +2.371831196320849e-01   +6.287459047586580e-02   +8.105079958817868e-02; +4.849808449456872e-02   -6.870850545932450e-02   +2.685070113107274e-01   -2.151560751105543e-01   +2.408833991508154e-02   +5.183683777346154e-02   -2.385076425498869e-01   +1.862274174392184e-01   -3.996983557071746e-01   +1.010616882804171e-01   -1.907021748146188e-01   +4.189151668599752e-01; +1.553598867741676e-01   +1.318945617485953e-01   -2.906889321069924e-01   -3.437084724925599e-01   -4.141560363931098e-01   +9.865345987256482e-03   -1.401001839377180e-01   -1.898220813057078e-01   -1.311651948827061e-01   -3.621126228965680e-01   +3.597684111738526e-02   -3.862800840742389e-01; +4.848857613852496e-02   -1.180474606569806e-01   +3.803598446572580e-02   +6.758284549472843e-02   -3.391114350934273e-01   -4.227029266257195e-01   +6.047615624633528e-02   +2.383075227576558e-01   +4.362966927683805e-02   -6.767821232213472e-01   +3.218614366837213e-01   -1.151596861991863e-01; -9.388435783632547e-02   +3.448099889669425e-01   +9.342178919275045e-02   -2.337785627509454e-01   +9.958881706563957e-02   -1.623638961319726e-01   -1.703429810994951e-01   +4.178374035033342e-01   +3.888194766612413e-01   -5.864072581645907e-02   -3.118980937329144e-02   -2.520909568900904e-01; +1.513817974292308e-01   -2.707162427695844e-02   +5.918040900517894e-01   -1.171100389724817e-01   -3.433817999209837e-01   +3.126687153989577e-01   -2.916491641617853e-01   +4.542382655661849e-01   +5.013096798445315e-02   +7.267519574704090e-03   -2.570454029445176e-01   -2.443886195213186e-01; -9.869509515934949e-02   +2.342178115465758e-01   +2.063188877107949e-02   +1.576659595020306e-01   +3.408296610100379e-01   +4.937801996759509e-01   +1.313490100619225e-01   +1.674491159570946e-01   +7.858569392537200e-03   +2.422510391173756e-01   -3.712232118282009e-01   +7.313678122229560e-02; +2.822403522333436e-01   -1.842361169938075e-01   -1.478564380413004e-01   +2.461819710791690e-01   -1.705983029288316e-01   +2.091603339478547e-01   -6.247489606141504e-02   -5.568188103663538e-02   -5.263020048373155e-01   +7.350977091910134e-02   -1.909399614497583e-01   -2.521226491364361e-01; -1.480727670118671e-01   +6.964295704720284e-03   -3.323572184664323e-01   +1.687730961208247e-01   +1.440648725767867e-01   +1.675042550957179e-01   -1.669386408911043e-01   +3.139129342328920e-01   -1.875646530570729e-02   +1.525765359962865e-01   +2.771189565975586e-01   +9.603371374054728e-02; +2.783869964162621e-01   +8.841727541405411e-02   -2.114065976236949e-01   +6.465627990344178e-02   +3.124400611535839e-02   -5.671319722752960e-02   +2.601110003703413e-01   -4.610260014042180e-01   -2.327347907481215e-01   +1.651388189948655e-01   -1.076677031315385e-01   -2.503996257935629e-01];
L2E_Input1_iAMPA_netcon = [-1.319926431711934e-01   -1.145840315500672e-01   +2.061268404504558e-01   -3.604546700332761e-02   -6.396559321412676e-02   +1.986324985191613e-01   +4.027309591984469e-01   +8.140278443988894e-02];
L2I_Input2_iAMPA_netcon = [+1.558385607927041e-01   +1.506967370074947e-01   +3.775963458003766e-01   -9.351345675864747e-02   +4.179557171696943e-02   -4.819120711886870e-01   -1.274347848360099e-01   -2.506749150073380e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
