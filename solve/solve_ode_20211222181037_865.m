function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.685575074986198e-01   +4.297082557423625e-01   +6.538894010462054e-01   -5.032448228745360e-01   -6.348860901609744e-02   +5.104669472383436e-01   -3.337568486851424e-02   +3.688247053520703e-02   +6.453943010334100e-01   +2.366304819351893e-01   +4.029924349091851e-02   -1.787326471766399e-01   -4.002881111638668e-01   -9.653890896475037e-01   -1.637632661615530e-01   +9.971206256998580e-02; +3.198687409209892e-01   -2.925952126217622e-01   -1.000025387353887e-02   -1.913902658108901e-01   -1.821065575667954e-01   +1.031305942508843e-01   +8.627365042071147e-01   -1.856999830377966e-01   +6.012913709047804e-01   +7.093856920381427e-01   +4.214702317637417e-01   -2.419131685480284e-01   -1.068000153821770e-01   -4.927831012948485e-01   +2.783143509469502e-01   +1.275522422765099e-01; -3.211071534525872e-01   -2.946422732540745e-01   -2.595925612372045e-01   +2.775539459601890e-01   +9.867429507451730e-02   +2.584923642596521e-01   -3.715220618495735e-01   -4.155089563975101e-01   +5.018629622070678e-01   +1.233964118487843e-01   +1.183708494849303e-01   -4.332144617829041e-01   +4.170638425500502e-01   -5.090831873167113e-01   -4.934155835756827e-01   -6.532668335004888e-02; +6.656901728830120e-02   -3.788323345494587e-01   +4.149731371305133e-01   -4.961195099862432e-01   +1.046896576942999e-02   -2.192986408269429e-01   +9.838168800972364e-01   -8.275636906313169e-01   -6.214178652523634e-01   -7.790335405217514e-01   +3.376499546237494e-01   -2.929261359993325e-01   -6.604311995307517e-01   +6.384730177129255e-01   -3.291613197486071e-01   +6.362656471728483e-01; +4.411073022156390e-01   -9.908642511145938e-02   -1.771406193578874e-01   -1.106781632445896e-01   +9.932017946367211e-02   -8.687874840236003e-01   +9.029081010130908e-01   +1.914657394978021e-02   +4.777310649963920e-01   +1.846168112769754e-01   +7.213555307650050e-01   +9.156148748515504e-02   +2.227394727159474e-01   -1.804597592867037e-01   +6.753553257453278e-01   +4.425749081256768e-01; -1.546476452232699e-01   -7.186860352777342e-01   +2.012117177815158e-01   +2.627913220739598e-01   -4.902396717161741e-01   -8.407126155220854e-02   +7.928116406863001e-02   +2.021851038140803e-01   +4.933978684767949e-01   -8.897603981642493e-03   -2.136921642757920e-01   +1.559326222870963e-01   -8.546895103591827e-01   -3.059738260355039e-01   -8.576362797155435e-02   +1.515565309324277e-01; -3.975516265355167e-02   +1.206403840389621e-01   +2.381765375102909e-01   +3.225395672758050e-02   -3.492608714296611e-01   -3.459847642814440e-01   +1.719233749107786e-01   -3.031782123268551e-01   -2.129318763021085e-01   -2.194689987972993e-01   +3.205811135534692e-01   -3.820128289239871e-01   -7.028255566860910e-01   -2.341093880912859e-01   +7.445914492080788e-02   -3.994506942080234e-02; -2.072320770912300e-01   +4.746084062354976e-01   +3.109619380579240e-01   +3.254989510121018e-01   -1.018329907815019e-01   +3.288118169042856e-01   -6.883818594134056e-02   -9.914240762199694e-02   -1.064897228178004e-01   +8.341074843112792e-01   -5.380635063129833e-01   -2.045267429514525e-01   -4.393456567322706e-01   -1.073751072203216e-01   +5.464660168865545e-01   -2.600940472544903e-01; -2.406590995643764e-01   +8.888346083200405e-01   -1.230640655508385e-01   -4.907465772511403e-01   +5.100072896987461e-01   +2.024458601577331e-01   +7.178632017968104e-01   +1.406870127454124e-02   +5.862518414050294e-02   +4.229361643533915e-01   -1.070197914693213e-01   +1.513705587879007e-01   +2.042293783328246e-01   +2.512723649285156e-01   -4.627638271827253e-02   +3.491571677518522e-02; -8.876702795326069e-02   -5.197642269137439e-01   -1.259219244500966e-01   +4.704268065923973e-01   -2.428676122049320e-01   +5.422745749666388e-01   -3.096127550075890e-01   +3.104049266885791e-01   +8.257905340975380e-02   -8.149328550303256e-01   +5.156741137614653e-01   -4.071128729708309e-01   +5.932566608428445e-01   -8.739604243781041e-01   -5.517826110768762e-02   -1.515253659431748e-01; +3.216455256526585e-01   -2.215281805618789e-01   +5.130708460655489e-01   -2.671582556670818e-01   +2.572397794846346e-01   -1.119773744741228e-01   -6.536093471836935e-02   -6.263531288912229e-01   +5.003286639312194e-01   +4.556811439693357e-01   -3.558042396725246e-01   -1.425783733109450e-01   -5.230293801718295e-01   +5.020827942791402e-01   +3.801185072578221e-02   -5.780879588108948e-01; -4.531771264019808e-01   +3.681461564298551e-01   +2.632299172053953e-02   -3.149473505864037e-01   +3.185186327938211e-01   +3.299537725930395e-01   -6.327057081766307e-01   -4.192945418917233e-01   +3.950894772195008e-02   +8.243267973727908e-01   -6.076858005534234e-01   +3.635690743990066e-01   -5.428737742621014e-01   +4.636331675098059e-01   -2.350175522736442e-01   +3.328925283245386e-01; -1.069206972871466e-01   -4.532605428298900e-01   -5.317509564878440e-01   +4.436225652484647e-01   -2.738142285537453e-01   +7.221522431920876e-01   +1.195949735850837e-01   +5.005401310453539e-01   -5.320111373093539e-01   +5.106485154110019e-01   -4.125439182502174e-01   +3.893294593976721e-01   +3.993611891795530e-01   -4.455139802844721e-02   +4.982752829703365e-01   -2.275556352097177e-01; +1.053011064055917e-01   +6.919813008925824e-02   +1.708287189430258e-01   +2.970410600803539e-01   +6.524905794140163e-01   +3.042930265951772e-01   +3.981737079349440e-02   +9.445766761150780e-02   -3.350152456428071e-02   +6.093193283983170e-01   +5.655707109473672e-01   -2.094441179854266e-01   +2.791395262103766e-01   -1.811898543411241e-01   +1.010841242556439e-01   -2.182166625011450e-01; +6.539317293005820e-02   +4.137263955702106e-01   +1.512265909134453e-01   -4.055119285590321e-01   -3.996444040359672e-01   +2.837464458007496e-01   -3.089029258139586e-01   +3.113047806910910e-01   +1.609298085973218e-01   -4.943788661850035e-01   -3.358079428009161e-01   -3.250636804689377e-01   +8.387228701328686e-04   +1.471933615349250e-01   +6.765037544095400e-01   +4.219348541665527e-01; +6.502968173814930e-02   -1.099043795110058e-01   +2.207884732269399e-01   -5.089901971701031e-01   -3.940324340186584e-01   -7.418317218238087e-01   +2.659671968812505e-01   -5.233461421044325e-01   +8.362247305449348e-01   -4.579775244455407e-01   -2.352518896152403e-01   +4.027803348434261e-01   +2.420010548072904e-01   -2.072359825909389e-02   -8.053588428941318e-01   +3.000575332081704e-01];
L1E_L1I_iGABA_netcon = [+3.131650659170325e-01   +3.670087041433091e-02   -4.805008874376680e-02   +1.365349048539282e-02   -8.514556208498733e-02   -6.070309391370553e-01   -1.536736540733139e-01   -6.996352361919774e-03   -6.311723607159597e-01   -7.492284030150114e-01   +3.300680217106823e-01   +3.337988956609282e-01   +1.347114315165923e-01   +7.328365856166259e-01   +4.926641137369400e-01   -1.123501193093317e-01; -4.228679002831772e-01   +4.421976302127693e-01   -1.058494676276882e-01   +2.087910995225693e-01   -3.212772015029939e-01   -3.330353786698415e-01   -3.904836186556310e-01   -2.321108916790645e-01   +3.242493035500645e-01   +5.355090350902831e-01   +5.340175179485049e-01   +6.110067866960132e-01   -5.010512340289780e-01   +2.771900228065855e-01   +1.782245262305203e-01   +5.609550559233714e-01; +3.541955973020697e-01   +6.818583909589518e-01   +2.535554357423582e-01   -1.787309910016132e-01   +3.412569994946902e-01   -1.028261504858335e-02   -3.294230667106379e-02   -1.736492028847915e-01   +3.806598827586160e-01   +7.112356903863174e-01   +1.775855306904832e-01   -7.163307649773099e-02   -3.113142212046947e-01   +3.200006688776470e-01   +1.430265126425488e-02   -3.168327596472941e-01; -3.502661636867713e-01   +3.023057302869340e-01   -3.275854499137681e-01   +3.725817106982643e-01   -2.534290024779325e-01   +8.708975915868467e-03   +3.574314690681900e-01   +3.217133854655178e-01   -1.766194246427331e-01   +3.028466861548201e-01   +6.492065124302219e-01   -2.968422560620677e-03   +3.689728275619596e-01   +2.537771564443309e-01   +4.422433259646751e-02   -2.067363111857947e-02; -6.767922760455818e-01   -1.465328859022196e-01   -9.709998058116651e-02   -2.553401005372664e-01   +1.843878474410765e-01   +6.908366476332173e-02   +7.051394174496514e-01   +3.747443000091092e-01   +2.989422566619569e-01   -4.030387142649268e-01   -5.269473387155905e-01   +3.842848043213089e-01   +1.954915338062828e-01   -5.954655996418540e-01   +3.472355504606446e-01   +2.405418026059693e-01; +1.510639213552131e-01   +4.892168576266865e-01   +5.593499768838878e-01   -6.507539065751604e-01   +4.509819113095871e-01   +4.940515680001669e-01   -4.882945240752509e-01   +3.376285273241361e-01   -1.885950720076710e-03   +6.873606373554859e-01   -7.635157652860062e-01   +8.361953125683548e-01   +3.330689817731582e-01   +1.000000000000000e+00   +3.269519259528471e-01   -4.094644335816972e-01; -2.025370621157581e-01   +5.689806253978253e-01   +1.715164859162422e-01   +2.450569633244478e-01   -2.016678014561784e-01   +1.740712424631755e-01   -1.034392255435613e-01   -3.299488088374116e-01   +5.007764763439869e-01   -2.346600981447049e-01   -4.335207207889222e-01   +5.067881296469258e-01   -9.474342094482829e-02   -4.822074492096979e-01   -2.308057642761509e-01   -3.540512153700272e-01; +2.958655202251740e-02   +8.104742535583934e-02   +2.541927091082637e-01   +4.980606508830319e-01   +5.768197690166355e-01   +1.572056432271113e-01   +1.551895622700717e-01   -7.103849637253205e-01   +1.922057550299359e-02   -1.823537986625386e-01   -2.651582636132385e-01   +3.784117789757505e-01   -2.495712003497272e-01   -7.950122558211723e-01   -1.548071578303567e-01   -1.772251757674958e-01; +1.457653141872020e-01   +2.022527608747675e-01   +3.338470938465906e-01   -2.290799048487692e-01   -8.208873577477192e-02   -2.032492322321672e-01   +7.037291917627218e-02   -3.603278566509030e-01   +2.220200376005248e-01   -2.156522559118026e-01   +5.924990064796902e-02   -7.572768708727372e-01   -1.986531358797535e-01   -2.714774373102053e-01   +6.736527491831924e-01   -1.128632232562874e-01; +2.540031175481996e-01   -1.096766913527020e-01   +1.162162835457280e-01   +3.499499810723999e-01   -7.512645558647831e-01   -2.679556692647571e-01   -4.548720105047240e-03   -4.491969684999825e-01   +2.308614677828983e-01   +2.595119374927354e-01   +6.585642870599594e-02   +3.583098135545535e-01   -6.576793635283537e-01   +3.547858921134546e-01   +3.700238590162576e-01   -2.294122769021796e-01; -6.291898989614143e-01   -2.989681806920313e-01   -4.351344031931102e-01   +1.578435332119336e-03   -7.256984490570579e-01   +5.798612772679169e-01   +2.762800107098691e-01   +9.349892325896697e-01   +6.579474644087457e-02   -2.642451549526367e-01   -5.466947519258064e-01   -2.949636511989008e-01   +1.356847895062990e-01   +8.611066211819747e-02   +3.012315335133733e-01   +3.507685379577108e-01; +4.465374130144540e-01   +6.101360104064669e-02   +1.837263911381705e-01   +1.842495986073589e-02   +3.889282128103996e-02   +1.361823923607874e-01   +2.931374362609960e-01   -1.991244342614956e-01   +6.780555083679353e-02   -6.166965770327648e-01   -2.096571503314917e-01   +7.702062871528768e-01   -3.603541152092681e-01   +4.981775709264307e-01   -3.547509470612437e-02   -7.215497681274448e-02; -3.883544029639726e-02   +4.259704986000902e-01   -2.365388007974310e-01   +5.960985408398056e-01   -3.498172034605758e-01   -1.548913577970919e-01   -1.818800542285897e-01   +7.299294006613390e-02   +2.507516743725944e-01   +6.078004321961075e-01   -3.924706755923666e-01   +2.255630135385926e-01   -3.254115431316744e-01   -1.582397234993412e-01   +1.434216572666872e-01   +5.125370190844125e-01; -4.225491625765350e-01   +2.741353738550946e-01   +3.929550414994502e-01   +2.916276383860673e-01   +1.110684811983385e-01   -4.447445667866147e-01   +7.507840080782055e-02   -2.132813520577257e-01   +1.465701207647270e-01   -8.728187825551779e-02   +2.271157308600165e-01   -4.602191755909155e-01   -2.661761591026517e-01   +2.441935314383654e-01   -3.764675594025449e-01   +1.778212004824458e-01; +3.198271820348682e-01   -9.451982381836714e-02   -7.528240753001318e-02   +1.690104545227877e-01   +2.202912512870328e-01   -1.288844070528290e-01   +1.032251448840826e-01   -1.072068854302437e-01   +7.476197023297033e-02   -3.137567301514984e-01   -7.100770034405317e-02   +2.893804303837126e-01   -3.228325117595049e-01   -6.973872589147190e-01   -6.270548727977209e-01   -6.067891849630872e-01; +7.811112800267310e-03   +6.942774997984934e-01   +3.627805825819198e-01   +1.246360406030424e-01   +7.255460218523661e-01   +4.265740598636372e-01   -9.158068716527451e-02   +8.078598539332736e-02   +2.236446097075565e-01   -4.333146574409709e-01   +6.349395240659197e-02   +7.093178317067562e-02   +1.530715458923136e-01   +4.812599099725507e-01   -1.700051782998339e-01   -7.998664990191051e-02];
L2I_L1I_iGABA_netcon = [+5.588020279234718e-02   -4.967847079527101e-01   +3.234886975074071e-01   -7.152223884455428e-01   -1.589523036108534e-01   +3.673381754219428e-01   -3.527907571880671e-01   -1.824037727748585e-01; +2.175928238390907e-01   +2.824122217198869e-01   -1.229140729423764e-01   -2.393091668500996e-01   +5.773818367593456e-01   +3.203759854694764e-01   +4.332822024151123e-01   +2.919476154635852e-01; +3.051608148943586e-01   -1.516237774007284e-01   +3.040273023068604e-02   +4.567154136050617e-01   +2.269163381413391e-01   -6.783321248205512e-01   -3.052551023035900e-01   +2.377943847417897e-01; -1.968083123627475e-01   +2.350983675628451e-01   +1.248534294929258e-01   +2.040411096420990e-01   +8.750335753343051e-02   +2.910366602318561e-01   +5.945355309330556e-01   -8.015270890720125e-02; -3.825517765346131e-02   +2.960304954056234e-01   +7.032090114275562e-01   -5.950137075642778e-02   +2.908712382285087e-01   +2.757805742155724e-01   +1.425401046098934e-01   +7.887193955379826e-01; -4.649287925802886e-01   +2.195032749395865e-01   -8.928604431034179e-02   -1.844016935808114e-01   -5.292084937765094e-01   +6.933576233615267e-01   +1.542490997821325e-01   -3.382767412282454e-01; -1.232349621568031e-01   +2.850746078145338e-01   +4.913744476261191e-02   +7.790934679260272e-02   +1.201905547332556e-01   +1.016420338113705e-01   +5.652024444615402e-01   -3.177665706045499e-01; +2.336748978283787e-03   +1.615689842323806e-01   +5.541306620062859e-01   -3.937732704960565e-01   +4.963461376815914e-01   -1.230774061349057e-01   +2.151677536812344e-01   -1.227967407474130e-01; -2.168970933699474e-01   +3.472047316173572e-01   +6.529715549083279e-02   -1.533557488841690e-01   +4.669751525007936e-01   +3.968461737361652e-01   +5.533626994012800e-01   -7.639148896420238e-01; -2.889276776774346e-01   +1.875838518277553e-01   +2.060914207810055e-02   -4.476778617487335e-01   +7.285285995226758e-01   +2.756962053825009e-01   -2.568825918104279e-01   +7.699822710747015e-02; +1.456213626618778e-01   +4.722693638651346e-02   +5.612847936986461e-01   +1.525878871555774e-01   -6.397236552272147e-01   +4.689010078364769e-01   -1.513365314028671e-01   -3.514771478661486e-01; +5.087085188640488e-01   -5.124077918972406e-01   +1.787352805115541e-02   +4.918939620086766e-01   -7.250933333550803e-01   -4.840622268352689e-01   +2.140610156153297e-02   +4.296329614015201e-01; -2.205078026625359e-01   +9.421191267650156e-02   -5.863456246637927e-02   -3.634454130150458e-01   +5.531129653146407e-01   -5.879548695698701e-01   -4.256797748368114e-01   -2.262755455478938e-02; -2.867185389124284e-01   +9.666703703903549e-02   +8.702815050029966e-02   +3.117572303266539e-01   +3.818265024647349e-01   +3.441926808017939e-01   +2.241976734652515e-01   -4.059264852583873e-01; +5.223503405814400e-01   +4.452405950494292e-02   -8.561009374270034e-02   -3.346089865763457e-02   -2.176727937799715e-01   -2.479134321123563e-01   -1.331112237425140e-02   +8.042099081278886e-02; -8.943175163976702e-02   +4.541649648859983e-01   +6.186132420234922e-01   -2.351760324879238e-01   +2.610375433664242e-01   -7.990966099179267e-01   -2.081975785111413e-01   +1.214511104286923e-01];
L1I_L2I_iGABA_netcon = [-3.126251804996968e-01   -1.642274630794439e-01   -1.154587283399165e-01   -3.661351271439944e-01   +9.679473831882687e-02   +2.053986971839252e-01   +2.956460299934660e-01   +2.830485684120032e-01   -4.535941412668443e-01   -1.684765717758410e-01   -4.443349233681822e-01   +3.056036067284816e-01   +4.915194239090443e-01   -1.114504256254363e-01   +4.244139403044727e-01   +6.523029634307079e-01; -6.238556830142303e-01   +1.320713291702483e-01   +1.657191911862078e-01   +5.860475730275352e-02   +2.175145630934381e-01   +3.302031235333739e-01   +1.157250542241747e-01   -2.674467927840718e-01   -2.677405499651650e-01   +3.712698723710630e-01   -1.152846951436820e-02   +1.980012904560414e-01   +8.966391706747627e-02   +2.885456526756705e-01   -2.543748353018964e-02   -2.710688180613041e-01; -2.943267264459226e-01   +2.337971137380672e-01   -5.320754458172774e-02   +1.236263317997282e-01   +1.359863986904090e-01   +6.440674657608567e-01   +4.165397206422413e-01   +6.171493864419177e-01   -5.212256614674525e-01   +5.419230169404224e-01   +1.323240326651029e-01   +6.966755830563917e-02   +2.415545891513089e-01   -9.736060470743618e-02   +4.396426094886737e-01   +4.809998053405390e-01; +1.000000000000000e+00   -1.241065334622993e-01   -4.276252739480816e-01   -3.415300216607361e-02   +8.319568180558502e-01   -4.096160125683809e-01   +1.860654917266367e-01   +7.529307053116523e-01   -4.571364624810842e-01   -5.948518337180630e-01   -9.339918796575068e-02   +3.144792959813342e-01   -4.943441950007370e-01   -4.416712357173870e-01   +3.320580714522254e-01   -2.932830850187885e-02; -4.950196315406926e-02   +7.832388146151529e-01   +2.378196230505922e-01   -9.525050799008947e-01   -3.716733619914007e-01   -6.478325717406418e-01   -1.659873839990347e-01   +5.891811970273740e-01   -3.426841682054036e-01   -3.608818686367793e-01   +4.420462145457012e-01   +5.235333128560957e-01   +4.310618087791904e-01   -5.310560825184932e-02   +7.141663506985255e-01   +2.178471719678938e-01; +2.561320465638718e-01   +3.660761295880119e-01   +3.076336229274744e-01   -3.792725903719051e-01   +6.155006929295630e-02   -5.995955624451065e-02   +3.689635269816678e-02   -5.327893595257868e-02   -1.005509706136880e-01   +1.987111639647675e-01   -5.754544057345985e-01   +2.037128949084928e-01   +2.994816886558158e-01   +3.941578444181661e-01   -3.952508731558367e-03   +5.942891427743284e-01; +7.272748612028778e-01   -5.511830668825285e-01   -9.427069622981941e-02   +4.718607714388345e-01   +8.512775715573093e-01   +1.658762743540823e-01   -2.710937208252092e-01   -1.968100907149346e-01   +4.624311596577751e-01   +5.156370431086806e-02   -6.967360222034231e-02   -3.542558446190489e-01   +1.225773913549718e-01   +1.875124129817160e-01   +2.330756642851114e-01   +4.111622751534817e-01; +1.402705452399624e-01   +8.130789950681024e-01   -2.182025018555914e-01   -2.782001130072053e-02   -1.417630291427203e-01   -4.248951567190183e-01   -2.243981159738164e-01   +5.023452034504541e-01   +5.837908902028478e-01   +4.958372319960863e-01   -3.780741440738931e-01   +1.345736036403898e-01   +1.081212331920637e-01   +6.446762483297407e-01   -3.936870321996844e-02   +2.032434047261815e-01];
L2E_L1E_iAMPA_netcon = [+4.729757935576941e-01   +5.566972353866734e-01   +4.955818791413971e-01   -4.423594605848015e-01   -3.980693795589993e-01   +6.614430294716518e-02   -4.851695063096407e-01   +6.217142626402673e-01; +6.363927109136309e-01   +3.556252018247566e-01   +6.355441293826746e-01   -6.195556908084934e-01   -2.800770967173055e-01   -2.570872682500873e-01   -3.379450131840141e-01   -5.481271336165899e-01; +7.135153836534563e-01   -1.742387136742898e-01   -4.126577654719980e-01   +2.663632430306515e-01   +8.312341444934257e-02   +1.956833503317970e-01   -2.876742913446443e-01   +1.091574294539785e-01; -1.235542262813024e-01   +2.678621332262366e-01   +2.877758829059427e-01   +5.418009006762893e-02   +1.233534391568207e-01   +6.179876050328520e-01   -4.824761388166322e-03   +7.663290173731779e-02; -5.919898743045080e-02   -2.154618557213078e-01   -3.052138104830353e-01   +8.004293859336338e-01   -7.449093772094849e-02   -4.346199463155013e-01   -1.284824023570469e-01   -9.819520465632239e-02; -5.164756915228988e-02   +8.625603943025604e-01   +6.687321696492661e-02   -1.805959373023593e-01   -2.461815691505475e-02   +1.000000000000000e+00   +6.733850322930364e-02   +3.854189176202424e-01; -3.149489351964498e-01   -3.582053365678873e-01   -5.118708435079709e-01   +5.174619784274879e-01   +2.613362428543704e-02   +1.279677144015056e-01   +5.966252156397425e-02   -4.064335284270467e-02; +2.343960111083599e-01   -1.145248564263979e-01   -5.969021034997531e-01   +1.861179680892628e-01   +2.234501524068812e-01   -6.706471082945987e-01   -3.143059736329417e-01   +5.383396565048006e-01; -1.973550100032359e-01   +3.080714220278977e-01   +3.304210939971026e-01   -5.507294860295913e-02   +3.255627922996407e-01   +1.878443293823061e-01   +8.184354348193271e-02   +2.569962919288425e-01; -2.071181891899782e-01   +1.153588877536437e-02   +4.824405209489729e-01   -2.199079519451186e-01   +3.902407637062688e-01   -7.744458140103651e-01   -3.265268497024107e-02   +9.687109383123670e-02; +1.057820524500602e-01   -1.175988004469826e-01   -7.127767077137064e-01   -2.748340002187292e-01   -6.453928790916696e-01   -7.352940713247360e-01   -1.209850017835286e-01   +7.814137515565278e-02; -9.389528407328177e-02   +6.339092268739545e-02   -3.739121495230503e-01   -2.247415236543089e-01   -6.001649383700117e-02   +5.669246643244604e-01   -5.741013782637421e-01   -8.916090436674634e-02; -2.515164125078317e-01   -6.965586054689252e-01   +2.716819693659389e-01   +8.300274998815962e-02   +6.204922687092195e-02   -3.755579299630840e-01   -2.018246306118503e-01   +3.812933525544489e-02; -1.850737750087290e-01   +2.882961967374001e-01   -2.515162868154792e-02   -1.297368291877165e-02   +4.685284760456960e-01   -2.598566654736784e-01   -1.972228070712575e-01   -6.059689605736104e-02; +1.589608727621745e-01   +1.141616810008170e-01   +1.774959911760007e-01   -1.595623793123371e-02   +4.936069563002239e-01   -4.779497118826767e-01   +1.792562856821169e-01   +1.050323772290597e-01; +2.893567067401003e-01   +1.317630964586582e-01   +2.464782113729384e-01   -7.018193901547636e-02   +6.868792033402231e-02   +3.602080043604522e-01   -1.442363985765822e-02   +1.992965189178723e-01];
L1E_L2E_iAMPA_netcon = [+1.969568737691507e-01   -1.094490275056605e-01   +3.870136196119710e-02   -6.797421016380463e-01   -6.076508560437756e-01   +8.057651220156262e-01   +6.106747034611956e-01   +7.817643001005756e-02   +3.037755577051090e-01   -6.065668929444681e-01   +2.553070786746638e-01   +3.558242762989966e-04   +1.479412969071262e-01   +3.221273040313418e-01   -6.831449184095766e-01   +2.401470072766842e-01; +4.822461253248013e-01   -1.012947221052783e-01   -1.983579489746638e-01   +1.787168473700044e-01   +3.705048953451641e-01   +4.358052517992709e-01   -5.979698727179924e-01   -4.852351901021939e-01   +4.272739439251858e-01   +2.995841164427820e-02   -2.364322388028415e-01   +1.570176403837377e-01   +1.206229065674419e-02   -1.630141425672572e-01   +8.027043336302636e-01   +1.180596875210624e-01; -1.000000000000000e+00   -1.019159468874823e-01   -2.459604476335024e-01   +2.831254094984412e-01   +4.543978661361429e-01   +6.228329982871967e-01   +1.406773421332631e-01   -9.941752814332841e-02   +7.419830746809326e-01   +4.502746842385372e-01   +2.411472401294963e-01   -6.369912162056524e-01   -4.598265539258179e-01   +5.537488011748238e-01   +1.397725963939838e-01   +3.325508331705700e-01; +7.207887137278172e-01   -4.114836757638952e-01   +4.014246471746014e-01   -1.147074817237098e-01   +4.914668664761506e-01   +3.493912555494277e-01   -1.066579693413279e-01   +3.212229348692593e-01   -6.513185375708287e-01   +6.389619792935300e-01   -2.680091949505478e-01   -3.955462963298659e-01   +2.971861844083776e-01   +3.133669628260016e-01   +4.035119426427334e-01   +1.160195753551197e-02; +6.161548285784305e-01   -5.967853823151213e-03   -3.496780247667255e-01   +1.662791701583314e-01   -8.904484182011582e-02   +4.732736298503007e-01   +4.447391351642420e-01   -9.131278341761456e-01   +3.785446069558560e-01   +6.099598543484211e-04   -5.860482307730933e-01   -1.061665874808138e-01   +2.530069997325312e-01   +4.748732337663059e-01   +3.258288515049744e-01   -4.355773910130540e-01; +9.090951957085770e-02   -4.433187220105922e-01   -1.123162087432176e-01   +2.099800279036257e-01   -7.807013386505680e-02   +1.236057366903999e-02   -3.571671166659705e-01   -7.576607263706320e-01   -1.430447779944692e-01   -2.775534391980918e-01   +3.590300273067471e-01   +3.125828911490453e-01   +4.524484702049255e-01   -8.941984067047615e-01   -1.390330773415378e-02   -1.563375614040743e-01; -6.265008493741278e-01   -1.047598822246235e-01   +1.724760210960479e-01   +4.788515146700058e-01   +4.260485480795567e-02   +5.179262132911990e-01   +3.569804098876118e-01   +3.513746124520898e-01   -7.934151930994142e-01   +1.563485432917689e-01   +1.513304738430898e-02   -1.257241717003298e-01   -1.313083606176619e-01   +6.952322044009868e-02   -6.988290351965856e-02   +1.446433489233510e-01; +6.035080556087710e-01   +3.660890270419651e-01   -6.422279325456244e-01   -2.604953433504875e-01   +2.351165713103784e-01   +2.243721759555036e-01   -6.480101027222256e-01   -1.352818119766595e-01   -6.776847592743772e-01   +2.269619853905989e-01   +9.317642992422197e-02   -3.777940177756692e-01   +4.135771120939487e-01   +1.784366227140980e-01   +7.071424286720052e-01   +2.192604155893501e-01];
L2I_L2E_iAMPA_netcon = [+9.426516312557401e-01   +3.098878218083151e-01   -6.810186409502403e-01   +2.178960620302930e-01   +2.806798095754632e-01   +2.232853051659902e-01   +2.782646838317868e-01   -4.040571900687280e-01; +5.702935285880008e-01   -1.303477250809693e-01   -1.953719981133663e-01   +6.364874742274446e-02   +3.888088416171935e-01   -1.623095176643376e-01   -5.409670924176549e-02   +3.825499228706505e-01; +1.229121271397424e-01   -1.280908666000911e-01   -7.247701030352646e-01   +4.651660283729852e-01   -2.592964781474447e-01   -4.274533109985773e-01   +2.655161924297612e-02   -5.621337578764110e-01; -3.078306165436256e-01   -5.295663023152856e-02   +1.000000000000000e+00   +5.867921885724651e-02   -5.525889071992743e-01   -2.345671464890514e-01   -4.071992477925111e-02   +2.479468348647368e-01; -4.729394787809096e-02   -6.683340817256767e-01   +5.955373719164484e-02   -4.282477890516111e-01   -4.861641705831485e-02   -3.618497599158347e-01   +6.073341807843047e-01   -1.147105829546885e-01; +5.139463147147958e-01   -2.032359142836099e-01   +2.766373695878326e-01   -9.973784124138618e-02   -2.741158756747942e-01   +4.695428680999070e-01   -2.829263588291441e-01   +3.277681086030046e-01; -2.870536466941044e-01   +2.676049686267212e-01   +1.787930289658105e-02   +2.810171672704515e-01   +4.750402219142054e-01   -3.255813917090508e-01   -6.670226236258599e-02   +6.667004146667440e-01; -1.194176928557935e-01   -7.946982309263455e-01   +6.447502150763365e-01   -2.536018394869175e-02   -3.219540138353040e-01   -2.866222707548496e-01   -5.486334257274370e-02   +2.982499106654532e-01];
L2E_L2I_iGABA_netcon = [-5.269106770318461e-02   +1.174892399357309e-01   +7.173766496934720e-01   -7.714379199448050e-01   -6.593038450592421e-01   +7.710690793888993e-01   +3.757049490126396e-01   -4.904725669859018e-02; -2.076929711965670e-01   -3.795812995353268e-01   -2.345604323236462e-01   +6.443714331142257e-01   -2.690543724230873e-01   +4.788113968244015e-01   -7.340243685754033e-01   +1.284946376189684e-01; -2.735450992051021e-01   -6.219351807004319e-01   -3.687447800885565e-02   +1.394561677398732e-01   +4.076561404239493e-01   +3.755885737381204e-02   +2.606442500385739e-01   -5.533227934391706e-01; +1.000000000000000e+00   +3.628721218097946e-01   +3.866415340576591e-01   +1.577869883376887e-01   +9.855507556859084e-01   -5.480590930133945e-01   -4.208522162387937e-01   -2.992296521744505e-01; -4.083672705884268e-01   +1.156066725605098e-01   +2.748747093444260e-01   +1.137782777567137e-01   -2.335752642346574e-01   +7.179306090167827e-02   -2.612093824870924e-02   +2.370549428237756e-01; -4.537036933708229e-01   +5.520554633245741e-01   -4.647595873794158e-01   +6.143987322298640e-01   -5.799920504593571e-01   +4.458974891763270e-01   +3.437740116952973e-01   +6.943611996902752e-01; +1.827371335134377e-01   +3.828270310462349e-01   -8.703252256159318e-01   -3.506300121520506e-02   +7.329456595158325e-01   +2.920931121296347e-01   +6.338952165234006e-02   -1.690920361036463e-01; -3.547012119117329e-01   -1.007787446325272e-01   +1.623326304155220e-01   -7.036417783281722e-01   -3.440775196004138e-02   -1.164615663771132e-01   +9.102395824089186e-01   +1.871277563291258e-01];
L3E_L2E_iAMPA_netcon = [+1.075373203555783e-01   +2.441894177862179e-01   +8.692290561368375e-02   -2.982676298555479e-02   -3.677335392154659e-01   +7.812138680388681e-02   -2.409060923847643e-01   +1.152841489978434e-01   -6.394466357894599e-01   -5.202802011952485e-01   -6.926661022270085e-03   +4.589242183903585e-01; +1.223085963206591e-01   +9.114409191771269e-02   +6.361367212873639e-02   +7.829667793725351e-01   -5.522508437353305e-01   -2.853738905421464e-01   -2.733818750867428e-01   +2.450560240318670e-01   +2.253501362462254e-01   +4.104739364979451e-01   -4.582969182697460e-01   +5.090355111333550e-01; +4.812555952081548e-01   -1.543957018160864e-01   +3.418601989379151e-01   +5.826474981409043e-01   +4.680428280602354e-01   +6.594913180267989e-01   +1.575889626046585e-03   +2.763289976755494e-01   +4.685959882247119e-01   +2.017720276807423e-02   -6.846010258163925e-01   -8.162834173150676e-01; -2.878614575893347e-01   -1.039188607536274e-01   +6.240632989399266e-01   +1.041969356049879e-01   -6.663495659540212e-01   -3.055675798272939e-01   -1.719654040590384e-01   -6.510766739897531e-01   -3.110271032263079e-01   -1.258857964546274e-01   -1.599193645282014e-02   -6.920367623737802e-01; +7.704775358537581e-01   -3.135728111960178e-01   -5.600221648307335e-01   +1.801541434595285e-01   +1.624676833599690e-01   +4.187039492236498e-01   +1.000000000000000e+00   -1.030665106714927e-01   +3.353803437196492e-01   +4.666514433534213e-01   -3.903791319962798e-01   -3.918313637742818e-01; +5.538252790167635e-01   +4.036762313451867e-01   -5.283721413025397e-01   +7.956600515563188e-01   +1.810450209194755e-01   -3.303924919896831e-01   +8.036240174103788e-02   -4.138304898904033e-01   -2.547799555890208e-01   +5.344894583729692e-01   -7.939217644381443e-01   -5.358679922951552e-01; -2.508175294742380e-01   +2.959251682738961e-01   -1.437397809021941e-01   -1.361421341230728e-01   +4.559143623498674e-02   -3.788047861173545e-01   +5.074943716679700e-02   -9.763623625987422e-03   +4.419404828939167e-02   -3.683673702503626e-01   +4.783756300292146e-01   -3.653166626434182e-01; +2.885807021106447e-01   -7.983997215350945e-01   -2.823992999328401e-01   +7.328622937199761e-02   +8.908010325044824e-02   -2.874635192474158e-01   -2.492913066751460e-01   -3.271227697731979e-01   +2.134261430194945e-01   -4.265793514710464e-02   -1.432250368637681e-01   -2.456722117530943e-01];
L3I_L2I_iGABA_netcon = [-1.234143349985436e-01   +7.877671017351194e-02   -7.684072682507939e-01   +1.612375213696276e-01   +3.953814473710587e-02   +2.398872216228809e-04   -4.192998793332213e-01   +9.194208093556186e-02   +1.108116541671738e-01   +2.960383104728703e-01   -7.098871390376305e-02   -7.079160187342981e-01; -6.398182255871972e-02   +7.937774417535480e-01   +2.659574594986560e-01   -3.508084215698410e-01   +4.566786381088507e-01   +1.236833103518523e-01   -3.103120470266081e-01   -3.183300290733488e-01   -3.092758961114243e-01   +3.033283755131995e-02   -1.856793824458029e-01   +4.106062138917598e-01; +6.349269392855071e-01   -2.740779653760317e-01   -7.311909921909381e-01   +3.580727710415677e-02   -7.024402616218141e-02   -3.828483737998839e-02   +9.028060271549315e-02   +1.873107514570280e-01   +1.542421425576133e-01   +4.097987627968123e-01   -7.147133582611500e-01   -9.999904275045227e-02; +1.140734666054094e-01   +7.093513709312045e-01   +8.354477366652417e-01   +1.287188870045435e-02   -5.791638993344844e-02   -4.232386358413012e-01   -5.660739926597635e-02   +1.014346063440827e-01   +8.507582168370783e-01   -3.012041069752966e-01   +6.368674114875235e-01   -1.048759922465670e-03; +6.412136840615759e-01   +3.262131431341253e-02   +1.584537676461116e-01   -7.877343929448094e-02   -1.580208005350256e-01   +6.475154996451574e-01   -3.135643235703711e-01   +6.963871916430878e-01   +5.472585302248461e-01   -9.861020894019962e-02   -1.805732436017602e-01   +5.462555941543796e-01; -5.465434718719162e-01   +2.246095367668578e-01   -6.395349505162363e-01   -4.224533589250860e-01   +8.190172854120009e-01   -1.869443699618275e-01   -2.988625995254831e-01   +3.017007983147156e-01   +3.698778625719349e-01   -6.076445130357345e-01   +1.083339007971499e-01   +6.146594041143978e-01; -4.960199522021028e-01   -4.965711657597530e-01   +6.598356684217930e-01   +2.499238154243497e-01   +1.411075676086599e-01   +6.206912649810702e-01   +4.019692374292301e-01   +2.614637995680273e-01   -6.915106234145737e-01   -1.894405951613576e-01   -9.577459490954190e-02   +1.716734717399269e-01; -1.815756303612495e-02   -1.839437509191611e-01   +1.045274993921367e-01   +6.018959694623959e-01   +3.351711777075733e-01   +4.548936524208930e-04   -3.227896270285945e-01   +3.700574028583267e-01   -4.776292049494946e-02   +4.253083023134007e-01   +9.986416753640509e-03   +3.312598761541184e-01];
L2E_L3E_iAMPA_netcon = [-2.233579996062471e-01   +3.477461152471264e-01   +8.330953774367891e-01   -5.374240907520151e-01   +2.824449787208977e-01   +6.837157649412977e-01   +7.219418233433758e-02   +6.979559258178960e-01; +3.872346227094970e-01   +6.374536276007240e-01   +3.957561213267934e-01   -7.483998273716963e-01   +1.405104112697832e-01   +1.351277936539517e-01   -4.388773577725704e-01   +4.068411028753436e-01; +7.071637482296883e-01   -1.485623991611060e-01   -3.672835932308451e-01   +3.424170094921024e-01   -4.422277937481125e-02   +4.344220515942297e-01   -3.986343060410524e-02   +5.913522386408372e-01; +6.937832837380617e-02   +1.817845663552506e-02   +4.259874416021937e-02   +1.001076178363790e-01   -2.387952397245265e-01   +7.023165595828206e-01   +7.528310129868409e-01   +2.084704003772899e-02; -6.254322956453086e-02   -3.601307224082483e-01   +3.983127103285031e-02   -5.221512178060225e-02   +5.022334299385313e-01   -2.000896765103123e-02   +1.272269949954790e-01   +4.509645119865760e-01; +4.335551199646233e-01   +6.080408377437444e-01   -6.330518115228968e-01   +7.108713512316883e-02   +3.072400827550567e-01   +4.520759846526780e-01   -6.177800710102894e-01   -9.056753547416131e-02; -5.103169154361917e-01   -4.067161798706000e-02   +1.930885027753086e-01   +7.388059257042587e-02   -3.507340270003181e-01   -2.113262854750781e-02   +3.797434762591333e-02   -7.679181750977090e-01; -2.966490805869058e-02   -2.706442213782090e-01   +5.806222081443647e-01   -2.875689913907527e-01   -1.006187356252493e-01   -3.386021953691212e-01   -9.642712409215085e-02   -2.816807726336695e-01; -3.977044085737702e-01   +3.314324448796989e-02   +4.042267667796311e-02   -3.251409048806189e-01   -4.590786386198754e-01   +1.463772684491347e-01   -1.553387155839223e-01   +2.746518278749787e-02; +3.067516462774449e-01   -2.817743668170383e-01   -1.053704249689611e-01   -5.697631574331915e-02   -9.979719881192359e-02   -5.553613907579784e-01   +2.781063962790975e-01   -7.156425435413862e-01; +2.004546944618444e-01   -5.570902230847570e-01   -1.000000000000000e+00   +3.861574529226036e-01   -5.466014593657804e-02   -4.443828579960183e-01   -5.331077973200726e-01   +2.420093397604467e-02; +3.263284062448174e-01   +2.373664681151357e-01   -1.583536353846808e-01   +4.832198696484780e-02   -5.895634279702956e-01   -2.937023560179623e-01   -4.545092259813823e-01   -5.730236656543136e-01];
L2I_L3I_iGABA_netcon = [-3.133549378712309e-01   +3.774113459790718e-02   -3.139728041496811e-01   +2.879381495801185e-01   +3.931866627186803e-01   +3.390552335137116e-01   -1.878565331991335e-01   +4.968127474036409e-01; -1.485984110324499e-01   -3.345464264481783e-01   +3.725940426359966e-01   -3.192177099066427e-01   -3.126108088563089e-01   -1.179635602710084e-01   +3.446804907648288e-01   +2.506302196478569e-01; -2.006894067221435e-01   -2.965117083049502e-01   -4.893243553020482e-01   +4.870878525005021e-01   +1.601577781273498e-01   -9.615081597521768e-02   -3.752081445908509e-02   -2.273495447928324e-01; -6.168035841384064e-01   -6.566268855675566e-01   -1.797466451072208e-01   +3.241791312043064e-01   -2.495322371894690e-01   +6.231143832089095e-02   +3.548924296879305e-01   +6.055800826690857e-02; +2.773430322447609e-01   -8.683117181016181e-02   -4.653461857974245e-01   +1.061993957084083e-01   -3.754238957130610e-01   +1.440416695522788e-01   +3.893829618919860e-01   -2.404887061688189e-01; -1.738499126831575e-01   +1.135355939292566e-01   -2.776191997650206e-01   -8.942007828938618e-02   +4.840702191401115e-01   +2.824408501331494e-02   -2.672049247209243e-02   +1.764443993899534e-01; +5.248313374776088e-02   +4.903361833074382e-01   -1.878964869323696e-01   -4.106563218556475e-02   +9.154797637750309e-01   +4.484199300592193e-01   +1.417318459968648e-01   +7.528567904286116e-01; +1.691998277900125e-01   +2.925084726724227e-01   -3.660061561639082e-01   +3.547102959051964e-01   -7.646808858652349e-02   +6.205106904619271e-01   +5.299709010258890e-01   +2.395458450580040e-01; +8.520120177115208e-01   +6.188491321994639e-01   +7.369438984269527e-01   -5.823615291141787e-01   -8.685575165666932e-01   +6.735055053687913e-02   +3.505662813017885e-01   -2.510828912353482e-01; +7.830132286827304e-02   -7.587420692711341e-01   -2.412005934568992e-01   +2.959427339490991e-01   +3.075057843108370e-01   +3.829604190299434e-01   +2.742959502160464e-01   -2.655282307978990e-01; -5.648091517015159e-01   -3.593607376762303e-02   +1.788040171683174e-01   +2.907595656071647e-01   +3.133354433867984e-01   -7.025684999334343e-01   -8.968381524161189e-01   -3.068754888128683e-01; -5.579636820800538e-03   -3.822567509579650e-02   +1.434489078232139e-01   -7.580349000506508e-01   -2.194391266066905e-01   +3.458900040856191e-01   -5.823324250863122e-01   -4.033267999815816e-01];
L3I_L3E_iAMPA_netcon = [-7.228326764533302e-01   -5.727645098139640e-01   -1.086880805207816e-01   -1.111942613772259e-01   -5.037737259224163e-01   -8.775660172005558e-01   -2.930355356245934e-01   -3.756437943406883e-01   +5.397551565050153e-01   -6.416250903003906e-01   +3.295454885833813e-01   +3.126609788505584e-01; +1.238876921518555e-01   -4.106787547644983e-02   +4.714252218078981e-01   -7.592940691710455e-01   +9.267536316425018e-01   +6.165082767166531e-01   +4.480060015113997e-01   +6.258459916892051e-01   -2.715281809279092e-02   -9.080753097653895e-01   -6.011814786559020e-01   +1.365663123416638e-01; -5.299894787346463e-01   -1.742951724249444e-01   +3.702664783821463e-01   -4.639407577391370e-01   +2.487669381850321e-02   +4.658814888230601e-01   -3.477215780724783e-01   -2.467923505635642e-01   +2.484993535172479e-01   +2.799954008087568e-01   -1.770390157319873e-01   -2.178114784969656e-01; -4.443318947142306e-01   -2.049103114315601e-01   -3.822683425849965e-01   -8.432241667615796e-01   +2.458922097869631e-02   +2.623260100950875e-03   -2.243190313007168e-01   +9.772415775111055e-01   +4.603431967984676e-01   +4.011870738925024e-01   -4.447215605177193e-01   +2.134846452130243e-01; +1.398618644620431e-01   -6.308182837394262e-01   -6.656406909880097e-01   +3.133687510171811e-01   +2.332570476787245e-01   -2.030423420240881e-01   -3.768710714073917e-01   -7.278042240227824e-01   -1.105741101123097e-01   -4.198965578263906e-01   -3.395132600689956e-01   +2.534064349441816e-01; +9.347743156829489e-01   -2.980900801905880e-01   +4.216731673409600e-02   +7.087821716188375e-02   -6.144145638481541e-01   +8.318252303508971e-01   -2.869905330711423e-01   -6.796166891561854e-01   +2.287647289584521e-02   +4.566565011031403e-01   -7.046814095284808e-01   +6.341968638121784e-01; +1.215924761539742e-01   -2.074817144705676e-02   +7.041426161555006e-01   +1.142478038371695e-01   -5.876656449835238e-01   +5.793339900315573e-02   +5.638521665768229e-01   +9.247363690975949e-01   -2.823677341758486e-01   -8.231635966202644e-02   -3.214802184963131e-01   +7.661224240910935e-01; +4.584271617990915e-01   -7.603729063962416e-01   +8.441987535512083e-01   +3.648851665763893e-01   +2.508859213266755e-01   -1.032189910560514e-01   +1.293464193221710e-01   +3.163653829133060e-01   +5.109480311656638e-01   +3.530749221105850e-02   +3.958143418768475e-01   -6.526150700439798e-01; -4.360789151231571e-01   -2.124763535193998e-01   -8.526301204992959e-02   +2.738552780278085e-02   -1.743584793022343e-01   +5.395202288044906e-02   +1.733979303703825e-02   +4.204407473433436e-01   -5.142732493649013e-02   +2.679089420084794e-01   -3.196701096989799e-01   +7.210286480843286e-02; -1.511219068854436e-01   +1.791465599085428e-01   +2.111312464247412e-01   +8.375696489807266e-02   +2.697708850522282e-01   -3.142905435304287e-01   -5.744500230806751e-02   -2.403271292103198e-02   -1.817632421337679e-01   +4.024914684013132e-01   -6.634779638069951e-01   +1.227421210906503e-01; -1.811568388725942e-01   +4.559921547342266e-02   -7.204532946280490e-02   -4.175766144870494e-01   -5.985495926731295e-01   -2.449983775414282e-01   +5.342910959854118e-01   -3.726418217200670e-01   -1.497270866867266e-01   -1.492848077109218e-01   +7.394042985508389e-02   -6.241141441281699e-02; -3.063273759426177e-02   -4.269439662897234e-02   +3.888513413830261e-01   -7.525091369798116e-01   -2.303958061041479e-01   +2.707804924133146e-01   -8.605137627289097e-01   -5.920884126057541e-01   +3.415897678912651e-01   -4.308263863432057e-01   +6.268335562467356e-01   +9.103158787884418e-01];
L3E_L3I_iGABA_netcon = [-4.145122834422462e-01   -2.754756503364332e-01   -1.116785547873104e-01   +2.410475622460929e-01   -5.993797815029896e-02   -2.428544082131752e-01   +7.998296574069237e-02   -8.919821576338616e-02   +2.658903584680082e-01   -2.712205240967693e-01   +2.586943154668349e-01   +2.423575506379276e-01; -6.716990242569219e-02   +1.481799678514169e-01   +1.154917193973684e-01   +1.451083591215406e-02   +3.624281589857836e-01   -3.848561167199609e-02   -2.361040599131091e-01   -2.545196853571601e-01   +6.589230136970188e-01   -4.748959327669736e-01   +1.089022565777540e-01   -4.513898681866190e-01; +2.471412114396445e-01   +9.792043052469498e-02   -4.107288718768105e-01   +3.043614133118270e-01   -6.781475928536413e-01   -1.036614459634315e-01   +3.387862594923464e-01   +1.125926894221445e-01   -4.276398697470978e-01   +6.330304825809157e-01   +9.659018855782292e-02   -4.253421849350476e-01; +1.929064074327905e-01   +5.687188024330525e-01   -3.528731983984631e-01   +3.909570892520211e-01   +4.345668608373925e-02   +3.226721662761384e-02   +4.065223813799346e-01   -1.811624074740966e-01   +5.807155549746608e-01   -3.403016302737517e-01   +4.446483466270389e-02   +1.928956810268580e-01; +2.284127182565571e-01   -3.461818345103402e-01   -4.220552002335077e-01   +2.900274479341194e-01   -6.907667560875717e-01   -3.330729886876858e-01   -6.047243431829248e-01   -3.491552403855526e-01   -1.696556578077283e-01   +1.684413643084960e-01   -7.174726423040646e-01   +1.833851771575436e-01; +8.942972694675450e-03   -1.213600941542670e-02   -3.758981437093772e-01   -2.693990223533134e-01   -2.722038974346186e-01   -3.892313178453211e-02   +1.757860121676159e-01   +3.476800039051399e-01   -2.345768251567057e-01   -1.195791328811364e-01   -4.312121999071438e-01   -2.919099873322477e-01; +1.357507576116784e-01   -3.386797783539490e-01   +1.585209316509437e-01   -5.977013547635783e-01   -2.908479724968628e-01   +3.481143991990676e-03   -5.734506890539015e-02   +3.669486001476959e-01   -6.841726492433930e-01   -1.737302945440280e-02   -5.760616995102398e-01   +1.326944917497632e-01; +3.146901147094022e-01   +4.383814888266038e-01   -2.615018109876034e-02   +1.341593358278651e-01   +1.072399537696871e-01   -1.173309690602873e-01   -3.960575514870871e-01   -5.590283233441843e-01   -5.399412208684029e-01   -1.624010168034876e-01   -9.954071748003762e-01   -7.700613074478113e-02; -3.415476404490020e-01   +2.637795394447736e-01   +4.035105706045211e-01   -3.208945633991392e-01   -7.036394955190133e-02   -5.274439328999428e-01   +5.504386200198274e-01   +3.109755794214382e-01   +3.183066311800231e-01   +6.330227380499954e-01   -1.135970163727885e-01   -7.752674066723113e-01; +3.259407312192248e-01   +2.863694910961285e-01   -4.144922982841491e-02   +5.999103673602293e-01   +2.355120068198914e-01   +2.041187577448230e-01   -2.815904316211711e-01   -3.576208335226645e-02   -5.603104844284617e-01   -4.122841416007552e-01   -3.118324882661499e-01   +2.833938419257518e-01; -7.777128511122287e-01   +2.175216721797251e-01   -6.870049065635771e-02   +3.584397185129353e-01   -4.417620608644777e-01   -4.379775369711330e-01   +4.682073647400988e-01   -2.679792332964315e-02   -7.965867065942067e-02   -5.491904386701121e-02   +6.508984131749165e-01   +3.996979663634690e-01; +9.304024659839105e-02   -2.843170497277216e-01   +7.516118817412784e-01   -4.896233569100932e-01   -5.292464636492403e-02   -1.225099177241755e-01   -2.746788830120689e-01   +1.362357486675942e-01   +9.792825952150340e-02   +8.308976205681207e-01   +1.893287043442751e-02   -5.093365700707914e-01];
L2E_Input1_iAMPA_netcon = [-3.863779045592484e-02   +4.456341961160812e-01   +2.869669031252119e-01   +5.711617970737647e-01   +5.215577252492057e-01   -4.586180060420178e-01   -1.587910896688233e-01   -1.728590407031206e-01];
L2I_Input2_iAMPA_netcon = [+6.634413550272325e-02   -3.453236180896027e-01   +8.842290545733473e-01   -6.982232468265118e-01   +5.485571467835765e-01   -6.452014812676359e-01   -8.315495351328199e-01   +1.103491631307989e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
