function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.067693992498593e-01   -5.492096081764354e-01   +1.426713968863807e-01   +1.272331528516456e-01   +2.823534560209508e-02   +2.279475467756418e-01   -3.768439873687761e-01   -1.546836761737829e-01   +6.133104727054577e-01   +5.520801622507359e-01   +1.927457031762654e-02   -3.042806545909858e-03   +5.108055614552370e-01   +1.945980410696298e-02   -2.585686852100504e-01   -2.725505115849310e-02; +3.035569849427944e-01   +2.768307571175362e-01   +3.018850166020509e-01   +8.360495724928164e-02   +1.632835653483902e-01   +5.484376642358731e-01   -2.888359840959555e-01   -3.444817211517184e-02   +2.125107760611045e-01   -3.728824885745839e-02   +1.995366298351526e-01   +1.901902358781134e-01   +2.915724664008761e-01   +5.966746100017618e-02   -8.921451181839506e-03   -1.560054595416600e-01; +1.756858348824559e-01   +1.594772996075328e-02   -6.962081537153433e-02   +3.611943002289459e-01   -2.608265589709533e-01   +3.342223259943291e-01   +5.868091907876147e-01   -9.239612829330691e-02   +5.402827910527223e-01   +2.076007384854092e-01   +5.180508463139474e-01   -1.008654627910633e-01   +3.587973542834582e-02   -4.249781009933215e-01   +2.157230802687326e-02   +4.210807999195263e-01; +2.744878713086334e-01   -2.552700614012033e-01   -2.110222640506488e-02   +4.329580912316672e-01   +3.380843800914694e-03   +6.168093073738228e-01   +6.508606525165006e-01   +6.098382170101306e-01   +2.183070966336059e-01   -3.566590162353639e-01   +4.402489116573436e-01   +1.306870361501737e-01   -2.225565123662424e-01   +4.203872776615403e-01   +1.631573674107981e-01   +9.047454414417662e-01; +2.089960808212365e-01   +1.742619227374072e-01   +6.091772013696082e-01   +4.232674163832524e-01   +4.106973783870215e-02   +2.667851564364478e-01   +1.983115651063172e-01   +1.328506846157515e-01   +7.938760925344637e-02   +6.293658945952638e-01   +7.078034616248261e-01   -4.254555525741258e-02   +5.127381403703344e-01   -8.124010149871294e-02   +1.758026027150435e-01   +7.953484625181986e-02; -1.301591931618306e-01   +1.000000000000000e+00   +3.963126201870835e-01   +5.575222491261669e-02   +3.962744068673056e-01   +2.557204599753910e-01   +5.996253804618291e-01   +1.616985828319571e-01   +2.880075411774188e-01   -1.089889190577033e-01   +1.436074465173211e-01   -2.394449202442770e-01   +3.058975155056584e-01   +1.609091569060916e-01   -1.574825312081413e-01   -1.987353221603642e-01; +2.093328855345483e-01   +2.744746114870081e-01   +6.485693249293579e-01   +4.924466198805850e-01   -4.985963182399527e-01   +1.669861690530852e-01   +1.601969526231282e-01   +2.492847462727447e-01   -5.639382208627400e-01   +6.050384855713833e-02   -2.223924264541133e-02   -1.114774530282048e-02   +3.661610916124241e-01   -1.885400023852304e-01   +5.529632116015385e-01   +6.231509513221880e-01; +8.775222525533341e-02   +4.356448879854283e-01   -2.139560934382093e-01   +2.594175162438149e-01   +2.464218378734518e-01   -1.511931750407032e-01   +5.552985250283548e-01   +2.415707280105464e-01   +3.549209165385974e-01   -8.732287183088391e-02   +2.958500032959182e-01   -6.432577942987155e-03   -2.139376763663912e-01   +5.740759621752702e-02   -1.167732298911626e-01   +1.893644911749012e-01; +1.727212576422779e-01   +7.531557285096477e-01   -2.301926209625533e-01   -3.613136744715446e-02   +3.889909157144677e-01   +4.173015676434370e-01   -1.649464949894522e-01   -2.377032134975087e-01   +2.810614885572739e-01   +4.273437933766312e-02   +3.227766483690043e-01   -5.111089381321302e-02   +3.323277138249304e-03   +2.244558637032073e-01   -3.558605252504786e-02   -2.451349624977340e-02; +4.714569153304403e-01   +3.486697080944123e-01   -1.410035415441447e-01   +4.553806830491436e-01   -3.416815222901175e-01   +3.858730224396335e-02   +4.309226668794680e-01   -9.347148311744388e-02   +2.340398306094409e-01   -1.482674619145623e-01   +8.673427980834741e-01   +1.657868845065159e-01   +2.523058699697712e-01   +4.465908619115134e-01   -4.364765145069526e-02   +1.075438266449663e-01; +9.583217989974442e-02   +7.456666226859456e-01   +5.040119330398175e-02   +1.515658658606690e-02   +3.717696230252881e-01   -4.488796620285933e-02   -2.364286007372753e-01   -1.348873690755679e-01   +3.088761170873575e-01   +5.300237938435390e-01   -7.501244180011624e-02   +1.351794034541341e-01   -6.819536161687134e-01   -2.327228195547428e-01   +3.130967641465923e-01   -4.130047120432210e-02; +3.494478244044155e-01   +2.248866046419551e-01   +1.140775768688522e-01   -1.927086055114504e-01   +1.241959733198970e-01   +2.389334838364257e-01   +3.397871987425403e-01   +4.833765557921822e-02   +4.510901559089952e-01   -5.143178552669341e-01   +2.651252144403194e-01   +5.185920378015020e-01   +5.656514327473429e-01   +2.675669347834752e-02   -4.026688881455727e-01   +2.600370255904037e-02; -3.968130922469915e-01   +2.916792099106421e-01   +1.621564149720394e-01   +3.162010402216594e-01   +8.805842905084547e-01   +6.816845775070119e-01   -1.759158061169802e-01   -1.299746295369364e-01   +3.883774946244039e-01   +4.831123521344616e-01   +1.654912231678023e-01   +1.894382958371904e-01   -2.846441732456280e-01   +9.972857028551847e-02   +6.573659040182410e-02   +2.232814309155184e-01; -3.820020824688365e-01   +5.361904091281811e-01   +1.534318540297607e-01   -4.224279005287872e-01   +2.707473754528283e-01   +3.705858954152598e-01   -2.810712693086345e-01   +1.007076761853439e-01   -2.102455915583494e-01   +2.187137498915232e-01   +7.698672076406829e-01   -8.652681572721141e-02   -1.296956742857404e-01   +5.197221130046640e-01   -2.698641283119834e-01   -1.716182468819489e-01; +2.671301998838593e-01   -3.249226877032394e-01   +4.344418817204573e-01   +2.594866404963263e-01   -9.634810336580697e-02   +3.386652877175753e-02   +1.458649207730695e-01   +1.111600813186314e-01   +1.168009793327639e-01   -2.280093838344283e-01   +2.523852696720554e-01   +1.681934691643871e-02   +7.342846942458618e-01   +1.262740670058663e-01   +3.259488306246963e-02   +1.399274004365998e-01; -8.178233155845617e-01   +2.824714389377369e-01   -4.469022732610202e-01   +3.928474367847080e-01   +8.089046414751314e-01   +2.531773045799111e-01   -9.527359521002218e-02   +6.879945451666182e-01   -2.165717320596769e-01   +2.515662792300382e-01   +5.207984810193879e-01   +9.006092162210742e-02   +2.723385608326728e-02   +2.519861022291736e-01   -7.297613096346357e-02   +2.901796053471084e-01];
L1E_L1I_iGABA_netcon = [+9.493461748326489e-02   +8.321360014820659e-01   -4.525660389619192e-01   -2.300655564734189e-01   +4.134915101178301e-01   +4.232671389228289e-01   +6.713325007347654e-01   +4.487906861713646e-01   -4.832342386667919e-01   -1.294005981008728e-01   -2.661225099627471e-01   +6.325599938371862e-01   +8.467149303549570e-01   -3.688218502131818e-01   +5.941183527274543e-01   +6.586269199838093e-01; -3.339574148895801e-01   -8.684834890529529e-02   +9.797662454986802e-01   -4.246067861127841e-01   +6.262978717425499e-01   -4.332975240012541e-01   +6.330997427475297e-01   +5.403695203442139e-01   +2.893394806694406e-01   +2.757060154496930e-01   +4.533489064892221e-01   -1.364698094824986e-01   +5.035689990659380e-01   +4.972532345382131e-01   +6.619809237039297e-01   -4.028621941749567e-02; +1.874036280045517e-02   +4.588999362654382e-01   -2.221646594437814e-01   +4.490196314453159e-01   -1.944537045756648e-01   -2.207675723486950e-01   -1.781657954376960e-01   -2.607466912747393e-01   +1.367731567597166e-01   +2.582228675558785e-01   -1.187220152777846e-01   +6.768509305260917e-01   +2.279216092296620e-02   -4.786162705846841e-01   +6.531429747936529e-01   +6.944967328728973e-03; +3.231125586566435e-01   -8.202780966937255e-02   -3.570707720882719e-01   +1.176174061397420e-01   +7.800986742443068e-02   +2.042750136806891e-01   -1.116809164156319e-02   -1.309077610999353e-01   +1.850246707908813e-01   +2.789266006482856e-01   +4.600283313969256e-01   +1.301249350796815e-01   -6.875369849171808e-02   +4.307854227001307e-01   +2.575644398998378e-01   -4.511518042726406e-02; -1.360170764285300e-02   +3.979643495842268e-01   +5.584440415842399e-01   -3.355301822038291e-03   +6.483556928252221e-01   -2.474931839874146e-01   -1.380716727921639e-01   -3.805694633700429e-01   +2.105644588256542e-01   +3.612968162363279e-01   -8.144704050359158e-02   +6.938933470999806e-01   +6.228259499954963e-01   +4.857419882645866e-01   -3.563939445185078e-01   +2.712822448088376e-01; +2.662994853891242e-01   -9.156882701828331e-02   +1.870362688780941e-01   -3.954843124228714e-01   -5.712710305204637e-02   +4.978112813190740e-01   -1.426742456873357e-01   -3.206978076949439e-01   +8.976787492059414e-02   -2.704733069879174e-02   -1.176347293676180e-01   +5.573735371138706e-01   +2.743965957796491e-01   -2.937671354505602e-01   +2.375205417649813e-01   -1.282094581611142e-01; -7.153931944934161e-01   -4.290193891363014e-01   -3.187545407576732e-01   -5.618780927037371e-01   +5.581945069888349e-01   -1.134634277448922e-01   -2.969583761686732e-01   -2.074932180215743e-01   +4.946161806743667e-01   +5.509220087247987e-01   +6.858524722214124e-01   +6.601969983923575e-02   -2.589868928936123e-01   +4.480125556458080e-01   +6.144863380884173e-01   +8.789286524084722e-03; +3.342699003285393e-01   +2.545517019274494e-01   -2.413618464897099e-01   -3.703144658041493e-02   +9.168168049593187e-02   -1.243906518773394e-01   +9.192179357098178e-01   -5.727407554685680e-02   +6.212043571060549e-01   +2.533365725517119e-01   -1.986297346591874e-01   -3.166619932868148e-02   +7.885285825430898e-01   +5.488987309579698e-01   +4.380754080955753e-01   +7.700226098188103e-01; +3.141813467735462e-01   +6.798135925115907e-01   -4.537100061614036e-03   -2.149849624468864e-01   -5.992172255082866e-01   +7.059377035786196e-01   +1.252603274576081e-01   +3.535291742240930e-05   +1.613108978966935e-01   -5.648005948241995e-01   -1.234184887686829e-01   -3.179411520933211e-01   -1.989850937843556e-01   +1.137261807269444e-01   +8.824322126157527e-01   -7.714284716321940e-02; +3.337983560299206e-01   +6.595654113868367e-01   -3.459773623850169e-02   -4.545206619033417e-01   -1.652782086640559e-01   +7.342462220964606e-02   -3.681650868394176e-01   -5.180950578795297e-02   +6.889860827562391e-01   +3.230531464039552e-03   -4.449495932016079e-01   +4.029370355902845e-02   +6.125406386748163e-01   +3.210886638038314e-01   +1.256421040264474e-01   +2.075760237989555e-01; +2.737689178231464e-01   -1.472183018262861e-02   +3.336883746940989e-01   +6.146005853074866e-01   +3.721223735559865e-01   -1.306293575774681e-01   +2.990081825462768e-01   -2.919614983342730e-01   +4.597986885065624e-01   +3.711746701613020e-01   -3.695117811499348e-01   +3.778736181618411e-01   +4.611709655165493e-01   +4.317005138093002e-01   +1.307914667828989e-01   -6.787111586906859e-01; +1.870829016374163e-01   +7.439639999592938e-02   +2.879263748516392e-01   -5.417301105309704e-01   +4.846046206865085e-02   +6.498079389673408e-02   -3.470417459430903e-01   +9.481099002502207e-02   +5.885241298243675e-02   -1.765460785844666e-01   +2.770464102793739e-03   -4.575381866910828e-02   +5.329130639238290e-01   -1.289950124989460e-01   +5.390577592621549e-01   +2.136627860582331e-01; +4.273482675921818e-01   +2.709453035876336e-01   +7.331862735620945e-02   +3.573096777099809e-01   -1.655734564870267e-01   -1.741289516287720e-01   +2.332214054679254e-01   +8.809486250412793e-02   +2.270555379501681e-01   -1.470740082738761e-01   -6.311866205427102e-02   -2.515387269532292e-01   +2.500753023027253e-01   +3.599603272241462e-01   +2.113116947788468e-01   +3.909263284333679e-02; +3.910415910912303e-01   -1.309705446796426e-01   -2.587474873971281e-01   +4.052521565188335e-01   +1.258279241505731e-02   -3.316285021610227e-01   +2.056999694131194e-01   +3.886082474635732e-01   +5.676947835119516e-01   -1.322597743731788e-01   +2.611782111323750e-01   +1.692080139100033e-01   -1.621994046448512e-01   -3.027558058304154e-02   -1.288062910836582e-01   -4.614750038577620e-03; -4.897991016220436e-02   +4.120623257511787e-01   +5.363127886927480e-02   -5.834137722163281e-02   -1.989113370398571e-01   +1.146822752832052e-01   +1.607634916816964e-01   +9.876380113931579e-02   +7.249177672630670e-01   -1.079793952111598e-03   +7.663487131222925e-01   +3.538260710937883e-02   -1.873515563198221e-01   -6.810441807145239e-01   +1.000000000000000e+00   +5.956424609908038e-02; -3.919074872533275e-01   +4.837623499799262e-01   -1.532015937368097e-01   -1.020153636880675e-01   -3.283459390569298e-01   +1.152806695936803e-01   +6.270968640169161e-02   -1.086491303357090e-02   -2.965572361475235e-01   +1.264312986677962e-01   -2.935906961282780e-01   -8.558625828491662e-02   +2.303211776298776e-01   +4.549758653007187e-01   -4.218650291050712e-02   +3.383893897615224e-01];
L2I_L1I_iGABA_netcon = [-1.495325335777319e-01   -2.056707787616734e-01   +1.636977191297272e-01   +4.833238270744925e-01   -3.630704217485304e-01   +4.422715551456001e-01   -3.323922426111434e-02   -3.109286232391932e-01; +3.368451481187362e-02   +7.147690811849915e-01   -1.116646209879335e-02   -5.267044706960208e-02   +5.384381742046074e-01   +5.253130658916051e-01   +8.650877200648724e-02   -2.151507242063204e-01; +3.869904393583368e-01   -3.629280849134414e-02   -1.127669738580035e-01   +3.230526923472019e-01   +1.783112309296601e-02   +7.574464212509063e-02   -4.792014336799723e-02   +2.418299209462111e-01; +1.482436469313337e-01   +1.557658513596363e-02   +6.036591412336542e-01   +2.567479385670695e-01   +1.836869119262681e-01   +4.810374555754422e-01   +3.013800860864386e-01   -2.613562239264397e-01; +7.321283052395047e-02   -4.152989495377273e-01   +6.596909659710387e-01   +5.492354102318897e-01   +5.471957840355404e-01   +5.431184449611922e-01   +3.380869628515721e-01   +1.091605568119949e-01; +7.504360644899369e-02   -1.805184094583117e-02   +3.135550860547850e-01   +5.261205426480737e-01   -1.013583184709929e-01   +4.634830568880879e-01   +4.247860045847394e-01   +5.848413836088572e-01; +2.344763826745265e-01   -1.358608422038998e-03   +1.369157649321513e-01   -6.678584290350530e-02   +2.211665189156758e-01   +6.382135647923380e-01   +3.804818924043437e-01   +1.045241629748043e-01; -2.568267295672258e-01   +5.318022433746967e-01   +1.451443686396870e-01   +2.395249229052231e-01   +5.778476830880613e-01   -1.069628352229335e-01   +2.832451768649015e-01   -5.057736094796123e-03; +1.236433946165254e-01   +9.024765419966198e-01   -4.265171580496998e-01   +4.195979412064824e-01   +3.818907041140908e-01   +4.168208989001634e-01   +3.050006868640098e-01   -3.132845757822143e-01; -1.786359436463666e-01   -2.783486001405539e-01   +3.112715224254529e-01   -1.788499165237825e-01   +1.094084783554186e-01   +1.317989262682843e-01   -6.375919845643911e-01   +8.378126807119610e-02; +3.137873706897054e-03   +2.216073404139124e-03   +1.569384847980565e-01   +3.599323919418035e-01   +2.226999740280819e-02   -1.360064636974792e-01   +1.193050665876127e-01   +2.716666464548364e-01; +4.019148959045642e-01   +2.471896798792124e-01   +3.243052119415351e-01   -3.049424989400135e-01   -1.473547460664376e-02   -1.116924735781139e-01   +7.913212823819052e-01   +5.203128733256254e-01; +3.741380296296745e-01   +3.387071828792419e-01   +4.007267528847369e-02   +2.916651553980222e-01   +5.993508339439111e-01   -2.857375611981980e-01   -3.405310225158337e-01   -1.720186691556054e-01; -2.494751598297702e-01   -3.560722877949645e-01   -1.010839402659053e-01   -4.335753292729128e-01   +1.660413742390095e-01   -5.891955380493456e-02   +4.466089619259969e-01   +4.832459060955487e-01; +4.986650305550289e-01   +2.985094210943373e-01   +4.233375361444293e-01   +7.536931097488193e-02   -2.626620330887466e-01   +6.306185137679248e-01   +6.306536795126639e-01   +2.557146289399537e-01; -1.139751596126242e-01   -5.866404249726587e-02   +1.764714146853922e-01   +4.327787745534758e-01   +4.005476519308224e-01   +2.414168529478008e-01   -1.779252896851472e-01   +1.921828648780749e-01];
L1I_L2I_iGABA_netcon = [+3.777172475676394e-01   -2.772280509558872e-01   -7.221283583870777e-02   +3.157236275680653e-01   +9.508802147631217e-02   +1.696527045956061e-01   -3.539811536089430e-01   -7.184695853450032e-02   -1.767925149544039e-01   +3.894931675202374e-01   -2.168571012256954e-01   -4.894737767088728e-02   -7.949310522186326e-02   -1.171280816825571e-01   -2.538537621357561e-01   +2.566251505540515e-01; +2.428378815347007e-01   -4.301046573789150e-01   -4.836411282130700e-02   -1.364030435249444e-01   -2.273433301384141e-01   -1.028935366903426e-01   +2.051445011502838e-01   +3.557665298130349e-01   -3.888219483453438e-02   +7.549453926791614e-01   +2.644527642288154e-01   -1.867718641201997e-01   +1.076835091069881e-01   -2.335726948520943e-01   +4.188531200060781e-01   +3.185598748552950e-01; +3.801322324208584e-01   -1.052505552276066e-01   +2.472293455387062e-01   -3.724842037339637e-03   +6.029256752486040e-02   -2.884517116173248e-01   +3.644921442235002e-01   +1.374334615790020e-01   -7.419258013024223e-02   -5.213690124460114e-02   -2.515763299016310e-01   +1.349306083956865e-01   +3.487596464506910e-01   +4.450189520139432e-01   +3.982372521543406e-01   +4.928584114893111e-02; +2.103784813741391e-01   +4.444408505286616e-01   +5.081242458042081e-01   -1.069110882658555e-01   +4.408287736806315e-01   +8.930460659823332e-01   +1.914663229421005e-01   +1.033857721987218e-01   -6.319485660400032e-02   +6.209287512947741e-01   +4.003088277130215e-01   +3.808936124506367e-01   +2.683498411129638e-01   +7.192166898541585e-01   +3.403231671904621e-01   +4.524563795774060e-01; -3.693679095014261e-01   +1.730582892433844e-01   +1.134738150751919e-01   +2.256543049690241e-01   +2.420825235308590e-01   +4.507908333797277e-01   +4.267013728250413e-01   +3.692268768736123e-01   +3.905035407184987e-01   +2.483220994599566e-01   +2.287922672391772e-01   +1.810544344284007e-02   -7.255891362835988e-01   +2.332712870258519e-01   +2.947049220708885e-01   +5.473282143285760e-01; +8.780522602043082e-02   +4.195571141611072e-01   -6.769491004675942e-01   +2.923936568899166e-01   -3.175566353868348e-02   -3.718175507170694e-02   +4.469455335915959e-01   +2.070066065234905e-01   +2.348348295594745e-01   +3.017945073601703e-01   +2.288172362097158e-02   -3.367108717544004e-03   +1.683674696296155e-01   +8.750645450127519e-01   +2.140058774676533e-01   +8.740323052898641e-02; +8.610492834314751e-02   +3.072145894308649e-01   -2.839358127600745e-01   +1.817901227629352e-01   +3.656786816707768e-01   -3.745731720859470e-01   +4.079301104289267e-01   -8.789215401058315e-03   -3.726249956750198e-01   -4.311435083978113e-01   +2.266417653022511e-01   +3.903149232799974e-01   +2.139602837555354e-01   +2.641130216889428e-01   +2.445717115593420e-01   +5.318346804950917e-02; +2.239399455529534e-01   +2.270173735047283e-01   +1.997305589849788e-01   -7.978730280819539e-02   +1.097858400761735e-01   +3.687134385445054e-01   -1.729239770814515e-01   -9.172245060865178e-02   +1.986686439960689e-01   +3.218998362197973e-01   +1.939515931552671e-01   +6.114774940356934e-01   -1.474278835153880e-01   +1.775688104535657e-01   +2.194603208184495e-01   +6.357130981746655e-01];
L2E_L1E_iAMPA_netcon = [+3.177373921200007e-01   -4.999006335905049e-01   -1.134817915829137e-01   +4.697034935089014e-01   +6.258050486953585e-01   +3.591341816239177e-01   +5.530178186386190e-01   -5.956254418767058e-02; -8.865321221785744e-02   +7.769918918527348e-02   -3.725241786399804e-01   +3.157712604997092e-01   +1.975943216944653e-01   +4.991078190302428e-01   +1.563131681738746e-01   +2.374124661247781e-01; +4.633922931420117e-01   -4.887662323417510e-03   +1.522224750020375e-01   +2.645344781409720e-01   -1.091806307727596e-01   -1.325399417863781e-01   +8.990496397739971e-02   +1.921192712143187e-01; +4.967822444047643e-01   -2.494189201284823e-01   -2.026513596973193e-01   +3.723760003429782e-01   +4.174938600846741e-02   -1.158536502108506e-02   -2.556918948380699e-01   -2.234550977536369e-02; +4.901766856011766e-02   +4.376304135010918e-02   +4.319462944730257e-01   -3.476846126748708e-01   +9.833083382736906e-03   +5.082519950833828e-02   -3.635259020301010e-02   +2.845262197367691e-01; +6.304877410802772e-01   -1.237860985789863e-01   +1.066703363896492e-01   +5.347086228353796e-01   +4.183961672568838e-01   +5.442652574956819e-01   +4.865244506631085e-01   +2.455920241723272e-01; -2.761203194044049e-01   +7.856698649728840e-01   -4.326506301700087e-03   -2.848486288203891e-01   -1.645001007467583e-01   +2.760432164687648e-01   +5.874318418690303e-01   -3.068468263146742e-01; +1.042788533467914e-01   +3.820356048757431e-01   +7.448931819493133e-01   +9.555031459919866e-02   -2.334324930869512e-02   +8.615300334900734e-02   +4.865527605951193e-01   -9.598679786551797e-03; +2.934697333506691e-01   -5.865813101004087e-02   +6.012566486554024e-01   +7.405185829431984e-01   -4.998058954335549e-01   +3.990548700049574e-01   +5.729367009514350e-01   -9.375315492964674e-02; -1.769440953953605e-01   +2.494555682292171e-01   +4.653117624451006e-02   +5.625443215903316e-01   +8.238956567908129e-02   -2.744166816896859e-01   -2.172580439933882e-01   -2.615529260186107e-01; -4.245603725207069e-02   +6.910348388980193e-01   +6.862265720632919e-01   +7.519373637535789e-02   -1.726199249357410e-02   +2.061399212802827e-02   -1.461872345334747e-01   +7.946778232883522e-02; +3.647212353683341e-02   -1.873527608779557e-01   +5.527741156566668e-01   -3.145827663137471e-01   -2.750394593958378e-01   +9.124210900329406e-02   -1.443860031169671e-01   -3.255890008178848e-01; -1.237709637032011e-01   +3.651163269338447e-01   -1.369726667972744e-01   -4.135183897263615e-02   +4.820599231704005e-01   -3.223782371291822e-01   +7.354608744561772e-02   -7.995607045939659e-02; -1.548709492240479e-01   +1.000000000000000e+00   -2.547486832281569e-01   -8.910235236495366e-02   +5.562873889565336e-01   +8.915367517794075e-02   -2.403333009312962e-01   +2.749148708421296e-01; +3.064162261786610e-01   +3.784343870576941e-01   -4.645597368135457e-02   +1.881614134419307e-01   -1.806975757325688e-02   -7.739701251146716e-02   -2.102856049905682e-01   -1.197449810214888e-01; +8.685480776376735e-02   -1.246080711770353e-01   -4.116782084533364e-01   +1.948503200849048e-01   +1.683719644846005e-01   +3.121992372800822e-01   +7.216589854639549e-01   -2.821307328861786e-02];
L1E_L2E_iAMPA_netcon = [+4.148385107583838e-01   +1.654964114008954e-01   +9.991467919191853e-02   -2.830595048987765e-01   +2.444058370866390e-01   +4.238177050795258e-01   +3.262930911422702e-01   -3.974273786182395e-03   -9.855114412153029e-02   -1.610624283974804e-01   +7.213651064313922e-01   +2.045263894675469e-03   -8.856412448073174e-02   -1.078676727912089e-01   -1.605526977773618e-01   +2.681258602574826e-01; +3.319218917701637e-01   +6.167269523470091e-02   +2.270626119113263e-01   -1.840258221581712e-01   +3.541851914518245e-01   +1.641575214894032e-01   +7.309551402598071e-01   +1.809181841066181e-01   -9.537193347335951e-02   -9.097291315771552e-02   +4.032541484227378e-01   -8.934263109433399e-02   +6.612870369176009e-01   +3.998363994482642e-01   -5.599109765889661e-02   -6.168990127308984e-01; +1.000000000000000e+00   -3.865278231134839e-02   +4.091847179724577e-02   +2.522855524929386e-01   +1.898322487730310e-01   -3.114565256807070e-01   -2.140385709884219e-01   +1.581696340368981e-01   +1.946126471480908e-01   -3.537406831451990e-01   -1.719434222433052e-01   +3.234274016005302e-01   -1.525548375019390e-01   +6.011053053312758e-01   +1.043594895585535e-01   +6.532902243745595e-02; -2.601569398125047e-02   -6.810826375196848e-02   -2.229763809723415e-01   +3.991357942360809e-01   -1.842021537793664e-01   +7.810407660489891e-01   +5.788652050674431e-01   -7.847999342531836e-02   -1.105220338106037e-01   +1.507154872237081e-01   +5.265083910393018e-01   -3.033046744105402e-01   -1.854784653547410e-01   +8.539792146776619e-01   +3.984946370608491e-01   -1.201730302369365e-02; -1.615187149500232e-01   -4.441948942098904e-01   +1.299797864914034e-02   +2.353984381552487e-01   -2.348651592464905e-01   +1.326983558627887e-01   +3.554425388156805e-01   +2.540440738415602e-01   +4.591571008576048e-01   -3.988903260649367e-02   +2.434418505510816e-01   -4.537129613088789e-01   -3.907773123079026e-01   -1.302134837537414e-01   +1.874839328484967e-01   -2.910213625766920e-01; +1.554818965248966e-02   +5.033970765698182e-01   +6.461997990462773e-02   +6.465221402698890e-01   -9.576752553285064e-02   -1.746234923907310e-01   +9.462235452572563e-01   -2.984835021606909e-01   +5.159641896010028e-02   +2.295619200782615e-01   +4.103332276254885e-01   -4.101995879399491e-02   -2.031161695631215e-01   +9.064168072666318e-03   -2.182658411900210e-01   +6.401150179481608e-01; +1.350567027129022e-01   +3.459173546242940e-01   +2.019570145398221e-01   -1.670408763284141e-01   +2.598767201688426e-01   +2.585582382278414e-01   +4.285521341023832e-01   -4.351190359329246e-01   -1.243635154344384e-01   +2.012850030338360e-02   -1.610019318673231e-01   -6.534751497281683e-03   -5.695242853140496e-01   +5.696099220632955e-01   +6.237619694069236e-01   +4.277503962091032e-01; +6.117057708407330e-01   +7.246347758363687e-02   +2.675765663884602e-01   +5.493953432220732e-01   +4.281801906745757e-01   +5.183501216954619e-01   -2.185561685343314e-02   +1.807738860983908e-01   +2.236690058976448e-01   +2.862056314369998e-01   +3.178736212763128e-02   +5.733361845932905e-03   -7.871426399781867e-01   -7.293325170006213e-03   +3.993928482930851e-01   +3.811509475272997e-01];
L2I_L2E_iAMPA_netcon = [+2.052180689855031e-02   +6.926385811050570e-01   +2.954622658448623e-01   -1.158210151549700e-01   +7.275460215346255e-02   +1.460709454566392e-01   -1.151688523764538e-01   +6.246318216044412e-01; +6.876238144363197e-01   +4.164725276357745e-01   +4.725403862623619e-01   +9.301801790092831e-01   +3.027931121359794e-01   +3.098144709934328e-01   +1.646897237035651e-01   +4.291310884330797e-01; +1.831140497564505e-01   +9.602271715456520e-02   -3.271318846859779e-01   +4.151411154588821e-01   -2.661915354341280e-01   +4.331127778131680e-02   +3.761953237757575e-01   +8.760705761407898e-02; +4.440959027625997e-01   +4.874150239179931e-01   -6.443499280262626e-01   +4.115615551821895e-01   +5.429504713625455e-01   +8.043662361318882e-02   +1.665931258486113e-01   +4.912646577819032e-01; +3.861282450546638e-01   +1.479078730022472e-01   -3.963560239862796e-01   +8.341178454176590e-03   +7.717537280566552e-01   -6.929072075513572e-02   +1.790592968707711e-01   -6.061617675445286e-02; +4.387658833111032e-01   +3.072761987064359e-01   -3.625770434666706e-01   +4.345576177924551e-01   -6.651647215054753e-01   +5.470587565585946e-02   +1.974895976068553e-01   -2.014335071312665e-01; +5.320575875746362e-01   -3.126700596234163e-01   +1.848042009963861e-01   +5.197382392588579e-01   +2.166125352204294e-01   -2.987351647266653e-01   +8.044849406427774e-01   -7.283107718707702e-01; +1.894241602524115e-01   -5.821028573987391e-02   -7.034554959604832e-01   +2.936970977468548e-01   -2.377178896058288e-01   -1.664694174831313e-01   +1.585707812957884e-01   +8.509599994210824e-01];
L2E_L2I_iGABA_netcon = [+3.187311559670316e-01   +4.699239493995848e-01   +1.235387390312045e-01   -1.735094478769599e-01   +4.830726804829186e-02   -7.339699952206266e-02   -2.809557414852519e-01   +6.077596679015883e-01; +2.589769177706682e-01   +1.713030816973225e-01   +2.453741427730406e-01   +1.000000000000000e+00   +3.687538712354089e-01   -2.506132250714392e-01   -2.859216683963213e-01   +2.286727084102038e-01; +1.476715052484037e-01   +5.915389580430804e-01   -5.246207214193247e-01   -3.816377831674969e-01   +1.313863164024217e-01   +5.735840640912551e-01   +2.111732443954328e-01   +9.523409741656244e-02; +3.095358713846201e-01   +1.966683139615688e-01   +1.277769507608891e-01   +5.521113824957939e-01   +5.538233763979654e-01   -2.090521215135237e-01   -3.509517989289088e-01   +7.023502275305642e-02; -2.615879441917742e-01   -6.948763265254013e-02   -2.206694293287620e-01   +4.032369556680445e-01   +4.833787951137742e-01   -1.673766012832054e-02   +3.821740024795613e-02   +2.872720445803378e-01; +8.114266724995064e-01   +2.985001796816380e-02   +2.595838879244683e-01   +2.366780193034933e-01   +3.765022283643955e-01   -4.829989800267293e-02   +4.629480854089589e-01   -3.535356570573607e-01; -4.177276088310725e-02   +9.975662605119823e-02   -3.819456018193026e-01   +1.507266401981984e-01   -1.327661256107726e-01   -6.234164284604776e-02   +1.642734315391689e-01   +7.968129969376746e-01; +1.133604156582287e-01   +1.449243574296714e-01   +4.081659251279328e-01   -1.340832492349193e-01   +4.577863189811835e-01   +2.613208842366726e-01   +2.801889971988321e-01   +4.780583117765363e-01];
L3E_L2E_iAMPA_netcon = [-9.304734153562465e-03   -3.391105508493004e-01   -1.731450453924166e-01   +1.992744006625983e-01   +7.032556209093914e-01   +1.891576823034951e-01   -1.883134856292027e-01   +1.000000000000000e+00   +4.928327139015719e-01   +2.352261003224264e-01   +1.836728885051521e-01   -5.371107304761505e-01; -2.179159817833046e-01   +2.231195912458379e-01   -1.033899583264846e-01   -5.921079407071311e-01   -3.412512685112805e-01   -2.891310898815053e-01   -1.904575916357861e-01   -2.042318410131058e-01   +1.508581565742802e-01   +4.642023175734104e-01   -1.185748844745285e-01   +5.108243568535347e-01; -6.271897909198104e-01   -1.644896098991104e-01   +5.376136541778960e-01   +1.118331186197102e-01   +2.355896515597064e-02   +8.415078541228103e-02   -4.751216889314407e-02   +2.960220331858520e-04   +6.507191114742420e-01   -6.169730393568182e-01   +6.951753224354178e-01   +4.363069741307054e-01; +3.853567746199343e-01   +3.605075122017663e-01   -2.959028980592410e-01   +2.346091920757013e-01   +6.209634426097814e-01   +2.651606653376210e-01   +2.966896871562895e-01   +9.102374712090433e-01   -2.189892007759662e-01   -3.024035529255696e-01   -2.084510987825557e-01   +3.768090465819894e-01; -3.463031247111241e-02   +4.481015330302773e-01   +4.197232787589312e-01   +1.957972328884122e-01   +4.166949597409348e-01   +4.834671803572716e-01   +1.643648845954768e-01   +9.539620211311882e-03   -4.229181649735296e-01   +3.700409565529179e-01   +8.889448884101409e-02   +3.601861774195133e-01; +2.009515808497712e-01   +4.232260777414051e-02   +3.583780524043239e-01   +5.041992466234287e-02   +7.309752905579054e-01   +4.604320540243469e-01   -3.720187753564261e-01   -1.077968520222655e-01   -2.510969599555999e-01   +4.252438915040188e-01   +9.887853594797881e-02   -2.233085940577143e-01; +4.527570209224264e-01   +2.932413208839860e-01   +1.863362462947985e-03   -2.297831926771683e-01   +1.333246203018396e-01   +4.659904287233979e-01   -5.676445042992524e-02   +3.104409704809716e-01   -1.313534884858369e-01   -3.611721342966552e-02   +2.287754354901055e-02   +2.236429607500689e-01; -7.578295161917856e-02   +7.959913199919022e-01   +9.281752728437437e-02   -6.931579924111139e-01   +3.131035321739730e-01   -2.971481218474264e-01   -2.038800149431999e-01   -2.584783419425121e-02   +2.295189628005097e-01   -6.115439677839944e-03   +4.918963023857460e-01   -1.376393012626557e-01];
L3I_L2I_iGABA_netcon = [+7.781352779919505e-01   +6.824278058058360e-01   -6.448338186683021e-02   +1.957616167840538e-01   -4.456895901629912e-01   +6.854293369174520e-05   +1.000000000000000e+00   +5.620268163557540e-01   +1.836117674012322e-01   +3.851356360685954e-01   +1.773671711691250e-01   +2.416265688284652e-01; -5.374349912822775e-02   +1.663275148052988e-02   +2.258908431442918e-01   -2.026819539270587e-01   -3.814516442429020e-02   +1.068069586168174e-01   +1.244907308017212e-01   -8.364261557131955e-02   +1.698299283157375e-01   -2.327563303386409e-01   +1.967322033543326e-01   +2.358637545722572e-01; +1.500753183598091e-01   -1.371730170888022e-01   -1.078768501491392e-01   -2.663572441236445e-01   -3.114967517770844e-01   +4.947993162929866e-01   +9.034955781259330e-02   +1.752315219874572e-02   +3.672958812159002e-03   -1.340610567517537e-01   +7.616694391273157e-02   +5.627636964966057e-01; +6.811157364248461e-01   +2.397819458624663e-01   +4.504473704808205e-01   -1.893371058302792e-01   -2.013933832135159e-01   +2.140602251573741e-01   +9.313042947235491e-02   -2.942352232696795e-01   +8.645032927693383e-02   +3.756058552147344e-01   +4.024316033706218e-01   -2.644440326569322e-02; +1.262867046196385e-01   +3.665437034680845e-01   -2.202532409748097e-01   -2.078836785386818e-01   +1.156694835795854e-01   +4.879505336476723e-01   +9.080517745344958e-02   +4.200448125567794e-01   +3.017735775235064e-01   +5.373258606964632e-02   +1.822431424798474e-01   +1.811550949927367e-01; -2.222713130864546e-01   +1.255431651688637e-01   +5.151451437789274e-01   -5.846565475625088e-02   +4.110716316571276e-02   -1.033802311465470e-01   -4.930556440494368e-02   -1.721324719873091e-01   +9.168379497583451e-03   -9.290514966955202e-02   -7.924294660497666e-01   -5.099691805380133e-02; +2.015552079159070e-01   +2.108947303045096e-01   +4.209728149163245e-01   +2.822392340987260e-01   +3.903668992140538e-01   +5.725484150774003e-01   +2.974560478028310e-01   +3.633689455637174e-02   -5.950369271677886e-01   +1.888001194814652e-01   +4.110913758067893e-01   -1.972362179972520e-01; -6.427981636294026e-02   -8.639691288819440e-02   +3.760321447416377e-01   +1.197790961250966e-01   +3.358005200978152e-02   +4.018257223665188e-01   +3.023527520265805e-01   +5.152857831816997e-01   +6.900428361503659e-01   +2.207679140957414e-01   +2.381799622342553e-01   +2.382431900025229e-01];
L2E_L3E_iAMPA_netcon = [+6.017507255458385e-01   +4.795230907282139e-01   +4.649793330586784e-01   -6.388634274664640e-01   +4.768817406291818e-02   +1.846999183924613e-01   +5.852268836520537e-01   +2.275124703514171e-01; +3.683827240146553e-01   -1.214957870942886e-01   -1.526419741442928e-01   +4.656276521547963e-02   +9.034181187091727e-01   -6.065581795675756e-01   -9.179391905768122e-01   -5.100345330694042e-01; +1.546806185272278e-01   +1.815629955695535e-01   +3.057586114792903e-01   +8.932288475476619e-02   -9.364491518774573e-02   +3.125996804053528e-01   +5.790821161534174e-02   -1.248336320298837e-01; +4.853820475395551e-01   +5.151994494162931e-01   +7.578526246419981e-01   +8.577671765612802e-01   +5.070944671035814e-03   +5.712379727944877e-01   -5.473333506088222e-02   -4.746477604661053e-01; -1.618683203824515e-02   -4.246630883741024e-02   +3.545771291328237e-01   +3.205376751604382e-01   +1.011076158287774e-01   -1.853978049935692e-01   -5.169369256950220e-02   -6.014623730547946e-01; +8.590695438424883e-02   +2.248831048250820e-01   +3.338364862216014e-01   +5.300171609491878e-01   -1.404080660864481e-01   -1.161096641841431e-02   -2.124359256628235e-02   +3.039150758995060e-01; +3.058078621275110e-01   +7.991776650269742e-01   +7.177956064610924e-01   -2.835655555001595e-01   +5.457457905734042e-01   +2.207839966270040e-01   +6.442035813750182e-01   +9.021340799321624e-02; +3.901883893755281e-01   +4.815125139825569e-01   +1.778554406710535e-02   +1.752453909808352e-01   -4.446018848306006e-01   +1.794947513762810e-01   +2.761277955422241e-01   +6.834534357111187e-01; -2.133142890046659e-01   +5.906138845150060e-01   +6.150798905011711e-01   +7.675827789550509e-01   +5.952821004541448e-02   -2.151530454094816e-01   +3.772013996023051e-01   +6.193064949354225e-02; -2.980646843560544e-01   +1.621028801720426e-01   +5.498495822804318e-01   +2.376771291217828e-01   +1.515799193254228e-01   -3.669005632680102e-01   +5.363321656017171e-01   +6.799409188999224e-02; +7.826171509815497e-01   +5.503980424080158e-01   +1.247690431030351e-02   +4.466535842531807e-01   +1.306699301186299e-01   +1.000000000000000e+00   -5.330245767962273e-01   +3.450121577718865e-02; -1.730082152539962e-01   +4.565646398516989e-01   +5.956718069019110e-01   -8.132877793715543e-04   -1.462604389130986e-01   -1.320898213717476e-01   +1.316623575975522e-02   +2.696622450409994e-01];
L2I_L3I_iGABA_netcon = [-9.801860008450404e-02   -2.174935120003946e-01   +2.323741445972890e-01   +2.122948205396780e-01   +2.461412279058971e-01   +6.777520514798513e-01   +5.417960054872762e-01   +1.465524069015484e-01; -2.420259606805765e-01   +4.862125703956159e-01   +3.306361818047235e-01   -1.708939414425721e-01   -1.357745924947919e-01   -5.947715066022245e-02   +2.971721205600064e-01   +3.193637054582652e-01; +1.844857316727926e-01   +7.990734495281473e-01   +4.610890503523513e-01   +1.304754847278826e-01   +3.061868252117116e-01   +4.614463139076534e-01   -6.892627555363934e-03   +1.328037766265799e-01; +8.039990255848951e-02   -2.758036910321369e-01   +4.642163698915979e-01   -1.554493131664526e-01   -2.779377944291602e-01   +1.217375022350763e-01   +3.626279679915785e-01   +3.928234204350806e-01; -1.307438798729758e-01   -1.259274552290489e-01   +1.456002084024619e-01   +4.291740566271137e-01   +1.187381197122134e-01   +4.724362800870787e-01   +4.138660143884172e-01   -1.435891488406756e-01; -4.967258085610604e-02   +5.658330658833397e-01   +1.131863988435519e-01   +2.240809873380505e-01   +5.737225525717550e-01   +3.071878480119195e-01   -4.618782408647001e-01   -8.994836710932563e-02; -2.681741777961375e-01   +9.858691935805969e-01   +4.786975457192391e-01   +1.613283151460956e-01   -1.447174951421888e-01   -6.220672425705220e-02   +7.729506907300687e-01   +3.985160754275820e-01; -4.767970544484084e-01   +4.790867327203450e-01   +3.658619872848501e-01   +3.032468662852371e-02   +1.894191650525305e-01   +4.514265235006045e-01   +7.838039614337960e-03   +6.975703896268376e-01; -6.495940798670514e-01   +8.538579231909416e-01   +2.843133497760983e-01   +9.466408397681911e-04   +7.018030025142397e-03   -1.789997757931273e-01   +1.965671401797489e-01   +2.099946035821590e-01; -7.344689260384342e-02   -3.029622920863962e-01   +5.366534340148031e-01   +1.912383257836890e-01   +4.451890597174658e-01   +3.436218712833529e-01   +1.235635502241049e-02   +5.319604140507365e-02; +5.992566743986436e-01   -2.314789570704667e-01   -5.645713991930019e-01   +5.897725886303271e-01   +1.740251903512888e-01   -2.742125294984863e-01   +4.278774279412338e-01   +1.938705025824280e-01; -8.657560003449555e-02   +6.719341667814098e-01   +2.837999708060163e-01   +3.022918122208137e-01   +2.501329275930966e-01   +3.714397880951569e-01   +1.651345159245209e-01   -1.946097765613731e-01];
L3I_L3E_iAMPA_netcon = [+1.902799865830982e-01   -7.364583068862803e-01   -1.511048661154156e-02   +1.802478749008498e-01   +5.298924649648227e-02   +1.778591910775187e-01   +9.111093061526081e-02   +4.121975492434365e-01   +7.726461116773998e-01   +1.114861293430721e-01   +1.100014993916849e-01   +4.948007104797517e-01; +1.509684418226495e-01   +2.419853267189895e-01   +1.946409758102355e-01   +5.332267329801726e-01   +4.572994499636845e-01   +3.022221286751433e-01   +4.848989164653768e-01   +8.921882889742621e-01   +5.858178205708832e-01   +1.077447180987024e-01   +1.867427951826386e-01   -3.969446595904778e-01; +2.932655502547670e-01   +3.567530322494437e-01   +3.487517076065583e-01   -3.414498302508597e-01   +8.414332105124982e-01   +3.120811282849249e-01   +6.407777893162484e-01   -2.726684779938208e-01   +5.788794625532883e-01   -1.392109004256107e-01   -1.350050664123379e-01   +1.290609142731850e-03; +1.467756704614137e-01   +2.127189285910794e-01   +1.057579294732607e-01   -3.745327154977767e-01   +5.243181871685574e-01   +7.633373082901965e-02   -3.965844598592984e-02   +6.807443244445304e-01   -4.450329530399328e-01   +2.759139062942720e-01   +2.904342169553012e-03   +4.439276442707789e-01; -2.602436215510611e-01   +3.292375306625444e-01   +7.588223420505794e-01   +5.401516825941037e-01   +3.339461946412438e-01   +6.350960512438439e-02   -1.867302931246274e-02   +1.311921487460790e-01   +2.596972933371200e-01   -6.442327687562455e-02   +1.000765765340999e-01   +1.398091746820652e-01; +3.445736279049246e-01   -3.228932497651154e-01   -3.004066432389826e-01   -8.831230823361541e-02   -2.043211299833178e-01   -2.622759228835482e-01   +6.907017292294587e-01   +3.179902417351229e-02   +1.538681175245941e-01   +4.086776961852936e-01   -1.259602342601853e-01   +9.771848001203809e-01; +2.984168489772520e-01   +2.690280439441453e-01   -1.437161526013331e-01   -9.761824299969488e-02   +3.281107259859990e-01   +9.263866031867796e-02   +1.856765420006177e-01   +1.286337220724522e-01   +2.363168150912502e-01   +1.016280668126038e-02   +7.414007432048261e-02   -1.591718094944710e-01; +1.835938331802216e-01   +3.804926605784128e-01   -3.036157309869913e-01   -3.062649754566444e-01   +5.265721385394276e-01   +3.199724668135953e-01   +1.799350397931409e-02   +5.582677044852117e-03   -2.453390358541598e-01   -3.814236676436860e-01   -5.795259350442260e-01   +1.934227807458073e-01; -2.571018512634292e-01   +6.509110138973881e-01   +3.806981060607418e-01   +8.592508792968473e-01   -1.007739412731288e-01   +6.065694498536219e-01   +3.992734526466211e-01   +4.713065288019954e-01   +3.000561543419910e-01   +5.053767480835645e-01   +1.540656183191674e-01   +4.343365596324043e-01; +1.000000000000000e+00   -6.466890149729136e-01   +5.042569983411977e-01   -3.446853921496476e-01   +2.089762170331096e-01   -3.965908122736789e-01   +9.737980075604452e-02   +2.750713648497987e-01   -1.438242963203671e-01   -2.243505825718603e-01   +5.458988738720579e-01   -4.225338816402742e-01; -2.255628351265078e-01   +7.305289605971044e-01   +3.574535705254748e-01   +2.772381429525368e-01   +3.364624250501895e-02   +3.576569335742037e-02   +5.826878196244633e-01   +3.179276531975537e-01   +5.626586419818905e-01   +1.813794346992087e-01   +7.498077757961921e-02   +7.340816079932263e-01; +2.911814431293724e-02   +1.297391441247238e-01   +1.698792187181830e-01   +5.395820688523024e-01   -5.817747781940759e-02   -2.539230333801328e-01   -3.409858147965902e-01   +4.791214605114639e-01   -3.880921959083455e-02   -2.629733356783018e-01   +2.754493894539864e-01   -2.144538636046034e-01];
L3E_L3I_iGABA_netcon = [+6.939360627232162e-02   +3.205023589698174e-04   +4.852235360430124e-01   +3.471412523708069e-01   +4.113307588254215e-01   -6.042182505360900e-02   -1.687091440246116e-01   +2.662350883989453e-01   -1.652039273065849e-01   +3.441272440802041e-01   +5.673874183594390e-01   +4.665979684419543e-01; +3.903937882894241e-01   -4.703285516142557e-01   +2.599018473910777e-01   +1.311665400574644e-01   +5.353542806039406e-01   -3.505099539406436e-01   +6.772074180205226e-02   +1.401212280016373e-01   -3.820455703478487e-01   +1.424879470664358e-01   -7.410669327579059e-01   -1.155673233843096e-01; +1.466526213146460e-01   -2.113796751002973e-01   -4.736899338498467e-01   -2.294045438272305e-01   -5.559257060450288e-02   +3.669176134245246e-01   +3.685043751576322e-01   -2.575275642214681e-01   -9.872810172957101e-02   -2.006074205327020e-01   -3.466627160581315e-01   +1.413721740616209e-01; +3.830783155934835e-01   -9.615730692180662e-02   -3.156036736891600e-01   +6.495669377464719e-01   +9.427819701521400e-01   -1.693228909752759e-01   +1.621526434400208e-01   -7.991647503790182e-02   +9.251816880880880e-01   +4.487844462107681e-01   +4.232462473908242e-01   -2.075127280907821e-01; +1.340971884436132e-01   +5.017469396205880e-01   -2.123925264262234e-01   +1.480382725569532e-01   -1.971388871008457e-01   -2.984458233166548e-01   +2.782411553811446e-01   +3.385523463270108e-01   -2.998650931851712e-01   +7.780917237163253e-01   +4.909520312939233e-01   -4.296085796847856e-02; +2.608811164881766e-01   +8.165235053301767e-02   -1.842806891823459e-01   -1.034686604706451e-01   +2.423650604585761e-01   +1.265995046806981e-01   +2.314145419171697e-01   +2.617966389757408e-02   +3.114031233853549e-01   +9.704574547896128e-02   -2.049101156005202e-01   +1.014148200342878e-01; -2.048614617345424e-01   +8.586336195759339e-02   +1.187027417270875e-01   +7.968167449632342e-01   -4.493075352320988e-02   +6.510256645999950e-01   +3.239208690903819e-01   +8.255796858464755e-01   -7.693382151265626e-02   +3.092014195778367e-01   +3.141081545495846e-01   +3.301310587540414e-01; -1.340170529845022e-02   +2.844814972947888e-01   +7.599151273546930e-01   -1.220318345888588e-01   +2.752453425037549e-01   -4.541672726904675e-01   -6.931530749523797e-01   +5.489658900813588e-01   -4.167982091357833e-01   -4.402872054474619e-01   +4.737810901868561e-01   +8.046153060733198e-02; +3.326233833695208e-01   -2.235981754913288e-01   +6.870683877171926e-01   -3.748695827677910e-01   +1.904684865845255e-01   -8.366317157761825e-02   -5.926119732781276e-01   -9.916111509312069e-02   +2.530745686528251e-01   +3.885735255662820e-01   -2.024206272999260e-01   +5.494965791389633e-01; +3.076595119826041e-01   -2.181857812272227e-01   +2.993852325863580e-01   -1.618470790778736e-01   -5.931908482365678e-01   +9.756373599345831e-02   -4.515547722395470e-01   +3.331011310914500e-01   -1.596776384550023e-01   +1.228257463950756e-01   +2.235093758549760e-01   +2.682221162479556e-01; -1.800923185877121e-01   +1.993935978669097e-02   +8.072063730943917e-02   +3.790219594554087e-02   -3.037274430848514e-01   +5.823317561939730e-02   +2.463056490884677e-01   +2.134654282309812e-02   -2.181778705974133e-02   -6.027519628318979e-01   +1.018595029874048e-01   +4.291784874634957e-01; +7.300474389836110e-02   -1.624844006185772e-01   -5.193508241197864e-01   -1.829068323807703e-01   +1.000000000000000e+00   +2.098130786773647e-01   +4.880643866140628e-01   +3.097718885472641e-01   -1.266892022371438e-01   -3.480282368556318e-01   +1.141558406017409e-01   -5.946748018940288e-01];
L2E_Input1_iAMPA_netcon = [+7.805493470839094e-01   +8.338624691720165e-01   +7.376643581855733e-01   +3.839434250775575e-01   +2.182767348730610e-01   +3.113639850223348e-01   +8.639958281001547e-01   +7.196785635127129e-01];
L2I_Input2_iAMPA_netcon = [+6.185309304107395e-01   +8.681063068140528e-01   +2.985538610281178e-01   +2.749254705434407e-01   +2.257517302553552e-02   +7.138736621630242e-01   -3.828944196319789e-01   -2.092271335748438e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
