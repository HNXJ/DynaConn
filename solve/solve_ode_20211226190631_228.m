function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.913576885843703e-01   +1.121883331638715e-01   +1.948716165404251e-01   -2.917246361351390e-02   +2.591197086083734e-01   +2.147998643075290e-01   +2.788775945538611e-01   +7.593188219127658e-02   +4.330291278292872e-02   +2.534801222330288e-01   +1.156169712042707e-01   +2.241060763991110e-06   -1.054219605658796e-02   -3.363108218828127e-01   -1.052221982329006e-01   -1.801039861972662e-01; +1.162097387200988e-01   -2.165725898298555e-01   -2.740194812546980e-01   +4.647697019030094e-02   -5.554974203105123e-02   -2.939874575000507e-01   +2.287097862579953e-01   -3.068197259580427e-01   +1.305771072644753e-01   +1.308102509893105e-02   -9.619155748506615e-03   -1.970549764997941e-01   +2.392445182349871e-02   -1.552213786883944e-01   +2.708783809867793e-02   +2.961834965997969e-01; +5.232368939047662e-02   +2.167683478591826e-02   +5.732312075770395e-02   -1.780458140132774e-01   +1.507637489676761e-01   +1.404111021706052e-02   -3.137073635753096e-01   -2.321079638106152e-01   +1.415854858362534e-01   -1.570737609409576e-01   -1.087025608517951e-01   -1.878466809967982e-02   -9.672992577802156e-02   -8.470025629492769e-02   -3.151973650948864e-02   +1.592533802712336e-01; +2.621891245925545e-01   +1.160814317582724e-01   +1.703413804889978e-01   +1.170291328718131e-01   -1.563145622930736e-01   -1.436262021599545e-01   +3.034823260706132e-01   -2.675867805517865e-01   -4.870054927810309e-02   -1.052574660975480e-02   -2.610281078722389e-02   -8.604013426405002e-02   +1.157501879638317e-01   +3.535758731993638e-01   -3.653036190012992e-01   +9.392327818391022e-02; -2.051640295478066e-03   +2.269538933593605e-01   +3.176032959564331e-01   +2.370095982730913e-01   -2.166824521137022e-02   -3.734614708063808e-01   +3.411584439695826e-02   -7.458501132222539e-02   +5.244972853595695e-03   -2.142830723755604e-01   +2.765442441645290e-01   +2.177651266720505e-02   +1.680578977908885e-01   -7.416342766010438e-02   +1.840500732722194e-01   +2.237140846753068e-01; -5.375248928011783e-02   -6.494382881211271e-02   +2.256843396359584e-01   -7.545714868619499e-02   -3.908642066037374e-01   +1.522869755656792e-01   +1.831348455407520e-01   +2.580308421298083e-01   +3.605894077531098e-01   -2.527127531700943e-01   -2.127579079561778e-02   -7.368332704401478e-02   -1.986226636692967e-01   -1.594074099376719e-01   -2.493873644457031e-01   +2.277325228479434e-03; -1.378577628000380e-03   +1.095468503430092e-01   +7.560173696398510e-02   +8.086236131444026e-02   -1.388008729754538e-02   -7.594667550157685e-02   +4.236165795587166e-02   -1.607408141811944e-02   +1.009355743709837e-01   -3.740523788376667e-01   +1.421326130167847e-01   -3.441501278217306e-01   -1.717815028241441e-01   -5.585658478972852e-02   +7.666849199426701e-03   -1.028023116726958e-01; +2.211883010645373e-01   +1.763294910718531e-01   -1.321221190322523e-01   +3.866172981360483e-01   -2.001642078210004e-01   -1.916795705779306e-01   +3.611082796728163e-02   -2.489782283773080e-01   +2.443210677486995e-01   -3.070131988329567e-01   +1.052475608981514e-01   +1.048813084473929e-01   +2.913062769884778e-01   +8.261848791674548e-03   +1.097362639006556e-01   +1.967863197391537e-01; -3.164967222892191e-01   -1.675367519708371e-01   +2.972083671382363e-01   +2.683022603581207e-01   -1.112579674287876e-01   -3.008416329006852e-01   -1.644816294023504e-01   -2.560136014177262e-01   +3.346776258883779e-01   -5.776397261923538e-02   +1.344584219460520e-01   +3.142284449570225e-02   -1.537735662072201e-01   +1.753833416308270e-01   -7.311998959622004e-02   -2.279189033553307e-01; -1.708505041452548e-01   -4.548992914600676e-02   -2.967753083378960e-02   +1.431188282082296e-01   -1.005536933584261e-01   +2.402449515510109e-01   +9.050938190094930e-02   +2.629475318968247e-01   +1.373467528191376e-01   -2.684744845579213e-01   -8.611804119447786e-03   +6.831900192122664e-02   -6.792306235282503e-02   +2.051622296773113e-01   -4.473610770091530e-02   -2.081484813893051e-01; -4.375919127270012e-02   -1.764109274394681e-01   +2.188224058154765e-01   +9.165777845242146e-02   -3.691825558262924e-01   +1.059742654469609e-01   -1.644504090671023e-01   -6.451679969667806e-03   -1.613370710258619e-01   -2.529732900936865e-01   +4.900856024404617e-01   -1.642006718383427e-01   -2.634000651494003e-01   +7.073390660905537e-03   -2.107074358624689e-01   -1.302341936241780e-01; +1.190116647116130e-01   -7.375064691225692e-03   -4.809575945066016e-02   -1.987838831330288e-02   +3.054134641491701e-01   +3.768773015345493e-01   -2.835412280023197e-01   +1.111717475395783e-01   -2.238462545604645e-01   +1.244947991477994e-01   +1.157931803837418e-01   +1.246677313428046e-01   -5.239525016064302e-02   -1.509803271820580e-01   +2.480168024022531e-01   -8.673045349925416e-02; +1.316578854213548e-01   -2.886597643146829e-02   +1.659622577718274e-01   +3.693459113985409e-01   -1.684160504643067e-01   -2.426996193502988e-01   +5.625711348334728e-03   +8.563484578111774e-02   -3.770198579619147e-03   -3.521304722879363e-01   -4.119668461642196e-01   +8.179372839862087e-02   +4.080866228444733e-01   +2.387054558247000e-01   -1.526510947741740e-01   -9.869058872717358e-02; +3.650193180443314e-01   -8.122436736154375e-02   +2.128751215789739e-01   -3.637426640423819e-01   -3.860499639908423e-02   +1.474412048701270e-01   -1.909610969019348e-01   +3.300448013627455e-01   -4.029418402368789e-01   -2.246453937635590e-02   -2.885905959405389e-01   +1.173714064615428e-02   -5.303111798513960e-02   +2.874600935290348e-01   +3.645607129638721e-02   -5.341157483314646e-02; +1.711996308033574e-01   +2.104571938044233e-01   -7.935507341922877e-02   +3.584207246952704e-01   +2.339086066303453e-02   +1.096761979475276e-01   +1.206612533681543e-01   -1.064611134294547e-01   -6.501016155861877e-02   -1.975926966739014e-01   +1.948529097989117e-01   +9.150238003566044e-02   -1.589579490214580e-01   +4.140669920610912e-02   +8.428987810215685e-02   +1.275644834458949e-01; +1.414837471711123e-01   +7.539725403121852e-02   +1.463423130759929e-01   +2.151751247527462e-01   +2.501544277766030e-02   -1.964957288949213e-01   +5.779447895190193e-02   -2.810726554760347e-01   -2.969176027539971e-01   +1.393652931371660e-01   -2.493297360630052e-01   -9.684624906980173e-02   +3.007030658172986e-01   -2.340718236057037e-01   +6.159089478346302e-02   -9.844605196215366e-02];
L1E_L1I_iGABA_netcon = [-1.407594516355581e-01   -5.844623099076307e-02   -1.872878741363031e-01   +1.761668623900613e-01   +3.099805680697187e-01   +8.559919169719774e-02   +3.365453890362743e-01   -2.604232545967490e-01   -1.645643035207641e-01   +1.276528661985869e-02   -2.410103613550775e-01   +4.961852305294845e-01   -2.673777721761659e-01   -8.665009657881322e-02   -9.231465006983602e-02   +1.966838358502684e-03; +1.269618768604786e-02   -6.432186168579562e-02   -9.486676256755854e-02   +2.147130557560194e-01   +1.864561266829947e-01   -1.232368487217199e-01   -1.872384243149119e-01   +1.616632634228596e-01   +2.035215555310963e-01   +7.259840334951137e-02   -2.089003894526800e-01   +1.291326689277754e-02   +6.879283926144361e-02   +3.430790844736110e-02   +1.135337196770564e-02   -3.910242314489561e-01; -1.556414360413870e-01   -8.912575780539078e-02   -2.243061792390925e-01   -2.064788686968909e-01   -7.440409265260170e-02   -1.179281992791981e-01   -1.754208704719867e-01   -1.834715454493537e-01   -1.371036464866660e-02   -1.538671445749552e-01   +1.121634944058530e-01   -8.104267476729531e-02   -4.025575301998799e-02   +5.838092517086513e-02   +1.599562143593273e-01   -2.727805411298675e-01; +2.754679967310057e-01   -1.176631644412547e-01   +2.192946715233577e-01   +8.479165105819629e-02   -4.424208038834559e-03   -3.221174031582817e-01   +1.898628563957206e-01   +1.156506333995315e-01   +2.438325148238743e-01   +1.497648547373955e-01   +3.758988393674234e-01   +3.665346449554254e-01   +1.402277295489880e-01   -8.690898289378984e-02   +7.884162239254700e-02   -2.029547424126352e-01; -2.072486386106106e-01   -5.662033282208323e-03   +2.960642989975943e-01   -2.707159047625468e-01   +3.238492346706273e-01   -7.367504818923551e-02   +1.589810142107578e-01   -2.413442057249265e-01   -2.365538325541480e-01   +2.096914442830725e-01   -9.432612320700040e-02   -3.829376005955972e-01   -1.785986087863700e-01   +1.866232900676295e-01   -1.182664550104931e-01   -1.135538484471599e-01; -1.563441583489826e-01   +1.906936912438185e-01   +3.378734874108552e-02   -6.573794365818036e-03   +1.688539171454944e-01   +8.405368816056923e-02   -2.471223961900117e-01   -2.690998274796599e-01   +3.575511002145548e-02   -3.297307707756426e-01   +1.764845993129149e-03   +4.540592625358664e-03   -6.986497856685889e-02   +1.624552085077032e-01   -1.736708877292375e-02   -4.194057077128834e-01; -3.235770838729528e-01   +2.644495896058416e-02   +3.022083766465776e-01   -2.514216776220478e-01   -1.416152033043741e-01   +3.896652424648313e-02   -1.945382452948977e-01   -2.701691512676481e-01   -2.300474184462254e-01   +1.249514802018683e-01   +4.822934086540795e-02   +8.959925467343216e-02   +3.089073078735025e-01   +8.030599056556734e-02   -3.024647511664956e-01   -9.952159297464976e-02; +1.874459266751239e-01   +1.694132789537068e-01   -1.798562195800691e-01   +2.271016170936747e-02   +1.238611954429434e-01   -2.042788734053719e-02   +3.533711791807648e-01   -2.842795597300062e-01   +2.651162033045190e-03   -1.142393600536081e-01   -3.704633266917370e-02   -1.055620648931837e-01   -2.165265550070839e-01   +1.301406963234716e-01   -4.205120809817433e-01   +1.248450696741304e-03; -3.901846140277165e-02   -2.858915659071844e-01   -1.939489730300903e-01   +9.836917308079321e-02   -8.588925816894462e-02   -2.299708840057390e-01   -2.087585357284560e-01   -2.673271095009118e-01   +2.159109683951625e-01   +1.556517817367651e-01   -2.295512305180154e-01   +1.045380165905085e-01   +1.110074165736724e-01   +1.894292764077682e-03   +8.217613620810381e-02   -2.339838545287845e-01; +1.639770439474897e-01   -4.227772170164419e-01   +5.578074303264521e-02   -2.385485082929219e-01   -7.882377542056476e-02   +2.894486818442592e-01   -8.895942679531217e-02   +1.323280427462757e-01   +4.367743926926114e-02   -2.345240134579862e-01   -1.392599429805289e-01   -1.153511816258651e-01   -1.990194638752586e-01   +1.236384394149535e-01   +2.822198692932303e-01   +1.104985579663215e-01; +1.080181166499492e-01   +1.839824141401318e-01   +2.539598772796446e-01   -1.917290075659333e-01   +7.637586136575361e-02   +2.704854588346937e-01   +3.086620323325758e-01   +1.184129376251508e-01   +8.435534362599698e-02   -2.545933693185054e-01   +1.770137925507516e-01   +9.748495661277354e-02   +3.411553583222723e-01   +3.054129490850579e-01   +5.409655013197689e-03   -3.030696656896290e-01; -2.859067186184811e-01   +2.879003627336329e-02   -1.683558329540931e-01   +2.395052134436293e-01   +1.025764597734209e-01   +4.044843628471387e-01   +3.302421329606314e-01   -2.563122854366205e-02   +1.688916232957798e-01   +2.699634578734261e-01   +1.373505118764211e-01   -1.964596231243760e-01   -6.312789359264626e-02   +1.821152873471466e-01   -1.633315462809880e-01   +4.840148117523420e-01; +4.677868811247531e-02   -1.775582539347519e-01   +1.362964306340660e-01   +2.189133603988321e-01   -4.297986873184568e-01   -2.212494688424670e-01   +1.437443112697072e-01   -7.882122266765196e-02   +4.024368497071168e-02   +1.804070355157348e-01   -2.468431707800919e-01   -1.892388181907473e-02   -5.776698902160574e-02   +9.688387518567862e-02   -8.239419024712313e-05   +1.839780673084034e-01; -2.218192275844018e-01   +3.120985165369063e-01   +3.845458886138833e-02   +3.672937189081922e-02   -3.021066053874606e-02   +1.626272914384128e-01   +8.265621352031896e-02   +1.815445985068281e-01   -2.688691229279142e-02   +4.271204848673942e-01   -1.316153411701919e-01   -3.414515579206613e-01   -1.496479757984583e-01   +4.957812841232923e-02   +2.010868865298540e-01   -3.336844344229101e-02; +1.755211855441053e-01   -2.232085319372812e-01   +6.716623027815714e-02   -1.949930886112762e-02   +6.102492265199182e-02   -1.262977328198267e-02   +1.342773738383412e-01   -4.178007078609593e-02   -7.955625278012010e-02   +2.740198373599317e-03   +2.152574226090560e-01   +3.348876812138710e-02   -1.938763853837576e-01   +1.502287189746565e-01   +3.003414234687557e-01   +3.250225053079498e-01; -1.310284216271483e-01   -2.203303303077915e-02   -2.866390622284370e-01   -2.506080092271663e-02   +9.034990454002415e-02   -1.980927763501093e-01   +1.650676929615229e-01   +2.149772741476744e-01   -2.062695016749641e-01   -4.725733539931011e-02   -6.630761275235426e-02   -3.324645311335980e-01   -5.531738481571288e-02   +1.108619318726936e-01   -5.157297010734466e-02   -1.207356156796552e-02];
L2I_L1I_iGABA_netcon = [-3.737744679103041e-01   +4.857209352329580e-02   +1.547521682156819e-01   -2.481984122223963e-01   +3.313319330038373e-01   +1.129514818915698e-01   +7.873999769675288e-03   +1.174035971445160e-01; -6.665017531228094e-02   -2.494574815843437e-01   +2.718260295083569e-01   +1.218275534320758e-01   -1.749898147117457e-01   +1.849652532804077e-01   +3.231774190456610e-01   +3.136803438417877e-02; -2.961296044947224e-01   +1.925635022688481e-01   +1.139516178932802e-02   -2.243686411863327e-01   +1.756634217644884e-01   -9.277305538017794e-02   -2.202960997441336e-01   -4.647703801862062e-02; -1.206999492613812e-01   +1.095789674392208e-01   -2.928335354123814e-01   -1.514001321642468e-01   +2.905304352296282e-01   -6.401974320571566e-03   -1.234751469092029e-02   +1.243932036133759e-01; -2.408702261676614e-01   -3.712453452996241e-01   +1.623283795067851e-02   -6.555683230089293e-02   +8.119826535109190e-02   +5.953849712452808e-02   -5.910146326027753e-02   +2.744297100402306e-01; -2.834672107003233e-01   -9.618870817171193e-02   +1.148170081727447e-01   +3.580582038534538e-01   -1.752013093157843e-01   +1.264113676189305e-01   -1.151718471547205e-01   -1.276660947133207e-02; -1.212804590414392e-01   +2.168698060270573e-01   +5.365410367191441e-02   -2.001928336240349e-01   -4.295586114995420e-01   +2.192444901195688e-01   -2.415073482872273e-01   +5.931093871608629e-02; -4.479591888085196e-02   -1.033255477993626e-01   -6.129741159846672e-02   +1.096307594020681e-01   -4.612209948326507e-03   -1.608100067322071e-01   -2.918303556581056e-01   -1.011222326869632e-02; -2.186983436693141e-01   -1.052126841432823e-02   -1.591177920718340e-01   +2.125987056281420e-02   -1.084935594600436e-01   +1.627208653156598e-01   +2.900422990017164e-01   +1.302186402504762e-01; -2.589460274514931e-01   -2.075700306863847e-01   +4.540552769317674e-02   -1.681496693714974e-01   +1.731681681799828e-01   -1.634822155028887e-01   -6.362111131956905e-02   +3.324655622848037e-01; -2.408529608189151e-01   -1.803100347246968e-01   +2.069505318782281e-01   -2.352903628422519e-01   +1.694070496579453e-01   -1.109907409028175e-01   +1.305895929618984e-01   -1.991031834142455e-01; +2.376396402795715e-01   +2.706896649515323e-01   -5.815354530701394e-02   +3.022573865699302e-02   +8.971090643284466e-02   -1.291929099906291e-01   +2.074155842939871e-01   -4.294057705137774e-02; +4.574689080085181e-03   +7.943715546711277e-03   -2.874386706893131e-01   +2.931873845838593e-01   +6.837913948597618e-02   -5.478457913429255e-02   +4.114387970700928e-01   -2.549825192459544e-01; -6.689870823090655e-02   +3.671875152159512e-02   -2.247437594129855e-01   +6.248127667091960e-02   -2.359270244631792e-01   -3.722688176830025e-03   +2.590598922375500e-02   +2.219203413706038e-02; -6.296951213348941e-02   -1.462723928991332e-02   +2.254365407531915e-01   -4.798136628570185e-02   -1.312862302134868e-01   +2.149693876969449e-02   -1.432168533998877e-01   +9.335126689439172e-02; -1.673257927202620e-02   -1.000496016819890e-01   +7.554290042945619e-02   -1.480170187393277e-01   +2.787236179858937e-01   +1.701630521392284e-01   +2.742133053535335e-01   +4.710931089215764e-02];
L1I_L2I_iGABA_netcon = [-8.945650031946889e-03   -2.490720510029795e-01   -2.452454315440620e-01   +9.588171817894670e-02   -2.079550505317673e-02   -3.292708669634285e-02   +1.239775799467946e-01   +1.814126587393406e-01   +6.978405675496113e-02   -1.133137464393595e-01   +2.275602639131414e-01   +1.103677577229356e-01   +1.085479555246864e-01   -1.004282548762831e-01   -8.097926280476629e-02   -6.524271976085846e-02; -3.307729182165629e-01   +1.842911719699605e-01   +2.811014856916805e-01   +6.745746841938588e-02   -1.927879297916066e-01   -2.197746240724459e-01   -1.978035864765185e-02   +2.035317813723786e-01   -9.233479655574518e-02   -1.451116632590393e-01   -1.254748290799559e-01   +3.940621783705232e-02   +8.507183029981485e-02   +2.719647808994143e-02   +1.383028880222026e-01   +4.006864446514404e-01; -2.376361145800049e-01   -9.407106387478431e-02   +4.078622184054741e-02   +1.861245851389483e-01   +9.843192799195218e-02   -1.156217214784288e-01   +5.545405514257588e-02   -1.645434411374817e-01   -2.011934147762823e-01   +2.547868961107917e-01   -4.178007166178065e-01   -2.749467714219443e-01   -8.755025479136727e-02   +1.279390190725860e-01   +5.697562766459384e-02   +3.481461827134269e-03; +1.258954647324533e-01   -1.124928536275208e-01   -2.308102708497659e-01   +1.182924260173451e-01   +7.447902446166507e-02   +1.652741597766188e-01   +3.155347637448253e-02   -1.224896119310389e-01   +2.376366190752001e-01   -2.679706981447731e-01   +1.042210757281345e-01   -2.706831443581181e-02   +2.247329973112126e-01   +2.384715487030757e-01   -1.007512757601418e-01   -2.693086571623374e-02; +6.343932309988386e-02   +1.423396680438103e-01   -7.809348605422689e-02   -1.494378274132231e-01   +2.340739351203012e-01   +2.314008324718048e-01   -4.678480888234637e-02   -8.470543134206254e-02   -1.744842472419848e-01   +2.339618149118594e-01   -3.548031627449114e-02   -9.599031841407776e-02   -2.716926878200429e-02   +1.782034225221245e-01   -4.175145538310934e-02   +3.764996973588887e-01; +1.318388439385089e-01   +1.454518737441705e-02   +5.226231812619136e-02   +2.373994167294616e-02   +5.381637763176994e-02   -6.221416990661634e-02   +5.527997520161559e-03   +1.723943163043526e-01   +2.269213964742716e-01   -2.206185114794023e-01   +2.060593127701988e-01   -6.480118034820860e-02   -3.871583878664570e-02   +3.424192367652023e-01   +2.723917862289995e-01   +5.938701690629286e-02; -2.659341766706130e-01   +2.339130833988363e-01   -1.291350684888366e-01   +2.277703747059544e-01   -2.472193019140605e-01   +1.954232235568434e-01   -1.106381703018735e-01   +1.792695761246935e-01   -9.850404268711861e-02   -5.003064214380154e-02   -1.698707946654696e-01   +1.917493048573065e-01   -1.254133384904776e-01   +1.318495657239862e-01   +1.356356573900180e-01   -1.960888116184704e-01; -1.550363224444969e-01   +1.685426790249224e-01   +2.187941661358997e-01   +1.991683972536952e-01   +7.198691658279899e-02   -2.797100643537523e-01   -1.945394893078445e-01   -5.059816382950377e-02   +1.721860197591645e-02   +6.208646939911757e-02   +1.777989901033121e-01   -4.261039433861971e-02   +2.615056455945560e-01   -2.901638431544215e-02   -9.191931981138111e-02   -1.775417338471955e-02];
L2E_L1E_iAMPA_netcon = [+4.029633322843872e-02   +9.902106828168578e-02   +5.123476605142736e-01   +1.195997045554064e-01   +5.588992220642297e-03   -1.400225007167849e-01   +1.826291140562066e-01   -2.252431999231941e-01; +2.668733061785281e-01   -4.355592445659177e-01   -3.237056095515286e-01   -6.036513301056898e-02   +2.955458730068562e-01   +2.568300475401068e-02   +5.439872285497775e-02   +1.328475430468269e-01; +6.451831748263229e-02   +1.478985616135036e-01   +1.581982228548312e-01   +2.855174493243816e-01   -7.755945033212173e-02   -2.136003207612845e-01   -6.840055182279614e-02   +2.078751188445547e-01; -4.643597700181852e-02   +5.766895113254705e-03   -5.172006081516999e-02   -1.828755085095122e-01   +2.952567618194099e-01   +1.072423565875965e-01   +3.112880024220590e-01   -8.772924812938895e-03; -4.554661159690946e-01   +7.668625209542118e-03   +3.273252364088913e-02   +3.183767065502557e-01   +2.661350602099640e-01   -2.924396951285351e-01   -1.941600633222640e-01   -2.630084120960438e-01; -1.848267954668676e-01   +3.022308396498010e-02   -4.318253118599912e-01   +2.800575422258383e-01   -4.427505849404666e-02   -5.385005416835044e-02   -2.528065888988726e-02   +3.466022150451242e-01; +1.107919793419211e-01   +2.413738785514691e-02   -2.106346459838173e-01   -1.656203457836914e-01   +2.462508968437128e-01   -2.464623369649119e-02   -1.680424870081036e-01   +3.908949200984631e-01; -5.261738491390969e-02   +2.945130046061246e-01   -6.884929082398364e-04   -1.037844175590631e-01   -7.996966887364619e-02   +9.890505929668741e-02   -3.517166328548677e-01   -8.940576350029762e-02; -3.544721393915002e-01   -4.807114488289299e-01   +2.604767477679076e-01   -1.809677844960396e-01   -1.802383028461852e-01   +3.004452412693426e-01   -1.637275994776384e-01   -3.062064447226509e-01; -7.699048590138347e-02   +2.000219949958248e-01   -3.822233243392210e-01   -5.226547386981772e-02   -2.238683293075074e-01   +2.145150056870138e-01   -7.075882614149062e-02   +1.150406112187765e-01; -7.292183369504453e-02   -1.332014553803904e-02   -4.762588197791761e-01   +6.205938900551120e-02   +1.844355434523398e-01   -2.450351950109335e-01   +2.677838119063797e-01   -1.695027202620653e-01; -4.128075284250544e-01   -2.435507194546302e-01   +1.261716180703185e-01   -1.565498322986554e-01   -1.820079241742348e-01   +3.366065169753040e-01   +1.879807403314645e-01   +8.224267743614033e-02; -2.324430391364431e-02   +1.630121018051610e-01   +1.197417281757142e-01   -1.100417832210301e-01   +9.952341299059370e-02   +3.539890867508689e-02   +2.865636660770059e-01   +3.341249716011568e-02; -8.762721263172943e-02   -1.082091432748155e-01   +1.923366711922899e-01   +1.044794762992366e-01   +1.619655441255224e-03   +3.336235358217373e-01   -2.331931039741502e-01   +1.586601651091788e-01; -1.339223377997776e-01   -1.529271459135535e-01   +1.552387327654292e-01   -3.574113993650695e-01   -1.247337235408490e-01   -1.796600113116703e-01   -1.174709681288454e-01   +3.466941004966261e-02; +3.282117148291558e-02   +1.724634139629287e-01   -5.100619908239144e-02   +3.706852388371046e-02   +5.829527106574703e-02   -2.149309448483049e-01   +2.015278488714154e-01   -1.184896641990311e-01];
L1E_L2E_iAMPA_netcon = [-2.092532415562587e-01   -9.148829421995346e-02   +8.269369728190160e-02   -3.128402099730451e-01   +1.814258005600350e-01   -1.249857028171260e-01   -1.552099836690650e-01   -1.372820012841945e-01   +5.495633422699889e-02   -1.190762120624941e-02   -2.432358915003398e-01   +2.542019279883684e-02   +3.145238376488540e-01   +3.052835499999325e-01   -6.107990148287008e-02   -1.778584911605290e-01; -1.676589098743802e-03   +3.805435138174263e-01   -4.292564849502106e-02   +2.008771819924224e-01   +5.522943711685245e-02   +1.210110143122818e-02   -9.357028632360385e-02   -1.133212369735629e-01   -8.363559995471696e-02   -2.049198869820223e-01   -1.473754498882048e-01   -3.464607047340522e-02   -7.763012764598846e-04   -3.227543947417556e-01   +6.447240462579498e-02   +2.444657454594412e-01; -3.620148669945605e-02   +2.838322250024297e-01   +1.537969310829002e-02   +7.496003606550362e-02   -6.777489363282270e-03   +3.427584030033864e-01   -1.321074026894457e-02   +9.689925104950356e-02   +8.052771959965112e-02   +2.148140429995559e-01   +3.261518148520337e-01   -1.005667533966715e-01   -3.069336830587388e-01   +1.143916266456774e-01   +1.902601881775594e-01   -2.985159387208185e-01; +5.744157993469040e-02   -1.399331445439641e-01   -1.687575683648491e-01   -2.955566853582270e-01   -1.599131649334120e-01   +5.800575138421840e-02   -1.809413274285457e-01   -2.637257902771631e-01   -1.508001547074291e-01   -3.916970061001636e-01   -1.002050704307710e-01   -2.796772638834065e-01   +6.918581299698477e-02   -1.778712541245026e-02   +4.853327775735586e-02   +1.940641495835779e-02; +5.754106088987473e-02   +2.714782449009117e-01   -1.785538831316575e-01   +9.638074070135505e-02   +2.333533387439714e-01   +1.893181236011184e-01   -2.892078557769091e-01   -2.987863008712546e-02   -1.190814383236635e-01   -1.695803578407569e-01   +1.619910954456369e-01   +2.562454730542859e-01   -3.596728077972859e-01   +1.220108755138216e-01   -9.765303553874177e-02   -2.049416167796758e-01; -2.557180779815538e-01   -2.311924621471677e-01   -1.355628821980709e-01   +2.277692837360991e-01   -1.793400831671434e-01   +1.188580422622003e-01   -1.035441652240214e-01   +4.256485980493710e-02   -1.112333644545411e-01   +1.156224290795033e-01   -1.281311244057979e-01   +1.393534094249435e-01   -3.659742290957675e-01   -2.490320050564827e-01   +3.646096734594544e-01   +1.141933114857732e-01; +3.373206237250910e-01   -1.879193450890130e-02   +8.838512403658577e-02   -3.056139637961164e-02   +3.578353446602019e-01   -2.088478667416271e-01   -1.645608266754276e-01   -1.032510159025042e-01   +2.569853942779560e-01   -1.407868104183418e-01   +2.953720458510472e-02   +1.570586991620299e-01   +2.148517041363517e-01   -2.767397256864683e-01   +2.680854368078895e-01   -1.836796489046172e-01; -9.610570322394096e-03   -1.234081378942884e-01   +1.630957960898883e-01   -2.822685840942437e-01   +6.949656719457734e-02   +1.153100099391828e-01   +4.986774686890200e-02   -3.317742425203230e-01   +1.027461369001106e-01   +2.300811349067155e-01   -1.945879691642944e-01   -7.617255621067771e-02   +3.015476474544646e-01   -1.935538081382711e-01   +3.119111547099776e-01   -9.272645235059400e-02];
L2I_L2E_iAMPA_netcon = [-3.392658737509937e-01   +2.248968909110391e-01   -3.608052557918226e-02   -6.655939428084445e-02   -1.943328276743694e-01   +2.207998343085833e-01   +1.751830436830691e-01   -3.293889523523287e-01; -3.640158921651024e-03   +4.386450057291602e-01   -2.176281127763068e-01   +2.522213215445951e-01   -7.038655936385281e-02   -3.349388284343534e-01   +1.709562524463172e-01   -1.670948961940376e-01; +6.681636982326078e-02   +4.174676729177880e-01   -3.695870048889510e-02   -5.517984380992658e-03   -2.103946343269340e-01   -2.760653697031908e-01   +2.304926370474079e-01   -6.311414918715073e-02; -2.187517631834007e-01   -2.656375246618650e-01   -2.327834803925541e-02   +6.916395813955657e-02   +1.302480456454658e-01   +3.187479649666438e-01   -1.364202904185670e-01   -2.971994598425181e-01; -1.992210902996031e-01   -8.353212909981947e-02   +3.390621037159242e-02   +1.255275733019199e-01   -2.349225271928237e-01   -8.269562402819504e-02   +2.772134219167275e-01   +2.141233161946990e-01; -4.559962449374909e-01   +1.650379182619595e-01   +3.218300466825048e-01   -6.348595404416499e-03   +1.138739560298164e-01   -1.522271382239477e-01   +2.420745826703177e-02   -2.797445984269627e-01; +1.715168947874973e-01   +5.950542465250677e-02   -4.817457915566804e-02   +1.271077630689920e-01   +5.743685935049934e-02   -1.429428419030474e-01   +5.375767154836281e-02   +1.962539521350716e-01; +5.100719456936089e-01   +3.526854447623052e-01   +3.411955244712338e-01   +2.695775545585009e-01   -1.640748313209935e-01   +6.761851009575878e-02   -3.009324505796566e-01   +1.946140701855426e-01];
L2E_L2I_iGABA_netcon = [-1.262824784694025e-01   -2.610730784350715e-01   +1.801245709211415e-01   +7.558831325480009e-02   +3.577798359195938e-02   +2.028302131329206e-01   +3.071230034230612e-01   +3.975977062527801e-01; -1.713125216046829e-01   -2.687605380016419e-01   -4.690860386734833e-02   +3.089505773630495e-01   -3.229594167577370e-02   +2.946561827158835e-01   -5.890029288764784e-03   -4.252602525848877e-02; +4.400727074302391e-04   +3.778446889880395e-01   -1.163426910303759e-01   +9.368598854652070e-03   -5.281160567143552e-02   +1.798154005718502e-01   -1.074842030158726e-01   +1.224525107652098e-01; +1.259899182960484e-01   +1.355249428554524e-01   -1.707026753918130e-01   -4.138071471480517e-02   -1.890373228991007e-01   +1.357409731673206e-01   -3.766682839907393e-01   +2.159052590150310e-01; -3.339096776920362e-02   +3.960731233569412e-01   -1.149164601489788e-01   +5.186800102894414e-02   +2.317759472580500e-01   -1.262194595604129e-01   +3.649542651486742e-01   +8.099417915365031e-02; -2.906613114596279e-03   -1.616542480516467e-01   -2.436951991299446e-01   +2.001895819795221e-01   +8.909397911343098e-02   +8.664047297849287e-02   -5.192439360012519e-02   +1.300796294982861e-01; -1.366480054462864e-02   -5.245732492489741e-01   -2.659298904728212e-01   -6.069233668434168e-02   +1.776095917862062e-01   -2.947945469047324e-01   +3.196814654294271e-01   -1.392101449093659e-01; -3.992997102321529e-02   -1.355796773461911e-02   +2.806195656556068e-02   +3.687157574284794e-01   +2.228990316562219e-01   -9.629411688384207e-02   +4.142187099564383e-01   +1.744593339154335e-01];
L3E_L2E_iAMPA_netcon = [+2.157405276792666e-01   -4.250519689887434e-01   +1.239131776882983e-01   +8.452020009499378e-05   +1.195050096242806e-01   -5.707003755058210e-02   -1.295772842714551e-01   +1.268930442321015e-01   +4.390417165953397e-02   -9.701883607085048e-02   -1.376270759264023e-01   -2.602224449873518e-01; -1.619862932728940e-01   +2.122023902809004e-01   +3.023257249638366e-01   -1.721468195230489e-01   +5.878343190115770e-02   +4.425358007348609e-01   -8.497905591927277e-02   +1.706007863765940e-01   +2.742880989341703e-01   +2.779963041533015e-02   -5.213692817757817e-02   +2.275013818920583e-01; +1.422221287991192e-01   -1.462577803932645e-01   +1.632108736747076e-01   +2.517902368469384e-01   +2.651892364596360e-01   -2.808368088184453e-01   +1.651089902628040e-01   -6.025650762730983e-05   -2.223830952689694e-02   -8.456967643257385e-02   +1.817028064322083e-01   +6.537891378169833e-03; -8.348254742354741e-02   +2.043966817389351e-01   -1.015537644189640e-01   +2.351159477394703e-01   +2.177583622373365e-01   -1.013491896029152e-01   -1.072781181417882e-01   +3.742283180283796e-01   +5.232275305964101e-02   -1.713568659305687e-01   -1.300934834641770e-01   -2.969388435288747e-02; +3.574729096714817e-02   +1.914350436495800e-03   -3.622243677343762e-02   +3.763042044431734e-01   -3.971024433494424e-01   -7.768663519912754e-02   +3.968872961730841e-01   -2.085955652557809e-01   +1.464287165597293e-01   +8.901777847964823e-02   +2.174642757957806e-02   +2.358481268060697e-02; +1.694980178507542e-02   -7.897367650377056e-02   +5.155943510594602e-02   +2.014162141754173e-01   -7.334135009529018e-02   -9.785501758822300e-02   -4.064400248589570e-02   +1.487200392852517e-01   +1.923079916148075e-01   -3.519920341010546e-02   -3.440958017717076e-02   +2.656938540038425e-02; -9.429598460118815e-03   +3.496576231311311e-01   +3.457159230458348e-01   -3.462760911657398e-01   -1.781827274940525e-01   +1.845812051883137e-01   +3.586932099703488e-01   -7.081702249676627e-02   -2.623154659856131e-01   -1.819406739109942e-01   +1.542677961073155e-01   -1.276995025968914e-01; +9.967655817662530e-02   +1.584578394322972e-01   -1.125413376605341e-01   -2.477729087428847e-02   +1.631368923043812e-01   +4.609040810949126e-02   -3.709821680850553e-02   +2.409012150321861e-02   -2.564716999329608e-01   +2.132380961359577e-01   +4.106047305694096e-01   +2.006154629700536e-01];
L3I_L2I_iGABA_netcon = [+3.769353822453981e-01   -3.071108643199795e-01   +2.293677156760817e-01   +4.146155000769665e-01   -3.737555059274645e-01   -2.891410567191042e-01   +6.699634235788515e-02   +1.749332130096119e-01   +5.107574432032294e-02   -1.442975222158210e-01   +4.324188753282032e-01   +3.548576039068078e-01; +1.765266265167019e-01   -6.994232734860864e-02   -1.751863042432649e-01   +2.124249142559528e-01   -2.251040980925931e-01   +2.156294820065829e-02   +1.660269339530445e-01   +1.059093543590154e-01   -1.273552550295527e-01   +1.003156654440129e-01   +1.696334529328516e-01   +2.392555171562513e-02; +1.997374444052996e-01   +2.410257232210140e-01   -9.289186456196266e-02   +4.012276275032980e-01   -1.577208102599362e-01   +2.060057900138032e-01   +1.683640664477959e-02   -2.080915152500806e-03   -1.695201679943857e-01   +3.549226393700723e-01   -2.880167032862015e-01   +1.236074196820849e-01; +8.733440463417350e-02   -2.742321304417470e-01   -3.027278290224271e-01   +1.386471334062691e-01   +7.898200268431584e-03   +1.453269033017482e-01   +6.360395622289070e-02   -1.397567460190760e-01   +1.940943999848588e-01   -3.685288300596648e-02   -1.237863276840194e-01   -3.143613086110479e-01; -3.395051586093259e-02   -1.819231091339317e-02   +5.766328084614838e-02   -3.934390648378234e-01   -3.081309239636306e-01   -2.064806041935547e-01   -2.458560470549358e-02   -1.219040588008369e-02   +2.512389561223421e-01   -7.675506766206505e-02   -2.595409503133608e-01   +4.680993863592228e-02; -3.701977867998980e-01   -4.044786933085726e-02   -1.071451196022920e-02   -3.872639265848157e-01   -1.207762013388035e-01   +2.755700014138250e-01   -1.904658991190713e-01   +1.430509110735434e-01   -2.206193100090123e-01   +7.117822144979978e-02   -2.160239780344475e-01   -3.515984512044729e-01; +1.234719167159427e-01   -1.226017248621584e-01   -2.254340903001461e-02   -1.119119622714243e-03   -2.671079392270137e-01   +1.676322008468892e-01   -1.349091847147587e-01   +8.962195894346008e-02   +1.869167423605183e-01   +1.364315527104893e-01   -9.348156502485133e-02   -3.720193038235098e-01; -1.228928993682029e-01   +3.763970994383058e-01   -3.000204212041281e-01   +1.197992196867949e-02   -2.820189875145069e-01   +1.902728394534170e-02   -8.036697223293812e-02   -4.642958024220947e-02   +1.894213918747534e-01   +3.017396465189642e-01   -1.897066091483170e-02   +2.873289623064673e-02];
L2E_L3E_iAMPA_netcon = [+1.387761942461850e-01   -1.585790300686231e-01   +3.297836360897065e-01   +3.984235588052824e-02   -1.526080280780875e-01   +9.372057941137628e-02   -1.394988010494115e-01   +7.113082116395447e-02; -1.181199714449606e-01   +1.350542982050523e-02   -8.561624145978550e-02   -2.241362777661925e-01   +3.657029555916166e-02   -5.892615373619595e-02   +1.455974806684109e-01   -3.036022163609355e-01; +2.269225229184508e-01   +4.202385760490118e-03   -3.010516577579139e-01   -8.336940690024641e-02   -3.710213937163578e-01   -1.169320162754650e-01   -8.429464311184327e-02   -5.854930364842034e-02; -1.280925128979312e-02   +1.073184208961113e-01   -9.384829178924832e-02   +2.516485131099822e-01   +1.686349787599035e-01   +1.160917558539253e-01   -2.589470250101409e-01   +3.186507457042680e-01; +5.068649359882318e-01   -2.148971632478196e-02   +3.304659310850650e-01   -1.566049415226670e-01   -2.865773182376423e-01   +2.775198249731929e-02   -6.713929301908168e-02   -6.590613748107643e-02; -1.111084972859375e-01   -1.333300975061443e-01   -1.182787291991514e-02   -2.500883022815469e-01   +1.080610216812673e-01   -9.460712531448455e-02   +3.677905107273785e-02   +6.779087524794905e-02; +2.515511921490186e-01   -9.545411011260073e-02   -3.896703731052444e-01   -8.177232341349708e-02   -9.420897548188997e-02   -1.657325085483889e-01   +3.231715849061180e-01   -7.709360654457356e-02; +5.505379676931917e-01   +2.878009556438621e-01   -2.589389665549391e-02   +2.394061013281218e-01   +3.234647274492439e-01   +2.731810789098077e-02   +1.378018011407631e-01   +1.112785930297765e-01; +4.220364344006205e-01   +1.917458344856708e-01   +6.468833787209402e-02   +1.837307858780229e-02   +2.331923994871072e-01   -7.912827035626324e-03   -1.738677642802127e-01   -4.287316864333862e-01; +1.666025704264655e-01   +1.351625209454981e-01   -2.726026611926696e-01   +1.678336060915404e-01   -2.369598468277559e-01   -2.482192954688506e-01   +1.347108956911897e-01   -6.287636782666950e-02; -3.213603216381512e-03   +3.496563367084755e-02   +9.837002996511321e-02   +2.087097300618725e-02   +2.587532508380935e-01   -7.094479245081677e-02   -1.102457641645452e-01   -1.301477109091143e-01; +4.162473639233824e-02   +1.479460209910244e-01   +1.647307164332714e-01   -1.531744746248596e-01   +3.013326948303280e-02   -1.931408004457583e-01   -2.038533920115793e-01   +2.148856623330845e-01];
L2I_L3I_iGABA_netcon = [-1.338998956913852e-01   -7.123618387570263e-02   +1.449682003042861e-01   +2.390815494955763e-01   -2.075587226684339e-02   +8.359447588457508e-02   -3.286168919361683e-01   +1.364110927381801e-01; -4.913259248286156e-02   +1.723144746137396e-01   +1.089695526381478e-02   +1.855708998968105e-01   +2.653838669902338e-01   +2.438887898034929e-01   +3.349581060176439e-01   -2.679306188404839e-01; +6.597776456821158e-02   -5.764087495059350e-02   -1.897155347076852e-01   +1.492563240116380e-01   -1.725375593011350e-01   -1.195734081911120e-01   +1.311594222203255e-01   +5.211955470670156e-02; -2.113345116961122e-01   -2.381337359173454e-01   -8.442198971709024e-02   +3.300341364980578e-01   -1.611216780348015e-01   +2.630147508039887e-01   +2.474842373249755e-02   +2.362950702171356e-01; -1.537537780894952e-01   +2.754796161386010e-01   +1.302686982478058e-01   -2.493809008359575e-02   +1.140817512283176e-01   +1.371274162529764e-01   -2.805842107793947e-01   -1.373017166149340e-01; +1.596679061378214e-01   +2.114503274559185e-01   +2.674074260792597e-01   -1.899835222666884e-02   +3.987605215343054e-02   +1.595946567554097e-01   +1.588827124378143e-01   +1.265397336565266e-02; -1.531044056417034e-01   +1.826850124709226e-01   -4.557900848283401e-02   -1.286328212777120e-02   -9.489296993307952e-02   -7.251316404119690e-02   -1.579401989319915e-02   -7.796590333279067e-02; +2.708509374896208e-01   +7.026974432928099e-02   -2.859692365067140e-04   -3.122043752065470e-02   -6.852679235080750e-02   -1.905225564132867e-02   -7.182698058677284e-02   -4.097996930571610e-02; +4.217056688400563e-02   -2.759176775554242e-01   +4.797034444340320e-02   +3.060436827103225e-01   +3.256199474047712e-02   +1.548195936185439e-01   +1.884075284905720e-01   +2.053823227463301e-01; +1.297644101460466e-01   +1.887150813284232e-01   +1.115968950069292e-01   +7.267481278304054e-02   +1.342196992223587e-01   +3.076954049814614e-01   +6.152145246334643e-02   -1.962543666835751e-01; -1.361261200120510e-01   -4.721950868898771e-02   -1.618499035591266e-02   -9.033406399436880e-03   -3.364847409634376e-01   +3.392267673792188e-01   -1.242472512212773e-01   -1.191902581286423e-01; +1.827196417125916e-01   -2.751278238536021e-01   +2.384004216077479e-01   +1.915545992270246e-02   +9.723782834600037e-02   +6.135964043377903e-02   +2.751537335176555e-01   +1.062336924134251e-01];
L3I_L3E_iAMPA_netcon = [-1.343358733021694e-01   -3.301200250291380e-01   +1.612467920675491e-01   +2.395862982141580e-01   -5.272013691563573e-02   -1.191348958670155e-01   -6.154454912353988e-02   +1.173939108129259e-01   +1.278870730077223e-01   +7.539151309311252e-02   -1.428307800330683e-01   -1.013564010219919e-01; -2.344393943523329e-02   -9.770459775992603e-02   +1.687053396530960e-01   +1.546355862966518e-01   -4.284198429658072e-02   -3.500473701811205e-01   -9.119911972898670e-02   +3.944579444680089e-02   +3.532323465091608e-03   +1.120752610830165e-01   +1.075804289897149e-01   +3.371740836524484e-01; -2.227557700925935e-02   -1.639937358267240e-01   -6.981087192079233e-03   +3.578173551577057e-02   +1.852336955761165e-01   +2.875047451629629e-01   +1.562265193717475e-01   +4.933159420896033e-01   +5.759375588811796e-02   -1.016831424732867e-01   -3.690321474003651e-01   +3.868208757539188e-02; -2.132294703093551e-01   +2.995908765701386e-01   +1.615491496166020e-01   -8.411518019012457e-02   +1.360014131323416e-01   +2.207163748788167e-02   -2.261802586752822e-01   +7.032067721981367e-02   +1.845937382115225e-01   -3.469587661547405e-01   -1.180288540689158e-01   +1.924367736573471e-01; +3.440374084017233e-01   +1.252818892681883e-01   -2.004040021695139e-02   +1.976541894819170e-02   +1.567039172414759e-01   -5.181768591018658e-02   +1.918344810358421e-01   +1.284050849089961e-01   +2.330359923629733e-01   -7.865221438943484e-02   -2.828148116710740e-01   +1.214215928356802e-01; +1.408696681980525e-01   +2.055630851921173e-01   -3.332196306651145e-02   +2.364967559759459e-01   -1.246881925433273e-01   +3.676621128879136e-01   +1.563437183114577e-01   -8.447510859488394e-02   -1.681481723623867e-01   +1.169312367986799e-02   +3.078246937141288e-03   +1.286063229188006e-01; -3.738650701695226e-03   +9.437018372993805e-02   +4.788539403726628e-02   +8.108332739578081e-02   +2.218381174772577e-01   -1.902072605572376e-01   +1.742647005862402e-01   +2.759049303494547e-01   -7.601438561777123e-02   -1.050263017843639e-01   +3.656000596921799e-02   -1.518803694367382e-01; +3.778264977083405e-01   -2.881775646387641e-01   -1.150766417256696e-01   +9.722862130488839e-02   +1.170964680741691e-01   -1.435065516882474e-01   -3.041930357634541e-02   +1.290419927846886e-02   +2.086484982606685e-01   -9.973281732592769e-02   +2.324610482262024e-01   -3.945673351449352e-02; +4.022172655771539e-03   +1.950965266392651e-01   +1.043981137730227e-01   -2.890089896717916e-01   +1.971784363258964e-01   -3.214526828077076e-01   -9.005899178366746e-02   +3.773199354723700e-02   +7.225967297947072e-02   +2.336177537468971e-01   +3.466053290985288e-03   -5.297244517244885e-02; -8.664985190350000e-02   -1.719240000896037e-01   +7.830757469720433e-02   -1.801966395277051e-02   +1.927936995840940e-01   +2.487166703894674e-01   -3.231492371629489e-01   +3.328041682816236e-01   -1.388970418797522e-02   +1.931724919475227e-01   +1.019472804057211e-01   +1.843173038961537e-01; -2.203943830852281e-01   +6.833226612583626e-02   -2.422481149509237e-01   -1.238064596968110e-01   +1.657692884056665e-01   +7.706788098235419e-02   +2.756009529867448e-01   -2.144821166942666e-02   -2.765910391671292e-02   +2.932530902668349e-01   +3.500040938357879e-01   -1.044186305063376e-01; -1.506782653572878e-01   +2.574356317199498e-02   -2.545020006393936e-01   +1.843382252526328e-01   -1.819894329560955e-01   -2.969221821660665e-01   +2.002084782710455e-01   -8.243616054624044e-02   +2.286026319445197e-01   +2.504759598277179e-01   +1.198269508439978e-01   -4.070779811643799e-02];
L3E_L3I_iGABA_netcon = [+2.556872261077869e-01   -2.871070654723558e-02   +1.836197900214980e-01   +7.190090499948273e-03   +4.926715326280182e-02   -4.871601785136899e-02   +3.494616147030552e-02   -1.260050759240210e-01   +1.043725975126165e-01   -1.382785772283338e-01   +3.895525203521226e-02   +3.320496681416001e-02; -2.488381533997245e-01   +9.474792790083056e-02   -2.620542801756193e-01   -5.191981686469810e-02   +2.754489912356191e-01   -2.088976684898339e-01   +2.399696926797824e-01   -1.042047455029200e-01   -1.092093632391635e-01   -3.394545206473882e-01   +1.466358401019211e-01   -3.508362590725954e-01; -2.952656648084664e-01   -1.145565428274776e-01   +1.812984246212833e-01   -2.115840079071682e-02   +1.210536374617623e-01   +2.298494982021982e-01   -1.104541778936596e-01   -7.681883017846078e-02   -6.804291629345044e-02   +2.200410885670150e-01   +1.600029919161687e-01   +8.019345961173789e-02; +2.473184488853485e-01   -2.183775031431997e-01   +1.526470364437805e-01   +1.823551908733450e-01   +1.089129111221933e-01   +1.284003545100996e-01   -2.626677975539745e-01   +1.609213157486367e-01   -1.791675283857914e-01   -1.960385667495051e-02   -2.171286443890322e-02   -2.279512385740106e-01; -3.502972325212010e-02   +1.077546543488231e-01   +1.484293781733674e-01   +2.637356118683085e-01   -3.656157818914667e-02   +5.735741837261263e-02   +9.984691787051213e-02   -6.254866694557493e-03   +1.236865513156289e-01   -2.210476802137619e-01   +2.253618627442194e-01   -8.154760036232148e-02; -2.335002283824218e-02   +1.340706874804762e-01   -2.021421716365322e-01   +2.295742849242186e-02   +3.592871948963226e-01   +2.056907270765822e-01   +1.954217815798004e-02   +2.633223320200766e-02   +2.827219636555790e-01   -3.512927715103334e-01   +3.141559598806539e-01   +2.161119437562297e-01; +2.831723662349069e-01   -6.574625967161216e-03   -1.668633247955693e-01   -3.103715017001875e-01   +2.265643631297282e-01   -1.177469959025984e-01   -5.267719733902476e-02   +1.961728528783650e-02   -3.243673062080263e-01   +9.478024509616753e-02   -2.128611724174790e-01   -3.974774141005652e-02; +3.500621277657342e-01   +1.159014996830607e-02   +2.354737037962000e-01   +2.071601885928313e-01   +1.795806865827495e-01   +1.932555996005607e-01   -4.751557896200356e-02   +6.592770044508771e-02   +2.191825329634130e-01   -1.583113681442873e-01   +3.963186089164760e-01   -1.450693688594183e-01; -2.384068901502918e-02   -9.532695402951760e-02   -1.919245077191451e-01   -1.009766117190711e-01   +2.745069182147920e-01   +2.819985681461870e-01   +3.237213924554195e-01   -2.472230272480032e-01   +2.074878005229930e-01   +7.431510049183820e-02   -3.744064574496141e-01   +1.501524858859340e-02; +3.266014251989402e-01   +4.110640608410555e-01   -1.243811733714513e-01   +1.146705816288326e-01   -4.339116376906295e-02   -1.435053863294939e-01   +1.598073356855904e-01   -1.246015290055077e-01   +9.085820653781890e-02   -1.767271160010839e-02   +2.772527789007904e-03   -1.225142393589220e-01; -1.139817066291634e-01   -1.577225179244724e-01   -3.239139889708583e-01   -1.846573544783816e-01   -2.689260469984175e-01   -4.875289963352408e-02   +2.965911466414522e-01   -1.270638541550808e-01   -3.149480787633804e-01   +1.325695456289846e-01   +1.608215956304837e-01   -2.644605227957318e-01; +1.650952402643531e-02   -4.654809206134233e-01   +2.047243301069230e-01   +2.284940439027810e-01   -3.298771825010827e-01   -1.881018039884145e-01   -1.646820695357807e-01   +2.161917330793293e-01   +9.631907216349800e-02   -1.954953349630330e-01   -6.123854018822460e-02   +2.504750010403234e-01];
L2E_Input1_iAMPA_netcon = [-3.596978315641504e-01   -8.954191238383097e-02   -7.248548469787101e-02   -9.958455720373452e-02   -1.808491104005268e-01   +5.318099145682156e-02   -1.448915782603045e-01   -1.781526839914642e-02];
L2I_Input2_iAMPA_netcon = [-2.054755781917829e-01   -9.131551577432633e-02   -1.134342200525940e-01   -1.126867131096189e-01   +6.442524422307326e-02   +1.911264767241687e-01   -4.241491004835719e-01   +1.703143840591617e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
