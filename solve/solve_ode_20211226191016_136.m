function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.252416788193058e-01   -5.306885202146477e-02   +1.091066911107390e-02   -8.447639080402286e-02   +8.559505546799073e-04   -1.638481005823917e-01   +1.397014729206323e-01   +1.327942898757962e-01   -1.697801855324308e-01   -2.606833720177492e-01   -1.777822330309081e-02   -8.252483498677025e-02   +1.889734043313878e-01   +4.325836784936363e-02   +2.824155554961322e-01   -2.502550767376560e-01; +7.856399707746875e-03   +2.882717185543042e-02   -4.757414302212875e-02   +9.439160991517266e-02   -3.815069475066941e-01   -6.366803620360094e-02   -7.573909724551717e-02   -1.758983846787024e-01   -6.121477830635598e-02   +2.333937556412265e-01   +1.366460980298047e-01   -2.219633306978026e-01   +8.247744850468514e-02   -3.069410122751580e-01   +1.126687832888466e-01   +9.203088635562079e-02; -1.179600512076060e-01   -3.392867328616708e-01   -2.422029482781188e-01   +1.574943008064085e-02   +7.457306716947196e-02   +9.419034822405786e-02   -1.250283944306799e-01   -1.018373938041236e-01   +1.486963802582712e-01   +4.357967778584804e-02   -3.296569848074208e-01   -8.062925905649232e-02   +3.149003738010281e-02   -3.256191217682743e-02   +2.535031001499401e-01   +3.501937179827026e-01; +5.552504540678449e-02   -1.339097603048766e-01   -4.943052713789280e-02   +2.303319257511713e-01   +7.347098329094720e-02   +1.723372184210079e-01   -1.009493251740379e-03   -1.402797783643419e-01   +1.342730625278714e-01   -8.264230212849466e-02   -2.294028133664832e-01   -2.304766478142724e-01   +1.735241007637121e-01   -4.063700138862188e-02   +2.228086160672801e-01   -4.642570664115099e-02; +7.169373366034926e-02   +2.577579788169763e-01   +3.900786387697859e-01   +1.283008823457497e-01   +4.229090867299973e-03   -1.080391341703153e-01   +1.063399833405358e-01   +1.715541160013000e-01   +2.390646591904710e-01   -3.428188630275864e-01   -9.753660679158473e-02   +7.101715108214386e-02   +2.380821357957690e-01   +2.793456640060916e-01   +2.205363455297047e-01   +4.359463890104323e-01; +3.521007099039482e-01   -2.845598063964799e-01   -1.032924442806553e-01   -7.412537864902580e-02   +4.585071570616337e-02   -1.790960346662758e-01   -1.968479022681259e-01   +1.122938928648505e-01   +2.752534821032519e-01   -1.455699297999377e-01   -1.156487329940144e-01   -8.283466030495421e-02   +8.833650443480388e-02   -4.595827186187180e-01   +3.691442292910041e-01   +8.183214964069553e-02; +6.212632046680942e-02   -1.099185442381250e-01   +9.849478729561725e-03   -7.867513878335622e-02   +3.777346393963639e-02   -1.219872912297483e-02   -1.614655187272349e-01   +3.268428215690527e-01   -2.791404692336426e-01   -1.365188348439850e-03   -3.584232224960154e-03   -6.276220774835362e-02   +8.594294445773645e-02   +1.878547335593367e-01   +9.332224272479271e-02   +1.421972124572739e-01; +4.182695583247570e-01   +2.871550412955337e-01   +3.116584045314017e-01   -3.170548195657043e-02   +2.769291019397246e-02   -2.465251353071075e-01   +7.587321213247770e-02   -1.768747763933190e-01   +2.357842261680002e-02   -7.791581041023073e-02   -9.988068393264614e-02   -7.086563830172192e-02   -2.189336906198206e-02   -1.962574288743192e-01   +1.850057536230426e-02   -6.071194475678152e-02; -2.588418202283990e-01   -4.758516341161827e-02   +5.765750120708142e-02   +2.441235112911429e-01   -1.695000114969145e-01   -1.680000491934467e-01   +8.020907714691665e-02   -9.255333486905865e-02   +1.645083825453049e-01   +1.085775067537335e-01   -3.435789953865747e-01   +2.949806774144701e-01   -2.437124079173960e-01   -1.850634190983263e-01   +1.385564034051232e-01   +1.152955465665521e-01; -3.501817186568345e-01   +4.581987602568457e-02   +2.832356991127027e-01   +1.015399229445665e-01   -7.952291487211967e-02   +2.706972997440950e-01   -4.798612382908123e-02   +2.459661571089865e-01   +2.588579786952702e-02   +2.441200605819027e-01   -3.375205446492349e-03   -1.015616278519412e-01   +1.216382100028702e-01   +3.628180754112282e-01   +7.502299875869081e-02   +3.513801504261789e-03; +2.291518327212238e-01   -5.660027672246760e-03   +9.588239228821910e-02   -2.374647652001569e-01   +1.460504129156092e-01   +1.088659418728225e-01   -1.152294212605878e-01   +6.836744595305469e-02   +5.922180107107178e-02   -1.270953907842320e-01   +4.626603022522386e-01   +1.022090924557258e-01   +4.334139754529860e-02   -2.650333464450667e-01   +2.513365759088855e-01   -3.205034917455548e-01; +4.230354262779068e-03   +3.789523088389518e-01   +5.568383290786963e-02   +9.596169496062282e-02   +1.156196301165041e-02   -3.060531974765788e-01   +2.793235367200249e-02   -1.573405590396850e-01   -8.083947096019239e-02   +3.763685303805778e-01   +4.385927002428482e-02   -1.196772339819974e-01   +2.534076816628706e-01   +2.877536979297365e-01   -2.571609107014802e-01   -1.455755828696159e-01; +1.175630907654156e-01   -2.375013641391009e-01   +3.075692256083312e-01   +4.844960128717562e-02   -1.315984453366264e-01   -1.253131751618666e-02   +2.228150038868485e-01   +3.838380837910245e-01   +3.113529675864515e-02   -2.798654577788723e-02   +2.793162704825149e-01   -1.877196561003372e-01   +8.024314954547897e-02   +4.978011673466620e-02   +1.051629480749098e-01   +1.015491840937436e-01; -1.107621200300047e-01   -5.934292555227490e-02   +1.272881235845749e-01   -2.171952321208103e-02   +3.709369807597656e-01   +9.499663660414510e-02   +7.840722534490188e-02   +1.445275960826601e-02   -8.196914432904365e-03   -5.369679920778153e-02   +6.009022809851303e-02   +1.687660534905828e-01   -6.478497651530936e-02   -2.659388711650153e-01   -9.839346213374964e-02   -1.514012146375596e-01; -1.658671434302575e-01   +1.611921251962614e-02   +3.531148043269426e-01   -1.413847414522119e-01   -7.889967434028100e-02   +8.050833753372738e-02   -1.358955054128869e-01   +2.402300633084129e-01   +1.460324272656161e-01   +7.214841948155663e-02   -4.722811149971522e-02   -8.777205847366118e-04   +2.598586456556196e-03   +2.101215675414496e-01   +7.038266961942211e-02   +1.505454806458910e-01; +2.318900277453084e-01   +1.241280667947811e-02   +1.020861450762428e-01   +1.769838863762266e-01   -2.174510388987134e-01   -1.422501965459160e-01   -8.680704388626187e-02   +1.124666522308891e-01   -3.553142587514325e-01   -9.600660836457268e-02   -3.718175412082002e-01   +6.434884022040346e-02   +1.565618626021451e-01   -8.849829472209572e-02   -1.611379315995858e-01   +2.539894212609353e-01];
L1E_L1I_iGABA_netcon = [-3.061572378210611e-01   -2.453265765489547e-01   +1.067304850527334e-01   +3.088867587379551e-01   +1.479286402352082e-01   +2.268062051041263e-01   -2.256138510095704e-01   +4.289381549202276e-03   -2.870548321321476e-02   -1.203309962293221e-01   -1.368562264646753e-01   +1.188055153302403e-01   -4.157121997332375e-01   +8.687159692705911e-02   +4.470195239717159e-02   -6.561639972075223e-02; -3.935158280897949e-02   -1.141580681603072e-01   -4.628345890118247e-02   +2.075260447254131e-01   +2.248673588973414e-01   +6.196360391680278e-02   -1.953863037194385e-01   -1.347812975547992e-01   -3.271532173526832e-01   -1.398656599405210e-01   -1.677286924822281e-01   +1.794511903760084e-01   +4.148007365511559e-01   +9.926865576757124e-02   +6.398675736058929e-03   -2.295992940716712e-01; -8.924234901101828e-02   +1.179483912288783e-01   -2.126790000084988e-02   +3.949350833348575e-03   +9.920744783782875e-02   -2.912219033821719e-01   +1.598244754621352e-01   -2.212995856053487e-01   -5.057387020855053e-02   -1.183337456432681e-01   -6.700313488206094e-02   -1.946804088300161e-01   +3.441151963734512e-02   -1.887962205198640e-01   -6.039042293850187e-02   +8.044315061241171e-02; +1.497535456811829e-01   -1.328382533746765e-01   +3.168831587625486e-02   -1.678656105986046e-01   -8.647478822889293e-02   -4.736718764335159e-01   +6.356133436010522e-02   +2.491159833886586e-01   +1.238051328227248e-01   -1.504897469665144e-01   -3.752233625084594e-02   -4.995945021189430e-02   +1.407728496002293e-01   +9.346319787784021e-04   -3.670714929011670e-03   +2.263496378979038e-01; -2.101108153390580e-02   +1.784808680950392e-01   +1.498833622047578e-01   +9.086346458153402e-02   +5.885358017257941e-02   -1.602395509485967e-01   -2.354345149957449e-01   +1.270151866709633e-01   -2.372252768820108e-02   +3.446920450927423e-01   -1.092740767284411e-01   -7.060392091078849e-02   -5.244048908214591e-02   -9.636890586926739e-02   -3.364623983793756e-01   -4.002785186995274e-02; +2.271970851776961e-01   +8.874525283143372e-02   -1.220346898079321e-01   +1.353852688185842e-01   +1.743396672916350e-01   -1.942871003020260e-01   +3.895884999786707e-03   +5.092388111088272e-02   +3.272435031158817e-01   +2.903285500466571e-01   -2.369860809499844e-01   -8.544861955767827e-02   +1.627398641639939e-01   +3.323807610954641e-01   -4.326432884564076e-01   -4.099008144928544e-01; +4.841348391273384e-03   +2.144938208217176e-02   -8.946742874879515e-02   -2.835304074990774e-01   +5.619696013929787e-02   -3.222900088711944e-02   -1.035015976747084e-01   -3.327309633358509e-02   -8.781857674455368e-02   -9.468871695008958e-02   +3.544928210245045e-01   -3.054823633642030e-02   -7.997746614773656e-03   -1.109336221897797e-02   +1.821379460558814e-02   -1.536719672971964e-01; +3.068428797965796e-01   -5.760209947715827e-02   +5.944523575870156e-02   +1.976503512482001e-01   -1.963708731721753e-02   +1.370827702949439e-01   +1.515376540762712e-01   -2.625109094205363e-02   +2.145556086615180e-01   +3.881836466292153e-02   -5.068196166889435e-02   +5.378528305269913e-02   -9.033253608154565e-02   +4.318313200447708e-01   -3.148568324434728e-01   +8.040665050541969e-02; -4.192540233011861e-01   +2.785598651699013e-01   +2.368329714119611e-03   +3.155275525293335e-01   -6.279552908576647e-02   -5.345638742263940e-02   +1.604831758302848e-01   -4.209241928557388e-02   +2.318401057613166e-01   -1.079600207027615e-01   -6.458703884498898e-02   +9.985287981351415e-02   -1.728095360774128e-01   +4.215502925012954e-02   -1.350259680206893e-01   -2.801515859776817e-01; +2.181483657857292e-02   +4.575025105683821e-02   -2.413251137910409e-01   -2.655089658733410e-01   -1.289020584473033e-01   +3.731570506873113e-01   -3.141525098711597e-02   -1.074108503083361e-01   -6.910802375321284e-02   -9.951422137910157e-03   -2.094960051739279e-01   +6.096953806277075e-02   -3.767697905834900e-01   -3.134182330398985e-01   -6.833049812529907e-02   -1.360729598428678e-01; -3.320734001581638e-01   -6.643897425206789e-02   +1.421969113374240e-01   -2.613891068959746e-01   -4.707049294446221e-02   -2.526353929079226e-01   -7.115804752322492e-02   +2.358470526000664e-01   -5.648869322598023e-02   +1.156907751608192e-02   -6.440959870622009e-02   -1.208289134043586e-01   +4.296003405888275e-01   +8.466582752818041e-03   +2.785753705434311e-01   -2.560767445113410e-02; -2.532249754097656e-01   -4.529457810095802e-02   +2.362259003237558e-01   -3.095440216963269e-02   -1.912204073259239e-01   +9.170759749000952e-02   +2.416092699406342e-01   -2.128819236930972e-01   +6.383510183118782e-02   -8.294466494148320e-02   +4.543429649346096e-01   +2.690879738683927e-01   +1.274661345601839e-01   -4.243453397406136e-02   -6.003514854284017e-02   +4.744602666029011e-01; +2.218377937050613e-01   -4.217871478693230e-01   +2.667048289884393e-01   +3.663406147400891e-01   -2.313553140817609e-01   -1.525038367117071e-01   +8.439011842537630e-02   +2.403876188644195e-01   +1.246061789528130e-01   +2.110815058011441e-01   +1.568490809820283e-02   -1.140546063206597e-01   +1.405542816203649e-01   -1.158892914271229e-01   +1.781169215746197e-01   -1.067101859667241e-03; +1.547000474213389e-01   -2.667900278458288e-01   -6.263324917458885e-02   +1.745674414390484e-01   +1.359621776892556e-01   +2.425856330064101e-01   +1.347448578713372e-01   -5.113174814126933e-02   +1.489657380350809e-01   +8.993360471209071e-02   +2.031174780666270e-02   +1.767364824198798e-01   -1.185886878785840e-01   -8.225801855499194e-02   +3.411610859883978e-01   +1.862501896603690e-01; -3.098041139819897e-01   +2.006312737181745e-02   +4.146530177310962e-01   -1.763087839686514e-01   -2.085522048405762e-01   +1.522854301327431e-01   +3.739737938049812e-01   -1.996335385543428e-02   +3.319886002170275e-01   +5.977678978691858e-02   -8.904916270712177e-02   -3.156758910152285e-01   -3.130263302661507e-01   +1.210855580675707e-01   +1.333645354030081e-01   -2.396903850589563e-01; +8.287583514672345e-02   -1.045400248539687e-01   +8.951420000060797e-02   -2.502055920578937e-01   +1.451049038658287e-01   -1.110088548738193e-01   +2.334959706339866e-01   +2.963175056784459e-02   +1.518351853578207e-01   +1.211437443587070e-01   -2.697097062912689e-02   -7.009024224780923e-02   +1.832454261121432e-01   -2.095830307017202e-01   +3.231000466041861e-01   -1.834423800210707e-01];
L2I_L1I_iGABA_netcon = [+1.706327632514523e-01   +3.446583965453581e-01   +1.773328531252392e-01   -2.300847656263079e-01   +1.002380601555425e-01   -2.322686271508779e-01   -1.501670730921288e-01   +2.344223157934287e-01; -4.229921405244731e-02   -4.680290786776238e-01   +1.790382468648352e-01   +3.189551012541751e-01   -4.207220131051551e-01   +4.324037163812162e-02   +2.682305847961586e-01   -2.662967509286086e-02; -1.172055738873080e-01   +3.032793447683551e-01   +1.266522774727983e-01   -2.424280012199136e-02   +3.638797202161345e-01   -8.292015785424775e-02   +1.676736898719014e-01   +2.486387628398673e-01; -8.013353950754722e-02   -6.354201492219377e-02   -1.256849339900837e-01   -1.604367026235183e-01   +9.816193001147624e-03   +1.957162326364831e-01   -1.029947145491594e-01   -2.567411450140178e-01; -1.683410499895352e-01   +5.948130647070868e-02   -3.018373323767570e-01   +2.043234539447139e-01   +2.470322375315635e-01   -4.941208403572470e-02   -4.868763182808782e-02   -2.013897143933156e-03; -2.076370311316080e-01   -3.266183579625950e-01   +8.104554714871595e-02   -1.018733799593399e-01   +2.528179540634879e-01   +1.131578904518169e-01   -1.238611247886101e-01   +1.794783925867952e-01; -1.513284177370078e-01   +1.476044918548644e-01   +3.771699579719724e-01   -1.370767858724085e-01   -2.186390044438380e-01   +3.926744378960050e-02   +2.962053693288939e-02   +4.076763325126373e-02; +1.281820384547721e-02   -7.139703238887285e-02   -3.560507907107333e-02   -9.223693921739701e-02   +1.986446695840758e-01   -1.493925585795337e-01   +1.524348575058552e-01   -2.566071641129171e-01; +1.409242274950129e-01   -2.399201567364422e-02   -2.030115401523994e-01   -1.414730772371025e-01   +1.402867072114670e-01   -1.154445952625445e-01   +1.212777622998641e-01   +4.323382371478270e-01; -1.823145552106681e-01   +1.177787825950484e-01   -1.433222757283192e-02   +8.147098077238296e-02   -1.544759536195295e-01   +2.972832111310655e-02   -8.351525714614193e-03   -9.560153721701911e-02; +1.582750297070969e-01   -2.718774405042890e-01   +1.602004683650851e-01   -2.727274069469437e-01   +1.709775496720664e-02   +1.704795797405315e-02   +5.289293222187668e-03   +3.797396226834657e-03; +4.837312177152805e-02   +2.174706185690087e-01   +2.229697166416680e-01   +3.221213866719757e-01   -1.427124262509585e-01   -3.013979941472248e-01   -2.337823978688697e-01   -3.459817996737296e-01; +9.921732165460911e-02   +1.421257495163819e-01   +2.101974239174982e-01   +2.073251932814332e-01   +3.423397611875752e-01   -1.685522863035878e-01   -5.744065710783101e-02   +1.188878116604652e-02; -3.229561422153454e-02   -3.863191051855402e-02   -1.507324683233911e-01   -2.317320886327874e-01   +5.714674796591961e-02   -6.797141755108584e-02   -1.568128543528283e-01   +1.696032015282398e-01; +2.881326843915268e-02   -2.264670899435012e-01   -3.287246659442578e-03   -2.464066880684306e-01   -2.579908490548988e-01   -1.304728950606113e-02   -2.025680721092291e-01   +2.511618243003009e-01; +2.136248915545829e-01   +1.021453785497488e-01   +3.703783804831996e-01   -2.288477136417264e-01   -1.876453203945688e-02   +2.151955138664349e-01   -3.032088590628051e-02   +5.375398416790295e-02];
L1I_L2I_iGABA_netcon = [+1.015957787577656e-01   +2.174034008607045e-02   -1.655413568561559e-01   -2.073792391169152e-02   +5.511552923246060e-02   -1.543672855388835e-01   -2.533769585251452e-01   +1.338960825997331e-01   +1.136132805578243e-01   -1.804994901755949e-01   +3.042791370592437e-01   +3.530912411321967e-02   +2.969552485356557e-01   +2.711831190881129e-01   -1.019129354091828e-01   -3.176052256798559e-01; +2.218114469435245e-01   -1.588042562223428e-01   -1.566327458228443e-01   -4.591462519470854e-02   +3.365912697281120e-03   +1.719687225550043e-01   -1.775411075261424e-01   +1.988885517069233e-01   -1.638093218472296e-01   -2.437160125476104e-01   -2.812802111990885e-01   -2.031832556823296e-02   +1.713054701351264e-01   +1.620184641471423e-01   -2.556720222063310e-01   -8.377980613896463e-02; -2.401398090033630e-01   -3.754408045499674e-01   -1.703388480444102e-01   +4.618348055309508e-02   +3.460063464588805e-01   +9.184590594354142e-03   -7.663506148343224e-02   +3.370650710364297e-01   +1.734596639708109e-01   -4.926456745658864e-03   -1.171356394989337e-01   +1.651441118300855e-02   -1.760187374277462e-01   +1.827523210534210e-01   +2.822173199209184e-01   -2.393229062931611e-01; -1.849160446123163e-01   +2.345355990666459e-01   +1.382764987192021e-01   +1.741036339424045e-01   +1.282050634207242e-03   -2.387769563236925e-01   -7.139143293092633e-02   -6.399968157650980e-02   +2.553000546026608e-01   -2.465837334709436e-01   +2.804482408570309e-01   +6.204890602379394e-02   -5.056732076115299e-02   +2.449884961706506e-01   -2.091988799924734e-01   +5.000553816481967e-02; +1.297151577532877e-01   -9.511048781034386e-02   +2.788537790340970e-01   -3.429278665520678e-01   +1.603233523904605e-02   -2.180734655859585e-01   +1.442977430713565e-01   +1.904213007384739e-01   +2.714104260305931e-02   +1.870777063488647e-01   -1.064597689978482e-01   -1.158318155600850e-01   -1.166405937866205e-01   +1.536654429641061e-01   +3.244251630055949e-01   -4.974111125149933e-02; -2.038566897294423e-02   -1.097720920767164e-01   -1.117399347685227e-01   +3.021951014716664e-01   +9.359822391702957e-02   +4.990983454005543e-02   -1.222256207809653e-01   +2.710073907701587e-01   +2.204517088018271e-01   -2.928159722988082e-01   -7.669697266595324e-02   +6.397136467091982e-02   -1.149110856021222e-01   +2.450660836212025e-01   +8.303865078513934e-03   -1.896247343914901e-01; +1.409897373511371e-01   -1.005532450504113e-01   +8.903575374924333e-02   +1.983108364626649e-01   -3.158173742662103e-01   +1.864419454793582e-01   +2.245946124198809e-01   +1.812994257159072e-02   +4.230834940394021e-02   +1.023052719121424e-01   -1.337935680169225e-01   +1.106546169977843e-01   +1.792446423242991e-01   -3.327713948186074e-03   +1.322662529817564e-01   -1.044170276882092e-01; +1.388993629101701e-01   +1.361517287481961e-03   +1.291397177709943e-01   -2.599625732952686e-01   -1.511532370708337e-01   -2.544393933457059e-01   -1.480762475326702e-01   -7.886458281033587e-02   -4.356006550882027e-02   +1.351053718995351e-01   -5.955088692899011e-02   +1.267692415926490e-01   -2.432330064550917e-03   -2.752482439792926e-02   -3.270951695034271e-01   +2.695178809822300e-01];
L2E_L1E_iAMPA_netcon = [+2.815409435012403e-01   -6.911645979419827e-02   -2.268159838084340e-01   -1.657039838643104e-02   -2.138050518485024e-01   -2.362458804906313e-01   +1.023118885381989e-01   -3.881978886554319e-01; +2.371137629028269e-01   +1.740660326511390e-02   -1.570489672392459e-01   +2.415944374443335e-01   +5.116029541128958e-02   -1.527630145423268e-01   -1.970499645824032e-01   -2.175449604969555e-01; +1.880636637354205e-01   +3.562870514742943e-01   -3.133414348923407e-01   +1.312997170225556e-01   +9.764965218562935e-02   -1.952219807288625e-01   -3.982714412640901e-01   +1.223058294210662e-01; +3.497089164572586e-01   -9.041895934590398e-02   +2.061585742100055e-01   +4.164072257620093e-02   +2.750051980509333e-01   -2.053783664018426e-01   -2.556620178200182e-01   +2.417954145425475e-01; +2.079342230576347e-01   -3.912093105684268e-01   -7.055555291535930e-02   +1.601959032318374e-01   +2.362408485266780e-01   -2.672180424815802e-01   +4.397665841316455e-02   +9.705984518858818e-02; -1.182427842166221e-01   -2.431678987599707e-01   +1.744444269800078e-01   +3.456374996591657e-01   -8.793750442089324e-02   +1.708823779023026e-01   +2.898405258843380e-01   +1.269330339823813e-01; +1.072781078869808e-01   -2.161233413205295e-01   -8.153357353456761e-02   -2.271688721328817e-01   +4.339140908414253e-01   +3.286435978754780e-01   +9.258745705867112e-02   -1.635126324673421e-01; -1.110301227729420e-02   +2.873833679288781e-01   +2.576144872610088e-01   -2.399772814398953e-01   -5.715450138696117e-02   +8.658493469231138e-02   +2.208594955172036e-01   -1.040204521815822e-01; +3.006417041690798e-02   -1.472185143425159e-01   -2.050833586804202e-01   -1.592583901000882e-02   +2.198955829345747e-01   +1.242864910275184e-01   -1.476765433068220e-01   -3.844563917119435e-02; +9.494343155128360e-02   +3.306664859924671e-01   +5.713864962506648e-02   +2.978000190558298e-02   -3.474683880428124e-01   +4.724795063986438e-02   +8.492347723656787e-02   +8.063939091264405e-02; +1.504656372126859e-01   +2.997948843151602e-01   -1.376590858194112e-01   +1.962890942306164e-02   -2.579794490060539e-01   +1.945930901522972e-01   +4.051157460010225e-01   +2.268231457830988e-02; +1.413386152274726e-01   -2.461487459928535e-01   -2.596293440005844e-01   -3.985793365265803e-01   +9.804199453957305e-02   +3.066239020555696e-01   +2.968610070174462e-01   -6.409680718030178e-03; +1.117377819867601e-01   +2.622701323300585e-01   -1.807850264321398e-01   +1.162197774260110e-01   +3.676563008581465e-01   -1.059420119188898e-01   -1.017430513507049e-01   -1.975578987317484e-01; +1.503569244462995e-01   -3.210243343144119e-01   -2.648400122916605e-01   -2.455029151528218e-01   -2.936078448362641e-01   +1.477430726463567e-01   -1.195117931253095e-01   +1.692551096497376e-01; -9.933438090777562e-02   +2.311129218716455e-01   -3.151765953634320e-01   -9.914927523503338e-02   -2.913038477457407e-01   -2.977711859296460e-01   -2.202169998247643e-01   +4.194254995035743e-03; -1.512449615285025e-01   -1.469588301902136e-01   +4.987321415906466e-01   -1.279179786065935e-01   -2.102607395385492e-01   -8.292099061369580e-02   +1.784487384688294e-01   -2.296302100816113e-01];
L1E_L2E_iAMPA_netcon = [-1.232155125600904e-01   -1.360055552200775e-02   -3.979436009452336e-01   -2.118647845069363e-01   -2.385149772199762e-01   -3.060904180544696e-01   +2.231832448395385e-01   -3.055839596170189e-01   +1.467858388962574e-01   -1.022940152812036e-01   +1.412594279769469e-01   +3.348261346554023e-01   +1.175125641710141e-01   +4.929058287513416e-03   +1.097637032360941e-01   +1.790144811265484e-01; -7.258606341979570e-02   -3.093892241243681e-02   -1.607403282374539e-01   +1.329477151689367e-01   +1.916133555465408e-01   -1.024901463841411e-01   -7.445906037955284e-02   -1.171483989670955e-01   +1.521946526571385e-01   -2.671980626831002e-01   +9.603202236893016e-02   +4.124880989874712e-01   -4.014395070615712e-02   -8.880847941181050e-02   +1.701983893766413e-01   +4.735162007006538e-02; +1.686244803315635e-01   -1.581289447695481e-01   +8.298410104683415e-02   +1.771190995079465e-01   +2.114465040687569e-01   -1.093211965564593e-01   -2.045660059912508e-01   +2.415900893830036e-01   -7.232388067144636e-03   +1.345993835415587e-01   +1.493068946875620e-01   +1.205753351896124e-02   -5.009686700564482e-02   -1.319320991572767e-01   +1.662998601165090e-01   -4.225145026849356e-01; +2.576561045022218e-02   -1.658937259999627e-01   +1.122307566895096e-01   -2.645809312522320e-01   -2.117739061555876e-01   -9.772074866017322e-02   +1.476836164371869e-01   -1.550182244422875e-01   -2.314906994675637e-01   -3.680986399134381e-01   -1.987181860596849e-01   +2.698957480397391e-01   -1.103788686334535e-01   +3.174252389770747e-01   +1.972679680658857e-01   +5.047373823341803e-02; +1.987804620918761e-01   +1.866427982787466e-01   +3.673495691635006e-02   +3.221629028499208e-01   +2.542743700806495e-01   +1.939425406951170e-01   -1.661643641658735e-01   +2.851263312768558e-01   -1.133152404543977e-01   -1.571626205359198e-01   +3.392561617080675e-01   +3.000539697329330e-01   -7.948851537924352e-02   +2.532600715156035e-01   -7.936837549042772e-02   +3.132646687470615e-01; -4.402963678977820e-02   -2.270223555812546e-01   -1.496271918548896e-01   -1.819598976898539e-01   -2.019026079601418e-01   -1.814153732446297e-01   -4.757710342586086e-02   -1.600711329984541e-01   -1.073862447971260e-01   +2.424771644659147e-01   +4.987463866254419e-02   -1.186955962502611e-01   -7.214657488319069e-02   -5.661879487741693e-02   -1.737804000232215e-02   +1.691384866246624e-01; +3.702354864446455e-02   -2.398349370288994e-01   -1.650829393242476e-01   -4.008221926180933e-01   +2.920573519088256e-01   -4.584432251429549e-02   +1.382688022284385e-01   -3.475133679048962e-01   -1.628242397313012e-02   +2.180533250909961e-02   +1.907572270502811e-02   -1.055807937031516e-01   -1.421046684473625e-01   +1.945583987148466e-01   -7.276108408088400e-03   +2.424045473213086e-01; -2.891534094046123e-01   +3.305497475580707e-02   -1.329029345307225e-01   -1.805408882006098e-01   +2.666426078633966e-02   -2.166064819731962e-01   +1.191461559775730e-01   -1.011602750315867e-01   -1.762444108275474e-03   -1.613122684479412e-03   +1.377068496421712e-01   +5.106996520140661e-02   +1.964478969486977e-01   -3.944756002278278e-01   +4.060442314413836e-01   -2.913962916395204e-01];
L2I_L2E_iAMPA_netcon = [+8.708464173093886e-02   +2.566471988358821e-01   -1.411652631472956e-02   +1.186577228774396e-01   +1.033986606342851e-01   +1.167764226179194e-01   -3.368276898499439e-01   -3.772993620881369e-01; -1.200935237085976e-01   +2.674985867539195e-01   +5.355757546651860e-02   -1.377136253061008e-01   -1.838402491376127e-01   -1.457785713282808e-01   +3.065162624914041e-01   +3.812492645973984e-01; +3.478241064828058e-01   +2.294385077837929e-01   -3.739117399971615e-01   +8.029896520059979e-02   +3.544456772604854e-02   +1.363241744590009e-01   +4.657974856875816e-01   -5.626590691174325e-02; -3.200556785107482e-02   +1.343541073410769e-01   -3.160755640301277e-02   +2.036950214089784e-01   -1.970327738295841e-01   -8.530761919390858e-02   -2.091207786102851e-01   -1.100923774475197e-01; -2.808012639713393e-01   -2.213790396579221e-01   -3.821307702676112e-01   +6.624721202645487e-02   +2.453900119396007e-02   -1.239080012288313e-01   +3.399976438393474e-01   -9.513823961448231e-02; -2.090783084833747e-01   +5.863199547477088e-02   -3.586293163439722e-02   +2.072373860265320e-01   +1.666674072944198e-01   -1.876477194254298e-01   +2.087501412600314e-01   -2.933294786808841e-01; -1.245033092351734e-01   -1.234751879182838e-01   -4.948163299054791e-02   +2.037321800195860e-01   -1.258630625414530e-01   -1.565637250598414e-01   -5.104347296873854e-03   -7.959752851805751e-03; +4.911225178310379e-02   -2.495693158478723e-02   -5.832531577690592e-02   +3.440927970525001e-02   -1.329903455322662e-01   +1.858425289545821e-01   -1.174201697610647e-01   +2.764978136458275e-01];
L2E_L2I_iGABA_netcon = [+6.238343360912166e-02   -2.415494492650238e-01   -8.366907938993823e-02   +1.589599125360377e-01   +1.301955925231374e-01   -3.079672468993508e-02   +7.916479650056951e-02   -7.889331230775060e-02; -1.355953147074818e-01   +1.511705746525846e-01   +1.741212591207085e-01   +1.750220403460840e-01   +1.327856073528180e-01   -2.661862997210672e-02   -1.576156832316753e-01   -1.682804335227771e-01; -8.417433000264654e-02   +7.241742044127930e-02   -4.189133777907689e-02   +1.550614643581165e-01   -2.315262869218067e-01   -1.137415113120532e-01   -7.839770461035847e-02   -1.236313082981857e-02; -3.436558790059344e-01   +1.729112534368650e-01   -3.846541939132178e-01   -1.966610121243363e-02   +7.857793082496663e-02   +2.939108933599036e-02   -4.136821562003623e-01   +2.313695877187497e-01; +2.827779709605698e-01   +1.146853943109455e-01   +2.730497080760514e-01   -5.194867074297564e-02   -2.526521152917969e-01   +1.796106822673959e-01   +1.043279744891270e-01   +2.328624382813038e-01; +1.105815610368301e-01   -1.337897388822795e-01   -4.409646263424691e-02   +4.526461388574377e-03   +1.855230554466119e-01   +1.567988398261859e-01   +4.475052866170642e-01   +8.649965929490736e-02; -3.511577923309395e-01   -2.068388672902756e-01   -5.222891844548316e-02   -2.733197693124706e-01   +6.300927707899909e-02   +3.140921063008659e-02   +2.611455259106842e-01   -2.338193877153191e-01; -1.247445001557519e-01   +8.284993186549702e-02   +1.645207579847858e-01   +3.152246188613561e-01   -3.199501142264924e-01   +5.909096885389465e-02   +9.503309259471071e-02   -1.539063462072188e-01];
L3E_L2E_iAMPA_netcon = [+1.382074665777304e-01   +1.598638627910507e-01   +1.526145808088107e-01   +1.664577972047830e-01   -2.826524425531274e-01   -1.364693677436963e-01   -1.694219864919881e-01   +3.336694396311969e-01   -6.007577213550992e-02   -3.415517464569883e-01   +1.933755968007432e-01   -1.116333464225838e-01; +3.501982093060966e-01   +1.182607895403271e-01   -5.239715591102712e-02   +8.065247011960311e-02   -2.296250529387906e-01   +8.657490573873844e-02   +2.916110561359722e-03   +9.679785485703063e-02   -7.588206710637659e-02   +1.551511297836840e-01   +1.255145082040372e-02   +1.782597768507125e-01; -1.746976920513742e-01   -6.546881522206041e-02   +1.788526050910172e-01   +4.852420688905986e-01   +2.112912221566406e-01   -2.138061069224745e-01   +1.109158593974417e-01   -1.000712679878215e-01   -3.719212162045517e-01   +3.303938355301825e-01   +7.396180779122442e-02   -6.903039608880933e-02; +1.003733854595876e-02   +8.592748696552927e-02   -3.534818606126885e-01   +8.058679244395758e-02   +6.439681930702952e-02   -2.586119243284170e-01   +1.615816737353512e-01   -3.224434018925527e-01   -2.038736697258006e-02   -1.493559179857972e-01   -1.893676705343461e-01   -1.355048700662492e-01; +4.033208863273766e-02   +3.984710858643494e-01   -2.478336770301112e-01   -6.749187007062173e-02   +5.677106741487208e-02   -2.432516387079714e-01   +6.237627161761887e-02   -1.919552615484353e-01   -1.138653410319496e-02   +6.750014017585998e-02   +2.490806792459146e-01   +2.834547017578684e-01; +1.287357819030126e-02   +1.845085700995386e-01   +4.158225841834032e-02   -6.989792019372509e-02   +2.780798421766285e-01   +8.786742377792801e-02   -3.051264206008977e-01   -7.074056103959614e-02   +6.600070960303753e-02   -1.440736899796742e-01   +1.393153870959939e-01   -1.204155818085625e-01; +7.984016212776587e-02   -1.246789015340968e-01   -5.064438119832715e-02   +2.091537880611132e-01   -1.396247309076912e-02   +3.175994288572020e-02   -2.744705506228386e-02   -7.386165160985853e-02   +8.403250534404735e-02   -2.981174167339417e-01   +6.267322980755977e-02   -8.536784159643815e-02; -1.153470489215241e-01   +6.958373931931205e-02   -1.889027098569590e-01   -2.752302467018449e-01   +9.810161701795478e-02   -3.760379874562773e-01   -1.556431199410608e-01   -2.579159640786305e-02   +8.933384701479834e-02   +2.495123985285544e-01   -2.906799406829752e-01   +4.481720750904020e-02];
L3I_L2I_iGABA_netcon = [+1.351713855379911e-01   -4.064264288406567e-02   +9.799094384087310e-02   -2.226376102554314e-01   -1.813797650831070e-01   +2.735635317054489e-01   +2.753282304435026e-01   +8.783498597397896e-02   -9.466910200480511e-02   -6.480431764882638e-02   +3.304487611809270e-01   -8.834408300455923e-02; -3.111712978541534e-02   -3.367434387221286e-01   -5.421802890081094e-02   -1.056935614490782e-01   -3.030914905444324e-01   +8.964304342105978e-02   -2.018269717850201e-01   -2.076741380494107e-01   -1.683458010266935e-01   +2.157733890649436e-01   -2.469928214662384e-01   +3.944835009507068e-01; +5.593274267899351e-04   -2.047997393475259e-01   +2.893777553910782e-01   +5.816643965206689e-02   +7.860821507911772e-03   +1.696318101109986e-01   +7.768250196010301e-02   -1.380436906320658e-01   +2.790303978987094e-01   -2.971809964539903e-01   +6.361211424344472e-02   +2.362478767710250e-01; +2.816094034933523e-01   -1.275896873512871e-01   -1.182537503623297e-01   -1.922037924128563e-01   +1.223033119004115e-01   +2.260864286913334e-01   -4.460054278717823e-01   +1.663411347069080e-01   -1.749258199448890e-01   +7.234565707789571e-02   +7.647742330963447e-02   -2.829949542516966e-01; +9.748462137067190e-02   -2.550324533332704e-01   -1.860374587616389e-01   -1.355090924195796e-01   +2.467523898865204e-02   +2.665359855415542e-02   +1.987208231221053e-01   +2.350781795668937e-01   +1.499192865906835e-01   -1.362224928825428e-01   -1.490629175244505e-01   +2.629302614073779e-01; -2.178121186472950e-01   -4.350494997009678e-01   -2.475061398250442e-01   -1.405229552782414e-03   -3.387005577557498e-01   -1.319803143891717e-01   -1.511243419587538e-01   +3.237481310510249e-01   -3.704363573829663e-01   -8.740122180689872e-02   -3.464289030579333e-01   -1.456574466205702e-02; +1.073275554222828e-01   +2.318252530487566e-01   -4.247314388463256e-02   +1.469558776715522e-01   -4.609732688781200e-02   -3.332728416148010e-02   -1.550832372309067e-01   -6.086095957997269e-02   +1.334966154122028e-02   +3.637619597090073e-01   -2.618251902409377e-02   -7.868407383874140e-02; -7.696553616523548e-02   +2.951740684696615e-01   -3.071430180995108e-02   -2.693256308440782e-01   -3.504034818600874e-01   +3.390094266354583e-02   +2.369941634358069e-01   -2.167134633897513e-02   -2.062401356527385e-01   +7.008682313810372e-02   -1.401121897882186e-01   +1.103571602373594e-01];
L2E_L3E_iAMPA_netcon = [+3.636772448171224e-02   +1.706147757905259e-02   -1.017366574140889e-01   +2.053322707246580e-01   -1.106334181105314e-01   +4.705088503370727e-01   -1.464575400350549e-01   -8.208477306652265e-03; +2.092443245874625e-01   +7.878173114203549e-02   -2.606095242280281e-01   -3.511993076945790e-01   -2.445755314704524e-01   -8.387723163302377e-02   +1.848844992741654e-02   +2.985610874634373e-01; +2.470460104454396e-01   -2.369000090113799e-02   -1.972694155703057e-01   -2.859846546471665e-01   -5.378211565644822e-02   -3.602147105652087e-01   -2.704890929921446e-01   +1.357295186188526e-01; -3.801844444342755e-01   -1.107245326125852e-01   -2.223318378190633e-03   +4.263286790329542e-02   +8.338832020371881e-02   -1.439194681669500e-02   -1.575227352223103e-01   +2.563106856522418e-01; -4.903329780695943e-03   -1.337036085973165e-01   +3.064662866697308e-02   +1.403652114094107e-01   -3.329655329359187e-02   +1.770445790479523e-01   +6.536477450200032e-02   +2.547766821239477e-01; -4.270758656370372e-01   +1.363381340844811e-01   +1.026469305741876e-01   -5.189234700377569e-03   +2.589287686807401e-01   +5.256582680590485e-02   -8.906803585738084e-02   -3.140111166133379e-01; -1.745393841053979e-01   +1.016673732471928e-01   -5.236789948329949e-02   +2.764523439654826e-01   +2.594736621304283e-01   -6.154421283750505e-02   +4.022618476898361e-01   -4.143355081969665e-01; +4.543426022196688e-01   -2.560382905357730e-01   -6.253092824009214e-02   -8.777452109691308e-02   +1.894800638570025e-01   -6.059237430300783e-03   +2.239174162291461e-01   +2.280455950388260e-01; +4.269963168252217e-01   +8.140207012159269e-02   -2.019387582023194e-01   +1.241537275508148e-01   +5.035545339325352e-01   +1.095822313559866e-01   +2.031916130556620e-01   -2.314688522262225e-01; -1.934792838951792e-01   +1.579260758536425e-01   -5.478812328825740e-02   +3.767738851712027e-01   +1.128856299090360e-01   -8.188560567360226e-02   -3.346517136136203e-02   +7.629332084096774e-02; -2.415857388560606e-01   -2.180811620646493e-01   -4.199565679123436e-01   +6.980263832802883e-03   -1.224215491068825e-02   -1.286423773648280e-01   -8.686371306051531e-02   -2.541755589298507e-02; -1.292910785513393e-01   -1.159685799052847e-01   -4.224367668412592e-02   +1.714973780459728e-01   -8.421449488846687e-02   +1.148888169637386e-01   -2.483352528681571e-01   +4.507092671546241e-01];
L2I_L3I_iGABA_netcon = [-1.675925057768628e-01   +1.850638891812995e-01   +1.682973120842350e-01   +2.016716381500496e-01   +3.751247483854245e-01   -1.035035515020366e-01   -3.043648860876352e-01   +6.050435592089606e-02; -3.472649313553920e-01   -5.235409520622583e-02   -1.690151473022784e-01   +1.203989972820909e-01   -1.724885060197218e-01   -6.424591086196858e-02   -2.578879639920548e-01   -4.158784903003230e-01; -9.449106760276740e-02   -6.031370921646574e-02   -3.308695418142417e-02   +4.861669921299319e-02   +2.555008076912155e-01   +2.778908913429830e-01   +2.667494010903166e-01   +1.180569298096831e-01; +1.256451110159338e-01   -5.459189981305999e-02   -1.166817919204598e-01   -7.750139856249752e-02   -1.265621282597117e-02   +1.804547926139928e-02   -2.364141225100487e-01   +1.575541916340100e-01; -2.242064855627603e-01   -1.292798132641433e-01   +1.016497490343705e-01   -7.198579586583428e-02   -4.588414646490371e-02   +2.903007859814357e-01   -9.366791464103437e-02   -9.789860300875401e-02; +2.452342470338095e-01   +2.727088426911551e-01   +1.300737572527604e-02   +5.582893303088915e-02   +7.140688423582375e-02   -2.822919059424747e-01   +8.694662659104707e-03   -3.136971824872461e-01; -1.604101480974542e-01   +2.243653484607663e-01   +1.560132876771117e-02   +1.172803946022856e-01   +8.728722919104911e-02   +2.025230747886727e-01   -2.799270177118141e-01   +6.556535537577610e-02; +2.255265629046302e-01   +3.392962501492635e-01   -2.356798066429378e-01   +2.735846964241048e-01   +9.679769721356601e-02   +3.256114438508751e-01   +2.127283711804444e-01   -9.585170711778519e-02; -4.931704884254377e-02   -1.938560962517828e-01   -3.611599934143305e-01   +2.663298895446803e-01   -3.166872156245257e-01   -2.006759160344906e-02   +7.614212960340819e-02   +3.919205339480350e-02; +2.730029813122062e-01   +6.201949801137077e-02   +2.293939956326757e-01   +1.576801506311762e-01   +1.134906871007592e-02   -2.469545171833205e-02   +2.464256832271152e-01   -8.045867599035650e-02; +1.701640666040735e-01   -3.655170417619273e-02   -7.639235518983391e-02   +1.145848234963611e-01   -1.390951714843953e-01   +3.018506149464800e-01   +4.026174714504784e-01   +3.186367873716218e-01; +5.095276672408011e-02   -1.908562887737818e-01   +8.218442595632379e-02   -3.615387434308448e-01   +4.508727154817692e-02   +8.545759034995101e-02   +2.291040308946668e-01   -2.196593616682159e-01];
L3I_L3E_iAMPA_netcon = [+1.593216307354648e-01   +2.121626367120014e-01   +8.110391026436645e-02   +3.761060739164251e-01   -1.626107783293482e-01   +6.425997736913402e-02   -2.097679211987774e-01   +9.986560105045164e-02   -1.224485470599649e-01   +1.218868868210990e-01   -1.416378333292261e-01   -1.456847029608853e-01; -1.498032470814690e-01   -3.204926651204273e-01   +7.034726793785970e-02   +2.500604325228727e-02   -6.985389390115870e-02   +1.666244910434891e-01   -1.818379085988267e-02   -8.228964641664853e-02   -1.399184871846388e-01   -4.538570251532689e-02   +4.105037367379080e-01   +1.920997271796314e-01; -4.284381943083801e-02   -1.169259257539832e-01   +2.250540444434552e-01   -8.109170861351545e-02   +2.908627110070526e-01   -4.210573847079731e-02   +2.382888152014198e-01   +2.080203629311448e-01   -1.960850989855099e-01   -1.242385761985384e-01   +2.136178540457766e-02   -9.839438788573179e-02; +1.561176042524399e-01   +1.543199900070350e-01   +1.993583184551787e-02   -3.078807652812137e-01   -1.947532895469331e-01   -2.532573827632787e-01   -2.959427114192003e-01   +2.583303778586894e-01   -6.459170967462274e-02   -2.889957789950504e-01   -9.742995396078517e-02   -5.500056529000596e-03; -1.242853431516591e-01   -2.256703919307569e-02   -1.749969691776695e-01   +3.501478753541690e-02   +1.820940669718676e-01   -2.325306587042896e-01   +6.917867788662586e-02   -1.013518606889750e-01   +2.170649796805271e-01   -4.365666904941072e-02   -4.890002866908628e-01   +3.828252373776156e-02; -4.721450157269947e-02   -6.981335205841016e-02   -1.093996369763642e-01   -5.678735070569697e-02   -9.478325854186301e-02   +4.079637607264184e-01   +2.011103675099500e-01   -1.164427181840615e-01   -7.285170648643693e-02   -2.466543668514115e-01   -1.200004409090385e-01   +6.473767269528627e-02; -1.384906277862745e-01   +1.967005776400644e-01   +3.046931181220249e-01   -1.066162556733194e-01   +1.157550904703325e-01   +1.437476449865131e-01   +1.166426815511444e-02   +1.425291301037690e-01   +2.305687089255354e-01   -3.578752329744219e-01   -4.433623012820492e-02   -4.547332262190028e-01; -7.134375442334130e-02   -2.164728373161294e-01   +2.958361779719371e-01   +2.899144505934381e-01   +1.095447108424547e-01   -1.951812054489200e-02   -2.667550452670036e-01   +2.555361004119705e-02   +9.378071721832043e-02   -6.680734014403411e-02   -2.541555862606930e-01   -1.507384100608249e-01; -4.498550439992050e-02   -2.900490468006649e-01   +1.171402856131298e-01   +1.741809646105772e-01   -1.690868637703817e-01   -1.772136569206603e-01   -6.768543048684983e-02   -8.788327209704777e-02   +1.018611333933838e-01   -5.746203811136688e-02   -1.731721815798005e-01   -1.601006475316604e-01; +2.084235507094941e-01   -1.489004635520891e-02   +2.171245509433821e-01   +1.422098701863967e-01   +1.696317618254775e-01   +9.722264004705453e-03   -2.734988370644512e-01   +9.726646988410903e-02   -2.492514355798903e-01   -7.176498957894156e-02   -8.350585809099031e-03   +3.026245456664303e-01; +1.962971974397028e-01   -1.063394434778100e-01   -2.991753602605882e-01   -1.432219011443164e-03   -7.778160526484545e-02   +2.378002971158522e-02   +2.578980491765720e-01   +9.854812332191598e-03   -2.021849402963730e-01   +2.338687762273723e-01   -7.848155022530401e-02   -1.606273170423145e-01; +1.369084872006850e-01   +1.410993749031416e-01   -1.245186482515854e-01   +4.544611014556414e-01   -2.767187640485794e-01   +1.819202416787076e-01   +1.573560583084172e-01   -8.358735797495911e-02   +1.615949292801451e-01   -2.528491583639438e-01   +2.322078924377010e-01   -2.145334794231774e-01];
L3E_L3I_iGABA_netcon = [+2.195355482318256e-01   -2.362571319617438e-01   +2.223700540561705e-01   -2.649268714507411e-02   -8.412681186727518e-02   -1.825841363229573e-01   -3.343695838639762e-02   -3.649392252415126e-01   +3.660313804695959e-02   +1.163703489567644e-02   +2.315961121358057e-02   +2.610558043419638e-02; -3.527268834591178e-01   -2.608097669558457e-01   +2.142574049997968e-01   +6.367535402500980e-02   -2.403032392215103e-01   +1.696076110024019e-01   -8.284145746386196e-02   +1.386218970387191e-01   -1.409113435476488e-01   -3.084567468279520e-01   +3.991349566150972e-01   -6.744207494905174e-03; -1.732203607357928e-01   -1.796574466317175e-01   +1.882249247426701e-01   -2.720478004258313e-01   +1.641466074595285e-01   +4.467323332589823e-01   -1.600984795224931e-01   +5.830299011994181e-02   +8.288831192143548e-03   +1.028114986207275e-01   +2.267300153581056e-01   +2.889693122887624e-02; +2.345924900936405e-01   +5.606188312258670e-02   +2.827183205446899e-01   +8.448333764362712e-02   -1.294896656893154e-02   -2.330453812758638e-01   +2.055185762884345e-01   +1.968072723529563e-01   -1.325213835567332e-01   +2.862153247080575e-02   +1.355895371774270e-02   -1.475461224445967e-01; -3.667448552295308e-02   -5.781033092360191e-02   -1.310714756789328e-01   -1.497756812908088e-01   -5.736711182901130e-03   +7.602135339591801e-02   -3.214137827187153e-01   +1.274358597065628e-01   +1.258828389956529e-01   -1.312595548379773e-02   +3.960771714661527e-01   +1.885385170085210e-01; +1.040702536222548e-01   -3.071169197001972e-02   -8.595773259216380e-02   +4.176516377164627e-02   +6.087920219390983e-02   +1.339020970198971e-01   +6.918363584394777e-02   +2.945464241103167e-01   -3.077598421477967e-02   +1.832701544726207e-01   +2.020312556247470e-01   +1.293335632280836e-01; +3.168144252699729e-01   -1.753551201433824e-01   +4.201407423864371e-01   -7.282243429424709e-02   +6.032080750197510e-03   -3.861411781191477e-01   -2.323148554154149e-02   -1.053881925348793e-01   -3.561003095955820e-01   -2.774558015874081e-01   -1.117495269999313e-01   +5.800051568153707e-02; -1.058764223969814e-01   -1.747495676750230e-01   -1.408390855005157e-02   -9.067150062705823e-02   -1.210959948044437e-01   +1.515454206667371e-01   -1.016820581989719e-01   +3.278625229926106e-01   +3.539729619688139e-03   -2.627375909201269e-01   +9.706657156640990e-02   -2.473697949839854e-01; +4.412266755827865e-02   -1.212068982563159e-01   -1.807484772684664e-01   -1.400022917427755e-01   +1.068326238266233e-01   -4.407689654564217e-02   +1.999933047929004e-01   -1.910179043837034e-01   -1.298248566895140e-01   +1.301231083597341e-01   -2.603690502328524e-01   -1.271536769296168e-01; +2.057172695014182e-01   -4.872915043929520e-02   +2.628259206260968e-01   +2.254596773314960e-01   -2.835162487724378e-01   -3.284088934266771e-01   -1.725533538243667e-01   +2.167764274073231e-01   +4.434835233273932e-02   +1.139325869890709e-01   -6.223580032379417e-02   +1.584154126069942e-01; +1.477848675373646e-01   -1.648428835589077e-01   -2.493936269714253e-01   -2.145093715022724e-01   +5.083946615950187e-02   -3.603219572474587e-01   +3.391550161528351e-01   -2.941739225384965e-01   +6.759669431793591e-02   +4.934215338797152e-02   +1.372252579683369e-01   -5.632640698652266e-02; +3.364693438318739e-02   -1.805237294729892e-02   -1.230636831500667e-01   -1.117250457198801e-01   +3.454576272923676e-03   +3.677855719399649e-01   -3.189999794331150e-01   -2.464925069049251e-02   +3.821839604438935e-01   -3.746078674078901e-01   +2.714625632246573e-01   +2.791489494158558e-01];
L2E_Input1_iAMPA_netcon = [+1.834494573629076e-01   +2.550787725919387e-01   +9.891611719264362e-02   +9.946907653985777e-02   -2.135485851556670e-01   +3.628290801262156e-01   -1.303049243229489e-01   +1.468070690491711e-01];
L2I_Input2_iAMPA_netcon = [+4.717494023288391e-02   -4.214387336628073e-02   -2.954379672751875e-01   -1.096551435262576e-01   +2.154457645565104e-01   +1.988862998724344e-01   -4.783104534239641e-01   +2.976195652590984e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
