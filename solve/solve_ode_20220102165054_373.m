function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.226281224627900e-03   +1.329728931186014e-01   +2.333783317608520e-01   +1.782911421631604e-01   +1.583096395459939e-01   +2.484684179563666e-01   +1.273088870589552e-01   +4.986776279567613e-02   +4.838363044681316e-02   +1.151643210782573e-01   +1.511758489799334e-01   +5.339061584892935e-02   +1.052611597816557e-01   +1.727761347375749e-01   +1.127965623031125e-01   +1.949217539871495e-02; +9.688669776760137e-02   +1.060363716298923e-03   +1.365749023504761e-01   +1.603365393394089e-01   +7.210784730816362e-02   +8.167061612619603e-02   +2.338487998161534e-01   +2.524686719818098e-01   +1.735072435315071e-01   +5.027978070829858e-02   +2.563300963635770e-01   +5.487832006530968e-02   +5.200482355513045e-02   +4.377188976575911e-03   +1.379045040883729e-01   +7.374821426169815e-03; +1.736669742911431e-01   +1.813459659886576e-01   +2.159919061590157e-01   +1.187001099792227e-01   +2.466515892211212e-02   +2.163556687568487e-01   +2.269820563336528e-01   +1.096303126638090e-01   +1.207259091542929e-01   +1.066987062173571e-01   +1.192778488071862e-01   +3.932279585617864e-02   +1.591983480679557e-02   +3.579787340733859e-02   +2.100947563311313e-01   +1.512720238580766e-01; -1.520137026807044e-03   +7.868527030535810e-03   +1.195702785011979e-01   +1.622246638679073e-01   +5.563565344715406e-02   +2.018101246945651e-01   +1.150048339062831e-01   +2.465175926363957e-01   +1.239086157631017e-01   +7.727788922734176e-02   +2.280888211455533e-01   +2.259642618017036e-01   +3.175490589732367e-02   +2.355953509609512e-01   +5.518853033933048e-02   +7.646191298607635e-02; +1.192026205635089e-01   +1.661391971190578e-01   +1.605856239915084e-01   +1.822247074035804e-01   +9.725217623199267e-02   +2.147345229944868e-01   +1.273660921603915e-01   +6.697667547766724e-02   +1.426401372379283e-01   +2.173262303848923e-01   +9.538426578307702e-02   +1.744262799874969e-01   +6.511946733419489e-02   +8.634589149564188e-02   +2.295312221672260e-01   +4.054180240977690e-02; +1.244070006213806e-01   +3.860547528408382e-02   +2.136052870656904e-01   +4.520163466438680e-02   +1.627845482679875e-01   +8.201474359384599e-02   +1.113465732263679e-01   +5.133847611078398e-02   +1.219780356731742e-01   +1.240320588357255e-01   +1.884464953994776e-01   +6.611919080094834e-02   +1.235025531796058e-01   +1.386299181607026e-01   +1.184340978210599e-01   +1.852208614580161e-01; +8.165338294543106e-02   +1.687546088308615e-01   +2.375037730648396e-01   +1.658991905256093e-01   +1.014753711139655e-01   +1.541035561336062e-01   +9.650715124594951e-02   +2.114624456448512e-01   +2.470688323328557e-01   +9.969582630216359e-02   +3.949008868707114e-02   +4.436969205810617e-02   +1.116627550021136e-01   +2.433388544009378e-01   +1.017547249528013e-02   +6.228398294397204e-02; +1.454387172324631e-01   +9.038024711242090e-02   +1.938070370513925e-01   +1.571069986312930e-01   +1.522879380702254e-01   +3.679129447095887e-02   +1.692920222954859e-02   +1.150089765699968e-01   +1.970306853673864e-01   +1.697018574243208e-01   +7.135959695369015e-02   +1.933549732947108e-01   +7.542780759089777e-02   +2.850130692467183e-02   +1.818710949839283e-01   +1.537819766168620e-01; +5.779212782249873e-03   +1.704834655029544e-01   +1.728532402458709e-01   +1.743736660210846e-01   +2.579263644130327e-02   +2.264316282127175e-01   +1.138338471583591e-01   +1.147144737126390e-01   +1.238799153361133e-01   +1.234931316356972e-01   +4.365846889225301e-02   +2.298384163118367e-01   +3.286621854092950e-03   +1.948819442701193e-01   +9.479360106206093e-02   +1.289595170532488e-01; +1.817568446496125e-01   +3.081852341688749e-02   +2.257698175266403e-01   +2.078380544176993e-01   +1.558396933625799e-01   +4.696479304559475e-02   +2.438658865376970e-02   +1.061165346349234e-02   +1.906739719071803e-01   +1.011702073095334e-01   +2.494484912652296e-02   +1.417903160044705e-01   +2.126404133358694e-01   +6.376031187503302e-02   +2.224161019126133e-01   +1.642354006404792e-01; +1.010027471829743e-01   +1.254296778595650e-01   +1.258532626702883e-01   +2.028477083424897e-01   +2.228481909920901e-01   +5.150212326184462e-02   +1.623305895900392e-01   +1.473590975341565e-01   +5.829998015354573e-02   +7.153607978868069e-02   +1.887904954249025e-01   +2.424697057794766e-01   +3.402994701160351e-02   +1.809328877737707e-01   +1.933784891841958e-01   +5.058649332750804e-02; +1.325743653935809e-01   +7.553612208863848e-02   +2.613747560858484e-02   +1.755807938573629e-03   +2.463402498085714e-01   +2.318487738002086e-01   +1.301054794699842e-02   +1.746149048298516e-01   +1.777906720853937e-01   +7.713212064502574e-02   +2.981683726049540e-02   +2.624048492313323e-03   +2.369374555091510e-01   +1.814467308345686e-02   +1.380079524847619e-01   +1.042005722056886e-01; +1.630681480622488e-01   +1.894117704661175e-01   +2.230667273542137e-01   +3.758541826614882e-02   +1.651829364401508e-01   +1.790520603351834e-01   +1.775378063467234e-01   +1.655182396365927e-01   +2.295681821680291e-01   +1.107666062507855e-01   +1.055561208376054e-01   +2.219038347263028e-01   +2.099549539673914e-01   +1.843679064614134e-01   +1.159287221095321e-01   +2.269694813934332e-01; +2.162526461692837e-01   +1.670921107502523e-01   +8.106718400387923e-02   +1.547295269293404e-01   +2.722978042289795e-02   +6.143674580279214e-02   +1.536062180125759e-02   +6.006727026482020e-02   +8.692264204088004e-02   +1.832811216774565e-01   +5.217823386514395e-02   +2.055163457447381e-01   +1.446986919251922e-01   +1.583995774963200e-01   +1.028164273725007e-01   +8.382657360717209e-02; +1.129973705833976e-02   +1.379493484499791e-01   +2.184580606739956e-01   +1.326503909725177e-01   +7.308514996446634e-02   +4.894921084948433e-02   +7.092651228907734e-02   +1.000226454856866e-01   +5.983818823691725e-02   +2.540213312692661e-01   +8.797201993399179e-02   +1.268419493492969e-02   +4.621909194024516e-02   +1.873926926553640e-01   +6.001426961371952e-03   +1.747288944558035e-01; +2.012830385379283e-01   +9.544928199575524e-02   +5.047693886040037e-02   +2.439049488177793e-01   +3.076804845508729e-02   +3.855850998218638e-02   +2.233727273250074e-01   +3.808452587475090e-02   +1.540234783012450e-01   +1.944097335433402e-01   +1.663846286267684e-01   +3.912160334054403e-02   +1.888302672720905e-01   +2.002419126014856e-01   +2.382975394912774e-01   +2.238748078281225e-01];
L1E_L1I_iGABA_netcon = [+1.294103531708375e-01   +1.630537490955752e-01   +1.368109421117088e-02   +8.203566679105426e-02   +2.128639921622146e-01   +9.641850393844584e-02   +9.502356749681180e-02   +5.884944017046936e-02   +2.333432664216488e-02   +9.267196167800396e-02   +9.302847668843131e-02   +1.508071480797500e-01   +7.963192401451312e-02   +2.303844563431865e-01   +5.658274132581922e-02   +1.263159102549964e-01; +3.354478665038003e-02   +2.311897828145915e-01   +1.245594467521080e-01   +2.241614741053777e-01   +1.137466627827359e-01   +1.067252528432675e-01   +4.133938282127470e-02   +1.252615911772486e-01   +1.246742315994247e-01   +3.746223480320719e-02   +5.084717777353457e-02   +1.837355154011938e-01   +1.275168137037316e-01   +1.861408396027690e-01   +1.249084749479119e-01   +1.834019208279636e-01; +1.600197708773554e-01   +2.587216569570122e-01   +2.002446124875757e-01   +1.655069670080921e-01   +2.319844339971003e-02   +1.480947418217006e-01   +1.674609024851156e-01   +2.186749000351175e-01   +2.208879590380588e-01   +2.393757559751123e-01   +1.696576407275814e-01   +1.327516645627010e-01   +2.487584095018282e-01   +2.125082965758216e-01   +1.084273497067340e-01   +1.457529140853335e-01; +1.540866269266681e-02   +3.817444269728889e-02   +2.304427871383763e-01   +1.403204914104817e-02   +4.268740324726968e-02   +1.825243217945463e-01   +1.854886881249757e-01   +1.441263832229642e-01   +1.327146535943267e-01   +2.450180136201980e-01   +1.641222689020680e-01   +1.890559411159250e-02   +9.376225112768316e-02   +4.888296695799233e-02   +2.711794510865117e-02   +2.466142072631382e-01; +3.854626352872899e-03   +2.229008113791903e-01   +1.308990683342007e-01   +2.700802252451533e-02   +1.019439705077830e-01   +2.147999823803214e-01   +1.816361601310442e-01   +1.022861242717280e-01   +2.817431253415007e-04   +4.399230183461932e-02   +1.802747862165820e-01   +2.756752126212752e-02   +2.108907871109301e-01   +1.175426958459142e-01   +1.648097746547453e-01   +1.395505367387938e-01; +1.969980712395898e-01   +2.355516255200127e-01   +3.454923799738661e-02   +1.717070452155987e-01   +9.138633369161778e-02   -1.676563712999461e-03   +1.768073123531255e-01   +7.456988305263228e-02   +2.120705696683995e-01   +3.966944779986853e-02   +2.427216205261281e-01   +3.630132546722182e-02   +9.309570343870624e-02   +3.562352179987230e-02   +1.351553340869792e-01   +3.594924175434293e-02; +1.277704390431062e-01   +5.278194639782404e-02   +3.753369983899901e-02   +6.336086188475269e-02   +4.973503437757869e-02   +9.467609567502107e-02   +7.629969777399233e-02   +1.361976141231569e-01   +2.214154241426744e-01   +4.004860545301150e-02   +1.944232477614249e-01   +2.536531572828352e-01   +2.558446414331405e-01   +1.267128733972823e-01   +1.312672358462025e-01   +7.330028114700073e-02; +7.570549126102628e-02   +5.532449487656799e-02   +2.043795199177559e-03   +3.832854388549325e-02   +1.834327851517173e-01   +1.301805622251482e-01   +1.242960388613416e-01   +1.575405665596155e-01   +5.313593117148337e-02   +1.081623398880665e-01   +2.138828772554741e-01   +2.399247895539947e-01   +1.334421289378895e-01   +1.208602838400971e-01   +4.655566555301069e-02   +1.808931367285186e-01; +7.307962658367556e-02   +1.563123724567026e-01   +7.635022045250459e-02   +5.530637318321548e-03   +4.298863939539130e-02   +1.771773440922009e-01   +2.068870659768299e-01   +2.254759202897912e-01   +9.370722960707144e-02   +2.839908817052557e-02   +1.902633792556265e-01   +8.818281516438610e-02   +2.230870725687541e-01   +2.405456810366072e-01   +1.543322264241543e-01   +1.822684471030878e-02; +1.155153314991967e-02   +1.028505918318809e-01   +4.017957268463715e-02   +1.429152602170657e-01   +9.650935770450868e-02   +2.140670345001161e-01   +7.911137752330268e-02   +5.492829488892829e-02   +2.358878383487754e-01   +1.930313914042458e-01   +5.906630874001369e-02   +1.558985681612320e-01   +1.921736498213822e-01   +4.940349512832871e-02   +1.966485905695350e-01   +5.220660077106633e-02; +2.176558291478404e-01   +2.790728276557706e-02   +8.125528350634616e-02   +1.022094251548844e-01   +1.326814494555972e-01   +1.713014202814047e-01   +1.163269110304171e-01   +2.445674021186385e-01   +8.027372659963330e-02   +1.042773160248741e-01   +1.473522896170037e-01   +1.213964763420760e-01   +6.334054031791050e-02   +2.452297993923914e-01   +2.244249214075755e-01   +8.353122378680769e-02; +4.460592959199771e-02   +2.308706181073601e-01   +1.405713302191072e-01   +2.317704967606531e-01   +2.468392264526311e-01   +1.659799096801622e-01   +1.227149288395416e-01   +3.723047114127337e-02   +1.809243382964674e-01   +1.226010664501374e-01   +8.411239817080383e-02   +2.126549603967265e-01   +1.761541435626697e-01   +1.209083344153807e-01   +2.030955642706647e-01   +6.233079191647951e-02; +1.817414462061156e-01   +2.451881274988962e-02   +1.381657563070010e-01   +3.352713226429460e-02   +1.369930018249794e-01   +1.462536075240239e-01   +1.518571197711014e-01   +5.493850684062836e-02   +1.912808179068584e-01   +2.217844194793169e-01   +4.741738252577252e-02   +1.955621830172152e-01   +2.486824968177244e-01   +1.600198724837371e-01   +9.247868740616932e-02   +3.177664465069368e-02; +6.606684067574797e-02   +6.509928986600927e-02   +6.663070690322220e-02   +2.702681457584267e-02   +5.234945689255628e-02   +2.204274778394428e-01   +2.332826445957559e-01   +1.929437967372154e-01   +1.107194907621456e-01   +1.637821119268337e-01   +2.559410897856991e-01   +1.902932884914958e-01   +1.603089869763514e-01   +2.178069071053953e-01   +1.661768052220773e-01   +1.884287195597147e-01; +1.115415053168341e-01   +4.260921846054527e-02   +1.137827633597278e-01   +2.208071726640218e-01   +1.582330989836449e-01   +1.335439142713477e-01   +3.390168853308304e-02   +8.825368837314645e-02   +4.894772139539091e-02   +1.327250880043392e-01   +6.567907569215274e-02   +1.136402653047450e-01   +9.350519335695745e-02   +5.618577558249220e-02   +4.071264517116030e-02   +7.798062000675331e-02; +1.148368403838256e-01   +1.378634138436552e-02   +4.647701778324460e-02   +2.317635209806664e-01   +2.418028142892335e-01   +1.788049788422379e-02   +5.543597094832534e-02   +2.032558795130213e-01   +2.041344462958465e-01   +3.381414758092573e-02   +1.266130754032896e-02   +1.553324532650108e-01   +1.691297655784275e-01   +1.331727150797961e-01   +1.001378771635041e-01   +1.153781142021989e-01];
L2I_L1I_iGABA_netcon = [+2.504530230582566e-01   +1.240513117930304e-01   +7.349948274220755e-02   +2.236540153584649e-01   +2.372927537584512e-01   +2.362907527987223e-01   +9.035998709544590e-02   +1.984515900889491e-01; +2.008622909724281e-01   +2.214394458281630e-01   +1.790461799636592e-01   +7.332859978587630e-02   +1.128314062934851e-01   +1.695660679778973e-01   +2.293371642112397e-01   +5.718549728246135e-02; +5.553259492421023e-02   +5.632793614963303e-02   +6.813327185319781e-02   +1.025765933903246e-02   +2.059022178431234e-01   +2.459662942869807e-01   +2.835130065389756e-02   +1.528197786697226e-01; +9.889837857216645e-02   +2.001014520308455e-01   +1.711213643624420e-01   +1.580284593921326e-01   +1.579665301305856e-01   +1.560488488462919e-01   +1.297663284845260e-01   +2.025712851135796e-01; +8.424764149970153e-02   +4.558651211779532e-02   +1.563294053787973e-01   +1.485604485476446e-01   +1.178043814938119e-01   +1.968397952516187e-01   +1.304345258962622e-01   +1.478966688759052e-01; +1.954821105108118e-01   +1.857410121806254e-01   +2.302053891357912e-01   +1.108713890044353e-01   +7.332749704119584e-02   +1.748038710340976e-01   -3.092251160970386e-04   +1.718626762014492e-01; +3.249141333326064e-02   +9.157975229580428e-02   +9.209039552523698e-02   +6.191155997214141e-02   +1.788666024818442e-01   +6.968113926163347e-02   +5.580096746559208e-02   +1.647312139513539e-01; +1.462095393302962e-01   +9.137790844296216e-02   +2.052865829476349e-01   +9.846689405017753e-02   +7.532965140482970e-02   +1.780056097498472e-01   +1.135370629675494e-01   +8.001214433111686e-02; +1.032268191230123e-01   +1.748250116326648e-01   +5.258175701675691e-02   +6.605544488093397e-02   +8.380058986779997e-02   +4.277031007167495e-02   +1.063175250988263e-01   +2.466150204722439e-01; +1.358055338753334e-01   +1.668376144580462e-01   +5.882235821257261e-02   +1.371262947176122e-01   +7.473030375671541e-03   +1.802197338849221e-01   +2.281531215116494e-01   +1.718146431091722e-01; +1.331509577357340e-01   +2.029136759025350e-01   +2.132230399489370e-01   +9.137623036646408e-02   +1.813286213389925e-01   +2.497602710566661e-01   +4.903720951524745e-02   +6.984771091397608e-02; +1.967709601502562e-01   +1.320803855038696e-01   +1.530370213832020e-01   +1.047516768131466e-01   +2.479375198985993e-01   +6.813657296223237e-02   +1.599573686908368e-01   +8.711935648741526e-02; +7.693871207367317e-02   +2.435638621813033e-01   +2.319642608975817e-01   +4.672853188323967e-02   +1.403390529687637e-01   +7.886440094157769e-02   +8.019630065815603e-02   +1.315501171630576e-01; +1.769627541958779e-01   +6.575321688881720e-02   +2.553332673507579e-01   +1.300089004565227e-01   +2.117650234869746e-01   +4.641332308854983e-02   +2.399323687736478e-01   +5.869020981663388e-02; +2.459892777588261e-01   +5.251665917971114e-02   +6.635625346883754e-02   +2.357734296373569e-01   +1.661363936789875e-01   +3.373499842782317e-02   +1.023546403278822e-01   +1.808396173506240e-01; +4.968930710928070e-02   +1.792097400594882e-01   +1.786969224420562e-01   +1.575164929288580e-01   +2.107547852241411e-01   +3.170366439368955e-02   +2.528319307662817e-01   +6.975339459848308e-02];
L1I_L2I_iGABA_netcon = [+1.477361804647475e-01   +1.725418456045539e-01   +7.680749629913888e-02   +1.822455525507121e-02   +1.315005937651356e-01   +9.658885214365440e-02   +2.481611539456364e-01   +1.783885979975193e-01   +1.054925340207152e-01   +1.957630470822257e-01   +3.635385746802995e-02   +7.939061456347153e-02   +2.563693488411443e-02   +2.558547922707203e-03   +5.152009501819368e-02   +2.012823684924891e-01; +2.041022260830445e-01   +1.509455454097564e-01   +1.006625917381224e-01   +1.207380138960160e-01   +2.360616076858877e-01   +1.132562606496088e-01   +1.715819194038223e-01   +2.453370995906979e-01   +1.107959145338796e-01   +2.457904486938923e-01   +1.712404793469809e-01   +9.478796540541572e-02   +1.247549646258048e-01   +1.794764641620439e-02   +8.537330033550125e-03   +2.245109812158480e-01; +2.196734487796224e-01   +1.459280484870410e-01   +5.355404180748970e-02   +2.139117851753563e-01   +8.456385185326229e-02   +2.206785222188699e-01   +1.904688379171877e-01   +1.668999990731136e-01   +9.626130003397979e-02   +8.827939290096623e-02   +1.746629794160989e-01   +9.994214491703905e-02   +8.284971686122275e-02   +4.703375136893308e-02   +1.539341964290931e-01   +3.305626016906704e-02; +1.036125862857745e-01   +6.766097820047929e-03   +1.481962639083488e-01   +2.183122659409521e-01   +2.319892541273058e-02   +2.238616899581627e-03   +9.165353700255495e-02   +8.745622984837752e-02   +1.865028931365554e-02   +1.669519128791718e-01   +1.412034553743468e-01   +1.238347108731939e-01   +6.190957991286331e-02   +1.315835711134402e-02   +1.988976513896916e-01   +1.328137382940481e-01; +1.869735054002838e-02   +2.094702211446491e-01   +2.029691204238252e-01   +1.690657764706706e-01   +1.566405051229128e-01   +1.271349581808142e-01   +1.576127653182145e-01   +2.162708836390064e-01   +1.524500172282377e-01   +5.661892113512522e-03   +8.093288021980065e-02   +3.904644116962000e-03   +6.289913097235102e-02   +2.273498880436187e-01   +5.117796420642189e-02   +1.220098310042957e-01; +1.575893950074885e-01   +1.799416069465320e-01   +3.472801133759299e-02   +2.242851524301515e-01   +1.484635896812648e-01   +2.439665286689941e-01   +1.821812817654279e-01   +2.088596610561261e-01   +1.383324300315167e-01   +1.467099692000422e-01   +2.573297290744094e-01   +2.085389764913445e-01   +3.926567763552768e-02   +2.299756624367831e-01   +1.824572674782966e-01   +2.326184839982687e-01; +1.960528422229161e-01   +3.304381411802546e-02   +2.189717727564491e-01   +2.497487804285481e-01   +9.946365596668187e-02   +2.470311273677616e-01   +1.353755315620301e-01   +1.189449300853350e-01   +1.818558156765805e-03   +1.494141186757487e-01   +7.506158474159612e-02   +8.790628884242187e-02   +1.961867090869956e-01   +1.049779819874192e-01   +2.109749685148299e-01   +1.481649780168600e-01; +1.872907673601368e-01   +2.265136901153509e-02   +2.280843630670117e-01   +1.812363151293012e-01   +2.560430953687793e-02   +1.985804712796841e-01   +1.498927987847969e-01   +1.969942673903078e-01   +9.034784045796962e-02   +2.232720698167431e-01   +7.107081360122912e-02   +1.285943300142519e-01   +1.291323737159168e-01   +1.137180968189550e-02   +2.315410917303178e-01   +2.299312522711740e-04];
L2E_L1E_iAMPA_netcon = [+2.025180402682733e-01   +7.674102638754281e-02   +3.206499107334554e-02   +2.551218293240085e-01   +3.141322284400305e-03   +1.258665960862735e-01   +1.693792581686480e-01   +2.284736574088743e-02; +2.373395085432002e-01   +2.190982182667889e-01   +1.379863879814407e-01   +9.474059374015195e-02   +1.280676245858140e-01   +4.831547489277645e-02   +2.305267370285330e-01   +1.041044517486267e-01; +2.646562277948046e-02   +3.129282139665955e-02   +7.939418778399608e-02   +3.673596823588557e-02   +1.610853810317276e-01   +2.148366464927695e-01   +7.847172824293017e-02   +8.202890564601277e-02; +7.047213077521604e-02   +1.864154257168341e-01   +5.422463102027848e-02   +1.732672741942307e-01   +1.897976448429907e-01   +8.318325977252450e-02   +2.269641316360027e-01   +2.102984091582373e-01; +4.735604889133699e-02   +2.485676257814148e-01   +3.671762362818753e-02   +9.409222669305353e-03   +2.339039586040287e-01   +2.433569687633404e-01   +1.716895309560687e-01   +1.138652481121245e-01; +1.804127646471257e-01   +1.330049942586931e-01   +2.416944351438706e-01   +1.968480782152270e-01   +1.735464802154418e-01   +6.229221353612919e-02   +1.978706649124783e-01   +1.735044683343839e-01; +2.472839973593313e-02   +8.429711388578685e-02   +7.140199642768341e-02   +1.165799589383897e-01   +2.329460751634289e-01   +1.193147441045456e-01   +4.644507297349435e-02   +8.752209649629573e-02; +1.534397231375492e-02   +3.223216477408383e-02   +1.360613003859960e-01   +1.692773136817600e-01   +9.655300739752096e-02   +2.316509532827027e-01   +2.467842472810677e-01   +2.321212631445183e-01; +9.374352503229513e-02   +2.287863537144359e-01   +1.465819436929740e-02   +6.352430942559351e-02   +3.958522185550781e-02   +2.450350464906217e-01   +1.404209004714384e-01   +1.901513225729371e-02; +7.086857067586672e-02   +7.673908603120597e-02   +2.151277020585962e-01   +1.020786277415812e-01   +2.079962691908230e-01   +2.402546411748586e-02   +3.458465047211797e-02   +2.407811318900515e-01; +1.446838963267375e-01   +1.255980838502547e-01   +4.926297155388245e-02   +1.588169924509247e-01   +1.041256511543782e-01   +1.072892600734269e-01   +1.535513810355802e-01   +2.290874357730365e-01; +6.356672032386612e-02   +1.109012676563467e-01   +2.106074624427156e-01   +1.891171131109123e-01   +1.652394258405496e-01   +4.693703489820612e-02   +2.559094565021217e-01   +5.713032885515821e-02; +1.495873647695213e-01   +2.143630459850062e-01   +6.299845517911057e-02   +1.072619137922578e-02   +2.478840712589722e-01   +1.713812188130457e-01   +1.142975018341838e-01   +2.067725374688865e-01; +1.039163488848989e-01   +1.118774254737917e-02   +2.964700501015998e-02   +1.711810820976731e-01   +2.499193262889856e-02   +7.427593324145233e-02   +1.528335227696931e-02   +1.910917594078398e-01; +6.831741966680133e-02   +5.270818230369260e-02   +2.053245889116826e-02   +1.969065967920029e-01   +2.554278200487218e-02   +2.220753058989808e-02   +1.043585463553038e-01   +5.309326905675772e-02; +3.701481155308174e-02   +1.136957799858919e-01   +3.402153964187770e-02   +1.383890878343360e-01   +6.103600665441031e-02   +1.364175066867266e-01   +2.457364134194180e-02   +2.079378934801460e-01];
L1E_L2E_iAMPA_netcon = [+9.610083734053095e-02   +3.577371843892602e-02   +2.401615916578860e-01   +2.391030060738540e-01   +8.480053015532743e-02   +2.422291359394846e-01   +1.268341582785155e-01   +2.497203663139495e-01   +3.459936532192420e-02   +1.686057854879254e-01   +1.601029321720876e-01   +1.938061792667682e-01   +9.644956880737783e-02   +1.679513980239559e-01   +1.436956557696331e-01   +1.250093463136800e-01; +9.799015227741703e-02   +1.332224962606748e-01   +5.306960160998158e-02   +2.371287806634508e-02   +1.389883972938199e-02   +1.671945567447346e-01   +1.757297889448168e-02   +8.368990215557746e-02   +5.806147875351970e-02   +8.276993331487570e-02   +7.021232830813569e-02   +2.407857912812990e-01   +3.737507646573876e-02   +6.382943109289596e-02   +1.537905756768918e-01   +6.454402412879336e-02; +8.371661595210889e-02   +1.475064759255210e-01   +2.280349330999410e-01   +2.307902121261461e-01   +2.432348272597259e-01   +2.862863460157556e-02   +7.556685874212349e-02   +1.803102488742462e-02   +1.129435720378182e-01   +1.497561734744760e-01   +8.055399896776448e-02   +2.738907129473047e-02   +1.871349278440173e-01   +1.575512697306246e-01   +2.232099442376639e-01   +2.025278313128724e-02; +1.979591057375558e-01   +6.499881397767186e-03   +5.633659518514328e-02   +5.067195857865674e-02   +1.826484348095363e-01   +8.291244372548921e-02   +2.309992970673008e-01   +2.247774261478671e-01   +1.968336607306495e-01   +1.978715884497861e-01   +1.125482613441120e-01   +1.401590046347972e-01   +2.354545888159866e-01   +8.533778964858930e-02   +2.332482165438623e-01   +2.504196774426670e-01; +3.544651917652526e-02   +2.198232488166447e-01   +2.231997607685420e-01   +6.774309321694404e-03   +4.288894142939762e-02   +2.083417330651843e-01   +2.313368565250183e-01   +4.565644284107801e-02   +1.493962390918910e-01   +1.088411134162473e-01   +1.459725780203810e-01   +1.961587452128817e-01   +6.271780833714667e-02   +1.351465709761701e-01   +2.528131907551253e-01   +1.891725496156450e-02; +9.740216911242185e-03   +2.237086665362760e-01   +6.972645702167100e-02   +2.066352341932405e-01   +2.481190429855354e-01   +2.225812864265875e-01   +1.334957226462542e-01   +2.334024723709391e-01   +8.375935720450157e-02   +1.044854791743266e-01   +2.176704777106726e-01   +2.335858259728807e-01   +2.145855360614857e-01   +1.580214280953635e-01   +4.955787059509521e-02   +1.439670753313269e-01; +8.073949721764653e-02   +5.072759064548085e-02   +1.466656510646570e-01   -2.307502347108653e-03   +9.454367564838803e-02   +1.342503786152960e-01   +1.900699774196905e-01   +1.488579042392804e-01   +1.516475001614218e-01   +2.021662105249165e-01   +1.622960544998669e-01   +3.551899311717038e-02   +9.528315821673981e-02   +1.452129780631062e-01   +6.225329797551681e-02   +8.548912834501980e-02; +2.010967071701679e-02   +1.370730366223583e-01   +1.223911741843649e-01   +1.020838303167808e-01   +1.844808502862676e-01   +2.460067207274199e-01   +2.484693099259208e-01   +1.633172867233149e-01   +2.234230384333799e-01   +1.033738089242975e-01   +8.674371198111823e-02   +2.488231007797947e-01   +1.685135491323692e-01   +2.333926885680200e-01   +8.377100543954884e-02   +2.802630957695778e-02];
L2I_L2E_iAMPA_netcon = [+1.626398901076127e-01   +6.055287922185501e-02   +2.307388770692601e-01   +1.226572291001696e-01   +1.933389149900146e-01   +8.764937784418033e-03   +6.734017883949618e-03   +2.333208955910892e-01; +3.858682260533829e-02   +2.920481602718471e-02   +4.291904797120523e-02   +2.152534652495701e-01   +1.953439526794088e-01   +9.749185233986553e-02   +1.795668792340318e-01   +1.246094804199142e-01; +2.174251086661547e-01   +1.914025593630909e-01   +2.105611263949913e-01   +1.899673530115877e-01   +1.337775706932961e-01   +1.281102071576502e-01   +1.276118139683800e-01   +1.850086384795726e-01; +9.980008012427644e-02   +3.893466433193540e-02   +2.288307252321257e-01   +1.114247373814537e-01   +2.438964252917179e-01   +3.874658924144196e-02   +1.141615782333268e-01   +2.161255175342288e-01; +1.745033763387296e-01   +2.197667360628957e-01   +1.615854217028578e-01   +1.550944833783503e-01   +2.355559849768038e-01   +1.903014862118017e-01   +9.899135467405880e-02   +1.859456549071601e-01; +1.524366835252430e-01   +5.474275307077929e-03   +2.225696694910771e-01   +1.868792491179612e-01   +1.379947646641977e-01   +5.415077411988153e-02   +2.793431990827612e-02   +1.788987809836334e-01; +2.455412404924112e-01   +1.213306556951303e-01   +4.616755739596808e-02   +1.010085352947136e-02   +3.326727486800667e-02   +5.282461474397425e-02   +3.948628470447231e-02   +4.671848041802280e-02; +2.306527288430684e-01   +7.959309883931821e-02   +1.393666346472926e-01   +1.219598400652196e-01   +2.210479118789618e-01   +6.305660111503636e-02   +2.847009647127075e-02   +8.237019785542079e-03];
L2E_L2I_iGABA_netcon = [+2.354794274506435e-01   +5.898631146376718e-02   +4.905124549473011e-02   +4.247463041970684e-02   +1.690369635836201e-01   +9.471164010849932e-02   +2.131267776917138e-01   +2.374009750962046e-01; +6.493628362415067e-02   +1.054770019751800e-01   +3.349425590426620e-02   +1.944877611737295e-03   +2.528390744632429e-01   +1.792647717636311e-01   +1.923781081205897e-01   +2.049785661849684e-02; +1.677040965246652e-01   +8.896940657885528e-02   +1.438800557674191e-01   +1.666683952410361e-02   +1.019475431188267e-01   +2.190653607442493e-02   +2.451407968989780e-01   +2.101419852203342e-01; +2.169011559117594e-01   +2.228667382852489e-02   +6.951913544755776e-02   +1.826692998343249e-01   +2.351689069228586e-01   +1.637993317509258e-01   +1.108095001847513e-01   +1.704700387904859e-01; +4.037522801136365e-02   +2.293505093575212e-01   +1.779200437481821e-02   +2.116943127634729e-01   +8.045432652466891e-02   +9.167987900844178e-02   +1.305077609997665e-02   +6.766242460352560e-02; +1.890231151782257e-01   +8.748481054412810e-03   +1.388143302097335e-01   +1.989197980709197e-01   +2.279426131414448e-01   +6.714196972221416e-02   +2.388149353249888e-01   +1.914999089902871e-01; +3.824961379793597e-02   +2.487865312013795e-01   +7.295411029318055e-02   +9.299532792671355e-03   +1.821814658445066e-01   +1.331196974361833e-01   +1.507088901112261e-01   +1.567942367487965e-01; +2.198752399982976e-01   +7.864116859958734e-02   +1.288163137805626e-01   +5.316135442111190e-02   +1.186181433804609e-01   +2.010649737859602e-01   +2.433071033713270e-01   +1.634358182097831e-01];
L3E_L2E_iAMPA_netcon = [+8.798694849354761e-02   +1.653355331764325e-01   +3.743325113720160e-02   +1.752311626914087e-02   +1.774582424763119e-03   +2.522949742512408e-01   +9.676804057977423e-02   +2.188401872261301e-01   +3.048459818510382e-02   +7.584839351542717e-02   +7.114510729464096e-02   +1.772759371930573e-02; +6.924828004168485e-02   +2.314736009889324e-01   +7.780862018635502e-02   +9.382141222134181e-02   +1.162487030744359e-01   +1.442882875396688e-01   +2.297666475193184e-01   +2.531245863204010e-01   +1.458124391787617e-01   +2.443540991272274e-01   +8.340469789296710e-02   +6.554180765395093e-02; +2.051206286716972e-02   +1.947888756290788e-01   +3.042090468487571e-02   +1.901697713876276e-01   -1.034197470610875e-03   +2.772566239365783e-03   +1.336951858402841e-01   +2.458793205190112e-01   +1.489837022222010e-01   +1.547620163676403e-01   +6.356799233148555e-02   +1.736860921962118e-01; +9.958947301532895e-03   +5.108018820287289e-02   +2.072793973202916e-01   +6.724102671722071e-02   +7.569703517653398e-02   -2.308295329689324e-03   +8.611513453938600e-02   +2.059570609472650e-02   +5.236563013231578e-02   +8.390528536628787e-02   +5.308575879575791e-02   +8.204895995619527e-02; +2.331563701555044e-01   +9.804440021009883e-02   +8.332705452400202e-02   +2.509426231329387e-01   +1.762861786829855e-01   +8.927253299779446e-02   +2.486347357998874e-01   +4.571065228702402e-02   +2.146999411943686e-01   +1.193054749513806e-01   +1.759172910481933e-01   +9.962449179833396e-02; +2.218773054753263e-01   +1.511245754341248e-01   +2.243302444638558e-02   +1.253154667092280e-01   +1.592195998384628e-01   +2.362566753687710e-01   +2.291172739950123e-01   +9.672777149822293e-02   +1.162760513097541e-01   -9.796180526028039e-04   +1.636026446266103e-01   +6.501111891444970e-02; +1.607175845104847e-01   +1.305662350551172e-01   +1.624775659648476e-01   +5.361810763711477e-02   +1.761683340284222e-02   +9.388298539340330e-02   +2.790021580419281e-04   +9.147028019054998e-02   +7.186429098538087e-02   +2.150757037017736e-02   -7.444995654582820e-04   +1.171254346847165e-01; +2.169194365222202e-01   +2.946869669031863e-02   +2.998144373072942e-03   +6.626493793486928e-02   +1.415228772229577e-01   +2.441205018712240e-02   +8.550170321922856e-03   +1.208723913165298e-01   +1.229626143146048e-01   +2.144649419052947e-01   +2.280601250308917e-02   +1.529136888183498e-01];
L3I_L2I_iGABA_netcon = [+2.474768645728533e-01   +1.278790043510576e-01   +1.675361471122099e-01   +6.635422586078174e-02   +2.428287648368649e-01   +1.095098508947677e-01   +1.216219679912143e-02   +1.974636057151251e-03   +2.195448442486328e-01   +1.129575025538801e-01   +2.744589638138831e-02   +1.880017184106065e-01; +2.270936716793090e-01   +2.459927975476254e-01   +2.220186086797088e-01   +3.878541253852957e-02   +1.260256434523838e-01   +2.100777496699363e-01   +1.150528036082289e-02   +5.655836502730553e-02   +1.240193933742995e-01   +1.701482422867241e-01   +3.212289936098713e-02   +1.627114200123628e-01; +2.787810415228881e-02   +2.188831655194664e-01   +2.314975839409007e-01   +5.580085717649697e-03   +1.766378163171877e-01   +3.030195873645806e-03   +1.587336892306160e-01   +2.412765232803872e-01   +1.817259815130448e-01   +4.655241157653643e-03   +1.578881752380851e-01   +2.872374249691282e-02; +2.454954649948553e-01   +1.280810430283731e-02   +1.235579129842261e-02   +1.634453324993046e-01   +2.265413680691896e-01   +1.385796756443927e-01   +6.286193667926330e-03   +8.721348819321333e-03   +2.186078831603863e-01   +2.089620856504267e-01   +2.539955008867816e-01   +1.396111119775863e-01; +4.060756066879608e-02   +2.414490206844450e-01   +1.031016236609001e-01   +1.120881979512815e-01   +1.471503259809588e-01   +2.355299435079460e-01   +9.971939044397496e-02   +4.428230598473907e-02   +2.596292418082115e-01   +1.266002415765912e-01   +5.442541981911925e-02   +4.995894558659612e-02; +1.131550206985483e-02   +1.754649756903832e-01   +5.209410155785522e-02   +1.123603918241403e-03   +3.811084773031806e-02   +1.649826734737108e-01   +1.768770697552713e-01   +6.275837429252891e-02   +1.489691992409378e-02   +1.913271906939743e-01   +2.266605886830347e-01   +2.009507618386547e-02; +1.563502961692699e-01   +2.189463901627668e-01   +1.449343768932920e-01   +1.662340171357152e-01   +1.084145479863025e-01   +7.705175421759471e-02   +1.726944792475223e-01   +4.064215958194189e-03   +2.185299142174426e-01   +9.439436195904030e-02   +1.237174446780651e-01   +1.789251287231501e-01; +1.277244383394712e-01   +5.080064203118515e-02   +8.518055202882734e-02   +1.521147334092346e-01   +8.960227874218255e-02   +3.196675372486054e-02   +5.816910080250796e-02   +6.885611815158775e-02   +1.395418965477987e-01   +2.457364954707824e-01   +7.106412993892851e-02   +7.372282580312355e-02];
L2E_L3E_iAMPA_netcon = [+1.738224934739057e-01   +1.683455270429915e-01   +5.970402618767946e-02   +2.179381277882401e-01   +1.224814325070439e-02   +1.299091703253906e-01   +1.726550004743722e-01   +2.385124271797718e-01; +1.406142809122160e-01   +1.872594736404515e-01   +1.855230665100564e-01   +2.010661663980882e-01   +2.307926954864051e-02   +1.347641188975439e-01   +2.158672100983293e-01   +1.782264285165057e-01; +2.139734247033617e-01   +2.238134097173505e-01   +2.137111594721884e-01   +2.281141445929445e-01   +1.485228283816151e-01   +1.649363446548238e-01   +2.261801650990687e-01   +1.482998768157089e-01; +1.011221481915461e-01   +2.426066275849234e-01   +2.158797423273361e-01   +1.535917604279263e-01   +1.310113114167328e-01   +1.293017879518443e-01   +6.911387199510216e-02   +4.657032590731468e-02; +3.418128420304271e-02   +1.429086440223347e-01   +6.619445099697291e-02   +2.319018385048336e-02   +4.505897545939834e-02   +1.399743779806897e-01   +2.259931022688046e-01   +1.937643701303139e-01; +1.205405989652805e-01   +2.536410436045987e-01   +2.321168157044667e-01   +1.415990458904328e-01   +1.271551215928456e-01   +2.483583852622936e-01   +1.826483925070129e-01   +2.496456013351684e-01; +1.202713648812713e-01   +2.930489582822017e-02   +1.278810432635823e-01   +5.236738550051572e-03   +9.190137938026838e-02   +2.016764592335147e-01   +8.818401358996061e-02   +1.963270478601208e-01; +2.370649497207653e-01   +1.758498477137650e-01   +1.159669372592424e-01   +1.979545124461020e-01   +8.870844154804659e-02   +1.915116049383799e-01   +1.286589831403890e-01   +1.058207841625960e-01; +1.221864897427272e-01   +1.394640013128546e-01   +2.277892708774244e-01   +1.565252677477298e-01   +1.475311710777830e-01   +8.746949542027319e-02   +1.500161810861409e-01   +1.701745717775008e-01; +6.573268431519751e-02   +4.255559940330542e-02   +2.002893120589966e-01   +2.211005239703430e-01   +2.282678579129788e-01   +3.144001105219541e-03   +3.548867863376164e-02   +1.656259636399852e-01; +1.494487907180809e-01   +8.526858781140310e-02   +1.855985531208558e-01   +2.095552086998756e-01   +2.368841304862200e-01   +2.448849053754860e-01   +6.562930631811524e-02   +9.094967496728347e-02; +2.996716119152038e-02   +1.509157829337295e-01   +1.095572564678706e-01   +2.213547567986015e-01   +1.242529372276885e-01   +5.388088177175717e-02   +1.629536842603445e-01   +2.218441133587028e-01];
L2I_L3I_iGABA_netcon = [+2.404939371932991e-01   +1.081463997866190e-01   +7.274032559352607e-02   +1.780578743790531e-01   +1.889450644240301e-01   +2.146787033211220e-01   +6.689913224793789e-03   +1.358312024903306e-01; +1.356214435005154e-01   +1.208037697077933e-01   +1.761954309335397e-01   +4.250591306916059e-02   +2.283806563819802e-01   +2.099087117271446e-01   +1.153037924434970e-01   +6.677484445831720e-02; +1.987021131609104e-01   +1.847642360026760e-01   +2.414726866545405e-01   +1.532373534689467e-01   +8.929978894068406e-02   +1.519953300771414e-01   +1.008478845996170e-01   +4.019801919637091e-02; +5.454379770347771e-02   +2.112272852256487e-01   +5.479700246160989e-02   +1.253896467306385e-01   +1.391613488219618e-02   +8.792951176640425e-02   +9.802490092989040e-02   +2.504181889330789e-01; +7.684335761414668e-02   +9.642471172962792e-02   +1.323667992873402e-01   +1.154738994091450e-01   +9.543243273162916e-02   +1.627528689281861e-01   +2.471656731731536e-02   +3.752589670126272e-02; +7.708728268120590e-03   +6.771369340424126e-02   +1.040727029119145e-01   +4.545044844952858e-02   +8.863495857388010e-02   +1.046715455829925e-01   +1.316697740282622e-01   +1.793430829160058e-01; +9.180712380611569e-02   +1.160777109455123e-01   +2.409784127631287e-01   +1.614209207171468e-01   +1.882998589710648e-01   +7.734290536135023e-02   +8.007970347086674e-02   +7.815821195369199e-02; +7.127888539506856e-03   +2.531533410421983e-01   +7.753131721188757e-02   +2.229826308910269e-01   -2.832082409891914e-03   +1.934710294923228e-01   +1.428211873070499e-01   +1.946705337079653e-01; +2.237548726262724e-01   +7.698707473119998e-02   +2.123321534564979e-01   +1.374868128470246e-02   +1.313819447245074e-01   +7.231690836710437e-02   +1.064914988348061e-01   +1.139319790586641e-01; +1.906870062102328e-01   +1.285480891749319e-01   +6.725216182349841e-02   +1.267663611192844e-01   +1.584939264006888e-01   +8.538491568832246e-02   +5.507299370118803e-02   +7.923276071013605e-02; +1.843477373199965e-01   +2.474168973116386e-01   +1.354276620976488e-01   +1.728897654409363e-01   +7.126031225008340e-02   +9.362147284151066e-02   +2.394681659200020e-01   +3.254240193441334e-02; +1.904047122573732e-01   +4.962842387796940e-04   +8.743940592766260e-02   +3.490100862833297e-02   +3.697659065658266e-02   +2.489605307148430e-01   +1.272613227992540e-01   +1.396089614372081e-01];
L3I_L3E_iAMPA_netcon = [+1.124762601683613e-01   +2.549205154291024e-01   +6.646985088322235e-02   +1.553672955538808e-01   +1.971705212422507e-01   +8.570307183818583e-02   +7.692575799554741e-02   +6.110896717725414e-02   +8.751611140382150e-02   +6.889510689483104e-02   +6.788854479274434e-02   +1.363419834335385e-02; +9.759259758810879e-02   +2.158347472616426e-01   +5.498121131960985e-02   +3.548637570698439e-02   +2.301573176272785e-02   +1.407556103909642e-01   +1.409105812262098e-01   +1.393119503986998e-01   +5.794453670780749e-02   +1.233061738131638e-01   +1.900977758568972e-01   +1.408653704907779e-01; +1.237794098417594e-02   +1.535308746227741e-01   +1.238675742608666e-01   +1.475341068780773e-01   +1.245291512903262e-01   +1.112113832411064e-01   +1.307295120728027e-01   +1.173304493572366e-01   +9.032865686542670e-02   +1.452659524778817e-01   +1.183651801798423e-01   +1.387717894816695e-01; +9.659470358681488e-02   +1.846511160439387e-01   +1.598375831470797e-01   +1.082906501494487e-01   +1.148042128690307e-01   +2.228666811621737e-01   +1.946343539115352e-01   +3.334068613684740e-02   +2.396594544359049e-01   +2.293772176504746e-01   +4.112329661419870e-02   +1.881728344321748e-01; +2.997561320863729e-02   +8.478174872436642e-02   +5.538372980141391e-03   +2.138177807747261e-01   +1.946206463613646e-01   +1.404979944731623e-01   +2.431282152533193e-01   +1.412183781503475e-02   +2.277208148039574e-01   +1.466645039883396e-01   +9.205472838253005e-02   +3.052814780045193e-02; +8.677979693342268e-02   +1.676858620398549e-01   +2.097757205917824e-01   +1.073574755697471e-01   +2.535704820586664e-01   +4.373714110122905e-03   +2.260839681774399e-01   +6.908181124082635e-02   +1.707709376850986e-01   +7.435337898752002e-03   +8.724897109189515e-02   +4.095099321133416e-02; +2.017529035191076e-01   +9.284892020266776e-02   +9.732661422387312e-02   +7.115420851900821e-02   +1.703961548044400e-01   +5.150262480719898e-02   +1.381907714709912e-01   +2.312883263749257e-01   +2.127430582884678e-01   +2.470815048160205e-01   +1.365516624048962e-01   +1.844782332193807e-01; +1.900461055832155e-01   +5.182053513934541e-02   +1.813091137937006e-01   +1.538151560828419e-01   +2.497510787040206e-01   +1.491703213499126e-01   +2.630461507940796e-02   +1.266417556549926e-01   +1.129190918948970e-01   +7.840784133569573e-02   +6.251289202001822e-02   +2.384333327232125e-01; +2.009599776406590e-02   +2.139287103703399e-01   +1.852328383621415e-01   +2.056256968966121e-01   +9.192587194273968e-02   +1.845950197413570e-01   +4.680484613033441e-02   +2.023314354874990e-01   +2.137247504379550e-01   +1.177520081728634e-01   +5.496903659494030e-02   +5.731059688776213e-02; +2.327090124350356e-01   +2.026544063378604e-01   +1.014054425822775e-01   +5.569863627791505e-02   +1.434932836344704e-01   +2.011245614154323e-01   +1.269821439512178e-01   +2.274372268063245e-01   +1.727732018569312e-01   +8.230525425927186e-02   +2.277138492215709e-01   +5.437140968055433e-02; +1.100094623098925e-01   +9.057252495810469e-02   +2.527014326613741e-01   +2.419303866507146e-01   +5.986665418454462e-03   +1.544813688889805e-01   +1.843303516872014e-02   +6.402263416846608e-02   +8.092458097748318e-03   +2.442785527708684e-01   +1.861600087923802e-01   +9.447139216363200e-02; +2.360008782639926e-02   +4.082828816447247e-02   +1.215196373443949e-02   +1.131334076321090e-01   +1.106614194139635e-01   +5.908222108454393e-02   +2.010696915411382e-01   +4.693608741806222e-02   +8.290192336495579e-02   +5.981438314004613e-02   +1.924198772647253e-01   +7.077016769125886e-02];
L3E_L3I_iGABA_netcon = [+4.745127293234577e-02   +1.141515341092267e-01   +8.420738349136954e-02   +2.311893091854991e-01   +2.088532957003845e-01   +1.405817268957294e-01   +8.117112155396350e-02   +1.911662209216621e-01   +1.642155557028506e-01   +1.864349982532535e-01   +1.531199863114188e-01   +6.311709465273962e-02; +1.962176018968961e-01   +1.644674732977420e-01   +7.840447510174545e-02   +3.412193974781988e-03   +9.345643568393810e-02   +1.818750999607468e-01   +1.631289343683695e-01   +2.505791912068809e-01   +2.173886259071482e-01   +1.165241949878159e-01   +3.157679504901110e-02   +3.176333788288749e-03; +1.441547264476818e-01   +2.439486075058998e-01   +2.432303225328626e-01   +2.168885495137214e-01   +3.799708193323302e-03   +1.913490864952945e-01   +1.478962521349911e-01   +1.765649141271733e-01   +1.004358523822644e-01   +1.030389634005090e-01   +7.060251546033625e-02   +3.454634367296850e-02; +1.094439896805514e-01   +1.718925754644934e-03   +3.823358151630021e-02   +1.804741959141762e-01   +1.813000262255324e-01   +6.777611236953872e-02   +1.066518809747191e-01   +9.406231221476845e-02   +2.493559297981938e-01   +1.161256854282515e-01   +1.099473773018625e-02   +1.508859401792741e-01; +1.098260305223376e-01   +1.012610485708384e-01   +2.521884423547574e-01   +6.794652042528998e-02   +1.363088131829941e-01   +1.936928958191499e-01   +2.468968462121058e-01   +2.365242730673448e-01   +6.931949988338393e-02   +1.458820494800224e-01   +2.130642283831657e-01   +1.623365010799069e-02; +1.702063540156029e-01   +1.175368493066375e-01   +2.152687013047127e-01   +2.333000957029515e-02   +1.233520172387678e-02   +2.521568024846901e-01   +1.963514810895508e-02   +1.577332182432277e-02   +2.104598142439740e-01   +1.532567326478034e-01   +6.759216059099438e-02   +5.268684533607650e-02; +1.438670731126702e-01   +8.972162842784390e-02   +1.237621905112776e-01   +1.472902463969066e-01   +1.723383619548145e-01   +1.217782749998692e-01   +8.244604071879780e-02   +8.059678583051372e-03   +8.566339743345081e-02   +4.092489546869756e-02   +7.800694797751002e-02   +1.810009899490413e-01; +7.985149763268930e-02   +4.018693612522819e-02   +3.021121969031959e-02   +2.323521197982132e-01   +1.132364449074259e-01   +1.952609047717320e-01   +1.336639434043500e-01   +1.941804716508800e-01   +1.985211605378751e-01   +2.149149799312480e-01   +3.953705484705706e-02   +1.478155943978141e-01; +7.111679050445943e-02   +5.016942272906890e-02   +1.931638463052588e-01   +7.603055986133652e-03   +2.409525585065170e-01   +2.276741363557504e-01   +4.464079106435018e-02   +1.803866962340996e-01   +5.963003533222044e-02   +1.034553450946418e-01   +1.071294687000049e-01   +1.523860542386504e-01; +2.072293884770480e-01   +8.050609657771467e-02   +2.159275625926468e-01   +8.145120782845745e-02   +9.001261217951320e-02   +2.507005283892221e-01   +1.934023032643036e-01   +1.426063921343340e-01   +2.354736371528763e-01   +2.485269136309922e-01   +4.252544275029543e-02   +8.451705829468196e-03; +1.393499938279728e-01   +4.090994082066236e-02   +5.368535597637351e-02   +5.023817571152178e-02   +1.990195731334566e-01   +1.296196046844867e-01   +2.232116423032368e-01   +1.576546238409818e-01   +1.448563843970327e-01   +4.671348438812430e-02   +2.202977478696732e-02   +2.022685814809276e-01; +1.627669315364749e-01   +1.296911730793886e-01   +2.551830574320351e-01   +1.798474857602682e-01   +5.740613295386351e-03   +1.326283285627864e-01   +2.502041256426842e-01   +1.883339285990995e-02   +1.975981753848245e-01   +9.822121398584696e-02   +1.188090465319788e-01   +1.113891274752975e-01];
L2E_Input1_iAMPA_netcon = [+2.549322078977872e-01   +2.569726158344571e-01   +2.554616649609603e-01   +2.583168624809939e-01   +2.582528392661176e-01   +2.629106621223398e-01   +2.575166666446610e-01   +2.499561622234223e-01];
L2I_Input2_iAMPA_netcon = [+2.584868478767904e-01   +2.601020717962840e-01   +2.553690011777160e-01   +2.533745533912159e-01   +2.517101286364818e-01   +2.551551370833233e-01   +2.545215156205695e-01   +2.544717753429764e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
