function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.054387521653469e-03   -2.818766047271931e-02   +1.288519364132118e-02   +8.415845655656470e-03   -1.587797123358258e-02   -7.432595315964928e-02   -5.943385018560194e-03   -8.771698175056997e-02   +1.619046929463444e-02   +1.035094919416121e-02   +1.803495544483744e-02   +3.386641837113159e-02   +4.257750062729052e-02   -7.047152802026943e-02   +2.240770576281165e-02   +5.438083696777406e-02; -6.608610667894813e-02   +3.803032900056051e-02   -2.150232337280846e-02   +2.224139278409540e-02   -4.466555874820171e-02   +6.291407495296295e-02   +2.035320373104222e-02   +4.802414304628169e-02   -7.122096387539711e-02   -1.025263911383772e-02   -6.492294498483454e-02   +1.042332071482924e-01   -1.531748442458843e-03   +1.055197876336974e-03   -5.338439285555594e-02   +6.743091145840525e-02; -1.349932916793877e-02   -5.046271770020792e-02   +1.026812125295195e-03   +1.080417541557804e-01   +4.428513121251997e-03   -6.589213854751429e-02   -1.332466606551582e-01   -1.081218277029739e-01   -1.136742729904835e-01   +1.042038173199509e-02   +3.719638737167640e-02   +1.196630579679845e-03   +9.977270201903460e-02   -8.495693770070652e-02   +5.866457785396496e-02   +5.388539031278453e-03; -1.863297186156482e-02   -4.670060611249995e-02   +4.220775957919781e-02   +4.949065718173566e-02   -5.117521205644237e-03   +2.170819911110490e-02   +3.042235887281259e-02   +3.246016027446656e-02   -1.169278364243502e-01   -9.267829599597840e-02   +4.186692744243548e-02   +6.867571722617200e-02   +8.877258783226916e-02   +6.315376562211977e-02   +4.215958260847204e-02   +2.090738719479661e-02; -4.286699086041748e-02   -1.576440512862716e-02   -6.073744978007182e-02   -4.649023362608687e-02   -1.136643710410101e-01   -1.031771839581828e-02   +4.272460865810988e-02   +6.765169791305516e-02   +6.790700898134483e-02   -6.578429639895519e-02   +3.983784104275394e-02   +6.835582309121919e-02   -2.115309867452009e-02   +4.592519586177826e-02   -1.773828174237698e-02   -3.133253838804205e-02; -1.300980546328075e-01   +7.377070566898485e-02   +9.307291044969913e-02   -4.828753450841982e-02   +1.057608060974694e-02   +5.264574482167246e-02   +3.000031141841548e-02   +1.072614521850312e-02   -1.914503544523079e-02   +1.405422655609264e-02   -1.175070445011811e-02   +1.990682316068077e-02   +5.573616038523189e-02   -4.596905679711848e-02   -8.532400495162894e-02   +4.078814151996135e-02; +2.032466103365424e-02   +1.043228831338064e-01   -6.183824596122978e-02   -1.123530785576684e-01   -9.496660152767168e-02   -3.820438128311497e-02   -9.037564612485359e-03   -4.616211578352990e-02   +5.731055717711961e-02   -4.231703929613832e-02   +4.500290336434225e-04   +5.922910887872443e-02   +8.458669093923693e-02   -7.005405082108790e-02   +9.321490291596968e-02   +1.080125831404424e-01; +1.577152942961459e-03   +8.731128536716089e-02   +1.474377057545412e-01   -1.147374199365795e-01   -6.350425419127984e-02   -9.476264034474488e-02   +9.598353518597955e-02   +1.002707431923885e-01   -4.385474198208066e-02   +6.197911122033078e-03   +1.024265685796113e-01   -6.720030241887547e-02   +3.033507852125340e-02   +2.949000443399159e-02   +6.127573251685567e-02   +2.028711694010244e-03; -3.042123349559672e-02   -4.682389397020115e-02   +7.781128396103396e-02   +1.803337923545985e-02   -4.697830266174802e-02   +7.199648688305989e-02   +6.707040970909715e-02   -6.638922958141660e-02   -9.031910310312624e-02   +2.749600506970744e-02   +3.670432992684071e-02   -4.186213815596825e-02   +1.064694947610894e-01   +1.209606956843728e-01   -1.950868618391529e-02   -2.012400987609736e-02; +2.626630808821913e-02   -5.411499633579004e-02   -3.837257771601227e-02   +1.037760908862645e-01   +1.471802532478869e-01   -7.433287474237747e-03   +6.854842366201611e-04   -1.496110872908554e-02   +6.744637386834440e-02   +2.625772597329597e-02   -3.616171171472479e-02   +1.251011843142148e-02   +4.888004478405721e-02   +1.002322750911446e-01   -5.684382234776519e-02   -1.254457604800628e-01; +3.769982452294152e-02   -7.492082496606980e-03   -4.753094104269465e-02   -2.412665002976252e-02   -2.862702608936615e-02   +1.250911315333334e-01   -3.900723661912864e-02   -4.547857043810553e-02   +8.890422925828811e-02   -2.986297865667627e-02   +3.803522335324572e-02   -5.176746960931482e-02   -9.216688100177708e-02   -2.993963762838249e-02   -8.666738768471008e-02   +2.393382531040200e-02; +1.607716245254000e-02   -1.040194408521622e-01   +6.542925890062030e-03   +8.247766552824169e-03   -5.744580086621814e-02   -4.927364589020046e-02   +2.866238621307325e-02   +5.235702378962320e-02   -8.405069143615848e-02   +8.159108153188324e-02   +5.455253797812032e-03   +3.269061085547829e-02   -8.652920256987578e-03   +1.867341860567252e-02   +5.863960017622120e-02   +1.072804433279438e-02; -4.687863125591406e-04   -5.796697098573959e-02   +8.185487360227447e-03   -6.285850712335984e-03   +3.358981955159231e-02   -6.926796625960741e-02   +4.504114192873468e-02   -8.151065442118262e-02   +4.659256678760228e-02   -8.101014078632257e-02   -7.961126265758518e-03   +8.175598712646417e-02   +1.789749776840404e-02   +7.583808669697548e-02   +1.740138459962265e-03   -1.640324842657213e-02; +3.386138968704454e-02   -4.543530998752063e-02   -2.942281964479893e-02   -3.145945903979339e-02   +6.747985878117017e-02   -1.194710860166217e-01   +4.370161571745436e-02   +4.438705799718039e-02   +4.103220238561919e-02   +2.750216715825476e-02   -6.355998604867681e-02   -3.042685204292847e-02   -3.958548756171245e-02   -6.790885783376258e-02   +1.023188152594229e-01   -8.237468424501041e-03; -3.683311885642859e-02   -1.294947235459601e-03   -8.855708010356430e-03   +2.722390377354982e-02   +4.753553594051296e-02   -8.076331714390297e-02   +3.949577317191814e-02   +7.285379749401051e-02   -4.199350897134019e-02   +6.500487245045912e-02   +2.743402362686385e-02   +2.661866190849869e-02   +4.794966388594665e-03   -6.838581059614060e-02   -9.600126030207351e-02   -1.704701162531775e-01; -4.796704295032381e-02   +1.624920960504544e-02   +4.544739307782461e-02   -1.992059686529408e-02   -8.953515891501530e-02   -2.720870553233964e-02   -5.808411552628145e-02   -1.236489402537108e-01   -1.948490918993223e-02   -2.198953832748453e-02   -7.095000243140064e-02   +1.428128336114646e-02   -6.377562053883954e-03   -3.422174981215392e-02   -3.390818227910718e-02   +9.329419464774642e-02];
L1E_L1I_iGABA_netcon = [-3.752596988401520e-02   +6.168138621218063e-02   -5.255846741047410e-02   +1.270539973340792e-01   -1.739662273279999e-02   -7.687500198619683e-02   -8.041335617826524e-02   -3.456810384962944e-02   +6.420264436198402e-02   -1.282006457843581e-02   -2.748655197109252e-02   -8.663146575989165e-02   +4.577258050657644e-02   -4.150231279623368e-02   -5.341257558657368e-02   -1.119822397260045e-01; +2.319854025011343e-02   -4.515858303758358e-02   -9.248330234380953e-03   +2.021809834368218e-02   +1.542097247108125e-01   -7.585006598830291e-02   -9.998101811481842e-02   -6.289624947202256e-02   +6.067149853821729e-02   -7.766402766545843e-02   -1.951951936749991e-02   +5.618657427338620e-02   +1.144273355443469e-02   +3.394420638433232e-02   -6.250087425522380e-02   -4.045764912954018e-02; +1.269834735973783e-02   +1.008050476651139e-01   -6.524146375176874e-03   +4.771399588652307e-02   -8.961170646965798e-02   +3.934407769494992e-02   -5.033879514926230e-02   +5.985351555791455e-02   -9.799904497970632e-02   -8.872413371978899e-02   +1.071615172081783e-01   -1.006629425625983e-01   +2.061267951854213e-02   -8.058690256551112e-03   +4.620418249708831e-02   +3.304273870225883e-02; +1.949800124054766e-02   -3.958163121684682e-02   -1.112887796829625e-02   -5.853533256664169e-02   +1.667712746135419e-02   -2.146098771245487e-02   -2.911221611439158e-02   +4.829719972255619e-02   -6.801755729907009e-02   +1.216229975323136e-02   +1.099158293288638e-01   -1.525546248409286e-03   -9.195065771753902e-02   -7.044576226591397e-03   +2.773155090894992e-03   -5.823110926073532e-02; -1.405450921887533e-01   +6.274800861459187e-03   -4.365718573204434e-02   -2.270618341101909e-02   +3.845655198552317e-02   +1.310847602367971e-02   +6.814060554711007e-02   +1.270382635875270e-01   +1.377089189899733e-01   +1.812565244618064e-02   -5.054225397528749e-02   -2.930776833569990e-02   +9.617713886478545e-02   +4.649930566942061e-02   -5.954902276133504e-02   +4.543164557236851e-02; +9.813741367629331e-02   +3.121670234313247e-02   +4.895238733764030e-02   +7.869910676103134e-02   -1.742645051152442e-02   -1.388391912478092e-02   +7.207895091110772e-02   -2.538823578839261e-02   -1.465609060905750e-02   -1.154700853786176e-01   +8.172834513689137e-03   -3.178173583594819e-03   +1.306715895148410e-02   +4.751527447010829e-02   +7.272163761662864e-02   -1.390729240129498e-02; -1.152208575633248e-02   -3.871552452221557e-02   -1.319318930457079e-01   +6.219198964630293e-02   -1.314153853448332e-01   +1.734550367604185e-01   +4.083010801921380e-02   +9.703662908265609e-02   -3.848469592763444e-02   +7.382388630087956e-02   +1.765371134141290e-02   +7.507512386919109e-04   +1.002194092643706e-02   -8.939839970903013e-02   -6.396856250046902e-02   +5.239509283164521e-02; +1.546014195018395e-02   -8.251527630385759e-02   -3.499503340415162e-02   -3.458386498983462e-02   -5.709599622634916e-02   -1.110785784837390e-01   +2.584177442176242e-02   +9.257893465517578e-02   -1.745608114361116e-02   -3.989510574700800e-03   -2.368506787006128e-02   +2.346577774086402e-02   +1.253231867579027e-02   +1.423491497096244e-02   +7.559768747440157e-02   +1.267405392025258e-01; -4.844026675315886e-02   -2.716668757829529e-02   +1.060685829579407e-01   +9.557089873302177e-02   +9.395209888839914e-02   -4.218185340643955e-02   +5.694954415437890e-02   -8.828434908808502e-03   -6.798359832852978e-02   -1.061624970953373e-01   -2.186202554279935e-02   +2.759783054370267e-02   +2.678753808509742e-02   +1.114996381452630e-01   +4.340127946539046e-02   +3.027748883472259e-02; -4.434994189907637e-02   -7.391549364054861e-02   -4.548484269774254e-02   +1.571327169079736e-01   -4.174306101963170e-02   +1.252241969953879e-01   -4.136342485375866e-02   +3.247752825885174e-02   -8.226844854947216e-02   -3.175509609958696e-02   -7.126372535249570e-02   -5.419757418575942e-03   +1.000979383774456e-03   +7.166845776002334e-02   +7.346015999552218e-03   -7.420147464965515e-02; -1.080075068440577e-01   -1.505070934750914e-01   -4.504743683197716e-02   -1.120407751865310e-01   -3.519856758684396e-02   -9.494470632569627e-02   -3.063076496826292e-02   -8.539300745651657e-02   +6.201836983939753e-02   -7.452254263476871e-02   -3.429329077976116e-02   -6.363745514846864e-02   -1.895041232506789e-02   +5.546523250276786e-02   -5.027836654462448e-02   -3.776509915488162e-03; -2.345588789270465e-02   +1.146574373712463e-01   -3.208890328741300e-02   -6.991746913748681e-02   +1.988957943105813e-02   -1.596681299476572e-02   -6.553745953743573e-02   -4.082666701288369e-02   +1.166460683936273e-01   +2.024642759303565e-02   -1.105953623517470e-01   -7.127497421346411e-02   +3.907852297490565e-02   -5.612693168014778e-02   -2.551962315478243e-02   +4.221309869053197e-02; +1.612345147279855e-02   -1.465674360917531e-02   -6.651817944165729e-03   +3.245868300279245e-02   +5.941698956367690e-02   +1.157063295545430e-01   -8.424006299689471e-02   +2.116542032828626e-02   -7.348734337784540e-02   +1.181437891059491e-03   +1.012936452512901e-02   -1.450935567402509e-02   -1.136643811935921e-01   -3.801687627288405e-02   -1.301121898395060e-01   +2.215594345376807e-02; +4.623632603141479e-02   -8.878136666505176e-02   +2.842298628729375e-02   +3.236235716967662e-02   -9.753439938713884e-02   -2.959566406454914e-02   -7.162903858301906e-03   -9.446435855116288e-02   +7.755114675235773e-02   +2.354175144236403e-02   -8.306420490284697e-02   +3.269208736543455e-02   -1.037506117762719e-02   -6.114589768708383e-02   -1.021932741712688e-02   +7.836397290304241e-02; -7.666276578443983e-02   -1.221128633427011e-01   -1.827752728066144e-02   +4.096174187978274e-02   -9.444415531999614e-03   +3.223711655961567e-02   +1.111260532695323e-01   -4.437995619669188e-02   +9.943252967526735e-02   +6.539434326552637e-02   -2.462806528796282e-03   -8.770280079934965e-03   +5.609235958793855e-02   -1.196834144440862e-01   -1.734209803941855e-02   -1.329743344805434e-01; +2.666829611050656e-02   +1.514149422092307e-01   +1.084609680332511e-01   -7.738667665666255e-02   +6.605962882221403e-02   -1.122948132569706e-01   -1.991850946549838e-02   -3.705773589478502e-02   -8.808154876288821e-02   -5.514376729163018e-04   -2.912847560518452e-02   -8.296524483498398e-02   -3.326143502132171e-02   -3.035918329867689e-02   -6.413399818228961e-02   -1.886420462794541e-02];
L2I_L1I_iGABA_netcon = [-2.822974325768213e-02   -4.987340345723576e-02   -3.707030502840893e-02   -1.307097986914033e-01   -9.867870431187944e-02   -1.102006581999532e-02   +7.667171745844754e-02   -7.212265928801864e-02; -7.511254048180903e-02   -1.087172503650271e-02   -1.443742474201652e-02   -2.198521971246750e-02   -2.126755081797404e-02   +1.574449818782471e-02   +3.300745586596969e-02   +1.598065487785741e-02; -7.990443199115072e-02   +3.560660117454098e-02   -9.252241475326409e-02   -6.213522586417252e-03   +1.543989206515139e-01   -7.485981393650230e-02   -3.895684699867098e-02   -1.082529686164079e-01; -8.163076505155650e-02   +4.220966178643446e-02   -1.735876782488619e-01   -6.505903693124974e-03   -4.136281052361888e-02   -2.907953590924927e-04   -4.634261170257797e-02   -3.675210618757026e-02; -7.458738838408960e-02   -2.017437096621876e-02   -8.296761774109530e-02   +5.442147250265347e-02   +6.814536772267285e-02   +4.030047161743831e-02   -4.097168426879650e-02   +5.532558035136333e-02; +7.424383879927370e-02   +6.868885128840464e-02   +5.641020997204556e-02   -1.379672698767628e-02   +1.065894640593393e-01   +2.520785160769952e-02   -9.791352357122941e-02   -9.431727960609520e-03; -3.697541896544619e-02   +8.821198099886014e-02   -6.160054871978474e-02   +4.611824898086122e-02   +1.727474474102893e-02   +2.903113663085102e-02   +3.915283838586180e-02   +6.480404990225702e-02; +1.509615506384865e-02   -3.647400776092838e-02   -8.167777970277249e-02   +6.044697804234386e-02   +6.070858665367665e-02   +4.875810703567150e-02   -4.448321505534313e-02   +5.946618742387907e-02; -6.044183652212996e-02   -6.751484299344335e-02   +8.354751170738126e-02   +5.882865897629774e-02   -7.342253629867754e-02   +4.706457447034054e-02   +6.956263877925165e-02   +9.369052029885683e-02; +3.852123313866112e-02   -7.053218539307499e-02   +5.286192915605790e-02   -1.157862281993794e-02   -1.021322464928143e-01   +1.147425288757471e-01   +3.365685197899973e-02   -9.054841491619153e-02; -8.342266182222559e-02   +1.063203370913183e-01   +4.161816242418204e-02   +1.014650242776392e-01   -9.277167620728149e-02   -1.000185308857334e-01   +4.095558636085789e-02   +8.618637564562245e-02; +4.388540308682373e-02   +2.523271442385498e-02   -4.075076743660237e-02   +1.904477741958879e-02   -3.043728786686743e-02   +3.713064238838596e-02   -2.329504496830736e-02   +1.002892147207514e-01; -1.374635098036004e-02   +2.235093378135405e-02   -3.139856693852051e-02   +2.320476751803810e-02   +1.467648582433282e-02   +1.260513616406561e-01   +8.784256482855694e-03   -1.723969064301439e-02; +9.184553012522967e-02   -2.079415097677553e-02   +4.701382342413044e-02   +1.143743973595467e-01   -8.558466149239174e-02   +5.291563043556009e-02   -7.878698083075275e-02   +1.053669561635880e-02; -4.997568821858493e-02   -8.500902282379297e-02   +5.146653278414611e-02   -5.488712978982632e-02   -4.492421485213211e-03   +6.764907711027143e-02   -5.460931760931956e-02   -4.631964332873322e-02; -1.312389893724613e-01   -3.406004631842534e-03   -9.996025355566426e-02   -3.592391849853306e-02   -1.589532536651665e-02   +1.543330798030813e-02   +1.112380001990106e-04   -2.329979151201206e-02];
L1I_L2I_iGABA_netcon = [-5.781365151824608e-03   -3.778612855338321e-02   +5.303989595776471e-02   -2.266015914746274e-02   -7.724944152970573e-02   +2.693747959251098e-02   +5.029607112652010e-02   +1.042476348279822e-01   +4.946048677577749e-02   -5.858414405530867e-02   +6.763149297169740e-03   +1.885301808941191e-02   -1.747248379579134e-02   +8.436419735729513e-02   -4.582945796021143e-02   +2.181914020147504e-03; -1.645242440226657e-01   +8.275065222138560e-02   -4.326646116437866e-03   +1.351775591980350e-02   -5.871245182207154e-02   -5.724322677895437e-02   -6.874659170595608e-02   +1.097278335807215e-01   -3.250994741004479e-02   +1.219019004701029e-02   -6.287507404053543e-02   -1.259637628406641e-01   +3.028894496980621e-02   -1.926966641030016e-02   -7.100662417775114e-02   +2.668090285919261e-02; +3.794272958001670e-02   +2.725958048746195e-02   -5.430050445361952e-02   -9.691611452599605e-02   +1.062870010553496e-02   +3.933742293542908e-02   -2.731119032342199e-02   +2.014231881784221e-02   +1.059096453034433e-02   -7.166390213399020e-02   -3.831761641759669e-02   +8.637757029489695e-02   -4.201663906264803e-02   +7.711094074661970e-02   -5.564797144213483e-02   -1.860718440621210e-02; -8.357909590479774e-02   -8.823618918913977e-02   -1.020695616563335e-02   -5.533933318770487e-03   -2.804119716902695e-02   +6.665672714379883e-02   -7.686433453962485e-02   -1.825016941284161e-02   -2.674800028811450e-02   -7.136718362660679e-02   -7.692455475321436e-02   +4.744779967738143e-02   -6.748931162213008e-02   -4.336293840076636e-02   +8.218226094005843e-03   -1.239907089497485e-01; +9.700540175869328e-02   -4.662323609177185e-02   +1.572379473800965e-02   -2.933121659154794e-02   +6.570110373402606e-02   +9.711651017414782e-02   +7.390414628057135e-03   -5.132453282610717e-02   -2.833925769823192e-02   +7.001091247350119e-03   +1.242395889525325e-02   -7.892449960721712e-02   +2.762214045348903e-02   +8.035625092977848e-02   +1.910698115050138e-02   -1.814246256897045e-02; -1.467107869377135e-01   -2.255002005909390e-02   +3.161741278080870e-02   +7.612662075593768e-02   -5.024721751068831e-02   +6.987360537273216e-02   -1.825045200618547e-02   +7.350956880567609e-02   -4.184516610399300e-02   +6.430477159354389e-02   +2.296025868279220e-02   -2.372429225114664e-02   +2.691690263699967e-02   +2.852581645132569e-02   -7.213973214615575e-02   -1.636148129723886e-01; -2.920890253308380e-02   +2.751341528184185e-03   +1.737299786559419e-02   -8.028984866278294e-02   +1.565769537875302e-01   +1.353230528119535e-01   +3.140884918067491e-02   +1.185183754056188e-01   -3.154282507824608e-02   -1.267930397456643e-01   +2.035740555442778e-03   +6.026568351285835e-02   +5.634232075183556e-02   +3.797458323471558e-02   +4.593590814411719e-02   +1.452228874309761e-02; +1.057906245242875e-01   -1.068519981872100e-01   -6.805426326674045e-03   -4.657854552393873e-03   -2.277017073739232e-02   -6.180063587261433e-02   +4.903237550628584e-02   -1.049355415427735e-02   +4.699824591853544e-02   +5.544572038815585e-02   -4.338127824877614e-02   +3.792271394593845e-02   -2.550960905984932e-02   -3.279529550024383e-03   +1.653424282045769e-02   -6.581590422220931e-02];
L2E_L1E_iAMPA_netcon = [-1.061156855177457e-01   +4.590525919745767e-02   -5.168670344101486e-02   +3.908394489733327e-02   +4.089500165046675e-03   -1.236012780038446e-01   +6.324891702808888e-02   +3.561654258856978e-02; -2.672910930711624e-02   -1.479198443685604e-03   -4.541244987887263e-02   -4.254912510099559e-04   -2.593239453996880e-02   -9.007593635489378e-02   +6.069493407103604e-02   -1.223487756517168e-02; +5.373051277571477e-02   -9.999051749341793e-02   -9.710505263468984e-02   -1.106258982368907e-05   -2.997272034837901e-02   -5.571054410919810e-02   +8.590558535562451e-02   +7.223114877684311e-02; +8.438686798146067e-02   +9.993689646096432e-02   +1.114144878392632e-02   +2.648940696314735e-02   -4.626792992570866e-02   +1.058760533194603e-01   +2.515472081973506e-02   -1.153162269299034e-02; +8.181314713425573e-02   +2.199165622193434e-02   +1.304840104521542e-02   -6.680337060670877e-02   -8.618484413795539e-02   -6.334760615286456e-02   +5.058650963165700e-02   -3.143610906078053e-02; +8.791191686204190e-02   -7.682332710394375e-02   +6.154154168697516e-04   -5.650175572964104e-02   -6.357327173860226e-02   -6.886150700624424e-02   +4.991022475217901e-03   +1.290046288127333e-01; +2.298759421971224e-02   -3.601439828854659e-02   -9.950513433107554e-02   -5.004780904080606e-02   +4.277303396903900e-02   -4.896731465605783e-02   -9.230383102072278e-03   +1.139817870886254e-01; +1.021042130022865e-01   +2.136552697449309e-02   +8.773134705018708e-03   +7.578632341859165e-02   +4.536509640278542e-02   -4.322856800685443e-02   +1.144407300269957e-01   +2.525405885062198e-02; +2.888223183398434e-02   -1.396631838781106e-01   -5.086797423820182e-02   -1.172783666464365e-02   +5.680314488268020e-02   +3.756820741557387e-02   +7.447186616711396e-02   -1.157733268457088e-01; +8.876442192186799e-02   -1.009976491567469e-01   -3.401314426005608e-02   -3.677585229452181e-02   +3.519453424548991e-02   +4.982102268621221e-02   -2.037037721916888e-02   -2.786330614344645e-02; +3.641885929661864e-02   -2.261846648677803e-02   -1.348825078379155e-02   -6.625608659541379e-02   +8.389238189913437e-02   -5.479962303059601e-02   -9.540958001410851e-03   +2.062394688984011e-02; +2.209208078871626e-02   -5.249273121659322e-02   -2.819682288591462e-02   -5.896660860619028e-02   -9.087610122235418e-02   +3.089782243534567e-03   -1.219402844326380e-02   -6.288847465825786e-02; +4.281068300203232e-02   +2.744910683246510e-02   +3.512157571079923e-02   -8.984335744741297e-02   -4.895809373072887e-02   +1.831446131943892e-02   +8.168468977088993e-03   +9.055769568598181e-02; -7.883532679007002e-02   +3.600601324604533e-02   -2.059063270421249e-02   -7.000248361751954e-02   +1.020970550946812e-02   -4.899358766188580e-02   -9.494319318704208e-03   -8.806960198440342e-02; -4.467476048704673e-02   +6.211998622655839e-02   +6.441941619478336e-02   -3.076220205418230e-04   +3.128025594138708e-02   -4.851360431255974e-02   -1.095711534539988e-02   +3.487119654729292e-03; -6.861872529110660e-02   +4.859887618370941e-03   -3.533055554216413e-02   +9.693386904622996e-03   +2.548662422747369e-02   +9.887253466048379e-02   -5.687346423500357e-03   -5.485549466239033e-02];
L1E_L2E_iAMPA_netcon = [-2.278873238456786e-02   +6.990564321271805e-02   -8.270658213953987e-02   -1.397733864935352e-02   +8.870679833801388e-03   +9.145590742616666e-02   -3.207234955133358e-03   +8.453623279721337e-03   -7.900991594751165e-02   +3.187236434816840e-02   +1.301994900767491e-01   -6.478490911559054e-02   -2.071163340044249e-02   -4.473673587080666e-02   +4.393665007586079e-02   -6.036738061912421e-02; -4.652069915164254e-02   -2.607225279575812e-02   -5.706883119031758e-02   +9.524228176408865e-02   +9.253401664644768e-02   +3.283890341957413e-03   -1.332537841486305e-02   +3.085199934892819e-02   +4.851626525793572e-02   -4.428720274402523e-02   +8.329999442737423e-03   +5.103961465589793e-02   -3.337704205332571e-03   -4.311544936716221e-02   -7.010311560556259e-02   -4.861341643732054e-02; -5.861143096636678e-02   +5.219323198660689e-02   +1.124362743942286e-01   +1.958196418196928e-02   +2.685836030935055e-02   +7.380265771452729e-03   +4.188270961525359e-04   -2.527661039386184e-02   -1.149924353360022e-01   -4.970583843602194e-02   +2.214990198837157e-02   -4.813043476871001e-02   -2.000588205797607e-02   +1.489891074812513e-01   +4.699492049114597e-02   -8.806936961529420e-02; +8.348318884436802e-02   -4.913312636533213e-02   -5.301572525706906e-02   +2.700213996188260e-02   -1.370265187765181e-02   -1.454233249588405e-02   -3.699520457258143e-02   -8.802786139217258e-02   -9.351161623632333e-03   -3.941328845878175e-02   +7.672754146593439e-03   +1.694480456328092e-02   -1.241134003390835e-02   -1.029305689835449e-02   -2.218186919666987e-02   +5.911050340910527e-02; +1.802851702853643e-01   -9.113671318322734e-02   +4.857914611154248e-02   -3.473996988833541e-02   +7.381687950858331e-03   +4.431013075757025e-02   -8.693253133725430e-02   +6.739769899396390e-03   +3.230989030768991e-02   -5.248592189161415e-02   +5.186360605640758e-02   -2.791841414070790e-02   -2.978192956319739e-02   +4.595613984585699e-02   +2.355287237939091e-02   -4.480185213481367e-02; +2.397342139073420e-02   -6.838970951305846e-02   +4.071451028914921e-02   +5.562550679413988e-02   -2.544414888664565e-02   +1.186366104621063e-01   +4.828110883202715e-02   -3.509408745389171e-02   -1.245194412039198e-01   -1.185149650147711e-02   -9.041021979155431e-02   +1.120316973323144e-01   +9.082342022094050e-02   +4.359026691484656e-02   +1.162043405111083e-01   +2.626383021927537e-03; -1.210982108948223e-02   +3.514768233510021e-02   +3.015418984589134e-02   -5.683940574001137e-02   -1.084090565881719e-01   +1.103211873613358e-02   -5.023703785325653e-02   -1.460885066656795e-02   -3.664819448090258e-02   -3.613058929293186e-02   +5.255177208429917e-02   -5.696570965354110e-02   +2.584161784706004e-02   +7.964089315419282e-02   -3.705328607410590e-02   -4.575323890847643e-02; -8.843725686664904e-02   -3.069858063954935e-02   +2.352968557650200e-02   -2.657574933668316e-02   +1.098322817603883e-02   -1.478339352087557e-02   +2.605665366712643e-02   -1.698065814204527e-02   -1.860457105152833e-02   +2.906687108739876e-02   +9.914830592053445e-02   +7.987144827980150e-02   +5.098943060513633e-02   -6.596860060134675e-02   -3.445038925366238e-02   +8.207220799832883e-02];
L2I_L2E_iAMPA_netcon = [+1.384709659355261e-01   -8.698003431501869e-02   -3.012949084959970e-02   -5.328236860410734e-02   +3.469403291063827e-02   -8.148288079441769e-03   +5.075524108781783e-02   -1.019089635358546e-01; -1.032060166608652e-02   -5.893563720914027e-02   -5.901322455038822e-02   +1.157834916204702e-01   -2.291105244616551e-02   -3.427180353722781e-02   -1.291864726723854e-02   +6.130873900953198e-03; -6.467539245357813e-02   +5.383788639861459e-02   -6.723436858632925e-02   +3.240129660229136e-02   -8.287627588116350e-02   +3.850943471033270e-02   +2.920722000838575e-02   -4.226367111157829e-02; +6.793250299232251e-02   -1.863434902136176e-02   -1.787322728075719e-02   +8.884814272694834e-02   -1.197821767756553e-01   +6.659981887647205e-02   -3.046566128550472e-02   -2.560477684212745e-02; -5.479322915115148e-02   +6.509281152706976e-02   +6.116453408898850e-02   -2.727114715665094e-02   +3.630817345830092e-02   +1.013548556623063e-01   +1.012827577462827e-01   +1.022815666949078e-01; +1.785267215577838e-02   -7.519306693127853e-02   -3.216150816779319e-02   +1.136660195092433e-01   +7.078388101445424e-02   -5.950772863833924e-02   -1.454945460566212e-01   -4.333913229034233e-02; -9.606346055650773e-02   +2.852919435735196e-02   +2.323013532318702e-02   +1.292845919255203e-02   -7.063666902060659e-02   +7.823256482504055e-02   -4.195317887176137e-02   -2.272487625349905e-02; -6.396557122683943e-02   -2.083358623740261e-02   +1.978600815463942e-02   -2.496317233411520e-02   +5.011975212782231e-02   -6.898000229778377e-02   -4.623944524864295e-02   +3.281355691918258e-03];
L2E_L2I_iGABA_netcon = [-1.347068389866653e-02   -6.536385686728061e-02   -3.993894155803448e-03   +7.584546894336422e-02   -2.882698350936093e-02   -4.308392367109538e-02   +3.588681516540033e-02   -5.668727323544988e-03; +4.566746695484687e-02   -1.152474146217360e-01   +7.810919011360955e-02   +1.660603541557569e-02   +9.126922761716420e-02   -2.289095526063027e-02   -4.374343317075813e-03   +1.168577205916806e-01; -1.080723457601690e-01   +1.582468352951023e-01   -3.810896459321909e-02   +5.264581267175067e-02   +7.535682485857022e-02   -3.290905230147477e-02   +5.846790959027860e-02   -7.689137943120208e-02; +5.514045912656583e-02   +2.771957560212007e-03   +6.761237186487287e-02   -5.208571030499932e-02   +4.445137920308609e-02   -6.067051746353931e-02   -2.823167014808072e-03   -3.877609199665222e-02; -6.616472305238973e-02   -1.039383186337951e-02   -4.271522657967414e-02   +1.283951226330178e-02   -5.932309372860436e-02   -1.873656980820149e-02   -1.556667740138415e-02   -1.300102806502008e-02; +2.421779785480272e-02   -6.030127550683334e-02   +5.117206109811757e-02   +6.057237969918796e-02   -1.654293802534886e-02   +3.433631971348661e-02   +1.183310100237854e-02   -8.324757383650556e-03; +1.458454344393864e-03   +1.791386595973583e-02   +4.347283744572786e-02   +1.354627967323800e-01   -3.752524015555436e-02   +5.992503034750362e-02   +9.342092413761299e-02   +3.740319435019177e-02; -6.090370940267664e-02   +1.305631877700934e-01   +4.757082583326854e-02   +7.113195022711833e-03   -5.548123417241586e-02   -1.485243321519400e-02   -3.719054629755666e-02   -3.598155506714371e-02];
L3E_L2E_iAMPA_netcon = [-4.773735095959794e-02   +2.266652339328243e-02   +4.910023427473524e-02   -1.414820770285897e-02   +9.106851184236348e-02   -2.127589406835626e-02   -5.058360713974940e-02   -5.112007404789955e-02   -8.237661927677618e-02   -5.871582852761668e-02   +6.118748772060149e-02   +6.965253828336594e-02; -1.695379179372260e-02   +7.854848984408039e-04   +7.638862812981466e-02   -1.701563340849753e-02   +8.707492635245259e-02   -9.484439550533282e-02   -8.197770430042051e-03   +6.871515485951652e-03   +8.045205749106819e-02   -3.266850327727752e-02   -1.619318988559952e-02   -1.027888868609227e-01; +9.762399020967488e-02   -1.356751241697408e-02   -8.829712673621128e-02   -2.092302854769306e-04   +9.357216565003613e-02   +4.761562624334487e-02   -4.135490683447619e-02   -5.545695585543375e-02   -5.362391082418527e-02   -4.201822774900896e-02   -8.573731121319958e-02   -2.436509867056040e-02; -1.251683451416358e-02   -1.740554354919020e-02   +5.408830378631108e-02   -4.061794353543259e-03   +2.321149085113608e-02   +5.842476800320325e-02   +3.868869187466251e-02   +8.730290486699920e-02   -5.001540776530474e-03   +6.605081564749801e-02   -3.362767285944305e-02   +4.717830980189983e-02; +9.020336157911306e-02   +6.536297148667997e-02   -5.965752482702083e-02   +6.614534368181522e-04   +1.087242613509862e-02   -1.640864329051852e-02   -1.261951604292858e-02   -5.743616024648751e-02   +2.207057542379063e-02   +6.291255913028738e-02   +2.768204890926521e-02   +4.288878477712740e-02; -1.010033876604964e-01   +5.117474253467569e-02   -2.124705024692333e-02   +7.219827347059346e-02   +2.708063025323147e-02   +9.131973334883679e-02   +3.725778543986321e-02   -1.642318953078252e-02   +3.462518415240178e-02   +4.005431139710509e-03   +1.245414707424150e-01   -7.230389967994255e-02; -3.370873779796342e-02   -2.458254404329645e-02   +1.548344567952656e-03   -6.970158522097875e-02   +5.085981971328198e-02   -7.897879592100418e-02   +2.374269255596614e-02   -3.189673061513213e-03   -5.030184593512323e-02   +5.921045470776104e-02   +1.212132881751627e-02   +8.167708141802255e-02; -6.217137689481932e-02   -9.269857434709797e-02   -3.008808196885109e-02   +6.851047430907606e-02   +2.184199003442558e-02   -2.140626983676123e-02   +4.919464380308859e-02   +6.243411799095555e-02   +2.417046064142908e-02   +1.582286395505820e-02   +3.816577895918286e-02   -9.536557551016127e-02];
L3I_L2I_iGABA_netcon = [+2.576739067869709e-02   -8.934363156182820e-02   +4.078907102780847e-02   -2.497085030570100e-03   -2.785276797461777e-02   +2.250039307654540e-02   +4.079370583264807e-02   +3.157583825885579e-02   +3.446533550635239e-02   -9.544592734713389e-02   +2.313046457243793e-02   -5.635842556659189e-02; +8.586548954371581e-02   +4.254510313122398e-02   +4.687315138112620e-02   -3.735192649266772e-02   -1.995057100433517e-03   +1.120848990831984e-02   +7.284393705680217e-02   +5.326015921946517e-02   +5.710029181806302e-02   +1.582863798926547e-02   +5.567255758244215e-02   +5.007340387433090e-02; -1.127609961062907e-01   -8.750523639413056e-02   +4.158890628048986e-02   +1.113172481874390e-01   +5.558717079541996e-02   +4.576818828629645e-02   +3.665788049675879e-02   -7.662129213412766e-02   +8.222002046712804e-02   -3.047222263933439e-02   +9.845856555131186e-02   +5.671567466304831e-03; -9.691457606430569e-03   +9.857537204782996e-02   +8.141470279107714e-03   -2.298272929615566e-02   +6.558330269403834e-02   -5.687462169132430e-02   +8.317645357012290e-02   +4.144426081152586e-02   +5.686891976950073e-02   -1.804926132170844e-02   +7.033525922560847e-02   -2.702355074266632e-02; +6.430852446440462e-02   -2.986228037557073e-03   +4.289479114481796e-02   -4.615240117686412e-03   -3.692643755799979e-02   +7.813925721068862e-02   +1.508276716795644e-02   +1.694787450740409e-02   -8.602496287296998e-02   +7.060164284672812e-02   +5.967458602932242e-03   +3.232460364578271e-02; +2.988648905888762e-02   -8.310648873888994e-02   -1.099316528609052e-01   -2.318444795656667e-02   -6.718726990634614e-02   -7.539519674688100e-02   -2.374710701822719e-02   +6.115824030103086e-02   -1.042798444646305e-01   -4.815639206716699e-02   +3.848321061505755e-02   +8.109150362730787e-02; -6.273305273621878e-03   +3.734078103150235e-02   -1.836820688546781e-02   -4.137835353222272e-02   -9.161124868486308e-02   -1.460640891112288e-02   -4.534374888217586e-02   -5.782162471313403e-02   -3.947690777161354e-02   -1.155607524791706e-01   -5.281911973497947e-02   +6.757089264851747e-02; -2.355277371431564e-02   +3.484202456496814e-02   -3.262404097623066e-02   -2.824347175585512e-02   -3.262233420287819e-02   +3.114358246342969e-02   +3.547788449247839e-02   +7.012847740315560e-02   -8.547086131230160e-02   -7.876444326403254e-02   +9.343987511179819e-02   -4.516073906036931e-02];
L2E_L3E_iAMPA_netcon = [+7.594003101756974e-02   -4.512905970454902e-03   -8.268104804650200e-02   -8.194992692135191e-03   +4.454985529991038e-02   -4.937825821718688e-02   -1.321112009388712e-01   +5.054516139663194e-03; +9.575260253243627e-02   -3.481485509978172e-02   -2.882912297672068e-02   -1.225502834804859e-01   -3.997852627620990e-02   -2.092961487114333e-02   -1.692603930726138e-02   +1.449820766612989e-01; -7.687459426824399e-02   +9.578148520404428e-02   +2.052014019535676e-03   -3.238886465751094e-02   +6.466151787689485e-02   -4.610977722950309e-02   +6.468292327741994e-02   +2.697999595940153e-02; +1.265920263010269e-01   +9.823201273804347e-02   -4.515988866256239e-03   -1.540532278459832e-03   +8.237854989192000e-03   -5.187011476534608e-02   +7.645030701541933e-03   +2.535308899818636e-02; -5.142219550919695e-02   +6.478255785209362e-02   -8.075434289537881e-03   +3.264470262763029e-03   -5.869661180057591e-02   -2.859093972932443e-02   -1.310266336383686e-01   -3.460469453533122e-02; +4.064340137785065e-02   -8.963733261131984e-02   +5.181427616254482e-02   +7.950820627429367e-02   +1.514792024243949e-02   -4.444657076431491e-02   -7.162634953301732e-02   +8.324816701527091e-02; +9.402585261823151e-03   -6.492275144453595e-02   +4.143730672146563e-02   +1.123933627970394e-01   -1.876824589359275e-02   +2.460203894122525e-02   -4.614682454268569e-02   +2.898567734141353e-02; -1.684460147837708e-02   +4.827530194542450e-02   +3.830650874887091e-03   -1.708606786704208e-02   +2.884845003374126e-02   -8.739678731732585e-02   +4.114172059221212e-02   +6.118247693002639e-02; +6.673440748550080e-02   -1.023470403199144e-01   +5.459532648078999e-02   +6.455549694093526e-02   +6.763971376957137e-02   +3.305169439672549e-02   +5.636516465182295e-02   -3.255250994713361e-02; -6.925334502940414e-02   -4.321091136403893e-02   +1.624690023099152e-02   -3.080525124914006e-02   -3.350202264752709e-02   -8.160624753014993e-02   +5.558194001733917e-02   +4.588417805210464e-02; -9.205656104766407e-03   +1.687518119869090e-02   -6.746021510858845e-02   +6.672586814232018e-02   +5.650620592622451e-02   +3.405328126248248e-02   -1.105079326034817e-03   -2.246757442076807e-02; -5.241426246861436e-02   -1.029683457577095e-02   -3.668253749670138e-03   +7.587914632262484e-02   -1.619302779674454e-02   -4.890224491390821e-02   -9.121387482389063e-03   -1.313694201414540e-01];
L2I_L3I_iGABA_netcon = [-2.832072444812391e-02   +4.740719088409777e-04   +5.677716845458552e-02   -1.221026499333967e-01   -6.073513264362224e-02   -1.528093730514406e-02   +6.033116991013485e-02   -1.964797671834652e-02; -5.036343848071149e-02   +5.721930573923078e-03   -5.574348614265647e-03   +4.597531322760684e-02   -3.328494075443970e-02   -2.168373833199151e-02   +1.377214382840345e-01   -5.356744025619800e-03; +7.649946194944302e-02   -1.232202446415727e-02   -8.257777934388005e-02   -1.133738647548684e-01   +2.441013536915225e-02   +1.956366018731558e-02   +3.286869550869714e-02   +6.555201725051364e-02; +1.433994019430043e-02   +4.692618633263099e-02   -2.543924267613896e-02   -4.395415694153987e-02   +3.405723415546928e-02   -5.386077147381949e-02   +5.807004150073639e-02   -1.331680199263262e-01; -8.513737270950913e-02   +2.136488350993570e-02   -1.120065913023016e-01   -1.136597099789163e-02   +4.733073294571518e-02   +2.013025404383485e-02   -4.065853745573296e-02   +4.150949425389094e-02; +5.239658164581111e-02   -6.143388997004950e-02   -3.901945276919770e-02   -1.309771346704717e-02   +8.495372762306166e-02   +1.049400625289666e-01   +7.258994416932273e-02   +6.163579252700183e-03; +4.482780937747310e-02   +1.368474286676490e-02   +6.699039117866910e-02   -8.836587388361772e-02   +2.969013237115220e-02   -6.359864664261784e-02   +8.541355733004453e-03   +1.514688824483952e-02; -1.047805627522985e-02   +1.084897886959356e-01   -3.932561744194422e-03   +3.507530415339777e-02   -4.855816095975556e-02   +3.061357038368072e-02   -5.671366718173139e-02   -7.957353816965683e-02; +6.145904713413008e-02   +6.325728004118841e-02   -3.089740430884824e-02   +4.003381405163162e-02   +6.576935915691470e-02   +3.992322536452925e-02   +1.515644744323757e-01   -3.596689792113834e-02; +3.984634827472033e-04   -7.030706993042607e-03   -3.842442074871429e-02   -2.190497165208896e-02   -6.307348897261577e-03   -1.092129167883752e-01   -2.250273660812002e-02   +4.670682830828969e-03; -5.341299587003084e-02   -7.779595103602025e-03   -1.088160970676028e-02   +4.506955416812621e-02   +8.286698750011270e-02   +5.574314624448699e-02   -9.022867504908135e-04   +2.436282005259457e-04; -8.351303837813734e-02   +1.308699393259073e-01   +9.402994730942043e-03   +1.269518011541466e-01   -6.001540123113581e-03   -1.629065291095378e-02   -7.611527818510494e-03   -7.322160480633236e-02];
L3I_L3E_iAMPA_netcon = [+9.792474333220319e-02   -2.937530881918103e-02   +1.849788921857418e-01   +3.187894256583124e-02   -1.803715156036952e-02   +7.124363526877303e-02   -1.146072911564625e-01   -4.804139286123598e-03   -1.475257690468076e-02   +4.251247584563192e-02   -2.196981448878269e-02   +2.694086585875615e-02; -3.150186673502863e-02   -8.028000961511191e-02   +1.311247670659506e-01   -2.544693328248875e-02   -1.920855301067309e-03   -1.775180914494964e-01   +7.013374104298557e-02   +1.406707164210004e-01   +1.388376328433926e-01   -1.695950683399169e-04   -7.440012583563373e-02   +5.750684912240657e-03; -8.790914279652257e-03   -4.600629644220237e-02   -9.380687078111211e-02   +9.914498122935376e-03   +8.091156324843332e-02   +4.217008489530928e-02   +1.461041583121476e-02   +3.424939657211218e-02   +4.103834871660704e-02   -6.166582805350324e-02   -4.995242775178764e-02   +6.923169423460759e-02; +1.010104864840232e-03   +2.045589888479418e-02   +8.014786147952918e-02   +2.838161034741045e-03   -3.793261252845451e-02   +3.822674976995587e-02   -1.078180369253901e-01   +2.020708222076793e-02   +5.317220721452075e-02   -3.460813996405420e-03   -6.652501137535748e-02   +1.377885745104888e-01; -7.035212578291644e-02   -1.661188474031203e-01   -9.761393849909439e-02   -1.171843739211417e-01   -3.407672955869703e-02   -4.140839236846298e-02   +6.909746630152437e-02   +1.758526579365953e-02   -4.393008929978073e-02   -1.300268386834693e-01   +9.231783673457773e-03   -5.334441099629009e-02; +1.089248263377359e-02   +2.714742248882396e-02   +4.457986009844818e-02   -4.140316522193537e-02   -4.709381333887279e-02   +6.018424151124525e-02   +1.992103340239456e-02   +2.238361249011348e-02   -4.361068760686287e-02   +9.058799918776581e-02   +8.430843370065018e-02   +3.965677378990170e-03; +6.204682144287059e-02   -4.792505478064805e-02   -6.544582053835432e-02   +4.751203438722214e-02   +2.863757959342488e-02   +7.517880720177977e-05   +3.778303483295542e-02   +2.558528817004639e-02   +2.490810956471095e-02   -4.635055151411058e-02   +9.001485360026339e-03   +9.074798114452692e-02; +1.566235424119821e-02   -1.188954607855884e-02   +7.891037708670372e-02   +6.605876305915453e-02   +5.955265722017902e-02   +4.703375595609804e-02   +1.472932106209093e-02   +3.760727453243240e-02   +2.782913364536948e-02   -2.231849704451142e-02   +4.209655359129350e-02   +2.736697621038111e-02; +1.200051754684628e-01   -6.889818640276631e-02   +7.112545309300841e-02   -1.667688118513782e-01   -9.826270078506708e-03   +6.591651858833471e-02   +5.080077472351796e-02   +2.127360846661156e-02   -5.629815813679057e-02   +1.210379193518862e-02   +1.076691216867335e-02   -1.258722886633411e-01; +9.191207803552126e-03   -4.836178471477198e-02   -7.183635511238956e-02   +7.217218507391671e-02   -4.649940392594154e-02   -2.054185292954515e-02   -3.891116595029900e-02   -2.672023559919637e-02   +4.223209350656355e-02   +4.528708661385658e-02   +7.106683021026097e-02   -1.772633536312790e-02; +2.494840716694153e-02   +3.686978237787009e-02   -9.969028965073420e-02   -7.926624192891696e-02   +8.725417384421490e-02   -1.382942567785075e-01   -4.167360656021877e-02   +3.413441187201630e-02   +5.922065165939133e-02   -2.160015689740650e-02   +9.898460781298335e-02   +6.058401314495009e-02; -1.009192991139966e-01   +1.141159220026040e-01   +3.824304791703188e-02   +4.959489565465235e-02   +2.526344537126539e-02   -1.221682607905981e-01   +6.047886688878405e-02   -7.189362711045125e-02   -4.396195562001887e-02   +1.064294015392409e-01   +1.197198936069375e-01   +1.394297646179599e-02];
L3E_L3I_iGABA_netcon = [-7.343990783295687e-02   +6.588801342559877e-02   +8.016745054061836e-02   -1.910685733190724e-02   -9.370716198042836e-02   -9.211620890139192e-02   +4.896429374795336e-02   -1.597919144655364e-02   -9.700449910048832e-02   -9.083477970846953e-03   -2.929948390580392e-02   +1.189959656076350e-02; -5.607159595111608e-02   -3.405477371736187e-03   +1.337003425225009e-03   -5.669344619613513e-03   +1.171257402722754e-01   -2.763884968404434e-03   -3.168518143610208e-03   +5.735725309760967e-03   -7.185104921715503e-02   -6.475716628978331e-02   +1.391361219694578e-01   -2.184083876147929e-02; -9.344968287273792e-02   -8.187639500327075e-03   +6.021336629099339e-02   +1.662761487666072e-02   +5.683727708097663e-02   -4.768931285934888e-02   +3.831891078369991e-02   +8.683241569307394e-04   -8.044528010802696e-02   -7.096299669683608e-02   -4.267149247006247e-02   -2.430988998352453e-02; -2.812816587907542e-02   -2.898799856054121e-02   -4.723677683873291e-02   +2.130597144017461e-03   +3.055352627053313e-02   +8.989051959282364e-02   -1.322817234428431e-02   +8.232434185270882e-03   +9.160870052322406e-02   +2.976291125964691e-03   -4.566114662247438e-02   +6.384843197984631e-02; +3.336386191281082e-02   -4.155404813730999e-02   -9.176210790574442e-03   -5.021324335863409e-03   +3.019957368523143e-02   +2.733486068436591e-02   -3.496491722957644e-02   -1.152096737189316e-01   +3.434311719567837e-02   +1.620930780477250e-02   -2.436652086955739e-02   +1.331152835821060e-01; -6.884788912980924e-03   -4.509160219808402e-02   +1.133243453053953e-01   -1.338962038979212e-02   +3.685100776339757e-02   +4.597457961315016e-03   -1.807397617896791e-02   -9.721831752942980e-02   -7.432687236054647e-02   -2.826437720640270e-02   -4.277709281154932e-02   -6.611629941340180e-05; -1.171345843893465e-01   -3.280610479230600e-02   +6.335971186902656e-02   -1.203181714594544e-01   -6.319541698403730e-02   -9.475090059472351e-02   -2.956913566846087e-02   +6.069272748550665e-03   +3.999235009086870e-02   +1.253836755559045e-01   +1.500586175063654e-02   -5.330091717077609e-02; -1.135996465194130e-02   +8.586429575906607e-03   -8.248885634633407e-02   -2.211904279549188e-02   -8.451463095680579e-02   -1.007951903185526e-02   +5.321367910276761e-02   +5.513881771010270e-02   -5.079642404071297e-03   +4.635207351648277e-02   -4.392371047170285e-02   -6.547228190617130e-02; -5.241122123524896e-02   +1.074454920671735e-01   +4.777057465775876e-02   -6.986549798743498e-02   -1.104048646838573e-01   -1.695187410048441e-01   -8.157131716582926e-02   +6.175378206168620e-02   +1.142208096346907e-01   +5.084112114127848e-02   +5.450735069356515e-02   +3.653030922571376e-02; -1.239584189349570e-02   -6.676029867471069e-02   +1.731432525360790e-02   -8.647454797404877e-03   +5.835076111185997e-02   -6.960346238446523e-02   -6.703018103712083e-02   -9.610024647533636e-03   -1.086964690671446e-02   +1.494017385809222e-02   -1.134923264900679e-02   -6.096817819539557e-02; +8.886111701555202e-02   +2.520338083597553e-02   -3.669342490756713e-02   +5.161969016399087e-02   -2.668315746769878e-02   +1.442093183437241e-01   +1.133824012165944e-02   -3.662634782929375e-02   +5.347311306263890e-02   +4.508294521833990e-02   -2.619356972055766e-02   +8.188232758611906e-03; +1.391867816792381e-02   +2.133783603002945e-02   +5.544460934474582e-02   +7.917162033453592e-03   +8.847733886587542e-02   +1.344613177815640e-02   -4.341467431252991e-02   +6.142972267863619e-02   +3.436848922779541e-03   +1.000025498107390e-01   +3.623725996948144e-02   -5.323400189114524e-02];
L2E_Input1_iAMPA_netcon = [+2.400417889461728e-02   -1.612141576426317e-02   +6.888891735553121e-02   -5.191309232267337e-02   +6.209931032549727e-02   -5.534684054509798e-02   +6.976810431889495e-02   +8.011608911319888e-02];
L2I_Input2_iAMPA_netcon = [-7.797859916946916e-02   -4.288139017471376e-02   -3.503507022100964e-02   -1.403282616979965e-01   +6.148477248591418e-02   -8.735610949014756e-02   +1.258605177546914e-01   -6.212770730735560e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
