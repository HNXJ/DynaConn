function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.155955759281590e-01   +6.540063321936578e-01   +1.497141717682616e-01   +6.838334409092343e-01   +7.793105987157487e-01   +7.820205744277228e-01   +9.156569314966648e-02   +7.612648049297285e-01   +1.135488060260858e-01   +4.039235102465816e-01   +6.932604163487488e-01   +6.998861447369840e-01   +1.968023764719969e-01   +2.280443211888206e-01   +7.576379796060905e-01   +4.373040731815312e-01; +3.732468234183120e-01   +7.487823331318749e-01   +3.802836241049080e-02   +4.343694948957756e-01   +5.213966375433308e-01   +3.638631092267564e-01   +3.669173853759233e-01   +4.074059693196007e-01   +8.702642854420313e-02   +6.447887792384009e-01   +6.748574737142305e-01   +7.559731460325496e-01   +5.425450135398654e-01   +2.808466660809843e-01   +3.174004956014230e-01   +1.913736940830159e-01; +6.210539077612067e-01   +1.505171443245367e-01   +4.119270479686900e-02   +6.525933280256087e-01   +4.778673036443865e-01   +3.805322065006481e-01   +1.150638683267349e-01   +2.862158614708951e-01   +6.471445256406582e-01   +4.559534708585516e-01   +5.673335220051147e-02   +3.078733537685581e-01   +1.991365330481491e-01   +6.853186824108131e-01   +5.852167091000207e-01   +7.912289747225334e-01; +7.538150339914443e-01   +1.416333684501010e-01   +7.276261302947451e-01   +6.651953474159076e-01   +6.882615264370782e-01   +2.949894110058060e-01   +2.775731777828269e-01   +1.162108663699842e-01   +5.176605370630796e-02   +5.308953037365549e-01   +7.155295481650450e-01   +7.333749219698690e-01   +6.022716228249733e-01   +2.098323811424394e-01   +3.421970937894452e-02   +7.507755151525641e-01; +1.007697418482485e-01   +5.942183369116067e-01   +5.542201756997621e-01   +3.528491065988180e-01   +7.388464477187147e-01   +5.892540112818183e-01   +6.702042063929039e-01   +5.547597728877378e-01   +3.312652568920543e-01   +1.342498614921472e-01   +4.571550751776310e-01   +5.506493632873403e-01   +5.500182550159395e-03   +6.491366053307817e-01   +7.691615275685246e-01   +4.778307329853613e-01; +5.839370384073931e-01   +6.015573226110902e-01   +3.374711372124742e-01   +7.004759941881801e-01   +3.494089751648201e-01   +6.801147968882012e-01   +6.917904998382182e-01   +1.411775574100418e-01   +2.645916990878506e-01   +2.440839325675988e-01   +1.715376688654571e-01   +4.697694581743103e-01   +6.138924776924817e-01   +3.948111675262846e-01   +5.899839236568487e-01   +7.007231683391918e-01; +2.507396140683181e-02   +6.874996062525748e-01   +6.888313229781662e-01   +2.188186111603944e-01   +1.788839997711040e-01   +1.567551076506301e-01   +4.781673402238971e-01   +6.691429835911246e-01   +1.342709291166166e-01   +7.444739079653992e-02   +7.354661599126409e-01   +7.349708570865575e-01   +7.050221447217455e-01   +6.473438786484429e-01   +2.763909429646214e-01   +2.011197487884463e-01; +2.140218638364085e-01   +4.328888629613194e-02   +4.715841711469291e-01   +6.726483327237675e-01   +7.769479728128427e-01   +5.433251122966890e-01   +4.824790171166561e-01   +1.772337322879087e-01   +7.050113706483466e-01   +4.043937832109334e-01   +5.554298890135637e-01   +5.712387556508849e-02   +6.621571730123044e-01   +6.899434979784779e-01   +6.747417108128162e-01   +3.125488507474782e-02; +2.196672191263748e-01   +2.232711059846794e-01   +4.412141571850057e-01   +5.860311721169552e-02   +7.270215282610910e-01   +6.840021165056265e-02   +6.434938701900482e-03   +4.227600146877385e-02   +5.405551908346020e-01   +7.304772535180045e-01   +7.176406702544669e-01   +7.986173230673796e-01   +4.424394166156027e-01   +2.605295270483764e-01   +5.688927009907156e-02   +7.786093490033023e-01; +1.746054153015734e-01   +4.342523652567922e-01   +6.924226696282731e-01   +1.489903841923331e-01   +3.818801851781428e-03   +1.997985412617291e-01   +5.955315852237270e-01   +7.406443234533917e-01   +6.762248133299213e-01   +2.248028592713193e-01   +8.172545238363102e-02   +3.467823855843233e-01   +7.468283086603359e-01   +4.239162991690275e-01   +4.841660280935977e-01   +7.974829584732588e-01; +2.571916417929592e-01   +5.965147905884934e-01   +5.309697937782011e-01   +3.448440405891577e-01   +8.823312671539962e-02   +5.405253281482127e-01   +4.885010023196195e-01   +6.498832980219781e-01   +5.139968831982525e-01   +4.090713015669908e-01   +1.814033936909371e-01   +6.089029122121394e-01   +3.347539683680997e-02   +4.518303997236733e-01   +7.744272914051124e-01   +4.138903687015900e-01; +7.954274458182000e-01   +4.089591082110767e-01   +1.607010746207793e-01   +5.682332839886737e-01   +6.304838321634157e-01   +7.102234966591193e-01   +2.182277792271065e-01   +1.681414073489621e-03   +5.636048313927530e-01   +4.574633389071993e-01   +2.737704505027956e-01   +1.679353953705193e-01   +2.602200807971334e-01   +3.254171915886219e-01   +4.993926191862911e-01   +3.421376326326133e-01; +3.831398198357656e-01   +1.050598878431840e-02   +5.498133758339337e-01   +5.764262242306253e-01   +6.304591388667218e-01   +6.353845250854357e-01   +7.140011208287805e-01   +5.525493796338637e-01   +4.220037216250856e-03   +7.583806005152768e-01   +3.711012333649106e-01   +3.349153873333163e-02   +5.646093727584114e-01   +3.373391308399830e-01   +2.097658090435050e-01   +1.304768102743787e-01; +4.765084941811640e-01   +7.532726005447897e-01   +1.354566715577976e-01   +5.369823582360447e-01   +4.168944982036402e-01   +7.351383758647447e-01   +6.905296613202412e-01   +3.019126916343928e-01   +7.997950618522029e-01   +1.221902495301845e-01   +3.453621201423469e-01   +5.932470414561066e-01   +4.863046447002653e-01   +7.628285042512301e-01   +7.858971591932602e-01   +6.416137182311250e-01; +3.657256659667550e-01   +1.869973948918537e-01   +6.236587071487920e-01   +1.825346390157609e-01   +4.989283549324548e-01   +5.360248361652692e-01   +4.170157071054598e-01   +6.886576933058841e-01   +7.801031289412612e-01   +4.082972541431633e-01   +6.285275925897591e-01   +4.819006515250023e-01   +2.573012701747093e-01   +2.972291165465222e-01   +5.713492761855444e-01   +4.995473686324847e-02; +1.583319812574307e-01   +7.409451205497414e-02   +1.051561706087425e-01   +4.975888111887673e-01   +3.760974247153429e-01   +4.293392676190455e-01   +2.620095332605116e-01   +2.083158984193579e-01   +6.100801162698858e-01   +7.893264177905127e-02   +1.048133911436937e-03   +4.862918734850391e-01   +8.612185269100582e-02   +2.459297314641791e-01   +3.323396580653697e-01   +2.602444774234420e-01];
L1E_L1I_iGABA_netcon = [+5.053282802912630e-02   +8.030468093310822e-02   +7.914595992234118e-01   +5.797286618720733e-01   +6.368073305969095e-01   +3.159438864093391e-01   +7.281940343422398e-01   +2.052726110186246e-01   +5.190607634681396e-01   +2.443939695998328e-01   +5.836146520746962e-01   +4.343383092762661e-01   +6.769687687851238e-01   +7.374982745130968e-01   +3.426656255799281e-02   +4.516716113284058e-01; +4.553155806120476e-01   +9.759537081414071e-02   +1.172394321046072e-02   +6.600069455945574e-02   +7.456427601612113e-02   +1.506123410957873e-01   +1.011916288433348e-01   +1.337571894473075e-01   +3.898357108179683e-02   +7.657866088833231e-01   +7.626952027831710e-01   +4.786924054507823e-01   +6.389739605472747e-02   +6.642383672275348e-03   +8.093259030398789e-02   +3.248150403465329e-01; +4.368579213946530e-01   +3.902198152298415e-02   +2.891251059724987e-02   +6.425364007411212e-01   +4.592645441764372e-01   +1.596168202877286e-01   +5.022032237679208e-01   +6.913524724205851e-01   +1.991375668667544e-01   +5.768450063678561e-01   +3.948105020634712e-01   +5.794861021449935e-01   +7.963215300790188e-01   +7.542830386566772e-01   +7.970049509989670e-01   +2.185322600683191e-01; +6.596690067915089e-01   +7.362891937691720e-01   +3.903366176485728e-01   +3.019206526567043e-01   +1.144034079336142e-01   +5.320139065085099e-01   +2.101249552034601e-01   +5.683130508173999e-01   +4.303319115951555e-01   +7.631116016574378e-02   +2.509927968062129e-01   +5.310919563745343e-01   +1.967701735051131e-01   +7.662122107829424e-01   +7.228477230465781e-01   +4.761373974297228e-01; +6.703891760368952e-01   +3.052783064659871e-01   +6.174515685037026e-01   +4.159283540161176e-01   +7.867852437589060e-01   +4.179098385699382e-01   +7.104124412335384e-01   +7.597711245126909e-01   +1.443159504236217e-01   +6.414031237224086e-01   +6.695037586236466e-01   +7.729567009093335e-01   +3.412822062771554e-01   +2.472991816621928e-01   +7.172419669288791e-01   +7.968679178831392e-02; +3.114986978630587e-01   +3.278902485531335e-01   +5.153271791229366e-01   +7.074364078883580e-01   +4.786437931583894e-02   +1.492417482178847e-01   +6.599797176471595e-01   +4.254866831035965e-01   +8.887255104991017e-02   +4.904293457700345e-01   +3.768013884386427e-01   +3.758672913577464e-01   +7.382137854358422e-01   +6.249071254506475e-01   +2.948323963232369e-03   +1.294595425109991e-01; +3.224276106868601e-01   +1.516164719227488e-01   +7.023279985941219e-01   +5.329936232066830e-01   +3.441471563439854e-02   +5.642254632053563e-01   +2.318947533154960e-01   +7.746442904023483e-01   +6.867857051969162e-01   +6.065828852588672e-01   +5.717540225332333e-01   +3.113892773196723e-01   +6.915636582975149e-01   +1.953538162178310e-01   +7.449145632925798e-01   +1.330955489751361e-01; +6.985117572637256e-01   +4.287864692038724e-01   +7.693172827355214e-01   +1.180833025212524e-01   +6.672739461854731e-01   +3.504514347462589e-01   +2.682287860008649e-01   +7.606835333631274e-01   +5.536287732451097e-01   +6.383276183856201e-01   +2.746910582429180e-01   +2.674726641098646e-01   +4.916236979086390e-01   +5.181667256638097e-02   +1.011027316218764e-01   +3.094662552508784e-01; +7.428439786743963e-01   +1.150325180822856e-01   +8.873525602249162e-02   +4.443356074345742e-01   +7.173824790252762e-01   +6.055049496839854e-02   +2.907637761315333e-01   +8.426249959421320e-02   +5.891661016817225e-01   +1.249863756137703e-01   +5.053356202135540e-01   +2.653878414584667e-01   +1.312897356315238e-01   +4.860446989435677e-01   +5.151331600108397e-03   +6.896731936357946e-01; +2.465671439266775e-01   +3.839990338080428e-01   +2.112604362118588e-01   +2.712364313885250e-01   +2.737286536008459e-01   +5.969066999014571e-01   +7.560528813941166e-01   +7.177060767622702e-01   +2.130516711861874e-01   +3.746961949123330e-01   +1.265494331356194e-01   +3.293881233501539e-01   +5.743350183300375e-01   +8.489899924877410e-02   +3.613467819690453e-01   +3.545899133584232e-01; +2.431879960917981e-01   +1.016279088826549e-01   +7.151357819677283e-01   +5.904067456611649e-01   +7.657083709458360e-01   +7.664351712504651e-01   +7.488295165547322e-01   +4.161090004868475e-01   +6.549858628799600e-01   +1.573832373297962e-01   +1.188603507519439e-01   +5.237685473581871e-01   +7.626680248724287e-01   +1.782974057064014e-01   +4.102423231758609e-01   +2.018452150348342e-01; +1.556272478178957e-02   +7.250575731916203e-01   +5.848284286579146e-01   +4.255935066959692e-01   +6.078201467668830e-02   +7.761480067366432e-01   +5.409222851890219e-01   +3.688607789848966e-01   +3.311922739063902e-01   +4.799160929045981e-01   +5.079669147246290e-01   +1.248085281077923e-01   +4.892435018653136e-01   +2.871797840309361e-01   +3.493023146253622e-01   +4.787307441323608e-01; +6.788561776861688e-01   +7.429094459918286e-01   +1.178860707109694e-01   +1.361993079775333e-01   +6.705613298857306e-01   +4.727280711883065e-01   +1.144252537789131e-01   +7.396652562971258e-01   +6.798227811763007e-02   +3.275981015053141e-02   +1.476253390990808e-01   +4.501342772515365e-01   +2.502060989961277e-01   +3.425084000188925e-01   +6.430680445109919e-01   +2.511327253337357e-01; +2.728210774518950e-01   +3.243788793004878e-01   +7.477137597914615e-01   +1.560488330726235e-01   +7.583045961993639e-01   +6.571014170374164e-01   +7.695843245791274e-01   +5.814592267529038e-01   +2.242444089841051e-01   +4.171715825977614e-01   +7.765406578374935e-01   +2.880884973822140e-01   +6.244974963460423e-02   +4.437967383344809e-01   +4.280266615234310e-02   +4.440081279400653e-02; +3.332247281250613e-01   +3.659466594813488e-01   +7.498739557698468e-01   +6.815016686538411e-02   +3.555678454748380e-01   +3.210777250982570e-01   +2.540818398842568e-01   +1.173821017729738e-01   +3.006467472417862e-01   +2.841105064136111e-01   +1.232212019605583e-01   +3.078968538224513e-01   +5.997877381699754e-01   +3.823471344914313e-01   +2.664790707966835e-01   +6.908922855814525e-01; +2.281236836763819e-01   +6.667484305833991e-01   +4.630664034744678e-01   +1.857792662480217e-01   +4.221218038530315e-01   +6.431340252210480e-01   +6.431898752679671e-01   +4.888994502505978e-01   +2.572841621177750e-01   +6.796906397194309e-01   +7.829630911591522e-01   +4.640218006074677e-01   +9.340344577455718e-02   +2.867076441095882e-01   +3.881154515868449e-01   +3.495691298645220e-01];
L2I_L1I_iGABA_netcon = [+4.664596470279530e-01   +7.286226738398007e-01   +1.566179094480648e-01   +7.785002238149765e-01   +1.088815049513806e-01   +3.846248547771396e-01   +2.236385874244484e-01   +7.283161312191969e-01; +5.959988586878177e-01   +6.760456076183609e-02   +7.487203964451847e-01   +7.259494923664150e-01   +3.084040929822725e-01   +2.710855825239739e-01   +6.384450397030564e-02   +2.263540835361518e-01; +2.158091824723002e-01   +2.424323728476546e-01   +2.124599050811551e-01   +3.089984885450707e-02   +6.908003945270008e-01   +3.951659946227204e-02   +6.266780233816720e-01   +2.563370765576165e-01; +2.075107355031480e-01   +9.994322109305853e-02   +6.539136097916809e-01   +1.930697648796143e-01   +1.552192112746471e-01   +3.015939027498082e-01   +1.628804101647250e-01   +1.303589557001981e-01; +4.400807605233374e-01   +2.755070088016494e-01   +1.036065495356964e-01   +6.394270411878352e-01   +7.633282404734153e-01   +5.046090767074779e-01   +2.219248024559606e-01   +7.483536652892355e-01; +7.694722871560119e-01   +1.350004451589649e-01   +2.799356783719951e-01   +2.902222742110696e-01   +5.085222808188462e-01   +8.874834769722684e-02   +7.145658699518637e-02   +6.522720111245908e-01; +5.471765548493160e-01   +4.987138485663734e-01   +2.970340677818036e-01   +4.876892851294239e-01   +3.278572078939879e-01   +6.526586321438103e-01   +2.034447907991642e-01   +2.384369529252727e-02; +3.868785609464551e-01   +5.984985202397214e-01   +4.571365881419776e-01   +2.518153565319610e-01   +6.281432455592333e-01   +6.752383818209560e-01   +1.688860752676269e-01   +1.321433435456529e-01; +1.950185078203236e-01   +7.476034675400184e-02   +5.627858972838284e-01   +3.803691634316745e-01   +5.524751966604491e-01   +3.432821382981855e-01   +7.560378857325292e-01   +5.153791400221400e-01; +4.689889748359379e-01   +4.917575624711130e-02   +4.432319538240239e-01   +6.273831139687019e-01   +6.719532342274773e-01   +4.154124279623818e-01   +1.202092514188692e-01   +4.470019326849127e-01; +1.734965518323314e-01   +6.028977675469304e-01   +4.323163072703245e-01   +7.248964857918206e-01   +2.452912019532047e-01   +4.128820123409969e-01   +5.007377026940081e-01   +1.471081760818057e-01; +2.663784813001567e-01   +5.597478661484145e-01   +6.163957440840820e-01   +6.356601981086973e-01   +4.140376269240364e-01   +4.474158368679079e-01   +6.838460413173160e-02   +1.952321732173960e-02; +6.381111967186666e-01   +1.307893830346968e-02   +7.176597206924480e-01   +4.912758536389153e-01   +3.728677848516309e-01   +1.202523343601231e-01   +5.237836860065075e-01   +3.978022542324052e-01; +4.385928593056647e-01   +2.550699357333108e-01   +5.478779265936720e-01   +7.684706161335901e-01   +7.762482916057458e-01   +6.171298971899521e-01   +4.763241494274453e-01   +4.277725409078794e-01; +3.182702674215216e-01   +6.241693996267198e-01   +4.100365757999991e-01   +3.258627305659734e-02   +5.172532585351182e-01   +1.181747582380866e-01   +7.285988712463272e-01   +4.513534837745813e-02; +7.400257665598248e-01   +1.426173335763796e-01   +2.534869046313536e-01   +6.776768207888776e-01   +5.755890649825441e-01   +6.395589081880559e-01   +5.322444244837683e-01   +3.855424692372086e-01];
L1I_L2I_iGABA_netcon = [+2.225652725838829e-01   -1.395128612615514e-04   +8.278166638585732e-02   +3.099170533685048e-02   +4.916575709375927e-01   +1.317360165927629e-01   +9.302272941450815e-02   +1.710319948460893e-01   +6.681338898620144e-01   +6.025024204291858e-02   +9.975528373412570e-02   +1.193821175182124e-01   +7.040312017795985e-01   +1.248268197741067e-01   +5.987397887258171e-01   +6.548306055365586e-01; +4.981141227710300e-03   +7.255699119390448e-02   +4.068270532626885e-01   +5.839400136254467e-02   +1.146016649660607e-01   +4.179485145985570e-01   +3.914734403495151e-01   +2.161604222043783e-01   +7.863095125249745e-01   +9.276473431113456e-02   +4.362294172300239e-01   +8.278618450826981e-02   +2.273875073767078e-01   +6.112570535092902e-01   +1.135986069154610e-01   +2.849266826005824e-01; +3.565991055653872e-01   +4.622020828233345e-01   +4.637179126707018e-01   +1.505045658912045e-01   +7.692944497529094e-01   +2.708227860073336e-01   +5.470569723946570e-01   +5.060560654102959e-01   +5.239305844420511e-01   +7.696038375468822e-01   +1.376674276411272e-01   +2.853396035140414e-01   +6.231844998712609e-01   +7.521716437923222e-02   +2.903650789073926e-02   +4.897648191367617e-01; +7.436633606216472e-01   +1.127513617592554e-01   +6.496220653486869e-02   +3.384814338074313e-01   +4.599210331187835e-01   +1.825925345973095e-01   +4.686516348061492e-01   +5.989532156678133e-01   +6.266144862067947e-01   +1.018095822119710e-01   +1.502796995392711e-01   +2.772905011899996e-01   +4.171044815056547e-01   +7.616953706235745e-01   +4.722055068183981e-01   +4.180220787490584e-01; +2.322136038807904e-02   +8.825317581792916e-02   +9.949312609511053e-02   +1.751092646779406e-02   +2.141928464665440e-01   +6.672909229369305e-01   +7.078793296401157e-01   +6.513858041196678e-01   +5.606638718454997e-01   +2.753246939886782e-02   +6.583349359795149e-01   +3.566473181852413e-01   +1.856189643680950e-01   +5.478198748050551e-01   +2.412323793023911e-01   +2.161620994169635e-01; +1.423487407947528e-01   +1.489851947173788e-01   +5.734393767185783e-01   +1.241158846718023e-01   +6.277594992535321e-01   +2.607700536278060e-01   +5.067793510768263e-01   +2.782539376260562e-01   +4.666370669178312e-01   +1.489286734321462e-01   +2.696187208962605e-01   +2.828442772258853e-01   +3.873651614351769e-01   +3.620074137241513e-01   +5.316403531443357e-01   +5.627575080934394e-01; +3.204242746438013e-01   +3.318285143002632e-03   +2.545208579988304e-01   +8.836539130875659e-02   +2.779206295875295e-01   +7.734522840326977e-01   +4.370703358922946e-01   +6.050391964313511e-01   +7.699784137748140e-01   +3.461817478443157e-01   +7.443517386240461e-02   +1.380877036680190e-01   +1.731443081763508e-01   +4.275395031926132e-01   +1.016794031888044e-01   +2.182725401522409e-02; +1.209775975244039e-01   +6.870009211840737e-01   +7.876660540150985e-01   +3.160337023902489e-01   +2.785000322614195e-01   +3.815963997665231e-01   +5.648980580091164e-01   +4.916903286852901e-01   +3.723026879813965e-01   +3.796469101848197e-01   +1.004075768040784e-01   +1.950674413562948e-01   +1.154133912433114e-01   +4.902632366574650e-01   +2.713685409539214e-01   +6.825288261538746e-01];
L2E_L1E_iAMPA_netcon = [+1.292141901506476e-01   +9.438676836910263e-02   +8.749465895692869e-02   +6.640114559030615e-01   +4.502926563488834e-01   +3.631671609281852e-01   +2.756032109814860e-01   +5.261455462449077e-02; +1.563174219876917e-01   +3.555406835363023e-01   +1.404617699499945e-01   +8.023132718044086e-02   +3.494335293147077e-01   +7.380758464636638e-01   +5.743209320926209e-01   +2.211382273254066e-01; +1.437008078395633e-01   +6.915969563015519e-01   +3.389937849310282e-01   +5.061636803103733e-01   +6.151642641383774e-01   +4.302626255987944e-01   +3.605057861849765e-01   +1.775925279889140e-01; +2.788521896628288e-01   +3.793836358596596e-01   +5.142171703731051e-02   +7.289290773305795e-01   +4.899801513741642e-01   +3.405682806269639e-01   +3.969895263618537e-01   +6.138738530513200e-01; +7.564353640340535e-01   +6.608873511755529e-01   +3.497525190226763e-01   +5.277165389384633e-01   +2.491595301523266e-01   +1.171435418653933e-01   +6.940888740785514e-01   +1.330993940690516e-01; +3.835639874116519e-01   +2.772937860137282e-01   +2.693796770900521e-01   +1.961413628113046e-01   +6.195711667724868e-01   +7.596319030409773e-02   +1.218001456178844e-01   +2.434562734032810e-01; +6.723977716538897e-01   +3.926542114509021e-01   +6.794943137911387e-01   +5.195192610344355e-01   +3.234793593714950e-01   +3.410823241075795e-01   +1.469321268181917e-01   +1.520793013406243e-01; +1.046133301676869e-01   +5.366283636708504e-01   +7.002915569224836e-01   +2.862962216980103e-02   +4.134647172650608e-01   +3.554191822847670e-01   +6.629987297868268e-01   +3.826484334630595e-01; +7.782322993654888e-01   +5.746438106482920e-01   +1.585377383010860e-01   +3.197594077626829e-01   +6.290263114509540e-01   +7.109813482494896e-01   +6.497602327170499e-01   +6.623284843525987e-01; +7.837660298673585e-01   +5.398695596624993e-01   +3.216996673177625e-01   +6.368130867761709e-01   +1.263324095935099e-02   +3.520674892038498e-01   +3.358792191867272e-01   +3.645798343140829e-01; +5.286210225034841e-02   +1.171724675151929e-01   +3.221855374628751e-01   +6.470151089548642e-01   +2.641941539587372e-01   +1.628265772271038e-01   +1.376351704734999e-01   +2.354856530501089e-01; +3.361940922097297e-01   +4.033463573456925e-01   +3.093304730002906e-01   +6.492579677067800e-01   +2.827404748629312e-01   +6.822533280710776e-01   +2.002252121765927e-01   +4.137536415570909e-01; +1.011901494813429e-01   +3.427596208761037e-01   +5.705327995375929e-01   +6.118494558303401e-01   +5.989437257452661e-01   +4.914390430366901e-01   +5.570375967672973e-02   +1.432093583089716e-02; +4.176149352683792e-01   +1.573324773512811e-01   +1.208123474146962e-01   +3.430052376269328e-01   +3.510374095230596e-01   +3.166631299190055e-02   +3.522296015246305e-01   +3.696372786102403e-01; +3.221827359811936e-01   +4.195185374278384e-01   +5.185853342892719e-02   +5.142234296538214e-01   +6.389388377909790e-01   +4.611881926860281e-01   +6.510914562190182e-01   +1.686408145041479e-01; +1.395491144492535e-01   +4.266318759754631e-01   +2.886511356523481e-01   +6.699054631739008e-01   +4.706239306338417e-01   +1.106125703351602e-02   +3.303369009500108e-02   +5.724578005410772e-01];
L1E_L2E_iAMPA_netcon = [+4.640740740529633e-01   +7.455901653443117e-01   +2.289298607261621e-01   +2.074831669466234e-02   +4.315213991990958e-01   +1.110336527784440e-01   +1.657428856359402e-01   +3.371860609150148e-01   +4.459107875099279e-01   +7.644777009303871e-01   +6.289803435363560e-01   +1.571723662259096e-01   +8.800455003870135e-02   +7.985433045071139e-02   +3.591718696302477e-01   +2.895376675866397e-01; +2.455887491602173e-01   +5.143569029424999e-01   +5.336821826633277e-01   +6.762367728494467e-01   +2.265175920872789e-01   +4.643307932268467e-01   +2.345129749885046e-01   +3.857493851938175e-01   +4.600277180481287e-01   +3.313433505502343e-01   +5.235067840802603e-02   +6.661683019351659e-01   +4.098847241471014e-01   +5.731695441871623e-01   +6.773105271007445e-01   +4.803201622478004e-01; +2.082447818167510e-01   +6.411633872281188e-01   +7.301439608567004e-01   +2.402899231614556e-01   +4.844234273608709e-01   +4.473648170119630e-01   +7.710360310289344e-01   +7.825465722457072e-01   +6.007800792238084e-01   +3.095171396426035e-01   +1.845846376693291e-01   +2.318481768720130e-01   +1.262761719984175e-01   +4.497896077428438e-03   +7.453290576803734e-01   +5.128441816545279e-01; +1.115425943325785e-01   +7.762119078020064e-01   +6.557621889453334e-01   +5.252438669414857e-01   +2.340817656769435e-02   +7.119823950268706e-01   +7.421698098449627e-01   +3.850271430797165e-01   +7.122404247342642e-01   +6.518910740780739e-01   +9.887121216595122e-02   +3.624617503668330e-01   +2.525465996249268e-01   +4.449440677616083e-01   +7.109962023928956e-01   +1.012492232376373e-01; +1.689833983751231e-01   +5.048300776199535e-02   +3.690925541334221e-01   +3.736190512449991e-01   +5.571267433672082e-01   +5.121845120656705e-01   +2.259548239382502e-02   +5.890781560451119e-01   +7.703386408609815e-01   +7.477760807788890e-01   +6.974892348691470e-01   +5.983648943598519e-01   +5.640151743189543e-01   +1.429570048488677e-01   +4.606558198695267e-01   +7.311657501839590e-01; +7.159256393467576e-01   +5.709359851473024e-01   +2.504956235358002e-01   +7.791109670900720e-01   +3.496072919111901e-01   +6.251891986753880e-01   +4.497154616005326e-01   +7.629745775370922e-01   +3.464372922665549e-01   +5.780033917096711e-01   +2.759222788920977e-01   +5.220168308222577e-01   +6.674756259064127e-01   +3.968404825264185e-01   +4.984167286684563e-01   +6.065785938050342e-01; +6.655267034817709e-01   +2.554934313419162e-01   +2.567666822377637e-01   +5.848906113286892e-01   +6.449535352464676e-01   +1.031261820739736e-01   +9.046779395997925e-02   +7.971395267918836e-01   +4.092192867246613e-01   +7.756186192226699e-01   +3.731449654033591e-01   +7.658403671573972e-01   +9.149769602257950e-02   +1.985812719264344e-01   +1.837385587436511e-01   +1.473063872896504e-01; +2.627025678284836e-01   +6.526407025400448e-01   +8.652206119877717e-02   +3.383192876912280e-01   +1.837548201565918e-01   +2.367627489512788e-01   +7.691729381606537e-01   +3.764083249815591e-01   +2.326191646927120e-01   +1.428598824248337e-01   +6.422688195618859e-01   +3.113571507528172e-01   +4.073284480410927e-01   +5.455061223445671e-01   +6.192097396989067e-01   +7.800009279604110e-01];
L2I_L2E_iAMPA_netcon = [+4.030517664450918e-01   +6.904953102536633e-01   +7.504367876244652e-01   +3.956399759473664e-01   +4.702244712712947e-01   +4.991541814790628e-01   +3.758883570420098e-02   +7.913155079376698e-01; +3.153657376725187e-01   +3.917786657642794e-01   +3.592154518397799e-01   +1.413851122049314e-01   +2.839921435193946e-01   +6.464980440431303e-01   +2.839464190848181e-02   +1.044191638629324e-01; +2.746901917924026e-01   +8.911531656103966e-02   +7.632819293073368e-01   +7.705572887736803e-01   +4.399920999043085e-01   +5.273617552760559e-01   +5.681519523739181e-01   +4.485930459252546e-01; +4.672040388436067e-01   +5.945022604312840e-01   +1.751376780157068e-01   +2.784006746064289e-01   +3.817116993174572e-01   +4.347303280008447e-01   +1.908465864182392e-01   +1.419577070117895e-01; +3.580859132433789e-01   +3.575719713359843e-01   +6.546888253193004e-01   +6.410207462927634e-01   +1.267074909383355e-01   +1.021355789221899e-01   +2.647311259997964e-01   +6.233175616064179e-02; +5.425212182161970e-01   +4.112282573904522e-01   +3.313876504172901e-01   +1.813743834223035e-01   +3.601308147972235e-01   +3.604604592993753e-01   +5.195592238735254e-01   +4.458314644732192e-01; +6.274642226784952e-01   +7.146229543931860e-01   +5.516692212498181e-01   +4.106039199510599e-01   +1.540825591502754e-01   +4.570160594877088e-01   +3.268813541812098e-01   +6.678952517830193e-01; +3.168102581574072e-02   +5.405842487961349e-01   +6.653623979517186e-01   +7.670867375569849e-01   +5.905648300832235e-01   +1.037529132585874e-02   +6.284695735341066e-01   +6.434592895710685e-01];
L2E_L2I_iGABA_netcon = [+4.971881784469836e-01   +7.583448066371471e-01   +1.265113170333140e-01   +2.608659057044025e-02   +7.761788140765732e-02   +7.765899530621205e-01   +5.169448767533218e-01   +8.569389293267964e-02; +3.495597794173778e-01   +3.485372863133248e-01   +6.194299360729119e-01   +1.003287212259948e-01   +6.719758095183422e-01   +7.893969059056302e-01   +6.479811401091491e-01   +1.912343167586365e-01; +1.761046477134655e-01   +6.841121070730514e-01   +1.926755561333366e-01   +1.873046970874875e-01   +6.662146717490109e-01   +1.441145398499241e-01   +7.347694049745120e-01   +1.096645379943789e-01; +2.877249723394958e-01   +3.159688420796193e-01   +1.879664252913045e-01   +2.081764743632123e-01   +2.069364502605686e-01   +2.948980230111709e-01   +5.339455147287110e-01   +4.121148143044074e-01; +1.628763703231434e-01   +7.445177880991650e-01   +1.182147947947652e-02   +6.416440176371734e-01   +2.199133321046186e-01   +6.575948608991303e-01   +4.657266608164098e-01   +4.629012560151008e-01; +1.470543997704773e-01   +2.208368330540216e-01   +5.005757718226626e-01   +4.253487478235783e-01   +7.648150083982794e-01   +6.250954045189790e-01   +7.669814989871258e-01   +9.526867900503520e-02; +6.701004256053538e-01   +7.563260766547083e-01   +3.000161053671798e-01   +6.658376232745771e-01   +2.746757214502453e-01   +5.103385084677532e-02   +1.936115217273282e-01   +2.775586900871381e-01; +2.672447485848820e-01   +2.236051186621907e-01   +1.888442110105204e-01   +7.577901220497938e-01   +6.620569509144323e-01   +9.317372110067706e-02   +2.268085330348368e-01   +9.103444372261971e-02];
L3E_L2E_iAMPA_netcon = [+5.251564309658736e-01   +4.384648597259316e-01   +3.941383250890831e-01   +5.140225425927867e-01   +2.703433827702098e-01   +7.826459374652882e-01   +1.890516240982701e-01   +3.776062918377255e-02   +3.072624494226974e-01   +1.037040536418850e-01   +2.990692025515337e-01   +6.617004478724453e-01; +6.542389923532042e-01   +3.097184512276142e-01   +7.862382558412850e-01   +6.182610268297783e-01   +3.251703564740623e-01   +2.167267503928817e-01   +1.141863571890059e-01   +5.024167463886278e-01   +7.629098106683966e-01   +9.568401568528959e-02   +2.326368606342694e-01   +7.547406977576180e-01; +3.725004000697958e-02   +1.049578608638170e-01   +3.014842962955892e-01   +6.282545816413120e-01   +7.066183340525375e-01   +1.677412928440815e-01   +1.880731588673555e-01   +3.141238758867307e-01   +8.183651235368038e-02   +2.685867009281168e-01   +1.645339455575124e-01   +8.618247341847819e-02; +4.237221856036149e-01   +5.377798696762451e-01   +5.871763344317150e-01   +7.304720497480564e-01   +1.117393854143511e-01   +7.311968688492068e-01   +3.070261146020133e-01   +4.769864388301427e-01   +7.862208487064244e-02   +6.434563603642601e-01   +1.775615856074823e-01   +8.552642736331773e-02; +3.146468068643692e-02   +6.982648224158325e-02   +2.639506206224021e-01   +5.325921776772119e-01   +5.785567660738347e-01   +5.100555287729284e-01   +6.860164681845917e-01   +3.150046641383072e-01   +4.506010682759360e-01   +4.298722648340490e-02   +1.910858350074920e-02   +6.627107447382021e-01; +7.534568434021491e-01   +4.715202234317143e-01   +6.063853757369972e-01   +7.243620581799152e-01   +1.582370877209409e-01   +3.902939862760577e-02   +2.793246914307738e-01   +2.923620941497880e-01   +5.900534882422770e-01   +3.242462811224113e-01   +3.752823200513001e-01   +4.601460529496821e-02; +1.808369047154417e-01   +1.220504293333749e-01   +7.463645892868787e-01   +3.696972229727694e-01   +3.296429365147813e-02   +2.470564238367018e-01   +7.166795700989055e-01   +1.537362166254521e-01   +6.589570017680160e-01   +3.452784081153039e-01   +3.520571037597819e-01   +8.621066175760565e-02; +1.193876200607967e-01   +1.216660514805659e-01   +5.237913781394937e-02   +3.664502783382892e-02   +4.852174211166188e-01   +3.203716627842607e-01   +4.625350829111856e-01   +6.991345862646416e-01   +1.953984396010323e-01   +3.690359946287704e-01   +4.599512344107167e-01   +5.235454818045858e-01];
L3I_L2I_iGABA_netcon = [+5.875507603349668e-01   +6.309835764762233e-01   +3.067928267085239e-01   +3.095633932347836e-01   +6.362442813244863e-01   +3.733688149477076e-01   +2.540175599311661e-01   +1.326165424468470e-01   +3.571074344008808e-01   +3.634666571512929e-01   +1.110347664428373e-01   +3.436691337834817e-01; +7.837908128070042e-01   +4.743154934890939e-01   +1.528181385611024e-01   +7.262138592681815e-01   +6.738170336232350e-01   +3.439698162873346e-01   +5.683400335663464e-01   +4.919382465423082e-01   +6.748545082294838e-01   +5.440367398427175e-01   +1.445716595015873e-01   +1.417245367728109e-01; +4.605929293928638e-01   +4.072021454939707e-01   +1.973495443973491e-01   +9.067304148246536e-02   +3.697350422506697e-01   +1.055444393459646e-01   +4.587155024817982e-01   +4.675002871824832e-01   +1.101171720018200e-01   +4.943410336463238e-01   +4.465935846920107e-01   +1.858440509742426e-04; +6.764242090490777e-02   +7.563941990857883e-01   +5.963071318281472e-01   +6.353271107352395e-01   +7.242136882104661e-01   +1.898699429096272e-01   +5.722846848350437e-02   +1.821535985085694e-01   +2.091027827564113e-01   +2.882279888057355e-01   +2.584296259317523e-01   +1.260851640346300e-01; +7.452181252931965e-01   +7.668794719830727e-01   +6.662135410595225e-01   +5.791684283929721e-01   +6.854937473890000e-01   +2.907757142536804e-01   +1.708570234718255e-02   +4.953847823002357e-01   +3.262098022891450e-01   +3.162696215160281e-01   +6.611934031112428e-01   +2.063349832571078e-01; +7.523676499294453e-01   +3.517208209894956e-01   +1.252359731545867e-01   +4.890993645937396e-01   +2.201057067365571e-01   +4.999992416507762e-01   +3.730099202314374e-01   +5.819035367539893e-01   +5.763954282372129e-01   +8.332781341903195e-02   +1.960742947613856e-04   +3.171340048347799e-01; +7.225692472289604e-01   +3.448706703078650e-01   +7.923713578897730e-01   +5.498801772194220e-01   +4.421525409279384e-01   +7.357282146343791e-01   +2.909325948167301e-01   +3.104813969779152e-02   +3.729398170755504e-01   +7.331772889354551e-01   +1.501535523664113e-01   +7.109378013339014e-01; +6.430070774963329e-01   +1.108004383789762e-01   +5.142200402337128e-01   +5.619541449478586e-01   +1.313582018972235e-01   +7.322304411545574e-03   +2.896054291611803e-02   +2.947352570123599e-01   +6.127814612552221e-01   +1.407534187527447e-01   +6.810781828590750e-01   +2.253387012613888e-01];
L2E_L3E_iAMPA_netcon = [+2.315668489350039e-01   +7.598576447686048e-01   +7.469533047626561e-01   +4.796542745196056e-01   +7.445367402247776e-01   +9.059153615152998e-02   +2.732602149947814e-01   +5.499774490420363e-01; +7.217257546056853e-01   +6.395915774240527e-01   +5.344587160914390e-01   +4.302818573582121e-02   +2.110141188181324e-01   +3.766769405832178e-02   +2.680624696867231e-01   +4.271861118503343e-01; +4.874217483037594e-01   +7.918532278094154e-02   +2.938094890474131e-01   +4.291579083971119e-01   +3.915260541265398e-01   +6.078210946989783e-01   +2.049733010875131e-01   +6.233172924991675e-01; +7.933018848428788e-01   +7.896658479762363e-02   +1.497229240124526e-01   +4.494374030702550e-02   +3.134017011184744e-01   +7.684455546042256e-01   +5.824514984339698e-01   +5.797538150523709e-01; +4.430547868003529e-01   +7.676441822040442e-01   +1.681160978915876e-01   +7.426958672520347e-01   +4.826128707470445e-01   +1.701163336729094e-01   +6.373412108018868e-01   +6.541518445616722e-01; +4.887700034656686e-02   +9.584990575086001e-02   +2.118317011205093e-01   +2.736946538491249e-01   +3.875923455089276e-01   +5.073258681097025e-01   +1.840320600325971e-01   +5.065369338945216e-01; +4.824035801537051e-01   +3.645374147683179e-01   +2.777337934281891e-01   +2.244782206546587e-01   +7.646661631383836e-02   +5.124664048281382e-01   +5.310653965769013e-01   +3.552793487790263e-01; +3.531823804713075e-02   +3.763129221569627e-01   +6.543033677853101e-01   +6.089706458586246e-01   +6.668819403915195e-01   +3.854682919165096e-01   +3.441113737065026e-01   +3.282960385312641e-01; +1.192124353354136e-01   +3.132131175160163e-01   +4.991698530731618e-01   +6.401847383468636e-01   +5.490207088839439e-01   +2.571182350316071e-01   +6.999042518534077e-02   +5.439984887777218e-01; +1.074868871133061e-01   +5.977160476112866e-01   +5.569798937513151e-02   +3.935002630126445e-01   +1.544981825087305e-01   +7.192523336076607e-02   +7.391177447386189e-01   +4.609864194770917e-01; +9.170923579041097e-02   +1.612529212000793e-01   +3.877470761201691e-01   +7.847589611033197e-01   +2.392631840776523e-01   +6.427999794270402e-02   +7.202517964005420e-01   +1.554378691646152e-01; +4.591898920876848e-01   +4.882373133103699e-01   +1.505327435993533e-01   +6.935418664024537e-01   +5.479034723762584e-01   +3.721044246524931e-01   +7.533612023106873e-01   +3.529873401783665e-01];
L2I_L3I_iGABA_netcon = [+3.947527257484144e-02   +5.221811171046007e-01   +3.846089351732895e-01   +3.348759657770338e-01   +2.495128345764147e-01   +3.788084532363501e-01   +2.862573616779109e-01   +1.795735956695014e-01; +3.571024207995016e-01   +5.098177743153428e-01   +4.694366401396741e-01   +3.950044696383167e-02   +4.661887646729670e-01   +6.331820838664758e-01   +4.283074180907082e-01   +9.388115565068324e-02; +5.252191116864270e-01   +5.195926550313559e-01   +4.199801204666195e-01   +3.167014395389069e-02   +7.117163399637332e-02   +4.807951302265680e-01   +6.071716782190998e-02   +3.254694340199292e-01; +7.960959826399853e-01   +1.101423685161755e-01   +3.269403589521334e-01   +2.072221570275478e-02   +2.602771571303943e-01   +3.711494443509036e-01   +6.283239495573216e-01   +2.414174121224493e-01; +7.729386494266255e-02   +3.077308335268453e-02   +1.333967893401295e-01   +4.749522756957516e-02   +5.641339339635246e-02   +7.155600461087651e-01   +4.874679309566238e-02   +4.875027797049596e-01; +2.877546916717495e-01   +6.254827140087506e-01   +6.813646150566924e-01   +7.807961251034876e-01   +2.168548024228100e-02   +4.928204450759751e-01   +5.766068347439923e-01   +6.795209275088024e-01; +8.112364448554282e-02   +1.797162000297843e-04   +1.382210796308108e-01   +2.118788332862292e-01   +4.907684828404501e-01   +1.457634217299762e-01   +2.556788842601633e-01   +8.492883860086571e-02; +7.009243615717420e-01   +6.146162696878493e-01   +1.487368800204666e-01   +2.474156945711804e-01   +1.056249307341078e-01   +1.592170560577731e-01   +7.611015518708388e-01   +2.301655602107563e-01; +6.174083766419940e-01   +3.790732058129334e-01   +7.328151781845788e-01   +2.154461529724789e-01   +1.167851257060044e-01   +2.962040031072479e-01   +6.099326793289233e-01   +5.583595534658506e-01; +2.084747513438862e-01   +7.351259823996897e-01   +1.844956068071446e-01   +1.452655947757470e-01   +1.485211866096878e-01   +1.218771988252799e-01   +3.019786338011265e-01   +5.806651677370706e-01; +6.139861702950627e-01   +3.286798100299063e-01   +1.801501966629765e-01   +1.874667646030384e-01   +3.820461635829729e-01   +2.100823688440376e-01   +4.422736246822127e-01   +5.458246945985610e-01; +4.107920312710840e-01   +2.485103305196051e-01   +4.113234635055595e-01   +2.159950736223283e-01   +2.226637553487152e-01   +8.964643827743791e-02   +3.699051787948488e-01   +7.536229339651075e-01];
L3I_L3E_iAMPA_netcon = [+4.848629037790356e-01   +4.316791538177452e-01   +5.545279725423669e-01   +2.114003133134474e-01   +7.293920068335309e-01   +5.430609160599797e-02   +2.217682266844804e-01   +5.191004867074405e-01   +2.936346410862333e-01   +1.373143986424459e-01   +7.347596435411532e-01   +5.451334783068172e-02; +8.759350118852689e-02   +4.861520993150398e-01   +5.357433859213949e-02   +1.748877806134294e-01   +6.738843594286416e-01   +6.824477384665062e-01   +3.828268475005841e-01   +8.242197702832332e-02   +7.416864580176784e-01   +6.430961318477777e-01   +4.799266797586853e-02   +2.059605838452288e-01; +3.590235397222042e-01   +6.593225186790914e-01   +7.610304622654825e-01   +6.464131139598008e-02   +7.879434530431517e-01   +7.721441571800749e-01   +2.458710481866924e-01   +7.637523472723158e-01   +5.246496926974076e-01   +9.972022442260126e-02   +1.251803509957641e-01   +7.947161768814703e-01; +7.962656575221431e-01   +2.059698718773544e-01   +3.966447658279562e-01   +3.192336536230209e-01   +4.054004220601541e-01   +7.818001096192284e-01   +4.302871364985134e-01   +3.199538467901092e-01   +6.345051333202210e-01   +4.521515995588967e-01   +1.498635702727433e-02   +2.903824200685530e-01; +2.933096519983260e-01   +6.079033047390184e-01   +7.030567549516763e-02   +1.262394016677624e-01   +2.184373996486045e-01   +4.526480842672449e-01   +1.577822628074196e-01   +2.551631231728974e-01   +7.384982253062862e-01   +4.041003585703211e-01   +2.254510022586282e-01   +7.523472021423187e-02; +4.928118048620490e-01   +3.326326898356021e-02   +2.978060400001801e-01   +7.958959311022361e-01   +1.223134910850368e-01   +3.355818567948302e-01   +2.340660678786546e-01   +3.691389516019983e-01   +4.264951109221977e-01   +5.369638299106974e-01   +7.650073585100462e-01   +7.326470101119023e-01; +4.480421871113689e-02   +2.705567356933311e-01   +7.778901203094258e-01   +3.692840146286508e-01   +6.743516387746441e-01   +2.233955445337068e-01   +7.591057428030590e-01   +3.773030146818015e-01   +4.094184256384688e-01   +6.027833895191188e-01   +5.107632057777325e-01   +6.768696892486761e-01; +7.865471792483386e-02   +3.474158221224221e-01   +7.444742992269532e-01   +2.557234420684822e-01   +6.846995598578517e-01   +6.103576092222879e-02   +2.496615525103612e-01   +7.836035554391577e-01   +7.198534134035532e-01   +4.448173387694370e-02   +4.566597672993018e-01   +2.996407523462248e-01; +2.186285573602554e-01   +3.492699878367936e-01   +2.790642005182660e-01   +1.811767483665514e-01   +1.057550191579749e-01   +7.865700558873530e-01   +5.928588087576430e-01   +3.807931525331194e-01   +3.311605959184798e-01   +3.038614540691270e-01   +5.134052704489670e-01   +7.417280963984313e-01; +6.294005041752383e-02   +2.315501812025968e-02   +5.873622430189219e-01   +2.928906151743355e-01   +6.278032385247959e-01   +3.004762659817618e-02   +6.549333010445505e-01   +7.898671238102289e-01   +7.739588016601326e-01   +7.668760884504555e-01   +4.860187691114667e-01   +6.143337491473626e-01; +5.329523733141696e-01   +6.610297603325350e-01   +4.492875621909446e-01   +5.315245661837269e-01   +7.579344135419618e-01   +3.831499006226086e-01   +7.056808663329813e-01   +1.572772230758906e-01   +1.176569819345159e-01   +2.642937622783937e-01   +4.726661987923626e-01   +6.752585914122997e-01; +7.556698529628817e-01   +7.184271521108583e-01   +4.818639748307831e-01   +2.491803969691402e-01   +4.606844933217590e-01   +4.321633982865499e-01   +6.661467947203102e-01   +5.142331879914592e-01   +3.936373539862232e-01   +7.361328009593252e-02   +4.309790698564778e-02   +7.379300139164959e-01];
L3E_L3I_iGABA_netcon = [+8.630472459900083e-02   +5.029575789012392e-01   +6.883515853296925e-01   +6.321959854286338e-02   +6.604386916892352e-01   +2.372011792607933e-01   +3.868096865779906e-01   +1.434688002281446e-01   +7.947583848551168e-02   +2.701761416210838e-01   +1.355367154099419e-01   +3.562562301560650e-01; +1.753542631219563e-01   +1.345270028515163e-01   +1.132220376102123e-01   +2.926687711809224e-01   +6.849905065200564e-02   +7.735748702294228e-01   +5.023173608896511e-01   +5.683276790823927e-01   +4.611361358241350e-01   +3.246083066662993e-01   +4.864744113635380e-01   +7.609780614511074e-01; +1.760066436923652e-01   +3.162155887318523e-01   +2.347757443657133e-02   +3.133160871701786e-01   +9.703899299845149e-02   +6.713713916157377e-01   +5.459129288586811e-01   +7.244994224425005e-01   +5.537776760962290e-01   +1.715047143543452e-01   +6.646329183271132e-01   +7.809065127001241e-01; +1.638594955061214e-02   +7.046416349915451e-01   +3.166888990500161e-02   +2.135923928042068e-01   +6.835832401481121e-01   +3.503263804889794e-01   +6.744129543934483e-01   +5.014449588210013e-01   +1.283340548776154e-01   +7.092412770197859e-01   +3.667271899998829e-01   +6.321651509173611e-01; +4.443568679736960e-01   +6.246089525438039e-01   +5.236098880401620e-02   +3.165925266750153e-01   +5.086262905907446e-01   +6.506795434896012e-01   +7.330964684725019e-01   +3.824196207884858e-01   +5.942394704089784e-02   +6.829929585708023e-01   +4.415659492302851e-01   +6.019003031208011e-01; +2.841255814866377e-01   +9.581889642022770e-02   +7.789850272386537e-01   +3.270888323808392e-01   +1.247222114787640e-01   +1.754858552709797e-01   +7.328761878448408e-01   +2.872748659684995e-01   +4.154610939099380e-01   +5.356283673768456e-01   +1.477840106452774e-01   +6.623137245114252e-01; +1.474612976871824e-01   +3.377501832189983e-01   +7.142577676555856e-02   +5.773616911847440e-01   +3.141708109138650e-01   +2.543832075752402e-01   +2.170095167657785e-01   +1.111426444063881e-01   +7.017132892603959e-01   +2.209489432297707e-01   +3.055035780070563e-02   +1.742022087362214e-01; +5.204163009641806e-01   +4.632163155248741e-01   +1.231291370395125e-01   +5.263479746022763e-01   +6.344852590808295e-02   +5.412244669309973e-01   +3.234870541782252e-01   +7.431256245919784e-01   +6.052100094666076e-02   +6.776309959789351e-01   +6.417129709737827e-01   +3.997713314615355e-01; +7.075520217278624e-01   +8.279013365109338e-02   +5.286430412678714e-01   +1.779284574195874e-01   +1.750059372816864e-01   +3.233468328212910e-01   +9.479672954668529e-02   +3.460490247051366e-01   +6.439188810678430e-01   +3.635477631324694e-01   +2.965078981545773e-01   +4.811084628059219e-01; +2.657813213497527e-01   +5.132270050112355e-01   +4.714915085338905e-01   +7.754901036079715e-01   +1.023832319266042e-01   +7.665966984439584e-01   +4.074461612632973e-01   +6.743161847602624e-01   +8.879147705259106e-02   +7.692017221008963e-01   +5.955537414377764e-01   +6.204746017756404e-01; +8.045011291692637e-02   +5.708776710821021e-01   +5.373426885299106e-01   +7.865418517579038e-01   +3.909723794172763e-01   +2.299358771517434e-01   +4.151438052705866e-01   +3.065097669584422e-01   +2.451567455741288e-01   +2.031900359260021e-01   +6.559748607467294e-02   +2.226335214279489e-01; +5.933686628256230e-01   +4.605089483010458e-01   +3.747383034143594e-01   +5.842212717829718e-01   +5.379252215373042e-01   +7.068603791868612e-01   +4.211039587442351e-01   +1.963947325753265e-01   +6.770949688149306e-01   +7.844957551730351e-02   +6.847627910352093e-01   +4.535852206308426e-01];
L2E_Input1_iAMPA_netcon = [+2.110696483387762e-01   +2.118690148859411e-01   +5.208790646859722e-01   +6.318528283727097e-01   +6.742768949686730e-02   +2.199915470698678e-01   +4.934828408029472e-01   +1.881377695688954e-01];
L2I_Input2_iAMPA_netcon = [+4.048449951851952e-01   +7.916145748487826e-01   +4.855640941353583e-01   +5.078036578204728e-01   +2.282675963502918e-02   +4.816630290766175e-01   +2.110568125301852e-02   +7.303625930082329e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
