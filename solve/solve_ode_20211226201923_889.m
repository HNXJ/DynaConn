function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.795971432177260e-02   +3.348913676025779e-01   +2.435486697398977e-01   +2.616053165110368e-02   +4.821475077657924e-02   -2.407854081555224e-01   +9.356866042574059e-02   +1.781240208989237e-01   -2.178829427072809e-02   +1.307485153798469e-01   +1.421162974581170e-01   -1.213065864549327e-01   +1.688806088630918e-02   +8.005378587889689e-02   +2.830184493291095e-01   -3.139569049335740e-01; -2.473135388089451e-01   -1.796251389987106e-02   -1.971264767857913e-01   -6.027004090505586e-02   +1.687957588939097e-01   -1.462690307327882e-01   -1.299333525221816e-01   -8.107942824158071e-02   +1.839471444181680e-01   -1.579979584407600e-01   -7.544410037439604e-02   +2.126414433610246e-02   -3.869399277751313e-01   -1.511545128825207e-01   -4.238995893419627e-03   +4.258284727373137e-02; +9.327896866908737e-02   -5.757799348423448e-03   -2.156595409067285e-01   +9.196847372194503e-02   -5.784758131532475e-02   -1.979487972428579e-01   +2.027257973307371e-01   +1.227943542136426e-01   +3.091455684956460e-01   -2.586716996865250e-02   +2.158311460799647e-01   -1.072843732880231e-01   -1.780021574779846e-02   +1.336549386508652e-01   +5.156751171707586e-02   +1.312836854133746e-01; +1.393813209584861e-01   +1.319280979662592e-01   +2.150651178865582e-01   -2.994857609482111e-01   -3.026448153612088e-01   +1.350469046924724e-01   -1.051111815581598e-01   +2.186337044943197e-01   -7.077936384837381e-02   -3.029949259898978e-01   +3.103271654983608e-01   +2.268284983682426e-01   -1.961401640451143e-01   +3.716565559351552e-01   +7.371367014684783e-02   +4.738540831973446e-02; +1.863135743816087e-01   +1.332511053631837e-01   -6.156807690620685e-02   -4.579380646701690e-01   +1.677767505862858e-01   -2.637270050968657e-03   +2.168019979724714e-01   +1.554462055302449e-01   -2.714945992707969e-01   -1.525108982560634e-01   -1.588326922814850e-01   +1.410170863628897e-01   +8.366089176291534e-03   +2.231934864149029e-01   -2.060300825085041e-01   -4.015153998933905e-01; +6.269074108146730e-02   -7.738766008201804e-02   -1.367277775214033e-01   -1.586917203898437e-01   +1.055460627974003e-01   +5.413078635679894e-02   -1.504250854577169e-01   -1.704721069278396e-01   +3.674511725109399e-01   -5.214317571129971e-02   -2.911106394241002e-02   +5.867475059901872e-03   -1.189238218471125e-01   +3.736325051552666e-01   -1.926296388874688e-01   -1.319308632627090e-01; +4.012489220996435e-01   +5.158296146284452e-02   +8.067169854429529e-02   +1.585823110240419e-01   +2.836491074890676e-01   +1.629117193300266e-01   -4.646610327524883e-02   -8.995299009464011e-02   +1.883089042668540e-01   -2.070610349667324e-01   +1.903772172919165e-01   -1.309189650626570e-01   +1.209337633361681e-01   -2.004600416329158e-01   -7.957173776810059e-02   -4.532164285997878e-02; -6.501996647529872e-02   +3.401705760204290e-01   +3.698280876361720e-02   +3.132469445795037e-02   +8.573028393125133e-02   -1.119665650192678e-01   -2.991279243282719e-01   -2.450289905501933e-02   -1.984989225193933e-01   +2.191450511447920e-01   -3.102592235084958e-01   +9.355166154305745e-02   +9.369600342032509e-02   -3.551715732051342e-01   +3.638505040913714e-02   +3.334549650520185e-01; +1.603639762376146e-01   -9.431786646421525e-02   -9.747405820203746e-03   +1.177539743827576e-01   +1.693702158045288e-02   +9.265894528389533e-02   +1.911478236001319e-01   +1.822438248907307e-01   -1.920125917878772e-01   +1.147735397001212e-01   +1.820295078482377e-01   -7.649277636566673e-02   +4.402578643687277e-01   -1.631603021621271e-01   +2.086455551920982e-01   -4.451518536455092e-02; -8.157488378050862e-02   +1.967763138948710e-01   +2.061050492018580e-01   -2.379831431183912e-01   -3.147171512991932e-01   -6.796797165778151e-01   +2.342681973488981e-01   +5.675166553434630e-03   +2.458136122673500e-01   +1.106040242086321e-01   +4.327003797726654e-01   -2.138324751957795e-01   -1.291315036560289e-01   +5.948741842561061e-02   +1.555996305993789e-02   +2.677535582307966e-01; -7.552247035101919e-02   -1.101767642711845e-01   -3.385073824743249e-01   -7.422798756487579e-02   -8.379995150636804e-02   -1.682772841099459e-01   +7.820249836721883e-02   +2.262984802449909e-01   -2.227299293133374e-01   -2.834048128917327e-01   +1.250699663531354e-01   -3.345156252047468e-01   +1.663233167879585e-01   -1.388025149763594e-01   -8.239490088957806e-02   +4.585424831122012e-02; +2.050334776787533e-01   +3.069824498188809e-01   +3.444584380132071e-01   +1.999077714518985e-01   +3.029219173526710e-02   +3.424543268464388e-02   -1.312101752596506e-01   -1.713537711542068e-01   -6.259561740318020e-02   -5.188390375116553e-02   -1.299720653918700e-01   -1.619985776562088e-01   +2.500641217835542e-02   +2.931919515336803e-02   -1.669990084517439e-01   -1.656374119908971e-01; -1.277216322805806e-01   +3.839362199241311e-01   +3.564917889652544e-02   -2.701727824548161e-01   +1.638189148083412e-01   -2.756746477141561e-01   -5.837871770581618e-02   +2.818368248835308e-01   +9.710889974728484e-02   +3.840332911961430e-01   +3.130237300169255e-01   -1.845801387644061e-01   +3.408122572856601e-01   +1.770236812263607e-01   -1.387993235033698e-01   +9.632927042471226e-02; +1.863555275788442e-01   -1.918814114542730e-01   +4.852135013919300e-02   -3.451353154370926e-01   -2.230076688212923e-01   -1.514617948817168e-01   -1.575146340397153e-01   -7.502110587507085e-02   -1.605094897032836e-01   -1.684529752171200e-01   -5.235969682235687e-02   -7.043993414268000e-02   +1.479196702038603e-01   -1.950899759088497e-01   +4.401124892079641e-02   +1.184012770641306e-01; -3.476692901293622e-02   +7.861714643228471e-02   -1.899713295594888e-01   -1.250479619516102e-01   -2.171403256535968e-01   -1.862600892871830e-01   +5.270052016165755e-02   +1.961357519882398e-01   +8.342668887554314e-02   +6.478750722045630e-02   +6.997170525859880e-02   -2.118340468042182e-01   +1.260673777887522e-03   +4.236409350644360e-02   +2.249396225460594e-01   +1.593555939443381e-01; +1.392204409482380e-01   -7.091513206857368e-02   +1.712043483949310e-01   +3.808036135491359e-01   -8.788288143746058e-02   -1.092626424325318e-01   -3.032808590579871e-02   -2.754730775229547e-01   +2.608254657773481e-01   -2.260216749398616e-01   -1.046916940556432e-01   -2.399672608385103e-01   +1.912436988107900e-01   -1.597831999945705e-01   +2.943540393575778e-01   +7.772992785128302e-02];
L1E_L1I_iGABA_netcon = [+2.829270786568456e-01   -1.335041587949527e-01   -4.899582623934605e-02   -1.450618365762082e-01   +1.592596710453755e-01   -5.056512525241591e-01   +3.278802863855337e-01   +1.359548249043072e-01   +3.181266721871885e-02   -1.612398065115590e-01   -3.022506629614389e-01   -5.402507906984060e-02   -1.398717245447256e-01   +3.941405996333661e-02   -1.273573354506791e-01   -2.222701327274021e-01; -1.946974673241403e-01   -2.102627222060202e-01   +8.308787272234602e-02   +2.715477798138233e-01   +2.095673737896283e-01   -1.663340009810606e-01   +1.063904043208097e-01   -1.100045339201020e-01   -2.304466483823298e-02   +3.767318437982045e-02   +2.131799418377027e-01   -1.481693508323869e-01   +1.300363507388501e-01   -5.924914209583497e-02   -1.897681579495059e-01   +1.028414072157891e-01; +8.168482746559314e-02   +3.812582059822692e-01   +3.105851778384153e-02   +1.918823977801355e-01   +1.235117506250525e-02   +9.609572645127852e-03   -2.275188075328010e-01   +1.575215539582326e-01   -4.202705859961887e-02   -1.139868145458523e-01   +1.673485903168418e-01   -2.141968160670027e-02   -1.850024333492422e-01   +2.252180026461234e-01   -1.218524341728772e-01   +4.177386147919916e-01; +2.994252024411180e-02   -2.328475320129912e-01   -1.310784052385027e-01   +2.561444909914518e-01   -1.844832076661210e-01   +2.422752493441273e-01   +2.201197245254589e-02   +2.121258064594535e-01   +7.080409306949492e-02   -1.313275502847184e-01   -1.491123511114188e-01   +2.427772412811134e-01   +1.553160581187188e-01   -2.335524930968328e-01   -1.599232677692420e-01   -1.413295276830482e-01; -9.687664728621906e-02   -6.497957233593077e-02   -1.335334858982728e-01   -2.293588543807305e-01   -1.663269258861867e-01   +1.697325166568289e-01   +2.020686580467086e-01   -5.606339847520563e-02   +9.383896305458098e-02   +2.055573630015484e-01   -3.378980827639803e-01   -1.080924648868368e-01   +3.298090907927493e-01   -2.488099543869642e-01   +1.246363087891903e-01   +1.223471428840886e-01; -2.392287651750076e-02   +2.301814434755602e-01   +1.380717565618421e-01   +1.880397571801456e-03   +3.105476550637303e-02   +1.215217357390273e-01   +1.038235518974756e-01   -1.944097354777671e-01   -3.213970994670973e-02   -9.910531680188825e-02   +1.096846631439908e-01   -1.049225793480413e-01   -8.088630012644604e-03   +1.349604378151981e-01   +2.604715792200956e-01   +1.071072030745878e-01; -1.625789898622707e-01   -1.438633776702649e-01   -2.921041808169370e-01   +3.935746841709340e-01   -1.694402996177416e-01   +1.033549410851333e-01   -2.754768337563310e-01   +3.577964882277557e-02   +5.697804325379141e-02   -1.346397726452009e-01   -5.727451784534949e-02   -1.368192162619558e-01   +1.899232073617119e-01   -2.085191361164623e-01   -3.784926320473881e-02   -6.945897521336844e-02; -1.239248151007310e-01   -4.029248101580654e-01   +1.343914161049564e-01   +1.582647141003476e-01   +1.701392219471025e-01   +2.510424370138061e-01   -2.903954222338263e-01   +1.695281701830775e-02   -1.456338655080125e-01   +1.658519532079381e-01   +8.063649062654381e-02   +7.569625953627690e-02   -9.226770175740352e-03   -3.993200198691374e-02   -2.841177312780908e-01   +4.189822010717051e-01; +2.195067295731374e-01   +1.870546290351691e-01   +5.982338917793115e-02   -3.048099933284877e-01   +1.684299067812997e-01   -8.770709916157088e-02   +2.702489963453656e-01   +2.066336528902945e-01   +1.424356439045586e-02   -1.062943845753478e-01   -6.612325310106366e-02   +2.170231253031604e-01   +1.799179447741553e-01   -3.199271340211880e-02   +3.059710782434458e-02   +1.275003011427694e-01; -2.232960084896518e-01   +9.526439046519830e-02   +2.725655666223590e-01   +1.573972930919080e-01   +4.247396156309397e-01   +4.711727620677510e-02   -1.745995853281139e-01   +1.388309249181755e-01   -3.446825628186672e-01   +1.824994287463685e-01   -2.932995337399708e-01   +1.435864324395809e-01   -2.115034793458048e-01   -1.794521980388568e-01   +6.537814242155959e-02   -3.347064705342910e-02; -8.152235754767720e-02   -2.721055271434887e-01   -9.928327284365193e-02   +1.652010931240004e-01   +1.324068203926629e-01   +1.029290822460157e-01   -3.064990073213077e-01   -2.576530415457937e-02   +3.122125742235752e-01   -1.946633629978116e-01   -2.195798889805463e-01   +3.530865147327850e-01   -2.459081253864565e-01   +3.302876963787160e-02   -5.327774895322749e-02   -4.097943783049116e-02; +2.879293980681453e-01   -9.989021013223336e-03   +4.735209604316113e-02   -4.740680790587058e-02   -4.299039878301866e-03   +1.215655822063709e-01   +5.172101864380009e-02   +1.484686758686325e-01   +1.487454329968609e-01   -9.768338719446254e-02   +3.630918086738066e-01   +1.945119132404101e-01   +4.796057322461680e-02   +2.231924664871200e-02   -1.262042120570082e-01   -1.131145581530336e-01; +1.339557289576416e-01   +1.344455559444482e-01   +1.066077289355350e-01   +2.960103663751142e-01   +2.220999955681009e-01   -1.279731064708391e-01   -1.216116905147074e-01   -2.024425466304055e-01   -3.190693757595553e-01   -1.923964685604737e-01   +1.191774581420193e-01   +1.842708244733002e-01   -3.045097840057913e-02   +2.464051217513201e-01   +2.664424812906576e-01   +2.486018797924144e-01; +1.058660499081192e-01   +6.634426924473942e-02   -1.719247985004425e-02   +3.692273461983349e-01   +4.003067689782976e-01   +2.732410968599217e-01   +9.263533734016668e-02   +4.137615115133340e-01   -8.358975536750277e-03   +1.382487471805837e-01   -1.079535663933950e-01   +7.247862653022427e-02   +7.501029975137174e-03   -5.278394962812416e-02   -6.284337285397719e-02   -2.201643407180945e-02; -2.638847867837001e-01   -1.724474390315628e-01   +1.533404753573959e-01   -3.528585997965883e-01   +1.527122100911749e-01   +3.037267680424995e-01   +2.709753195448595e-01   -1.038087476046386e-01   -1.954959857492636e-02   +3.434569690157724e-01   -7.863709607657728e-02   +2.106268048945596e-01   -2.698838359284809e-02   -2.129368951005991e-01   +1.157267814850062e-01   +6.561721940595522e-02; -5.509491376541097e-02   +2.433870409052728e-01   -2.121544537374792e-01   -7.304264568611510e-02   -6.814494977639869e-02   -1.045435921130117e-01   +1.077125090151638e-01   -2.206545853016003e-01   -4.998942523561235e-03   +1.359039072694041e-01   +9.541658181850289e-02   +3.510132493574059e-02   -2.303898851588113e-01   -1.675175708195406e-01   +1.615866109913558e-01   +2.109633605866966e-02];
L2I_L1I_iGABA_netcon = [+3.484935552399651e-01   +1.062208129110783e-01   +2.510199115379355e-01   +4.284368894996365e-03   -2.983575683457786e-03   -2.523563453690634e-01   -6.759177359575162e-02   +2.096565449545464e-01; +9.157026290652240e-02   -1.556598858171429e-01   -1.255056931435999e-02   +3.769951516585175e-02   -1.747613100099405e-01   +2.429144118107230e-01   +1.851571960207809e-01   -2.885014479076582e-01; -2.189586644702073e-01   +2.123473333860119e-01   +9.229218503450386e-02   -3.048787902617791e-01   -4.185962569774371e-01   -2.634854151886284e-02   -3.073040667847924e-02   +3.017288139070464e-01; +1.834996904926575e-01   +6.991645128809269e-02   -2.193610210134380e-01   -1.006871961871236e-01   -3.969386460089436e-01   +2.247586917803699e-02   +2.213199769794823e-01   -6.723157817696396e-02; -1.150134148242722e-02   +1.449043547975175e-01   -3.187725233476005e-02   -3.591512679103277e-02   -8.507004172718950e-02   -1.650039825989897e-02   +5.295948633381851e-02   +1.300106546954032e-01; -3.773415884543373e-03   -3.894196831129467e-01   +3.746555234430968e-01   -1.165410251757091e-01   +9.294570520942685e-02   +3.231679322434102e-02   +1.886097229983771e-01   -3.573096349539408e-02; +1.109561548060541e-01   -1.889241600765004e-02   -4.920759051650346e-02   +1.254719120631069e-02   +3.274262664470490e-01   -3.521059005596494e-01   +9.010065491534532e-02   +6.781187297728844e-02; -2.222188903563235e-01   +1.063172996183223e-01   -1.439723251440045e-01   -1.237238489669659e-02   +6.897887703857747e-02   -8.707328148188861e-02   -2.523762304768108e-01   -1.112485029237762e-01; +1.794318942499657e-01   -2.163864445948004e-01   +1.761245503223300e-01   +2.555097508595625e-01   -2.335154304278325e-01   +1.021792212369137e-01   +5.550045193389311e-02   +2.391453241470544e-01; -6.270476156486643e-02   +3.519612705087271e-01   -2.143414293023509e-01   -1.573390018015672e-01   +2.861474407414612e-01   -1.841747605936927e-01   -3.279978206265219e-01   -6.317209158740775e-03; -1.456404571645472e-01   -1.465418022864368e-01   +6.576468989293453e-02   +1.147785694102425e-01   +5.158594852685991e-02   -1.454057358293815e-01   -2.564554718905498e-01   -2.623597356706517e-01; +1.104076878442643e-01   +3.509161779168823e-01   +7.069024396301639e-03   +3.321778467270868e-01   -2.384016052870817e-01   -3.783675080769770e-02   +1.986724286388534e-01   -1.494051787634110e-01; -1.290560585024298e-01   +1.164586620923548e-01   +1.664758417674805e-02   -8.688012049384611e-02   +1.424844076179490e-01   -1.380041172329275e-01   +9.545039061921126e-02   -2.015858543989391e-01; +1.825232153183414e-01   +1.013549466389971e-01   -2.844566757984043e-01   -2.292679184400321e-01   -7.258821895770772e-03   -4.342041860466458e-01   +2.248900561472973e-01   +3.687537217479753e-02; +1.632319381778999e-01   +1.576019473320260e-01   +1.039721915451086e-02   +6.388192254795320e-02   -2.383512064544990e-02   +1.052369610993422e-01   +7.708315002085746e-02   -1.269247969311874e-02; -3.419137535537725e-01   +2.638398291876548e-01   -3.170984053982490e-02   -2.004094639770634e-01   +3.543316175946944e-01   +4.780739007483527e-02   -2.437869173659176e-01   +1.329317289294973e-01];
L1I_L2I_iGABA_netcon = [-2.492231902558737e-01   -1.973942228802888e-01   -1.207299758147507e-01   +1.481953051100113e-01   +1.316715115640201e-01   +9.508245687212180e-02   -4.212976181577432e-02   +4.457439565363293e-02   -9.714080763793895e-02   +3.891221116650105e-01   +1.649667682530884e-01   -4.527389763162600e-01   -1.747207844193704e-02   +1.443660743039532e-01   +1.001158138936110e-01   +2.530082486062675e-01; -1.493979442891543e-01   +1.566249888799429e-01   +3.055742032149229e-02   +3.722575406788530e-01   +1.327807843104921e-01   +2.173000831218637e-01   -7.078111386931555e-03   -1.407982123511853e-01   +1.201510033457994e-02   +3.541576460985567e-01   -1.758808183757674e-01   +2.498913039149311e-01   +5.294385253318075e-02   +4.826512853713932e-02   +7.970798908285942e-02   +1.743077587396764e-01; -1.948640089514215e-01   +5.733584717891614e-02   +6.077946573727547e-02   -1.640572147582361e-01   -9.810902083271630e-02   +1.084985302469559e-01   +1.429190192751856e-01   +2.254269221562126e-01   -6.627809958945693e-02   -2.996517571041931e-01   -4.131888723528242e-02   -2.994694424962781e-01   +2.018084663268827e-01   -1.134210744870459e-01   -3.503823211392073e-01   -1.977439624709992e-01; +1.186106489112823e-01   +4.407345612646255e-02   +4.112104556138448e-02   -2.675464962297910e-01   -5.395419304493399e-02   -5.511525482829190e-02   -1.156967625727243e-01   +1.937252231021682e-01   +3.487782076701322e-02   +4.699902449107033e-02   -3.264969966153627e-02   +1.557113694187635e-01   -2.361698181252811e-01   -5.230087299016115e-02   +1.846626260470037e-01   +1.074913548871892e-01; +1.271887369213910e-01   +1.944203198346632e-01   +2.188329309758970e-01   -7.935951762808183e-02   +4.610588012855104e-02   +2.178521532898410e-01   -2.101232838877920e-01   -1.490314445896705e-01   -1.810107938348377e-01   -2.589897026554736e-01   -8.104374144462270e-02   +2.200262958238707e-02   -1.186709456403340e-02   -5.362027377014821e-02   +4.709382163182912e-01   +1.627125048139393e-01; -3.514645014281075e-01   +4.055018529461161e-02   -8.383855267608871e-02   +6.841087930564976e-02   +1.557370804853409e-01   +1.889378826044143e-02   -3.039302994744648e-01   +2.252544319850767e-01   +1.437165940127277e-01   -1.541717627017958e-01   -1.965727207318635e-03   -2.175966324435390e-01   +1.987153508759530e-01   +5.954459929842312e-02   +4.189994449063192e-01   -8.813579066420468e-02; +9.921151652584159e-02   +4.138757189091057e-01   +1.225158999899578e-02   -3.249566315369748e-01   +7.046980661020900e-02   -3.856281854320961e-02   -1.977270522989352e-01   +5.625882975386774e-02   -1.033201089600661e-01   +1.529498193901190e-01   -2.746800014751894e-02   +2.459699775183305e-01   -1.820182280302806e-01   -1.636888619083802e-02   +3.584560963909788e-03   -2.413740201744333e-01; +1.254137645345680e-01   -1.105699719096357e-02   -2.523341425834615e-01   -5.613156470034278e-03   -3.206954515435981e-02   +1.563843511543904e-01   +4.836990096622363e-03   -5.323251052859522e-02   -3.652520496623021e-01   +1.296095261571346e-01   +9.512646717845637e-02   +1.131401178031912e-01   -4.771662438613687e-01   +1.958032556348575e-01   +6.860790395258153e-02   +1.255106553784041e-01];
L2E_L1E_iAMPA_netcon = [-1.866318573079217e-01   +1.434171989367748e-02   -3.871769517629436e-01   -7.552443060974191e-02   -9.440908839904574e-02   +1.480879391433384e-01   +1.341448983999224e-01   -2.835577241348687e-02; +1.377623419457234e-01   -1.736735793488895e-01   -1.062774456191137e-01   -2.827563693696646e-01   +2.227053635975094e-01   +1.270569067261693e-02   -3.503189859820809e-01   +1.359195773959602e-01; -6.675980588723035e-02   +8.914525939484448e-02   +5.653656996692428e-02   +2.914604542536700e-02   -7.049218788289480e-02   -2.686660104156752e-02   -1.497431126378158e-01   +3.475050823568594e-02; -5.180409451710664e-02   -1.587268327152743e-01   -1.290071764710344e-01   +1.008907786731869e-01   +5.762454524561418e-02   -2.491332697785319e-01   +3.390421311630383e-02   +2.157545207255665e-01; +2.107406343289618e-01   -3.692146660593219e-04   -5.856831611680492e-02   +2.111529671452039e-02   +3.132736481809305e-01   -2.145035448324128e-01   -1.173048844727895e-01   -2.106667217484903e-01; +1.120265922003317e-01   -4.107544200688126e-02   -1.324324328435982e-01   +2.757285793351255e-02   +1.858817318445403e-02   -1.174733488990672e-01   -2.879063947359468e-02   +3.254458333859123e-01; -1.698234037615676e-01   -1.221919351897442e-01   -1.329155120018866e-01   +1.066280846858583e-01   -6.835140717812845e-02   -3.106521743677229e-01   -4.629024432715153e-02   -3.200143597645485e-02; +4.164571066307603e-02   +2.176574368378154e-01   +2.334496928025807e-01   -1.075052093033490e-01   +9.697137487639547e-03   +2.680808252867440e-01   +2.474927904951297e-01   +1.432831515009029e-01; +9.068818468341570e-02   -5.746483379595173e-02   +4.424543701764059e-02   +1.734050264372501e-01   -1.070446527958120e-01   +6.242910549054972e-02   +1.431588601013058e-01   +1.236449788097474e-01; +1.349876265117724e-02   +3.184840766256796e-01   +7.717716955811324e-02   -1.030898558566151e-01   +3.147791391901730e-01   -5.123676836655414e-02   +5.664220270415254e-02   +5.456753280345584e-02; +5.815693190449886e-03   -1.020168569620351e-01   +1.127578168960163e-01   +1.161106593187968e-01   -4.683084004656768e-02   +1.085765050069435e-01   -1.850368781669730e-01   -8.501212312643933e-02; +7.407881376319056e-02   +2.225454537903221e-01   +1.694793086125164e-01   -3.284738885337504e-01   -1.258014930234358e-01   +1.690540575332175e-02   -3.194017673717456e-02   -4.090865962085094e-02; +5.916939506863828e-02   -3.108178444895863e-01   +1.411670119654915e-01   +2.008323341106584e-01   +1.580061149169326e-01   -1.113935711020883e-01   +2.097700301617417e-01   -6.388310791667597e-02; +2.373477791174047e-01   -9.245686652779490e-02   +1.375362998919278e-01   +4.261693099643172e-02   +1.813984214349145e-01   -1.237623841074924e-01   -2.168515122147466e-01   +1.466432927448796e-01; -1.377367649462237e-01   +2.262248205044452e-02   +1.210470208821878e-01   -4.940252542822636e-02   -1.481979665145562e-01   -9.002379603296595e-02   -1.149659990683854e-01   +4.164334212697116e-01; +2.030135482768205e-02   -7.747856327676379e-02   +1.662837521904864e-01   +6.821570035076809e-02   -3.024507171536898e-01   +3.758483898670140e-02   +2.028313942375044e-01   +1.305574399627192e-01];
L1E_L2E_iAMPA_netcon = [+3.209019540697374e-01   -6.154458828197776e-03   -1.669506494261765e-01   +5.134240088092830e-02   -2.033756667208237e-01   -4.541884646863498e-02   +2.639744313805425e-01   +2.125642758944692e-01   +3.455053962682738e-01   +4.846917203343064e-02   -2.568241765670099e-02   -1.355140784641802e-01   +2.282008615772838e-01   -2.632898212209829e-02   +6.455151497222958e-02   +1.165678995142335e-01; +7.476179489728209e-02   +7.663786435046324e-02   +5.689515590626677e-02   -3.567058080336974e-01   +5.352708981107924e-02   -1.079395459509098e-01   -2.656951235787424e-02   +1.760252154353348e-01   -2.497062490971452e-01   +1.030119211085356e-01   -3.200519232288097e-02   +1.559653587393372e-01   -1.450664809634713e-01   -3.525802843611469e-01   +1.635026477982473e-01   +6.154349833553836e-02; -2.938309946289456e-01   +2.120486031858286e-01   -1.010796764707167e-01   -1.133540029536748e-01   -1.181416704478721e-01   +1.770700048153960e-01   +1.424306401176985e-01   +1.804377662226832e-01   -3.202680229846587e-02   +1.034996708292328e-01   +3.413217370564437e-01   -3.432863533294471e-02   -1.641540090108527e-01   -1.004339249862431e-01   -9.670011991276276e-02   -9.837307653180213e-02; -2.998026830320339e-01   -1.961180808304489e-02   +1.910737511963214e-01   -1.120165653407856e-01   -7.172462392477350e-02   +1.933533715557681e-01   -1.426578254629197e-02   +2.376406070853130e-01   +5.076934997266304e-02   -1.214415775551233e-01   -4.013840690663244e-02   +1.182550474663646e-01   -2.904239920728600e-01   -6.666169044447054e-02   -1.391228741377498e-01   +9.156329167534626e-02; -5.039877229549062e-02   +4.938311965848104e-02   +4.876285001789127e-01   +1.011999866951021e-01   -8.885529931092891e-02   -3.425669096590951e-01   +1.719600492960723e-01   -5.098257055239667e-02   -3.280001153517714e-01   +1.851384521631925e-01   -1.458061247069926e-01   -6.980876481588275e-02   -1.406795220539654e-01   +3.960078120110566e-01   +2.790740249012679e-01   +1.876764754911712e-01; -2.623147575471122e-01   -6.960614737927422e-02   -1.817918174281208e-01   +3.667064980241596e-01   -5.562018571487168e-02   -1.243906726180540e-01   -3.935587784975972e-01   +2.698028266460583e-02   +1.864044772809324e-01   +1.976120339527853e-02   -3.708220837610364e-01   -1.491819420091363e-01   -3.572679765078372e-02   -4.377879044999837e-02   +7.549139557783840e-02   -1.421163291460726e-01; -2.390333619014993e-01   +2.563109581461829e-01   -9.909659732325241e-02   -1.722162564776337e-01   +1.472699137299350e-01   +4.613201629272867e-01   -2.186235634900829e-01   +2.569754636399767e-01   -1.103085557583278e-01   +1.955238560993386e-01   +1.011709801880519e-01   +6.319730541619351e-03   +4.938775702136246e-02   -1.626156876725345e-01   +1.431502355653242e-01   +1.289924009265083e-01; -9.168708582489705e-02   +4.866452665176264e-02   +8.106401356971825e-02   +2.989166926967167e-01   +4.385513951568198e-01   -2.497503972657902e-01   +6.260287347193985e-02   -4.220316608808485e-03   +4.757984912572980e-01   +6.720943874167828e-02   +2.840281733475026e-01   -6.236508195644916e-02   -2.795114369899303e-01   -2.287081358081262e-01   -3.028323976864858e-01   -5.848681567408975e-02];
L2I_L2E_iAMPA_netcon = [-3.424726078793495e-01   +1.328932493082101e-01   +1.389957832956959e-01   -1.619665596613244e-01   +4.598799759217882e-02   -2.071313754822747e-01   -2.405246464604318e-02   +8.898574789440925e-02; +1.389584575286242e-02   -1.199375926715909e-02   -2.105092776657914e-01   +2.094517514345809e-01   -1.235392532084804e-01   -2.212435110179429e-01   +1.800034687875492e-01   -2.172550861762984e-01; -1.761760196826146e-01   -3.444531201095523e-02   -1.433673912607297e-01   -3.225323964909284e-01   -1.858852368002737e-01   -2.068013045978170e-01   -2.565866139293702e-01   +1.180359213973889e-01; +1.382539497337326e-01   +3.120426339585297e-01   -3.433498193777845e-01   +3.301634981614804e-01   -2.916108627938609e-01   -5.334139896395630e-02   +1.934648705305112e-01   -1.622892224077168e-01; +1.994384490925277e-01   +1.165707136478515e-01   +1.137398191481049e-01   +1.248797255555914e-01   -3.454051901413741e-02   +2.819427842093030e-02   -7.172315950052657e-02   -1.498338082929986e-01; +2.033161008047529e-01   -1.260606361325633e-01   -1.295264382694825e-01   +3.741184425745767e-01   +8.167787949641550e-02   -5.608540995290041e-02   +2.777772473405016e-01   -1.267308708558347e-01; -3.757863409211644e-02   +3.036569511990714e-01   +1.821009819480049e-01   -2.356426421833777e-01   -9.625622095007415e-02   -4.523586375828048e-01   -2.022698295654020e-01   +1.795609341428760e-02; -1.760181641870654e-01   +3.630117589436450e-01   +3.567297453240784e-03   -6.933804799408843e-03   +1.147532307008813e-02   +3.812100644937817e-01   +3.040574573733224e-01   -4.455318343423461e-01];
L2E_L2I_iGABA_netcon = [+1.184687425953211e-02   -1.276015714167217e-01   -1.311489151585781e-02   -8.181446478350572e-02   +3.111584277231652e-01   -2.108470382721426e-01   -8.608797363471771e-02   -2.287723726039553e-02; +1.772777861142921e-01   -2.287965122325578e-01   +1.999627113136622e-02   +6.733873799124834e-02   +8.999758304434655e-02   -2.074708438826836e-01   +2.696691886370576e-01   -1.955720332194347e-01; +9.125150823369568e-02   -7.807054353346153e-02   +1.454540344453648e-01   -1.415798832280435e-01   +9.986403522929940e-02   +1.233448135570442e-01   +4.355271344365730e-02   -1.422349171540657e-01; +1.246057714492630e-01   -4.686429233687365e-04   -1.134633886736099e-01   +4.770608440391617e-02   -3.154184984639129e-02   +1.383247820873307e-01   +1.085779035752452e-02   +1.918209032407505e-01; +1.912682557843573e-01   -5.449524260151725e-02   -8.524933626791396e-02   +4.695328272561701e-02   +2.687985865573664e-02   +1.776116008118517e-01   +6.026054827311265e-02   +4.670448677379798e-02; +5.005007528717084e-02   +2.204509494732210e-01   -3.149387448895096e-03   -2.121481539181321e-01   +2.153888818352493e-01   +3.483220479612910e-01   +8.418577975893513e-02   -5.906482500615671e-02; -7.091579314428226e-02   +2.809353216039900e-01   +4.669565079561073e-01   +6.870589426161196e-02   +3.543818884015720e-02   +3.305614832950365e-03   +4.402436999836579e-02   +1.082310494577461e-01; -2.880569446324685e-02   -3.450285789365008e-02   -1.104593342503515e-02   -3.784264797927150e-03   -1.734446966101334e-02   +2.733136821615785e-01   +4.108114853724178e-03   +2.674773775280412e-01];
L3E_L2E_iAMPA_netcon = [+1.462311487798687e-01   -1.733991112476881e-01   +6.253296851170831e-02   -4.014064210888025e-01   -2.133394205986280e-01   +2.926068281115761e-02   +2.497396054468472e-01   -2.435534884519320e-01   -2.104003422019308e-01   -5.009457537469554e-02   -2.805434240603451e-01   +1.365929616256769e-01; -6.402245647507181e-03   -2.198924426946395e-01   -1.556023094423784e-04   +4.895236396976327e-02   -2.284398143500489e-01   -1.385007319793240e-01   -1.756371020721149e-01   +2.944229467770468e-01   -1.699764962579794e-01   +6.973580665291147e-02   -2.209068838276022e-01   +1.166582914766836e-01; -3.030224951189995e-02   +8.442478483057381e-02   -7.294952381625944e-02   +5.679331526952654e-03   +2.286976921522896e-02   -1.747930165910414e-01   -1.358919953215986e-01   +2.068424829847838e-02   +1.029626082315621e-01   +5.700245604308055e-02   -2.580003396991051e-01   -1.444777300087871e-01; -3.508657609971911e-01   -1.277131963575451e-01   +3.064478229446567e-01   +1.358293228294953e-01   +4.526771380164473e-02   +2.569345436416854e-02   +1.829248925881027e-01   +5.418217611501090e-02   +3.213104836389029e-02   -2.092432089490277e-01   -1.354704802428307e-01   +2.255549730102313e-02; +1.722153739109885e-01   +1.317008691325696e-01   -7.668826171735976e-02   -1.277358362299426e-01   +2.577419352928283e-02   +1.997828761614965e-01   -9.000707679751511e-02   +1.002266802628058e-01   +1.401504601921365e-01   -1.040391642400248e-01   -1.308386455343510e-01   -2.392777224318740e-02; -3.299732774031645e-01   +5.835185392572418e-02   -9.878239574823092e-02   +2.545422576400448e-01   -2.435104847022845e-01   -1.958992713477443e-01   +4.330918406556863e-01   -2.536291634872933e-01   +7.266881557682704e-02   +4.770800537860426e-02   +1.726004115161733e-01   +1.273498269228713e-02; +1.983793210974157e-02   -1.812865413380587e-01   +1.894828170813376e-01   -3.035753795285414e-01   +2.451544137455201e-01   -5.352533244956112e-02   +2.043699842013427e-01   +1.142063126601984e-01   -1.558249815083596e-01   +1.974402021935006e-01   -2.515218936199781e-01   -1.149081368285267e-01; -1.627802893729794e-02   +1.383013743096036e-01   +5.320927478934976e-01   +1.501378087641424e-01   +1.496026920122327e-01   +2.829198506937548e-01   -1.964097945165978e-01   +2.898281967484004e-01   +1.031922888877044e-01   +1.083360304275803e-01   -9.884264984371854e-02   -2.656922210684530e-01];
L3I_L2I_iGABA_netcon = [-4.112185480379275e-03   +4.571453204909156e-01   +1.256264797744252e-01   +3.382575811574634e-01   -1.569280129131741e-01   -3.009647224577462e-01   -3.825725698851259e-01   +1.406380633169714e-02   -2.481488805009438e-01   +1.104617893016345e-01   -2.204842732663466e-02   +1.528490317526462e-01; +1.880014415555625e-01   -1.397464860249775e-01   -5.984787333927313e-02   +1.476742534057112e-01   -1.416987048788858e-01   -9.730973954562176e-02   +7.814733527945926e-02   -1.011054155391452e-02   -2.038667183879309e-01   -1.781731699274245e-01   -3.998306590567639e-02   +1.222410759187332e-01; +2.378035178902912e-01   -1.831687490907357e-01   -1.040306019066702e-01   -2.459412651615570e-01   +1.216304019521906e-01   +1.120939419308031e-01   -1.267608651672553e-01   -1.623430200999610e-01   -3.412040973054437e-02   +6.218039916419729e-02   -3.314559106445040e-01   +4.456704874593233e-02; +7.179727816732350e-03   -8.942517720318650e-02   +6.656654392366418e-02   -3.642500636781316e-01   +1.748869821223126e-01   -8.489839347584446e-02   -1.008118384420532e-02   +7.884537920065912e-02   +2.453569281515569e-01   +8.720236261058231e-02   +3.203353645750891e-02   +7.298905968129839e-02; +2.206881633156029e-01   -3.135606840374762e-01   +1.704493441492345e-01   -5.335688291076542e-02   -3.050398991443855e-01   +2.731501450708887e-01   -1.317337110102218e-01   +1.751488575196181e-01   -6.613947358629219e-02   +2.536669073290476e-01   -2.582240957804497e-01   -1.694905830559067e-01; +3.170156169523466e-01   -2.026089162297565e-01   -1.383486784590773e-01   -9.563588920258387e-02   +2.376821850781099e-01   -3.438617708068848e-01   +1.057851128982704e-01   -1.053442801314683e-01   +7.923121477793857e-02   -8.169484776561291e-02   -1.820262809448244e-01   +2.488283532037341e-02; -5.572135154547904e-02   +2.587054583309316e-01   +1.198415879136961e-01   -3.585574444357300e-01   -6.347647174393509e-02   +9.388360043172728e-02   +9.077184831423172e-03   -2.266667433857825e-02   +1.025141153952539e-02   -3.312509964037431e-01   +6.061397948799156e-02   -1.749472833451858e-01; +2.253678108877839e-01   -2.406970786316687e-01   +4.579533210968956e-02   +3.238945722458695e-01   -2.130597871492730e-02   +1.006992684511916e-01   +3.890741620294920e-01   -1.370548286476651e-01   -2.383844244888660e-01   -1.396896571620078e-01   -2.884008421613679e-01   +2.851405434624908e-02];
L2E_L3E_iAMPA_netcon = [+2.756404607482179e-01   -1.087456035145364e-01   +8.433733917692293e-02   +2.601025667205423e-01   +3.444167356264342e-02   +5.758502328289470e-01   -3.115121532209373e-02   +1.841673102492350e-01; -2.184132296634956e-01   -2.219273805824068e-01   +3.334929859541047e-01   +4.372639864229263e-01   -1.907032689998859e-01   +3.243721631508770e-01   +1.071896774593857e-01   -1.066936814155047e-01; -5.730097943540011e-02   +1.339812293958911e-01   -1.179235824883564e-01   +2.330202124404245e-01   -4.297077039472076e-03   +5.132641311665272e-02   +1.099049116125721e-01   +1.707014575302401e-01; +1.156923315657322e-01   -1.049551783831332e-01   +2.804686639798919e-01   -5.235117402007493e-02   -2.063987907278971e-01   -1.295382958369344e-01   -1.051020138157488e-01   +7.523879860223423e-02; +1.501842448721288e-01   -1.057819179952592e-01   -3.052389978262078e-01   +3.157739597075352e-01   -4.081263033050808e-02   -2.099991439665599e-01   +3.281021101311569e-02   -1.540986566320098e-02; -1.617921160527217e-01   -4.935590069923043e-02   -2.642922882704586e-01   +9.458698620620386e-03   +2.662302780468144e-01   +2.048125857419406e-01   +1.071639983516987e-02   -1.631285534941513e-01; -1.932808413625490e-02   +2.799536081015423e-02   +2.827434799786854e-01   -2.381970722910444e-01   +1.737026071079142e-01   -2.393931554754079e-01   -4.897639905456233e-02   +6.662545385219466e-02; -1.534800725620440e-01   +2.196190417807884e-01   +9.313974865513761e-03   -9.622148121715930e-02   +2.042773513506076e-01   -1.283117915917029e-01   -3.144898334915573e-01   +2.183880359208348e-01; +4.126209729795989e-02   +3.608397523430826e-02   -3.610420400946075e-02   -1.329490681269416e-01   +2.980740362409385e-01   +2.111164005847252e-01   -4.863294322218764e-01   -2.584185132124650e-01; -1.528524035720026e-01   -3.186682498680996e-03   -1.080241206036339e-01   +2.120433609435264e-01   +3.034523548362947e-02   +1.341113279749615e-01   +1.128824309065403e-01   +5.689328129801478e-02; +2.124803257360257e-01   -2.646058166227839e-01   -8.601177634818809e-02   -1.375282758545964e-01   +2.513562959905769e-01   -1.713650056249522e-01   +2.276346851154097e-01   +2.170710616834229e-02; -8.128186244796699e-02   -1.132906314720279e-01   -3.288630245069519e-01   -5.737447277622941e-02   +8.883958503591294e-02   -2.628595854495598e-01   -1.573604977402265e-01   -5.910955931408522e-03];
L2I_L3I_iGABA_netcon = [-3.001153573246015e-01   +2.916059656277151e-01   +1.316635184271093e-01   +9.638503716756025e-02   -2.531070202694239e-01   +8.395310141661157e-02   -5.103082158684875e-02   +1.358380661573426e-01; -4.060536707818571e-01   +5.766686146023414e-02   +1.520300318109098e-01   +2.150256638470554e-01   +8.373857754785342e-02   -1.514141939569754e-02   +2.985571865619457e-01   -1.266897960807941e-02; -1.747221865238633e-01   +1.494425910590241e-01   +1.266582336987765e-01   +2.750786950444643e-01   +6.710945348499181e-02   +2.194774587662708e-01   +4.519143070724539e-02   -1.514446388147724e-02; -1.889309959211836e-01   +1.255017932450410e-01   -4.558862273845749e-02   -3.053563838125242e-02   +2.219576810363740e-02   +6.063693886076721e-02   +1.225431604225756e-01   +1.028510753120946e-01; -9.423170376168864e-02   +8.467038415777450e-02   +3.971074077569823e-01   -2.267965220107276e-04   -2.311612855009094e-01   +3.784886582233205e-02   -2.293384988746786e-01   +6.071704125351008e-02; +6.066194554631979e-02   -2.975150248546434e-01   -7.741612110340901e-02   +4.314570729083484e-02   -2.681850985163591e-01   +3.129915116484956e-01   -2.086560355074177e-01   +9.555222490593252e-03; -3.018098090120965e-01   -1.207283184551901e-01   +1.426351489121261e-02   -1.715085088463049e-01   -2.416239223219831e-01   +6.899373533432310e-02   +1.220910095942485e-01   -3.949851960024780e-02; +1.582191653211084e-01   +1.403646058207196e-01   +2.665250109666187e-02   -2.332154640382283e-01   -3.094201104305070e-01   -2.365141333634706e-01   -4.477448352257479e-01   +2.468778364936519e-01; +1.546076144283650e-01   -8.398191407195030e-02   +1.277046512223577e-01   -3.640505993065072e-01   +8.586291749190132e-02   -1.971519020040232e-01   -2.327701154093082e-01   +2.177847769109165e-01; +1.196029205377549e-01   +1.070359467342922e-01   -3.177221775195556e-01   -1.692918961454923e-01   +6.076767970080586e-02   +1.919545499078309e-01   +2.048197982374764e-02   -1.236278245531147e-01; -3.691334330867382e-02   +3.180200460774672e-01   +4.680438884766099e-01   +1.237789884168129e-01   -2.060459790339544e-01   -3.033343553609399e-01   -1.416351001082876e-01   +2.964824684816342e-01; +2.691520159527770e-02   +2.614798614965338e-01   +1.562768859430175e-01   -7.887063568272687e-02   -7.021040621010305e-02   +2.207855978882016e-01   -3.814956838956830e-01   +2.130057384504884e-03];
L3I_L3E_iAMPA_netcon = [+1.728700886672357e-01   -1.477495372708064e-01   +7.218211963161732e-02   +3.453472853247517e-01   -2.092198929656461e-01   -4.184131772136770e-01   -3.019148462050235e-02   +3.313321320134519e-02   +1.417649506460338e-01   +3.812524501754973e-02   -1.366188113183584e-01   -5.695559094014385e-02; +1.159980664005094e-01   -7.406456158921225e-02   -1.225560503843817e-01   -1.175019677362135e-01   -2.646063733913090e-01   +1.340485845848961e-01   +1.032419192473766e-01   +1.064961343309609e-01   +2.952127023083575e-01   -2.144773063221733e-02   -6.226323318334724e-02   +1.913746964975667e-01; -1.507296838689159e-01   -3.067271235549653e-02   +9.114917953414972e-02   +1.809843354357493e-02   +5.157884898127615e-02   +2.808895324177618e-01   +6.151169603552785e-02   -2.029681654887912e-01   -1.705967537637031e-01   -7.460676993437032e-02   +4.893600523077550e-02   -1.290337404513795e-01; +3.760152553879330e-01   +4.407248209479095e-02   -2.580730734112210e-01   -8.967355305628751e-02   +3.510280383767797e-01   +1.295343166190930e-01   -2.230242043106494e-01   +1.979359638610302e-01   +1.376767721593159e-01   -1.444525275112141e-02   -2.153149513281860e-01   -1.159823556401468e-01; +2.544288825134538e-02   -7.356006562683320e-02   -1.286256936194267e-01   +9.079534234583010e-02   +3.868815225839357e-01   -1.083185006668329e-01   -9.433126463618340e-02   -1.080558215852210e-01   -5.166862343418276e-02   -1.631071286103913e-01   -3.925366880480364e-01   -1.458552740075401e-01; +1.138734056771325e-01   +3.082534532820287e-01   +1.029851344261928e-01   -5.148630729047637e-02   +6.998066606786238e-02   -1.585788273159969e-01   -2.120843397995267e-02   -5.799918432366372e-02   -2.971896360940687e-01   +3.846198004212915e-01   -1.326007614235200e-01   +1.355488974338343e-01; +2.747391555637880e-01   +1.359517539771632e-01   -1.471108400043911e-01   +1.615417745484533e-01   +5.441229924628891e-02   -1.077175914190091e-01   +1.429539082243868e-01   -2.439204417326558e-01   +3.937216746753544e-02   -9.168322634541584e-02   +5.614505882242942e-02   -9.181289798000841e-02; +1.232915112795614e-01   -2.234137831538655e-01   +7.315663390366804e-02   +1.769541422820000e-01   +1.986332930028649e-01   -7.207932987330307e-02   -8.728897789772097e-02   +2.237933752576665e-01   +1.716239831335467e-01   -8.923795598277709e-02   -2.257824642218600e-01   -7.125313209496029e-02; -4.223904165549314e-02   -8.798958381243226e-02   +3.777056045692550e-01   -1.764789343458188e-01   +3.740434262180167e-02   -2.156546393227867e-01   +1.542802559658241e-01   -1.393020526393893e-01   -7.664265007981051e-02   -2.665726680287486e-01   -6.646404586224043e-02   -1.274609393017147e-01; +2.313923004869241e-01   -2.608186069565006e-02   +1.355434358612912e-01   +2.955328044758163e-02   +4.010065605774750e-02   +1.137257558970841e-01   +2.552930529526959e-01   +2.191779720129409e-01   +4.089490004111274e-02   +1.812328017023720e-02   -1.096492331286097e-01   +1.605743914121186e-01; +9.219488755974385e-03   -1.986081221049409e-01   -6.682572033788292e-02   +8.879156808292588e-02   +4.140854766905383e-02   +3.289045980901141e-01   -1.517599574034977e-01   -1.795134419815985e-02   -7.193133758193454e-02   +1.441931069259514e-01   +5.136923261631562e-02   +2.468792453506638e-02; -1.131105672549957e-01   +2.686107893865148e-01   +2.391417901212481e-01   +1.785981608741257e-01   -1.523592049400400e-01   -3.688476068191633e-01   -2.336725695712110e-01   -5.459257528679243e-02   -9.097761232404122e-02   -1.361735209433708e-01   -9.810832926157570e-02   +1.982372456639196e-01];
L3E_L3I_iGABA_netcon = [+1.381957279697011e-01   -1.748674007772906e-01   -1.687927375055594e-01   +9.482016117759218e-02   +2.223430144216663e-02   -2.327368251924489e-01   +1.693515903071086e-01   +2.713552662844110e-01   -1.413342208149643e-02   +7.674803810313283e-02   +3.327227054294860e-01   -1.830453695799211e-01; +8.450597215102443e-02   -1.554728056266097e-01   +1.206461588636263e-01   +2.335817550127011e-01   -1.346087210960454e-02   -7.275786051433930e-02   +1.676845328958354e-01   -2.994910399981633e-01   -1.274212840217822e-01   +1.603939318731715e-01   -1.983058796162461e-01   -2.207200407205365e-01; -4.002048960161075e-02   -7.501928011286751e-02   -2.230802410540884e-01   +2.045719451716627e-01   +5.245594188703818e-02   -3.213876924897912e-01   -2.284297899405703e-01   +2.371923147069146e-01   +4.534958995322736e-02   +1.132171187636472e-01   -1.507914890802431e-01   -4.945162146915160e-01; +7.353552932427482e-02   -2.574153084718365e-01   -1.368084588253546e-01   -1.742546836588908e-01   -2.804195236333792e-01   +1.387872028469297e-01   +6.289459732849470e-02   -4.170547868634676e-01   -1.059606277260736e-01   +1.296381016380805e-01   +1.478946233485821e-01   -8.520903397202256e-02; +2.938176526381059e-01   +1.038531772627498e-01   -4.154359924857117e-01   +6.411457186501213e-02   -1.504015816082410e-01   +2.789763191226334e-01   +1.596469971231858e-01   -2.567555271147616e-01   +8.957189618884553e-02   -2.949077633856665e-01   -9.228953960492187e-02   -9.305011296147660e-02; +1.370482930747206e-01   +7.123711851093764e-02   -1.166849496911629e-01   +2.564097071259410e-01   +4.039897102611257e-02   -5.127056671119700e-02   -1.209400944452439e-01   -2.020284615157472e-01   +1.606899151060272e-02   -1.527788622061201e-01   +2.747483588657382e-01   +2.484179534275784e-01; +9.822978319231959e-02   -9.063456505220938e-02   +2.312035647712470e-01   -9.200805133995854e-02   -2.208782020398442e-02   +2.584863735563755e-01   +1.792248384286407e-01   -2.340671632322728e-01   -4.616473122806275e-01   +4.800780387676391e-01   -2.052589536150017e-01   +3.037470675377794e-02; -9.091316295113508e-02   +1.952345087153687e-01   +5.922450443452299e-02   -2.113167971052728e-01   -3.144088036306221e-01   -9.756073279614447e-03   -1.241376786811348e-01   -4.411861196434469e-02   +9.473908862219833e-02   -3.141271756693749e-01   -4.688626300493345e-02   -3.257654230374444e-01; -1.406862229388661e-01   -2.806096607495569e-02   -2.330885476098392e-02   +1.664882902331551e-02   +6.254029442009712e-02   -3.223607281073680e-02   +1.197020580728012e-01   +1.359055868226821e-01   -1.437617399165622e-02   +5.493503910693743e-02   -6.065908620464228e-02   -1.595844000829995e-01; -8.598534228742331e-02   +5.743246921778569e-02   +2.312890552292746e-01   +2.464340509694392e-01   +2.720658382364329e-01   -2.849494139581706e-01   -1.676360568251381e-01   +1.648348380626588e-01   -2.119070873747256e-01   -9.575464516467661e-02   +1.564224936411123e-01   +3.178794494677801e-01; -1.220986292493469e-01   +9.231893998645102e-02   +1.045720246657040e-01   -2.573917992938485e-01   -2.790025581302369e-01   -9.293107689642248e-03   -1.697841313444960e-02   +7.263521976132499e-02   +1.122281551897723e-01   +4.307410018011500e-02   +2.429299220281788e-02   +2.791962134224741e-01; -2.004055011300246e-01   +2.304782112190843e-01   -3.143685915674725e-02   -6.314756003977781e-03   +7.600160864478456e-02   +2.521726702895601e-01   -1.488619581657317e-01   -2.227275321978000e-01   +1.417997005500805e-01   -1.216878690664891e-01   +4.975626753399229e-01   +2.776265770341550e-02];
L2E_Input1_iAMPA_netcon = [+2.925072070287210e-01   -1.009798167780968e-02   -1.880496181335689e-01   -6.678875237489465e-02   -5.702214652711135e-02   -5.902246950350969e-02   +2.304612392351187e-02   -3.583444860878818e-02];
L2I_Input2_iAMPA_netcon = [+1.581524254007638e-01   -2.940568283032517e-01   +1.656476031189388e-01   -4.834620204737955e-02   +2.211610615675610e-01   +1.958999057515578e-01   +9.424630457687759e-02   +1.208368889343297e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
