function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.941936548412795e-01   +1.441641513030699e-01   +7.361657133613307e-01   -3.763136236533456e-03   +2.742653401101554e-01   +8.352903151798046e-01   +8.939133523578055e-02   +1.433152977225242e-01   +2.975191343396014e-01   +6.949106720163118e-01   +1.419945392628235e-01   +3.065590838192412e-01   +7.521192666783275e-02   +4.327319432024578e-01   +6.992922468549895e-01   +5.786802190893291e-02; +6.901421376318413e-01   +2.954493614367080e-01   -2.424032320782742e-01   +8.285856062588224e-03   +5.569554463482310e-01   +6.020081788244823e-01   +1.048797596387140e-01   +2.725382988925485e-01   +3.465109777433608e-01   +1.668419033434823e-01   +4.280033557239655e-01   +5.369731859103920e-01   +4.683010809196075e-01   +8.918363704392082e-01   +7.355046676975906e-02   +2.894519115801011e-01; +5.844605236418318e-01   +4.069012961537475e-01   -1.061264497900973e-02   +4.460915852385779e-01   +4.718240760438415e-01   +1.488889227064052e-01   +1.734650787921699e-01   +2.109049647926122e-01   +2.487376121577603e-01   +3.053229353180877e-01   -3.106167559866430e-03   +2.831272843912268e-01   +4.093291918294065e-01   +5.966006719900168e-01   -4.039370620505076e-02   +3.507897468890381e-01; +5.860333200211043e-01   +4.672167161549527e-01   +7.176460542148984e-01   +9.748602143979653e-01   +8.810586198462593e-01   +4.664950427586055e-01   +8.258887220784866e-01   +8.842268982748751e-01   +8.408428796656827e-01   +5.061987697811106e-01   +2.955109336638860e-01   +2.621163847305810e-01   +4.013545799055511e-01   +5.034285810102908e-01   +2.015964737448905e-01   +3.015589825499455e-01; +4.018097747561362e-01   +7.347880286733723e-01   +4.116332995062543e-01   +1.000000000000000e+00   +2.416542842250000e-01   -4.798862239265332e-02   +5.836601753138557e-02   +9.356068981792753e-01   +6.748685479054425e-01   +5.933198318918357e-01   +8.387602353803986e-01   +2.897358569146460e-01   +7.633503620905746e-01   -3.108293082145114e-02   +1.523386592708276e-01   +3.627686204464985e-01; +2.987802619965738e-01   +2.555954791428642e-01   +5.762011632016513e-01   +1.127634652321784e-02   +2.498200576766699e-01   +7.545299181873735e-01   +4.947652296271282e-01   +4.932885174578356e-01   +2.068249486793904e-01   +4.287500740901596e-01   +1.786532598104594e-01   +8.232858233728387e-01   +6.573761159087479e-02   +3.277544562931777e-01   +5.166607231660022e-01   +6.176570896022107e-01; +5.891106173561084e-01   +5.543163545686505e-01   +5.488548181993871e-02   +1.408928334412085e-01   +5.485436654322027e-01   +5.186994497049324e-01   +4.749969621094215e-01   +3.751343453500704e-02   +3.184801567252803e-01   +4.304957540053058e-01   +5.358884164030182e-01   +5.256577752079374e-01   +6.020998112256571e-01   +5.306409391840278e-02   -5.506652671276547e-02   +1.894629146480271e-01; +7.892829741551703e-01   +7.991209105282848e-01   +4.966915288138531e-01   -1.134172389125443e-01   +4.051042682248970e-01   -7.796018620421206e-02   +3.656031343907903e-01   +2.102476556778444e-01   +4.322455857895933e-01   +6.756636375474093e-01   +3.424385897917403e-01   +1.600281783346208e-01   +2.088066534165672e-01   +2.580132862234301e-01   +1.154762411747024e-01   +7.975666011427474e-01; -7.128602912070055e-04   +5.266124174368091e-01   +1.581144753975806e-01   +3.836069469393836e-01   +7.187375712036949e-01   +9.440786316053897e-02   +4.230039203518239e-01   +4.342993906143575e-01   +2.450219444649021e-01   +1.866133006734203e-01   +5.884759774063090e-01   -2.086121362793851e-01   +2.119200735333468e-01   +2.109445842731225e-01   +2.261513053668883e-01   -4.341868213755999e-03; +4.008029418120491e-01   +3.536187792578271e-01   +3.202495477425096e-01   +3.500158149655299e-01   +7.385937396174481e-01   +5.191088061219445e-01   +5.336822313575019e-01   +3.507124984727466e-01   +1.524852507879060e-01   +6.400249244835853e-02   +1.034753335696565e-01   +6.207928752060623e-01   +5.580419927881443e-01   +6.769017647519175e-01   +1.374016710480178e-01   +7.516722792443471e-01; +4.300368662710642e-01   +5.616616116281256e-01   +3.007347487949678e-01   +5.413480440915209e-01   +5.724504613774761e-01   +2.661858972764211e-01   +4.810023742209122e-01   +7.731296581318156e-01   +3.586383059786632e-01   +7.056618120484968e-02   +6.216886302345798e-02   +7.441408429227009e-01   +3.372259610094625e-01   +3.789515564451237e-01   +4.051343002697619e-01   -5.518421724418638e-02; +3.329583139765083e-01   -3.478792085074962e-02   +5.135480670647872e-01   +5.249913685600085e-01   +4.680313052919334e-01   +4.187742488102945e-02   +4.398181540650443e-01   -1.105716657151166e-01   -8.818942714950520e-02   +4.980349790943503e-01   +1.969336057531574e-01   -1.746538551072104e-01   +7.251186992323990e-01   +6.363941784491245e-01   +1.023564785737514e-01   +2.961629796233858e-01; +2.630346621945123e-01   +2.422067770566264e-01   +9.578796349864498e-01   +7.193973878914789e-01   +6.994422302095014e-01   +8.459824526356905e-01   +1.991017315876724e-01   +2.917822177476116e-01   +2.196444798199386e-01   +2.145081669413773e-01   +3.714725954816285e-01   +5.726643344596797e-01   +2.987668599577211e-01   +5.722148841590985e-01   +4.971560420069381e-01   +4.123854402350058e-01; +5.646659363393535e-01   +8.511408427180287e-01   +6.516513805141489e-01   +7.204717789075802e-01   +7.748512125666542e-01   +4.422526395591360e-01   +2.216861148391082e-01   +1.995371140538981e-01   +5.217093481902986e-01   -1.806276607612460e-01   +4.113769953251423e-01   +3.575044037395531e-01   +2.499859657628058e-01   -1.830348053096319e-01   +1.595043222121107e-01   +2.620276343391809e-01; +1.536069314185341e-01   +4.747320880682957e-01   +4.505254842961410e-01   +3.285106303827995e-01   +5.520169425019441e-01   +7.884526028103809e-01   -4.851914708555238e-02   +5.322563998525501e-02   -2.212673357986182e-01   +4.114142708360271e-01   +5.172692817815049e-01   +7.120808436899360e-01   +7.483232561225366e-01   +7.897633853807960e-01   +3.859600500563226e-01   +8.685895574732282e-02; +6.597169060090295e-01   +1.668453453691801e-01   -1.357336362565902e-01   +3.341085385505518e-01   +6.150626238090374e-01   +5.043517235049697e-01   -1.589712443403438e-01   +7.391850572863050e-02   +3.554144365609848e-01   +5.232995512328510e-01   +6.636001305260778e-01   +3.861786335530612e-01   +6.711760185302028e-01   -1.944278022836089e-01   +5.454532258225808e-01   +3.931261602209961e-01];
L1E_L1I_iGABA_netcon = [+4.906056689635323e-01   +6.077731021868200e-01   +4.806103299153609e-01   +5.135809483495533e-02   -7.106001171546705e-02   +3.025721600547109e-02   +5.598731936705487e-01   +1.075876839309050e-01   +6.115092195540323e-01   +5.084928157320044e-01   +4.216278217246970e-01   +3.705533058163055e-01   +6.974792715083444e-01   +1.456521001169347e-01   +3.745272227249083e-01   +1.682586725135169e-01; -1.169048458753358e-01   +2.039820682814254e-01   +1.681702683727845e-01   +3.788858555299361e-01   +1.730601473231927e-01   +3.211486341827691e-01   +4.142131494290682e-01   -2.857527415117249e-01   +7.679023914355589e-01   +3.659158300811561e-01   +4.760917418677681e-01   -1.778074347094150e-02   +3.250565243253153e-01   +1.932843214485486e-01   +2.924345950340667e-01   +4.348884313761216e-01; +6.668767347156802e-01   +4.285498942755314e-01   +3.807295349173716e-01   +5.360194264752014e-03   +5.198933618180973e-01   +7.649690151330448e-01   +2.773972875037271e-01   +1.146192778568843e-01   +4.312684862944605e-01   +2.412891898763004e-01   +7.384631871272536e-01   +6.524334023220905e-01   +7.094325257426922e-01   +1.064879708120239e-01   +4.677940195975956e-01   +5.517265938027396e-01; +1.862808834904132e-01   -2.329534891904645e-02   +9.613273672013964e-02   +5.616571935292328e-01   +5.889722516568064e-01   +4.952237820422032e-01   +7.342534448528377e-01   +2.858153586001562e-01   +3.530598038263548e-01   +7.678394997734690e-01   +1.747193200231257e-01   +2.422450636070526e-01   +5.235032336643888e-01   -6.565094298346216e-03   +5.674167082168950e-01   +4.083905569055095e-01; +1.358630370529691e-01   +1.379828024754770e-01   -5.204294805920809e-02   +2.569475263626090e-01   +2.214475228036823e-01   +4.574514637645157e-01   +6.195066246056429e-01   +8.149423825624036e-01   +3.928345079842342e-01   +2.633030137026206e-01   +2.922521647639110e-01   +6.099492768046461e-01   +1.394088518481848e-01   +5.008298244486791e-01   +6.056432709498628e-01   +2.260155974823193e-01; +5.927027011618543e-01   +2.464718178731696e-01   +2.924186422180421e-01   +2.264277954794529e-01   +2.663007030893176e-01   +1.273590435005401e-01   +4.299027334338080e-01   +5.026965168031126e-01   +7.262446491126871e-03   +5.432831778317142e-01   +3.437031919581022e-01   +2.504537696037616e-01   +5.874044208335738e-02   +4.995469749372635e-01   +3.367364412505084e-01   +5.758342978866288e-01; +1.116322332197034e-01   +5.932503598700625e-01   +8.187522275226464e-02   +3.847360158415516e-01   +8.291888412502424e-02   -3.665605458049825e-01   +6.965459576718065e-01   +3.679783680868587e-01   +1.921338143086457e-01   -4.588505036146855e-02   +3.252165979626596e-01   +4.288557831199059e-02   +2.430804317070180e-01   +4.625699193316654e-01   +5.906235266610660e-01   +3.617145377303895e-01; +3.074515403688128e-01   +9.572008817803991e-01   +5.534534262769060e-01   +2.150009586691761e-01   +4.530656975876082e-01   +7.491165322626423e-01   +7.132784032763935e-04   +1.269737186649324e-02   +2.966570722074420e-01   +4.925308558909517e-01   +5.596524066842989e-01   +1.369313993738660e-01   +3.906361826083726e-01   +7.291210061799087e-01   +6.560898531322346e-01   +1.191953861079613e-01; +8.138580437240084e-02   +8.556749647021955e-02   +4.496441081696684e-01   +4.306569892005617e-01   +6.195146031148218e-01   +2.909382892447128e-01   +6.447555060706496e-01   +6.102857009903668e-02   +3.255976182406207e-01   +1.434566877801275e-01   -6.634290102576133e-02   +2.543047079359586e-01   +3.841232635359166e-01   +5.210211886745277e-01   +3.233539894746977e-01   +1.507052447935546e-01; +2.928349836723545e-01   +6.830126565564899e-01   +4.135796565608451e-01   +1.945097082880702e-02   +2.671269964795412e-01   +5.634136321062277e-01   +4.023998324328954e-01   +7.855944382038277e-02   +3.289874707992785e-01   +5.143192392787789e-01   +2.831126769973013e-01   +6.881052700441571e-01   +4.064820429023028e-01   +1.528072532859626e-01   +5.725147140674549e-01   +2.649154222337661e-01; +1.693807627597713e-02   +5.933000540601288e-01   +7.760029331632193e-01   +6.025310811206038e-01   +5.079644184067912e-01   +9.442206553956062e-02   +2.756313399456216e-01   +5.019052977170548e-01   +6.066061774785799e-01   +3.686539474428521e-01   +6.070660147800927e-01   +4.327345124998446e-01   +1.648491777789549e-01   +6.828305445745394e-01   +2.178834104960501e-01   +4.465008739838603e-01; +6.544658116537625e-01   -6.716304305445953e-02   +8.620543703644343e-02   +5.984361834095668e-01   +6.711549001209067e-01   +2.469792166090220e-01   +2.233060396098348e-01   +3.260452864410068e-01   -3.055583006603702e-02   +2.417415332605214e-01   +5.072866623219843e-01   +3.962392682778992e-01   +5.229457979737465e-02   +9.915892610567781e-02   +2.793546446220787e-01   +5.786630759578192e-01; +5.003514379982612e-01   +6.753552671777585e-01   +6.410943405343014e-01   +5.049828403369216e-02   +3.318600978992107e-01   +9.612259027571738e-01   +2.276419604657454e-01   +6.120918426938562e-01   +3.987983555904048e-01   +4.294432833566048e-01   +6.494260506514886e-01   -6.950900803581947e-02   +7.170837699879187e-01   +2.589226802207551e-01   +2.658733795649227e-01   +4.925611825655836e-01; +3.552699279748102e-01   +4.041104332665008e-01   +2.387423828678320e-01   +7.494371524534821e-01   +7.931490385131659e-01   +7.212789349118059e-01   +7.179533352519606e-01   +1.156743482560986e-01   +2.082822302349810e-02   +2.725170904384200e-01   +4.627795033587197e-02   +5.649169748261649e-01   +4.005357702330649e-01   +4.472515010941369e-01   +5.743258759986478e-01   +3.405835403688280e-01; +8.764336233009122e-01   +8.048638692136730e-01   +2.006586969110425e-01   +2.169551484171664e-02   +4.635944691356479e-01   +2.548619341138619e-01   +3.604191415110213e-01   +1.562983929519573e-01   +6.547283169199800e-01   -6.001235539267416e-03   +6.327686028922044e-01   +3.968369471677151e-01   +7.200686504497620e-01   -1.165509045374755e-01   +1.597393571311281e-01   -1.807729565391974e-01; +2.790738790183049e-02   +1.593205177758279e-01   +6.906578339343284e-01   +1.544399604376973e-01   +1.917511379099109e-01   +3.788081022238157e-01   +2.107717369846177e-01   +6.961794293002812e-01   +6.995087684651535e-01   +1.388160199188497e-01   +6.454238787791294e-02   +7.506686969299593e-01   +1.306798963059490e-02   +6.833789815547432e-02   +1.897261006108780e-01   +3.294071288692560e-01];
L2I_L1I_iGABA_netcon = [+3.798407350521094e-01   +2.497472879744227e-01   +7.593987306323361e-01   +1.356494943768815e-01   +8.013812165398330e-01   +6.176016624180849e-01   +6.843779828199248e-01   +9.331437120610097e-01; +2.944500283811555e-01   +3.998786539148795e-01   +3.539020500284095e-01   +3.051862471254767e-01   +6.807784151425814e-01   +1.398650995478134e-01   +1.961356641245980e-01   +9.057761128273673e-02; +5.099152315495655e-01   +5.490553251604130e-01   -1.953513109231428e-01   +2.155267507777527e-01   +5.915322565261685e-01   +2.042411579546344e-01   +5.160836288556627e-01   +3.815332589368584e-01; +5.579621708652578e-01   +4.470145605050839e-01   +2.279658481989110e-01   +5.236350724104243e-01   +4.953070632085251e-01   +1.130418145399153e-01   +2.698425804411302e-03   +4.067175603397157e-02; +4.800572021871513e-01   +5.948233064352105e-01   +3.043238726908174e-02   +1.096454277525821e-01   +6.787560398862262e-01   +3.202760619615098e-01   +5.424550533997406e-01   +5.814570905387837e-01; +8.172770222936896e-01   +6.421235356037636e-01   +4.273208123802117e-01   +5.094987619321720e-01   +4.407280694319717e-01   +2.176066964159545e-01   +6.984110579572919e-01   +1.171254607887718e-01; +2.396633824847471e-01   +4.908239940941742e-01   +6.174570619712770e-01   +7.369949124050362e-01   +9.430095896145144e-02   +1.303659485666541e-01   +3.904441998254360e-01   +5.116621460829714e-01; +4.473157575595220e-01   +3.811900957631943e-01   -6.863095371902772e-02   +2.879071934509533e-01   +1.684256584207453e-01   +5.406781471893694e-01   +2.743872109637276e-01   +4.410016289075328e-01; +1.620304410276135e-01   +2.653061469536924e-01   +8.427320665430172e-01   +3.176270843502592e-01   +3.219029365842889e-01   +8.973726731907053e-01   +3.937293506552473e-01   +7.842286906114834e-01; +6.255510647671603e-01   +3.216299383622698e-01   +1.148707751410973e-02   +7.235015655565208e-02   +7.062012372289511e-01   -1.054268971129041e-01   +2.734319686190018e-01   +4.660088938386717e-01; +4.917040990449735e-01   +3.644503322687837e-01   +2.836218087237685e-01   +1.000000000000000e+00   +1.542257841851655e-02   +4.021284282870088e-01   +9.101755494382989e-01   +7.512686875406318e-01; +6.259440425285862e-01   +8.291080286784993e-01   -9.493879842904990e-02   +1.913670581807044e-01   +2.539328881123147e-01   +5.951895901313538e-01   +6.138922215039456e-01   +1.366041440128807e-01; +9.705539358065786e-01   +1.263433976765500e-01   +6.457553764424159e-01   +4.861185252468589e-02   +4.860642571133778e-01   +1.142158229270103e-02   +7.402574097728952e-01   +9.998338782807776e-03; +6.453920672674953e-01   +2.537352023475705e-01   +4.328391544717217e-01   +4.787864221926220e-02   +3.504724355677672e-01   +4.779716045260148e-01   +1.200578628166546e-01   +2.035877214434432e-01; -1.517957568074402e-01   +7.884061376633669e-01   +5.816329391479405e-01   +2.698920897166124e-01   +2.693040142108308e-01   +6.133627367835944e-01   +8.492941514121730e-02   +4.616644083521156e-01; +2.752950194262835e-01   +7.806039301303594e-01   +3.666099154274768e-01   +5.509038725858908e-01   +3.065113199701383e-01   +3.406865249297770e-01   +4.234334739603645e-01   +1.832351540044810e-01];
L1I_L2I_iGABA_netcon = [+1.641862081253442e-01   +4.751245970616130e-01   +4.492626826720609e-01   +3.798839380465134e-01   +6.516245998324592e-01   +2.877212666035987e-02   +5.609408078790945e-01   -6.129426356641840e-02   +2.847703431430879e-01   +7.102051350068906e-01   +4.585420895731910e-01   +4.905157280719570e-01   +4.319613844086940e-01   +3.134446063087448e-01   +1.575926427420769e-01   +4.362079966487333e-01; +7.204368685279114e-01   +4.632514661685698e-01   +5.525344346638876e-01   +4.511965494108313e-01   +6.696504642182126e-01   +8.122480914171835e-01   +4.845012297257834e-01   +2.986651812044796e-01   +5.074996197705743e-01   -4.612749666844239e-02   +2.185662230057995e-02   +8.004990867481370e-01   +5.782970319654986e-01   +2.967522630434767e-01   +4.847927740831113e-01   +7.167498922851664e-01; +2.419393138459026e-01   +7.656371885438705e-02   +2.964350309080714e-01   +3.970729219320215e-01   +4.316496922404860e-01   +6.476045223625226e-01   +5.079896656134403e-01   +4.443458594926367e-01   +5.073561237574195e-01   +3.459977492924349e-01   +4.686964073586911e-02   +4.640162009552218e-01   +7.717140962269452e-02   +9.197457325126955e-01   +3.983699530362225e-01   +1.811828289715191e-01; -1.896351186624377e-01   +6.610608250144661e-01   +5.303171386254528e-01   -8.767267858884077e-02   +4.265920734733917e-01   +5.969303139327271e-01   +8.540418449766575e-01   +2.335376583422179e-01   +6.709341432163691e-01   -8.603994714206642e-02   +1.347681363726908e-01   +8.250589637851806e-01   +1.664398872760952e-01   +4.483454198453650e-01   +7.740896850019778e-01   +6.251509980070183e-01; +4.505142781004423e-01   +7.251493966503805e-01   +5.717860037423632e-01   +2.176062653519990e-01   +3.670646100602010e-02   +2.761543117511729e-01   +5.526441766500415e-01   +1.166444831699983e-01   -5.072395957780607e-02   +3.801843804289842e-01   +5.957159550442939e-01   +5.437396384550796e-01   +1.032226960643545e-01   +4.447917648818232e-02   +3.675049924259113e-01   +6.515839865265749e-01; +8.443949398800373e-01   +5.290203551343662e-01   +2.620113232773000e-01   -2.706116610593336e-01   +2.466550645237089e-01   +2.138052176807579e-01   +7.207908259022830e-01   +3.511719490063562e-01   +3.477484780135754e-01   +8.891410952324041e-01   +1.000000000000000e+00   +7.278791091506206e-03   +5.807737631431330e-02   +6.194246727175512e-01   +2.736069983051138e-01   +3.518032531954420e-01; +1.550801146165123e-01   +6.530756875261821e-01   +6.587381750922714e-01   +4.423592437398977e-01   +3.651293042024344e-01   +8.176112796044245e-01   +4.524095381431703e-01   +3.060528016272390e-02   +2.265304997113587e-01   -3.487165852778115e-03   +5.033378220291854e-01   +1.883623016220377e-01   +7.641685680385785e-01   +7.922829659450007e-01   +2.105107232304351e-01   +5.103957182179159e-01; +4.218084578352855e-01   +6.796792470027969e-01   +4.844451860833848e-01   +6.855794202977175e-01   +6.948184919198410e-01   +4.700502539964334e-01   +3.274903393589518e-01   -3.494145488336144e-02   -1.682704438948947e-02   +7.347145904789648e-02   +1.633712252444623e-01   +3.170733798835913e-01   +1.818103590789235e-01   +7.022562735833248e-01   +4.876737605831509e-01   +4.725804934196942e-01];
L2E_L1E_iAMPA_netcon = [+8.226690066969518e-02   +3.109295261907840e-01   +8.467731580192046e-01   +4.585234836164851e-01   +5.490619486744767e-01   +2.753802230789765e-01   +7.303732219510527e-01   +8.743612574803994e-01; +7.664355401151695e-01   +8.631280967911879e-02   +3.068421319573521e-01   +4.899192465736232e-01   +2.676793698914592e-01   +3.697217743587585e-01   +2.279018960803828e-01   +5.536366836548412e-01; +2.386748066091113e-01   +2.402230957912017e-01   +4.788545447423487e-01   +1.000000000000000e+00   +1.675616766469676e-01   +5.294461550026822e-01   -1.017231882880501e-01   +6.681430963267373e-01; +3.502735927015842e-01   +2.529605024648915e-01   +5.607096293779757e-01   +8.456574341354551e-01   +5.117409361277725e-01   +3.850085160783122e-01   +6.526669566167627e-01   +5.824945337945525e-01; +9.025529328941480e-01   +7.518130815326701e-01   +3.628252600422930e-01   +1.153027927610658e-01   +3.816936727996832e-01   +3.112347771272758e-01   +3.501480390973418e-01   +4.821152979237187e-01; +7.540233272278396e-01   +2.289328044088687e-01   +9.403666006495861e-01   +7.880763285590436e-01   +7.603032198933972e-01   +6.482458877282115e-01   +6.486443203498196e-01   +7.624292734659686e-01; +5.740785941721864e-01   +1.416625898312398e-01   +2.001499482768304e-01   +9.843541873663768e-02   +6.907684370644630e-01   +6.054886808722330e-01   +1.652098383827710e-01   +8.080473629076956e-01; +7.698534425780418e-01   +4.848768793564689e-01   +5.334222060697922e-01   +4.660027146772646e-01   +2.319333722506597e-02   -1.061376611585963e-01   +5.048409300946968e-01   +8.115045583300253e-01; +2.937638710209736e-02   +1.985529205214824e-01   +4.904301052423423e-01   +2.107147258388037e-01   +6.622679821523472e-01   +6.733297535251526e-01   +3.757081373166074e-01   -2.412322934075832e-02; +4.974342275551905e-01   +3.843421448265083e-01   +3.944032179196602e-01   +7.850251985336660e-01   +5.352872130274268e-01   -3.271660113253798e-02   +8.233424092630803e-01   +3.903367465959014e-02; -8.064867013478018e-02   -4.717462205195001e-02   +3.762373663385006e-01   +6.124698188858291e-01   +2.406671111882561e-01   +5.253130554670198e-01   +7.675447972940336e-01   +2.172807991569510e-01; +6.972694204305007e-01   +2.577204961391067e-01   +1.078517186108762e-01   +8.045945638892614e-01   +5.670428345928422e-01   +2.662115419520638e-02   +2.816900945980535e-01   +6.337182122002319e-01; +1.621964922211133e-01   +6.784427822762292e-01   +5.177303681925518e-01   +3.806072736626053e-01   +4.902761287981072e-01   +3.394029915020542e-01   -1.891910200661875e-02   +3.685476500373825e-01; +6.756186302296940e-02   +6.081196748104567e-01   +7.763177117495870e-01   +5.851547906901327e-01   +3.184402261568560e-01   +5.236711780449196e-01   +3.997637131241823e-01   +7.870979687917808e-01; +5.940264760479110e-01   +1.938268811070933e-01   +3.918997728768058e-01   +6.570897748067285e-01   +8.393357411323197e-01   +5.098479953702759e-01   +6.515849448959015e-01   +6.434326803595032e-01; +4.238844707577520e-01   +3.337621619312377e-01   +1.625516672100322e-01   +1.454654576764221e-01   +6.373615744161717e-01   +1.496280315583884e-01   +1.031898990967140e-01   +1.701514733028081e-01];
L1E_L2E_iAMPA_netcon = [+2.998501961737698e-01   +4.828596888072171e-01   +2.042256536201880e-01   +4.246796761697832e-01   +1.337071384089518e-02   +3.340501248467782e-01   +2.547052022091193e-01   +7.703617926961791e-01   +7.597739221420630e-01   +3.261282578432594e-01   +3.750151235204692e-01   +6.045778198465095e-01   +5.575593947805169e-01   +1.808966137591901e-01   -3.980145109261136e-02   +5.523817540570782e-01; +4.395389167530875e-01   +5.218018047021545e-01   +8.102697047237735e-01   +6.605075869260907e-01   +4.657971550668121e-01   +6.030368642858204e-01   +5.581938122498906e-01   -2.168723540603133e-01   +2.986937590129319e-01   +4.975487318638366e-01   +2.192203298228110e-01   -1.475083767460488e-01   +5.198821933347455e-01   +8.880473677666255e-02   +1.740999417649804e-01   +2.080533577762682e-01; +1.856747542998960e-01   +2.617520444701654e-01   +6.085097787960843e-01   +6.209794899662683e-01   -7.453953297154561e-02   +2.613781765609905e-01   +5.726783187500343e-02   -1.749671963430080e-03   +4.833680476456794e-01   +2.395425859610343e-01   +9.491309559728540e-01   +4.628210874255009e-01   +3.852192462374631e-01   +5.881258913809049e-01   +4.863089831692728e-01   +4.222626702147568e-01; -2.756420096586031e-02   +6.288703644523986e-01   +4.518849436266179e-01   +6.567752438819913e-01   -1.516358171902971e-01   +5.245743363952959e-01   +2.372842768820126e-01   +4.669667138960266e-02   +2.656141124100946e-01   +5.613890330053088e-01   +4.315456925472444e-01   +3.403511967559444e-01   +3.110955221859222e-01   +3.465707743195728e-01   +3.550375685809748e-01   +1.736579830675466e-01; +3.070099518875051e-01   +6.153806342519662e-01   +7.746424520105437e-01   +2.034859409258803e-01   +2.721293370648444e-01   +7.115417805118760e-01   +3.405926176355446e-01   +2.160642509172017e-01   +5.629996804593179e-01   +6.306777327919325e-01   +8.832615702900483e-01   -1.232555825991118e-01   +8.585921929742216e-01   +7.758790660922572e-01   +3.014794015886508e-01   +2.510937921955714e-01; +4.368191939675003e-01   +1.705855169603737e-01   +3.206762230370445e-01   +4.060350073969546e-01   +5.060384470217705e-01   +4.263270810139260e-01   +7.314400683178318e-01   +2.033113037860755e-01   +2.001555550256229e-01   +5.625416859821268e-01   +2.946357086847321e-01   +4.693663661963072e-01   +5.516806712052279e-01   +3.650789105079841e-01   +5.068481619616403e-01   +4.111556278451614e-01; +4.365754547556058e-01   +2.533725677079641e-01   +4.119788774385117e-01   +6.464636639963677e-01   +1.857525690211575e-01   +4.568454391793010e-02   +7.540544542231463e-01   +8.017932437217051e-01   +4.030332607377010e-01   +5.334734379972691e-01   +4.774070238074065e-01   +5.707847459798645e-01   -5.812460840751041e-02   +4.444739441994149e-01   +2.342768783659340e-01   +1.430023090457812e-01; +4.617065648115793e-01   +5.848987897437978e-01   +4.459465678228125e-01   -6.127669867439552e-02   +7.531859803453655e-01   +4.090780109178664e-01   +5.245507626576575e-01   +4.751577858303528e-01   +4.072369075966036e-01   +1.656783413659773e-01   +4.756999059247695e-01   +2.345180025240178e-01   +4.556572750336368e-02   -2.221687733535293e-01   +4.420652322795555e-01   +4.593432265317904e-01];
L2I_L2E_iAMPA_netcon = [+1.645438134961543e-01   +7.266960139721472e-01   +5.646390400787274e-01   +6.616721819477820e-01   +3.483170570981655e-01   +2.973644488540859e-02   +9.526549741940002e-01   +5.865385230567570e-01; +6.217707063746392e-01   +9.164488354480844e-01   +4.122092798624365e-01   -2.278637996215475e-02   +5.710527610220594e-01   -3.978002583807165e-02   +1.619200092850860e-01   +3.680900467242944e-01; +6.637580303939767e-01   +4.782050384028016e-01   +7.083250462771804e-01   +1.305600612350759e-01   +2.958512460458629e-01   +7.614890654380506e-01   +5.209596167649913e-02   +2.221373659069315e-01; +4.300661908689768e-01   +7.162935591122543e-01   +1.969513329187253e-01   +1.176827222069237e-01   +6.265746955579531e-01   +7.605655796136089e-01   +6.736638755336428e-01   +6.297337821366913e-01; +7.690792107087581e-01   +2.896919535371050e-01   +5.992682790907964e-01   +2.501726622026755e-01   +2.752674865194642e-01   +7.723185213721919e-01   +6.791008420468981e-01   +4.240055336800247e-01; -1.241589037328012e-01   +2.284116961531200e-01   +1.644222286557200e-01   +3.529782262212258e-01   +3.033230011373707e-02   +7.175143330253324e-01   +8.918139254958733e-01   +1.554744310508754e-01; +7.837936737025263e-01   +2.045689088765225e-01   +5.786321155342794e-01   +1.109334296159421e-01   +1.961712282415728e-01   +2.102302738032680e-01   +7.136547151048563e-01   +4.800648051949592e-01; -3.550839582944917e-02   +3.649333264714175e-01   +2.762124999858400e-01   +1.314845674910639e-01   +8.946262819728706e-01   +4.709654046461573e-01   +1.724775318124450e-01   +1.197438215223695e-01];
L2E_L2I_iGABA_netcon = [+8.359633213040234e-01   +7.681783564215919e-01   +7.282348892733737e-01   +6.812053843453054e-01   +3.048761073329464e-01   +8.583514291067433e-02   +3.452462867942717e-01   +2.910445540331669e-01; +4.602925184290523e-01   +9.518864631167534e-01   +8.180334944954496e-01   +8.058083642258673e-01   +2.198350164546178e-01   +2.988604858101385e-01   -2.374815815102875e-02   +9.724183771994143e-01; +2.246286974451213e-01   +7.807963702168812e-01   +8.931277978736735e-01   +9.056266909375916e-01   +5.536479338081252e-01   -1.561033165799419e-01   +6.350225764186000e-01   +1.492348942134152e-01; +5.009271158320596e-01   +3.180011836437612e-01   +6.674936176685635e-01   +1.911443422476979e-01   +6.120986065466630e-01   +4.549101414558703e-01   +3.861513787092801e-01   -1.279477307684334e-01; +5.040970254359837e-01   +8.764449933710809e-01   +6.178181661562581e-01   +5.163395141090897e-01   +6.443223631778198e-01   +3.230015731341588e-01   +7.998892467777686e-01   +2.318113073172333e-02; -5.582144924540781e-03   +2.218398362726327e-01   -1.859185281246017e-01   +2.104223701480242e-01   +8.069860571579679e-01   +5.549199183260420e-01   +4.584267161113500e-01   +1.941699073351148e-01; +4.692296464748194e-01   +9.174163220478646e-01   +3.953240980080948e-02   +2.850885849209255e-01   +4.683810306085840e-01   +8.728815187672506e-01   +5.768706460259808e-01   +8.418998155188133e-01; +3.658758686829365e-01   +3.220066167241855e-01   +2.476489308099569e-01   +7.635919315716064e-01   +4.180002110846818e-01   +4.810407002736377e-01   +2.407220057255521e-01   +2.346629161530586e-01];
L3E_L2E_iAMPA_netcon = [+1.986978146986935e-01   +1.485533349045961e-01   +6.571280286046705e-01   +5.173200145720859e-01   +6.432189545735516e-01   +6.006031840744456e-01   +6.673533830407605e-01   +6.235837857875743e-01   +9.648329577063415e-02   +8.205065773659841e-01   +9.369961887678490e-01   +6.044897728149218e-01; +3.292849371268818e-01   +4.228106550027452e-01   +8.331946826730444e-01   +3.072235073748059e-01   +4.393755668077045e-01   +2.956961215183391e-01   +2.482265906335755e-01   +9.803624858555096e-01   +2.018372714948853e-01   +5.884225420268560e-01   +4.568738484968702e-01   +5.036307675423793e-02; +1.666251773509438e-01   -5.645094394199916e-02   +2.057439663280231e-02   +5.699571423317114e-01   +8.301378051817560e-02   +4.860837145364822e-01   +2.813719576598018e-01   +3.246907399515597e-01   -6.993665679627724e-02   +1.862828698324551e-01   +2.907550333995959e-01   +5.402854519450884e-01; +5.616536574373013e-01   +4.918725551124381e-01   +1.308627979051707e-01   +5.451150138414270e-01   +5.367582188005310e-01   +1.186345723540341e-01   +2.984735468719441e-01   +1.381447644001942e-01   +7.340525582030034e-01   +1.861855170038475e-02   +2.338336130483852e-01   +6.368422680913373e-01; +6.616578894274290e-01   -1.351035183931349e-01   +6.339896441927910e-01   +4.791114790481573e-01   +5.775661018616720e-01   +9.198363799944419e-01   +3.933214528225020e-01   +4.701634644541200e-01   +9.041372916648076e-03   +8.700728077184251e-01   +4.790376578173229e-01   +1.682275132695278e-01; +6.204275803719539e-01   +6.883721226006312e-01   -4.602950262282987e-02   +4.909008561250702e-01   +2.882817104985637e-01   +8.042442886935846e-01   +5.933430477113018e-01   -2.832858225205559e-02   +2.178966187975377e-01   +6.938436952887015e-01   +2.190078300967891e-01   +7.357144565110396e-01; +1.627377851921846e-01   +4.203663843710381e-01   +4.609652062154230e-01   -1.662338436644406e-01   +9.491024860117145e-01   -3.368644471487293e-02   +5.809938965211148e-01   +6.884881462819378e-01   +1.409198970046858e-01   +4.054782231788165e-01   +8.966999746312865e-02   +6.027332271373147e-01; +2.359227259329878e-01   +4.933576631855262e-02   +8.874099597915412e-02   +3.006524868175938e-01   +7.470647568393070e-01   +6.379997283181010e-02   +5.349419147269651e-01   +1.508028992729002e-01   +6.668924472917276e-02   +5.194357151594571e-01   +5.594232872112620e-01   +9.449114661807134e-02];
L3I_L2I_iGABA_netcon = [+6.868538193905218e-01   +4.169043536821877e-01   +7.508720850248015e-01   +9.104509446094580e-02   +2.609953491653558e-01   +6.025163071852271e-01   +5.035049473755643e-01   +3.049712069605114e-01   +4.814400400007991e-01   +4.844613960599886e-01   +5.662829078000745e-01   +7.925440074404042e-01; +4.935855381992984e-01   -2.106522109572265e-01   -1.304422724209564e-01   +7.053392372087739e-01   +2.236577495200510e-01   +4.743265921498542e-01   +2.989210924113467e-01   +3.356839045510602e-01   +8.037977380542810e-01   +4.835756889541097e-03   +6.286524408687941e-01   +2.331485947417238e-01; +2.397121819676876e-01   +3.612646211390531e-01   +8.379639068382578e-01   +7.772465730461716e-01   +1.273155284153750e-01   +3.360314879587231e-01   +1.327570543815858e-01   +6.205471319250195e-01   +6.036671513166808e-01   +3.170260310167416e-01   +7.095854253556416e-01   +8.364543334164579e-01; -1.015233956345466e-01   +2.635171689644827e-01   +8.480587856341364e-01   +3.732119657449863e-01   +5.033747827274175e-01   +7.152215947805490e-01   +1.769492521440242e-01   +4.495443458171682e-01   +1.492781760481365e-01   +1.450035373183942e-01   -6.220266011902224e-03   +1.597531221806224e-01; +2.921566056200076e-01   +5.426069929847567e-01   +1.072974391219241e-01   -1.069712920020034e-01   +3.804183573491546e-01   +3.416560078856251e-01   +2.520127011149764e-01   +3.559944898609846e-01   +3.080503906758477e-01   +6.652993278371007e-01   +8.421717744022993e-01   +6.554855768388457e-01; -2.951756968509192e-02   +8.847312547091730e-01   +2.492811992119690e-01   +5.603507925694642e-01   +2.792774957863912e-01   -7.137845184775288e-02   -1.333266483926213e-01   +3.684885439815309e-01   +2.776986164044449e-01   +5.864839001923495e-01   +7.317593851470290e-01   +6.082605291824302e-01; +6.576200593149381e-01   +3.381511932476146e-01   +6.619288782004263e-01   +3.164168345641256e-01   +5.287669652907806e-01   +3.808233045322169e-01   +4.233708408315554e-01   +3.498506673061329e-01   +2.170244949833865e-01   +6.794067079810600e-01   +3.636323233755793e-01   +6.743342632076090e-01; +5.289009328593910e-01   +7.937749131145013e-01   +4.229187294384323e-01   +1.562512874474505e-01   +3.178835050445786e-01   -2.537217246540274e-01   +9.358316013033408e-01   +5.857055451461517e-01   +6.675384860467710e-01   +7.134583057308208e-01   +4.159865135657069e-01   +7.116172926916878e-01];
L2E_L3E_iAMPA_netcon = [+1.727590860185629e-01   +2.727761726334831e-01   +2.617585270897721e-01   +5.470015254062979e-01   +7.124072336952567e-01   +2.621619810760679e-01   +2.368828802998185e-01   +2.917764330208800e-01; +5.245678828166724e-01   +7.087299649555242e-01   +1.811760917741772e-01   +6.206032533972986e-01   +2.023780832516809e-01   +6.711708946835111e-01   +1.962730856048345e-02   +5.834778413221091e-01; +9.485332501646088e-01   +4.785850594719545e-01   +3.255699450016534e-01   +1.195075741702973e-01   +8.454378519671925e-01   +1.812206408546725e-01   +3.864819502594242e-01   +2.776019492379661e-01; +4.025912265428638e-01   +7.361695502992686e-01   +5.885051226800579e-01   +5.093342091062091e-01   +6.956778008098281e-01   +2.829454036263486e-01   +4.215633586995570e-01   +6.165034301717149e-01; +2.702300406008878e-01   +3.610706867540047e-02   +7.197039389400716e-01   +5.115127904094362e-01   +3.801627000537976e-01   +1.332752497529553e-01   +8.149704970643824e-01   +3.037776425673701e-01; +4.290455935384364e-01   +6.344673883643677e-01   +8.682581761505025e-02   +8.606674230853189e-01   +7.889371654533539e-02   +6.916958197236853e-01   +3.225980350596168e-01   +6.470888800262691e-01; -2.838143178469961e-01   +5.211345974913743e-01   +4.662717912502438e-01   +2.331743886877058e-01   +3.494401235424072e-01   +5.389154169813363e-02   +8.324023817752347e-01   +5.500209795950272e-01; +3.349067318629585e-01   +8.051996356962656e-01   +4.031245062153606e-01   -2.603917034337261e-02   +3.880959715565098e-01   +3.716195925981129e-01   +6.544252605561689e-01   +2.332823856581535e-02; +5.854183906571820e-01   +8.372127503073300e-01   +7.381141517024746e-01   +7.422391944547236e-01   +9.850039719247339e-02   +5.719457815895487e-01   +6.788101543429370e-01   +1.000000000000000e+00; +4.739322275244089e-01   +6.733905215953991e-02   +2.225937603393227e-01   +7.056629761292343e-01   +4.631143887811749e-01   +1.343354618055724e-01   +7.544248038213107e-01   -1.839050013163255e-01; +2.260001337638471e-01   +4.368619047282129e-01   +6.124069840587167e-02   -1.326511318064733e-02   +3.454757965951060e-01   -3.116945465502862e-02   +3.282515753277912e-01   +9.765294681634417e-01; +6.069796164767781e-01   +5.254740158090007e-01   +3.754262993663607e-01   +9.131246611603269e-01   +9.001901722344644e-01   +1.885055163228203e-01   +3.031816846309482e-02   +3.519568453346477e-01];
L2I_L3I_iGABA_netcon = [+4.589609267070702e-01   +2.290022769940168e-01   -1.140450263054409e-02   +1.000000000000000e+00   +4.278042732000914e-01   +7.577000920895795e-02   +7.077715047976163e-01   +1.216917390233828e-01; +3.004742925738702e-01   +3.094259139155949e-01   +1.113204106311730e-01   +6.969420671919262e-02   +3.179930935749723e-01   +7.399434761031409e-01   +8.265931160040884e-01   +4.165335629121715e-01; +2.235373551312886e-01   +5.881711533905634e-01   -6.227439209003173e-02   +6.010663907890351e-01   +1.468555236504858e-01   -1.156548510985305e-01   +4.122100043635210e-01   +4.359350590690958e-01; +2.211039457151568e-01   -2.463005851592291e-01   +6.271910580933749e-01   +5.653991942646310e-01   +7.575427675735587e-01   +1.774158260271731e-01   +5.144502157432825e-01   +2.945738322965692e-01; +2.363016012772754e-01   +5.087833883978425e-01   +2.809816068345286e-01   +1.194779658423681e-01   +1.964608909197680e-01   +4.749289564480487e-01   +5.657863131683563e-01   +6.768303616176601e-01; +1.812904996943240e-01   +4.257006424809617e-01   +6.207429092725205e-03   +3.480843576584726e-01   +3.956195430147930e-01   +6.708317274665343e-01   +1.302179497760836e-01   +4.835377755680498e-01; +5.762840795334944e-01   +2.666393446772181e-01   +3.046689349842578e-01   +7.158810659191458e-01   +3.603361344663826e-01   -9.845945879532117e-02   +1.305395720019875e-01   +4.623863160647559e-01; +4.950946535028979e-01   +6.577048277786380e-01   +4.005968524272645e-01   +2.299274476277627e-01   +2.848818702558688e-01   +5.648758850231348e-01   +4.234450438433304e-01   -3.117069318715860e-02; -1.864871757465167e-01   +2.366672324418905e-01   +4.069467452393328e-01   +2.814639744747236e-01   +6.398691726940218e-01   +4.767620369834845e-01   +4.621602599382775e-01   +3.279328473954352e-01; +7.178152369871933e-01   +1.925565246024594e-01   +4.251837459852092e-01   +1.576510073551302e-01   +4.110356778230014e-01   -7.129017892700099e-03   -4.385385119915339e-02   +6.071648667035864e-02; +4.162937125011905e-01   +7.472551283145076e-01   +2.006426787990311e-01   +7.373189580354698e-01   +6.446097049523232e-03   +1.130810043109864e-01   +1.967419946260170e-01   -8.550605083022324e-02; +3.052072201871485e-02   +3.958705387056142e-01   +7.854907474190108e-02   +3.239665440737307e-01   +6.016655434059452e-01   +8.191871336607608e-01   +8.544995752740341e-01   +1.115945002165378e-01];
L3I_L3E_iAMPA_netcon = [+3.832701273129570e-01   +7.585914256232104e-01   +2.167505484219679e-02   +4.317912839125286e-01   +8.673949708766835e-01   +1.491755394111663e-01   +6.754014990245440e-01   +5.491139124230930e-01   +8.597782700668152e-02   +2.313645132220162e-01   +2.049421927803418e-01   +5.808616260339408e-01; +7.345036656466797e-01   +7.844291507960185e-01   +6.589203643586014e-01   +2.054472441427511e-01   -4.423683482977209e-02   +7.190292038439727e-01   +6.349590929778112e-01   +9.592287346733146e-01   +1.035303377672277e-02   +7.499876005716407e-01   +3.836388032367249e-01   +6.246743501778563e-01; +5.004654866899172e-01   +6.069932796835285e-01   +4.221271683282847e-01   -2.171250628818615e-01   +7.841295536944799e-01   +8.273094173984977e-01   +4.468010136697743e-01   +7.644847416417616e-01   +2.890122762219881e-02   +5.788172994335682e-01   +9.201708295544451e-01   +5.905987832947770e-01; +8.223329396605962e-01   +5.750188552842155e-01   +4.333943346861366e-01   +8.046171226703288e-01   +7.683304477757975e-01   +7.450493787122975e-01   +9.616742817972819e-01   +8.120222596219902e-01   +8.118100035099154e-02   +7.582082762034623e-01   +5.030542060642236e-01   +6.873977720476885e-01; +5.214142124163601e-02   +6.748227671949081e-02   +1.088998774052188e-01   -1.982270593693492e-02   +6.131570007887768e-01   +8.639734362739353e-01   +1.333290073122604e-01   +6.607559048763318e-01   +6.053561132755410e-01   +1.532929730580436e-01   +8.853468639634207e-01   +8.937015587315758e-03; +4.019985181009558e-01   +9.399236696744983e-01   +2.751250329561946e-01   +7.816141868242839e-01   +3.949488464337771e-01   +1.914229233678431e-01   +5.093867792728952e-01   -1.170573718971523e-01   +4.477706547775674e-01   +3.414684363572498e-01   +3.049019389389240e-01   +3.279305634559631e-01; -5.481770927174230e-02   +2.935574986939775e-01   +1.005800840392491e-01   +4.527389793245160e-02   +9.433017091668456e-01   +3.034637120442142e-01   +4.486305068170409e-01   +5.779406749199010e-01   +3.020549110807435e-01   +4.442806333409000e-01   +4.312246123805157e-01   +3.501239966347578e-01; +1.842910565642882e-01   +1.065172736371096e-01   +3.378772527455298e-01   +2.568613238160757e-01   +2.790936894987515e-01   +5.047454155868321e-02   +3.379865867776905e-01   +4.233905521121200e-01   -6.793277474042496e-02   +7.787909051778805e-01   +3.600347337899399e-01   +2.638071886706295e-01; +1.687102936269347e-01   +1.542780546193948e-01   +5.551798091362656e-01   +4.884879976084560e-01   +4.020143614434000e-01   -6.890772459218054e-02   +2.286656322346801e-01   +4.288923657628367e-01   +7.197240720337965e-01   -1.746573496192724e-01   +1.773368207619242e-01   +4.060072702386453e-01; +3.978747518793944e-01   +5.932473666765703e-01   +4.330040495014650e-01   +5.924671855840197e-01   -1.114078720698720e-01   +2.934226070692005e-01   +6.318255739399083e-01   +5.176745508992425e-01   +7.268360794482983e-01   -1.143423513512349e-01   +5.432191693347588e-01   +3.081380582540154e-01; +2.987272237209080e-02   -7.858493296939849e-02   +6.289692388421172e-01   +3.018854358794250e-01   +1.794692852357071e-01   +4.412162211153705e-01   +5.138479742626730e-02   +5.518829478893941e-01   +8.239378694299822e-01   +8.222887025437100e-01   +1.143083216039308e-01   +5.708435479514503e-01; -1.328597296197447e-01   +4.477644635631549e-01   +3.207520967363157e-01   +5.154851682778835e-01   +8.778620553365166e-01   +1.029009766901148e-01   +3.572280650744834e-02   +4.276429698504832e-01   +6.632662614333570e-01   +4.403247529568926e-01   +3.068588551799721e-01   +3.849547444452016e-01];
L3E_L3I_iGABA_netcon = [+5.503612759122199e-01   +1.807264920903053e-01   +4.688901079523972e-02   +6.727821463162202e-01   +3.977303347873936e-01   +6.870251072127828e-01   +6.857080708032989e-01   +7.438921437154505e-01   +6.467308078333571e-01   +1.882018639031732e-01   +1.581082617166824e-01   +4.607202423949044e-01; +5.442378500796440e-01   +2.358844455449984e-01   +8.352016770261456e-01   +4.043786997138582e-01   +5.482498126107304e-01   +6.326097868200082e-01   +9.365961242792914e-01   +2.007514048946513e-01   +3.627561447912231e-01   +1.710597722548871e-01   +2.094358987273145e-01   +5.240145534759355e-01; -6.782939378389270e-02   +1.246333863661949e-01   +1.564670610917863e-02   +3.983030777243374e-01   +3.509293840568922e-01   +4.221554571333441e-01   +6.573001366248457e-01   +5.246797321433940e-01   +5.225532884203823e-01   +4.743550776516993e-01   +4.808314031234641e-01   +3.155584786149443e-01; +5.689350257638057e-01   +7.880674047671454e-01   +6.174691268931043e-01   +9.156068042708412e-02   +7.051073122886250e-01   +1.863820967588581e-02   +5.763008844373405e-01   +4.553482761000098e-01   +2.803102469516638e-01   -6.181502221472943e-03   +5.900783590085358e-01   +4.287830711778314e-01; +1.142586544880997e-01   -3.642031590656128e-02   +4.698511406540801e-01   +3.936045030354781e-01   +3.478862693031693e-01   +1.630546681620729e-01   +4.796710909982581e-01   +4.306105624049811e-01   +3.865664994409979e-01   +1.518825247908626e-01   +4.385419652660995e-01   -2.347753114895761e-02; +1.379287717049118e-01   +1.307730762979657e-01   +5.317564128570706e-01   +6.948572534726056e-01   +3.591493453847945e-01   +3.585724639591131e-02   +1.555501987564075e-02   +1.416046715597143e-01   +2.072772498210337e-01   +6.118860130462757e-01   +5.884309736200802e-01   -6.111357503530697e-02; +3.851182779803386e-01   +3.744951782109164e-01   +6.877619678101708e-01   +1.928050893764398e-01   +5.093273815684843e-01   +5.420377011353528e-01   -1.107097741508933e-01   +5.496228236299173e-01   +5.768804291636600e-01   +3.574643035593138e-01   +5.162503378796601e-01   +3.891243418798094e-01; +1.730247679622318e-01   +2.160873535083278e-01   -5.671441712327106e-03   +8.602566679734429e-01   +4.925862144949963e-01   +2.496890972358768e-01   +5.027386311479991e-01   +5.066126900420205e-02   +2.453162678195827e-01   +2.864278217290799e-01   +3.918214218657876e-01   +7.806884864784784e-01; +5.202071138233640e-01   +1.611184405892437e-01   +6.862868828050527e-01   +6.328947526135656e-01   +4.967908867183086e-01   -3.681399496777103e-02   +4.286830768946039e-01   +6.101341559547341e-01   +3.705115313901046e-01   +8.567510028852035e-02   +4.688593697196828e-01   +7.436961154581458e-01; +3.480543115173568e-01   +7.945792690635496e-01   +9.762302417650675e-01   +7.243269510096262e-01   +2.300830383903244e-01   +2.348924914432162e-01   +6.677519601417042e-01   -8.076331777349703e-02   +8.990041233288331e-01   +6.605253862854091e-01   +2.457022698327458e-01   +8.764883415951888e-02; -2.128925676260947e-02   +4.784297698379997e-01   +2.686394196842618e-01   +4.809538795608522e-01   +6.781318496044215e-01   +3.522987349100676e-01   +7.774194697596131e-01   +6.360122134275794e-01   +6.359223886754375e-01   +3.974035933777866e-01   +9.347348744104211e-02   +7.866654900031863e-01; +5.715461870956957e-01   +5.610768673760763e-02   +4.163260443757205e-01   +7.376867461554447e-01   +5.449878348993105e-01   +5.604986067855866e-01   +3.625688580964986e-01   +3.429525258761206e-01   +3.490551786689769e-01   +4.890550674168689e-01   -4.144588704276871e-02   +3.763560625782624e-01];
L2E_Input1_iAMPA_netcon = [+7.391248849605593e-01   +9.585396005826101e-01   +7.750899573135696e-01   +8.162501852115952e-01   +9.484839880641945e-01   +7.354847148915107e-01   +1.000000000000000e+00   +6.082148982210566e-01];
L2I_Input2_iAMPA_netcon = [+8.158076640899405e-01   +7.597322144222919e-01   +4.851613701941064e-01   +6.886771937796846e-01   +6.496080807298662e-01   +1.000000000000000e+00   +5.724500109216566e-01   +6.322518349816210e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
