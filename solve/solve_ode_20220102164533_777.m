function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.048208339904570e-02   +3.519382240363479e-01   +6.037498893015053e-01   +4.580009159545794e-01   +4.109603770036909e-01   +6.340474007760625e-01   +3.285648508202244e-01   +1.134816730549929e-01   +1.303525138359561e-01   +2.913937104091042e-01   +3.806352030292319e-01   +1.278406381303522e-01   +2.561394328033023e-01   +4.367608241380112e-01   +2.908811908253528e-01   +5.151653928745885e-02; +2.460488603136392e-01   +8.292175662054814e-03   +3.415937277830380e-01   +4.100428210963501e-01   +1.836992142192879e-01   +2.129842207952931e-01   +5.953189560912373e-01   +6.542084015528743e-01   +4.509009973898640e-01   +1.348142735397772e-01   +6.512854037150538e-01   +1.406735056200841e-01   +1.288364516072165e-01   +2.094510744327093e-02   +3.516449984065537e-01   +2.339054506836394e-02; +4.398236678557967e-01   +4.652753214509474e-01   +5.534865648875593e-01   +3.137317541337112e-01   +7.703908369769398e-02   +5.575875356845124e-01   +5.797849808088894e-01   +2.819384957793013e-01   +3.096353562785822e-01   +2.798688721396858e-01   +2.982460622333555e-01   +9.557625056898368e-02   +4.492631259981181e-02   +9.237817015831938e-02   +5.465615615650042e-01   +3.872771467398565e-01; +4.835714603010737e-03   +1.306970763549140e-02   +3.043577402249873e-01   +4.097510269316346e-01   +1.348085385969737e-01   +5.275265174417355e-01   +3.020649726778848e-01   +6.354803013492282e-01   +3.216136775463717e-01   +1.976644421463396e-01   +5.922804801914066e-01   +5.940741729382207e-01   +8.331023471657373e-02   +6.037209819657311e-01   +1.489876270187535e-01   +2.080398130746597e-01; +3.146593189680426e-01   +4.201670562703110e-01   +4.155372067713038e-01   +4.559587383400048e-01   +2.564669748174113e-01   +5.498931349322370e-01   +3.301991704924753e-01   +1.744102349163466e-01   +3.645944083528754e-01   +5.515869980806051e-01   +2.414574127134335e-01   +4.484870237843624e-01   +1.588072855955795e-01   +2.147064640695300e-01   +5.883096452279688e-01   +1.059390540023371e-01; +3.160370204371723e-01   +9.915193401040555e-02   +5.494494435069742e-01   +1.087472123566260e-01   +4.201539302492681e-01   +1.985012020826369e-01   +2.988338912376103e-01   +1.249267408982430e-01   +3.283383502514980e-01   +3.140380098257115e-01   +4.992531169984798e-01   +1.603448554989861e-01   +3.202351957388274e-01   +3.514508075374758e-01   +3.160209014146963e-01   +4.623707060789148e-01; +2.122920339151995e-01   +4.405818089991915e-01   +6.126928943202252e-01   +4.320452058609831e-01   +2.468667939813571e-01   +4.102930029862422e-01   +2.440758984942807e-01   +5.478848846326220e-01   +6.351184256417854e-01   +2.590666910240291e-01   +9.655908334544254e-02   +1.106972993673681e-01   +2.789869223842726e-01   +6.094424785073741e-01   +3.528794738600212e-02   +1.608965136428515e-01; +3.743488643588869e-01   +2.311898884523183e-01   +5.088530527864846e-01   +4.023684064467189e-01   +3.835228633281926e-01   +1.040607386828537e-01   +5.386108998833078e-02   +2.834428569265199e-01   +5.016375121818115e-01   +4.500634852314761e-01   +1.930506446498443e-01   +4.961287110430447e-01   +2.036703896862392e-01   +7.063657260744241e-02   +4.725436821270186e-01   +4.016166196614769e-01; +9.996568185575577e-03   +4.427670845822996e-01   +4.413182247752520e-01   +4.543859173481272e-01   +5.379535929300433e-02   +6.006397697177132e-01   +2.944055322846841e-01   +2.880713309226209e-01   +3.279196050439157e-01   +3.178639569615342e-01   +1.112175209769643e-01   +5.846146053687292e-01   +6.018332599005942e-03   +5.061933397471333e-01   +2.427903502836488e-01   +3.181910586860591e-01; +4.683854831442898e-01   +7.537191635900564e-02   +5.827937313147386e-01   +5.394661687333531e-01   +4.220762789152187e-01   +1.205866947627400e-01   +5.000490037211600e-02   +7.519349837397876e-03   +4.943340932671255e-01   +2.601683471496050e-01   +6.877891977999592e-02   +3.629465087699104e-01   +5.475896217907925e-01   +1.667442236853919e-01   +5.618471597195097e-01   +4.312086209153577e-01; +2.544361415136495e-01   +3.198272744974030e-01   +3.406292861144117e-01   +5.162118858750092e-01   +5.895984246207980e-01   +1.213055662047498e-01   +4.089943649583074e-01   +3.990260681362470e-01   +1.655816331046265e-01   +1.954850699876662e-01   +4.754758511640691e-01   +6.283887004495444e-01   +8.039383669861144e-02   +4.633717273465770e-01   +5.025766025705990e-01   +1.246829377771133e-01; +3.466155176254690e-01   +1.963627992141001e-01   +6.213197892145911e-02   -8.509046710575452e-04   +6.417103962333607e-01   +6.052892933622293e-01   +3.366623887865899e-02   +4.565493619920324e-01   +4.584126611319631e-01   +1.907498887114458e-01   +7.536974125807969e-02   +1.542270291299050e-02   +6.025624568394763e-01   +4.607822394035194e-02   +3.548417794037130e-01   +2.691596350887375e-01; +4.344650652649817e-01   +4.849693096139977e-01   +5.749538337639454e-01   +1.008868763622387e-01   +4.371243568891252e-01   +4.630390007304535e-01   +4.650537659773223e-01   +4.201375978702695e-01   +5.883214644029445e-01   +2.907859639500540e-01   +2.692068071307895e-01   +5.779650745671880e-01   +5.494055387805463e-01   +4.764231068812848e-01   +2.937502153922059e-01   +5.928141757865029e-01; +5.510363142736320e-01   +4.369576046183198e-01   +1.997856410355313e-01   +4.078714254556278e-01   +8.706026899493895e-02   +1.572126797127608e-01   +4.193489583361940e-02   +1.528087210331441e-01   +2.285058254923244e-01   +4.527229624868524e-01   +1.308462778633729e-01   +5.146931436661263e-01   +3.656943755426451e-01   +4.107174706382600e-01   +2.625229692705097e-01   +2.114986047829001e-01; +2.426216260650729e-02   +3.460717889337819e-01   +5.476694442620789e-01   +3.484462880694025e-01   +1.768700894296579e-01   +1.166767075767677e-01   +1.782475898843089e-01   +2.542190844213032e-01   +1.582423784651069e-01   +6.525789726761854e-01   +2.352323603825109e-01   +3.905178836946681e-02   +1.244758837851278e-01   +4.820613271013888e-01   +1.948389921116043e-02   +4.501128996282722e-01; +5.182313822552408e-01   +2.392934672281133e-01   +1.367213470133886e-01   +6.369464671909559e-01   +7.038131917851768e-02   +9.249492555563271e-02   +5.857958338526168e-01   +9.775042468416270e-02   +3.984472854801671e-01   +4.957125736662968e-01   +4.314090720411170e-01   +1.074952751240864e-01   +4.899759821092836e-01   +5.286921216825995e-01   +6.282789238405412e-01   +5.923320963099744e-01];
L1E_L1I_iGABA_netcon = [+3.498722990004353e-01   +4.246864819223256e-01   +4.468496278293231e-02   +2.150036557155560e-01   +5.435246523574643e-01   +2.584329548868918e-01   +2.390282217646685e-01   +1.548232005393521e-01   +5.556299986070136e-02   +2.501656485701826e-01   +2.467889658015948e-01   +3.850053832899287e-01   +2.122237295845351e-01   +5.898879235951706e-01   +1.373292441403273e-01   +3.454137043723247e-01; +9.570558745901042e-02   +6.017936811222123e-01   +3.369093186487421e-01   +5.770302922157503e-01   +2.969695323156758e-01   +2.791579781791192e-01   +9.267222018918025e-02   +3.355968156891626e-01   +3.127081462884204e-01   +1.010213999778439e-01   +1.400882730602020e-01   +4.583531548803303e-01   +3.140124592662975e-01   +4.776446616611139e-01   +3.255976964899063e-01   +4.736540580289957e-01; +4.076430701337704e-01   +6.468582416599772e-01   +5.120978952856960e-01   +4.156132085211891e-01   +7.805491269130607e-02   +3.879895165861780e-01   +4.247741567933215e-01   +5.665483727094124e-01   +5.736062753652820e-01   +6.221417448703903e-01   +4.309760064463497e-01   +3.185992090235502e-01   +6.355936950557256e-01   +5.509127006255700e-01   +2.878033544777703e-01   +3.624754846603643e-01; +3.356865110369633e-02   +9.434746564048641e-02   +6.000222538810688e-01   +2.899931494212119e-02   +1.238392721970523e-01   +4.725907127657645e-01   +4.751637101840610e-01   +3.702630351186936e-01   +3.290113033557580e-01   +6.331904264867799e-01   +4.206506271935202e-01   +5.405052002558771e-02   +2.356391015679579e-01   +1.225012805125164e-01   +6.896505192748975e-02   +6.412087414244397e-01; +1.118096840627209e-02   +5.751509226903732e-01   +3.415782360166312e-01   +5.983105838903940e-02   +2.760638176814012e-01   +5.612679568035189e-01   +4.635132607130060e-01   +2.525479059646385e-01   -8.943970008763697e-04   +1.054132335847174e-01   +4.732375321277081e-01   +8.157919981941888e-02   +5.370324852947758e-01   +3.088825942591497e-01   +4.372252071308195e-01   +3.604960916136491e-01; +5.140351872574784e-01   +6.156477175108142e-01   +1.018147540226612e-01   +4.454850377747285e-01   +2.364497839167402e-01   +8.641373535487095e-04   +4.563036796192739e-01   +1.943497553793249e-01   +5.376356528932589e-01   +1.140070909293683e-01   +6.210588071708179e-01   +8.863041776704990e-02   +2.498723739859531e-01   +8.901058312491740e-02   +3.469601505493638e-01   +9.596132748168239e-02; +3.277530649668381e-01   +1.490911512027683e-01   +8.485132769011353e-02   +1.706272000710195e-01   +1.233684585835344e-01   +2.493285745404458e-01   +1.930121142158087e-01   +3.522088414047954e-01   +5.802587122107893e-01   +1.019123647091215e-01   +4.919407539695307e-01   +6.549469469996962e-01   +6.547637183296765e-01   +3.429253651231398e-01   +3.396066437695381e-01   +1.996612777707566e-01; +1.890832169759309e-01   +1.417570813656535e-01   +1.094129052873658e-02   +1.061254036159811e-01   +4.743858418052648e-01   +3.437547441542047e-01   +3.240475803129190e-01   +4.112230073589406e-01   +1.296049956822503e-01   +2.733882232225257e-01   +5.380590886904102e-01   +6.245790829575844e-01   +3.445587502552949e-01   +2.977013173393454e-01   +1.161606294865178e-01   +4.577817336391665e-01; +1.904675442125700e-01   +3.980431373343233e-01   +1.958280288777146e-01   +1.188520702495897e-02   +1.165009467795769e-01   +4.628216675069323e-01   +5.250100831644627e-01   +5.930695509161809e-01   +2.461797656927494e-01   +7.052450095542018e-02   +4.992791646632191e-01   +2.307465588925875e-01   +5.819296117566619e-01   +6.086432088708472e-01   +3.975156354948182e-01   +4.606715971863727e-02; +3.173451254978532e-02   +2.681585123481945e-01   +9.609010174221125e-02   +3.799505659146800e-01   +2.670060802550765e-01   +5.430374321087408e-01   +2.057596726301295e-01   +1.475709336989098e-01   +6.122280161417922e-01   +5.070369184354141e-01   +1.518554081806521e-01   +4.043062392741407e-01   +5.052083247521371e-01   +1.229052346482614e-01   +5.046946297900941e-01   +1.458814222430174e-01; +5.696175702183766e-01   +5.529527139027150e-02   +1.979171761781663e-01   +2.624202196355547e-01   +3.439257758992187e-01   +4.302210400515857e-01   +2.984719614998662e-01   +6.268883056622629e-01   +2.117129070757282e-01   +2.715480567183803e-01   +3.794443545972682e-01   +3.106298459947411e-01   +1.688505404176577e-01   +6.420100392279227e-01   +5.815985692184065e-01   +2.224461886901396e-01; +1.218352732271364e-01   +5.961259095739299e-01   +3.668899635303572e-01   +6.045455392497530e-01   +6.512361360703168e-01   +4.436996847058550e-01   +3.040419845574864e-01   +9.679780287537920e-02   +4.771418527894520e-01   +2.982135263621314e-01   +2.295469008043894e-01   +5.439829126299777e-01   +4.418613383425027e-01   +3.249502362577858e-01   +5.209393002326131e-01   +1.626991298611605e-01; +4.795341173155097e-01   +5.861850941561063e-02   +3.458749106890381e-01   +7.913176707260026e-02   +3.536692142727642e-01   +3.713700465968218e-01   +3.861655626924839e-01   +1.368651567952354e-01   +4.924296519290347e-01   +5.816628100644885e-01   +1.155172784700977e-01   +5.090654838519637e-01   +6.333168797335454e-01   +4.063457209948323e-01   +2.409098750090803e-01   +8.757671096501626e-02; +1.662146522734778e-01   +1.679218854815908e-01   +1.507664502284123e-01   +6.211153217136301e-02   +1.215933819780682e-01   +5.690806542540789e-01   +6.059971635311026e-01   +4.959790279017716e-01   +2.816520891643385e-01   +4.303666590680871e-01   +6.432469199711023e-01   +4.804707383325767e-01   +4.093155195811347e-01   +5.724486436795484e-01   +4.229397268164579e-01   +4.839394996478724e-01; +2.863833066141789e-01   +1.083912758367140e-01   +2.901366185849354e-01   +5.794323041363713e-01   +4.189628695256032e-01   +3.345618602253877e-01   +7.338302229317561e-02   +2.272304319998801e-01   +1.086114803053320e-01   +3.326765663327164e-01   +1.735058351934692e-01   +2.908102301332021e-01   +2.523231874019178e-01   +1.519154665475358e-01   +1.168080234018833e-01   +2.023442813850706e-01; +2.879602394785464e-01   +5.158766543762978e-02   +1.239927813740243e-01   +6.119200845521130e-01   +6.149003808905849e-01   +4.830066530555729e-02   +1.289031613557533e-01   +5.312258612153404e-01   +5.245300467402670e-01   +9.080474927957971e-02   +3.605225803955486e-02   +4.101182104268281e-01   +4.311925652918246e-01   +3.429432048011143e-01   +2.650058679829834e-01   +2.986405469426390e-01];
L2I_L1I_iGABA_netcon = [+6.433788315091467e-01   +3.179461186628163e-01   +1.888905137628908e-01   +5.744748019713856e-01   +6.110063462605217e-01   +6.088698007252255e-01   +2.380383240876577e-01   +5.171097899176048e-01; +5.178823591851283e-01   +5.685755367327531e-01   +4.669146004195203e-01   +1.849854111132030e-01   +2.815050629652364e-01   +4.405489025350111e-01   +5.929967136798217e-01   +1.433404909388773e-01; +1.361960178896739e-01   +1.591730727802959e-01   +1.761295847295110e-01   +2.129825002009128e-02   +5.191319222800357e-01   +6.293171392540666e-01   +7.095117321182887e-02   +4.033510101697128e-01; +2.509097026557497e-01   +5.178906329445772e-01   +4.401217514747361e-01   +4.074372757537855e-01   +3.934029044100036e-01   +4.001557076789005e-01   +3.209328301899675e-01   +5.261453251083151e-01; +2.054867208023983e-01   +1.227132837128555e-01   +3.906695258486434e-01   +3.701004353747249e-01   +2.890509182140297e-01   +5.088756647991246e-01   +3.275193179318565e-01   +3.914604818573381e-01; +5.143358909546518e-01   +4.713237833517264e-01   +5.931613234067498e-01   +2.683194819832433e-01   +1.897252694158537e-01   +4.629726351984436e-01   +8.742096105514963e-03   +4.461995207086701e-01; +9.751378377361539e-02   +2.404389322045032e-01   +2.525737117443277e-01   +1.529619677584281e-01   +4.527008937333268e-01   +1.799827797378090e-01   +1.496886975440349e-01   +4.395501348203640e-01; +3.835092640006527e-01   +2.233242675148991e-01   +5.130818528438531e-01   +2.547605371688434e-01   +1.782718457256872e-01   +4.521430734143227e-01   +2.940995862454381e-01   +1.975365837642271e-01; +2.678822254057424e-01   +4.660402737466463e-01   +1.311228971649269e-01   +1.537827265935517e-01   +2.112043353742185e-01   +1.082010006444437e-01   +2.710308457972645e-01   +6.260106102704406e-01; +3.486882743150548e-01   +4.486937133505662e-01   +1.363790876237856e-01   +3.602526611435086e-01   +1.192610520518029e-02   +4.572098265767985e-01   +5.888725352134168e-01   +4.570930155571070e-01; +3.341889678660421e-01   +5.128914345155923e-01   +5.495802065828377e-01   +2.394827326082779e-01   +4.667584325728292e-01   +6.433497689690180e-01   +1.207709820590615e-01   +1.823629597919509e-01; +5.182219215886376e-01   +3.441408430789150e-01   +4.036814390998670e-01   +2.768348812890246e-01   +6.337208235174886e-01   +1.772999601376809e-01   +4.134368687053253e-01   +2.097922639204020e-01; +2.016656395423103e-01   +6.270312566331987e-01   +6.004844670351773e-01   +1.331242958264917e-01   +3.689801205917396e-01   +1.934534317139850e-01   +2.053535122438368e-01   +3.263579660769824e-01; +4.556515935635476e-01   +1.639627003356525e-01   +6.485954511025561e-01   +3.406833554561400e-01   +5.427524364527503e-01   +1.235701160443026e-01   +6.325507515588972e-01   +1.432289360762292e-01; +6.265855743521914e-01   +1.412149309448107e-01   +1.787760131863542e-01   +5.904129061591178e-01   +4.292567223048286e-01   +9.184064429267536e-02   +2.584053440335912e-01   +4.525168691669993e-01; +1.213048611024684e-01   +4.528044610154378e-01   +4.736326373768321e-01   +4.031850732626795e-01   +5.393352905950044e-01   +8.206647827265624e-02   +6.387657686844280e-01   +1.990337639621522e-01];
L1I_L2I_iGABA_netcon = [+3.687970619115439e-01   +4.495817600834671e-01   +2.016375272099336e-01   +4.611879546543169e-02   +3.323304275423150e-01   +2.586511274122988e-01   +6.438108382244733e-01   +4.468307240742677e-01   +2.658713889060634e-01   +5.118147845673692e-01   +9.486150829010566e-02   +2.020588897930387e-01   +8.139389275153006e-02   +3.300220475384873e-03   +1.334800775386382e-01   +5.151591959285802e-01; +5.207033966552652e-01   +3.871055999072490e-01   +2.450678500144380e-01   +3.019293585948120e-01   +6.052973592983621e-01   +2.981249180615214e-01   +4.411965682390805e-01   +6.303849961399713e-01   +2.810711131007751e-01   +6.483548190561941e-01   +4.328214936019066e-01   +2.302331644843834e-01   +3.220927332692157e-01   +4.127577163145670e-02   +2.583758454886052e-02   +5.761564545419340e-01; +5.552349241920909e-01   +3.819920324752201e-01   +1.422277622452428e-01   +5.331981333663549e-01   +2.177729450012932e-01   +5.696251144134763e-01   +4.966026222837895e-01   +4.336842933927607e-01   +2.471540278462960e-01   +2.370074123451431e-01   +4.443981896724146e-01   +2.605306461848342e-01   +2.177796068454331e-01   +1.070483836765705e-01   +4.014025867656807e-01   +8.371360615048087e-02; +2.758880748131193e-01   +3.482747841927165e-02   +3.902989198086478e-01   +5.696648930492534e-01   +7.052986884105279e-02   +2.556933352949437e-04   +2.292235533535096e-01   +2.200254476051452e-01   +3.735470065816970e-02   +4.215081114275926e-01   +3.647170928586950e-01   +3.059921558012515e-01   +1.634359054363524e-01   +3.355113348808814e-02   +5.217937311506399e-01   +3.417434502759282e-01; +5.402980929286696e-02   +5.320371818166331e-01   +5.167049360878999e-01   +4.393723479414493e-01   +4.097809304337908e-01   +3.226742966865018e-01   +4.156195863718671e-01   +5.436991446938140e-01   +4.036378945706049e-01   +1.245403530724477e-02   +2.026465168562208e-01   +1.473532494389718e-02   +1.638183664151184e-01   +5.704896240146725e-01   +1.336375612475099e-01   +3.088923575468213e-01; +4.155377423960899e-01   +4.625317690441149e-01   +8.446390081317377e-02   +5.836648428177917e-01   +3.654104508794688e-01   +6.297377122186596e-01   +4.783626438388434e-01   +5.366535242389026e-01   +3.596629058914520e-01   +3.794762520850185e-01   +6.526459967727030e-01   +5.381816662687743e-01   +8.796851526812743e-02   +5.955925874515059e-01   +4.640118795403084e-01   +5.951347552120998e-01; +5.034409671119384e-01   +9.993690391177922e-02   +5.627736369845883e-01   +6.446523953019652e-01   +2.507244022095884e-01   +6.394792244925487e-01   +3.322561770734074e-01   +3.077668492183217e-01   +8.822530530956553e-03   +3.839745350160225e-01   +2.025442446726086e-01   +2.302623408858294e-01   +5.100112599828135e-01   +2.745544568882446e-01   +5.533546930739930e-01   +3.723409372100421e-01; +4.861183274152325e-01   +7.148448090017512e-02   +5.859496741320785e-01   +4.675258091242041e-01   +7.683603468214563e-02   +5.176435619667588e-01   +3.847954721244100e-01   +5.048215117395388e-01   +2.384628752706670e-01   +5.565459640261873e-01   +1.710898667916968e-01   +3.226087345030566e-01   +3.240247972890773e-01   +4.661678129823237e-02   +6.058148434879028e-01   +2.390278008532900e-03];
L2E_L1E_iAMPA_netcon = [+5.102029335164334e-01   +1.870117473943869e-01   +9.669185435032922e-02   +6.422564752695997e-01   +6.598041560713138e-03   +3.187443986811999e-01   +4.312415997607993e-01   +5.318262749833939e-02; +6.032602244321966e-01   +5.702648916543097e-01   +3.481205121492666e-01   +2.427459208279873e-01   +3.293089183795812e-01   +1.177565091898299e-01   +5.962607239112301e-01   +2.600929392542236e-01; +5.639994384124785e-02   +8.558287490502500e-02   +2.153476663003684e-01   +1.016708160895533e-01   +4.091368686723977e-01   +5.567304164528696e-01   +2.193840687432875e-01   +2.073751528227546e-01; +1.706685451580946e-01   +4.753234293966047e-01   +1.415815046467534e-01   +4.281622562959481e-01   +4.944711791739846e-01   +2.061588880950828e-01   +5.783112089846987e-01   +5.421491800173284e-01; +1.287743006865788e-01   +6.470236491044955e-01   +9.142707837868942e-02   +1.970377329421707e-02   +6.197387938356457e-01   +6.235278546845365e-01   +4.466567177284254e-01   +3.064713099983080e-01; +4.571395268918272e-01   +3.366758721658895e-01   +6.246383620705037e-01   +5.073725464270249e-01   +4.582394980874052e-01   +1.450228610454936e-01   +5.236206165833726e-01   +4.528869016901549e-01; +7.233766170537510e-02   +2.184874113336853e-01   +1.909466058295264e-01   +3.010385813577430e-01   +6.056404081992853e-01   +3.032807533501413e-01   +1.030507118785610e-01   +2.265966074050835e-01; +4.329717161695733e-02   +8.172332970009845e-02   +3.465997080642624e-01   +4.418528471754214e-01   +2.607107863006916e-01   +5.947992637037908e-01   +6.370401619826266e-01   +5.996364842924014e-01; +2.311057274724536e-01   +5.795583502376450e-01   +2.690082581438059e-02   +1.770839811283161e-01   +1.075903305056536e-01   +6.313823135565102e-01   +3.452439253012441e-01   +4.540987048098916e-02; +1.945847018550821e-01   +1.828533222049926e-01   +5.652157931481447e-01   +2.682535975142278e-01   +5.365609772970421e-01   +5.681513103093902e-02   +8.206936482292314e-02   +6.316087733065653e-01; +3.734110611340045e-01   +3.090513989224057e-01   +1.199611523543582e-01   +3.981799984286811e-01   +2.685899636011664e-01   +2.705238893560156e-01   +3.830180525769531e-01   +5.885424902063278e-01; +1.736504434299278e-01   +2.963262696522561e-01   +5.366817075597154e-01   +4.800209723368741e-01   +4.213746591222192e-01   +1.251747558072873e-01   +6.523886596967758e-01   +1.529803609252701e-01; +3.922749071122159e-01   +5.424588532952549e-01   +1.590072553833476e-01   +3.770100630260251e-02   +6.403601409464406e-01   +4.382426040953862e-01   +3.027275495033370e-01   +5.302601947636462e-01; +2.765278694491810e-01   +3.484866330180939e-02   +7.545707083361504e-02   +4.367829755608266e-01   +6.144063075006172e-02   +1.970725086790606e-01   +5.270735736852149e-02   +4.835550457588665e-01; +1.852573848709608e-01   +1.369509405623712e-01   +4.317587741562230e-02   +4.973207709459558e-01   +7.708318338132514e-02   +6.075671327451952e-02   +2.702922135585686e-01   +1.555826427140779e-01; +9.653126016719039e-02   +2.886989277410820e-01   +9.331793621452518e-02   +3.561541087709909e-01   +1.657024039069275e-01   +3.598320153129001e-01   +7.060615278472426e-02   +5.368757631832108e-01];
L1E_L2E_iAMPA_netcon = [+2.418937585388407e-01   +1.023854301242943e-01   +6.105504750906880e-01   +6.354515583014945e-01   +2.175648511201857e-01   +6.193962912136707e-01   +3.311710208275595e-01   +6.500643548740258e-01   +9.033739270303573e-02   +4.257409695844862e-01   +4.212914443949503e-01   +4.997390841306162e-01   +2.454049919603171e-01   +4.461424855287281e-01   +3.695536595381208e-01   +3.245006043565166e-01; +2.561379058924366e-01   +3.400746076307672e-01   +1.415984037539922e-01   +5.815564945610149e-02   +4.349641018750870e-02   +4.501870791640032e-01   +5.608086327439834e-02   +2.055152792457760e-01   +1.342675280414434e-01   +2.059178413582389e-01   +1.787288242382714e-01   +6.218183621165427e-01   +9.326628778585361e-02   +1.868576770964539e-01   +3.852187830582430e-01   +1.615898435875638e-01; +2.132676202162532e-01   +3.933431291669583e-01   +5.931994518403462e-01   +6.084261073560834e-01   +6.231630270936308e-01   +7.186709040058924e-02   +1.908283696573190e-01   +3.455064058670645e-02   +2.895928258793342e-01   +3.790394896080999e-01   +2.215497619872611e-01   +7.116229951689394e-02   +4.941115957118856e-01   +3.924966022250379e-01   +5.840392922608875e-01   +4.943455252400770e-02; +5.180127349433407e-01   +1.891653626450934e-02   +1.485781757038680e-01   +1.426709951638923e-01   +4.816915861680575e-01   +2.099585145347874e-01   +5.961851641476779e-01   +5.878783995254966e-01   +5.097776990372113e-01   +4.987863547061735e-01   +3.089923440825678e-01   +3.675522996962332e-01   +6.155834727046640e-01   +2.206315329223852e-01   +6.002084154220936e-01   +6.367194875369643e-01; +8.559983617464985e-02   +5.621648040703415e-01   +5.696203385485984e-01   +2.007964348600117e-02   +1.044203628580829e-01   +5.298144662804828e-01   +6.127976563168063e-01   +1.194478864266868e-01   +3.735394366261364e-01   +2.728933404864813e-01   +3.616709839346808e-01   +5.075037019021081e-01   +1.544062994368959e-01   +3.424436014590667e-01   +6.491318330590184e-01   +2.894821533318543e-02; +2.356455188806755e-02   +5.541641928180231e-01   +1.744931313877126e-01   +5.301795292373745e-01   +6.321209291762858e-01   +5.570077775387244e-01   +3.427184764872340e-01   +6.119712870336392e-01   +2.139186710393456e-01   +2.649161133154319e-01   +5.526167766303167e-01   +6.021023098446819e-01   +5.576132991858430e-01   +4.104135040241123e-01   +1.258200492769843e-01   +3.797793118685331e-01; +2.056908523484665e-01   +1.475458648300215e-01   +3.844255899958030e-01   +1.696606940648089e-03   +2.534249543481314e-01   +3.444724311369918e-01   +4.913756516780751e-01   +3.868931766678138e-01   +3.805488318389640e-01   +5.140449103671646e-01   +4.147201729492052e-01   +6.746773725362143e-02   +2.373091672586511e-01   +3.596879620603730e-01   +1.591416619858489e-01   +2.267398265032936e-01; +5.634680215564315e-02   +3.587738668654494e-01   +3.246335767248154e-01   +2.594340716826193e-01   +4.757376118072212e-01   +6.321086052800329e-01   +6.474506884265742e-01   +4.159740170745330e-01   +5.740589142587949e-01   +2.620872361631489e-01   +2.267695723056436e-01   +6.469836778677974e-01   +4.394470417453372e-01   +5.920435097546657e-01   +2.203415423619059e-01   +6.935523572869379e-02];
L2I_L2E_iAMPA_netcon = [+4.096346857495788e-01   +1.536371586496152e-01   +5.917790445886411e-01   +3.118883006177842e-01   +5.117225625373302e-01   +3.041400104544452e-02   +6.297967028182193e-03   +5.902663994450393e-01; +1.037105104721706e-01   +8.225711200036173e-02   +1.038684257453558e-01   +5.609323817558434e-01   +4.966562425871818e-01   +2.625392687488977e-01   +4.603192643772370e-01   +3.144806549321368e-01; +5.537527921770486e-01   +4.939031312621819e-01   +5.492558877021737e-01   +4.857654087810515e-01   +3.408043369027234e-01   +3.381733953481023e-01   +3.333523057330320e-01   +4.638547354841850e-01; +2.603530470925945e-01   +1.141899294312067e-01   +5.820830450604734e-01   +2.799104354269053e-01   +6.288982668461813e-01   +1.004766589008671e-01   +3.032601607447318e-01   +5.659731328709771e-01; +4.645767988392155e-01   +5.640610880007962e-01   +4.197230488716296e-01   +4.008536537286035e-01   +6.062347714128958e-01   +4.881268305111330e-01   +2.760818647024855e-01   +4.915784368191208e-01; +3.970882661669364e-01   +2.693134413208785e-02   +5.851956896841906e-01   +4.874522525986727e-01   +3.523720698855111e-01   +1.189833242258435e-01   +7.041309775902339e-02   +4.831018509810702e-01; +6.264517931540976e-01   +2.997575453707853e-01   +1.102688953006466e-01   +3.199067657374979e-02   +9.127952418577091e-02   +1.446532155017332e-01   +9.621682389421607e-02   +1.155116934419080e-01; +5.966801933001274e-01   +2.286701830938631e-01   +3.614768867078862e-01   +3.204962798204875e-01   +5.725313803727361e-01   +1.570320206473030e-01   +8.253838016935418e-02   +1.444564689924870e-02];
L2E_L2I_iGABA_netcon = [+6.082401001474568e-01   +1.562820561423771e-01   +1.346471712254528e-01   +1.264811151281532e-01   +4.377845641297630e-01   +2.451320360880636e-01   +5.405742903996980e-01   +6.200780381846457e-01; +1.650008934923815e-01   +2.818380270385563e-01   +8.213480250980359e-02   +8.970279329782031e-03   +6.505292002116525e-01   +4.563126870293714e-01   +5.043886047964146e-01   +4.735584602250291e-02; +4.282850184525079e-01   +2.350000324730191e-01   +3.594961587799217e-01   +3.003813361130177e-02   +2.536792761386772e-01   +5.226117062565198e-02   +6.492421868090706e-01   +5.459559111563362e-01; +5.674668123902609e-01   +4.339716915934546e-02   +1.669476249078437e-01   +4.859118678064135e-01   +6.038848452020018e-01   +4.249672156279481e-01   +2.823413152553559e-01   +4.364416849437285e-01; +1.038241040171248e-01   +5.936423059478347e-01   +4.040122460763736e-02   +5.533016877690490e-01   +2.026417884882552e-01   +2.401993116195194e-01   +2.639543809446987e-02   +1.779244890509516e-01; +4.943587882622939e-01   +1.069554693563618e-02   +3.595916747637870e-01   +5.201142181280206e-01   +5.823498131237491e-01   +1.746741252889631e-01   +6.267092904417199e-01   +5.151663468884802e-01; +1.057278384940298e-01   +6.420656329210706e-01   +1.907580163748324e-01   +2.070133394604375e-02   +4.714474902920994e-01   +3.450399395000036e-01   +3.980515324918154e-01   +4.048359723384258e-01; +5.701626656475625e-01   +2.034060075694866e-01   +3.257006481087439e-01   +1.378852126511444e-01   +3.068633329883638e-01   +5.150389821033019e-01   +6.217961679222489e-01   +3.998048117185692e-01];
L3E_L2E_iAMPA_netcon = [+2.324239711160860e-01   +4.161377439681656e-01   +1.001236508421926e-01   +5.467936452483825e-02   +5.875049909948265e-03   +6.432685443154318e-01   +2.573991290142366e-01   +5.663574482778488e-01   +7.671217403043920e-02   +1.945155484738516e-01   +1.913624061306129e-01   +3.215230764110052e-02; +1.725122160373039e-01   +5.835310045531470e-01   +1.909750820585467e-01   +2.464065306205512e-01   +3.032589039024998e-01   +3.689216517243025e-01   +6.022112311247788e-01   +6.483674691903080e-01   +3.663454399718716e-01   +6.345420420208315e-01   +2.337964749349380e-01   +1.680436778706692e-01; +6.503694965334272e-02   +4.866822863662791e-01   +7.065114386858741e-02   +4.821448710047643e-01   -7.813373168739336e-04   +7.893840477933537e-05   +3.545197711455417e-01   +6.456837108331965e-01   +3.897715837520508e-01   +4.014164696061124e-01   +1.625554495007992e-01   +4.658128121386870e-01; +2.099569442564852e-02   +1.313650916830679e-01   +5.321100797354439e-01   +1.695006625243310e-01   +1.809716046972443e-01   +8.914004200685461e-03   +2.211827301799545e-01   +4.541056518619260e-02   +1.423350121728333e-01   +2.056264931756533e-01   +1.290336817367202e-01   +2.170743731787186e-01; +5.922371671945413e-01   +2.430583867293414e-01   +2.255194369513681e-01   +6.500462599567188e-01   +4.438014132514637e-01   +2.438498039955553e-01   +6.396596759487537e-01   +1.070977216467451e-01   +5.529284985618128e-01   +3.179953878933309e-01   +4.478074241427218e-01   +2.655834043934668e-01; +5.779626259212554e-01   +3.899850820416863e-01   +7.143910831890588e-02   +3.246691012602065e-01   +4.178347601435099e-01   +5.945625904811073e-01   +5.823007761459396e-01   +2.500660587679371e-01   +3.031974745867050e-01   +1.155763195689226e-02   +4.157958391821387e-01   +1.651882703193321e-01; +4.091916767227401e-01   +3.365330908285202e-01   +4.120270377670672e-01   +1.351458587831681e-01   +4.048823613594879e-02   +2.361634707529596e-01   +6.946815592894034e-03   +2.268361235342040e-01   +1.851328972560698e-01   +6.956494278365014e-02   +5.083398805034401e-03   +3.062236795595504e-01; +5.531719892919792e-01   +6.339981292016834e-02   +5.044773444646591e-03   +1.736142408354326e-01   +3.631104516826267e-01   +5.899904713959962e-02   +1.974249104925340e-02   +3.188747616735594e-01   +3.237148330744354e-01   +5.626163913926361e-01   +5.655682098523911e-02   +4.016756692456933e-01];
L3I_L2I_iGABA_netcon = [+6.403781613939866e-01   +3.296599382444676e-01   +4.250339983128714e-01   +1.814610444804532e-01   +6.224494871147621e-01   +2.931016750340045e-01   +3.292347379469463e-02   +1.409453714611510e-02   +5.745326667651464e-01   +2.973049581004097e-01   +5.799860308688549e-02   +4.879844965186675e-01; +5.881840357819316e-01   +6.326451401733868e-01   +5.863055156111875e-01   +1.084622765707242e-01   +3.376178882650508e-01   +5.492604027808232e-01   +3.842271164875943e-02   +1.366018986461442e-01   +3.252131338700581e-01   +4.323282570517959e-01   +7.869621976002764e-02   +4.254849232027046e-01; +6.811034033928470e-02   +5.624919483359168e-01   +5.897528848337961e-01   +5.451109184640030e-03   +4.653987920950834e-01   +1.092791969381252e-03   +4.063622233102574e-01   +6.078201378652749e-01   +4.755782518132703e-01   +1.454805244308138e-02   +3.860643002720532e-01   +7.500773188598943e-02; +6.308337028227752e-01   +1.569636120868451e-02   +2.183353697217765e-02   +4.245707761117770e-01   +5.865550931038791e-01   +3.637644978902073e-01   +2.304077209003514e-02   +1.177991375848874e-02   +5.667715037081553e-01   +5.404649509643074e-01   +6.519757035910486e-01   +3.600540972874739e-01; +1.021157025438546e-01   +6.323083648526995e-01   +2.721228487525772e-01   +2.792968295881986e-01   +3.737094739128305e-01   +6.057720972112757e-01   +2.532756404338104e-01   +1.143695087143695e-01   +6.556063533691636e-01   +3.276399743981851e-01   +1.482273438752727e-01   +1.126748252577808e-01; +2.408146485719373e-02   +4.498215364292744e-01   +1.372764803816802e-01   +8.608445905162063e-03   +1.113101526130538e-01   +4.250705816146853e-01   +4.546427572021422e-01   +1.559746850378668e-01   +3.407682481131581e-02   +5.009975253411915e-01   +5.672013717328408e-01   +5.227605312975592e-02; +4.129000378697666e-01   +5.755299741862218e-01   +3.820955020562346e-01   +4.251495242880723e-01   +2.950725979279892e-01   +2.010123651245522e-01   +4.610221412968761e-01   +5.532418180315780e-03   +5.473326098480524e-01   +2.501019093056426e-01   +3.310919045470737e-01   +4.735134276933974e-01; +3.219236616023052e-01   +1.369048183906929e-01   +2.018886608028961e-01   +3.791872807741041e-01   +2.312372537402995e-01   +9.342672199138338e-02   +1.495487684862671e-01   +1.785587317772447e-01   +3.606907571719516e-01   +6.432385741939540e-01   +1.809713267182115e-01   +1.927159218446627e-01];
L2E_L3E_iAMPA_netcon = [+4.431452783807789e-01   +4.350580575389573e-01   +1.500354166198423e-01   +5.731876699251717e-01   +3.024742072353954e-02   +3.378511104288674e-01   +4.435298936456573e-01   +6.135385932485499e-01; +3.521292083469320e-01   +4.800361698182735e-01   +4.842623954864527e-01   +5.270143271794983e-01   +7.059442572503505e-02   +3.276069882898711e-01   +5.632435359284728e-01   +4.522125054407178e-01; +5.584634838835661e-01   +5.792296265211189e-01   +5.567138382832237e-01   +5.957934987563169e-01   +3.835595439879421e-01   +4.284996407890521e-01   +5.683242424504262e-01   +3.799153919274323e-01; +2.701186546066980e-01   +6.287583847816174e-01   +5.595381611155678e-01   +4.021860933717386e-01   +3.395051533665411e-01   +3.251138074176728e-01   +1.862786245925999e-01   +1.216753788199735e-01; +9.460409139286929e-02   +3.604370360178710e-01   +1.617044149768861e-01   +5.428654253968341e-02   +1.173483339068410e-01   +3.584456753707899e-01   +5.827684145021667e-01   +5.012762420960351e-01; +3.282836628901479e-01   +6.439411703227761e-01   +5.833873551136864e-01   +3.531278987996339e-01   +3.386906582868990e-01   +6.451484573348527e-01   +4.695964891896320e-01   +6.444488151012712e-01; +3.167154436967897e-01   +6.572460357818682e-02   +3.518587965274378e-01   +1.818793534766824e-02   +2.354610498168821e-01   +5.351600124943924e-01   +2.283522360076036e-01   +5.083886467543417e-01; +6.132129529417157e-01   +4.561753375646053e-01   +2.810608206957207e-01   +5.101712036096951e-01   +2.282310293224969e-01   +5.055044292336015e-01   +3.396416247682325e-01   +2.847606327521549e-01; +3.063082852548947e-01   +3.611594720943093e-01   +5.796292490851923e-01   +4.138351026990109e-01   +3.764497368720976e-01   +2.258622368090806e-01   +3.984310688568788e-01   +4.316236932643917e-01; +1.845905883380536e-01   +1.037826865360738e-01   +5.128271542680545e-01   +5.730724086694303e-01   +5.912014383371696e-01   +1.549329141484733e-02   +8.583281221502714e-02   +4.287651823753541e-01; +3.779393124837219e-01   +2.093136478058039e-01   +4.839653678653128e-01   +5.339644239563032e-01   +6.131779627696664e-01   +6.288393348551474e-01   +1.745667038975310e-01   +2.440926846097905e-01; +5.984521952533430e-02   +3.824364294218326e-01   +2.720575116180363e-01   +5.657275395233385e-01   +3.235384774685397e-01   +1.338325090804126e-01   +4.353750302088089e-01   +5.605351776476660e-01];
L2I_L3I_iGABA_netcon = [+6.214021662773118e-01   +2.600010950693836e-01   +1.844896952466721e-01   +4.642556424961407e-01   +4.826995215132945e-01   +5.502054184457974e-01   +2.537346062416676e-02   +3.377338367056492e-01; +3.629523284581999e-01   +3.123132790675650e-01   +4.633165848845611e-01   +1.090815599356148e-01   +5.789542419687105e-01   +5.397387606227126e-01   +3.085845718487168e-01   +1.673098845961070e-01; +5.146393863714236e-01   +4.824448798799680e-01   +6.154172913073425e-01   +4.145140607821436e-01   +2.351762399265747e-01   +4.005086627008808e-01   +2.664381555595266e-01   +1.116956043007378e-01; +1.415150726568086e-01   +5.511099088191441e-01   +1.412733626782905e-01   +3.262671663581724e-01   +2.138651942181599e-02   +2.402660044348714e-01   +2.430842055896599e-01   +6.413499236025106e-01; +2.027936687339974e-01   +2.538427465336806e-01   +3.462156691809595e-01   +3.140105937415437e-01   +2.351136240917172e-01   +4.265867956913390e-01   +6.386583708820090e-02   +8.557926819373593e-02; +6.582162765524060e-03   +1.637504514633998e-01   +2.874476402188438e-01   +1.183189119739306e-01   +2.389515953371008e-01   +2.595270126347202e-01   +3.450721513372567e-01   +4.608556846538666e-01; +2.342809276281054e-01   +3.133153359662118e-01   +6.133373908250164e-01   +4.203673511465874e-01   +4.793348725092709e-01   +1.986758923083329e-01   +2.083698822226165e-01   +1.979324273423749e-01; +2.410591133813302e-02   +6.485459320692120e-01   +2.046722847656033e-01   +5.779992918370851e-01   +4.737775564761387e-03   +4.944016921674600e-01   +3.730766432323211e-01   +4.967167795435641e-01; +5.802993881315587e-01   +1.924091004460610e-01   +5.499439492986039e-01   +4.371902694000147e-02   +3.239459274319713e-01   +1.729905221189151e-01   +2.709861088846743e-01   +2.943408175623269e-01; +5.087699121109630e-01   +3.250680335789805e-01   +1.605847774846059e-01   +3.268204109326370e-01   +4.113002727616838e-01   +2.261375035873578e-01   +1.401625064951972e-01   +2.021863233272996e-01; +4.730853226722326e-01   +6.343633086785724e-01   +3.537870945533949e-01   +4.502271823359263e-01   +1.904036251157255e-01   +2.304750410348561e-01   +6.211895580658535e-01   +8.205256366650160e-02; +5.012710283944980e-01   +3.786313586262609e-03   +2.214665836305140e-01   +9.659374174115475e-02   +9.518370991640182e-02   +6.336942299631010e-01   +3.212321604454124e-01   +3.625176657550848e-01];
L3I_L3E_iAMPA_netcon = [+2.949307900582510e-01   +6.526806866042052e-01   +1.828461438758600e-01   +4.027014882758242e-01   +5.107957708129035e-01   +2.086819208070737e-01   +1.902176527859489e-01   +1.497594218740912e-01   +2.196803038401026e-01   +1.856215266581580e-01   +1.770464338378725e-01   +2.947248179978811e-02; +2.668462935266007e-01   +5.643732278610674e-01   +1.468441980844353e-01   +8.861214392999517e-02   +5.359866380283591e-02   +3.527674715737861e-01   +3.671664801091432e-01   +3.618798796135159e-01   +1.497720190555520e-01   +3.190404971641532e-01   +4.942495073914711e-01   +3.711623814105451e-01; +2.215674648029907e-02   +4.097963883733136e-01   +2.970666555673905e-01   +3.882637474233973e-01   +3.210326011536547e-01   +3.006103570572464e-01   +3.285903677840076e-01   +3.031770483158437e-01   +2.240005688748740e-01   +3.777181246570142e-01   +3.038443764042697e-01   +3.663833089834224e-01; +2.583104624509491e-01   +4.871237571369854e-01   +4.105313885768063e-01   +2.786725319854868e-01   +2.938302155073513e-01   +5.888789128972823e-01   +5.049595383244900e-01   +7.916687258151120e-02   +6.020262100732954e-01   +5.956344090967386e-01   +1.113443465624649e-01   +4.845840585770397e-01; +6.875495322668376e-02   +2.152397691615895e-01   +2.152564842681831e-02   +5.705112239052634e-01   +5.004515818405640e-01   +3.607395062335599e-01   +6.228477507262753e-01   +3.161090189525372e-02   +5.812600500706014e-01   +3.747641786560146e-01   +2.483853866197160e-01   +7.219035501967086e-02; +2.182284283417299e-01   +4.356558472960267e-01   +5.437880931096689e-01   +2.814391797931295e-01   +6.445449984481640e-01   +2.057437902004260e-02   +5.926065342461520e-01   +1.637253362882374e-01   +4.461144236818306e-01   +1.677986859841883e-02   +2.279500013549914e-01   +9.748376136881716e-02; +5.382930035168619e-01   +2.453294101196313e-01   +2.592769539466959e-01   +1.852183084440445e-01   +4.386228051772965e-01   +1.275235554480536e-01   +3.724408846924037e-01   +6.049292191903644e-01   +5.496876451008349e-01   +6.427386198064839e-01   +3.442690734966038e-01   +4.664624114904013e-01; +4.776765604840121e-01   +1.395670876421584e-01   +4.767918891663631e-01   +3.889890473464498e-01   +6.455381709869730e-01   +3.879974050116824e-01   +6.315693159177660e-02   +3.177922607558639e-01   +2.790248813727083e-01   +1.916485054885610e-01   +1.612198040309765e-01   +6.289037698380902e-01; +6.185166082270695e-02   +5.550082467011871e-01   +4.835383596344229e-01   +5.298192468169286e-01   +2.446971235914007e-01   +4.738640566451891e-01   +1.206234876934325e-01   +5.105796233326015e-01   +5.469183683691402e-01   +3.022875208099112e-01   +1.406423664128067e-01   +1.582043973198557e-01; +6.045882432530605e-01   +5.105304871604180e-01   +2.642393352332122e-01   +1.572753232045499e-01   +3.737507524550193e-01   +5.077638716535329e-01   +3.290276841280843e-01   +5.734976217083037e-01   +4.339397908344497e-01   +2.263776642596698e-01   +5.814484303675661e-01   +1.399973861150001e-01; +2.955805934934478e-01   +2.271184869538998e-01   +6.450487285353816e-01   +6.214065275721163e-01   +6.535854080784121e-03   +4.082208929675752e-01   +5.452045703098084e-02   +1.673259919987841e-01   +2.380176008242986e-02   +6.290845254703169e-01   +5.079404329225831e-01   +2.351385813328823e-01; +7.083385496194941e-02   +1.176342394162359e-01   +1.634594328753102e-02   +2.980510486175481e-01   +2.872360879978707e-01   +1.556630783507969e-01   +5.151360426619916e-01   +1.338859526179823e-01   +2.120963296742361e-01   +1.634289389158660e-01   +5.115676140057961e-01   +1.758248643811221e-01];
L3E_L3I_iGABA_netcon = [+1.299024029519746e-01   +2.949330727311487e-01   +2.177014090413256e-01   +6.055158442783393e-01   +5.379457392959479e-01   +3.638133260031670e-01   +2.019557994269619e-01   +4.995169871538929e-01   +4.232963490083836e-01   +4.872030900953301e-01   +3.889984940359596e-01   +1.512423549914505e-01; +5.120682167047920e-01   +4.134121877823818e-01   +1.939261795430254e-01   +1.739600926284259e-02   +2.451278820351375e-01   +4.613986154010458e-01   +4.382695291046505e-01   +6.401360128121788e-01   +5.619027191553666e-01   +2.927518325692369e-01   +7.989444961572030e-02   +1.834870216135256e-03; +3.873439823330702e-01   +6.331151728156195e-01   +6.208812914582518e-01   +5.510516214014820e-01   +2.563538975981001e-03   +4.917056196477768e-01   +3.850965845462890e-01   +4.563587157626313e-01   +2.769294808642156e-01   +2.736782632878835e-01   +1.872389182211239e-01   +9.659948780077274e-02; +2.680341394884206e-01   +8.598380465033129e-04   +8.847373468621066e-02   +4.747397645207462e-01   +4.765010708196484e-01   +1.733540591608280e-01   +2.747824580541684e-01   +2.432023851821151e-01   +6.507617947212897e-01   +3.121977769055552e-01   +3.216376029711179e-02   +3.943782857847561e-01; +2.744200982105456e-01   +2.562072782440729e-01   +6.545816433550027e-01   +1.782642051682376e-01   +3.544026912060749e-01   +5.041090280774340e-01   +6.329241780000739e-01   +6.062979154621004e-01   +1.717341968921294e-01   +3.700713564709284e-01   +5.472631029845562e-01   +3.629563917443042e-02; +4.486494981938118e-01   +3.134959989931734e-01   +5.503661565628920e-01   +5.552984833852134e-02   +2.992740544596421e-02   +6.444668766007517e-01   +5.864469052475560e-02   +4.077864433426168e-02   +5.398777544110048e-01   +3.976341730807359e-01   +1.840444340673934e-01   +1.425205238441477e-01; +3.865145123505798e-01   +2.353673651263902e-01   +3.131556139614774e-01   +3.986491083071853e-01   +4.504105110435094e-01   +3.151363922111788e-01   +2.265933529358891e-01   +1.168706325398304e-02   +2.130403072489802e-01   +1.070369279710711e-01   +2.000692639423818e-01   +4.779252624911255e-01; +1.964991110719087e-01   +1.150809851702981e-01   +8.058077545421588e-02   +6.004236763284038e-01   +2.784563978370800e-01   +4.889144459624942e-01   +3.412494661911413e-01   +5.018856129820488e-01   +5.056821394841520e-01   +5.630029495196675e-01   +1.030942466424476e-01   +3.884435691268132e-01; +1.839553880468262e-01   +1.209837673943054e-01   +5.106949878553090e-01   +3.378355431184796e-02   +6.165771575543775e-01   +5.965246783321547e-01   +1.228320329748733e-01   +4.716320883484501e-01   +1.559677309618375e-01   +2.725899356396491e-01   +2.825632447003883e-01   +4.092916300431769e-01; +5.410528853959821e-01   +2.070854347392197e-01   +5.591060149774809e-01   +2.163680346956531e-01   +2.322546623866255e-01   +6.377316667565931e-01   +4.957606735249814e-01   +3.716432702783462e-01   +6.176588167713137e-01   +6.411197274105882e-01   +1.084904903729919e-01   +2.602965997002042e-02; +3.638598417152542e-01   +8.528944381637828e-02   +1.435254474164658e-01   +1.244696150081277e-01   +5.168258482934474e-01   +3.266163074469016e-01   +5.567712135675473e-01   +4.038304108732855e-01   +3.696720097428605e-01   +1.105314310047139e-01   +6.031258072482235e-02   +5.314674916445370e-01; +4.216994582154652e-01   +3.401570916184940e-01   +6.546816898678771e-01   +4.807505479718507e-01   +1.454341243303770e-02   +3.431219428520915e-01   +6.459087105952728e-01   +4.177617277055533e-02   +5.190031273283721e-01   +2.645176475279473e-01   +3.033589694117224e-01   +2.887594969824044e-01];
L2E_Input1_iAMPA_netcon = [+6.524203007338660e-01   +6.546701847015055e-01   +6.535015282675244e-01   +6.580540113253406e-01   +6.577403498707813e-01   +6.573273921711547e-01   +6.564428586200636e-01   +6.552642123581723e-01];
L2I_Input2_iAMPA_netcon = [+6.549661595410684e-01   +6.573372297396740e-01   +6.557899215639600e-01   +6.546371349156312e-01   +6.574418404277105e-01   +6.581442439757726e-01   +6.546048432760962e-01   +6.554467382742010e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
