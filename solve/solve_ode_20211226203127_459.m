function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.685697735292527e-02   +9.672501611634403e-02   -4.948198850110391e-02   +7.610673619618170e-02   +2.669662778168604e-01   -1.263248713745965e-01   +2.209237984146324e-01   -2.525336032720866e-01   -3.104347685625192e-01   +3.080844076273372e-01   -2.942843739921954e-02   +4.281049275000013e-01   +9.913697863122002e-02   +5.415690464033168e-01   +1.498142038516795e-01   -1.315683622295100e-01; +7.019787765680814e-02   -2.279930651972922e-01   -4.346428227453888e-02   -4.098551562449851e-01   -1.892137110434968e-01   +1.226262547897864e-01   +2.037230636433484e-01   +5.842126864160667e-02   -1.773378431893238e-01   +3.740856523269798e-02   +8.319546604725206e-02   -6.657417428301106e-02   -2.435122766399751e-01   -1.024198161815909e-01   +1.449978435442120e-01   +3.304245268977365e-01; +1.189313511420932e-01   -1.248778768833616e-01   +3.822808774397287e-02   -1.404031437514863e-01   -1.847386343611789e-01   +1.795155802032235e-01   -1.482139102840402e-01   -1.672915330506590e-01   -7.479960432363728e-02   -2.125100812307442e-01   +3.411009310516832e-01   +5.957076710073447e-02   +9.395966279706448e-02   -1.234015107791443e-01   -2.129736995039275e-01   -3.237166420089612e-01; -1.271065043748626e-01   +2.859706532805838e-01   +1.036527933549635e-02   -4.489478629579698e-01   +2.791680228902033e-02   -6.398729809349187e-02   +6.362296132788721e-02   -4.670993960997536e-02   +3.782543514972390e-01   +1.491748362760799e-01   +3.693450200601421e-02   -6.021214833766130e-02   +2.071999581591857e-01   -4.868964172630071e-02   -3.873006573444328e-01   -4.647860263166881e-01; +4.035829123633951e-01   +1.158826253459710e-02   +3.238717452584446e-01   -3.109246063920071e-02   +3.204465763859564e-01   -1.965430154005486e-01   +1.389461262322533e-01   +3.018308809094925e-01   +8.212003396034495e-02   -3.182363009991324e-02   +1.715322588946956e-02   +2.346062748463605e-02   +9.757239084139049e-02   -2.038296101784226e-01   -5.175679233674454e-01   +9.741672132505297e-02; -2.231276524248084e-01   +3.086379194465209e-01   -6.721684643371641e-02   -1.303761546675340e-01   -1.084188777896439e-01   -3.858458964811753e-01   +3.177975951541213e-02   +3.036997419535118e-01   +1.762531740256799e-01   +3.929564960749574e-02   +3.730941422784619e-01   +1.084323026336968e-01   +2.974727105195742e-02   -1.138989320978286e-01   -2.782483386419595e-01   +1.509514912010959e-01; +1.033618819150661e-01   -3.702498221229694e-02   +1.936916974509675e-01   +5.977216987085811e-02   +4.131653282719470e-02   -1.606768752944466e-01   -4.530356330058385e-02   -2.245168774229986e-01   -6.158988202050808e-02   -1.477274812996324e-01   -3.502849980349965e-01   +8.167377073370405e-02   -2.562297981622099e-01   -1.647480138114038e-02   -6.532736242275049e-02   +3.804103957531474e-01; -5.662631935152249e-01   +1.694837882116451e-02   -9.445016282092900e-02   +3.976632556221806e-02   +1.959567710298673e-01   +4.096617981151863e-02   -1.897072091753693e-01   -7.231601670681650e-02   +1.410463074051667e-01   +1.071742167907722e-01   +1.016944391608099e-01   +2.660278167746746e-01   +3.203822158286377e-01   -5.885585674488986e-01   +1.125680385998201e-01   +1.770902398792908e-01; -1.648576379787513e-01   +2.143960306625206e-01   +2.513070733431861e-01   +7.829947003899840e-02   -1.949710014948130e-01   -3.776482942916349e-01   +3.139919234547569e-01   -2.584779477054679e-01   +2.272039120444289e-02   -3.375201536760648e-01   -4.508737838318853e-02   -3.538851601717508e-02   -3.180330524040099e-01   +1.319714242699635e-01   -1.873422605630499e-01   +4.129320247234055e-02; +1.690518490013069e-01   -1.025807504087778e-01   +3.239086058110583e-01   -1.040051285929202e-01   +2.786916745417104e-01   +1.343814370837808e-02   +1.939295532269625e-01   -2.121264872165123e-01   +1.528703381765936e-01   -1.235996840320848e-01   +1.258138728565542e-01   -6.470593914664771e-02   -3.114661307852095e-01   -2.189630199277626e-01   +8.802326444177042e-03   +3.480421575336577e-01; +2.285227402467488e-01   +9.820186176543627e-02   +2.271309265407906e-01   -1.012740894662267e-01   +5.255020869671499e-02   -1.217448131996128e-01   -8.985996043471553e-02   +1.256938441281077e-01   +4.600186425621086e-01   -3.713695397402163e-02   -2.167643273312398e-01   -1.156422428798901e-01   +6.358506975172380e-02   -1.661379304640796e-01   +4.976413717108904e-01   +2.924177509043489e-01; -6.890784798998338e-02   -5.282215477278029e-04   -6.909020056027647e-02   -9.481428416187526e-02   -8.632579308411698e-02   -3.738770893939523e-02   -1.050270416140484e-01   -3.202083419002383e-02   +3.456051727668873e-01   +1.353294628621503e-01   -1.551709645680049e-01   +5.446423102146392e-02   -2.942586766524836e-01   +3.746592227038088e-02   -2.062464727742590e-01   -2.602432733995935e-01; -5.294499239787228e-01   -2.398236948286219e-01   +3.283556577238145e-01   +2.165103662633331e-01   -5.031784939500591e-02   +9.106108175160077e-02   -3.970500933346555e-01   -1.334000652603240e-01   -6.275425588091355e-02   +3.907007835274159e-01   -4.117288846260138e-02   +4.790880442525650e-02   +2.796939038657060e-01   -9.462345335125777e-02   +1.271760201202117e-01   +1.717498777612640e-01; +8.622818553020579e-02   -6.400479619038434e-02   -5.328603193484480e-03   -3.851342710023793e-02   +4.483905826087754e-02   +1.604031108916573e-01   +1.456092764673305e-01   +3.861821170912773e-01   -3.941754061952902e-01   +2.279126337419113e-01   -3.704350514588326e-01   -1.813836460190346e-01   -8.494847911487442e-02   -4.100651651852290e-02   -2.197581716722551e-01   -1.574450890617998e-01; +7.421939130348384e-02   -1.794852176478818e-01   +2.542289084395558e-01   -2.800644468249214e-01   -6.834077155979812e-02   -3.739402090907110e-01   -4.150223189921787e-01   +2.952724802864648e-02   -1.133919452727235e-02   -1.749760609701715e-01   +1.510579148146357e-01   -1.558718636301753e-01   +2.802140205969130e-01   -1.989494122159599e-01   +3.327245332882047e-01   +3.716489429663293e-02; -1.655864384302573e-01   -2.643489357781424e-01   +1.200716834341201e-01   -1.417709678271946e-01   -2.520307211773282e-01   -2.017723017267308e-01   +1.058908922022873e-02   -3.403326422507951e-01   -1.312998509935763e-02   +4.182484603155708e-02   -3.807001754333525e-02   +2.357482366502642e-01   -1.361099892554031e-01   -9.133212808410424e-02   -4.405390857657958e-02   +8.593732503471184e-02];
L1E_L1I_iGABA_netcon = [-1.128943813223605e-02   -1.760595249195678e-01   -3.575276931599043e-01   -1.693531113437102e-01   -1.237762555631441e-02   -1.903966659488957e-01   +1.180952922451827e-01   +1.146080470502892e-01   -1.426411914005643e-01   +7.204419332060633e-02   -4.860177925439027e-01   +1.963961904533200e-01   -2.592947393903837e-01   -6.825617829808060e-02   +3.880590524613079e-01   +3.187494117291527e-02; -5.156178281327929e-01   -1.077658127897730e-01   +2.691880613299845e-01   +1.453213554208559e-01   -9.941383118227530e-02   +3.696756391771647e-02   +1.489166882064787e-01   +2.529990922648179e-01   -1.140376366734673e-01   +1.031991664973626e-01   -1.749281476936468e-01   -2.476314558603394e-01   +2.092592566560439e-01   -2.458213630955707e-01   -1.774826233765928e-02   -3.061424681356020e-01; +1.282087747346119e-01   +1.183161747722856e-01   +3.518775222708218e-01   +1.521274491503737e-01   +4.549863041472009e-01   -3.104395335332495e-02   +1.672330619087823e-01   -6.529216893148157e-02   +2.887031047168232e-01   -6.773129919563498e-02   -4.433120938415632e-01   -9.617212378894645e-03   +8.360535700828318e-02   -7.481047262100587e-02   -3.106347495058780e-01   -1.608985947301199e-02; -1.767190578574560e-01   +5.085431034176782e-02   -2.952343657545866e-01   -1.207141475047696e-01   +2.147966435787169e-01   +2.385273858498745e-01   +2.137388782263560e-01   -2.129889841437382e-01   -2.847888749495743e-01   -2.611233278558543e-01   -5.782397340672180e-04   -8.587298732742187e-03   +1.123176298380835e-02   +2.610841879906816e-02   -1.280156100690883e-01   +3.028666780675692e-01; +4.867802306612840e-02   -2.675962604694908e-01   +1.112450661481423e-01   +4.177994401816724e-01   +1.023730453336404e-01   +1.105062421479694e-01   -2.241369718862451e-01   +2.510559573908167e-02   +4.777830234664606e-01   +1.993559568353941e-01   -2.698601822509340e-01   -6.697517007242976e-02   +1.397219271230792e-01   +1.956007921042099e-01   +3.135589289103030e-01   -1.044403772360181e-01; -8.072730727891181e-02   +1.943497133813477e-01   -4.111944900289120e-01   -6.642296822781321e-02   +1.913101332160988e-02   +1.186729790194220e-01   -2.776455132498866e-01   -1.309792175395428e-01   -1.495183763422883e-01   -2.504908668079102e-01   -2.735949066279741e-01   -6.125716278789137e-02   -1.289103599370282e-01   +1.682315357881491e-01   -6.979641360070434e-02   -1.737620732817743e-01; +1.808870590785835e-01   -4.741060423020630e-01   -1.778759881655804e-02   +1.439305706699356e-01   -1.410494115131841e-01   +7.761000386042788e-02   +2.608764080645710e-01   -2.137173793004751e-03   +7.255377506382793e-02   -3.650266980574544e-01   +7.046739587254397e-02   -2.135944560238266e-01   +1.120717074913669e-01   +7.260966160847901e-02   -1.218146403487376e-02   +1.354272538759531e-01; +1.978934627643263e-01   -1.026526439384640e-02   -2.870957808295247e-01   +3.178603273648701e-01   +2.733346083199404e-02   +1.208149631507886e-01   -1.344492852079884e-02   +2.501190251111263e-01   -1.675831866945721e-01   +6.565261472544618e-01   -2.889549071792309e-01   -3.089420117877687e-02   +1.034723616703432e-01   -2.973791979757033e-01   -4.011628772362714e-01   -2.949843479881335e-01; +3.601557591992315e-02   -1.269064649505935e-01   -3.366138276772550e-01   -1.052652809632574e-01   +9.352511267253778e-02   +2.023619955863217e-01   -1.570339184240426e-02   -8.663624791944204e-02   +3.473812655193086e-02   -1.309720949007892e-01   +1.330445575079840e-01   +6.708692803366391e-02   -2.828255514041564e-01   +1.995646330520096e-02   +1.400689684292652e-01   -1.373123299277827e-01; -2.426375351161123e-01   +7.508089010441323e-02   +1.734862805795793e-01   -1.802657166902631e-01   -2.841874947814330e-02   +5.242840452855199e-02   -6.596559909992651e-02   +7.739608859610733e-02   -1.384214558656531e-01   -3.362695251568047e-02   +1.389287573775192e-02   -2.159835760224982e-01   -2.030542146803057e-01   -1.678205764251055e-01   -9.644706659548484e-02   +7.412941963135670e-02; +4.275447273974371e-02   -1.256501394273605e-01   -2.108066966936161e-01   -1.239512556617455e-01   +2.051775505420101e-01   -2.975170408135786e-01   +3.345338367563355e-01   +2.752614936672617e-01   +1.724928670673546e-01   +1.861174576494871e-01   -3.532659780309323e-02   -2.000675806020759e-02   -1.722390789484638e-01   -9.340519555141331e-04   +4.059155989167461e-01   +1.238221842824123e-01; +3.924698619129086e-01   -1.792706595528670e-01   +1.235966209290839e-01   +4.001165568575595e-01   -4.054531133096334e-01   -9.197275208424083e-02   -1.215983397967333e-01   -1.807509560991487e-01   +4.440749519158169e-02   +2.413189657251760e-01   +2.832421659221762e-02   -8.006349649818860e-02   +7.951118629754933e-02   +3.226101202141214e-02   -2.421705238728629e-01   +1.305727695046055e-03; -3.806389494421170e-01   -1.557213884475998e-01   -1.272756636789402e-01   -2.462928229315332e-02   +1.624225520142542e-01   -8.233988168161223e-02   +1.067292895125983e-01   +7.337862321225455e-02   +2.260074140951613e-01   -3.576860196923120e-01   +3.515850059572185e-01   -1.290999265894487e-01   +1.777757558124304e-01   -1.082834324998637e-01   +7.321021859746911e-02   -1.870479774696161e-02; +2.548319447026526e-02   -3.576759708454312e-01   +4.006742333301604e-01   -7.991424610497969e-03   -1.994307771544481e-01   -5.819454425367582e-02   +1.051576347822881e-01   +8.734497375471570e-02   -2.763653035737769e-01   -2.515124236989188e-02   -2.066078987987205e-01   +9.663109366436037e-03   -1.243567002953232e-01   +1.357479958631753e-01   -2.736954857434863e-01   -2.578941393356000e-01; -3.809910821695608e-01   +4.668165495486772e-02   -3.326530109701899e-02   +1.514755212302498e-01   -2.338874194035524e-01   +1.066100302830945e-02   -1.035112057643877e-01   -2.569100659969446e-01   -2.834858384575665e-01   +5.354321289730458e-02   +2.227427820812187e-01   -3.542854103291657e-01   -9.701953181230860e-02   +2.372530910835187e-01   +1.105802947242920e-01   -1.088066157227802e-01; -3.536451866275540e-01   +5.123055659139086e-02   +8.397271307030324e-02   +5.374650608655354e-01   +3.044026836430355e-01   -1.279927436039139e-01   +6.467924846067553e-02   +4.128797334045212e-02   +1.247321466422961e-01   +6.201837071686999e-02   +2.641584597104981e-01   +2.013144330383695e-01   +8.422522751514991e-02   +7.576524008059937e-02   +4.612730991198976e-01   +1.507093939754092e-01];
L2I_L1I_iGABA_netcon = [+2.571252318846005e-01   -2.355770278435303e-02   +1.263218710020963e-01   +2.899414443055927e-02   +8.068597810182469e-02   -2.041679393504921e-01   +2.600323847373230e-01   -7.041968300562017e-02; +1.511289273944137e-01   -2.771271599781047e-02   -2.046675482400555e-01   +2.855740685789023e-01   -7.103017893521274e-02   -4.005610648842440e-01   +1.827872020841275e-01   -2.381557177610903e-01; +1.438806050877795e-01   +3.600939390608933e-01   -1.026071237504597e-01   -5.999226571722291e-02   +2.235568760950074e-01   +2.276523568059627e-01   +1.266129847646803e-01   -1.824431312725962e-01; -1.882854484320921e-01   +1.555836215797309e-01   -3.401084583111241e-02   -1.160180282425822e-01   -3.799521592086602e-02   +3.051995926954394e-01   -4.939185786919661e-02   +4.351123194905465e-01; -1.431621947123358e-01   -2.076120193990735e-01   -1.305162360761173e-01   -1.567954320550960e-01   +3.363749820939801e-02   +1.516523435149473e-01   -8.458083841628786e-03   +4.194523200596313e-01; +1.043073032136011e-01   -8.895598785234195e-03   +1.384250214236507e-01   +2.582176787961707e-01   -3.539298847352786e-01   -3.080806195813066e-01   -1.905513089815146e-02   +3.289461290485264e-01; -2.393552656106748e-02   -8.569485617511710e-02   -9.807025234695843e-03   -3.139274276700975e-01   +3.127701144026571e-01   -1.806823049952226e-01   -1.502555676652460e-01   +5.915192394284610e-02; -6.334836459204914e-02   +6.683316060542230e-02   +2.878513835305734e-01   +1.004310730273626e-01   -2.250462010406041e-01   +3.694839159491543e-01   +1.609907367610135e-01   -2.095893827948239e-01; +1.608201863593327e-01   +4.526194128960870e-02   +2.663483157629480e-01   -6.898427804799385e-02   +3.343184662257212e-01   -8.275107088467956e-02   -2.196183852823037e-01   -4.381448139478119e-01; +4.068957585721349e-01   +6.811730939505975e-02   +1.064693519163832e-01   +1.068828484707939e-01   -1.731586725575045e-01   +1.229363917489869e-01   -3.939645522603381e-02   +2.298621354374987e-01; +4.416394744952274e-01   -2.563319207404796e-01   -4.466615792353793e-02   +1.625740317060601e-01   -6.536084376094631e-02   -2.322564295704568e-01   +1.240884055806661e-01   -1.052426174162962e-02; -7.435319426233111e-02   +2.386907841299818e-01   -9.804938988861206e-02   +2.761283018733318e-01   -2.837692231758933e-02   -1.402455228095043e-01   +3.254590386432076e-01   +2.918785756277927e-02; +3.339305580715031e-01   +1.053546630072791e-01   +7.795473069649150e-02   -5.041320362571539e-02   +4.357379017570234e-01   -3.929772027793252e-02   +1.922324255154939e-01   -1.506077610115463e-01; +2.797282960073587e-01   +2.408765770516643e-01   +1.647414899107029e-01   -2.373177147953664e-02   -1.297207523874468e-01   -2.387458849346722e-01   -2.914256846959561e-01   -2.910110452014327e-01; -5.567375699265585e-02   -4.619320370595225e-01   +1.628990995410154e-01   +2.704869768850890e-01   -6.974507930520774e-02   +1.199029401199596e-01   -3.801264998556952e-02   -1.408544190193743e-01; -1.540800413448100e-02   +1.193044625493368e-02   +3.775794551484388e-01   +2.869317697901488e-01   -5.295312357807166e-02   -1.073148360236257e-01   +3.752418958897759e-01   -1.183716471702955e-01];
L1I_L2I_iGABA_netcon = [+8.958145092626918e-02   +7.805093931124533e-02   -9.911440703386175e-02   +1.201557113996053e-01   -1.503582787192105e-01   +1.216352710477464e-01   +1.919221008912836e-01   +1.545333912641594e-01   -4.375891497481880e-01   +1.159529865851559e-01   +3.553250933283801e-01   +7.750118199122634e-02   +1.399300461589443e-01   +8.551065383679123e-02   -1.293211043846452e-01   -2.074171148224896e-01; +1.923427934385012e-01   -1.324191958457812e-01   +4.840165594709306e-02   -6.745645833239577e-02   +2.755643908399735e-01   -2.746264434272913e-01   -1.645466528860089e-01   -6.598684810848250e-02   +7.111583246478131e-02   +1.306713733695717e-01   -1.861224638117562e-02   -2.613679902795228e-01   -2.419767478768686e-01   -4.822985661861640e-01   +1.645632748300378e-02   +4.014311711028474e-01; -2.387388480315036e-01   +1.499152380234252e-02   +9.426974495596474e-02   +1.276795854737453e-01   -1.457111952303185e-01   -3.446234267199682e-01   +2.258702191752539e-01   -8.016239484021848e-02   +2.189998754481975e-01   -1.230705944105551e-01   +1.298899234901623e-01   -3.641715224363808e-01   -1.644607058612803e-01   +1.843380168291796e-01   +2.475363025743152e-01   +1.885024324452993e-01; +7.100691824472355e-02   +9.040520172973451e-02   +1.470948710847246e-01   -4.249413244194777e-01   -9.011389184463707e-02   -4.996920065353690e-03   -8.165429006936673e-02   +1.292449459299714e-01   +1.659933368404080e-01   +1.131044557457065e-02   -1.313759976227563e-01   +5.273491554913523e-01   -4.070370825616197e-01   -2.475113205859493e-01   +3.637381121555726e-03   -9.958428027710287e-02; +3.435229586979374e-01   -2.009330463377175e-01   +2.014515333927847e-01   +5.074787088256599e-02   +2.986005179142340e-01   -2.503223032315214e-01   +1.312306899476005e-01   -4.761227720253821e-01   -2.411474704166720e-01   +2.264733969402072e-02   -4.830299897103237e-02   +2.928755389346580e-02   -2.805941894375337e-01   -1.438665899510443e-01   +2.381074280056314e-02   +2.441473142351994e-01; +7.571569128920508e-02   +5.172574234160797e-02   +1.302624503058639e-03   -1.068220200861540e-01   -2.820401879707657e-01   -5.159599277034481e-02   +8.937204388707806e-03   +2.882296298639602e-01   +3.493316652626463e-03   -8.175825875487031e-02   -1.517717099722055e-01   +2.049542491829801e-01   -4.087158835639894e-01   -3.797132986858116e-01   -8.398614735147775e-02   +1.173697783193609e-01; +1.068204830885826e-01   -2.905247353912440e-01   -1.309813530906479e-01   -1.434677864160315e-03   -2.163506975869565e-01   +2.806475011161635e-01   -2.096148122221162e-01   +1.747136920937886e-01   -7.716480024531090e-02   -7.648871042590191e-02   -3.331408724700003e-01   -2.160177208030904e-01   +1.359824833164050e-01   +2.083089039338812e-01   -9.352676502075656e-02   -3.615085672841644e-02; -4.913734223377971e-01   -1.194967638649885e-01   -2.815641321064265e-01   -1.533625898097759e-01   +2.876587718465750e-01   -6.227899524191376e-02   -1.309391682308173e-01   -3.129790095101417e-01   +1.110194275410900e-02   +3.573119354553864e-01   -2.850140353810114e-01   +6.740599287115925e-02   -2.896441846058510e-01   +2.949726053836649e-01   +2.124124438469784e-01   +2.223739796394113e-01];
L2E_L1E_iAMPA_netcon = [-5.127328381444120e-02   -4.577587295605424e-01   -1.537832729016418e-01   -6.239472525025504e-02   +2.376578177164435e-01   +3.050236219861542e-01   -1.804918184765172e-01   -7.562968645330882e-02; -2.112319423682572e-01   +1.420174822686161e-01   +2.502625796530565e-01   +9.936180208835113e-02   -1.789952712447769e-01   -2.771707469804434e-01   +7.184801587893963e-02   -6.325203842287372e-02; +3.294041328425535e-02   -1.559584127064861e-01   -4.591986763877105e-02   -1.684317959379644e-02   +4.647172373012665e-02   -4.720452902057466e-01   +3.840289716428380e-01   +1.573025971250828e-01; -2.449806790391621e-01   +7.725969198760058e-02   -4.708343749982873e-01   +1.039047393760230e-01   -1.835629170504805e-01   +1.393571754100763e-01   +5.774118358793761e-01   -5.076606404779314e-02; -8.004957846321248e-02   -2.144720520535779e-01   -1.047999666646205e-01   +2.660312407415292e-01   +1.074656507770815e-01   -8.368384872363177e-02   -1.427454876866670e-01   +1.841481819409241e-01; +1.289581810950727e-01   -5.892157339692784e-02   -8.175715902423902e-02   +1.131741226331431e-01   -1.695255112673357e-01   +1.680542981372596e-01   +2.091029372018257e-01   -1.183673696369900e-01; +1.061959505041186e-01   -2.041246501938239e-01   +3.773116852039905e-01   -4.647021161030654e-02   +2.722168752629935e-01   +5.753784231435900e-02   +1.276489512053395e-01   +2.329348176609648e-01; +2.212508328645030e-01   -1.094894699605937e-02   -3.048060060637864e-01   +1.015765538313785e-01   +2.057414184938004e-01   +4.657244035226046e-02   +2.169170998202260e-01   -1.489032674301759e-01; -2.897456973593462e-01   -6.515982687575064e-02   -3.058540171341237e-01   -5.583451303753351e-01   -1.481540784157456e-01   +2.808161184727372e-01   -1.749947355888295e-01   +2.490532314532749e-02; -1.194318211336446e-01   +2.651000805895396e-01   +3.491830941718589e-02   -1.278205215520344e-01   +2.472279258866189e-01   +9.130391487117007e-02   +5.914251542427654e-02   -8.437044061631999e-02; +6.908299617555744e-02   -2.771467578848134e-01   -1.809158019189545e-02   -1.990906353125428e-01   +1.697737800058531e-01   -4.790474134808125e-01   -3.732118229874682e-01   -2.531490192200878e-01; +1.326854091944754e-01   -6.037255828615991e-01   +1.011699035761451e-01   -5.211851437664580e-01   -4.229660374153553e-02   -2.126155096274362e-01   +8.966231441822288e-02   +2.030819117618158e-01; -4.652874851767170e-01   -6.819270669350622e-02   +9.083609594984407e-02   -4.086033076948776e-01   +3.184251541325138e-01   -3.544600150462177e-02   +4.367764930382411e-01   +7.307915338089579e-02; -1.589431954901231e-01   -1.315202883199018e-01   +7.709038192212389e-02   +1.223405676430617e-01   +3.182456684984362e-01   +2.972141788872672e-01   +6.932603033040222e-02   +1.976778637694920e-01; +1.131750040114689e-01   +1.945923202563266e-02   -1.984198994338515e-01   -2.420674718607944e-01   -7.267286959034372e-02   +1.402534020348994e-01   +9.965956597433451e-02   +3.736178636769649e-01; +1.294262685937656e-01   +3.412156642144319e-02   -4.164601481273973e-02   +4.621944444574880e-01   -1.207192610590919e-01   +2.150238239343222e-01   +3.795486264047004e-01   -1.343809043432215e-01];
L1E_L2E_iAMPA_netcon = [-3.801297456427504e-02   +3.308257133666866e-01   -2.763996494413273e-02   -1.410543604512736e-01   +4.035134421069208e-01   -1.021044090797840e-01   +1.726541955324009e-01   +3.806446726093555e-01   +2.675833415009639e-01   +1.417125822617541e-01   -2.351647568082975e-01   -1.380884900996115e-01   +3.454733102565734e-01   +4.543578665332090e-02   +3.184437913275911e-01   -2.455209970509864e-01; +2.606794191862858e-01   -4.669874134026077e-02   -9.884726289568632e-02   +1.988484437733980e-01   +1.821005056285169e-02   +2.188217359502651e-01   -3.531136695091568e-01   +1.353630056852204e-01   +1.948261504509061e-01   +1.993673760838977e-01   -9.003109344855960e-02   -2.242936713661814e-01   +1.042107148868186e-01   +4.060478201046152e-01   +2.413173117994443e-01   -1.872307619662034e-01; -1.919825008671073e-01   -1.490179322657790e-01   +2.944400230980130e-01   -1.725798351590220e-02   -3.591558016017564e-01   +4.666445356061206e-01   -6.443137306602878e-02   +7.366672505572491e-02   +2.384370085214008e-01   +1.542640594488209e-01   +1.345650990694056e-02   +5.850920760941251e-02   -4.948744093890198e-01   -1.379228859909057e-01   +1.827838218761894e-01   +1.187897082149605e-01; +6.377549168126539e-02   -1.575381866961817e-01   -1.835974148922032e-01   -1.753807459760746e-02   +4.733237129975984e-02   +2.302377943731209e-01   -1.862475943711323e-01   -2.792423600061519e-01   +1.745937892980696e-01   -8.100574239587596e-02   -1.777449868433951e-01   -1.272797234205645e-01   -4.798424075621403e-01   -5.940248295508913e-02   +4.079609433604842e-02   +6.164883221823292e-03; -1.671968757235565e-01   +4.103756716565543e-05   -7.025526271078544e-02   +4.243657419495757e-01   -1.628142375631399e-01   -1.411957482951482e-01   -1.549989571268219e-01   +8.216671930924144e-02   +2.223506378124958e-02   +3.837131061136267e-01   -4.994036159066064e-01   -2.723236221055190e-01   +1.396604628614770e-01   -1.803040876245440e-01   +3.681353288729994e-01   +3.619277598389177e-01; +5.237742171315872e-02   +2.677858757827564e-02   -2.597278035461358e-02   +1.065896355578906e-01   +2.269478787208603e-01   -1.218955037514050e-01   -3.561744657790525e-01   -1.578281946231697e-02   -1.050608800864530e-01   -1.657970604903117e-01   -3.431453081529722e-01   +2.641853218196625e-01   +1.294946454967738e-01   -1.130809172861312e-01   -3.117375047966411e-01   +1.010044870487631e-02; -1.936640696820711e-01   +8.306252865322135e-02   -2.910304407654365e-01   +1.010671389114531e-01   +2.498094205722849e-01   +1.455081132296559e-01   -2.495573536016228e-01   +1.634153966200129e-01   +3.111811149712291e-01   +2.770201963171895e-02   +4.762492527441332e-02   -2.649570795474571e-01   +2.442930962957657e-01   -2.740074751853103e-01   -1.227846234749066e-01   +2.994907344937730e-02; -1.771548386961588e-01   -1.976142853427100e-01   -4.044390110497757e-01   +1.194809039049207e-01   -2.932632241635247e-01   -2.827019434442898e-01   -3.673125472409093e-01   -1.766540934228133e-01   +2.851883035649967e-01   -5.027440706735145e-02   -1.681736550184009e-01   -3.183133943209373e-01   -2.955295783213681e-01   -1.612292237389127e-01   -4.716684863088143e-02   -2.728553594222145e-01];
L2I_L2E_iAMPA_netcon = [+4.372977664591632e-02   -8.949341091888381e-02   +1.556259031295132e-01   -1.832693975321404e-01   +3.846015020269607e-02   +2.975819255297867e-01   -2.423213936258092e-01   -2.481020800342729e-01; +7.265928898136624e-02   -1.065592387020544e-01   +1.114853870445665e-02   +3.640790001937649e-04   +8.104902031165058e-02   -4.192409124204116e-02   -1.912764568180864e-01   -3.804270377959901e-01; -1.297034119037409e-01   -2.204246631099850e-01   -2.371521976718427e-01   -2.206504123563576e-01   -6.518356672498858e-02   -8.734064413723228e-02   +4.207155274606580e-01   -2.710984095728539e-01; -1.670333438831993e-01   +3.086196031979745e-01   +2.465624485294311e-02   +9.029251442951050e-02   -1.982716962295085e-01   -7.587772110949925e-02   +3.244788829581398e-01   -7.905518179834405e-02; -2.450645568378807e-01   +3.014360791832560e-01   -1.074870758667278e-01   -9.008018566283602e-02   +3.467782255201098e-01   -7.614593583905088e-02   +4.184242662260140e-01   -3.514955388419808e-01; -3.146578962683786e-01   +1.534417159810738e-01   +2.066963171799255e-01   +2.818327837197132e-02   -9.784639322009220e-02   -1.174592178263539e-01   +1.257486514495896e-01   +1.968201399885988e-01; -2.288318732184665e-02   -3.817509142832593e-03   -1.806138074088512e-01   +2.108886604836948e-01   -1.018249013723204e-01   -2.955562932189051e-01   -5.176063102404509e-02   +3.281422896779072e-02; -4.699672824005841e-01   -3.953995516695777e-01   +8.866089181551332e-02   +2.930461773583578e-01   -1.958348262292023e-01   -1.436428516106884e-01   -9.025645544486349e-02   +3.846125233074765e-01];
L2E_L2I_iGABA_netcon = [-1.945171385099032e-04   +2.889511398658675e-01   +2.191664324300835e-01   -6.623653229663179e-02   -1.498093856567224e-01   -2.565713919543183e-01   -4.876124238130423e-01   +1.632636802379183e-01; -3.905622326780672e-01   -1.879904876413019e-01   +4.269345044365149e-02   +1.716177129194113e-01   +1.880607013458080e-01   -6.510155574268023e-02   +1.500943439299378e-01   +1.329610450123268e-01; +1.288537038874085e-01   -2.634502099635466e-02   +6.147925253997848e-02   +9.210056983894171e-02   +2.256530556543611e-01   -1.846968387203319e-01   -1.619660536604180e-01   +1.094147664449601e-01; +4.820274991467111e-02   -4.226625879578280e-01   -1.896611026219944e-01   +3.671229821742000e-01   -1.881241959087107e-01   -1.270175317527708e-01   +6.035575556829556e-03   -3.941649985543518e-01; +2.655848240946900e-01   -3.471425256907715e-01   +2.191172159593012e-01   +2.422238490249281e-01   -2.229990293023917e-01   +2.142494883368596e-01   +1.134205846257588e-01   +6.404631382284658e-02; +3.885113837843507e-01   +1.654553118741592e-01   -2.429606821557405e-01   -1.299103990700461e-01   -1.030227490643072e-01   -8.250494205119457e-02   -4.215328050541356e-02   -2.908479356670698e-02; -1.222828243555336e-01   +2.234446958668697e-01   +3.489803402361618e-01   -1.864279178341616e-01   +1.130284909238444e-05   -1.366345101160207e-01   -1.132150142968432e-01   +1.417281600096868e-01; +1.130618198752693e-02   -4.793565698669483e-01   +1.129701096397783e-01   -2.999838399158422e-01   -1.041324349047374e-01   -9.353307836245432e-02   -1.521120286413237e-01   +2.343660918697992e-02];
L3E_L2E_iAMPA_netcon = [-1.813251204756559e-01   -2.558225960286389e-01   -2.508200621306576e-01   +5.573413840893660e-02   +3.028000144306273e-01   +4.664439693670054e-02   +5.294577984841115e-02   +1.297399049971477e-01   +1.832139179426505e-02   -3.712652850340502e-01   -5.376466768650492e-01   +1.119403949074911e-01; +2.334646597775203e-01   +1.131294816571688e-01   -7.823031751130992e-02   -4.823835874763371e-02   +9.234193602553929e-02   -3.699286858700687e-01   -6.020604191947376e-02   +2.060233382919527e-01   +1.235425754504339e-01   +1.811495674156202e-01   +9.751019773130805e-02   -2.481463788627934e-01; -1.441555424254006e-01   +1.603565036015535e-01   -3.236201116424116e-01   +7.275732786294657e-02   -2.730700698885493e-01   +9.251823761595140e-02   +2.333238149639040e-01   -1.187158455995773e-01   +2.032548425560126e-01   +9.173536381866644e-02   -2.007236502329697e-01   -3.071355341583716e-02; -3.819726345398302e-01   -2.422547550746945e-01   +1.923966210015858e-01   +1.397915921683357e-01   +2.153571640818882e-01   +2.486697470318690e-01   +1.887647060011561e-01   +1.246019807555022e-01   +6.654403707052683e-02   -1.021632861793365e-02   -1.148924372234238e-01   -1.673492490403769e-01; -3.196595645768208e-01   -1.706078144683144e-01   -3.684730101669682e-02   +1.591418049571750e-01   +5.160919488158763e-02   -1.438128665025358e-02   -9.966044441486288e-02   -1.784308827804161e-01   +1.570771523261338e-01   -2.207403307121424e-01   +1.085369362073318e-01   +2.217298202960534e-01; -5.082608595263952e-03   +2.682236376588511e-02   +1.965082618564540e-01   -5.250406277676756e-03   -1.686693990629887e-01   +1.356979637730542e-01   +1.238970559933072e-01   -3.884171233954023e-01   -3.061862263439038e-02   +4.060855923597140e-02   +3.567149304929772e-02   -4.975756231495526e-02; -1.318103935375859e-01   +1.081217635249679e-01   -1.307426189359400e-02   -1.831697031463576e-01   +6.308477787081254e-03   +2.894221749439845e-02   -1.734231056395792e-01   +3.265419959616150e-01   +3.142893566858243e-02   -2.441229963499857e-01   -1.833458829118360e-01   -1.222370803839396e-01; -4.649579004958441e-01   -1.055996007884134e-01   +4.226845037987026e-01   +1.608119701200853e-01   -3.353673358111244e-01   +1.184707716086029e-01   -3.713523184616825e-01   -4.199425231617140e-01   -3.442258655725312e-01   -1.638687404849072e-02   +1.535999862488210e-01   +3.912002580471464e-01];
L3I_L2I_iGABA_netcon = [-1.007747162044816e-02   +4.644675554299424e-01   +1.922895153344162e-01   +2.949722237551985e-04   -1.479402990607638e-01   -2.567660565977671e-02   +1.401391082091959e-01   +1.845877252887385e-01   +3.537895517809437e-01   -1.001879133912119e-01   +8.278571874796750e-02   +4.214702594773837e-01; -3.833729538423816e-02   -5.068424628552962e-03   -2.157411151004022e-01   +2.385630093678707e-01   -6.029334188508343e-02   +1.335537215205656e-01   -3.651067875823644e-03   +2.808737063784390e-01   +1.962349282563225e-04   +1.327411916708084e-01   +4.695602933411603e-02   -2.934879862635870e-02; +2.607855116892772e-02   +3.408348007296895e-01   +2.656770830665672e-01   -2.608097132087699e-01   +2.232297132304460e-02   +6.808477456503996e-02   -2.196931274806835e-02   -2.169362189539429e-01   -1.609190414684860e-01   +2.033941711930674e-01   -2.833657034461758e-01   +1.001645164662941e-01; +6.039506965436553e-02   -3.853847386865399e-02   +1.586805651880929e-01   +2.380946859922485e-01   -2.092368337277161e-01   -1.391797386700726e-02   -7.255060506752459e-02   -1.041917484182948e-01   +1.472329215437414e-01   +6.290618506731332e-02   -2.065618470315807e-01   -3.097298485790307e-02; +3.939866619455115e-02   -4.207017519176755e-02   -1.635482807711175e-01   -2.618712347576644e-01   +1.857432670147109e-01   +2.926536575152244e-01   -8.315256951530128e-02   +1.452519710405581e-01   +2.274447567223935e-01   -9.714695278422231e-02   -1.783967575965192e-01   +2.137063844036581e-01; +2.650830084989600e-01   +3.798064471461653e-01   -2.527039697830344e-01   -1.162196492309772e-01   +1.235296153384735e-02   +1.082619914081640e-01   +8.431109939507594e-02   -2.303920523177573e-01   +4.133615942200931e-02   -1.422067652835331e-01   -1.921732971695503e-01   +7.147643814288168e-02; +2.975658516074162e-01   +5.411895148197961e-03   -1.787987191228220e-01   -2.239977293793073e-01   -2.783229809792570e-01   +2.395171432220301e-01   +1.139760663606763e-02   -2.262510034550362e-01   -2.250773891608529e-01   +1.157269700703973e-01   +1.816799785998871e-01   +1.612674118940527e-01; -1.485470939286603e-01   -3.982571441262656e-02   +2.720728087219426e-01   -2.004059667739472e-01   -5.267484131959960e-03   +6.742287690755787e-02   -5.972788706854255e-02   -3.256009632478156e-01   +4.936336335203884e-02   +1.890525207437928e-01   -7.932623264861324e-02   +3.145034474795532e-01];
L2E_L3E_iAMPA_netcon = [-1.280254432594494e-02   -2.598999938326751e-01   +4.745145080043774e-02   +4.404263898161793e-03   -2.501466697853058e-01   +2.736105074195353e-01   +5.123108735956844e-02   +8.238299373669679e-02; -1.757794505252560e-02   +1.770249790701192e-02   +2.940018699549803e-01   +1.283432821983224e-01   +2.544099352563716e-01   +9.643663355528978e-02   -4.585018943752404e-01   -2.530420233623538e-01; +1.688385860336969e-01   -9.414611310599902e-02   +8.346988657271362e-02   +9.671401038624682e-02   -3.957411432759499e-01   +1.004431449288954e-01   -1.610632114545085e-01   +1.996260680464360e-02; +6.236406225076827e-02   -2.143162327295790e-02   -1.395618953446804e-01   +1.701410112871596e-01   +2.033207170491230e-01   -1.482978743027672e-01   -4.587785690580349e-01   -1.458687965396790e-01; +1.906561828909349e-01   -1.735036911388892e-01   -1.738492294960928e-01   -1.192511526731760e-01   +3.629012077487793e-02   +2.858941996313768e-02   -1.595013806323112e-01   -2.252183225348138e-01; +1.769046573046368e-02   -2.175782803654793e-01   -2.192148934685076e-01   -5.274833077124048e-01   -9.193069038959621e-02   +4.430913295156186e-01   -3.764160319351556e-01   +1.399563117416189e-02; +2.630581284865629e-02   +2.423151970739733e-02   +1.740259170556379e-01   -3.685456059554781e-01   -2.279555141271467e-01   -3.966192309805034e-01   +3.322140023035773e-01   +2.984082532691095e-01; -1.887134069339752e-01   +2.110308782351677e-01   +1.645164734420145e-02   +2.912687859898781e-02   -5.313390568498733e-01   -1.700215011209630e-01   +8.747998460741103e-02   -6.468522416175469e-02; +3.679807822179283e-01   -1.129536764154386e-01   -9.542034062639376e-02   -2.159386904232587e-01   +2.769098400805625e-02   +2.877302742534975e-01   +1.067265110178892e-01   -3.330110975753209e-01; +1.663274923466391e-01   -6.847189691803435e-02   -9.254512743330238e-02   -2.443272459787545e-01   +2.571558463592436e-01   +1.316628290836679e-01   +3.271034927918196e-01   +3.385757994013813e-02; -2.745156168797203e-01   -1.912757842137801e-01   -1.368420997351863e-01   -1.996904380116883e-01   +1.475664978094214e-01   -2.342811201658964e-01   +2.489591094733925e-01   -2.145376908534168e-01; -7.507235422038712e-02   -6.550765816292109e-02   +3.376740747992582e-01   -3.255598232942483e-02   -2.850718666101877e-01   -1.480664420710429e-01   -1.163684164474483e-01   +5.691368730436557e-02];
L2I_L3I_iGABA_netcon = [-4.168783303490571e-01   +1.121830139043103e-02   +3.760251473442304e-01   -1.713267585755635e-01   -3.618055341835468e-01   +2.504699196133808e-01   +1.081243303214202e-01   +3.416338239721396e-02; -9.559759532959279e-02   -2.241039049176792e-01   +1.043349987566259e-01   -1.247430215128373e-01   +8.898112124250973e-02   -1.244133986700935e-01   +4.115499250481068e-02   -1.863230063710891e-01; +1.196665748549038e-01   +3.999408806054235e-01   -3.230309366225406e-02   +2.131592574058468e-01   -7.215773934887312e-02   +2.055422375569084e-01   +5.032457784548328e-01   -9.225593147008024e-02; -8.491035615086850e-02   -2.312086411071805e-01   +7.018646395705799e-02   +1.194851178538767e-01   -2.926421408850864e-01   -7.202858130430188e-02   +2.386781432101550e-01   +8.259171258895107e-02; -1.280023453329747e-01   +2.402186053486311e-01   +1.999551955085158e-01   +3.230707850558489e-01   +1.038410080794423e-01   -1.668661245706774e-01   +3.111430302459299e-01   -1.669778398212977e-01; +2.980515815796265e-01   -8.117010580879079e-02   -1.143513949277757e-01   -6.531666078032147e-02   +1.039133540550867e-01   -3.053592805193380e-01   +1.576014908851674e-01   +2.512148516020066e-01; +2.866734001882909e-01   +5.133843292749882e-02   +2.937429714106087e-01   +5.135068036031975e-02   +2.207969631353223e-01   +2.233708785385594e-01   +3.750750570999835e-01   -1.688161569142808e-01; +2.065162125416682e-02   +1.715379067340526e-01   +1.544899019105468e-01   +1.126104194632047e-01   +3.301485285945010e-01   -3.251693709563769e-01   -8.670162951596992e-02   +1.992296336376070e-01; -3.173986865912666e-01   +2.524583747276097e-01   -4.100580570211354e-02   +3.874331781596692e-01   +3.757634176968938e-01   +4.612267047444437e-01   +3.141821478531427e-01   +2.415796122403342e-01; +2.239416291769195e-01   +1.996008813623124e-01   +2.547189759785419e-02   -2.559011451956953e-01   -1.712732899436300e-01   -5.377814843954871e-02   -4.035513998594945e-02   -6.930259005387707e-02; +2.410177198198919e-01   -1.873511579957368e-01   +5.946576049005475e-02   -2.431850484966245e-01   -2.121213816647173e-01   -6.353308334739328e-02   +1.630936532525848e-01   +3.602019428539793e-01; -6.085996558883339e-03   -1.227114553224736e-02   +1.237346881931228e-01   +3.567178311560647e-01   -3.473136891607687e-01   -1.045495901256141e-01   -3.614023816511884e-01   -1.057754996503158e-01];
L3I_L3E_iAMPA_netcon = [-1.854867581046369e-01   -7.440418567890286e-02   -1.439411307059690e-01   +4.087528443346260e-01   +6.773905628920916e-02   +1.874233753774534e-01   -2.800790932945594e-01   -2.844236974671051e-01   +3.094591785437988e-01   -5.552925440627620e-01   +7.189347428978856e-03   +2.711582274666786e-01; -9.429250443664215e-02   -9.115995225994759e-03   -1.959654122868573e-01   +5.960929687380797e-02   +4.391275462483364e-01   +1.009654634900505e-01   -1.304661944990234e-01   -3.906329682520866e-01   +1.657031805032078e-01   -7.040585305680172e-02   -2.979259074574125e-01   +1.986385096805658e-01; +3.662225785876674e-02   +1.329011978879282e-01   +3.621689914146741e-01   -1.929032565373017e-01   -1.912617998614684e-01   +1.874936281945014e-01   +5.857696903780228e-02   +8.196315927688698e-02   +4.427843061659521e-01   +1.868993547109987e-01   -1.794121159160998e-01   -3.161681368599843e-02; -4.077446724868203e-02   -1.139068655545793e-01   +2.309357980190117e-01   +3.837304064130327e-01   +3.801702606620518e-01   -3.961599237222068e-01   +4.209432659254348e-01   -4.702073502933884e-02   +4.442806726898324e-02   +2.709330182373485e-01   +3.371932557391317e-01   +2.007296532597916e-01; +1.186670371776558e-01   +4.049019066234166e-02   -2.875291157475667e-01   +4.052776927887258e-01   +8.997024642839867e-02   +6.706018210246198e-02   -9.313574130481478e-03   -7.321648653781894e-02   +8.410577929370595e-02   -4.169583854235977e-02   +1.106874233488166e-01   +6.042312050993480e-02; +1.646351138623148e-01   -1.481742096629643e-01   -3.555923499803798e-01   +3.507557970104355e-01   +2.440057749202603e-01   -2.653679598089917e-01   -7.677448695821995e-02   -8.695997360745553e-02   -2.901335089228268e-01   +4.797598878496735e-01   -2.787645308457212e-01   -3.655292750142196e-01; +6.639204635605483e-02   -4.202359458123148e-02   -2.313000369617105e-01   -2.488153297484036e-02   +1.039975577328755e-01   -6.672063498654499e-02   -2.104119506772615e-01   -2.959317754324134e-01   -2.102086597628784e-01   +2.350241322045719e-03   +4.517184215034209e-01   +3.854455007711115e-01; +3.222491083124576e-02   -5.959635026504015e-02   +4.016365053765128e-02   -4.181166033215708e-03   +1.421324073654359e-01   +4.132487641135821e-01   -3.509879861127814e-01   +4.638196469513239e-02   -6.400060080342063e-02   +8.557421074570734e-03   +3.097222089644593e-01   +2.458524055207160e-01; +2.848812253956721e-01   +6.812357180038725e-03   -6.818847350917545e-02   +2.665286795116268e-01   -1.502968547590425e-01   -2.101025241411350e-01   +1.254047085442903e-01   +3.539614947292673e-01   -3.491057252535517e-01   -1.005119701753687e-01   -7.963210667165094e-02   +3.070636646152202e-01; +2.482168535109982e-02   -2.019808025144866e-01   -5.786251778073398e-02   +3.558707166676640e-01   +1.071849617421773e-01   -1.830258462520294e-01   -1.353699436872100e-01   +2.305346493981729e-01   -2.012746610951006e-01   -3.946620829436260e-01   +2.190431655320293e-01   +7.427607367182704e-03; -2.258421716174349e-01   -4.627294956360119e-02   +2.583175177492651e-01   -1.859122800740169e-01   +3.721498314803355e-01   -3.778418420198956e-01   +4.658806891688348e-02   +1.631947172021604e-01   -7.263259445203456e-02   +2.044008991569045e-01   +3.127556866877679e-02   -3.826309693222688e-02; +1.060108289923591e-01   -2.144572403363013e-01   +3.572410344979959e-01   +2.259905617947848e-01   -1.502056810473696e-01   -4.191090317885177e-02   +1.909743098050781e-01   -2.477090955996953e-01   +9.887752324016869e-02   +3.087588058451383e-01   +6.218984240147676e-02   +9.141257079826838e-02];
L3E_L3I_iGABA_netcon = [-1.067596071103930e-02   +2.881671058250726e-03   +2.578074104363987e-01   +5.531802215081508e-02   +2.352040749567050e-01   -3.935343744420662e-01   +3.247543697575012e-01   -1.936876838593827e-01   +8.665702359584075e-02   +6.406171953572880e-02   -1.185454575905375e-01   +1.196605000319004e-01; -5.057683170350331e-02   +2.845196047101263e-01   +2.716022323446073e-01   -1.544404289946977e-01   -3.027617277859333e-02   -4.474004167581888e-02   +1.038022691257909e-01   +1.299945169981273e-01   +6.321439472858617e-02   -4.274530690144909e-01   -4.075998166213776e-01   -1.212562185421322e-01; -1.591850588463354e-01   -1.781471819970748e-01   -1.304959900541194e-01   -2.625831260780781e-01   +3.318168005580188e-02   -8.591092791803565e-02   +2.175184180605596e-01   +2.636991776460643e-02   +4.796448785913726e-01   +4.069559889574780e-01   +1.451761358055572e-01   +3.647906051853883e-02; +2.296325515576343e-01   +1.952290506372812e-01   -9.993935078012219e-02   +9.831520095091989e-02   +8.498319967699848e-02   -1.387289003125357e-01   -1.598786518045716e-01   -3.062939366053853e-02   +1.174516098008804e-02   -1.105373454038967e-01   +9.068916374229261e-02   -7.960560339139264e-02; -1.259409355866632e-01   +2.876939951888400e-01   -2.386999366989320e-02   -5.719919344343138e-02   -1.621142922783138e-01   +8.481542599168915e-02   +1.510754486120014e-01   -3.481750403449560e-01   -2.934992474217483e-01   -4.106575427006977e-02   +6.962731127149929e-02   -3.423780784623813e-01; +8.760987136949147e-02   -1.515439581659427e-01   -2.611766483777834e-01   +2.302257296636192e-01   +3.551407204155855e-01   -1.171215907630868e-01   +2.385512212076800e-01   -6.215024073495002e-02   -7.708015513702850e-02   -3.381877495968131e-01   +2.073679864856246e-01   -9.305412587900265e-02; +1.952158543786854e-02   -3.622491811771900e-01   +3.060939434435473e-01   -3.948033793761536e-02   -6.742951496047105e-02   +3.033314199654747e-01   +1.561118454952062e-01   +9.783046052113685e-03   +2.204568734268957e-02   +1.478763667556205e-01   +3.284026610066403e-01   -3.541704138453799e-01; +6.290255065438850e-03   -1.893287354148399e-03   +1.031593803314446e-02   +7.596945310559212e-02   -1.252657725908906e-01   -2.170287123107845e-01   +1.442360257586451e-01   +5.347739776428053e-02   +8.603964000415440e-02   -2.081818547640783e-01   -3.801248537557879e-01   -2.664759987166646e-01; +4.570866769641593e-03   +3.238834950329095e-02   +3.104872831145367e-02   +3.291219271862719e-01   +1.632921438561738e-01   -1.343513659889606e-03   -3.314157140785886e-01   +3.369539343483003e-01   +9.455913253046046e-03   -1.422718643909977e-01   -1.287084531121222e-01   +2.774028909143566e-02; +1.122817706293328e-01   -2.128090330771989e-01   +1.023832871121526e-02   +6.204520508920040e-02   -2.408335596112935e-01   -1.510188676519844e-01   -1.867403992827951e-01   -1.476478244507154e-01   -1.481915017877847e-01   -2.527365114482727e-02   -3.590774397592610e-02   +3.390441319058283e-01; -5.274816933052323e-02   +3.160046903097198e-01   -1.340880188321927e-01   +9.491165565410070e-02   -1.476883138006092e-02   +2.319942755195120e-03   -7.837129057949915e-02   -9.423828817387304e-02   -3.470733893409950e-01   -4.333301221059699e-01   -2.139745099835079e-01   +7.783365372441405e-02; -1.121180548525832e-01   -3.108558837127783e-01   +5.860142536483724e-04   +1.751413140305396e-01   +1.358560219816839e-01   -3.146565234463867e-01   +2.106577948727423e-01   -3.539625044463113e-01   -9.842023893140612e-03   +2.386715654736320e-01   -1.688148180503419e-01   -2.892058508590404e-01];
L2E_Input1_iAMPA_netcon = [-2.540301578591017e-02   +2.011550230666140e-01   -6.424167973471923e-02   -2.868904819979615e-01   +1.608522174310058e-01   -4.623015034047753e-02   -1.574965063722744e-01   -5.658265905764526e-02];
L2I_Input2_iAMPA_netcon = [+5.204317732937397e-02   -2.838042582704109e-02   +2.031360659486158e-01   -6.179887891992718e-02   +2.822107280990999e-01   -2.364545710548887e-01   -1.322766313090352e-02   -6.355371314595734e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
