function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.618648488829897e-03   +4.448722593389361e-02   +7.690350756483638e-02   +5.744057769722367e-02   +5.299771850538085e-02   +9.153610001576912e-02   +4.260166503205711e-02   +1.365280240218332e-02   +2.004220801955664e-02   +4.040701668181897e-02   +5.636407089915822e-02   +2.497085736217029e-02   +3.788112982056704e-02   +6.250541556165308e-02   +3.987885912235687e-02   +5.590840827867824e-03; +3.493052126355222e-02   +1.929898403813312e-03   +4.671421380601814e-02   +5.549374667015055e-02   +2.123735952746077e-02   +2.818742980553933e-02   +8.335402094507394e-02   +8.861910841060254e-02   +6.032197571974239e-02   +2.195667886564079e-02   +9.041653362594504e-02   +1.725676681465488e-02   +1.608461513653821e-02   -5.815307871278775e-03   +5.014119674318165e-02   +2.297527998201052e-03; +6.230420791973139e-02   +6.304403373984521e-02   +7.780707041946430e-02   +4.476753344909916e-02   +8.990442839712027e-03   +8.181693526481340e-02   +7.710182399832767e-02   +4.025383415809562e-02   +4.014954277815833e-02   +3.248063570713901e-02   +4.222338361871804e-02   +1.721004687263392e-02   +3.978988143094317e-03   +1.789041422663996e-02   +7.486032034484434e-02   +5.180238594959795e-02; -9.920651494074407e-04   +3.891666672533395e-03   +4.047412193057334e-02   +5.906451697011932e-02   +1.802762317985753e-02   +6.553727663518062e-02   +4.345255137174417e-02   +8.589347917866129e-02   +3.317777914083500e-02   +2.178157257644693e-02   +7.660326865622967e-02   +8.236223977388657e-02   +1.509560355784800e-02   +8.206718226808550e-02   +2.054959689642275e-02   +2.789038412580047e-02; +4.439612831426466e-02   +5.829011785730608e-02   +5.854707771344009e-02   +6.419688890549710e-02   +3.409274256526731e-02   +8.121364647806453e-02   +4.175180407795112e-02   +2.175148907694759e-02   +4.801855989120002e-02   +7.395762235536707e-02   +3.280041545565827e-02   +6.216049945629946e-02   +2.004136525867263e-02   +2.511756095346460e-02   +8.635285737524548e-02   +1.581072760867548e-02; +4.450617368946801e-02   +8.273591006262892e-03   +7.637244280266052e-02   +1.672069905400998e-02   +5.181231553019542e-02   +2.860239735528916e-02   +3.593833779355517e-02   +1.633964153176270e-02   +3.897948393739462e-02   +4.341459679266547e-02   +6.161681465690713e-02   +2.032669086914547e-02   +4.377642657484160e-02   +4.742496073117806e-02   +4.571592535613593e-02   +6.389668234086948e-02; +3.019534641872394e-02   +5.960695803577895e-02   +8.007264804394199e-02   +5.611137931429998e-02   +4.012444137397966e-02   +5.240287296787392e-02   +3.401097716658885e-02   +7.838234661839524e-02   +8.612988824397080e-02   +3.522395301539508e-02   +1.199910457548537e-02   +1.689889392358280e-02   +4.180260458391418e-02   +8.513504810080844e-02   +7.063236936561282e-03   +2.014762263738516e-02; +4.895709466435805e-02   +3.262793878053367e-02   +6.344060652964609e-02   +5.562916353653967e-02   +5.515465444263903e-02   +1.366820879601387e-02   +4.060040839555429e-03   +4.390484294878523e-02   +6.693885051576423e-02   +5.521816775918106e-02   +2.447998192809233e-02   +6.937647019867256e-02   +2.096098401904175e-02   +1.061716589138060e-02   +5.856343388590690e-02   +5.379633308301032e-02; +1.482708262740263e-03   +5.826935997609319e-02   +5.646070347668781e-02   +5.817935205898187e-02   +3.368072223101762e-03   +8.223668618145667e-02   +3.521797934135087e-02   +4.384853317429228e-02   +4.567293985131920e-02   +4.516147849756611e-02   +1.646124410539286e-02   +8.178733012180071e-02   -3.675090623038637e-03   +6.713139561023999e-02   +2.878397859103697e-02   +3.725335410446792e-02; +5.892873136628661e-02   +1.384170516775043e-02   +7.975389400144481e-02   +7.180735575855099e-02   +5.489481615992282e-02   +1.578325227672038e-02   +1.016568458443643e-02   +4.405390360630194e-03   +6.555727342866562e-02   +3.635087260364934e-02   +6.282535782384911e-03   +5.056852980607997e-02   +7.988575675908823e-02   +1.974485560829099e-02   +7.444173649360533e-02   +5.694653583088996e-02; +3.951759204627266e-02   +4.413578611143307e-02   +4.551144266806714e-02   +7.107279990408738e-02   +7.890918351772759e-02   +1.632797881474813e-02   +5.416668785990363e-02   +5.465284552250577e-02   +1.876131053278275e-02   +1.873127063618898e-02   +6.453198527825890e-02   +8.228624525512922e-02   +1.472175767313142e-02   +5.909408320175340e-02   +6.737199241486716e-02   +1.725179658458808e-02; +4.596382902632947e-02   +2.194508694904746e-02   +5.085125882843941e-03   +1.824283085052678e-03   +7.879909684999632e-02   +8.177165061051707e-02   +7.441299331653015e-03   +6.363608415196619e-02   +6.233476347631789e-02   +2.810323378568056e-02   +1.045447846723692e-02   +2.422102884756043e-04   +8.123306527188588e-02   +7.122314026237562e-03   +4.573232140175728e-02   +4.001326781498007e-02; +5.851610525055945e-02   +6.792515950618599e-02   +7.302211778559245e-02   +1.653383480420842e-02   +5.806059896954290e-02   +6.041338423920728e-02   +6.402739853308949e-02   +6.373777086268380e-02   +7.475639017082125e-02   +3.813591325554250e-02   +3.254563354928159e-02   +8.447245585467314e-02   +7.335131180730527e-02   +6.303253625933516e-02   +4.225630122105110e-02   +7.926310561653936e-02; +7.421802580865752e-02   +5.951834847100483e-02   +2.737712524605650e-02   +4.829944250338586e-02   +1.178003634876663e-02   +2.186273906649999e-02   +1.271075809405141e-02   +1.912698690775557e-02   +2.894334335092694e-02   +6.569462138094249e-02   +1.617977534263374e-02   +7.839150037780636e-02   +5.396380419856691e-02   +5.954711460932430e-02   +3.371238243052301e-02   +2.822285090291633e-02; +1.826813591675684e-03   +4.754674221113352e-02   +7.635382695640271e-02   +4.890645049312983e-02   +2.886131356474337e-02   +1.313639934148804e-02   +2.237683124938383e-02   +3.665469652962584e-02   +2.208813258889151e-02   +8.585828699963095e-02   +2.830582916566497e-02   +6.961183967105319e-03   +1.095413452000412e-02   +6.662337865633029e-02   +2.146014442879087e-03   +5.916620658467731e-02; +6.793553621915782e-02   +2.758420933456445e-02   +2.037334489050237e-02   +8.606783072893165e-02   +7.760852678135228e-03   +1.161132678918428e-02   +7.746556348827985e-02   +8.055562997765758e-03   +4.975498214358412e-02   +7.188986883200345e-02   +6.427894019224614e-02   +1.313113779955855e-02   +6.474447870682593e-02   +7.048926846264542e-02   +8.754745096813542e-02   +7.878008045361880e-02];
L1E_L1I_iGABA_netcon = [+4.264794791357612e-02   +5.110149279073459e-02   +5.494740699290093e-03   +2.208526611128813e-02   +7.279829490319693e-02   +3.480501283762918e-02   +3.411280844564540e-02   +1.602742455180948e-02   +9.882006684863410e-03   +2.561092991301415e-02   +3.264307890191395e-02   +4.940132432542729e-02   +2.603588866117284e-02   +7.853625476281950e-02   +1.726885641662711e-02   +4.080624265291657e-02; +6.723536057299907e-03   +8.156023468476974e-02   +4.787614715463218e-02   +7.281402145904999e-02   +3.965802838254125e-02   +4.280619356089195e-02   +1.593255986995383e-02   +4.475144977855353e-02   +4.698485480898643e-02   +1.283327809981198e-02   +1.789362973898879e-02   +6.297757506917410e-02   +3.572027878711397e-02   +6.238362547456052e-02   +4.594771751855183e-02   +6.358407729941083e-02; +5.485326802507780e-02   +8.588381493735057e-02   +7.480321397012590e-02   +5.900493807609272e-02   +1.255252950767289e-02   +4.412158954593319e-02   +5.710657261436031e-02   +8.120714067062755e-02   +7.968793519492177e-02   +9.026496662493812e-02   +5.856207686312213e-02   +4.701907641279019e-02   +8.461669906169549e-02   +7.313595213965556e-02   +3.850166843678971e-02   +5.325068411414319e-02; +1.430604749841418e-03   +1.496217830683675e-02   +7.881750799805282e-02   +9.499346719849647e-03   +1.273528691083827e-02   +6.360029894411919e-02   +6.823703074390738e-02   +4.585494488417410e-02   +4.525117343679392e-02   +8.699560513765667e-02   +5.630072936980127e-02   +9.527092659370545e-03   +3.044127630086057e-02   +2.085965975855030e-02   +1.072826648045233e-02   +8.751500761715461e-02; +4.785435170382397e-03   +7.956647919822715e-02   +4.315103647575613e-02   +9.654174611956019e-03   +3.865910387901239e-02   +7.508855724302002e-02   +6.415137655133889e-02   +3.574845441577466e-02   +1.861299732619914e-03   +1.434870908911540e-02   +5.800303658221099e-02   +1.261071727545797e-02   +7.202309566757933e-02   +3.884664411551855e-02   +5.491364475044149e-02   +4.232843207459539e-02; +7.476021617768690e-02   +7.927400550493792e-02   +7.887832200894508e-03   +6.355749629955638e-02   +3.051705667318401e-02   -6.653557412165359e-03   +6.095217789956557e-02   +2.597579188876671e-02   +7.757779788156700e-02   +1.684440284470593e-02   +8.146292506774187e-02   +1.272311146709139e-02   +3.544299902899112e-02   +5.758202698692065e-03   +5.477222178623472e-02   +1.466908880501117e-02; +4.515773143502998e-02   +1.920363853122969e-02   +1.548139738147681e-02   +2.176159560457926e-02   +1.066136321191856e-02   +3.270424970321757e-02   +2.931000089101426e-02   +4.666728790073332e-02   +7.929686878873959e-02   +1.688963948456087e-02   +7.125146314105385e-02   +8.578595528367357e-02   +8.987490988412745e-02   +4.363595027887697e-02   +4.582613302603547e-02   +2.591468775239830e-02; +2.386738916393029e-02   +1.547784795525544e-02   +1.355975024477900e-03   +1.507277033554170e-02   +5.829650511791264e-02   +4.580874613050044e-02   +4.411695724926698e-02   +4.959470798719606e-02   +1.877331704853787e-02   +3.808927738559745e-02   +7.638384259201282e-02   +9.031867943155340e-02   +4.672554583620639e-02   +4.241227618310331e-02   +1.355526162895661e-02   +6.126577154847470e-02; +2.972351176787958e-02   +5.443681235054740e-02   +2.765406647254292e-02   -4.398862325811942e-04   +1.636299546080137e-02   +5.556626200459506e-02   +7.014633602004926e-02   +7.854282347282672e-02   +3.008386506079238e-02   +8.972432700996201e-03   +6.309818849178286e-02   +3.585859446888882e-02   +8.226598258621989e-02   +8.635780990921407e-02   +4.925935190606479e-02   +1.236912798497521e-02; +5.929283840067155e-03   +3.532847010964710e-02   +2.036888079174592e-02   +5.078432152554112e-02   +3.311245312816031e-02   +7.042076755696086e-02   +2.492939671339706e-02   +2.436443974967788e-02   +8.425833794819154e-02   +7.058850791909496e-02   +2.018571913914875e-02   +4.949047585330316e-02   +6.729526800852657e-02   +1.723485813937388e-02   +6.130141649909435e-02   +2.164621653868577e-02; +7.603403445417498e-02   +7.703155899336716e-03   +2.870355714017901e-02   +4.047631738589199e-02   +5.003755731127673e-02   +6.146128723551823e-02   +4.056276419878930e-02   +8.767604519449750e-02   +3.017063603656188e-02   +3.391154059621587e-02   +5.563853094324502e-02   +4.226263517180546e-02   +1.872239212151660e-02   +8.842774578601470e-02   +7.212889804500598e-02   +2.981027129048671e-02; +1.730232338401036e-02   +8.241264607377394e-02   +4.613185613396840e-02   +8.289465396755208e-02   +8.416616199102805e-02   +6.357674202381247e-02   +4.169067401427954e-02   +1.024482095507374e-02   +6.240821902622497e-02   +4.703525613771695e-02   +2.735973328320092e-02   +7.110798300406429e-02   +6.430331739426631e-02   +4.624629274975824e-02   +7.089111791337895e-02   +1.879992763511294e-02; +6.517358153070368e-02   +8.752620644783247e-03   +5.049291420582283e-02   +1.037157272745506e-02   +4.911119548778285e-02   +4.942131463368153e-02   +5.441903295457192e-02   +2.172558085347796e-02   +6.652180579616676e-02   +7.662162177745337e-02   +2.488240110680824e-02   +7.227281705292496e-02   +8.439324437349188e-02   +5.534985677862487e-02   +3.151313900272831e-02   +1.002852834692717e-02; +2.447326168333517e-02   +2.458863867433709e-02   +2.466852189686871e-02   +1.085858302122500e-02   +1.737482460653502e-02   +7.511180060719820e-02   +7.984780927522334e-02   +6.524589358612777e-02   +4.186794058461416e-02   +5.677340123234892e-02   +8.424697767445836e-02   +6.537749781152477e-02   +5.536764727311604e-02   +7.143827892722174e-02   +5.575620441443596e-02   +6.232999018279967e-02; +3.916759151584189e-02   +2.018487267106517e-02   +4.086541488340450e-02   +7.188231600221838e-02   +5.150608751678860e-02   +4.818670961008886e-02   +1.127712210504695e-02   +3.104307296828883e-02   +1.108818301791097e-02   +4.826838352298866e-02   +2.780993708871156e-02   +3.886850095398839e-02   +2.958482196159418e-02   +2.127829258498897e-02   +1.056929962758205e-02   +2.417740510572349e-02; +3.496858098075373e-02   +3.248405561720736e-03   +1.569728041821164e-02   +8.342774862112168e-02   +8.711010385072679e-02   +7.138048784923020e-03   +1.882675287439003e-02   +7.793890222748957e-02   +7.633550910546356e-02   +1.026131133616673e-02   +4.799095560009408e-03   +5.454568870120261e-02   +5.878057760034748e-02   +4.617243283538160e-02   +3.951130037728964e-02   +4.173847356173691e-02];
L2I_L1I_iGABA_netcon = [+8.790830656270329e-02   +3.995658112867819e-02   +3.333900498521761e-02   +7.770532804555744e-02   +8.805665179015598e-02   +8.020300637200388e-02   +3.408997553852817e-02   +6.891020494447954e-02; +7.178350550654548e-02   +7.140758363914096e-02   +6.266261194866184e-02   +2.543951139891910e-02   +3.588072255059211e-02   +5.558074413209828e-02   +7.991474412330830e-02   +2.281944591660405e-02; +1.692569793187742e-02   +2.038066850630220e-02   +2.096623450618560e-02   +3.410273228678901e-03   +7.101717990864399e-02   +8.291471227910796e-02   +7.281351987930255e-03   +5.553564753999405e-02; +3.414908666133435e-02   +7.039491349152480e-02   +6.237764095393242e-02   +5.644409517974368e-02   +5.555554401135017e-02   +4.949113628540373e-02   +4.281222704091164e-02   +6.962679416136035e-02; +3.002135633067139e-02   +9.958176984543486e-03   +5.716187521192563e-02   +5.332270015323131e-02   +3.565222498704770e-02   +6.280199197172821e-02   +4.158717591226909e-02   +4.689542803764212e-02; +6.869935519007063e-02   +5.946942190847650e-02   +8.379487062741664e-02   +4.511212438655434e-02   +2.184482189146051e-02   +6.091921739840082e-02   +3.327287078519230e-03   +6.251671257333827e-02; +8.504668150766613e-03   +3.915055261727664e-02   +3.962125863906357e-02   +2.517286925781238e-02   +6.783228279188480e-02   +2.687659172608903e-02   +1.953077258899423e-02   +6.333581376307222e-02; +5.396110055899435e-02   +2.753897479036136e-02   +6.909943894955763e-02   +3.796109651840805e-02   +2.337175181951764e-02   +6.519754203936454e-02   +4.008827571179125e-02   +2.785419895725079e-02; +4.119325190723863e-02   +6.163683004146999e-02   +1.730355293955001e-02   +1.788648233560517e-02   +2.913895628513425e-02   +1.536166968136305e-02   +4.053684611714045e-02   +9.053246166523156e-02; +5.128050553088241e-02   +5.885609986033855e-02   +1.951816202903509e-02   +4.055743728634459e-02   +7.206163683042012e-03   +6.326263198572855e-02   +8.045914175927615e-02   +6.076233777594556e-02; +4.469689882942710e-02   +6.997105303149541e-02   +7.180853874719549e-02   +2.769524117899632e-02   +6.303709024576688e-02   +7.884229875092950e-02   +1.445586788329639e-02   +2.343582037385543e-02; +7.483680737462389e-02   +4.693670048340536e-02   +5.625337774801904e-02   +3.793843471977069e-02   +7.727945973823934e-02   +1.922499102655261e-02   +5.381398275088214e-02   +2.882347235924911e-02; +2.987677504391147e-02   +8.669350400655260e-02   +7.848628418891553e-02   +9.262931945259845e-03   +4.823590187502785e-02   +3.249938262471823e-02   +2.899458302273740e-02   +5.139785390422764e-02; +6.783483401584652e-02   +2.116333879318716e-02   +8.753149117045522e-02   +4.505531492952174e-02   +7.674449202204843e-02   +1.927487338930392e-02   +8.331747770329420e-02   +1.995255211267056e-02; +8.988670475040030e-02   +1.952283126431210e-02   +2.464784384958539e-02   +8.289618197379432e-02   +5.724470986290177e-02   +1.195427630969959e-02   +3.606702800327430e-02   +6.109289412921686e-02; +1.620904881075417e-02   +6.135177158626927e-02   +5.908381025283239e-02   +5.739816629719129e-02   +7.731506532186361e-02   +1.438625682458194e-02   +8.696513145120739e-02   +2.828776911369653e-02];
L1I_L2I_iGABA_netcon = [+5.191932416660953e-02   +6.297727080508336e-02   +1.794897054729202e-02   +5.596860239597776e-03   +4.915701276085314e-02   +2.685112213821110e-02   +8.755964388142790e-02   +5.757355340233906e-02   +3.815960311175123e-02   +7.027050113471445e-02   +1.576714325134137e-02   +2.463197154516240e-02   +1.182789703014154e-02   +5.116267309330004e-04   +1.702424231680612e-02   +7.335646273324145e-02; +6.619011113224896e-02   +5.639421323550879e-02   +3.349426007553116e-02   +4.607036156838717e-02   +8.827650021327606e-02   +4.154975432368190e-02   +5.512480470000355e-02   +8.213606429907086e-02   +4.653750599760983e-02   +8.555119114262327e-02   +5.973604021720264e-02   +3.237061726298725e-02   +4.541414484654938e-02   +7.450739778984338e-03   +2.063063064527514e-03   +7.927415832135058e-02; +7.807942180157007e-02   +5.254284526960534e-02   +1.612336076401128e-02   +6.972538057512019e-02   +3.083576849285836e-02   +7.908007616768446e-02   +6.109273533820003e-02   +5.644466735949975e-02   +3.069887596368667e-02   +3.913051275636344e-02   +5.329525703272955e-02   +3.948016997071234e-02   +2.910961499319026e-02   +1.262990898151438e-02   +5.204089326481385e-02   +1.635012105924430e-02; +3.833246462860049e-02   +1.485081745140297e-03   +5.333139128827831e-02   +7.005726897337776e-02   +1.461377196928021e-02   +5.131226342891948e-03   +3.206868715866616e-02   +2.570532254419413e-02   +3.411136000297758e-03   +5.811935104508827e-02   +4.824683692204823e-02   +4.018801602738058e-02   +2.178063662004665e-02   +4.119132730768702e-03   +7.068937337126488e-02   +4.641483556371045e-02; +8.476601699874652e-03   +7.577355566585313e-02   +6.291827802014795e-02   +5.918315215056916e-02   +5.608784593405801e-02   +4.633292442362345e-02   +4.915239303333366e-02   +7.788703147017335e-02   +5.348754197235848e-02   +4.794287989969714e-03   +2.501979938997723e-02   -1.385664542801821e-03   +2.716526613501682e-02   +7.328659181578615e-02   +1.623367265256034e-02   +5.011287441401385e-02; +5.333202147625860e-02   +6.248301911082406e-02   +5.653635860420431e-03   +8.043626387753912e-02   +5.399216709593024e-02   +8.432881105051122e-02   +6.430390278923792e-02   +6.853624106920930e-02   +4.911728055741080e-02   +5.023265247421359e-02   +8.615760756940095e-02   +6.816943475027674e-02   +1.197710313986389e-02   +8.379559002530554e-02   +5.936745033052402e-02   +8.153321758856522e-02; +7.226701853475340e-02   +1.091450668253576e-02   +7.759731239531369e-02   +8.699070111006540e-02   +3.653423053314280e-02   +8.993154560705674e-02   +4.678846028546618e-02   +3.927540519558829e-02   -7.069335010822255e-04   +4.914476311485527e-02   +2.997016957793381e-02   +2.931034228354763e-02   +6.706349112071323e-02   +3.463197563968898e-02   +7.410706337004760e-02   +5.044804750811247e-02; +6.058003169756240e-02   +7.622847147115790e-03   +7.411375801172326e-02   +6.334830600138452e-02   +4.363934431375885e-03   +6.589037821434277e-02   +5.307270326112822e-02   +7.136411061510817e-02   +3.609685197188914e-02   +7.643106800496070e-02   +2.295561183405655e-02   +4.429402742385071e-02   +4.213306108759118e-02   +6.703917741247780e-03   +7.756802507211927e-02   +2.165140270621714e-04];
L2E_L1E_iAMPA_netcon = [+7.187690294057943e-02   +2.761903283047421e-02   +1.115695596575940e-02   +9.031022122846739e-02   -3.875005925519205e-03   +3.952541406848463e-02   +5.623838285795983e-02   +5.706227387475894e-03; +8.309908739659456e-02   +7.983249504869280e-02   +5.233916195585163e-02   +3.261108420644872e-02   +4.360762130799014e-02   +1.873665899714509e-02   +8.223656940209177e-02   +3.891035710531625e-02; +8.063198554155143e-03   +1.591892999501063e-02   +2.151310682317009e-02   +1.284945504407794e-02   +5.426334914961822e-02   +7.233727782823450e-02   +3.177779876689511e-02   +3.030984827161527e-02; +2.372432219145970e-02   +6.405477004670682e-02   +1.414708636137860e-02   +5.957084311318361e-02   +7.085729778950224e-02   +2.590331574959857e-02   +8.092931892225326e-02   +8.198360758644016e-02; +1.917195538251462e-02   +9.127876528662927e-02   +1.045552121577798e-02   +1.163205664654032e-03   +8.138459732354206e-02   +8.618704668384478e-02   +5.999221069265772e-02   +3.232792652362362e-02; +6.714050176506149e-02   +5.051269645439937e-02   +8.199296874280586e-02   +7.262761707017283e-02   +5.594752784018063e-02   +1.794170466557164e-02   +6.450694438867398e-02   +5.600031969207932e-02; +1.051875423472782e-02   +2.704026862131648e-02   +1.933342245950792e-02   +3.525735394594057e-02   +7.624259805892354e-02   +4.002357859354870e-02   +1.534008822397274e-02   +2.629180237143806e-02; +6.209727994907314e-03   +1.616020700595270e-02   +4.836921756985126e-02   +5.670581308173721e-02   +3.464517947604388e-02   +7.965308244071290e-02   +8.266229331390736e-02   +8.116770039831350e-02; +3.175047652443296e-02   +7.870145096184934e-02   -3.623003216086772e-03   +2.921037321856659e-02   +1.908265299172172e-02   +8.725927908136107e-02   +5.301916561069359e-02   +9.244953917916941e-03; +2.589435368210525e-02   +2.048068907341128e-02   +7.703370893742326e-02   +3.385592249961945e-02   +7.619258013492823e-02   +4.934976768381142e-03   +1.501397543463023e-02   +8.710143742272497e-02; +4.764607731207181e-02   +3.968891663582388e-02   +1.263530723395961e-02   +5.478609172598686e-02   +3.597930273266172e-02   +3.262873056382645e-02   +4.968913275250441e-02   +7.841157951879336e-02; +2.022168176192454e-02   +4.366094575976438e-02   +7.439534777845268e-02   +6.277825882068964e-02   +6.163457965732060e-02   +1.826348472155418e-02   +8.386582224868147e-02   +2.227453725656010e-02; +4.997830501677435e-02   +7.215660879426054e-02   +1.757360779286420e-02   +3.077649844858899e-03   +8.525156574729977e-02   +6.389307792432165e-02   +3.604456599155621e-02   +7.256814886430660e-02; +3.690435337616284e-02   +2.827065182509280e-03   +6.663704626049914e-03   +6.584901432850426e-02   +5.416762229874809e-03   +2.435581747978181e-02   +8.634714336079392e-03   +7.082771332047982e-02; +2.787794458716299e-02   +1.612816590220314e-02   +6.474767415024684e-03   +6.989442023706512e-02   +8.869973889757188e-03   +1.039585358841089e-02   +4.052521186192055e-02   +1.946874305936710e-02; +1.090960395346724e-02   +4.125748984995898e-02   +7.183829172447699e-03   +5.013114755770530e-02   +1.901732869426630e-02   +5.078063547849420e-02   +4.757436054716544e-03   +7.666633570682364e-02];
L1E_L2E_iAMPA_netcon = [+3.086257917098300e-02   +1.776163268520984e-02   +8.658781052249827e-02   +8.393117328839629e-02   +2.753289871657837e-02   +7.985337667213344e-02   +4.179095786322132e-02   +8.670882110582841e-02   +1.595623809738831e-02   +5.680116857485334e-02   +5.277249539050671e-02   +6.600767262605821e-02   +3.366686496226878e-02   +5.773317033041708e-02   +4.481656980111078e-02   +3.968579032350974e-02; +3.487762024056678e-02   +5.264971746622446e-02   +1.825595306592493e-02   +8.692239050869514e-03   +7.077344557026410e-03   +6.007653944317787e-02   +5.231281485294347e-03   +2.817373154898892e-02   +2.345927331353042e-02   +2.727841762312003e-02   +1.952635937856880e-02   +8.820212439325488e-02   +1.202414543814214e-02   +1.992877914863719e-02   +5.259331861207056e-02   +2.455152142648545e-02; +3.437572442596880e-02   +5.537299810897581e-02   +7.562969202584822e-02   +7.917147408124928e-02   +8.383373414080340e-02   +9.095626019668396e-03   +2.815153883997727e-02   +2.281216266985291e-03   +3.702561183759481e-02   +5.631776997643641e-02   +3.012074952678148e-02   +1.654654794516138e-03   +5.807431395049696e-02   +5.223506869635822e-02   +7.674121804895143e-02   +6.057288904429694e-03; +6.215228291933542e-02   +5.439692174655572e-03   +1.855614705953660e-02   +1.539629274566773e-02   +6.303171460217907e-02   +2.716415832783050e-02   +8.423854561824656e-02   +7.998295596501999e-02   +7.034009476112503e-02   +6.710294676826602e-02   +4.116283044607463e-02   +4.815514973509163e-02   +8.522725890812795e-02   +2.706067117895716e-02   +7.958999888388038e-02   +8.238023090587818e-02; +1.475768260349732e-02   +8.801082437729150e-02   +7.555953449662588e-02   +4.695486508199924e-03   +1.688639592858154e-02   +6.735774173184651e-02   +7.485820863173916e-02   +1.694849333503269e-02   +4.797162351794057e-02   +3.604704902157231e-02   +5.064881624019978e-02   +6.625293998118532e-02   +2.528080285454127e-02   +5.310788026733228e-02   +8.598784262559597e-02   +2.411606774027742e-03; +4.987325558337117e-03   +7.979377333223765e-02   +2.979407441010900e-02   +7.614810176518648e-02   +8.827924365063372e-02   +7.761341018289242e-02   +4.101531368929694e-02   +7.923169320116032e-02   +2.799567268928814e-02   +3.727633406778099e-02   +7.683318137553398e-02   +8.125947715113457e-02   +7.366185627477412e-02   +5.408255511231975e-02   +1.343311209510036e-02   +5.125281658029793e-02; +2.685997172001132e-02   +1.513054119628760e-02   +5.642773963262905e-02   +4.558951860160843e-03   +3.782414005512443e-02   +4.369871646946939e-02   +6.862488376819410e-02   +5.310447055825868e-02   +4.701100107992018e-02   +7.245605493829149e-02   +5.745355722647803e-02   +8.401289986363161e-03   +3.817507515252803e-02   +4.955217589774254e-02   +1.897447270690672e-02   +2.665046356930988e-02; +5.751953909662930e-03   +4.598627164822917e-02   +4.261242333935025e-02   +3.461197763109525e-02   +6.179078818693601e-02   +8.900536419884876e-02   +8.425387052600260e-02   +5.303710622513026e-02   +7.768774517395603e-02   +3.848312157609019e-02   +3.122756883297067e-02   +8.853498354918077e-02   +6.027799675497852e-02   +7.346416914794801e-02   +2.424972858135923e-02   +1.363595962661826e-02];
L2I_L2E_iAMPA_netcon = [+6.011785500056985e-02   +2.732001807874896e-02   +7.597248947504112e-02   +3.924127131550309e-02   +7.045891532001627e-02   +2.779647435868240e-03   +6.943003256110792e-04   +7.870615027708781e-02; +1.122974229622050e-02   +1.594130420748004e-02   +1.502711790765037e-02   +6.753928449194840e-02   +6.943313731735487e-02   +3.349227298185865e-02   +6.270444803985338e-02   +4.298677246658029e-02; +7.514910396220856e-02   +6.813857389103727e-02   +7.431650614759039e-02   +5.998379315153625e-02   +4.341476096259516e-02   +4.888206317440624e-02   +4.136724026089172e-02   +6.271242997036237e-02; +3.578436773751591e-02   +1.782771524654628e-02   +7.841501067999668e-02   +3.826092084704248e-02   +8.856947948782511e-02   +1.236907264132637e-02   +4.272486715374203e-02   +7.847610370106863e-02; +5.424413055636117e-02   +7.986490618348586e-02   +5.053218323138864e-02   +5.066594706116824e-02   +8.241443520182130e-02   +7.086371413088932e-02   +3.868320391723113e-02   +6.638774998001494e-02; +4.827922769173575e-02   +1.819342227389958e-03   +7.716598055646458e-02   +6.371764458969650e-02   +5.281309962450634e-02   +1.753360896128775e-02   +1.236552405815119e-02   +5.997555221240503e-02; +8.949288068413866e-02   +4.146815854824024e-02   +9.123993564359438e-03   +3.105414123714137e-04   +1.342789747569588e-02   +2.161454760978827e-02   +1.626298279751583e-02   +2.184293339221683e-02; +8.314090198754018e-02   +2.421401648031751e-02   +4.992844405383427e-02   +4.695152768603601e-02   +7.446657764570989e-02   +2.534302095433359e-02   +8.184909858417190e-03   +8.613820324524105e-03];
L2E_L2I_iGABA_netcon = [+7.913202503552993e-02   +1.454934089551160e-02   +1.439566501622757e-02   +1.350967449300496e-02   +5.609196033833777e-02   +3.414586538105096e-02   +7.100796711935181e-02   +7.936522063743694e-02; +2.395640887209718e-02   +3.463772759056766e-02   +1.461974226737500e-02   +8.068179526878982e-04   +8.627090584513711e-02   +6.300344264782871e-02   +6.775346612942511e-02   +4.490757356136708e-03; +6.298509093362466e-02   +3.183981294339897e-02   +4.980582232596711e-02   +7.768214581767313e-03   +3.086951802857504e-02   +5.976008597800985e-03   +8.196274448191711e-02   +7.309081938703194e-02; +7.189700545772362e-02   +4.757753887671558e-03   +2.271260944226308e-02   +6.717091053319044e-02   +7.861084506528124e-02   +6.096485949010341e-02   +3.908977404962279e-02   +5.525650472093976e-02; +1.320833559163572e-02   +7.684908173084257e-02   +3.344531125306208e-03   +7.335997574273644e-02   +2.976146841010517e-02   +3.217583905037725e-02   +1.585415174042129e-03   +2.130192749557430e-02; +6.252343892730075e-02   -7.965965182788659e-04   +4.390089846474206e-02   +6.883593302090120e-02   +8.318478820032382e-02   +2.437217601010637e-02   +7.866045961835906e-02   +6.971837597271199e-02; +1.389524901701317e-02   +8.899588922651380e-02   +2.592700393492160e-02   +9.571732104376899e-04   +6.887776353881959e-02   +4.065068565219838e-02   +5.155424537313626e-02   +4.883421580948059e-02; +7.300136625630034e-02   +2.926826198366426e-02   +4.793519288506119e-02   +1.640372522096530e-02   +3.525868577098597e-02   +6.936203224620967e-02   +8.526752546966231e-02   +5.740117648535346e-02];
L3E_L2E_iAMPA_netcon = [+3.271819676430062e-02   +5.782255955136386e-02   +6.532263354191221e-03   +7.297197666272041e-03   -1.419659473065072e-03   +8.142215519931476e-02   +3.299947856352304e-02   +7.850776891471527e-02   +1.310560375844701e-02   +2.178429811483286e-02   +2.481137572244255e-02   +6.992971624966685e-03; +2.650359248181558e-02   +7.910789719701475e-02   +2.592273219364610e-02   +3.090432281116703e-02   +4.199258283189919e-02   +4.695472235375063e-02   +7.856624428549148e-02   +8.907889279999609e-02   +5.365164487168494e-02   +8.305646923366485e-02   +2.763331209840461e-02   +2.362259384241798e-02; +9.609071417083679e-03   +7.024505645721298e-02   +1.527286721492126e-02   +6.666363229701118e-02   +1.141688537062029e-04   -5.454808263563735e-04   +4.874287302644571e-02   +8.690008846086471e-02   +5.400733400235931e-02   +4.817956458506842e-02   +2.561056567403533e-02   +5.780483828219832e-02; +3.271286706808708e-03   +2.081429896219650e-02   +7.180658405306213e-02   +2.904894648434927e-02   +2.340954547731983e-02   +1.405788454583031e-03   +3.033239825639777e-02   +2.501686732604600e-03   +1.554485296012994e-02   +3.038688784296789e-02   +1.813876020626464e-02   +2.911274462189254e-02; +7.883994935730364e-02   +3.478565505341316e-02   +3.053765321970356e-02   +8.083567205615035e-02   +6.019290612620867e-02   +3.288784240909007e-02   +8.524079169894423e-02   +1.563462321227000e-02   +7.395702810256470e-02   +3.966770277074690e-02   +6.247724314893099e-02   +3.187924299009515e-02; +7.801542110150748e-02   +5.623135745080093e-02   +6.862210138154230e-03   +3.999147255841909e-02   +5.446771602625276e-02   +9.179819551217853e-02   +8.043259706116251e-02   +2.939695242754711e-02   +4.278650840403366e-02   -4.654490468349181e-03   +5.558089584669287e-02   +1.881446401504392e-02; +5.380603147914895e-02   +4.117231436582885e-02   +5.704710899301968e-02   +2.402408849481051e-02   +1.022702846861337e-03   +3.474285126180753e-02   +1.253672900000326e-03   +2.901837424671572e-02   +2.785538563685614e-02   +8.401027325242014e-03   +1.919359008692924e-03   +3.516366041729127e-02; +7.507700636421996e-02   +1.479878549750572e-02   +1.975648048277471e-03   +2.697962012303833e-02   +4.531732453597170e-02   +9.181916415637148e-03   +4.566272365143227e-03   +4.117379756604125e-02   +4.511429867657167e-02   +7.682508028401197e-02   +7.763957814185384e-03   +5.253765393384671e-02];
L3I_L2I_iGABA_netcon = [+8.836285690643951e-02   +5.077197052393842e-02   +5.440420677537088e-02   +3.063214593189834e-02   +8.335216402883065e-02   +3.356229385315636e-02   +6.922193937319012e-03   +2.456005442049796e-03   +7.795472276112513e-02   +3.975332166154263e-02   +5.206129088227742e-03   +7.117720733791576e-02; +7.864551032618940e-02   +8.256395947202584e-02   +7.155171441192069e-02   +1.351636942712143e-02   +4.120917483545944e-02   +7.134512933636397e-02   +5.377769132958090e-03   +1.282891567229473e-02   +4.240476094542513e-02   +6.136366321547663e-02   +8.944426011057343e-03   +5.658017744193922e-02; +7.755078747465062e-03   +7.429640375272531e-02   +8.533770820936991e-02   +1.735074580823448e-03   +5.815289733778303e-02   +2.792259989003307e-03   +5.529032822312466e-02   +7.961315270736671e-02   +6.291241028751395e-02   +3.368542978025431e-03   +5.794305326591397e-02   +1.219259304783252e-02; +8.851580911126118e-02   -1.772973259907850e-03   +4.736682329960990e-03   +6.022694900659386e-02   +7.766091911898600e-02   +4.995477323481200e-02   -1.434422617259938e-03   +6.804619593264719e-03   +8.018170761254517e-02   +7.155685623097854e-02   +8.731397920390631e-02   +4.594344360926597e-02; +1.934395707619550e-02   +8.882396407490355e-02   +3.520841216918001e-02   +3.731764239603350e-02   +5.088020562715539e-02   +8.485001336250236e-02   +3.196302468692115e-02   +1.448156408902507e-02   +8.763288619017480e-02   +4.383441471546440e-02   +2.557595838745151e-02   +1.397998582305673e-02; +1.181134256032788e-03   +6.098721466604811e-02   +1.824345865440109e-02   -1.565260268132059e-04   +1.256154561531942e-02   +5.743624221765968e-02   +6.657806027986625e-02   +1.909608137585854e-02   +5.939282807767235e-03   +7.028317307296328e-02   +7.125857487164902e-02   +3.932661959711540e-03; +5.693342858579011e-02   +8.080080868779221e-02   +4.802277951653165e-02   +5.780100827362519e-02   +4.162060852666701e-02   +2.398868095720799e-02   +5.902528976176315e-02   +3.134041361261908e-03   +8.000396044879954e-02   +2.924072680421590e-02   +4.110530965943977e-02   +6.728928595630693e-02; +4.233252680418181e-02   +1.842236002969048e-02   +3.135249755819081e-02   +5.101550450375976e-02   +3.200318678550493e-02   +1.278470039814931e-02   +2.025829552718357e-02   +2.499735252615358e-02   +4.976571781179678e-02   +8.664748364647466e-02   +2.228436179706165e-02   +2.436161077020233e-02];
L2E_L3E_iAMPA_netcon = [+5.468771589778839e-02   +5.999032968154881e-02   +2.227146460508582e-02   +7.174064374767102e-02   +6.105654311024686e-03   +4.685577312712982e-02   +6.250754050670576e-02   +8.590301628565623e-02; +4.395364186525141e-02   +5.969653598348917e-02   +6.538575403966364e-02   +7.106497005030007e-02   +1.368884332587420e-03   +4.955203784957035e-02   +7.173449145681352e-02   +5.538322045861644e-02; +6.827371244031993e-02   +7.796112351019927e-02   +7.452611458175748e-02   +8.680220019921535e-02   +5.416584330580557e-02   +6.014785856297755e-02   +7.723364314433419e-02   +5.174243328535068e-02; +3.477637258919878e-02   +8.417915221281415e-02   +7.331851954896589e-02   +5.589486835615191e-02   +4.264007600922209e-02   +4.706593821191184e-02   +2.337192001528074e-02   +1.088802980888396e-02; +7.349765603673091e-03   +4.775371660171179e-02   +2.596178136816857e-02   +2.505342641442356e-03   +1.155474665461357e-02   +4.715836011355073e-02   +7.668228543737966e-02   +7.060089993636773e-02; +4.477460969261778e-02   +9.287137619365074e-02   +7.736280732673051e-02   +4.908550570124450e-02   +4.601745798307820e-02   +8.527923780347116e-02   +6.038787893929634e-02   +8.708585664068466e-02; +4.568994477787747e-02   +7.273117000909661e-03   +4.606352603010467e-02   +1.830807727597358e-03   +3.023164623415099e-02   +7.240565189302828e-02   +3.298245488978595e-02   +6.826516939904319e-02; +7.701239838545135e-02   +6.035919346738340e-02   +4.277360200376826e-02   +7.043901756121938e-02   +3.385854897035327e-02   +6.853401585918273e-02   +4.342172744937572e-02   +3.023072564761593e-02; +4.000674933208385e-02   +4.661381305627622e-02   +8.430312961146483e-02   +5.282889553946125e-02   +5.149320682700834e-02   +3.107348834346424e-02   +4.903869166872874e-02   +5.768139621146792e-02; +1.770820706211104e-02   +1.494100015130088e-02   +7.016759586520217e-02   +7.603227209463025e-02   +8.490866120059069e-02   -1.877906245204559e-03   +9.245463389760700e-03   +5.566214118453135e-02; +5.469010135982694e-02   +2.256923693171457e-02   +6.715133272844112e-02   +7.003414979984790e-02   +8.025231008286603e-02   +9.310845608374403e-02   +2.040402437281536e-02   +2.882587736935770e-02; +1.133659031384838e-02   +4.932048620701435e-02   +3.667846231048214e-02   +7.800122654778902e-02   +4.435874455637806e-02   +1.566870853420664e-02   +5.457238029045203e-02   +7.692431095491721e-02];
L2I_L3I_iGABA_netcon = [+8.379610873312440e-02   +3.616691605408807e-02   +1.928568068365133e-02   +6.118035801246399e-02   +6.862624454385761e-02   +7.833387195165366e-02   +8.286129427610943e-04   +4.449056427268593e-02; +4.468561631123843e-02   +3.936936646538258e-02   +6.741751680358785e-02   +1.475610561804241e-02   +7.571819977321791e-02   +7.317749712316177e-02   +4.446695107118265e-02   +2.491669221127092e-02; +6.698412422315775e-02   +6.317716471783492e-02   +8.216408310728503e-02   +5.087072832979119e-02   +3.281283630939368e-02   +5.633572884457427e-02   +4.063545171285543e-02   +1.444687828613321e-02; +1.984841128878389e-02   +7.139970765550423e-02   +2.034343625098305e-02   +3.923727332415192e-02   +4.133232514037660e-03   +2.531378516487099e-02   +3.613667426599919e-02   +9.219355496778558e-02; +2.873302469027709e-02   +3.030839576746030e-02   +4.690665618184727e-02   +4.051735946152440e-02   +3.661870638958596e-02   +5.707901861954848e-02   +1.149019029748290e-02   +1.363936830698025e-02; -1.494699052540302e-03   +2.245665601583000e-02   +3.312619395263267e-02   +1.323999001549941e-02   +3.110147875470534e-02   +3.890985378285805e-02   +4.891308327433685e-02   +6.685495447904524e-02; +3.367207578002863e-02   +4.355952667845996e-02   +8.271362882256665e-02   +5.804460047466797e-02   +6.917290585451027e-02   +2.796705801179373e-02   +3.019207071923758e-02   +3.115151558793771e-02; +3.061604748772692e-03   +8.935984807833335e-02   +2.549422303330359e-02   +7.301541737668175e-02   -1.171056765466076e-03   +6.436488546060623e-02   +4.559155793399838e-02   +6.994769154764145e-02; +7.836285102475748e-02   +3.125421130313269e-02   +7.452793399271106e-02   +5.961192263642879e-03   +4.626293972336490e-02   +2.838704369653481e-02   +3.319581401722532e-02   +3.928782560480216e-02; +6.640587290195132e-02   +4.777798332477019e-02   +1.690318901166365e-02   +4.609971972694645e-02   +5.664712275521880e-02   +2.917582589633631e-02   +1.695459190814228e-02   +2.887082176557209e-02; +6.820605587966828e-02   +8.432383415071085e-02   +5.239124716278498e-02   +5.655368460603148e-02   +3.032620970596260e-02   +3.839845237926148e-02   +7.947002916275213e-02   +1.206124939232821e-02; +5.980517696543897e-02   -5.094852559439537e-03   +3.396904367346005e-02   +1.818347099624826e-02   +9.020024593371243e-03   +8.846408703814590e-02   +4.615664060433429e-02   +5.039615826518997e-02];
L3I_L3E_iAMPA_netcon = [+4.305438237412541e-02   +8.731359005378519e-02   +2.272681657557383e-02   +4.906958892344365e-02   +6.857331947113611e-02   +3.414762611624829e-02   +2.827106065141062e-02   +1.997036420207578e-02   +2.969858852898902e-02   +2.517626874266991e-02   +1.966807072305061e-02   +6.269680139001844e-03; +3.167047275831975e-02   +7.125411554495542e-02   +2.596439919456522e-02   +5.965892124558399e-03   +6.539082296636066e-03   +5.162791718478273e-02   +5.268599592635014e-02   +4.213131867840698e-02   +1.663865317965879e-02   +4.345807631957638e-02   +6.503747597975042e-02   +4.555186743905407e-02; +2.140496099236182e-03   +5.166942872592710e-02   +4.537928245925409e-02   +5.143550219842177e-02   +4.438585295061583e-02   +4.021319471924478e-02   +4.279016665578821e-02   +4.227815027680907e-02   +4.027507120888775e-02   +5.016655235310841e-02   +3.639489032017594e-02   +4.850774505960843e-02; +3.545292980380541e-02   +6.987775000081579e-02   +5.845513547006410e-02   +4.307966513675930e-02   +3.912401069373756e-02   +8.105150050204397e-02   +6.862880254649213e-02   +1.538695557498700e-02   +8.113542447161817e-02   +7.956793248674512e-02   +1.987586868142815e-02   +6.366042688200192e-02; +1.132358709950762e-02   +3.667671081000365e-02   +5.635007298245630e-03   +7.508462720633263e-02   +7.244557600059530e-02   +5.126792190429313e-02   +8.749733796437213e-02   +7.561145509956273e-03   +8.871101467579885e-02   +5.322652167927307e-02   +3.143359663187579e-02   +1.318875155019232e-02; +3.365899254442019e-02   +4.978161455213580e-02   +7.208764940475200e-02   +4.193321679923594e-02   +8.726179064088124e-02   +5.290504063455246e-03   +7.531252428444259e-02   +2.912817413078146e-02   +6.264529765374868e-02   +7.674348795559163e-03   +3.211563115058347e-02   +1.597515075074358e-02; +6.844072293111467e-02   +3.399922125293720e-02   +3.280155603536097e-02   +2.379008849669392e-02   +5.675884603294930e-02   +1.056954738884944e-02   +4.909602985671509e-02   +8.272901648935498e-02   +7.491297715198145e-02   +8.775519212814789e-02   +4.850899114058457e-02   +6.285832235641930e-02; +6.347689144500204e-02   +1.856222306885089e-02   +6.139227591127810e-02   +5.922615443781997e-02   +8.683066373079747e-02   +5.002041383006426e-02   +5.843963055562665e-03   +4.304402222830773e-02   +4.056730664909743e-02   +2.523682817937769e-02   +2.071699605102136e-02   +8.342128512803686e-02; +1.103935130625945e-02   +7.743540522253614e-02   +6.199815666733459e-02   +6.780544194325876e-02   +3.338866212471964e-02   +7.124129668982543e-02   +1.429794715664843e-02   +7.210987198759264e-02   +7.220610131703033e-02   +4.119759932375811e-02   +2.327516660554293e-02   +1.520186476909286e-02; +7.560339958237804e-02   +7.639474147257554e-02   +3.851700541750386e-02   +2.046861436310895e-02   +4.673391422720681e-02   +7.380827587348339e-02   +5.134757568688302e-02   +8.225827405354362e-02   +6.570352824536679e-02   +3.551070432343287e-02   +7.646820046156329e-02   +2.005845506613183e-02; +4.219881564156375e-02   +3.233774955071124e-02   +8.614468323002673e-02   +8.156927938738023e-02   +4.683759326672197e-03   +5.188559230542272e-02   +2.898613589096717e-03   +2.314366346198964e-02   +4.622103197986773e-03   +8.100056651688531e-02   +6.789739525399122e-02   +3.470315817716393e-02; +1.859660422931738e-03   +1.422224774161455e-02   +6.289824046082922e-03   +4.158465482030552e-02   +4.308912502578485e-02   +2.178345205427847e-02   +7.163346063787950e-02   +1.624165877057975e-02   +2.777562728302439e-02   +2.001138050969876e-02   +6.876873040080951e-02   +2.997274804030087e-02];
L3E_L3I_iGABA_netcon = [+9.845460368730234e-03   +3.611475394550597e-02   +2.560587314697492e-02   +8.213520220484556e-02   +6.879775843567487e-02   +4.980573838980016e-02   +2.912551340972500e-02   +6.717805411068728e-02   +5.082477889553358e-02   +5.921100662415373e-02   +5.077116996296191e-02   +2.172881855871147e-02; +6.845603474764549e-02   +5.922369165145769e-02   +3.128477011928988e-02   -8.321827445709566e-04   +2.894114735272458e-02   +6.596409295252126e-02   +5.676212487662684e-02   +8.846310781125717e-02   +7.291329480992460e-02   +3.522912827588848e-02   +1.301961479527651e-02   -2.217703888956131e-03; +4.873917551619796e-02   +8.934730777761188e-02   +8.947434707668601e-02   +7.448104479315798e-02   -4.827721034774827e-04   +6.630132072436896e-02   +5.233196410734300e-02   +6.075586338943177e-02   +3.880941938980823e-02   +3.507674305740678e-02   +2.331383679476077e-02   +8.988766182240333e-03; +3.413829740718990e-02   -7.371784041409349e-04   +1.799148666870207e-02   +6.856285751486874e-02   +6.722630846710330e-02   +2.786687319137524e-02   +3.821075640198020e-02   +3.446928452675432e-02   +8.508304650957423e-02   +4.026215535407317e-02   +6.065942970719234e-03   +6.165599008680802e-02; +3.974291632899658e-02   +3.813083891539978e-02   +9.308876938414436e-02   +1.862889904364599e-02   +4.622410919038474e-02   +7.434464754364714e-02   +9.020286076331729e-02   +8.289159883806205e-02   +2.278614313942516e-02   +5.343587557722926e-02   +7.757310448337568e-02   +1.653442526794744e-03; +6.195185809095351e-02   +3.919940430291973e-02   +7.320440080440387e-02   +1.219595538429358e-03   +7.176164556912827e-03   +8.911076602289845e-02   +4.683182685778244e-03   +1.725325333293688e-03   +7.109923961674343e-02   +5.552639897173442e-02   +1.871302583159472e-02   +2.247720962328578e-02; +4.956875991956634e-02   +3.281604734904563e-02   +4.818110540070663e-02   +5.080087389070509e-02   +5.623357534600738e-02   +4.554562568379186e-02   +3.327770879559798e-02   +2.740718555779297e-03   +3.450907669962223e-02   +1.217977801636668e-02   +2.951495311998911e-02   +6.048216986265995e-02; +2.259096280166862e-02   +7.190262842359959e-03   +1.140724850527855e-02   +8.415197218177019e-02   +3.937172649951936e-02   +7.234625751145891e-02   +4.374546729394391e-02   +6.755618413399980e-02   +6.807290993959400e-02   +7.918297259394103e-02   +1.441716495524638e-02   +5.904584000004088e-02; +2.212013992326332e-02   +1.760956264362460e-02   +7.163134841325165e-02   +3.003601287970535e-03   +8.966036907375885e-02   +7.796173278043798e-02   +1.507253754799055e-02   +6.794437337375375e-02   +2.005463814520244e-02   +3.122250361507013e-02   +4.259475572378946e-02   +5.422603737338978e-02; +6.892129389336993e-02   +3.127398751331129e-02   +7.734696652050600e-02   +2.708160772485160e-02   +3.704805552106633e-02   +8.650319379555393e-02   +6.351164548174747e-02   +4.987372783778774e-02   +7.816801426622508e-02   +8.157521895506135e-02   +1.830203543074440e-02   +6.271899490766461e-04; +4.696704886635929e-02   +1.437829625894326e-02   +2.101321704263668e-02   +2.058876609868865e-02   +6.435058661799631e-02   +4.381256137522661e-02   +8.206968343879197e-02   +5.783304473089229e-02   +4.717776463359656e-02   +1.631070276430747e-02   +9.100871664103219e-03   +7.109798275082549e-02; +5.648448709403069e-02   +5.039197384035701e-02   +8.509403270273960e-02   +5.968963981978612e-02   +3.638120637921394e-03   +4.566303118819939e-02   +8.535427702256829e-02   +5.372329057899685e-03   +6.835774736721732e-02   +3.404704777464441e-02   +4.407588521123817e-02   +3.329822119905972e-02];
L2E_Input1_iAMPA_netcon = [+8.842199827631382e-02   +8.708492484071120e-02   +8.801234834110640e-02   +8.806934831706506e-02   +9.298746853460543e-02   +9.546375211426192e-02   +9.048217976548097e-02   +8.620110388757141e-02];
L2I_Input2_iAMPA_netcon = [+8.572949371641152e-02   +9.143925772442511e-02   +8.998390153894262e-02   +8.961692290841858e-02   +8.366649678527104e-02   +9.155690312386255e-02   +9.018802173169568e-02   +8.005443316476628e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
