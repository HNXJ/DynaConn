function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.636959162948275e-01   +5.574436377488300e-01   +5.199684567830406e-01   +1.181102395093182e-01   +5.307931268732334e-01   +3.360380737846112e-01   +5.830086477447114e-01   +4.325146359585059e-01   +5.605297912457300e-01   +3.044406432168816e-01   +2.563108191325519e-03   +5.327901972406840e-01   +2.932173866953056e-01   +7.435723951978972e-01   +3.810096002297960e-01   +2.255417949372467e-02; +1.570518760810476e-01   +2.979071264958178e-01   +2.590405685793413e-01   +5.574479623953194e-01   +3.488338824358987e-01   +2.061185364195034e-01   +5.966559576041512e-01   +6.773558882518689e-01   +1.448597783463942e-01   +1.698356460574810e-01   +1.330489105485101e-01   +4.450418495765371e-01   +4.898308530864736e-01   +3.532184697852331e-01   +6.888914031091693e-01   +7.400839525804352e-01; +6.878877888832806e-01   +2.540448166774832e-01   +6.879787335997600e-01   +6.918412887464711e-01   +2.208556587038810e-01   +3.284500076807350e-01   +7.099588359526868e-01   +3.206332465930501e-01   +8.460689347311152e-02   +6.991031713055118e-01   +6.082029292536045e-02   +3.273426830095593e-01   +1.949774123525451e-01   +7.081331212739188e-01   +6.540138372544066e-01   +3.034037510154801e-01; +7.327571050289317e-01   +2.340425613564570e-01   -1.125154073677694e-03   +6.569609478182258e-01   +7.927202112871780e-01   +4.144714477027751e-01   +1.900315640972465e-01   +5.910272555124320e-01   +7.769478424875320e-01   +3.612510276538906e-01   +7.590947054373024e-01   +2.043052116028232e-03   +7.193411734653078e-01   +3.632610004392005e-01   +7.774740482927779e-01   +7.183796422784174e-01; +1.607890991828768e-01   +1.328788357400071e-01   +4.063425007892928e-01   +5.047988653471216e-01   +5.701500734347145e-01   +3.376552454337501e-01   +1.525949757887513e-01   +1.511778145376116e-01   +1.655869300536806e-01   +4.635266483007572e-01   +7.171846494935734e-01   +9.429009943889120e-02   +3.003448580352912e-01   +6.093196737159259e-01   +7.610460229636566e-03   +2.359346539795587e-01; +3.485672082545737e-01   +6.946628863558134e-01   +7.151273338493231e-01   +1.922876491588416e-01   +9.639275319526384e-02   +4.854670929268975e-02   +2.259151863024232e-01   +3.052647436557459e-01   +5.373622813255727e-01   +6.912521172513068e-01   +3.210096384153270e-01   +9.615089985512384e-02   +5.308771613874852e-01   +4.022817145868074e-01   +1.881333643649286e-01   +7.463715305124305e-01; +3.728212685905413e-01   +7.032748278760624e-01   +6.810560560835321e-01   +2.349225754432959e-02   +6.798861016582263e-01   +5.428000374764418e-01   +4.350713721615398e-01   +1.066667704888730e-02   +6.605190784311039e-01   +1.824424520869636e-01   +1.197877275977124e-01   +3.260719017499663e-01   +8.228767338798082e-02   +4.783932403085036e-01   +4.427486484898825e-01   +6.019633738889465e-01; +5.985513372065726e-01   +2.414382307835662e-01   +1.089316662487290e-01   +4.842324153772541e-01   +5.716854303798717e-01   +4.193833959143051e-01   +1.654332791548152e-01   +4.959667504148090e-01   +2.419271356593912e-01   +2.114444238195768e-01   +5.759853590874863e-01   +4.937489049151209e-01   +5.726903516569394e-01   +4.037436903973261e-01   +1.644748822434995e-01   +5.895152816634490e-01; +5.802209774866450e-01   +5.447212547817544e-01   +4.953798575814864e-01   +2.456987129992211e-02   +7.041092056272863e-01   +2.289422011204849e-01   +8.077641740096172e-01   +2.770347796047386e-01   +3.637480384812129e-02   +2.823672075079090e-01   +2.339998811175205e-01   +4.634663201219230e-01   +3.194808721741889e-01   +5.430422550855611e-01   +5.868231088235574e-01   +3.794874713044452e-01; +4.113761315258934e-01   +6.243204144453945e-01   +1.215329565404176e-01   +6.411230786442064e-01   +4.734073868152505e-01   +5.832498675794858e-01   +5.612877163056341e-01   +6.569625747650731e-01   +1.513379363238155e-01   +5.282714553459205e-01   +7.090024764248405e-01   +1.505810211785885e-02   +4.394417303409173e-02   +5.125729738885479e-01   +1.472167282215491e-01   +2.886379923941276e-01; +3.544124848747632e-01   +7.211773186215200e-01   +2.390713314661256e-01   +5.044171411438798e-01   +5.109921460337230e-01   +1.531988091327505e-01   +1.916100399289030e-01   +4.081025326640393e-01   +5.639862820474459e-01   +6.692596437326359e-01   +4.685639717007613e-01   +6.666730292533060e-01   +5.010338097411191e-01   +6.263684882807453e-01   +3.239874627232150e-01   +5.254902400994472e-01; +5.175943188523588e-01   +1.399834529652113e-01   +2.696297931574929e-01   +7.842726339134785e-01   +4.063984337542645e-01   +6.121437309177457e-01   +4.056831768220878e-01   +1.892581111809067e-01   +6.412983957499039e-01   +1.014310484083859e-01   +6.947684469062922e-02   +3.624992811949691e-01   +3.988276527716650e-02   +5.502482496724164e-01   +8.193300399649606e-02   +6.506443099288769e-01; +7.480616351803966e-01   +5.709949667101272e-01   +4.735859033291482e-01   +7.316729433245506e-01   +1.693596162300149e-01   +4.937640539509006e-01   +5.505484736280866e-01   +1.270648759811335e-01   +7.339634734264080e-01   +2.363139161287938e-01   +1.358864864215253e-01   +7.742086213289517e-01   +3.672753122171720e-01   +2.513529163481431e-01   +4.569634866603128e-01   +6.387815793037546e-01; +8.752270345947065e-02   +7.461850323066366e-01   +9.568312207893394e-02   +4.849897600646942e-01   +4.078114688424459e-01   +5.942317995807486e-01   +5.673680009087939e-01   +4.450400323134313e-01   +6.117403246185729e-01   +4.133406319942916e-01   +5.606762763796229e-01   +4.038746283961703e-01   +3.675049759361602e-02   +1.968790755662953e-01   +1.249096937012202e-01   +2.898081768612042e-01; +2.173068192473315e-02   +3.966490350106984e-01   +3.572510232296142e-01   +5.631481417308480e-01   +3.731272517852438e-01   +7.891085189358770e-01   +8.361476677753638e-02   +6.558843798903927e-01   +3.307703597482857e-01   +7.976483452894007e-01   +2.377364917006149e-01   +3.665243373536591e-01   +3.084400400280541e-01   +8.064049434410422e-01   +1.076920796647096e-01   +4.217180611028270e-01; +5.252085933859972e-01   +1.377545638838977e-02   +5.885176152579449e-01   +6.334298011064818e-01   +5.883570677742237e-01   +5.057521476979027e-01   +2.694512977795586e-01   +1.402263428558770e-01   +6.588501450593574e-01   +5.696484891448370e-01   +5.384891920193487e-02   +7.041822008727644e-02   +5.386901677207808e-01   +7.035023703943079e-01   +5.555673096998749e-01   +5.679793866394523e-02];
L1E_L1I_iGABA_netcon = [+2.083864733166455e-01   +4.754854143359747e-01   +5.346499577815750e-01   +4.316929808385694e-01   +6.763222322367937e-01   +4.846555481070147e-01   +7.550874386968534e-01   +7.029901307200870e-01   +2.322813172884726e-01   +1.671965589395754e-01   +4.313852907729392e-02   +1.991782954915776e-01   +4.249209864943552e-01   +2.445130164198353e-01   +5.819314143176435e-01   +6.318169349665006e-01; +5.166181657779340e-01   +4.930647517733930e-01   +4.984977097582228e-01   +1.803223461035441e-01   +5.105790784246947e-01   +1.172511520651251e-02   +7.684636301515443e-01   +3.770002263588552e-01   +1.417698528145381e-01   +7.480619754486161e-01   +3.545325817915464e-01   +1.191849641824749e-01   +1.496747940176683e-01   +2.807795894840591e-01   +4.221232085315890e-01   +4.656373775748453e-01; +1.998228515292383e-01   +1.253580256503394e-01   +3.728481434449591e-01   +6.649346348174744e-02   +2.662995979650379e-02   +4.702304070613550e-01   +8.396034966237043e-02   +1.976464445727670e-01   +5.567162864068148e-01   +2.220218486630391e-02   +6.190513314266215e-01   +2.797478050499609e-02   +8.847219790015383e-02   +4.073325597927487e-01   +6.960919999328909e-01   +8.417587175839947e-02; +2.231652722945087e-01   +6.739166121453485e-01   +7.557779381752522e-01   +4.877413462260199e-01   +5.249602570273435e-01   +4.310626357677594e-01   +1.430720411174716e-02   +3.156889089094782e-01   +2.775147562346482e-02   +8.108736598436590e-03   +1.056971290159857e-01   +6.373825724819435e-01   +6.016464659325750e-01   +5.613273673426441e-01   +4.405807391769774e-01   +3.234125775484041e-01; +1.065034244310476e-01   +1.484467114921078e-01   +4.916816715039087e-01   +1.696106574531420e-01   +5.231114541207667e-01   +1.144500142373812e-01   +4.541042996804059e-01   +2.043919152467457e-01   +1.134621487367761e-02   +6.855455412642151e-01   +5.888458997596414e-03   +5.774377697367493e-01   +2.313010087068300e-01   +4.774612418052094e-01   +7.709500261739048e-01   +2.975648222444106e-01; +7.847643863235940e-01   +5.598691596776840e-01   +1.184685865146405e-02   +4.591607727544650e-01   +6.117119888990834e-01   +4.884409615657637e-01   +7.004754890871120e-01   +6.911902153853173e-01   +7.437757079793069e-01   +2.028819945744389e-02   +7.797490450714202e-02   +6.409876610426467e-01   +7.208850039145747e-01   +9.843704817286519e-02   +5.579669989018453e-01   +5.450596095912365e-02; +3.152936202153706e-01   +2.464768661098893e-01   +5.269611100133524e-01   +6.962092819468553e-01   +9.364488139100703e-02   +6.524724637869198e-01   +2.112099127665530e-01   +3.957992139704798e-01   +4.858344348493566e-01   +5.351572254038971e-01   +9.058932102357257e-02   +6.925130660838043e-01   +5.395061505810216e-01   +1.198326505834374e-01   +1.915191637904083e-01   +3.434337590865988e-01; +6.983409143788203e-01   +6.003813797633637e-01   +4.236492194348589e-01   +6.544762193407047e-01   +6.934463156398109e-01   +7.986468427457367e-01   +1.592156421690513e-01   +2.938652129533262e-02   +1.951874169993111e-01   +4.594893703203575e-01   +6.749479159911030e-01   +6.460289083212294e-01   +3.706460865492971e-01   +5.101195180869006e-01   +2.194726817616116e-01   +6.708099080812350e-01; +7.344961299598350e-01   +1.744805428276172e-01   +4.550974059420644e-01   +6.966906573641557e-01   +4.711541346685446e-01   +6.655495912547434e-01   +1.645466336338847e-01   +5.608920755530845e-01   +4.587241437448536e-01   +3.391359407914728e-01   +6.243995439907662e-01   +3.457425138756022e-01   +4.141238629981161e-01   +6.793165016644993e-01   +4.739863217241697e-01   +3.305831468319133e-01; +4.232943284637407e-01   +1.909246204391969e-01   +6.312758766162961e-01   +2.211979111434285e-01   +6.386135364567027e-01   +3.544939094215412e-01   +4.656604696806528e-01   +5.402595904343320e-01   +1.955269532746515e-02   +1.103748852325639e-01   +5.897076278573634e-01   +2.698524620335210e-01   +7.021124334817617e-02   +5.673198051551568e-01   +4.164688705218768e-01   +1.461050251025259e-01; +4.065639037924784e-01   +1.237851205261794e-01   +2.913464896537543e-01   +6.300924783126780e-01   +5.937077287876694e-01   +9.520456614498519e-02   +1.018610107020291e-01   +4.295839700543982e-01   +5.445243462519281e-01   +4.740772076400333e-01   +3.953012502863887e-01   +7.448323286254218e-01   +7.091124357705433e-02   +5.287409705559432e-01   +1.666448870791082e-01   +1.322784128687037e-01; +5.320422357764943e-01   +6.425854146240174e-01   +3.782441561464932e-01   +5.898572579475484e-01   +3.178239132143438e-01   +2.461613387746034e-01   +1.073389064745285e-01   +4.897629878190875e-01   +3.855904039573909e-01   +3.215393718091293e-01   +8.033706875198323e-01   +5.921134481837558e-01   +4.654856449304808e-01   +1.242337824398465e-01   +4.626062567042786e-01   +5.873252402303459e-01; +7.408051880035142e-01   +3.153807596022800e-01   +4.315417885415538e-01   +2.472481570862278e-01   +2.624356208505971e-01   +6.134470717134068e-01   +1.285613719322414e-01   +1.699627912022619e-01   +5.287073651436151e-02   +3.875759443598682e-01   +1.809568674360169e-01   +5.693091045443515e-01   +7.168561223968826e-01   +6.561590510501836e-01   +5.949328805965275e-01   +2.524155677410452e-01; +2.087716322763889e-01   +6.927691958468452e-01   +1.909846567308969e-01   +5.168798731622748e-01   +6.803547194878487e-02   +1.626272419889929e-01   +6.387813640956681e-01   +1.459591782034606e-01   +1.729394363943306e-01   +3.109016456271531e-01   +2.566859902831638e-01   +6.487534409024460e-02   +4.360318082861311e-01   +4.565121875283984e-01   +8.881164889647936e-02   +6.571078008066796e-01; +2.990766725563380e-01   +3.417150973689167e-01   +7.884120812388484e-01   +6.045529371314907e-01   +7.098520612614480e-01   +7.360253421526795e-01   +7.975277928090774e-01   +5.016426867076811e-01   +1.452304387684689e-01   +5.942990772434151e-01   +2.008933430052131e-01   +7.347995440116168e-01   +5.923267075629703e-02   +1.776635486423467e-01   +5.672298886177830e-01   +4.536441057513121e-01; +3.995584926029092e-01   +2.403550984912692e-01   +4.466496910378775e-01   +8.050726048752140e-01   +3.086658591922464e-01   +2.898229205524199e-01   +2.470307764814663e-01   +6.420541781522870e-02   +2.819298944214514e-01   +3.525425193721021e-02   +6.528200073655253e-01   +8.104674971863842e-01   +4.574464216621566e-01   +2.411021118939494e-01   +8.241789820651629e-02   +2.091009877741572e-01];
L2I_L1I_iGABA_netcon = [+6.717469830082752e-01   +4.640272758301638e-01   +6.915642402724799e-01   +2.810825672014211e-01   +7.122658997633877e-02   +4.100337312598922e-01   +5.382269012341173e-01   +4.291905634643691e-01; +5.448727919455081e-01   +6.118284666679702e-01   +2.228538650958989e-01   +4.683275164053672e-01   +4.105251269158201e-02   +5.990214564558147e-01   +6.078032177598778e-01   +2.045449390123130e-01; +4.798508404046050e-01   +6.260032271311631e-01   +2.658287245800083e-01   +6.479669196316754e-01   +4.946159166520280e-01   +7.088617512220076e-01   +7.092328733763639e-01   +5.972012434652351e-01; +4.288261957482035e-01   +6.248276465454481e-01   +6.194627979302627e-01   +4.031896912839387e-01   +1.875493646731754e-01   +6.964814187939475e-01   +1.822999734944100e-01   +4.367092219874051e-01; +2.352852260740886e-01   +3.125131181051740e-01   +5.678620522266841e-01   +6.144398282448983e-01   +5.303269493065605e-01   +4.564944803061725e-01   +2.534085816565560e-01   +4.370034922415143e-01; +2.822800280768704e-01   +4.399284509470419e-02   +6.427189765938311e-01   +7.112945188307551e-01   +6.534402883421464e-01   +4.528881278227776e-02   +1.673474334660394e-01   +6.355632540399535e-01; +3.853281919708253e-01   +2.145179171520207e-01   +2.301165436977423e-01   +7.745861001285913e-01   +2.927482751123798e-01   +2.037081118886625e-01   +4.407886015587092e-01   +5.807637223765127e-01; +3.282729335866815e-01   +4.561915935898053e-01   +7.205213117406372e-01   +5.827092256328775e-01   +4.978117592416443e-01   +6.866552403786885e-01   +2.593713521293010e-01   +3.558551828953129e-01; +1.072836385230012e-01   +6.143632439734005e-01   +2.766460723714810e-02   +2.927722227352447e-01   +5.760817995975268e-01   +2.397286649310028e-01   +7.627687423094865e-01   +4.303357270112346e-02; +7.648347735626068e-01   +7.116527609235798e-01   +3.583454897976618e-01   +2.501799121987228e-01   +6.355554918272561e-01   +2.539779046260261e-01   +4.252514494761369e-01   +6.408134358598559e-02; +1.231232724181497e-01   +4.970914517917294e-01   +3.434991906152158e-01   +4.283436140980652e-01   +1.205934341525007e-01   +2.444318803608236e-01   +3.119073697153085e-01   +3.081976980562031e-01; +1.666136845347474e-01   +1.148763924766208e-01   +6.340097655009740e-01   +1.629965689926466e-01   +4.320731562982057e-01   +3.792793464716896e-01   +6.055967942002159e-01   +4.531452988961985e-01; +6.753408708564026e-01   +5.488985205145502e-01   +6.730487170385601e-01   +2.276096598719501e-01   +7.406650667255129e-01   +5.483714131579939e-01   +5.731231215592126e-03   +2.410398228595166e-01; +1.704597046117091e-01   +4.172616491043127e-01   +7.385451072571556e-01   +7.687476584943880e-01   +6.238605382975317e-01   +4.275578013606831e-01   +1.148117052469332e-01   +6.970136525461851e-01; +1.005942652442777e-01   +3.730548726577451e-01   +5.439374179492046e-01   +3.926124934867511e-01   +6.380083528512870e-01   +2.536744907664292e-01   +6.890107324868173e-01   +1.627214289482657e-01; +2.919810013898735e-01   +5.717102513414998e-01   +5.439840956253990e-01   +6.513101189658356e-01   +4.119051431087221e-01   +7.250224510032652e-01   +3.895198037456380e-01   +7.794353123187509e-01];
L1I_L2I_iGABA_netcon = [+3.163899067985212e-01   +1.780926821539742e-01   +3.056980738928636e-01   +1.560076452856610e-01   +7.280688036498059e-01   +2.332364045141557e-01   +6.143273687034820e-01   -4.162560196611068e-03   +3.582159864773232e-01   +7.686261865639405e-01   +6.473143853404663e-01   +1.941812520574956e-01   +3.020180503828107e-01   +3.829924578539140e-01   +2.787607652982288e-01   +7.935888214435595e-01; +4.157496045094954e-01   +4.332864793903803e-02   +6.267797412741106e-01   +3.938632176045535e-01   +1.090831917572295e-01   +4.797507939479859e-01   +3.223101720708028e-01   +5.168573767813710e-01   +7.247686254272935e-01   +1.857771224747366e-01   +5.962990606153437e-01   +4.819687464845482e-01   +3.733948107016993e-01   +3.876680391915248e-01   +8.675867570405323e-02   +5.158327144144350e-01; +2.029151174735616e-01   +4.214286469349757e-01   +1.938487088740111e-01   +5.570752354269136e-01   +5.870225648830973e-01   +7.748937970606077e-01   +5.064306753613435e-01   +6.738249013812944e-01   +7.177218707968039e-01   +6.866604485833685e-01   +6.235713467587344e-02   +4.140328592224877e-01   +6.572530406955037e-01   +1.144990022500155e-01   +2.969795560658088e-01   +4.806540970860917e-01; +1.714064542222087e-01   +4.821021824618895e-01   +7.818947974188886e-01   +5.856708358079781e-01   +6.117707576125389e-01   +5.329043085105577e-01   +3.295719551307882e-01   +3.489693585713846e-01   +6.688461631155388e-01   +2.666576634940807e-01   +1.456674574590320e-01   +2.225371594830699e-01   +3.167783532106839e-01   +7.727007870694571e-01   +4.307287184438513e-01   +2.384210113835861e-01; +6.580156441259155e-01   +3.732293941980316e-02   +6.405351148001847e-01   +1.948045739619036e-02   +6.543211572929396e-01   +1.709086217108144e-01   +3.419327507268992e-01   +5.208241051735797e-01   +8.974318045463149e-02   +3.807732761876716e-01   +4.594761747566357e-01   +3.653874886586353e-01   +4.451169256982569e-01   +1.834618845574143e-01   +7.965749780107507e-01   +2.752990608329455e-01; +3.206169842794226e-01   +6.696258649045862e-01   +6.994719346461969e-01   +5.796938557190080e-01   +6.854629142813521e-01   +7.727460719356333e-01   +1.671937304607427e-01   +4.479307078285042e-01   +6.399664782674173e-01   +5.266782000065783e-01   +4.540502349253343e-02   +3.209164553841463e-01   +3.692146314361167e-01   +4.124753967800063e-01   +3.358824235090122e-01   +4.467423479121207e-01; +4.632152179919530e-01   +3.544136577973099e-01   +8.005599450753252e-01   +9.537352197332886e-02   +7.177309415496550e-01   +9.923427130056793e-02   +4.076184422496012e-01   +3.150702158130245e-01   +3.339861808973953e-01   +7.194077446851328e-01   +1.389166147108396e-01   +3.846593592682379e-01   +3.505744969888396e-01   +2.155690787508948e-01   +6.603183258653574e-01   +3.691998505498844e-01; +6.388869668301798e-01   +7.147293195780100e-01   +6.541612752581184e-01   +4.572979348152703e-01   +7.161700826754238e-01   +5.806002287684640e-01   +7.573626879660466e-01   +2.189167465475291e-01   +9.441417602040904e-03   +4.907894660905118e-02   +3.803782038057872e-01   +8.527333924225455e-02   +6.755983766094296e-01   +2.900920543802770e-01   +2.636753603834626e-01   +2.242912217681697e-01];
L2E_L1E_iAMPA_netcon = [+4.543671837037529e-01   +1.721025509134945e-01   +6.236677954468177e-01   +1.889924285567128e-01   +4.295523371123475e-01   +4.592267730514083e-01   +9.861598250327785e-02   +7.452899109904537e-01; +3.881452761948487e-01   +6.245265935446483e-01   +7.344436781030776e-01   +6.280409962585444e-01   +2.410980259584417e-01   +1.925545448860846e-01   +2.608496405401605e-01   +7.869856044450356e-01; +5.949698774788106e-01   +2.322979565801860e-01   +7.639395336247889e-01   +2.875530536601639e-01   +4.856570857583417e-01   +4.452646102744113e-01   +5.318259830092241e-01   +5.019138945380197e-02; +4.080181896801339e-01   +2.428300343417391e-01   +3.139446455140224e-01   +6.350649707213299e-02   +4.355011247120809e-01   +5.438020862018148e-01   +6.422734291921291e-02   +6.510155397338977e-01; +5.067708983977415e-01   +5.410729495279564e-01   +6.905849169227266e-01   +4.580303799670527e-01   +1.787488381649086e-01   +3.696859016536478e-01   +1.089328253708043e-01   +2.857016089972824e-01; +5.810211295737328e-01   +8.499395954655214e-02   +5.665144470873492e-01   +1.606620607417747e-01   +4.402432773258471e-01   +8.917451993730137e-02   +2.192797782107331e-01   +1.212907030164863e-01; +3.889848868634252e-01   +4.643585214097848e-01   +3.899120253592723e-01   +5.316715381194961e-01   +1.949824299835995e-01   +3.170174166041034e-01   +7.019465313572737e-01   +3.848870798397522e-01; +7.143787766593602e-01   +4.010817812214197e-01   +3.107293528198307e-02   +2.965542871900275e-01   +3.851041056317021e-01   +7.828617802010551e-01   +1.204681265490166e-01   +7.153921717636873e-01; +5.540689646085798e-01   +2.261142477859169e-02   +6.083682543329741e-01   +4.706741248093124e-02   +5.756472240168704e-01   +5.373112720825347e-01   +7.111955116249492e-01   +1.519778193998146e-01; +3.389305838070982e-01   +8.189353941423309e-02   +3.626335279065150e-01   +3.205522779434603e-01   +6.288500000049635e-03   +1.350517173690203e-01   +5.439860505304148e-01   +2.633052599191185e-01; +3.404920514713870e-01   +1.491753444821247e-01   +6.875406086172613e-01   +7.561539856735258e-02   +2.816629528313414e-01   +5.371499722047347e-01   +4.842931186526041e-01   +4.457700601340612e-01; +3.228504908388773e-02   +7.965430940866102e-01   +1.003293697813682e-01   +1.771767993499236e-01   +1.552016834355826e-01   +3.841895891744972e-01   +1.264102073936468e-01   +4.740500669524886e-01; +3.799885729401321e-01   +2.876903513792768e-01   +2.559577942765808e-01   +1.996421835740098e-01   +3.078465073739507e-01   +7.812807906538383e-01   +1.866658029463667e-01   +6.906117323902757e-01; +5.969709401054749e-02   +5.566983451947646e-02   +6.630693347706332e-01   +3.175100379677175e-01   +7.901139541987606e-02   +1.898039513840059e-01   +3.593351202001992e-02   +3.624919402704933e-02; +2.528177505155221e-01   +2.753227500215906e-01   +6.184343058181413e-01   +1.793537541480528e-01   +3.801993016965376e-01   +6.679627370780979e-01   +9.194498347527370e-02   +6.780572400915127e-01; +7.055354442982420e-01   +3.371279285056750e-01   +2.097624621949560e-01   +4.639425939856435e-02   +7.546556725700724e-01   +6.998715088997876e-01   +2.543714856874302e-01   +6.749525926304215e-01];
L1E_L2E_iAMPA_netcon = [+7.378237660688387e-01   +5.397430750223228e-01   +7.660476838531458e-01   +6.845847624714044e-01   +1.518912618725587e-01   +1.868531101325046e-01   +1.936349811956166e-01   +1.402823265972089e-01   +5.285736403197591e-01   +4.242070852547847e-01   +2.331809665593737e-01   +3.789180096700966e-01   +1.328284525564805e-01   +2.551588321135192e-01   +4.950578659131141e-01   +3.619871074940099e-01; +4.034217865723618e-01   +2.348150387510166e-01   +7.614639678454509e-01   +6.095137869047852e-01   +5.593076061580385e-01   +5.082811112372552e-01   +3.859132308121236e-01   +3.293137614643812e-01   +7.171047557586122e-01   +3.088890976059233e-01   +6.469734259143288e-02   +1.659811139324774e-01   +4.934570681391386e-01   +6.928132621318431e-02   +7.540883437694111e-01   +4.406824338867247e-01; +1.542193952569556e-01   +7.336595167678946e-01   +3.338937610385985e-01   +6.952316679038467e-03   +7.576318013204812e-01   +6.398354049264126e-01   +4.284506340767859e-01   +6.381870031412686e-01   +2.274009397802627e-01   +2.418017476202990e-01   +3.573068621043956e-01   +1.775646869653534e-01   +7.992667154049683e-01   +3.485380642405599e-01   +5.492057404597945e-01   +6.017537715068966e-01; +1.421468177991282e-01   +1.492521392937606e-01   +5.631757403188975e-01   +2.543770543162462e-01   +7.136641209137764e-01   +7.069088026681309e-01   +8.040067543152118e-01   +2.884661226378249e-01   +2.599186528924687e-01   +4.639816411895398e-03   +5.863389555921290e-01   +1.585535140937697e-01   +7.336542631159312e-01   +6.167883414005159e-01   +4.675343395097389e-01   +7.086463753841110e-01; +3.422055044311634e-01   +5.185834216291817e-01   +4.621848444501560e-01   +7.077424784933610e-01   +4.487722498940566e-01   +7.282379084898938e-01   +2.799549864007876e-01   +4.024468388668789e-01   +4.832832650449618e-01   +6.619682217005373e-01   +9.930693260640171e-02   +2.898102626586487e-01   +2.092035472245821e-01   +4.420464705024223e-02   +6.954736384467268e-01   +3.584695086287982e-01; +3.213418370155463e-01   +6.739991262228878e-01   +2.871273432376577e-01   +7.931051480273385e-02   +2.327746410708081e-01   +5.042715681825481e-01   +5.970218679226382e-01   +3.254437083037329e-01   +4.673536524712089e-01   +7.409937114025950e-01   +7.188842179597532e-01   +2.809364841758004e-01   +1.777495416740751e-01   +2.714879405187094e-01   +6.516347626517412e-02   +7.287890259789580e-01; +5.703730677308130e-01   +9.411521875968748e-02   +4.595494410627317e-01   +3.846596974797294e-02   +6.978163440446683e-01   +9.147427551997177e-02   +2.197866314314329e-01   +6.458606985778755e-01   +1.427540916260862e-01   +7.867291072784405e-01   +4.388243352371153e-01   +3.049737125723700e-01   +7.880501518704809e-01   +4.717954235416197e-01   +4.135288128179451e-01   +9.101936455893926e-02; +1.229392140504396e-01   +3.920490616263750e-01   +3.376606777033838e-01   +2.155989901975493e-01   +1.500008872192247e-01   +7.290698513628410e-02   +8.629342018725321e-02   +4.185311716954072e-01   +7.385901885042719e-01   +1.729717407399143e-01   +6.756520751552971e-01   +5.329495636557495e-01   +8.051981288429429e-02   +8.416898522385806e-02   +3.195478641245529e-02   +3.609636616935242e-01];
L2I_L2E_iAMPA_netcon = [+5.853378544857768e-01   +4.512039057328154e-01   +6.997549400608504e-01   +7.579100838362753e-02   +4.557541703758499e-02   +6.370976470321758e-01   +6.492406328275004e-01   +2.405268833818833e-01; +2.316475311943182e-01   +1.910795943787816e-01   +5.365843803292153e-01   +7.816717437498598e-01   +6.250220977851532e-01   +7.152803082829108e-01   +2.784661625070575e-01   +3.775254438842116e-01; +3.748906909120579e-01   +2.653464158091365e-02   +7.331863532204238e-01   +6.838000018218361e-01   +4.628748808745520e-01   +5.260209962962594e-01   +5.187804477105635e-01   +3.795159667059761e-01; +1.114725917051841e-01   +4.786470888774702e-01   +4.656241216016515e-01   +2.973330920936211e-02   +5.925597155757178e-01   +7.615007596171951e-01   +5.892367442113313e-01   +6.108186189101287e-01; +2.962536996249580e-01   +5.256847080329466e-01   +4.277260711968872e-01   +8.102300108719939e-03   +7.198556758207247e-01   +2.064943701583609e-01   +2.771586053138650e-01   +6.515513192326068e-01; +5.282262942318808e-02   +6.220654253145306e-01   +7.065002498706703e-02   +4.047910152829273e-01   -6.937139656704347e-03   +6.407320310884532e-02   +4.708186868837101e-01   +2.726666302223745e-01; +6.088152005460276e-01   +1.526842252410247e-01   +5.001914214413017e-01   +4.702236576506309e-01   +5.697984433528590e-01   +3.712784889666805e-01   +4.053756997481268e-01   +2.356724668766539e-01; +1.938809565667370e-01   +6.678725675598787e-01   +1.610479763230541e-01   +7.318839996449612e-01   +9.196075996513062e-02   +7.839465084158130e-01   +2.799678033176921e-01   +3.530068897343383e-01];
L2E_L2I_iGABA_netcon = [+4.229133243111166e-01   +2.999732110144542e-01   +1.922925972139345e-01   +7.779994467000739e-01   +5.894044293314488e-01   +7.050515761198671e-01   +7.135377864910095e-01   +6.999767624954663e-02; +1.152523457196184e-01   +6.538615232207068e-01   +6.354475315290536e-01   +4.940696784821801e-01   +3.292714958601416e-02   +1.044588677317532e-01   +7.312751696384391e-01   +1.695005117161728e-01; +5.512985564903343e-01   +1.428348148305172e-01   +1.606293630900554e-01   +2.237948243597558e-01   +7.539142424674151e-01   +7.952331876808776e-01   +4.025068387456490e-01   +4.905398232113965e-01; +9.312315984633493e-02   +2.335438023797284e-01   +4.998381841114957e-01   +1.532160414909343e-02   +6.916446895736043e-01   +2.645472993651122e-01   +7.573733926683296e-01   +4.385500387985652e-01; +1.876138644428675e-01   +2.935999724336098e-01   +7.942312833305774e-01   +3.766298873638359e-01   +3.183930233887318e-01   +4.432626032105229e-01   +1.633628781102794e-01   +5.478066340559554e-01; +2.073639671425536e-02   +7.309726492592601e-01   +7.860098979964038e-01   +3.566921556166642e-02   +3.132465292871855e-01   +6.023919989893728e-01   +6.419017790207262e-01   +4.376146248075926e-01; +5.889840280270434e-01   +1.963640531536527e-01   +7.219707184322760e-01   +5.180621294797640e-01   +2.309732416892678e-01   +4.871441221969646e-01   +4.756924052796357e-01   +5.514148610127003e-01; +7.483227534044019e-01   +1.683055349904046e-01   +7.332214741157698e-01   +6.634353415182368e-01   +2.613418925616263e-01   +4.356339806037887e-01   +5.797455484961723e-01   +1.922069033365822e-01];
L3E_L2E_iAMPA_netcon = [+2.776585217044055e-02   +6.152130016664855e-01   +1.363827749931951e-01   +3.741487741892031e-01   +4.579082567028890e-01   +2.915652961593515e-01   +3.156829888410310e-01   +2.247206085081689e-01   +6.226984946190259e-01   +3.606013943450096e-01   +4.652387181057849e-01   +6.832294345295907e-01; +2.279278291390718e-01   +3.141108658328877e-01   +8.070981692773723e-01   +6.197851755854583e-01   +3.585602159454737e-01   +5.062849150401947e-01   +4.730941482160685e-01   +1.561238102055907e-01   +4.885090543592696e-01   +4.742056766371328e-01   +6.005107987469656e-01   +6.293894449225440e-01; +4.286010760539511e-01   +3.347336978734874e-01   +4.901510940680476e-01   +1.674248754185294e-01   +2.258628740992620e-01   +2.029900712251616e-01   +2.365694830210106e-01   +1.426115199628075e-01   +2.610651142264319e-01   +6.702682760288148e-02   +6.058802516741986e-01   +3.835401806970375e-01; +6.627895917898882e-02   +6.045668674355538e-01   +6.211028358082794e-01   +3.546638350834015e-01   +2.550848194761154e-01   +1.574345655934662e-01   +4.886181432122389e-01   +1.169863745255361e-01   +3.953456716904373e-01   +6.565621504322870e-02   +6.071984914963533e-01   +3.105043531954637e-01; +7.381366951969490e-01   +6.605405545216493e-01   +6.606452763468746e-01   +6.741109933306535e-01   +1.683074363465205e-01   +2.299950710486874e-01   +7.140433113507981e-01   +3.211858969638374e-01   +1.102875019166260e-01   +7.674841771829073e-01   +3.036410215937715e-01   +6.593599479569263e-02; +1.233851346008255e-01   +2.933260345991593e-01   +2.348309990222842e-01   +7.227380751517333e-01   +6.205622785057877e-01   +1.313429999902986e-01   +5.344504907328061e-01   +1.720563559594598e-01   +1.684064198402895e-01   +6.183295936500967e-01   +5.229689052072004e-01   +5.276649355761982e-01; +1.162138821970895e-01   +3.155654805470522e-01   +6.507778844795557e-02   +7.238576879872193e-01   +4.259956700063084e-01   +1.657010252856815e-01   +5.778532774545817e-01   +6.360741743280577e-01   +5.272027814099141e-01   +1.156064812159874e-01   +3.839227581072563e-01   +5.693778457384369e-02; +1.932747462797821e-02   +4.849684358751242e-01   +3.345011766759391e-01   +4.727474009509857e-01   +1.437580909107752e-01   +1.554533723845868e-01   +4.557008003432639e-03   +1.553457207021112e-01   +4.646765103179492e-01   +3.832720845817771e-01   +1.806967930686455e-02   +1.757701130725954e-01];
L3I_L2I_iGABA_netcon = [+1.651441783063745e-01   +1.318200789234527e-01   +4.704414670925390e-01   +2.690465317457953e-01   +6.187448484094238e-01   +7.309542896716941e-01   +6.034796730447697e-01   +2.690667020644404e-02   +2.289990839319874e-01   +7.528151702379239e-01   +5.013839535194453e-01   +6.940264370683267e-01; +2.419079717628948e-02   +5.156255540440128e-01   +9.036205466663964e-02   +4.996106530040652e-01   +5.221803893893352e-01   +6.543492261435719e-01   +7.440702765189320e-01   +3.618636230271393e-01   +7.238137892214123e-01   +4.339658090321015e-01   +6.644191092475255e-01   +1.097563817319121e-01; +4.859609258630738e-01   +5.018042978857662e-01   +2.934446325654453e-01   +4.277219355788236e-01   +1.404291455581633e-01   +1.296892311706255e-01   +2.086974198948510e-01   +1.109794756624168e-01   +1.848746142877413e-01   +7.938566429515673e-01   +7.095855223938310e-01   +3.970746355824958e-01; +3.641798646271857e-01   +3.327743567487920e-01   +7.538088930035337e-01   +8.794951921486990e-02   +3.758877048847094e-01   +3.249721398239617e-01   +3.579829474527771e-01   +3.377709461924314e-01   +2.729675815509218e-01   +3.733939589243148e-01   +4.334555286981133e-01   +4.502672437115102e-01; +3.857089222661125e-02   +2.084488720617557e-01   +6.056327695144662e-01   +6.133159458830828e-01   +1.358633882516764e-01   +1.905768215923185e-02   +6.811055303250878e-01   +5.513999928185521e-01   +7.148905552544910e-01   +5.475969671282699e-01   +2.116451183311839e-01   +6.935430611218050e-01; +5.062793362236291e-01   +4.413953890641983e-01   +6.062462504540113e-01   +6.041834310684264e-01   +4.948214770533068e-01   +5.232423931590588e-01   +1.967005488610639e-01   +1.565817622741355e-02   +4.986316546546568e-01   +5.227071967579323e-01   +7.851714572447598e-01   +3.177587224534042e-01; +3.362113405461496e-01   +7.072273148541105e-01   +3.285017313675822e-01   +5.398140258207487e-01   +2.480438526762820e-01   +2.827488441968838e-01   +5.078818921307239e-01   +7.571350893100440e-01   +5.999728405541683e-01   +4.678635449309402e-01   +6.005480339212753e-01   +7.240479382823110e-01; +7.566253158517665e-01   +7.082082059728649e-01   +7.246731239767276e-01   +1.545111182964092e-01   +7.156787609795748e-01   +3.515805087078841e-01   +1.328230825199929e-01   +4.774745981662945e-01   +6.450183925850727e-01   +2.297116099202895e-01   +6.669062362013125e-01   +5.615972658110123e-01];
L2E_L3E_iAMPA_netcon = [+7.614714167085064e-02   +9.920910317720581e-03   +5.775307698749094e-01   +1.713778220389134e-01   +5.124962266470416e-01   +7.582763039203353e-01   +6.268739855894498e-02   +1.467747781826118e-01; +6.094397906244428e-01   +1.885003853316123e-01   +7.809723959555002e-01   +3.915071809171731e-01   +7.251408816834638e-01   +1.800953663764961e-01   +7.545446478738771e-01   +6.577052022584632e-01; +1.732820580548667e-01   +1.931474744857345e-01   +1.519600274668999e-01   +5.695369825535498e-01   +4.550287443057906e-01   +3.487919164524283e-01   +2.423273987163683e-01   +7.630911310104302e-01; +6.773176052618343e-02   +1.918729865059186e-01   +2.854490705429560e-01   +4.395324245248856e-01   +6.758339245538190e-01   +5.212998419276827e-01   +2.507115950379906e-01   +2.397028836482075e-01; +6.375864460089617e-01   +2.959512345599045e-01   +7.065144463375038e-01   +2.211043787441828e-01   +2.783937365270555e-01   +3.194892495240554e-01   +6.467686686659990e-01   +7.156272694026702e-01; +7.681974031043590e-01   +6.312083390058771e-01   +2.606108223725985e-01   +6.878767488872022e-01   +1.951988676697083e-02   +4.237385862504623e-02   +7.793609219027381e-01   +7.903063738846179e-01; +1.116232920891049e-01   +7.079856613371683e-01   +5.414915613572097e-01   +5.460700384805507e-01   +7.588069685646044e-01   +1.882079373989799e-01   +1.732617882223380e-01   +2.391448445315403e-01; +2.508668182074970e-01   +4.526604975771754e-01   +5.258051675661461e-01   +4.491842819935841e-01   +2.953813539294518e-01   +2.544622549315549e-01   +3.182319503579051e-01   +2.559849805141948e-01; +2.086212327252455e-01   +4.333262414395362e-01   +3.537835370905147e-02   +2.771300030589121e-01   +7.534748108401095e-01   +5.046317546158164e-01   +6.107289296814826e-01   +3.443544693115836e-01; +1.928008612661552e-01   +4.504631581434837e-01   +3.645548790680697e-01   +1.007955234920555e-01   +3.530080684745673e-01   +6.044847069133790e-01   +3.502498293609922e-01   +3.825943111036005e-01; +4.139145559372450e-01   +5.045147638924846e-01   +1.570760255668726e-01   +7.132793055789981e-01   +4.459494989282581e-01   +3.985969860754644e-01   +7.436762031443601e-01   +1.595037922779326e-02; +4.880488671063897e-01   +6.744262641849345e-03   +5.662019854618928e-01   +3.192941453756441e-01   +5.256678369455404e-01   +1.085576646478068e-01   +7.328250892712039e-01   +1.007396037639120e-01];
L2I_L3I_iGABA_netcon = [+3.910809402558357e-01   +6.165026046996768e-01   +4.622433357067727e-01   +6.856837040738195e-01   +2.516204151121597e-01   +6.088070264397279e-01   +6.812326965983750e-02   +5.498945928335938e-01; +4.323804800862340e-01   +7.328503985364946e-01   +3.188638955444906e-01   +3.323327037878072e-01   +4.091873744662292e-01   +1.929582578720998e-01   +1.216620852452209e-02   +4.334334230557373e-01; +2.431370065212510e-01   +5.212963967825848e-02   +3.082380244159718e-01   +4.918849489216948e-01   +6.484322943328559e-01   +1.125786275017471e-01   +2.971656510359201e-01   +5.848704984588124e-02; +4.660252637539744e-01   +3.532801369782582e-01   +4.163594243949858e-01   +2.175786967945758e-01   +5.820761947009592e-01   +6.162142019877449e-01   +2.733682201317809e-01   +2.594190461018804e-01; +5.613686850898144e-01   +5.269563164524137e-01   +1.637606064945022e-01   +3.822345082218745e-03   +5.580167302138791e-01   +2.527218811770075e-01   +4.124366205116727e-03   +3.733970331386518e-01; +5.212907086206485e-01   +4.885245732150007e-01   +5.684526834854715e-01   +1.090253275569932e-01   +6.834233249349982e-01   +5.176773586183058e-01   +1.558853177372041e-01   +6.076912740228093e-01; +2.536796532854509e-01   +2.183868592771490e-01   +7.373907975342739e-01   +1.592384384265419e-01   +1.580350195194599e-01   +4.342491876088311e-02   +4.647566219723043e-01   +2.592306616640539e-01; +2.519204504825194e-01   +4.832187919193540e-01   +3.495837501472142e-01   +3.807373019798575e-01   +4.376926358594766e-01   +3.569189359057018e-01   +3.174433540411222e-01   +5.168159825627798e-01; +4.291697396423347e-01   +8.295254120974725e-02   +1.473044806295983e-02   +1.282524589310328e-01   +4.814223915277545e-01   +1.082118471445010e-01   +5.104621722496455e-01   +6.071514216358705e-01; +4.619129618367928e-01   +4.443143973102492e-01   +4.928766450133569e-01   +2.025776194976230e-02   +7.618678425357431e-01   +1.685811804820939e-01   +7.405188679939575e-01   +1.235136822292830e-02; +3.323896938547806e-01   +4.952990475796962e-01   +6.780336900328016e-01   +1.721567437683252e-01   +5.114714509219769e-01   +9.070380179356609e-03   +3.372222159230647e-01   +7.463751422133160e-01; +6.121106432541331e-01   +4.851861795067439e-01   +6.873274129865947e-02   +2.125542732602131e-02   +1.855450653155481e-01   +4.740639122708410e-01   +8.533289504565048e-02   +2.421933040230638e-01];
L3I_L3E_iAMPA_netcon = [+5.730835494065861e-01   +6.224778831695736e-01   +4.950201037353203e-01   +1.878055951207524e-01   +6.977583222953870e-01   +6.127338532145654e-01   +2.956643315446617e-01   +3.053609430449953e-01   +1.472241056826706e-01   +6.543022699281423e-01   +4.836720161951495e-01   +6.627692717718237e-01; +7.903786207940472e-01   +1.247078551727495e-01   +8.049125858703692e-01   +3.512425324693245e-01   +4.510301647618989e-01   +1.153645169606875e-01   +1.533541687139387e-01   +3.024658565804877e-01   +1.809286278523068e-01   +3.051888013637791e-01   +4.016878719143194e-01   +4.708952693346534e-01; +3.954570726907557e-01   +3.700948703071733e-01   +7.787829215363101e-01   +6.567447841490714e-01   +1.359305006813208e-01   +1.474600455052915e-01   +3.847633162611010e-01   +2.731280664088478e-02   +4.508601995680528e-01   +5.642370470803924e-02   +6.592548222276936e-01   +5.522745137008607e-01; +5.209361429411162e-01   +6.574911051744242e-01   +6.363679653081138e-01   +1.623647160038998e-01   +3.216406557431110e-01   +4.243402891685562e-01   +1.350656561758537e-01   +2.640156564780542e-01   +3.019944320424012e-02   +5.273237681442515e-01   +3.457353946067351e-01   +2.609141823522386e-01; +7.315039176861777e-01   +3.375648538174017e-02   +6.598061976510954e-02   +5.930724396794348e-01   +1.750033337659914e-01   +3.311854313279844e-01   +1.270179228687950e-01   +6.600540490625264e-01   +6.007395093846323e-01   +3.055647400608449e-01   +7.125256624003947e-01   +1.459179000429941e-01; +5.177688573955013e-01   +5.907669725478374e-01   +1.990345814323971e-01   +6.482042952463709e-01   +5.282657069591699e-01   +2.970359034915668e-01   +4.639016610402891e-01   +2.489543980495341e-01   +4.136271964574955e-01   +5.039004365185984e-01   +8.258531346613442e-03   +1.130157451980840e-01; +4.082960805586402e-01   +2.837050622201913e-01   +1.992797685587654e-01   +5.465864275446729e-02   +1.661371457193188e-01   +2.991442625645961e-01   +5.618288312520469e-01   +1.307669859299591e-01   +1.054232797822646e-01   +5.154123748498685e-01   +3.121321453199751e-01   +7.160637954744028e-01; +6.802628160436920e-01   +6.792441380766387e-01   +7.837359916268055e-01   +1.943063497683941e-01   +5.214530235373027e-01   +5.073565545981640e-01   +7.931049944405980e-01   +5.121435450936067e-01   +5.331649774321392e-01   +7.022351372555662e-01   +2.594892878731809e-01   +6.359384751996311e-01; +1.817699740830379e-01   +1.111353062115564e-01   +3.744466390124090e-01   +7.386507654732601e-01   +1.071583407704476e-01   +5.249381589524892e-01   +3.969825270006768e-01   +3.062097753408090e-01   +6.347422655479196e-02   +2.241100753100386e-01   +2.302198867265224e-01   +7.436351424111296e-01; +3.579883513114295e-01   +6.832871077858297e-01   +6.026519742918025e-01   +6.440395116855746e-01   +2.926080004506260e-01   +2.292443383861807e-01   +5.591595641299699e-01   +7.669955195147686e-01   +1.987939638658562e-01   +2.440340412585661e-01   +3.085174006320678e-01   +4.553196847783277e-01; +2.183882852244610e-01   +7.176497967352732e-01   +3.895621766833056e-03   +5.715807479675123e-01   +9.608705299860283e-02   +3.063882218466575e-01   +5.804632896673627e-01   +4.322528477812057e-01   +3.805649192515184e-01   +6.733822244998688e-01   +2.100048348180133e-01   +7.675848278125575e-01; +3.144078614942191e-01   +5.167364608939709e-01   +7.898193599768444e-01   +1.355319455151988e-01   +1.009255085310324e-01   +7.879001800172292e-01   +6.482521451357045e-01   +3.289076508048988e-01   +6.191245978912272e-01   +5.301731074882846e-01   +2.251098176345054e-01   +7.928089003601411e-02];
L3E_L3I_iGABA_netcon = [+4.650540867722884e-02   +7.142873655607338e-01   +4.434346464093104e-01   +3.897254299966365e-01   +4.096553102454197e-01   +6.926974421573452e-01   +4.862300994133401e-01   +5.554667742513572e-01   +3.610909008349354e-01   +7.022802552003263e-01   +8.066863482066489e-02   +1.510193567544103e-01; +3.268328796415113e-01   +5.901526316441539e-01   +6.245218256095904e-01   +3.265430875124501e-01   +6.457560753021496e-01   +3.486514693438570e-01   +6.232457837489803e-01   +7.368732189099217e-01   +4.665190850990621e-01   +2.752205358066855e-01   +7.652178433234572e-02   +2.613116424354160e-01; +5.571702827891594e-01   +3.103119692614932e-01   +5.515865998260532e-01   +1.743104867166248e-01   +3.920368195907208e-01   +2.372531507228506e-01   +7.856327086484211e-01   +3.405998580865734e-01   +2.480759096109815e-01   +3.239889629297955e-01   +7.561500060377475e-01   +4.566683778944486e-01; +3.289708155938859e-01   +4.986684101134125e-01   +7.945340508734228e-01   +2.036953145939771e-01   +1.086183654482284e-01   +2.797819454266003e-01   +2.687544425681990e-01   +2.494304488607821e-01   +2.881460904254893e-01   -8.008229877218918e-04   +2.378999742287831e-01   +2.473555128927104e-01; +5.997539446387384e-01   +5.346664910885397e-01   +7.217408599794194e-01   +3.236058669703857e-01   +7.173842071322432e-01   +7.752160790329619e-01   +4.090649388549312e-01   +1.962761414470665e-01   +8.042216840657204e-01   +5.291519158202439e-02   +1.808254097982761e-01   +1.247352530175705e-01; +3.894203880147992e-01   +4.972640485937327e-01   +2.683949166336065e-01   +5.360357328548273e-01   +1.996267825335601e-01   +7.121132110293538e-01   +1.129350359900503e-01   +4.935211688284510e-01   +3.141337600929581e-01   +5.387081145803490e-01   +2.642675837097880e-01   +2.391014555224826e-01; +7.722571591354663e-01   +4.602386427830605e-01   +3.854620869256479e-01   +3.596317499847564e-01   +4.967089639822676e-01   +4.312174108831854e-01   +6.860458543398444e-01   +2.246495388021048e-01   +6.369232075423007e-01   +7.145525621637610e-01   +7.721687388375368e-01   +7.734571808981493e-01; +5.449812955245357e-01   +2.274894390367597e-01   +4.910340141335613e-01   +5.122486108458978e-01   +3.677243845916842e-01   +2.069609913450075e-01   +6.065899013564402e-01   +6.995647958927688e-01   +7.033933447590159e-01   +5.856632087193385e-01   +7.462042039801522e-01   +4.856127956430323e-01; +5.462277337508077e-01   +6.221202453947491e-01   +6.996259549882808e-01   +1.019235988789517e-01   +4.229777566274125e-01   +9.874080258055568e-02   +2.350219809308434e-01   +6.833467460512954e-01   +3.308819687662771e-01   +4.381514470278651e-01   +2.986725151345828e-01   +7.468791113750575e-01; +2.489490213655762e-01   +2.476879220174735e-01   +6.887968598023549e-02   +1.059880738654685e-01   +5.078424686508940e-01   +4.836831605593489e-02   +2.822719597582251e-01   +4.247370756526214e-01   +7.638652567186315e-01   +6.137335641156287e-01   +2.411358933193244e-01   +1.646475752113378e-01; +4.318675690206885e-01   +4.194091411188986e-01   +6.106224481641217e-01   +2.730945494610018e-01   +4.911618870132613e-01   +7.955307960280620e-01   +7.158305026223327e-01   +2.512227782623774e-01   +8.058418663413225e-02   +5.316413608298060e-01   +5.466425334669015e-01   +1.584125126504697e-02; +6.111633896331871e-01   +5.039300058275445e-01   +1.631632951216147e-01   +3.319937789596544e-01   +6.814583845493992e-01   +4.222416512286631e-01   +4.317068599987707e-01   +5.326774780209180e-01   +2.786642304929323e-01   +6.180822636903363e-01   +3.821902001354259e-01   +2.854176349768526e-01];
L2E_Input1_iAMPA_netcon = [+8.101237390674068e-01   +8.040644643360019e-01   +8.115918505458528e-01   +8.076085526818102e-01   +7.919935810601477e-01   +7.975556290751391e-01   +8.099383844087391e-01   +7.944802818634561e-01];
L2I_Input2_iAMPA_netcon = [+8.033088284326917e-01   +8.013355216783794e-01   +8.048469466775524e-01   +8.119482192141848e-01   +7.947126065058707e-01   +7.879907667072478e-01   +8.067897851660683e-01   +8.027034911816840e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
