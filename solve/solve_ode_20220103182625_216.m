function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.152333661685345e-01   +9.474224100364519e-01   +6.996381361199038e-01   +1.645194870303394e-01   +9.188504647327116e-01   +2.128979066590752e-01   +7.425713687123171e-01   +3.057527130568803e-01   +5.402919550678205e-01   +8.398609190676004e-01   +9.729164763118738e-01   +9.715234075322607e-01   +6.980470577977570e-01   +3.688487598671629e-01   +2.985258411702116e-01   +3.838022022929020e-01; +3.498694578107072e-01   +8.993977369585680e-03   +1.403980345504561e-01   +1.708533722009492e-01   +7.749102241798689e-02   +8.108035176326435e-01   +7.954694338732038e-01   +7.567105176544017e-01   +7.909764825469866e-01   +1.892553534678479e-01   +4.735552113259803e-01   +6.628604365330520e-01   +3.681097570645407e-01   +2.763748910931051e-01   +6.902660383290942e-01   +9.631054798481486e-01; +2.010982150549783e-01   +4.748125292791205e-01   +8.391006777774249e-02   +7.080201193983129e-01   +3.172292871249013e-01   +3.803994346516864e-01   +6.580728847694614e-01   +9.538401259645122e-01   +4.717155138088879e-02   +9.250082042409888e-01   +8.719443687667688e-01   +1.989049140259367e-01   +5.482628728296371e-01   +7.523659806536546e-02   +7.816150633198955e-01   +8.103350594150195e-01; +2.846757577277574e-02   +4.878189502590246e-01   +4.282709486134124e-01   +8.363692059481296e-01   +6.330802908512965e-01   +8.595647427775799e-01   +4.408665925170210e-01   +5.210254158804987e-03   +4.602003793248526e-01   +4.202957150244026e-01   +9.404563912739122e-01   +9.010772652513117e-01   +5.141009308467658e-01   +1.592938959352691e-01   +7.119142369381025e-01   +8.926839999187003e-01; +7.673017728183168e-01   +5.154497257885043e-01   +9.005646332437525e-01   +8.391482909109764e-02   +9.045444361160495e-01   +3.221214103233843e-01   +5.786153899115153e-01   +4.009417347120839e-01   +9.381516477226377e-01   +3.026131649682642e-01   +2.428558463064426e-01   +4.814496763005416e-01   +7.666046206644955e-01   +3.627238628011233e-01   +2.713584621078607e-01   +6.442177108050469e-02; +5.695793908299753e-01   +2.887852188538283e-01   +7.171895221260400e-01   +8.349815883827030e-01   +8.015496689302499e-01   +3.812737372719646e-01   +5.126949121874700e-01   +1.565598251472738e-01   +4.789305227176442e-01   +3.566456198855710e-01   +9.206698205568145e-01   +6.693010860324887e-01   +7.464400002086259e-02   +7.147930350616504e-01   +2.097684248050415e-02   +9.012606709209037e-01; +5.791899129794716e-01   +5.587060703501635e-01   +6.842838750449909e-01   +5.512883352272711e-01   +6.489084256857809e-01   +6.439052998824589e-01   +7.278226891169181e-01   +8.314791870768565e-01   +7.792889456642317e-01   +9.750011419452943e-01   +6.356528010968803e-01   +5.289154710861373e-01   +5.119464888155335e-03   +5.424316603778709e-01   +1.342037266806051e-02   +6.718323257137134e-01; +3.894727541025094e-01   +5.188859958817507e-01   +2.060594580326860e-01   +9.658951052455182e-01   +4.446866213673739e-01   +3.951765875101867e-01   +2.228079777102207e-01   +2.885246771381342e-01   +1.090090746465032e-01   +5.395680862921892e-01   +2.858276547834726e-01   +7.056195541957287e-01   +3.999666685116374e-01   +2.342822342733399e-01   +9.279583794134958e-01   +3.470361126141114e-01; +5.541436633789540e-01   +6.740806323615463e-01   +5.246046335228960e-01   +6.728059896634419e-01   +7.470365264261311e-01   +7.026034538517092e-02   +9.981754049657988e-01   +9.799141080461496e-01   +5.221145394176102e-01   +7.955895628219428e-01   +8.484464308262881e-01   +7.130377333238777e-01   +6.626051838346899e-01   +4.674606150081984e-01   +9.350451719535295e-01   +8.394581237190264e-01; +1.849573387408915e-01   +6.175525124996661e-01   +8.241298085850444e-01   +3.385224081184391e-01   +8.295376414693354e-01   +1.610939010355881e-02   +6.199678050647184e-01   +6.210115070031984e-01   +6.365765262410428e-01   +8.016457097763181e-01   +1.660994267212317e-01   +2.996125675170677e-01   +3.725456174086865e-01   +7.163723918199505e-01   +3.728600942549738e-01   +1.941410331583698e-01; +1.158567080673072e-01   +5.677188970725368e-01   +1.836012164448566e-01   +2.131602116971014e-01   +3.483485603378323e-01   +8.755790524861519e-01   +9.934832938469561e-01   +7.453139662036199e-01   +5.772436103683963e-01   +1.373956881706583e-01   +8.261067536307026e-01   +1.101966967570647e-01   +3.969224477137863e-01   +5.185636862912372e-01   +1.041936861788730e-01   +8.464023023301226e-01; +5.301697510501460e-02   +5.091312993417998e-01   +5.158654610315225e-01   +5.699086453607426e-01   +1.502356828735385e-01   +1.609563538002831e-01   +4.903549187740256e-01   +8.858499301533400e-01   +8.409243106784449e-01   +4.540223523589086e-01   +2.217331977492098e-01   +3.330298468434289e-01   +1.369396859414746e-01   +5.134591217907449e-01   +7.213351458637678e-01   +4.300150661274328e-01; +9.365350453282970e-01   +6.694915518128651e-01   +3.563044856622998e-01   +3.937467592103020e-03   +5.046071269586361e-01   +9.187543947710670e-01   +5.290473882850192e-01   +3.359965451521570e-01   +1.174158463052758e-01   +4.536293674920617e-01   +2.758452693382988e-01   +4.622634971403246e-01   +3.384693326414434e-01   +3.941752016106965e-01   +4.574607136936670e-01   +5.538959684744177e-01; +7.442555401802249e-01   +6.372123213944779e-01   +6.513582289763959e-01   +5.938515785415820e-01   +4.104262406055366e-01   +5.641167386886702e-01   +8.580122996238450e-01   +9.271000924101652e-02   +5.092387547380758e-02   +9.591876289999078e-01   +9.130999281911586e-02   +7.156992427570743e-01   +1.205521398404968e-01   +4.795538081423005e-01   +1.302017950507540e-02   +4.463088100233795e-01; +2.374672398371635e-01   +1.425277004750580e-01   +2.810068692328562e-01   +8.965606509186368e-01   +1.748556465771112e-01   +9.240724470967735e-01   +2.550961321232229e-01   +4.468593042760542e-01   +5.177960590973115e-01   +5.108494081140146e-02   +9.188257926125557e-01   +4.004734340145614e-01   +3.680102815609235e-01   +7.425702281196473e-01   +1.164743264596098e-01   +7.631260897224049e-01; +2.025298962144298e-01   +1.812112651471273e-01   +4.349024650555821e-01   +2.588702140354361e-01   +4.962246050814254e-01   +5.954370499588506e-01   +5.753484681531656e-01   +2.390595179370489e-01   +7.035531625028838e-01   +3.910280964678709e-02   +7.307694836321194e-01   +2.399019394386388e-01   +2.470727496433280e-01   +7.038966621729837e-01   +6.631120706604222e-01   +9.437444446059920e-02];
L1E_L1I_iGABA_netcon = [+8.410200235505697e-01   +7.505892572006672e-01   +8.700357809111516e-01   +4.369633290959469e-01   +9.186435915203588e-01   +7.697903836421945e-01   +3.211317187117156e-01   +6.423314524124834e-01   +9.671487153104720e-02   +2.713822651998683e-02   +1.265723570447001e-01   +5.167690956491052e-01   +8.771647055227951e-01   +5.745066429457005e-01   +1.734433635520857e-01   +6.371632427578178e-01; +6.194615743744440e-01   +9.910541975285514e-01   +3.108713249067384e-01   +1.400998150200999e-01   +8.900586855366094e-01   +2.762399639920074e-01   +9.675205876451577e-01   +4.397019536686453e-01   +2.969934311861327e-01   +5.120237429847141e-01   +4.344871338885595e-01   +2.062535792578370e-01   +8.040829549797515e-01   +2.925726109925341e-01   +5.731163230015900e-02   +3.406700002596134e-01; +6.656335970489999e-01   +3.743541954708529e-01   +4.310307736060130e-01   +6.498365770715251e-01   +5.888939019009326e-01   +5.220414258445373e-01   +3.509345098719284e-01   +4.819359285055951e-01   +3.306076721785572e-01   +8.667327222838198e-01   +4.795087176112473e-01   +7.721872366121227e-01   +6.482949034255272e-01   +1.437010381776339e-01   +2.206424484038438e-01   +1.523653910481482e-01; +7.808498009317633e-01   +5.099474359449758e-01   +3.789352539314695e-01   +7.273477376733747e-01   +8.357141401815875e-01   +4.106762303376008e-01   +3.168782449614250e-01   +9.644740751454470e-02   +4.764378002018657e-01   +5.769212678433554e-01   +6.765176225732301e-01   +3.891765048596952e-01   +7.347447032058719e-01   +4.375516622351250e-02   +2.033654560309488e-01   +3.997804960112128e-01; +3.167312865239015e-01   +7.577013473129511e-01   +6.546057664002913e-01   +1.718452909231783e-01   +7.785083819067944e-01   +7.855627683643500e-01   +9.137208459140915e-01   +8.055791795487729e-01   +2.402690073090498e-01   +4.253506275672095e-01   +3.494430816334110e-01   +6.821791432683409e-02   +6.644370628556180e-01   +6.210446025697012e-01   +2.113803709201894e-01   +9.158575486385290e-01; +3.214356646144130e-01   +1.358273648289051e-01   +2.459258339531515e-01   +3.390779394307022e-01   +7.907071815463157e-01   +2.604199972439208e-02   +8.831158441057059e-01   +6.215465617994245e-02   +4.546806479948824e-01   +7.207713649499440e-01   +4.495866067142287e-02   +7.500627257880595e-01   +8.869722479779321e-01   +6.062515049552071e-01   +5.822492100971327e-01   +1.523214005587794e-01; +6.256746129939272e-01   +5.182254009451288e-01   +6.889437220454864e-01   +1.028150633727850e-01   +6.954076146122867e-01   +4.084470418961320e-01   +3.594095431569071e-01   +9.546945525312762e-01   +7.542827330192986e-01   +2.276397303659507e-01   +2.930228728240603e-01   +4.586715816104679e-01   +8.554780645437386e-01   +3.726796071510941e-01   +3.608640171278014e-02   +4.672170270861036e-01; +9.015328989439392e-01   +9.097492470158255e-01   +3.282346774385451e-01   +4.559737377616191e-02   +1.648366699048298e-02   +8.288662653581425e-01   +7.391244172433947e-01   +7.735040742140675e-01   +7.148407299736632e-01   +5.938883671416013e-02   +8.017160286240541e-01   +3.102332897989890e-01   +4.079354472315326e-01   +8.326965699866187e-01   +7.969930438258861e-01   +8.199733600787769e-02; +3.707128894846637e-01   +9.962414400315281e-02   +8.732530339311401e-01   +4.722352431391761e-01   +3.253833069373847e-01   +5.917991657845516e-01   +1.219976472372994e-01   +4.448776511918449e-01   +2.310224351099517e-01   +9.757891910061233e-01   +6.504348932071672e-01   +2.732669979466102e-01   +1.121640064919353e-01   +5.183911747193898e-01   +1.394110059053628e-01   +3.350861445707267e-01; +8.866497823213869e-01   +1.846945008005545e-01   +1.000000000000000e+00   +4.747972559808232e-01   +9.490172340926643e-01   +2.094902537300043e-01   +5.916396963064843e-01   +1.669949000463396e-01   +6.981912718496009e-01   +9.710169827800034e-01   +7.090434718287850e-01   +5.758655104028393e-01   +4.092638212909698e-01   +8.148939013476534e-01   +5.763036093500108e-01   +4.891993110265367e-01; +1.141422899384854e-01   +1.782446123604406e-01   +6.845048032419568e-01   +5.496390294432403e-01   +4.078650403089821e-01   +2.911679475876698e-01   +4.368850856070844e-01   +7.819239688883169e-02   +3.031127618570440e-01   +1.268298928472161e-01   +7.602982295683470e-01   +9.143990017361312e-01   +3.315277448094690e-01   +5.800067493160667e-01   +8.093458629908079e-02   +4.990581624461610e-01; +9.570287929477889e-02   +5.336647548811406e-01   +3.482229708579808e-01   +6.439635554129236e-01   +6.239476258450386e-01   +2.696410872826185e-01   +9.642624177426262e-01   +7.456545055174517e-01   +4.680728804406933e-01   +2.167194508510904e-03   +3.871420067355857e-01   +4.483706779400726e-01   +1.074443507607832e-01   +7.113701379305524e-01   +2.275548752162030e-01   +1.317547132661506e-01; +5.406008607587760e-01   +9.767287459980493e-01   +5.593492768475125e-01   +3.480703934772741e-01   +8.521131197446987e-01   +9.344707209696504e-01   +9.740487036440911e-01   +5.347377271703775e-01   +4.375815054109406e-01   +9.349675712089123e-01   +3.645564837892612e-01   +9.816340702657759e-01   +8.590331105217152e-01   +7.289818625147804e-01   +4.415644013404005e-01   +7.698534546151652e-02; +5.994239246287708e-01   +8.411795897146084e-01   +8.935229580542087e-01   +2.532236596967247e-01   +3.702214559326037e-01   +5.589442575399191e-01   +2.486155288240665e-01   +4.871468130663463e-01   +7.280751545388481e-01   +7.397455877762932e-01   +8.115917860668650e-01   +1.035261837811184e-01   +8.997827060930925e-01   +4.474963758110511e-01   +1.744580509198805e-01   +6.727853713613278e-01; +7.234053965811259e-01   +6.683316125893890e-01   +6.496743346125500e-01   +1.821919790996180e-01   +2.048122197073081e-01   +4.326716866519398e-01   +7.761570609848291e-01   +8.866416786601726e-01   +8.740505747690864e-01   +4.296268067817682e-01   +3.892852778057520e-01   +4.201053399140573e-01   +6.903125670893754e-01   +2.791949187168393e-01   +4.149725667487039e-01   +1.160917524861143e-01; +9.909637708792435e-01   +1.411756075084917e-02   +3.826552726714101e-01   +4.790779259165032e-01   +9.080449709508301e-01   +3.248185145039538e-01   +7.084193140768948e-01   +5.874602991126159e-01   +9.102012568334833e-01   +9.421676021811859e-01   +8.719542042868133e-01   +3.882577300701158e-01   +7.456518728504203e-01   +1.573634863265511e-01   +9.636513150214450e-01   +9.847269677049706e-01];
L2I_L1I_iGABA_netcon = [+5.736962849274473e-01   +5.664716829316290e-01   +1.052178375659723e-01   +4.566308089686653e-01   +8.025780278415403e-01   +9.735786093183780e-01   +2.234203119840208e-01   +7.570088072203058e-01; +5.597291491020365e-01   +9.506627775382227e-01   +1.350022493088343e-01   +5.661512254881497e-01   +5.451337868844637e-01   +4.228520263114756e-01   +6.409176132556968e-02   +4.987238238525483e-01; +6.040819892481459e-01   +1.351553956543860e-02   +4.367726225558231e-01   +8.193523519241643e-01   +2.596736620778658e-01   +3.898323752596844e-01   +8.295885257783340e-01   +8.254135440092778e-01; +4.648334717222729e-01   +1.231110659150596e-01   +9.306640756572438e-01   +3.609967693051732e-01   +7.790935010927933e-01   +4.592656627082449e-01   +3.812485238741219e-02   +9.170424119451780e-01; +4.378598418903890e-01   +8.529875878374382e-01   +1.366954297027710e-01   +2.410136564735079e-01   +7.772431182507143e-01   +1.323255002088150e-01   +9.106410912947737e-01   +7.063438140734433e-01; +6.968072494761345e-02   +2.187394073397887e-01   +8.198223116194401e-01   +7.652566087083044e-01   +1.494954895657937e-01   +4.644114800892376e-01   +4.558825324752584e-01   +8.016743061610048e-01; +6.384007451556406e-01   +7.010538261010369e-01   +9.330158112895103e-01   +2.861295500464026e-03   +8.280140366470657e-01   +2.657422271831039e-01   +2.830404071475284e-01   +9.599671007274505e-01; +4.263999366654920e-01   +7.789898352602457e-01   +5.747746235720078e-01   +2.799971301405361e-01   +6.226025257414802e-01   +1.015225369115648e-01   +7.564403146971560e-01   +9.488488532739668e-01; +7.561739034992662e-01   +4.282241833406399e-01   +4.999606615345205e-01   +3.193616267224166e-02   +4.673120779119976e-01   +6.575871879122569e-01   +9.306054156718467e-01   +2.941389943346601e-01; +3.022811728760708e-01   +7.316657442282102e-01   +9.241296643780543e-01   +6.666581875582576e-01   +4.875513142370045e-01   +9.372888800542489e-01   +1.390430348156963e-01   +3.548860527448433e-01; +5.995701414815960e-01   +4.511623969958671e-01   +8.589777707299032e-01   +9.757907236589610e-01   +2.210045349169270e-01   +7.668532579789958e-01   +9.450607316487785e-01   +5.449010984193704e-01; +3.311703190990647e-01   +8.042502865809079e-01   +2.511285978907768e-01   +9.454996615778779e-01   +8.544737466444535e-01   +4.350811082691930e-02   +3.149436468909976e-01   +2.097060813042068e-01; +6.448909458428140e-01   +4.328757309561887e-01   +4.584654355605109e-01   +5.167467922424791e-02   +8.769607174633807e-01   +2.584158059213808e-01   +2.061948268425506e-01   +7.911428867333820e-02; +3.772179073832211e-04   +1.505611846800796e-01   +7.393258663809655e-01   +2.904999687974867e-01   +8.367054867558350e-01   +6.431625311494965e-01   +4.631975981499170e-01   +5.110661597458392e-01; +1.471683400827655e-01   +7.997389228851043e-01   +7.508788749136253e-01   +4.829421366845698e-01   +4.408718772674118e-01   +8.656094975631498e-02   +5.980852099566514e-01   +1.966788778427146e-01; +2.489186642744636e-01   +3.777683738229518e-01   +2.395610666405510e-01   +8.855439310037615e-01   +5.427687888792052e-01   +7.316783033497574e-02   +5.480449212107538e-01   +1.423837544461914e-01];
L1I_L2I_iGABA_netcon = [+7.166308951456150e-01   +8.734620464613830e-01   +6.182219456914353e-01   +4.855755750406528e-02   +1.505819150977560e-01   +2.365462497501579e-01   +8.461488544396918e-01   +3.706021521284185e-01   +7.161688663265527e-01   +3.921857289268217e-01   +2.418005875243169e-01   +6.783506786656794e-01   +1.634114821128903e-01   +5.738016876485286e-01   +4.863343402737098e-02   +4.550171749274085e-02; +6.124087364894286e-01   +8.052729099516166e-01   +6.181687664321129e-01   +5.417031390182591e-02   +7.503061302052960e-01   +5.542414526131731e-01   +2.005424202491858e-01   +5.647139324548223e-01   +1.941830415650405e-01   +7.289637691234734e-01   +5.090923379060709e-01   +3.401068074981610e-01   +1.115214466575336e-01   +8.170016683584899e-01   +4.366829483122118e-01   +9.278731937713731e-01; +1.641783406242222e-01   +6.226456787728452e-01   +3.113824513552692e-01   +6.008807867107239e-01   +9.524614523916456e-01   +1.146743489590409e-01   +6.156691167787627e-01   +8.419422705110847e-01   +2.343704944357075e-01   +6.355267792337986e-01   +7.362540079446712e-01   +5.504644001888827e-01   +7.480792451560456e-01   +6.796853806368948e-01   +9.260016819533400e-01   +1.778109664343534e-01; +4.846514013959781e-01   +4.821085873941272e-01   +1.355696971178478e-01   +6.620662636576957e-01   +2.602068730051338e-01   +8.289643051542173e-01   +1.574737984461873e-01   +7.174069041035142e-01   +1.000000000000000e+00   +9.806515789641705e-02   +7.841583888407019e-01   +5.346794558411542e-01   +2.181984495080521e-01   +4.430331755723347e-01   +8.871075451471520e-01   +7.500180494982874e-01; +2.890994892379423e-01   +2.162247450775355e-02   +6.067067804317362e-01   +4.897731419970226e-01   +9.378709383889855e-02   +6.583003521184363e-01   +5.872267594966434e-01   +1.122449308782526e-01   +9.059581328957468e-01   +5.006991325391593e-01   +6.823687737208446e-01   +9.087012194463762e-01   +4.875929161364454e-01   +8.956133649150700e-01   +9.274564896277775e-02   +4.697908443095437e-01; +4.016534521975543e-01   +1.256342817992515e-01   +8.974799727006824e-01   +9.826361689358507e-01   +2.315635869541355e-01   +2.316907238121728e-01   +5.454411191301186e-01   +7.447837452751032e-01   +1.017556405541158e-02   +5.568859743680038e-01   +8.151917500631946e-01   +2.868607292800820e-01   +4.659666957074827e-02   +7.900869282195540e-01   +6.833958754636374e-01   +2.504235269995895e-01; +4.894270474317298e-01   +7.241605344192935e-01   +5.691265083081056e-01   +8.647605479413447e-01   +8.962879262987705e-01   +3.030801500581011e-01   +6.907586820087281e-01   +9.251804105343181e-01   +8.392707384135101e-01   +5.596858733867893e-02   +4.250158894151545e-01   +1.354571160234635e-01   +5.805784226711779e-01   +5.933066174108204e-01   +1.480704626478918e-02   +6.648059908963336e-01; +8.660580345398312e-01   +6.706663479731795e-01   +6.386110608704172e-01   +9.597484395538256e-01   +1.984867814196526e-01   +3.260324104470822e-01   +7.027096806192815e-01   +9.282066543301289e-01   +2.547097423699459e-01   +8.392138080226036e-02   +4.954208501593600e-01   +9.594707301032969e-01   +4.968863537115431e-01   +6.246332712088766e-01   +1.256726575157891e-01   +6.152498787101381e-01];
L2E_L1E_iAMPA_netcon = [+3.736694061102029e-01   +5.648161501966914e-01   +2.009154452243230e-01   +5.201428287081717e-01   +2.934587695362953e-01   +6.908371846174875e-02   +2.840901865579172e-01   +2.653477612356274e-01; +4.377528335828671e-01   +1.849222960613816e-01   +1.450200403779891e-01   +6.831092156041676e-01   +6.168432595398450e-01   +5.918328473861331e-01   +9.293658058772308e-01   +8.994752147749959e-01; +7.217975966150122e-01   +6.046949431860805e-01   +7.619633702432825e-02   +2.149313847945264e-01   +8.673957168216083e-01   +7.713786232477798e-02   +7.590858818290448e-01   +1.587197831530780e-01; +1.963469151834090e-01   +7.321932840192675e-01   +9.302989513397526e-02   +9.687469304943445e-01   +8.153483559173739e-01   +3.963780113006479e-01   +2.591799174573642e-01   +5.517858073414686e-01; +4.602711736430447e-02   +8.374278905231257e-01   +5.484536671351724e-01   +3.469944459264672e-01   +2.088091043222401e-01   +5.320031321380984e-02   +2.434440454289327e-01   +4.212802227644474e-01; +3.085615107044983e-01   +2.764076054048443e-01   +7.328984994021633e-01   +1.830191571138770e-01   +7.536641502125856e-01   +1.262093527233406e-01   +1.621587198113181e-01   +5.456698037735428e-01; +7.921877393825614e-01   +6.097805833065252e-01   +5.467298884627971e-01   +2.451943831401454e-01   +2.011390194598428e-01   +2.384467819792046e-01   +2.925687821553935e-01   +7.484907507361080e-01; +4.252294152243079e-02   +5.489684124486054e-01   +4.546384499732900e-02   +2.606199389910175e-01   +5.843178919181585e-01   +9.416885940937836e-01   +5.674462278167047e-01   +1.210489008770005e-02; +2.149104523771599e-01   +2.796087491970549e-01   +6.383156131542473e-01   +2.181392816795686e-01   +8.774622401700350e-01   +2.063699753955263e-01   +3.970811369474049e-01   +1.932007885148707e-03; +2.693268281226344e-01   +3.388682876569699e-01   +9.886784984991910e-01   +3.741778898336374e-02   +7.189155314731426e-01   +3.290257335453264e-01   +9.830890313290267e-01   +1.888754637181135e-02; +7.919376689205163e-01   +5.728005085565474e-01   +9.173679632194311e-01   +3.500790458945437e-01   +6.984545644370921e-01   +8.660163621869010e-01   +5.459891938908168e-01   +3.476197839915702e-01; +9.832572547882156e-01   +7.460630673960691e-01   +7.750660902839885e-01   +8.994921109340392e-01   +4.589253787965349e-01   +9.263107200697979e-01   +9.363470941237556e-01   +4.287508256389960e-01; +9.471152010032007e-02   +7.664466916822537e-01   +1.957383828249472e-01   +1.369458757365937e-01   +5.057160083219451e-01   +2.245181682096487e-02   +9.871460313112568e-01   +5.418735915124109e-01; +1.976520909818725e-01   +4.046434004279023e-01   +3.206257281581949e-02   +9.497408890230027e-01   +7.990562273739340e-01   +3.620902096555018e-01   +8.292741854526027e-01   +4.794563624232842e-01; +1.184128461057859e-01   +1.558836880059414e-01   +3.777592095346519e-01   +9.053274480631502e-01   +9.379035653942859e-01   +5.328266801737365e-01   +1.785183048727289e-01   +9.128835712166851e-01; +6.436230864170376e-01   +2.043716812207839e-01   +5.770643289778450e-01   +4.115350044921588e-01   +7.933246432864618e-01   +4.100665483198377e-01   +3.136119179329505e-01   +4.199768082583732e-01];
L1E_L2E_iAMPA_netcon = [+4.971519200725595e-01   +4.582453351999038e-01   +6.164838578620326e-01   +4.925028477785355e-01   +2.366471401925822e-01   +7.166046388165184e-01   +6.839745605318555e-01   +6.356498813987600e-01   +5.187700648439684e-01   +2.405455148632246e-01   +8.719859916743810e-01   +1.746053620568506e-01   +1.351650759673788e-01   +2.433282316629832e-01   +1.840824973347255e-01   +3.162118176813659e-02; +8.376133278359394e-01   +3.660108221588382e-01   +1.002017148180339e-01   +6.631351405781230e-01   +8.336735966838240e-01   +3.795441414231808e-01   +9.730997679967686e-01   +6.214181543375538e-01   +6.720508412207554e-01   +7.298956265560377e-01   +6.666303799211355e-01   +2.982465148514890e-01   +2.893068075264907e-01   +7.433204902394550e-01   +1.510246839716342e-01   +2.535110478937859e-01; +1.833613302127223e-01   +2.928850476797710e-01   +7.574096403870679e-01   +1.779803114599346e-01   +7.319563086469862e-01   +3.805064630909428e-01   +7.565012194090331e-01   +4.093494449619110e-01   +7.746021420306302e-01   +1.247855984492584e-01   +5.462008875190398e-01   +1.054073994577974e-01   +5.461880182483228e-03   +9.321371865609861e-01   +1.345007549324014e-01   +9.883341589699406e-01; +3.389013028238321e-01   +2.373308816635822e-01   +5.404733561719737e-01   +4.736714665198279e-01   +4.869719465525632e-01   +7.172808912821892e-01   +5.529713040262939e-01   +4.336430322959948e-01   +4.632280480798306e-01   +3.919362219872162e-02   +2.440962632334527e-01   +4.558257171831281e-01   +3.053649508466078e-01   +3.611627946236710e-02   +1.639638315311390e-01   +6.323569078745072e-01; +6.942144135960511e-01   +1.374425671441994e-01   +4.472053672302138e-01   +5.008506110786619e-01   +8.510024350095771e-01   +8.323457092651533e-01   +2.730684102259856e-02   +5.143180373209791e-01   +9.082445636574497e-01   +6.503184881387497e-01   +1.068370693470444e-01   +5.867304798003264e-01   +9.076617013316292e-01   +4.285326427663437e-01   +9.251828052081729e-01   +3.561608778144888e-01; +6.888379826404436e-01   +1.027130801204987e-01   +7.430900476416081e-01   +5.999528530009307e-01   +7.209106578302052e-01   +6.694598441435626e-01   +1.896482757579111e-01   +2.615856120380960e-01   +2.331127072805628e-02   +1.965222573166389e-01   +9.694164896484186e-01   +2.181063750380736e-01   +2.958189041052446e-01   +8.244779509993894e-01   +2.630681478406329e-01   +1.004108558179285e-01; +3.693967491521140e-01   +2.365922180018881e-01   +3.874373431022516e-01   +2.456136532288358e-01   +5.188593234955361e-01   +6.470916268873400e-01   +9.401023634543304e-01   +4.217469802965532e-01   +4.883941991261768e-01   +9.734528705400519e-01   +5.879136151152788e-01   +1.071702123214102e-01   +8.290245416613579e-01   +9.968319349279494e-01   +2.050738939729303e-01   +4.127513475030207e-01; +2.925960954879449e-02   +3.482376035935722e-01   +5.313523952710347e-01   +5.180962458820222e-01   +9.382995719660705e-01   +5.617711462198067e-01   +3.931018947273638e-01   +5.197060493251853e-01   +2.712685021766203e-01   +8.251779664712438e-01   +8.164104206288788e-01   +5.636267940802965e-01   +7.369549194870632e-01   +9.207883979784844e-01   +6.195343526616404e-01   +9.300228337803509e-01];
L2I_L2E_iAMPA_netcon = [+6.776274246287521e-01   +6.138768741844411e-01   +3.882132649423659e-02   +8.020755915162365e-01   +5.212403888454806e-01   +8.215974143286566e-01   +6.492585041017935e-01   +3.848193252877646e-01; +2.357286434924433e-02   +9.412069504101935e-01   +5.522835872241398e-02   +9.362603518731651e-01   +6.354525420868157e-02   +1.077242096000838e-01   +3.441685855679879e-02   +1.682569021643787e-01; +7.310285367150344e-01   +9.627748960076785e-01   +4.067198659235218e-01   +9.375179995437777e-01   +2.869294856759857e-01   +2.303174507421091e-02   +5.621668299155068e-01   +4.461277265806238e-01; +2.143583208549635e-01   +3.687206278525135e-01   +9.796339394289565e-01   +1.457108642842576e-01   +7.149989516330961e-01   +1.019774178060743e-02   +3.086090003675325e-01   +8.743471468290241e-01; +8.523879143222850e-01   +7.942630135168716e-01   +7.111485171745145e-01   +3.243208302369537e-01   +8.859100074401033e-01   +3.357627525950575e-01   +2.637904347116952e-01   +4.029012641232937e-01; +1.557151340922854e-01   +7.227559579524973e-01   +9.918475710015929e-01   +4.268536544402536e-01   +3.676807625676730e-01   +6.664564630083496e-01   +7.193407747348693e-01   +1.659025801129997e-01; +6.691480792955090e-01   +9.525437378356039e-01   +6.496943880092525e-01   +7.083441292585094e-01   +5.625323803874159e-01   +5.912600138779277e-01   +3.066912093628953e-01   +6.650652205516124e-01; +9.346493265944258e-01   +1.304023893491121e-02   +5.028801408371395e-01   +6.203965537471250e-01   +8.819895599916672e-01   +7.884756007781962e-02   +9.034764101560512e-01   +9.317629559714576e-01];
L2E_L2I_iGABA_netcon = [+6.536181643983605e-02   +5.244696322459982e-01   +3.448443588384776e-01   +2.591454977001773e-01   +4.534907361448051e-02   +9.035856006738054e-01   +3.426339181384760e-01   +4.549394758988952e-01; +3.552177650729638e-01   +6.071080997239357e-02   +5.573456498334771e-01   +9.830336231203184e-01   +3.634008903624067e-01   +5.544791972298897e-01   +9.360313733841914e-01   +6.680162179469721e-01; +9.290380385866496e-01   +1.811001567808653e-01   +6.887285329795050e-01   +3.483016109976501e-01   +4.188018465489964e-02   +7.113378293012073e-01   +9.112325124506290e-01   +7.725251544691650e-01; +2.402779221946266e-01   +3.166714447388501e-01   +3.441639408872657e-03   +3.925802036828909e-01   +4.904541741140826e-01   +7.179047109704791e-01   +7.301409519344292e-01   +9.272104309802017e-01; +1.115900437435636e-01   +2.455182728529442e-01   +5.063843763644858e-02   +7.521614996313637e-01   +7.304915831086198e-01   +1.739214728122269e-01   +4.445634558341570e-01   +6.515642349845392e-01; +7.099322364623636e-01   +3.179318920134425e-01   +3.056839132552909e-01   +1.103095599389466e-01   +1.321408610512093e-02   +3.534954636734420e-01   +1.471648896273637e-01   +5.024938190015561e-01; +4.019580612441121e-03   +8.710796965215986e-01   +8.764840184372142e-01   +5.962793465096210e-01   +5.064136446202774e-01   +3.724501278623738e-01   +8.305525342049835e-01   +3.431054387077725e-01; +1.796664684233471e-01   +3.003129732623917e-01   +6.261302187648047e-01   +1.232131040229164e-01   +2.497958856830526e-01   +7.601808326064503e-01   +2.474202892670603e-01   +9.411785422095925e-01];
L3E_L2E_iAMPA_netcon = [+7.806641190811890e-02   +1.758916141838487e-02   +3.701119191572664e-01   +4.928594931337614e-01   +1.969264456403109e-02   +9.645797594844875e-01   +3.582970531373629e-01   +2.187084510715980e-02   +2.036697713716561e-01   +6.728093283863604e-02   +2.424292492736200e-01   +1.000000000000000e+00; +9.551680116295513e-01   +9.861263769989674e-01   +1.201459903424399e-01   +6.748546824369038e-02   +8.087491456944129e-01   +3.892923511940186e-01   +2.296376861613720e-01   +1.302088573907740e-01   +3.553145642308103e-01   +7.491153855619427e-01   +5.423858457801950e-01   +3.407749134073337e-01; +6.638156470468254e-01   +7.234846150560844e-01   +5.090933503405154e-01   +8.709566861006022e-01   +7.981063827315789e-01   +6.621598592039701e-01   +7.243565931998617e-01   +6.694744376068686e-01   +8.951888696503241e-01   +9.973784774965655e-01   +3.354155334501422e-01   +8.303627997139810e-01; +1.700069739134943e-01   +8.786391307751524e-01   +6.146573131369429e-03   +9.997624837702186e-01   +4.168559064920523e-01   +5.846284845399404e-01   +7.738459590910348e-01   +5.108254688519354e-01   +8.178623026612195e-01   +7.699138361135799e-01   +6.689413061583397e-01   +1.127691835335222e-01; +1.988644656750628e-01   +8.164632369301970e-01   +8.731960208291690e-01   +1.205776557687792e-01   +6.395136787609642e-01   +4.897187944779902e-02   +3.354610351935092e-01   +7.477289107805442e-02   +3.167455478034112e-01   +8.933965083134989e-01   +8.803219957023971e-01   +7.803048342537768e-01; +9.903312807786241e-01   +3.526521164088071e-02   +9.071701984634006e-01   +1.061052282359563e-01   +5.687785253851205e-01   +7.795255764031112e-02   +5.729527432128587e-01   +5.363699656936313e-01   +6.007429000563771e-01   +4.444005584574499e-02   +9.760672569284242e-01   +1.532993717972246e-01; +9.352344146902469e-01   +9.437070575533514e-02   +1.114166565324601e-01   +1.490681112769203e-01   +9.114373452196212e-01   +2.281250237798174e-01   +6.368264910530657e-01   +6.869024212197783e-01   +7.050928098196323e-01   +7.983353565890060e-01   +1.349122485962738e-01   +7.319145232443740e-01; +9.802987825326894e-01   +9.571116036684243e-02   +4.187749944799404e-02   +1.294661668229645e-01   +7.560561025791026e-01   +4.144668951749114e-01   +3.654586848917262e-01   +5.911444870640404e-01   +1.798926124888406e-01   +7.145028120173771e-01   +8.822180402014378e-01   +1.167270370288347e-01];
L3I_L2I_iGABA_netcon = [+7.680097477042659e-01   +5.392000038818405e-01   +5.993845575257176e-01   +3.081145534713609e-01   +9.609861702943056e-01   +1.124803746461450e-01   +2.964306450282326e-01   +7.949884542537619e-01   +9.195531255588517e-01   +9.947143306975523e-01   +3.101181193978700e-01   +9.939913356348429e-01; +6.376231561665642e-01   +4.503626897722898e-01   +5.629356631494185e-01   +7.596723864251780e-01   +5.479717542946985e-01   +6.318875182153022e-02   +1.657636013210572e-01   +5.139041216442494e-02   +3.870796017699800e-01   +2.922197304049414e-01   +4.432408864924514e-01   +9.169212127499029e-01; +8.008967301227428e-01   +1.155272639938546e-01   +7.334307713506105e-02   +6.503148984948571e-01   +9.794310193125086e-01   +4.562754273155070e-02   +7.222409713136950e-01   +1.828536147946702e-01   +7.476333718340793e-01   +5.228063608260366e-01   +2.041532018616525e-01   +6.932044410300588e-01; +9.647808666675317e-01   +7.155053104993874e-01   +7.635073675506246e-01   +3.313517053318699e-01   +1.244520636177866e-01   +1.287279822077538e-01   +2.986406785911888e-01   +2.469083529315735e-01   +8.782521315877295e-01   +3.620095277281833e-01   +9.412422653491409e-01   +2.183433390450595e-01; +7.129241477618833e-01   +1.839349176006325e-01   +8.703293518613575e-01   +9.783531272420491e-01   +1.598320387471107e-01   +4.901673068324389e-01   +6.759421967532178e-01   +2.562152783983683e-01   +3.988818773329258e-01   +5.203663788635882e-01   +2.910421112026269e-01   +3.088435213873966e-01; +6.452963313096226e-01   +3.273377510033438e-01   +7.003634329910486e-01   +5.307531903786110e-01   +3.341609676703088e-01   +4.688247055222226e-01   +7.543229036840396e-01   +6.502923956568005e-01   +1.692638244880187e-01   +4.960150910919937e-01   +1.172385036336217e-01   +2.269496905986767e-01; +5.172759615066312e-01   +9.701949648754472e-01   +1.108315511388701e-01   +7.517613189901264e-01   +5.297699601238567e-01   +1.557686433543302e-01   +7.444776053334422e-01   +1.004493253767516e-01   +4.444387890517222e-01   +1.839807897980912e-01   +6.748795512194550e-02   +7.037139218596878e-01; +9.535841624703260e-01   +6.947489506014646e-01   +6.628142092422211e-01   +2.659548587842804e-01   +6.895780675628290e-01   +1.330254609690102e-01   +7.807104631716122e-01   +4.697727694708068e-01   +8.527910361384262e-01   +4.856820277324421e-01   +7.276208689804542e-01   +3.776579794043523e-01];
L2E_L3E_iAMPA_netcon = [+6.518187785491876e-01   +3.826564123902498e-01   +2.305223155574431e-01   +4.658545140724357e-01   +9.104197805963400e-01   +9.530281034871063e-01   +7.624875195050784e-01   +3.542804524718644e-01; +3.781832674031537e-01   +2.598926920692899e-02   +9.129011669477026e-01   +2.868570488086080e-01   +6.803166118998073e-01   +1.770409591626751e-02   +8.941051631995447e-01   +6.650581460799265e-01; +3.047158209794041e-01   +3.289789688448468e-01   +4.877161912061015e-01   +2.735010813365933e-01   +8.437721848851798e-01   +5.016085359347727e-01   +7.934141620041387e-01   +5.939952457217057e-01; +1.571386821389089e-01   +4.944816871539147e-01   +5.891412436888919e-01   +1.464923018964675e-01   +9.618590461308615e-02   +3.352981901692372e-01   +9.439252418406699e-01   +5.116795441910677e-02; +7.779791837258884e-01   +2.695651618820687e-01   +9.533801138794926e-01   +1.404895861790223e-01   +7.359683491685249e-01   +6.662775088459462e-01   +5.356630101336713e-01   +2.117039031244478e-01; +7.136300160434812e-01   +5.319233871251868e-01   +8.487549248033933e-02   +2.639507352940543e-01   +5.499143533986754e-01   +1.632667484823925e-01   +1.591762430205014e-01   +5.968426972505588e-01; +1.750284857946046e-01   +4.188982754806973e-01   +2.215607014378139e-01   +6.064786136462589e-01   +2.499487100857853e-01   +2.245621688728128e-01   +1.345317484513090e-01   +2.671268305096915e-01; +4.475490959931773e-01   +8.480545529247175e-03   +1.617317103588171e-01   +1.015865519853806e-01   +7.200643616407717e-01   +1.115351892463702e-01   +2.602430533171193e-02   +1.163635705947953e-01; +8.407696134351417e-01   +8.944846750684663e-01   +3.906527449647240e-01   +4.933706866852232e-01   +3.639344645059841e-01   +9.927324526300016e-01   +6.890017914779734e-01   +2.172755526962083e-01; +7.018818459763824e-01   +2.379846451517540e-01   +1.860636770675851e-01   +8.928392638000150e-01   +8.478350975119485e-01   +1.449139355574637e-01   +5.812759509791751e-01   +8.774434933176595e-01; +7.656233072794592e-01   +8.028334307092583e-01   +7.603595564924115e-01   +1.860420835561868e-01   +8.227718512500057e-01   +7.673566999203870e-01   +2.985345947989896e-01   +4.613342954178677e-01; +9.781890750630309e-01   +5.805199156365398e-01   +2.337606059217365e-01   +5.411958964694850e-02   +6.203243492185673e-01   +6.279784596024789e-01   +7.290831721964737e-02   +7.308273761432731e-01];
L2I_L3I_iGABA_netcon = [+5.885423682792190e-01   +1.440816683402188e-01   +3.445967150036677e-01   +3.716417229633526e-01   +5.975897994379411e-01   +5.116807117869246e-01   +7.746827604742202e-01   +2.649212215441458e-01; +8.433526938789739e-01   +9.896111984249478e-01   +4.180515592166367e-02   +5.373114346509423e-01   +4.781456844123402e-01   +2.433820753214222e-01   +1.826170878727809e-01   +5.961132834444914e-01; +6.056592988434822e-01   +4.787190466003364e-01   +9.488515630081230e-01   +9.715138759171755e-01   +3.777015256440912e-01   +2.672646433297745e-01   +4.525314717058301e-01   +6.843806720366612e-01; +7.485977669107905e-01   +4.047813869487743e-02   +8.586972851566623e-01   +9.966557103640690e-01   +9.810867464992266e-01   +4.140733843982055e-01   +3.040725839621402e-01   +4.157906672425419e-01; +8.542293699451060e-01   +2.705462544941810e-01   +1.361747820146672e-01   +4.095680694493757e-01   +1.395793390093971e-01   +2.632983193251169e-01   +3.811357218728684e-01   +5.163116079539978e-01; +1.453349001118172e-01   +6.734565095052220e-01   +5.806259706332969e-01   +4.487163194161530e-01   +2.717889698871914e-01   +8.548407753003193e-01   +7.957749239000164e-01   +8.121684711568968e-01; +7.377168408492943e-01   +1.420311879716608e-01   +6.268391674018392e-02   +2.419863731819415e-01   +2.245089603082189e-01   +4.812650658790495e-01   +7.818857456277598e-01   +5.428062601425004e-01; +1.460554057163357e-02   +7.733712420575392e-01   +9.519356885866646e-01   +5.949658019209819e-01   +7.934966996046816e-01   +3.322839463017486e-01   +6.448055134751084e-01   +5.922903001954801e-01; +2.306615273662618e-01   +2.677373126744307e-01   +4.996316318521167e-01   +7.464597559568051e-02   +8.187408804785933e-01   +6.306803749679960e-01   +2.395312581359341e-01   +5.392598734821293e-01; +5.390848431679931e-01   +8.818256732431989e-01   +2.430709042680318e-02   +9.098261612755730e-01   +8.038992282731275e-01   +4.175264763779719e-01   +6.032373108339690e-01   +5.435066199550738e-01; +7.104692873466905e-01   +3.632641692143610e-01   +5.438707143449962e-02   +4.757315847039807e-01   +1.187040173541071e-01   +5.409577074826297e-01   +4.195658674397023e-01   +1.524991638559444e-01; +4.341682378440334e-01   +1.445888168442609e-02   +3.091044861433251e-01   +5.021579387291176e-01   +6.414350203501337e-01   +3.387277654331625e-01   +2.999104950194565e-01   +6.983871586438323e-01];
L3I_L3E_iAMPA_netcon = [+6.151350301184992e-02   +7.781613528903651e-01   +5.571933972624877e-01   +5.676147458816707e-01   +9.116533039333006e-01   +8.349072747737065e-01   +8.494431148179657e-01   +8.638063066166277e-01   +5.298982145449704e-01   +9.917326766926396e-01   +4.805323842203431e-01   +3.511153265175923e-01; +9.204426859544051e-01   +8.329175261003274e-01   +8.487989701758065e-01   +9.358419252692648e-01   +5.886548893322013e-01   +4.005099445197445e-01   +6.270920209660553e-01   +8.532826631674825e-01   +5.710690019779572e-01   +6.997962416813822e-01   +7.415509740831397e-01   +3.973323980369640e-01; +1.826864221451076e-01   +5.944274264866490e-01   +9.704119527402969e-01   +7.745570203899328e-01   +5.758060008433391e-01   +6.929911230893179e-02   +4.427139397410225e-01   +9.465190975638403e-01   +9.780950668106055e-01   +8.377126606769506e-01   +5.906865450694325e-01   +9.947302692790454e-01; +5.343558798288720e-01   +7.588404295703817e-01   +4.678575064296785e-01   +5.999167611625955e-01   +6.517820901076314e-01   +3.771559945861102e-01   +2.276552430692080e-01   +6.946473028023479e-01   +9.585598151407244e-01   +7.302441091854677e-01   +2.547276277045243e-01   +2.904884391495264e-01; +3.988483186749908e-01   +6.583181028976233e-01   +7.746441937584616e-01   +6.558708199355394e-02   +4.301446266989256e-01   +8.608641914720805e-01   +4.975076192713037e-02   +3.598546857795226e-01   +5.563838392504645e-01   +1.000000000000000e+00   +6.120193912960171e-01   +2.362932958992601e-01; +9.952578068571586e-03   +5.856745778203813e-01   +2.342214157798436e-02   +5.320018940549477e-01   +9.391064604498847e-01   +2.967680840419567e-02   +7.061485964150387e-01   +3.805345094355780e-01   +5.219400671536895e-01   +5.056094398642493e-01   +2.299130927234667e-01   +3.297365236212033e-01; +1.077769694899128e-01   +2.267065216768909e-02   +6.760492578826036e-01   +8.594066470462072e-01   +1.031189751247854e-01   +4.240808094668487e-01   +8.507749196241107e-01   +8.521325701310498e-01   +4.721595794667659e-01   +1.932168672345828e-01   +1.918158651616703e-01   +1.666957132759502e-01; +8.535365461975416e-01   +6.862076995057189e-01   +8.385478081023819e-01   +3.417708894059367e-01   +4.119107669138778e-01   +2.471523676977877e-01   +4.014056098871874e-01   +3.843701942366002e-01   +8.932967536195442e-01   +9.512219327761848e-01   +4.717311216079031e-03   +3.851684299700053e-01; +3.349803240661465e-01   +3.237382716679553e-01   +6.912539859144535e-01   +1.811355605437709e-01   +8.942901222825341e-01   +7.208918548929250e-02   +2.884193256188035e-01   +7.712312842293313e-01   +4.818552819810942e-01   +4.524755447629927e-01   +6.531856870583840e-01   +5.282145378546290e-01; +1.438080739883884e-01   +8.823494167339831e-02   +8.975081612103230e-01   +8.844278593797384e-01   +7.353693847527328e-01   +9.188382819003670e-01   +2.551838785197071e-01   +7.798271995469332e-01   +4.910281172061120e-01   +6.021410468988974e-01   +4.023019184934308e-01   +5.929452498413892e-01; +7.982931926971327e-01   +7.477514466341564e-01   +8.949997107175243e-02   +8.434507791728230e-01   +9.567296990384440e-01   +2.677277620541803e-01   +5.121245177093450e-01   +4.248495895126933e-01   +3.095368371382126e-01   +6.444358503460711e-01   +2.704993140738839e-01   +1.659907311446725e-01; +6.519846537413004e-01   +9.689104589954555e-01   +7.805293918246918e-02   +8.256664406151526e-01   +9.754485347463592e-01   +1.077755866339115e-01   +1.184087570886929e-01   +4.881158644802031e-01   +8.577243007140645e-01   +7.554188691819457e-01   +6.844702375906576e-03   +6.127927268573093e-02];
L3E_L3I_iGABA_netcon = [+4.421955608990550e-01   +6.189528361480357e-02   +6.970015949339405e-03   +4.994176874678543e-01   +5.396188076582368e-01   +2.498421018432058e-01   +7.200781466329361e-01   +7.601301150635944e-01   +3.802777657444468e-01   +4.491318289112379e-01   +2.008120910737162e-01   +6.555887718549702e-01; +5.923126079521669e-02   +8.066707159378314e-01   +1.285152631282798e-01   +1.933158304173443e-01   +2.199442763350408e-01   +3.377708847616664e-01   +2.223185823915835e-01   +8.870423077497195e-01   +6.079348097642863e-01   +3.925158080870108e-01   +8.300180117976683e-01   +9.019280016784165e-01; +6.264814026761127e-01   +9.125290274850744e-01   +3.095114089182164e-01   +6.458404201841254e-01   +2.681839895233075e-01   +6.023119905669455e-01   +4.954272776632623e-01   +7.286445994204892e-01   +1.622077066417948e-01   +6.753853397603653e-01   +4.404309694339782e-01   +8.356396024819069e-01; +8.084381038964872e-01   +4.231453359904259e-01   +2.374926123743907e-01   +2.556061988582859e-01   +1.346679439305521e-01   +4.782653463628336e-01   +4.753517706225376e-01   +6.887918859375812e-01   +1.022606710101094e-01   +3.194457045695005e-02   +4.157694211664818e-02   +1.667739391880416e-01; +4.037934997116631e-01   +1.883163242775005e-01   +6.511747025247501e-01   +9.412296960219192e-01   +1.161819233714123e-02   +9.007090902460926e-01   +4.354096928748701e-01   +6.497110058604675e-01   +6.163474474034727e-01   +7.813709697415991e-01   +7.657543833136214e-01   +1.622379164691937e-01; +8.880723837900478e-01   +1.868904666762485e-01   +8.055532508656483e-01   +2.908036764708889e-01   +1.413604276064284e-02   +2.870434203902555e-01   +5.586953671429105e-01   +6.206810842816390e-01   +9.606089201252894e-01   +3.742403503020957e-01   +9.319453817838154e-02   +1.353048243385370e-01; +7.198088519049255e-01   +6.693270547508524e-01   +7.353072158114616e-01   +1.462769444675480e-01   +9.890438398303989e-01   +7.813664764771436e-02   +2.051124869546621e-01   +7.802733585824512e-02   +6.690528923829970e-01   +6.387598922461596e-01   +6.547945045354908e-01   +1.533879288881506e-01; +2.036087852386088e-01   +5.228590327579202e-01   +1.208621289741547e-01   +8.660422922354878e-01   +6.479466897501071e-01   +3.844190234445862e-01   +2.770651451828922e-01   +5.470380010488316e-01   +4.723586868501429e-01   +4.932105705552816e-01   +2.642849787464628e-01   +3.962171915694210e-01; +3.740864630551479e-01   +7.800125684656303e-01   +1.747968872686570e-01   +8.856894957584728e-01   +8.074882487448762e-01   +1.841581700870797e-01   +8.038922832833093e-01   +8.763818057968619e-01   +3.339926565743990e-01   +2.278316515517704e-01   +4.399567469735609e-01   +6.572078683322400e-01; +2.114577877176247e-01   +3.027731065662601e-01   +2.631355298135770e-01   +6.581082836791383e-01   +2.799975301140775e-01   +7.298057613698462e-01   +9.931564077815623e-02   +9.848680456869844e-01   +5.879692848015403e-01   +2.121515626372855e-01   +8.489218277702446e-01   +2.209706089476858e-01; +2.579005930497821e-01   +4.699433538003963e-01   +8.163219540858117e-01   +9.966322090785259e-01   +1.403065769473544e-02   +4.277834572658162e-01   +3.721601541224821e-02   +6.760488945523406e-02   +5.488605772020582e-01   +4.534293004653001e-01   +9.048228201390000e-01   +6.415910322127962e-01; +9.941947749542597e-01   +7.073871224714853e-01   +5.895205944782156e-01   +2.613462766907506e-01   +1.018818209256870e-01   +2.663693018492055e-01   +7.076053840094294e-02   +3.005645572524490e-02   +4.106404703858133e-02   +6.267622622155552e-01   +2.828270597924589e-01   +6.123821557571285e-01];
L2E_Input1_iAMPA_netcon = [+9.979758981002664e-01   +9.969178803956142e-01   +9.982624809696534e-01   +9.928462702484635e-01   +9.931351909688547e-01   +9.990788257858226e-01   +9.918761777542955e-01   +9.954177893299238e-01];
L2I_Input2_iAMPA_netcon = [+9.994299726901281e-01   +9.968177962906976e-01   +9.969897770645239e-01   +9.947316006156314e-01   +9.978551236828036e-01   +9.950351719159054e-01   +9.977305338774687e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
