function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.069780592722634e-02   -4.689657193100566e-01   +1.640011258171537e-01   -3.519527908612360e-01   +5.767321290154286e-02   -3.751965361077509e-01   -2.738315729479430e-01   +4.360023653208898e-01   +3.759056269606057e-01   -3.164490206662008e-01   +9.819936560301694e-02   +8.491216377715260e-02   -2.146661411235322e-01   +5.143040968042270e-01   -3.560785378942793e-01   -2.219319364353285e-01; -2.056232847844197e-01   -3.592359970403899e-01   -1.751470635049242e-01   -3.406456270008077e-01   -2.253138578238920e-01   -2.994775278732455e-01   +2.682602574907742e-02   +5.284256569039453e-02   +1.208162497199292e-01   -2.315375022036067e-01   +1.637248854410867e-01   +1.770574799073631e-01   +1.559945254401194e-01   -1.139895353617782e-02   -1.873661987075088e-01   -8.449736067185853e-03; -1.858712333630679e-01   -4.502796835324643e-01   -6.027678994821697e-02   +8.020440216557871e-01   +4.980381272753176e-02   +9.355748050329918e-02   +2.720745115705929e-01   -4.961310364912722e-03   -3.034072465394755e-01   +1.701182180650938e-01   +2.154824768718689e-01   -1.270386352647714e-01   -7.213389062586326e-01   +2.743805875792414e-02   -3.378873894084363e-01   -5.559839667084496e-01; -5.386407634350668e-01   +2.473490465394192e-02   -4.475070227023605e-01   -2.248284130993657e-01   -1.157855383786075e-01   -1.033609440280916e-02   +1.168136100533933e-01   -3.151121708633888e-01   +6.122589954761885e-01   -2.244892450851489e-01   -9.089693111671535e-02   +4.224432342459411e-01   -9.831007993033175e-02   +8.458350014745346e-02   -1.569052931049914e-01   -3.962293865136371e-01; +6.075429760555352e-02   +4.137555583923979e-01   +5.958054050534369e-01   +3.054810310416955e-01   -2.065335862263924e-01   -5.386164487239535e-01   +4.829372914105015e-02   -3.354963502416680e-01   -4.886815909454216e-01   +4.956041670792227e-02   +1.989988964773645e-01   -1.794694265331722e-01   -4.675664257568809e-01   -3.905954831495341e-01   +4.220965709929684e-01   +5.498441749286969e-01; -7.237059324666402e-02   -3.008271294541498e-01   -3.412715110343998e-01   +9.450830500302164e-02   +5.539947361400649e-01   +6.539177626791719e-02   -3.237308862460879e-01   -2.885856065470777e-01   +2.623782131625170e-01   -7.109146449471505e-02   +3.557111741783868e-01   -1.547828210608866e-01   -8.406269017769463e-02   +3.650478702964011e-02   +2.234626922682328e-01   +6.124063540088823e-01; +3.954180162829273e-01   +4.833815586617196e-01   +1.316572702319453e-01   +1.200936561748742e-01   +1.893851787638485e-01   -3.609224397635987e-01   +5.130384905796772e-01   +4.179628878433563e-01   -1.757195611079841e-02   -1.479289036116451e-01   +5.419380318203152e-01   +4.397285850197179e-01   +3.836990867029906e-01   -4.006973172232648e-01   -2.716544442783613e-01   -2.286951598111474e-01; -5.187186929649865e-02   -3.357378921979624e-01   +4.680861629620480e-01   -2.324405048163398e-01   -4.050379988800291e-01   -1.731144268027508e-01   -4.308050940453706e-02   -5.863780214194630e-02   +2.000664875488462e-02   +1.463580503593769e-02   -1.456514322420729e-01   +3.640561047708721e-01   +3.698997303099580e-02   +4.488104096164690e-02   -1.942839386876719e-01   -7.535884611499495e-02; -2.076923889592695e-02   -5.443376195567085e-02   -3.595731240082810e-01   +2.071199898738610e-01   -2.127281052019882e-01   +1.083239001190748e-01   +5.975455605410499e-01   +3.526274682795016e-01   +8.560248912817439e-02   +4.660594571114779e-01   +9.082091553326777e-02   +1.690161036303671e-01   +2.280990204685370e-01   -6.149134308234284e-01   -8.052961808673342e-02   +3.373512891465523e-01; -1.339389351562678e-01   +3.917966731492044e-01   -1.171327602106891e-01   +1.283811399154122e-03   +3.543569412905542e-01   +1.367457785710459e-01   -1.434840765523585e-01   -2.352754453881890e-01   +6.533196534306772e-02   +4.687816952376275e-01   -3.495833781945654e-02   +4.459986501966121e-01   -1.587597115133711e-01   -5.355696574839364e-02   -2.083602835526591e-01   +3.156252971232960e-01; +3.543780129604982e-01   -1.034699314648512e-01   +4.822884994043751e-01   -4.165405782031433e-01   +1.468413696643454e-01   +1.916125888485047e-01   +1.205271006111778e-01   -5.566192264520057e-01   -1.754252509721905e-01   +3.174932587638748e-02   +2.018510546067974e-01   -7.304466873294448e-02   +2.268019160819896e-01   +1.165121832519690e-01   -3.330413623753918e-02   +4.312770036573833e-01; +6.219886485231542e-02   -8.014668258939645e-01   -2.195438209597085e-02   +2.353468260090159e-01   -2.253613828693765e-01   -2.482337097617573e-01   +2.809820535789431e-01   -1.905396643244670e-01   +4.171311850192966e-01   +1.481521806633743e-01   -4.554806134525265e-01   +6.152182310471130e-01   +3.362890596502131e-01   -6.632364993870327e-02   -3.578176771623604e-01   -1.817698867221675e-01; -1.682670614353947e-02   +7.380931871776183e-02   +5.264834934476853e-03   +7.670101059180567e-02   +5.143602378005916e-01   -2.699590500843767e-01   +1.882067809038247e-01   +4.807151359270619e-01   +4.565531082094504e-01   -8.587359572079335e-02   -9.841973078994876e-02   +5.501882275053597e-01   +4.574895437151351e-01   -3.670907734531448e-01   -4.815257903831423e-02   -2.055804692493336e-01; +1.419501389583823e-01   +1.641059212583073e-01   -5.357932279521816e-01   -1.388477404056317e-01   -2.527663381402824e-01   -2.826057553560909e-01   -5.828025535251929e-01   +3.739122442749335e-01   +2.222763819277440e-01   +6.447098195313989e-01   -1.876688280510866e-01   -1.708144118103720e-01   +2.414799921875217e-03   +3.479469867673386e-01   +9.171460715691093e-02   +2.734716455951645e-01; +1.304183691618839e-01   +5.632426819791906e-02   -2.040973325604134e-02   -2.582574706145607e-01   +2.874139430306951e-01   +2.361658716434506e-02   -1.560696842893087e-01   +2.037341402473670e-01   +4.997062453061323e-01   +1.225388984731898e-02   +6.898076221780961e-01   -8.529238288217145e-02   +6.702454193845467e-01   -3.976280693899277e-02   -3.777369301964731e-01   -4.558511795116819e-01; -4.067685553957139e-01   +2.602119444075797e-01   +3.348778583944954e-01   +2.793862698617492e-01   -8.032094257994311e-02   -7.096377498089321e-02   -7.302600851033589e-02   +4.549183842538747e-01   +3.680890642800839e-01   -1.951082591182526e-02   -2.998515407579706e-02   +6.177507765090027e-02   -9.641305337764006e-02   -2.828816654430417e-01   +1.124580422296690e-01   +1.296238551150419e-01];
L1E_L1I_iGABA_netcon = [-2.231729576024290e-01   +3.429966401440078e-01   +2.682685146248804e-01   -1.939779531781141e-01   -3.878656673591767e-01   +4.549588380263010e-01   -2.245474715315807e-01   +5.565015768813628e-01   -1.199346439287413e-01   +2.146034977406298e-01   +1.467516924767487e-01   +2.922492375112524e-01   +3.100201143514156e-02   +8.346713540093138e-02   -1.960083629112953e-02   +2.501320378326704e-01; -1.352071239929373e-01   -7.012175426809847e-01   -7.590495598705138e-01   -2.640153738472398e-01   +8.725642112827647e-02   -3.028256204046205e-01   -5.081690414564713e-01   +3.623310119842635e-01   +4.337590450656745e-01   -2.643934614697022e-01   -1.317383209608044e-02   +2.919094696976310e-01   +3.069676589177460e-01   +3.023547198214835e-01   +1.477411034678432e-01   +1.347508709715496e-01; +5.237380259328052e-01   -3.438022019136365e-01   -3.606300932379748e-01   -3.271177295049831e-01   -2.726003054149884e-01   -2.781035508348838e-01   +3.240001379433782e-01   +3.880446126763479e-01   +5.987951926640193e-03   -3.222008650326690e-01   +3.714676247859663e-01   +7.835811347185871e-02   +1.511840941878723e-01   -4.710100437273274e-02   +2.732122376798519e-01   -2.906668659302004e-01; +2.424735263460150e-01   +7.309708766159162e-01   +4.219428688719544e-01   +3.474448199218315e-01   -6.020798284250377e-02   -1.428849709470129e-01   -3.250500933317371e-03   +4.235209404993361e-01   +4.858299150296202e-01   +1.573791252186041e-02   -5.362558707554010e-01   +1.182414440498790e-01   +1.543598346163780e-01   +6.807463199845473e-03   -7.730845391385370e-02   -1.453334645085639e-01; +2.724220708873444e-01   +6.948376265447069e-01   -4.667941896102985e-01   +2.961729845740735e-02   +1.032604148395510e-01   -3.324305425370300e-01   +4.647196505331715e-01   +5.977500131960715e-03   -2.471637808344826e-01   -2.802095468732730e-01   -1.694992651069631e-01   +3.662958280509857e-01   +4.962699666503344e-01   -2.709090956069189e-01   -4.644046683240630e-01   +2.966756880318372e-01; +2.681504862894846e-02   +1.551697321526410e-01   +2.651010560819905e-01   +5.521798720802412e-03   -4.876427424776595e-02   -5.788558575064537e-02   +1.422720805053182e-01   -4.956794978429674e-01   -1.802673705146343e-01   +5.586183657137517e-01   -2.762698461185542e-01   -4.241208615184094e-02   +4.872817353496453e-01   -4.485099704414535e-01   -2.447495448847050e-01   +3.524178517069261e-01; +7.366352473973156e-02   +2.195675250894318e-01   +2.576176584263618e-01   -7.281802645825891e-01   +3.721069408180805e-01   +3.045722400839330e-01   +2.594805940516666e-01   +1.813003798567954e-01   -1.959103200802413e-01   +2.600607397815036e-01   -1.750843606863590e-02   +3.414758169095898e-01   +4.776529897595125e-01   -3.032435126081656e-01   +1.822582188233097e-01   +2.806728118053055e-01; -6.972809442003430e-01   -1.657654891116275e-01   +8.098491193341631e-02   -1.247011714707734e-01   -2.185564850648759e-01   +7.375965028537423e-01   +2.016614297433919e-01   +9.722028487932510e-02   -3.325308062468053e-01   +4.097796392019811e-01   -4.779466318093903e-01   -1.364994019339137e-01   -4.168973351346106e-01   -1.580798224455671e-01   +7.477097776486488e-02   +1.934454337055272e-01; +2.209753544831546e-01   -5.321703803798092e-02   -4.062842718811810e-01   -4.056810936699091e-01   -6.169739877339347e-02   -1.789767679534137e-01   -1.131743207446510e-02   -4.335389470419240e-02   +2.194001058043110e-01   -2.839876718449551e-02   -1.187800808750130e-01   +1.756409610529052e-01   +3.953081719253352e-01   +3.075162269411889e-01   -5.989058888066385e-01   -2.685426369400738e-01; -2.736145100872845e-01   +4.786826158937394e-01   +1.644644093385899e-01   -2.709218658840444e-01   -5.262932978046174e-02   -1.809859725254648e-01   +6.188340625473665e-01   +1.550460004587425e-01   +1.973121307372466e-01   -3.336877333824215e-01   -2.869654601126637e-01   +6.240381133698323e-01   +1.489268649233026e-01   -4.307847658058696e-01   +2.018364357564429e-01   -3.165111792819429e-01; +2.539147340291714e-01   +3.363902131507217e-01   +6.474854682622412e-02   +6.584430950164234e-02   -3.458421180966005e-01   +1.080311823758142e-01   +1.303358452183321e-01   -2.085037516823427e-01   +5.229359501628315e-01   -3.308578696553821e-01   -7.862381778872987e-02   -1.581180706965626e-01   -2.217481693496789e-01   +9.036888489757353e-03   -5.189638623502602e-01   -3.590829188622287e-01; -3.117928630090246e-01   -2.295942619509853e-01   -2.570184455803779e-01   +4.141351307587958e-01   +3.295263992222980e-01   -7.446760485762277e-01   +1.947602120814875e-01   -2.326785938939146e-01   -1.807652109185910e-01   -4.132677632908168e-01   -4.302303318888200e-01   -3.766381325555707e-01   -7.205928766333528e-01   +5.511928813942903e-01   +1.763602192986164e-01   -7.055247294907406e-02; +3.531075806626858e-01   +6.396622221711297e-01   +3.756321115728304e-01   -6.318293342526513e-01   +3.118231116722943e-01   -5.022840316286922e-01   +2.618009071508717e-01   -5.790184712980966e-01   +2.398307882207221e-01   -1.077524323172217e-01   +1.339466058081988e-01   +5.367282450111801e-01   +1.970280383721650e-01   -1.788465845639024e-01   -8.132754399734583e-02   +1.025023091306969e-01; -1.174000994899026e-01   -7.702244215655462e-01   -1.104564915949912e-01   +3.439365841445825e-01   +3.371613638975999e-01   -2.816236239916907e-01   -3.655320917909320e-01   +4.992351619234817e-01   +3.242504389615056e-01   +2.560881453177455e-01   -2.079423238463129e-01   -1.604007306399929e-01   +2.260664489809172e-01   -2.356982528288395e-01   -4.356163628654317e-01   +2.723226129191093e-01; -1.877828579086260e-01   +1.135318848431646e-01   +2.969523392694608e-01   +1.421462018390137e-01   +3.272351025744948e-01   +2.229929190615929e-01   +3.575144421738222e-01   -2.020261974158447e-01   +3.328694766201205e-02   +2.724297376395327e-01   -5.876259293927286e-01   -8.807842675224825e-02   +6.368061445274756e-01   +9.719796823486662e-02   -3.593496676725358e-01   -1.683821222912866e-01; +3.399741565024232e-01   +1.717284998646384e-01   -6.007580427226981e-02   -6.467671008949527e-01   +1.958215366294270e-01   +3.837239345633313e-01   -2.623293882620850e-01   -1.442368893025168e-01   +4.689110845352851e-01   -1.474588984984327e-01   -2.812318907991541e-01   +1.487847596522877e-01   +1.440622169324397e-01   +3.558501427935686e-01   +4.224337757758204e-01   +3.328746794772763e-01];
L2I_L1I_iGABA_netcon = [+2.507082444230869e-01   -4.393971849059625e-03   -2.746508484268886e-01   -1.449985071461075e-01   +3.675152480131475e-01   +8.626530791990744e-02   +1.017961867081859e-01   +4.307998349805714e-01; +2.713450453914619e-01   -1.470000932547657e-01   +4.064481441068399e-01   -5.304669092353023e-01   +4.164625490305760e-01   -1.419676882600984e-01   +4.868514143821328e-01   -2.899650101122626e-01; +5.765728278153407e-01   -6.436707583932393e-02   +5.130282462301105e-01   +6.371957436182529e-02   +5.965254993741533e-02   -6.088863167062225e-02   -5.675273921048287e-01   -6.768946513875128e-01; -7.211020266150632e-01   -6.345752175256624e-01   -3.746098688884339e-02   -1.957523238788623e-01   -6.287286990968896e-01   -2.332031523850930e-01   -1.760699172491972e-02   -1.305963040429345e-01; -2.373932153743249e-01   +1.277127765619147e-01   -7.670474212650019e-02   +4.802107940849168e-01   -7.831856433054063e-02   -4.193032235966221e-01   -2.480703438149194e-01   -2.609890342485535e-01; -3.159740926072264e-01   +1.953041904611473e-01   -4.207588990921507e-02   -2.051500290222003e-01   -8.553322392877584e-02   +3.049162266399645e-01   +1.771282487329642e-01   +1.324608498198592e-01; +1.949141499145395e-01   +2.650053310825255e-02   -3.727096220961593e-01   -2.437863458190501e-01   +3.617566864965954e-01   -3.052910894725492e-02   +3.024050211752294e-01   +3.356658455119325e-01; +3.510842089735149e-01   -1.943611820450493e-01   -3.764852857864730e-01   +4.417157189869239e-01   +4.436281460076102e-01   +6.942035246275921e-01   +1.231343686153178e-01   -1.585952527615480e-01; +8.064011638960250e-02   +3.257028030938855e-01   -1.162418001008636e-02   -1.848642178838452e-01   +1.884249827434597e-01   +2.990972410448527e-01   +3.854715274275022e-01   -4.040152914845850e-01; +7.022177919840501e-01   -2.056608017450276e-01   +1.012008922653798e-01   +9.618278595066948e-02   -3.420694982801632e-01   +1.340362792499442e-02   -8.231528153858331e-03   -4.211309339273716e-01; +3.553994832992536e-01   -3.878955509770481e-01   +1.838652860111104e-01   +1.154633263972393e-02   +2.675349159379600e-01   +1.139133793184684e-01   +1.525656063729117e-01   -7.754773326846017e-01; +8.073150785079877e-02   -3.022853299523869e-01   +1.191368252192659e-01   -1.661341010781688e-01   -5.217960085135208e-02   +1.752933016077595e-01   -1.082251428225711e-01   +2.055077940549617e-01; -4.521063802458968e-01   +4.520072550318277e-03   +1.527430563645297e-01   -1.655339540272573e-01   +2.329200072470585e-01   -5.295879107594054e-01   -3.470516040262393e-01   -7.865403797044045e-02; -3.642096731135507e-01   +4.073413646397470e-01   +4.545891196570691e-01   -9.568518054012726e-02   +1.580473854003758e-01   +7.594007501567834e-02   +9.604013073839425e-02   -6.046307904821424e-02; -7.768783664003232e-02   -3.890276016410223e-01   +4.679311761880629e-01   -2.059665690891992e-01   +3.436474703215452e-01   -2.864443067924884e-01   +4.268029381572964e-01   -5.243310931389576e-02; +7.288416226585447e-02   +8.068384186890249e-01   -3.195022316307327e-01   +2.082010704949703e-01   +4.329427509571240e-01   +3.975635054435557e-01   +7.162076609889208e-02   +3.289323056906328e-01];
L1I_L2I_iGABA_netcon = [-1.067547710758120e-01   -3.042627435817374e-02   +4.966270000655298e-01   +1.799108638285007e-01   +7.208080492561819e-02   -3.485868288382097e-02   +5.074158494141212e-01   -2.864504082251220e-02   +4.190946136559587e-01   +2.469234251524547e-01   -3.869876602841980e-02   +3.310270884085100e-01   -1.646306223848662e-01   -1.076847373533914e-01   +1.372410307920723e-01   +4.471904026932335e-01; +2.542426480363846e-02   +4.401358005615645e-01   -7.163321599909213e-01   -1.606115054344613e-01   -3.761748061783800e-01   -4.454405118366280e-01   +2.694724300663659e-01   -4.535892886889812e-01   +3.434321716079065e-01   -3.677909595364055e-02   +3.379293959570466e-01   +4.575771517721341e-01   +7.550694826542462e-02   -1.823550537335681e-01   -2.446053354182617e-02   +1.253907306006091e-01; +4.055212397578876e-02   +3.463289851936830e-01   +5.801373731236736e-03   +5.451158682601650e-01   +3.727801005143494e-01   -2.625049788722458e-01   +3.712676224005197e-01   +3.113544597376512e-01   -2.107335968898357e-01   -7.278204848933086e-02   -7.599779141224541e-02   -4.331720293560077e-01   +1.452659768132801e-01   +1.497765124692336e-01   -4.728700041820622e-02   -2.512437341259030e-02; +2.302901888900934e-01   +1.217963586012008e-01   -9.611185438176489e-02   +1.380264580599974e-01   -1.958400616261288e-01   -1.246611238381867e-01   +3.993484144484112e-01   +2.585594216967629e-01   +4.113001927495823e-01   +2.988391534188832e-01   -6.173841671049425e-02   -3.287219061891832e-01   -1.088855514024206e-01   -2.849578518443179e-01   -4.274363088996382e-02   -4.824522704578796e-01; +4.689812031603294e-02   -2.844400127971404e-01   -2.577667733378571e-01   +9.435311006295022e-04   +8.905688096802154e-02   +1.363155792048061e-01   -1.972072038867167e-02   +4.283532121114418e-02   -1.192362025771591e-01   +2.457393221095610e-01   +2.484230451550951e-01   +3.660180429488564e-01   -4.028269097665633e-01   -1.061663402146753e-01   -3.952685222840642e-01   -1.735288515878710e-02; +4.031277827903592e-01   -3.485147047076936e-01   -1.721971396870963e-01   +4.586794488338860e-01   +1.810228292801224e-01   -3.467595234687283e-02   +9.043009945325373e-02   +2.343028586495200e-01   +3.963308768688433e-01   -2.480501490257230e-01   +1.084417628646220e-01   +7.129447864499242e-02   -4.018823701753559e-01   +1.990697656358219e-01   +2.451192064098701e-02   -1.371063883960401e-01; -1.205805910574224e-01   -4.652833882130291e-01   -9.649779356496428e-02   +3.153836882416039e-01   -2.636274414026841e-01   +6.006425931603969e-01   +9.994973532418429e-02   -6.513060884740307e-01   +3.543883245305292e-01   +1.502653080577221e-01   -4.617949712188623e-01   -7.066621358723861e-01   +2.250143272881749e-01   +4.719238421427972e-01   +1.533586939443910e-01   +1.690628248231610e-01; -1.597650013937849e-01   +1.703815479669153e-01   +3.555895814313255e-02   -4.396733391258284e-01   +5.224510905164654e-01   -9.702947472248688e-04   +1.783890617295008e-02   +3.324847869716057e-01   +3.526933103530014e-01   +2.700027114967476e-01   -4.739180301852319e-01   +1.420139173150302e-01   -2.496583296256704e-02   -1.814344083386867e-01   +6.123138584012513e-01   +1.774887540247134e-01];
L2E_L1E_iAMPA_netcon = [-7.528788257408534e-02   +2.578860623351727e-03   +9.510589520099494e-02   +5.261021050127827e-02   -1.394229121266023e-01   +2.461443017697754e-01   +2.104111569287805e-01   -1.909265609979551e-01; +5.365698056649324e-01   +2.449574663987487e-01   +2.301819272748653e-01   -5.552272826807281e-01   -1.066802275764062e-01   +8.772701162806770e-01   +7.284162991764599e-02   +4.905881005075786e-01; +8.811648081413873e-02   -8.129770626183809e-01   -6.562020847612378e-01   -2.928689682994793e-01   -5.421005594633567e-01   -1.783574931339615e-01   -6.721445195232882e-01   -3.332971471404566e-01; +1.425042456156817e-01   +1.022578137480716e-02   +3.698662680281321e-01   +2.930034321977426e-01   -4.962364816316018e-01   -6.476647012584296e-01   +4.631596352324555e-01   +2.651430683102532e-01; -5.500161265027241e-01   +2.354651558385090e-01   +1.179593731229170e-01   +4.948905070361321e-01   -2.411726879167261e-01   -5.230109388226085e-01   -3.710468384597072e-01   +1.012669410709141e-01; -7.082109235215733e-01   -5.723353534644875e-01   -2.155183340098707e-02   +2.976906467932064e-01   -3.837916251851483e-01   -6.670817854898677e-01   -2.130576509191223e-01   -3.645502795451442e-01; +4.515218894442277e-01   +1.988976903608101e-01   -7.217079517458697e-01   +1.096038532569041e-01   -1.422537459673365e-01   +3.351652915581693e-01   -2.580990351181681e-01   -1.543736586269094e-01; +3.773977454234889e-02   -3.892315130442456e-02   -3.550252734927972e-01   +8.166482331053732e-02   -2.681998263622214e-01   +3.850018730075589e-01   +6.498200521365765e-01   -1.132248315030369e-01; +5.982500286423231e-01   +2.917813262512109e-01   -1.862229256191345e-01   -2.592050313368076e-01   +4.340667742151018e-01   +7.957102640680414e-02   +2.903504052529723e-01   +4.838708896409142e-01; +1.194475387912272e-01   +1.941271468852270e-02   +4.416454137858317e-01   +2.261723213077982e-01   -2.789992802926138e-01   -2.204046118531221e-01   -1.365183878785788e-01   +3.499937341449348e-01; +3.633344564883705e-01   -7.565886287053510e-01   -9.161647405213227e-02   +2.840656166525267e-01   -1.851096860657868e-01   -1.386873042563093e-01   -5.003122450648408e-02   -8.551064635889791e-02; +3.933881108662105e-01   -2.086775793813893e-01   +2.648525694849792e-01   +1.135301362722886e-01   -3.361062004739641e-01   -5.567076360261317e-01   -6.987254939540601e-02   -5.436020949725161e-01; +2.458610509279408e-01   -1.908706623875658e-01   -2.115068684115330e-01   +1.690486080377696e-01   +1.029644058463099e-01   -5.089388152976991e-01   -2.107647909972772e-01   +3.522658190113119e-01; +2.437185057170054e-01   +3.907704177609556e-02   +2.874143707849479e-01   +2.446839083218260e-02   -4.718777609956695e-02   -6.832687645088354e-01   +4.884802462507316e-01   -1.797428223703625e-01; -7.909641300349538e-01   +1.540259874591378e-01   +6.083258249532602e-01   +2.828671387060743e-01   -2.947164343942495e-01   -2.935151801146862e-01   -3.045202454473040e-02   -7.042570612031328e-02; -7.291083424714878e-01   +1.200461279896932e-01   -3.003716403452950e-01   +2.586924111470249e-01   +2.095738804989922e-03   +1.003084305276400e-01   +6.933063196498698e-01   -2.695591684881207e-01];
L1E_L2E_iAMPA_netcon = [+4.227332452575003e-01   +9.031058242872686e-01   +1.096079232096651e-01   -2.157238502373563e-01   +1.225924006050451e-01   -1.172220241302542e-01   -1.563974193803635e-01   +9.440407807557297e-02   -5.068391579917437e-01   -2.909634841661786e-01   +4.166455984516853e-01   +1.186001851549254e-02   +5.259551967291459e-01   -1.024845251757831e-02   -5.598113159064703e-01   +1.106777773755002e-01; +5.294071670285549e-02   +1.524800927936852e-01   +2.120688535305628e-01   +2.030713004897386e-01   +4.482675020604412e-02   -7.047235461540647e-01   -3.507277396372437e-01   -8.977451873824151e-02   +5.655437193322882e-01   -4.769857935041531e-01   -2.569747088238948e-01   -4.103587023203148e-01   +5.177496934648704e-01   +4.063126345655778e-01   -3.768936628781508e-02   +5.378644124866007e-01; -5.396989962771020e-01   -3.115450700290524e-02   +5.799695383256510e-01   +3.772619751747686e-01   -4.100975947813257e-01   -5.264376292237627e-01   -1.659043102163732e-01   -2.728820679364613e-01   -7.060540920342540e-01   -3.555141589346740e-02   +2.957728459752034e-01   -7.015003472275333e-02   -2.260571551123105e-01   +1.525658234212863e-01   +2.473450555528205e-01   -6.666692077468165e-01; +1.600131130556056e-01   +4.897500244009713e-02   +1.731500921041682e-01   -2.856802259906324e-01   +1.347264367320442e-02   +2.606729244472371e-01   -2.475312426477428e-01   +1.058488799323021e-03   +3.056438874377034e-01   +2.315434143677128e-02   +6.185765845387577e-01   -1.438402039865416e-01   -2.068295667339028e-01   -4.885062093602459e-01   -3.836612032229526e-02   +3.749698422336703e-01; +1.845112964107548e-02   +1.224536708762935e-01   -4.049803606256853e-01   +3.628894559794576e-01   +4.899478978022985e-01   +2.564966026047282e-01   -1.604454302131215e-01   +2.247425861517221e-01   -1.144538801148731e-01   +1.620009239473965e-01   +1.619384756156764e-01   -1.390471190943879e-01   -4.301192829334095e-02   +3.609463106372006e-02   +1.066023057741724e-01   +2.731347194405912e-01; +1.847810875242442e-01   -1.306781712242820e-01   -3.676902827672385e-01   +8.469893962480385e-02   +1.832076816897331e-01   +1.416412037894796e-01   +7.659772733087997e-01   -2.886275107480953e-01   +1.902796153944276e-01   -2.681740981746997e-01   -3.271126186700167e-01   +7.162159979101491e-02   -2.313190078563011e-01   +3.913615213128783e-01   -1.185921180507832e-02   -3.107627056421857e-01; +3.951543318422593e-01   -2.362053393838911e-01   -4.052610156042732e-01   +7.635382207248387e-01   -5.420652041911634e-01   -5.940575424315082e-01   +2.446531856610097e-01   +4.475206141931993e-02   +1.922815459897556e-02   +1.886169529364874e-02   -3.541314283338565e-03   -5.093565063436797e-01   +3.300058526972326e-01   +4.234500650503061e-01   +1.600636801339706e-01   +1.616014177668801e-01; -2.402795328937134e-01   -1.206857808189546e-01   -2.238238590296851e-01   -1.888247352736807e-01   +5.653655239749224e-03   +4.520223482203888e-01   +4.520186935201699e-02   -5.000743473614488e-01   +2.265879715038859e-01   -3.785125743916534e-02   +9.101584136163898e-02   -6.160206035737859e-02   -3.661453141813621e-01   +1.290046863909496e-01   -2.008663033846958e-02   -1.078390138273586e-01];
L2I_L2E_iAMPA_netcon = [-4.688786978590449e-01   +3.070837851656083e-01   +5.704875577606550e-01   -5.226770244768465e-01   +4.366611342166037e-01   +5.429041470181605e-01   -1.547279900472871e-01   +4.267698476458996e-01; -1.539148309539098e-01   +3.455520590103368e-02   +2.554635650810679e-01   +6.084499536331411e-01   -1.059709295410080e-01   +3.286473201574751e-01   -3.598912000871700e-01   +4.344253055340162e-01; -4.449804283268414e-01   +1.002069963515341e-02   +2.064852789029228e-02   +4.614489269528657e-02   +1.515065821558231e-01   -3.887396699179955e-01   -2.407271448504320e-01   +4.400594441808555e-01; +2.539583780525205e-01   +6.438504657796692e-01   +2.910417070665018e-01   -1.489966352620318e-01   +1.792628839669793e-01   +2.276695292308991e-01   +1.344574343402546e-01   -2.310624077659851e-01; -1.622335892993539e-02   +2.475361898749388e-01   +6.269129227881090e-01   +1.567894870808835e-01   +1.393383273583317e-01   -5.053499003746900e-01   -2.100457101634003e-01   +5.680352317367250e-01; +4.766754860572802e-01   -2.572931589464720e-01   -3.650306307649030e-01   -1.077314720742133e-01   -4.820555646919121e-01   +2.990184691661530e-01   -6.608895693597225e-02   +2.225203899271052e-01; +6.163805567416648e-01   +4.406404701568237e-01   -5.212743576573555e-01   -5.401468284135448e-01   -2.464752330342614e-01   +2.799207358343239e-01   +3.620628130321938e-01   -5.961748292387663e-01; -2.696878652997719e-01   +7.539127786589860e-01   +5.719498879937578e-01   -2.353270976911067e-01   -3.169753771115944e-01   +5.872396334820874e-01   -3.131886064658628e-01   -2.551124152736661e-01];
L2E_L2I_iGABA_netcon = [+2.974404748895975e-01   +5.464411965192711e-02   -2.149043873508214e-01   +5.630938708214058e-01   -2.571683406992052e-01   -1.861508387681176e-01   +7.374598074587816e-01   +9.769577101144343e-02; +1.745929793751135e-01   +4.403790536940049e-01   +2.725132066982362e-01   +9.408651595382067e-02   +2.199571153617390e-01   +1.124807952609790e-01   -3.411428091595290e-01   +5.124068433371042e-01; +1.889463994064649e-01   -1.415074724567972e-01   +3.066347325340568e-01   +2.744318976532071e-01   +4.732989547518183e-01   +8.329309362354029e-02   +4.305043292137467e-02   +4.299593455001128e-01; +1.686144621588265e-01   -1.473825589999441e-01   -4.152604185111218e-01   -5.095500619779809e-01   -2.634378601098967e-01   -1.504073564274527e-01   -2.790436757597179e-01   +2.410649396661710e-01; +2.420203408204694e-01   -3.292823199926062e-01   +3.404855868789182e-01   -2.205820122849252e-02   +1.142501777633087e-02   -4.181102167107979e-01   -1.271721594827186e-01   -3.799562108910112e-02; +1.989813736886144e-02   -6.282585391216684e-01   -3.030393143246299e-01   -4.571424375258900e-01   +4.882639693568702e-01   +9.426245910380285e-02   +2.310045725139026e-02   +1.607887814742204e-01; +3.627858244238394e-01   -1.464183789510404e-01   +1.207040276615429e-01   -4.802363036136200e-01   -2.272875945884680e-01   +6.332905419892569e-01   -3.577125429298841e-01   +4.752101628334882e-01; +2.414502491285842e-01   +5.687128608372961e-01   +3.600209986368929e-01   -3.419131863399143e-01   -8.515093153365780e-02   -1.434488764493395e-01   +2.846143098581010e-01   -4.394186602875023e-01];
L3E_L2E_iAMPA_netcon = [+2.757213537624799e-01   -2.309228793994667e-02   -3.008459287920833e-01   +4.026475970764938e-02   +3.838768532313163e-01   -3.222017747806108e-01   -4.258376071118217e-03   -3.043408639502227e-02   +3.281463827023913e-01   -3.000124889776692e-01   +6.801379894752339e-01   +3.700805992284876e-01; +4.199672451609744e-01   -3.083544536417598e-01   +3.129482328372440e-01   +3.319909284067341e-01   +3.276335621084014e-01   -3.001789462239656e-01   -2.870403157555479e-01   +3.454631330510388e-01   +8.940117658274171e-02   -1.931844433570073e-01   -2.414062952976275e-01   -8.534049961284718e-02; -2.169769406885161e-01   +2.155565986052906e-01   -4.191260752278816e-01   +1.431220354279493e-01   -3.382615921083207e-02   -3.482774910262614e-01   -1.162976816074851e-01   -4.828774177416704e-01   +4.052382802942343e-01   -9.182987286173822e-02   +2.123223226345160e-01   +5.278452277069408e-01; +2.257835087065225e-01   +6.390501028008944e-01   -2.077146898106610e-01   -4.045777115992651e-01   -2.969206549564824e-01   -2.294325950381707e-01   -2.813659915573657e-01   +6.740695834161700e-01   +3.961130834435003e-01   -1.092858548309969e-01   -9.964650470724573e-02   -6.317246379161392e-01; -2.997478196820980e-02   +6.828621092201396e-01   -4.837805486951890e-01   +6.785861491047284e-01   -9.678915276209774e-02   +1.645064908070717e-01   +7.631293322167394e-03   +1.639619983446812e-01   -8.620404386866956e-02   -1.526136542755599e-01   +6.499367254790892e-02   -1.575244821473330e-01; +1.769617413168133e-01   +3.571269848766871e-02   +7.909257890459190e-01   +4.036854800426853e-01   +5.000597932605787e-02   +3.223803218098323e-01   -3.951804468366821e-01   -2.894333307584965e-01   -6.303848750260083e-02   -1.508600566135684e-01   +1.930543790899362e-01   -3.296849010529440e-01; +9.828044681631448e-02   +4.778588446099724e-01   -2.731527271759044e-01   -2.804391041949142e-01   -1.025163435337382e-01   +3.241468491437139e-01   +3.041293481220436e-01   -4.672699129438862e-01   -4.438522491488527e-01   -3.539905109868396e-01   +3.965449874651724e-01   +2.065567823064533e-01; -2.649067476044836e-02   -6.968217102716319e-02   +6.913305899008141e-01   -3.503324142912791e-01   -1.429222682724594e-01   +1.666149202993855e-02   -5.470908751040367e-02   +4.318134408060283e-01   -2.477725243279107e-01   +1.639616580720274e-01   -5.334384978236612e-01   +1.218553118642268e-02];
L3I_L2I_iGABA_netcon = [+2.828065169871012e-01   -8.869021150433698e-03   -3.831917949703462e-01   +1.394267502543477e-01   -2.260340067117989e-01   +3.586988076487918e-02   +1.541184566298177e-01   -1.270718820843538e-01   -2.695746364328616e-01   -4.982972460778450e-02   +3.986886423275415e-01   -1.892756889571140e-01; +1.574001602499444e-01   -7.459724516548254e-02   -1.076013822314732e-01   +3.301566569953687e-02   -3.169176265212957e-01   -1.338985046426416e-01   +2.132826392977968e-01   -1.627914499173090e-01   -4.808324318396266e-01   -2.977520394003860e-01   +4.399366713118371e-01   +2.873216434749502e-01; +4.379666012922748e-02   -1.378231357499741e-01   +2.690832355413927e-01   -4.723275548907431e-01   -2.672556168254341e-01   +1.804241816385219e-02   -9.976433860894056e-02   +1.855158308522303e-01   +8.586972668787508e-01   -2.558418288035983e-01   +4.374543838787358e-01   +1.783382701742705e-01; -7.727255238343075e-02   +3.315392871874713e-01   -7.297151928810802e-02   +3.335595111277042e-01   +2.718896598401636e-01   +1.365308707584302e-01   -3.711015959690531e-01   +1.868185840029534e-01   -2.649856327593632e-01   -1.626197524830770e-01   -3.636850543942423e-02   -3.764300245332011e-01; -1.281406501945311e-01   +5.421503631366742e-02   -2.630576473511943e-01   +1.364612731377454e-01   +8.167375535969626e-02   -2.117468567788077e-01   -6.799885648695686e-01   -2.799827478633204e-01   -2.894868066864636e-01   +5.749333324347344e-01   +2.244802228414877e-01   -6.924698155338582e-02; -2.480171225728287e-01   -4.252325683000744e-01   +6.588043066026686e-02   +3.208630799674756e-01   +1.706871414316040e-01   +4.799127660415304e-01   -2.309537321644197e-01   +4.515340504425100e-02   -2.177692608080043e-01   -2.070211831969173e-01   +3.945023335229373e-02   -3.130602672372351e-01; +2.633520401930813e-01   -3.291576407824391e-01   -3.164051611366224e-01   +8.067399856595436e-03   -8.744657742685583e-02   +1.263275237596107e-01   +1.414199670971313e-01   +5.293192708771089e-01   -5.802205860872910e-01   -2.665560264544236e-01   -1.382830565047832e-01   +2.635864319854215e-01; -4.897366324889060e-02   -4.687944838008143e-01   -1.863750481604083e-01   +2.749997966223103e-01   +3.163828982841929e-01   +4.624628367193501e-01   +4.128142643207499e-01   -1.304017661676770e-01   +1.334054744831157e-01   -2.659507633414114e-01   +3.902746427147211e-01   -7.731724342969103e-01];
L2E_L3E_iAMPA_netcon = [-4.306471477872942e-03   -3.792051635414111e-01   +6.367792058033053e-01   +6.870557082622766e-01   -4.480927616369784e-01   +8.689206076534437e-01   -8.886069607832765e-02   +2.252619102778785e-01; +6.829945954775317e-01   +4.159722505969532e-02   -3.594798762994807e-01   +3.688997589603648e-01   +3.827668758456069e-01   +1.911426452860135e-01   +5.291433224742842e-01   -1.369495300892750e-01; +2.291498199920087e-01   +1.708135843628402e-01   +2.583757846878906e-01   +2.544301153933740e-01   +2.906926630604249e-01   +2.484836038496543e-01   -7.488790151847047e-01   -1.858733673601792e-01; -1.421651997223445e-01   -4.761388609364632e-01   -2.038623953957471e-01   -1.338899871502933e-01   +6.587672780349906e-01   +9.173545982817496e-02   +1.634557345784035e-01   -2.619628192154296e-01; -3.244939543512715e-01   -6.505890685163057e-02   +2.907806817435743e-02   +3.620421689045583e-03   -2.674143820353744e-01   -2.420785372921369e-01   -3.689851032637120e-01   -3.322564953919736e-01; +5.067010375105396e-01   -3.065774424648854e-01   +5.362966312235362e-01   -1.309740214968759e-01   +1.502501894006817e-01   -8.641467839381139e-02   -2.281543532560738e-01   -5.292111600475109e-01; +8.782838620913384e-01   -6.451444775461080e-01   +4.002850899783165e-01   +3.785932632754873e-01   -1.386679421677502e-01   +5.747588114192925e-02   +3.495830676745741e-01   -8.589315016708682e-02; -1.198352137557968e-01   +1.271269706995319e-01   -5.013734833627283e-02   -3.838136838282376e-01   +3.330756540596923e-01   -7.469988588035241e-01   +4.506793232849248e-01   -1.183775045012114e-01; -1.503794449311414e-01   +1.634921151980722e-01   +3.735546804655751e-01   -9.837294193066262e-02   -2.716782609374156e-02   +3.445674917155908e-01   +3.152185516482650e-03   -1.850157931329634e-01; -3.936449797810068e-02   -4.104652774964510e-01   +1.403891931716433e-01   +3.728499231039960e-01   +1.053902055439796e-01   +2.059003754891147e-01   -4.241996205227428e-01   -1.728949689378862e-01; +5.279459220509579e-01   +5.132010415296467e-01   -7.808203562507668e-02   +3.600266479897666e-01   -5.043561801601104e-02   +2.640443331435014e-01   +3.416142364148454e-01   -1.891169747911454e-01; -9.770435932197369e-02   -7.670128405832298e-02   -8.107621829347861e-02   +1.861881794869733e-01   +1.820144995776211e-01   +4.028920532197024e-02   -3.926520691071824e-01   -3.925246626829498e-01];
L2I_L3I_iGABA_netcon = [-6.246457007129869e-01   -5.530976298145311e-01   -9.395039939900133e-01   -4.156696308831264e-01   +2.576244978261720e-01   +4.977813659214981e-01   +2.940815057313566e-01   -6.131131024798847e-02; +1.945642895781310e-01   -1.104935925797045e-01   +4.276228951890658e-02   +1.066966472655426e-01   -4.803503694143759e-01   +4.423889264689110e-01   +6.339578667395358e-01   +2.743211340460470e-01; -3.121929054092991e-01   -3.780410280679232e-01   -3.506925867254057e-01   -4.001242634806421e-01   +4.260525858868295e-01   +5.493513229738328e-02   -4.465017831649820e-01   -4.481976161507487e-01; -1.080537939703503e-01   +6.433236713282062e-01   +3.330698033848373e-01   -3.844198297266441e-01   -7.975464943661588e-02   -7.177701829822364e-02   +3.721325840442405e-01   +4.069685339050539e-01; +3.649463331186727e-02   -6.541450006487656e-02   -1.276910499224251e-01   -1.692313549341011e-01   +6.573010271803840e-01   +2.972052514924118e-01   +4.808694085558803e-02   +2.384636616996937e-01; -3.011482124458327e-01   -2.494930108139224e-01   -3.202712067545663e-02   +5.097352802339039e-02   +1.073757749001079e-01   +7.362522152807072e-01   -4.471841849857150e-01   +1.330105661951105e-01; +3.953077754287584e-01   +6.023793108980826e-01   +2.726553376037011e-01   +3.250189762900588e-01   -4.907369235681562e-02   +1.739419140278674e-01   -3.711608496070018e-01   +7.472206422315839e-01; -7.976694492921985e-02   -3.090509137403888e-01   -4.297189080685411e-01   -4.311443187011128e-01   -2.876874100059061e-01   +8.603921849510361e-01   +2.976765558115451e-01   -2.648237307880749e-01; -1.757062766906942e-01   +1.514508737127679e-02   -1.659616117624811e-01   -7.280139106177960e-01   +1.613299505439547e-01   +3.896888418293571e-01   +2.294487006071367e-01   -3.034249912416105e-01; +1.441296413434937e-02   -2.685805913410971e-02   +5.162847338197162e-01   +3.031442093748061e-01   -1.509093889423122e-01   +5.522328571556707e-01   -1.978885659729198e-01   +2.842404849644639e-01; -1.633059083904278e-01   -1.220164626619642e-01   -1.410171167612431e-01   +4.862366801240015e-01   -4.146832802046907e-01   -2.090285092501949e-01   +1.052380843386865e-01   +5.453894998467196e-01; -4.246888043910096e-01   -1.534078375760969e-02   +7.669284419793159e-01   -1.739318340821772e-02   -6.627184265375144e-01   +1.797172452915982e-01   -6.642270814580702e-01   -8.266520142422680e-02];
L3I_L3E_iAMPA_netcon = [+1.518186897541114e-01   +2.026208925892001e-01   -7.078067248514919e-02   -6.122196656477483e-01   +3.599383432491456e-01   +2.893950118940837e-01   -7.254655792711649e-02   +2.810969097942392e-01   -2.266294599132607e-01   +3.897541498252403e-01   +5.799309177415504e-01   -2.614524930789775e-01; +7.669005819362890e-03   +3.635712913657657e-01   +2.916416330308423e-01   -6.906514508254882e-01   +2.477608740573935e-01   +2.230959528134133e-01   -1.016643065195345e-01   -7.238040756232422e-02   +1.031304577392913e-01   -3.517410853817978e-01   -2.081857720687760e-01   -6.390994816345347e-02; -1.858202511356321e-01   -1.830619907273912e-01   -1.940466263514570e-01   +8.381892756261088e-02   +6.049899413228904e-02   -7.517487294220797e-01   +3.972600075647352e-01   +3.204681541103271e-02   -3.073147756776998e-01   -8.731760784851400e-02   -3.136915460402904e-02   +2.111197904919962e-01; -1.317406118967627e-02   -3.790167339541517e-01   -4.640780762426205e-01   +1.570102085234661e-01   -1.277230072056053e-01   +5.760610845833466e-01   -5.186778430080691e-01   +5.823016261092963e-01   +1.619381723776662e-01   -9.253378413013946e-02   -5.914858284350262e-02   +2.841875803029481e-01; +1.660206479925433e-01   +3.465906860941059e-01   +6.042238005706393e-01   +4.409952736374780e-02   +3.047137774374244e-01   +2.682962934650631e-01   -5.407586159485018e-01   -7.727839707350633e-01   +1.459698364780942e-01   +7.165533919501935e-02   +1.606284848693669e-01   +7.161018348756737e-02; -5.903766688430314e-01   +2.754667153266791e-01   -5.338727025223591e-01   +6.570887804714470e-02   +6.031627126511350e-01   -9.436537239801357e-02   +1.826707361517906e-02   +2.032406174281328e-01   -3.764512041157959e-02   -3.494930964916733e-01   +3.045196905240037e-02   +9.815953141220608e-02; +7.072236436721738e-01   -1.627767367395871e-01   -4.722951140366758e-01   -3.366761516822856e-01   +5.186408282269364e-01   -4.568087199509726e-01   +5.546807348468337e-01   +3.871644898974723e-01   -3.198413804486799e-01   -9.328727482737581e-02   -3.304235771428702e-01   +4.370312036654969e-01; -6.342462489668580e-01   +3.588497058815329e-01   +2.978169282173295e-01   -6.647876634608247e-01   +1.101550134804834e-01   +2.111152887278183e-01   +2.207328330270927e-01   -3.534784337635121e-01   +3.115268432393309e-01   +4.944631971466582e-01   +1.246682272250294e-01   -2.538983262452615e-01; -4.568963010718882e-01   -2.124708494922075e-01   +6.317675040544819e-02   -1.719970977170853e-01   +4.352608994673861e-01   +1.964461040982171e-01   -4.097129398319928e-01   -3.345580571388057e-01   -8.497086103605836e-02   +1.819698959039654e-01   +1.332443184521209e-01   -9.320173769802009e-02; -2.768018233406982e-01   -3.303046844172729e-02   -1.202853416284051e-01   +3.383978978501272e-01   -1.401779848595047e-01   -2.403457893253067e-01   +7.100309840862878e-02   -8.266796555020198e-02   -4.273157756463506e-01   -1.016070162933497e-01   -5.308816331154653e-01   +1.758744282943907e-01; -4.472425233064002e-01   +9.710658090801884e-02   +6.023600348843300e-01   +3.958264490566285e-01   -9.948020108755636e-02   -2.236189672610389e-01   +3.073114717971647e-01   -3.214127751240006e-01   +2.314468806222866e-01   +5.053765684378220e-01   -6.413788729062722e-01   +4.635001129385221e-01; +1.617250637855977e-02   +8.518208228922852e-03   +3.760375959035143e-01   -4.759096632241362e-01   +5.064099212848188e-01   -5.361559345002931e-01   -1.937884592280262e-01   +8.276181335976329e-02   +2.761603166889636e-01   +3.209378631381059e-02   -7.937225206871806e-02   +4.788341190370017e-01];
L3E_L3I_iGABA_netcon = [+7.311603900589561e-03   -5.846640497432852e-02   -1.955103117846367e-01   -3.344007423106748e-01   +3.245948980921791e-01   +1.309797680988796e-01   -3.386004463835730e-01   +4.975462900775715e-02   -3.804779885763793e-01   +3.997448724478099e-01   +4.893257962803165e-01   -4.963391758705993e-01; +3.649065506786613e-01   +1.502151311777236e-01   -1.758597370127612e-02   -4.027067072663706e-01   -1.521541623547472e-01   -2.544130560375094e-02   -3.467006123502981e-01   -2.982132260401488e-01   -4.219194989751049e-01   +9.966110499345038e-03   +2.215208250612949e-01   +4.017601167600230e-01; +4.120590940155630e-01   +1.308389320644096e-01   +3.101123454766255e-01   +5.259235694980932e-01   -2.724514616432307e-02   +1.557871346866889e-01   -3.789481077769802e-01   +3.062637012828947e-01   -4.688180699613931e-01   +1.368713983136716e-01   -1.230257496135147e-01   +1.730625679284029e-01; -9.468564867803882e-02   -1.795611145826485e-02   +2.859976544417370e-01   +1.184493630468341e-01   -1.724862462183374e-01   +2.235234522541124e-01   -5.143904449806357e-01   +3.837569254538674e-01   -3.303429176735746e-01   -1.113281473687550e-01   -2.074736361537744e-01   -1.077964736924191e-01; +2.979260754950344e-01   -2.033439878424241e-01   +3.121703704156262e-02   -3.747874171002381e-02   +9.586416125953498e-02   -5.960765257209191e-02   -9.855572031247739e-02   +3.868997330811451e-01   +2.467294508377509e-01   -5.151004642353325e-01   -1.627028595525462e-01   -2.638185935265974e-01; +3.157033176553090e-01   -1.945119477520459e-01   +6.129491307111876e-01   -9.003908763420968e-01   +4.425028914258890e-02   +1.655491589409445e-01   -7.542889055576765e-02   +1.381264480433992e-01   +7.642484637274211e-02   -3.015883868875109e-02   -2.078940010213223e-01   -1.192266776619416e-01; +3.661486935893055e-02   +1.844836114368414e-02   -2.343353427294490e-01   -7.610438872779335e-02   +4.249252666315648e-02   +2.374364329693943e-01   -1.981556579171935e-01   -1.921049614255323e-01   -1.459679705125414e-01   +2.850060231027147e-01   +1.185139182899446e-01   -2.475852489005526e-01; -5.908023214083433e-02   -5.374552841204228e-02   +4.024268874609908e-01   -9.120920314148270e-02   -3.074140509244379e-01   +3.694116895615190e-01   -3.840860423949236e-02   -3.901689215968990e-01   +1.176468626287693e-01   -1.961668266621215e-01   -1.811224430010152e-01   +3.357557637607487e-01; -3.316932999008611e-02   +1.365818101361608e-01   +8.604992774821334e-02   -3.300754030756379e-01   -5.088508278398052e-01   +9.531666440605760e-02   -2.652221874126898e-01   +3.497792232923671e-01   -6.866190943628003e-01   +3.460715250392526e-01   +3.663476091413752e-01   -2.484882669764367e-01; +6.721263774168351e-02   -4.242472915404791e-01   -1.582454913430079e-01   +1.200798566139637e-01   +1.398670073252468e-01   +3.033614668337575e-02   -3.937999416130559e-01   +5.541258562783954e-01   +1.440418556776182e-01   +4.623650192303273e-02   +6.161131591502492e-01   +7.021212159536083e-02; +1.389618128223705e-01   +9.353703995442625e-02   -1.659882121712485e-01   +5.211331584864061e-02   -3.930676347936979e-01   +2.770915968684646e-01   -2.555053338657882e-01   +2.599446111549830e-01   +3.477936261886672e-02   -4.948087714161719e-02   -1.577739802263513e-01   +1.728154945579026e-01; +2.346513654132279e-01   -1.113821980784336e-01   +3.088983550339650e-01   +1.436063688911041e-01   -8.142378403435105e-02   +3.126855374481076e-01   +4.247928301228251e-01   +4.187959196340090e-01   -2.399194374077603e-01   +2.365337540230106e-01   +3.779206450975498e-01   -2.326546198684143e-01];
L2E_Input1_iAMPA_netcon = [+3.095722841669437e-01   +2.467667963972252e-01   -6.016524310797157e-01   +9.187742279300554e-02   +8.121144170190014e-01   -2.292916835829187e-01   +2.314728725821649e-01   -7.652675133896163e-01];
L2I_Input2_iAMPA_netcon = [-1.895021406421300e-02   +8.418730062386962e-02   +2.369156311639133e-01   -2.369716861054454e-01   +6.299510436194999e-01   +3.158072665268800e-01   +3.628924443462787e-01   +4.322360565228427e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
