function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.145291958484986e-01   +9.495255612916758e-01   +7.007458307208101e-01   +1.646213624606108e-01   +9.202643711163407e-01   +2.114697333803683e-01   +7.416653432124755e-01   +3.032042427860563e-01   +5.351560826752058e-01   +8.354160218029538e-01   +9.725767573492367e-01   +9.700401195387395e-01   +6.987786359017626e-01   +3.692563575561003e-01   +2.983219402058315e-01   +3.824203843781927e-01; +3.509665730549151e-01   +1.008475944507294e-02   +1.384418505686037e-01   +1.695027068389504e-01   +7.821939994310859e-02   +8.113284450906139e-01   +7.993714496995249e-01   +7.544164244149479e-01   +7.931709728184625e-01   +1.888167605976706e-01   +4.750431939100897e-01   +6.616853884971290e-01   +3.671119582472534e-01   +2.754417041105419e-01   +6.877662160982017e-01   +9.607000526980491e-01; +2.022556975958069e-01   +4.771260883990996e-01   +8.328638501633485e-02   +7.096232934639473e-01   +3.160919722834596e-01   +3.817203932424450e-01   +6.600084403240363e-01   +9.547738920132571e-01   +4.728454805826550e-02   +9.271476717590503e-01   +8.709345927678698e-01   +2.004233506045915e-01   +5.458166437549802e-01   +7.057671440283524e-02   +7.774291882700302e-01   +8.104409023773189e-01; +2.341387764038913e-02   +4.915134254897864e-01   +4.306297239360498e-01   +8.395686359585638e-01   +6.338959093489536e-01   +8.631936473060793e-01   +4.397852604227209e-01   +4.754745280562299e-03   +4.612869975638115e-01   +4.193757136561839e-01   +9.421219327328860e-01   +9.004580752344080e-01   +5.137388308568136e-01   +1.560205730492609e-01   +7.166500443636104e-01   +8.936699953751009e-01; +7.658881782114172e-01   +5.167013479212288e-01   +9.004758207942105e-01   +8.275591134413651e-02   +9.072690163635930e-01   +3.222192045508195e-01   +5.779788735167521e-01   +4.033720410749626e-01   +9.402252854356598e-01   +2.997259260153426e-01   +2.419414934111568e-01   +4.801941954327112e-01   +7.689980118492282e-01   +3.634284613781196e-01   +2.751773093826856e-01   +6.784758834015697e-02; +5.716919775431131e-01   +2.879528482515473e-01   +7.214710881094698e-01   +8.363617279334202e-01   +7.979719055913943e-01   +3.814404218946660e-01   +5.181046445032724e-01   +1.571143335129754e-01   +4.755251597195053e-01   +3.547192524595958e-01   +9.188452124541200e-01   +6.665687847172156e-01   +7.504393189520316e-02   +7.146309593132399e-01   +1.736389868068059e-02   +9.033940488960903e-01; +5.807377461874057e-01   +5.623116320086770e-01   +6.860126227050310e-01   +5.503202647502994e-01   +6.484800818474354e-01   +6.449060917733141e-01   +7.274798277469002e-01   +8.285491285180403e-01   +7.782332712881171e-01   +9.752235846628982e-01   +6.326689513775831e-01   +5.274234353740819e-01   +5.317515855833545e-03   +5.393601779468958e-01   +1.774939128072688e-02   +6.732478861767788e-01; +3.859225402051761e-01   +5.149561945267194e-01   +2.079359894493082e-01   +9.670451572402625e-01   +4.388827102888387e-01   +3.891371942435458e-01   +2.217587258389258e-01   +2.862499915657040e-01   +1.103022259382111e-01   +5.370730065732285e-01   +2.881312878730055e-01   +7.036017843803217e-01   +4.073997318894038e-01   +2.350303980745151e-01   +9.327424283251126e-01   +3.447277376088160e-01; +5.539977691250911e-01   +6.720015967258106e-01   +5.252952137288955e-01   +6.730491030713056e-01   +7.493065424640858e-01   +7.408615306158119e-02   +9.977485705925251e-01   +9.785541872986417e-01   +5.193813626476580e-01   +7.928336829024575e-01   +8.482594026871009e-01   +7.174781232234142e-01   +6.625229817993850e-01   +4.722075646122458e-01   +9.346889159933665e-01   +8.442738567873771e-01; +1.872480288061086e-01   +6.168806755773850e-01   +8.238876953582882e-01   +3.352896153956170e-01   +8.304092210832612e-01   +1.538015566332912e-02   +6.223656259862982e-01   +6.239393672142804e-01   +6.383230013704567e-01   +7.980407593304283e-01   +1.604874666056069e-01   +2.945656637466537e-01   +3.726622807120017e-01   +7.186977277802474e-01   +3.760442075473123e-01   +1.970198211506768e-01; +1.179986857254658e-01   +5.647802976484468e-01   +1.817452998525913e-01   +2.157047156183864e-01   +3.477255911834811e-01   +8.737051275769613e-01   +9.879182284388879e-01   +7.486250206191928e-01   +5.758501480932754e-01   +1.399042103090413e-01   +8.274350529718023e-01   +1.147276591247294e-01   +3.962862326462309e-01   +5.177299209458089e-01   +1.046069244789729e-01   +8.436807196972583e-01; +5.299233113281697e-02   +5.080320785573109e-01   +5.161927116177685e-01   +5.702570228218760e-01   +1.504876433018544e-01   +1.592583147395592e-01   +4.919143598530198e-01   +8.841064308825798e-01   +8.397030736736177e-01   +4.555446814221147e-01   +2.166723325488063e-01   +3.319627561830610e-01   +1.367842994831261e-01   +5.156731102529394e-01   +7.239516761729109e-01   +4.275578943624715e-01; +9.371331653315673e-01   +6.659435496523336e-01   +3.556436931770909e-01   +4.743842341318132e-03   +5.046379538665766e-01   +9.228764117836190e-01   +5.252438977883750e-01   +3.333284978787553e-01   +1.171576059674529e-01   +4.542104581538013e-01   +2.699951470403696e-01   +4.646289549445661e-01   +3.378943606865937e-01   +3.925235294626383e-01   +4.562440007585600e-01   +5.582983693406949e-01; +7.422850175681801e-01   +6.409870697657576e-01   +6.530008332988771e-01   +5.913108086710185e-01   +4.133570258515001e-01   +5.656406936340486e-01   +8.564877867378692e-01   +9.439433062353238e-02   +5.030040017633044e-02   +9.586447788697040e-01   +9.048028542605278e-02   +7.149041372445800e-01   +1.230153042968756e-01   +4.848511583841627e-01   +1.432621475705467e-02   +4.452631641682316e-01; +2.395666863813455e-01   +1.404851688721901e-01   +2.812634700505520e-01   +8.961795932303291e-01   +1.767667023352809e-01   +9.232697467888080e-01   +2.544012227176623e-01   +4.453884920987956e-01   +5.223206249186005e-01   +5.027868216840582e-02   +9.160847198136910e-01   +3.974358048397308e-01   +3.700423735531793e-01   +7.410152304435893e-01   +1.168248977727983e-01   +7.615165267501438e-01; +2.025813540117933e-01   +1.818973357412248e-01   +4.331553796869028e-01   +2.597435878998795e-01   +4.924094160456252e-01   +5.951286358709734e-01   +5.774747844109809e-01   +2.364117462464792e-01   +7.043727569704643e-01   +3.880591902608214e-02   +7.312643140547315e-01   +2.398081198262976e-01   +2.466319725640088e-01   +7.081187867367080e-01   +6.609291351166409e-01   +9.626693195425730e-02];
L1E_L1I_iGABA_netcon = [+8.405162873772930e-01   +7.482543649679753e-01   +8.719006982575420e-01   +4.352291230038550e-01   +9.228425000160811e-01   +7.701715025832774e-01   +3.229344461704190e-01   +6.426857478693313e-01   +9.521194977411604e-02   +2.808038058070855e-02   +1.295019606800913e-01   +5.194238967940180e-01   +8.757663561173931e-01   +5.738344390988671e-01   +1.715162648301494e-01   +6.335480700837962e-01; +6.151946672719645e-01   +9.934183588220309e-01   +3.123409865358310e-01   +1.462063526707714e-01   +8.862200628367010e-01   +2.729895444289800e-01   +9.655598170072778e-01   +4.366114824221428e-01   +2.953246615752986e-01   +5.109293518911154e-01   +4.310053077621349e-01   +2.060069300278429e-01   +8.039688158419431e-01   +2.929199270121995e-01   +5.582539731893007e-02   +3.420318653679070e-01; +6.655105663512594e-01   +3.744173932792094e-01   +4.311581383020993e-01   +6.532747844238675e-01   +5.904696462502973e-01   +5.240954294893020e-01   +3.532159942296800e-01   +4.808073625954994e-01   +3.294814167036511e-01   +8.656535520668697e-01   +4.791046446653713e-01   +7.676200510039444e-01   +6.430714048976134e-01   +1.401898028622580e-01   +2.178182456914187e-01   +1.549571802104904e-01; +7.781897467189119e-01   +5.078836165131152e-01   +3.789667298184883e-01   +7.250470119893334e-01   +8.364072926652639e-01   +4.094015587172292e-01   +3.185430274404218e-01   +9.904566802137525e-02   +4.753284782586574e-01   +5.790294876368555e-01   +6.738219114535182e-01   +3.881401271409582e-01   +7.349224511296454e-01   +4.301974967694128e-02   +2.069001560268177e-01   +4.017536537121656e-01; +3.166204122616372e-01   +7.529258628252722e-01   +6.527620102023791e-01   +1.702808003201592e-01   +7.825855863938856e-01   +7.822778562896885e-01   +9.137321180291395e-01   +8.053063973635329e-01   +2.405976051752264e-01   +4.271803593596497e-01   +3.538673182919768e-01   +6.864066033861180e-02   +6.640652112085674e-01   +6.255009448386240e-01   +2.154781798834981e-01   +9.126163975508221e-01; +3.284456976521393e-01   +1.328420095864102e-01   +2.467106310505146e-01   +3.395674005932469e-01   +7.881206728286941e-01   +2.625591390103173e-02   +8.837050679252710e-01   +6.091707107175290e-02   +4.564489698083498e-01   +7.195142442791147e-01   +4.458854093657519e-02   +7.519336667957504e-01   +8.854236159606064e-01   +6.056965211433855e-01   +5.780930642587848e-01   +1.558742031552642e-01; +6.303521628606996e-01   +5.174464619952911e-01   +6.890504474299132e-01   +1.034859702337468e-01   +6.974705937416033e-01   +4.109959454185175e-01   +3.619298103477102e-01   +9.569554046746769e-01   +7.551833603449802e-01   +2.294403672358298e-01   +2.923265842964777e-01   +4.561145632321653e-01   +8.526427596014986e-01   +3.692657085473522e-01   +3.571417202128004e-02   +4.682519404662100e-01; +9.016907481873042e-01   +9.073225405943448e-01   +3.288454876485837e-01   +4.484315066849577e-02   +1.988332667038979e-02   +8.265585694403015e-01   +7.411847674231840e-01   +7.725225373932088e-01   +7.152371364882002e-01   +5.654037272576913e-02   +7.984253071067315e-01   +3.157049801222211e-01   +4.072016052663728e-01   +8.346934946987870e-01   +7.979033111987434e-01   +8.014740968293087e-02; +3.703296705025224e-01   +1.012750024439738e-01   +8.734719717946343e-01   +4.746655195879947e-01   +3.244593286357843e-01   +5.916196923025836e-01   +1.240131876936840e-01   +4.465554979675616e-01   +2.323596506379228e-01   +9.753423666601357e-01   +6.485030611126944e-01   +2.754079844017402e-01   +1.113566758641187e-01   +5.165830374643466e-01   +1.345731468608448e-01   +3.384640643753446e-01; +8.833469596920519e-01   +1.810442827916011e-01   +9.978447556554390e-01   +4.767603429286958e-01   +9.463038407159314e-01   +2.093806894450547e-01   +5.919234976765949e-01   +1.653432356790419e-01   +7.026440303967749e-01   +9.696184872168149e-01   +7.092833248665482e-01   +5.752872963506573e-01   +4.084957003522498e-01   +8.110892431472695e-01   +5.799318859379253e-01   +4.924095410544498e-01; +1.188842367952040e-01   +1.792471936956125e-01   +6.880891829016085e-01   +5.529086815464329e-01   +4.049539473845319e-01   +2.918506972742172e-01   +4.391408602795674e-01   +8.016523267294656e-02   +3.039789714606152e-01   +1.316392140525172e-01   +7.574422827002278e-01   +9.124970477099013e-01   +3.355483880857459e-01   +5.770080121064619e-01   +8.341035355695497e-02   +5.001320194176048e-01; +9.150960194271759e-02   +5.379242698773667e-01   +3.458643544886145e-01   +6.478742677248228e-01   +6.254112679910555e-01   +2.667775972289876e-01   +9.634177496930931e-01   +7.408315370025027e-01   +4.694718054124035e-01   +1.367564841466666e-03   +3.904889214908471e-01   +4.490593624032700e-01   +1.096518016559500e-01   +7.135500179589475e-01   +2.290720749730265e-01   +1.314325609720351e-01; +5.449470146219754e-01   +9.757609282427235e-01   +5.598649415580903e-01   +3.491096605981370e-01   +8.508518585091037e-01   +9.329436422600387e-01   +9.744544254981103e-01   +5.348341130156917e-01   +4.379389225662608e-01   +9.327261850334597e-01   +3.650292068752582e-01   +9.813236483013638e-01   +8.583099031936299e-01   +7.326364537242754e-01   +4.470453175441151e-01   +7.675358191886519e-02; +6.012210550920695e-01   +8.425165547416906e-01   +8.923486418355102e-01   +2.534555358267578e-01   +3.672932371523962e-01   +5.525854313420635e-01   +2.488555806975989e-01   +4.854588169867358e-01   +7.298133526248177e-01   +7.397800363424890e-01   +8.126825625168549e-01   +1.036361549734420e-01   +8.965452987903346e-01   +4.450608791415384e-01   +1.785408854389859e-01   +6.759945362197015e-01; +7.245990161084302e-01   +6.691738782759842e-01   +6.485122258052171e-01   +1.799249420575826e-01   +2.033090144592870e-01   +4.305183575713661e-01   +7.737220700974689e-01   +8.859186017059518e-01   +8.740702335181428e-01   +4.290769235332618e-01   +3.867040961074164e-01   +4.180798376056860e-01   +6.905556871008406e-01   +2.808838388508030e-01   +4.132623458476793e-01   +1.178665378148978e-01; +9.936252457897533e-01   +1.343394418345477e-02   +3.794337161096539e-01   +4.779095551452160e-01   +9.080366672730826e-01   +3.251590170727723e-01   +7.088422295092330e-01   +5.883060236882564e-01   +9.111917973343147e-01   +9.441049319554328e-01   +8.701788241850509e-01   +3.873127673806609e-01   +7.457588154942835e-01   +1.541410611286451e-01   +9.655405236605854e-01   +9.899365866125450e-01];
L2I_L1I_iGABA_netcon = [+5.716368041213962e-01   +5.640978721770222e-01   +1.056379654817834e-01   +4.523046570499384e-01   +7.986495309747182e-01   +9.764784590934331e-01   +2.219495085683807e-01   +7.591166665313176e-01; +5.665815241528018e-01   +9.538113615566248e-01   +1.277286532877671e-01   +5.669891057761185e-01   +5.441205499625357e-01   +4.242877156804493e-01   +6.247116006664681e-02   +4.956825605799744e-01; +6.075320609563327e-01   +1.324553892017939e-02   +4.343401418558208e-01   +8.178744541414842e-01   +2.583243765444248e-01   +3.925758766622613e-01   +8.279074826426973e-01   +8.258376050278967e-01; +4.652770012083120e-01   +1.252329266327678e-01   +9.299345353027126e-01   +3.606703304077571e-01   +7.785154305468152e-01   +4.591646341966372e-01   +4.102390269950596e-02   +9.180000672816805e-01; +4.353567443082411e-01   +8.561328854204793e-01   +1.388649982652496e-01   +2.421383213711521e-01   +7.771119595541506e-01   +1.281248209812701e-01   +9.114301620155439e-01   +7.096910243705391e-01; +6.732700664986406e-02   +2.216987604109466e-01   +8.206936642036164e-01   +7.630252990143365e-01   +1.443435788170048e-01   +4.623892809999684e-01   +4.531035226308926e-01   +8.013632401425931e-01; +6.388990293790725e-01   +7.033140416326449e-01   +9.317454395027743e-01   +3.815867235600693e-03   +8.257139785844159e-01   +2.660211643197271e-01   +2.803573929828462e-01   +9.570880900199988e-01; +4.253921681913396e-01   +7.764690007538044e-01   +5.710705383757229e-01   +2.771844015949708e-01   +6.243830429104429e-01   +1.037721309849518e-01   +7.551011584074042e-01   +9.515803190426391e-01; +7.526578157744447e-01   +4.238924137066480e-01   +4.991654013671030e-01   +3.119736915305334e-02   +4.617764008755154e-01   +6.593400150723071e-01   +9.268932191913952e-01   +2.955362381037774e-01; +3.062466079413825e-01   +7.296755454121421e-01   +9.288688512817282e-01   +6.692906245668260e-01   +4.846093380126942e-01   +9.434126149006182e-01   +1.408034632261124e-01   +3.536304900631108e-01; +5.998922264480845e-01   +4.537551957958873e-01   +8.642157383582915e-01   +9.724928321877405e-01   +2.197570493417411e-01   +7.658147315396060e-01   +9.454013044636352e-01   +5.442925942083522e-01; +3.308657531595092e-01   +8.034388178584780e-01   +2.542600653758280e-01   +9.447642895092822e-01   +8.542320789117024e-01   +4.043224258698896e-02   +3.142318802914032e-01   +2.118520957050278e-01; +6.462321518311451e-01   +4.311489909956627e-01   +4.563040677403922e-01   +4.788868626820275e-02   +8.767776137670381e-01   +2.609074821472103e-01   +2.077961436269715e-01   +8.044565169432910e-02; +4.806613656390708e-03   +1.518649318127967e-01   +7.383501256466141e-01   +2.880054376693777e-01   +8.391676351720461e-01   +6.415044178162502e-01   +4.607719126248060e-01   +5.105566803214703e-01; +1.477173982883062e-01   +8.023801122044367e-01   +7.540186298100600e-01   +4.820868782739834e-01   +4.424836154548293e-01   +8.959960872643433e-02   +5.936888388425574e-01   +1.992118115858252e-01; +2.474104844660208e-01   +3.729996161819876e-01   +2.371531543376413e-01   +8.858155463353016e-01   +5.424789819833138e-01   +7.272997196572603e-02   +5.495673652668311e-01   +1.425584522415765e-01];
L1I_L2I_iGABA_netcon = [+7.106869419972958e-01   +8.705906332634836e-01   +6.148150742863026e-01   +4.886720787621850e-02   +1.440872553373329e-01   +2.348755374611189e-01   +8.404891613092391e-01   +3.670231911661379e-01   +7.104671063246633e-01   +3.903097828264675e-01   +2.446554173982291e-01   +6.723313759242014e-01   +1.625086216473327e-01   +5.709829538604335e-01   +4.527845883453506e-02   +4.476414817025889e-02; +6.068244578289208e-01   +8.029005227443902e-01   +6.164853511074244e-01   +5.285265397850897e-02   +7.453596441680822e-01   +5.520847625422360e-01   +2.008913791948805e-01   +5.589351258855072e-01   +1.890701467619676e-01   +7.257557574019641e-01   +5.074100261283370e-01   +3.355762289434551e-01   +1.072195963649568e-01   +8.121523091709578e-01   +4.352805757805181e-01   +9.227396338103517e-01; +1.600655153294808e-01   +6.212260653245707e-01   +3.094718878731553e-01   +5.994239768624843e-01   +9.518199529850963e-01   +1.131137344007821e-01   +6.154064596829800e-01   +8.338373206890336e-01   +2.298222305435664e-01   +6.340813099614223e-01   +7.335547322555310e-01   +5.483002262368060e-01   +7.456814419320524e-01   +6.739889189081257e-01   +9.257960911609763e-01   +1.771985375435519e-01; +4.810742263560644e-01   +4.772306882605598e-01   +1.314694170413362e-01   +6.608593017325531e-01   +2.630841418060602e-01   +8.221616335241180e-01   +1.593490341034195e-01   +7.152013387556660e-01   +9.987859085953442e-01   +9.959247460637204e-02   +7.794830143600546e-01   +5.347963499950842e-01   +2.161613885579796e-01   +4.418876313117490e-01   +8.862565343114264e-01   +7.447232766588587e-01; +2.903698210343199e-01   +1.981588859856778e-02   +6.021404978572305e-01   +4.858931718405428e-01   +9.029759744679963e-02   +6.577672304248887e-01   +5.876613062378931e-01   +1.169328145982763e-01   +9.015472853816666e-01   +4.950585750652147e-01   +6.844806961139427e-01   +9.073509577401403e-01   +4.866143537424038e-01   +8.880259798605604e-01   +9.574193698102595e-02   +4.710452527484014e-01; +4.029616565792094e-01   +1.195063109944929e-01   +8.918661203527619e-01   +9.779643957522236e-01   +2.324194562101934e-01   +2.350166103723258e-01   +5.435347865840614e-01   +7.394866604617768e-01   +1.456056500132521e-02   +5.555606892106970e-01   +8.146621090096194e-01   +2.840686449067497e-01   +4.987806409436420e-02   +7.875910515333465e-01   +6.845657401868883e-01   +2.531208882192599e-01; +4.900039997109281e-01   +7.242495575791650e-01   +5.654406087367443e-01   +8.672021305922586e-01   +8.907262992529514e-01   +3.039400883848691e-01   +6.867023662233613e-01   +9.222952624359234e-01   +8.343359515366021e-01   +5.254584196261348e-02   +4.232548121929217e-01   +1.388496328332627e-01   +5.786253269769764e-01   +5.858884141712528e-01   +1.118938355443747e-02   +6.650641418051689e-01; +8.624331414605630e-01   +6.685429930897994e-01   +6.322290868907203e-01   +9.559806981059022e-01   +1.985255262585850e-01   +3.252929894268285e-01   +6.999264642088506e-01   +9.201222584492844e-01   +2.524150588670446e-01   +8.145365633881053e-02   +4.949301570674412e-01   +9.550219263420199e-01   +4.951550011458584e-01   +6.196366768641552e-01   +1.254110309893110e-01   +6.075510585419617e-01];
L2E_L1E_iAMPA_netcon = [+3.714994315828045e-01   +5.616152002509478e-01   +2.063776802915517e-01   +5.188833636947334e-01   +2.949906750122159e-01   +7.054314446991128e-02   +2.827794512819025e-01   +2.641354579934638e-01; +4.330290966628365e-01   +1.865086875592405e-01   +1.383390931178926e-01   +6.832677891462503e-01   +6.185275924734452e-01   +5.916686974740923e-01   +9.291608975905047e-01   +8.998646262529433e-01; +7.184576229102150e-01   +6.066756378573958e-01   +8.046635390652002e-02   +2.077447095649757e-01   +8.696506682134093e-01   +7.847353786419897e-02   +7.589949498630143e-01   +1.554810469325663e-01; +1.955844150995489e-01   +7.339427150573509e-01   +9.344173477436682e-02   +9.725655891841256e-01   +8.153983478647123e-01   +3.987261384053549e-01   +2.600630592977547e-01   +5.533358271337585e-01; +4.458972661593813e-02   +8.347089244869234e-01   +5.510866469278796e-01   +3.490706698703079e-01   +2.086576472869159e-01   +5.508193979900419e-02   +2.449584438489114e-01   +4.228016439354090e-01; +3.133877734821229e-01   +2.742550637445206e-01   +7.318164102352551e-01   +1.814351673331902e-01   +7.476783412792544e-01   +1.257734311970140e-01   +1.624636315397337e-01   +5.478930383872889e-01; +7.932956788094495e-01   +6.084434303566602e-01   +5.465819285014852e-01   +2.437621505352961e-01   +1.997662927331874e-01   +2.439547146898116e-01   +2.891265124915398e-01   +7.465474316999869e-01; +4.122239024045392e-02   +5.484956742316714e-01   +5.024167801513379e-02   +2.570593763485577e-01   +5.801400790265404e-01   +9.397320828292252e-01   +5.656308222149231e-01   +1.170735282284686e-02; +2.150515195585520e-01   +2.760994687034961e-01   +6.370808559710853e-01   +2.186363560005613e-01   +8.760018566122854e-01   +2.070599954126304e-01   +4.005103654157190e-01   -7.785626723485181e-04; +2.706956003620618e-01   +3.388235646624158e-01   +9.917659088605512e-01   +3.854022364660541e-02   +7.172545194272024e-01   +3.281766289081259e-01   +9.859725560012848e-01   +1.918768903637127e-02; +7.927589092594474e-01   +5.707869324104103e-01   +9.104583250376795e-01   +3.517767947980999e-01   +6.970033895657572e-01   +8.644500215038734e-01   +5.452867048823242e-01   +3.534543549827502e-01; +9.852065292505929e-01   +7.425398558572163e-01   +7.726159793229147e-01   +8.964700460349516e-01   +4.609486971680422e-01   +9.192594574311391e-01   +9.335928759189659e-01   +4.289288752282249e-01; +9.849433595087249e-02   +7.640162269895352e-01   +1.955032976082448e-01   +1.371752584202372e-01   +5.037810346536253e-01   +2.144619646616324e-02   +9.876439097963411e-01   +5.451761124349553e-01; +1.997131924994980e-01   +4.047816770733208e-01   +3.063160575971536e-02   +9.516009718364743e-01   +8.001522540645355e-01   +3.604690016193161e-01   +8.335850925953167e-01   +4.825600983745619e-01; +1.184240681557237e-01   +1.553763648853994e-01   +3.768708467467177e-01   +9.068744384037305e-01   +9.339932772171298e-01   +5.323912072864997e-01   +1.811534997763142e-01   +9.172620585109634e-01; +6.393704662505346e-01   +2.051184793004946e-01   +5.783669829872025e-01   +4.115994851490360e-01   +7.924141909072192e-01   +4.049474758209727e-01   +3.102193182920912e-01   +4.149988628066347e-01];
L1E_L2E_iAMPA_netcon = [+4.962780743654898e-01   +4.528569429414636e-01   +6.132917650850566e-01   +4.918533315521112e-01   +2.328043454169008e-01   +7.134544562098795e-01   +6.863352520885979e-01   +6.353050675995547e-01   +5.203956475387459e-01   +2.392708724625403e-01   +8.719079408707006e-01   +1.750917777597001e-01   +1.378802514176558e-01   +2.478951254294286e-01   +1.814184388558796e-01   +3.031818898290177e-02; +8.322294589607490e-01   +3.626149683820320e-01   +1.031946574997655e-01   +6.632809648616004e-01   +8.369713843119011e-01   +3.821010091495118e-01   +9.753135432739310e-01   +6.217544771537153e-01   +6.719530874661463e-01   +7.275145011086859e-01   +6.620662844594627e-01   +2.983222662554737e-01   +2.844561541013712e-01   +7.483317928695880e-01   +1.504824279880350e-01   +2.491680477239485e-01; +1.847034663555966e-01   +2.972507997452804e-01   +7.554608896328519e-01   +1.793886572320396e-01   +7.347939789227330e-01   +3.798518988069834e-01   +7.557988201115687e-01   +4.090320429127175e-01   +7.717196733695889e-01   +1.264639812887965e-01   +5.449423602058175e-01   +1.077651133373272e-01   +4.116098340443301e-03   +9.313430862875114e-01   +1.349405636221951e-01   +9.886457429756598e-01; +3.396535236051352e-01   +2.399079037802937e-01   +5.396792922744107e-01   +4.756721473926383e-01   +4.891622905890148e-01   +7.180229662868299e-01   +5.553944887333400e-01   +4.302686936095926e-01   +4.631460282789001e-01   +4.355103299318332e-02   +2.473868668378665e-01   +4.508028038905394e-01   +3.104122333857823e-01   +3.060024293175935e-02   +1.654795507175947e-01   +6.313333989474584e-01; +6.932392950373009e-01   +1.361805807856415e-01   +4.460307082898143e-01   +5.032524193297926e-01   +8.522535710573350e-01   +8.317845826269006e-01   +2.854166128175507e-02   +5.110351453087584e-01   +9.041788625376381e-01   +6.535219488457730e-01   +1.096657294890095e-01   +5.857804629874531e-01   +9.071170955741857e-01   +4.312007325493925e-01   +9.204323891388374e-01   +3.616691634990173e-01; +6.939013783690240e-01   +1.010523348332457e-01   +7.441881788070397e-01   +6.027077402753762e-01   +7.216296408860760e-01   +6.696512873809958e-01   +1.894360473115048e-01   +2.608620577055364e-01   +2.442421659267035e-02   +1.994475431131232e-01   +9.714323129085098e-01   +2.205105337063176e-01   +2.932591790238653e-01   +8.277013367691903e-01   +2.606083112646535e-01   +9.902531420560536e-02; +3.697456672633543e-01   +2.325199938998570e-01   +3.884395531562281e-01   +2.449587332379678e-01   +5.214580238751048e-01   +6.493046499666043e-01   +9.373326736820886e-01   +4.234400984155176e-01   +4.845967869294273e-01   +9.722052721572357e-01   +5.884134591416781e-01   +1.060653497389254e-01   +8.262477450420014e-01   +9.956004335535018e-01   +2.042195631135182e-01   +4.154258181885608e-01; +3.130047466557419e-02   +3.480812087513203e-01   +5.329566276624046e-01   +5.206265609040698e-01   +9.382972980524137e-01   +5.616235900510471e-01   +3.927113470887849e-01   +5.249890420902577e-01   +2.720658923623369e-01   +8.230494340037281e-01   +8.172017663119127e-01   +5.613053205801164e-01   +7.378830533875255e-01   +9.219058980302334e-01   +6.185764852445774e-01   +9.275289633060869e-01];
L2I_L2E_iAMPA_netcon = [+6.752701878090565e-01   +6.120668227443252e-01   +4.308259415777815e-02   +7.986161331543836e-01   +5.195498972669946e-01   +8.231597352342711e-01   +6.458473516230707e-01   +3.871056037448082e-01; +2.390681193480173e-02   +9.445277264512603e-01   +5.482955717506012e-02   +9.341176888846873e-01   +6.643483772140059e-02   +1.111542188086162e-01   +3.455494268017622e-02   +1.702760953947980e-01; +7.364273883462064e-01   +9.617750236775997e-01   +4.061696046956043e-01   +9.396773826194854e-01   +2.877065465219152e-01   +2.581692644846534e-02   +5.642331557165287e-01   +4.435064926303611e-01; +2.190296514377902e-01   +3.656612789318731e-01   +9.792167319734867e-01   +1.428590014617507e-01   +7.158170322632692e-01   +7.653623961578014e-03   +3.081152536636060e-01   +8.796232726750914e-01; +8.550042453191750e-01   +8.001114839073687e-01   +7.139978105925753e-01   +3.244010959764146e-01   +8.879318234026172e-01   +3.357631817238882e-01   +2.626089383127139e-01   +4.037028699895728e-01; +1.586350589591683e-01   +7.226589359581986e-01   +9.885240683555125e-01   +4.267852775876430e-01   +3.638391746340816e-01   +6.675790451963949e-01   +7.188137517573151e-01   +1.658117603664867e-01; +6.715960112721041e-01   +9.513156173708066e-01   +6.441117529925175e-01   +7.071156740547333e-01   +5.670423501099197e-01   +5.912841584287059e-01   +3.088721576864439e-01   +6.648781043747961e-01; +9.341566631512210e-01   +1.228137731439969e-02   +5.029567076066189e-01   +6.174765731377418e-01   +8.812553261811585e-01   +7.764966174256599e-02   +9.010929257566990e-01   +9.296041552411272e-01];
L2E_L2I_iGABA_netcon = [+6.126741255088562e-02   +5.238894586115520e-01   +3.486151845379170e-01   +2.574853266503495e-01   +4.532071859760071e-02   +9.006024804773762e-01   +3.444759893938122e-01   +4.527595153191967e-01; +3.539229667937613e-01   +6.582221552827619e-02   +5.587712665744269e-01   +9.826880908752696e-01   +3.629212699870664e-01   +5.502334284629776e-01   +9.352661166041909e-01   +6.737231836286171e-01; +9.321777598188936e-01   +1.838765278956694e-01   +6.910689766587264e-01   +3.478244994140053e-01   +3.932178440663576e-02   +7.116308587961508e-01   +9.115837219203996e-01   +7.707630022531515e-01; +2.402232376688880e-01   +3.137588904118588e-01   +5.585022569736428e-03   +3.941932813715984e-01   +4.908191563335901e-01   +7.151467059766388e-01   +7.261694971353866e-01   +9.227512901191509e-01; +1.076774885044654e-01   +2.468880097075119e-01   +4.815730723153362e-02   +7.516404890460192e-01   +7.254405424100621e-01   +1.731142308559468e-01   +4.416253330013014e-01   +6.524152678740558e-01; +7.101735746758430e-01   +3.214800343877628e-01   +3.022275511675303e-01   +1.093630322447975e-01   +1.717511062774168e-02   +3.527540904683109e-01   +1.468125795096507e-01   +5.041931792635910e-01; +6.419526174812942e-03   +8.729278427947668e-01   +8.742474306698940e-01   +5.952447915728718e-01   +5.117441751487535e-01   +3.779053888531017e-01   +8.306718806079154e-01   +3.427165554159332e-01; +1.770931355106898e-01   +3.048906825445613e-01   +6.243311894519158e-01   +1.206261896482832e-01   +2.435021886747607e-01   +7.590135853892451e-01   +2.489845920637020e-01   +9.443454392898323e-01];
L3E_L2E_iAMPA_netcon = [+7.900576955596898e-02   +1.763759056571579e-02   +3.680714930688380e-01   +4.950491838943555e-01   +2.141929459454221e-02   +9.627017954402541e-01   +3.548518389931567e-01   +2.346139125752303e-02   +2.069843286621881e-01   +7.094413720692608e-02   +2.424107960586388e-01   +1.000000000000000e+00; +9.492586159248843e-01   +9.780273752164859e-01   +1.179961363339813e-01   +6.486112547714207e-02   +8.070495534699679e-01   +3.912781672492752e-01   +2.272332665961214e-01   +1.283988269514125e-01   +3.523806865947048e-01   +7.441341653679372e-01   +5.364468636921441e-01   +3.410912951959996e-01; +6.652492453897437e-01   +7.177135467510773e-01   +5.112250308095233e-01   +8.702426896669577e-01   +7.965589439072339e-01   +6.620823737020143e-01   +7.259576680885728e-01   +6.636604209068426e-01   +8.882086283457423e-01   +9.898318911878655e-01   +3.345456293728827e-01   +8.281209415263219e-01; +1.688083054886753e-01   +8.749496912261523e-01   +5.825862389355323e-03   +9.985459477091427e-01   +4.174885316169015e-01   +5.826130289066692e-01   +7.722590871478873e-01   +5.084640637067479e-01   +8.172439294394165e-01   +7.692316237481707e-01   +6.697767373621047e-01   +1.100072073418783e-01; +1.979432294741779e-01   +8.153121150363121e-01   +8.703976013205206e-01   +1.178633402002356e-01   +6.320950980153985e-01   +5.172156858478885e-02   +3.376937874275590e-01   +7.676827965260241e-02   +3.185536679556942e-01   +8.865335228098151e-01   +8.765404245930335e-01   +7.784637800332128e-01; +9.909692472633135e-01   +3.599153940384082e-02   +9.067427342110332e-01   +1.045039286901218e-01   +5.677657967230421e-01   +7.293796769709369e-02   +5.711127282750952e-01   +5.354327160433027e-01   +5.969076451039007e-01   +4.180963344753503e-02   +9.803976894342419e-01   +1.538537007288235e-01; +9.304378518218285e-01   +9.452981289902490e-02   +1.105907496009727e-01   +1.472392340813519e-01   +9.043468513382757e-01   +2.311257198273818e-01   +6.364895854244855e-01   +6.841941144028928e-01   +6.989827014430195e-01   +7.980544091554077e-01   +1.374584674268710e-01   +7.330230479455019e-01; +9.764479641623530e-01   +9.428418000532947e-02   +4.326894645557636e-02   +1.305763160700253e-01   +7.519659462318850e-01   +4.138724837529665e-01   +3.691856851794798e-01   +5.892147918548050e-01   +1.797768294570227e-01   +7.103185825002338e-01   +8.817975177361610e-01   +1.183527011351637e-01];
L3I_L2I_iGABA_netcon = [+7.684797233645155e-01   +5.371936503069400e-01   +5.965266686664636e-01   +3.051496993088699e-01   +9.655063149680072e-01   +1.137704423449613e-01   +2.927317329686365e-01   +7.954597256455621e-01   +9.234114507834450e-01   +9.969085973295788e-01   +3.102097208648776e-01   +9.926269758588943e-01; +6.364952869316419e-01   +4.480388927160427e-01   +5.605037982771450e-01   +7.577104379267361e-01   +5.481159350338790e-01   +6.363647878737666e-02   +1.678988231319893e-01   +4.915958799994970e-02   +3.885113890685044e-01   +2.936091494912556e-01   +4.488922840139867e-01   +9.180428661710635e-01; +7.958884544251434e-01   +1.143634398850654e-01   +7.730302886059894e-02   +6.520741626095713e-01   +9.789690955139999e-01   +4.699983937818632e-02   +7.236554618669564e-01   +1.808015487358556e-01   +7.486063504773595e-01   +5.243093129911920e-01   +2.025205041887539e-01   +6.860229276930067e-01; +9.633938404834131e-01   +7.194595234732004e-01   +7.672899452496676e-01   +3.327350905294105e-01   +1.270127266425382e-01   +1.304432201100569e-01   +2.984866999399357e-01   +2.479708327575904e-01   +8.781490637980329e-01   +3.588187950326393e-01   +9.446917192657359e-01   +2.151415148371645e-01; +7.131120133280323e-01   +1.841496986528575e-01   +8.625363655923365e-01   +9.775242055606819e-01   +1.609565371589119e-01   +4.909056152262646e-01   +6.795283978191095e-01   +2.601285230398901e-01   +3.949107629791336e-01   +5.191269127948978e-01   +2.892862697513662e-01   +3.130683227180208e-01; +6.444529288369143e-01   +3.251507619028154e-01   +7.021531794586071e-01   +5.301680306638995e-01   +3.352170047252433e-01   +4.716504693885639e-01   +7.514423547081106e-01   +6.483431054160501e-01   +1.695916042292289e-01   +4.952392435617943e-01   +1.147888447755060e-01   +2.276609237853831e-01; +5.169945708087796e-01   +9.675461703623602e-01   +1.114112047374168e-01   +7.539173404243571e-01   +5.310657674022476e-01   +1.570342987215738e-01   +7.454961687556483e-01   +9.836430556429837e-02   +4.405707482918611e-01   +1.805348578538774e-01   +6.691283263629733e-02   +7.050047547348620e-01; +9.534536840150574e-01   +6.979020723959969e-01   +6.590137097677269e-01   +2.633757921974921e-01   +6.900737425892609e-01   +1.366397874148502e-01   +7.819665170807512e-01   +4.694356242760590e-01   +8.515145279133161e-01   +4.820250354763747e-01   +7.287908652427239e-01   +3.723956308077356e-01];
L2E_L3E_iAMPA_netcon = [+6.553342077798546e-01   +3.849763782037550e-01   +2.356375979896957e-01   +4.660562759780759e-01   +9.069132287619442e-01   +9.542126140838824e-01   +7.659334476136014e-01   +3.565438183052372e-01; +3.828213121008977e-01   +2.190191731327130e-02   +9.145533539678213e-01   +2.875138198400023e-01   +6.807730523219584e-01   +1.895786648617965e-02   +8.975190118755419e-01   +6.604599498323626e-01; +3.033157735605880e-01   +3.306440833675280e-01   +4.872371553693106e-01   +2.757798200163902e-01   +8.432595394106674e-01   +4.983592356230072e-01   +7.950243395071862e-01   +5.926435377213087e-01; +1.546316726855421e-01   +4.882684038489596e-01   +5.882231482686390e-01   +1.444908047063656e-01   +9.524139035105852e-02   +3.365803730230699e-01   +9.494087426896040e-01   +5.537662133647586e-02; +7.761411940933939e-01   +2.651492037218091e-01   +9.557896468221930e-01   +1.440535824496356e-01   +7.399857567406443e-01   +6.663217910226586e-01   +5.380241287620814e-01   +2.086458055040647e-01; +7.127499236648079e-01   +5.299209515868741e-01   +8.268710460923162e-02   +2.659196927124540e-01   +5.483130129892120e-01   +1.643636504056247e-01   +1.607048428385994e-01   +5.999780691484071e-01; +1.735684272388443e-01   +4.163280819289737e-01   +2.196235235070815e-01   +6.050483990306489e-01   +2.541158438808381e-01   +2.269705108343530e-01   +1.357873205489205e-01   +2.678387823267543e-01; +4.495499724669866e-01   +1.727473022117495e-03   +1.623885349539310e-01   +1.050534626727492e-01   +7.170438741598468e-01   +1.158675099628397e-01   +2.718602005397831e-02   +1.142268397610472e-01; +8.411659045463246e-01   +8.926252241392788e-01   +3.909624426769800e-01   +4.887743010312049e-01   +3.621766573328450e-01   +9.888103603871718e-01   +6.869261190452327e-01   +2.187530238740141e-01; +7.009437714777402e-01   +2.426639382853758e-01   +1.869641063708945e-01   +8.957062328083630e-01   +8.479281256557407e-01   +1.411461746803357e-01   +5.841675587068795e-01   +8.793606904047095e-01; +7.645566345304573e-01   +8.008368293704757e-01   +7.594807733229855e-01   +1.901362266859641e-01   +8.218801483345493e-01   +7.685315817810572e-01   +2.971258638503969e-01   +4.630330524075852e-01; +9.765713897226951e-01   +5.787267210283242e-01   +2.323984676727622e-01   +5.367743745942428e-02   +6.179147379613950e-01   +6.263995599883292e-01   +7.345093732767556e-02   +7.317874962514725e-01];
L2I_L3I_iGABA_netcon = [+5.901337699077673e-01   +1.449998727395666e-01   +3.477411708959944e-01   +3.745925326019792e-01   +5.943395445058848e-01   +5.139814165468888e-01   +7.752540574906132e-01   +2.686665749273656e-01; +8.430884740540886e-01   +9.903942160169709e-01   +4.520857490594474e-02   +5.346149773652469e-01   +4.752525375669180e-01   +2.396954636554837e-01   +1.820864045699181e-01   +5.952674328970411e-01; +6.093255101359381e-01   +4.813935976846103e-01   +9.476855491844141e-01   +9.747957575354628e-01   +3.786516122803261e-01   +2.704733274739288e-01   +4.525413535525966e-01   +6.851789468088769e-01; +7.435193725344591e-01   +4.253952837322734e-02   +8.594202833610345e-01   +9.949540197907606e-01   +9.823687874137131e-01   +4.093869045339825e-01   +3.053449310409365e-01   +4.143142793775061e-01; +8.513854237849244e-01   +2.660033600598734e-01   +1.391351179029343e-01   +4.112277661009704e-01   +1.410540798299198e-01   +2.652178953743127e-01   +3.843463156164512e-01   +5.101001101317554e-01; +1.453884558772845e-01   +6.700573645145028e-01   +5.857121132341977e-01   +4.473732232423961e-01   +2.721763476737267e-01   +8.551446624255230e-01   +7.978190422613252e-01   +8.164346090470997e-01; +7.395479987888798e-01   +1.443966634949110e-01   +6.254362898892876e-02   +2.448649423233118e-01   +2.234162931167836e-01   +4.805438991340353e-01   +7.808606931113707e-01   +5.404179606853795e-01; +1.796441902918641e-02   +7.761193018837224e-01   +9.528651197037334e-01   +5.983979684128264e-01   +7.927679159737910e-01   +3.375394027019434e-01   +6.459460157190687e-01   +5.894002036068122e-01; +2.304881083222133e-01   +2.669195572112451e-01   +4.958128933226141e-01   +7.523588987042294e-02   +8.200724632057033e-01   +6.346149685210125e-01   +2.418852211869812e-01   +5.380699386717491e-01; +5.376470274205797e-01   +8.819077784041700e-01   +2.532680098345281e-02   +9.089699371040639e-01   +7.994622471894075e-01   +4.167126604136564e-01   +6.045165269414720e-01   +5.406706802337350e-01; +7.153544298101802e-01   +3.610905901848016e-01   +5.213249348329371e-02   +4.769618210979313e-01   +1.154124225472720e-01   +5.435198819478624e-01   +4.186089864524500e-01   +1.544063239835007e-01; +4.322047680285471e-01   +1.211225545743710e-02   +3.029096925423701e-01   +5.041790671050116e-01   +6.406328270431865e-01   +3.379118073893659e-01   +2.966317634791346e-01   +6.992335497450197e-01];
L3I_L3E_iAMPA_netcon = [+6.014997012337831e-02   +7.755305682582410e-01   +5.545336890000084e-01   +5.689885720837065e-01   +9.129496520129072e-01   +8.319323859268525e-01   +8.467939602012244e-01   +8.627510953948095e-01   +5.267624271734702e-01   +9.919153249557806e-01   +4.807968194294294e-01   +3.496923228928334e-01; +9.239709244341278e-01   +8.335406440371498e-01   +8.481610881838215e-01   +9.337904441769490e-01   +5.890968436705677e-01   +3.997111769098723e-01   +6.293048475592621e-01   +8.529766548870745e-01   +5.660229661997115e-01   +7.007053044146058e-01   +7.402956656607237e-01   +3.954864847952935e-01; +1.834512156684512e-01   +5.924913480193880e-01   +9.693731302713261e-01   +7.794991471064451e-01   +5.775613656312435e-01   +7.049234051310739e-02   +4.405538190672624e-01   +9.486350054387475e-01   +9.814436302896505e-01   +8.395067403275128e-01   +5.946109788189927e-01   +9.899712517006900e-01; +5.392153014337953e-01   +7.598907596788707e-01   +4.667993382265950e-01   +5.985528511504400e-01   +6.519209698777417e-01   +3.779740129290278e-01   +2.305338385852599e-01   +6.999286617742405e-01   +9.625717828982879e-01   +7.352324294471578e-01   +2.553033833229980e-01   +2.943228370547191e-01; +3.997110501052125e-01   +6.618736333638578e-01   +7.694298745143960e-01   +6.388733658759811e-02   +4.300645570303513e-01   +8.577799744726432e-01   +5.264964148365865e-02   +3.581975315879463e-01   +5.567164351022164e-01   +9.947743167187729e-01   +6.086135084628345e-01   +2.315683753610853e-01; +1.012200707787402e-02   +5.849517839724584e-01   +2.300870042421767e-02   +5.370787815606731e-01   +9.395269634178713e-01   +2.746421013374642e-02   +7.044032532719346e-01   +3.769998412933534e-01   +5.234080340910754e-01   +5.053179189178474e-01   +2.323593126610855e-01   +3.278529920327861e-01; +1.075793240864938e-01   +2.550123930420205e-02   +6.740313513516064e-01   +8.602581609489026e-01   +1.022660672128660e-01   +4.192776442632188e-01   +8.498273229282748e-01   +8.479719224232655e-01   +4.709658502745995e-01   +1.910958667596789e-01   +1.942663458693412e-01   +1.691706643796332e-01; +8.542727818760895e-01   +6.837131889991185e-01   +8.406143322527315e-01   +3.373632645743450e-01   +4.091022416610410e-01   +2.526495867798135e-01   +4.038207389456260e-01   +3.869351876424026e-01   +8.984618225256009e-01   +9.523382734480701e-01   +2.120352143359267e-03   +3.807224986397842e-01; +3.322985771286478e-01   +3.234505196470196e-01   +6.911901544692256e-01   +1.791252342719608e-01   +8.921960546302240e-01   +7.078219944613640e-02   +2.910882327790018e-01   +7.722718541731999e-01   +4.795972708926878e-01   +4.514780062724210e-01   +6.508233940920283e-01   +5.295481212676324e-01; +1.439738033779146e-01   +8.306861318362456e-02   +8.979321005949165e-01   +8.791201062225538e-01   +7.379849440886325e-01   +9.149932563842447e-01   +2.588331991475470e-01   +7.760467420915128e-01   +4.891820175897410e-01   +6.024111592178064e-01   +3.983735741767414e-01   +5.940813798150598e-01; +7.996788360621612e-01   +7.458171048773390e-01   +9.501431819847385e-02   +8.402199908882588e-01   +9.585829694455275e-01   +2.635964033981855e-01   +5.093089174022872e-01   +4.279916774736998e-01   +3.115819531962302e-01   +6.444389129377629e-01   +2.695826903114903e-01   +1.683261030466494e-01; +6.514282478111603e-01   +9.638724178027167e-01   +7.631512591433851e-02   +8.275978879527476e-01   +9.749260225805616e-01   +1.061887597542586e-01   +1.175585895465774e-01   +4.859782972384589e-01   +8.531272553283296e-01   +7.594279757008404e-01   +5.339044084464930e-03   +6.568528984792826e-02];
L3E_L3I_iGABA_netcon = [+4.413374692738064e-01   +6.463092065163833e-02   +5.980771336182283e-03   +4.959653093561544e-01   +5.427360974826909e-01   +2.540921661455095e-01   +7.181065270939961e-01   +7.582011451154025e-01   +3.803920961593738e-01   +4.475258840270284e-01   +2.015239529432615e-01   +6.568749045370802e-01; +5.681284620087132e-02   +8.068230353629102e-01   +1.292497001405040e-01   +1.931128207153369e-01   +2.163447029106313e-01   +3.336933702692766e-01   +2.264085482977828e-01   +8.916594296503282e-01   +6.070190416037150e-01   +3.929654323111037e-01   +8.282786509009237e-01   +9.046942376820782e-01; +6.276382075713545e-01   +9.137136932667220e-01   +3.095840849802337e-01   +6.440264439560590e-01   +2.693153295538058e-01   +6.000341128217920e-01   +4.963861508746037e-01   +7.317898479362193e-01   +1.642904850652269e-01   +6.754879286943478e-01   +4.398638803318276e-01   +8.390814555466586e-01; +8.073120741456760e-01   +4.278159095149723e-01   +2.382572656182958e-01   +2.573214311398581e-01   +1.359515903590559e-01   +4.800571911621051e-01   +4.779375153278178e-01   +6.911634711281839e-01   +9.997799489093497e-02   +3.428104043889445e-02   +4.172838590824144e-02   +1.689142200767352e-01; +4.036902006060681e-01   +1.908437055379159e-01   +6.537643700445966e-01   +9.397206081022390e-01   +1.608496890162667e-02   +8.996716988527835e-01   +4.310738972404488e-01   +6.445076083549570e-01   +6.193146597187087e-01   +7.814748281870535e-01   +7.645266668446759e-01   +1.621939180603984e-01; +8.863547518776664e-01   +1.867554646229399e-01   +8.093955881967162e-01   +2.914641949154078e-01   +1.357498071837261e-02   +2.875008731764720e-01   +5.571564832007814e-01   +6.165090484316859e-01   +9.625602697340748e-01   +3.748389076746361e-01   +9.206379571905482e-02   +1.387421120163201e-01; +7.185357618678463e-01   +6.714885764433380e-01   +7.391751223896326e-01   +1.423276284019797e-01   +9.844678142285073e-01   +7.467826803955720e-02   +2.049429531256270e-01   +7.367316836388599e-02   +6.719223998691474e-01   +6.387859586799834e-01   +6.568075989585798e-01   +1.587226037476542e-01; +1.974008961101881e-01   +5.254419930974399e-01   +1.230729461975849e-01   +8.647207212000096e-01   +6.466406144210254e-01   +3.873540434678461e-01   +2.754731834924176e-01   +5.479257590324985e-01   +4.695399743027155e-01   +4.956937718622690e-01   +2.688742729217029e-01   +3.999828017168782e-01; +3.710470696520600e-01   +7.738576531841630e-01   +1.764200610290509e-01   +8.854703773928017e-01   +8.116564115929489e-01   +1.895834500260852e-01   +8.092991900110365e-01   +8.764921780757774e-01   +3.343639883791742e-01   +2.220567157851879e-01   +4.364199454884415e-01   +6.615726796428247e-01; +2.065048981372111e-01   +3.015928750083056e-01   +2.688403213842731e-01   +6.598532190272076e-01   +2.772979489884063e-01   +7.293554892440139e-01   +1.012597622692140e-01   +9.850401336477673e-01   +5.877476855126139e-01   +2.152241213321676e-01   +8.506727561214641e-01   +2.235436080855082e-01; +2.609304223989924e-01   +4.736588702617799e-01   +8.144121027656273e-01   +9.999477464501573e-01   +1.459138423940655e-02   +4.255010620898779e-01   +3.605476778326455e-02   +7.022126656853030e-02   +5.440514760219383e-01   +4.549580925206043e-01   +9.048418565769291e-01   +6.454487321424164e-01; +9.922711423298909e-01   +7.106054282194736e-01   +5.938521973207537e-01   +2.632593030582527e-01   +1.033016761358549e-01   +2.676254802884281e-01   +6.942637170465596e-02   +2.717276091580362e-02   +4.053467130663293e-02   +6.320466775284822e-01   +2.867708545926337e-01   +6.105382040174655e-01];
L2E_Input1_iAMPA_netcon = [+9.969031394608071e-01   +9.928724264351390e-01   +9.941234508153518e-01   +9.899524931011815e-01   +9.921478585409018e-01   +9.984140105341479e-01   +9.863535905280273e-01   +9.975849141956538e-01];
L2I_Input2_iAMPA_netcon = [+9.989751244255561e-01   +9.965380027533388e-01   +9.921428060580028e-01   +9.891405944321804e-01   +9.914564224214585e-01   +9.885344525404306e-01   +9.925446324046298e-01   +9.978034024806197e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
