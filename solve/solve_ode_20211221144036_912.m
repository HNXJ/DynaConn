function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.749847660560783e-01   +2.822697650979744e-02   -6.124189605955709e-01   +3.601621584184562e-01   +2.354550328585604e-01   +6.585441291980758e-01   -2.346145499401823e-01   +2.596306187206950e-01   +2.259755073135064e-01   +1.623906159552030e-01   -8.609233541070125e-01   +2.934853423641582e-01   -4.446998734534143e-02   +2.469978163292331e-01   -4.757069782743705e-01   +2.669600245777448e-01; -3.203991311057398e-01   -5.741397156075043e-01   +3.261759325475769e-01   -1.582623518430675e-01   -3.147944888879734e-02   -2.670285915625702e-01   -7.719982424908670e-02   -1.855041988773060e-02   -2.075480095523253e-01   +1.040136732642505e-01   +2.298994785310597e-01   +3.635236786771243e-02   -8.442646150371064e-02   -1.281601236141479e-01   +2.032310502988823e-01   -2.955215153403312e-01; +1.323651371107628e-01   +5.178253381113964e-03   -2.717169076469310e-01   -7.425093752247056e-01   +7.344484619996326e-02   +2.667144527789931e-01   -3.167809173205928e-01   +5.045089672620665e-01   +8.230767613642928e-03   -7.295251768604765e-01   -3.163133539778444e-01   -3.621534036157597e-01   -4.322248291585665e-02   +1.241482017129676e-01   +2.600610176595576e-02   +5.853430889505516e-01; -3.810821656449480e-02   -3.756936257508323e-02   +1.092630771408919e-01   +8.798036804126046e-02   -3.280588558839097e-01   -7.756592487346033e-02   -3.459060180145800e-01   +3.604785655808747e-02   +8.166640945049819e-04   +4.060143215711933e-01   -1.717231777628611e-01   -2.304766703248343e-01   -4.949113121541193e-01   -3.435262444575203e-01   +3.921962923344831e-01   -5.773329596913414e-01; -1.316274896723527e-01   -1.913546734989227e-01   -1.427835085986728e-02   +1.363653896738228e-01   -2.661591770197113e-01   -5.280038716962145e-01   -1.233187214309271e-01   +3.336660550834081e-01   +1.412485842971794e-01   -2.162492292885333e-01   +8.999452009130857e-02   +5.491026337078695e-01   -9.716855716288783e-03   +2.125262371547870e-01   +1.349374140940848e-01   +3.024395825281707e-01; +6.972012309479343e-01   +5.458346107192542e-02   +1.675763078571645e-01   +3.160666668078346e-01   -3.460402541074137e-01   -8.753011418728751e-03   -3.263985613322012e-01   -8.777779575019637e-02   -2.659099313752977e-01   -6.922004994150424e-03   -2.360103243039850e-01   +2.189877585832466e-02   -3.114584475497179e-01   +2.263882672650397e-01   +1.326645853683687e-01   +3.080351692872542e-01; +5.144240725406390e-02   -4.864626479920433e-01   -3.700036031085017e-01   +7.899829155011886e-01   -5.492757439557008e-01   +7.573030410175392e-01   +5.040661967972201e-01   -2.108447862131497e-01   -1.117301864524042e-01   +3.301625924232878e-02   -8.521200340413648e-01   -2.014847393984305e-01   -2.012375292743840e-03   -1.760643539017026e-02   -4.391014045420915e-01   +1.777609281492188e-01; -2.865501103929260e-01   +2.192718201763663e-02   +2.075920551399051e-01   +2.132922859474906e-01   -9.543114475866067e-02   -1.736370585471829e-01   -3.600919237497230e-01   +1.162342963428452e-01   +1.505276389701936e-01   +4.739408894526078e-01   +1.719147524112735e-01   -3.388213960027625e-01   +2.467140436318153e-02   -1.626480266023767e-01   +8.029849488551946e-02   +7.026082244179799e-02; +4.000330014208779e-01   +4.319198965374125e-01   +3.435259711206752e-01   -1.040110139712810e-02   -1.157730146557636e-01   +5.507816256747960e-02   -1.644662430422478e-01   +3.307754671280748e-01   +2.311785015971310e-01   +2.145113444733747e-01   +5.052132517888983e-02   +6.797581828211643e-02   -3.650912059755391e-01   +4.653573638712198e-01   -2.926049318979947e-01   +1.407659772559678e-01; -3.772219611654494e-01   +1.309933224163437e-01   -2.292558830899214e-01   +5.102626663508778e-01   +1.035990374323510e-01   +1.003784924157786e-01   -1.997305179401036e-01   -7.527715139707899e-01   -3.164316725543763e-01   +5.263047562345043e-01   +2.995235509586679e-02   -6.532534661437926e-01   -4.039876490604437e-01   +9.540263684239655e-02   -3.050759086131067e-01   -3.738535106931521e-01; +6.576994440314621e-01   +3.572332134345280e-01   +1.690708649248393e-01   -4.842129145621372e-01   -4.985952460693639e-01   +3.914205994870668e-02   +5.236216270826424e-02   -8.987524284409613e-02   +9.853266502678950e-03   +2.070526271920963e-01   +3.013139747551486e-01   -5.107261328862547e-01   -2.662879023443607e-01   +1.975649913852824e-01   -2.964404619861682e-01   -5.361214164078600e-01; -4.219353920094246e-01   -3.284063708638308e-01   +4.085869606963606e-01   +4.580697823129751e-01   -4.733195912373922e-01   -2.337038297304309e-01   +6.103941113661111e-02   +1.479800599904898e-01   -1.794066788752672e-01   +2.602357863147612e-01   -4.232071320394702e-01   -3.301891698488696e-01   +6.465115710804277e-02   -1.000429841806981e-01   -3.369199085613796e-01   +4.415228282639357e-01; +1.411739757570079e-01   -1.976047038070270e-01   +7.752996153791039e-02   -3.064280904762336e-01   -7.108982143162126e-01   -1.336147648788624e-01   +5.036473176074806e-01   +3.819775464145191e-01   -1.425300540109306e-01   +3.601640897211117e-01   -2.504716710177713e-01   +1.754093198673452e-01   +1.136765778050905e-01   -2.611086907988915e-01   +2.670101866876602e-01   +4.444875213631558e-02; -2.028394091704337e-01   -1.221150980470138e-01   +4.217031971251621e-02   +4.962714678445042e-01   -1.663789905513517e-01   -2.925406208287676e-02   -2.823071767142475e-01   +3.369837907609478e-01   -9.070780575929940e-02   -5.930729476680671e-01   -4.042220126187612e-01   -6.194952774369776e-02   -1.921081574886164e-01   +4.533029534376738e-01   +4.178230879926323e-02   -2.855037445494541e-01; -2.725360817525361e-01   +1.685358563038790e-01   -4.656863664583749e-01   -2.913652832049627e-01   -2.051970275040389e-01   -2.051172893136981e-01   +1.568378366459747e-01   +4.413903649109932e-01   +7.009828902832399e-02   -2.914853317353273e-01   -5.959184411363161e-01   +1.551277497093200e-01   +4.603790938720110e-01   -2.228909706383660e-01   +4.866223138549547e-01   -2.327795577113667e-02; -3.134865770383847e-02   +2.695422212641421e-02   +2.002517802732630e-01   +2.286053749631859e-01   +1.667770992630903e-01   +1.378872668599831e-01   -2.250490070949887e-02   -2.388519535188298e-02   -1.707150137362229e-01   +1.861444160258401e-02   +2.336856110811272e-01   -3.696840712590118e-01   +1.902577809650004e-01   -3.158274986069159e-01   -1.695032299267726e-01   +1.021217340088397e-01];
L1E_L1I_iGABA_netcon = [+1.027038318857301e-01   +2.375681316998840e-01   -4.098226114829342e-01   +4.283723006670799e-02   -3.598232208597001e-01   -3.324340469848451e-01   -2.577985076196142e-01   -4.516027661627993e-01   -5.266347378517751e-02   -1.108019358389147e-01   +5.137046684681738e-01   +3.337992021937201e-01   -4.312474252503139e-02   -2.950439635066514e-01   +5.310263857780639e-01   +2.507214982731514e-01; +5.922021290237128e-01   -7.663953174614486e-02   +5.062565140378098e-01   +2.887365199086714e-01   -1.035108833512870e-01   +2.419683348212458e-01   -4.316845577861484e-01   -2.893103180154722e-01   +6.251787664288861e-01   -5.548373478356924e-01   +7.254463792969361e-01   -1.309949237036639e-02   -3.180334610584988e-01   -4.077520269710369e-01   -5.667598847607855e-01   -8.600782876950303e-02; -2.034798407818086e-01   -8.105209711146039e-01   -5.197026617264422e-01   -2.872467698304859e-01   +1.626482521673263e-01   +5.116464373968930e-01   +2.457146788759735e-01   +5.446001569371784e-01   -4.405587024636716e-01   -4.686235197097921e-01   +2.020492219598694e-02   -4.464552025972334e-01   +3.429403123486623e-03   +2.764480212453981e-01   +1.681775851584733e-01   +1.954790714908351e-02; -4.616725914388153e-02   +2.799081704704462e-02   +5.335093149622409e-02   +4.021073368850652e-01   -3.106292781288892e-01   -4.605310714831038e-01   -6.375715160494143e-01   +1.801973202360146e-02   -2.674457418475364e-01   +1.880425638779611e-01   +1.369216644160551e-01   +3.241614708934423e-01   -5.386025868919839e-01   +2.893022088475887e-01   -5.881358259349161e-01   +2.384939327778251e-01; +3.489249151426272e-01   +7.321154483379996e-02   -7.979020751787903e-01   +6.775308625523809e-01   +3.483815509446593e-01   -1.936077190900146e-02   -7.925657685541583e-02   +8.847876418286680e-01   -2.950457710366873e-02   +9.899483581180450e-02   +4.155762138295340e-02   -3.852378199391362e-01   -2.159528544874193e-01   -1.938535355127637e-01   +5.441907889739719e-01   +3.728876645969477e-01; -4.559151892458981e-01   +2.491678994755785e-01   -2.022964192184206e-01   +7.650982498477973e-02   +4.716749746581846e-01   -6.416898109426221e-01   -2.237454454519856e-01   +3.230342110423216e-01   -7.918432185416789e-02   +4.086453059632009e-01   -2.411872332768470e-01   -2.487605009407608e-01   +2.345918422426013e-01   +3.730140980695998e-01   -7.009120339070760e-01   -1.582913077144460e-01; +4.321324803242262e-01   -5.799940426536537e-01   -4.205207996215393e-01   -2.377611323216819e-01   +2.558615997335589e-01   -2.647643785249021e-01   -8.492604813725105e-02   -4.879011107521436e-01   -3.020645095863896e-01   -2.612476809379879e-01   +6.168013927990738e-02   -3.381571766887361e-01   -3.165750843193815e-01   -2.071681040679114e-02   +5.190268693395067e-01   +4.828433382942663e-01; -5.945944683743145e-01   -2.434458672074929e-02   +6.121022936787064e-01   +5.384861490741740e-01   +1.047717247153433e-01   -5.099954814436073e-01   +2.067872850470984e-01   +5.623817467334522e-01   +1.358643558815233e-01   +1.867133626480498e-01   -6.273293422137961e-01   +6.730893368835191e-01   +4.379519619652597e-02   -2.207269852870787e-01   -4.123243323244945e-02   +5.581088723810398e-03; +7.663263326486530e-01   -3.302472715110075e-01   -1.905775230859793e-01   -3.036897766766685e-01   +1.219969955506753e-01   -7.481393290584902e-01   +5.814776235318381e-01   +6.459190276544250e-01   +1.378429568409470e-01   +1.914331873532919e-01   -5.139561372345018e-01   +8.167688048176318e-01   +1.715578425365685e-01   +7.083787609490723e-01   +1.396173025954825e-01   -8.223894207949654e-01; -1.931266594237507e-02   -5.385775842812579e-01   +6.103357768726377e-01   +2.128903253045484e-02   +4.466173969062880e-01   +4.977550626439333e-01   +2.282677928637864e-02   +3.168817443643561e-01   -4.869352947948560e-01   +6.057818934209558e-01   +1.341359477386970e-01   +3.820664105518782e-01   +5.246375320911739e-01   -3.104530287284047e-01   -1.616633805822836e-01   -4.683960098617059e-01; +7.165409889476833e-02   +3.320408882046885e-01   -4.425964867897962e-01   +1.915230859709520e-01   -3.523211269618107e-01   +5.005393044692868e-01   +5.290769844515353e-01   +3.796033739497308e-01   +1.298349846822605e-01   +6.064687066245927e-01   -4.672095442680798e-01   -1.291816704034384e-01   +6.535674232719687e-01   -3.094565174692751e-02   -2.972959474219149e-01   -3.279357779035290e-01; +1.375248820963562e-01   +8.444389908739875e-03   -2.633114073435604e-01   +4.331343474743218e-01   +5.895917448048262e-01   -4.490414380511046e-01   -2.738110227813325e-01   +2.014750719031700e-01   +2.215044172630481e-01   -1.127820363355307e-01   -5.713222284077534e-01   -3.755318508987539e-01   -3.508837597778569e-01   -1.623148390306040e-01   +4.440322981986132e-01   -2.878413410660229e-01; -1.109680690722136e-01   +2.613652611170290e-01   -1.464986905118955e-01   -2.307198681989305e-01   +1.552256981715787e-01   +2.388413971346485e-01   +1.315132358787159e-01   -4.581333081038159e-01   -2.916239562774181e-01   -6.099006588468262e-02   +6.662967793615255e-01   +3.971434037501628e-01   -1.178019887705155e-02   -4.362663277478004e-01   -2.565773258347695e-01   +2.253731370922218e-01; +3.540691251403642e-01   +1.146717098509586e-01   +3.676403177258099e-01   -9.166838197774810e-02   -1.055617072980173e-01   -1.408764371332159e-01   -2.702418285839532e-01   +4.784086390331233e-01   -3.972987558258342e-01   +2.269370329147297e-01   +1.757041504585251e-01   -5.517106596114563e-01   -3.021651098807801e-01   -6.331006258911978e-01   +6.192441047934574e-01   +5.348637036027163e-01; -5.317800136365914e-01   -3.068081469467622e-01   +6.138420001635555e-01   +2.969373047763592e-01   +5.479445952882341e-01   -6.005737801565666e-01   +4.342382822807593e-02   -5.100885318910504e-01   +1.096712810030643e-01   +1.880740536056068e-01   +1.058718037875362e-01   -2.158099211210495e-01   +2.076265632592290e-01   -2.903276660396057e-01   +5.775178672082005e-01   +3.129353476479545e-01; +2.591704205631858e-01   -2.015971110391949e-01   +2.702735869496763e-02   -4.211356729794170e-01   -4.734745959946000e-01   +3.619578738255736e-01   +3.820720658322736e-02   +7.479593920613370e-02   +1.021221418304240e-01   +4.870221631844741e-01   -3.838305974632979e-01   +1.676546730283177e-01   -7.609046028892522e-03   +7.455411074431244e-01   -9.885877257511055e-02   +3.664362186864266e-01];
L2I_L1I_iGABA_netcon = [-2.007604944481718e-01   -2.442274180172442e-01   -2.224038322571230e-01   +2.805491643211548e-02   -7.198773630447231e-01   +2.249368143728586e-03   -3.906663070484340e-01   +3.257545875524868e-01; +2.631471228942315e-01   +3.020552004565342e-02   +1.148713585240186e-01   +4.181763000442994e-02   +1.508102386285878e-01   +3.685472437182567e-02   -8.856129573014682e-04   -3.219703606172035e-01; -1.077454427095541e-01   -4.704700178269437e-01   -3.911072115470110e-01   +1.780391330984822e-01   +8.061455090359038e-02   -3.024863835859867e-01   -1.682399473970736e-01   +7.912167142716048e-01; -3.547156516103598e-01   +3.107013056859664e-01   +3.296737981987670e-01   -1.545785007765603e-01   -2.025002537918474e-01   -1.608427672062459e-01   +4.205276564737331e-01   -3.252216062926004e-01; +1.078793800862352e-01   +5.189033568360439e-01   +2.581715614544756e-02   +6.280323952062431e-01   +2.590863903481677e-01   +2.755494454651016e-01   -5.648237551866984e-01   +5.959897845383889e-01; -4.088071140600130e-01   -1.868761132779317e-01   -1.563683667491449e-01   -2.976101343344467e-01   -4.245400412966537e-01   +2.462326732092467e-01   -5.839447124122565e-01   -1.276055961403386e-01; -3.613461316984834e-01   +1.491346013474066e-01   -3.234851880085745e-01   +4.195995336277133e-02   +4.259271519061446e-01   +2.270812020635003e-01   +3.208197487998007e-01   -2.211314616535223e-01; +5.616277506870913e-01   +2.365111903922525e-01   -1.890644075086775e-01   -3.440736226157214e-01   +1.342854879797183e-01   -2.964693809370391e-01   +5.351890326056985e-01   +1.657917807816778e-01; -5.618833261369236e-01   -2.646108211851188e-01   -4.238933518301961e-01   +2.027896194664084e-01   +4.438732040982903e-01   -4.270324847962779e-01   -2.897017832009546e-01   -7.602613123757720e-02; -1.615360373146404e-01   +2.306376693808683e-01   +2.551603468236860e-01   -5.439667555534500e-01   +1.486005877509652e-01   -2.419007157319882e-02   -4.034726224670827e-01   -4.403210968720329e-02; -3.103193771995334e-01   +4.998922030043676e-01   -4.845979083552989e-01   +1.478227128561423e-01   -3.936920960392141e-01   -4.411342372143451e-01   -4.948493064331969e-01   +9.604397959411705e-02; +2.135864218035044e-01   -5.665031500335892e-02   +3.425562489414335e-03   +1.327393667105361e-01   +6.678493123884736e-01   +2.268865490886962e-01   -3.067229274812835e-01   +5.029517734242558e-02; +8.794549029809751e-03   +4.807686966373594e-01   -1.981158752430012e-01   -7.351348683449553e-02   +5.935626286306742e-03   +2.128088062832299e-01   -5.673189469520725e-01   -3.501275117162824e-01; +1.375523989845827e-01   +1.606571281664918e-02   +1.616811881498584e-01   -7.124377533980288e-02   -4.359930528494654e-01   +3.991114035438518e-02   +1.291520298639800e-01   +8.519490371225778e-02; -3.598269669495410e-01   +9.225705307762629e-02   +1.346366054556747e-01   -1.683803083761747e-01   -3.339150260533878e-02   -2.602147820787118e-01   -2.528350878045414e-01   -2.328486403071928e-01; -3.848957247178579e-01   -2.184972208638405e-02   +3.625141103484557e-01   -1.919679342359494e-01   +2.098615234323213e-01   +5.472593436464479e-02   -6.651983932988474e-02   +3.076634918907243e-01];
L1I_L2I_iGABA_netcon = [+8.070806647080569e-02   +1.800697463833287e-01   +7.461460576086065e-01   -1.925787291200101e-02   +4.942202284058052e-01   +6.691208617781192e-01   +6.912343555091727e-01   +2.195878489761725e-01   +7.232666635383048e-01   -7.815763008955325e-01   -5.974755053065126e-02   -6.908126968247326e-01   -1.541609104609623e-01   -2.737062585668258e-01   -1.981742490336963e-01   -7.446253519714808e-01; +4.270413534644441e-01   -1.204101302146389e-01   +1.462456717726957e-01   -1.804319888835524e-01   +5.976475899021234e-01   -3.271421732662456e-01   +8.012019552855839e-01   +5.912862698873667e-01   -1.658652638278850e-01   +4.284344221520429e-01   -4.541902507651963e-01   +4.728514026251844e-02   -1.962365931920546e-01   +3.819964945878050e-01   -1.280318021824950e-02   -7.536864016749150e-01; +1.772149245404729e-01   +2.273624677124844e-01   -2.251704589397981e-01   -2.953007408448910e-01   +2.305038774582193e-01   -5.410611305280850e-01   +7.015682595037122e-01   +2.005998392073952e-02   -1.666682722580138e-01   +6.719057272015726e-01   +4.955486534794874e-02   +2.812242912674322e-01   +6.901241155793948e-01   +3.248621716987835e-01   +3.588347397286679e-01   +4.458448459410224e-01; +1.405171553606045e-01   -5.837166698402005e-01   +6.050280865973280e-02   -6.406727140380534e-01   +1.204515083421843e-01   +3.889794951371972e-01   -4.852285646545230e-01   +4.329599410760330e-01   +7.873273876202603e-01   -1.094657098844242e-01   +1.348123572927081e-01   -1.362444217208804e-01   -7.284826761695314e-01   -1.296429099166002e-01   -1.135957119129681e-01   -2.957168344405850e-01; -1.433330089532043e-01   -2.974782188568381e-01   -5.289019778434267e-01   -1.036048377810330e-01   -2.918247598923476e-01   -3.003120063874323e-01   +5.102764225907250e-01   +2.598599726867692e-01   -5.464602551975335e-01   -2.463917876327998e-01   -4.528508422365284e-01   -1.346217738827070e-01   -3.475281083000613e-01   -4.089362704665560e-01   +2.858271759408840e-01   +5.826552026053561e-03; +1.230108011405630e-01   +1.590456220060162e-01   -8.124446401116417e-02   +3.180667012167815e-01   -2.198804057346946e-01   +4.618854327029692e-01   -8.350279779001943e-02   +1.442115351209947e-01   +2.526757157480018e-01   +4.121653500393067e-01   -4.145650154987414e-01   -6.415166587428132e-01   +1.231942063520532e-02   -3.316503528889355e-01   -3.442535838127966e-01   -4.275303871893231e-01; -1.976683374327252e-01   +3.166193794642885e-01   +6.669923078041975e-01   +4.000790092646400e-01   -2.889752906756196e-01   +5.848212916801517e-01   -2.798596482284886e-01   -7.390282090089868e-01   -5.824639737756943e-01   +4.876672773835177e-01   -4.872557168324418e-01   +4.440821795500919e-01   -1.391020232950615e-01   -6.237579714208250e-02   +3.345694620725170e-01   +1.360589575958337e-01; -4.042242420012529e-02   +4.348048032825482e-01   -4.380429471127891e-01   -5.821746290912891e-01   +1.350693980149333e-01   -2.892106604128840e-01   -5.610383102420817e-01   -3.032727038874822e-01   -3.956377561981136e-02   +8.945503791536426e-02   +1.238321093037973e-01   -1.250977917811947e-02   -3.540120605353492e-01   +5.526635593133954e-02   +4.520564148660971e-01   +1.060468497210545e-03];
L2E_L1E_iAMPA_netcon = [-1.575968617009786e-01   +8.351777144490041e-02   -2.976868197468647e-01   +3.353430035084818e-01   +3.710843066272653e-01   -3.285436850643945e-01   -4.085473169195191e-01   -1.138615478900408e-02; -8.061420301980884e-03   -1.521588223785414e-01   +4.730384418173831e-01   -4.656590337550595e-01   -2.768110943359398e-01   -2.075500519853453e-01   -3.311655621586789e-01   +4.792266426808497e-01; -1.836085149101679e-01   +7.856967234655510e-01   +2.587243874940469e-02   +1.903092314958306e-01   -1.568757165375582e-02   +2.272111351930326e-01   -2.120242443124261e-02   +1.296491540962842e-01; -3.179432844073414e-01   +8.335747580443920e-02   -6.738546285397075e-01   -9.596639846327817e-03   -6.825715512248475e-01   +2.995661660373223e-01   -3.374987510827053e-01   -4.412266169561552e-01; +2.469921061402017e-01   -1.506009981627282e-01   +5.824917343643439e-01   -3.038992073218392e-01   -1.284137588233173e-01   -1.238010330727515e-01   +6.585516470092212e-01   +1.413135287658094e-01; -2.008455665453326e-01   -5.940346340763313e-01   -1.438426033266015e-01   +3.835054062632636e-01   -2.713134229124105e-01   -5.685574708879056e-02   +1.231949723039115e-01   -5.119015654096278e-01; +6.423241942526818e-02   -1.416488051322794e-01   +1.753386526226012e-01   +4.221310524544680e-01   +5.945904256634651e-02   -5.455125788823532e-01   -4.018212656744483e-01   +3.363116534705441e-01; +2.668426466478089e-01   -1.366126318389214e-01   +9.933475689962959e-02   -4.786486182394890e-02   +3.114548431199411e-01   -7.560509847871796e-01   +1.299400582145165e-01   -7.071508984867418e-01; -4.705751677238755e-01   +2.016891304348466e-02   +2.502996720736159e-01   -7.391500515754326e-02   +3.436904700358848e-01   +1.959040355054149e-01   +6.650204124532598e-02   -5.906291082997223e-02; +2.637216098124434e-01   -2.961441067008472e-02   -1.534559469264509e-01   +2.480349477312715e-01   +4.276765240396839e-02   +2.291887895632895e-01   -3.252853497105231e-01   +5.622073785970545e-01; +3.040248540405912e-01   -1.860775447383403e-01   +1.135131138779149e-01   -4.134302527046390e-01   -3.392130349482827e-01   +5.969238397101064e-01   +3.640692428935535e-01   -5.241926820065637e-01; +3.782596319907131e-01   -5.208303367163658e-01   -3.707856588832401e-01   -2.140778732578394e-02   -4.962128387383493e-01   -4.303117530955319e-01   -4.117266299998608e-01   +3.379139714986933e-01; -6.631313002403527e-01   +3.188220237727495e-01   +2.355703549357756e-01   +2.611533840446230e-01   -8.422206264198366e-02   +1.050870055493393e-01   -3.079884800469598e-01   -5.292921189876192e-01; -3.928301896250857e-01   -9.448170475305678e-02   -1.339341750379575e-01   -1.586927452796782e-01   -1.313789335438247e-01   +2.352275778501196e-01   +5.801065038735922e-01   -2.362333871690881e-01; +1.831213667657915e-01   -1.265255713045553e-01   -8.731209013476698e-02   +1.767328226861818e-02   -5.030453252583027e-01   +6.933220909219290e-02   -5.062546145640924e-01   -4.943931789623695e-01; -2.460554699358447e-01   -9.832351527608807e-02   +1.947083627821924e-01   -2.516512059775921e-01   +4.707359436560434e-01   +3.700360275344666e-01   +2.090403843540931e-01   -2.795246546142408e-02];
L1E_L2E_iAMPA_netcon = [+1.023704554162026e-01   +4.085072818642901e-01   -2.420159419327090e-01   -4.756629254317007e-01   -7.581061351564885e-01   -7.226532092707232e-01   +9.037149211902007e-02   -2.359020323740053e-01   +3.122218699881458e-01   +2.523889977694849e-01   -3.601362198440578e-02   +2.581063436094820e-01   +6.330342081178345e-01   +4.077225896656518e-01   +3.044375071864793e-01   -2.844589277309904e-01; -2.786139101141771e-02   -2.038989154020432e-01   -3.363667357856990e-01   -1.442099445810813e-01   +5.539296037704272e-02   +2.994643383838023e-01   +1.405978510591572e-01   -1.952059788497614e-01   +7.241875035908003e-02   -2.449039514392793e-01   +3.002715613516122e-01   -4.501898282626908e-01   +1.551967354439586e-01   -4.705544417215021e-01   +6.371371421687221e-01   +3.931079942934688e-01; -1.679027260217452e-01   +2.616443394581416e-01   -7.159032287539596e-01   +4.489918564063895e-01   -4.306404318033933e-01   +2.651574642135338e-01   +9.440002730236055e-03   -9.837200602750834e-02   -3.695365468195496e-01   -6.510169865246084e-01   +2.049406603861017e-02   +1.771489865496333e-01   +5.366603348539392e-01   +2.959893090361623e-01   +6.248322573739344e-02   +1.168204545133186e-01; +2.496449186134390e-01   -1.090929607359701e-01   +3.928493275044426e-01   +1.107241478216818e-01   +1.128670216606759e-04   -6.824180313399102e-01   -1.757028418082511e-02   -3.284735795655027e-01   +6.949922835847895e-01   +5.436459773494610e-01   +4.496416826733025e-01   +2.272290428186163e-01   +8.345536574143411e-02   -2.834552848704937e-01   -1.219964534099327e-02   +3.053946176854095e-01; -3.298807744013671e-04   +2.080720097973666e-01   -8.463441917511488e-02   +2.217454042684461e-03   -7.534041279114659e-01   -1.335839486170027e-01   +5.419905101967289e-02   +3.150943731612220e-01   +3.271186925806937e-01   +5.376452773779098e-01   -7.623386288652012e-02   -1.006137654948907e-01   -8.478518763514367e-02   +2.994497793968955e-01   +3.653051171079032e-01   +5.449196456225921e-01; +8.459036203133964e-01   +2.308000746686095e-01   +2.801026096215422e-01   +4.628577175040594e-01   -3.426580796071337e-02   -2.314456883532025e-01   -5.794386774469328e-03   +3.127713963584569e-01   -8.853678194607295e-02   +6.928724368664502e-01   +2.331352612707722e-02   -3.209327105472478e-01   +2.800873161367888e-02   +3.754280286357599e-01   +3.375890359276187e-01   +1.760724148018340e-01; +1.687162938044743e-01   +6.915339761130461e-01   +2.992421745181681e-01   +2.342790684184740e-01   -1.571185982100197e-01   +4.558513711144396e-01   -1.807281790109289e-01   +5.052388549071357e-02   -4.584575321999994e-01   +1.221214432864809e-01   +7.552145639767743e-02   -2.537531465586477e-01   -2.725551875835144e-01   -4.224606384876611e-01   -5.174728763870106e-01   +2.546151319281920e-01; +6.820140477298566e-01   -3.762575659851105e-01   -2.921534926642000e-01   +4.486239543983292e-01   -4.978636855976802e-01   +3.162893070344150e-01   +5.756201441519460e-01   +2.585038459684191e-01   -3.486358894038739e-01   -6.784292028182598e-02   -3.051122550712917e-01   +3.102863767126863e-03   -1.446380573384778e-01   +1.925955424813980e-01   -2.911205218924111e-01   -5.581627748516497e-01];
L2I_L2E_iAMPA_netcon = [-1.438038465119674e-01   -1.228198229767660e-01   +4.817077903875772e-01   +2.521727953990286e-01   +1.733543874333706e-01   -2.076038580788136e-01   +4.492108460681900e-01   +2.025996046374455e-02; -3.342437247012381e-01   +6.034695363634027e-01   -1.059403641545174e-02   -1.978378972978249e-01   +3.707421860398463e-01   +2.353543409658311e-01   -1.926871469431355e-01   +6.537166483758836e-01; -1.536518881951631e-02   -1.431522482219938e-01   +6.137382778247189e-01   -1.764461512870247e-01   +8.867009306259468e-02   -3.397615648032356e-01   +3.873559348720311e-02   -6.333574458446291e-01; +1.834049167793913e-01   -1.439263972163285e-01   -6.848948889474231e-01   +6.752999222992931e-02   -6.112516689374586e-02   -2.273836715523159e-01   -1.892658195176020e-03   +5.776024406524781e-01; +2.532408943111046e-01   +6.437278485029629e-01   +3.907997693105773e-02   -2.493099481493634e-01   +2.031361252161545e-01   +1.792519540738871e-01   +5.184457500851145e-01   +1.621579037312239e-01; -3.925825623588308e-01   -2.671037016616806e-01   -9.139218764098353e-02   +2.716640724854916e-01   +2.847846771633763e-01   +1.534678141609183e-01   +3.232106710184696e-02   -4.229404481488555e-01; -6.222481008722569e-01   -6.363900916059663e-01   -2.426857556839442e-01   -4.200294600498795e-02   +6.776322884355057e-02   +1.269016129836457e-01   -7.008877821576391e-01   -6.573540105759549e-01; +5.736627492767132e-02   -1.560620888666026e-02   +6.179416846720194e-03   +1.611736128668865e-01   -6.804614172869619e-03   -6.065282592909217e-01   +3.670006314425550e-01   -3.101738529738897e-01];
L2E_L2I_iGABA_netcon = [-4.196385630180554e-01   -3.111532890724132e-01   +9.933288184481159e-02   -8.917234337742243e-01   -1.611580524464639e-01   +1.533196871067316e-02   -2.209176024439004e-01   +5.605090782528253e-01; +4.947353066900680e-01   -1.905658566408948e-01   -2.508369736312714e-01   -1.632028424515258e-01   -5.826847526539053e-01   -1.171175049104524e-01   -5.309109010994384e-01   -1.278386696031505e-01; -9.975116373748059e-02   +2.365807200325347e-01   +6.077199927259140e-01   +5.401891945250082e-01   -3.764689577234028e-01   +2.057018154131353e-01   -8.269514247616403e-01   -4.762405109175730e-01; +8.354671753588871e-02   -1.813969247690974e-01   -3.466769545860608e-01   -6.662694062503326e-03   +5.397584461192273e-01   -4.481252428804650e-02   +8.788567448702964e-02   -2.020070063255466e-01; +4.286437630747051e-01   +5.642796607152500e-01   -6.565570778607153e-01   -2.384410839874648e-01   -2.053185247843952e-01   -1.934222801316775e-01   -1.339261023683375e-01   +8.159766820146275e-02; +5.432438449587817e-02   -9.133260338457233e-02   -2.521914672755296e-02   +5.458550457261319e-01   +4.045090883997607e-02   -1.487044130720039e-01   +6.893967539279666e-01   +1.160792882549041e-01; +5.624204639959449e-01   +1.740417527612782e-01   -4.624141780729353e-01   +6.251231463469971e-02   -4.636900410566996e-01   -1.956826173394124e-01   +3.073742127159521e-01   +4.336606302413450e-01; -3.565307107748076e-01   -4.260369626872997e-02   -2.734166827845467e-01   -3.127501872864501e-02   -1.086891893861340e-01   +3.959077049766810e-01   +2.276210855513328e-01   +4.142302925846914e-01];
L3E_L2E_iAMPA_netcon = [+3.156148582571293e-01   -1.085233339106374e-01   -5.880341844858584e-01   +1.541051363860484e-02   +4.542265907338031e-01   +4.358696625883037e-01   -3.408415297466112e-01   -3.711282234340305e-01   -2.636007459207025e-01   +1.951153319851230e-01   -3.667723438614469e-01   +4.301612793948114e-01; -5.350693140849484e-02   -1.323984109830288e-01   +1.058056466943045e-01   +2.917988510429895e-01   -1.598531599630396e-01   -3.540514592968906e-01   +5.781331090138050e-01   +5.001932024389670e-01   +1.718391238566650e-01   -1.525589361253488e-01   +1.675392920601495e-01   +3.493086852117985e-02; -1.333574117217469e-01   +2.384324814529653e-01   -1.020774553394804e-01   -3.671141378131457e-01   -3.609823632294352e-01   +2.282506565741070e-01   +5.999418899439318e-02   +8.060726677781357e-02   +3.628587360542402e-01   +4.851530497923586e-02   +4.427892699403224e-03   -2.590600296958567e-01; +7.536307722674270e-01   -3.137147559546015e-01   +2.527738332244732e-01   +4.663890517880034e-01   -4.467564595852362e-01   -2.479069889213633e-01   +7.909032019606696e-02   +4.646963564399310e-02   -3.133386920266843e-01   +8.015748967437106e-02   -5.613498802555843e-01   -4.228818189121996e-02; -6.834985756560029e-01   +4.372578269745628e-01   +1.078429687038229e-01   -2.469322640900003e-01   -7.352023367660430e-01   -1.516634878496271e-01   -6.311781835446717e-02   +5.985941910930810e-01   -1.431379501495852e-02   -1.044376426509550e-01   -3.323700055011139e-01   -4.018426036581690e-01; +2.972444823917625e-02   +2.603037643198428e-01   -2.168055516659025e-01   +1.891293931873601e-01   -3.680841603727906e-01   -3.411018199606674e-01   +1.350851141835101e-01   +1.200014293874740e-01   -3.025592013841618e-01   +4.859739395753916e-01   +4.039567433456643e-02   +5.474838104979340e-03; -3.490288495592908e-01   -1.120407553818300e-01   +3.990038893395475e-01   -7.690489515412392e-01   +2.607437022183743e-02   +6.834790375088157e-02   -3.581188297310500e-01   +9.697917956761803e-02   +3.332482313618810e-01   -1.596248029156267e-01   -1.994586901405161e-01   +6.490739282882692e-01; +3.194866121351557e-01   +1.577000467133968e-01   -5.210545037594417e-01   -1.525443358710559e-01   -2.206697250396802e-02   +5.493787540968365e-01   +2.097033003682685e-01   +3.981139297987644e-02   +1.671395948201741e-01   -6.907203572007609e-01   -1.432435474263537e-01   -2.733360480696734e-01];
L3I_L2I_iGABA_netcon = [-3.785828507642389e-01   -3.666706584015790e-01   -3.477176113271641e-03   -3.670731174088939e-01   -2.128222331013001e-01   +1.993834275454226e-01   -3.129512256223032e-01   +2.860225234358832e-01   +4.629233068445202e-01   -4.622606548039762e-01   +6.408753155251561e-01   +8.849662097863770e-03; +3.414660661575707e-01   -2.151080851106708e-01   -1.682435912201903e-01   -4.794242808240570e-02   -3.066775974508962e-01   +6.538164773144854e-02   +2.136801554783026e-02   +4.876847620435912e-01   +5.771132007451182e-01   +1.640010297961185e-01   -9.307308967312954e-02   -5.175555616162065e-01; -5.423276385982443e-01   -2.746528340245069e-01   -4.652304250907652e-03   -1.309294762230997e-01   +1.007716592139074e-01   -1.062357024158441e-01   -4.612528468503431e-01   -3.238489432298309e-01   -8.609268843229215e-01   -3.548579163117851e-01   -4.205949699247059e-01   +5.903262310555689e-01; -2.062460798995343e-01   -2.170906287021499e-01   +8.314149655735627e-02   +4.384714272131021e-02   +3.595636314268577e-01   +7.008828918566744e-02   +4.147501700014849e-01   +3.375263827575939e-01   +1.655473485904666e-01   -4.163385965530309e-01   +5.009188481454877e-01   +5.160444023429333e-02; +2.812463203928175e-01   +8.862881341366861e-02   -1.056394758761434e-01   +5.987814247987109e-01   -2.753358362230454e-01   -8.386234160432829e-02   -2.613202362298832e-01   +3.949715601595493e-01   -2.345733578453244e-01   -6.148617306368439e-01   +4.248566549715765e-01   +3.538239949725010e-01; -2.699587796708531e-01   -5.216761346078997e-01   +4.304698179496561e-01   +6.643351476856317e-01   +4.602324692811298e-01   -5.547585590584965e-02   +4.597593545789788e-01   -5.239878948069639e-02   +6.649771790798500e-02   +2.603707313301087e-01   +2.779698291680958e-01   -4.378503090144916e-01; +5.232729207402181e-01   +1.800972722792922e-01   -1.473194772630612e-01   -4.497042156293883e-01   +3.941494929598949e-01   +2.092484874777634e-01   +1.683121373957569e-01   +7.974359282169851e-01   +9.664266410452178e-02   -1.406021062551895e-01   -1.325559367800593e-01   +1.675796863057187e-01; +1.403212515391262e-01   +7.660855075142493e-01   -3.407243927219325e-01   -1.836869952415995e-02   +8.711175937151970e-02   +2.698826731736362e-01   +4.114265362678834e-02   +2.897697120405092e-01   +3.841876878752380e-02   +4.864211682673180e-02   -2.611194822561634e-01   +2.266170320841774e-01];
L2E_L3E_iAMPA_netcon = [-9.037311256685719e-02   +2.134763443603427e-01   -3.332336956459375e-01   -3.922014453759300e-02   +1.001049178985090e-01   +5.717323752974314e-02   +1.173006666141956e-01   -9.208956690872505e-02; +4.081000899122603e-01   +3.950320267630151e-01   +8.505527606771087e-01   -2.857108947930485e-01   -1.986601308947390e-02   +8.568351741742616e-02   -6.494802038260829e-02   -5.581757564742252e-01; +3.705881002944033e-01   +1.332111148162509e-02   -4.418528627838004e-01   +3.128862538920591e-01   -4.136115145961929e-01   +5.233173313676934e-01   +8.395534192082469e-01   +1.490064571931768e-01; -3.021936138325638e-01   +2.075124611767441e-01   -3.868741522104507e-02   +5.209813183553341e-01   -1.881221545415490e-01   -5.940746715023340e-01   -1.636180405716223e-01   -2.133391090852052e-01; -2.049630947282133e-01   +4.561690755767835e-01   -4.363149455968802e-01   +5.854022038736179e-02   -6.583788546655943e-02   -2.412465810692755e-01   +1.526531848582742e-01   -3.385208748857018e-01; -1.819684900627685e-01   +4.973253110308684e-01   -1.924512190949957e-01   +1.754319545286344e-01   -8.313795611055594e-03   -2.614805739177544e-01   -2.056535394840727e-01   -4.417414751028693e-01; +2.274426792603741e-01   +5.264813857461540e-01   -2.866651434723019e-04   +8.835253739139680e-02   +7.130426363668951e-02   +4.705279765180151e-01   -1.018840878504031e-01   -7.222353414647116e-02; +1.604853400902941e-02   +3.837780960747654e-03   +8.142590259139244e-01   +2.795366981781428e-01   +3.064921286483401e-02   -8.112250528417955e-02   -8.403495874543575e-01   -3.460913362002865e-02; +3.333095785104178e-01   +6.368034252595672e-02   +1.926116727215572e-01   -2.565893653560881e-01   -2.798983894700138e-01   -5.573015114629497e-01   +1.442896209705688e-01   +3.703680086539874e-01; +1.912935097751134e-01   +2.185920007413852e-01   -2.720741018986872e-01   -2.662197482791577e-01   -3.501842123965513e-01   -7.440396056567014e-02   -3.881755783239397e-01   +9.026201013399405e-01; +1.753065401608743e-01   -1.200679477248273e-01   -4.107929689393869e-01   -3.334044296804548e-02   +5.891522574920406e-01   -3.049277870036627e-01   +1.248758106649633e-01   -4.134765780743207e-01; -1.187516533249697e-01   +2.954582543051270e-01   +3.448641896439746e-01   -3.605061873924805e-01   +3.039483804769034e-01   -2.615803035227257e-01   -8.436729219209179e-01   -3.294342751134793e-01];
L2I_L3I_iGABA_netcon = [-3.103306742697314e-02   -2.494648235412881e-01   +2.094729895631802e-01   +5.704882451514562e-02   -1.094232690495684e-01   +2.324649954996071e-01   +2.868390913223610e-01   -4.112879881079324e-02; +3.177169546739219e-01   +4.523642476898791e-01   -6.815312080372589e-01   -2.754001533417502e-01   -5.658476829257880e-01   -4.463514116684252e-01   -9.960270565381694e-02   -1.290830755745383e-01; +2.780178100264649e-01   -8.732962868436327e-02   +2.850438514066507e-01   +3.646495682938569e-01   -2.648325597819656e-01   +2.027099206188575e-01   -1.491978939139638e-02   -2.601759958731062e-01; +5.874488271300481e-02   -2.810572924436952e-01   -6.322939032495811e-01   -3.103743248509629e-02   +1.812515166284426e-01   -2.826323994561889e-01   +2.279788887209533e-01   -2.299764122793638e-02; +3.576045282494111e-01   +5.307597553830631e-02   -7.692521385758462e-02   -1.187534041275619e-01   -2.429467770435043e-01   +4.163251101011866e-01   +2.569899014880721e-02   +3.706356832307919e-01; -2.337062307667915e-01   -6.718600398965863e-01   -4.221095359518195e-02   -1.507334248723526e-02   -2.750097559700053e-01   -5.162131305244808e-01   -5.583462620057698e-01   +2.777585136906098e-01; +5.814581208481470e-01   +6.559898642600148e-02   -1.472494181649342e-01   -4.891501430107408e-01   +2.507531633089511e-01   +2.717189825692691e-03   -4.692713530976436e-01   -1.095322082790120e-01; +3.822675006089290e-01   +3.383669147858511e-01   -3.347154489703710e-01   +2.496018614302803e-01   -1.733768917129024e-01   +6.530693678186628e-01   -3.244557468641149e-01   +2.200612775051119e-01; -1.384858908119946e-01   -2.826088296163171e-02   -1.288320088177955e-01   -3.897577319407055e-01   -7.029643013163474e-02   -1.776548548466798e-01   -2.402957893056638e-01   +2.051778928690307e-01; -2.796379225947624e-01   +1.126452423505032e-02   +2.600265374683043e-01   -2.159774337016957e-01   -5.528401632874619e-01   -5.258295969110729e-03   +3.887603724234902e-01   -9.504651843251340e-03; -1.089828281045137e-01   -1.080570728128312e-01   +3.765183062824595e-02   -4.970597777747378e-02   +1.262884103666833e-01   +1.799204872096233e-01   +2.714754731072943e-01   -1.473226792672457e-02; -3.846717530652977e-01   +1.900935642597207e-01   -1.294323614006118e-01   -1.254177844624950e-01   +1.199959636351393e-01   -1.996553726174386e-01   -7.365700313905210e-02   +1.882752570708814e-01];
L3I_L3E_iAMPA_netcon = [+2.855887497991848e-01   +8.028652693597350e-02   +5.215239313925731e-02   +4.376622950979820e-01   -3.481913212190497e-01   -2.556992624263743e-01   -4.602967589578874e-02   +5.815765761109114e-02   -4.820410139281969e-02   -4.289385992740825e-02   -5.491267935043003e-02   +3.718924577057882e-01; +4.094730983801645e-01   +8.189253153971796e-02   -6.927656634247919e-03   +5.622688815228064e-01   +4.034191842037291e-01   +1.502044156313907e-01   -2.984815989959609e-01   -1.854860658474799e-01   -7.433480404594224e-01   +1.893366341697643e-01   +1.433835730183156e-01   -2.746223553587130e-01; +4.497345445806719e-01   +3.053462081246557e-02   +5.355876036256768e-01   +2.066445448925497e-01   -4.773725223129697e-01   +1.671588913879858e-01   -8.256700400356731e-02   +1.895848677719736e-01   +1.941482343862311e-02   +1.373068219559821e-01   +2.418148223805981e-01   +6.227195102695172e-03; +3.153787701416793e-01   -4.943619785898967e-01   +1.518822454796467e-01   +6.929709613911444e-02   -7.045451272140805e-01   -1.648444044655799e-01   +8.497414512246054e-02   -3.500107751422886e-01   -3.384913938858561e-01   -4.470129037919539e-01   -3.207365917020014e-01   -3.718954975484715e-01; -8.420981854226312e-02   +3.106766402506519e-01   +2.704341332964310e-01   -3.050491500322638e-02   +1.838441474989683e-01   +1.361470910458792e-01   +1.857708823211647e-01   +1.914872854385884e-01   -8.337137843329050e-01   -1.212519327666091e-01   +2.820503081806600e-01   -4.416690440812940e-01; -9.303958589737617e-02   -4.457134601846175e-01   -4.286344913810675e-01   -6.054327957645243e-02   -3.434127432257372e-01   +6.051566112137473e-02   -2.499570084588579e-01   +2.647264784954518e-01   -6.378036530762916e-01   +4.365995091529309e-03   +2.711935642290299e-01   +6.832136009099393e-02; -2.022555314832395e-01   -4.702980296044340e-01   +4.383948832840818e-01   +2.190450463081514e-01   -7.358540880618816e-02   +3.410345533760887e-01   -1.632122157513695e-01   -1.335539248438036e-01   +6.621278138934579e-01   +4.553679530589863e-02   -1.841952762975162e-02   -6.250166264561301e-01; -1.443987660317823e-01   +4.331252575810491e-01   -4.202450841515851e-01   -8.172037676149993e-02   -1.101525762529545e-02   +2.145626598162994e-01   -3.859500386226888e-02   +2.272896625177155e-01   -2.744307495380496e-01   -1.562026080177533e-01   +9.279477093136637e-02   +3.779305681667362e-01; +5.844101492717474e-01   -3.154088210666590e-02   -2.526264546407269e-01   -5.296579301478133e-02   +8.149272195002190e-02   +8.089862220414988e-02   +9.369341746054977e-02   +1.050912627619035e-02   -3.315040083538098e-01   -4.241913342702665e-01   +4.653812669929572e-02   +1.091810089027729e-01; +2.370782599373369e-01   -1.971900025460162e-01   -3.605621109316731e-01   +4.832502193737490e-02   +9.039958541957060e-03   +3.356364794475922e-01   +1.525738093182820e-01   -1.486321821400863e-01   +1.136351693954557e-01   -1.445679299345859e-04   -2.852506223077810e-01   -1.039735370252555e-01; +2.886579134040659e-01   +1.363533498282945e-01   -2.424239794374990e-02   +1.601452761137903e-01   +3.396407244327452e-01   +4.017798723791282e-01   +1.053330063688801e-01   -3.524992021623108e-01   +1.384888204779005e-01   -1.073631622429938e-01   -4.749288256800771e-02   -6.462464742325018e-02; +2.980307876104051e-02   +3.214205219486703e-01   -3.979746146795511e-01   -1.027647800156976e-01   +3.611484723784224e-02   +6.654454510281230e-02   +1.376261585016421e-01   +9.864893656736004e-02   +3.652411122101643e-01   -3.108248447255489e-01   -2.027401706285824e-01   -6.075865669070564e-02];
L3E_L3I_iGABA_netcon = [-1.818964003418286e-01   -2.322096079854972e-01   -2.761819312481193e-01   -2.082495827133985e-02   +3.240641272869966e-01   +5.589721387084747e-01   -6.883172078016392e-02   -2.935744787092069e-01   +4.102123424728570e-01   -8.798648716500081e-02   +5.581569017156152e-01   -1.764453412118589e-01; -1.037611699976713e-01   +6.186365480954612e-01   +3.471423149908928e-01   -1.566613488587392e-01   +3.339917341908657e-01   -3.475948993416535e-02   -2.285040110479060e-01   +2.159006103847453e-02   -2.886487555370692e-01   +1.096484307670602e-01   +5.753261244754247e-01   +3.361437444814511e-02; -1.209012416062052e-01   +5.348550539921708e-01   -2.645058874621145e-02   -2.810695057788862e-01   -1.871808953988321e-01   +6.864229810260930e-02   -3.460791884272194e-01   -2.693057052359426e-01   -3.973342441966382e-01   -7.715285464248792e-01   +4.534762067238513e-01   -1.835183322277894e-01; +1.659849922886379e-01   -1.935965928615151e-01   +8.456166447267692e-02   -5.612357555962109e-01   +3.312456804800675e-01   +2.953554981856743e-01   -3.759975373192294e-01   +7.203140955191274e-01   +1.296101786025044e-01   -4.252926262280607e-01   +1.228181738679973e-03   +1.411880895207452e-01; +7.732076418185786e-01   -4.938752213133394e-01   -2.017753019999378e-01   +3.811913747929154e-01   -3.648447966864282e-04   +3.836399227539467e-01   +8.015476345548343e-02   -7.716182832341122e-02   -3.303434111261149e-01   -7.873043491157668e-02   +3.349970193272054e-01   -7.448796992284067e-01; +3.788630605223145e-01   +3.842933458777688e-01   -2.103341714888397e-01   +1.155656191901433e-01   -3.934057562388388e-01   -1.816079868403595e-02   -2.498626722779387e-01   -7.188385926941678e-01   +4.782386794281578e-01   +3.741216329276266e-01   -7.161606476902587e-01   +3.295793269050801e-01; -4.862403356450212e-01   +2.326723990014365e-03   -5.580456159815631e-01   -3.179581942903621e-01   -5.640534915114994e-01   +6.208091658974132e-01   -1.764888539166465e-01   +1.885186409614780e-01   -2.681387982068943e-01   +5.621829194909161e-01   -1.535320848530268e-01   -2.093407007846350e-01; -2.815709654195680e-01   -4.638780878023698e-02   +3.641332824847093e-01   +3.354549243980318e-01   +2.659412179241375e-01   -3.711557828287801e-01   -5.824756065802747e-02   +4.122576647785471e-02   +2.172446241204092e-01   +3.042595452365227e-01   +3.237368605958145e-01   -3.744317569296777e-01; +2.938724215105555e-01   -1.264404990228901e-02   -7.279724152346338e-02   +4.453447113787033e-02   -1.423897262715607e-01   +2.524737909782114e-01   -3.202562228220031e-01   +1.546100773292587e-01   +3.218170986266608e-01   +7.045079940864449e-01   -2.392404630048952e-01   -1.053302986704173e-01; -2.300509551131436e-01   -2.557802505482645e-01   -1.925579544468866e-01   -9.795690730204010e-02   -4.185073190161961e-01   -5.283051846886638e-01   -3.610143431436855e-01   +6.334318499091010e-01   +1.819515464050507e-01   +3.653268013709830e-02   -5.852248500212313e-01   -1.813286264606438e-01; -3.792960600376403e-01   +1.053162115583708e-01   -4.987888295527643e-02   +9.857628161438203e-03   -6.145101347153366e-01   +6.580273258115152e-01   -2.522840122944822e-01   +5.646472871364290e-01   +5.018060812883727e-01   -5.797318734405375e-02   +6.336104297206193e-01   +9.362502785109289e-02; -3.484120680814197e-01   +6.874095326859945e-01   -4.544610100552816e-01   +1.072368281057937e-01   -9.382679913865727e-02   +2.614761946862985e-01   -7.184137585892261e-02   +4.297971103142859e-01   -1.004851003959825e-01   -6.905939946561873e-02   +3.412375629197877e-01   -4.545548125319497e-01];
L2E_Input1_iAMPA_netcon = [-1.651244425097834e-01   +5.256004398635511e-02   -1.665994949159493e-01   +8.437025377762957e-01   -3.323996146988160e-01   +3.959539385425007e-01   +6.000786316376313e-01   +1.189109392311406e-01];
L2I_Input2_iAMPA_netcon = [+2.531863395009946e-01   +3.291986416270045e-01   -5.852764807949720e-01   -7.071052652388946e-02   +2.428818330094403e-01   +7.419015246813164e-02   -6.180828973144029e-02   +1.142436142185513e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
