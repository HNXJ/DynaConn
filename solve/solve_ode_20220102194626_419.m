function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.336863601778468e-01   -1.983993810309892e-01   +6.319758083766331e-01   +3.279588051760406e-01   +2.182607227066324e-01   +7.279115746869643e-01   -2.176930903003416e-01   +3.174917348928866e-01   +2.710076220541345e-01   +8.623143668099938e-01   +3.257770290238139e-01   +3.013838293156367e-01   +6.122370757957423e-02   +1.091874253626684e-01   -1.445470120083909e-01   +1.984039620010948e-02; +2.328186777535677e-02   +5.803889840465633e-02   -8.338523228453107e-02   +9.542325547872594e-01   -1.218893896426003e-02   +3.239163928877784e-01   -4.096799698714112e-02   +5.426543494703140e-01   +6.591191510781647e-01   +1.836961559526676e-01   +6.610469298379983e-01   +6.456020305759710e-01   +1.923922348904806e-01   +3.974717748441311e-01   +1.527026493308711e-01   -5.520554238113799e-02; +8.516654272452882e-01   +3.195566746704302e-01   +6.945294185220914e-02   +2.909748708241197e-02   +2.450721140215752e-01   +3.582605700615654e-01   +5.438984473740295e-01   +1.778341325793396e-01   +2.140735119153138e-01   +5.596499245292079e-01   +4.862184239171843e-01   +1.408165878977762e-02   +3.370151458876783e-01   -1.508806998289582e-01   -3.739621559085114e-02   +2.263255491648752e-01; +1.765124611597813e-01   -3.334334815133553e-01   +5.786657184056797e-02   +3.219034660047503e-01   +3.887017044480112e-02   -1.549669084927784e-02   +8.562556573022461e-01   +8.526585344325571e-01   +3.861708791600553e-01   -1.432432166438665e-01   +2.728591233165345e-01   +7.074819450087025e-01   +1.736323164888105e-01   +6.537114891131987e-01   -9.513357502152781e-02   +6.408679958098419e-01; +8.247817761377948e-01   +2.433860345807018e-01   +6.626463085092084e-01   +6.966558048119302e-01   +1.240794516592990e-01   +3.990464670839432e-01   -2.374621760761667e-01   +4.933607048577263e-01   +1.567588062218543e-01   +3.797697732475275e-01   +3.399603413789862e-01   -6.283567630973737e-02   +1.754732739242672e-01   +3.643386576996065e-01   +3.638532553597122e-01   +2.059792733357912e-01; -1.569146054738724e-01   +6.712453566998162e-01   +3.341136003001816e-01   +8.637586003195238e-02   +7.484995975603944e-01   +2.774859971062098e-01   +8.316766524646773e-01   +1.917586071945935e-01   +3.229710863352789e-01   +5.188192351492555e-01   +3.694717683281917e-01   -2.696865927605798e-03   +5.459737885657493e-01   +3.119344127489374e-01   +3.622982461661853e-02   +1.050332872538219e-01; +4.159662043936998e-01   +5.899903890666213e-01   +2.651452216791432e-01   -9.300091663017303e-02   +2.635207570686778e-01   +2.711638076875320e-01   +1.818665291482243e-01   +5.353096898925620e-02   +6.348471227831322e-01   +4.402549072625761e-01   -6.775888876099051e-03   +3.896589190281208e-01   +2.422312191441625e-01   +3.480544072013503e-01   +4.615338586570357e-01   +4.339294710246931e-01; +3.854763580133709e-01   +6.173773925026805e-01   -2.687689781211651e-02   +9.621788979774937e-01   +9.426314420090560e-02   +2.107713360850684e-01   +4.622060238944946e-01   +8.520841041569511e-01   +9.572226011939082e-01   +6.524045556250644e-01   +3.144660088972628e-01   +6.640200351981306e-01   +2.181125206437337e-01   +3.350154717833911e-01   +1.912858272060294e-01   +4.573536073726175e-01; -4.809261859562258e-02   +6.165200339910241e-01   -3.277027955188935e-01   +3.787447244883289e-01   +2.083104642964106e-02   +5.295405439486145e-01   +2.320984245090860e-01   -2.234715845357345e-01   +2.325425407445922e-01   +5.545459340715634e-01   +7.380989102369280e-01   -3.484501377690785e-01   +6.533568382650037e-01   +4.092587494683851e-01   -4.223066172466527e-02   +1.086265160387476e-01; +3.487148806332149e-02   +2.601391288666012e-01   +4.793933190305789e-01   +6.057783071195333e-01   +5.870916318073376e-01   +2.143354216599201e-01   +4.551954963731621e-01   +2.444896108352037e-01   +5.527752848500889e-02   -6.289693287002887e-02   +2.774025262263515e-02   +2.365090167447215e-01   +7.414277711718321e-01   +7.481353610952372e-02   +1.499158878461548e-01   +5.383243661606482e-01; -3.130863398661889e-02   +8.805819988082313e-01   +3.614787469184567e-01   +2.022564963086706e-01   +6.334548239931717e-01   +8.193042219018997e-01   +7.610850575032216e-01   +2.553299082162113e-01   +1.286827142604952e-01   +6.304892032355511e-01   +5.486957112628740e-02   +4.259174081217929e-01   -2.242529886240505e-01   +4.618386976769349e-01   +6.881110416502881e-01   +2.864816332536221e-01; +7.119057961106687e-01   +8.444233968748018e-02   +2.749310236468248e-02   +8.138203266157179e-02   +3.868386947328513e-01   +4.162326355205370e-01   -1.933121038157845e-02   +4.154073096830080e-01   +8.372815780680294e-01   -3.555260621180144e-01   +5.832916134981069e-02   +4.561034224757791e-01   +4.797762247414867e-01   +4.890111921431163e-01   -5.153594051395265e-02   +2.827745049808117e-01; -1.175799880118435e-01   +6.742872309905521e-01   +5.864944423493469e-01   +5.921374429155396e-01   +6.468793119538260e-01   +6.214307464314998e-01   +2.548455259770443e-01   +5.594162637986032e-01   +8.929483530608775e-01   +5.303084235060647e-01   +1.096170532176293e-01   +5.170748934134497e-02   -2.719429474096389e-01   +2.017424911604442e-01   +8.477409685296346e-02   +1.234894225211799e-01; +1.897533756361094e-01   +6.201253934040217e-01   +4.501949977488724e-01   -2.629366645681246e-01   +1.912703182719069e-01   +6.399135303065472e-01   +1.044142915182474e-01   +3.019851874213925e-01   -1.357029001199557e-01   +1.213592431550365e-02   +8.602064721664843e-01   +6.060554207024416e-01   +6.704054577992481e-01   +4.562759212214954e-01   +3.552689823382428e-01   +4.512480157965280e-01; +5.078681393977543e-01   +7.887824618854940e-02   +5.775441730149055e-01   +7.951311971045946e-01   +5.570493952492266e-03   +3.808932285751080e-02   +5.312392973944937e-01   -7.827436905381453e-02   -2.348596860026722e-01   +2.630401006242727e-01   +3.832924622259096e-01   +3.445796647718810e-01   +3.567443610322988e-01   +2.606083087909353e-01   +2.717038037906534e-01   -1.423369748735675e-01; -1.208542199019192e-01   +4.907137412973898e-01   +1.171815759639264e-01   +6.721769433766550e-01   +1.000000000000000e+00   +7.898067995214313e-01   -1.091166423710248e-01   +7.985712256769576e-01   -1.560558913091986e-02   +6.841783396610619e-01   +5.641619106302247e-01   +3.411437448316712e-01   +9.422938456009446e-02   +7.433650075212852e-01   +5.533880922730186e-01   +6.653160660311414e-02];
L1E_L1I_iGABA_netcon = [+3.320539593522371e-01   +3.319817579090738e-01   +2.429875969305690e-01   +7.707740783955372e-02   +3.958325724894908e-01   -2.421247088379254e-01   +3.155853838564259e-01   +2.366971347707346e-01   +1.269437412077934e-01   +3.310673188511644e-02   +3.541508314950387e-01   +1.469662631039533e-01   +5.758963842286829e-01   -2.921509152331364e-01   -2.081113455655509e-01   +8.651243874606324e-01; -1.675416761537046e-01   -1.788545361183141e-01   +2.444953154101806e-01   -1.196139397896258e-01   +1.010014291966707e-01   +1.885819702098291e-01   +3.443870850836821e-01   +1.904475976746903e-01   +6.988421044267236e-01   +1.546474453401367e-01   +5.417094303171264e-01   +2.321257384983359e-01   +6.188115696788882e-01   +4.080874218788007e-02   -1.084810757144493e-01   -1.958560234930601e-01; +1.030298671818932e-01   +7.037553221994219e-02   +1.299559207911895e-01   +5.121950451914907e-01   +3.223114885463287e-01   -5.926866459113506e-02   +3.882713090831889e-02   +1.434624205837244e-01   +2.177998306179932e-01   +9.962703352561503e-01   +1.698769008096719e-01   +2.359742624121403e-01   +1.112851715366046e-01   -2.802669066398432e-01   +1.605295754735823e-01   +6.015743009735744e-01; +4.155038811484808e-01   -1.687079178727768e-01   -3.035743496402224e-03   +3.007923010126505e-01   -7.881351837347014e-02   -6.959685207761948e-02   +7.959332053811212e-02   -1.460798675434042e-01   -3.493724211530821e-02   -2.126271284223847e-02   +3.331286973564287e-02   +3.347667275966169e-01   +2.278524602716033e-02   +3.687997975668230e-01   +2.889797645729821e-01   +1.741783959467028e-01; +2.294550080283727e-01   +2.566346664784709e-01   +2.162439622779974e-02   +6.939181266947964e-02   +5.249304855186173e-01   -5.196813410713195e-01   +3.248700647820600e-01   -1.327616932431839e-01   +2.526370918806614e-01   +2.239260860674669e-01   -1.876977281322497e-01   +4.701923684105098e-01   +3.322046992463593e-01   -2.025367004679406e-01   +2.795692798247073e-02   +5.088398074734294e-01; +1.265067210783301e-01   +1.378064874174612e-01   +3.899106243595610e-01   +3.449569837558154e-02   +2.310172177358635e-02   +5.354985250285660e-01   +8.489137051445780e-02   -1.273292835782989e-01   -3.547151758930212e-02   +2.002635421632490e-01   -3.950080176745448e-02   +1.866479130082296e-01   -7.716587515306803e-02   -1.260676317416687e-01   +6.299249894770822e-01   +4.821977882737300e-01; +4.716916247459124e-02   +9.464736507728298e-02   -1.063679276367341e-01   +5.713202138974499e-02   +1.085141155771002e-01   +3.229474229128716e-01   +3.377613645728415e-02   -1.634849854698596e-01   -6.722876626132145e-03   +4.381614908761125e-02   +3.788695814076444e-01   +5.625133555886458e-02   +4.330030941633433e-01   -3.632771231519472e-01   +5.932883167200007e-01   -6.128358573994218e-02; +2.752329368915908e-01   +5.181877849231127e-01   -1.069886377436984e-01   +2.629221431542095e-01   -8.881000909762399e-02   -1.822665950394310e-01   +5.916726919042302e-01   +3.682285167975803e-02   +5.479581305755375e-01   -2.269408721385314e-01   +1.745435811551037e-01   -1.630337993297098e-01   +2.960156920390533e-01   +2.634025895124131e-01   -8.210097953031766e-02   +6.293432170570572e-02; +5.220289374861529e-01   +5.052409731166189e-01   +4.890958382446114e-01   +1.127588884265545e-01   +1.372168521228665e-01   +5.196430877141432e-01   +1.935792435693610e-01   +1.097153846151252e-01   +3.952729163262451e-01   +2.680239411846931e-01   +1.647871578279929e-01   +1.488432296192480e-01   +3.579602343474623e-02   -4.203225484978028e-03   +6.834975667699527e-01   +3.007421064727580e-01; +3.087246381620554e-01   +4.871527224876210e-01   -1.044609344062467e-01   +4.401896534349277e-01   +1.059817292432542e-01   +2.875495432405428e-01   +1.122610058883203e-01   +7.106229290475154e-02   +2.925448425684728e-01   +1.241910416333660e-01   -3.736244765889029e-02   +2.939084541525745e-01   +1.842242641048734e-01   +5.217253923792031e-01   +1.328748841481744e-01   +4.101109017556806e-01; +1.642787589482773e-01   +2.035084638513943e-01   +4.846059325904121e-01   +5.855522209537435e-02   +3.460742074114871e-01   +2.688297078300334e-01   +2.864563146184838e-01   -1.784062367656872e-02   +3.561939544191405e-01   +1.316184671150935e-01   -3.907826963397114e-02   +5.336626512700020e-01   +4.881060955486423e-01   +5.865656526423348e-02   +1.982410770939020e-01   +2.385549718970978e-01; +3.464971634719922e-01   +1.413359546787944e-01   +1.249938042440341e-01   -1.696768041268483e-01   -1.080509314882723e-02   +3.731209108818189e-01   +2.189421224519467e-01   +4.972396155441429e-01   -1.910089656979397e-01   +3.458868718035032e-01   +4.279024790555994e-01   +5.203912209177191e-01   -1.567668428996133e-01   +2.631783554590403e-01   +9.826631892707306e-02   +3.486394745978508e-01; +2.989438444359006e-01   +2.109578531870359e-01   -2.126293621939027e-01   +7.752866483741142e-01   +1.873245258416507e-02   +9.639855568843092e-02   +1.159682436595931e-01   +3.841740354467403e-01   +1.190457832092842e-01   -1.778538338719022e-01   +2.111449069975181e-01   +3.275720675366083e-01   +1.907634529664152e-01   +3.178204893041461e-01   +4.891407773977803e-01   +6.958744720351820e-02; +2.443142916306228e-01   -7.706448709841386e-03   +3.056552498480356e-01   +4.879210971229005e-01   +3.292872710662761e-01   +5.749292618281418e-02   +3.172634754548933e-01   +2.426997404215141e-01   +1.776014976477520e-01   -9.952441361837426e-02   +2.685644012460082e-01   -2.059248986716099e-01   -8.924961516699985e-02   +6.708468244413315e-02   +3.073831057817746e-01   +2.612162567387835e-02; +3.658332596136997e-01   +3.937453320337855e-02   +3.753478629458301e-02   +7.078153182538885e-02   -2.820557396212443e-02   +1.222648703949606e-01   +5.498317997120511e-02   -2.611988325405487e-02   +3.886699216656461e-01   +2.751620398109861e-01   +5.086997106474205e-01   +3.582551743217277e-01   +8.542718835639566e-02   -3.072203341892833e-01   +2.829929745606732e-01   +2.397927881045900e-01; +3.214413516704360e-01   +3.187034349865735e-02   +3.505827243010514e-01   -7.348436606423367e-02   +4.033864032473179e-01   +2.766068362150166e-01   -4.136512904747311e-02   +3.124438521343137e-01   -2.156592809766772e-01   +1.753725763780334e-01   +2.716607180016953e-01   +3.633139297113769e-01   +4.506284733226941e-01   +3.369973952299045e-01   -1.237068802562651e-01   +5.043789357388846e-01];
L2I_L1I_iGABA_netcon = [+2.813880918524053e-01   -2.225784438841120e-02   +1.848993672279143e-01   +5.531235202065650e-01   -2.391941794492729e-02   -9.027654856101351e-02   +2.091275388393461e-01   +1.404099371325141e-01; +4.870059247438914e-01   +5.965123711632268e-01   +5.173622168147809e-02   +3.298212433525050e-01   +4.828039209313342e-01   +2.341173043686993e-01   +3.360451717397077e-01   -1.590695845375191e-01; +3.255959060163925e-01   +7.757196494271881e-03   +5.731398699943251e-01   -5.107195192842730e-03   +6.602969174745908e-01   +1.699143771755642e-01   +1.738442176881205e-01   -2.916210805054269e-01; +6.783563045799254e-01   +2.580445863779329e-01   +5.376833495277000e-01   +1.823067663569881e-01   +8.405934419667266e-01   +3.963911612020196e-01   +7.005860473632046e-01   +5.164349515280302e-01; +1.192456115427382e-01   +5.629419365890355e-01   +2.754888945141293e-01   +2.597930729962108e-01   +3.763904506532112e-01   -7.494541354947479e-02   +2.565402268861527e-01   +9.727822888439158e-02; +3.244199679909827e-01   +5.731118085228228e-02   +4.514722208620726e-01   +3.077922914812438e-01   +3.126686113062172e-01   +5.133586527767927e-01   +1.934217394210930e-01   +5.071805235626501e-01; +6.147742490491299e-01   +5.704405404524162e-01   +4.611825858323619e-01   +1.558911981887130e-01   +3.585223103040822e-01   +1.572384521031756e-01   +5.125315392607294e-01   +1.893530077635457e-01; +3.123671978308881e-01   +3.899714953682501e-01   +4.123574369898457e-01   +1.278623028776083e-01   +1.631884653392788e-01   +1.924480073616637e-01   +1.745290506648028e-01   +3.701045715749576e-01; +5.167041993433452e-01   +9.577421686485270e-01   -1.992418544499313e-01   +7.258031956222534e-01   -9.422287891370945e-02   +3.454760058833560e-01   +1.459067494474270e-01   +3.671344842270454e-01; -8.194148356369711e-02   -1.607417191012803e-01   +1.809207596779332e-01   +4.848649612468451e-01   +6.520745900135217e-01   -6.623216119825237e-02   +1.911451134024225e-02   +8.421761876177053e-01; +1.861607408265081e-01   +1.485383330367581e-01   +3.887295198118279e-01   +5.058627763433405e-01   +1.306425780235481e-01   -8.671279398460169e-02   +3.186767861615166e-01   +1.808704164581744e-01; +4.193648288504834e-02   +5.321533411919377e-01   +2.152697781540645e-01   +3.281321729507160e-01   -1.499596062512797e-02   +3.862900396718640e-01   +2.841235955489531e-01   +2.510607379853101e-01; +2.131147748198908e-01   +4.724347929189717e-01   +8.078041363432753e-01   -1.659324875010032e-02   +2.573080410457013e-02   +9.018974333263055e-02   -2.235624209357471e-01   -8.541755964967379e-02; +1.923243613269406e-01   -1.042112057691329e-02   +1.707265575382128e-01   -1.074361687476298e-01   +4.799288789537769e-01   +2.027752753403809e-01   +3.502627041006539e-01   +2.439505004020170e-01; +5.111105586148473e-01   +4.736208356779460e-01   +3.788959013061383e-01   +7.765687701279661e-01   +1.867865175042419e-01   +8.949694471879475e-01   +4.988364397775528e-01   +7.252411161619684e-01; -2.081819957335913e-01   +3.154534924942214e-02   +6.093319990357988e-01   -8.668079793724644e-03   +1.522320124432230e-01   +8.135750871772603e-02   +1.523065681457990e-01   +6.796605186174346e-01];
L1I_L2I_iGABA_netcon = [+3.000326666215961e-01   +3.295126791457811e-01   +1.538141768262273e-02   +4.171058070974545e-01   +1.407100845054732e-01   +6.596182527486635e-02   +2.438379005010611e-01   +4.645114179126222e-01   -3.385849605509866e-01   +5.655772044774052e-01   +4.912645480812693e-02   +1.130219990441383e-01   +5.722065906471658e-01   +2.211843409698691e-01   +2.158660389096100e-01   +3.057297162590694e-01; +2.735130684087053e-01   +9.335592506842152e-02   +5.449124688932210e-04   +2.962994588158513e-01   -3.119321870042482e-01   +2.530959764051234e-01   +6.493055975496724e-01   +8.804970422431119e-02   +4.890826829283804e-01   +5.201073740754787e-01   +1.671079625230734e-01   -2.564487874994295e-01   +3.490746982254904e-02   -5.231988618160087e-01   +1.384196822876953e-01   +5.307833177658587e-01; +1.612343730043417e-01   +1.012368411530417e-01   +3.037587613087659e-01   +1.861156861978042e-01   +2.865275257233974e-01   +3.870246186514079e-01   +5.839580777542576e-01   +3.993424116941809e-01   -1.685182778815939e-01   +3.436719867313529e-01   -6.446501526409029e-02   +3.587556701067768e-01   +5.497428277324938e-01   +5.494262644530953e-01   +5.700073906155814e-01   +9.520380518174709e-02; +5.355689289712842e-01   +1.337059886334289e-01   +2.603998376859136e-01   +8.103236282652136e-02   +6.313542613118394e-01   +1.377676953682651e-01   +5.068656006424141e-01   +5.531896527764991e-01   -2.031974877060590e-02   +4.555336002014718e-01   +4.207198089914552e-01   +4.482588719784786e-01   +4.200811077403537e-01   +1.610745315383017e-02   +4.518425399364297e-01   +1.646030414590183e-01; +4.685035354597688e-02   +2.327655312182378e-01   +1.067049880612699e-01   +2.211987497920936e-01   +8.150843837819571e-02   +9.526330569979254e-01   +3.933046126375097e-01   -9.280757616935667e-02   +5.000459672049912e-01   +3.134546415592912e-01   +1.311873850299248e-01   +1.686269627709252e-01   -1.060810982086750e-01   +3.292563955292015e-01   +2.113486569322764e-01   +5.937759611560877e-01; +2.224013270029430e-01   +2.236716123234727e-01   +4.659072293297638e-02   +7.367099006152312e-01   -1.068032679482063e-02   +5.019897520399275e-01   +5.480457093360356e-01   +2.794078485698087e-01   +1.029274999577779e-01   -2.403716376172217e-01   +4.366330374550934e-01   -9.195371904514081e-03   +6.602803224777140e-01   +5.435225197257070e-01   +5.303131973575115e-01   +8.838698504008402e-02; +4.070478895021371e-01   +8.070291187829013e-01   +1.447738500250987e-02   +5.978460900485426e-01   +3.708214377173475e-01   -1.707256348194899e-02   +5.302732030766840e-01   -3.661169635336808e-02   +8.416694467334729e-03   +4.213519348357119e-01   +2.538647966136176e-01   +2.554070086544221e-01   +1.520358481374597e-02   +2.524688508587755e-01   +2.293017669679170e-01   +3.318552369957087e-01; +5.277182216174956e-01   +3.304987457645990e-01   +3.263678496725758e-01   +3.050713537288552e-01   +5.543202704519086e-03   +5.720196170937244e-01   +4.572278756296633e-01   +2.211304274211270e-01   -1.656747786891860e-02   +1.883301768639031e-01   +7.925542687389219e-01   +3.719693965933592e-01   +4.014980326011763e-01   +1.245780881429443e-01   +2.328984066947996e-01   +1.270968337235820e-01];
L2E_L1E_iAMPA_netcon = [+3.580221320861740e-01   +7.824172543436736e-02   +9.709689560758433e-02   +2.044125431663130e-01   +5.759830993592442e-01   +4.256516040063053e-01   +1.683554905893866e-01   +3.017355373395890e-02; -1.107237869673663e-01   +5.918674804155695e-01   -5.922638298777111e-02   -6.299558767701288e-02   +3.698753131707968e-01   -3.929653611503328e-02   +4.388007823678974e-01   +5.405676379639119e-01; +1.064350718150145e-01   +6.227531625589618e-01   +4.727109612178525e-01   +1.783955342809146e-01   +2.659828984109402e-01   +3.155304429335940e-01   +5.450961669248250e-01   +9.093642667715759e-02; +5.302362418375562e-01   +2.460723808330477e-01   -2.249672518174882e-01   +3.773156804207493e-01   +3.643011311404963e-01   +1.228565297149389e-01   +1.547199369977903e-01   -4.831034847891300e-02; -1.172672980940377e-01   +4.362146933110693e-01   +3.929355395767845e-01   +1.730007874107498e-01   +5.048999883940843e-01   +1.726563049497034e-02   +5.685468032575405e-01   +6.280963269520583e-01; +3.808033184022408e-01   -2.863417826384375e-01   +4.595585191435952e-01   +5.528337722265177e-02   +3.829680401375728e-01   +6.479333039708440e-01   +5.218861711607021e-01   +1.596375187958091e-01; +8.868409824049586e-02   +3.309676391244693e-01   +2.296324132682814e-02   +4.798116009334931e-01   -9.845292205915966e-02   +4.034152943557331e-01   +1.000000000000000e+00   +1.516666488150508e-01; -3.179212289648010e-02   +5.122848560125474e-01   +6.422743785087328e-01   +7.194233903828980e-02   +6.340232307311059e-01   +3.465098968688820e-01   +2.053996330134558e-01   +1.103053617735818e-01; +6.946476480756681e-01   +1.040222951463234e-01   +2.146017971118274e-01   +8.072248711423037e-01   +1.591953792597144e-01   +6.121856345826989e-01   +1.018076063100812e-01   +2.027020931565438e-01; +3.767607883427612e-01   +6.256934549584864e-01   +1.839773686135547e-01   +4.176132194993292e-01   +1.042392942862400e-01   +9.079773867249225e-02   +2.475740155301014e-01   +3.157526791746836e-01; -1.620175863075904e-02   +4.604416890716712e-01   +2.601341984669530e-01   +7.224728058041059e-02   -3.693765040291004e-02   +1.909682523130453e-01   -4.568565252384962e-02   +3.146625246064301e-01; +1.883004219954260e-01   +2.109194391958029e-01   +8.066330398136990e-01   +1.132831103010332e-01   +4.192432571745809e-02   +3.619472061426031e-01   -2.859639714831483e-01   +1.091463793868911e-01; +1.568763323717917e-02   +4.166924422937900e-01   +1.869913263399209e-01   +2.042910544487261e-01   +2.431914667473184e-01   -2.600953499656900e-02   +4.892281289180500e-01   +2.161788286602347e-02; +3.254837158568183e-01   +3.024036911009489e-01   +3.502356178782783e-02   +3.980791278056279e-01   +1.689749083342258e-01   -8.421559789104413e-02   +3.494302633468431e-01   +1.549955395823612e-01; -4.625208588201654e-02   -2.438615565987751e-01   +1.322794336268778e-01   +3.457681878579168e-01   +1.652836630645962e-01   +4.112435226593767e-01   -1.364965249477485e-01   -1.707801115676489e-02; +2.957284513625699e-01   +8.432755075024318e-03   -2.114810643195030e-02   +9.085668423910939e-02   +5.048241144590305e-01   +4.050244292220511e-01   +2.790489745197142e-01   +6.893861150603352e-01];
L1E_L2E_iAMPA_netcon = [+2.188042446827042e-01   +2.807223967571520e-01   +1.040368006357231e-02   +2.469036720794617e-01   +2.181274901319751e-01   +4.133206124591011e-01   +1.965909168426033e-01   +5.825144472365730e-02   +2.669794362375175e-01   +2.826161105094775e-01   +2.259704190875308e-01   +5.406446952057481e-01   +3.911250525190704e-01   +6.043599955321281e-02   -2.054477179598422e-01   +8.763368103276714e-04; +3.552343532791694e-01   -2.581786421574974e-01   +4.101739540256617e-01   +2.479053760309202e-01   +1.637699103445299e-01   +6.761786236263637e-02   +1.220956759623035e-01   +1.219672826570660e-01   +1.023618412595960e-01   +3.352632909471300e-01   +5.086944652392603e-02   +4.462834850511607e-01   +3.040009860697315e-01   +2.438727293855053e-01   +6.111054428451590e-01   +4.373590835064874e-02; +6.066541299869497e-01   +9.210262925106918e-03   +8.722010886620488e-02   +5.124186377188669e-02   +1.405008377120039e-01   +4.478737231454665e-01   +4.013963564741352e-01   +4.187568330401462e-01   +4.071557867112406e-01   -7.472753296758858e-03   +3.272774729618101e-01   +4.218482634368002e-01   +1.260834523764190e-01   +3.537212153842433e-01   +1.234782478580724e-01   -7.029335579122056e-02; +3.232795734789204e-01   +1.336967091066219e-01   +5.979248749874899e-01   +2.061807248961310e-01   +1.832997853195616e-02   +3.298228971983480e-01   +9.648988670845831e-01   +1.029791145981594e-01   +2.383765007460640e-01   +2.947710660176180e-01   +4.869547666913017e-01   -6.083183284622895e-02   +1.044467560348907e-01   +3.372471178517328e-01   +4.956699783726299e-01   -2.199157013052673e-02; +2.259805464088120e-01   -2.269022296082066e-02   +7.509041472111436e-01   +1.695153843655310e-01   +4.265315067202453e-01   +3.156289691842134e-01   +7.094395076452686e-01   +2.635592569243372e-01   +3.369761181837199e-01   +1.560225296208711e-01   +1.515510076792473e-01   -3.921762957186530e-01   +4.249824928729705e-01   +2.381786265821306e-01   +8.989406409980294e-01   +1.639048728578054e-01; +2.246606772138807e-01   +5.966241095427852e-01   +5.099314334974256e-01   +4.758620453799803e-01   +2.435778347522199e-01   +2.246334605563181e-02   +4.425593288117073e-01   +3.850493857818446e-01   +5.407195099795118e-01   +1.555519780439086e-01   +4.775859804473002e-01   -2.293763762654508e-02   -2.797089212543859e-02   -3.276811282950720e-01   -1.018784217126818e-01   +4.590795299114040e-01; +1.212631213382886e-01   +1.011852029576917e-02   +2.627911320353665e-01   +4.256391538609681e-01   +2.322014516907379e-01   +3.368469290584247e-02   +6.175700205548684e-01   +2.532714629750438e-01   -2.603745804232433e-01   +2.121756716802183e-01   +7.049468282228205e-02   -2.643001836928091e-01   -2.523277111956062e-01   +1.280720684102766e-01   +3.053960445913073e-01   +1.880724047675671e-01; +4.091160195911663e-01   +2.748542974644179e-02   +2.670238154864240e-01   +5.096829608152659e-01   +4.229124279938040e-01   +7.450540251222334e-01   +6.191900086752306e-01   +1.431285376221277e-01   +2.481201428654445e-02   +6.122041528104256e-01   +2.906812425510735e-01   +4.141627603472038e-01   -5.109196970520290e-02   +7.359076559448348e-02   +2.339710143392175e-01   +1.022952466930107e-01];
L2I_L2E_iAMPA_netcon = [+4.446192873484168e-01   +4.681773279946301e-01   +5.991551622887705e-01   +3.678476258496279e-01   +1.300056219204263e-01   +5.449456463703073e-01   +4.279979150436110e-01   +4.234936459614034e-01; +5.808311777024914e-01   +1.381527026489545e-01   +5.769027502413840e-01   +5.495710086773204e-01   +2.485504700631837e-01   +1.087373146310468e-01   +3.721681731342733e-02   +1.511562809297445e-01; +1.684762084993656e-01   +6.091452454254849e-01   +2.223354486988896e-01   -1.296562867034538e-01   -6.110360456118272e-02   +2.216933690398533e-01   +3.713565559153342e-01   +1.659178391809703e-02; +1.205377922858785e-01   +2.970440511080260e-01   +5.547583866196824e-02   +5.420757451653819e-01   +3.540319127306450e-01   -7.201894224475669e-02   +2.228537651150175e-01   +1.935080557567695e-01; +4.336275222541104e-01   +1.194306572959128e-01   +5.270645228551417e-02   +4.896028400352570e-01   +1.990051996270667e-01   +2.016570736609224e-01   +6.218978279952140e-01   +1.266048679516751e-01; +1.397419620279552e-01   +3.123504706796780e-01   +2.652201309433032e-01   +4.399879628501362e-01   +2.779126183774662e-02   +2.588956139393181e-01   +1.222973416001671e-01   +3.264977955323765e-01; +1.896020228943121e-01   +4.551879311646596e-02   +1.228123605197064e-01   +4.504812371262804e-01   +4.065559888738868e-01   +8.979980059870879e-02   +9.349596959156115e-01   +1.027737276632937e-01; +5.529335071337109e-01   -1.092448721766830e-02   -2.760839152779398e-01   +3.099031773108560e-01   +2.246244099654344e-01   +2.209650545926721e-01   -2.510965218742846e-01   +3.849375694194653e-01];
L2E_L2I_iGABA_netcon = [+3.005219271337205e-02   +5.641766287153095e-01   +3.281286209825914e-01   +1.405414624396840e-01   -7.128658950559930e-02   +2.223014494203188e-01   +1.957075449934593e-01   +4.069289310750719e-01; +1.970745304682824e-01   +3.488445738450579e-01   +3.073692465602622e-01   +4.094054909232646e-01   +2.687976989794324e-01   +3.914382330835806e-01   -3.586663978084335e-01   +1.853576450046777e-01; +1.016027725258756e-01   +6.827815588333834e-01   -5.922086411390452e-02   -2.526855563006992e-02   +3.698991507138335e-01   +7.232503987373754e-01   -3.750090133467933e-02   +9.735702654681945e-01; -2.126424189072795e-01   +2.292882131310183e-01   +8.069712138965561e-02   +5.296472821829949e-01   +5.490430575935565e-01   -8.738620716012113e-03   -1.651195066911662e-01   -3.784128679825056e-02; +2.010562663422745e-01   -2.115004620902826e-01   -9.332148720709502e-02   +5.723547645913957e-01   +6.684740584478892e-01   +3.031266436040962e-01   +7.684827919410749e-02   +1.775589578940433e-01; +1.795867364665073e-01   +1.648292060229531e-01   +2.027392263481239e-01   +2.786424573116632e-01   +2.847499536948742e-01   +3.506844587295913e-02   +2.233542835883702e-01   +1.066872643467359e-01; +4.487986519785278e-01   +2.764304427421134e-01   -1.132682138355422e-01   +2.179739762498357e-01   -6.241135341446181e-02   -6.230019442715747e-02   +1.330616475309301e-01   +9.413137164626768e-01; +3.135656804172128e-01   +6.057675685924536e-01   +5.555509559300464e-01   -2.787707962698949e-01   +3.358841958724577e-01   +1.598747207773834e-01   +4.854548240681748e-01   +4.490558027062203e-01];
L3E_L2E_iAMPA_netcon = [+5.492731629560886e-01   -2.222327455319652e-01   +2.253260721160267e-01   +2.341460870156842e-01   +6.706083515513684e-01   +2.661241141661062e-01   +3.675715285175009e-01   +4.460482423861510e-01   +1.488842572096472e-01   +9.661589001661403e-02   -1.767819694495385e-02   +3.429939103424039e-01; +2.276497337514279e-01   +9.296853597831873e-01   +3.339551936625694e-01   +3.287562568422420e-01   +2.390997706852698e-01   -4.343859756387284e-01   +1.121809752334267e-01   +2.683734195949310e-01   -5.288775413690519e-02   +2.964828225636394e-02   +1.300987375824483e-01   +3.856193742434949e-01; -1.288787322799959e-01   -7.170559491609806e-02   +2.645623152175256e-01   +3.847316704054070e-01   +8.682560641995907e-01   +3.603206277132185e-01   +4.005235246536250e-01   +3.767957210370185e-01   +4.593314724142412e-01   -2.052793504399731e-01   +3.427491016011746e-01   +7.392443222150769e-01; +1.068480090928142e-01   +3.230679868980784e-01   +2.439296978269775e-01   +6.159866240143549e-02   +5.233571178772088e-01   +1.081288947638470e-01   +3.612575559767611e-01   +2.118304489808273e-01   +3.612223626521612e-01   +7.950848915639215e-01   +1.304201709322491e-01   +2.018289313285716e-01; +6.252111428814917e-01   +2.814720976466233e-02   +4.971490810320030e-01   -1.373422146602208e-01   +9.332238275341134e-01   +3.323725280166065e-01   +1.295292861506354e-01   +9.472019227279285e-02   +3.349554381467878e-01   +4.903705299868410e-01   +6.659421901221585e-01   +5.077665811494927e-01; +6.932318604127632e-01   +6.767442410944154e-01   +4.589907863880610e-01   -9.515322207834287e-02   +4.095203516711631e-01   +9.466025686080543e-01   +4.606969369478133e-01   -5.668264861199065e-02   +1.406292519595129e-01   +6.158830231265630e-01   -9.708957887537098e-02   +4.507404824403746e-01; +3.452359026923155e-01   +1.371558895220506e-01   +7.469125728869244e-01   +2.183663693963224e-01   +2.147509075518774e-01   +3.135961023602419e-01   +1.734594111208465e-01   +5.560209316487217e-01   +5.079713374225001e-01   +5.336006007435350e-01   -1.603171921824618e-01   +3.144139822470440e-01; -5.731218514744941e-02   +7.344532891257173e-01   +5.977259505124481e-01   -4.146277240957247e-01   +7.121706940373359e-01   +5.416567969546742e-03   -1.275755920592033e-02   +1.202451333893273e-01   +5.411071585752278e-01   +5.689599691098598e-01   +1.681086588915858e-01   +1.849566820087564e-01];
L3I_L2I_iGABA_netcon = [+5.722581861540141e-01   +5.950752356295161e-01   +3.348130343470416e-01   +3.189389706023166e-01   -1.838521471177871e-01   +1.810737396146340e-01   +5.040007410025904e-01   +5.126174159440501e-01   +8.975277107765787e-01   +3.597797722306574e-01   +2.574858663289351e-01   +5.478870060555334e-01; +2.476284568811223e-01   +1.911144214599773e-01   +1.256498824381894e-01   +3.138549106027883e-01   +6.760826787144283e-01   +2.735429186989046e-01   +4.056376892978174e-01   +3.930117664566768e-02   +1.843847952150079e-01   +2.013997040156159e-01   +3.835387762149284e-01   -3.969355197408123e-01; -4.985935019242128e-02   +6.820148367543507e-01   +4.856958146635087e-01   -5.421185239476303e-02   +7.748025096015919e-02   +4.149340288834662e-02   +5.408537317491333e-01   +7.464756402906974e-01   +3.032474616215534e-01   +2.937613800904828e-01   -6.429561151852463e-02   +8.840017490984801e-01; +5.645814172787654e-01   +5.007796329968508e-01   +3.949257448917997e-01   -3.848513027935310e-02   +2.513290123436756e-01   +3.677888620591147e-01   +1.162674383475435e-01   +1.686222688698873e-01   +2.330053249654327e-01   +3.359799546828535e-01   +5.891480416613875e-01   +3.329299747216946e-01; +7.084139865947656e-02   +5.308379030456770e-01   +2.058607004959008e-01   +6.903989087734164e-01   +5.457671091082952e-01   +3.861302155708539e-01   -5.673761805496169e-03   +8.483065162302882e-01   +7.482314034365705e-01   +5.654302726886901e-02   +1.218914646156914e-01   +5.561183183538506e-01; -6.288593169740389e-02   +5.199853985995990e-01   +9.410101685118474e-02   +6.036344067390121e-01   +7.728405390084704e-01   +3.560508174215399e-01   +2.463571596111948e-01   +2.141192835309962e-01   +3.774834604910661e-01   +2.032114806668868e-01   +3.962083782355762e-01   +4.528665635866948e-01; +4.952781387553992e-01   +3.046229065782008e-01   +7.246630795535999e-01   +1.176489873208057e-01   +4.952147658064682e-02   +5.537051919618247e-01   +5.155467995642169e-01   +3.225867187337944e-04   -2.619128472273333e-01   +4.710552806358542e-01   +7.009696892800510e-01   +3.536238888716515e-01; +2.492040318943365e-02   +3.249394801144154e-01   +6.395983444760465e-01   +6.424160347861450e-01   -3.622734241750103e-01   +5.542249220685845e-01   +6.543119545948355e-01   +3.205085797133118e-01   +8.092189158041917e-01   +3.212560404240973e-01   +6.687538435319375e-01   +3.440392153609602e-01];
L2E_L3E_iAMPA_netcon = [+4.616021286926652e-01   +1.488525074813642e-01   -3.338173948124477e-02   +1.936564900588192e-02   +4.065840786410335e-02   -6.680996163879852e-02   +2.397860141767293e-01   -6.543002104376329e-02; +3.519730349030974e-01   +2.098139815700318e-01   +4.529302211783393e-01   +2.408262485903069e-01   +4.388089564135061e-01   -1.636543644400486e-01   -3.203253388496090e-01   -4.503501992563552e-01; +6.506051931011905e-01   -2.411420709363770e-01   +3.543670952247448e-01   +5.232942258707771e-01   +6.205465916157506e-02   -5.142533760571853e-03   +2.888878969111356e-01   +3.571159516047650e-01; +1.630504007353235e-01   +1.391730549405008e-01   +5.551745108054061e-01   +8.678596501262785e-01   +7.351578775721450e-01   +5.423090106048443e-01   +2.177981456597127e-02   +3.036413039848824e-02; +6.500822931835828e-02   +4.503974271848311e-01   +1.845131129447622e-01   +6.698986320630399e-01   +8.745228355763294e-01   -6.496342615650325e-02   -7.239204838484396e-02   +1.562462236225640e-01; +3.787057487089149e-01   +6.555514365269828e-01   +7.084065322348413e-01   +7.046813418563735e-01   +6.156588668215156e-01   +1.564452239258415e-01   +4.312816780163703e-01   -3.239274795573727e-02; +9.289948296375033e-02   +3.722688712105021e-01   +7.542220215577237e-01   +1.868955439448431e-01   -1.795326259732118e-02   +1.240215861598586e-02   -2.711422924606412e-02   +4.415562452035721e-01; +3.126655552724893e-01   +3.494229532637651e-01   +2.435300283109965e-01   +6.158682344488240e-02   +1.371070723832208e-01   +1.670463539237048e-01   +4.327704422516803e-01   +9.388080302466304e-01; +6.657568338166718e-01   +2.389574264908554e-01   +2.912546646282302e-01   +1.441639461355273e-01   +3.930413120772149e-01   -2.780860559748469e-02   +5.252077927918307e-01   -2.702967602322290e-01; -7.103273541100279e-02   +2.820836548285672e-01   +2.890181946005518e-01   +3.600399671742190e-01   +4.300397624363059e-02   -5.091056176423187e-02   +5.798988649930616e-01   +1.056205606499198e-01; +2.797492211476548e-01   +5.430532343637433e-02   -1.780535317012563e-01   +6.709005181757530e-01   +3.463059126750442e-01   +4.265472739852705e-01   +3.457558107062880e-01   +5.666689449517005e-01; +4.694841311284426e-02   +8.037452699197389e-01   +6.872660815185810e-01   +5.027754307372949e-01   +6.398522551590044e-02   +5.810160965489392e-03   -2.192337170391066e-02   +4.223594678420290e-01];
L2I_L3I_iGABA_netcon = [-4.181570459292289e-01   +2.219335007007789e-01   +6.285320485741518e-01   +4.265596179250909e-01   -1.637604149328311e-01   +4.869951493731047e-01   +1.179738871056525e-01   -4.433823075730015e-01; +1.654583787491826e-01   +3.824534059455820e-01   +1.711700009881350e-01   +2.472664266139801e-01   +4.109964119175924e-01   +2.113741264961356e-01   +2.383970583053451e-01   +1.441463727212789e-01; +6.877159517500575e-01   +5.518180428525479e-01   +2.064701902560560e-01   +5.888132500135683e-01   +6.993259514921177e-03   +9.663583363379249e-01   +3.784065889497458e-01   -1.509355495183930e-01; -4.318902489924652e-03   +2.767891164626876e-01   +7.172659713000530e-01   -9.246310153505272e-02   +2.701293633036516e-01   +4.135277394539261e-01   +1.303351927395407e-02   +4.394399184961101e-01; +6.048160444733808e-01   +3.222480573189396e-01   +7.790028649479752e-03   +4.649398906203777e-01   +2.891185134622679e-02   +2.099822752836016e-01   +9.929769132639812e-02   +5.627684003586206e-02; -6.824480457551861e-02   +3.384478900306836e-01   +5.885949374623871e-01   -2.863133897216837e-01   +2.550948801154121e-01   +6.623409712415177e-01   -1.021079096277621e-01   -1.394539174953480e-01; +5.871271696069507e-01   +1.954799517849902e-01   +3.771648639577336e-01   +3.066336681109267e-01   +1.387584555775652e-01   +4.585492628248380e-01   +6.342681445626693e-01   +2.434871501705996e-01; -1.821778710970573e-01   +6.541461051408043e-01   -4.931289860432300e-02   +9.819708361680757e-02   +1.630566717102358e-01   +1.385416886710037e-01   -7.221848713848024e-02   +6.057519356308001e-01; -6.144152408307673e-01   +5.395805432941300e-01   +4.664202332612636e-01   -1.293852732217760e-01   +9.072680106087154e-02   +3.908771059221648e-01   +3.181709732458152e-01   +3.330044602095161e-01; +4.871402327990313e-01   -2.188799594058966e-01   +3.667563329874132e-01   +1.195874787706135e-01   +4.221790515409192e-01   +5.470720147184407e-01   +3.991660207563155e-02   +5.340890814614071e-01; +7.955051230040264e-01   +4.081326353825964e-02   -1.875475002019381e-01   +3.201336639338943e-02   +5.019035486702882e-01   -1.053692839175340e-01   +3.452587494265004e-01   +8.622500499744389e-01; -3.107020874925898e-01   +4.150206750997557e-01   -2.264020911421522e-01   +5.339526428271921e-01   +8.091695720236572e-01   +3.379254919070115e-01   +2.645466318887614e-02   +4.447803490975191e-01];
L3I_L3E_iAMPA_netcon = [+5.274514356782641e-01   +1.737713473942996e-01   +1.777998407912040e-03   +4.043974466077835e-01   +4.807809283464482e-01   +4.874656654095705e-02   +2.630486426261838e-01   +1.092348841906734e-01   -2.366447264742887e-01   +2.763686615738510e-01   -1.764489578254444e-01   +6.741908165737273e-01; +3.276206832250103e-01   +9.515163902455508e-02   +2.344660777601985e-01   +6.325060456824372e-01   +7.021724686846151e-01   +5.060118200737738e-02   +1.627990228842250e-01   +3.887095054820512e-01   +3.636421789011891e-01   +4.050552932988538e-01   -7.530614488620385e-02   +1.368964061557452e-01; +3.853485155080970e-01   +4.310506792385326e-01   +6.544829125324204e-01   +4.727373466736201e-01   +8.299115132963472e-01   +4.872773921551539e-01   +6.426292454080728e-01   -4.048626737203635e-01   +4.583692495912089e-01   +5.202672786748407e-01   +1.657651331807476e-01   +5.121349779561291e-01; +2.959316229243740e-01   +6.028855073277113e-01   +5.882582836179594e-01   -4.031094979027321e-02   +2.712513996074729e-01   +7.593707858761068e-01   -3.846928026986404e-01   +4.339044457393967e-01   +3.277250681273423e-01   +2.167885219584552e-01   +9.112935224080951e-02   +2.978439810847347e-01; +4.274069695265940e-02   +6.183161735814449e-02   +7.549538593598016e-01   -3.255935943757258e-02   +3.584976828941300e-01   +2.327932434534541e-01   -8.470101251761275e-02   +4.803221078516099e-01   +6.225375920089172e-01   +6.117148604294231e-01   +3.908702591026665e-01   +2.030239354164527e-01; -1.044607002746892e-01   +1.284448687419806e-01   +3.052936752686963e-01   +7.672335402664233e-02   +9.763187663882988e-02   -8.941826029300326e-02   +4.591837794590841e-01   +2.547834801836112e-01   +1.270026251474354e-01   +3.414822844789086e-02   +2.144215782547191e-01   +3.543967463253870e-01; -1.249200689358865e-01   +7.263246603037495e-02   -2.109715089190536e-01   +9.555679855735696e-02   +4.349718562319078e-01   -5.016888444731563e-02   +5.600871735422471e-01   +5.058844407178537e-01   -1.835582893286699e-01   +2.198324225360434e-01   +4.308082857531396e-01   +1.425755104625842e-01; +9.962443273446342e-02   +3.340742569569697e-01   +2.733983019974731e-01   +9.582144882402002e-02   -2.051547143023558e-01   +2.957212851525441e-01   +8.705959646805367e-02   +5.259070004363581e-01   +3.875075033595868e-01   -3.015753098878641e-01   +8.631645769281837e-02   +4.506347490186882e-01; +1.726309709129535e-01   +6.076877558956293e-01   -8.503659513270502e-02   +1.764750450157164e-01   +2.568456408950120e-01   +8.566983859457553e-01   +1.547881632157052e-01   +5.572708321454786e-01   +2.976901119675724e-01   +4.715468648582120e-01   +7.679863399382799e-01   +6.746207511595330e-01; +7.313293801956937e-01   -4.586661728727478e-01   +7.273709213008588e-01   +3.546330949950062e-01   +2.733499073461024e-01   -3.371101131434745e-01   +4.544096188596462e-01   +1.246874498424397e-01   +3.523457286195402e-01   -7.296766966626077e-02   +9.561007541059070e-01   +1.224806329228883e-01; -2.243150281364604e-01   +2.379217801404389e-01   +5.768394689705945e-01   +6.005594103725987e-01   +5.585278912673436e-01   +6.022818983100275e-02   +3.538531428708979e-01   +5.042551103509082e-01   +8.338903076765968e-01   +3.642637489405054e-02   +1.768051087166672e-01   +6.308892823730268e-01; -4.570301553642669e-02   +8.854602547323562e-02   +2.078082189834537e-01   +1.864888332050475e-01   -2.452343789776835e-01   -1.521611339260460e-01   -8.028421493244869e-02   +2.620733034824890e-01   +8.344520419530295e-01   +3.443061021949053e-02   +1.289286575890527e-01   +1.370972954290223e-01];
L3E_L3I_iGABA_netcon = [-9.585967497535659e-02   +3.884175220540628e-01   +4.216716816937132e-02   +5.974657750296108e-01   +3.304989770457619e-01   +9.388022335012208e-02   -4.935503169373655e-03   +9.634446553866746e-02   +3.334842282418904e-02   +4.062365878572449e-01   +5.031044478839974e-01   +1.964272352020890e-01; +4.069302204964855e-01   +1.834109335394211e-01   +1.096464374609935e-01   -6.808618862268082e-02   +2.985682357093927e-01   +1.201287978181637e-01   +5.559341690679778e-02   +4.101416758281273e-01   -2.131283980365914e-01   +4.257759989567962e-02   -4.933883371448579e-02   +5.710830750650270e-02; +2.435782951834211e-01   +1.560704226218266e-01   -1.410841441397700e-01   +2.842526405584671e-02   +2.831856806559590e-01   +3.411426045779346e-01   +3.588186382826407e-01   +1.683858502643428e-01   -1.282321893345862e-01   +4.466363598893288e-01   -2.087872908384984e-01   -1.754697385535698e-01; +2.058894663604494e-01   +3.424496733654279e-01   -1.966175820636411e-01   +1.344006091338876e-01   +7.153309190408760e-01   +1.273872309670655e-01   -1.146772337137054e-01   +1.255697796443511e-01   +7.357022813485435e-01   +5.386525968367646e-01   +2.906254767282314e-01   +2.531697143818004e-01; +3.694544635717518e-01   +4.276461554703499e-02   +1.378846122594093e-01   +5.227631702155173e-01   +3.387389362303029e-02   +2.032758052551005e-01   -2.828313354360976e-01   +5.647725344692784e-01   +2.089488891489222e-01   +5.593506342611420e-01   +3.711387198293462e-01   +3.169708860163576e-01; +2.841761513603899e-01   +1.921689311826986e-02   -6.512890927326133e-02   +8.403099385487876e-02   +3.402657264766818e-01   +1.870739190333806e-01   +7.341006510180120e-02   +2.281745332332582e-01   +5.454095501234817e-01   +4.307256002903051e-01   +3.167241236275845e-01   -1.069271316267481e-01; -2.048457727280460e-01   +2.785390011085284e-01   +6.901641441343173e-01   +9.501600926882051e-01   +3.060967756534714e-01   +1.471657735298748e-01   +5.212404978580120e-01   +4.775031014950852e-01   +3.693510003582810e-02   +3.667147018201316e-01   +4.798010162413263e-01   -1.386410956746021e-01; +1.860796756152099e-01   +2.591521270627092e-01   +5.579862561506488e-01   +5.023627533116999e-02   +1.275067521211775e-01   +2.304990263278387e-01   +2.775867131198823e-01   +4.584606580119830e-01   -1.658843455275324e-02   +1.527542759961959e-01   +3.759442881505204e-01   +3.284519654910530e-01; +1.203286627969503e-01   +2.393253521180532e-01   +9.889852359142477e-02   -5.040767574832165e-02   +1.271371989363481e-01   +1.236888448741915e-01   -2.118918232709678e-01   +1.435583901305393e-01   +5.867206499755705e-01   +5.641839251651314e-01   +3.913167858280496e-01   +4.538538410090794e-01; -1.095587430169375e-01   +2.466639279237254e-01   +2.775983866066953e-01   +2.561524990440776e-01   -2.486974355824320e-01   +1.498024211599045e-01   +3.789069515506616e-01   +2.583161101661412e-02   +1.366459205826480e-01   -1.086921233786303e-02   +3.199927724926002e-01   +3.090315059489839e-01; -2.170436602212816e-01   +1.927542547072018e-01   +2.816320271101698e-01   -7.219991736244072e-02   +3.396099546722967e-01   -9.771845771200502e-02   +4.472682428570016e-01   +2.195185050908807e-01   +1.080147195432133e-01   +2.155483725578420e-01   +2.391534091260330e-01   +1.776047532615888e-01; +1.811695039296897e-01   +4.377924506073124e-01   -2.248294950494253e-02   +2.297381522971685e-01   +7.018814928505472e-01   +5.229515966180602e-01   +6.445727685900370e-01   +8.568508215437390e-02   +1.457948320019252e-01   -1.167741075874751e-01   +3.081724063973380e-01   -2.924186397866895e-02];
L2E_Input1_iAMPA_netcon = [+4.232404887026106e-01   +7.166405611515340e-01   +8.599537662116228e-01   +9.924803580238607e-01   +8.034736688819070e-01   +8.379819911171607e-01   +5.786274700460600e-01   +8.377929237466932e-01];
L2I_Input2_iAMPA_netcon = [+6.275439820631034e-01   +6.156682250041993e-01   +7.779917975328523e-01   +7.601900311617272e-01   +1.987066857950566e-01   +9.395874776531147e-01   +2.828428290078029e-01   +7.633080063315281e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
