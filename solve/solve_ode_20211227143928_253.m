function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-8.126270111913955e-03   -6.132624330844177e-02   +4.200920774028829e-02   -3.560047564001176e-03   -5.160732099329112e-02   -1.837939101302834e-02   +1.640622493939983e-03   -7.559686808016142e-02   +5.550698037093272e-02   -4.615282708952719e-03   +1.174960677315964e-02   +4.942960204169884e-02   +6.787628204409195e-02   -6.566490078715297e-02   +1.588225900815712e-02   -9.583897117354951e-03; -3.109481914861225e-02   +2.803692463201400e-02   -1.634434654859689e-02   +4.499973370903677e-02   +2.305243167261935e-03   +7.918749633219965e-02   +2.286733178771669e-03   +3.476766272796436e-02   -2.927780044862048e-02   -2.866147675574819e-02   +3.325612815802372e-02   +4.753351146835257e-02   +3.299609488845705e-02   -2.173972795073315e-02   -1.573393926998146e-02   +6.309110440266779e-03; -3.221008748985565e-02   -1.254560843484128e-02   +3.970342605010474e-02   +3.253415297357808e-02   -3.235553072005610e-02   +3.955266623112898e-04   -3.415542377408404e-02   -1.012655102859745e-02   -8.736688483047324e-02   +6.098667722630218e-02   +4.007524443234187e-02   -3.433010961394981e-02   +4.874158464708852e-02   -4.740546494609402e-02   +5.386844292680042e-02   -1.107355075964921e-02; +2.242911957548352e-03   -2.721343687594510e-02   -3.733780089905234e-02   +2.057634673627178e-02   +3.859583108509005e-02   -4.619598628042777e-02   -5.232041178367165e-03   +1.306529858584667e-02   -4.045055191521525e-02   -9.951308036985747e-02   +7.629064070660260e-03   +4.425311942543656e-02   +5.513101213097558e-02   +2.323279249861717e-02   -3.184024590850803e-03   +3.896178909259780e-03; -1.721881585571690e-02   -3.119724843545249e-02   -3.021806580958727e-02   -2.806096753094169e-02   -4.463510695158250e-02   +3.427375730043246e-02   +3.111511783211065e-02   +3.652044936109158e-02   -4.561487519299915e-03   +2.728747246846887e-03   +3.432593983298619e-02   +2.038271427257540e-02   +4.455645166432801e-02   +2.768046905005258e-02   -2.155215690329440e-02   -1.098737865945875e-02; -6.211224004824067e-02   -4.524091416649554e-03   +5.192787773426638e-02   -5.016587835901536e-02   +3.583856856705687e-02   +1.991813767850384e-02   +3.316502748441871e-02   -3.916264119791499e-02   -3.209241926244897e-02   +1.269335189245185e-02   +2.367328219862114e-02   -3.803884531539520e-03   +5.964887581354984e-02   +3.809815214767467e-02   -4.263424576600060e-02   +1.455135914878552e-02; +7.563052623171196e-03   +3.367156825642272e-02   -2.102830897875801e-02   -6.017435182776789e-02   -2.086245816108968e-02   -5.285820962226229e-02   -2.488259691038730e-02   -1.759705778057526e-02   +2.556026238073021e-02   -5.520484103399474e-02   +2.473534472152239e-02   -3.159504845404521e-03   +8.743589165113251e-02   -2.627098743147496e-02   +3.880044226403508e-02   +4.398742439122796e-02; +1.491994809291860e-02   +4.108930258818839e-02   +7.338314774531661e-02   -3.825927454282174e-02   -6.825329326087430e-02   -4.005368758720889e-03   +6.321422164241396e-02   +7.574630075359197e-02   -4.462428608780066e-02   -4.462707943726302e-02   +8.323695589566839e-02   -1.195589205368013e-03   +2.313378922668442e-02   -3.111487376197904e-03   +3.120821399714093e-02   -5.630857584904862e-02; -9.642105795093825e-02   -8.064351481641190e-03   +4.839773231448062e-02   +2.714787169563452e-02   -5.010583113881761e-02   +3.105812196431371e-02   +3.620697600796028e-02   +1.054566957276137e-02   -6.833447996768431e-02   +2.248095748501067e-02   +2.851442089895409e-02   -1.350997041195342e-02   +9.619792416515278e-02   +6.193543972674772e-02   +8.042947795553177e-03   +2.062701448280695e-02; +5.752268119457974e-02   -3.972420252245516e-02   +2.907625208802803e-03   +7.211715432439807e-02   +3.607979827067038e-02   +4.317309193424924e-02   -2.906610063523576e-03   -5.642239229088707e-02   +2.972258067521048e-02   +1.219489442490694e-02   -2.763819273227304e-02   +1.069849551584910e-02   -9.966548254625934e-03   +6.016156738405524e-02   -4.956914201699013e-02   -5.457496032385772e-02; +4.921660277390631e-02   +4.649196851504073e-02   -2.095829175772695e-02   -6.344415250632575e-03   +2.405436621659863e-02   +7.691360696620268e-02   +2.820161566506523e-02   +1.822225767556881e-03   +6.624544410360041e-02   -7.934444928266379e-03   +1.081454063432102e-02   +1.153649227561801e-02   -2.327969644831662e-02   -3.187227818842020e-02   -7.269564906518276e-02   -1.915580811310986e-02; +2.387772003564100e-02   -4.978891610972269e-02   -3.031020955009062e-02   +2.152209785171039e-02   +1.641881111740379e-02   -4.174200948249996e-02   +5.012933316536602e-02   +2.687328545720825e-02   -1.577157902242131e-02   +5.526234669882289e-02   +2.771059833495794e-02   -1.527647763209778e-02   +8.823556009609435e-03   +5.078139624233419e-03   +6.509468378697937e-02   +1.381409275978518e-03; +1.637213520876121e-02   -8.871085734565179e-02   +1.668796681951938e-02   +1.993334269296141e-02   -6.766306795650951e-03   -1.355124436503938e-02   -3.658596485422255e-03   +1.901341283215340e-02   +6.897016044867021e-02   -4.588418220105514e-02   -2.442561646830970e-02   +8.571744358621719e-02   +2.803622779472983e-02   +9.764358415011432e-02   +1.380567374400902e-02   +1.644831446915323e-02; +5.183592456856551e-02   +1.205085131573566e-02   +5.220305630217858e-03   -3.865423029081055e-02   +6.570827835496033e-02   -4.405923573869751e-02   +3.695858802970157e-02   +8.839315244043276e-03   +3.056434684306110e-02   +2.824786351476811e-02   -1.739395769957463e-02   -2.359899704210790e-02   -1.437426407461603e-02   -6.640147236121523e-02   -4.197881111492005e-03   +4.150569891606719e-03; -4.332383061415718e-02   +3.019478555410167e-02   +1.092765900635770e-02   +2.623505885189230e-02   +6.485340306922566e-02   -3.519130647818640e-02   -2.552745022136622e-02   -2.083393691399697e-03   -1.938522138731129e-02   +1.327181924718630e-02   +5.519900405715759e-02   +1.774715346226620e-02   +1.721847837393566e-03   -2.957804452732148e-02   -5.290756852419044e-02   -5.381921067807964e-02; -4.681590586894199e-02   +5.010587216118892e-02   +2.048796072594134e-02   +2.060788974158775e-02   -6.767005533607455e-02   -3.277885699151040e-02   -1.423774392739286e-03   -1.080941634240843e-01   -1.620109108601655e-02   -9.312792041534696e-03   +8.538283151714437e-04   +2.113808754580675e-03   -5.782234629898192e-02   -1.341791595253998e-02   -2.990906040107905e-02   +2.212336111680707e-02];
L1E_L1I_iGABA_netcon = [-5.506701488006781e-02   -2.843488655612527e-03   -5.900946995741783e-02   +5.160614852042164e-02   -9.029003843136020e-04   -3.594825003810045e-02   -8.020905273586876e-02   +4.417485740596649e-02   +5.368525292939250e-02   +1.300929528672753e-02   +1.154475705419200e-02   +1.252879695016624e-03   +7.155893604666293e-03   +7.899499248461578e-03   -6.986242224462276e-02   -5.457554094353385e-02; +1.311474622070036e-02   -6.755740021857998e-03   +5.902906375331194e-03   +3.614260983478128e-02   +8.406709713297725e-02   -4.160861782008332e-02   -7.454164142138374e-02   -2.982921415927692e-02   +1.175675290524444e-02   -3.701173334379634e-02   -9.263429307332913e-03   +3.636902152145494e-02   +2.631763510950218e-02   +2.479091176649155e-02   -4.340015992647301e-02   -4.316842275816567e-03; +2.996845403099480e-02   +1.157723029385383e-02   -2.515419570748676e-02   +1.136545434404134e-02   -1.577439717810068e-02   +2.557200680143241e-03   -8.181022828629037e-02   +1.039356048712541e-02   -2.043921337340828e-02   -5.615090371037370e-02   +2.455579429520210e-02   -4.659500473487846e-02   +8.549729603012422e-03   -2.424350238404550e-02   +8.270526462453770e-02   -1.294842163676500e-02; -3.930019845091583e-02   +9.925765950019875e-03   +1.638864510500825e-02   +1.014317542529284e-02   +3.221568498066438e-02   +1.807038047519768e-03   +2.772549078926188e-02   -1.709792684600611e-03   -2.790917956200912e-03   +1.159777018683416e-02   +5.474421235019521e-02   +4.415698435405239e-02   -6.114772012737472e-02   -4.582825394227418e-02   +3.587844637126150e-02   -6.316193592962728e-02; -7.426413107883401e-02   -6.796248492125486e-03   +5.881866690563290e-03   +2.637352313074719e-02   -3.205784687894806e-03   -1.212422962407687e-02   +8.292376659088536e-02   +3.953178453925891e-02   +5.878919431156486e-02   +4.647929504974330e-02   +4.457030414978314e-03   -3.568149219835562e-02   +2.022819223968515e-02   +2.952166740670293e-02   +2.508459086514312e-03   +4.256498531421821e-02; +2.409082765826212e-02   +3.886200888980718e-02   +4.244313150168504e-02   -1.719319838729547e-02   +3.553385632522732e-02   +1.223059014208363e-02   +4.363636130695833e-02   -3.077512505225560e-04   -4.388818405564342e-02   -5.208895829102188e-03   -3.738847227885021e-02   +2.519113581152762e-02   +4.507328681186766e-02   +4.852402408235914e-02   +6.705740391442032e-03   -2.377105518857067e-02; +9.367363384056594e-03   -9.312813406626635e-03   -7.941552221570347e-02   +6.254944073950403e-03   -5.581138672306425e-02   +1.453369215567818e-01   +1.432064540393210e-02   +1.039153652026957e-01   +1.316686625467660e-03   +4.225287067985989e-02   +4.935241603053735e-02   -1.938983963295298e-02   +3.249418161418365e-02   -8.446762384698095e-02   -1.574244108035625e-02   +6.310438945357993e-02; +1.482803595371397e-02   +1.370891014804318e-02   -4.730819491263782e-02   -8.214630091755215e-03   -1.047770821611589e-02   -5.983096746329197e-02   -1.329091608532160e-02   +7.112484974723661e-02   -5.783453675309692e-02   +5.505834075898619e-03   +2.640155619327870e-03   -1.601186553751301e-03   -7.531879116013655e-03   -3.349419063486676e-02   +4.060250183357215e-02   +7.250380306522916e-02; -4.799668357707347e-02   -6.064613859663481e-02   +1.223078700478335e-02   +3.695957772679099e-02   +4.800907686476299e-02   -7.148321533547983e-02   +8.372976471007054e-03   -1.546790619564991e-02   -4.848526343531754e-02   -5.316088227856834e-02   -4.655480620199649e-02   +1.840705323162063e-02   +9.908731615205151e-03   +2.310281945996347e-02   +2.210676104636337e-02   +2.643038303156260e-02; -3.180943972273109e-02   +1.249065871455473e-02   -1.374692303181398e-02   +9.236207100910022e-02   -4.287823674860407e-02   +8.618922091718094e-02   -5.966494966783054e-02   +4.623294852121920e-02   -6.872850702057684e-02   -3.948879290789447e-02   -6.528601355542465e-02   -1.462460873652268e-02   -4.088674010424035e-03   +3.987430360002087e-02   +2.561870202331688e-02   -5.247132404039898e-02; -2.069851787296861e-02   -6.210662938722217e-02   +2.369224464172171e-02   -3.209346958712606e-02   -2.918121443348475e-02   -5.226512624265357e-02   -1.420682616287642e-02   -8.739534470444429e-02   -4.901784278737185e-03   +6.101503786085459e-03   -2.199296466550970e-02   -5.172623156114770e-02   +4.421265338311288e-02   +3.178377817897757e-02   -6.398570091009841e-02   -1.600392045293085e-02; -1.182100334850170e-02   +5.200113741318584e-02   -2.331000826494318e-02   -4.821418580435938e-02   +8.377755272069942e-03   -3.544742828719646e-02   -1.625591742325093e-02   -2.312506993043747e-02   +4.231540317708049e-02   +3.052440344218882e-02   -6.407637319659186e-02   -3.962666240381030e-02   +5.297752299610299e-02   -5.013083907817277e-02   -3.989079050926090e-02   -2.560266123570965e-02; +5.021237041570050e-02   +2.000673819470671e-02   -7.836475467244869e-03   +1.467744289470475e-02   +2.861205255097322e-02   +8.422959203182760e-02   +3.467875716205829e-03   +8.820985683926842e-03   -1.962346938343041e-02   -2.518720566667227e-02   -1.777015114046921e-02   +5.300759900859152e-02   -3.433078268904437e-02   -4.767099169847054e-02   -4.239350172100558e-02   -1.583957781946949e-03; +4.427483105537162e-02   -1.602716720133453e-02   +1.288106584834706e-03   -1.842809305392751e-03   -6.888565890297720e-03   +6.546678070963511e-03   +2.648186401140545e-02   -4.031806107619461e-02   +8.556415767281653e-02   +5.652639894872077e-02   -2.853804735005779e-02   +3.799626943469808e-02   +6.610702851885085e-03   +2.604411261707011e-02   +9.127613494333680e-03   +3.520282431613615e-02; -8.234857870796826e-02   -4.392990010643833e-02   -4.396844238824748e-02   +7.915237810751536e-03   +1.438386091190145e-02   +1.464053657787539e-02   +1.127284834855613e-02   -3.907185126775817e-02   +7.514245670511584e-02   +4.480228677953230e-02   +5.121832389874709e-02   -5.601048075096185e-03   +4.053333289283088e-02   -4.197225348600429e-02   +1.999284158210128e-02   -1.056825840180808e-01; +1.767254410764352e-02   +8.091305842418536e-02   +5.991940423617256e-02   -3.974290989009764e-02   +1.758313232850936e-02   -8.552880414943320e-02   -1.230154547274419e-03   -1.224106018735280e-02   -2.323371778775028e-02   +7.843182488024149e-03   -2.966093074224551e-02   -7.303930779285055e-02   +2.644216300034897e-02   +6.120850783078141e-02   +1.598974417221774e-03   +7.614925499661038e-04];
L2I_L1I_iGABA_netcon = [-2.915443943349964e-02   -1.981529410660282e-02   +1.530785664060032e-02   -4.773106536243740e-02   -7.322540421613255e-02   +3.174398932799936e-02   +2.643425845540928e-02   -4.557069804816104e-02; -3.205702862074324e-02   -1.038212899543388e-02   -3.948118445388966e-02   +1.436373149766653e-02   -1.723472899988461e-02   -1.347409483320314e-02   +6.726458148814759e-03   +7.098217155898152e-03; +6.658141007938092e-03   -5.854399725630558e-03   -9.488413308284156e-02   -1.018155291774829e-02   +8.585816502682612e-02   -3.159196148234935e-02   +7.074133356130039e-03   -7.589515256909431e-02; -5.040692477905693e-02   +6.101350440879877e-02   -1.013657841015119e-01   +4.392836542768450e-02   +5.686314807130732e-02   +2.476018107143914e-02   +3.117979014450181e-02   -4.669498128107071e-04; +1.627076180467267e-02   +5.079162875542624e-03   -3.072712668245846e-02   +5.845100686204083e-02   +1.267153037892979e-02   -3.282353023707169e-02   -1.580096451998595e-02   +1.413676454164261e-02; +3.279867557362062e-03   +6.648563948727487e-02   +2.498383437402567e-02   -1.346957660128021e-03   +1.773202619545404e-02   +1.109395067320514e-02   -7.817949940290526e-02   -1.639133562335081e-02; -3.434911287595663e-02   +4.148494254252994e-02   -2.105664350907110e-02   +4.773292391677658e-02   +3.373175865240988e-02   +3.788523914936456e-02   +2.129323732348802e-03   +6.471673749818066e-02; +1.170234624827255e-02   -5.839576028810356e-02   -4.278143503872862e-02   -1.170087051795319e-02   +1.546062276914520e-02   +3.584745096500572e-02   -4.188242640847237e-02   +4.875517280314014e-02; -5.830744164979906e-02   -9.443830547386466e-03   +6.122768404762933e-02   +5.412204506789030e-02   -2.942233412579259e-02   +4.685730616135367e-02   +7.381206003885424e-02   +6.682068733947270e-02; +1.631406212105316e-03   -1.267563205129698e-02   +2.346846556064852e-03   -2.886417378803684e-02   -2.264478598590139e-02   +2.421655127599531e-02   -3.209019174388253e-02   -6.666686100342813e-02; +6.797149761524859e-03   +3.799776670119011e-02   +2.972892808218754e-02   +3.268935530385289e-02   -7.338184552584359e-02   -8.583579610714086e-02   +6.282441165705318e-03   +4.763339644199596e-02; -9.579017379946014e-03   +1.589461010121395e-02   -9.646274983277732e-03   +5.201755085259421e-02   -9.038263864332509e-02   -9.102970189700478e-04   -2.967884104174254e-02   +3.965534886659289e-02; +4.827550213166019e-03   +5.454295968458881e-02   +4.533957602730711e-03   -2.337928968155531e-02   +2.724985727981777e-02   +7.894374581181313e-02   +1.314984979183541e-02   -6.650834767899226e-04; +5.809347016556413e-02   +1.066951282369421e-02   +2.390802995289970e-02   +4.750292608608487e-02   -2.052199329764903e-02   +4.072658701625935e-02   -1.629702743279240e-02   +2.921892111448907e-02; -3.330081702202923e-03   -4.261356391105624e-02   +4.014740643851941e-02   -1.937320120625075e-02   +2.830087373116661e-03   +3.751600015847222e-02   -6.603683876687268e-02   -1.216557543868555e-02; -9.176926163751934e-03   +9.711825348114251e-03   -3.096962572086420e-02   -7.993406447729272e-02   +1.739438521472051e-03   +2.883717151917177e-02   -1.479402817230075e-02   -3.378520238055295e-02];
L1I_L2I_iGABA_netcon = [-4.378321985873020e-02   -3.161330122213375e-03   +1.098023273397606e-02   -1.648899839036319e-02   -8.382439124675783e-02   +1.853625269135499e-02   +2.710386667087332e-02   +3.106339903492276e-02   +4.967054936785366e-02   +7.929950342450346e-03   -4.520757105540769e-03   +4.516713152963529e-02   +6.628846927963373e-03   +3.030364860780070e-02   -2.569451101704065e-02   +3.856253212007698e-02; -4.500670406948294e-02   +3.450000140668482e-02   +3.267156938516537e-02   +2.578002256627587e-02   -4.200564999570756e-02   -2.556292007323513e-02   -4.226972435091751e-02   +6.188909682128165e-02   +1.180479184883617e-02   +7.813407530737342e-02   -4.918161001451676e-02   -9.182795884470121e-02   +5.742657811432246e-02   -2.798898045598824e-02   +3.954840931990567e-03   +3.599257297688896e-02; -4.409058958903900e-02   +6.747585485531964e-03   -6.251054085398230e-02   -4.245497166684127e-02   +6.757620970857508e-04   +6.048175026710632e-02   -1.293217903189467e-02   -2.953722959531370e-02   +1.055632560956987e-02   -1.401456922876928e-02   -3.933218622442287e-02   +5.230648723195093e-02   -1.777425411441018e-02   +5.602061161658824e-02   -4.697251477576045e-02   -1.825967718658312e-02; -6.032119531854140e-03   -2.136302137040349e-02   +3.857709057436500e-03   +3.239338138356399e-02   -4.022522798787676e-02   +2.401716746278443e-02   -3.392314820336623e-02   -3.764457204234527e-02   -8.668763339187495e-02   +1.368396501447602e-02   -3.596055177849032e-02   +2.649716772552122e-02   -4.089475194047470e-02   +1.754287480769948e-02   +5.366183568423429e-02   -5.528898849104046e-02; +1.027943719603606e-02   -4.774766171100332e-02   +2.357139188066262e-02   -3.943246590145115e-02   +6.387106843087043e-02   +7.618535933377325e-02   +6.698578038759230e-02   -4.256156723414099e-02   +6.110870544871374e-02   -1.772133485986721e-02   -3.515482725260328e-03   -4.645877625886614e-02   -3.444623524099464e-02   +6.162308268515235e-02   +1.383504262356964e-02   +1.931085635666555e-02; -5.301725970114556e-02   +3.778752291142130e-02   +7.001703794510624e-03   +4.672341090002604e-02   -3.213455842587819e-02   +5.334877006103100e-02   +1.775301192994928e-02   +3.288961211163132e-02   +1.163673141816260e-02   +2.140852301505109e-02   +7.569501973684115e-03   +4.887377109047647e-03   +1.297750908417728e-02   -1.833696310402621e-02   -2.249288065639166e-02   -9.742820524644386e-02; +1.422571535581925e-02   +4.042074104766660e-02   +3.281717832796388e-02   -5.797919208290001e-02   +6.988803866530378e-02   +9.185609050845486e-02   +2.303743822159512e-02   +2.356887770263094e-02   -8.874254380361482e-03   -1.366901152458863e-01   +5.893894666733945e-03   +6.147423752151967e-02   +7.555109677270827e-02   +5.024435295961905e-02   -5.037593306025694e-03   +6.158937312321899e-03; +5.887958655435157e-02   -5.821493147461092e-02   +3.213711448781289e-03   +3.923462616747831e-02   -2.965572944151104e-02   -5.948324728873913e-02   -2.427625786727728e-02   +9.735047799634184e-03   +3.610253322281297e-02   +6.178603668732623e-04   -1.991348645781227e-02   +1.924766107376398e-02   -1.916145971425702e-02   -3.041394407283295e-03   -6.484902065453617e-03   -8.228005449764522e-02];
L2E_L1E_iAMPA_netcon = [-6.677197787893352e-02   +3.208254236479916e-02   +2.229591315096182e-02   +1.435522848382889e-02   -3.346626230155206e-02   -7.283947822627845e-02   +9.223439099074660e-03   -3.833910257022579e-02; +4.447289340258826e-03   +2.679860664506475e-03   -2.014330756633956e-02   -2.499104201183975e-02   -3.012994660041454e-02   -1.894936288288793e-02   +9.684964766206642e-03   +3.295571217621194e-02; -3.965313694847608e-04   -1.021808954594767e-01   -6.048679793070092e-02   -1.402253525573806e-02   +2.324551706619451e-02   -1.500753730076476e-02   +6.175172947752832e-02   +6.023095461390320e-02; +8.555336811173713e-03   +2.509849022179800e-02   +5.990096193797794e-02   -4.015721427601723e-03   +4.427508236846989e-02   +3.539248292304781e-02   +5.762850687944354e-02   -1.514440354464452e-03; +4.633487907168400e-02   +2.409494997236322e-02   -1.448822574336683e-02   -1.064753060830788e-02   -3.907295751855606e-02   -1.810888184412497e-02   -2.668895676897121e-02   +5.599128705799409e-03; +6.525947029488591e-02   -3.121153271128306e-02   -7.335162865761583e-03   -6.963945686309691e-03   -4.660238123610304e-02   +1.832054776108264e-02   -2.605252105927193e-02   +1.213896014218382e-01; +3.680968557354204e-02   +9.571118364096940e-03   -4.084434950379409e-02   -2.584211221034548e-03   -1.167317014498812e-02   +3.613699360628975e-03   -2.357692232223082e-02   +3.232187388107826e-02; +4.257608781882467e-02   +3.481054334433557e-02   -2.962108246008597e-02   +2.266007349402564e-02   +2.897175731839052e-02   +1.796359869747081e-02   -1.686858977244126e-02   +1.933349447247238e-02; +1.750419974985982e-02   -4.036931345960802e-02   +6.282536313750864e-04   +2.311481404270768e-03   -9.681488278950184e-03   -2.086011183917103e-02   +6.488215251255551e-02   -9.236768654046848e-02; +8.127207536980308e-02   -4.684850552796987e-02   +1.368721037465591e-02   -6.931631332043602e-03   -7.128013301981307e-03   +2.541489798690075e-02   -4.444968167969457e-02   -2.756862167974870e-02; -3.827653435409566e-02   +4.538236108240472e-03   -1.986229718004036e-02   -5.861571749547205e-02   +6.300357729155560e-02   -1.591562589850774e-02   +5.313550574777758e-03   +1.886277418959574e-02; +2.827763275223029e-03   -5.906604595179369e-02   -3.994357527664518e-02   -8.632233315117965e-02   -4.988901775076596e-02   -3.338947957385967e-02   -4.787533473845968e-02   -3.616968372421403e-02; +3.306480967861796e-02   +4.071638362793412e-02   +3.545580015670227e-02   -4.546397340839945e-02   -3.490358982882810e-02   +2.188948518850552e-02   +1.351346716610238e-03   +2.445019999640979e-02; -4.664584193195983e-02   -3.411395113032251e-03   +1.564521188349714e-02   +2.510865573091839e-03   -3.152798038775938e-02   +4.347037915958532e-02   +7.628037979394648e-04   -2.830585701204125e-02; -2.717464286872399e-02   +3.563360465566549e-02   +9.168295498482122e-02   +4.182577581617283e-02   -8.133051867142648e-03   -2.375021870483102e-02   +5.729978372116694e-02   +2.249477951233243e-02; -4.319370805110036e-02   +3.783607774616349e-02   -2.243454005814623e-02   +6.133936077181800e-03   +1.349462918249994e-02   +2.171426342047155e-02   +2.562615232865196e-02   -7.369646740375670e-02];
L1E_L2E_iAMPA_netcon = [+4.029672234754809e-02   +6.059790396092312e-03   +1.209649980415939e-02   +1.124130591937091e-02   -1.041711053565594e-02   +2.866423521517743e-02   +1.576496336724821e-02   +4.739624570322738e-02   -7.223648465430152e-02   -2.261156765256786e-02   +6.529725744354305e-02   -4.455193802929941e-02   -2.681779827831611e-02   -2.286154919196986e-02   +4.744201824589171e-02   -1.720441465189442e-03; -1.022665147778874e-02   -3.528325153043213e-02   -4.039689886131313e-02   +9.305214946286480e-02   +3.478892032045351e-02   -1.621257193304402e-02   +6.984307341978479e-03   +1.395242861467757e-02   +5.441292896603570e-02   -2.784489433539835e-02   -1.067191794659473e-02   -3.044525744572701e-02   -1.586249793311165e-02   -6.439221913100631e-03   -2.184916549592594e-02   -4.326810884945431e-02; -3.542725712139723e-02   +2.853869003646773e-02   +7.841349151322283e-02   -1.607505383135202e-02   +1.737797634262904e-02   +7.935676937620461e-03   -2.354439284355881e-02   -2.256675666218423e-02   -3.859330521090393e-02   -5.436838999416113e-02   +3.659890302544651e-02   -7.295831492116142e-02   -3.264584450811404e-02   +1.065626453760421e-01   +3.695644792627114e-03   -1.026738659998004e-02; -5.483816557391892e-05   +9.471364866862054e-03   -5.032923158707681e-02   +2.718166468434977e-02   +3.770927056278003e-03   -2.178147744231364e-02   -6.136714157369659e-02   +3.471710831655076e-03   +9.498395044709930e-03   -5.395465725219597e-02   +2.251165308342800e-02   -1.135881640015928e-03   +1.120585944588384e-02   +3.818282848930263e-02   -1.260730437312082e-02   +3.675436237634548e-02; +4.724578085449754e-02   -4.070772036449095e-02   +4.985682921737641e-02   -3.504690649826035e-02   +1.379861198924537e-02   +5.767843523046867e-03   +9.370533238696278e-03   +2.217563529332032e-02   +1.083396135584752e-02   -1.619425703091510e-03   +3.389567930158953e-03   -6.037913063636951e-03   -3.845202044158174e-02   -2.681168131717567e-02   +3.299522684565237e-02   +3.070104963115617e-02; +4.916832574628396e-02   -1.966174327628120e-02   +1.843101459332235e-02   +6.638388674687122e-02   -9.878481136657671e-03   +5.759425460623999e-02   +1.585649713926543e-02   +3.494318764399233e-02   -8.312866719780576e-02   -1.270087439261831e-03   -3.092885625068060e-02   +7.505893363125435e-02   +2.310624713552580e-02   +4.895520823320934e-02   +7.308482698876413e-02   +1.540718369554184e-02; -1.386729451612385e-02   +5.629579549590644e-02   +4.658694131803706e-02   -4.407072061851087e-02   -3.722083296226968e-02   +2.236504400186146e-02   -3.122182526096470e-03   +2.246192916931673e-02   +1.663683097690953e-02   +7.897465142801523e-03   +5.529449551357853e-02   -3.197992972447839e-02   +3.023568313120682e-02   +6.956667595803448e-02   -2.860148185517799e-03   -3.906405493855464e-02; -1.873483155293648e-02   -1.230134234549042e-02   +1.117213960573702e-02   +4.035777768190931e-03   +3.535212832175198e-02   +7.111926168049372e-03   +4.285489703013774e-02   -1.404514255136280e-02   -5.514310547632129e-04   +9.225570840484485e-03   +3.355721383743906e-02   +1.675950059117297e-02   +3.697462864515697e-02   -1.074549755155322e-02   -7.252302868411682e-02   +3.827233570821425e-02];
L2I_L2E_iAMPA_netcon = [+4.282448410840502e-02   -5.673301889466258e-02   +4.290159728560628e-03   -5.738500579193417e-02   +6.371287274842651e-02   +7.199890769521442e-03   +1.338922590818126e-02   -6.660467017656543e-02; -4.524932326233327e-02   -4.390998602415895e-02   -6.869274156351274e-02   +1.174962427637808e-01   -5.482812214550881e-05   -6.965322149037590e-03   -6.319156759787334e-02   +1.135221842740802e-02; -2.438746183770126e-02   +3.367263598333337e-02   -3.522750484835900e-02   +1.790774178979258e-02   -6.963067123609896e-02   +3.937676083483442e-03   +5.324034054341430e-02   -8.961588702848820e-02; +8.426243158137239e-02   -3.405143427842675e-02   +2.941250902183951e-02   +4.699881321310866e-02   -9.150898368384981e-02   +5.492670355591317e-02   -1.794511216492603e-02   -3.491174276136061e-02; +9.279589734267266e-03   +4.657414533954152e-02   -1.263584163450071e-04   -1.030267027132787e-02   +1.908832898293161e-02   +7.044585099527419e-02   +7.270516715861466e-02   +7.087540962659898e-02; -3.204621697084838e-02   -4.454372522022068e-02   -1.400717890649804e-02   +1.068152917709801e-02   +2.921671513752266e-02   -4.129825840616021e-02   -1.373840792960090e-01   -1.002859615789451e-02; -1.296362245274155e-02   -1.750502031312390e-02   -1.289313917132863e-02   -1.458947573681044e-02   -7.513080830435974e-02   +3.809473417806167e-02   -5.465246974241093e-02   +2.570149910863295e-02; -2.926528421413541e-02   -4.185618437377923e-02   +5.420713580317918e-02   -1.660746979635817e-02   +5.898913954468284e-02   -3.292322666279920e-03   -2.404082996444159e-02   +3.343122869261728e-02];
L2E_L2I_iGABA_netcon = [+5.006545685536687e-02   -2.019295941420712e-02   +4.987060010950459e-02   -6.447293961649767e-04   +2.661792713538691e-02   -6.575440963294833e-02   +8.470752986721449e-03   +2.360508996611443e-02; +1.742743831654449e-02   -4.694288598783236e-02   +3.405136185416522e-02   +4.917245232296454e-02   +1.474755675084637e-02   -3.729613484523487e-02   -5.234659361336832e-02   +1.552371604052540e-02; -4.680234441051952e-02   +5.580041760917540e-02   -2.019751753335603e-02   +4.232976098796121e-02   +3.290214063073989e-02   -3.688483859890890e-02   +5.761256546397490e-02   -3.326934171528045e-02; +1.994623358101983e-02   +9.020924696235643e-03   +2.782452413945264e-02   -5.771125356817375e-02   +1.814116282135666e-02   -1.062632218009564e-02   +7.414585939614783e-02   +5.834913515711218e-03; -1.999194866232097e-03   -3.113997745485083e-02   -2.255033819395353e-02   -2.270002740565421e-02   -4.999842477765683e-02   -1.370045990602977e-02   +8.620472739930097e-03   -3.271268591784241e-02; +2.003749986045551e-02   -3.650711776738123e-02   +4.484375768126531e-02   +4.610760164351699e-02   -3.066332244120860e-02   +4.396220784506687e-02   +5.573230162425249e-04   +5.184712011617613e-02; +3.094662401436438e-02   -1.290517085181057e-02   +1.914132182249717e-02   +9.621736772136248e-02   +3.543218569910793e-02   +3.632584605103143e-02   +5.137163159752488e-02   +4.537377936030220e-02; -1.837950781738474e-02   +9.205002996900692e-02   -2.252197611085598e-02   +7.312049093940159e-04   -4.530694855166154e-02   +5.371116263634302e-03   -8.503383368940978e-03   -2.246641486535819e-02];
L3E_L2E_iAMPA_netcon = [-3.445370347048964e-02   -6.851565499643690e-03   -2.320043553562158e-03   -8.395997261354315e-03   +9.323358729181322e-03   -1.336666155616564e-02   -4.384876911645954e-02   -2.519911667252204e-02   -1.295370780731478e-02   +8.775242625391059e-03   +2.006666475023835e-02   +1.729507083055397e-02; -8.268344010917730e-02   -7.948010306895723e-03   -1.809779628916433e-02   +6.496609806534641e-03   +5.018885434809116e-02   -5.175009134121004e-02   -3.120615404588294e-02   -8.075455429399707e-03   +5.126578938269751e-02   -1.682061791813064e-02   +1.177452439712694e-02   -4.676569867426787e-02; +1.977911895716973e-02   -6.785039257462705e-02   -1.054268387537658e-01   +1.290247088715033e-03   +4.350126549905591e-02   +6.591914319322774e-02   +3.164502209134570e-03   -8.151720174181466e-02   -2.039707209244473e-02   -1.526227850193623e-02   -5.523579540022487e-02   +3.161536187241731e-02; -2.432168084190622e-02   -4.387290993297069e-02   +2.836524693392827e-02   +2.301902163545601e-02   +6.189867454853684e-03   +3.615686931858608e-02   +7.244090952185957e-04   +6.291268909897320e-02   +3.486443537790652e-03   +3.967737000000499e-02   +1.811017461746245e-02   +2.094498414743884e-02; +4.332770690661256e-02   +4.447597778599906e-02   -2.812246855901770e-02   +4.523959507799609e-03   -2.425902264215733e-02   -3.315008659360241e-02   +1.007955616637735e-02   -1.639108056834587e-02   -3.749744578823298e-03   +7.096952313552155e-02   -4.501904101285521e-03   -3.595628971980358e-02; -5.497465061027267e-02   +8.133024935705679e-03   +3.678651157318893e-02   +1.889236978527957e-02   +1.417729438779226e-02   +6.326613129068351e-02   -7.961091109707781e-03   +1.096008768291396e-02   +8.873184200098843e-03   +4.467333739209850e-02   +5.486756630930788e-02   +1.247894792763459e-02; -4.080241853254503e-02   -3.879416277787907e-02   -4.480675669629629e-02   -2.753004648478581e-02   -6.379337532566648e-03   -2.822415272380188e-02   -3.737117336357379e-03   +1.868330726359014e-03   -2.238534082709690e-02   +3.537152763619215e-02   -9.402367868097249e-03   +2.829784720162409e-02; -3.720608993196101e-02   -1.269176048770113e-02   -3.511159138857418e-02   +4.177602951961615e-02   -1.237702991741771e-02   -4.171573765741170e-02   +1.449028718032952e-03   +8.924212597593748e-02   +2.549353898678802e-02   -9.551750274929027e-03   +1.391903725503234e-02   -8.844334994221804e-02];
L3I_L2I_iGABA_netcon = [-1.702852603842855e-02   -4.853275243339211e-03   +9.674294645226032e-02   +1.443248491545052e-02   -1.783640362906717e-02   +2.960374424081819e-02   +6.856102261503579e-03   +8.864068413871723e-03   -2.776130183195595e-02   -4.742954825170817e-02   +9.236936987353514e-04   -4.321494510272687e-02; +4.007799836491067e-02   +4.843368060356691e-02   +2.602861083568550e-02   -2.757506613753800e-02   -1.791345582856690e-03   +4.833449326642546e-03   -3.204880257008395e-02   -4.079527671243402e-02   +2.335734955878079e-02   +2.878504915851710e-02   +1.671086393076167e-02   +1.728800618453235e-02; -2.798465717056849e-02   -1.003612774145388e-01   +6.080688232098561e-02   +3.942075265714773e-02   -1.044972865714433e-03   +1.880861863437268e-02   -1.179971166791732e-02   -4.168781435106324e-03   +2.682612905272973e-02   -1.360058137787100e-02   +1.445944031900575e-02   +1.918179407378181e-02; +1.242675649455307e-02   +2.814008782868548e-02   +2.714456944587048e-02   +6.941558780289923e-03   +5.199980502941682e-02   -1.992437151855529e-02   +1.905052343683058e-02   +5.030944239039004e-02   -1.355585552322939e-02   -3.794068553604419e-02   +1.158509406659012e-02   -3.739241781004932e-02; +7.165954733156120e-02   +1.040302572577924e-02   +3.284650524272290e-02   +1.386923661170372e-02   +9.946169587935153e-03   +3.435222718125789e-02   -2.587480949929399e-02   +1.147738724672799e-02   -3.641720213805178e-02   -2.081114475305731e-02   +3.501607552237524e-02   +1.127745941307147e-02; -3.393844595819198e-02   -2.861996641595525e-02   -2.933015539288658e-02   -4.467940606169563e-03   -3.441056765442854e-02   -7.627439831035560e-02   +1.638180573035681e-02   +9.255134512279143e-03   -9.046465494351093e-02   +5.636841275709311e-03   -1.081872725446815e-02   +1.124019921045039e-02; +2.030700712174006e-02   +8.203576012136466e-03   -2.171767289863492e-02   +9.969359216221367e-04   -5.059067389902914e-02   +4.837208378274742e-03   -2.935944369743906e-02   -3.226016383143249e-02   -5.797887927671418e-02   -1.768694260670187e-02   +2.305523591619523e-03   +2.620585646561690e-02; -4.545624401836314e-02   +4.408209139083161e-02   -8.961589790737655e-03   +7.826600963446576e-03   +1.190628536278574e-02   +2.165625083577295e-02   -5.164282930135745e-04   +1.630801283572093e-02   -3.967979593754321e-02   -2.897587164540527e-02   +9.470170614685833e-02   -3.231349504816093e-04];
L2E_L3E_iAMPA_netcon = [+5.074547230153937e-02   -3.083873184191544e-02   -5.352491002547004e-02   -1.305837880328156e-02   +7.209048886793555e-03   +4.295282322336474e-04   -4.643004394683586e-02   -8.940001782160863e-03; +6.681400368719069e-02   -2.677223571263049e-03   +2.400740112087326e-02   +1.407099061042023e-02   +8.195120755182188e-03   -6.185106368163184e-02   -1.996026780229038e-02   +8.027384647618994e-02; -2.219495222261470e-02   +4.333609904616344e-02   +2.739353728063323e-02   +1.065358215490768e-02   +4.069953092951424e-02   -7.474355707347347e-03   +9.832486030448421e-03   +7.784761246726933e-03; +8.004252990498048e-02   +6.628738577503462e-02   +3.897796099542265e-03   +3.722494314973680e-02   +2.294520146428025e-02   -4.079304916774249e-02   +3.772008437768250e-03   -1.945658333441633e-02; -7.875565771940000e-02   -1.027950497603160e-02   -1.238631779761592e-02   -5.395024233198190e-02   -4.538999211765491e-02   -3.239765388902641e-02   -9.162553588716878e-02   +2.019165289235631e-02; +3.812255942886114e-02   -5.404177349731572e-02   +4.435079153508146e-03   +3.886353243651676e-02   +2.144084689259515e-02   -2.270648089780002e-02   -5.249172197110977e-02   +2.006032234668927e-02; +2.549772493734610e-02   -2.435335427758929e-02   +3.091193520338043e-02   +5.168180955704573e-02   -2.712704302087156e-02   -2.147929037496906e-02   -3.633644183727917e-02   -1.650731537351190e-02; -2.668962046190806e-02   -1.574743132028913e-02   +2.684823184844280e-02   +4.219623773148305e-02   +7.864649094793354e-02   -1.837006895656998e-02   -1.926191805752252e-02   -1.355493362402743e-02; +4.072089756044055e-02   -3.012274248242264e-02   -1.013062643136398e-02   +3.281069331917175e-02   +2.813765566426117e-02   +2.465986149526012e-02   +2.712880282920604e-02   -1.633935235636168e-02; -3.654667021917665e-03   -3.723833961609261e-02   +9.639006904730747e-03   -1.134821397685526e-02   -3.427336165512367e-02   -1.287665418841975e-02   -1.837758660585657e-02   +6.882770256321735e-02; -4.186810878423616e-03   -1.907987260282801e-02   -5.106137739847780e-02   +3.175165454438307e-02   +2.344400202075116e-02   -2.820381541430165e-03   -3.844560266476959e-02   -3.005086597656830e-02; -2.842514534889180e-02   +3.580594673286319e-02   -3.023113990690450e-02   +1.940321475950866e-02   -2.462368220504120e-02   -3.702420191962139e-02   +2.548656216935654e-02   -8.913737522066190e-02];
L2I_L3I_iGABA_netcon = [-1.331810038302226e-02   +1.377213889250741e-02   +3.354509594136357e-02   -4.425733704547924e-02   -3.214682538802963e-02   +3.526491362052981e-02   +7.713053378919271e-02   +4.582405576313212e-03; -3.702184193678486e-02   +1.385345075882422e-03   -1.808594986047085e-02   -1.254197771410032e-02   -8.597545730709442e-02   -1.352572915214190e-02   +7.272339404746761e-02   -3.693127012556842e-02; +6.928300758513264e-02   +1.537894081294773e-02   -3.315866196089423e-02   -2.658455565589807e-02   +3.308105974014550e-03   +3.353984036226524e-02   +4.257666387548589e-02   +4.733415828887378e-02; -2.465020540738214e-02   +2.380907050178649e-02   -1.796703863597340e-02   -1.476900697225954e-02   -1.618603857164029e-02   -2.126497988013457e-02   +1.711701729839149e-02   -9.188543223761260e-02; -2.283158746650882e-02   +1.755006134635833e-02   -6.875115219539371e-02   +2.592414159355994e-02   +4.621403629537514e-02   +2.406815526868525e-02   +1.599723277045554e-02   -9.544194165448262e-03; -6.132537513774241e-03   -6.630664772560857e-04   -4.937553491663493e-02   +1.287446112266569e-02   +1.504531153187836e-02   +8.387766368767346e-02   +6.941282078938567e-02   -1.920860926561248e-02; -3.080659985343205e-02   +6.723753280795465e-02   +1.927340295322865e-02   -2.073179210618943e-02   +9.138458519665243e-03   -5.906133354529135e-02   -5.554164105676208e-03   -3.975621965341483e-03; -1.909842707978952e-02   -2.522453636635585e-03   -4.046369244877770e-02   -9.857254422624251e-03   -1.444369898365344e-02   +6.012740478024898e-02   -9.504526867566577e-03   -7.158406502965325e-02; +5.872796845047196e-02   +4.897956575047338e-02   -7.728753640795250e-03   +4.142829451990288e-02   +1.230364690570053e-02   -1.748966987695724e-02   +2.864804557335909e-02   -2.038729004666735e-02; -5.898991471536749e-03   -3.023125266270976e-03   +7.624489016879997e-03   +2.828223072986840e-02   +9.466646419305558e-03   -6.361604132009478e-02   -6.260264761551917e-02   +3.030938116956306e-02; -5.571916675089984e-02   +2.560017940791344e-02   +8.783552695774799e-03   +2.583482868499365e-02   +3.199143206009881e-02   +5.689985342237366e-02   -1.384880662964481e-02   +3.277242603222359e-03; -6.979788671285643e-02   +8.449549798542901e-02   +2.198963015151491e-03   +1.060922225532712e-01   +3.554809761852360e-02   -2.006456401157391e-02   -2.120451747890573e-02   -3.074622848294734e-02];
L3I_L3E_iAMPA_netcon = [+5.586884818544090e-02   -6.917347606254682e-03   +1.468913191647067e-01   +5.643020884444194e-02   +2.934929509712929e-02   +4.229637727668228e-02   -9.965463974726745e-02   +1.624695748268274e-04   -2.565195554768348e-02   +4.499607688204442e-02   +1.352470853716715e-03   +8.986607144669206e-03; +1.431821652300663e-02   -2.886839928219318e-02   +5.481773066840494e-02   -2.442252812547958e-02   +1.209223311945063e-02   -9.168450714915660e-02   +3.715506072430017e-02   +4.237896313735935e-02   +2.495986087094298e-02   +3.896301481146074e-02   -3.195921610295132e-02   +4.626008190099920e-03; +3.929570263063276e-02   +3.823961705414191e-03   -4.682773171999731e-02   -1.899988365904809e-02   -9.173714824411608e-03   -1.700446506911926e-02   +2.242456456305700e-02   +7.216958567665878e-02   -2.519173038726662e-02   -5.943688416995585e-02   -5.624929830998808e-03   +5.024024042477913e-02; +2.062850537504436e-02   +1.868844158504192e-02   +3.419456415019016e-02   -2.759434168465665e-02   -8.166336912924808e-03   +1.873278372993824e-02   +2.318904933704053e-02   -7.564774425742677e-03   +1.576902941319068e-02   -5.143543703948750e-03   -5.439370579410629e-02   +3.455303471935421e-02; +1.906899913467673e-02   -8.611078861386755e-02   -2.466402494065620e-02   -7.434463195386110e-02   +3.618343439026804e-03   -2.554948459702353e-02   +1.931554696970910e-02   +3.428031911163242e-02   -8.281642275135338e-02   -2.635795810432427e-02   -4.248648647487385e-02   +2.889737284745187e-03; -2.345707057623146e-03   +6.423154139474661e-03   +4.759722823746674e-02   +1.114651577389260e-02   -2.054372967785059e-02   +6.496813582426743e-02   -1.200774468530268e-02   +8.842074749362480e-03   -2.541503207361356e-02   +3.950393627542772e-02   +7.087288345668391e-02   +8.598420824487980e-03; +4.005344685494899e-02   -1.708913444345757e-02   -1.338287680318317e-02   +4.106435568879835e-02   -5.225049358533669e-03   -5.731769100902994e-03   +1.414601845227952e-02   +3.170504355208979e-02   -4.161996945309132e-03   +9.944899485411308e-03   -8.258090071757701e-03   +2.577804228900063e-02; -4.850593314956835e-02   +1.219664753418296e-02   +6.637151087237476e-02   +1.688654271169769e-03   +3.906904173301461e-02   +2.145773815161404e-02   -4.417040576756178e-03   +6.214797403039441e-02   -1.346201153820882e-02   -2.695844530450744e-02   +4.031081251517539e-02   +6.937397571086383e-03; +2.246691873577613e-02   -1.222546036748594e-02   +8.799713828871908e-02   -7.813523720683120e-02   -4.940244754565721e-03   -4.324635213691566e-04   -8.206256132210364e-03   -1.628187079345804e-02   -4.534920160303560e-02   +3.870642140635722e-02   -5.196728225450056e-02   -2.767078768700270e-02; +9.078882017287961e-03   -2.142228527756035e-02   -5.530856200815121e-02   +8.910817266714591e-02   -4.237845887633405e-02   -1.612621415257062e-02   +1.693314624920861e-03   -9.562045019385309e-03   +2.479321602167118e-02   +3.801517370792479e-02   +5.175895947197728e-02   -2.536440296726656e-02; +1.504330633978857e-02   +7.864024424192560e-02   -9.827799698341186e-02   -8.484543860850807e-02   +6.117997535777115e-02   -3.458504371151781e-02   -4.337824548794607e-02   +2.793621226149632e-02   +1.686339668718938e-02   -3.009974021565591e-02   +5.580259170078166e-02   +6.636304086742134e-02; -3.031892149682263e-02   +1.098760610888830e-01   +1.630043363325094e-02   +1.332949507794243e-02   +7.999946673852953e-02   -6.665656718408962e-02   +3.711738034886045e-02   -3.352882559173609e-03   -2.392491326862189e-02   +1.024404084057776e-01   +5.175121531774368e-02   +2.647708032947641e-03];
L3E_L3I_iGABA_netcon = [-5.820302301027266e-02   +4.435647000654604e-02   +1.204639603429924e-02   -3.637150448434626e-02   -3.485937947569702e-02   -3.347816938193991e-02   +1.982477890806070e-02   -3.343543053475752e-02   +7.543526326866894e-03   -1.496069611150911e-02   -4.997717680731191e-03   +1.478432401529471e-02; +3.656601661760218e-02   +4.673429404478820e-03   +1.812973846427221e-02   +5.229269187790968e-02   +6.431464361138574e-02   +7.709182080004437e-03   +7.144051671256034e-03   +9.853096985221223e-03   -5.402055360628039e-02   -2.294059901175008e-02   +1.114117451679435e-01   -2.911541865782500e-02; -1.539192049499146e-02   +3.414582651365752e-02   +2.591479363034955e-02   -3.567165522631597e-03   -1.335741656648328e-03   -5.721060214825250e-03   +1.293133954038851e-02   -3.226165042302839e-02   -3.852187073160753e-02   -4.636515147556246e-02   +2.319021062389615e-02   -3.305016823409540e-02; -1.894139909794656e-02   -1.958456149797894e-02   -3.834180267236240e-02   +4.039852168636924e-03   +4.984852300062118e-02   +3.513996311446832e-02   +5.026421729733671e-03   +3.747646320259791e-02   +4.451931904442576e-02   -9.018380032767809e-03   -4.626793299158786e-02   -2.195584862130890e-02; -2.801068263804049e-03   -8.249360805121497e-02   -5.133941171692183e-03   +3.201674214147913e-02   +2.421676597765179e-02   +3.594696553019592e-03   +4.457515832840273e-02   -7.779300158189113e-02   +3.056525121019736e-02   +2.389841509268108e-02   +2.128554898227110e-02   +6.182175104272693e-02; +1.007553518533420e-02   -1.479778476310245e-02   +3.094697267634564e-03   -1.979376086916233e-02   +5.915104319159308e-02   -7.327135799240206e-03   -2.088469026158418e-02   -2.255139404208785e-02   -2.478932628483268e-02   +1.695271224665166e-03   -5.441296026940731e-02   -3.864409638242289e-03; -8.154082190077061e-02   -1.331755836643843e-02   +8.100529175569117e-02   -7.653939842973700e-02   -4.002785051975870e-03   -3.165088261088285e-02   +2.360811143304670e-03   -1.731970852603681e-02   +5.727697571385087e-02   +1.111047565463248e-01   -1.840510543602986e-02   -2.251494890630454e-03; -5.600018009406551e-02   +5.115801614165075e-02   -4.044826399260047e-02   -8.660005361643608e-02   -5.459995311976978e-02   +2.872807338083483e-02   -2.722512823865674e-02   +4.151227011503167e-02   +9.938215834679581e-03   +2.518917862075512e-02   -1.871296050507605e-02   +2.690738244071956e-02; -2.863549193301177e-02   +5.158927651587929e-02   +6.013458970930514e-02   -3.674407296061874e-02   -5.262219603046146e-02   -8.527590680370142e-02   -3.469352947862461e-02   +5.725365279347613e-03   +5.232136532193608e-02   +3.071233818613109e-02   +5.209541561839202e-02   -2.728819253945440e-02; -6.889815158373125e-04   -7.996903015419296e-02   +2.028694556160102e-02   -3.123314920084263e-02   +2.580492977066237e-02   -5.900576826632797e-02   +1.796015829547923e-02   -1.528769867550598e-02   -6.172185362800002e-03   +9.303280542755544e-03   +7.686686212022106e-03   -1.944439469409236e-02; +2.826413335699494e-02   +3.105757942721842e-02   -3.875145277094273e-02   +4.832038985900064e-02   -1.357949703737558e-02   +4.849486594643507e-02   +4.696305410042782e-02   -3.396749048395145e-03   +1.784272032106923e-02   -2.021888504856659e-02   -2.997532814183615e-02   -3.588077896799230e-03; -2.590877831782571e-02   +6.970780863361481e-03   +4.468354162465956e-02   +1.386765606922119e-02   +4.122185041084695e-02   -4.462639559488611e-02   -2.576651934342775e-02   +5.398242264054769e-02   +6.845719499247095e-03   +9.840453489194174e-02   -1.913266396682955e-02   -5.388212002224112e-02];
L2E_Input1_iAMPA_netcon = [+1.977601232880733e-02   -1.044436551681581e-02   +3.247753063210092e-02   -5.929130566482006e-02   +2.080333027578121e-02   -2.816348697465080e-02   +4.422892905794924e-02   +3.449090219418817e-02];
L2I_Input2_iAMPA_netcon = [-5.963756503448060e-02   +2.272315619486035e-03   -2.420651732531322e-02   -6.897626967011344e-02   +4.634795536572373e-02   +2.738794911447534e-02   +2.282754115423784e-02   -2.280339101140329e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
