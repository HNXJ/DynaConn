function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.538980999769231e-02   -7.794617207959617e-02   +5.042142277116475e-02   -8.205489309876270e-03   -4.688559318734184e-02   -2.284597460248574e-02   +7.385449907669593e-03   -9.020130617417482e-02   +4.868536336826943e-02   +8.397608742669246e-04   +3.802406068635035e-03   +5.964764585979931e-02   +7.548893495448415e-02   -7.413454269205749e-02   +2.118923989091073e-02   -2.193528854359656e-03; -2.831835120986696e-02   +3.416922852623927e-02   -2.569529573078581e-02   +5.147632589504902e-02   +4.054134392256551e-03   +8.308990398500553e-02   -8.430723422036608e-03   +2.744192028710190e-02   -4.168558703984193e-02   -3.183165879464080e-02   +3.487415609425071e-02   +5.576479216765547e-02   +3.220370024543773e-02   -2.680239459135138e-02   -2.040536743201790e-02   +1.325904672258453e-02; -2.768281892891162e-02   -1.344394029748916e-02   +4.167298439635360e-02   +3.187656096914763e-02   -3.321119027450743e-02   -1.071674239215954e-03   -4.490776321967373e-02   -1.392471493025444e-02   -9.379461918769014e-02   +6.896452528100711e-02   +4.488447612207927e-02   -3.060477720864170e-02   +6.392625090739060e-02   -4.274820704457297e-02   +7.149845046931100e-02   -1.918349441358988e-02; -8.530915476969936e-03   -2.333828888944071e-02   -3.973823278828038e-02   +3.008553694935527e-02   +4.485983842484544e-02   -5.800931479388459e-02   -1.101000796976758e-02   +2.673514816220123e-02   -5.367766612673675e-02   -1.021795867835956e-01   +1.978280629124162e-02   +5.939743851968005e-02   +6.454335295179549e-02   +1.928071592642136e-02   +8.415034182970692e-03   -5.834827460756905e-03; -1.349501341812362e-02   -3.745423607359948e-02   -3.194809433172631e-02   -3.397784445525942e-02   -4.499647268392529e-02   +2.651402208533346e-02   +2.929461146497606e-02   +4.899989419103962e-02   -4.754987545542557e-03   +7.630170794433835e-03   +2.788486403992270e-02   +3.457436875120115e-02   +4.346701576066601e-02   +3.385702638349344e-02   -3.274108659874301e-02   -1.071736586827783e-02; -6.236047639643137e-02   +2.583247794540389e-03   +5.824986823978160e-02   -6.523496883492050e-02   +2.844651038045891e-02   +1.794777039601105e-02   +5.068204112055130e-02   -2.988642631615336e-02   -3.248022683526236e-02   +3.985746274330269e-03   +3.416856432625877e-02   +6.540529995202628e-03   +5.608241035406544e-02   +2.895972912866169e-02   -5.520196268278367e-02   +2.274505366992880e-02; +1.638722751093970e-02   +4.087256019399856e-02   -3.648422666997744e-02   -7.931780321142132e-02   -2.526705532617741e-02   -5.343004161423634e-02   -2.626964048942989e-02   -1.060378711152351e-02   +3.886503016507470e-02   -6.740136916667362e-02   +1.554079840969624e-02   -1.708679999292091e-03   +8.951145925483586e-02   -2.182769044600250e-02   +4.837693432095763e-02   +5.672023782822532e-02; +1.612594671043130e-02   +5.631139175483170e-02   +9.132193235015902e-02   -5.587630825955968e-02   -7.998341613498787e-02   -4.529789152657462e-03   +6.345300448300097e-02   +7.706548332402353e-02   -6.161752734446009e-02   -5.309073363413824e-02   +8.704739459782911e-02   -1.198657590712290e-02   +2.900695871113747e-02   +1.021024329776407e-03   +2.320761839486044e-02   -4.930615892145881e-02; -9.380514273453984e-02   -1.896264873769139e-02   +5.280305662526462e-02   +3.797637275644506e-02   -5.203232019804281e-02   +4.507439950821415e-02   +3.175414858090005e-02   +2.210121004705639e-03   -6.277356045416115e-02   +3.202398258931341e-02   +3.278486559831849e-02   -1.736443530447034e-02   +9.789217933644306e-02   +8.185880573139219e-02   +2.022759810089854e-02   +1.871736987846627e-02; +7.162295148429898e-02   -5.094853740591990e-02   +6.676844919159661e-03   +7.692844152559136e-02   +3.090980718736826e-02   +3.595755612195122e-02   -4.438252320624572e-03   -5.496479030301463e-02   +2.401791215376840e-02   +1.911269473420239e-02   -1.925852820214953e-02   +2.395824614992339e-02   -1.438846960440797e-02   +5.394568018239236e-02   -4.204958601222527e-02   -5.306158616612785e-02; +6.150079324422565e-02   +5.654178221831353e-02   -3.193923489999949e-02   -1.809607048985806e-02   +2.353121460467063e-02   +9.803375829763729e-02   +4.234670821262583e-02   +2.184630333411581e-03   +6.543316647322528e-02   -2.057936839921368e-02   +3.773718444239098e-03   +6.517395362492039e-03   -2.205228682242278e-02   -4.667797378850978e-02   -8.670698598783735e-02   -1.025767424823276e-02; +2.749497714501554e-02   -6.312145749449140e-02   -2.891637316361621e-02   +1.023342961452654e-02   +8.057267307552320e-03   -5.280452366243372e-02   +4.449545067834091e-02   +2.478898697706942e-02   -2.305868038611274e-02   +5.126012866401337e-02   +3.004053464039837e-02   -5.809290152825268e-03   +8.534184193240856e-03   +7.958326527062853e-03   +6.930771733103137e-02   +8.210590986975982e-03; +3.108851163968199e-02   -8.843292245239670e-02   +1.264461036561815e-02   +1.502633452849591e-02   -1.743341619637839e-02   -1.050418136148096e-02   -1.649301833456770e-02   +1.931473256626398e-02   +6.557419809558826e-02   -4.852191836909944e-02   -3.238394015104689e-02   +1.018153808204525e-01   +2.779954316707465e-02   +1.037422330844309e-01   +1.503784700219824e-02   +1.713083519964003e-02; +5.702122755029018e-02   +2.201621193163244e-02   +1.319060243562709e-02   -3.021836226854335e-02   +6.687051584556659e-02   -5.026604834624795e-02   +4.330952524429935e-02   +1.405876624996100e-02   +2.775830960308408e-02   +2.962578570572754e-02   -1.346690092967533e-02   -2.713989822913909e-02   -2.081927849251480e-02   -6.409796349041856e-02   +6.899627518123091e-04   +4.026746981716460e-03; -6.022634872212072e-02   +3.780390787650707e-02   +2.207204958260507e-02   +3.539211805942172e-02   +7.279028616677252e-02   -2.825300509480761e-02   -1.880494954926109e-02   +1.738442007253054e-03   -1.134864787178256e-02   +1.127268298054670e-02   +5.195612256267208e-02   +1.532405581489299e-02   +5.009004006299157e-03   -2.438174904816311e-02   -5.251374461316351e-02   -7.367093070954391e-02; -4.184911362501675e-02   +4.543937019816335e-02   +1.931638640136431e-02   +1.445092049607726e-02   -7.666379270394158e-02   -2.966566397050227e-02   +7.122523572117517e-03   -1.246946258289083e-01   -1.876607678640880e-02   -1.827519803809304e-02   +8.439440072363184e-04   -2.547085245547343e-03   -5.655802513634402e-02   -4.272962393669354e-03   -2.143265394099353e-02   +2.456317776860469e-02];
L1E_L1I_iGABA_netcon = [-5.058333907522887e-02   +4.137480332804137e-03   -6.942640489928595e-02   +5.628219537342279e-02   +4.446645139919579e-04   -2.695295926128227e-02   -8.249802792895729e-02   +4.093560686419900e-02   +5.810071897961524e-02   +1.023627784287805e-02   +1.316036410931359e-02   +1.180202380957875e-02   -2.431085025396948e-03   +8.535435572333883e-03   -8.311361502393079e-02   -5.373676564332102e-02; +2.801906985786004e-02   +2.409557062095762e-03   -1.815952287690669e-03   +2.881255715923251e-02   +8.523738229924011e-02   -3.408971046884668e-02   -9.026177812245322e-02   -3.582452602959715e-02   +1.429038188159538e-02   -5.116635899916303e-02   -8.799662299686397e-03   +3.679687214222269e-02   +2.680561319633254e-02   +1.904490291015613e-02   -3.730460931046316e-02   -1.386194332096680e-02; +4.154123816207749e-02   +4.912753184767991e-03   -2.866594950038321e-02   +1.247104839866447e-02   -2.702959616889935e-02   +1.028432194981975e-02   -7.993227055790382e-02   +2.517225669033541e-02   -2.015410048325252e-02   -5.935040064777884e-02   +3.578070997428946e-02   -4.867678953623208e-02   +1.316701750524780e-02   -3.917936737326939e-02   +9.157878753591153e-02   -3.532066348965225e-03; -5.430354083432834e-02   +5.857014112520612e-03   +1.612877315417511e-02   -4.875427536315570e-04   +2.772205346097388e-02   -9.224765690458749e-03   +3.509539836874486e-02   -6.440985135771822e-03   +8.424693730791943e-03   +1.901904372133328e-02   +5.963791040356024e-02   +4.514576922448116e-02   -5.692383019899137e-02   -5.245071552277543e-02   +4.444423775793806e-02   -7.501050900770818e-02; -8.086922196887643e-02   +3.815029036784932e-03   +5.950046345569468e-03   +2.863096601458839e-02   +3.477091592428636e-04   -8.366679987467594e-03   +9.011699782849870e-02   +4.472283686483473e-02   +7.017448016979817e-02   +6.060275283357638e-02   -3.093149957977879e-03   -4.334995144902332e-02   +1.706559551394512e-02   +2.874271370128939e-02   -2.520648688135931e-03   +6.109102038374119e-02; +2.548509750139107e-02   +4.022393870629555e-02   +3.713506560004041e-02   -9.651151342785585e-03   +4.172433319853551e-02   -1.653520360781566e-04   +3.759666180138249e-02   -1.238067080894491e-02   -5.056263029983299e-02   -1.608556045295525e-02   -4.279598750556107e-02   +2.875365590933752e-02   +6.050312273998824e-02   +5.758473270821365e-02   +1.453077279634050e-02   -1.446159797864394e-02; +1.337673640567799e-02   -1.758505542662425e-02   -1.015960519002293e-01   +1.844448800913452e-02   -4.946728498095607e-02   +1.599210613618826e-01   +2.723752790327432e-02   +1.046490750586643e-01   -3.928048662456031e-03   +4.209293324333081e-02   +5.944713977732216e-02   -1.112748036331966e-02   +4.141315523974597e-02   -9.619112533265910e-02   -7.377376121145453e-03   +6.922958520784808e-02; +2.151307562742637e-02   +2.453657293730296e-02   -5.540201716750274e-02   -5.118580851103506e-04   -1.591842240510143e-02   -7.192692077955321e-02   -1.352593360853180e-03   +7.193524189990821e-02   -5.779827596873253e-02   -5.885379319335460e-03   -9.978874113170236e-03   -5.952535921685891e-03   -7.610538598160440e-03   -2.461808054839080e-02   +4.314033544818750e-02   +9.290080166634275e-02; -4.025718561723904e-02   -6.081390251593592e-02   +2.625778839883477e-02   +4.915851469863918e-02   +4.803763346457672e-02   -6.969213333542139e-02   +2.299447479859763e-02   -2.926959483640310e-02   -4.961543937352627e-02   -5.515473846757049e-02   -5.103414382548051e-02   +2.016097453156832e-02   +1.917925963118320e-03   +2.809259846679744e-02   +2.655671883504125e-02   +3.460696047772416e-02; -2.799978508556352e-02   +1.730259991045570e-02   -1.575360446595778e-02   +1.088761266322774e-01   -4.565341527535176e-02   +8.659770625124708e-02   -6.464792638487463e-02   +5.825771503650280e-02   -6.386718812249337e-02   -4.702705495177595e-02   -7.840454989003955e-02   -4.386615839739823e-03   -6.540542699089685e-03   +5.049735466773571e-02   +1.618198103063538e-02   -6.677462937115852e-02; -2.364950350857382e-02   -5.641415547790023e-02   +1.604635114323291e-02   -2.798261341907748e-02   -2.961007330931972e-02   -5.716522297374367e-02   -4.271472499432431e-03   -9.194866289189767e-02   +3.376660154847184e-03   +4.964148108643576e-04   -1.600621465832507e-02   -5.141628931042851e-02   +3.565943023341896e-02   +3.979410077582848e-02   -6.503936813614673e-02   -2.195322639627476e-02; -5.921838466788843e-03   +6.157391098142272e-02   -1.446935403035833e-02   -5.204581966531276e-02   +1.068162360985805e-02   -2.725433759721683e-02   -2.241646035691658e-02   -1.446069163365909e-02   +5.820562147967228e-02   +3.521173119346672e-02   -6.186146389542848e-02   -4.096284212677370e-02   +5.891447917712846e-02   -4.783323302378378e-02   -5.724081719356548e-02   -2.205970508740000e-02; +5.651487437966019e-02   +2.512018782486218e-02   -9.477309599826430e-03   +1.567506906356899e-02   +3.355098859656327e-02   +9.355683035267921e-02   +1.259160762618947e-02   +5.593141683255086e-03   -2.899185842619996e-02   -3.666768297164619e-02   -2.742785075440304e-02   +6.810779629622675e-02   -4.269605402641127e-02   -5.750461960510685e-02   -5.552034097090154e-02   +4.240320400934455e-03; +4.003602228610871e-02   -1.828165309128416e-02   -4.346551818033930e-03   -6.864584618371678e-03   -7.153958857162411e-03   +3.226354342446733e-03   +1.998725541909283e-02   -3.963919055164124e-02   +8.674178356273018e-02   +5.207808505688957e-02   -3.558636903307421e-02   +3.607351158649046e-02   +4.284547476412506e-03   +3.871445426525968e-02   +1.803545068240801e-02   +3.844362449606818e-02; -1.046626116825680e-01   -3.892592481392810e-02   -5.515914629268702e-02   -4.242919466523439e-03   +2.065522513467610e-02   +2.556084514789516e-02   +1.672141932379810e-02   -3.538804010648015e-02   +8.137511167472146e-02   +5.467120055276904e-02   +4.695027582187226e-02   -1.109279280872140e-02   +4.395208129396722e-02   -5.775531773583457e-02   +2.351198299245598e-02   -1.159958942257360e-01; +1.680298539312160e-02   +9.073431625100496e-02   +5.401467554140973e-02   -4.929029300520926e-02   +2.953939915054956e-02   -9.550020875260269e-02   -1.028235653548971e-02   -2.348281786846427e-02   -2.760965445322714e-02   +2.151012998951569e-02   -2.921729357390671e-02   -9.233855520876071e-02   +2.398849478829232e-02   +6.678274983349293e-02   -4.278436149113652e-03   -7.764350852130175e-03];
L2I_L1I_iGABA_netcon = [-2.474049855671477e-02   -1.031829290511024e-02   +1.305945467084907e-02   -6.058017653464086e-02   -8.136453299090915e-02   +2.482992787796035e-02   +2.259935694580919e-02   -4.586770463615347e-02; -4.880917865433111e-02   -2.101286311701257e-02   -5.731263928916736e-02   +1.113040741025292e-02   -2.239468401612239e-02   -9.304008239745216e-03   +1.221749134666524e-02   +1.660199229046486e-02; -7.412413893657117e-04   -1.375066487815446e-02   -9.229740035766025e-02   -1.199757635192484e-02   +8.322128430331513e-02   -4.307329788657487e-02   +6.832805147537410e-03   -7.229704306838031e-02; -5.396634012346341e-02   +5.668222460869222e-02   -1.209340953967358e-01   +5.407952191377588e-02   +5.360752006731596e-02   +2.871933507651517e-02   +3.133807330498226e-02   +6.355471692948877e-03; +7.636065866949654e-03   +6.358726941927207e-03   -3.834137878843737e-02   +6.611799486311422e-02   +1.754864344878124e-02   -3.385974339017042e-02   -2.906126159363735e-02   +1.136273602103696e-02; +1.596895248196311e-02   +6.205498895010237e-02   +3.467323741697012e-02   +1.004751349057822e-02   +1.464105311712612e-02   +2.365022066397684e-02   -8.682824606537894e-02   -1.049094604766630e-02; -4.326902800467593e-02   +5.369381327667830e-02   -3.311855718049951e-02   +6.503283525769675e-02   +2.556590863709628e-02   +3.096330172042190e-02   +6.012808598380688e-03   +6.098078023549684e-02; +1.332473726737190e-02   -5.278829632251854e-02   -4.882734500444267e-02   -8.855126103985179e-04   +1.260338356256744e-02   +3.993171190813597e-02   -3.829396335708394e-02   +5.456392224908464e-02; -7.463509375204591e-02   -4.809691001726276e-03   +6.613990670561207e-02   +6.179444860289406e-02   -2.724472958603224e-02   +5.255851141923666e-02   +7.299217072977693e-02   +8.188493514804643e-02; +1.198718692186438e-02   -1.591022135491380e-02   +1.213065930125672e-03   -2.621433954763008e-02   -2.293050506868849e-02   +3.616234721005075e-02   -2.284892835538482e-02   -6.837352531961800e-02; +1.677959211919881e-02   +4.912491702926804e-02   +3.887530970300269e-02   +4.917935486822764e-02   -9.156854527224560e-02   -1.038950931584633e-01   -3.802970664826936e-03   +5.647657581247517e-02; -4.587957779178645e-03   +2.058845159744983e-02   -1.386752400213540e-02   +5.023640543431028e-02   -8.675713897119118e-02   +8.549115439574666e-03   -2.331935973363065e-02   +4.283090446097557e-02; +1.449145429644885e-02   +5.052875722453468e-02   +6.628176638767136e-04   -2.167498827531360e-02   +3.151549452188954e-02   +7.689041310181163e-02   +1.982932892279696e-02   +2.940843857277935e-04; +6.995850915761107e-02   +5.757760205015174e-03   +1.547960786427705e-02   +5.965426405153602e-02   -1.396688739623434e-02   +4.443185832695699e-02   -1.011152154395581e-02   +2.486970696057059e-02; -1.434881022373070e-02   -5.060343579123269e-02   +3.817630321847840e-02   -2.782098084791389e-02   -1.009359351459639e-02   +3.949404670093518e-02   -8.546087660959607e-02   -1.416762846714339e-02; -1.080418625456869e-02   +1.959544159871730e-02   -3.405607752264239e-02   -9.176016098654527e-02   -9.606948481325950e-03   +2.145486743258555e-02   -2.994419167688437e-02   -3.706376347826155e-02];
L1I_L2I_iGABA_netcon = [-5.672039111063235e-02   +1.648917247114301e-03   +1.349375537905520e-02   -1.079853559157100e-02   -1.030070959579160e-01   +3.202611441909294e-02   +2.956573931058709e-02   +4.575349370992331e-02   +4.314355545626327e-02   +2.667954331120386e-03   -2.481231925813620e-04   +4.223225616979891e-02   +7.067407802479590e-03   +3.812631420561383e-02   -2.276186715618208e-02   +3.770538540551494e-02; -6.167638662392943e-02   +4.468916752609612e-02   +2.335148839380253e-02   +3.942930138714733e-02   -4.154977459290376e-02   -3.910432625709997e-02   -3.365761207531492e-02   +5.562682421768889e-02   +3.467928743162158e-03   +7.513829777511405e-02   -4.710352190282147e-02   -9.563973745213031e-02   +6.123444433764114e-02   -1.926366592197492e-02   -7.534674663368657e-03   +2.764653953400787e-02; -3.833955626910421e-02   +5.639094209827382e-03   -5.783541243117746e-02   -3.974134342443032e-02   -1.214844422518364e-02   +6.594614534577750e-02   -2.815611361121242e-03   -3.707313235098378e-02   +1.272929304546530e-02   -2.755559341177313e-02   -4.492386962401151e-02   +7.194907825815203e-02   -2.305649194592219e-02   +5.480792821378101e-02   -4.248734374139589e-02   -3.133931243501516e-02; -1.972402836723092e-02   -3.194597732271270e-02   +3.860234842581779e-04   +2.976512106830816e-02   -4.651074018673726e-02   +3.880534542396658e-02   -5.139597502819299e-02   -3.672639821982532e-02   -8.456230901029581e-02   +8.651220252540585e-03   -2.976386975287210e-02   +2.516060572498446e-02   -3.228032291971780e-02   +2.066429637393111e-02   +5.105947970079869e-02   -6.110681712327119e-02; +2.044301571982053e-02   -4.757897247194801e-02   +3.790068915980188e-02   -3.694540580846557e-02   +6.606638140684711e-02   +7.434686400816641e-02   +6.225493014003286e-02   -4.512635160187874e-02   +5.676034432522258e-02   -1.492348557640177e-02   -1.642710910079729e-02   -3.878175693768591e-02   -2.531115713646965e-02   +6.884862526432287e-02   +2.354734301488743e-02   +1.632058967613123e-02; -4.628922013254646e-02   +3.203431169259906e-02   +1.711348195388569e-02   +4.268733866552599e-02   -3.476634433636585e-02   +6.337897886928975e-02   +6.886796416482066e-03   +3.541874699793392e-02   +1.058224545212141e-02   +2.299778990406486e-02   +1.896678404148671e-03   -2.149869798928235e-04   +1.436462276553704e-02   -1.709218538979351e-02   -2.853840920246590e-02   -9.958776194329336e-02; +1.043383679684556e-02   +4.716934936168034e-02   +4.180780327827951e-02   -6.751900984489410e-02   +7.958621400729399e-02   +9.638263840468420e-02   +1.368751550541816e-02   +2.095884817806332e-02   -2.071317284475519e-02   -1.545201698155309e-01   -2.811431566053030e-03   +7.614797084524794e-02   +7.285722236581360e-02   +4.681177105253261e-02   -1.836886008434308e-02   +2.021307444964582e-02; +6.078215146143012e-02   -6.870082785130366e-02   +4.757733223342888e-03   +3.504336270566560e-02   -3.874278861165110e-02   -7.514319814506605e-02   -2.131103597323458e-02   +2.360527621819990e-02   +4.479111982361465e-02   +9.297629491929558e-03   -2.098080985040816e-02   +2.060001576979394e-02   -3.144204479493232e-02   +4.495538098609921e-03   -4.933429166322736e-03   -8.246437823883557e-02];
L2E_L1E_iAMPA_netcon = [-6.765066066986174e-02   +3.647728364148142e-02   +1.906620469977204e-02   +2.521006493046323e-02   -4.537379287254976e-02   -6.985142704361333e-02   -2.302328381588459e-03   -4.839134827418115e-02; +1.416114083482608e-02   +1.474999914152895e-02   -3.472737264608079e-02   -1.633668620757005e-02   -4.031632648735446e-02   -2.802335004184705e-02   +1.688777253390799e-02   +4.275031546372234e-02; +1.054297049017968e-02   -1.132624049965997e-01   -7.542035267628772e-02   -1.685894226620711e-02   +2.701689346155702e-02   -1.016558317011596e-02   +6.615220368361005e-02   +5.519860422740497e-02; +5.115820344137521e-03   +1.561169852632420e-02   +7.593112477911892e-02   +3.683398876585526e-03   +4.599892259244252e-02   +3.947348651087482e-02   +6.899584005880838e-02   +6.463737192664873e-03; +5.493507380385063e-02   +3.421957517532675e-02   -1.362038273266363e-02   -2.076331221410358e-02   -4.668598860602272e-02   -9.044145799780409e-03   -2.785059144472158e-02   +8.938318901142366e-03; +6.243578249641044e-02   -4.143981783668908e-02   -2.016671104075077e-02   -5.453429290117570e-03   -5.321084512610405e-02   +2.751722047459577e-02   -4.115367977347412e-02   +1.277209205756060e-01; +4.931938545432761e-02   +5.619619965366057e-03   -4.690562183241846e-02   +4.534668151014332e-03   -2.218484868285774e-02   -6.408943732259966e-03   -3.711221663635791e-02   +2.473777867727403e-02; +5.398865017764655e-02   +3.269634015461474e-02   -4.307046213025871e-02   +3.207146420835914e-02   +1.928288215034370e-02   +3.068662235419187e-02   -1.125988568391518e-02   +2.954091318182477e-02; +9.513327308254653e-03   -5.078918459445440e-02   +1.298169636461098e-02   -4.158107652397974e-03   -8.868931277220084e-03   -2.961482218511190e-02   +7.132430572363804e-02   -1.063689496181913e-01; +8.351442476204229e-02   -6.339423309264598e-02   +1.875398561545131e-02   -1.173721084440534e-02   -1.970538222044593e-02   +1.839346390084458e-02   -3.593611014726478e-02   -2.896457915851253e-02; -3.244736351007012e-02   +3.358762018129253e-03   -2.258164885631877e-02   -5.971206415359592e-02   +7.044852117995327e-02   -1.444017752670538e-02   -9.038508486273501e-05   +1.771094379370120e-02; +1.137482968794258e-03   -5.454430789887250e-02   -4.906353357688856e-02   -1.053976097513248e-01   -6.621427259020600e-02   -4.826660169006524e-02   -4.068518371789772e-02   -2.807808844041550e-02; +3.651586782147424e-02   +4.244000667260592e-02   +5.280512215376043e-02   -3.793463420580180e-02   -4.676170900502468e-02   +2.797367634185758e-02   +1.081174148116467e-02   +3.355013811025161e-02; -5.475498407009376e-02   -1.388270499638808e-02   +1.137620272489123e-02   +1.440689382886845e-02   -3.933821931628170e-02   +5.085956998727477e-02   +5.625738049952873e-03   -3.141905448385903e-02; -1.862148760481096e-02   +3.136095549370482e-02   +1.057865902984389e-01   +3.492943060133152e-02   -1.514265635087690e-02   -1.319779912560586e-02   +5.120224982384199e-02   +1.337735741052791e-02; -4.044613631423712e-02   +3.796496578363320e-02   -1.271509311121937e-02   +1.669996533010152e-02   +3.054742419177366e-03   +3.246820306838558e-02   +1.494888643022140e-02   -8.067996601935296e-02];
L1E_L2E_iAMPA_netcon = [+3.858443566587756e-02   -4.011224366622867e-03   +2.480426380598800e-03   +2.085113774619156e-02   -1.999946306421905e-02   +3.585050570764893e-02   +1.850175940733175e-02   +4.939640697475036e-02   -7.691282603425857e-02   -2.315110466041794e-02   +7.920979679387015e-02   -3.667537138330590e-02   -2.586391029879035e-02   -3.591945912490899e-02   +4.536594765710678e-02   -1.561295508341155e-02; -1.070256841693387e-02   -5.108747109291360e-02   -5.318923242250893e-02   +9.196661862443686e-02   +4.047180081111014e-02   -7.754765749832617e-03   -4.560367466763823e-03   +1.700140504507087e-02   +6.220953172471153e-02   -4.160619846675669e-02   -2.518070912785252e-02   -3.983584088826485e-02   -1.033986751681958e-02   +9.126101737812059e-04   -1.513035583957159e-02   -4.053445346663848e-02; -2.603501737976589e-02   +3.117874938641488e-02   +9.621922237035398e-02   -6.746903918510353e-03   +1.618123414865019e-02   +1.510357828187535e-03   -1.972341804930534e-02   -1.540648051721337e-02   -5.106839325213024e-02   -4.842943934794883e-02   +3.008097387124976e-02   -6.886588980811660e-02   -2.561877396443554e-02   +1.127706060993690e-01   -4.162444132480306e-03   -1.634098312581744e-02; -1.333884686937847e-02   +5.947146159009622e-03   -5.617485236066062e-02   +2.143079474403830e-02   +5.977637086027707e-03   -3.728405480991979e-02   -6.672975357129146e-02   -2.486939544655349e-03   +1.974799026205833e-02   -4.987643052705014e-02   +2.398933984247865e-02   +3.904973901781100e-03   +1.399142486728156e-02   +5.175085602483115e-02   -2.444460704461223e-02   +3.889085282549428e-02; +4.808899624468505e-02   -5.861073722288815e-02   +4.390517503110378e-02   -4.342355465543375e-02   +2.226056288424715e-02   -2.169234279049061e-03   +4.608481929950968e-03   +3.149780834082605e-02   +2.154622500109416e-02   +1.749281739459471e-03   +6.966149746079297e-03   -1.815148973663297e-02   -4.891635171300680e-02   -3.474300250908661e-02   +4.537135102462383e-02   +2.805374796745778e-02; +5.632084590951753e-02   -3.340570367544113e-02   +1.618279750235661e-02   +6.916401261846544e-02   -1.267255862302506e-03   +6.779836778126701e-02   +1.768053395413438e-02   +2.871035427068355e-02   -9.543962018659813e-02   -8.579940720503646e-03   -2.939857049324232e-02   +7.055767758401188e-02   +3.087759755710861e-02   +5.061982342368622e-02   +7.893239536903879e-02   +1.408080269449070e-02; -5.525464641026497e-03   +6.444966357387077e-02   +5.768876592551618e-02   -3.677093243311947e-02   -4.465459959123355e-02   +2.487031041887137e-02   -8.682202643061274e-03   +1.464122386457406e-02   +2.503520143999075e-02   +6.155254682812715e-03   +7.165756398597881e-02   -3.421549146366685e-02   +4.495661824544756e-02   +7.131642882464675e-02   -4.931164428172315e-03   -3.521379593500423e-02; -2.015432585714757e-02   -9.572127700522286e-03   +2.366819167642580e-02   -4.505309854800018e-03   +4.006352026602227e-02   +2.128884921759178e-02   +5.523402714134550e-02   -2.763760455049084e-03   +6.331074357425604e-03   +2.115477172935992e-02   +3.126315234264600e-02   +2.631475284751491e-02   +3.482099438936214e-02   -2.174061400244761e-02   -6.791002501108978e-02   +5.422501301829197e-02];
L2I_L2E_iAMPA_netcon = [+4.392685652816284e-02   -5.658111236998718e-02   -5.225926734809939e-03   -6.785420693836147e-02   +7.006460994876063e-02   +1.203762902623057e-02   +8.270944127028163e-03   -7.319606462312926e-02; -4.899677691056035e-02   -4.911697909253446e-02   -7.055846083960038e-02   +1.198664641505858e-01   +1.319928545671065e-02   -8.986797797671385e-03   -6.384597310493330e-02   +1.030651705317948e-02; -3.434601429389741e-02   +4.870341111732512e-02   -4.104464758040748e-02   +3.294464420780323e-02   -6.666981688443083e-02   -7.342506552611013e-03   +5.431136048449527e-02   -1.126310962442632e-01; +8.432725742084199e-02   -3.197971786916670e-02   +3.152231030305049e-02   +6.313127280218045e-02   -1.026041402058214e-01   +5.491971872047598e-02   -3.369794269591053e-02   -5.055140803589150e-02; -2.670468230356684e-03   +4.904552535002961e-02   +9.727321592983448e-03   -1.504744375290557e-02   +2.230702930654552e-02   +7.688319725763947e-02   +8.089079220002207e-02   +6.620260163774519e-02; -3.536920325495632e-02   -3.783812872367644e-02   -2.397955667792649e-02   +2.020354568447221e-02   +3.965826947456734e-02   -3.352580215916184e-02   -1.393498802558185e-01   -8.235652735755033e-03; -1.104920660197020e-02   -8.671555137938347e-03   -2.515899250793078e-02   -6.653483359945575e-03   -7.219187313585093e-02   +4.362612475786592e-02   -5.286199286760002e-02   +1.776731260217587e-02; -2.644668032811528e-02   -4.013044698146927e-02   +6.843053599547710e-02   -2.051489302633450e-02   +6.066756372699152e-02   -5.244386577300526e-04   -1.822897179163485e-02   +2.578587304228092e-02];
L2E_L2I_iGABA_netcon = [+5.631845354669612e-02   -2.641810057337995e-02   +5.715650548664188e-02   -1.477381100606481e-03   +3.489794178729889e-02   -6.753366485022129e-02   +1.691756901731053e-02   +2.198208246807825e-02; +3.139865939312836e-02   -6.195741419915699e-02   +4.191505188308103e-02   +4.949085914266051e-02   +1.047564644492417e-02   -3.343705430528120e-02   -4.703203641133960e-02   +1.584450617005403e-02; -5.805824664718193e-02   +5.241449437385701e-02   -2.819249348338303e-02   +4.783574482304438e-02   +5.005944197168532e-02   -4.746848692606941e-02   +5.936808108833302e-02   -3.003436806212240e-02; +2.060992584302646e-02   +2.914165662042178e-03   +4.471070388978012e-02   -5.779746589943734e-02   +1.707150802405686e-02   -2.457752300597967e-03   +7.203503258728029e-02   +1.148192379721364e-02; -1.226550461847658e-02   -4.288744942055273e-02   -3.851819895517232e-02   -2.487168117903083e-02   -6.407668156268481e-02   -3.352832589544065e-03   -4.083941807860387e-03   -3.594716124797797e-02; +1.816674005085105e-02   -5.187286271457007e-02   +4.180067289354155e-02   +4.054173631975949e-02   -3.736457082813115e-02   +5.860003038427292e-02   -9.984240885238971e-03   +5.391165513876882e-02; +2.785176770811403e-02   -2.379528695426728e-02   +2.159798931415139e-02   +1.056057331007037e-01   +4.543561857406039e-02   +4.013679278518913e-02   +4.620975529715233e-02   +5.835356166817034e-02; -1.474738118651153e-02   +1.003794280043474e-01   -3.684574855980031e-02   +8.164210546532658e-03   -5.453409843904317e-02   +6.995659573882328e-03   -1.418511989986278e-02   -1.657565805733821e-02];
L3E_L2E_iAMPA_netcon = [-3.597286098981910e-02   -3.351760568402806e-03   +6.056084037002708e-03   -5.937376438098717e-03   +1.705196694369644e-02   -6.716716721374201e-03   -4.972636184404326e-02   -4.094169813090978e-02   -4.695186807850864e-03   +1.608555125864948e-03   +3.176447506949921e-02   +1.368387100048861e-02; -9.894297070214178e-02   +4.860585176558845e-03   -6.535474695014250e-03   +3.294989139717812e-03   +5.371637704717218e-02   -6.626346556731262e-02   -4.381844798200146e-02   -1.583801412471588e-02   +5.538291867453674e-02   -6.156237372840340e-03   +4.591618406136833e-04   -5.061875304650384e-02; +2.193558560480507e-02   -7.459840262732577e-02   -1.119656019030928e-01   +1.374527930440904e-02   +6.036791527392739e-02   +6.244209683602876e-02   +4.454427308531531e-04   -9.582389349519060e-02   -2.873446217099602e-02   -2.968932502656545e-02   -6.015334692288768e-02   +2.204712347882630e-02; -1.887848513647469e-02   -5.179619855357009e-02   +2.909527178672274e-02   +2.582009929641401e-02   +1.972015044655282e-02   +5.031624931705287e-02   +3.710558302775536e-03   +7.889569134119868e-02   +9.966097171716938e-03   +4.014117026123613e-02   +2.706859924849119e-02   +2.601871611802618e-02; +5.407035772681255e-02   +5.039187179573384e-02   -3.845578811150158e-02   +8.879852837828932e-03   -3.250655283787487e-02   -2.440479843671272e-02   +1.060252920142649e-03   -5.880250308465002e-03   -7.775086056326791e-04   +6.802872292177639e-02   -1.412941636988529e-03   -4.463862968061570e-02; -7.111263024021493e-02   +1.817286691000979e-02   +3.171345654367559e-02   +1.655098902018975e-02   +2.642002060063148e-03   +7.384241831113877e-02   +2.606996613770642e-03   +3.589009977531984e-03   +1.862064796896901e-03   +6.203975329334256e-02   +6.782362019727281e-02   +4.029282762568063e-03; -5.906217516970143e-02   -4.089782830490407e-02   -4.368173132251812e-02   -3.491114131446488e-02   -3.656322824612044e-03   -4.179124713886024e-02   +5.908288047751105e-03   +1.508202238492605e-02   -3.853319227919638e-02   +3.461027860276925e-02   -2.130959222451217e-02   +2.137107030253664e-02; -4.433454321246449e-02   -5.217939091326684e-03   -4.804185255581338e-02   +5.814710192369946e-02   -7.172215936120390e-03   -5.219624092155057e-02   +1.446924415011630e-02   +8.907766614907858e-02   +2.629449701918232e-02   -9.162618396394038e-03   +4.692677831770294e-03   -9.838997908561536e-02];
L3I_L2I_iGABA_netcon = [-2.954571221998738e-02   -1.557081338336366e-02   +1.048990837250396e-01   +3.059836514035758e-03   -1.253830775892187e-02   +3.629139685642133e-02   -2.513730523502170e-03   -2.182287789144383e-03   -4.135600650988264e-02   -4.408222965978914e-02   -6.357906706924979e-03   -3.909261538131541e-02; +3.849152710497294e-02   +5.022226138873605e-02   +2.340590779832387e-02   -2.930710339618170e-02   -7.986836530044429e-03   +1.142388844699462e-02   -2.468249081036101e-02   -3.614477077091892e-02   +3.174171876434403e-02   +4.164091190839844e-02   +1.650968014704249e-02   +5.559094085540122e-03; -2.445331977069608e-02   -1.205288475631417e-01   +7.392006839779280e-02   +3.797783443807248e-02   -3.583727290556559e-03   +2.673200856856728e-02   -1.510458244605364e-02   -8.505505309145935e-03   +3.816623411526117e-02   -1.048683073363573e-02   +1.809864970317998e-02   +3.155926148930278e-02; +2.204862315064816e-02   +2.946287221426565e-02   +1.947870196655392e-02   +2.542543118994966e-03   +5.290201606553740e-02   -2.146112990038042e-02   +1.044723933215203e-02   +5.288441016990644e-02   -2.411012231218123e-02   -4.043576519615134e-02   +2.642194066781690e-02   -3.039186444616133e-02; +7.287218008276518e-02   +1.861430628624146e-03   +3.053936048485961e-02   +1.121961960165955e-02   +1.701365973759877e-02   +5.050226756835514e-02   -2.269730412419431e-02   +6.057468738205724e-03   -5.300170158205381e-02   -2.507409570679495e-02   +3.256663914424468e-02   +2.375818110797424e-02; -3.918851400036910e-02   -3.820216265926815e-02   -4.126259722802041e-02   -1.861075297265196e-02   -3.095220020736828e-02   -9.435168635599256e-02   +1.586682391055079e-02   +5.789055710703882e-04   -1.054820923503028e-01   +1.482193950327423e-02   -1.287531027384551e-02   +2.343566218055779e-02; +2.689850806042088e-02   +8.961505386938717e-03   -1.713028586018636e-02   +3.753273680422430e-03   -4.496590044129024e-02   +6.157154819282046e-03   -2.250487429738788e-02   -3.665364936208693e-02   -5.144456160216384e-02   -1.340276505124081e-02   -8.767818684929714e-03   +1.807640801274438e-02; -5.211224992634756e-02   +4.060635921257321e-02   -4.767422813923039e-03   +3.524970443428672e-03   +1.274317822166816e-02   +2.138630893920683e-02   -9.552187369087190e-03   +2.032393331829767e-02   -3.509569863720424e-02   -3.629748321907438e-02   +1.035797167002337e-01   +1.041777636204763e-02];
L2E_L3E_iAMPA_netcon = [+4.505242075642313e-02   -2.788094768701965e-02   -4.692736684178675e-02   -6.863403734665910e-03   +1.379063933795884e-02   -1.296391818857906e-02   -4.114962391333413e-02   -1.394155456887935e-02; +8.350873953675490e-02   -6.211402034781639e-03   +2.939459682767729e-02   +1.107204105285875e-02   +1.338428219477480e-03   -7.481370183990840e-02   -3.487008951229266e-02   +9.581719153188346e-02; -2.537870853861251e-02   +3.662894245474691e-02   +3.478499870425621e-02   -1.634852131161369e-03   +4.014552010465281e-02   -5.689345061228116e-03   +1.461002739067706e-02   +1.020083565486874e-02; +8.400927170261685e-02   +8.165549883126222e-02   +1.780351363030649e-02   +3.472520151706049e-02   +3.295238415577571e-02   -4.608329760241823e-02   -8.299572106967249e-05   -3.282463587982693e-02; -7.428733456880286e-02   -3.174696105734252e-03   -2.020624945701290e-02   -5.324801620504185e-02   -3.830936916301141e-02   -3.185301808524071e-02   -1.065369011660062e-01   +2.446554664853740e-02; +3.897994603881898e-02   -6.126992016241866e-02   -3.065275346534551e-03   +4.367309593810009e-02   +2.468736079965832e-02   -3.168076364172554e-02   -6.734549087591413e-02   +2.860911786280851e-02; +2.719328088566222e-02   -1.956650635757683e-02   +3.652990942510936e-02   +6.336259705439282e-02   -2.642979459707186e-02   -1.921357579458651e-02   -2.772360133760632e-02   -7.288361256129373e-03; -3.670544976056168e-02   -2.784154975653628e-02   +2.922414654513456e-02   +4.358522161903032e-02   +7.856354914927141e-02   -2.180590730487396e-02   -1.279914524603514e-02   -1.084279899640454e-02; +4.795362786442234e-02   -3.303931247773405e-02   -8.167031863023951e-03   +3.576377759712243e-02   +3.297457980460989e-02   +3.282004190732284e-02   +1.874321803002699e-02   -3.163435769320112e-02; -6.479878139004105e-03   -3.490071656012840e-02   +1.595179194743931e-03   -8.379375898740662e-04   -3.850668675371356e-02   -8.824301032732282e-03   -1.293999537814524e-02   +6.503234824749202e-02; -1.608708465180197e-02   -8.079854550765663e-03   -5.678415519771980e-02   +3.709546630083611e-02   +3.249213356638872e-02   +1.028904905868889e-02   -5.571290316552446e-02   -3.928113468144893e-02; -2.919252841106149e-02   +4.043316614083585e-02   -4.104898163420319e-02   +2.365168738027610e-02   -2.014609994442675e-02   -3.627759260939312e-02   +2.059866216811818e-02   -1.080817914612261e-01];
L2I_L3I_iGABA_netcon = [-6.166919988891784e-03   +4.639044422171092e-03   +4.125800162985294e-02   -4.837775434102312e-02   -3.806165428182792e-02   +3.677159879095362e-02   +7.412375717083419e-02   +1.875841067234920e-02; -5.452832789386208e-02   -3.715771168334209e-03   -2.778623610038253e-02   -6.451399104562740e-03   -1.070967357943706e-01   -1.198727860106365e-02   +9.359902732745151e-02   -4.591683163573464e-02; +8.378388397914055e-02   +1.840275056255586e-02   -2.914064813651098e-02   -4.125665740276720e-02   -6.216710455488224e-04   +3.986089609711617e-02   +6.068322702543744e-02   +6.022589022596489e-02; -3.046977632205758e-02   +2.646020057539801e-02   -3.187812557981783e-02   -9.569286908222632e-03   -1.068005929526982e-02   -1.471509472621406e-02   +9.966765589789796e-03   -9.321356177011896e-02; -1.287115210173852e-02   +2.200808278044086e-02   -6.755876837361217e-02   +2.379711098534484e-02   +4.790518845511205e-02   +3.493900371126332e-02   +2.963441813530112e-02   +3.122321367076301e-03; +2.712831804812995e-03   +9.355160990018227e-03   -5.187967436988290e-02   +2.722650793184919e-03   +2.099792796483361e-02   +1.014131115465625e-01   +6.556301131362863e-02   -2.920763203199704e-02; -2.984337991447469e-02   +7.684439284338911e-02   +2.796147539272510e-02   -3.508704862416418e-02   +3.822801394258426e-03   -6.108544392649116e-02   -1.123875023433788e-02   -1.249756945322223e-02; -3.064688802751600e-02   -7.356453561113216e-03   -4.302888955674463e-02   +4.003423808873387e-04   -3.608097393217577e-03   +5.761178971451040e-02   -2.376143963656442e-02   -7.599279729321907e-02; +5.719189478268548e-02   +5.550945932475562e-02   -1.086366949685970e-02   +3.406036625539333e-02   +1.770858445928707e-02   -6.181910492157314e-03   +3.248183708250080e-02   -1.740393661488816e-02; -5.153659577595476e-03   +5.675556345775544e-03   -3.914668693527443e-04   +2.961123180127016e-02   +1.490496043233945e-02   -6.626837078301862e-02   -6.576110896691312e-02   +4.471005173193898e-02; -6.024069980551855e-02   +4.043907465633054e-02   +1.331378599093703e-02   +2.632889926430108e-02   +4.215958012895142e-02   +6.080433300375109e-02   -3.234763493998450e-03   +2.756371540529750e-03; -7.577649341639059e-02   +9.376095275156940e-02   +1.573279581847840e-02   +1.214863138228774e-01   +3.454808453400868e-02   -2.084406928967817e-02   -2.795955805421279e-02   -3.297710003130835e-02];
L3I_L3E_iAMPA_netcon = [+6.974939591383988e-02   -2.684842130732472e-03   +1.525136572216195e-01   +4.938306449238487e-02   +1.890700592413810e-02   +5.889920944866449e-02   -1.052428571722155e-01   -2.151238129309077e-03   -3.814017713204761e-02   +3.672636027461799e-02   +7.824033758090654e-03   +8.100551120412703e-03; +1.248339934864134e-02   -3.078792724846909e-02   +5.027551418931071e-02   -2.856864146612749e-02   +1.049383593947319e-02   -1.060792559277020e-01   +5.407241940990136e-02   +3.890238089411706e-02   +1.629209304253879e-02   +4.087192638687460e-02   -4.034181785790557e-02   +1.092513309128743e-02; +3.599355147486197e-02   -4.344804494406086e-03   -6.370759707006511e-02   -1.289269151013581e-02   -1.639912546477708e-02   -1.579849322197280e-02   +1.573717352735117e-02   +6.993683288799697e-02   -3.627300178547822e-02   -5.407817834206909e-02   -4.896388320516983e-03   +4.400031064966140e-02; +1.999471348216959e-02   +2.781777577385027e-02   +2.648556773314840e-02   -3.349377801604031e-02   -1.685024055704655e-02   +2.228418271831527e-02   +1.241816273250154e-02   -1.686368274337249e-03   +1.441800391471767e-02   +5.749175811892663e-03   -5.497393533392776e-02   +4.114943861133495e-02; +3.425704701598907e-02   -9.587179665346686e-02   -1.483526475614875e-02   -9.535582205838966e-02   -3.777981622948730e-03   -3.640353870525136e-02   +1.797792712280098e-02   +5.015505183581150e-02   -9.334215469991898e-02   -2.429056201962477e-02   -4.321681015324731e-02   -1.005894949213297e-02; -7.548870486319849e-03   +8.747545175751145e-03   +5.898824213004603e-02   +2.469625831682980e-02   -1.247900903016130e-02   +7.115771705235940e-02   -1.129096719808944e-02   +1.337146220819786e-03   -1.747102875390495e-02   +5.374186609543353e-02   +6.531694055051578e-02   +8.611590090226849e-03; +4.098650952676780e-02   -9.616109458257506e-03   -2.739063096038956e-02   +3.464789377757888e-02   +1.683551296631725e-03   +6.008673796635243e-03   +1.971214156359106e-02   +3.962320164965562e-02   -1.734872119525385e-02   +3.446201115926942e-03   -7.676128219850392e-03   +2.285073541693027e-02; -6.739556884965199e-02   +2.314017371432274e-02   +7.437280598674115e-02   -3.688146996130133e-03   +3.355363082665146e-02   +1.802951234876404e-02   +2.774964812949559e-03   +7.711915955539134e-02   -5.706561980686442e-03   -3.035255096421376e-02   +5.650721288657855e-02   +8.211488601201258e-03; +2.642357900573379e-02   -1.317536673054105e-02   +1.016263342015309e-01   -9.435899418756893e-02   -1.041726719028822e-03   +2.013496124797128e-04   +1.428394374997856e-03   -7.244196575628862e-03   -3.956490283865684e-02   +3.688878968742759e-02   -4.676350272010706e-02   -4.053424392350734e-02; +1.682989330708936e-02   -2.924040946004393e-02   -4.773357464426804e-02   +8.978710704138557e-02   -4.881472259004783e-02   -2.757226178375370e-02   -9.320281971034104e-03   -6.808397547899473e-03   +3.350932675760528e-02   +4.168462843471949e-02   +6.844283417588495e-02   -2.767859310149558e-02; +1.452971488546493e-02   +7.938278960114116e-02   -1.108911041574671e-01   -8.457588186522717e-02   +5.481251756271140e-02   -4.409756078252506e-02   -5.379931493772726e-02   +2.063243478958947e-02   +3.168618431210506e-02   -3.802517054680070e-02   +5.383645892075381e-02   +6.636502105274281e-02; -3.080077357348182e-02   +1.103228334076296e-01   +2.541504480649802e-02   +2.843474586215451e-02   +8.039468776851766e-02   -8.532852985985889e-02   +2.944085610766085e-02   -1.305197472858018e-03   -3.193017770039643e-02   +1.001095575164013e-01   +5.115930404767730e-02   +4.805900027705371e-03];
L3E_L3I_iGABA_netcon = [-5.831537773380965e-02   +3.584931292544875e-02   +1.241081497193059e-03   -2.964881444642249e-02   -4.866144952181285e-02   -2.705083071111145e-02   +2.917092237675420e-02   -3.153529471198858e-02   +1.835588703779447e-03   -2.502997159610471e-02   -8.963184727064914e-03   +1.695318594342603e-02; +4.417057871586594e-02   +1.407874469396263e-02   +1.225799160651961e-02   +5.625278685660068e-02   +6.992546968669401e-02   +1.990875469730599e-02   +2.004892975547279e-02   +1.160968626054481e-02   -5.988587739420392e-02   -3.344014251866708e-02   +1.360153065302382e-01   -2.022470262232637e-02; -7.606855084742817e-03   +3.956499173798631e-02   +3.130723820524836e-02   +4.625690866447541e-03   +3.015126270668843e-03   -5.817599131104110e-03   +2.271644679634317e-02   -2.844606817965851e-02   -4.649607304383910e-02   -5.839230585149371e-02   +3.539922134194817e-02   -4.240548888559426e-02; -2.184918069927404e-02   -1.698515412155936e-02   -4.861403733377145e-02   +1.744112539448899e-03   +5.389596133163428e-02   +4.666304443263915e-02   +1.309406194458327e-02   +5.457345036701915e-02   +3.762691595997807e-02   -1.715705432716715e-02   -4.485833760267165e-02   -1.557269464457407e-02; -6.324179028659034e-03   -8.309257006210925e-02   +8.386586159751970e-04   +2.541187506813343e-02   +1.746569360270559e-02   +5.295880029244783e-03   +4.096597509047602e-02   -7.822846489675034e-02   +2.083511987640518e-02   +1.708121797122410e-02   +2.621968546847385e-02   +7.270862940573436e-02; +4.282667203264539e-03   -2.712522834495125e-02   +1.488717617265100e-02   -1.209324385315753e-02   +5.483595357943887e-02   -8.292823371074572e-03   -2.285135367094294e-02   -1.988006070809835e-02   -3.170000113963874e-02   +7.568397513606768e-03   -7.292108225939950e-02   -1.286736922293684e-02; -9.438463104243346e-02   -2.589969308056080e-02   +8.916180629780154e-02   -7.506675607306404e-02   -3.375685670590944e-03   -3.703407201171866e-02   +7.964865682140911e-03   -1.595666759479504e-02   +5.036505295249329e-02   +1.133865171696121e-01   -1.954692585747536e-02   +1.547531574480537e-03; -6.250648132089810e-02   +4.839850929077036e-02   -5.340647216049053e-02   -8.370521219744502e-02   -5.390338314908927e-02   +3.215946946338440e-02   -2.670776603838909e-02   +4.562853710762316e-02   +2.368511428197000e-02   +2.410920006195868e-02   -2.261638312851740e-02   +2.520427191136772e-02; -2.308958087494558e-02   +5.365395443567985e-02   +5.942733725046852e-02   -5.215180607322415e-02   -4.698888812220288e-02   -1.028643109963849e-01   -3.334202299000178e-02   +1.483494659333210e-02   +4.798424574052892e-02   +2.195438115636542e-02   +6.391678278851692e-02   -4.142696141340087e-02; -4.663135953312152e-03   -9.175795941426780e-02   +3.194917098117951e-02   -4.718664099933787e-02   +3.716405935122605e-02   -6.798292420236354e-02   +2.134967711285850e-02   -1.551494173816638e-02   -1.064739956300474e-02   +5.549215864405231e-03   +2.052661144835217e-02   -2.295055922335816e-02; +3.592557853543658e-02   +2.099370562635145e-02   -4.615243573138991e-02   +6.008641647117393e-02   -2.696870678693133e-02   +4.715850936597998e-02   +5.702493125816986e-02   -1.502506432963141e-02   +1.511683114763531e-02   -3.084324711506028e-02   -3.063024006136974e-02   -6.526870653334628e-03; -2.020012190508806e-02   +2.077727685361343e-02   +4.193623745537355e-02   +2.567310861921659e-02   +5.493806337172885e-02   -4.468930776985927e-02   -1.563428091162370e-02   +4.746302296693115e-02   +3.050753515525490e-03   +1.056262936553660e-01   -9.994375397641687e-03   -5.724013750815207e-02];
L2E_Input1_iAMPA_netcon = [+3.028654134588598e-02   +1.578849095584738e-03   +3.975490978586101e-02   -5.733583082815002e-02   +1.880057126798660e-02   -2.047756537725458e-02   +5.605194558585468e-02   +4.626290650552382e-02];
L2I_Input2_iAMPA_netcon = [-7.272315118526125e-02   +1.501375476484639e-03   -1.921408793576055e-02   -6.356954485717847e-02   +4.487574223587135e-02   +2.546352656560018e-02   +3.276797426797162e-02   -2.768428663561697e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
