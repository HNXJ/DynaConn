function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.232226811271197e-02   +6.379276498651240e-02   +5.281748974005475e-02   +7.816223995746678e-02   +5.339097596846400e-02   +2.085133275173949e-02   -6.327296626059774e-02   -5.210714296495281e-02   -3.658275761877925e-02   +4.230467667053314e-02   +8.195573389610028e-02   +4.571060061956483e-02   -3.932577338490799e-02   +6.481949943999583e-02   +9.997785933928760e-02   +1.564647103751357e-03; -2.193386916503345e-02   +6.163965212784296e-02   +7.971592698638748e-02   +7.198291933300541e-02   +5.540486833055008e-03   -7.950084185051107e-02   +6.498383261442232e-02   +3.698463100375855e-02   +6.693649100994684e-02   -5.832338607390342e-02   +2.308344652328232e-02   +5.352520154272813e-03   -9.457960171150147e-02   +3.208904551859054e-03   -9.549096938041446e-02   +2.574252636610144e-02; +3.005089426192844e-02   +6.354191229595146e-02   -5.912936862832033e-02   +5.813689506699789e-02   +5.636822604803088e-02   -6.065302338406668e-03   +9.076521524855655e-02   -3.659023108362736e-02   -3.911339587966341e-02   +3.146461490168530e-02   +1.384527610130118e-02   +6.891836859885417e-02   -5.562012625136240e-02   +9.325472739555871e-02   -3.000251595591108e-02   +2.964401452650984e-02; +7.409249637455182e-03   +2.122400055841468e-02   -5.717468518174099e-02   -7.314734765203224e-02   +5.477726357362932e-02   -6.493907877542852e-02   -6.942432515043948e-02   -9.611480882011877e-02   -3.237464732904497e-02   +8.578261387457516e-02   +3.921045164233285e-02   +7.271916648242185e-02   -4.579118185351065e-02   -8.588731386129214e-02   +1.262646266568880e-01   -5.661404623329723e-02; -3.225462097270404e-02   +5.499873470786032e-02   -9.746066396302212e-02   -5.031545507882870e-02   +4.049446876257702e-02   +4.609145408867805e-02   +3.876562623773195e-02   -1.254500979903143e-02   +4.432255012328433e-02   -1.248286433716919e-02   +1.199755724213129e-02   +1.311625479821343e-02   +5.269496518937894e-02   -5.104728590384300e-03   +6.418641543383659e-02   -3.435619637518310e-03; -5.871248935180796e-03   -2.558006054319280e-02   +8.999015257500878e-02   -1.100860486534505e-01   -6.110097950830123e-02   +2.287594399214229e-02   -1.499601189131456e-02   +1.888209009390961e-02   -3.544587854181657e-02   -3.254892805489214e-02   -5.229813072868497e-02   +3.212853014504018e-02   +8.748531951717418e-02   +5.369433292663767e-02   -2.915751431720515e-02   +2.183415657571093e-02; +4.980688456981697e-02   -4.515430436509772e-02   +4.560963850393679e-03   -5.750377398267574e-02   -7.750469058162454e-02   -1.659446761725775e-02   +2.041671511626919e-02   +5.457379860697179e-02   -5.266580047560934e-03   +3.345168783524510e-02   +7.366296824626448e-02   +7.743907853938485e-02   +4.956561763714525e-02   -3.592621164274889e-02   +3.495983429358387e-02   -4.925630557398920e-02; +3.061582111770243e-02   -4.830547794812518e-02   +1.848812360400253e-02   +4.291342638919227e-02   -7.200400977577080e-02   -5.712550983735393e-02   -1.625270075293614e-02   +4.146816031484509e-03   -1.594614402301625e-02   -6.758380754589438e-02   +8.349105726080473e-03   -9.076173600255708e-02   -7.652899167988304e-02   -1.568093319008126e-02   +5.600646316020631e-02   +5.317970147787002e-02; -1.935492088887518e-02   +4.677503336385562e-02   -8.936120112288712e-02   -6.608159716842743e-02   +1.792296048169277e-02   +1.644609546864899e-03   +1.183235115075839e-02   +8.263154271364075e-02   +4.281041866719140e-02   +2.299175611249930e-02   -5.536076842104316e-02   -4.604114331769064e-02   -4.342990015725506e-03   -6.432327098322166e-02   +7.003344849760759e-02   -4.075874000533909e-02; -6.040277962879697e-02   +1.980687609458812e-03   +2.686649554845352e-02   -1.390791884273816e-01   +4.242874531554540e-02   +4.968192634669299e-02   -5.461702725814341e-02   +7.744067766293897e-02   +3.513273678013595e-02   -2.242456664422621e-03   +6.301755766911119e-03   -2.348277447508667e-02   +4.284685019543459e-02   +2.573087698809921e-02   -2.716310578861175e-02   -2.873690387388168e-03; +4.446720917058273e-02   +1.636860069566509e-03   +1.110002977382716e-02   -2.022028617766031e-02   -1.019875537640163e-01   +2.344421198457538e-03   -3.806284961738143e-02   +8.744306761580124e-02   +3.921760912877984e-02   +9.802172825214107e-02   -2.652082645440141e-02   -6.555828305826114e-02   -6.694394190811352e-02   +5.035555061917995e-02   -2.482769780239119e-03   +7.602423547591439e-02; +1.075775490115714e-01   -1.092978806014579e-01   -3.417247884543316e-02   +3.157111213748577e-02   +9.483119381408896e-03   -1.345150353978294e-02   +2.028492081697400e-02   -1.422863071594539e-03   +2.213165389214529e-02   -6.627669310764833e-02   -1.033978067892660e-01   -7.434580586244588e-02   -7.157462175408942e-02   +3.249466935844187e-02   -1.860009669475284e-03   +7.823908862464847e-02; +4.050223133852845e-02   -3.736618446357458e-02   +1.610478096877225e-02   -1.005633844809634e-01   +1.721117408555272e-01   +4.218711482033531e-03   +5.281876570048884e-03   +8.677089246420552e-02   -5.475094644538902e-02   -5.462494788819237e-02   -1.001498950355148e-01   -2.912601416409414e-02   +5.261082354835996e-02   +1.087599931485124e-01   -3.072551942697346e-02   +9.558904049094062e-03; +2.618983995736422e-02   -1.425098329520421e-02   -2.135615049468111e-02   +6.159065677127941e-02   +5.513095111048921e-02   +7.463751394086027e-02   -1.333879155337855e-03   +3.924032742858670e-02   +6.685522937002282e-03   -8.467334941367020e-02   -8.222031914412458e-03   +2.032127506636767e-02   +4.642871787847284e-02   -4.853798648315677e-02   -2.899511585046269e-03   +1.054203494837914e-01; -3.043141843328489e-02   +3.933587591492847e-03   -7.634811662047945e-02   -4.188369261426400e-02   -3.110400829709091e-02   +7.182884663014080e-02   -8.473299401311467e-03   +1.507710417169056e-01   +6.059776277940410e-03   +6.408955416978976e-02   -1.161115766965811e-01   -3.079909803715274e-02   +3.541087433261955e-02   -2.155296927561423e-02   +1.466117886156765e-02   -3.606341108338704e-02; +1.141114607893911e-02   +3.228306429314644e-02   +2.324026830901603e-02   +5.392469751741644e-02   +5.826714647716263e-02   +7.760385543222802e-02   +2.243808752760557e-02   -7.561641107471095e-02   -2.152615202145353e-02   +9.778698578979586e-02   +7.581523641437710e-02   +8.193823259964071e-02   -1.271662396848600e-01   +5.364333945430703e-02   +3.391963410797784e-02   -3.183548264617712e-02];
L1E_L1I_iGABA_netcon = [+7.042577026530017e-02   +1.029666947455513e-02   -5.292306200883783e-02   -8.527153374601378e-02   +5.659426463255389e-02   +4.834369006046008e-02   -1.069997341676079e-01   +6.062693484152695e-03   -3.633146650416274e-02   +1.055501039754814e-01   +4.301172948146646e-02   +4.271931534526811e-03   -4.705426830118600e-02   -9.218085105160430e-02   +5.696927907414958e-03   +2.946876415561245e-02; +1.310652842106123e-03   +4.485905521471651e-02   -4.781426909317007e-02   +1.103501436048635e-01   +3.821835824752012e-02   -2.211128738739638e-02   +3.009870632919308e-02   -4.751485564432804e-02   +5.304374463117298e-02   +4.946336597332937e-02   -7.293204233208021e-02   +1.002490925060373e-01   -7.984938913789652e-02   +2.471973714829421e-02   -2.908120852747317e-03   -4.890429082443385e-02; -2.653486822372706e-02   +3.134595591642470e-02   +8.882671269457662e-02   -3.394276509349960e-02   -2.410987426137276e-02   +2.133327721435463e-02   +4.935714557952983e-03   +4.885488301306060e-02   +2.790726977459254e-02   -3.953754176362659e-02   +4.937742352988747e-02   +4.247495302611893e-02   +6.017817357885757e-03   +7.512692623566139e-02   +1.817104441013009e-02   +6.249734396494965e-02; +1.781931246654866e-02   -6.392686164178370e-02   +6.063198381214535e-02   -2.013467736235448e-02   +1.209192666016021e-01   +6.807484553144320e-02   -1.762365858321846e-03   +3.787627390243593e-02   -3.147624878051682e-02   -2.840052738678134e-02   +3.054616072988658e-02   +7.691717192824460e-02   +8.202078377841870e-02   +3.863444585062349e-02   +2.772149265535719e-02   +2.819461830407007e-02; +1.003816882321427e-01   +5.943169834958880e-02   +4.711953043765447e-02   -1.996300532614326e-02   +4.496606250033718e-02   +7.371701470648226e-02   -5.566695326348857e-02   +5.075794709968013e-02   -1.887267285488669e-02   +4.350041993250516e-02   +8.862317672214620e-02   +7.953166179425561e-02   -3.432479816036026e-02   -1.351754956723453e-01   +4.537690642980568e-02   +8.244235545013343e-02; -4.894311782493550e-02   +9.502913923161596e-02   -1.196973146337938e-01   +1.396654808661659e-02   -1.337037114414290e-02   +5.141960933021237e-02   +1.658374293935697e-02   -4.639211220211538e-02   -8.192405629686032e-02   +4.341861019212313e-02   -1.333887114771319e-01   -2.550806386297482e-02   +4.470526634491075e-02   -6.624731553022312e-02   +2.504218822549662e-02   -1.110936293959549e-02; +3.362742631767361e-02   +5.176667191170321e-02   +1.513346799764311e-01   -7.110895251137342e-02   -1.632680474858317e-02   +4.891762759334232e-02   +5.183694981361714e-02   +4.995852687365215e-02   +3.310715711958326e-02   +4.054712951867755e-02   +3.999348997213106e-02   -5.738519505764651e-02   +3.191875875553955e-02   -1.088497538515129e-02   -4.485357024965719e-03   -2.021251349382895e-02; +8.505843294327474e-02   +3.983172876657867e-02   -1.731778455751072e-02   +3.288644101758929e-02   +4.781988839932258e-02   -1.600908819955386e-02   -2.636534336073261e-02   -4.523283101921992e-02   -1.082325919835669e-02   +4.971894385593562e-02   -9.051516769995981e-02   +1.059103439936215e-02   -2.989719262890529e-02   +3.445306647012709e-02   +3.664542775023832e-02   +5.064820872635343e-02; +4.749770671825490e-02   +4.282663588863787e-02   -6.226702251345101e-02   -1.349889958279294e-02   +7.434109904224519e-02   +4.315793044089109e-03   -5.162210288021614e-03   +5.977787963698920e-02   +7.197572727694339e-02   -3.883941179044480e-02   -5.553402373251632e-03   +7.081305851046132e-02   +4.816295461339892e-02   +6.373448384386177e-02   -1.605387435249836e-02   +9.512533193024586e-02; +1.308745893607625e-01   +1.478237959812894e-02   -5.026896788175354e-03   +4.266186415626182e-02   -3.562596276960592e-02   +6.188025748056905e-02   +8.082469000421068e-02   -2.884257036311101e-02   -5.416262292561734e-02   -1.051062585882831e-02   +5.914336516747866e-03   +5.471027183514349e-02   +8.194249143889648e-02   +6.943360953677422e-02   -6.581751373449260e-02   +7.523667466124685e-03; +4.408467555158544e-02   +4.558341310350802e-02   -2.234881883202453e-02   +5.733573471176489e-02   -1.224493787876631e-02   +5.740814716716015e-02   +1.530553479547058e-02   +7.186406188391847e-02   +5.413110531788903e-02   -3.244373128697400e-02   -3.501346610663539e-02   +3.303566948046208e-02   -2.396505807382244e-02   +2.607881837924131e-02   +6.585754392875404e-02   +1.051640324157459e-01; -3.082871267090082e-03   -6.604652581926003e-02   +1.393967738293883e-01   +1.119535140022870e-01   -4.927191488775685e-02   +4.741290330116495e-02   -5.027127312879139e-02   -3.609439353255584e-02   -8.905823353900769e-02   -5.697989518436002e-02   +1.268741173848227e-01   -8.612841899189438e-04   +4.473236286482320e-02   -1.145075744329759e-02   -2.395191022854777e-02   -4.341833154911654e-02; -1.230186577176483e-01   -2.595538436431819e-02   -3.685737728736997e-02   -3.528589219354428e-02   +8.655464583149128e-02   +9.266008312162485e-02   +8.233643937239216e-02   -3.708619450792955e-02   -7.855092425978871e-02   -3.283088223383347e-02   +4.461864608875606e-02   -1.804522935757782e-02   +8.642791410164588e-02   +1.036407232790137e-01   +1.158871005593948e-03   +1.481747647013789e-02; +7.665629350974419e-02   -4.118882234351101e-02   -1.883934540228790e-02   +2.317018474768448e-02   -9.578566130476654e-02   -6.265132327794218e-02   +4.159824239440523e-02   -1.253982564587668e-01   -1.241063142485913e-01   +5.063841903501648e-04   -3.601938162999445e-02   -6.489479870359463e-02   -3.842970574043601e-02   +7.881176799107667e-02   +5.919689678311565e-03   -6.660429877999993e-02; -3.487896785950183e-02   +8.539051114856387e-02   -1.410590472390078e-02   +1.994469156855094e-02   +8.836930207112242e-02   -4.990773591770550e-02   +1.280881223041926e-02   +8.771513493067414e-02   +1.424363952457214e-02   +8.200461934314943e-02   +9.520257667477459e-03   +6.340015883755053e-02   -1.627927246671302e-02   -8.632065193035436e-03   +1.060274129986898e-02   -1.491737951891490e-03; +2.601923227554061e-02   +6.198336472151991e-02   -1.678559584264428e-02   +5.941557824474479e-02   -5.521528277470875e-02   +1.099259584128473e-01   +3.065730284250459e-02   +4.018958429555165e-02   +4.551424686552925e-02   +5.922191814324735e-02   -1.238329419177087e-01   +3.746579015131050e-02   +1.174630616663727e-01   +4.210008782519017e-02   +4.053076486415300e-02   -1.100889044563169e-02];
L2I_L1I_iGABA_netcon = [+9.120478430377896e-02   -2.606321296778289e-02   +2.944563971365218e-03   +1.091671691660189e-02   +4.961805852612271e-02   +1.210115604881928e-01   -7.273714579706297e-02   -2.299187497076643e-02; +2.935602819065720e-02   -4.489906220093438e-02   -4.655741637457448e-02   +1.169211886720262e-02   -3.161762732834390e-02   -2.346233024534636e-02   +6.546603270593400e-03   +1.312683368287412e-01; -7.318987210941089e-02   +8.108987041320202e-03   -2.622538572554230e-02   -4.005181089526799e-02   +3.520719179094081e-02   +8.076924150128383e-02   -1.279629966247638e-02   -1.651786146913731e-02; +1.311985395174318e-01   +6.132626691236408e-02   +1.236014351171988e-02   -1.578781539080160e-02   -7.432396104878997e-02   +4.745342918625447e-02   -7.031001333489309e-02   +1.632723461805854e-02; +4.479876045983863e-04   -6.901932315979575e-03   +1.002194001209438e-01   +6.125621297249772e-02   +6.319283286054406e-02   +7.715572608448162e-02   +6.193898726793467e-02   -3.051225289619764e-02; -5.514262608797844e-02   +2.505423151599330e-03   +6.013523728978858e-02   +3.995309356727021e-02   -1.117827744523596e-01   +2.036610487230868e-02   -1.023866237155415e-02   +4.978416980583898e-03; +2.145663145969668e-02   -1.021571431642747e-01   -1.853751386458562e-02   +7.091783224915929e-02   -1.982535181120990e-02   +1.047548975139939e-01   +2.455621795080804e-02   -2.815210727933428e-02; +3.141974903042253e-03   -7.298930659663545e-02   +7.257752799533122e-02   +2.596967320759596e-02   +8.927971081592686e-03   -3.982181520408319e-02   -6.008868122334442e-02   +1.232873088647213e-01; +3.750925621860896e-02   +7.334004162807242e-02   +2.596780121823596e-02   -3.252191771791495e-02   +8.778820031630064e-02   +3.621303770362548e-02   -4.308638875470989e-02   -8.715151401758289e-02; -3.303791134233293e-02   +1.530266218031889e-02   -4.499420797498949e-02   -7.086567571083631e-02   -3.091709618232434e-02   -1.245791255571979e-02   +5.880765010921388e-02   -1.874056312852002e-02; +2.715601615460611e-03   -9.167685937830974e-03   +5.305784726228810e-02   -1.003214252520576e-01   +4.392781356516270e-03   +6.388801848915023e-02   -3.277749696275176e-02   +7.978096263025936e-02; -6.794134491454315e-03   +4.694561760511111e-02   -1.880659999190535e-02   +6.093382276594377e-02   +1.732653929858764e-02   +3.292610362489588e-02   -7.873272152668864e-02   -6.925324571003698e-02; -5.351328154754934e-04   +2.263693516531622e-02   -1.027508508442932e-01   -7.685391904459876e-02   +4.482528386917899e-02   -3.667238362255421e-02   +3.329086317367325e-02   +5.474685723665844e-02; -1.309668567712258e-02   +4.684002988703271e-02   +6.648170189947299e-02   +9.805222793180109e-02   -6.593911465114631e-02   -5.880281493527755e-02   -3.205766625935310e-02   -3.158420562826117e-02; -2.146162628238179e-02   -3.608206056999643e-02   -8.443607503245069e-03   +8.409982273741055e-02   +9.836320991790720e-02   -7.774181834205851e-03   -9.182028400387553e-02   +3.974777874720966e-02; -6.083402549924947e-03   +1.066287045261432e-02   -1.775937806013640e-02   +1.287885226392082e-02   +1.166382552421368e-01   -3.787790012669374e-02   -2.827293581123285e-02   +8.095012118057902e-03];
L1I_L2I_iGABA_netcon = [-7.101195229443727e-02   -9.449592285700305e-02   +9.385508837223530e-02   +3.521597974577753e-03   +4.994631782634473e-02   -4.359513601413210e-02   +3.355338503486713e-02   -5.759865874792204e-02   +7.489083202592997e-02   -1.877077088137651e-02   -8.309621481651541e-02   -7.670671261224621e-02   -3.428299214658557e-02   +3.867566709140794e-03   +7.631129321511115e-02   +5.753945449355838e-02; -1.589030073692872e-02   +6.773298955037606e-02   +2.355338672111081e-03   +2.421566164400498e-02   -5.312587356981802e-02   -9.116179514787731e-02   +4.190299666455261e-02   -3.454806434334066e-02   -4.046518844433508e-04   -8.229808371753188e-02   -6.434862326028458e-02   -1.561162435951387e-02   +7.829806460712646e-02   +1.069981914405229e-01   -3.549797279272063e-02   -5.460336971123450e-02; +3.320943884132686e-02   -7.195768253803403e-02   -6.940255965187204e-03   +5.511435282339110e-02   +8.628643286451806e-02   -6.862839230098208e-02   +2.266625682012857e-03   +2.896157267234140e-02   +7.543460418771110e-02   +5.977314669207237e-02   -4.091706023597420e-02   -4.722288019628582e-03   -2.840633272685318e-02   -6.595730248755871e-02   +1.876789965860674e-02   +5.068950173446933e-02; -4.806878011624593e-02   -2.956307524690220e-02   +2.743002489759155e-02   -2.620330136981226e-02   +6.631157124865711e-02   +8.626937591184033e-03   -2.429010409807586e-02   -5.278245189916895e-02   -1.790018669076705e-02   -4.435946649943061e-02   -3.828402081358208e-02   +8.150391635829531e-02   +4.332551723232173e-02   +9.327106471969555e-03   +8.646551935133497e-02   +3.226276339832818e-02; +8.342050211716950e-02   +3.697514022559081e-02   +1.954905323864256e-02   -1.226390307994362e-01   +5.039129106489371e-02   -5.411183698770203e-02   -4.380271469407050e-02   +7.873376059939488e-02   +8.364041817694580e-02   +5.767662153402067e-02   -6.693494373333411e-02   +3.983789835167242e-03   +9.292165344408738e-02   -6.160746136080434e-02   -1.291329039639746e-02   -1.160167569144366e-01; +8.698514670238597e-02   -5.268459164444311e-02   -7.023032706973110e-02   +6.328435746465833e-02   -9.852258319127825e-02   +8.791559370048402e-02   -2.068068230985298e-02   +8.140974673452507e-02   +2.778796071406562e-02   -3.335950204988355e-02   +2.737884606393354e-02   +9.520617472893536e-02   -6.788049190357552e-02   +3.753000989916735e-03   -7.441783452776438e-02   +1.300796898474124e-02; +5.647652763894719e-02   -1.513969671737396e-02   +2.119339886513375e-02   -2.983387430523835e-02   +1.940662963097155e-02   +5.682747383369856e-02   +2.513346144965716e-02   +4.258903378796545e-02   +5.241353718386729e-02   -2.141001186951442e-02   +8.984301851895928e-02   +3.384968752772573e-02   +2.092560791291716e-02   -4.313283059869834e-02   -3.530373840329087e-03   +5.986820223628311e-02; -8.301723276537072e-02   +4.977689444142423e-02   -5.614469780398899e-02   -3.786469835035357e-02   +3.535950384151432e-02   +1.185756237837564e-02   -5.465032298847940e-02   +1.979160014451902e-02   -8.219796814750907e-03   +3.806405085357714e-02   -8.757622659043224e-02   +7.081321425233908e-02   -4.432460633214438e-02   -7.547318442125681e-03   +1.051893077173081e-02   -4.337356861531271e-02];
L2E_L1E_iAMPA_netcon = [-5.227101422486596e-02   -9.792086027260774e-02   -6.196827438365127e-02   +3.578682891310662e-02   -3.338024005657617e-02   +1.060761289896369e-02   +2.924631559506993e-02   +6.315719131520585e-02; -2.120748827541380e-02   +3.340303871891456e-02   +5.616680713751259e-02   +2.213666789676629e-02   +8.832194774188372e-02   +6.124825065643943e-03   +5.609806743560853e-02   -3.090324246879965e-02; +2.198884067745155e-02   +2.383394968194089e-02   -2.002683041358004e-02   -2.952542584349602e-02   -1.381010138632691e-03   -1.174443788805233e-02   -4.838418253466976e-02   -1.384983598576957e-02; -4.822841930513433e-02   -1.898760796536946e-02   +1.943356347820303e-02   -5.922828045518153e-02   +7.111095906290192e-03   +3.123445879981758e-02   +3.770986557556338e-03   -3.810497174030173e-02; -6.406861453660063e-02   +6.769605783676913e-02   +1.498101264338290e-02   -8.001016930902105e-02   +1.822812812114705e-02   +1.393978685856785e-03   +4.468603261347550e-02   +2.387684140221565e-02; -3.862528597062279e-02   +5.348308910016050e-02   +5.193317686272722e-02   +2.054344799229932e-02   +7.977968857564957e-02   +1.181555820556488e-02   +1.107155703130980e-01   +2.852433241738420e-02; +7.507566201716660e-02   -8.701892129860408e-02   -7.535240673122609e-02   +2.406026853024736e-02   +2.284659976076445e-02   -8.533157149300422e-03   +5.693211404103522e-03   +6.543398263889801e-02; -1.877626286613903e-02   -2.378506956604230e-02   -5.038996256828385e-02   +2.314489757854896e-02   +9.951447606769849e-02   +3.478949996285999e-02   +4.903490155042562e-03   -8.322314514590754e-03; -1.372510501139363e-02   -3.738322821782855e-02   -5.259243648568938e-02   +8.874852790182294e-02   +1.262983432829716e-01   -5.106142423339392e-03   -3.862906523466978e-02   -1.104759273563192e-01; -2.396310979548931e-02   +1.060787101102702e-02   -5.825627421207030e-02   -3.486445320850862e-02   -2.669630605635296e-02   -2.481058552699024e-02   -4.023426990587926e-02   +4.091066694585174e-02; +4.563771026987531e-02   +7.027608767922377e-03   -8.905873507125238e-03   -4.316679728484669e-02   +9.347521690518357e-02   -4.716480984851415e-02   +2.600694307477795e-02   -1.598871908404394e-02; +5.868858766521177e-02   -2.349807523921624e-03   +6.066250741833422e-02   -7.206124203431882e-02   +5.218544566153304e-02   -5.689324042681662e-02   +1.112690043228074e-02   +4.352400220541679e-02; -6.740355793678079e-02   -2.747781938557451e-02   +4.406108836823064e-02   +4.905358563446829e-02   +6.132144880093482e-03   +7.691155486846574e-02   -4.872706279660229e-02   -4.771703849714135e-03; +5.843709788356105e-02   -1.311326778672736e-02   +6.679640226032124e-03   -1.309210616902930e-02   +9.525518994979963e-02   +1.208901162215537e-02   +2.019271909034544e-02   -1.338442049607615e-01; -1.066493637888838e-02   -3.870531691683077e-02   +3.951477013161253e-02   +2.650897955979683e-02   -4.266172533159213e-02   +7.350826901517914e-03   +1.656411039070295e-02   +1.353750589040994e-02; +6.774739611908552e-02   -5.084774551071204e-02   -6.982264466744097e-02   -2.909164846855728e-02   -7.184587738965124e-03   -5.385286520199750e-02   +3.482561915525552e-02   -8.181260592913879e-02];
L1E_L2E_iAMPA_netcon = [+3.037624352754287e-03   -6.421715251661063e-02   -6.436439530780605e-02   -1.356418893249216e-02   +4.391530878555924e-02   -2.609762778620500e-02   +2.377767757836581e-02   -1.024038471047220e-03   +6.021636285234490e-02   +7.951365090655395e-02   -5.911804919743438e-03   +6.798270976060666e-02   +6.630416354858956e-02   -9.140245647815920e-02   +5.761738963890720e-03   +5.213289691875511e-02; -3.621245291648537e-02   +6.761968654745035e-02   -4.616187735959849e-02   -1.167590322203809e-02   -1.087906686449984e-02   +2.765125664019543e-02   -1.311114698435089e-01   +9.219831356542312e-02   +1.554393264964659e-02   +5.670405482716258e-02   +9.709404064426060e-03   -4.438452443649863e-02   +3.865771331233880e-02   -3.049975563531494e-02   +3.727769152096150e-02   -2.634749899690952e-02; +4.065154111050623e-02   -3.077006537902782e-02   -3.271515505625543e-02   +6.347604494374784e-02   +1.053773003125322e-01   +1.007643667559855e-02   -1.026080013852396e-01   -7.471357762332215e-02   +5.511226792325412e-03   +2.997589400771205e-02   +4.158771678786190e-02   +7.709641022391422e-02   -7.926686740886521e-02   +1.743420967490682e-02   +3.698239891162527e-02   +5.564403918209544e-02; -7.127813713941092e-02   +1.639065168335710e-02   -6.873783155269222e-03   +3.162606335484276e-02   -2.697780218028231e-03   +8.977373091557830e-02   -4.955008623146540e-02   +1.745284475263109e-02   +6.301559535154422e-02   +8.468374443902255e-02   +4.092289344401661e-02   +4.883882009846442e-03   -4.183303820845949e-02   -1.051777887196845e-02   +1.147753827603636e-01   +2.156476994273020e-02; -1.009887741958377e-01   -5.266492317052338e-02   -2.187741431959040e-02   +6.737495415174702e-04   -1.583967803100664e-02   +7.484151618813695e-02   +1.108412333101264e-01   +3.066178004158442e-02   +5.382418787565412e-03   +9.249175586911508e-02   -1.170040071553573e-02   +4.373029266811002e-02   +6.103283843225067e-02   -3.907300930861659e-02   -2.970752741297802e-02   +8.096523517342163e-02; +4.158336349249987e-03   +3.943556532096920e-02   +2.082764239212133e-02   -2.395920864251603e-02   +1.473511081215749e-02   +1.085636068625302e-01   +2.711715697973042e-02   -5.156844718055008e-02   +6.652994945104535e-03   -2.101436913559204e-02   +6.038225946593249e-02   -5.474517702982643e-02   -3.484929532001929e-02   +3.098225233342517e-02   +6.810978624487556e-02   -2.060921183604399e-02; -7.663696661217417e-02   +1.699672459210539e-02   +4.850664109468345e-02   -3.147940561913716e-02   +8.993149038779841e-02   -3.902186207868263e-02   -6.219027180734835e-02   +4.873597653638690e-02   -5.300729869007463e-02   +5.611288662582528e-02   -1.183748183912355e-01   +9.820828015064786e-03   +1.209533057517116e-02   -4.973275455341707e-02   +5.895712363973815e-02   -5.302922495200275e-02; -8.651566860349258e-02   -2.887346387094410e-02   -6.821034047121977e-05   +3.823095974001883e-02   +3.232515461111135e-02   +3.645115783063487e-02   +1.099641120531022e-01   -2.073325956214872e-04   -3.208740274480532e-02   -4.804933077850797e-02   +7.672671680922660e-02   +3.821917442926552e-02   -3.997470865517643e-02   +3.040027786763264e-02   -7.693142995088627e-02   -5.190122008121789e-02];
L2I_L2E_iAMPA_netcon = [+6.636690860536781e-03   -3.598766626528177e-02   +9.301279770348309e-02   +6.224288450945199e-02   +5.013614395325012e-02   -1.048998187427173e-03   -4.409215753029741e-02   -2.774500641210265e-04; +3.613853912332410e-02   +6.071953908364406e-03   -2.326022520652689e-02   +9.155830670721475e-02   +3.896840951304912e-02   +7.833539304837753e-03   +4.693336572079194e-02   -3.954574816877856e-02; -1.631524353384805e-02   +2.362194781538898e-03   -4.123191632546397e-02   +1.910685999904404e-02   -1.047737215850345e-01   -7.640266476580573e-02   -1.056436748297319e-01   -2.374468809583398e-03; +5.493709190606905e-02   -4.209385253253729e-02   -9.751360385490832e-02   -4.866277999288816e-02   -5.728086639719376e-02   -5.977178122070007e-04   -6.101704687959891e-02   +6.956521711927885e-02; +2.957926490418284e-02   -4.367049468473762e-02   -6.531846116375953e-02   -1.468428691511279e-02   +1.056657144403424e-02   +2.781725721471994e-02   +7.366889574742224e-03   -1.520790887503605e-02; +4.082460294791473e-02   -2.020890244503734e-03   +6.620307712119262e-02   -1.135302763955584e-01   -2.478866610655599e-02   -1.354643078370268e-02   +8.767963354473551e-02   +3.058250943603070e-02; +4.700687922765806e-02   +6.463021333457548e-02   -4.133589528568360e-02   +1.130618685808513e-01   -8.036488162687788e-02   +5.468793700483705e-03   +2.026921747961518e-02   +4.175096989283195e-02; -7.472392459017804e-02   -4.487828882528415e-02   +7.716410251517261e-02   +5.118848839788996e-02   +5.193392364979775e-02   +1.671302804225861e-02   +6.080660786840880e-03   -4.952616617375133e-02];
L2E_L2I_iGABA_netcon = [-3.141474110852659e-03   -5.941831713707416e-02   +7.504661871412542e-03   +5.433500304868293e-02   +5.925421221252343e-02   +1.082744936665384e-01   -4.085020382566109e-03   +1.173139633999496e-02; +3.250355096848949e-02   -6.997332698298792e-03   +8.001348183546322e-02   -1.016130188516307e-01   +8.160363083001855e-02   -6.276999035303328e-02   +1.056869712173823e-01   +2.354989497779917e-02; +9.224168818628298e-02   -8.523208288767692e-02   -1.034129196843774e-02   +6.613166925845090e-02   +2.824801327491776e-02   +4.148835295352851e-02   +1.497571327989296e-02   -4.613782985329394e-02; -9.392668900255266e-04   +3.923663520537714e-02   -2.211933451644820e-02   +3.481243319816742e-02   -5.406029131018529e-02   +2.624402534656171e-03   +3.635603629390166e-02   -1.242412642633712e-01; +3.836438632395655e-02   -3.869689495610262e-02   +9.367930291181895e-03   -4.724077089300687e-02   -8.782927017483996e-03   -2.718550955592088e-03   +1.116572693452604e-01   +3.997257161577136e-02; +1.727590732199941e-02   -5.643002350900526e-02   +2.879178514913448e-03   +6.511204522612692e-02   -5.535523151628321e-02   +2.010245320990493e-02   +7.586398785317508e-02   +3.398303977496399e-02; +5.240066249062649e-03   -8.495442860515899e-02   +1.146363715643545e-02   +8.685417576215433e-02   -2.080566512194611e-02   +1.506526140047448e-02   -3.944043129151517e-02   -9.791692623019342e-03; -7.316110122322127e-02   +3.862530126351080e-02   +3.893166793878065e-02   -7.569514621071577e-02   +7.726464215213114e-02   +7.214379072473950e-03   -5.694986685987342e-03   -1.895568569061834e-04];
L3E_L2E_iAMPA_netcon = [-5.109889245003331e-02   -1.634887018848799e-03   -4.432284192890776e-02   -9.611897462056218e-02   -4.638998855056313e-02   +1.005109415621640e-01   -9.300307599335530e-03   +3.553804097804227e-02   -3.523910328666219e-02   -1.750525138310292e-02   -4.065284490188246e-02   -9.900255474999238e-03; -1.802982236269572e-03   -4.034456923370895e-02   -1.209385369263247e-01   +4.795443746192364e-02   -7.973465697420482e-02   -5.360116364364045e-02   +5.763782730750716e-02   -1.002394951478771e-01   +3.124282019561424e-02   -1.948296134580371e-02   -5.700103438550161e-02   +1.437355471521358e-02; +4.155956104822695e-02   +8.070724275135488e-02   +8.084596877458125e-02   +3.884768340278579e-02   +4.524520834203512e-02   -1.374794340352328e-02   +7.330356825714615e-02   +2.594873352436706e-02   +7.582934040274752e-02   -5.226149787420822e-03   -1.288114392104521e-02   +3.319845120173146e-02; -6.833259732205828e-02   +1.079803644685620e-01   -4.142316784655167e-02   -2.741489076346153e-02   +6.722452689189629e-02   -2.020163495303818e-03   -3.733850531003476e-02   +5.949653500221364e-02   -4.378601327004391e-02   +2.061472447528050e-02   +1.704049417421104e-02   +4.724428344039912e-02; -6.035335757418620e-02   -3.959058869284206e-02   +1.320196115756702e-01   -1.498693635520409e-02   -6.979586535150753e-03   +5.558669526594893e-02   -4.158892128239326e-03   -9.823343342636190e-02   -4.190457077119843e-02   -4.318564333848703e-02   +1.798204124166455e-02   -9.114202349330947e-02; -7.034077196246980e-03   +1.261568782756231e-02   -1.872966266618444e-02   -6.371027436173150e-02   +1.681421432282144e-02   +1.805965774855253e-02   -1.032912872864669e-01   -2.235654886752653e-02   +4.730247872065935e-02   +3.616834384605763e-02   -8.988863066683866e-02   -5.366093994542327e-02; -6.500678965984596e-02   -2.646166998831467e-02   -2.918355486580156e-02   +4.228814249027268e-02   +4.320065630722598e-02   -2.131701726892017e-02   +1.046365209414023e-01   +8.564510836620928e-02   +1.157967430037478e-01   +1.110850244690131e-01   +7.705640941131277e-02   +6.167289326870791e-02; +1.215110815160580e-02   +5.740083990857914e-02   -3.882159027040038e-02   +6.023560165470375e-02   -2.079700710138690e-02   +1.235023760620473e-02   -1.800877747581305e-02   -8.758632116219735e-02   +5.659849770724419e-02   +1.186657451773286e-01   +1.119229050050187e-01   +3.288421382665646e-02];
L3I_L2I_iGABA_netcon = [-5.153934048940434e-02   -2.982097711271688e-02   -4.691146925223890e-02   -2.468652185478035e-02   +4.983946186042412e-02   -2.894191329630324e-02   +2.130780472283829e-02   +1.121602573985225e-03   +3.640440848007608e-02   +1.069499242739287e-01   +1.359552731313504e-01   +6.334609847545052e-02; +4.392958610735202e-02   +1.575591539514768e-02   -2.228857368913937e-02   +2.114958320432134e-02   +1.593335119593799e-02   +8.630934252933004e-02   +6.593876215231589e-02   -1.393400430346640e-02   -5.871499202942092e-02   -8.892916469573027e-02   +4.784549067654268e-02   +4.656845782770200e-02; +1.780500535347359e-02   +8.388468586396752e-02   -6.482953169980869e-03   +4.870163584039357e-03   +9.112819937744185e-02   +2.399866856802403e-02   -1.436326125434385e-02   +4.133478770485803e-02   +6.882609395202544e-02   -4.700967597130200e-03   -7.765362329615546e-03   +4.069357683679087e-02; +5.256183746680838e-02   -8.378721429765942e-02   +3.746862041232285e-03   -5.524876622486473e-02   +4.447318218591746e-02   +2.159495202067657e-02   +5.358629417911920e-02   -3.598813773809461e-02   +4.382103800173734e-02   -7.507897478807896e-03   +1.064068450911041e-02   -5.388670384747654e-02; -1.223495444273941e-02   -1.182326219402655e-02   +7.152950949921891e-02   -7.023405559361558e-02   +4.959714917240439e-02   -3.690544710094000e-02   +5.519594250947859e-02   +4.081043331571385e-02   +5.834262671007903e-02   -5.192569780746885e-02   +4.012487358443359e-02   -3.346777538585759e-02; -1.668918420218170e-02   +1.086782006294676e-01   +2.550437544232682e-03   -5.892187456519540e-02   -2.801132379970031e-02   +2.962352308645328e-02   +1.384837995088875e-02   -2.117116807172776e-02   +4.463124388947887e-03   -3.231334066385174e-02   -3.593102072991203e-02   -1.889419103765640e-02; +1.198145323083922e-02   +6.049496638733488e-02   +1.031981052704733e-01   -2.855430362090411e-02   +3.663275274673233e-02   +2.080803589781020e-02   -3.668052104089146e-02   -7.545422716032464e-03   +5.393327099637453e-02   +1.134539994115505e-01   -5.608989760678529e-02   +9.038907829873288e-02; +1.010842421488537e-01   +4.463726447389155e-02   +4.756336012968460e-02   +5.964557307972015e-02   -4.877707277319292e-02   +6.857567540517201e-02   +2.387949577156613e-02   -2.729999788727878e-02   +6.500608526010805e-02   -7.499708806918257e-02   +1.402601365331452e-01   -4.472948173405379e-02];
L2E_L3E_iAMPA_netcon = [-7.088944578592227e-02   -5.741808667075830e-02   +7.457437846201968e-03   -3.687110543621542e-02   +8.553653547582309e-02   +2.776755431610767e-02   +6.559940750164873e-02   +2.374353515219550e-02; +8.312581638746620e-02   -2.779297492303083e-02   -5.270935444804045e-02   -3.568248185894547e-02   +2.061391987852749e-02   -3.875416634231231e-02   +5.832569500708089e-03   +1.210750249770832e-02; -2.723917880662925e-02   +6.280130629985659e-02   +1.128131127692523e-01   +3.273649213970295e-02   +1.458044037012874e-01   -8.475243807974787e-02   -2.290627720925861e-02   -3.437291315096865e-02; +4.037126773253329e-02   +6.566882595814285e-03   +1.154135175275684e-02   +3.101161009973369e-02   +9.446536009583729e-02   -7.579095435976660e-02   +6.696863409529043e-02   -4.588051387682332e-02; +1.591723980093254e-02   -6.266784213371016e-02   +1.037922245839756e-01   -6.790830073669835e-02   -5.589888267265657e-02   +6.858773776586095e-02   -7.604207506368045e-02   +6.996681367749118e-02; +1.722721669166939e-02   +5.521162791460142e-02   -5.569285100891912e-02   -7.323008218557786e-02   -5.378445406302380e-02   -4.356093039561944e-02   +4.557379857497627e-02   +7.198138847840756e-02; +7.171279257517496e-02   +7.230296587090762e-02   +3.730870248222548e-02   +1.501473933214764e-01   +8.224770267484784e-02   -6.594637506067835e-02   +2.324902495498692e-02   +3.736522348748698e-02; -5.938258310921742e-02   -3.784718704807526e-02   +7.589928830772390e-02   +4.794828423620413e-02   -4.242647126139271e-02   +6.289269506696080e-02   -3.176508016294138e-02   -2.177405894743640e-02; +4.282977692182250e-02   -5.784164194880739e-02   -2.755424694038971e-02   -5.197470148503242e-02   -4.967178564702492e-02   +4.207301962212868e-02   +6.670247201188445e-03   +6.879230012877199e-03; +2.672666546980922e-02   -2.457702195005097e-02   -2.144760359182865e-02   +7.843204147865913e-03   +6.846604086598621e-02   +1.093218978693573e-01   -2.316746155266668e-02   +3.362714060319634e-03; -1.741000379467789e-02   -8.219274600668607e-02   +7.460741214563441e-02   +1.036911647256133e-01   +9.173252425831105e-03   +5.137194769730892e-02   +3.096858295211730e-02   +1.126804542909796e-01; -4.382683792452084e-02   +3.411692818198583e-02   -4.385341266879553e-02   -4.768506215916169e-02   +4.852866998592287e-02   -4.000257321419889e-02   +1.437321304613660e-01   +6.981270814810192e-02];
L2I_L3I_iGABA_netcon = [-2.478879457212247e-03   -5.388979788559525e-03   +1.129986845040530e-02   -1.099822851988755e-01   +4.824368540869255e-02   +2.755509508137961e-02   +1.031492582363727e-01   +5.945338335830030e-02; +9.065618388050950e-05   -1.627248966986565e-02   +1.424437163634512e-01   -4.399811535236573e-02   +6.457008122044203e-02   -3.471901250623922e-02   +1.902004019908692e-02   +6.757414921284169e-02; +3.229701452880802e-02   -1.770977779799705e-02   +4.174394746920441e-02   -5.177028426952883e-02   +8.095398245306618e-02   +6.172802231870034e-02   -4.855955685210446e-02   +1.254218768237840e-02; +3.413487356521575e-02   +4.282020026814864e-02   -1.515283299167657e-02   -4.281156592054130e-02   +2.779482532901130e-02   -1.346767511401874e-01   -1.297571289956428e-01   +7.629261833566871e-03; +6.181619880740157e-02   +3.958300005372176e-02   -5.406193797365658e-02   +4.529345848871783e-02   -9.044543023070031e-02   -1.506594585552994e-02   -4.349050155536065e-02   -3.298698181788295e-02; -4.066160393739881e-02   +2.120682339291185e-02   +1.933445855908400e-02   -3.582824809114069e-02   +4.386292252689099e-02   -1.988488588071310e-04   -9.165791766391140e-02   -1.147734538528053e-01; +1.050688036379900e-01   -3.093468014467631e-02   +1.310841865086008e-01   +2.781518559413117e-02   +9.438752323054747e-02   -3.631128296310138e-02   +9.827869199768044e-02   +2.662119828460580e-02; -8.070792994957172e-02   -1.067258620000565e-01   -1.582735140240700e-02   +7.255225449148105e-02   -3.929669661327151e-02   -2.686406776238840e-02   -9.503413533785557e-02   +2.808098527985398e-02; +2.584028379080833e-02   +1.106594191906678e-02   +1.020060064471444e-01   -1.358986278600050e-02   +5.144283957994326e-02   +2.272611540738603e-02   +2.991984028952599e-02   -1.275334594487502e-01; +8.767025733316489e-02   +4.902748074353583e-02   -3.779745013106101e-02   +5.528524112911282e-02   +4.408602261776045e-02   -2.960006081585922e-02   +9.797241475764332e-02   +1.554125761990198e-02; +2.998804186370957e-02   -1.085133973000471e-02   +2.753046072317411e-02   +7.760642167283126e-02   -1.321830508382592e-02   -1.714334591273729e-02   -7.487630921444299e-02   +8.693613159803715e-02; +7.189516216841121e-02   -5.929603769482821e-02   +1.940712523991443e-02   -1.099447537926769e-02   -2.668388993109545e-02   +3.810922396882653e-02   +8.105267151926503e-02   -5.519324716996243e-03];
L3I_L3E_iAMPA_netcon = [+9.343514547769069e-02   +4.558260669893798e-02   -8.758823294695936e-02   +4.156399410379881e-03   +3.140759459172053e-02   -7.070439610218592e-02   -2.040376475980620e-02   -1.546769111566566e-02   -4.461151843332485e-02   -1.063373136957175e-01   +2.002298935202929e-02   -5.951142372391998e-02; -3.579452070748338e-02   +6.596156945192211e-02   -6.208980122655604e-03   -8.221601224834039e-02   +1.471700868607841e-02   +2.647372120505170e-02   +8.307048967521349e-02   -5.303460430133811e-02   -5.084066360715466e-02   +9.297264658383599e-02   -2.592923326256881e-02   +1.123585778954335e-02; +1.393521871416100e-02   +4.572075760734371e-02   +5.950152801442454e-04   +7.038605342885668e-03   -4.696097100452245e-02   -4.479545728174725e-02   +7.523897022683726e-02   -4.106873085979088e-02   +2.584549544082849e-02   +6.879988360949359e-02   -5.691690242329321e-02   -1.705938484773249e-02; +1.595374758919027e-02   -5.975493500195696e-03   +1.134889857051875e-01   +1.001808134983538e-01   -7.519396588011751e-02   -3.606844539389195e-02   -1.103286181722545e-04   +6.825827059604651e-02   +5.293106639440168e-02   +5.140580106658903e-02   +2.676083065182655e-02   +1.909258509415825e-02; -2.303955647890687e-02   -3.464022904225139e-02   +1.811788020651564e-02   -9.849260922919136e-03   -2.929537694635725e-02   +2.312886792138830e-02   -6.001305560306484e-02   +5.149366038637057e-02   +5.172778884162973e-02   +4.527327061089606e-02   +7.667965482478020e-02   +5.839670746188124e-02; +1.911411637128944e-02   +8.647154507048820e-02   -1.148081956679407e-02   -6.430611952054027e-02   -1.103070676294382e-01   -6.288856544355660e-02   +7.161699160991779e-02   -8.629996644539267e-03   +3.543656245284090e-02   +1.247045352817559e-03   +5.779551065472872e-02   +1.452055534239619e-01; -4.181079245824321e-02   +5.273395135557148e-02   +6.187599502619275e-02   -4.305170135027705e-03   -6.183755215306147e-05   -9.931513308798368e-02   +8.281385616061381e-03   +2.488537204755537e-02   +1.772330386604951e-02   +1.048754067329991e-01   -6.492264668951275e-02   +2.914329892420384e-02; -8.127636730007580e-02   +6.707197543916896e-02   +5.427319328737999e-02   +3.350659475103148e-02   -5.749564452839668e-02   +7.208355075352052e-02   +2.182792902480656e-02   -1.061179934621850e-01   +8.638246110414596e-02   +1.450804942445372e-03   +9.929275073633649e-03   +3.238219189010452e-02; -2.182945624780851e-03   +1.942626538801898e-03   -5.103059354421621e-02   +2.709545989261128e-02   -1.909046551685049e-02   -8.754235435706238e-03   +6.895642491590577e-02   -1.021660115606678e-01   -2.269109080543204e-02   -7.108980372198123e-02   -7.333095181547750e-02   +2.663353615495058e-02; +5.907094722953495e-02   +2.446510678816698e-02   -4.210493365577743e-02   +4.117716052698714e-03   -2.146269017891060e-02   +8.012410788904104e-02   +1.454954668379295e-02   +2.431798589615106e-02   +6.264565945055950e-02   +5.064288728016144e-03   +5.448104014556178e-02   -6.935340863052072e-02; -4.485730282781208e-02   +4.429165674118656e-02   -5.624439762328425e-02   +9.373924584912853e-03   +5.009616780710273e-02   -6.029713654264923e-02   +2.932445861933839e-02   +1.524560544276409e-02   +7.218825071642383e-02   -2.653609440203952e-02   +3.467089251548290e-02   +8.865351401846279e-02; -8.901114068038696e-02   +9.929842006165750e-03   +1.049767909679850e-01   -3.444000383973890e-02   +9.518715533125312e-02   +1.232110941918568e-02   +3.105683326870555e-02   +8.572119349773495e-02   +5.211222561519240e-02   +1.431841951779670e-02   -3.819399610362691e-02   +5.484768537834009e-02];
L3E_L3I_iGABA_netcon = [+7.891338619743052e-02   +3.653169362816515e-02   -3.695120917765288e-02   -4.522851976326667e-03   +5.574254546387730e-02   +1.234649249022668e-02   -7.651767995551784e-04   -9.973790447926017e-03   -8.039849184206149e-02   +1.301523566285722e-02   +3.199444269314600e-02   -8.226957456609704e-02; +6.904719758876178e-02   +3.791229228670204e-02   -8.991857016676283e-03   -4.792417770169029e-02   +8.003655456288311e-02   +9.759018413604442e-02   -5.187087081682114e-02   -6.094217533251192e-02   -8.252682990752859e-03   +3.757471524110398e-02   -1.350124842859048e-01   -1.945461606206083e-02; +1.097761321858804e-01   -2.372946022877018e-02   +3.582850032565263e-02   -6.342430550475540e-02   +1.075047330456988e-01   -1.804725505236894e-02   +3.592853905759217e-02   -6.025542809693916e-02   -7.798096071249916e-03   +6.659463018020018e-02   -6.055940929703493e-02   -3.210371750630547e-02; -5.943634605958479e-02   +1.725878859726062e-02   +5.206331692448284e-02   -1.596840998980635e-02   +5.435932703969257e-02   +1.906308325551874e-02   +3.777710254936914e-02   -3.906077403427190e-02   -7.697306110199338e-02   +7.407469437076739e-02   +2.864538910339134e-02   +3.424141100426790e-02; +8.522812403890578e-03   +1.047239010840987e-01   -3.351216661222941e-02   -2.259877156113977e-02   +2.084398805810129e-02   -5.319813442319597e-03   +4.468437952586155e-03   +3.491231060504267e-02   +9.553790878924988e-02   +1.129190780871703e-01   -1.271561218551649e-02   -5.342709949535344e-02; +2.651152915541109e-02   +4.236286086299805e-02   +3.155100969077626e-02   -7.393781294101220e-02   +2.404202060972645e-02   -1.901138979020502e-02   -2.911055454563639e-02   -3.224939338061445e-02   +3.689791977541377e-03   +7.104740203094578e-02   +8.412230883403368e-02   +5.313411145109517e-02; -7.692495472035665e-02   +6.005609306505370e-02   +1.842691686492259e-02   +6.381073575739567e-02   +6.982120506825115e-02   -7.804901765578409e-02   +1.933911826940686e-02   -1.244082643948534e-02   -3.094408300376132e-02   -4.328941820016680e-02   +5.242145187105435e-03   -8.505820120972468e-02; -3.872288200516431e-02   +6.532918667414858e-03   -9.667961260803579e-03   +3.957903938245842e-02   +1.794170373346140e-02   -7.421067988593590e-02   -5.105516828929048e-02   -1.249649676513483e-01   -2.682280472965593e-02   +9.122327018999579e-03   +5.094472238934958e-02   -1.732082852909865e-02; -3.754586988912471e-02   +3.978174669093668e-02   +2.923399494607169e-02   -4.590124301979738e-02   +1.094663829163653e-02   -8.422322238238625e-02   +4.208092923687899e-02   +7.530622385594271e-02   +6.361738168471315e-02   +8.966475245113373e-02   +4.609722552735716e-02   -5.055714904806159e-02; +1.060103738960796e-01   -4.683563152441395e-04   +1.002914705042978e-01   -2.107741487667514e-02   -1.933112453566448e-02   -1.161784813622994e-01   -3.510963373430608e-02   +5.312710715047659e-02   +9.052213335362663e-02   -9.710584981632321e-02   +2.375915771011339e-02   -2.642301077876013e-02; +1.503884074094804e-02   +6.565234573834772e-02   -4.962198146519655e-02   +5.883208379438089e-02   -2.298404390966210e-02   -7.398852642815701e-03   +1.523164594807179e-01   -8.749678136587855e-02   +3.846467693422042e-02   +2.581446125017153e-02   -6.284093651035613e-02   -5.520124982258152e-02; -7.262745033057516e-02   -4.586980882638256e-02   -5.027297292806674e-02   +2.821555963250802e-03   -1.614305765061951e-02   -5.930917200547634e-02   +5.503327278403448e-02   +2.258429269269571e-03   -7.509734084273138e-02   +5.970616101603984e-02   -3.919270775791084e-02   -2.912653412591424e-02];
L2E_Input1_iAMPA_netcon = [+8.248842755475926e-02   -1.068464967172377e-01   -6.493684545886007e-02   -2.493042817270269e-02   -8.548640887064316e-03   -6.736182259723919e-02   +5.927088856412430e-02   +8.749030215700568e-02];
L2I_Input2_iAMPA_netcon = [+8.648360565953081e-02   +1.016553849550449e-01   +9.443176635680400e-02   +1.037796492343793e-02   -5.263731388144825e-02   +3.857672593497959e-03   -1.932760386691776e-02   +1.074773772273974e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
