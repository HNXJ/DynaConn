function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.310572263562486e-01   -1.811531595904531e-01   -6.180054125186045e-01   -6.394476035387008e-01   +2.360731573881105e-02   +4.964695643127889e-01   +6.728659295200641e-02   +8.699782923261982e-01   +1.894953279748369e-01   +2.579605263329737e-01   +3.498409956024038e-01   -3.964939396864100e-01   +1.622305704767308e-01   +3.368249552987252e-01   -4.924605830721365e-02   +2.384537403722554e-01; +6.739589632071343e-01   +2.533245253202441e-01   -3.373974177491428e-01   +1.518628387650598e-02   +1.125975273454645e-01   +1.348891387484864e-01   +1.982443552174361e-01   +1.375583317290822e-01   -1.619834142287871e-01   -2.971399994699502e-01   +7.129219242906319e-01   +3.216357486602198e-01   -1.947974414951742e-01   -2.241789566051953e-01   -2.387629517775473e-01   -4.213767839522211e-01; +2.384792500386273e-01   +6.322469565242795e-01   -1.513348627772413e-01   -1.552986600315402e-01   -4.360416627368392e-02   +8.403869065627963e-02   -2.310470141442135e-01   +2.920459715125431e-01   +3.983266187859880e-02   -1.262116584832801e-01   -8.682360232610817e-02   -2.577663691852327e-01   -4.016051284940583e-01   +3.558240178772878e-01   -3.930362760207699e-01   -8.871316000466261e-01; -5.633336385062133e-01   -1.193119513378325e-03   -1.300866704068494e-01   -3.016536031191391e-01   +6.840567817215599e-01   +4.726150853258946e-01   +8.228462498145053e-01   +3.845087534030082e-01   +9.260018503200720e-02   +1.614984248072058e-01   -5.846408478389437e-01   +7.700870088698004e-02   +7.134083517855298e-02   -2.401103789473653e-01   -3.432137051391941e-01   -2.861326303726254e-01; -4.594082968952679e-01   +3.172199884473731e-01   +3.814109107928912e-01   -2.068608160027862e-01   -4.290579194957931e-01   -8.577556746079859e-01   +3.816352408208876e-01   +1.728259186695095e-01   -6.674719008984913e-02   +2.660498499587255e-01   -2.505764807782085e-01   -2.210475936390801e-01   +3.775330769761333e-01   +9.113099495684613e-01   -2.730840493795929e-01   +6.898201823714585e-01; -2.233831185948551e-01   -5.786450611961076e-01   -2.383286990816949e-01   +2.234982130272242e-01   +7.660192241617596e-02   -2.848182564588805e-01   +4.517320934580918e-03   -4.356655947480773e-01   +2.406765220664519e-01   +4.348436133984457e-01   -1.893734124784952e-01   +4.934910458549042e-01   +3.803007342625574e-01   +5.551394132995551e-02   +2.186440770969180e-01   -2.197310904071403e-01; -7.044102696543173e-01   -2.000056915986063e-01   +6.498015836376435e-01   +2.494495884538773e-01   -1.717844857661713e-01   +2.042122226225830e-01   -2.135774664976275e-02   -1.129417914891034e-01   -8.784020773105342e-03   -2.166072594392793e-02   -6.767385473597598e-01   +3.345410629044134e-01   -1.008980470057603e-02   +7.739402335462919e-01   -8.676198015537648e-02   -4.607630653028620e-02; -9.242690553919912e-01   -4.691536998020761e-02   -1.008360090207550e-01   +3.618961582275053e-01   -4.407343342406865e-01   +3.299573987203070e-01   +4.249934968492931e-01   -5.927060347027937e-03   -5.602840808734486e-01   +2.733454891280678e-01   -2.698344794256564e-01   -2.739649196947654e-01   -1.188159197900751e-01   -8.652746114390689e-02   -7.810960696500058e-01   -3.818433799461066e-01; -2.896502427976307e-01   +5.124172518732219e-02   -8.083498307710277e-01   +5.941386513386375e-01   +7.137305538534395e-01   +2.063264737271973e-01   +2.290021728316701e-01   +3.634730353759267e-01   +7.907998264097365e-01   -6.354862882265206e-01   -5.213542064431816e-01   +2.688746802783049e-01   +4.998601846703385e-01   -1.900242705344110e-01   -1.878097433519110e-01   -2.277082824326405e-01; -5.314653986257079e-01   -3.222015500235130e-01   +9.066612326561779e-02   -3.401455580689823e-01   +4.262681338940635e-01   +1.615883083337956e-01   -1.730126725748005e-01   -5.574056255824285e-01   +2.857154634387956e-01   +1.122973844673749e-01   +2.634426465882692e-01   -4.831318266658804e-01   -1.804790721894246e-01   -5.785989329869193e-02   -1.129794512536744e-01   -4.611474115917132e-02; +3.978773175788120e-01   +3.369168457858110e-01   -6.137543837657153e-01   +2.371171079300238e-01   -1.730952039670745e-01   -5.737840867964135e-01   -2.953934215569782e-01   -1.011891548502757e-01   +1.493769590960844e-01   -2.364436594716619e-01   +5.271359038741631e-02   -3.645288663715569e-01   -3.376217885291306e-02   +5.900095580224259e-01   +8.486837370701082e-02   -6.864159131221323e-01; -4.333229493233220e-02   +9.054914011114158e-01   -7.727855237654890e-01   +3.302405805301354e-01   +3.352774902817343e-01   -1.316383414697908e-01   -1.489991835859156e-01   -1.017573906225089e-01   +1.358572805925547e-01   -3.620151597949671e-01   +6.155558138042110e-01   +2.120217627363289e-01   -1.961348127632638e-01   +3.574041082603825e-01   -2.267862160418723e-01   +5.336891538185251e-01; +1.932559503202855e-01   -1.683535933177532e-01   -4.100215452101031e-01   +2.957307215095654e-01   -3.674671398077366e-03   -2.137274272929493e-01   +1.375910924143539e-02   -1.058231919587743e-01   +2.964228033806313e-01   +5.061032812523861e-02   +3.779565379963535e-01   -4.635533849430447e-01   -5.403650846216107e-01   +9.881766644493307e-02   +4.017707156840081e-01   -1.597277323369400e-01; -2.031392045948275e-01   -3.005642839536528e-01   -6.129948776743338e-01   -3.498498437354144e-01   -3.889911525286813e-01   +3.347948135062069e-01   -4.539372351149980e-02   +1.107254153183471e-01   -8.418851386698940e-02   +6.067473539072780e-02   +5.781452494067213e-01   -1.691960552896491e-01   +3.428491784255197e-01   -5.701418813893490e-01   -3.328997739621900e-02   +2.224834640874373e-02; +5.201211081115522e-01   -7.344721029117995e-02   +9.087362930409933e-02   +2.593491431777947e-01   +4.280117454078034e-01   -2.045580504859291e-02   -1.034274358906576e-01   +4.504566937670952e-01   +4.597696329239202e-02   -4.997285398650340e-02   -4.971663429648285e-01   +1.000000000000000e+00   +2.419031246634596e-01   -9.374819932939102e-02   -3.521739029176344e-01   +2.670116376579804e-01; -4.008682479957482e-01   -6.679717577310591e-01   +2.660168704674425e-01   -9.387720742766566e-02   -2.654013350225320e-01   +6.305860147087951e-02   -2.639086992602438e-01   +1.304429845326941e-01   -2.519395714156901e-03   -5.613313087132180e-01   +3.432397234899460e-01   +1.995439788503264e-01   -6.892345505037774e-01   -1.526847318266034e-01   +1.934025235922420e-01   -3.089593094119521e-01];
L1E_L1I_iGABA_netcon = [-4.041705633906867e-01   -1.196011784828132e-01   -2.280075153887709e-01   -7.211901041371202e-02   -6.763314843763624e-02   +2.132079942802093e-01   +7.033185839335744e-01   -2.030519443737826e-01   +1.475532842866433e-02   -5.766918756322713e-02   -2.909518273300991e-02   -2.983478313361962e-01   +3.332172059238587e-01   -5.861180207523888e-01   -3.149637588764984e-01   +6.158677121845304e-01; +1.090737452021929e-01   -7.556247161948347e-01   +3.932725130240461e-03   +5.647473155399167e-01   +2.841072125757546e-01   +1.926138373439771e-01   +5.149035013257537e-01   -1.131545474201083e-02   -6.851857384017289e-02   +5.135811310550564e-02   +3.207241488304753e-01   +2.771582216542556e-01   +2.010130529701352e-01   -4.715258918742149e-01   +2.641514438117389e-01   +3.066051644163468e-01; +1.586579667540543e-01   -5.235598993811270e-01   +5.065580804628326e-01   +3.885230657446449e-02   +1.117870866737788e-01   -1.728876900348604e-01   +5.007831961965160e-01   +7.232380922249787e-01   +1.937687636083441e-01   -9.324577230973617e-02   +1.442447363325666e-01   +9.309995986621787e-02   -4.913486187226551e-01   -6.886762272436435e-01   -4.457486556000251e-01   +6.041297591701401e-01; -3.703569584530693e-01   +7.520813985785683e-02   +3.043883497685493e-01   +9.002750989814677e-02   -1.449014661558622e-01   -7.032092788896775e-01   -1.300271090515278e-02   +1.808000603458363e-01   -1.591807396542347e-01   +1.000000000000000e+00   -5.889086314859472e-01   +4.793418494319153e-02   -8.053257604225202e-01   -1.090429678783783e-01   +3.682049637281653e-01   -1.883105683393423e-02; -9.753356319930993e-02   -7.397434108751283e-01   +1.168048061877847e-01   -1.367334599619756e-01   +5.126062189679236e-02   -2.741962112640307e-01   +2.265640027649014e-01   -4.320625482634390e-01   -3.404509009633665e-01   +2.549514383131608e-01   +9.487071203417483e-02   +1.239685211567044e-01   -1.126034385737260e-01   +1.877358947245397e-01   -8.928783846844290e-02   -1.269433341710351e-01; +3.285509088943238e-01   +1.156896008133838e-01   +4.664534218830168e-01   -3.490565091847684e-01   -4.591604095049003e-01   -2.174262807148017e-01   +8.914038996780133e-02   -7.307985308925117e-01   -2.250152428490572e-01   -1.854889911750277e-01   +9.451759693504570e-01   -2.454316876273685e-01   +4.584364132253599e-01   +4.413432906557231e-01   -5.497705391773450e-01   +3.655891555108656e-02; -1.331240925589003e-03   +8.430400670126886e-02   +7.275176631803662e-03   -1.316333288999217e-01   -3.752665233620550e-01   -3.666370182495166e-01   +9.881113903157292e-02   +3.730220350511240e-01   +1.990732531475337e-01   -6.722911382796423e-01   -8.520570142868669e-02   -5.270935960112384e-01   +4.869657479175794e-01   +3.274659461995763e-01   -5.405446900798415e-01   +4.756591347784699e-01; +3.739016620809006e-01   -1.181942634352957e-01   +3.570659463463205e-01   +5.674310424936216e-01   -5.902641200401672e-01   +1.125628634105161e-01   +5.975098593763847e-01   -7.515814531123748e-01   -3.199801133765094e-01   +7.689283202522247e-03   +1.689218113032391e-03   +3.015530127128383e-02   +1.134425797368788e-01   +3.178739643664759e-02   -2.811495588876566e-01   -4.417946827132915e-01; +4.078192889923304e-01   +2.813921831897803e-01   +2.646537354518325e-01   +4.431918437085149e-01   -2.553658143406631e-01   -2.266149884067848e-02   +4.559144621492391e-02   +4.551873335797669e-03   -2.931260088429628e-03   -3.265807672178311e-01   +3.868093571118227e-01   +4.878995797453213e-01   +1.587201988177905e-01   +2.355812912560055e-01   +6.813747920656482e-02   -2.239018861305354e-02; +6.144195764145007e-01   -1.936613698751705e-01   -6.576846797421211e-02   +5.103462565273325e-01   +6.471990987042284e-01   +7.728922907967527e-02   -2.294385418901048e-02   -2.201137836306780e-01   -3.082665782032928e-02   +4.356768802624211e-01   +4.122137640899026e-02   -6.885899184914022e-01   +1.483794755962332e-04   -2.740733452250657e-01   -2.640584094360550e-01   -3.553342650981188e-01; -2.883158837122061e-01   -1.356670369521563e-01   -1.159897851941867e-01   -2.249941620449159e-01   +4.524376412656740e-01   -4.849140573953926e-01   +3.333035727241039e-01   +1.459198778247704e-01   -2.101479907150181e-01   -2.471450670342115e-01   -8.028530992875478e-01   -2.161072137761046e-01   -1.080544636384849e-01   +1.971731104519068e-01   +1.904670446111635e-01   -1.958047298797492e-01; -2.426911507800813e-01   +1.074794260415405e-01   +1.763060579320817e-01   +9.295301117615359e-02   -1.088520212696931e-01   -1.878766939079538e-01   +6.339919279466393e-01   -5.300666460668318e-01   +1.507272910346673e-01   +7.253957166943469e-02   -1.596052378737727e-01   +5.824376611816001e-01   -1.514219167032349e-01   +2.570506382052739e-01   -2.787440733744155e-01   -5.933058412560950e-01; +6.929935988848720e-01   -2.379788827611466e-01   +5.908397896435840e-02   +5.228273367029832e-01   +2.900398898200668e-01   +1.763925535589388e-01   +9.218021484946427e-02   +2.913378234553537e-01   -1.806848440593455e-01   +5.508036013971140e-01   +2.176270682894365e-01   +1.900694328421565e-01   -4.778388086962173e-01   -9.831724191366324e-02   +6.102112513102911e-02   -6.114473315753267e-01; -6.602613144333133e-01   -3.409416869674207e-01   -7.244225026446219e-01   +4.219403318069255e-01   +1.360968768645766e-01   -1.709372422152191e-01   -3.080423871767170e-01   +3.485886968149018e-01   -4.054065642497133e-01   +6.054955938925212e-01   +1.940731518966397e-01   +4.120263285446735e-01   -1.152878163260312e-02   -9.886939133252134e-03   -2.036228296458981e-01   +6.770154565558935e-01; +1.224272720413929e-02   +3.860702728167399e-01   +1.361218008671914e-01   -7.565192604962728e-02   +4.550647564356209e-01   -4.592131274719305e-01   -7.712687359294174e-01   +5.714739712733428e-02   +2.379829243945592e-01   -7.794609394755713e-04   +8.835309987034029e-02   -1.552238715156120e-01   +1.599799153615437e-01   +3.215817213698408e-01   -5.647874997001059e-01   +2.546610210374617e-01; -1.663470771290756e-01   +1.525675183245062e-01   +2.789207386111048e-01   +1.950656373288931e-01   +5.408694615756953e-01   -4.289571012271286e-02   +1.435534596423435e-02   -2.829150791457011e-01   -7.583790050501010e-02   +4.029241991701303e-01   -4.715689266733979e-01   +4.148913570621416e-01   +4.688602139042613e-01   -3.069355527675022e-01   -5.804597471432908e-01   +3.507854251981430e-01];
L2I_L1I_iGABA_netcon = [-4.745124661574535e-03   -4.903552692961228e-01   +3.547085922213719e-01   -2.195368079131410e-01   -4.809801674305419e-02   +2.745726750208753e-01   +3.828660626872923e-01   +3.539691107829117e-01; +3.451918764910679e-01   +3.842355299337806e-02   -1.418694924096081e-02   -3.732697450245326e-01   +1.910423119938296e-01   +1.880292236475603e-01   +7.307124719681016e-01   +6.414498492430796e-01; +3.920666670576725e-01   +1.106795743738151e-01   -5.176046886861524e-03   +4.788605506599797e-01   -6.156232984056982e-01   -7.557716606624840e-02   +2.366778172214125e-01   +4.623305997883550e-01; +5.185592802228501e-01   +1.728602799081111e-01   +6.471286561150607e-01   -7.420303305500203e-02   +3.749560975120365e-01   +6.845815265631074e-01   -1.637180583674349e-01   -3.211119533427007e-01; +1.425212122482842e-01   +7.484250827752947e-01   -8.588380071734816e-01   -4.220063505600214e-01   +5.252817676443138e-01   -5.796975354234262e-01   +1.000000000000000e+00   -6.802034052341750e-02; +8.213777809852004e-01   +2.248446987812589e-01   +2.051980902227063e-01   -3.731360850850828e-01   -1.968276997693260e-01   -3.365634704824921e-01   +2.050100760614929e-01   +9.304529031183624e-02; +6.531306918595462e-01   -7.665073925638204e-02   +1.068852083925636e-01   +2.110721686324913e-02   -6.281970648855597e-01   -4.848986962276981e-02   -2.889194576093240e-01   -3.211010553834790e-01; +3.542836550155085e-01   -2.064102976080166e-01   -7.038683679873999e-02   +4.042441531807432e-01   +2.562796455988712e-01   -1.545755177088201e-01   +2.815224946869148e-01   -1.434695386403483e-01; +6.104772036976683e-01   -3.694812358812856e-01   -2.947305285985196e-01   +4.804591859812209e-01   -1.298672961053688e-01   -2.978816030524997e-01   -5.414034009244275e-01   +8.447633602339154e-01; -5.770773665202040e-01   +2.093034992594175e-01   +6.919587127348105e-01   -4.619594514191461e-01   -7.976688974893409e-02   +5.059717503656703e-01   +4.407195515380801e-01   -6.406547996558216e-01; -6.670227156316533e-02   -8.932428826524692e-01   +2.965952932396200e-01   -7.016838105872822e-01   +1.044189748616573e-03   -1.412903046313756e-01   +5.159552240061805e-01   +4.396306531328577e-01; +4.086659208700117e-01   +6.555418507609485e-02   -4.772766480624875e-01   -6.216987135395156e-01   +4.086205162949731e-01   -1.800927756362137e-01   -8.326595730622187e-01   +2.691067848311594e-01; +5.234585418523345e-01   +2.558953802468091e-01   +3.492246803050579e-01   +4.312973569594754e-01   +3.480131673756340e-01   -1.536751623644796e-01   +3.389241149152437e-01   -3.073121823753459e-01; +7.131301201280305e-02   +1.245217395461915e-01   -2.883182133571563e-01   -7.330563034218825e-01   +1.498348156980588e-01   -2.142753454230351e-01   -4.943594190494181e-01   -1.462374811108084e-02; +6.882251571249878e-01   +2.423649995117746e-01   +9.432290301621400e-02   -5.742847478897524e-01   -1.328434284873282e-01   +1.648214814257691e-01   +3.223688143424548e-01   +9.275689690664702e-01; -9.288770012475634e-01   -5.958229145986879e-02   +5.423081255052443e-01   +3.410123757341004e-01   +5.273647776506011e-01   -1.965735515688035e-01   -6.859066697151179e-01   +2.806429629483178e-01];
L1I_L2I_iGABA_netcon = [-2.362673217214799e-01   +4.838472098065928e-01   -6.904893925234165e-01   +1.397773362185796e-03   -1.206336862109795e-01   +5.398431262010754e-01   +1.190208880261222e-01   +4.354371273923399e-01   -1.441001902040787e-01   +3.691756439037939e-01   +2.782391009471902e-01   -7.526212026844546e-01   +2.445271789386773e-02   -5.922491916457580e-01   -5.920265206544484e-01   +3.312671763183586e-01; +2.297130352810348e-01   +6.727176832050435e-02   +1.000000000000000e+00   -3.285792291880400e-01   +1.214607528902326e-01   -1.143532104219566e-01   +6.307124635409209e-02   -9.057364051351199e-01   -4.435867697775717e-01   -6.095347767815334e-01   -1.775164448589559e-03   -7.351451352643420e-01   -2.804609775856505e-01   +1.962359121621714e-01   -6.122007310577786e-01   +5.512271184930915e-01; -1.118539709037460e-01   +6.106189347016923e-01   -1.963902970783732e-01   +5.172048656622181e-01   -3.145989174690489e-01   +2.127737648522092e-01   -2.072408117456475e-01   -1.729256269099613e-01   +5.846098694198591e-02   +2.414545005128343e-01   +2.788922149505618e-01   +6.440310181532002e-01   -3.908685157896661e-01   -3.373209201071850e-01   +4.757528501982128e-01   +2.247445760984098e-01; -1.533923428152933e-01   -7.931341160869021e-02   +8.292209258689128e-01   +2.847967437253389e-02   +2.036200216023234e-01   +8.757847122234367e-01   +3.831080946451345e-03   +2.622862650315472e-02   -4.683644847685715e-01   +6.226471113159500e-01   +5.079981502914758e-01   +2.315892027759419e-01   -1.357959990221455e-01   +1.914840762744543e-01   +5.356308768517803e-01   +4.121920778866502e-02; +6.254366676039345e-01   -5.319641114358247e-01   +4.838064843489315e-01   +4.382667994497100e-01   -3.887969957402928e-01   -9.844409336361239e-01   -6.192083618350894e-02   -4.406075787022137e-02   -1.460967727627787e-01   +1.202565995587037e-01   +1.765386034750782e-01   -3.924033849033418e-01   +6.042818276458722e-01   -2.124701591302735e-01   -1.930849512874479e-01   -5.116597151967003e-02; +1.934191754529916e-01   +2.943468831834222e-01   -2.236703407027511e-01   -4.293371524591771e-01   -5.793041965850607e-01   -3.182148286387108e-01   -4.725489636858343e-01   +4.844895062794747e-01   +1.932970700552752e-01   -3.503174902460907e-01   -5.272481434418039e-01   -4.630312641162144e-01   -3.780203182682663e-01   -1.236588535847717e-01   -6.876509085916114e-01   -1.206332428714220e-01; +3.763067007989658e-01   -2.291651752942464e-01   -1.105131693615072e-01   -6.539732124610447e-01   +6.931350364852550e-01   +7.980842612301767e-02   -5.059611416089966e-01   -1.333001733013454e-01   -1.165926519537794e-01   -1.028914341730666e-05   -3.065105791562576e-01   -5.999210321066929e-01   +3.554491114419743e-01   -1.098732534366970e-02   -1.288268952864447e-01   -6.101335611705324e-01; +3.111367511299836e-02   -1.308103350243428e-01   -1.561697872602230e-01   +4.562607043756149e-01   +2.105890572971052e-01   +2.183672186629531e-01   -6.545914524102184e-01   +5.291509873564839e-01   -1.562686525191159e-01   +2.391739071795287e-01   +7.796226850841670e-02   +1.195664910843572e-01   -7.242850274563607e-01   +1.170379927199634e-01   -2.193666904191759e-01   +9.115355636407307e-03];
L2E_L1E_iAMPA_netcon = [+4.477762975446573e-02   +6.925754698495403e-01   -1.518166060402839e-01   -3.775511375888457e-01   -6.377230450534040e-01   -1.263777849710888e-01   -1.780606883973586e-01   +4.219981690171117e-01; -7.659830702246537e-01   +4.221038154316398e-01   -5.509594484102042e-01   +1.696697190266619e-01   +2.361321788419762e-01   -3.641816243326281e-01   -3.855512367843504e-01   -3.715558949142447e-01; +1.856127378377896e-01   -2.041085521247951e-01   -3.753321584968988e-01   +1.535855329801183e-01   -5.523652148387025e-01   +4.712225704186755e-01   -3.748688363786412e-01   -5.006282359790244e-01; +2.223087852459089e-01   +4.532813710269863e-01   +2.239235301639655e-01   +3.546516006578129e-01   -6.520719452873770e-01   -7.788306985384170e-02   -2.741458111817381e-01   +2.472503534440228e-02; +7.594959259218380e-02   +8.472918906053285e-02   +4.158014471309344e-01   +4.078278786350001e-01   +8.806236629840612e-02   +5.066671191839466e-01   -1.613373853536049e-01   -1.734504317591042e-02; +7.157526287468212e-01   -3.036163025800742e-01   +2.330788434684219e-03   +1.586574828115999e-01   -3.448605768395834e-01   -5.517775743272362e-01   -1.135596383625516e-01   +8.892903576460187e-02; -9.343300005823570e-01   -1.728041991198080e-01   -1.546559707416815e-01   +4.412123059487868e-01   -3.649225884861084e-01   -2.361859545426246e-01   +8.585190134469575e-02   -1.263332819953833e-01; +3.987516173101014e-01   +3.095321640344008e-01   -1.309828431856830e-01   +1.727165924250327e-02   -1.000000000000000e+00   +6.005581429631670e-01   +1.784045952903209e-01   +9.028622282525267e-02; +5.367620264418462e-01   +5.054405810809706e-01   +1.282558469344660e-01   -5.665772805149586e-01   +1.244980902651151e-01   -6.166378092418510e-01   +3.545408358002389e-03   +2.915853623096778e-01; -2.294601087598218e-01   +1.484112865263719e-01   +7.216746105048119e-02   +2.807852970558457e-01   -2.128834405750209e-01   +2.979163799781108e-01   +4.283174599351766e-03   -3.553076174081241e-01; -2.136534084683753e-01   -4.454031509122441e-01   +8.695422955350198e-01   -7.418965132708881e-01   -3.183083227461624e-01   -1.256739440832301e-02   -9.061324824910789e-02   +3.300576798987173e-01; -2.680736208578368e-01   +1.993959569727830e-01   -4.948818544276917e-01   +5.784005359283693e-01   +1.486748005386921e-02   -1.169631507639988e-01   -5.984824389421142e-01   +1.629507465141549e-01; -6.357238156297808e-01   +4.326480046169283e-01   +2.565449666117611e-01   +3.605451416208335e-01   -3.217655733443184e-01   -5.822905301900242e-01   -1.268265460199735e-01   +1.816426221205528e-01; -5.534809973476804e-01   +3.738809327530055e-01   -4.069051819761298e-01   -8.695608632259115e-01   +4.881866425113543e-01   +2.508913017862867e-01   +5.297693987582577e-01   -4.617970259029353e-01; -5.237022059436968e-01   +3.451841472117807e-01   +1.250771956746672e-02   -3.358273282131593e-01   +2.269246253667927e-01   +4.824627584693048e-01   +8.670790436959999e-01   -3.020284254813856e-01; +3.401825049781970e-01   +3.717336823296677e-01   +2.076633250090272e-01   +2.737592539009726e-01   +6.243275823424602e-01   -1.061973994590499e-02   +1.404039637271608e-01   -3.898378777060481e-02];
L1E_L2E_iAMPA_netcon = [-1.431289832708323e-01   -4.091321476846959e-01   -9.678315708676398e-02   +7.337625000742622e-01   +8.722954074240735e-02   +2.784751652743840e-01   -6.064314888538971e-02   +2.043345725447929e-01   -3.033543643865332e-01   +1.087116453397911e-01   +2.884731156676524e-01   -2.163772942166252e-01   +1.090482247523723e-01   +3.411055025490757e-01   +4.699343291937839e-01   -3.310976184122225e-01; +3.671026345608674e-03   -4.932944126746006e-01   +1.103899275464757e-01   -8.395089685602408e-01   +1.786359557217478e-01   -5.704396760014770e-01   +9.907062817626253e-02   +6.766161833811006e-01   -1.599451906941392e-01   +1.150751165907850e-01   -1.312852702510341e-01   -6.453689726858558e-01   +6.316598837888721e-01   +1.277861218480784e-01   +2.964491730211525e-01   -3.644648151944955e-01; +5.772332795496595e-01   -1.845831582935031e-01   +2.510369230091033e-01   -2.009446345499208e-01   +3.289509238422569e-01   -1.553337779930271e-01   -4.266793751010858e-01   -8.522586675362855e-01   +5.282323882983488e-02   -6.590407635006124e-02   -5.742424993242234e-01   +2.778490661443872e-01   -1.086943603371902e-01   +8.211402718077021e-01   +6.218300538970541e-01   -6.203118065239302e-02; -8.570111356354544e-01   +3.684988370922315e-01   +6.884844263147635e-01   -5.100161331795360e-01   +5.231961424539686e-01   -4.779025947201616e-01   +6.492904115515506e-02   +2.500765931744175e-01   -1.163473117505571e-01   +4.155823526760918e-01   -6.180504687833661e-01   -4.795285973174854e-02   +8.294371942384707e-02   -9.720533828999234e-02   +1.457192208573515e-01   -1.093272052465032e-01; -4.111763559889453e-02   -1.466522415830730e-01   -2.369481613042371e-02   -9.151531671942675e-02   -6.123939489343333e-01   +4.150954640847390e-01   -4.573116326269293e-01   -8.328718626807778e-01   +1.279863605453043e-01   +4.232445438236921e-01   -4.756704389177924e-01   -2.516944955539259e-01   -3.805194357703232e-01   +3.000495129527286e-01   -5.310292501298083e-02   -6.536956933016940e-01; +2.393406471961744e-01   -4.924057074023059e-01   -2.814048276396992e-01   -2.877832519160566e-01   +7.997722313032722e-01   -8.040366375744588e-01   +3.259915531108825e-01   +7.864711004095937e-02   -1.417114238991368e-01   +2.280294322197239e-01   +1.279453151686593e-01   +2.128648264974112e-01   +2.017807849200193e-01   -4.823717905520347e-01   +4.007400245856296e-02   -2.399304052586806e-01; -9.381202317626230e-02   -3.030486681873850e-01   -3.609049357402350e-01   -1.220826568719731e-01   -5.724187929330499e-01   +1.915723452347107e-01   -2.849313028809666e-02   +5.318985725964509e-01   +4.223443509421302e-01   -5.657351264868542e-01   +6.353302020454094e-01   -7.046549732678344e-02   -6.108421642805795e-01   +5.711215576994555e-02   +2.086774699403974e-01   -6.321540074251216e-01; +4.501167051215068e-01   +8.829814762264632e-03   +2.239211267097974e-01   +5.058593213581506e-01   +5.052401003766495e-01   -6.023128009480644e-01   +2.790203374845440e-02   -4.323020131635056e-01   -5.299573721985610e-01   +5.482751042481779e-01   -1.787397726472330e-01   +3.813187346895267e-01   -5.992335058513856e-01   +4.345994638023776e-01   +1.037530406066519e-01   -8.456137459705376e-02];
L2I_L2E_iAMPA_netcon = [-4.563162327877168e-01   +4.145558959114543e-02   -2.954700194592935e-01   +4.324469467973645e-02   -8.044020239814766e-02   -1.169941642724564e-01   +3.004303856158982e-02   +4.332122848172921e-01; -1.696140713451572e-02   +3.134947216617230e-01   -5.465282056635551e-01   -1.098875117060339e-02   +2.548548167949894e-02   +3.127633041830642e-01   -2.151660558760038e-01   -3.133680361528597e-01; -6.765886369299864e-01   +4.002704426889275e-01   +7.073350303920536e-01   +3.048118565040434e-01   +1.370553681984353e-01   -2.007740698715286e-01   -3.907798621089007e-01   +3.821667402180414e-01; -1.405218444914981e-01   +2.636296432733630e-01   +1.371425825657479e-01   -2.463636910892900e-01   +1.000000000000000e+00   -1.731360337692137e-01   -8.140176269062671e-02   +9.186517122237924e-02; +2.513198947351616e-01   -3.973809988525115e-01   +3.590046397269598e-01   +2.746887198687013e-01   +3.549550179026085e-01   +9.154416169530914e-02   +1.916025597669452e-01   +5.993962121278652e-02; +4.991128760220476e-01   +4.127778018023268e-01   +3.437411680143384e-01   -5.376625420344466e-02   +7.182514374279035e-01   +2.219334383023491e-01   -2.039485698003676e-01   -4.166690100516541e-01; +3.393670107335116e-01   -1.789593400430401e-01   -2.860105480219998e-01   -3.239041321965949e-01   -5.827719942681433e-01   +4.449344464985464e-02   +3.734319431627140e-01   +3.088638070417458e-01; -4.078236441511061e-02   +4.541577328424889e-01   +1.548619577044048e-01   -5.189122099308610e-01   -4.618595128541101e-01   -6.041303454867132e-01   +5.411912329938733e-03   +1.979353656455359e-01];
L2E_L2I_iGABA_netcon = [+1.300245364556894e-02   +2.178300228949116e-01   -1.090587765196611e-01   +5.635043762151543e-01   -7.866851418519723e-02   +1.140570728115629e-01   -2.442726623328045e-01   -1.202759569306029e-01; -2.722187462977058e-01   -6.491454209863678e-02   +5.261032630081348e-01   +3.057800881623755e-01   +3.566111677318097e-01   +3.570915563124728e-01   +9.936129013005565e-02   -1.345878447729042e-01; -1.045846274123782e-01   +3.577295692306160e-01   +2.202108417361189e-02   +8.589073709075121e-01   +5.900112959986838e-01   +4.958824689268550e-01   +5.503262956323354e-02   -6.152105538661983e-01; -3.153690688907439e-01   +3.918332461028017e-01   +4.991557195416169e-01   -4.854645873152901e-01   +4.973625126247496e-01   +5.488443577640197e-01   -2.578905613068211e-01   +5.851785951955750e-01; +1.000000000000000e+00   +8.149914716181780e-01   -2.151213270632396e-01   +5.258322445847839e-02   +7.652286122142969e-02   +1.061944817841230e-01   -5.214746707896039e-01   +5.783888456155392e-01; -9.562385933201442e-02   +6.105326800842613e-01   +3.376290049309069e-01   +1.890468293463087e-01   +3.734494678776027e-02   +5.972179023025009e-01   -1.341700902089066e-01   -2.309497830758904e-01; -5.030134671635360e-01   +8.360540966406205e-02   +5.652540981519879e-01   -4.087935562019196e-01   +4.502274893832105e-02   -8.607273315955740e-01   -7.732856869942355e-02   -7.240179473816238e-02; +2.459130528819897e-01   +2.468752607998047e-01   +1.765680870914632e-01   +4.751076051935663e-01   -3.826981080868579e-01   -4.212357211580254e-01   +2.334054700384927e-01   +2.123772134723358e-01];
L3E_L2E_iAMPA_netcon = [-1.412539138291024e-01   +2.417563775976329e-01   +2.520796533604399e-01   -3.467614671141384e-02   -5.606088764003281e-01   +3.599402305596447e-01   -1.991406391495060e-03   -7.528012971969671e-01   -6.718801923140194e-02   -4.116595687709202e-01   -2.313598024922712e-01   -3.704713402433479e-01; -9.144438136776141e-01   +2.161454746430044e-01   +5.779915499492105e-01   -2.753876170506995e-01   -1.777439987880618e-01   +1.000000000000000e+00   -3.496326105145480e-01   +2.895838253356211e-01   +4.421676214120898e-01   +2.696231448550197e-01   -2.915457217430410e-02   +8.000056557472809e-01; +2.490974960501072e-01   +3.165638789492197e-01   +1.784203489501478e-02   -1.379236539179160e-01   +1.229089060213468e-01   +2.870029276018840e-01   +4.654174362589417e-01   +4.760388000183413e-01   -2.759306585113004e-01   +2.819596051417279e-01   -6.278350334840890e-01   -4.678770907443596e-01; -4.267191732735565e-01   +2.751326693361987e-02   +1.930470525533803e-01   +1.411723865923130e-01   +4.166741878147637e-01   -1.303379470380936e-01   -6.039462874181114e-01   -4.969459536189631e-01   +2.612755127660446e-01   +6.847686490175648e-01   -4.891620088344706e-01   -4.474050096968369e-02; +8.369329991386303e-01   -7.275035727156800e-01   +6.861822562462019e-01   -5.119773385103117e-01   -1.043437909100016e-01   +1.879716247057407e-01   +7.592726174579481e-01   +6.118097645507861e-01   -3.520651623193490e-01   -5.859793119342276e-01   +1.307787846626352e-01   -6.813972114149346e-01; +2.895042494472517e-01   +3.526405180822860e-01   +3.454139371968161e-01   +3.055868799141652e-01   +7.578714495437870e-02   +6.514110235624805e-01   +5.168241608346756e-01   -2.593038790943258e-01   +4.088062252084324e-01   +1.507869657286177e-01   -2.431884969361886e-01   +9.036101339350530e-02; -3.632030110779603e-01   +2.021062851579557e-01   -1.030527348078859e-01   +8.539757903170404e-02   -7.795027639314840e-02   +5.618951732153643e-02   -3.591177280013622e-01   +8.460804946615204e-02   +1.624176119512357e-01   +1.688980914593988e-01   +6.622477935138386e-01   +1.884227473536240e-01; -9.484378587755619e-01   -2.159208168991827e-01   +8.267446348141357e-02   +7.643582298714656e-01   -1.876928073881320e-01   +4.672615226873921e-01   +8.702417742584435e-02   +5.124362224118277e-01   +1.700433514078356e-01   +3.196797036993961e-01   +2.142413345022257e-01   +3.228806693979848e-01];
L3I_L2I_iGABA_netcon = [-5.183018784226227e-01   -6.762713689736563e-01   -6.191761887077775e-01   -5.842160411719240e-01   -4.575777510893007e-01   +6.475495959559482e-03   +6.077233568518681e-03   -2.190783646180626e-01   -2.201829650404333e-01   +3.612561313168296e-01   -3.605747017388506e-01   +8.765555749430172e-02; -3.718476694386813e-01   +6.213250778647982e-01   +5.714373010529324e-02   +4.074587559661466e-01   +8.686697001981894e-02   +2.336337801564966e-01   -3.952472608057346e-01   -4.838979419499755e-01   -7.850244958142797e-01   -2.497189043182904e-02   -4.153346401571735e-02   -4.522497713966822e-01; -1.469024276638772e-01   -4.343355490005831e-01   +1.713972975140879e-02   -7.112143481478310e-02   +4.692102017667148e-02   +8.153874428064566e-01   -4.955505030421881e-01   -5.047531740385239e-02   +5.504793668461511e-01   -3.956108612955278e-01   +8.373054110432828e-01   +1.000000000000000e+00; +5.663984867546566e-01   -4.315473600997817e-01   -4.041633097715910e-01   +2.098161222216231e-01   +2.563891301862343e-01   -6.997373368537935e-01   -7.001791382834571e-02   +2.168022212189892e-01   -5.460853874681056e-01   -7.721985670672112e-02   +3.462977189722399e-01   -5.702592808204442e-01; +9.785177372162190e-01   -1.610854405045581e-01   +5.089901679985238e-01   -1.463456599674487e-01   +9.015926069964299e-02   -9.696150445099017e-02   -4.286522508124809e-01   +2.530950132276158e-01   +2.026317176316789e-01   +2.175408691536505e-01   +3.721106629287765e-01   -5.764487586358458e-01; -1.052819010337020e-01   -3.087436694844565e-01   -4.728447756129942e-01   +6.420698656936423e-02   -4.006283048437544e-02   +2.742996227646802e-01   -4.500494912067730e-01   -3.206348086408647e-01   -7.161433620692438e-01   -1.321272005704299e-01   -4.133013135206542e-02   -1.454430990859290e-01; -2.024236368522889e-01   +4.007860095420891e-01   -3.211670948096534e-01   +6.569430925246580e-01   +3.538293905066657e-01   -2.050570949165978e-01   -1.987423932142718e-01   +2.470879262544690e-01   -6.901255476797957e-01   +6.465687488142394e-02   -1.612875571128601e-01   +2.570160763973380e-01; -1.419513960748168e-01   +2.436732175364943e-01   +2.878165096472672e-01   -1.828749898143908e-01   -1.735064488817962e-01   +6.272819567100231e-01   +6.323238777476624e-02   +5.018603556742309e-01   +5.106485583885682e-01   +1.381737932345165e-01   +6.332584675751459e-01   +8.498539737255004e-02];
L2E_L3E_iAMPA_netcon = [+6.687903789892197e-01   +3.946833780529549e-01   +4.982990453899406e-01   -2.608677229712294e-01   +9.275550273673421e-01   +5.867615354124806e-01   +2.902723300289087e-01   -6.344786201127284e-01; +1.553478737493105e-01   -3.190821661005058e-02   -3.493620499390810e-01   +9.105346751715704e-03   -6.875766539868228e-01   -3.957963406616111e-02   -5.877358673384043e-01   +1.142511517314020e-01; +8.694020087791762e-02   +2.700398961755189e-01   -1.527620783162359e-01   +2.129864719878574e-02   -7.123779666854616e-01   -5.156172836281605e-01   -4.039270190792497e-01   +1.612745847245807e-02; +1.231557845272796e-02   +1.510445730366434e-01   -2.174346033023209e-01   +5.495546400769284e-01   -5.555834197865744e-01   -6.023529758083824e-01   -3.313925160065869e-01   +3.301803908794264e-02; -2.757515566077553e-01   -5.047142203147679e-01   -4.087223473453361e-01   +3.560046615856396e-01   -6.320745032192016e-03   -5.501663526563634e-01   -1.392854808713407e-01   -3.140016115382765e-01; +2.399959977095507e-01   -4.375969546340579e-01   +1.765462080199030e-01   +2.266712720274892e-01   +5.380700106372909e-01   -8.710584092103584e-01   +7.587134067355342e-02   +9.769205155773689e-02; +1.085239502676769e-02   -6.881037634755783e-01   +2.550430546347423e-01   -6.615737843392993e-01   -1.621077424873921e-01   -2.792752867612879e-01   +2.709198198735937e-01   -1.409794860930257e-01; -1.027262568161291e-02   -1.702674901407151e-01   +5.046660781452261e-01   +1.114165660983206e-01   +3.594746046129679e-01   -2.241998388177767e-01   +5.050720702101312e-01   +8.349817677507525e-01; +7.333055364561385e-01   +1.964391619442969e-01   +7.941242069942674e-01   -5.604273061612960e-01   +6.512258240130113e-01   -4.721257934019208e-01   -2.258781671117080e-01   -3.091514064532122e-01; +5.296845395211419e-01   -2.354525170637189e-01   +7.351758463558066e-01   +4.798285148604743e-01   +5.745565674155850e-03   -9.186042678678632e-01   -6.376813024482961e-01   +4.187961032016760e-01; +9.595564511826675e-01   +1.421866987767020e-01   +8.509642993198505e-01   +5.701367367791729e-01   +2.414065870170015e-01   +8.019113207108319e-02   -2.466588623423578e-01   -1.231912675679150e-01; -1.538409050239468e-01   +2.612499574452614e-01   +3.947133336687422e-01   +2.414082546102505e-01   -1.939827997670451e-02   +6.148973227699357e-01   +3.728428347979908e-03   -1.226488274474224e-01];
L2I_L3I_iGABA_netcon = [+6.892643434268150e-01   +1.502296307470903e-01   +6.180466697772020e-01   -1.357626720043345e-01   +2.640169443660298e-01   -4.044638425408480e-01   +5.287785983713692e-01   +9.001075432934109e-02; +5.218062598488074e-01   +7.758680697366972e-02   +4.404010299088730e-01   +3.990503282344025e-02   +3.084568391619584e-02   -2.069864909112560e-01   -2.560547331971182e-01   -2.717311686804205e-01; -2.149654060191610e-01   -8.709809798746967e-02   +1.910387151864507e-01   +3.438880854327149e-01   -2.992619541318107e-01   +5.451474420962569e-01   +2.264238112126206e-01   +1.000000000000000e+00; +3.381056117409588e-01   -1.146936064581155e-01   -2.925615488451229e-01   +1.265943474715345e-01   -2.916160013130338e-01   -4.019831037220870e-01   -7.758378260237998e-02   -1.613842662601892e-01; +1.406194930493150e-01   -1.191604006815579e-01   +3.410261368819719e-01   +3.582837579494209e-01   +2.822527087604356e-01   -4.093716892307132e-01   +4.498394875784966e-01   +2.956713663875883e-01; -8.924993550806171e-02   +5.899334860618977e-01   -7.670136155924263e-02   -1.229766832482674e-01   +2.104949550040990e-01   -1.979584724583489e-01   -1.240186537473269e-01   +5.004338847934500e-02; +1.844840800765634e-01   +3.863322605460301e-01   +3.383900623304338e-01   +5.457534794439559e-02   +5.476074448543377e-01   -1.799647161158465e-01   +2.539182365731884e-01   +3.013322237674895e-01; -1.130624116298189e-02   -9.062450433152222e-02   -2.399427352195138e-01   -4.436064074788273e-01   -4.278951919128714e-01   -5.037027073881498e-01   +6.705600471427174e-01   -4.101337896374534e-02; -2.026185798945414e-01   -4.480294076131122e-01   +3.609713590813091e-02   +6.369938818488341e-01   +1.796565953153015e-01   -3.437304527649789e-01   -4.268457286870207e-01   -2.961767257523580e-01; -1.140736763647860e-01   -2.354814801080899e-01   -2.651570246216278e-01   -8.041821888002920e-01   +3.574068934929992e-01   +5.604131554609265e-01   -7.545201113574798e-02   -3.124135581813725e-01; +2.493182917961877e-02   +1.863762782212175e-01   -1.746063165850260e-01   +8.588484593006536e-02   +3.703251129719852e-01   -5.602650030192222e-01   +4.079601607909049e-01   +1.399984721929677e-01; -2.139268496982490e-01   +2.388753006010959e-01   -1.347171964721650e-01   +6.416461368285292e-01   -8.457827069997130e-02   +2.886838000471860e-02   -7.089741647523079e-02   -2.354516651676996e-01];
L3I_L3E_iAMPA_netcon = [+1.503553672114541e-01   -4.432256144864692e-01   -3.357898922134348e-01   +9.632437588916543e-02   -3.889727478897195e-01   +4.848217105532264e-01   +4.075808525907855e-01   -4.149944812818820e-01   +5.928099195010123e-02   +7.724063649504223e-02   -8.897662282932635e-02   +4.011943688065187e-01; -1.404587420848441e-02   -1.276958883918239e-02   +9.230790915690221e-01   -7.136610076819668e-01   +3.077489927638998e-01   +6.059728782442711e-02   +7.806793542171336e-01   -1.663820426534538e-01   +1.454315278223515e-01   -6.515633174360923e-01   +5.580204084912023e-01   -1.230148147029184e-01; +5.144422316045951e-01   -2.139031337613456e-01   +3.747595172393875e-01   -3.263793091347955e-01   -7.493012005118806e-01   +3.394429400252723e-01   +3.444886172672627e-01   +3.277568747898211e-01   -4.799089951254404e-01   -9.475603486975293e-02   -5.744154696398518e-01   -7.023141696496871e-02; +7.392276169767641e-01   -3.710321087632017e-01   +9.104528919079971e-01   -5.263924157303065e-01   -3.014621173005376e-01   +7.359317062815578e-01   -1.055998758932840e-01   -1.409494412036464e-01   +1.123660275454041e-01   +1.289954278733346e-01   -3.466920180781727e-01   -3.091446212514983e-01; -6.303630718911086e-01   +7.615332477254166e-02   -4.409450596421203e-01   -8.315766828585841e-01   -5.179216734278473e-01   -8.922465034905935e-01   -1.224787112722436e-02   +6.851320544575209e-01   -2.280237893354619e-01   -8.016175287892253e-01   +3.734762659300869e-01   -3.843161328051489e-02; +1.772566884420873e-01   -4.410185519333886e-01   -1.033519838203285e-02   +2.935667793616166e-01   +2.475462522197800e-01   +4.672404932264175e-02   -7.911310714864610e-01   +1.400833903971164e-01   -3.558011397233982e-01   +3.384044468492886e-03   -2.002527292773434e-01   +5.986432404353637e-02; +5.251093374547106e-02   -7.477603062405103e-02   -5.521231467726613e-01   -4.860170024778896e-01   +6.846598254656192e-01   -1.518468538959714e-01   -2.823706247756570e-01   +3.612989773847856e-01   -3.052930222481879e-01   +6.199499236622488e-01   -2.088061820091924e-01   -3.350548985639594e-01; -8.459347653786660e-01   +4.218496393537588e-02   -3.290936891858391e-01   +3.391216537639035e-01   -5.126865359099440e-01   -7.047042902691829e-01   -2.105859714824454e-01   -1.820802757630446e-01   +4.057681312496791e-01   -4.318547567947068e-01   +9.389220689359545e-03   -1.261443426647294e-01; +7.154703416764674e-01   -2.459296039280601e-01   +6.307150409634554e-02   +1.006432800651462e-01   +8.681628278733329e-01   +2.635772704094475e-02   +7.175592644171485e-01   +1.972536669454125e-01   +2.495090307525194e-01   +3.339233409535097e-03   -4.946076588218720e-01   +7.106895194245191e-01; -2.588650129818318e-01   +2.292181860204768e-01   -6.086932997210924e-01   +1.354441575666406e-01   +4.130147539850717e-01   -3.658141242546398e-01   -3.312495065645202e-01   -8.555396581350184e-02   +2.006944950724693e-01   +1.390572301836518e-01   +5.123065572099776e-01   -2.171232152916048e-01; +9.147812597633909e-01   +6.671324310619256e-02   -6.675627154087624e-01   +4.695389930510204e-01   +1.018919082469389e-01   +8.172837175735219e-01   +1.897491196408129e-01   -5.616963532421110e-02   +1.550532660827337e-01   -2.390914833946076e-01   -3.275581510824067e-01   +2.845231250166367e-01; -1.540530435249799e-01   -2.511344616237439e-01   +2.406979008086954e-01   +8.186892180906479e-01   +1.669525087091672e-01   -8.024208134367710e-01   -1.210352523691044e-01   -4.322154266914819e-01   -3.019605031229877e-01   -2.395906726702161e-01   -1.920373730488193e-01   +6.408267426276887e-01];
L3E_L3I_iGABA_netcon = [-5.851461369576466e-01   +3.204219040777378e-01   +1.260544688194472e-01   +6.968110004448312e-01   -2.592075323448902e-01   -2.298554036138647e-01   +1.643898797593390e-01   +2.245775029968162e-01   +7.738390254670724e-03   +2.559510852468878e-01   +2.127414220956860e-01   +3.293199689025020e-01; +2.291144497571069e-01   -1.877997566859945e-02   +7.381195429035204e-05   +5.651754807537264e-01   -2.998071984674128e-01   -1.045780526826117e-02   +6.328383802440073e-01   -2.079817476404286e-01   +1.000000000000000e+00   +4.148104439040842e-01   +2.231403950525326e-01   +2.352524972784448e-01; +6.719826646871527e-01   -1.764546330043823e-01   -4.291203587251837e-01   +1.007761337657512e-01   +9.819636122344287e-02   -8.023082602783120e-01   +2.038606361004541e-01   +1.452433779002553e-01   -3.872801164107764e-01   -2.068970446757749e-01   +8.660314747710754e-02   +2.071271836613340e-01; +9.503581169116725e-02   -1.261128430165782e-01   +5.123161187377332e-01   +6.376985279188659e-01   +2.300164904635862e-01   +1.064323344071971e-01   +5.377176025453434e-01   -1.582831514580642e-01   -3.633307885262111e-01   -5.121216964605093e-01   +2.005364883494933e-02   +6.304169574753721e-01; -2.954153138878073e-01   -8.356133323834064e-03   -4.398110589722308e-01   -1.362041154679850e-01   -1.569171620352434e-01   -6.017224537969881e-01   +7.930362153403939e-02   -8.197646559977155e-01   +3.997027583244240e-03   -9.647308799871817e-01   -2.623881668026146e-01   +7.522137275766883e-02; +2.006680731818416e-01   -1.127338263185358e-01   +1.711670885083157e-01   +4.776800680785985e-01   -3.621618067686817e-01   +1.328598901812496e-02   +4.077279128366774e-01   -1.189904066131463e-01   -1.651240941792692e-01   +2.382813778427462e-01   -1.711759599132095e-01   -1.613178066327329e-01; +8.432243511531774e-02   -2.029874230552251e-01   +2.713126439309085e-01   +1.934217192109770e-01   -5.362348495511915e-01   +2.113864878554105e-01   -3.067330130144221e-02   -1.731851900074684e-01   +5.799095043377681e-01   -7.308780347047641e-01   +5.225210498379824e-02   -4.679354247087052e-02; +5.271413244099553e-01   +1.377466421822366e-01   +3.992250974169996e-01   -1.859603048932039e-01   -2.769611390943292e-01   -3.370064037413517e-01   -3.605127164942318e-01   +3.271577531210068e-01   +3.920555062620152e-01   +5.797806482046807e-01   -7.773209400965066e-03   -9.022649913429666e-01; -4.655608254126648e-01   +6.326435976995061e-01   +8.286661579716607e-01   -4.244676162064059e-01   -9.990673041902595e-01   +2.292552260698474e-01   +1.064950283478513e-01   +1.536598015190676e-01   +8.047237599018314e-01   +1.405801834419419e-01   -3.999529639106775e-01   -5.066396674098328e-01; -2.440127956378566e-01   +7.417210548674377e-01   -8.747961597681107e-02   -3.676764240810035e-01   +2.605354642008466e-01   -7.694238638326683e-01   +2.417657653038552e-01   +5.213803100263747e-01   +2.178255070802491e-01   -2.136383312619339e-01   -5.438003231436820e-01   -1.554070056265447e-01; -2.058718990640346e-01   -1.342752955918054e-02   +2.864380644496319e-01   -1.453728166819674e-01   -5.433397741687721e-01   -2.644050813444699e-02   -3.075898163686846e-01   -8.027556394840672e-02   +8.721294778018124e-01   -9.364613316937281e-01   -1.526788549743177e-01   -7.141622263776894e-01; -2.236816146668084e-01   +4.067878571453326e-01   +6.617593770699233e-01   +4.945597631224245e-01   -4.551888394268475e-01   +1.803980100516435e-01   +1.365769750705156e-01   -1.896708767656677e-01   -4.421119399561261e-02   -8.758556509722787e-02   -4.087681089830861e-01   +3.224645298674029e-01];
L2E_Input1_iAMPA_netcon = [-3.031093822961041e-01   +4.341199347936576e-01   +5.421450885620412e-01   -2.933530165287948e-01   -2.199349424822393e-01   -5.601797513686529e-01   -7.300112091749377e-01   -9.382128154773167e-01];
L2I_Input2_iAMPA_netcon = [-4.493420752046611e-01   -4.314824327270407e-01   +7.314742542150172e-01   -2.039767445987859e-01   -1.062115605522296e-01   -3.834540479411194e-01   -2.270663819844299e-01   -5.742898343380020e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
