function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.020666343415590e-02   +3.988124104019530e-01   +2.636020734916830e-01   +1.478675354302505e-01   -6.408457414713528e-02   -3.099966110301850e-01   +7.545504364252933e-02   +1.896596926175858e-01   -1.216870974248065e-02   +4.928070409122437e-02   +1.581420615646967e-01   -3.079349700619050e-02   +5.290927324356932e-02   +1.803530151375748e-01   +4.032636138946472e-01   -2.948824455325477e-01; -2.242735173203536e-01   -2.410860496336910e-01   -3.290746160038945e-01   -1.680864066399100e-01   +3.119010926661350e-01   -6.982502876565355e-02   -1.302295647835202e-01   -2.932774677823462e-01   +7.196026103758904e-02   -1.280420461172601e-01   -1.910844358926356e-02   +1.948738282267320e-02   -4.044603928349012e-01   -2.045155984538595e-01   +8.530694775283401e-02   +1.088291006710261e-01; -5.651198853994237e-02   -9.145028689443524e-02   -1.852930364055805e-01   +2.716329925733395e-01   +3.101563280867387e-02   -1.772840555600936e-01   +4.045646298972074e-01   +3.279942941638550e-01   +3.696819078409927e-01   -1.875733725843885e-01   +3.153853407116387e-01   -1.395976030618123e-01   -1.756131920017266e-01   +2.495229181003689e-01   +1.824915107732494e-01   +5.848069869961044e-02; +8.715659328657839e-02   +4.946122134235087e-02   +2.090657223378956e-01   -4.175070676527821e-01   -4.571934319782485e-01   +1.481264775352724e-01   -6.346148935260848e-02   +3.976347531288786e-01   -2.234681970942456e-01   -2.935193525918136e-01   +2.833519452613287e-01   +2.737661644154283e-01   -4.893678287587526e-01   +4.774726693715046e-01   +1.965473450248926e-01   +1.916273396710673e-01; +1.831324116698977e-01   +2.495581289323332e-01   -7.553407336489427e-02   -7.065473852301358e-01   +1.149401680907766e-01   -2.052199902148464e-01   +5.180819519562743e-01   +3.790664252342210e-01   -5.984006114473885e-01   -3.586149127165950e-02   -9.331200694008077e-02   +4.488657151873089e-01   +3.350501312445558e-02   +3.482304739456906e-01   -1.497883876911613e-01   -5.224931790879270e-01; +1.649048109491948e-01   -2.871696224005346e-01   -8.185858464549232e-02   -1.169329783262763e-01   +2.720968251789848e-01   +2.248308051207488e-01   -3.523782330662169e-01   -2.456630766280280e-01   +4.048266601590024e-01   -1.760193705763125e-01   +7.680502127622563e-02   +2.194738116627123e-01   -3.304317045238994e-01   +5.095631523392634e-01   -2.946711594637322e-01   -2.616083399880471e-02; +4.533554092078707e-01   -1.130578091132050e-01   +6.064567859422921e-02   +7.436811133455741e-02   +3.645188629725791e-01   +1.472691378594190e-01   +1.588126744134069e-02   -6.741442855815148e-04   +1.413219345402777e-01   -3.055154475418671e-01   +2.866003567604659e-01   -2.465072429496382e-01   +2.469083638350274e-01   -2.332974292231679e-01   +5.048657479624512e-02   -1.553164365300796e-02; -7.006868353562362e-02   +3.149971186399296e-01   -5.015766853973852e-02   +1.986136957258474e-01   +8.747160446328259e-02   -2.710284663949814e-01   -5.201852855690986e-01   +7.540169642999056e-03   -3.022053703434437e-01   +1.681069398311010e-01   -3.832294569218850e-01   +4.669059281618725e-02   +4.808470885517210e-02   -5.031401542815501e-01   +2.121282944576525e-01   +2.874060505981146e-01; +1.850782130223161e-01   -2.645886328047023e-01   +6.067953338550168e-04   +9.125756918562736e-02   -1.005847285792061e-03   -4.994377112008838e-02   +3.200635758719951e-01   +2.420911255825746e-01   -2.402872747072175e-01   +3.453283758822118e-03   +3.094250375676652e-01   -2.411203398899822e-01   +5.326474255785600e-01   -3.299320454682478e-01   +2.814437817337580e-01   +5.550153185005319e-03; -1.748769203963140e-01   +5.268650371147718e-01   +3.571114529324467e-01   -2.464302917833851e-01   -3.718525323931627e-01   -8.433278317677690e-01   +2.657846467739333e-01   -1.203019009034433e-01   +3.785540745851551e-01   +5.255684135181342e-02   +5.463752297408568e-01   -3.501424696777275e-01   -3.142816799378846e-01   +1.523767681136879e-01   +2.062870455022264e-01   +3.830764857696932e-01; +1.083446868275015e-01   -1.731647274666169e-01   -6.490051289418959e-01   -1.842889394819462e-01   -2.649183560962214e-02   -2.193493761490777e-01   +6.432526968112522e-02   +2.086723575224216e-01   -2.349357994271982e-01   -4.504317614554785e-01   +2.691033730697583e-01   -4.649062531946844e-01   +3.635598348090050e-01   -3.207593202398956e-01   -2.632719247222650e-01   +9.226260201504478e-02; +1.939293213153205e-01   +3.971486137509726e-01   +6.431033921871760e-01   +2.618712316501847e-01   +1.815912061820129e-02   +8.118421229967349e-02   -3.098852178656860e-01   -4.067429392730577e-01   -1.884188839490944e-01   +6.110580749067997e-02   -7.789840520869765e-02   -3.576295215397359e-01   -2.981972644499620e-03   +1.318309039550510e-01   -3.275816288147802e-01   -4.537485620409310e-01; -2.727437670540717e-01   +4.354243644215644e-01   +1.203775679603826e-01   -2.260665662586591e-01   +2.747057982723476e-01   -3.611550163547501e-01   +1.432096519100732e-01   +3.100739184374481e-01   +8.737571269148892e-02   +7.012542628049163e-01   +4.850283029018150e-01   -3.617386798886031e-01   +4.003352698491732e-01   +2.465262802948572e-01   -7.637781311125867e-02   +1.798972209385013e-01; +1.476247396699141e-01   -3.091761341090036e-01   -4.589772913183129e-02   -4.251471540879789e-01   -2.682864240077443e-01   -1.818800103090076e-01   -3.496461816007844e-01   -2.154567666636804e-01   -3.882654543823253e-01   -2.072277019976133e-01   -1.637291975867601e-01   -2.968016892929318e-01   +2.072016838323811e-01   -1.643633414022500e-01   +3.692805202112791e-02   +4.707550713204198e-02; +1.039371956996663e-01   +3.343234394132027e-01   -1.506074184726203e-01   -9.157703757537114e-02   -1.480648024755015e-01   -2.360445530934943e-01   -4.279507118264964e-02   +1.366835356141329e-01   -1.441593125623989e-02   +2.321961298848439e-01   +1.025923700247534e-01   -2.744048588624957e-01   +1.835153919181179e-02   -6.877479255259290e-02   +4.086050170898547e-01   +2.106169089913968e-01; +1.435721883600770e-01   -9.096169550440142e-02   +1.514496762902377e-01   +5.996717470517650e-01   -1.319440367743150e-01   -1.125114157188661e-01   -2.306019082958168e-01   -5.427891164739800e-01   +3.121011896838422e-01   -3.868256217387395e-01   -3.605300823056772e-02   -1.950230331563641e-01   +5.118888641184427e-01   -2.685788269973891e-01   +3.201841657393397e-01   +1.215573329535783e-01];
L1E_L1I_iGABA_netcon = [+3.312776682774335e-01   -7.102706856909577e-02   +8.819066284716377e-02   -2.005247054803358e-01   +1.993463303385486e-01   -6.933515928737892e-01   +4.857385759141888e-01   +1.125490896272310e-01   -2.591183472661379e-03   -2.531847096941308e-02   -4.121022815244801e-01   -2.078914966070103e-02   -1.369348878737738e-01   +3.616172723296349e-02   -2.222581681837393e-02   -2.627819504921613e-01; -4.398591357893485e-01   -2.285999927578849e-01   +1.629907515965006e-01   +3.061953552631901e-01   +2.855303914044261e-01   -2.982737639199908e-01   +2.986704066561967e-01   +2.143710789854643e-02   -1.463353691503842e-01   -1.461071979460787e-01   +1.033903632832107e-01   -3.585597978100770e-01   +1.077628782296648e-01   -1.936616556718819e-01   -3.629443878201680e-01   +8.768098468376341e-02; +5.529980305412019e-02   +4.590279910078258e-01   +9.190420200605464e-03   +3.929646981992035e-01   -8.924619900234576e-03   -1.231199784569578e-01   -2.923165566908031e-01   +2.305104474199615e-01   -5.519431660168545e-02   -2.206104680551242e-01   +3.645376619765298e-01   +1.123262905859126e-01   -2.644893992578527e-01   +2.159524542793954e-01   -2.381062982366231e-01   +7.401998404623240e-01; +1.889402912774922e-01   -3.913137564393057e-01   -7.860287717208442e-02   +2.137998716883629e-01   -1.503681795040142e-01   +3.005140847952821e-01   +8.196634020710389e-02   +2.313901062218293e-01   +2.890826569732080e-01   -7.586903688445966e-02   -2.338672611405492e-01   +4.528122688813668e-01   +3.850587327051708e-01   -1.958114805879625e-01   -1.460573323598252e-01   -3.722481718526935e-01; -1.010695756800584e-02   -3.032464828064466e-01   -1.299240219537279e-01   -2.429737753869388e-01   -1.906818343925963e-01   +2.220974507757942e-01   +4.767314122069436e-01   +5.121420031476226e-02   +6.131184246501911e-02   +4.307365253086234e-01   -3.875588657347631e-01   -2.491734252359558e-01   +3.466810917303358e-01   -2.035897683729553e-01   +1.362429647702187e-01   +3.548842248281587e-01; -1.679450303643999e-02   +2.119033810366018e-01   +7.540787542606896e-02   +1.929942755992475e-01   -1.247087100077651e-01   +2.387857969553221e-01   +7.732580356513362e-02   -2.424002491344944e-01   -1.050408044759857e-01   -4.601673620094611e-02   +2.996480052042165e-01   -2.030758308988318e-01   +8.331373558435226e-02   +3.073884855524338e-01   +2.416059995447759e-01   +1.771897640377851e-01; -3.781880473390184e-01   -1.062241115928222e-01   -3.509282670734464e-01   +4.830573952989469e-01   -1.714714737679672e-01   +7.357785414229898e-02   -3.144949340100764e-01   +2.202778922691663e-01   +7.666344394793762e-02   -1.756294434413691e-03   +2.475609430842563e-02   +5.795094901286282e-03   +4.605807875099633e-01   -1.966612586448249e-01   +5.717235336666854e-02   -6.236337804955497e-02; -1.136968528355426e-01   -5.235380602182174e-01   +2.119458039170055e-01   +1.755618528518851e-01   +4.056821519239919e-01   +2.556941843475730e-01   -5.613401246884261e-01   +9.100310156881763e-02   -1.544929502912483e-01   +2.137409385438966e-01   +1.032813959993014e-01   +2.279256301599893e-01   +1.428563101882908e-01   +2.871268754565970e-02   -2.497991466823564e-01   +5.314104085859497e-01; +2.560692237801370e-01   +2.287454609906044e-01   +1.743463028781886e-01   -3.416212635240633e-01   +3.916137866225516e-01   -9.138392632467390e-02   +2.701883351711397e-01   +3.060836826114877e-01   +8.974164100334851e-02   +3.619383209483803e-02   -2.206257609527487e-01   +2.000417722123967e-01   +1.184820688349854e-01   +1.103421758486854e-01   +1.507186421672729e-01   +6.403884732799783e-02; -5.003460942408756e-01   +8.673874476815457e-02   +3.942827087810525e-01   +5.133852565635398e-02   +5.018843458381814e-01   -5.593600612050763e-02   -4.369822746609539e-01   +4.340410951519988e-02   -3.063527636692106e-01   +8.830397654153289e-02   -4.520554367667216e-01   +1.514226039618463e-01   -3.268812035033413e-01   -1.795898446157084e-01   +1.171127923911108e-01   -1.932846158685495e-01; -1.417799838460269e-01   -3.793661049251680e-01   -3.490180174137886e-02   +4.364884583555316e-01   +1.402690797422719e-01   +1.235461610314396e-01   -2.711628929646699e-01   +1.649374084835831e-02   +3.506297835032274e-01   -2.688434042494553e-01   -4.930309869785965e-01   +3.190250938923441e-01   -3.841718262311000e-01   +5.079209001283280e-02   -1.994967925853656e-01   +1.763010716398992e-01; +6.254952445455411e-01   +2.358450361864323e-02   +1.964421580695915e-01   -1.092914346590005e-01   -5.665895802907822e-02   +1.517647253587734e-01   +1.810432394346803e-02   +1.987396804293077e-01   +1.861494911859701e-01   +2.392381565321005e-02   +4.234176145195698e-01   +3.587188962018011e-01   -1.512991863462851e-02   -2.269740584336174e-02   -1.655977674091737e-01   -1.252416167385432e-01; +1.193407319641305e-01   +7.759386416199870e-02   -3.934812017174336e-02   +5.107570002911264e-01   +3.513894070460333e-01   -2.447167094630477e-01   -4.458818979399143e-02   -3.832035665749007e-01   -3.913653248490886e-01   -3.249418037080319e-01   -2.637141142247247e-02   +4.209958152208279e-01   -2.085351230339846e-02   +4.052705403770250e-01   +2.730530679160514e-01   +2.856455545317100e-01; +1.762508622837098e-01   +2.387429566937870e-01   -8.517234933001433e-02   +4.332505548848859e-01   +4.303069908841569e-01   +2.628922481543620e-01   -2.230585627122750e-03   +5.790710974226791e-01   +1.255843804497459e-01   +3.830823319718507e-01   -2.317102441338483e-01   +3.158321229413942e-02   -1.340355748085668e-01   -1.030851644175995e-01   -8.033577898772390e-02   -1.370521404118251e-01; -3.492518472724888e-01   -3.996524430410790e-01   +1.892736862395292e-01   -3.365186654693078e-01   +3.038595636835451e-01   +3.563161460846122e-01   +5.299403139956296e-01   -3.609485137796755e-01   +9.016036454153442e-03   +4.371066839206634e-01   -7.234891985792320e-02   +3.553145302178430e-01   +3.606293622822998e-02   -1.620622008197258e-01   +1.136406409756892e-01   +2.308886214264032e-01; +6.801198782672729e-02   +2.136308862481154e-01   -1.538879317707766e-01   +5.793936871366642e-02   -1.094903632252467e-03   -2.304665332059267e-01   +2.862024870026844e-01   -1.829112356317248e-01   -1.883225440523766e-01   +2.553119575558384e-01   +5.122203391410710e-02   -7.410926630208832e-02   -2.920694901898439e-01   -2.657942037939197e-01   +3.484845016040138e-01   +4.482683601743720e-02];
L2I_L1I_iGABA_netcon = [+6.356744390434950e-01   +1.843719912844135e-01   +2.427548413135175e-01   -9.489885883943931e-02   +3.516258745897849e-02   -3.243413746355331e-01   -2.152662121401295e-01   +2.466230690078176e-01; +6.012684666307568e-02   -9.021639917052353e-02   -7.206492954354826e-03   -8.598994474866567e-02   -3.816109461288960e-01   +2.780269221370441e-01   +3.452694518732463e-01   -3.044644915006031e-01; -2.431454611661295e-01   +1.517639868837185e-01   -1.043345132999529e-02   -2.756364667066099e-01   -5.117259022338271e-01   -1.010535994085296e-01   +1.198016112048698e-01   +4.485122336226463e-01; +5.160735286079086e-01   +8.379171825059048e-02   -3.950579481670794e-01   -6.479329377002381e-02   -4.285838304835531e-01   +2.366940864592879e-02   +1.809063277372945e-01   -3.182747856084053e-01; +1.923506707641967e-01   +3.659420144671078e-01   +1.598741064682661e-01   -9.802507516316600e-02   -2.787731947491409e-02   -1.040118848854207e-01   +5.315836997083552e-02   +7.696512950719654e-02; +8.694733440811034e-02   -4.339332444390513e-01   +3.972690363991818e-01   -3.194296004592383e-01   +3.079930977417173e-01   -3.919425715506362e-02   +2.502159151949852e-01   +6.234454923249853e-02; +2.873046406135834e-01   +8.169827122950893e-02   -1.695650216890766e-01   +1.499524230950167e-01   +4.192181101889940e-01   -5.011583960121968e-01   +1.983423506537706e-01   +2.478421004376084e-01; -4.410948873491042e-01   +1.160086717146075e-01   -2.144232021655334e-01   +8.348002414281061e-02   -4.561961364370115e-02   -1.119722244943016e-01   -2.237965775354186e-01   -1.326350091415234e-01; +1.993053425953087e-01   -3.771976889659219e-01   +4.015682893910998e-01   +4.836730844831669e-01   -3.745432742434417e-01   +9.420794074914256e-02   +6.171218696519935e-02   +3.594003943197242e-01; +6.325064406816705e-02   +3.901242257720873e-01   -2.085656293025325e-01   -1.338852459392648e-01   +2.504268807990138e-01   -4.407783560531183e-01   -3.013870333141535e-01   +8.115547887309685e-02; -3.892177097490471e-01   -1.217248513772593e-01   -4.345470967787834e-02   +8.558191091972969e-02   +7.836771616894990e-02   -3.401817175475647e-01   -1.926264732251657e-01   -2.245176982215260e-01; +3.726227318598613e-01   +4.545370568929172e-01   +1.781545614595825e-01   +3.449906927907536e-01   -3.255197563284604e-01   -8.570849950949719e-02   +1.368597281087861e-01   -6.199238002310080e-02; -2.690726058023977e-01   +1.843244759143747e-01   +4.738694736248425e-02   -3.082340022388389e-01   +1.426953012112845e-01   -2.354975549844160e-01   -5.452576918652773e-02   -1.376720947771835e-01; +2.281083933554303e-01   +7.241649475527817e-02   -3.128327111356791e-01   -2.958000546346809e-01   +1.092204248880886e-01   -6.394185037111130e-01   +2.703894698240212e-01   +2.084572107842824e-01; +2.274222342499970e-01   +1.227895986482717e-01   +7.165672423027389e-02   +1.775367851924153e-02   +5.643747539108651e-03   +9.321756139777457e-02   +2.526597533448734e-01   +1.880204084341557e-01; -5.228369033009337e-01   +5.624585625182383e-01   -1.107038881876163e-02   -3.522964505939750e-01   +3.385012782001036e-01   +1.462425378715168e-01   -3.748095258126649e-01   +3.450133693166590e-01];
L1I_L2I_iGABA_netcon = [-2.058677269929920e-01   -2.468292085786433e-01   -2.873109596300238e-01   +1.908091682751283e-01   +7.853866807856578e-02   +1.878511140202366e-01   +1.802280909191442e-02   +1.984118790624038e-01   -1.510077525708105e-01   +4.820465882144695e-01   +8.149912572732315e-02   -5.267623289392567e-01   +3.249253312340127e-02   +3.296154190225313e-01   +1.900642397195240e-02   +3.849678212750379e-01; -2.587764080258229e-01   +1.065406450705029e-01   -1.182494853746924e-02   +4.444962733395340e-01   +2.511393736409619e-01   +1.606343263775875e-01   +1.410180085123355e-01   -1.866592843772426e-01   +7.106171001361325e-02   +4.576021575343098e-01   -5.268309228354448e-02   +2.436633319884051e-01   +3.559813091277475e-02   +1.776820256079400e-01   -3.697089223071778e-02   +3.371273120519044e-01; -1.622658994651606e-01   +1.772268206926389e-01   +1.136362770307903e-03   -1.529659985942682e-01   -2.554881814128280e-01   +2.392663156448307e-01   +1.098844671274399e-02   +2.477212225519660e-01   -2.178771802215032e-01   -4.154477648176311e-01   -1.265325231070842e-01   -2.545512563119155e-01   +3.394629479146165e-01   -1.562347894217458e-02   -5.542611469133775e-01   -1.277108384545568e-01; +2.307688626201211e-01   +4.048705816328352e-02   +8.300081330187528e-02   -3.722399296683672e-01   -1.658569330169282e-02   +1.018247638526223e-01   -1.412174319878675e-01   +2.051228537131155e-01   +7.200791450594146e-02   +7.404366249985525e-02   +1.683238251183707e-01   +5.606016287873575e-02   -3.360548987587185e-01   -2.868778184732175e-02   +3.345541370241290e-01   +4.139926945863598e-02; +1.978290675419511e-01   +4.240531157622295e-01   +2.069968151334202e-01   -1.075822669282491e-01   +1.529258417893423e-02   +2.281054909379383e-01   -3.712693129561471e-01   -2.676237111051866e-01   -2.057429974812905e-01   -3.427212628602487e-01   -1.997100163420790e-01   -5.676107410519052e-02   +2.081422386311101e-01   +7.891892976661344e-02   +5.949944062344136e-01   +2.925487376057231e-01; -4.703244204645936e-01   +2.447436076658619e-01   -2.830292404864973e-02   +6.630809043825005e-02   +3.007103965993919e-01   +2.150496022919127e-01   -3.225685562744517e-01   +2.120487544560918e-01   +2.169000953947598e-01   -3.117117920051394e-01   +1.214557264459494e-01   -2.844205177030626e-01   +2.124329096840901e-01   +5.542835480205047e-02   +5.435325776161140e-01   -1.511643932302969e-01; +1.892459346045579e-01   +4.451434517191410e-01   +1.679501423415005e-01   -3.110202401431790e-01   -5.401974744142306e-02   -1.928389310088009e-02   -2.429211542948710e-01   +1.379885831228072e-01   -1.150063324443656e-02   +2.329178215972172e-01   +5.447395263277758e-03   +2.895388290746969e-01   -1.455240396736749e-01   +5.919810259225472e-02   -1.705748154919305e-02   -2.842593510216022e-01; +6.247505827062608e-02   -4.207833068086748e-02   -4.678398161079366e-01   +8.327405697972154e-02   -1.826699210149431e-01   +1.978706220391185e-01   +4.311394023919629e-02   +1.422517184376030e-01   -4.036918561713887e-01   +1.932438689086238e-01   +1.194633708443857e-01   +2.540722684451198e-01   -5.651725293538856e-01   +1.721645801607546e-01   -1.906590938706795e-02   +3.723391184334342e-01];
L2E_L1E_iAMPA_netcon = [-2.652529906118112e-01   +2.589607025585314e-01   -4.096730106367455e-01   -1.095733934929903e-01   -2.210548331190206e-01   +2.493410443597455e-01   +1.150766820187482e-01   -4.588116683493199e-02; +2.006092414700115e-01   -9.776208303884677e-02   -1.306907808422977e-01   -2.596634240012141e-01   +2.223333265344367e-01   -1.957845067962155e-02   -4.770921178209854e-01   +8.031279114335976e-02; -3.600644508646705e-02   +1.939392277478523e-01   +1.090706394322196e-01   +7.538624534969834e-02   -1.940548103196509e-01   -1.798515784216109e-01   -1.477333474127387e-01   +1.699288096453297e-01; +1.168264278706562e-01   -3.842441917268086e-01   -9.727403182125269e-02   +1.332849774166578e-01   -4.328027320342437e-02   -2.712782666329205e-01   +1.862670739994817e-01   +1.888381221487532e-01; +4.649380324995775e-01   -1.619955498552118e-01   +2.591451461836509e-02   -1.170691443279595e-01   +4.148018677587180e-01   -2.815883145988347e-01   -6.823958969158733e-02   -2.709199777062123e-01; +2.292630595378294e-01   -2.395316529105569e-01   -2.937906705541903e-01   +7.813449919993212e-02   +2.118211124721375e-02   -2.381955133995517e-01   +1.773696362444348e-02   +3.703507331669498e-01; -1.015505632963311e-01   -5.359950848027825e-02   -1.262871371492378e-01   +8.198516829121973e-02   -2.670924123354194e-01   -3.009682135071441e-01   -2.033745902592117e-01   -2.096641146539636e-01; +8.077115800291187e-02   +2.017195068064501e-01   +2.499056139548489e-01   -1.565851028665535e-01   -1.469569374173649e-01   +3.590914993262236e-01   +2.276782255734571e-01   +1.619005473576958e-01; -1.977541120781003e-02   -1.287475554283496e-02   +1.462011500651486e-01   +7.288274775726211e-02   -6.461616176592726e-02   -2.696585750571232e-02   +2.054566037064310e-01   +3.940190862549593e-01; +1.044006806730531e-01   +3.276756568648942e-01   +9.854824546932964e-02   -1.042701549162453e-01   +5.477661558999465e-01   +3.614179451722482e-02   +2.724030159779098e-01   -5.020213010033350e-02; -1.950815944746750e-02   -8.436102868760528e-02   +1.078161257711157e-01   +2.478639843199519e-01   +6.107708944964933e-02   +9.771787280712790e-04   -2.416998256702399e-01   +1.636960679637592e-02; +2.025727735884074e-01   +4.112450179644788e-01   +3.248125439904381e-01   -4.080667061691080e-01   -2.469685837667816e-05   +2.307839937678885e-02   -2.170714378335188e-01   -2.999819962675795e-02; +2.246696533380810e-01   -2.987914534658601e-01   +1.656012082549637e-01   +1.787534841111836e-01   +2.573349286130350e-02   -2.129101292176478e-01   +4.424361826866485e-01   -9.972934751781884e-02; +5.352480377455926e-01   +6.236114315041910e-02   +1.693877640544079e-01   +9.181470052528767e-02   +3.836104066937350e-01   -7.710435419896611e-02   -3.445663273755423e-01   +3.597051059826481e-01; -2.488763108226900e-01   +1.502807145431069e-01   +3.781980751182314e-02   -1.073574808277999e-02   -7.671785491461638e-02   -2.474323981021025e-01   -3.492000454044904e-01   +4.509669479740682e-01; +1.795335622344807e-02   +1.810543242670284e-02   +2.953917588101629e-01   -3.535379993971662e-02   -5.776024272075819e-01   -9.225437548582657e-02   +3.272826065978279e-01   +1.665994325905021e-01];
L1E_L2E_iAMPA_netcon = [+3.048023168844220e-01   -2.131308555864781e-01   -2.733234058897303e-01   +9.793014127357168e-02   -1.745534257377852e-01   -5.620126192684607e-03   +3.153606424931033e-01   +2.992250274036573e-01   +4.853159822327534e-01   +1.775926264445063e-01   -1.148275928412036e-01   -1.303666266271779e-01   +2.112970139323744e-01   +6.340274027392162e-02   -3.059722655037961e-02   +5.771985306063696e-02; +5.968524829007796e-02   -3.773309217165709e-02   -2.083980772504324e-03   -5.199716356916151e-01   +8.255279380637573e-02   -2.035736805135973e-01   -2.113439342296369e-01   +1.299222711718625e-01   -3.013752990237808e-01   +2.629086843429473e-01   -8.226840599114940e-02   +3.709066874972016e-01   -9.128992646717157e-02   -4.880386680537728e-01   +3.796665373419955e-01   -4.272008534661809e-02; -3.899530028053573e-01   +4.089536433951351e-01   -1.751001221667284e-01   -1.565877650694726e-01   -9.863966877479588e-02   +2.191551830616764e-01   +6.396866189437062e-02   +3.536781212675623e-01   -8.805367163404035e-02   +1.642811988438148e-02   +4.038845463089741e-01   +7.828027199493096e-02   -2.252525685984078e-01   -2.794003840831936e-01   -7.696585530256125e-02   -2.474313334843450e-01; -3.289007255631061e-01   -6.411405312574570e-02   +1.983928183178193e-01   -3.073884253820541e-01   -8.269407367505713e-02   +4.100496389203624e-01   -8.437712890203092e-03   +2.460135970150860e-01   -6.998925192975883e-02   -2.702811659442166e-01   +1.055369009442962e-01   +7.684088371992384e-02   -2.642741935932300e-01   -9.321807459828671e-02   -2.107073439125131e-01   +6.995913026899091e-02; -1.120504345734786e-01   +9.926886094865472e-02   +5.505083527073873e-01   -3.761508143170750e-03   -2.408952129159083e-01   -4.929733351387494e-01   +3.626933658313911e-01   -1.164483370591003e-01   -4.043553779150600e-01   +2.222759760513832e-01   -7.912528869576295e-02   -2.423398896895874e-01   -9.187113338278519e-02   +5.005963959653554e-01   +2.492373139951500e-01   +1.649678260936478e-01; -2.731275440834181e-01   -8.645294777175269e-02   -1.410886482533287e-01   +4.114204610440290e-01   -2.150326108813370e-01   -3.760781532043488e-01   -4.717610021880665e-01   -1.210287187929709e-02   +1.749581498924998e-01   -1.298740801769026e-01   -3.978652757709832e-01   -1.103152610490635e-01   +1.820804024933077e-01   -2.839867588347018e-02   +1.488815394103101e-01   -3.523029491266306e-01; -3.399666515539111e-01   +2.830424283792251e-01   -1.127613568391547e-01   -4.127548329640207e-01   +4.577254915418058e-02   +6.053530615431950e-01   -4.441140038320562e-01   +2.607241316231987e-01   +4.165421883044279e-02   +3.336207512794653e-01   +3.350372529533115e-01   -1.066933205884681e-01   +1.174342268362709e-01   -1.079169060882132e-01   +1.472121693742612e-02   +6.800030097860033e-02; -5.537017065073033e-02   -4.129844102758544e-02   +3.936246583301467e-03   +2.861256333028449e-01   +5.822195043633114e-01   -2.760581951650794e-01   -2.292344284209150e-02   +1.255650282060183e-01   +5.403569138763287e-01   -1.187203824752980e-01   +3.042404779449803e-01   -8.267901958738270e-02   -2.074879174110214e-01   -3.547062881598950e-01   -3.986828574034184e-01   +1.318123232239884e-02];
L2I_L2E_iAMPA_netcon = [-4.099714562765694e-01   +2.255581529890845e-01   +2.117251591435342e-01   -9.578744145276197e-02   -1.435604068803389e-02   -1.770692425538786e-01   +4.580942804451531e-02   +2.435605415563389e-01; -1.021004536588183e-01   -3.542777341878808e-02   -1.366332843839541e-01   +3.202809963485964e-01   -7.830091104519288e-02   -3.825312659407538e-01   +1.874528444937101e-01   -3.998182115177601e-01; -2.041312486694839e-01   -1.202879577399081e-01   -1.850594410718482e-01   -4.516625426222786e-01   -3.910193856665662e-01   -2.286373414011680e-01   -3.828967991581796e-01   +3.709133595594288e-01; +2.207771851165812e-01   +3.916045010002508e-01   -3.316230862030032e-01   +3.843268649398880e-01   -3.150289006256188e-01   -1.035161989159044e-02   +2.270584014587164e-01   -3.883360813295850e-01; +8.207370612275522e-02   +3.919488220244456e-01   +5.479917115442950e-02   +2.142521720539704e-01   +4.174374396295064e-02   +6.291833578183748e-03   +1.616367459312741e-03   -2.682994216576178e-01; +2.757218684007015e-01   -1.078486648132184e-01   -8.051901602996801e-02   +5.401591858864945e-01   -3.150678212751827e-03   -1.987951295772799e-01   +3.245282161129039e-01   -3.554390220300103e-01; +4.110896372801585e-02   +4.223176876785673e-01   +3.297963758174017e-01   -2.926999395703227e-01   -1.180770193798231e-01   -5.128680656402214e-01   -2.333038526252429e-01   -5.110469919846548e-02; -3.085270058029530e-01   +3.574133237876530e-01   -1.575250498960485e-01   -2.052696089719301e-01   +3.829093808648514e-02   +5.410740667112430e-01   +5.183787953667769e-01   -5.399144928638162e-01];
L2E_L2I_iGABA_netcon = [+4.522722066736093e-02   -2.109462084273086e-01   -1.629113043917423e-01   +1.249702171933606e-02   +3.102358827260672e-01   -1.313991488978491e-01   -2.476736655566136e-02   -1.363123943868065e-01; +1.011119842539465e-01   -2.646925762908188e-01   +2.859819906776750e-03   +2.675003205791644e-01   +1.275723281174571e-02   -3.146783563240466e-01   +2.953743403752733e-01   -3.171021000727109e-01; +1.854861102273660e-01   -2.514786444475169e-02   +1.173942187331432e-01   -3.473909885432856e-01   +2.560987976152960e-01   +2.396848464123066e-01   -3.861954681407745e-02   -2.301040533643660e-01; +2.023935622221267e-01   -1.181779036342880e-01   -3.170736880019986e-02   -3.051601845246701e-02   -1.633840373573548e-01   +1.035337249297576e-01   +1.552717972558095e-01   +2.722926317084683e-01; +2.160908487844230e-01   +4.431631499917403e-02   -4.033429192754942e-02   -3.221916770148940e-02   -1.237166357617436e-01   +1.232106142699937e-01   +3.024220238782580e-02   +1.175700052053655e-01; -1.745823929833729e-02   +3.725909341884481e-01   +2.057099957510098e-01   -2.015940347568871e-01   +4.668148839550169e-01   +4.894055541268919e-01   +1.364988549508208e-01   -7.968436876787180e-02; -1.502991589709139e-01   +5.201704873132473e-01   +5.668825846785962e-01   -4.719414116487847e-02   -9.166996152820128e-03   +1.042480321728126e-02   -1.331939531470719e-01   +4.153577943275460e-02; +1.566482407152671e-01   -2.195778859830018e-01   +1.485071135475292e-02   +1.542400173708560e-01   +7.142293586821780e-05   +3.651778065163466e-01   +1.062586380138140e-02   +4.719732247384391e-01];
L3E_L2E_iAMPA_netcon = [+1.726808390096156e-01   -1.731005519112678e-01   +1.566811659179787e-01   -5.178767332333435e-01   -3.102324902719702e-01   +1.929323691421224e-01   +5.407558258466982e-01   -3.565794883925880e-01   -3.695076024881580e-01   +5.659148905056816e-02   -3.033931942376358e-01   +2.843051851805721e-01; +1.483341311917163e-02   -2.485878955478065e-01   -4.230974899879980e-02   +2.281050920740727e-01   -4.258270261220453e-01   -1.836227360012246e-01   -1.655125012095231e-01   +3.580139161308393e-01   -3.855457563588892e-01   -8.552772647461154e-03   -3.204526488987266e-01   +4.739353216184331e-02; -1.467799899713177e-01   +1.926427140215776e-01   -8.164640450627786e-02   +1.406768608536529e-03   -6.694587454199398e-02   -4.520925968073016e-02   -1.742091796392895e-01   +3.931259244007546e-02   +1.001257263895144e-01   +1.498561115702784e-01   -4.191613501822987e-01   -2.061143552784515e-01; -3.418379015909280e-01   -1.512737153151801e-01   +4.972447174570589e-01   +1.822714707774160e-01   +1.945604506308623e-01   +2.573731846480142e-01   +4.971653030617187e-01   +7.725982022099337e-02   +1.135133430626371e-01   -3.117657363547156e-01   -3.523749092116102e-02   -8.705076733992227e-02; +1.612697242720629e-01   +7.945510752155230e-02   -1.797725775708689e-01   -1.029868742273928e-01   -6.812013862047622e-02   +2.288742902551025e-01   -3.678124726722259e-01   +1.530282799253621e-01   +5.405894027178997e-02   -1.638761864810529e-01   -1.276050799842784e-01   -1.170821541547013e-01; -3.688681326649170e-01   +1.082143954676430e-01   -2.617538119259881e-01   +3.850926198419005e-01   -3.972493807993256e-01   -1.742131205778774e-01   +6.038540971397854e-01   -4.637063398833044e-01   +1.785027150126644e-01   +1.278100021274562e-01   +1.469885197080121e-01   -4.946865439783109e-02; +1.841143710639289e-01   -1.231882700347896e-01   +4.990891764506842e-01   -5.092806810708208e-01   +2.708276488397309e-01   +2.750521538638733e-02   +4.819875366242414e-01   +2.333984864897956e-01   -1.420815889872287e-01   +1.207082165888450e-01   -2.828425637877977e-01   -1.691685826635550e-02; +2.610802711943574e-02   +1.692338346071088e-01   +7.563229903937387e-01   +1.993697553551151e-01   +3.194489767162501e-02   +3.055373129673902e-01   -1.552578908310101e-01   +5.682553116060596e-01   +5.871483194248028e-02   +2.481755491208124e-01   -1.970242804529325e-01   -5.179104101880154e-01];
L3I_L2I_iGABA_netcon = [-1.128096589704449e-01   +7.023711534701884e-01   +5.926128074782229e-02   +4.423603742669989e-01   -3.977076578717192e-01   -4.738567070156604e-01   -5.523238975369429e-01   +5.665686771836231e-02   -4.331518535701511e-01   +8.005237802814880e-02   -1.260970126425116e-01   +1.679012547974925e-01; +2.790103964438727e-01   -1.041201656222712e-01   -1.811634821751842e-02   +1.387763388169273e-01   -1.907791879968736e-01   -2.663751445827896e-01   +1.089002049573160e-01   +9.552429236795813e-02   -4.383707186781896e-01   -1.538157452938471e-01   -1.346173393921613e-01   +1.612266662163603e-01; +2.590858703738704e-01   -4.053836009569671e-01   -3.143551171110582e-01   -3.150480504708327e-01   +1.590066174760075e-01   +1.012006973042111e-01   +2.030683452086032e-02   -2.838144082302642e-01   +1.209603802348324e-01   +5.888990282424372e-02   -3.986076122931970e-01   +9.707568746471931e-02; +6.590118096998517e-02   +3.680841947659969e-03   -1.942456308521925e-03   -4.223200440122564e-01   +2.266498260197903e-01   -1.657761787299073e-01   +7.256953708356051e-02   +2.474009826253081e-01   +3.766573732108205e-01   +9.243292262096317e-02   +5.059123835681595e-02   -4.228123288402531e-02; +5.510632078468100e-01   -4.366427965176647e-01   +8.909547975523582e-02   -1.695408144914110e-01   -2.922262507159357e-01   +3.840454520905873e-01   -3.683750751796967e-02   +1.373192171145762e-01   -7.283743070462342e-02   +3.365777997382593e-01   -2.755823910905330e-01   -2.801816304593515e-01; +5.481146895201048e-01   -8.992882321670861e-02   -2.153938483121218e-01   -4.826897600750782e-02   +2.748878526922550e-01   -4.369724953746875e-01   +1.989726007824177e-01   -8.190236455437275e-02   -6.165951743343667e-03   +8.424746185499751e-03   -2.552794914151564e-01   -3.320087537867145e-02; +8.404677709229327e-02   +4.856664593861555e-01   +1.254233300003213e-01   -4.172967013825621e-01   +5.914988082291484e-02   +1.544454261622230e-01   +1.746577114995302e-01   +2.979428296369102e-02   -1.179345723760148e-02   -3.356931405394251e-01   +2.428083723670145e-01   -1.393917564798032e-01; +1.772604487263689e-01   -5.389152072541211e-01   +2.817442428235358e-01   +5.264899371357166e-01   -1.029302728703995e-01   +1.971226176891736e-01   +4.636151351719224e-01   -8.832777431971017e-02   -3.997340586763541e-01   -6.765218705012571e-02   -4.622247235288864e-01   -4.934329448957656e-02];
L2E_L3E_iAMPA_netcon = [+3.685659121136079e-01   -8.710134279758754e-02   +1.377815508545081e-01   +2.752595756371872e-01   -1.530045920839804e-02   +7.433742472538499e-01   -6.884481873978827e-02   +1.592548206516969e-01; -2.023686050339695e-01   -4.938080950435833e-01   +5.596856705257611e-01   +5.965028799641514e-01   -1.358245218144249e-01   +4.697264251743418e-01   +2.395521550788034e-01   -3.326167748746130e-02; -3.080009673648648e-02   +1.762721147165834e-01   -2.154642723414638e-01   +2.790224081653647e-01   -1.958682207385438e-01   +4.040027477041309e-02   +3.827656571840592e-02   +4.353996005872101e-01; +2.736122983677154e-01   -1.734996974403067e-01   +2.149519466038355e-01   +8.720737185477892e-02   -3.485435780726491e-01   -1.767010354025827e-01   +9.049876528925804e-03   -5.411878125974687e-02; +6.683199265341022e-02   -1.789019249644776e-01   -3.550213608552743e-01   +2.818375590871373e-01   -1.992944385531531e-01   -1.585094517840280e-01   +2.198059068043410e-01   +1.096440876507249e-01; -3.076027009751581e-01   +3.113722257468565e-02   -2.289154382346734e-01   -8.061119747495260e-02   +5.785824344086373e-01   +2.529528792055217e-01   -4.731435320180608e-02   -3.184573171644063e-01; +6.659606362666577e-02   +1.453181942462980e-01   +3.141118059716164e-01   -3.383638965031247e-01   +2.270687574705201e-01   -2.032620828782335e-01   -3.021658596665052e-01   -8.573040799006026e-02; -5.869906978946007e-02   +1.648446473720334e-01   +1.207381720665456e-01   -1.341600335535135e-01   +2.144151775714761e-01   -1.926415390825393e-01   -4.570556112602373e-01   +2.312924192144928e-01; -5.564504980396090e-02   +9.022240959445388e-02   +1.238304112960567e-01   -7.424975470016841e-02   +4.565517255072642e-01   +4.455322009073108e-01   -7.638321846062743e-01   -4.468025044651034e-01; -2.097223555340973e-01   +9.506601864071199e-02   -1.898434196470378e-01   +2.658034524323307e-01   +1.247726969538671e-01   +3.035571475330550e-01   +3.849020882581908e-01   +2.927182158655045e-01; +3.047792631856145e-01   -3.338015900088646e-01   -1.783018941121822e-01   -1.911038835921172e-01   +4.076337598170776e-01   -3.179253467693998e-01   +4.558890949901279e-01   -2.336758193629582e-02; -2.900591061317477e-01   -6.206637774620282e-02   -3.474250900304877e-01   -1.881189412262568e-02   -3.562572555223972e-02   -2.592735869496847e-01   -3.536431102100397e-01   -5.881639081379483e-02];
L2I_L3I_iGABA_netcon = [-3.190235125167295e-01   +4.830080930100201e-01   -9.968991078545191e-03   +2.888291223989865e-01   -3.179040838301381e-01   +1.504558718282910e-01   -8.815487475743455e-03   +2.178799307625721e-01; -3.977077197558512e-01   -1.133690284917310e-01   +2.551955207237542e-01   +2.159480948833079e-01   +3.223884768664694e-01   -4.342618235699935e-02   +3.166373147475814e-01   -1.807443436584998e-01; -3.040741453830997e-01   +2.684535794962345e-01   -3.138808436420175e-02   +4.210444742784675e-01   +1.435095015538355e-01   +2.787719735812361e-01   +1.563985365071688e-01   -1.179128369425031e-01; -1.920635744415833e-01   +2.811150453180745e-02   -7.307163643620677e-02   -1.985207659772343e-01   +1.349317218668984e-01   +2.389307845134104e-02   +6.258846226934944e-02   +2.081649055790472e-01; -2.148108523295831e-01   -1.639503236394091e-02   +4.990186857099970e-01   +9.600527098605868e-02   -2.882744950181927e-01   +4.836393449173471e-03   -2.498734763498092e-01   +4.991777600800604e-02; +2.936633712954367e-02   -2.758955234967488e-01   -2.327642526598515e-02   +2.840234032682325e-01   -3.476627840848964e-01   +5.775957838459294e-01   -4.012566162542204e-01   -3.114328208593434e-02; -3.239263771244043e-01   -1.788191416515522e-01   +1.830126579335075e-01   -1.873102530545382e-01   -3.969868217332794e-01   +2.163380660702343e-01   +1.226057134491337e-02   -7.209703152481631e-02; +1.761374403468022e-01   +2.291154424942983e-01   +2.027974719823288e-01   -1.788399442141170e-01   -2.971946377251027e-01   -3.556163044893888e-01   -7.039095831257254e-01   +2.760074331951602e-01; +4.320779900313904e-01   -2.232010818999106e-01   +3.566421819744098e-01   -5.338581299862677e-01   +2.308579943944452e-01   -2.881792366387541e-01   -4.639106382735939e-01   +1.736073294056691e-01; +2.406084067739279e-02   +2.771394153362334e-01   -5.607105190512314e-01   -1.187732939326440e-01   +2.120536048674882e-01   +1.993339049671250e-01   -9.153925420451570e-03   -3.100681848357566e-01; +1.337590819073670e-04   +3.323205272173868e-01   +5.660047811493091e-01   +1.306598423478604e-01   -1.480201966085579e-01   -5.512315386795947e-01   -2.873168590943230e-01   +3.585873530071121e-01; +8.105642583255773e-03   +2.433923685619361e-01   +1.265062067154391e-01   +3.628300290582588e-02   -1.304139977855299e-01   +1.766163701829751e-01   -4.254441440947888e-01   +1.598671824589274e-01];
L3I_L3E_iAMPA_netcon = [+3.847720404220589e-01   -3.006717783668122e-01   +1.338308060971362e-01   +6.495104355618596e-01   -4.854612076332459e-01   -6.572439843524456e-01   +6.273716214397228e-02   +5.705845470621546e-02   +6.974844633842048e-02   +3.276288332327217e-03   -1.937307054762290e-01   -1.301335674488931e-01; +2.866349641809134e-01   -1.290697520817332e-01   -2.632516365183748e-01   -1.294537527009633e-01   -2.752991314179251e-01   +2.410647863606545e-01   +1.347401919610579e-01   +6.832300072616068e-02   +4.326085829278636e-01   +3.369536540698773e-02   -1.371423627574038e-01   +1.129931719117102e-01; -1.537269891353969e-01   +8.853887047470133e-02   +5.233009638690408e-02   +1.231962581604829e-01   +1.995379992017033e-01   +4.789416664847790e-01   +2.846954138489740e-01   -3.133493437035765e-01   -1.373750425975818e-01   -1.729101901667912e-01   +1.066318930456310e-01   -4.315425134102881e-02; +6.161552953838539e-01   +1.641030553328733e-01   -4.277624925737333e-01   -1.855499734110921e-01   +4.170478219274205e-01   +6.638060433640947e-02   -4.261117676852777e-01   +2.793668843500626e-01   +2.543771192170868e-01   -2.097853086069378e-01   -3.826676917387248e-01   -2.136445377034767e-01; +1.876558254129632e-01   -1.374372234792514e-01   -3.867996049629643e-02   -5.572692123092605e-02   +5.195899137736941e-01   +4.589003298095212e-02   -5.341712370164252e-02   -2.157649274155798e-01   -1.798280623525902e-01   -2.824981364586976e-01   -4.519872627122100e-01   -2.738729971209023e-01; +1.441411958694686e-01   +3.808331887000213e-01   -1.695186512383706e-02   -2.416409597154663e-01   -7.926961134576013e-02   -3.436833555973283e-01   +8.426199612264822e-02   +1.254968409393188e-01   -4.074787334827696e-01   +4.589863657901940e-01   -1.708898181545201e-01   +1.577138729608596e-01; +4.812370413316279e-01   +3.838150139785337e-02   -1.238235040538761e-01   +1.487775466724143e-01   -2.646876065214195e-02   +1.524346357200163e-02   +5.690427769782780e-02   -3.614856098094453e-01   +8.375190616928266e-02   +8.738491369706539e-02   +1.206248039419452e-01   +1.314971606259649e-02; +2.857750782769379e-01   -2.837760683791150e-01   +2.891404691993135e-01   +1.894416623738245e-01   +2.715789346103578e-01   -6.635169227956617e-02   -4.827079641313692e-02   +3.996056957102702e-01   +4.113026636557226e-01   +6.401279939843990e-03   -3.143030356368668e-01   -1.045764577442602e-01; -5.030008531461375e-02   -2.965748206283813e-01   +3.508254907128902e-01   -6.486301165553943e-02   +5.788388061041239e-02   -2.476606679478083e-01   +3.165668073722430e-01   -1.810382032718738e-01   -2.304447492961034e-01   -5.016049303353294e-01   -7.626447242788859e-02   -1.695892846080287e-01; +2.569133695444528e-01   +8.249063087898384e-03   +3.816884462768812e-02   +3.467796299186171e-02   +6.383174112984649e-02   +3.972522847033402e-02   +1.777695046559011e-01   +4.110066161663520e-01   +2.071145727794171e-02   -5.970088487534791e-02   -1.715928505684292e-01   +3.682565102473636e-01; +8.671477061773285e-03   -2.596805778124722e-01   -5.017352941989559e-03   +2.066918871353229e-01   -7.549663642874981e-02   +5.179506828081001e-01   -1.619975389501919e-01   +1.884876050408897e-01   -1.231126741090503e-01   +2.354867686429273e-01   +1.388894686726426e-01   +1.726537631574672e-01; -3.509042030327338e-02   +4.302029077328078e-01   +3.831014063248203e-01   +1.239082880533817e-01   -1.332813551352673e-01   -7.391406182774446e-01   -3.297916920441079e-01   +3.729065175318519e-02   -2.059191835151587e-01   -6.007899193309162e-02   -1.019010823486536e-01   +2.452862938802302e-01];
L3E_L3I_iGABA_netcon = [+2.955197047096991e-01   -3.372061057706808e-01   -2.053409868184048e-01   +1.094745121183775e-01   +6.793639736911745e-02   -2.654560275660576e-01   +2.978190473040133e-01   +3.003571126164260e-01   +4.822384783520314e-02   +2.820212682083102e-01   +5.455772814734152e-01   -2.359693243723322e-01; -1.868960743516720e-02   -4.213364822262571e-01   +1.126204062478414e-01   +1.775750595739412e-01   +1.407474608051946e-01   -1.443971744701994e-02   +3.882530679401547e-01   -3.100592363090121e-01   -3.230784823863454e-01   +3.804899213066494e-01   -2.712754835980764e-01   -2.545791396319779e-01; -1.190289543597404e-01   -1.025082376224812e-01   -2.167824401460460e-01   +1.508709520922625e-01   -4.582289750378572e-02   -5.583756055790845e-01   -3.795896279392199e-01   +5.760753731000876e-01   +1.547925723242255e-01   +5.371453562320488e-02   -3.170655528981987e-01   -5.698409687389323e-01; +4.931504084608052e-02   -3.944218446822708e-01   -2.332592983286767e-01   -2.775973818866592e-01   -4.720923088550666e-01   +2.294458968718172e-01   +2.039113278484262e-01   -4.808324779113679e-01   -2.246113536455590e-01   +1.614970526298113e-01   +1.861026738563365e-01   -1.716967805040979e-01; +2.734351294516658e-01   +2.371838483271341e-01   -5.120348991839743e-01   +3.205620680244192e-02   -3.561048891863399e-01   +3.312012982806083e-01   +3.207950817142925e-02   -2.749410803970379e-01   +4.048268843911676e-02   -4.178031685360916e-01   -8.166916970524657e-03   +1.565295316179374e-02; +1.958773733249311e-01   -4.561363907170185e-03   -2.024222401651878e-01   +3.855222726116942e-01   -5.750706101269787e-02   -2.150917013603051e-01   -2.580867621857801e-01   -1.647577832788798e-01   -1.024420124803411e-01   -1.134458803169778e-01   +3.744541963885366e-01   +4.629646477089871e-01; +3.937343567508339e-02   -1.760454825849841e-01   +2.249296492073066e-01   -1.632230525955360e-01   +1.179889263054125e-01   +2.902506156381967e-01   +4.009551452420274e-01   -3.664310758826032e-01   -5.834478392016911e-01   +6.142860569174169e-01   -3.404452801598671e-01   -1.210651530823635e-01; -2.522257907539400e-01   +4.221470130414344e-01   +1.128862056636936e-01   -1.419126598046509e-01   -2.924557187003485e-01   +5.448173793154127e-02   -1.415362106157838e-01   -1.952978620842121e-01   +2.583187857952998e-01   -5.057464578825404e-01   -1.109151447578910e-01   -3.498978224213323e-01; -1.403427713737959e-01   -1.332050637950115e-01   +8.127439797545738e-02   +1.507667300658030e-01   +6.319362798910244e-02   +1.176692729259934e-01   +1.616670343314701e-01   +1.126384514465063e-01   -5.527496580521700e-03   +1.049643991430300e-02   +5.713617374692570e-02   -3.356101318021690e-01; +1.323928880793135e-02   +1.366832816930995e-01   +2.232685108036066e-01   +3.870138626149808e-01   +3.318911590307770e-01   -2.828862226731494e-01   -1.632754394876444e-01   +2.133660999085648e-01   -2.057340938621879e-01   -1.213851658809540e-01   +9.460952020196312e-02   +3.117673537660703e-01; -3.119953395386843e-01   +6.525441081199199e-02   +9.499539821260353e-02   -2.950138229184516e-01   -2.703219083480667e-01   -1.042539670822527e-01   +9.754077054311755e-02   +2.094619032853284e-01   +2.003360259038020e-02   -6.690621402340384e-02   -5.751032881803966e-02   +3.145200741322038e-01; -2.136956619692780e-01   +3.141362004028595e-01   -1.175713886449029e-01   -1.041139042900665e-01   +1.227177651117392e-01   +2.847965598879411e-01   -2.514983576352689e-01   -2.531863882777018e-01   +3.613248155812599e-01   -1.218582464247835e-01   +5.939325546981586e-01   +1.364681813569493e-02];
L2E_Input1_iAMPA_netcon = [+2.699859734228249e-01   -4.624682400136360e-02   -3.663816252619679e-01   -3.589992575132556e-02   -2.415233468916534e-01   -2.831167891757924e-01   +7.323323651854910e-02   -5.241491195771608e-02];
L2I_Input2_iAMPA_netcon = [+6.854064938488474e-03   -3.143379698905077e-01   +3.041882095370829e-01   +2.459295187284651e-02   +4.572107818142549e-01   +4.074593855393949e-01   -2.795194401031559e-02   +2.191775203340991e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
