function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.556682120589035e-01   +2.213084502378422e-01   +7.669803607031532e-01   -1.204474205773227e-02   +2.648098639069587e-01   +8.387399409929436e-01   +1.097543070698844e-01   +8.471902123454871e-02   +2.688057550730353e-01   +6.494226797198376e-01   +7.744485606111896e-02   +2.710603802544864e-01   +3.209039184731265e-02   +4.120765829005960e-01   +7.238039647667456e-01   +1.058086804032631e-01; +7.926129480674986e-01   +2.783515129169008e-01   -2.890656745472361e-01   +1.753540414784515e-02   +5.547480220407331e-01   +5.923075336482466e-01   +1.897473464364924e-01   +3.450285060871766e-01   +3.446449264043584e-01   +9.987604547238096e-02   +5.182648463310185e-01   +6.071983494742573e-01   +4.708640316074951e-01   +9.649205875094566e-01   +9.685576003816884e-03   +3.294652672107397e-01; +5.477175845837974e-01   +3.439451934719833e-01   +4.086224805552811e-02   +4.797396672549187e-01   +5.704188850161858e-01   +9.090141854362620e-02   +1.892072035211446e-01   +2.375679679164124e-01   +1.843947092011836e-01   +4.145277620979502e-01   -4.955091590738864e-02   +2.598738680015515e-01   +4.618251377417043e-01   +5.451938373739238e-01   +2.451512337888375e-02   +3.039743907338693e-01; +6.111234393708690e-01   +4.609127583731168e-01   +7.472138169711086e-01   +9.614126713813985e-01   +9.868669194935394e-01   +4.593669984338645e-01   +7.873123340516480e-01   +8.843830780626334e-01   +8.150130403793656e-01   +4.529950584191285e-01   +2.961636590443449e-01   +2.779240072625923e-01   +3.886467679502891e-01   +4.678563854556537e-01   +2.941702575915836e-01   +2.501628904008641e-01; +4.643677651453004e-01   +8.178392235147618e-01   +4.552053283093141e-01   +9.839451547398875e-01   +3.101983390750871e-01   -7.420295572154460e-02   +4.800678189855048e-02   +9.053852698608137e-01   +6.233997131054756e-01   +6.203967405036813e-01   +8.537346271145523e-01   +3.235244202492278e-01   +8.404908098775439e-01   -9.630082051981112e-02   +1.289305029772343e-01   +3.399642095862039e-01; +2.545147328140532e-01   +3.383790662406938e-01   +6.119098209509979e-01   -7.314817654970564e-02   +2.433009363815312e-01   +8.435161539501027e-01   +4.578172830118195e-01   +4.457826920290208e-01   +2.464587982205697e-01   +5.090521048852825e-01   +1.421891174002219e-01   +9.472612104227205e-01   +1.107696323103660e-01   +3.666762027327993e-01   +6.363135109816218e-01   +6.995054183180969e-01; +5.781759636058741e-01   +6.179951731117843e-01   +1.384533487460532e-01   +5.949247520968070e-02   +5.939768386091704e-01   +6.126016332493426e-01   +5.784156911637311e-01   +6.871878476663498e-02   +2.782553144788690e-01   +4.891122932231772e-01   +4.848582698136368e-01   +6.191315994693026e-01   +5.491882483572965e-01   +9.563159077552845e-02   +5.074747739259882e-03   +2.225069523322335e-01; +8.512797012648208e-01   +8.251266122336178e-01   +5.252682689340101e-01   -5.352235908690795e-02   +4.156760445533615e-01   -9.221560033209694e-02   +3.103337009534554e-01   +2.330699005939322e-01   +5.490604254504173e-01   +6.274665822346247e-01   +2.703021450478637e-01   +1.119401403100783e-01   +2.490642159301431e-01   +3.391391463469864e-01   +2.146671058475200e-01   +8.740225486479342e-01; +7.840513404133151e-02   +4.673876913721137e-01   +7.740037471795266e-02   +4.923008217854983e-01   +7.171808697646737e-01   +3.185075657665139e-02   +4.605683782340564e-01   +3.930761624837774e-01   +1.908706679494198e-01   +1.815925029016059e-01   +7.019998013950990e-01   -2.289863017754230e-01   +2.090172575629782e-01   +1.514063536757207e-01   +2.976634429440939e-01   -3.083761870151105e-02; +3.814052228778833e-01   +3.212518407060813e-01   +4.012814188671852e-01   +3.966037014525181e-01   +8.177469671250979e-01   +5.310602080822672e-01   +5.315378068078254e-01   +4.221408481575596e-01   +1.015691445118425e-01   +1.311246227005746e-01   +1.220439700599714e-01   +5.837382691532599e-01   +5.310604747079593e-01   +6.302360393722054e-01   +1.424453365578877e-01   +7.063863643595063e-01; +4.085551183319197e-01   +6.030101169147928e-01   +3.607154651643188e-01   +5.422317308886220e-01   +6.266111896412897e-01   +2.617939321812758e-01   +5.910890836941302e-01   +9.001665621396063e-01   +3.488340038947502e-01   +1.368814148207677e-01   +1.410941951217420e-01   +8.429387265729622e-01   +3.489882185821657e-01   +4.489750015117108e-01   +4.880165952343331e-01   -5.526894587616025e-02; +3.171462919986432e-01   -1.175335487971003e-02   +5.057732383023171e-01   +5.688162546855724e-01   +5.391998009813334e-01   -1.434270260790071e-03   +4.136336816190687e-01   -4.903184800735956e-02   -9.830674468995904e-02   +5.573360107348173e-01   +2.000331784918659e-01   -1.558711225144475e-01   +8.479614042435837e-01   +6.502899198358734e-01   +8.194338260956469e-02   +2.620789636561325e-01; +3.290990709217115e-01   +1.649245839251282e-01   +1.000000000000000e+00   +6.808493097921452e-01   +7.915138644267646e-01   +8.600933996586222e-01   +1.982914574204822e-01   +2.574743161077605e-01   +2.485428482647001e-01   +2.745248103313052e-01   +3.100516699067157e-01   +6.622805811879999e-01   +2.704400114859249e-01   +5.165818541716823e-01   +5.313943425852184e-01   +5.249076556950202e-01; +6.191534214965928e-01   +8.290196608028843e-01   +6.030321867513458e-01   +8.392266949244416e-01   +8.616166844764247e-01   +4.514882045289735e-01   +3.008708392751097e-01   +2.382951009340340e-01   +4.888578296863914e-01   -2.651428738432295e-01   +4.544241128302877e-01   +2.976599425166755e-01   +2.997921882254038e-01   -1.146614087745424e-01   +8.980365331133391e-02   +2.754038491965268e-01; +7.817160076047704e-02   +4.156429109119270e-01   +4.544190913769188e-01   +4.077150139199535e-01   +6.291580609442067e-01   +8.618557625134881e-01   -5.941490788728806e-03   +8.310354122917617e-02   -1.638325605633477e-01   +4.029288396564858e-01   +4.763642677113802e-01   +6.670760532983819e-01   +7.306649576792682e-01   +7.459974869426996e-01   +4.427100286125768e-01   +1.752974128505544e-01; +6.769795784041155e-01   +8.506873067526438e-02   -1.502761860846976e-01   +3.464513738517280e-01   +5.967320294130859e-01   +4.730160250314161e-01   -1.335736339047686e-01   +1.118211573126912e-01   +3.180637788165108e-01   +5.424713610157538e-01   +7.703650718023499e-01   +3.667763051840832e-01   +6.543166946347783e-01   -2.052064519957305e-01   +6.314087243406855e-01   +4.126940601359582e-01];
L1E_L1I_iGABA_netcon = [+4.716031359848995e-01   +6.032367691674837e-01   +5.507557642210615e-01   +3.142296001521393e-02   -1.080568956254931e-01   +1.187269508273882e-01   +4.690487324339003e-01   +1.892350009805034e-01   +6.725300519052911e-01   +4.897933262348327e-01   +3.704629520169976e-01   +3.894814189100048e-01   +6.871059680271271e-01   +1.159448644762341e-01   +4.254898233517511e-01   +1.942919167137272e-01; -1.885443439527017e-01   +1.721629535646746e-01   +9.713327631066239e-02   +2.894646117587437e-01   +1.811224488358500e-01   +3.964967469040876e-01   +3.416183629251488e-01   -1.994648594563670e-01   +7.398560349732156e-01   +3.689640981920347e-01   +4.313351796398593e-01   +3.423841750471301e-02   +2.890331893873880e-01   +2.631696072889651e-01   +2.777890135642017e-01   +3.588975147580684e-01; +6.273061724563623e-01   +4.417580029208515e-01   +4.045222102616450e-01   +3.106005820511906e-02   +4.832812255202155e-01   +7.869791230788294e-01   +2.650133337457054e-01   +1.072107702883750e-01   +4.856341251406149e-01   +2.277262634574854e-01   +7.329284499935267e-01   +5.676448106742320e-01   +6.652824653713146e-01   +1.610457799168238e-01   +3.943145304407819e-01   +5.044072341867544e-01; +2.633477315798626e-01   +1.098612445189381e-02   +7.576463812770023e-02   +5.607746146552288e-01   +6.022674477225841e-01   +4.490502686686206e-01   +7.284181362023812e-01   +3.509439096472582e-01   +2.844254026386450e-01   +6.950265232683965e-01   +9.272689170689365e-02   +2.636822624889534e-01   +5.289526029151137e-01   +5.681613269981557e-02   +4.877148285144912e-01   +4.536375513337114e-01; +7.524706890083734e-02   +5.519038767544232e-02   +4.018182241956984e-02   +2.723946997693261e-01   +3.047514065757501e-01   +4.294402156700156e-01   +5.920404952519638e-01   +7.379025340567378e-01   +3.231054450786843e-01   +2.266276630419954e-01   +3.679052881463534e-01   +6.331013719692203e-01   +1.890197238814459e-01   +4.566013200237704e-01   +6.109448109508240e-01   +2.761087203853738e-01; +5.969768785927775e-01   +2.970782259951873e-01   +3.159919004496481e-01   +1.831621744085768e-01   +2.836915367600386e-01   +1.764976717187602e-01   +5.022678456383315e-01   +4.707840518950360e-01   -2.803165661389311e-02   +4.816575554060518e-01   +2.952048426710693e-01   +2.442126046715412e-01   +1.489012401661536e-01   +5.532423028204643e-01   +4.102213832225144e-01   +5.655650963131464e-01; +5.316079106500500e-02   +6.647791573202954e-01   +3.843771204954653e-02   +3.484993080300067e-01   +1.026753501815090e-01   -3.019974706232919e-01   +7.194269769254534e-01   +3.335233387016163e-01   +1.176721129722012e-01   +1.674697041887720e-02   +2.504876354308339e-01   +3.436771350782358e-02   +1.507463319835379e-01   +4.587788828399439e-01   +6.169476284731283e-01   +2.972441977911748e-01; +2.239132274340893e-01   +1.000000000000000e+00   +4.852095574504423e-01   +1.348633919335888e-01   +4.944296746690127e-01   +8.357414015299423e-01   +6.286294220689275e-03   +6.498985968335085e-02   +3.362287700953844e-01   +5.644928168520582e-01   +5.638267470009490e-01   +1.136454327570109e-01   +3.436152027351229e-01   +6.483650105654887e-01   +6.157444590133565e-01   +1.363412078855606e-01; +1.242979289094858e-01   +1.514466535237856e-01   +4.427449016813818e-01   +4.870627291794047e-01   +5.785321156531176e-01   +2.856091940130907e-01   +6.402788852616913e-01   +3.802193852236104e-02   +3.249418356043073e-01   +8.604684711298904e-02   +8.774157649093662e-03   +1.954345385874812e-01   +3.676338976462307e-01   +4.394686995767295e-01   +4.168841501112879e-01   +6.821012840849473e-02; +2.535373201201895e-01   +7.535322109384168e-01   +4.489679415867533e-01   +4.697906293532465e-02   +3.175802955452368e-01   +6.477707055767916e-01   +3.581787075103054e-01   +1.513256752032304e-01   +3.593281645538803e-01   +5.808236004193073e-01   +2.367038589159398e-01   +6.077018833499295e-01   +4.614699462003498e-01   +1.630730723687290e-01   +6.422730184254641e-01   +2.233809989459148e-01; +8.662499646384517e-02   +6.223003311258268e-01   +7.293825401082824e-01   +5.667780641577248e-01   +5.430020199579952e-01   +7.486322846570004e-02   +2.366168057837235e-01   +4.193724376987287e-01   +5.261995831819900e-01   +3.609822306285905e-01   +6.899267166078342e-01   +3.861348000232353e-01   +2.280021220002285e-01   +6.434944707323130e-01   +1.722798398288754e-01   +4.635470241239253e-01; +5.968609084431274e-01   -1.229617526256220e-01   +4.363321596346512e-02   +6.751616816793643e-01   +7.072495755428185e-01   +2.039799501796233e-01   +1.795404233916077e-01   +3.529796659806055e-01   +1.106595174306490e-02   +2.189793421432357e-01   +5.056250610495088e-01   +3.485457969652307e-01   -2.094049771256378e-02   +1.160052571209371e-01   +3.546649954905365e-01   +5.969618852996571e-01; +5.289812396381158e-01   +6.114440963074284e-01   +7.102738693069863e-01   +3.764084532566130e-02   +2.796958243155794e-01   +8.820778086979859e-01   +2.652555576292981e-01   +5.357135660605072e-01   +4.033521793455039e-01   +3.583821651094454e-01   +5.960705599661651e-01   -9.534870888970351e-02   +6.356188430935886e-01   +2.889407195042148e-01   +1.900460070873546e-01   +4.747246227481468e-01; +3.838200893936618e-01   +4.922248613513209e-01   +2.386638219657494e-01   +7.841783715659582e-01   +7.954290570580642e-01   +6.998696304528337e-01   +6.253083458011268e-01   +2.084341694328687e-01   -4.399625834528016e-02   +3.137973810569484e-01   -3.919823505717242e-02   +5.647802112100176e-01   +3.342922511398516e-01   +5.141405407409848e-01   +5.405402192436861e-01   +2.762013635261886e-01; +8.840778845098043e-01   +8.165339280684258e-01   +1.070108975649341e-01   +5.179781658103971e-02   +5.228694630782840e-01   +3.380212819364289e-01   +2.992733277863474e-01   +2.010241340764309e-01   +5.818262582104470e-01   +5.364196550785758e-02   +5.418402791624918e-01   +3.253592245441791e-01   +7.256169840579502e-01   -1.276624546735398e-01   +2.139048424283185e-01   -1.638549307552972e-01; +1.927849293058470e-02   +2.235536070154375e-01   +6.145878818029187e-01   +1.285500699000336e-01   +2.673138017713636e-01   +4.092083852757911e-01   +2.186658673364038e-01   +6.266107453264000e-01   +6.079754806661870e-01   +9.835129879127393e-02   +1.175093145179527e-01   +6.593564378310718e-01   +7.953878256118503e-02   +1.167312360751769e-01   +1.563342850591011e-01   +4.113649913352881e-01];
L2I_L1I_iGABA_netcon = [+3.052338591740882e-01   +1.826259526121360e-01   +7.530094423745852e-01   +4.713092652035155e-02   +7.206290876481289e-01   +6.572571508144888e-01   +7.625781745097938e-01   +9.147304018372941e-01; +2.861622056779600e-01   +3.181949725560345e-01   +3.845041444602295e-01   +2.873053253331677e-01   +6.519443274326013e-01   +2.054701693959651e-01   +2.707499475791783e-01   +1.178661028354492e-01; +4.733899252121853e-01   +6.394044985108986e-01   -1.046276398191369e-01   +1.310587384924281e-01   +5.983247483178018e-01   +1.351952874164450e-01   +4.885896584266827e-01   +2.987841498498197e-01; +4.864135875901603e-01   +5.283336261152898e-01   +1.892365163848744e-01   +5.233254340047712e-01   +5.131417284702179e-01   +1.960147277040824e-01   +1.428989319283136e-02   +7.105076363891659e-02; +5.427488335926265e-01   +6.838212708865253e-01   +3.707917011668253e-03   +1.140950327515815e-01   +7.248553520895616e-01   +3.442214385736543e-01   +4.757683625789536e-01   +4.977332647028626e-01; +8.878535065606062e-01   +6.494743721071102e-01   +4.056747666771631e-01   +5.461841213422981e-01   +4.347651372924544e-01   +2.770121467892224e-01   +6.936269405225075e-01   +5.936521582968132e-02; +2.451870712648781e-01   +4.309721789147445e-01   +6.083657774657871e-01   +6.847856882702493e-01   +1.028971826864505e-01   +1.989989131911022e-01   +4.637288735616223e-01   +4.288782624461104e-01; +3.899549058879857e-01   +3.951617764911982e-01   -6.053726548727715e-02   +2.607482978976039e-01   +8.287778415584955e-02   +4.683167004441589e-01   +2.829935132708570e-01   +4.598745402384494e-01; +2.403461396230755e-01   +3.232340293767040e-01   +7.870835973979384e-01   +3.071484775213897e-01   +2.368311945445185e-01   +8.379111486289436e-01   +3.144264820525726e-01   +7.448723794985137e-01; +6.449440682443034e-01   +3.723572153300004e-01   -1.473605766992492e-03   +8.302303212407358e-02   +7.434783982342830e-01   -1.583756620361596e-01   +2.089271371921487e-01   +4.520833018580228e-01; +4.648109365489286e-01   +4.250832519642440e-01   +3.072803083302313e-01   +9.748517691341719e-01   -7.564777286384998e-02   +4.739384383366739e-01   +1.000000000000000e+00   +8.309713874606898e-01; +5.773249920665979e-01   +8.885368770051347e-01   -1.134944941452320e-01   +1.980084915853657e-01   +2.920983108642130e-01   +6.696277152282595e-01   +5.450459692627992e-01   +1.431920095999299e-01; +9.193845247915595e-01   +1.550756631051956e-01   +7.072142070172521e-01   +6.727502267011724e-02   +4.559058678495366e-01   -6.007121250712526e-03   +6.916618574701804e-01   +2.301320780241865e-02; +5.964899323142248e-01   +2.009043092050694e-01   +4.637259044024092e-01   -4.506144826456264e-03   +4.422743572749369e-01   +5.393588960040651e-01   +2.142554087564530e-01   +2.939910110121297e-01; -6.089945150701864e-02   +8.158142532219201e-01   +5.249102459545745e-01   +2.249009024489108e-01   +2.195934847231018e-01   +6.601442058949992e-01   +1.601932906666114e-01   +4.077811293208716e-01; +2.129125362068340e-01   +8.193854457363760e-01   +2.984693937979687e-01   +5.920620757906819e-01   +2.775838845526609e-01   +3.917520321030781e-01   +4.981277616115121e-01   +1.038126986599290e-01];
L1I_L2I_iGABA_netcon = [+2.453876778130293e-01   +4.516789897622576e-01   +5.457467298042830e-01   +3.937609357227326e-01   +6.965352228928092e-01   +4.481129859929111e-02   +5.972228935859764e-01   -1.733124255832150e-02   +2.248739145801555e-01   +7.851714680991670e-01   +5.320355692068942e-01   +5.457065493489754e-01   +3.965868593346875e-01   +2.498600394604990e-01   +1.782516004413368e-01   +3.941732109491503e-01; +7.790774268061228e-01   +4.650990883745588e-01   +5.492937691968771e-01   +4.454443433040823e-01   +7.676713113055121e-01   +8.174151962231782e-01   +5.196765176988055e-01   +3.026626599808984e-01   +4.941768548125854e-01   +1.343497093991462e-02   +1.160598357816986e-01   +8.645597762883518e-01   +6.700081326115064e-01   +4.129249377222334e-01   +4.698973953283466e-01   +8.618912230793566e-01; +3.127787394415393e-01   +3.518058446975645e-03   +2.967087325418076e-01   +4.473972967808867e-01   +4.003272466228289e-01   +6.685822203575330e-01   +5.451722653582788e-01   +4.930691979586185e-01   +4.858838534124093e-01   +3.851958972965169e-01   +7.325700094640512e-02   +5.397180111297202e-01   +1.112788392531127e-01   +9.507922537871719e-01   +4.875654881032261e-01   +1.987372576191266e-01; -1.520202647200385e-01   +6.859740670033360e-01   +4.996914374539485e-01   -5.893901951549353e-02   +5.174031113392137e-01   +7.355198705675063e-01   +8.396158727577143e-01   +2.309426574603884e-01   +7.582463141819019e-01   -1.506106568194926e-01   +2.163204052264114e-01   +8.535553029208696e-01   +1.406943108841591e-01   +5.193319100717988e-01   +7.494038679959684e-01   +6.029668106478377e-01; +5.711439451731668e-01   +6.969314772310029e-01   +7.015017937759090e-01   +2.263030668284023e-01   +1.104695184423645e-01   +2.965309752358046e-01   +5.792469121858769e-01   +7.049072151159527e-02   +1.446671913567979e-02   +4.119824312588546e-01   +6.119091101147692e-01   +6.391117578742707e-01   +2.039286175573639e-01   -3.726294242970067e-02   +4.601493827531601e-01   +6.703829301796973e-01; +9.091049633786988e-01   +6.177511128839903e-01   +2.776868069157294e-01   -2.325969367013713e-01   +1.820501419092223e-01   +1.897635226279108e-01   +7.522615548711731e-01   +3.295084153390009e-01   +2.913957760876051e-01   +8.723355064814633e-01   +1.000000000000000e+00   +3.269442459759793e-02   +1.197410369966939e-01   +6.879862636178664e-01   +2.895350571994689e-01   +3.040620925623149e-01; +7.962332780321760e-02   +6.242544304244725e-01   +6.780016015327947e-01   +5.518961693333390e-01   +3.770088535992682e-01   +9.460142263404127e-01   +4.129464965864942e-01   +6.928581075113047e-02   +3.269766785340715e-01   +6.345802226809628e-02   +5.362180474255170e-01   +1.258758535999503e-01   +7.856305017247016e-01   +8.845884200416712e-01   +3.082555153185240e-01   +5.812085455275875e-01; +4.488251878191215e-01   +6.510805790772436e-01   +4.503413504991168e-01   +6.748877528411822e-01   +8.294372583289077e-01   +4.648363680263701e-01   +3.104446312313570e-01   +4.980152333371557e-02   -7.999359019717887e-02   +1.909134698571375e-02   +1.166051475216077e-01   +4.042995461161100e-01   +1.793601182586239e-01   +8.495749998076901e-01   +4.476500059567318e-01   +5.335098066568627e-01];
L2E_L1E_iAMPA_netcon = [-4.485352451148842e-03   +4.023235333101586e-01   +8.069336342010727e-01   +5.389013823727374e-01   +4.870608513445684e-01   +2.807283576501500e-01   +6.942328043823106e-01   +8.927271176755635e-01; +8.907733203472570e-01   +5.790221279696587e-02   +3.395023112900408e-01   +5.501903792058471e-01   +1.869727498315110e-01   +3.407072364886098e-01   +2.976090086785247e-01   +5.439815877496220e-01; +2.719018673931606e-01   +1.678478704082122e-01   +5.446091383530225e-01   +1.000000000000000e+00   +2.210761123978359e-01   +5.783133990561818e-01   -1.498465637950533e-01   +7.868112712567052e-01; +4.395794600420194e-01   +2.382265157230832e-01   +5.014722599136715e-01   +8.229690207701761e-01   +5.689099359960810e-01   +4.007323628216289e-01   +6.735256605116071e-01   +6.875585923716663e-01; +9.420283109856636e-01   +7.120600434882214e-01   +3.645202167920506e-01   +9.373393254885554e-02   +4.157050210904832e-01   +3.669200194770541e-01   +2.870194282994993e-01   +5.247141595053154e-01; +8.607696617830887e-01   +2.712576738481095e-01   +8.991120253664675e-01   +7.323221206412627e-01   +7.894195271409294e-01   +6.238483686064936e-01   +7.324940907815940e-01   +7.619648534922780e-01; +5.558786501197382e-01   +1.836493898905695e-01   +1.336041902938128e-01   +1.218336277093676e-01   +7.221402892518175e-01   +5.516560301001258e-01   +1.744171774837056e-01   +8.120515460148385e-01; +7.804251937054923e-01   +5.179972974065509e-01   +6.450716279876295e-01   +5.606424407626096e-01   +3.422063929977580e-02   -1.438505954106881e-01   +4.969518729409406e-01   +8.025578347233886e-01; +6.842902034622465e-02   +2.652116793399122e-01   +5.111992165311841e-01   +2.409816379054504e-01   +7.697957893708379e-01   +7.661434842202963e-01   +3.815873632850584e-01   +5.311561712659175e-02; +5.396144844755001e-01   +3.502989836085902e-01   +4.587322714676044e-01   +8.362552194968548e-01   +5.316750834504163e-01   -1.136216869265206e-02   +9.362518728834710e-01   -1.777766042799239e-02; -7.237822248432806e-02   -1.002851607360500e-01   +3.282376930621990e-01   +6.949367106501314e-01   +2.032628118970071e-01   +6.138430340808687e-01   +7.642351755023633e-01   +1.872915919252960e-01; +6.757357939531111e-01   +2.894641521952997e-01   +3.306015824327785e-02   +7.599382508673620e-01   +6.271224571190880e-01   +6.131100481778741e-02   +3.790974743494746e-01   +5.772224247859217e-01; +1.825063565000640e-01   +7.194782174443544e-01   +5.600210086455896e-01   +3.118832019269910e-01   +5.262300549366218e-01   +4.152516229056570e-01   +5.803527312246275e-02   +4.434381401199103e-01; +9.312285691684118e-02   +7.201626363084189e-01   +7.808800946176173e-01   +5.459290115587678e-01   +3.428314130314906e-01   +5.166896620513700e-01   +4.172537847589028e-01   +8.962324011676108e-01; +6.409154505750805e-01   +2.284719311209237e-01   +3.809949707136514e-01   +7.028644314166804e-01   +9.277937059847774e-01   +5.842477681109098e-01   +6.613184588850242e-01   +5.779567420368923e-01; +4.491828268252459e-01   +4.341019017472449e-01   +1.869362065114218e-01   +1.961194199179718e-01   +6.598096588621701e-01   +1.387921052158927e-01   +1.752972812233246e-01   +1.249450738645116e-01];
L1E_L2E_iAMPA_netcon = [+3.085590734356800e-01   +4.347727648255921e-01   +2.736534341475666e-01   +3.375475024038967e-01   -4.827164717741261e-02   +3.771412721647390e-01   +1.789559541269402e-01   +8.178857066871340e-01   +7.608869419541336e-01   +4.099004876839482e-01   +3.069978798449510e-01   +6.619841771405351e-01   +5.237815385372562e-01   +2.253501022512788e-01   +4.894897876716067e-02   +4.591033286211456e-01; +3.539247522395432e-01   +5.003078229514021e-01   +8.904926129383880e-01   +7.415571083523581e-01   +4.698492114716340e-01   +5.908869949575613e-01   +5.270095909320991e-01   -1.479719018866972e-01   +3.609279816942910e-01   +4.375687859542535e-01   +1.909624250530363e-01   -1.190132801651528e-01   +5.046742639554792e-01   +1.552678145129290e-01   +1.533060959569379e-01   +1.330226788620887e-01; +2.099717933246859e-01   +1.844484610949475e-01   +5.385322445808024e-01   +5.771768776062736e-01   +1.335088605536059e-02   +2.590096056293426e-01   +1.886377477573943e-02   -1.738957398771171e-02   +4.467808905446340e-01   +3.160161913195924e-01   +1.000000000000000e+00   +3.976430881690404e-01   +3.619680382956748e-01   +6.097107573187817e-01   +5.090194444054451e-01   +4.234644899841093e-01; -4.257951773397713e-02   +7.120961458005942e-01   +4.349726047454858e-01   +5.776200733659095e-01   -1.391754481181295e-01   +5.688896055724383e-01   +2.479349935695588e-01   +1.249732602011334e-01   +3.314242990511864e-01   +5.548521224022205e-01   +3.644023610780986e-01   +2.908591901893446e-01   +3.711578389883176e-01   +3.393162113674134e-01   +2.744223142849803e-01   +1.735278629624138e-01; +3.306234342343052e-01   +5.817794937656426e-01   +6.885917238872192e-01   +1.785977668917519e-01   +2.102095624888104e-01   +7.479787313321903e-01   +4.110199778565549e-01   +2.845008329678013e-01   +5.966434946696022e-01   +6.673285681006143e-01   +8.128716087233636e-01   -2.969528465676571e-02   +7.843792231681483e-01   +7.871253896590057e-01   +3.185658559313151e-01   +2.375202322095538e-01; +3.613175335982288e-01   +1.426034840214860e-01   +3.832920534359913e-01   +3.801860894498067e-01   +5.582708233396677e-01   +4.938766689065607e-01   +6.984879142419836e-01   +1.582494572488586e-01   +2.450109874900862e-01   +5.433087035222881e-01   +2.153564351489067e-01   +4.667544386043925e-01   +4.585310387051538e-01   +3.062348412755803e-01   +5.677043642765364e-01   +4.400010630278820e-01; +4.272756795493362e-01   +3.406554534806912e-01   +3.653310474957359e-01   +6.172547704744500e-01   +2.246270075296235e-01   +1.360182919080146e-01   +7.766252047493872e-01   +7.619508663318298e-01   +3.114282537657200e-01   +5.834675829771874e-01   +4.987787807443851e-01   +5.091811868219638e-01   +2.789611109058805e-02   +4.331148293555012e-01   +2.588478919994367e-01   +1.079810933645422e-01; +4.751870692746463e-01   +5.336608441288456e-01   +4.732292629188151e-01   +1.794658391510191e-02   +6.729364249306251e-01   +4.563936559474627e-01   +5.631446529775946e-01   +3.888447879689653e-01   +3.277881941565264e-01   +8.325594555048745e-02   +5.110719277626038e-01   +1.861007819811824e-01   -2.229664671602707e-02   -1.584885229759204e-01   +4.861906208022810e-01   +5.458124978456789e-01];
L2I_L2E_iAMPA_netcon = [+1.582800520669445e-01   +7.170191714266586e-01   +5.704706604205664e-01   +6.921458593290369e-01   +4.016547787063072e-01   +5.355477693279447e-02   +9.621833874600543e-01   +5.844866788088593e-01; +5.886811533557379e-01   +8.704627078650236e-01   +3.428989628974685e-01   -4.159888917108608e-02   +6.504622506306698e-01   -5.396098216947835e-02   +1.834972490271230e-01   +3.665097480521293e-01; +6.475736129135212e-01   +4.411422519308936e-01   +6.848380841960839e-01   +5.272684864043511e-02   +3.850859749357430e-01   +7.126051204069459e-01   +3.027328350503114e-02   +2.766832042483161e-01; +4.731791002003566e-01   +6.671614834978589e-01   +2.076298612477699e-01   +2.000512558056294e-01   +6.606502857361457e-01   +7.601310125393261e-01   +7.125333171564784e-01   +6.322421319471930e-01; +8.390619904765159e-01   +3.082246931453679e-01   +5.955272263948068e-01   +3.434123566160797e-01   +2.661901626122073e-01   +7.775827013034587e-01   +6.354432886623638e-01   +3.815322412544319e-01; -2.178331532316108e-01   +1.856741796577011e-01   +1.010611092136654e-01   +3.709197747404741e-01   +1.054937736042620e-01   +6.857341935685992e-01   +8.128253331426319e-01   +2.267721368372013e-01; +8.015472091022238e-01   +2.493374188754130e-01   +5.590052017950163e-01   +6.873880801554241e-02   +1.917731970533125e-01   +2.454389163417298e-01   +7.465421309303775e-01   +5.063335504573702e-01; +2.540684243225321e-02   +4.517617865972097e-01   +2.143180603141217e-01   +1.807348720927253e-01   +8.313701258055816e-01   +4.369385763169785e-01   +1.437290605026537e-01   +4.088196657316490e-02];
L2E_L2I_iGABA_netcon = [+9.082081147079279e-01   +7.402436701005595e-01   +7.617598262324148e-01   +6.083331639448795e-01   +3.286805209869304e-01   +2.592851910689856e-02   +3.011715728956542e-01   +2.037665954477739e-01; +4.464673222323206e-01   +9.262304024487369e-01   +8.329022286704285e-01   +8.158073191581696e-01   +1.423073818572476e-01   +3.302949947082612e-01   +2.242364945849155e-02   +8.955924857410841e-01; +1.310377554760508e-01   +8.666347043650791e-01   +9.571630358646960e-01   +8.374682255406637e-01   +4.692878595633255e-01   -9.997541134947974e-02   +6.039312420805028e-01   +7.675875036471541e-02; +4.349293294895015e-01   +3.376272343838181e-01   +6.448399429137239e-01   +2.762151401096125e-01   +6.484863872002272e-01   +4.484412317653218e-01   +3.521317307691240e-01   -1.087877050429318e-01; +5.945513276484147e-01   +8.179829712247941e-01   +5.943447038744540e-01   +5.921862523146052e-01   +6.471887214588270e-01   +2.867353300748110e-01   +7.448160400613215e-01   +4.252138375741649e-02; +3.156875907219249e-02   +1.605382339754222e-01   -1.233494570522001e-01   +1.488971279395913e-01   +8.210377731508620e-01   +6.181363278246675e-01   +4.882290051958069e-01   +1.740262361902502e-01; +5.103679284569530e-01   +8.654645123495973e-01   -7.971187362254828e-03   +2.790055804583738e-01   +5.151699432990756e-01   +9.513964167364876e-01   +5.532863826857043e-01   +7.735267686660292e-01; +2.923451663990718e-01   +2.775484111204861e-01   +3.019704466347460e-01   +6.973854211278065e-01   +4.321125589303144e-01   +4.282176352283728e-01   +1.898194936863092e-01   +1.817149463351298e-01];
L3E_L2E_iAMPA_netcon = [+2.799389662736415e-01   +1.384883079164513e-01   +5.772103654566357e-01   +4.844558928212508e-01   +6.213207855804732e-01   +6.921672494088862e-01   +6.297223172592691e-01   +6.770378232278944e-01   +1.084074106927730e-01   +8.373431536997792e-01   +9.178441076139765e-01   +6.019329565677566e-01; +3.883580807506760e-01   +4.869123964773490e-01   +7.497592734984653e-01   +3.894205001429917e-01   +4.850809303934135e-01   +3.582060344659204e-01   +2.314741399600653e-01   +9.472613756578052e-01   +1.641044191259692e-01   +6.099279792842894e-01   +5.167833643928862e-01   +1.235338705220766e-01; +2.397325055249024e-01   +1.613871477856611e-02   +4.334277380612350e-02   +4.991180646060244e-01   -2.114017988585140e-03   +4.263114063237246e-01   +3.301248306493403e-01   +2.457965970001568e-01   +1.418630651020410e-02   +2.374776552263768e-01   +3.733631516055170e-01   +4.886859098815162e-01; +5.275280613512425e-01   +5.320683834914957e-01   +7.233690812909266e-02   +5.493857274983744e-01   +5.366691972958727e-01   +2.100233512799314e-01   +2.496754954865070e-01   +2.189511710801645e-01   +6.973551605710890e-01   -1.892923746326441e-02   +3.173425701560473e-01   +5.772882697766271e-01; +5.815334364547724e-01   -1.383858841153261e-01   +7.177526137174742e-01   +5.374075614745001e-01   +6.354388175023685e-01   +9.892967852328005e-01   +3.326427846261796e-01   +5.309905066613976e-01   -4.903202425157124e-02   +9.397672290342052e-01   +4.114633562554000e-01   +1.945563326921843e-01; +6.725156011242494e-01   +7.558170573629150e-01   -1.212104763805803e-01   +4.488327190513883e-01   +2.187697977682384e-01   +8.173857361134085e-01   +6.163058183586283e-01   -7.686382436701426e-02   +1.711859671286625e-01   +6.955343379841337e-01   +3.002092003632917e-01   +6.593647684687147e-01; +1.990526302236895e-01   +4.179936896645631e-01   +4.175706002611859e-01   -1.256883543974181e-01   +8.629865398750439e-01   +5.099707417819679e-02   +6.548007979452395e-01   +6.956291951131975e-01   +1.659766390730900e-01   +3.281378965292694e-01   +3.208159472893614e-02   +6.602062185352645e-01; +3.188237950431296e-01   +4.179326515296688e-02   +1.078373959397148e-01   +3.470994003515616e-01   +8.268144146261653e-01   +1.350057934563428e-01   +4.707277815600401e-01   +2.372513078509595e-01   -9.788916495803712e-03   +5.071223395199123e-01   +4.743351716202697e-01   +1.800828481191931e-01];
L3I_L2I_iGABA_netcon = [+7.496599112738686e-01   +4.997569371197275e-01   +6.769581117061095e-01   +8.766393878125948e-02   +3.491409818730019e-01   +5.130102550530624e-01   +4.843544731383180e-01   +3.959496596540548e-01   +5.294939932617241e-01   +5.053666267608761e-01   +5.216682303129070e-01   +7.303952191172243e-01; +4.823889693229008e-01   -2.054055827864850e-01   -6.540146492375665e-02   +7.000880462746852e-01   +1.427962079687960e-01   +4.884001485730069e-01   +2.055302861984112e-01   +3.691886912078530e-01   +7.110101854979241e-01   +6.276112010719219e-02   +5.938957282042909e-01   +2.025060508363806e-01; +2.453104317185728e-01   +4.042317741331043e-01   +7.592278365737875e-01   +8.226587234978252e-01   +6.995407448375664e-02   +2.592786463585762e-01   +8.641217416031316e-02   +6.203507220222572e-01   +5.778233684283657e-01   +2.887347531603300e-01   +7.336661875515335e-01   +8.887133007606119e-01; -1.246057140100853e-02   +2.796254942420703e-01   +7.704818908305524e-01   +3.134693443932617e-01   +5.055192446605113e-01   +7.038872619408435e-01   +1.754289180762853e-01   +5.099717485255357e-01   +2.148832019744628e-01   +2.250121730280868e-01   +2.912944354308994e-02   +1.332596772869983e-01; +2.642445147781380e-01   +4.707547783349737e-01   +1.838658137760273e-01   -6.491117704854892e-02   +3.656925343934041e-01   +3.085510164258969e-01   +3.044302413711863e-01   +3.512347912148216e-01   +2.599131814072358e-01   +6.430766158653783e-01   +8.885367105307652e-01   +6.445920893713523e-01; -6.180050962803886e-02   +7.913130120769515e-01   +3.392657601045166e-01   +4.787797365092381e-01   +2.470128157860032e-01   +1.772561644083085e-02   -6.621504538296553e-02   +2.890003452572632e-01   +2.008122627464276e-01   +6.555275586304216e-01   +6.663116613902176e-01   +6.904963788463440e-01; +7.173665563499019e-01   +4.032049602555097e-01   +7.321360135076954e-01   +3.764128878900493e-01   +4.641693254869964e-01   +3.438606325474122e-01   +3.400708929281930e-01   +3.349480473748320e-01   +3.049047341446490e-01   +6.253671509188253e-01   +2.739036690707164e-01   +6.910224040801918e-01; +5.370350025381022e-01   +7.261277679412711e-01   +4.390974511561372e-01   +8.723512391610370e-02   +2.661811136623196e-01   -2.275930160710639e-01   +1.000000000000000e+00   +6.349706017463886e-01   +5.871951364022766e-01   +6.383017147951922e-01   +3.765664836957736e-01   +7.334749772037568e-01];
L2E_L3E_iAMPA_netcon = [+1.912315955542870e-01   +3.172023266548151e-01   +2.266005211002249e-01   +6.288726466987707e-01   +7.013606142519558e-01   +2.099252776789016e-01   +3.365158014478368e-01   +3.039913633083349e-01; +5.924654892754397e-01   +7.008318390610331e-01   +1.058940035696625e-01   +6.263860540509025e-01   +1.502235312285221e-01   +6.043418407586659e-01   -4.297479827805848e-02   +5.099725746661747e-01; +9.364898398046083e-01   +4.015826010998502e-01   +4.135730069919192e-01   +4.358678955112601e-02   +8.459572502173877e-01   +1.035082825358537e-01   +3.482758884345842e-01   +2.943262652292409e-01; +3.900626517974673e-01   +7.072690868648289e-01   +6.980960262608181e-01   +5.018802344640992e-01   +6.572582824432368e-01   +3.664355407010551e-01   +4.829804922757658e-01   +6.404496815782766e-01; +2.734874144112388e-01   +1.116464696190734e-01   +7.731202322065286e-01   +5.191783849531245e-01   +3.567849370337722e-01   +1.328400531173460e-01   +8.259893274049978e-01   +2.345509104963378e-01; +3.769761863894869e-01   +5.674224480875016e-01   +8.088787732365614e-02   +8.974544630911805e-01   +9.739773861549819e-02   +7.882768556573466e-01   +2.846117935698889e-01   +7.372539242530635e-01; -2.338972533469884e-01   +5.103894610690862e-01   +4.138706758885022e-01   +1.850822273857170e-01   +3.793354544152466e-01   +8.381613288152215e-02   +8.067682687235427e-01   +6.263607857020806e-01; +3.099196214787700e-01   +7.380311333625930e-01   +3.565618788301222e-01   -7.057078597522259e-03   +4.835103651650542e-01   +4.189714011935688e-01   +7.315102062067810e-01   +1.325683367203221e-02; +5.432298108586120e-01   +8.242520991577053e-01   +7.163743507038234e-01   +6.948965653203495e-01   +1.705035577096023e-01   +6.011881923310002e-01   +6.081038512435555e-01   +9.560189940800347e-01; +5.724805864184835e-01   +7.886714244559914e-02   +1.782739043851285e-01   +6.441397808818783e-01   +3.899160649742059e-01   +2.212760799777684e-01   +8.093743498330177e-01   -1.595648133124105e-01; +2.695590600180522e-01   +4.213988796673255e-01   +1.152233548935499e-01   -4.957083067030289e-02   +3.267840156041801e-01   -6.544745456908910e-02   +4.321263791181939e-01   +9.310573014801145e-01; +6.475917038487246e-01   +4.643781920941363e-01   +4.432755590619126e-01   +1.000000000000000e+00   +8.578876624417556e-01   +1.997654324591644e-01   +1.065813396578467e-01   +4.122535427117498e-01];
L2I_L3I_iGABA_netcon = [+4.989131984760162e-01   +2.802630692121926e-01   +6.764978327750190e-02   +1.000000000000000e+00   +5.193661224360382e-01   +6.006638144571133e-02   +7.882241442739276e-01   +2.098159230561268e-01; +3.809411036172806e-01   +2.944049665669264e-01   +1.301113072609195e-01   +2.965244409100445e-02   +4.315883233263892e-01   +7.297003373287366e-01   +9.197419244667394e-01   +4.313146047418024e-01; +2.587241918104296e-01   +6.242594412658704e-01   -4.058656135256952e-02   +6.962190273373702e-01   +2.455015812935937e-01   -8.073697870740751e-02   +3.597073373272685e-01   +4.288749163681189e-01; +2.778317009860321e-01   -2.575644282949349e-01   +6.700774313116542e-01   +5.634761291747306e-01   +7.203929182260863e-01   +1.098361477235367e-01   +5.283363686127515e-01   +4.035757100982301e-01; +2.741392510263738e-01   +5.261236154557286e-01   +3.109404910294508e-01   +1.100302576332036e-01   +2.714593807550219e-01   +4.830200406911733e-01   +6.317108884726783e-01   +6.803572949991527e-01; +2.121566565363880e-01   +5.139686220447759e-01   +8.855581286364374e-02   +4.271053732714030e-01   +4.236994502682303e-01   +7.050581037519648e-01   +1.898419724391238e-01   +5.031715827784492e-01; +6.257526712681215e-01   +2.417072299139104e-01   +3.728229105978652e-01   +7.650676148765188e-01   +3.808928485656983e-01   -1.501054278319779e-02   +5.058200712906251e-02   +5.583414794859627e-01; +4.433821634910999e-01   +7.113463190670313e-01   +4.572759573286231e-01   +2.553962162470240e-01   +2.855178548201729e-01   +6.922047078510296e-01   +3.933080075601129e-01   +5.185744695949426e-02; -1.163378507440349e-01   +3.110219508729983e-01   +4.634179866523591e-01   +3.771403313025606e-01   +6.093134056623707e-01   +5.515545370576060e-01   +5.803190345414588e-01   +4.390742984867526e-01; +6.944563251422545e-01   +1.807601947726054e-01   +5.219300279696359e-01   +1.879226395104830e-01   +3.849199833883177e-01   +6.196412821386217e-02   +1.184214458620197e-02   -6.404435073751625e-03; +5.043377620336821e-01   +7.627816786909367e-01   +1.858250714346175e-01   +7.731162866139685e-01   +6.948079018022427e-02   +1.685383355420215e-01   +2.574640649275630e-01   -4.892632907890196e-02; +9.399933121127052e-02   +3.842567428315047e-01   +1.634701285036557e-01   +3.061200935206796e-01   +6.320679454499039e-01   +7.836843480921780e-01   +9.091958031155444e-01   +1.237991783002723e-01];
L3I_L3E_iAMPA_netcon = [+2.958687763720960e-01   +7.883747984873467e-01   -2.268957592903257e-02   +4.030545221260663e-01   +8.173342785652363e-01   +8.799065925540310e-02   +5.820940642595344e-01   +4.847010050152262e-01   +1.252845204221708e-01   +2.334570363369715e-01   +2.004733756561563e-01   +5.533978915212496e-01; +6.899635593043461e-01   +7.442378606501941e-01   +6.626576952761885e-01   +2.051575279149300e-01   -1.867644635088045e-02   +6.331127707983839e-01   +6.685774444593131e-01   +9.669513132888966e-01   +8.865911413352998e-02   +7.899688113810611e-01   +3.091196446084817e-01   +6.046377646139575e-01; +5.049591314603716e-01   +5.734098265249352e-01   +4.224931197688744e-01   -2.405126380747678e-01   +7.550737256727845e-01   +7.715684382102680e-01   +3.559014281487962e-01   +7.523326936358220e-01   -5.880400463820005e-02   +4.859831735012963e-01   +1.000000000000000e+00   +6.213697187611195e-01; +7.976604693574983e-01   +6.213081643922826e-01   +4.110317637095966e-01   +8.371977764232977e-01   +7.108599999181643e-01   +8.364185525443366e-01   +9.560908986703324e-01   +7.289438056833278e-01   +5.421381432892326e-02   +7.157159774177831e-01   +4.640089514086045e-01   +6.717877145983880e-01; +5.915737483092420e-02   +1.413298464162639e-02   +7.517206828001914e-02   -3.941785735410114e-02   +6.363773132730979e-01   +8.742935403438794e-01   +2.135783234763511e-01   +6.413791237453826e-01   +5.443232751712236e-01   +1.989556213522258e-01   +8.665427758699296e-01   +6.076755161777841e-02; +3.529499072253762e-01   +9.056767066189010e-01   +2.886620126132595e-01   +7.184049385967555e-01   +4.866821949813748e-01   +2.068292679312495e-01   +5.778549750884387e-01   -4.740568656294056e-02   +5.384893861372910e-01   +2.962987446860614e-01   +3.685225043461916e-01   +3.554266490117006e-01; -5.934412736629615e-02   +3.175829932752380e-01   +4.415977952052053e-02   +1.312341462298194e-01   +8.636619325201315e-01   +2.148605574540721e-01   +4.193551359986789e-01   +5.927699775990669e-01   +2.816455243779847e-01   +4.394515833778114e-01   +3.504437690994450e-01   +3.501164202937099e-01; +1.118418696671307e-01   +1.057388159989935e-01   +2.669442735481723e-01   +2.193547115082126e-01   +2.007589777973493e-01   -2.621006215602838e-02   +2.871385503211315e-01   +4.775674706815152e-01   -2.507759057073263e-03   +6.962185285397918e-01   +4.016826438272308e-01   +2.574412236382107e-01; +1.185853737002848e-01   +2.093206489274054e-01   +4.828899240893391e-01   +4.937098671743896e-01   +3.734732454784425e-01   -1.533802404523716e-03   +2.414515053606207e-01   +4.701096831835554e-01   +6.283688455158690e-01   -1.568308741609074e-01   +1.258178512261067e-01   +4.604009803427564e-01; +4.190079075704494e-01   +5.725592297500484e-01   +4.010093774082935e-01   +5.732626021310823e-01   -1.466563341415472e-01   +3.516745069491611e-01   +7.015095995799814e-01   +6.068172555459356e-01   +6.509559839383222e-01   -6.782647954032581e-02   +6.360480211845047e-01   +2.568912812516810e-01; -1.869947188868741e-02   -7.469054101993735e-03   +7.100015782680648e-01   +2.820323038344671e-01   +2.324153677190678e-01   +4.567035490328010e-01   +8.143269611156856e-02   +4.714159205726767e-01   +7.686536833230765e-01   +8.261053068250882e-01   +1.704915884470017e-01   +6.254262152441303e-01; -1.904027163506583e-01   +4.255726513033745e-01   +4.107419862266617e-01   +4.674811057559684e-01   +9.707804569491962e-01   +2.304883850104344e-02   +5.282736904408829e-02   +5.149085598769955e-01   +6.686389318893398e-01   +4.219312676678815e-01   +2.206843687561542e-01   +4.164618967560333e-01];
L3E_L3I_iGABA_netcon = [+4.570408493470301e-01   +2.091331834747421e-01   +1.224932661047671e-01   +7.499902144544816e-01   +4.123897214156211e-01   +6.549566036821289e-01   +7.268420810273472e-01   +7.387860444967395e-01   +7.389788609201210e-01   +1.118781106970159e-01   +1.303505828342649e-01   +4.088660002348847e-01; +5.421002295687197e-01   +3.041486763029683e-01   +7.841868242400356e-01   +3.289126651128468e-01   +5.258930154152053e-01   +6.293017036287560e-01   +1.000000000000000e+00   +2.641959848815662e-01   +4.487299113811635e-01   +2.457574573327572e-01   +2.531697003609665e-01   +5.104958973369245e-01; -2.126048180822377e-02   +1.548731703157050e-01   +4.861154172034082e-02   +3.810512426180767e-01   +3.772584094217988e-01   +4.276056626250268e-01   +6.811000628428195e-01   +6.004928614818327e-01   +5.245421185857947e-01   +5.177871362948916e-01   +4.208169505377607e-01   +2.995140940311362e-01; +5.168668310479960e-01   +7.064361326969978e-01   +5.836337730610456e-01   +1.795857355777929e-01   +7.504809333082280e-01   +8.878501687095294e-02   +6.131992158038791e-01   +5.258399825553043e-01   +3.366502540775151e-01   +7.392118958477216e-02   +6.695414665127674e-01   +4.615446772394195e-01; +1.922543743611711e-01   -6.295026642138310e-02   +3.791491396073322e-01   +3.109540632539603e-01   +3.138945343715059e-01   +2.130379283999511e-01   +5.017624988003453e-01   +5.156681514406448e-01   +3.132970767968003e-01   +2.242103133740458e-01   +4.036579490440607e-01   -4.101884915600303e-02; +1.446773291408598e-01   +4.025269790145197e-02   +5.266845963689558e-01   +6.543518642397712e-01   +2.861593028334135e-01   +1.031782799921522e-01   -6.049423976141637e-02   +1.998416375165250e-01   +2.417876394664499e-01   +6.842262547535080e-01   +6.324965086282138e-01   -3.325805930066668e-02; +4.380247563753434e-01   +3.641149291168592e-01   +6.205563779996841e-01   +2.579890858885359e-01   +4.750246097948375e-01   +5.244681800804784e-01   -1.239797078202530e-01   +5.116612363300109e-01   +5.184620051166526e-01   +3.466517385634778e-01   +5.264575615678273e-01   +4.631402079552758e-01; +1.938977447998837e-01   +2.524630524110918e-01   -2.512370026642810e-02   +9.243491485057768e-01   +5.710752224807750e-01   +2.154179576299795e-01   +4.199740464159192e-01   +6.612474986520868e-02   +3.046177910988656e-01   +2.290941938542540e-01   +4.283883343109033e-01   +7.614125357548074e-01; +4.574189375896019e-01   +7.045903061251457e-02   +6.699506601384767e-01   +6.160607956918908e-01   +4.896683777522982e-01   -9.024918606883223e-02   +3.909489797747926e-01   +6.590466029318340e-01   +3.955805016473681e-01   +6.814532884142038e-02   +3.970759597073179e-01   +7.345127420905205e-01; +2.862886997646321e-01   +7.743199015014736e-01   +9.151366708836187e-01   +8.027311772496334e-01   +2.321560539597098e-01   +1.866993702751605e-01   +7.455950212305260e-01   -8.356055118791622e-02   +8.254262606739913e-01   +6.810864926837007e-01   +1.836319609280454e-01   +5.641621962899439e-02; +5.792178845233932e-02   +5.416553560608974e-01   +2.172184447819472e-01   +4.912952997143723e-01   +6.058097772846931e-01   +3.787706075826202e-01   +6.861397901762452e-01   +7.255352641383448e-01   +5.464675068086801e-01   +4.689048383598558e-01   +2.381425059982777e-02   +6.975233074336871e-01; +5.269061313574784e-01   +1.437020836923897e-01   +3.731564943235764e-01   +6.807112436523413e-01   +5.930487421099108e-01   +6.474169199091765e-01   +4.137388846618396e-01   +3.252496808571462e-01   +3.863195756302796e-01   +4.056416108200455e-01   +2.729348727342542e-02   +2.918052145343329e-01];
L2E_Input1_iAMPA_netcon = [+8.173020035861814e-01   +9.110702171375593e-01   +7.993842451831993e-01   +7.504421318666441e-01   +1.000000000000000e+00   +6.828357977046426e-01   +9.561686613141911e-01   +5.607269421180707e-01];
L2I_Input2_iAMPA_netcon = [+9.721441811812476e-01   +8.069877013018310e-01   +5.889988379745472e-01   +7.929414085578256e-01   +7.546752812680068e-01   +1.000000000000000e+00   +6.101053986249741e-01   +7.322492331927274e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
