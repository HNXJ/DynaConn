function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.809561583946604e-01   +5.086934724524036e-01   +5.479707248105812e-01   +6.559334107803098e-02   +3.433979424428650e-01   +8.447522990609624e-01   +9.136399069577196e-01   +3.885996863067000e-02   +9.871330807380985e-02   +2.731431253997957e-01   +3.666583061821322e-01   +8.080996732041598e-01   +3.935974299129155e-01   +5.149222353256858e-01   +8.595034249225072e-01   +7.373692193219497e-01; +3.488041201605067e-01   +2.459181781029429e-01   +4.622616326437013e-01   +4.547356084956166e-01   +3.103520488585255e-01   +2.917506436609046e-01   +1.777649515354706e-01   +7.740700326329975e-01   +1.055607105319374e-02   +8.750190515504122e-01   +4.028786376962404e-01   +8.036868471924405e-01   +9.760040110782658e-01   +2.946544429491869e-01   +7.252114741482086e-01   +6.307944006351432e-01; +1.439591450397524e-01   +1.574005701704416e-01   +8.576313877973694e-01   +8.373061733233559e-01   +7.557979545911622e-01   +4.127759228885522e-01   +3.802497817965014e-01   +7.667260333765348e-01   +3.695061870844972e-01   -2.653243064647758e-02   +5.180069183659177e-01   +9.032186149232164e-01   +1.864565382162864e-01   +2.835320615372647e-01   +7.855582480536698e-01   +1.654267414846909e-01; +5.342634144381800e-01   +9.563660801296481e-01   +8.282303334918139e-01   +7.913877457305796e-01   +3.253362675848142e-01   +4.110743505386603e-01   +8.153236930327262e-01   +4.212187410800112e-01   +8.918059835054327e-01   +5.350014780908533e-01   +5.273853801684208e-02   +5.688458127658595e-01   +8.090022083367723e-01   +9.167189735536877e-01   +4.471600078137205e-03   +4.299503230166675e-01; +4.988211316043709e-01   +9.199999677122693e-01   +1.873195872801616e-01   +3.649203401647205e-01   +3.127946427053899e-01   +2.330704908844296e-01   +5.760146123372755e-01   +7.077604980290876e-01   +9.515056034094028e-01   +3.660388238493063e-01   +8.166982045978761e-01   +5.978548228267708e-01   +4.779749670379525e-01   +6.634151243119083e-01   +5.265048250800453e-01   +3.164971322544821e-01; +8.396924478296084e-01   +8.109501266991046e-01   +5.770933637068949e-01   +3.120359304868675e-01   +1.813460394695559e-01   +5.946770021691566e-01   +7.836761972758757e-01   +2.613052007304389e-01   +3.316236634605536e-01   +7.658102346668668e-01   +4.141053640108918e-01   +9.387853890235915e-01   +5.757034659590586e-01   +7.908903264321232e-01   +7.950508557839259e-01   +5.980367278419106e-02; +7.187623798649040e-01   +8.562200542651288e-01   +4.617087053333454e-01   +5.715322171392652e-01   +6.433298719443510e-01   +4.893166748265640e-01   +6.107362196201129e-01   +4.838487501090880e-02   +1.911949711855618e-01   +3.895652292090660e-01   +5.398711278927079e-01   +5.489267928910719e-01   +7.983683484547125e-01   +3.497265841819447e-01   +7.125736769054233e-01   +3.335664065692612e-01; +4.030011924341715e-01   +5.258815992357720e-01   +9.648690846634229e-02   +2.638692802009897e-01   +4.760946561322433e-01   +1.707916311581799e-01   +5.668054028906259e-01   +3.358923736408745e-01   +1.861789461906644e-01   +2.646467414225517e-01   +5.700176530252815e-01   +5.245449925201591e-01   +1.496009478792739e-01   +7.325474669641775e-01   +3.262862696977232e-01   +8.390692776459760e-02; +6.011416616296470e-01   +2.357169723561044e-01   +7.022537146725296e-01   +3.151116985868084e-01   +6.971187980192307e-01   +5.669760888141588e-01   +1.710998459261182e-02   +4.917847560377730e-01   +4.843613097120712e-01   +5.980858865489054e-01   +6.228884150437829e-01   +8.434253889496360e-01   +7.233260295668046e-01   +7.697022731279878e-01   +7.350146386039383e-01   +7.645037710364269e-01; +3.102100749376444e-01   +7.768457955101729e-01   +5.690475987678518e-01   +1.685087354816473e-01   +8.228314499555240e-01   +9.040430246487962e-01   +6.851166621638149e-01   +5.085975739764717e-01   +1.227468782962725e-01   +2.811852279676126e-01   +8.652293055232099e-02   +3.982719802589832e-01   +2.884429260176625e-01   +1.123590418063831e-01   +4.268279439060111e-01   +4.448368853436401e-01; +1.943451318058162e-01   +2.003323444658407e-01   +5.453099310405422e-01   +4.529465559396584e-01   +7.730191853275971e-01   +8.843613297259734e-01   +7.278448886792387e-01   +3.919891977901159e-01   +7.570975856892922e-01   +4.662998077006066e-01   +7.354358515674366e-01   +3.215072296142177e-01   +1.924602842252552e-01   +1.092804033258122e-01   +7.620607246041533e-01   +2.354358435631026e-03; +5.227084504484165e-01   +5.230024347231464e-02   +3.823938493377231e-01   +3.737617341594698e-01   +2.762763490945997e-01   +5.953128718442072e-01   +5.474335831656684e-01   +8.012565473781620e-01   +7.605435546674667e-01   +9.682070318467376e-01   +5.048851822481051e-01   +8.783689103649021e-01   +5.765393561986013e-01   +3.425851865387555e-01   +7.343175879060918e-01   +9.019326669846029e-01; -3.679208118325571e-02   +2.954864521488516e-01   +9.635169945980291e-01   +3.048754064138398e-01   +7.747955671988534e-02   +8.475480129300021e-01   +8.636090288947487e-01   +6.439712859733320e-01   +7.462402383092352e-01   +9.247725806667163e-01   +1.585114010171774e-01   +7.296601858393252e-01   +8.113140906407582e-01   +4.907207921708508e-01   +8.546493667097184e-01   +6.718511603326864e-01; +5.284193276130172e-02   +9.544988453672092e-01   +5.230594208718861e-01   +1.641907899635063e-01   +3.042062152183722e-01   +4.673788359126328e-01   +5.960814141787253e-01   +8.467668203385977e-01   +7.695202335886622e-02   +8.019761485714069e-01   +6.817151652502108e-01   +3.432869367461250e-01   +7.979596936152797e-01   +6.568570454783594e-01   +2.344536527067190e-01   +6.981099248093320e-01; +2.380732648392057e-01   +3.718448016274754e-01   +8.229291652472794e-01   +4.671859776358635e-02   +3.840906438281999e-01   +2.055288293736799e-01   +9.304909133443946e-01   +8.046011600195305e-01   +1.210759378580445e-01   +1.000000000000000e+00   +2.769904379242171e-01   +6.624164712083128e-02   +3.378743838874080e-01   -9.944499104698783e-03   +5.909310347050953e-01   +6.611688423984149e-01; +6.253191286224468e-01   +7.723308855171387e-01   +8.920692571721452e-01   +7.041579331393673e-01   +7.231754429839518e-01   +6.479521058823262e-01   +7.628918502879531e-02   +5.053877655486780e-01   +7.532627303348529e-01   +8.725952608774261e-01   +3.177991155480540e-01   +5.563440586348206e-01   +2.523041373578290e-01   +8.416152763269150e-01   +8.244933814686037e-01   +9.005825179524672e-01];
L1E_L1I_iGABA_netcon = [+4.685530259190749e-01   +3.077875035342708e-01   +1.484760549620128e-01   +4.124749454812256e-01   +1.886377984490803e-01   +4.813066610249509e-01   +1.113337086228632e-01   +4.924004575666751e-01   +5.836693551711768e-01   +3.964275700781436e-01   +6.676307823747504e-01   +5.564873210303309e-01   +1.233852100574016e-02   +8.850057769471162e-01   +5.055686507866332e-01   +5.172130423929179e-02; +4.085238513163836e-01   +4.549642791748965e-02   +6.419186137922560e-01   +4.489493616533980e-01   +5.680483185945094e-01   +4.463900779540251e-01   +5.234300536257753e-01   +5.789406648528780e-01   +1.805972086995176e-02   +4.249794017031306e-01   +2.254060334310197e-01   +5.617290032136918e-01   +1.639940384401413e-01   +1.818950291344455e-01   +5.400791007928254e-01   +5.177639374238850e-01; +7.198315069367546e-01   +1.227439680208631e-01   +4.525015474786053e-01   +9.342265498187443e-01   +7.752666531576756e-01   +5.834786613816834e-01   +4.385278083070040e-01   +6.802069679478535e-01   +1.819104924430743e-01   +3.391572276642699e-01   +4.801252353023048e-01   +3.099212700649234e-01   +9.790724741009798e-01   +7.799043514891887e-01   +1.340987040093722e-02   +6.904260793205337e-01; +6.831712676468615e-02   +8.889296050420954e-01   +6.705461560046406e-01   +1.994547761246337e-01   +5.338908445245988e-01   +8.377144522658694e-01   +6.337658639219760e-03   +5.810870004487201e-01   +2.415931542271512e-01   +1.221330078581381e-01   +1.302003924525344e-01   +5.826632104460494e-01   +1.589298122712350e-01   +5.769822513848427e-01   +3.415703145068806e-01   +5.563647221985202e-01; +3.691522407238872e-01   +2.887573109636328e-01   +1.940260546118497e-02   +4.600552895011766e-01   +3.125207220019278e-01   +5.157604459956009e-01   +7.745475290317078e-02   +3.359359830862927e-01   +2.683718310622899e-01   +6.108825632148970e-02   +7.043256740618950e-02   +8.774737130100692e-01   +2.505168895564983e-01   +2.714711027204627e-01   +8.765048214664818e-01   +9.056193859172942e-01; +5.880555752740880e-01   +1.674884360133779e-01   -2.125854698515693e-02   +1.962826706532989e-01   +2.927535166169922e-02   +6.653126673977570e-01   +1.707630266320375e-01   +8.962239464378940e-01   +5.002296928848402e-01   +8.450180558567570e-01   +7.667355033170421e-01   +7.715508819820899e-01   +7.236487382858711e-01   +3.012485986402674e-01   +1.008202178969896e-01   +3.241886889662760e-01; +9.313140217117962e-01   +3.953345173899693e-02   +3.217498846973112e-02   +1.359334581753480e-01   +5.666448355734262e-01   +6.179160332407151e-01   +9.335473379837848e-01   +3.593223542040732e-02   +3.849796462331617e-01   +9.091461493808793e-01   +1.611022420930002e-01   +3.648955214729645e-01   +4.773569050053559e-01   +3.883257770891262e-01   +2.269469827137290e-01   +2.777094312992324e-01; +4.445604453284963e-01   +8.858554133334230e-02   +6.963466718731811e-01   +9.681764772426523e-01   +2.000565431570402e-01   +5.144248709496386e-01   +1.578116239927166e-01   +8.877838427561142e-01   +3.226384770922596e-01   +3.296787759651507e-01   +1.148518501817516e-01   +9.858356776519066e-01   +6.522739175982981e-01   +4.267525669119475e-01   +6.538906365124871e-02   +7.324153396591950e-01; +8.954093272785761e-02   +8.266299783261974e-01   +5.827106365268035e-01   +1.493240349432497e-01   +9.316705234277706e-01   +4.199869298315011e-01   +5.198371521581235e-01   +5.382514254661146e-01   +1.469408985302424e-01   +9.277628148660529e-01   -3.517748997343775e-03   +9.166068843282015e-01   +1.837956149021788e-01   +3.491450907471232e-01   +3.196450829883747e-01   +3.385526110308721e-01; +3.138072863900775e-01   +3.894338245321510e-01   +9.363012314997329e-02   +2.561027535394475e-02   +7.494612955319553e-01   +6.849314245023039e-02   +6.779553275149027e-01   +8.748858311974618e-01   +2.827616514342877e-01   +9.205019419365167e-01   +3.023512376186318e-01   +8.487196971916655e-01   +4.583506341307153e-01   +5.226025287997802e-01   +3.351930883378903e-01   +8.863151137938421e-01; +6.784274257292755e-01   +8.151659505552358e-01   +8.505374045318946e-01   +7.114966558582377e-01   +7.234424649046945e-01   +6.140481901884801e-01   +1.137263231362252e-01   +6.096237649594404e-02   +4.691126997936525e-01   +6.855782394334180e-03   +7.378694111388908e-01   +7.037339718740691e-01   +2.509718952829182e-01   +9.043268529674351e-01   -2.999604322017570e-02   +7.463439526386523e-01; +2.385581303689733e-01   +7.292012248022586e-01   +6.777989355106357e-01   +7.399857705116526e-01   +8.037472852067976e-02   +3.974526348341271e-01   +3.957032253570251e-01   +5.750302599994933e-01   +8.769620336718548e-01   +4.647036172892528e-01   +6.946281600692785e-01   +9.566053254358142e-01   +3.654592110039294e-01   +9.591660558985825e-01   +8.866833918456893e-01   +5.882403113421545e-01; +3.308279314900928e-02   +4.478840727456268e-01   +9.861989100919226e-02   +5.353177015716823e-01   +2.713104197337421e-01   +8.488354544594308e-01   +7.348441164195346e-01   +4.455807230523026e-01   +4.940417116214477e-01   +8.549588142193693e-01   +2.886502934519055e-01   -1.621787380075840e-03   +3.836999068191294e-01   +1.075287008976489e-01   +2.735722994296961e-01   +8.401397476801693e-01; +8.675458512014761e-01   +2.324687906868286e-02   +6.389395998841709e-01   +6.147846697552138e-01   +5.080974746509744e-01   +1.983689127672225e-01   +5.549445547674225e-01   +2.567824890815964e-01   +6.474938122140685e-01   +6.635637086792270e-02   +3.796674463710287e-01   +7.211597273243213e-01   +6.988931563441683e-01   +9.642765715368371e-01   +1.479059831127147e-01   +1.823314048615352e-01; +2.768708018422013e-01   +7.139350511877750e-01   +1.347273893588593e-01   +1.080764482236485e-01   +7.682212159757885e-01   +3.981534063660530e-01   +8.957569067517982e-01   +8.823133787527020e-01   +9.055169173891257e-01   +8.412979097471819e-01   +8.857020176895685e-01   +6.709914940031297e-01   +3.746726499078630e-01   +1.073127869350763e-01   +2.892276393839784e-01   +3.598524226052676e-01; +3.289179952755346e-01   +5.065673542851310e-02   +6.947089068752850e-01   +1.688071193064115e-01   +4.249942481896254e-01   +8.140491088170613e-01   +5.533451937997195e-01   +1.813411538579533e-01   +7.667926853309990e-01   +9.442129233113640e-01   +5.222699516907042e-01   +6.593813914349872e-01   +7.847972633820262e-01   +2.585338150215190e-01   +4.198538714029587e-02   +1.864825744960659e-02];
L2I_L1I_iGABA_netcon = [+8.934424247472748e-02   +6.602109759442455e-01   +8.834233949752435e-01   +7.563421347057850e-02   +6.655413617443507e-01   +4.210343867559592e-01   +8.398321086397995e-01   +7.574298333425546e-01; +1.184433143751949e-01   +3.532237669489038e-01   +5.020137085145986e-01   +2.046483630831314e-01   +8.626867367143977e-01   +4.079091023739112e-02   +6.717616481925470e-01   +9.282631469000943e-01; +1.217102396531248e-01   +8.478895484364621e-01   +6.312094809032388e-01   +6.567564186959804e-01   +6.990536549035592e-01   +6.628976927528718e-01   +4.089770097987711e-01   +2.876856982404427e-01; +7.599384520446137e-01   +5.354061711305880e-01   +5.480715793346531e-01   +8.227870045171002e-01   +3.425935728863457e-01   +7.810364797864829e-02   +2.701084730383322e-01   +6.650943037514719e-02; +8.511064794411507e-01   +1.695878603833763e-01   +4.903361414989846e-01   +1.052644954481682e-01   +8.604678780494380e-01   +2.548253874068028e-01   +1.000000000000000e+00   +1.616935104072331e-01; +6.408358632055497e-01   +6.341260221019552e-01   +6.986691697710139e-01   +7.776589454399260e-01   +8.312003883818782e-01   +7.991194401752482e-01   +3.885194389981713e-01   +7.507806954017792e-01; +9.592991527065432e-01   +1.421612978019176e-01   +4.432560350800401e-01   +2.489562448954452e-01   +5.651397291384491e-01   +5.015635324547449e-01   +1.724468138604266e-01   +6.256872725609588e-01; +7.504726367808093e-01   +3.686082862896589e-01   +1.265401099868596e-01   +8.140324730652886e-01   +8.170772123454889e-01   +8.746657807590986e-01   +8.698883481961683e-01   +3.813259431236055e-01; +1.542273228678540e-01   +5.905631350837323e-01   +1.367889398598033e-02   +2.678312469204786e-01   +4.017050703683744e-01   +5.992723962160731e-01   +7.461369494308877e-01   +1.722975003733942e-01; +8.628693692029298e-01   +8.503166045730268e-01   +3.239689734116543e-01   +7.971863984801294e-01   +3.424106309134381e-01   +5.856099500316307e-02   +5.398755214469018e-01   +2.511798528378095e-01; +3.800256902508152e-01   +1.278768130193370e-01   +7.160176041207370e-01   +6.948077212142549e-01   +8.093948062785286e-02   +1.901290616220280e-01   +5.682856325220010e-01   +1.515697630877806e-01; +2.183814982363862e-01   +3.271110314802830e-01   +4.669254732801452e-01   +6.888283474620817e-01   +3.653447575039850e-01   +3.449129601987403e-01   +3.985033215839452e-01   +7.632286114550284e-02; +8.243682139672077e-01   +8.009952279296237e-01   +1.782278814223681e-01   +5.893507729707415e-01   +4.680987172510582e-01   +5.385466389671233e-02   +6.107308241793572e-02   +8.338678127421570e-01; +4.304871379941721e-01   +8.545500757395450e-01   -4.178581248381108e-03   +1.622729220148205e-01   +6.276472714407505e-01   +9.085732068581848e-01   +6.539297684321117e-01   +7.488652338269000e-01; +6.120493505102309e-01   +5.310015718660486e-01   +4.648054493123073e-01   +3.582790146412272e-01   +6.955053113216275e-01   +2.852605890801441e-01   +1.460599945639520e-01   +5.165384996735743e-01; +1.080332995821768e-01   +3.567929725212696e-01   +3.440436229736229e-01   +1.721185109920110e-01   +8.375252036792821e-01   +7.276018573452986e-01   +5.431686410907132e-01   +2.870363949581546e-01];
L1I_L2I_iGABA_netcon = [+9.082368225223940e-02   +7.635146728529305e-01   +3.507172357382978e-01   +2.627500376109428e-01   +8.968964087653924e-01   +8.593454835424224e-01   +8.325145727130419e-02   +2.814048069369190e-01   +4.040180371958641e-03   +8.514473199636330e-01   +6.288106208802885e-01   +2.438047884868788e-01   +7.271201914694230e-03   +5.537888919088628e-01   +1.288389824555206e-01   +7.710289076234949e-01; +9.321759435145454e-01   +5.519817964868569e-01   +5.981295836501406e-01   +3.949177314163770e-01   +1.150502050269376e-01   +3.795053104652651e-01   +6.138942508285705e-01   +1.186849547455062e-01   +3.757233704960972e-01   +3.137805240653343e-01   +3.279739419017523e-01   +1.328528327056698e-01   +8.605991438441546e-01   +8.063567065957797e-01   +9.427254786672336e-01   +2.260665688353848e-01; +4.410675875714007e-01   +4.648744119192889e-01   +9.771751046348934e-01   +7.844700333080050e-01   +2.941952604723111e-01   +1.048937929024685e-01   +6.705331011421096e-01   +4.672560017921659e-01   +5.198127580329530e-02   +6.937150808982425e-01   +2.092294745232944e-01   +3.948683693360195e-01   +1.000000000000000e+00   +5.572199078604788e-01   +1.266485011040449e-01   +2.333474870406226e-01; +8.634206513933655e-01   +4.485200197032136e-01   +5.729884773521131e-01   +3.613657237285181e-01   +8.383175626485407e-01   +5.402123182334286e-01   +4.571603397256556e-01   +2.211837587236906e-01   +4.166716622353354e-01   +3.577140763610764e-01   +4.385616359107758e-01   +4.489084321638463e-01   +4.527548938007742e-01   -8.278667915687460e-03   +1.340033263545649e-01   +5.305481512997070e-01; +7.243052762876409e-01   +4.685641029139776e-01   +8.166497200794857e-02   +9.072193757651106e-01   +6.179646184619455e-01   +4.426100998744339e-01   +7.383159527586670e-01   +3.554953759436415e-01   +7.545384467430215e-01   +4.166062488730635e-01   +6.687770529599713e-01   +8.332819539155231e-01   +9.339824658235605e-01   +1.253864063229538e-01   +5.053227265566559e-01   +7.147578241112170e-01; +3.949265759973120e-01   +3.382792912226377e-01   +8.492584969929995e-01   +1.193530229805798e-01   +9.921211028444257e-02   +7.472546208900627e-01   +5.893934578323379e-01   +8.859183661000032e-01   +4.216814469411030e-01   +4.585321085554987e-01   +9.357052434821015e-01   +7.152753348244459e-01   +4.669237793773073e-01   +8.752454816845595e-02   +3.393810751508090e-01   +9.368877704457518e-01; +4.058195932664982e-01   +2.035623305617677e-01   +1.771823470715647e-01   +9.032590446238427e-01   +4.965939789250493e-01   +6.618358677433877e-01   +2.879175589322508e-01   +5.450235747044416e-01   +1.443357434653089e-02   +2.512978831142460e-01   +3.701234212898399e-01   +8.526983914645071e-02   +6.907143893257437e-01   +3.467415502714059e-01   +6.695801766718799e-01   +1.773480406967683e-01; +6.206639210678183e-01   +6.267058726975754e-01   +8.962445448403406e-01   +3.962213339185972e-01   +7.903981898818794e-01   +6.903239762901045e-02   +1.638153784045165e-02   +8.064583174085813e-01   +6.040439987753096e-01   +2.687303407370836e-01   +4.177570870937653e-01   +6.344144597754301e-01   +4.260548862385422e-01   +8.840955368045614e-01   +1.477279424982792e-01   +3.722328371374632e-01];
L2E_L1E_iAMPA_netcon = [+1.041721932851216e-01   +6.002663009409875e-01   +8.162892417086876e-01   +7.974611236975551e-01   +5.662634414094199e-01   +7.055998253790813e-01   +8.866922827982434e-01   +4.764701553006373e-02; +2.259628579256725e-01   +2.243855449046005e-01   +1.794520298221368e-01   +3.281556149096680e-01   +4.940862536715827e-01   +6.351138030384915e-01   +7.562190774286415e-01   +1.964943159735221e-01; +3.423027494121423e-01   -6.483064335027162e-03   +9.160891950094052e-01   +6.344991139331267e-01   +3.173801768162298e-01   +6.071369315197958e-01   -4.719456207386186e-02   +4.789765111930122e-01; +1.214747185373010e-01   +1.978228456477626e-01   +9.540881346115393e-01   +1.641023889950495e-01   +4.308911087854870e-01   +9.306504719891481e-01   +4.251633391978414e-01   +5.735926774780020e-01; +9.099326368709169e-01   +6.926498226546401e-02   +6.997263707241441e-01   +9.425024671494741e-01   +1.560487876686349e-01   +7.129611069633006e-01   +6.581705581803476e-01   +7.831442058483890e-01; +9.129747087577403e-01   +4.669099952629033e-01   +6.991045530496494e-01   +5.956255224376024e-01   +2.722624447703871e-01   +8.665802490906234e-01   +5.579515518346509e-01   +9.806254305356719e-01; +9.262554055231121e-01   +8.510001079863443e-01   +9.617239090950495e-01   +2.227533848603458e-01   +1.933890790297636e-01   -5.157784042577124e-02   +8.649345217946043e-01   +8.032179132021862e-01; +7.023636273250581e-01   +9.157823171629432e-01   +8.368971915392296e-01   +5.684060958707113e-01   +6.260682140990748e-01   +8.443698568051751e-01   +8.498374547583364e-01   +7.824082800939283e-01; +8.226701974760084e-02   +3.413818305726523e-01   +7.993601706805032e-01   +5.372049770370949e-01   -4.285035465104968e-02   +7.500064255303602e-01   +8.043535501510827e-01   +9.116607598358910e-01; +3.754579799175617e-01   +3.909285559339682e-01   +4.859956570955737e-01   +2.353705579991391e-01   +8.294103042504708e-01   +3.798909466157136e-01   +5.541128240090915e-01   +8.829075216291828e-01; +8.220582940845587e-01   +9.161076203773835e-01   +2.681797085866395e-01   +1.791580975200449e-01   +3.049833255312042e-01   +7.807586093174279e-01   +1.190293313879587e-01   +8.811648871344101e-03; -4.199043814815500e-02   +6.268759294611788e-01   +7.007089307245494e-01   +2.186280559687939e-01   +4.000632209119264e-01   -4.031456649741886e-03   +7.024565258611107e-01   +7.806852832428144e-01; +2.574830276415203e-01   +9.859504278706578e-01   +9.875974590451436e-01   +1.909925516893922e-01   +4.959710348304676e-01   +2.364129332776186e-01   +3.963775404433285e-02   +9.284036612792868e-01; +2.767831756879874e-01   +1.678367890584546e-01   +5.710846169447741e-01   +9.945074637781812e-01   +8.721975593511909e-01   +8.461557959033559e-01   +2.379489995322453e-01   +1.388669547842399e-01; +6.657381657160100e-01   +7.543661198104840e-01   +2.908477644785493e-01   +8.576995377360532e-01   +6.662913694155080e-01   +5.675032208775628e-01   +7.296027154498046e-01   +8.390757086935380e-01; +5.237130546206166e-01   +7.973627360449671e-01   +9.618098763119587e-02   +6.564010281420073e-01   +2.682259052594029e-01   +4.789223293263073e-01   +5.193313478430187e-01   +3.544851288952621e-01];
L1E_L2E_iAMPA_netcon = [+8.593516849323934e-01   +5.887180831889094e-01   +1.435759809802773e-02   +5.816282723989042e-01   +8.079678095584030e-01   +2.486449417451519e-01   +4.071103674337320e-01   +8.662356121864097e-01   +1.701198062071153e-01   +2.594626267087726e-01   +4.104413142964773e-01   +8.455490537440951e-01   +1.080833209539438e-01   +1.182328041774775e-01   +8.120830040118967e-01   +2.824121514735624e-01; +5.079574782504440e-02   +3.273632796668038e-01   +6.436437332600959e-01   +1.114071820991513e-01   +2.793613773988461e-01   +1.286383893305984e-01   +4.211586928907980e-01   +3.985151990046315e-01   +5.660424071269868e-01   +1.000000000000000e+00   +5.133729371668085e-01   +3.261086420845422e-01   +8.823650479855902e-01   +8.284796380745053e-01   +7.073418897403934e-01   +7.260834340669087e-01; +2.776615200590112e-01   +8.592121009512934e-01   +7.277172670521111e-02   +2.345392457735227e-01   +5.594343911484055e-01   +2.319751372864727e-01   +9.429569485665136e-01   +8.692322016027495e-01   +5.759181430962294e-01   +6.103545040651135e-01   +7.231267019183567e-01   +2.218143699954693e-01   +7.595489937998885e-01   +4.919581490487859e-01   +8.953607349611906e-02   +4.672785903818833e-01; +8.939020234426011e-01   +3.191466642454091e-01   +5.547440259372859e-01   +2.044286783897497e-01   +4.580017813154876e-01   +3.498255150198405e-01   -3.356811222385371e-02   +1.188091248937502e-01   +7.816870694015929e-01   +1.003162212649438e-01   +3.686079276119619e-01   +1.967595720046600e-01   +5.480599290860694e-01   +9.399362910162408e-01   +6.028048362698171e-01   +7.585981573329250e-01; +4.061965857811092e-01   +4.198472244351014e-01   +4.802945037902770e-01   +4.018865605730180e-01   +5.287850425208362e-01   +6.047948289378794e-01   +2.346841757352773e-01   +5.951695071490873e-01   +2.313804588714962e-01   +6.258370571814754e-01   +4.984758480623106e-01   +1.272038084390007e-01   +2.845321793804561e-02   +8.407819843662977e-01   +1.230620964772020e-01   +7.147574726726025e-01; +9.215397695460011e-01   +2.585118830680331e-01   +2.501756103193173e-03   +8.518338171512932e-01   +1.237569318168342e-01   +3.165636321568591e-01   +6.871980178144272e-01   +2.303081497286710e-01   +4.141103511485563e-01   +3.006207670297598e-01   +3.231386949224556e-01   +9.566793166880828e-01   -2.655909884969573e-02   +2.602400903997168e-01   +3.700103064795419e-01   +7.522269250334307e-01; +4.236603580485662e-01   +3.017347381917100e-01   +1.771221086643100e-01   +1.308928973931193e-01   +9.313750715467498e-01   +5.937331932756169e-01   +5.064085035159020e-02   +5.000291341011378e-01   +3.867686003849141e-01   +7.152750462941964e-01   +5.801036383967704e-01   +1.585321626467023e-01   +6.353356789199510e-01   +5.046583122607713e-01   +6.604143673330013e-01   +9.330266021627448e-02; +3.868878296925341e-01   +5.820658930038481e-02   +8.189114235677143e-01   +7.001109520688732e-02   +6.073605387909077e-01   +4.059855780938360e-02   +3.253831021752538e-01   +6.978093464449288e-02   +2.171909507129239e-01   +8.138997356832278e-01   +6.860267841314311e-01   +3.481795982567434e-01   +8.807799036760608e-01   +6.105912694985697e-01   +3.033185460643123e-01   +2.444280485057138e-01];
L2I_L2E_iAMPA_netcon = [+4.122609702727602e-01   +9.845936649467490e-01   +2.434985028375269e-01   +7.154364776182804e-01   +8.226258501823405e-01   +7.791181503502935e-01   +5.823057099923263e-01   +4.762053904676471e-01; +9.536486214851008e-01   +4.053429181846054e-02   +7.031343195755877e-01   +3.206039888061291e-01   +7.097029528307978e-01   +3.641662894851936e-01   +3.308607099754437e-01   +8.868086474814613e-01; +1.000000000000000e+00   +2.642314411320991e-01   +7.741647257746666e-01   +5.864167154279860e-01   +2.879208781521123e-01   +6.724461096227362e-01   +9.009185104437102e-02   +5.132603026219716e-01; +3.738379357926792e-01   +8.913652325016460e-01   +5.539526056917117e-01   +3.645327124540227e-01   +5.265221278477716e-01   +1.481759896538505e-01   +8.983637101049886e-02   +6.266191904300746e-01; +3.883215175730232e-01   +5.275966460233639e-01   +5.293215167136340e-01   +1.102835965093477e-01   +7.837004348144738e-01   +3.894420537819263e-01   +1.651612807777078e-01   +7.447016118410698e-01; +3.831179932662553e-01   +2.256748303143200e-01   +5.700199367404905e-01   +5.941709118246118e-02   +7.374204795281541e-01   +8.060868094707899e-01   -4.598213149486523e-02   +6.140996752529450e-01; +5.275961376289477e-02   +2.864670777894656e-01   +4.595432566611675e-01   +5.726803502838486e-01   +1.120218702203013e-02   +1.047679549948662e-01   +1.600285401768120e-01   +5.951919854648746e-01; +4.038106101187505e-01   +4.384563443204176e-01   +1.085573269389059e-01   +7.737423252386071e-01   +2.870881420126957e-01   +8.569717284391999e-01   +5.057944931924300e-01   +6.730597147444531e-01];
L2E_L2I_iGABA_netcon = [+1.308635473475914e-01   +4.956743978093527e-01   +7.500775297722466e-02   +5.965463041052219e-01   +4.352164566225408e-01   +9.000484093165396e-01   +5.998900999611525e-01   +2.274599996378345e-01; +5.326176135524974e-01   +7.432451296611113e-01   +2.367459706722828e-01   +4.575575955967868e-01   +5.735035894861862e-01   +6.222306197915157e-01   +4.808492735779266e-02   +7.804913527360635e-01; +3.059302516234823e-01   +2.152598897363777e-01   +7.057569710296456e-01   +6.396860992622946e-01   +1.881335177930747e-01   +3.065606014056226e-01   +7.123813164679156e-02   +8.087692150391964e-01; +6.336890506516735e-02   +9.235800322414547e-01   -2.705049365375599e-02   +7.599583914272501e-01   +2.558143702657042e-01   +5.054862144670599e-01   +7.390364937171360e-01   +7.312300098388439e-01; +3.550961902550581e-01   +4.417447012209347e-01   +3.111276295317610e-01   +3.342022187905655e-01   -2.522419104917597e-02   +5.959407485227722e-01   +2.073808197220561e-01   +2.800393828619617e-02; +7.435116129598914e-01   +8.149616802079245e-01   +9.294740026864050e-01   +1.000000000000000e+00   +6.752367520798341e-01   +7.075795298718733e-01   +3.731762365169059e-01   +5.183698934704676e-01; +7.454376569875186e-02   +4.133530417705302e-01   +2.362256756685591e-01   +2.395663433673416e-02   +2.442415251134698e-01   -5.304763106090106e-03   +1.556418432818446e-01   +8.968962980291691e-01; +1.080349402451707e-01   +9.144212003924042e-01   +8.119763589756305e-01   +7.579613923797856e-03   +3.510528656634372e-01   +5.961815354571102e-01   +4.832344076975472e-01   +6.347728888041468e-01];
L3E_L2E_iAMPA_netcon = [+3.251476674901974e-01   +7.452003810527548e-01   +8.668594540520880e-01   +3.007377430741536e-01   +8.127819722752710e-02   +8.121653757165470e-01   +8.330002798561951e-01   +8.943684610750489e-01   +6.848359204766651e-01   +1.025783243762706e-01   +4.482226143625639e-01   +1.308587313090207e-01; +1.131315565385745e-01   +9.439696192649195e-01   +2.023890917293098e-01   +2.526286829345363e-01   +3.578621988948650e-01   -1.966946594053390e-02   +4.843665006141895e-01   +1.463513352384330e-01   +5.266088372563086e-01   +6.280573114378702e-01   +2.307211373069373e-01   +6.032567483372118e-02; +3.065527019592333e-01   +2.319481838474469e-01   +1.471295989457735e-01   +6.411596806046738e-01   +6.549053218254555e-01   +8.588953934688556e-01   +6.420284631196822e-01   +8.208573328547671e-01   +1.904668236863091e-01   +8.598189647861775e-01   +5.485730002412127e-01   +8.681324603176263e-01; +8.770989475320318e-01   +4.423634521122712e-01   +6.217262600612300e-01   +8.294513941031970e-01   +4.897086433112271e-01   +9.220924665256485e-01   +2.737584973644211e-01   +3.349947955956404e-01   +5.816204048792643e-01   +6.079213259764671e-02   +3.225755486576400e-01   +8.222484138393772e-01; +8.690844044091984e-01   +2.437940585059035e-01   +5.352369585583997e-01   +7.233657413537203e-01   +2.985035246603167e-01   +6.385679124438276e-01   +4.882688982262217e-01   +6.842490289995021e-01   +7.183027742819530e-01   +4.133765440438003e-01   +5.304304613459597e-01   +3.574684933112200e-01; +2.990907186387232e-01   +4.822001261040898e-01   +4.786290296832562e-01   +2.592915801308007e-02   +2.661348584017327e-01   +3.787918179993470e-01   +3.158396243640320e-01   +6.300691421519038e-01   +4.141957506469850e-01   +5.468556776445864e-01   +6.923417004872289e-01   -2.384071693245909e-02; -7.610921691079618e-03   +1.175279269106491e-01   +1.159375916920096e-01   +3.033383454689282e-01   +7.582380031932198e-01   +1.000000000000000e+00   +6.897623405308259e-01   +2.036815547849442e-01   +6.527929475944311e-01   +4.165488096469860e-01   +2.910324518702123e-01   +2.870158079421505e-01; +3.994082617197470e-01   -2.003664281494647e-02   +6.877117317108480e-01   +8.827189785682246e-01   +7.222285500154169e-01   +7.895773813833452e-01   +8.387596111558403e-01   +1.505205929774353e-01   +7.657701974328046e-01   +1.768157456717376e-01   +1.365878679640405e-01   +4.014891257663820e-01];
L3I_L2I_iGABA_netcon = [+7.520205835389112e-01   -6.536704531686576e-03   +4.417891152699923e-01   +6.196419682322913e-01   +3.101399003843821e-01   +1.255796912772509e-01   +2.633177933972050e-01   +3.180970266358087e-01   +4.468955234083675e-01   +9.355239692044048e-03   +3.428385948871325e-01   +8.907184612234105e-01; +8.022656980355732e-01   -1.544272778051352e-02   -7.549307065796923e-04   +6.684104079340377e-01   +8.435574344065567e-01   +5.775327256475469e-01   +5.483504662483913e-01   +2.758208344234144e-01   +3.525871811546309e-01   +7.137475138301327e-01   +5.804608240893530e-02   +3.380374559983250e-01; +8.451651815736637e-01   +2.717229360511321e-01   +7.572336332870976e-01   +9.879901434364391e-02   +6.955695200635880e-01   +1.012373511946796e-01   +6.404294439443959e-01   +1.671218540692048e-01   +3.730705968314305e-01   +7.086207584745994e-01   +3.095695385556846e-01   +8.119832937172926e-01; +6.983954765994205e-01   +1.844683119051358e-01   +9.467248684328274e-01   +9.378015520970654e-01   +7.782473952538277e-01   +3.512820341696346e-02   +7.287022465600219e-01   +4.475742453005876e-02   +8.732554497186551e-01   +1.198552821918702e-01   +1.683366777674264e-01   +7.218886318924107e-01; +1.432173639797489e-01   +1.636377500751743e-01   +3.664376602345662e-01   +3.299162742918265e-01   +6.469215379484745e-01   +8.754091822781369e-01   +3.275416612363045e-01   +6.359815348059117e-02   +2.881829901810764e-02   +2.483220321262509e-01   +8.801771021352571e-01   +8.109861537050526e-02; +9.203319684739033e-01   +3.515115121685333e-01   +5.279970609998059e-01   +8.229680498939066e-01   +7.087988938909692e-01   +2.838558532032689e-01   +3.785308707509297e-01   +1.923705174719065e-01   +3.943389623076692e-01   +2.189809641256664e-01   +1.955233738332089e-01   +3.187929832698616e-01; +6.706303743774300e-01   +8.416310755812715e-01   +7.837465909707584e-01   +6.297304138799007e-01   +1.751505507790077e-01   +5.193995922821374e-01   +4.812408839730107e-01   +7.553529576366885e-01   +9.266196173329078e-02   +8.480438796110363e-01   +4.693100828304100e-01   +9.103801907871033e-01; +1.010525947191114e-01   +2.313343494013813e-01   +5.438396879693902e-01   +6.740860318995688e-01   +2.512443100747676e-01   +1.478521307960247e-01   +1.608781809682428e-01   +7.424601223740127e-02   +7.101970810661502e-01   +5.977971332102142e-01   +3.263200922253094e-01   +2.448978196479150e-01];
L2E_L3E_iAMPA_netcon = [+4.760630403822443e-01   +8.160615333757736e-01   +4.456949880138955e-01   +7.657991167405910e-01   +3.669909085646417e-01   +1.403189164528185e-01   +5.097745066494061e-02   +4.847411258625486e-01; +6.183482322128813e-01   +3.707872313418126e-01   +7.714839240012489e-01   +1.158286436701522e-01   +1.707566762251733e-02   +2.524199824949243e-01   +8.771987899934192e-01   +8.217847408216450e-01; +2.786090186723909e-03   +1.920752557933307e-01   +1.000000000000000e+00   +8.808004079456270e-01   +6.876563049057427e-01   +2.377656145670873e-01   +2.923648476321801e-01   +8.293591037207365e-01; +3.693674522066928e-01   +5.109855943120746e-01   +1.407505154701674e-01   +5.202711037374864e-01   +3.148123151988459e-01   +8.686015734954350e-01   +7.481247088549969e-01   +2.163381741017395e-01; +3.449210774801422e-01   +6.921421156430018e-01   +7.552276266825859e-01   +9.107552935991162e-01   +7.626195875982192e-01   +1.235442091753598e-01   +4.999318461208667e-02   +9.161115785230763e-01; +8.777135121038286e-01   +7.663690730374416e-01   +2.526545418524926e-01   +1.120698323932555e-01   +3.921359781092461e-01   +8.241017008624042e-01   +6.909329846868778e-01   +7.237881099993063e-01; +9.704123235980949e-02   +3.710854136839261e-01   +4.145386703881432e-01   +9.928804867903167e-05   +2.287385860581408e-01   +2.553668944433385e-01   +3.861501499984397e-01   +3.300285052046826e-01; +8.672812240519683e-01   +1.128088835229759e-01   +8.374311181991958e-01   +2.785303123951693e-01   +2.204684152807979e-01   +5.205668996359434e-01   +8.917458610511290e-02   +1.683291030915160e-01; +4.319570098940184e-01   +6.102508250313067e-01   +7.212358028285453e-01   -1.261525726624883e-03   +2.570314962703379e-01   +1.316105224816013e-01   +6.263655829716190e-01   +6.544948968942996e-01; +5.768005174038503e-01   +8.820741019033091e-01   +2.518703828869635e-01   +4.858560586791738e-01   +9.094033844613885e-01   +4.901230110702757e-01   +9.042516569486094e-01   +5.186941908146654e-01; +6.676011091716607e-01   +2.135782256034412e-01   +6.440928609570955e-01   +3.291723516527781e-01   +4.527277656059708e-02   +1.282874758595703e-01   +9.339845095496710e-01   +7.121809566641962e-01; +7.878185381614048e-01   +2.719440018452204e-01   +5.303055783661730e-01   +8.569893080006732e-01   +6.493817731517644e-01   +9.441739835241045e-01   +3.543594458975342e-01   +4.685048040976287e-01];
L2I_L3I_iGABA_netcon = [+4.122488966870577e-01   +3.869879384325940e-01   +9.971148099855045e-01   +1.676185941280965e-01   +1.674539168378209e-01   +4.829847802955720e-01   +1.534918363063248e-02   +4.682039763513240e-01; +4.591909472560246e-01   +6.108314615958231e-02   +7.640799332750700e-01   +7.496852663773060e-01   +3.028481697088942e-01   +5.767678513823248e-01   +9.048716200393363e-01   +3.006663546736193e-01; +5.310249147908466e-01   +8.407409852026528e-01   +2.132907111243131e-02   +3.032663314971699e-01   +2.445933644725802e-01   +8.522233799514751e-01   +6.658376847065515e-01   +4.105270900261224e-01; +5.932633107174498e-01   +5.313601458437115e-01   +1.145202627534795e-01   +2.832049870952899e-01   +8.108227714865704e-01   +5.404610750334965e-01   +4.182151247815948e-01   +1.006598171684753e-01; +9.546639867528531e-01   +4.038503460776934e-01   +8.335937624179598e-01   +5.608818446104932e-01   +1.734818512220858e-01   +5.995965648197852e-01   +1.182148199308866e-01   +3.103510474439742e-01; +5.195480358992180e-02   +1.072101814374599e-01   +5.689007862850068e-01   +8.556418852378805e-01   +9.678495931412482e-01   +9.658630715080014e-01   +8.092689611557992e-01   +2.172437956606135e-01; +3.320718664406418e-01   +3.254142799472147e-01   +3.600319772768533e-01   +5.017397413868649e-01   +3.857929379502664e-01   +8.712141865379813e-01   +8.969083590518198e-01   +1.000000000000000e+00; +5.278605344952032e-01   +8.824321085355071e-01   +3.271591034477217e-01   +3.213029248536116e-01   +1.552515299280935e-01   +3.982250596207348e-01   +2.995319274549344e-01   +4.009703926545574e-01; +1.000087564279197e-01   +2.602201054144749e-01   +9.256194843828054e-02   +2.811154555247682e-02   +7.254223319334718e-01   +2.361072875671424e-01   +2.385259588043486e-01   +1.202038591783244e-01; +1.083017220451872e-01   +1.051499680605219e-01   +6.598580959674188e-01   +7.235790419630790e-01   +8.321550870295966e-01   +8.367457713687181e-01   +9.596842321500384e-01   +2.347483882443040e-01; +4.990569717833994e-01   +3.119531145334181e-01   +7.975292872270182e-01   +9.471163539219891e-02   +7.015604822984718e-01   +3.737335704348754e-01   +7.996910116697777e-01   +5.109115059356095e-01; +8.726315656226720e-01   +2.384907031039679e-01   +4.266091276950185e-01   +2.159602465753531e-01   +8.745275669817485e-01   +7.611114010591417e-01   +4.330571851702807e-01   +2.252416466449558e-01];
L3I_L3E_iAMPA_netcon = [+6.492060848721476e-01   +1.654188620248881e-01   +3.558058687620430e-01   +8.661292919348406e-01   +8.607233435547248e-01   +2.574062754202791e-01   +2.497819240459528e-01   +3.580967386412353e-01   +6.296229537992161e-02   +5.494821807356196e-02   +4.525802860620613e-01   -4.229351988817871e-02; +4.508860820998557e-01   +7.932641043984512e-01   +6.369725491116871e-01   +3.788568163634598e-01   +2.022031361203934e-01   +5.313233313221649e-02   +4.946787046809460e-01   +2.771788709408222e-01   +1.121165055975053e-01   +6.988458452617397e-01   +4.550156160446089e-01   +7.835937558456981e-01; +2.678147055152915e-02   +9.638765812529108e-01   +4.543764547108902e-01   +4.588752256834675e-01   +7.168971928429047e-01   +4.665536658169810e-01   +3.334080207428486e-01   +2.423978585286271e-01   +3.112722368756455e-01   +2.008552305681881e-01   +8.484245208571308e-01   +2.332665503100547e-01; +6.587506006215674e-01   +1.211596010285334e-01   +8.356313703829061e-01   +1.861738017319330e-01   +8.085491974035370e-01   +2.735873882757944e-01   +1.380971352938119e-01   +3.055531622431678e-01   +3.280035711818120e-01   +3.859259843593124e-01   +6.087949795460045e-01   +1.527306775684885e-01; +6.785005473301753e-02   +8.733593153270399e-01   +7.705552657855462e-02   +4.196140661722973e-01   +7.916639125788505e-01   +3.454011073745368e-01   +1.288164033296094e-01   +6.693926064579567e-02   +7.753054189033290e-01   +4.244417823782353e-02   +5.899724862008450e-01   +2.177051694699965e-01; +2.251930006769081e-01   +3.385407452892559e-01   +7.801608324951154e-01   +4.810155051734586e-01   +1.912327713315151e-01   +4.334095730128452e-01   +1.103809208590028e-01   +5.154684842263940e-01   +5.924105812880680e-01   +4.691210477452944e-02   +2.810814784211776e-01   +9.854716389656757e-01; +4.415394827183392e-02   +7.161074782028528e-01   +2.647829025908011e-01   +7.987849103888695e-01   +4.733423603643757e-01   +6.299199225720966e-01   +6.212673526064242e-01   +1.463938906089914e-01   +5.820163971578752e-01   +9.656289402430379e-01   +3.696311814466796e-01   +7.293036552010247e-01; +1.048936403325699e-01   +4.998737311764404e-01   +6.987511898997213e-01   +3.152762270061327e-01   +9.055946623036966e-01   +5.284913144778796e-03   +8.150876497095642e-01   +3.558439739640828e-01   +9.674439579744684e-01   +8.964286831314013e-01   +7.537645286610271e-01   +4.130595705838389e-01; +7.718788607604904e-01   +1.030023172778935e-01   -5.224136571926902e-03   +6.262676055491800e-01   +1.000000000000000e+00   +5.723140800944938e-02   +7.278591058682807e-02   +5.422525536494108e-01   +5.907380619402315e-01   +9.142190147210066e-01   +5.649647638756639e-01   +3.279359383867207e-01; +7.716158256525210e-01   +4.675442222882378e-01   +4.351458914510936e-01   +3.551063969032578e-01   +1.929039216441579e-01   +6.684584575586749e-02   +8.877355823447298e-01   +5.378289256976350e-01   +3.713127347245754e-01   +1.908850160076433e-01   +3.859616987332612e-02   +6.495751184328992e-01; +4.493230394745264e-02   +4.324750236016922e-01   +1.606492737620785e-01   +3.686473463718797e-01   +6.098327520363316e-01   +4.074194768521480e-01   +7.000112121248793e-01   +8.794849013939795e-01   +2.528107513262069e-01   +7.269913452706177e-01   +1.683333323434879e-02   +8.697144177540639e-01; +6.679545245638813e-01   +3.143394607812619e-02   +4.525641619229492e-01   +9.504156158480688e-01   +6.863863258711913e-01   +3.231749199508995e-01   +3.358226445471685e-01   +7.435917613237688e-01   +7.758427276390554e-01   +6.988306080836354e-01   +2.024034091212012e-01   +6.367283001894706e-01];
L3E_L3I_iGABA_netcon = [+2.085823301106917e-01   +8.058392221721626e-01   +3.651235046780250e-01   +6.415267405000465e-01   +7.290345542742475e-01   +7.390350265770916e-01   +7.594267656230349e-01   +7.653650633406546e-01   +8.773301398611750e-01   +1.249535725430375e-01   +5.486551690808185e-01   +4.422421873839039e-01; +5.722127939549546e-01   +7.899855865196695e-01   +6.122803988396599e-01   +7.771983125175366e-01   +2.266268618818442e-01   +3.747369327556639e-01   +7.429402706742767e-01   +7.499010865718994e-01   +8.401234231567078e-01   +6.312532500609505e-01   +5.304392885441570e-01   +3.717049723916819e-01; +4.730935097860915e-01   +9.406073463373934e-01   +1.940676428537698e-01   +9.425725911187556e-01   +1.858087270796562e-01   +6.046549906669240e-01   +7.018365692626073e-02   +4.508348999341791e-01   +2.278369520198277e-01   +5.051320135876726e-01   +6.673255996659586e-02   +1.138462770297282e-01; +4.376758995576190e-01   -3.602049161110444e-03   +7.001325770336169e-01   +8.915821791852842e-02   +6.096271237845084e-02   +9.112518696294200e-02   +9.009320016285614e-01   +5.151387605216841e-01   +4.446342460213272e-01   +5.267611257186864e-01   +2.199021029424639e-01   +3.289430910427777e-01; +8.906487333088534e-01   +6.901640704341974e-01   +9.217371728036530e-01   +3.753652690435207e-01   +7.145061848001522e-01   +7.833003213514497e-01   +5.123920740489903e-01   +7.777618651263934e-01   +3.177591999137029e-01   +8.053246684629625e-01   +5.448253124707170e-01   +2.625357358089365e-01; +8.751401782249647e-01   +9.473105665038931e-01   +5.176060861081313e-01   +5.889951365812984e-01   +2.053357554601880e-01   +7.969816451733219e-01   +2.777980798849261e-01   +7.410341458482399e-01   +3.728226559876532e-01   +6.672323394645798e-01   +1.268268274896297e-01   +1.700924525347592e-01; +6.241446749075050e-01   +4.913691402451799e-01   +1.357061592432675e-01   +9.860039172331797e-01   +3.560193423030068e-01   +5.105685282897009e-01   +6.058277890974795e-01   +3.178809970822325e-01   +5.294822338434763e-01   +2.715233846398279e-01   +9.833981990307719e-01   +8.937306183295467e-01; +7.238422574477558e-01   +4.727948368087656e-01   +3.754476468501463e-01   +7.136385458232997e-01   +7.494517828842411e-01   +4.707069695266057e-01   +2.874949688612290e-01   +5.841400186143787e-01   +3.667633906052492e-01   +5.435485121296310e-01   +3.499030502738301e-01   +5.448653269697319e-01; +1.928798483249052e-01   +5.841852771259610e-01   +7.598744348433322e-01   +8.065745140305459e-01   +1.827672737692292e-01   +7.766040523870549e-01   -1.964711943096969e-02   +6.264161809652197e-01   +1.174614891408090e-01   +5.984244165914532e-02   +9.956024413166170e-01   +2.799059698649267e-01; +3.225278807718225e-01   +4.485609952211517e-01   +2.634586637785599e-01   +2.616502798526056e-01   +2.592994044034682e-01   +6.905442885888493e-01   -4.409608333802988e-03   +8.107396489722963e-01   +2.282123126386297e-01   +3.302616663298664e-01   -4.205038381346147e-02   +3.230826337771558e-01; +7.857392451940343e-01   +2.359912673394741e-01   +8.871254232872432e-01   +2.835391517656466e-01   +1.135111244459795e-01   +2.253315074633184e-01   +5.495426273973864e-01   +3.266197516761233e-01   +3.238851898563538e-01   +1.810537496218623e-01   +8.627488692848970e-01   +8.656806339584553e-01; +5.319383914357484e-04   +2.830960119885993e-01   +8.388173728581396e-01   +1.645143814918328e-01   +2.339904897190281e-01   +3.118616225647558e-01   +8.610174927420841e-01   +8.221617954676029e-01   +1.218559034784743e-01   +2.923811815133353e-01   +2.038332858495628e-01   +6.539724274128258e-01];
L2E_Input1_iAMPA_netcon = [+9.475498313126640e-01   +9.005804851337217e-01   +9.731146595363696e-01   +9.682706999242012e-01   +9.471695454811769e-01   +8.883566197744229e-01   +9.072603194371682e-01   +9.842785485358838e-01];
L2I_Input2_iAMPA_netcon = [+9.421792169846149e-01   +9.568563383706550e-01   +8.797520539860866e-01   +9.615737668265127e-01   +8.707366158522868e-01   +8.794791899152583e-01   +9.186746629569228e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
