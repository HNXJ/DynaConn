function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.543505018351158e-01   -1.411508342917355e-01   -2.710633325600073e-02   -4.715625969181962e-01   +4.779656870006819e-01   +1.566867986689774e-01   -3.189492532111070e-01   +4.769193393207738e-01   +2.487961848769763e-01   -3.085564314107992e-01   +5.010585566846896e-01   +2.127000048520011e-01   +4.785231430159234e-01   +3.312771069397924e-01   +1.516051259517872e-01   -5.287089626494662e-02; +6.018041642010336e-01   -1.984856311733421e-01   -4.693654148694532e-01   -2.928284009219715e-01   -4.560198071521652e-01   -3.477453551261787e-01   +3.745623120422858e-01   +1.577239858667655e-01   +6.939150566725905e-02   +1.886758762536839e-01   +3.270273626271109e-01   -1.326567156295007e-01   +2.781590316973708e-02   +1.388216867899883e-02   -2.479265092067104e-01   -5.395965619767236e-01; +3.213352211845991e-01   +7.962817531465266e-01   +5.582675560917358e-01   -4.239407524984622e-01   -7.912720267454740e-01   -9.776594475942309e-02   -2.804075346180178e-02   +1.191838927229595e-01   -2.359842080498126e-01   +1.245083265235805e-01   -4.438881642787202e-01   +4.319597597180031e-01   +1.076080685637991e-01   +1.919827579729586e-01   -3.812112683127096e-01   -5.625586784385065e-01; -7.324400953049578e-01   -3.992173410821600e-02   +3.677730139111403e-01   -2.456636924291552e-01   -5.732711303291389e-01   +3.265706733451075e-02   -6.117798629270269e-01   +2.382202378991955e-01   -7.631380470074753e-02   +1.037028940217046e-01   +5.864370802792411e-02   -3.587231458768999e-01   -6.885156718145519e-02   +4.992710639377704e-02   -3.674923762815920e-01   -5.929182933916514e-03; +1.478849302640806e-02   -1.111198745192905e-01   +4.060813896978724e-01   +7.137692018296928e-01   +3.332944797552479e-02   +2.577611303768015e-01   +2.512142684713330e-01   +2.351360040038992e-01   +1.485203402725794e-01   -7.266718645681385e-02   -9.795934928024162e-02   -2.696066622084001e-01   +2.457370270187504e-02   +3.327159978201061e-01   +6.097214512716149e-01   -3.728836152270038e-01; -5.513305581480539e-01   -9.873993744432456e-02   +3.069147462830562e-01   +6.087703275582782e-02   +1.855254579557800e-01   +2.483319442367866e-01   +4.330294678678737e-01   -1.095651870548883e-01   -5.470606139093381e-01   -3.421860580299234e-01   -5.558133649798703e-01   +3.153038572081037e-01   +4.163760043724988e-01   -2.560388070923963e-01   +6.227661646434077e-02   -1.868500441168133e-01; -2.066416446487384e-01   -2.159469489113686e-01   -2.168770812106507e-01   +4.535747700639912e-01   +4.334389787096382e-01   -1.316084286458865e-01   +5.359906191323973e-02   +2.761565799671100e-01   +3.219013204309390e-01   -1.593914556189079e-01   +9.671276822904400e-02   -6.269006909272431e-01   -1.823663406180859e-01   -1.419958785150535e-02   -1.111783814860843e-01   +1.934275982904160e-01; -2.014212593993525e-01   -5.279508962538919e-01   +2.092244362236890e-01   -3.834690107252450e-02   -1.036777279564517e-01   -2.976280332121419e-01   -5.202815958199010e-01   +2.175517107044787e-02   +1.918072627466843e-02   +8.037239114076390e-02   +3.712720223297983e-01   +5.658513864503809e-02   +5.314578676964671e-01   +3.201147213096043e-02   -9.650387117971911e-02   -8.100847711731841e-01; +2.600227390577221e-01   +9.125311412224991e-02   -3.846423304300546e-01   -3.938344636161526e-02   -2.946846885148590e-02   -9.103670706367628e-02   +5.832808682186574e-02   -1.000000000000000e+00   +2.714901152758655e-01   +3.434972055604337e-02   -2.419229132686870e-01   +4.765064305606344e-01   -4.316033353676937e-02   +2.690223042109141e-01   +5.804702048985833e-01   -5.053579097900963e-01; +2.373871059851148e-02   +2.547745240984083e-01   +7.318574906384488e-01   -5.801144716486572e-02   -2.427560027665166e-02   +7.799977404512162e-02   +1.268491035229939e-01   +3.384964092197630e-01   +5.088079759679340e-02   -3.737990277329700e-03   -3.977784290008476e-02   -3.685274118338088e-01   +1.920240006498539e-01   +3.531939105547661e-01   +1.582656368914000e-01   +1.882417393760998e-01; +3.795077534811481e-01   -1.026790998290642e-01   -3.227527434445588e-01   +2.033832330518026e-01   -1.391314219136344e-01   -1.159671027575685e-01   +4.932179261978323e-01   -2.485478371014157e-01   +2.948221275426620e-01   +2.502847735855261e-01   -2.271820867941827e-01   +5.610267848296525e-02   +1.318144906817954e-01   -6.071345436120814e-01   +2.152277725312987e-01   -1.036697344411125e-01; -3.709763684787229e-01   +1.705893931839946e-01   +2.573374526978146e-01   +9.581377513160029e-02   -3.629873135748265e-01   +5.010688455603334e-01   -7.019099618694431e-02   -6.890679313664411e-02   +5.095525949831221e-01   +1.437076150463166e-01   +1.414282131157762e-01   +3.946577687359308e-01   +6.336686400908652e-01   -2.098329460134759e-01   -1.967546985473327e-01   -6.321119522947913e-01; -6.544723219824188e-01   -2.123917959197244e-02   +5.427154076731825e-02   -7.121267011031504e-02   +4.661003286016331e-01   -1.346809676064742e-01   -1.011411460017082e-01   -1.093490086299305e-01   +5.998518714156875e-01   -1.426784674174236e-01   -1.955151034273070e-01   -2.770245054636572e-01   +4.489238660305212e-01   +3.368582117617343e-01   -5.234390825141070e-01   -4.652158141465126e-01; -2.187849539027895e-01   +1.137915079140308e-01   +1.820483469921521e-04   +5.943550507137640e-01   +3.121090022885821e-02   +2.093499007739208e-01   -5.473454504531221e-01   -3.557869692555782e-02   +9.692868767824675e-02   +5.554354624692952e-01   +1.238772030266266e-01   +9.149503442649509e-02   -1.040826883671913e-01   +3.227812708715868e-01   -3.675155507421943e-01   +2.711191380648680e-02; +3.494870468460781e-02   -2.896369680244161e-02   -4.155255003599476e-01   -1.456831271534892e-01   -4.273268733715448e-01   -2.590257560174729e-01   +2.553385945647346e-01   -4.001168763559195e-01   +4.883197557335168e-01   -4.932821080689786e-02   -4.583591517989422e-02   -6.628385318368371e-01   +2.343970462368146e-01   -7.506282069264486e-02   +3.475126289596756e-01   +4.132730908953719e-01; -4.168848432955593e-01   -3.604067936838409e-01   +2.528484088319842e-01   +8.227430617277142e-01   +2.609820947514725e-01   +1.352539858288281e-01   -2.039233270448979e-01   -1.000794588593750e-01   -3.853624228490523e-01   +2.214708293809091e-01   +5.359752351341557e-02   +3.314435026008839e-01   +7.681567395284006e-02   +7.434533701926753e-02   -7.483824654273551e-03   -3.889703184250604e-01];
L1E_L1I_iGABA_netcon = [-2.064220333806709e-01   -4.743089738936347e-02   +9.678792726164114e-01   +1.610125117569874e-01   -6.820562508442363e-02   -7.227208391149188e-02   -1.695260985473706e-01   -1.458485059795092e-02   +8.559688236347388e-02   +4.014213953627678e-01   -3.244747500745628e-01   +5.129147838553044e-01   +2.967149609934951e-02   +3.742124726432364e-01   -1.357098375750817e-01   -5.081177317077755e-01; +2.085031274161840e-01   +2.541147461632656e-01   +2.370207101346930e-01   +3.948372982701086e-02   -7.750265879837401e-02   -1.885110692928576e-01   +4.651516186424687e-02   +5.723557086407175e-01   +3.705788014272928e-01   +4.769219499430142e-01   +8.234500651477832e-02   +4.620463043995733e-01   +1.261828170220529e-01   -3.399759985652775e-02   -2.266615342874311e-01   -1.834999354465429e-02; +2.682758026211264e-01   -2.859383604046256e-01   +6.735338900470293e-01   -4.988415023222911e-02   +5.481036197554476e-01   -4.110010149830373e-01   -3.315398228440870e-02   -5.749656480649419e-01   +1.048337309514792e-01   -2.539854269363391e-01   +3.683168410672242e-01   -1.006918865768191e-01   -2.782535928943047e-01   -2.774537889362215e-01   +1.616138577156002e-01   -5.594236993569983e-01; -4.277321109355523e-01   -2.144931356143474e-01   +4.045143534677159e-02   -2.289168960156829e-01   +3.087768279050983e-01   +4.749132755506531e-02   -1.395843843934085e-01   +1.140247571229212e-01   +6.947006612299432e-03   -4.921459777910686e-01   -6.722071458967321e-02   -2.955431325281901e-02   +2.672537911732416e-01   -4.454434799691875e-01   +5.210385743850376e-02   -4.922267516400603e-01; +1.813921191208865e-01   +5.610570095357870e-02   +3.161098822544003e-01   +4.490647992494439e-01   +3.523685350308157e-01   -1.257114307093199e-01   +3.059370527931052e-02   -1.875963691015422e-01   +4.809523665724481e-01   -4.739723935311108e-01   +3.894819040642090e-01   -2.055927525741391e-01   -6.711720956857472e-01   +2.947069030743680e-01   -2.769698310083027e-02   -3.410832400354093e-01; -2.739503242878147e-01   -2.037750544464122e-01   +2.788807411497199e-01   -7.636873778779268e-02   -5.717770125592227e-02   +1.500999944874269e-01   +1.139370896270042e-01   -2.328055047439970e-02   +8.772990922930568e-02   +4.803790153746891e-01   -6.574763745973715e-02   -3.009251878950583e-01   +2.452304573680935e-01   +1.892528460424887e-01   -3.154756624714017e-01   -3.262708644364417e-01; +4.527363354861124e-01   +9.008001712983243e-02   +1.565637654651524e-01   -8.632360764771219e-02   +5.859140617776792e-01   +3.065722398793899e-02   +5.119443534139136e-01   -2.775331044335352e-01   -1.589075052090423e-01   -2.546492609594664e-01   -1.643542736053895e-01   +1.817484238259059e-01   +4.135789121407962e-02   -3.973421721199652e-02   +3.909684770962306e-01   -9.721901487222256e-02; -4.224353864132020e-01   +9.249230338155058e-02   -1.712702997990029e-01   -7.629803355159104e-02   +1.290046664222301e-01   -2.421814434608310e-01   +7.594024138481786e-02   -2.820982536603396e-01   +2.449954171612186e-01   -2.137849556286739e-01   +4.027935794000401e-02   +3.301624718694029e-01   -1.713597583817041e-02   -2.939916282376920e-01   -2.247574452290418e-01   +8.177004872040930e-02; -1.501253112973360e-01   -4.340104524096492e-01   -5.217808519528613e-02   +4.196282911058453e-01   -4.470166611664502e-01   -5.356899915317860e-01   -6.865072804378008e-01   -2.899987489929537e-01   +4.494287021765787e-01   +7.154445102979384e-01   -3.126878693141133e-02   -4.563026370043016e-02   -2.616204635855288e-02   +3.051732905825717e-01   -6.237419677858024e-01   -9.860501703478572e-02; +1.253401980266877e-02   +2.174789383107003e-01   +3.087082483479300e-01   +3.521698117751845e-01   +2.422589233432609e-01   -9.521697572846219e-02   -3.322513705291003e-02   +4.154621252426934e-03   -4.811236492483808e-01   +1.409538601423730e-01   +5.095709339282235e-01   -4.777791380620564e-01   -8.997281998822471e-02   -6.259851641197378e-02   -2.495375405648931e-02   -3.127041648072706e-01; -2.256056948503945e-01   -1.749030773551540e-01   +3.398590139259336e-01   -3.185997360991270e-01   -4.736806311622213e-01   +1.993988721029279e-01   -4.890462674354118e-02   -2.338791223323849e-01   +3.264386948349912e-02   -2.764129205506137e-01   -2.319053985399636e-01   +2.462572723729631e-01   +2.411793006837071e-01   +4.876315342547405e-01   +1.717296115148204e-01   +5.082331340626542e-02; -6.836600699748895e-02   -1.040159792667389e-01   +2.023112272909769e-01   -3.823375668542837e-01   +1.422457315221666e-01   -2.306065887366775e-01   +8.427085299787408e-02   +5.842582579428481e-02   +3.318014800583696e-01   -2.262828188838564e-01   +7.753885719527986e-02   -8.912788725698743e-02   -2.096049900436994e-01   -3.839381890944925e-01   +1.751013634020620e-01   -7.877069613697044e-02; -2.046073156531182e-01   +1.790854866496622e-01   -6.127658138839957e-02   +2.568086264167038e-02   +3.711945601073096e-01   -1.407683172398151e-01   -3.940623977218260e-01   -3.940739739111451e-01   -2.181283082804038e-01   -4.393482363241207e-01   -7.718507143445905e-02   -3.381397802286107e-02   -6.138999523282627e-01   +1.679782968591833e-01   -4.319213163208716e-01   -2.541907781481668e-01; -1.962780332133967e-01   -1.868218070372233e-01   -1.649387735674924e-01   -3.266264002838534e-01   +7.013733971433793e-01   +3.292476352003832e-01   -1.721183534932371e-02   +2.793182577412853e-01   +3.879061350027789e-01   +3.937455042472319e-01   -8.030996664413942e-02   -3.120466162653777e-01   -1.698306396831585e-01   +1.171966884866217e-01   +2.621502796800162e-01   -3.554434637546533e-01; +8.891570623100811e-02   -1.365611943162130e-01   +4.641412906537105e-01   +8.979194836739335e-02   -1.927380052880097e-01   -1.384431754338677e-01   +5.459253186670979e-01   -4.573581549464023e-01   +8.235843630566128e-02   +3.670031536886822e-01   +2.207017466042578e-01   -3.003659907238612e-02   -4.832452554495153e-01   -4.660105387267456e-01   +2.777161242936653e-01   +1.156723020246750e-01; -7.446785174280508e-02   +4.286086565507580e-01   +3.298778303658979e-01   -3.468243676582688e-01   +2.871065294950442e-01   -5.910558998205981e-02   +1.840764524012072e-01   -4.556343938999058e-01   +4.325454789689208e-01   +2.665127798722566e-01   -2.321373972703916e-01   +1.236951283011184e-02   +5.843760998424913e-02   +5.881688036905748e-01   +1.019681199586469e-01   +4.424060299192699e-01];
L2I_L1I_iGABA_netcon = [-9.672317403028727e-02   +2.905467544748782e-01   +4.725535894178915e-01   -4.317644580002095e-02   -1.116729196123234e-01   -8.174808751133317e-01   -3.695421396181197e-01   +2.248941295978507e-01; -4.196275512109144e-02   -5.458524449203205e-01   -4.851446811566976e-02   -2.334862369641373e-01   -8.604492862797828e-01   -3.081314710767327e-02   +4.895648063706877e-01   +5.695027113274060e-01; +4.689377306128990e-01   +1.709916311595117e-01   -4.268536580561230e-01   +2.336696975718933e-01   -1.533781210547131e-01   +6.285107095639544e-01   -5.447661668841667e-01   -1.914129759155038e-01; +6.471118979632244e-01   -5.495967700367395e-01   -3.227220164201574e-01   +3.042515373940763e-01   -5.420855060416486e-01   +8.461218482640097e-01   +1.735380685719778e-01   -6.929710517308438e-01; -1.939490103236793e-02   -1.218799203643153e-01   +4.938493971471187e-01   +6.238324279714220e-01   -9.268103924082458e-02   -3.419108513433081e-01   +1.302993184861192e-01   -2.224907680096986e-01; +2.638266689560614e-01   +4.847486212633330e-01   +8.725519027410828e-03   -6.026352765657941e-02   +4.520666475232346e-01   -5.227427319862415e-01   +2.224838049115581e-01   -8.984179378232167e-02; -1.385998347409474e-01   +1.511006135366848e-01   +3.768799988986338e-02   -7.578892538240442e-02   +3.091240662668301e-01   +2.724927611753332e-01   -3.693341301003025e-02   +3.633506100286348e-01; +3.907640897206954e-01   -6.277695796918663e-02   +4.442327837032140e-01   +5.897580608171979e-01   -6.905613723639109e-01   +1.900714126017296e-01   -4.559964478426695e-02   +1.894012624500102e-01; +2.071854828242597e-01   -7.660122833367154e-02   -6.160469477886514e-01   -1.046757561380482e-01   -1.555695716595296e-02   -5.112009101548685e-01   -2.677468456722194e-02   -2.348805973223579e-02; +1.132366949908735e-01   +2.008687103217392e-01   +3.124747260209537e-01   -4.541884889146698e-01   -4.577375604755212e-01   +1.927651975009866e-01   -6.880557194329021e-01   -1.660955586033321e-01; +3.610625751138639e-01   -6.559235231476177e-01   +1.244223728688570e-01   -2.531891124776762e-01   +8.026669453524718e-02   -4.960449731750113e-01   +5.967379210518912e-02   -4.482682811206562e-04; +8.037778585563450e-02   -2.527971091147097e-01   -5.163748911428956e-01   +4.940322312596872e-01   -6.683942372526211e-01   -6.825500663502067e-01   -2.356916444022079e-01   -3.901899722346641e-01; -1.336854222151700e-01   +1.930015252752319e-01   -5.672160415788402e-02   +4.350149785324540e-01   -1.299653390571968e-01   +2.309557040618318e-01   -5.120161118013252e-01   -3.004972789266443e-01; +4.572972516750489e-01   +1.456100893410169e-01   +9.072872869967691e-03   -6.617995627821605e-01   +3.448488604321732e-02   -5.283838006198176e-01   +3.642995608409865e-01   -6.268412921146993e-01; -2.803799218564408e-01   -5.627529951111269e-01   -5.088972222241406e-01   -5.265069523674570e-01   -6.775520178740960e-01   -1.331382631203855e-01   +3.065429436252918e-01   +1.994751655238029e-01; +7.263374212547105e-02   +4.138161497214795e-01   +3.053536225400599e-01   +4.110368595094803e-01   +2.043468778692464e-01   +1.005831430368686e-01   -4.096217973153519e-01   +5.883755143453379e-03];
L1I_L2I_iGABA_netcon = [+3.380436720315529e-01   +3.741199865815521e-02   -2.945296940105604e-01   +6.474048684106269e-01   -4.724252947246114e-01   +2.533593662068626e-01   +1.378565834835200e-01   +8.175476195919145e-01   +1.982873058854357e-01   +5.192112013977410e-01   +5.956626810605166e-01   +7.762773501673471e-01   -5.343296007521526e-01   +5.838164611865624e-01   +1.930183158099638e-01   +5.643245407301319e-01; -2.355454483436930e-01   -1.044051552486268e-01   +2.306339250027808e-01   -3.436745691142148e-01   +6.823201001376269e-01   -4.335178254412351e-02   +6.520828812267838e-02   +4.680186970710920e-01   -4.281203541750664e-01   +6.319145118971659e-01   +2.394822299880718e-01   +1.341959214952199e-01   +2.520049530769585e-02   +6.821980033404798e-01   -1.663057469059281e-01   -1.246544534026357e-01; +1.986879483510652e-01   +2.354607525139584e-01   +1.989421155196203e-01   -1.884183819394321e-01   -4.245446677497521e-01   -2.106733093861394e-01   -1.647137494841430e-01   -1.885332930256703e-01   -5.010921483468999e-01   -3.161965317788811e-01   +4.388823269557571e-01   -4.137195833043913e-01   +3.955371544549348e-01   -4.519820049278793e-01   -3.631213236937590e-01   +2.983197425761314e-01; -3.652368682907853e-01   +3.654853429807599e-01   -7.114680658693916e-01   -2.683969488551410e-01   -3.203616845966543e-01   +2.717936731451732e-01   -8.348575790709098e-02   -1.589877758183636e-01   +3.399373080135466e-01   +5.351972018444655e-01   -8.615176126650426e-02   -2.092018176737595e-01   -9.727734883207463e-02   -8.176814013702189e-01   -2.349561521180789e-01   +2.725501584174234e-01; -7.643411918359115e-03   -3.884522366578808e-01   +2.495428150762327e-01   +9.182728703675507e-01   +2.164630907098459e-01   +3.794000944011732e-01   -6.409013353456558e-02   -6.185173905718077e-01   +2.904596441168807e-01   +1.000000000000000e+00   +3.865968467313986e-01   -5.679669604675701e-01   +2.439142079582069e-01   -1.010696943272428e-01   -1.218941317496136e-01   +2.428895123219163e-01; -3.449430010468287e-01   -2.812266388570835e-01   -4.607552547878402e-01   +2.366512259145638e-01   -2.724015313619422e-01   +5.826698044310950e-02   +3.509333893167886e-01   +3.299201464881811e-01   -3.059545150493030e-01   -4.369677187941609e-01   +5.720547762955625e-01   -4.474876489690182e-01   +3.502389207446908e-01   -3.460308281769843e-01   -1.310618220704494e-01   +4.672407721046159e-01; +4.491402980187845e-01   +5.607152008136114e-01   -3.570913546764107e-01   -1.938231538246196e-01   -1.274120530259301e-01   +1.185408713306403e-01   -2.657672076998611e-01   +5.918327125521446e-03   -2.670260562040202e-01   +4.411315039414514e-01   -1.400448186539986e-01   +3.106032157494640e-01   +5.676485683529841e-01   +2.741362816188768e-01   +3.357641994236113e-01   +4.640579408582686e-01; +3.468030106143366e-01   +1.560136111095276e-01   -6.069030111686288e-02   +1.517906364201034e-01   -1.159707611273299e-01   +8.576801622140164e-02   +1.701633472062206e-01   +1.656771970073765e-01   -6.652651245135831e-02   -2.241627462338944e-01   +3.284027388213630e-01   +4.112523544653177e-01   -5.006848695967622e-01   +1.613928217599956e-01   -2.105182131578611e-01   +1.707550279472282e-01];
L2E_L1E_iAMPA_netcon = [+9.839418104325107e-02   +1.603811361121507e-01   -1.200925986303114e-01   +1.692705850742504e-01   +2.734137846689369e-01   -5.538409705092890e-01   +3.049398942372823e-01   +9.239170960310203e-02; +1.244030218856537e-01   -3.330826646894690e-01   -2.434783242367688e-01   -9.377992087219661e-01   -2.475707417637360e-01   -8.522086776597004e-02   -6.438385288316042e-01   +1.907777017104465e-01; +1.153886682297184e-01   -1.742070723430514e-01   -7.001503803986215e-01   -4.532970274824993e-01   -3.779402067584419e-01   +7.747051827136207e-02   +4.697818305597706e-02   +7.454587537925508e-02; -6.313128018355717e-01   +3.328880223774445e-01   +1.579673605133256e-01   +7.000740488292452e-02   +4.575841529448813e-01   -1.479481544275663e-01   +4.598937496741075e-01   -1.873067986111421e-01; -4.045071121430638e-01   -3.657983590344192e-01   -1.286056957735969e-01   +3.302767068421463e-01   +5.025427978179624e-01   -6.151141677572831e-01   -1.205344015925079e-01   -6.060113291146173e-01; -1.088244680632046e-01   +4.274374877270680e-01   +4.271546260018181e-01   -2.520280369599091e-01   -4.544032692949740e-01   +1.712115302318027e-01   +5.143606734868791e-01   +4.458090344175948e-01; +1.860938576602246e-01   -5.616413208062374e-01   +7.031815786413201e-01   -1.059924139979000e-01   -2.634034326694783e-02   +1.983955578099768e-01   +5.221976982414270e-01   -1.181832523037421e-01; -2.179954170207562e-01   -2.551494014194098e-01   +3.902411510854413e-01   -2.320365955065379e-04   +1.520588401471633e-01   -4.831840736310867e-01   -4.523767735647201e-01   +1.147752912785176e-01; +4.226419868578909e-01   +5.905019403277114e-01   +3.719958459193730e-01   -3.132260785810312e-01   +3.659098115351146e-01   +1.831000850684902e-01   -3.067036874921055e-02   +5.054604958657417e-01; -3.767462666174761e-01   +2.121358290593409e-01   +4.575098934855565e-02   +1.882128497169742e-01   +9.193796425660955e-03   +5.320728040441262e-02   -6.254621316182030e-02   +5.236888672027511e-01; -3.702441125068762e-03   +8.243197994284740e-01   -2.771665902195064e-02   +5.513503599226838e-02   -4.346787267673723e-02   +2.501060401589537e-01   -3.265844570877253e-01   -8.646839214496550e-01; -5.921161321021164e-02   +1.081040811178078e-01   +6.735231250495144e-01   -2.975845890629518e-01   -3.791776178153419e-01   -5.160869972102872e-01   -2.359934719916042e-02   -4.149883915807433e-02; +3.713760241728852e-01   +5.947503862141029e-01   -3.010823759190893e-01   +2.639555833112181e-01   -6.654234103679273e-02   -5.264564455829233e-01   -5.331631388420738e-02   +7.558636048494204e-02; -1.136566280699967e-01   +8.159713735224251e-01   -3.644399792075095e-01   -3.765405074442727e-01   -1.883406209656212e-01   -2.869590157331393e-01   -6.072190502793680e-03   +8.443915101070870e-03; -4.379827195792909e-01   +4.115703575684865e-02   +2.888970560447786e-01   +6.478420343833716e-01   +6.276942333042693e-02   +4.816541290530792e-01   -4.831758404694287e-01   +7.029771111639629e-01; -1.824662098990407e-01   +9.712668132143992e-02   -5.559968213180082e-01   +8.725455387676818e-01   +3.929231516493161e-01   -9.126079841634685e-02   +4.667334708652701e-01   -1.062275663324628e-01];
L1E_L2E_iAMPA_netcon = [-7.422855795406615e-01   -2.177326269152419e-02   -1.015802596179224e-01   +8.420408502119728e-02   -3.701720884735525e-01   -4.728508728494746e-01   +2.677539319363885e-01   -3.064761895175030e-01   +6.828901917147591e-02   +3.223274320982683e-02   -2.412120649826937e-01   -1.034838668827751e-01   -1.891296426257237e-01   -5.573895105955839e-01   -3.544072501910803e-01   +8.209382436243098e-01; -5.091747702744915e-01   -2.831347970711627e-01   -6.330855437129550e-02   +2.975147224698707e-01   +4.469238911716187e-01   +1.210434993525260e-01   +1.228450682281851e-01   -4.605369859596503e-03   -5.787106147698535e-01   +5.795782126594774e-01   +8.217316409970341e-01   +4.892689625867291e-01   +1.439038501702221e-01   -1.278067559604134e-01   +4.250862853547031e-01   -1.910942184787744e-01; +6.294018860911055e-02   +8.030098699589445e-02   +4.091579460962278e-01   -1.194071890510938e-01   +4.664957069466990e-01   -2.305908381410247e-01   +8.667326967269022e-01   +2.225691450244337e-01   +1.162868723680396e-01   +4.505475236868049e-01   +3.073093594572732e-01   +2.412304916062919e-01   +1.777819290646465e-01   +3.845464132226484e-01   -1.149487371054257e-01   -1.011980795685336e-01; -3.081366584495185e-01   +5.824122268498449e-01   +5.728293807590761e-01   -2.205233670527862e-02   +2.448775914248702e-02   -5.028597487059240e-01   +1.310227759019948e-01   -2.016212353194406e-01   -1.288852161290950e-01   -1.887366119173209e-02   -3.774933707738570e-01   -3.669546674812594e-01   -1.781084431094057e-01   -4.960153438792257e-01   -5.462369005905381e-01   +2.656732836421254e-01; +5.753095086834071e-01   -2.268890738657408e-01   -4.963251539426480e-01   -1.461320664914620e-01   -4.864663242544506e-01   -2.241673903424068e-01   -6.326982213714821e-01   +1.014049424815465e-01   +4.331846363359776e-01   -1.883393598052033e-01   -1.783663765874152e-01   +3.268683000923176e-01   -4.897927931672513e-02   -3.931233711849939e-01   -7.176004182583112e-01   +8.016759845044796e-02; -2.961176685932598e-01   -9.699636431016342e-02   -4.858070981409821e-03   -1.860488899130948e-01   +1.016808961129161e-01   +7.530248665254120e-01   -4.141321238582125e-01   +3.795955116051627e-01   -4.270363601208448e-01   +3.149041080541164e-01   -1.903960361381687e-01   +3.969409383733418e-01   -3.110428734614805e-01   -2.539657408940685e-01   +3.123725627235441e-01   -2.192687134101076e-01; +4.050542872282176e-01   +1.749992796618795e-01   -2.558868847537329e-01   -4.626789964769774e-01   -1.111790072127003e-01   -5.911003598488950e-01   +3.696896484029131e-01   -1.988099455704967e-02   +4.171510650681052e-01   +8.046156100103539e-02   +2.163528617285893e-01   -5.239203495535041e-01   -4.548451888604435e-02   +1.054201201717744e-01   -4.943723160852464e-01   -1.479018219430042e-01; +3.254714905179353e-01   -1.916258349168408e-01   +1.154408155414474e-01   +5.040356292705822e-01   -1.783431811987973e-02   +5.164019899449145e-01   +1.311179822609497e-01   -3.688523155863418e-01   -3.162047665504730e-02   +2.258526902491348e-02   -4.634848529310150e-01   -2.888464388911899e-01   -6.069252230068408e-01   -4.565240996584993e-02   +3.057285946107864e-02   -4.148847848811963e-01];
L2I_L2E_iAMPA_netcon = [+2.610251884447146e-01   +4.164507824875523e-01   -5.548380447537224e-02   -2.486953525751273e-01   -1.031317928779131e-01   -1.349124002382530e-01   -2.369712807470229e-01   -1.619265368110008e-01; +6.058354956397505e-01   -4.586290297735691e-02   -3.006679798035330e-01   -9.849201889648261e-02   -1.557590910564700e-01   +4.170738536234084e-02   +3.700003543662453e-01   +3.412054537297347e-01; +7.417063759063594e-02   -6.048729213172303e-02   -4.350937979848649e-01   -5.261047992655731e-01   +3.450766527257473e-01   -3.496115899013466e-01   +5.909365130984893e-01   +3.416113648797985e-01; +2.732340603390310e-01   -1.785723604864528e-01   +2.659940278409366e-01   -3.380612253832656e-01   -3.366444082459722e-01   -2.250133283184267e-01   +2.100339731822558e-01   +2.375725647787787e-01; -6.061829310244495e-01   +1.914099421188555e-01   +1.510594601016442e-01   -4.552395078200842e-01   -3.438969546768296e-01   -1.573470356108725e-01   -1.318568480292797e-01   +5.634250058057889e-01; -3.959050074589137e-01   +4.102182840869549e-01   -7.744009756508854e-01   -9.883170357013961e-02   -2.726432142753659e-01   -2.186901601576982e-01   -9.877597008621747e-02   +9.584513935234869e-02; +5.390678778950726e-01   -2.978088988316888e-02   +4.916057744566696e-01   +4.097107484448886e-03   +3.098641493093826e-01   +2.248772843372534e-01   -4.482073664148761e-01   +5.487889201247684e-02; -1.563302609462676e-01   -2.680868597242326e-01   +8.501798187251070e-01   -2.017268515610758e-01   +4.225464128372162e-01   -4.974436845516433e-02   -7.644982711045886e-02   -2.004847015513576e-01];
L2E_L2I_iGABA_netcon = [+1.379574736780833e-01   +5.099216586452614e-01   +6.938967282831799e-01   +1.435282762854643e-01   -1.396969939905290e-03   +2.436664872437108e-02   +2.696276321405026e-01   -1.050801564583433e-01; +9.819176121933199e-02   +2.016567100687787e-01   +4.267038007550206e-01   -2.593610851939950e-01   +2.364260325908099e-01   +4.450902613308745e-02   -4.941775546420356e-01   +2.587133104498740e-02; +1.982990359577891e-02   +3.589381529960746e-01   +5.823878484362117e-01   -5.882339058072777e-02   -2.814834071089903e-01   +2.994069003994647e-01   -3.123359215120358e-01   -7.620301301925726e-02; -8.012261356767176e-01   +3.116421506013544e-01   -9.207701116408962e-02   -5.096419347657440e-01   +6.212959131401347e-01   +1.822997259557265e-01   -1.732953801119945e-01   +3.304098780763408e-01; +3.610378786829513e-01   -8.119479882449088e-02   +2.589237183206107e-01   +5.801507769632037e-01   -5.630191808768787e-01   -2.999019635111393e-01   -8.535399372430309e-02   +6.942334179578874e-01; -6.505693895653651e-02   +3.562756510065912e-02   -2.352132518881841e-01   +4.333688233732402e-02   -8.568459116399957e-01   +1.982671083469650e-01   +2.650122593325331e-02   -1.001274007905269e-01; -7.824235361131210e-02   +3.089000409285994e-02   -4.838317227064340e-01   -3.607003892486619e-01   +1.036445204741161e-01   +4.930331012701664e-02   -3.327276273583830e-01   -1.973336812206801e-01; -1.036912191066449e-01   +3.353339518169962e-02   +4.211600621162013e-01   -9.464956365136684e-01   -6.543457779834100e-02   +4.763791443843002e-01   +4.749254344045212e-01   -4.171715307277185e-02];
L3E_L2E_iAMPA_netcon = [-1.545841288307888e-01   -2.708945490779852e-01   -1.443762490320612e-01   +4.333636989565346e-01   -2.313536854186671e-03   +2.111685815408857e-01   +1.587656789316740e-01   +1.637997734812905e-01   -2.950391189945654e-01   -1.020683065383020e-04   -1.197815114779875e-02   -5.017310880816815e-01; +3.941057101111093e-01   +2.394749354883478e-01   +4.561314482127886e-01   +1.746209474953831e-01   +3.659906339203802e-01   +3.745230892352950e-01   +1.682196678498193e-01   +3.665033167836682e-01   +1.562458375689323e-01   +6.447335428306523e-01   -4.753608843244025e-01   -2.721218629476261e-01; +3.861191078273684e-01   -5.488334148979824e-01   -3.120034470351283e-01   -1.611150735155094e-01   +4.719935656953852e-01   -2.252544857776166e-01   +4.058439939362338e-01   -6.155636073245766e-01   -2.372723922752177e-01   -1.464009088098049e-01   +1.879190061325839e-01   -2.984716309572324e-01; +4.199578618165047e-01   +1.742023632610040e-01   +5.595004767394676e-01   -3.980059191964300e-01   +1.829540126601914e-04   -3.486724974604464e-01   +5.474840708761251e-01   -7.070360719115598e-01   -6.060329711227402e-02   +8.044722957419218e-02   +4.378725505738943e-01   +1.471061532360618e-01; +4.951406670410091e-01   +1.462837120533410e-01   -1.458709651066257e-01   -5.165542608042213e-01   +9.395029051726878e-02   +6.226118019859815e-02   -2.797339029900023e-02   -5.073182975322578e-01   -2.324828593555094e-01   +6.072173095597755e-01   +2.833000720831803e-01   -6.655950751313168e-01; +2.567157113767947e-01   -1.222332267704093e-01   +2.655409085690949e-02   +2.348121765925418e-02   +5.215517728679321e-01   -4.110239783697313e-01   +1.062767208062133e-01   +4.831586134404945e-01   -2.840832950901926e-02   +7.853805524060625e-02   +5.085888249517314e-01   +2.761272952579535e-01; +1.178115985616273e-01   +1.021428972925407e-01   +9.019148492270315e-02   -4.053496601521377e-01   +4.982663637432224e-01   -6.421843390114351e-02   -1.439183221477002e-01   -1.581294852629748e-01   -2.152337897205683e-01   +2.225764633075392e-01   -4.159990978200653e-01   -5.407359901338578e-02; +3.076810639403349e-02   -3.231374689171024e-01   -4.947330315498982e-01   -2.737324384065511e-01   -1.222875318356997e-01   +5.966708867413999e-01   -4.737996805377483e-01   +2.819563411189910e-01   -4.287522332373516e-01   +7.798667588650969e-01   -1.213922244038321e-01   -4.758535722757614e-01];
L3I_L2I_iGABA_netcon = [-1.444100777941690e-02   -4.567793583965426e-01   -8.762740858451909e-02   -3.311634513922260e-01   -4.173533158605207e-01   +2.519688047990476e-01   -1.777522244431635e-01   +2.346573309193595e-02   +3.063849876040976e-01   -2.607230276803112e-01   +3.290727089704581e-01   -1.000496737569212e-01; -6.130843748096247e-01   +6.520503206397595e-01   -3.097009324933685e-01   +9.411348741682481e-01   -9.805711494810431e-01   -4.502252670527962e-01   -5.124657997718882e-02   +5.841258518508592e-01   -6.843498733104786e-02   +8.283153386050413e-02   -7.814485961961226e-01   -2.196264109317173e-01; -1.122809591586089e-01   -1.426944748354849e-01   +7.812400056272940e-02   -6.253909750078255e-01   +4.977838611893383e-01   +6.956033674250167e-01   -4.041407309626302e-01   -6.044974965620919e-02   -9.688468989596138e-02   +1.018151413948346e-01   +7.425924727455518e-01   -4.220627929434870e-01; +2.442015606623624e-02   +2.416199412707980e-01   -1.004275430163831e-02   -7.204162162794357e-02   +7.751050914291494e-01   +8.963192644795898e-02   -5.406973783709241e-01   +2.867412046347116e-01   -1.821468068063466e-01   +1.777751818097872e-01   +2.089891247504165e-01   +1.834248755721405e-01; +2.180216753493017e-01   +2.728081588313928e-01   -2.273703856280198e-01   -1.632032564479836e-01   -1.857856615671544e-01   -1.938231841800803e-01   +4.160752175466894e-01   +3.743296816694692e-01   +5.132973476100272e-02   -3.234101879139040e-02   +2.274252236602582e-01   +7.497900949671883e-02; -7.948666835664044e-02   +3.859898912058846e-01   -3.530062421813338e-01   -6.953906500592748e-02   +2.936336297120938e-01   -1.481153774945054e-01   +2.854335017725876e-01   -9.493063703700488e-02   -1.123921774617851e-01   +4.351239028326915e-01   +3.802538001997821e-01   +2.125738717853668e-01; +3.618462894634006e-01   +2.923732877603634e-01   -1.051837583787062e-01   -1.124328630893005e-01   -4.246867667690618e-01   +4.818648966427335e-01   -1.924053095928343e-01   +2.144966348219017e-01   -6.926903647477177e-02   +8.384864882077063e-02   -2.163157312285331e-01   -1.670050813137216e-01; +5.682858375666827e-01   +5.101522114878627e-01   -8.270788798568188e-02   -1.543088480068123e-01   +3.661834494544584e-01   +1.139236630456726e-01   -6.997987021971699e-01   +1.187978500760563e-01   +2.303382073980820e-01   -2.332938477880185e-01   -1.980695443453202e-01   -3.412113227201834e-01];
L2E_L3E_iAMPA_netcon = [+1.737282799689084e-01   -1.701146064956987e-01   -4.836500414467299e-02   -1.000130880128968e-01   +2.771326048924697e-01   +4.701410899520148e-02   -2.567381385055811e-01   -1.942750631088354e-01; -5.444550894718813e-01   -6.232177329050681e-02   +1.766903042911738e-02   -4.098796076717592e-01   -5.897714660379689e-01   -1.477103728504034e-01   -6.541980763082025e-02   +4.409143878588118e-02; +4.458518155638224e-01   -4.250140931424555e-01   +4.796273154828026e-01   -7.755382001621206e-02   -3.365934935541808e-01   -1.390200863521120e-01   +4.230257256650848e-01   +1.658939681460904e-01; -6.685186388210501e-03   +6.648289466400206e-01   -2.670273203484221e-01   +1.456831814883258e-01   +3.328902708102958e-01   +3.143209603112768e-01   +2.502063182472176e-01   -1.748026866660020e-01; -1.578159961050900e-01   +2.314522004730304e-01   +3.597477204578224e-01   +4.705331161081330e-02   +2.235463938475672e-01   +4.031822117819640e-01   +3.980568721423454e-02   -9.103610424296597e-02; -4.027948147353890e-01   +4.457413455060011e-01   +3.847035013037089e-01   +4.009395238605877e-01   -7.510099782246208e-01   +8.946577201550500e-02   +2.499491452480989e-01   +5.265640414709680e-01; -9.716727627026057e-04   -3.065245287445005e-01   -7.179711035265167e-01   -6.148714616817358e-01   +9.037318599786530e-01   -6.312023240004090e-01   +2.955037122361864e-01   -4.405585116657822e-01; +2.074997277746721e-02   -2.509666698513110e-01   -1.495893426646984e-01   -6.648342395129059e-01   +2.298482047777343e-01   +1.118991533464767e-01   -1.774770606038285e-01   -3.669460234365465e-01; +3.169844346547071e-02   -7.814694109352373e-02   -4.739131294519906e-01   +1.590438265889838e-01   +1.471671966127714e-02   +4.312429932793430e-01   -3.028853707903928e-01   -4.149123483199640e-01; -4.369213297741192e-01   -1.374646063946686e-01   -1.256043926088382e-01   +3.486628070696647e-01   -1.222393186809430e-01   -4.173986963392626e-02   -2.397396667307637e-01   -2.683007291225591e-01; +1.083558223690424e-01   -1.422355239647204e-01   -1.739958072379595e-01   +7.682676072788813e-02   +2.256528876803725e-01   +4.467902612707232e-01   -3.356412758003013e-01   +6.598495244137736e-01; +2.224422342097667e-01   +5.091622372671651e-01   -9.572744521767880e-02   -7.483422312681338e-01   -3.736962666373893e-01   -9.012784783618419e-01   +2.300017652005990e-01   +3.325949299012070e-01];
L2I_L3I_iGABA_netcon = [-1.296202008267265e-01   -2.818989041901052e-01   -9.054026876412766e-01   -3.568667233522857e-01   +3.320989257716986e-01   -5.195604323463203e-01   +2.687964050883509e-01   +6.651915603993038e-01; -7.332694463540588e-01   +3.334872502848437e-01   +6.189680502960946e-01   -3.965494464105851e-01   +3.575520134379877e-01   +5.803810529208089e-01   +4.727666522088170e-02   +1.584004949965479e-01; -5.282730510578804e-02   +2.324722265695794e-01   -4.410299252854943e-02   +7.471374495478550e-02   -1.244242551147777e-01   +1.343447686715261e-01   +1.980619970118818e-01   +6.262639958003839e-01; +3.350198225359462e-01   +5.393191074451079e-02   +1.810878847102997e-01   -2.026667336654539e-01   +5.272252752372624e-01   -5.097933273669394e-01   +8.069678072368418e-01   +5.095326185234297e-01; -8.314900435165241e-01   +3.293918554732562e-01   +5.226560565727484e-01   -1.615408307481362e-01   -3.778790516654228e-01   -1.033166300769494e-01   +5.336128913245468e-01   -3.000948515170911e-01; +3.864809489676187e-01   +3.347722508189082e-01   -4.072437357409733e-01   -8.308846864749670e-01   -1.126752040585337e-01   -3.298352127981768e-01   -2.280703582525714e-02   -3.799989586776986e-01; -3.707250186739592e-01   -2.076028710829294e-01   -3.598313022504261e-01   -6.392508239927153e-03   +2.942273966391743e-01   +2.662110806278244e-01   -3.471722486535814e-01   +2.402644560105151e-01; -3.638240205792596e-01   -3.175325420192097e-02   -2.571893669496799e-01   -5.596429744158834e-01   -3.089838581927296e-01   +4.636136124569452e-01   -1.367765586093521e-01   -4.743070776441503e-01; +4.853419433916955e-01   +3.049830133315156e-01   -1.851257415081908e-01   +7.631919842709897e-02   -4.681916888834251e-03   -1.901317027734024e-01   -7.844990386546102e-01   +2.585968580647512e-01; +3.519183211668864e-01   -3.352186753125923e-01   +4.271230803487220e-01   -4.675584390388529e-01   +1.651481828667098e-01   -1.705548996050557e-01   +1.696649251033717e-01   +4.164122119214897e-01; -4.517934258940786e-01   +3.983885780730498e-01   -3.910867970215738e-01   -6.019752860658604e-01   +9.754644891526887e-02   -3.082248598764565e-01   +1.073917057972681e-01   +2.028525927447419e-01; +4.391098709538903e-01   -1.651720877114409e-01   -3.827989326182395e-01   -5.978836223232729e-01   +4.265915046911305e-01   +9.501532739705726e-02   -1.973134608764567e-02   -9.140362900248035e-02];
L3I_L3E_iAMPA_netcon = [+4.056528132094238e-01   -8.084840253296518e-01   -4.668942957997515e-01   -6.516652364430523e-01   -5.602412399568935e-01   -4.134660804884720e-01   +6.824955959690383e-01   -1.304867355958814e-01   +3.391089251629361e-01   -2.878857817145763e-01   -1.728992871983731e-01   -1.545763616533738e-01; -1.775697316200869e-01   +2.415115105061566e-01   -7.806205651299334e-01   +1.850743600848707e-01   +1.837169728889228e-01   -1.337752490621328e-01   -3.893304483703617e-01   +6.922675066893499e-01   -3.778683153308418e-01   +6.368642307642508e-02   -3.007692089757427e-02   -4.146912863148732e-01; +1.398110145094763e-01   -4.017058409337597e-01   +3.228169277017759e-03   +2.129753215606212e-03   -9.186890281709847e-02   -1.051432174267646e-01   -3.779041066655687e-01   -8.077844831825393e-02   +1.982234529531740e-01   +3.207508005891476e-01   +7.226035109612053e-02   +5.020895849017714e-01; +6.893391910904628e-03   +2.832464866768421e-01   -4.522687831803962e-01   -4.241124246365548e-01   -6.719910900515248e-02   -1.715190420416882e-01   +2.574088272395073e-02   +6.158697279419736e-01   -6.342381413251250e-01   -3.560292013756143e-01   -3.348758330806091e-01   +7.387349351855736e-02; +3.167241433402562e-01   +6.813335108888240e-01   -2.339971029227440e-01   +5.982879113243176e-01   -2.387349508819619e-01   -3.658353601095272e-02   +5.463869189975988e-02   +1.906232548026602e-01   -7.172851869832880e-02   -3.177102251550810e-01   -7.139024179860740e-01   -5.171538549591582e-01; -3.348487340961103e-01   +5.203617319536273e-01   +1.855473559528849e-01   +7.057007311115118e-01   +1.729067671484867e-01   +1.707438515419083e-01   -1.198550154450306e-01   -2.122591904425939e-01   -6.087162086478939e-01   +2.367506744948109e-02   +3.973046921027871e-02   -1.664671310986083e-01; -4.893538428142086e-01   +1.945035685318314e-02   +1.211076975232992e-01   -9.431040657446177e-02   -7.973101581924109e-01   -7.161131466442320e-01   +5.962450547962420e-01   +7.736048614275709e-02   +5.541023791403699e-01   -2.386557004671991e-01   -3.513647521382113e-01   +1.542951449803408e-01; +3.129714666175888e-01   -4.553521585556803e-02   +8.119597921726264e-01   +1.903000668227330e-01   +4.303330425865907e-01   -7.420441777959140e-02   -1.327123579360635e-01   +1.038340339429828e-01   +3.619597903692419e-01   -1.988018794037527e-01   -2.450523114353595e-01   -3.310529227588257e-01; -1.945792285730603e-02   -1.818145078818997e-02   +1.435148522466207e-01   -3.273756940786023e-01   +5.808700740474075e-01   -3.381877982359004e-01   +7.955219045666637e-02   -4.527821692081200e-01   +2.790509471245900e-01   +1.628047505969919e-01   -5.676651337830989e-01   +1.434320467319322e-01; +3.127150123139558e-01   -4.416647715411851e-01   +9.113827054792256e-02   -2.366701295802415e-01   +5.082362960470106e-01   +7.972935805794203e-02   +6.742013555617599e-01   -2.175374995712731e-02   -1.443073112075266e-02   +1.068526145139421e-01   -6.002877858317484e-01   +1.717231513852705e-01; -5.812716756702198e-01   +1.491391579861476e-01   +8.004893010714248e-03   +5.454819819646421e-01   +3.178437996587220e-01   +1.492558247612722e-01   +6.580301067036740e-02   -2.830959150908622e-01   +1.848130510871649e-01   -1.019562832971918e-01   -8.754783398764391e-01   +1.467827559682624e-01; -2.397616526491643e-01   -4.484308844834911e-02   -5.156500388599103e-02   -9.900566001270644e-02   +7.023495966350657e-01   -9.022866778185487e-02   +4.219887871690008e-01   +6.697359359500362e-01   -5.796554995885017e-01   +4.058886867824414e-01   -4.349480769411015e-02   +1.320731864536148e-02];
L3E_L3I_iGABA_netcon = [+4.987580269016881e-01   +1.440971017504814e-02   +1.751792314636882e-01   -1.543483960623967e-01   -1.783873263546414e-01   -1.835423853659501e-01   +1.127943212451612e-01   -1.331665005745040e-01   +2.971182466207177e-01   -3.714651420460444e-01   -6.103196465396129e-01   -4.659654333309450e-01; -8.903737136108961e-01   +2.780105307270665e-01   -2.880173355513547e-01   -9.809651680802212e-02   -3.549569869160585e-02   -2.945748275684187e-01   -4.283301131288106e-01   -5.119415712273757e-01   -7.522648550329727e-01   +6.590740578968144e-01   -6.597560189048504e-01   -5.009505502257923e-01; -3.066529264641146e-01   +1.914680065310995e-01   +8.294384345992389e-02   -9.280703542876463e-02   -5.786790560720475e-01   -2.866238615907356e-01   +2.760800915185810e-01   -1.201309077210256e-01   -8.341755602997053e-01   -2.417228356388001e-01   -6.315346508297487e-02   +8.107683841837582e-02; +3.739638860016448e-01   -4.126078604527365e-01   -2.638692946859819e-01   +1.281555868340141e-01   +1.749846004691544e-01   +2.105425593306710e-01   -1.947427917897388e-01   -1.975636407335342e-01   +4.326854230060762e-01   +1.828042178831266e-01   +2.416778496869101e-01   +4.401750021914419e-01; -2.988076219546877e-01   +4.239312270227438e-01   -3.060558354642762e-01   +5.560621372449467e-01   +3.751121990447162e-01   -4.215496931875878e-01   +4.302092426715556e-01   +6.004774996840462e-02   -5.922571003044359e-02   +4.554171318492377e-01   -1.898494296246521e-01   -1.235941199643531e-01; +1.368585104069645e-01   -1.355120647767113e-01   +2.566574476796973e-01   -3.102464655633778e-01   -4.319284116832488e-01   +4.268073657134284e-01   -5.988422453179165e-02   -1.767736047580492e-01   +1.726645262085522e-01   +1.154402467873244e-01   +8.610450407375947e-02   -3.290748099889677e-01; -3.849757869168731e-02   +3.791759452190287e-02   +3.036383967429531e-01   +7.153573823124998e-01   +1.623627161915304e-02   +3.520983679601227e-01   +4.621856963239702e-01   -5.841197584809379e-01   +1.324299849570130e-01   -2.089863120081772e-01   +4.357967854843111e-01   +6.847121517631113e-01; -1.822639559150970e-01   -1.736611507041359e-01   -3.927871040206588e-01   -1.954553719920343e-01   +4.870297109315409e-01   -1.062749889490305e-01   -4.664915204520325e-01   +4.816044436445451e-01   +6.006693969141020e-01   -1.037850063300125e-01   +3.768378712441453e-02   -1.127605168790319e-01; -3.594490355524552e-02   +2.321846032298815e-02   -2.278714679063798e-02   -3.462579869579723e-01   -1.537068534616997e-01   +4.025250723589126e-01   -1.352490315696221e-01   +2.984114833857644e-01   +6.103371547625254e-02   -3.991579979207421e-02   -4.695574357520969e-01   +4.871311304039407e-01; +2.757027011165802e-01   -3.343407280360162e-02   +3.844834431626711e-01   +4.794601852571570e-02   +1.755177187632167e-01   -6.471950689601150e-02   +3.699176233225725e-01   -5.270045531839617e-01   +5.315512678873527e-01   -4.963046169994189e-01   -9.974773874230837e-02   -1.982642159008079e-01; -1.471629655169466e-01   -9.246471748391975e-02   +3.831663885525716e-01   +3.477753685471480e-02   -2.589555600230343e-01   +7.711888758102938e-01   -1.044137647369543e-01   -2.034301131609169e-01   -4.848554493535376e-01   +2.981112110485070e-01   -3.595919093257712e-01   +2.814393615418190e-02; -3.161000154033107e-01   -5.566499667123742e-01   +4.311700714362148e-01   -1.371316868628030e-01   +8.291100015850289e-03   -3.764715110701145e-03   +3.514298853872657e-01   +3.499838150113216e-02   -1.339844505609045e-01   +2.249195230889702e-01   +7.044267338038038e-01   -6.046250871966422e-02];
L2E_Input1_iAMPA_netcon = [+2.031934232595160e-01   -5.501145761427092e-01   +3.104901669351708e-01   -4.958440566553817e-01   -8.167402713608147e-01   +7.604160525185820e-01   +1.401566914972807e-01   +9.083739644817946e-01];
L2I_Input2_iAMPA_netcon = [+1.373659186689808e-01   +7.397312856874331e-01   +4.766914899720140e-02   +5.366662774752267e-01   -7.070405017246503e-01   -9.347680280852091e-01   +6.600747942029296e-02   +6.636079247349513e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
