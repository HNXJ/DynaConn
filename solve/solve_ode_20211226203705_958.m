function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.783040029568934e-02   +5.378314488559663e-02   -3.760101720426988e-01   +1.506786053088217e-01   +2.119632078083019e-01   +2.403653935697658e-01   +2.529745282489743e-02   -8.708316192080216e-02   -6.800257614603754e-02   +5.971467194622957e-01   -3.571140661588355e-02   +4.720707314237010e-01   +5.187899347556092e-02   +2.897424336737197e-01   -1.266902398126375e-01   -1.844074901502270e-01; -2.579747541457811e-02   -4.777130785330717e-01   -1.977608607434631e-01   -3.824814239272857e-01   +1.033871174371098e-01   -4.812529559701426e-02   +2.622681520101958e-01   +1.503996255109629e-02   +9.834858652713563e-02   -1.973157566171491e-02   -3.059025291020659e-01   -3.971633395378460e-01   -6.523871781553611e-02   -2.264556219181584e-01   +8.452188307873867e-02   -7.938095458817543e-02; -5.140662907270934e-02   -3.305041696483862e-01   +1.938119545749373e-01   -2.386220392032727e-01   +8.005593506901415e-03   -1.350658192904046e-01   -3.270601276191100e-01   +7.050996342038282e-02   +6.899192073612034e-02   +9.507281396120755e-02   +1.868213854105898e-01   -2.266408442418557e-01   -1.999385967758545e-01   -1.666151561721693e-01   -1.589830204951893e-01   +2.135644500534269e-01; -2.648488492336940e-02   +2.948765748677230e-01   -4.731375463692316e-02   -2.077489065212970e-02   +2.351814586371603e-01   +6.013580937042648e-02   -1.142117069164993e-01   -2.615900460296133e-01   +2.757694644170702e-01   +3.450805327240871e-01   +6.627719231649194e-02   +1.363202744695983e-02   +1.568278185963905e-01   +1.614800585849466e-01   -2.065009260136976e-01   -6.453590449979230e-03; -2.561263505248439e-01   +2.090787639454744e-01   +4.127745753411736e-01   -2.910320783935809e-01   +2.949136421393147e-01   -2.252384921141068e-01   +9.240705825363482e-02   -2.700919597321760e-01   -1.195123275842491e-01   +9.736214591117617e-02   -1.660961113864017e-01   +1.094313287510687e-01   -4.014745406902611e-01   -1.305493604963795e-02   +1.727334746354992e-02   +1.807975316382098e-01; -3.645420772429815e-01   -3.016539330086715e-02   +2.409635205093331e-01   +3.082264865612350e-02   -2.493793749341529e-01   -2.260628206349901e-01   -1.247485715112859e-01   +1.620686175587618e-01   +8.041246396509466e-03   -3.010267948821733e-01   +2.138384690885052e-01   -4.460270929805837e-01   -2.939164168016229e-01   -9.622562553932186e-02   -1.112916933890920e-01   +1.334784770510132e-01; -1.841196572744632e-01   -3.879475991548651e-01   +1.231507265632105e-01   +2.655658043460640e-01   -3.440392481627579e-01   +3.470415487092989e-01   +3.732868425633311e-01   -1.678116624097062e-01   +9.380975881777637e-02   -1.407859469081818e-01   +2.256664988930779e-01   +1.184951101144422e-01   +9.564323989758286e-02   +2.985317568806731e-02   +1.003311476378488e-01   +1.512748795791665e-01; +2.638122560388709e-02   -3.006903852527318e-02   -2.251049603516647e-01   -1.184790810688113e-01   +5.019707498565493e-04   +5.653535122691811e-02   +1.313325889643244e-01   +1.535697433428334e-01   +3.831559027591082e-01   -1.751428586301027e-01   -1.080626138689003e-01   -3.211710429886483e-02   +5.363170211579837e-02   -4.277808156372766e-01   +1.160007199662479e-01   +1.460370962902816e-01; -3.452126366768651e-01   -4.638508435716514e-02   +2.659633687179522e-01   +2.738955000200186e-01   -4.223942743773341e-02   -4.220273509047978e-01   +1.922853149990477e-01   +1.827864020384656e-01   -1.021351118988763e-01   +1.208004504313004e-01   +4.342033768700512e-02   +1.997263795556255e-01   +2.546629106245266e-02   +8.895973921884387e-02   +1.899289340065127e-01   -1.454035475155436e-01; +3.286438416476306e-01   -2.311100470870291e-01   +1.281719215416285e-01   -2.992164817680599e-01   +2.132724568620409e-01   -1.879172866310451e-02   -1.589489901916535e-01   -2.140709428716283e-01   +6.812569691087422e-02   +1.905635879871139e-02   -1.803551246027882e-01   +1.447126621003377e-01   -2.655268016412449e-01   -1.961736723402005e-01   -3.577467261167711e-02   -1.380283731878706e-01; +5.529315677016927e-02   +6.604069990227916e-02   +1.332177232675347e-02   -2.745916477026898e-03   -7.540725571935503e-02   +2.294878718341720e-01   -1.927876487397289e-01   +2.192921891795752e-01   +4.021124446746217e-02   +3.825478355645743e-01   +1.865875243213306e-01   +1.892238606254787e-03   -1.258654479204519e-01   +1.685942140344864e-01   +1.966577595978184e-01   -2.716313884771070e-01; -9.759526802524779e-02   +3.261932810469735e-01   -1.295335972015171e-03   +2.774450770135878e-01   -1.268504933412880e-01   +9.204098510549025e-02   +4.711549894393028e-01   -1.251558215878968e-01   +3.508426245508264e-01   -1.871460884375867e-01   -2.680964492301791e-01   -6.618310925246690e-02   -1.217043903755367e-01   -1.270135242271836e-01   +3.736039061029214e-02   -7.974067633306145e-02; -4.190448514292379e-02   -3.535532852469634e-01   -3.566062183039553e-01   -5.470241142525204e-02   +2.770856005444968e-01   +1.577979097402341e-01   -2.801046617730048e-01   +8.215771796457362e-02   +1.025822044056855e-01   +4.869571800166167e-01   -1.045010700585740e-01   -1.631789623688049e-01   -1.033470129526864e-01   +1.761816190943177e-01   -1.070935735212708e-01   -3.077249862124238e-01; +4.016274993792420e-01   +1.905731562990906e-01   -6.420027502594899e-02   +2.535957386668310e-01   +6.316820411066486e-02   +3.734672545697042e-01   +1.606702015355195e-01   -2.525378453356170e-01   -5.237139868913165e-01   +5.234706679869006e-02   +2.133919548335647e-01   +2.701892542826536e-01   -7.818827285881308e-02   -8.216900724858017e-02   -2.060337929462969e-01   +4.014354664491726e-02; -2.829923897743835e-01   -3.893429078992579e-02   -1.124587466625414e-01   -2.353943834654121e-01   -1.856224657964331e-01   -1.925689943464949e-01   -2.259253613573827e-01   +8.690542902676002e-02   +2.806793942492385e-01   -7.710599309627401e-02   +5.614992835670799e-02   -1.449146622957943e-01   +1.525957139325367e-01   -4.050015070931515e-01   +2.217318018135237e-01   -1.809785718107776e-01; +1.725850903543267e-01   -5.575674805057457e-02   -3.499886525462277e-02   +4.147821758779899e-01   -2.092497511019999e-01   -2.022790713304756e-01   +1.365979428765088e-01   -4.518773096835604e-01   -2.344935395627638e-01   +1.394854113795291e-01   -5.623941899421012e-02   +3.164720801687270e-01   +2.926208190525203e-01   +2.099599777342506e-01   +1.167724843302913e-01   +1.356676988950525e-02];
L1E_L1I_iGABA_netcon = [-3.946365262933280e-02   -1.463906942441458e-02   +2.307971826792494e-01   -1.340761345944678e-01   -3.509159007830306e-01   -3.649407871433859e-01   +8.850543133029257e-02   -1.141531102827289e-01   +4.061170531595387e-02   -1.112876840058951e-01   -2.838042847281194e-01   -2.851497973929219e-02   -3.325128471986813e-01   -3.964598836860067e-03   +3.660070277310329e-01   -7.039936217082263e-02; -3.868852814246452e-01   -1.175199675321613e-01   -1.367100510147794e-02   +1.374239238322655e-02   +3.087477947708380e-01   +8.816614832128956e-02   +5.067130108064340e-01   +1.755696477638212e-01   +4.603338738265739e-04   +3.005533591531274e-02   -2.730977940821376e-02   -9.386443343837741e-02   -3.977093493829004e-02   +1.891722064020939e-01   +3.074159578151754e-01   +1.767135391428035e-01; -1.821491272758125e-01   -2.252522989228882e-02   +1.061700883642631e-01   +9.368932142999785e-02   -1.070254712302032e-01   +1.193793244785338e-01   -3.339073394399099e-01   -4.523286760841977e-01   -1.652981720591689e-01   +1.550296375848312e-01   -1.645717367233744e-01   +6.867568744204544e-02   +1.580847099682577e-01   +4.602566830371585e-02   -4.077276964367046e-01   -4.138658131799859e-01; +2.237350184495300e-02   +3.420394348474994e-02   -5.527542619355730e-04   -5.451651654914347e-01   -2.810170898532678e-02   -1.714028702018884e-01   -2.060960749664912e-01   -2.960102222131244e-01   -3.487008078216924e-02   -1.690165447591398e-02   -1.587262975167917e-01   +9.562283608553086e-02   -1.470865835904754e-01   -3.391103778061626e-01   -2.264158458262925e-01   +2.895882240379691e-02; +1.442355527834842e-01   -6.778450364358410e-02   -2.768177653233315e-01   +2.247532000075651e-01   -8.422155379885635e-02   +1.863364976332438e-02   -3.193756303780212e-01   +3.337935599460325e-01   +2.288266901114621e-01   +2.128515714331698e-01   +1.924036227902338e-01   +1.585337208431353e-01   -1.456933666363368e-01   +2.440722897324951e-01   -1.044843627196034e-01   -1.907275704319695e-01; -4.327384955458877e-01   +7.998880252925170e-02   -1.842997947493941e-01   +6.145905753500366e-02   -3.451802011295071e-01   +3.876006341136384e-03   -5.387302516218606e-03   -6.802104918607751e-02   -1.316771762424238e-01   -6.641567183168981e-02   -2.686855163999114e-01   -1.137333411620106e-01   +3.344108977486263e-01   +1.753510528650888e-02   +2.460014276939703e-01   -2.236826081088802e-01; +3.380145559310961e-01   +2.464990721388431e-01   +7.442376882287649e-02   +8.028139668913525e-03   -6.368385115996930e-02   +3.510345580593878e-01   +2.774354190659575e-01   +2.158974051183173e-01   -8.633658879539657e-02   +5.330851128452245e-02   +3.812749989133111e-01   +4.887122346486648e-02   -4.825143558394354e-02   -2.444539601421620e-01   +1.452012394187584e-02   +1.128999256938448e-01; -7.368558967905708e-02   +2.232774826927813e-01   -4.305751022415376e-02   -1.977003284653037e-01   -1.766994198790250e-01   -2.102589406156309e-01   -2.996368352747945e-01   +3.337478167104274e-01   +2.821844701826735e-01   +2.527210235863390e-01   +2.820873800728070e-01   +1.587473399988419e-01   +1.001993820111919e-01   -1.863209268508452e-01   -1.676355921647686e-01   +5.211941630789829e-02; +8.505158501237287e-02   -3.792451145234296e-01   -4.117000904581053e-02   +2.203738496785526e-01   +2.612822798381130e-01   +2.808729434951156e-01   -1.095859495265402e-01   -3.517284879071488e-01   -2.241923770345083e-01   +2.322037528675895e-01   +1.706951584014202e-02   +2.413235440596550e-01   +2.528626123070798e-01   -1.049713293132907e-01   -4.388441209766167e-02   +1.415723448085804e-01; +1.789735053187483e-01   +1.567552220014012e-01   +3.455629182303518e-01   -3.831043665211009e-01   +1.441717921980690e-01   +8.913498509210545e-02   -5.206073227782076e-02   +2.991104894378150e-01   -2.027219973117018e-02   -5.527660302315271e-02   -6.571490674789314e-02   -4.560807845937358e-02   +1.292454488872701e-02   +1.666324725007350e-01   -3.900283907044348e-01   -2.843718733235145e-02; -9.176933451214134e-02   -3.407114574942275e-01   +1.461463609102705e-01   +3.190417300467040e-02   +3.706054772898991e-01   +1.018961859577931e-01   +4.630657612608235e-02   -4.557192381080005e-02   +2.532444893775637e-01   -1.809441789063157e-01   +2.316952068397006e-01   +1.319826374878857e-01   -1.036300991760467e-01   -1.799938327790601e-01   +2.109430968994117e-01   -6.894514730288562e-02; -1.504666432516192e-01   -1.664304168173679e-01   -1.969983888023152e-01   -1.749416365616283e-01   -4.354676134360259e-01   +1.938121748685805e-01   -2.050349839752493e-01   +1.007352297148241e-01   +9.954073255475548e-02   +1.300913748444749e-01   -5.322892935982443e-02   -2.599286141785220e-01   -1.275473775764370e-01   -1.937552747678430e-01   +2.256981343863387e-03   +3.412232612090137e-02; -3.136153413938514e-01   +1.559453496865682e-01   -6.657763411194895e-03   -8.028017501968814e-02   +2.284865071664982e-01   +1.780051086189889e-01   +1.746701676005604e-01   -3.981434459313045e-01   +2.998743477325754e-01   +7.058989323006495e-02   +1.485001247872259e-01   +1.465091518419961e-01   -6.805519746734784e-02   -2.786155174313286e-01   +3.363029094719718e-01   +7.373180529080439e-03; -2.488570404092664e-01   -2.074891429510169e-01   +2.425937293948447e-01   -2.692056057698737e-01   +4.304812314981911e-01   -3.150911609624962e-02   +1.741613327748870e-01   +2.729479841358935e-01   -1.575586357637895e-01   +9.535838690843326e-02   +4.913026020704153e-02   -3.977503465512136e-01   +8.692790226129306e-02   +2.583664555409126e-01   -4.257097731839961e-02   +4.080381437012062e-01; -2.878172227318637e-02   -1.338935575338137e-01   -1.544166095532852e-01   -6.974934760571261e-03   -2.073332041840290e-01   +1.540424733573829e-01   +1.476100876650132e-01   -2.734510844280499e-01   +1.958503649066574e-01   -1.613671320156224e-01   -2.365345941259105e-01   +1.477334455502961e-02   +3.139623243174761e-02   -1.947143474066629e-01   +1.876622322291671e-01   -1.804312420930488e-01; -4.086333646901578e-01   +8.729954099649057e-02   +8.129185021701359e-02   +3.399238378875475e-01   +1.541106496828825e-01   +7.350125845560773e-03   +6.834603862335525e-02   -8.557590989627012e-02   +3.596280169010625e-03   -6.997279277136192e-02   -4.185641575721364e-01   +4.603861371334298e-01   -1.567627563183084e-01   -2.520879885908733e-01   +3.481089938885006e-01   -2.029637725600926e-01];
L2I_L1I_iGABA_netcon = [+6.092144928616328e-02   +4.447991048426642e-02   +1.378638312227342e-01   +2.459603845069940e-01   +1.710730359656670e-01   -4.284450559776706e-01   +2.312091389708253e-01   -1.511844127751910e-01; +1.593094504367566e-01   +2.037749392183782e-01   -9.271121029863057e-03   -2.826101763630671e-01   -1.404473761275632e-01   -1.376191861279458e-01   +2.487352605766738e-01   -1.676956349293292e-01; +9.016466932612585e-02   +1.855540361568845e-01   -4.302593843625210e-01   +3.626167041886519e-02   +1.621453203670127e-01   +1.880857598248790e-01   +3.307900737571128e-01   -3.497722449117844e-01; -1.583262398392137e-02   +1.961989139764606e-01   +1.387255159825495e-01   -4.613908935619352e-01   -4.076908750722565e-02   +3.346132253009861e-01   +1.814922449214232e-01   +3.152227689967382e-02; -4.318693085139880e-02   -8.570372367891946e-02   -2.983689322284963e-01   -4.951583791579443e-03   +6.345166386755167e-02   +1.644359569884840e-01   +1.911597327715879e-01   +1.694713256862553e-01; +3.417323145472013e-01   +6.012747779403891e-03   +4.222583040463332e-01   -1.360852907368371e-01   -1.361180052625923e-01   +6.973805292834784e-02   +1.097307360350215e-01   +1.412136475523556e-01; +3.012838897277452e-01   -7.039339504497708e-02   -4.820946652226218e-02   +1.236316314523046e-01   +8.014180884906721e-02   +2.738718894027189e-01   -2.164664600511244e-01   -3.237864586463062e-01; -8.087482065397547e-02   +1.524753696119233e-01   +1.616401579701279e-01   +1.340458972752008e-02   -2.623669257011157e-01   -7.755013399133315e-02   +3.017520782211760e-01   +1.435288605223469e-01; +3.728058296748688e-01   +6.828081709532197e-03   +3.794304857316790e-01   -8.960954445686019e-04   +2.367557856839381e-01   -5.982373478471409e-02   +2.697274905572648e-01   -1.143763768273307e-01; -9.902062083711310e-02   +6.226908790221294e-03   +2.010659239599156e-01   -8.182693273948952e-03   -3.981868874570796e-01   -1.260001369163420e-01   +1.637286948149695e-01   +3.760382887400078e-01; +4.655601218605179e-01   +4.278954926193906e-02   +2.295316929750982e-01   -4.430288806293571e-02   -8.741390355350875e-02   +3.343246267076953e-01   +1.468730333635948e-01   +2.762261941124091e-01; +1.076754601329079e-02   +4.945463845294339e-01   -6.905302164890605e-02   +1.885564621556783e-01   -5.229123442737511e-02   +1.633553618847891e-01   +4.075158110263575e-01   -1.103955964926173e-01; +3.336309833366923e-01   +7.692750716184185e-02   -3.571848032030536e-02   -2.849285996217432e-01   +5.766856088778264e-02   +2.026767897664193e-01   -7.104460545028929e-02   -1.822597432943077e-01; +2.392859362703142e-01   -3.588780776339042e-01   -3.369449469350786e-01   -3.832684144488809e-02   -4.114368284936285e-01   -4.782066279265315e-01   -3.175811283822105e-01   -3.011075294823136e-01; +7.656041727561692e-02   -4.360146609016284e-01   +4.763424412146240e-02   +5.353659381471042e-01   +7.008969970323617e-03   -1.016462660114860e-01   +1.408306958609135e-01   -3.682314701900646e-01; -2.163670973446800e-01   +2.161209782727830e-01   -1.446020113197938e-01   -8.423872232349383e-02   -3.658166908203223e-02   +3.920952771536785e-02   +7.221995796756198e-02   -7.022544176032874e-02];
L1I_L2I_iGABA_netcon = [+2.706972316672568e-02   -3.595926897992056e-01   -1.799614462878368e-01   -1.917522724990451e-01   +3.249654422917222e-01   -2.364772430832712e-02   +2.083748116178384e-01   -9.382110546571165e-02   -1.416971079104347e-01   -1.218192691986405e-01   +1.864517800852257e-01   -3.264513066737755e-01   +8.826825905801255e-02   +2.031308774504236e-01   -5.954874658874723e-02   -1.955231825117577e-02; -3.203685594106064e-02   +1.345875454944542e-02   +1.558615355522848e-01   +2.387723705565314e-02   +1.222706739796591e-01   +2.691624334596968e-02   -1.320336087955635e-01   +3.994099620333548e-02   -1.592060536256928e-01   -1.968178047204522e-01   -4.202202153438195e-03   -1.702621921011780e-01   -7.899591466274448e-02   +1.037542636914566e-01   +2.304085333398094e-01   +3.195420320619258e-01; +6.832710535890316e-02   -2.204910692508378e-01   -2.129278439155196e-01   -3.164446863053510e-01   -1.351051763899387e-01   -1.153813549821529e-01   +1.934300854573160e-01   +1.410647270195171e-01   -1.253108200916132e-01   -4.257432750491878e-02   +1.599655756516369e-02   -6.268837447349948e-02   -1.858842592229466e-01   +1.240650915043326e-01   +2.974325422589398e-01   +2.971047973105282e-01; +1.699867305057701e-01   -9.383332552738152e-02   +3.848468749096222e-01   -1.539577450145322e-01   -2.100396384914431e-01   -6.370876846763733e-02   +2.124592202436354e-02   +1.281660730103676e-01   +1.541754519639701e-01   +2.456437165943073e-02   +5.414729785705806e-03   +1.108005906910436e-01   -1.890060272181874e-01   +4.867724118837524e-02   +2.212752201277196e-01   -2.469875630112442e-01; +4.539442109310707e-01   -1.903914320670554e-01   +3.077423902837063e-01   +3.020872521681482e-01   -1.669317367773234e-01   -7.396649749531527e-02   -1.199607410339908e-01   -1.290279830835046e-02   -2.607693977410186e-01   -2.874514885643105e-01   +1.370277387359864e-01   +7.479528948760232e-02   -3.451281324993476e-01   -4.561411387942569e-01   -3.649926891905479e-01   +1.709057151950758e-01; -3.504012957248138e-01   +4.428479717787565e-01   -3.403154821260859e-01   +2.140122643878282e-01   -3.312051173535491e-02   -1.760995230500744e-01   -9.767277336511200e-02   +1.823897681048964e-01   -9.700298921281819e-02   +9.487023830918642e-02   -1.903916155851135e-02   +2.242371277982969e-01   -2.228162946851849e-01   -3.524258422190586e-01   -1.836147111093487e-01   +1.203838695885777e-01; -3.502043149595727e-01   -4.713340283718927e-02   -1.617515216699490e-01   +3.219579174716337e-01   -2.381137505870405e-01   -1.020065904412311e-01   -9.120636239248683e-02   +7.626235104483786e-02   -2.603456135607027e-01   +2.733684139480418e-01   +3.998667244522033e-02   +2.392094945376794e-01   +1.729972415977854e-01   -3.211605436726660e-01   +3.524674443689091e-02   -2.451465754122771e-01; -9.657002290033553e-02   -5.069763984134812e-01   -3.217940317985569e-01   +3.207007123332927e-01   -2.485325880963147e-01   -1.806181840766369e-01   +1.083418368908854e-01   +2.675328076297951e-02   +1.743878107005795e-01   +1.133009295608892e-01   +1.677148963005677e-01   +1.353641015194269e-01   +9.096752187498168e-02   +1.220187741383668e-01   +3.372421193275200e-01   +9.382856524115291e-02];
L2E_L1E_iAMPA_netcon = [+2.993619076908277e-01   -1.684268274178408e-01   -3.601647078556671e-01   -3.030157436355870e-01   +7.282249434003663e-02   -2.542787739027151e-01   -3.011642841486720e-01   -1.609742986282151e-02; +1.022775746466413e-01   -1.032129084767180e-01   +9.133250506712973e-02   +2.861667790375333e-04   +8.118895101304036e-03   +2.239868761881034e-01   +7.363671590837720e-02   -4.486214465020225e-02; +8.350262541832214e-02   +2.407324838099079e-01   -1.236922962987500e-01   +2.979243983498492e-01   +1.364107036179997e-01   -5.486110048593859e-02   -1.972363355097101e-01   +3.533194745987928e-02; -2.878390319915782e-01   +1.941924931063325e-01   -2.601377374344307e-01   +1.257949574436393e-01   +2.035734211594390e-01   -4.221279816182091e-01   +1.747383755809256e-02   +3.034653694506048e-02; -1.690424642850050e-02   +7.259343029063101e-02   -1.481457535436088e-01   -1.745769074572255e-01   -2.642780576408889e-01   +2.203189394316796e-01   +2.691683551575825e-02   -2.447727330534239e-02; -1.476130704462102e-01   +1.709791824648811e-01   +1.595867433030435e-01   -8.267097722255798e-02   +1.480898810294680e-01   +3.515863430217170e-01   +1.351466720829819e-01   -1.744820216245911e-01; +5.978362133456142e-02   +2.356522797522037e-01   -2.099718097327763e-01   -3.765465108242229e-01   -2.216182484508111e-02   +3.383153915831452e-02   -1.991098445470296e-01   +2.497380063572706e-01; +1.382651058883759e-01   -3.699803671513688e-01   +3.641806333666402e-01   -1.877698483340632e-01   +2.406381984973406e-02   -1.315562166043104e-01   +8.730049448773143e-02   +1.422693668806952e-01; -1.320568803016705e-01   +1.729277094201800e-02   -1.520585121512359e-01   -1.792273634730107e-01   -2.290663820361516e-01   +2.349706392923940e-01   -1.194538310636224e-02   -2.119622294782078e-01; -3.664806091765468e-02   -2.486070978448900e-01   +3.055397635521497e-01   -1.787866333230535e-01   +3.527917749106985e-01   +2.380159854508716e-01   +1.316804828779980e-02   +2.727730122458355e-01; +4.199060660326990e-01   -1.012808400646531e-01   +4.738619315097152e-02   -1.956267576718221e-02   +3.924790327798990e-01   -7.044567210297339e-02   +1.821453293458107e-01   -1.437879821934553e-01; +5.597975851937578e-01   -2.321434123543934e-01   +1.905621791670697e-01   +3.785427315914415e-02   +9.465487703985104e-02   -2.496341323072124e-01   +1.001040930024234e-02   +2.362870364445103e-01; -1.065418925575870e-02   -1.521827254024793e-01   +9.903578494877800e-02   -4.145674527903163e-01   +3.944913261488657e-01   -4.453148034876384e-02   -1.703109937627310e-01   -2.092656368663635e-01; -2.497721070347120e-01   -8.704664475479892e-02   -9.867550190648908e-02   -1.476131649071304e-01   +4.367572188260469e-01   +4.038345482851819e-02   +8.335618585350536e-02   -1.084658049612849e-01; -3.266390709698612e-01   -2.251254663460087e-01   +1.798517834905914e-01   +2.320860411519172e-02   -2.662134864830666e-01   -1.490388072908689e-01   -3.093155952892259e-01   +1.497504584126066e-01; -2.171640919243759e-01   -1.621310942414557e-01   -1.436684727836630e-01   +3.651059865045774e-01   +2.207416958501544e-02   +1.927610103737958e-01   +3.391421403766862e-01   +4.466630218519656e-02];
L1E_L2E_iAMPA_netcon = [-3.484964754301878e-03   -1.021196677149518e-01   +1.768416972687459e-01   +5.352747863983748e-02   +3.356350069394775e-01   -1.793037224895936e-01   -2.127355499651577e-01   +4.332487257434584e-03   +4.244538089885472e-01   -1.091257285987885e-01   +9.577996377355484e-02   -1.188387808523023e-01   +3.762849503160802e-01   -2.561260114444102e-01   +1.350561787410643e-01   +1.339411273514158e-01; -9.996302821508651e-02   -2.047712846875675e-01   +2.768409977245271e-01   -1.148360946324977e-01   +1.400607396475746e-01   +2.034349253164900e-01   +8.388640203737145e-02   +1.108637906443636e-01   +1.627077707857335e-01   +1.167222241470689e-01   -2.214309332045016e-01   +6.154073480545195e-02   -3.420160928424773e-02   -2.117458079309753e-01   +2.127155474439065e-01   -1.920279378181855e-01; -6.487165499559364e-02   +1.378149302740101e-01   +5.319360838560501e-01   -1.376963415199588e-01   -5.773160527267518e-02   +2.415638123174155e-01   -7.129844452520873e-02   +2.197438338838557e-01   +3.937676961122949e-01   -1.557678933662678e-02   +1.492263046715160e-01   -2.419639413500322e-01   -1.845805089703954e-01   -4.980323107930912e-01   -7.968572519880368e-02   +1.968190504894246e-01; +3.273870222210008e-01   -9.506297820690801e-02   -1.589528097017180e-01   +2.392419865216368e-01   -1.647283639172591e-01   +2.820665435835031e-01   +2.112177596876159e-01   +1.632485919161940e-01   -3.025401405136404e-01   +3.906731336600715e-01   -2.328147668137499e-01   -2.369264323726332e-01   -3.595770730156216e-01   -4.585579703143371e-01   +4.755806132239784e-02   -1.369537229523255e-01; -1.100917495322679e-01   -1.851938210280172e-02   +2.090181143026575e-01   +3.605415820396973e-01   -1.300588211419690e-01   +2.863552107987632e-02   +1.887791276112855e-01   +2.328512476630732e-01   -1.995647646358453e-01   -2.502430199248068e-02   -3.388539380768806e-01   -1.267686811366769e-01   +2.419128628686557e-01   +7.116489769683315e-02   +2.019118321625652e-01   -3.588882503422616e-02; -4.101452217190085e-01   +3.726570571961415e-01   -4.085320679900446e-02   -4.982126944685525e-02   -1.541346948590088e-01   -2.404821657569808e-01   +9.669295457801129e-02   -2.570799302071045e-02   +2.715106968607585e-01   -3.490613072525350e-02   +5.337063186095915e-02   -1.519889824103372e-01   +1.502133390327057e-01   -6.297331779450827e-03   +1.646029720540988e-01   +3.000523498175977e-01; -3.844882787784732e-01   -3.234930948317592e-01   -2.314029556261606e-01   -1.027726608189947e-01   +3.623207230297799e-01   -8.134365749713349e-02   -2.946872961830820e-01   -3.776477084036779e-02   +1.873050257340136e-01   +3.232839554726036e-02   -8.805132098450894e-03   -3.886980402391832e-01   +3.023496721392812e-01   +1.313809472061520e-01   -3.609859070821198e-01   -1.588062425099423e-01; -1.527840790013103e-01   -3.918493415613072e-01   -2.320677931632486e-01   -1.094177426699958e-01   +1.747364894857474e-01   -1.872863150311729e-01   +6.465692646792381e-02   -3.331359977755075e-02   +2.876817184627187e-02   -1.434962342252607e-01   -3.687520485561565e-01   -3.497127106502159e-01   -2.492443769094158e-01   -5.997468603736032e-02   -1.628111154743603e-02   -3.708224545298761e-02];
L2I_L2E_iAMPA_netcon = [-2.265642918846392e-01   -2.262189767012791e-01   +2.167771230460726e-01   -6.008134459618464e-01   +1.989411127951648e-01   +2.049731494429833e-01   +1.734202547979926e-01   +1.591759704761643e-02; +8.605749376126132e-02   -1.840409109234177e-01   +3.136905560261991e-02   +8.432191837192732e-02   -1.799697196839191e-01   +4.485552565435744e-02   -2.497346436181560e-01   -3.941118006790358e-01; -8.191873936539049e-02   -1.868860873149261e-01   -4.226766389300748e-01   +1.437538799396617e-01   -8.517548013902010e-02   -4.546927806878753e-02   -2.381843740192569e-02   +1.192628606900658e-01; -3.163473013085765e-01   -1.273067942458424e-01   -7.725302563705276e-02   -1.078275954465602e-01   +3.613914467269552e-01   +1.500948532475876e-01   -3.499869363850759e-01   -1.160082571235304e-01; +1.854657110300083e-01   +4.814737566139251e-02   +2.519887490775587e-01   +2.319887473646680e-01   +7.293498693564393e-02   -1.006000131572364e-01   +4.873694932121736e-01   -4.304416645364689e-02; +1.189070801273378e-01   -7.772216707344115e-02   +2.183089912521438e-01   -2.377514665098351e-01   -1.006267697204789e-01   +8.596317741041082e-03   +2.761262771017131e-01   +2.470855037248606e-01; +2.274277606202235e-01   +4.744466746708553e-02   -3.191054168010665e-02   +2.977638535121168e-01   -6.897258522521574e-02   +1.080577239118909e-01   +2.589049650176935e-01   -1.059594726249406e-01; -4.825247471220162e-01   +2.101929280568644e-01   +4.092422523130431e-01   +1.453547529571684e-01   -2.451224524706270e-01   +4.141426911475349e-02   +9.616161428323564e-02   +1.392389420275902e-02];
L2E_L2I_iGABA_netcon = [-4.794794243534825e-02   +2.613023045916485e-01   -1.379471105685566e-01   -2.079996705462514e-02   +4.796718714640475e-01   +9.105112236113522e-02   -1.266608825841696e-02   +4.033150658551115e-01; -5.944008984093363e-03   -2.333083718214320e-02   +1.913217987736346e-01   -1.600474940373875e-01   +1.230510030608495e-01   -2.794619760598601e-01   -4.616239012844693e-02   +1.829416379430318e-01; +4.604788928678091e-03   -7.477261884230883e-02   +5.819427386331688e-02   -7.806970143279385e-03   +3.451553473737958e-01   -2.722468641362251e-01   -3.038673107747206e-01   +2.260836121947064e-01; +1.456964284130635e-01   -2.378793685160490e-01   -7.404259390765955e-02   +6.451304678879860e-03   +2.147877353629628e-01   -1.913176140803607e-01   +2.037929027567371e-01   -3.465744381037336e-01; -1.712915737962997e-01   -3.915832342653242e-01   +9.990487833425729e-02   +2.658202145001889e-01   -1.442276659953720e-02   -1.222247891879178e-02   -3.133843873557329e-01   +3.379453390907288e-01; +1.209700234280343e-01   +3.153657056936459e-01   -2.366284636298233e-03   -4.310336846390791e-01   +1.152810945032749e-01   -2.532467279249791e-01   +1.367684999711097e-02   +1.429457508349554e-01; -3.530575050539155e-01   +5.605613075025784e-01   +5.809899095209392e-01   +2.593047836664532e-01   -6.917114426069226e-02   +9.242566294622792e-02   -2.397231981750571e-02   -4.079410735990679e-01; +1.293229814276066e-01   -5.124485242194874e-01   +1.012610852611401e-01   +8.028631091348860e-02   +2.148563814055391e-01   -9.846736966685338e-02   -1.769417916387999e-01   +4.060284076279794e-02];
L3E_L2E_iAMPA_netcon = [-3.294189787283111e-01   +1.459833488678920e-01   +1.094596600474480e-01   -1.708884292573061e-01   +3.975138129330262e-01   -1.027199784788900e-01   +4.897361446911802e-04   -1.339364013775263e-02   +1.281015504523099e-01   +1.428289854690470e-01   -3.396354498756987e-02   +1.026185552151841e-01; +5.244051366477918e-02   +2.320913616339511e-01   +6.081428031703112e-03   +2.213430881150490e-01   -1.337281016879429e-01   -3.069912484542582e-01   -1.411773628736985e-01   -3.512006950979585e-01   +7.492544279388758e-02   -1.243678251390148e-01   -1.033849407912938e-01   +1.903813291180129e-02; +1.528108096441738e-01   +3.590338288104199e-01   -2.783364713539200e-01   -2.008256237748873e-01   -1.304430411571962e-01   -1.030636134457211e-01   +4.187011165082923e-02   -8.205493058665703e-02   -2.419580335209440e-01   -7.642844310543330e-02   -1.100366392805576e-01   +4.492941760611736e-02; -3.780312386989144e-01   -1.311144739918248e-01   +5.240457083017522e-01   -3.985547057695787e-02   +2.564415792536797e-01   -2.714297828826889e-01   -3.083388211705552e-02   +2.511664552229303e-02   -1.290539950896666e-01   +3.821361681287883e-01   -8.935579403025831e-02   -2.795879838880025e-01; -2.582407207103828e-01   -4.692504665968666e-01   +1.037690781097940e-01   +2.870709501604084e-01   +2.090634997043820e-01   +2.518597478800152e-01   +3.546723986551060e-01   +2.775769508045215e-01   +1.360119201455547e-01   -8.706012093920075e-02   -2.252664604812154e-01   +4.557710193803198e-01; +2.108715100078851e-01   -1.792095869815154e-01   +2.197528852479565e-01   +1.347852974195678e-01   -1.642546623679128e-01   +1.985193640014020e-02   +4.741899037636814e-02   -1.955202333007691e-01   +6.291019087890366e-02   -2.314374391466534e-03   +9.684382671665051e-02   -1.792660259522084e-01; -1.460551809094743e-01   -4.373508453873560e-01   -1.989860051777551e-01   +6.723151354151713e-02   +6.477086710845871e-02   -2.535560155734794e-02   -6.018119222546847e-02   -1.042491020388428e-01   -1.617619754352645e-01   -5.350375938711579e-02   -2.757123276773057e-01   -1.619927809335631e-01; -1.022358926886124e-01   -3.377788040539600e-01   +1.890674679881071e-01   -2.828497066234417e-01   -2.532160465015110e-02   +2.448467355382121e-01   -3.885497290449124e-01   +1.612189417439175e-01   -3.905847398474487e-01   +3.162654874475675e-01   -3.348195823983257e-01   +3.481109839267670e-01];
L3I_L2I_iGABA_netcon = [+6.220146136375231e-02   +3.422512547030256e-01   +3.629113864709999e-02   +2.521238522322115e-01   +6.325309248280515e-02   -3.487760391490221e-01   +3.853925682230618e-01   -7.142101229726805e-03   -1.456492587077334e-01   +1.817068894324962e-01   +1.131146139983798e-02   +1.819424526264066e-01; -8.957869393010635e-02   +1.275075288614158e-01   -4.277404798075329e-01   -1.514289563706840e-01   -1.186435110230664e-01   -2.231857125468504e-01   +2.201456018737502e-01   +2.556552633715926e-01   -3.482948476518022e-02   +4.352319075648757e-02   -7.757439565519217e-02   +3.427323887061900e-01; -3.321192930382466e-01   -1.730716444080431e-01   -3.879239815290779e-03   -1.426909855754305e-01   -2.437649900228674e-01   -9.941992619342252e-02   -4.150589840248752e-01   -3.259182911663401e-01   -4.791794932956371e-01   -1.083941114657093e-01   +2.303393727949987e-02   -1.090623317612752e-01; -2.809119023620726e-03   -2.272314098915915e-01   +1.435949771923408e-01   +3.493210148400894e-01   -1.085576812003575e-01   +1.531548936043190e-01   -1.297444537476151e-01   +2.362114498510567e-02   +8.983066310115487e-02   -1.743705759278496e-01   -4.931992975080093e-01   -3.176035543865641e-01; -1.664336525451837e-01   +3.698673545747321e-01   -4.596080311106435e-01   +1.907379926361659e-01   -1.223538377948209e-01   -3.558839373256349e-01   -3.873205311920863e-01   +1.512441122267583e-01   +2.864134342423635e-03   +1.496467663294923e-01   -2.628157099145433e-01   +1.015231995752097e-04; -3.200955695883737e-01   +3.324523190244856e-01   +2.614874513057081e-01   +6.814253049735519e-02   -1.059337961418350e-01   -1.040104922672283e-01   +2.025058467401357e-01   -1.996592293556200e-02   +9.008695340236304e-02   -1.494157898802161e-01   -1.479675510909028e-01   +3.929361557154854e-02; +1.092890434499496e-01   +2.905146108147713e-01   -3.132238101990662e-01   -4.216145500318764e-01   -3.616131515026285e-01   +2.018843052934625e-01   -9.529924672130421e-02   -4.045629418449436e-01   -4.731306728810049e-01   -1.210383866445811e-01   -1.300472386756152e-01   +2.095368818534689e-01; -2.762531515203636e-01   +8.638211975136038e-02   -1.250982820474673e-01   -4.248107466231855e-02   +2.905129371514497e-01   +4.922691036582903e-02   -2.680378156391607e-01   -1.271195728714813e-01   +2.787028695856804e-02   -3.249889225508019e-02   -2.762691585009913e-02   -2.369619501036486e-01];
L2E_L3E_iAMPA_netcon = [-1.264654856090783e-01   +8.999782507981538e-02   +4.970624756848431e-02   +3.176260310827365e-01   -1.941091243902111e-02   +2.376213022453776e-01   -4.919325640290344e-01   -2.682903748592953e-01; -1.108532152796452e-01   -3.586642781220588e-01   +6.444219058464626e-02   -7.532541681564961e-02   +1.502709968830176e-01   +4.456409608344156e-02   -8.486622433081617e-02   +9.283880772013245e-02; +3.219076491167162e-02   -3.332819263892509e-01   -1.331615479868361e-01   -2.362383754632363e-01   +1.023074191329784e-01   +3.177967573549517e-01   -3.118125087925659e-01   +8.723903615658116e-02; +2.946951683651821e-01   -4.131329970129344e-02   -2.194412469243069e-01   -2.554605367019097e-01   +1.487406151465044e-01   +1.364987385057687e-01   +7.439127732839515e-03   -3.879208384869692e-01; +4.262639717266572e-01   +1.871115955452659e-01   +5.671432188251113e-02   -3.625831163877250e-01   -3.805245331838907e-01   -2.696645540469199e-01   -5.278891484303753e-02   -4.052430063748008e-01; +1.037066377080398e-03   +1.083889206350339e-01   -3.422958926545868e-01   -6.296945741841892e-03   -2.491374632583448e-01   +3.788899546739044e-02   -3.798476295286094e-01   +3.081887897962255e-01; +4.321771175396105e-02   -1.815241100603063e-01   -1.145850712255349e-01   -3.227495573869112e-01   +1.192430117625055e-02   +1.280619285646911e-01   +5.658208212719844e-01   +8.851229507639224e-02; -7.953331650964705e-02   -1.255528952373690e-01   -2.997115648094333e-01   +9.752693266724211e-02   -4.721635480520308e-01   +1.030140148907940e-01   +2.406766415679811e-01   -2.364682173952251e-02; -2.444868221557965e-01   -1.381110430100594e-01   -4.603543160916843e-02   -1.529343994340203e-01   +3.208280602409911e-01   -1.656849076906794e-01   -3.961310090674916e-02   +1.900477309966715e-01; +3.002781400223984e-01   +1.675999551092940e-01   +7.886488993928556e-02   -2.039389024300680e-01   +6.457906744953734e-02   -1.693207085756949e-01   -1.026424551319629e-01   -2.481079044060270e-01; +1.136776687250239e-01   +1.467749615597292e-01   -2.008427719733344e-01   -2.350247146334274e-01   -8.368163323153424e-02   -1.261380784745600e-01   -2.689346673982657e-03   +1.040592744043321e-01; -1.280174355158080e-01   -1.980317259178280e-01   +3.170470958942359e-01   -3.147063376456637e-01   +1.504998443136697e-01   -2.736985553154129e-01   -2.386052597829049e-01   -1.600831413248774e-01];
L2I_L3I_iGABA_netcon = [-4.202099695205033e-03   -2.579222554121808e-01   -6.838055560371009e-03   +5.542823647729060e-02   -1.004364160309078e-01   +2.705025588670378e-01   +3.639479625790343e-01   -2.855662649800905e-02; +1.398043078406656e-01   +1.694011267037258e-01   -1.899305891396281e-01   +1.185344968236081e-01   -4.417364602375300e-02   +9.876601537239199e-02   -1.826031751175666e-03   +6.240171657052844e-02; +9.901210392520873e-02   +1.428617394981602e-01   +3.064057912931418e-01   +2.197371511180649e-01   -1.079674432227465e-01   +1.001111516390612e-01   +2.326799583633693e-01   -9.536925482528230e-02; -1.890956932659078e-01   -3.967618500124964e-02   +2.357671400422729e-01   +3.108933382995871e-01   -4.492144376255029e-01   +1.219844955789999e-01   +3.351046037446080e-01   -1.975703130921378e-01; -1.102779413692765e-01   +2.082763294514795e-01   +4.644866967407927e-01   +1.849186927460096e-01   -7.683959026964199e-03   -3.651910830048586e-02   +2.162113290534388e-01   +3.003116903097203e-01; +1.432816079060747e-01   -9.292785632536960e-02   +3.419101065919644e-01   -2.004143458466835e-01   +2.098256290166594e-02   +5.527548214897882e-02   +1.156799265738509e-02   +3.941776457439864e-01; +1.043805467709107e-01   -5.366984320437555e-02   +4.326817403894088e-01   +1.194737873304402e-02   -1.457348187135922e-01   +5.228127065511123e-03   +1.272686960265731e-01   +1.152748516855540e-03; -1.761596817670231e-01   -5.097148229672363e-02   +2.955211416014346e-01   -1.587993680652522e-01   +2.093530111725727e-01   -1.750783165845496e-01   +1.636149755908247e-01   -1.839789745370153e-01; -2.621314457536501e-01   +4.110444836724630e-01   +2.072227431266342e-01   +2.446116956679950e-01   +4.468864073989040e-01   +1.187222934470008e-01   +2.389196058955343e-01   +6.701279001382895e-02; +5.647393166270439e-02   +2.125062762778548e-01   -1.301445050426668e-01   -5.475522009751047e-02   -3.994088239176782e-01   +3.913508542759070e-02   +1.872802575273097e-02   -2.906471811012059e-01; -9.156468782376827e-02   -1.898004534218460e-01   +2.850940863353479e-01   +2.079557219107539e-01   +3.837864232713590e-01   -2.885282286247322e-01   -1.454422091709264e-01   -4.742590718002512e-02; +9.784610011530556e-02   +4.735571076328193e-02   +4.130337990748434e-02   -2.016886108491598e-01   +1.135844639510677e-01   +2.766152258728869e-01   +2.951371274518864e-01   -1.571108615492472e-01];
L3I_L3E_iAMPA_netcon = [-3.320696623859855e-01   -4.392752158684294e-01   +1.563023346119343e-01   +2.481498579198705e-01   -2.000107169090493e-03   +1.126946823371795e-01   +1.727651378080543e-01   +1.750574995226117e-01   +1.691274961523788e-02   +8.389532375646012e-02   -7.762195417091292e-03   +4.905025151236846e-01; +2.839041010231582e-01   -1.625683304317961e-01   -6.913283065720793e-02   -2.176041316013867e-01   +3.139786958395846e-01   -3.704091049822162e-01   -1.299756821837950e-01   -1.338672987814229e-01   +2.692461181258082e-01   -1.379736690940445e-01   +1.283282498640772e-01   -1.260798344304956e-01; -4.805993350528670e-02   +3.575366126075072e-01   -8.569120054868609e-02   +8.463823278396990e-02   +2.460179203611989e-01   +2.980626073963192e-01   +2.267692057455237e-02   -1.317226960271681e-01   +9.955333851036849e-02   -2.780965757072477e-01   -1.362424750733120e-01   -1.420365254475019e-01; +2.393296652584957e-01   -2.506918580797243e-01   +2.171586015188880e-03   +2.462038562560344e-01   +2.382465267463492e-01   -3.620870133089898e-03   +2.444856698831370e-01   +1.865882976451574e-01   -2.137337792733937e-01   +2.282258733586658e-01   +2.349528584703261e-01   -3.502048049292104e-01; -9.258736480098088e-02   -2.760571657703329e-01   -3.773543686808698e-01   +1.293878202751451e-01   +1.113878065032865e-01   -1.313846547605153e-01   -1.431119615710627e-01   -8.861710247761179e-02   -1.711581660875649e-01   +1.146824212848774e-01   -4.496204504452866e-02   +7.865364367775796e-02; -4.810111600866776e-01   -5.547725309798231e-02   +2.091894766811137e-02   -5.824298176093184e-02   +2.447084091157944e-01   -1.189117753002336e-01   +2.006187442521296e-01   +1.768776692587005e-01   +2.224006720394655e-02   +3.134851866828670e-01   -1.441581719825579e-01   -1.325931330258580e-01; -2.002449164467699e-01   +1.139561949248471e-01   -4.554835220158004e-01   +1.576631398470790e-01   -9.391627134794039e-02   +1.749810430656631e-01   +2.237566441261705e-01   -9.659191168013335e-02   +2.410496730659797e-01   -1.317709925480644e-01   +3.702317584071406e-01   +1.972191015066848e-01; -5.914642781275189e-02   -3.276540246242636e-01   -9.884416090839905e-02   +3.073081676572926e-01   +1.542464514757217e-01   +2.723813340960352e-01   +1.109132357470037e-01   +1.519774743749055e-01   +8.864478684371406e-02   -2.097904901613338e-01   +2.510128780342685e-02   +1.958774704764583e-01; +4.245779292912225e-01   -6.186970739126632e-02   +5.877868236725838e-02   -1.836347177809113e-01   +2.427979260718832e-01   -3.279340735655894e-01   -9.713341885797727e-02   +1.774511375359875e-01   -4.442103279749574e-02   -2.467579471115019e-01   +8.103419591390751e-02   -1.541842021254936e-01; +8.917353709023218e-02   -2.923161564635812e-01   +2.454836800141442e-01   -1.739476717702206e-02   -2.196389446056434e-01   -2.892664910678829e-01   -3.357219594826740e-01   +3.963844252518621e-01   -1.892392797408916e-01   -3.079859897587592e-01   +2.465335897952070e-02   +3.402483702498413e-01; -2.284182105774660e-02   -2.373871519680804e-01   -4.366625744792033e-02   -4.381783220052291e-01   +3.135809098958309e-01   -3.450387477119170e-01   +2.395101478354120e-02   -1.174498689345018e-01   -4.335600201107759e-01   -2.114919699719003e-02   +1.782063323611371e-01   -5.297236933119509e-02; +2.595047583601971e-01   -1.258520108232774e-01   +9.249047464996052e-02   +4.925835115675473e-02   +1.534925809638012e-01   -1.043584428384470e-01   -2.953859167874172e-01   +1.323653721836733e-01   -1.823282925666708e-01   +4.534854171146533e-01   -1.881914615026418e-01   -3.613412951073208e-02];
L3E_L3I_iGABA_netcon = [+1.546599622047395e-01   +2.698154159119464e-01   +2.094691439566036e-01   +6.230582572397431e-02   -7.485068614541342e-02   +1.352573280385052e-01   +5.048329017704393e-01   +7.245330204477933e-02   -5.110538062797261e-02   -1.443135227881490e-01   +3.128265389769282e-01   +3.834357428986740e-01; +1.004284207756402e-01   +1.546168324192400e-01   +2.221901362386933e-01   +2.281552093968410e-01   -4.256340009215794e-02   +2.234614326615806e-01   +5.649449774380892e-02   +8.006729149123899e-02   +1.798391664874124e-01   -3.310150782220201e-01   -1.273040682869968e-01   -2.372684847247182e-03; +1.467350778313331e-02   +3.396565484988160e-01   -4.354640164960712e-03   +2.124071833707890e-01   +3.113610502241844e-01   +2.652732377681987e-01   -1.558058423845397e-01   -2.248686301206741e-01   -1.440857342322723e-02   -1.331955452671213e-02   +1.306118206716455e-01   -1.889553801141844e-01; +1.429191290091775e-01   -3.198366875962234e-02   +1.317869631391482e-01   +4.348588944894027e-02   +8.630680255610101e-02   -2.583970212373346e-02   -2.545683917532267e-01   -6.385856748693197e-02   -2.537832456721942e-01   +1.350123013203176e-01   -2.989034896336125e-01   -4.022810136866362e-01; -5.131614418283497e-01   -1.442103826237150e-01   +9.913242239299798e-02   -7.911923163831289e-02   -4.177500482599925e-02   -6.804048685022071e-02   +1.335149312805794e-01   -5.214533429080548e-02   +3.301349119965061e-02   -3.157638759342843e-01   -2.134932416802821e-01   -1.551044420837941e-01; +1.067546702523605e-01   -1.893543154684387e-01   +1.144360281508150e-01   +1.671410279500731e-01   +1.647637060403201e-01   +2.126997998944349e-01   -2.589791347376168e-02   -2.455364847794271e-01   -1.181335113347742e-01   -8.268860791818702e-02   +6.378340264269176e-02   +2.906850494743989e-01; +6.940773181512312e-02   -3.204008347344348e-02   +3.668145432055093e-02   +2.720527360165080e-01   -1.919956187092435e-01   +2.304145117103997e-01   -2.817957154413737e-01   +2.897712986839219e-01   +2.880130664309407e-01   +3.344407331354691e-01   +1.557638420700903e-01   +9.949174472123631e-02; -2.603240179201216e-01   -3.325511053981363e-01   +3.999611679492534e-02   -4.894561600647893e-02   +4.147015298415618e-02   -2.908930438857464e-01   -5.165829180083376e-02   -1.392713342711631e-01   -2.606497867124290e-01   +1.474571611444648e-01   -3.773716729591635e-01   +3.652751037830291e-01; -1.198756867715237e-01   -1.948508093804728e-01   -2.325714018160820e-01   -1.048393750058012e-02   -1.929737405886374e-01   +1.855506334837892e-01   -2.119778965799610e-01   +1.281810670300633e-01   +2.176149845311400e-01   +1.716980433255163e-01   -1.791411959156677e-01   -6.508579945352110e-02; +1.338232562248923e-01   -1.685967441713077e-02   -1.386150055861280e-01   +4.348488095529546e-02   -2.495798839243625e-02   -2.165245985171022e-01   +8.726113940954983e-02   -5.961248188210623e-02   +2.643142694841785e-01   +2.883384060664507e-01   +1.370281341138173e-01   -1.625263159912651e-01; +2.442964244000035e-01   +8.598379399321131e-02   +8.634419065351524e-02   -7.198995995889017e-02   +2.084658860875794e-01   -9.979587701709521e-02   +1.242961612239824e-01   -6.395717242507037e-02   -3.767273728094811e-02   -2.658604001211463e-01   +1.890924765112679e-01   -1.714741606465609e-01; -4.307236987816732e-02   -1.962865597035180e-01   -7.983381895222205e-02   +1.604067918497536e-01   -1.605181791562563e-01   +1.039060007201717e-01   +1.890480565290723e-01   -3.244091146546174e-01   -2.400540558519901e-01   -1.695802000881272e-02   -9.231520040731207e-02   -3.475005084844223e-01];
L2E_Input1_iAMPA_netcon = [-2.472767733822310e-01   -6.154422461091826e-02   -2.228169769339305e-01   -3.946310474213672e-01   +2.783532322069553e-01   +7.057612823819101e-02   -9.047287980852818e-02   +2.033676471091148e-01];
L2I_Input2_iAMPA_netcon = [-2.705957508753428e-01   +1.746148337671195e-02   -9.596987692650566e-02   -1.215003289059225e-01   +4.596789760528166e-01   +2.426711990554414e-02   +1.379020760187848e-01   -8.274700206461599e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
