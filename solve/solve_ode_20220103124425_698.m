function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.527878110014742e-01   +7.874039435040945e-01   +9.463883654188169e-01   +2.067155844459753e-01   +2.170988915330788e-01   +7.563938615152714e-01   -2.224310597146612e-02   +4.405331754076495e-01   +3.447331119149860e-01   +2.373541858948179e-01   +3.805663045255682e-01   +1.735434419144483e-01   +5.087973540381667e-01   +2.764409063916184e-01   +2.548829245086999e-01   +3.113643617475910e-02; +1.233613769741985e-01   +9.856058195583538e-01   +8.828076641544276e-01   +7.681324332357159e-01   +3.507453482254628e-01   +7.311218891536310e-01   +7.373534602467114e-01   +1.422321786538701e-01   +7.186672827738196e-02   +7.618783781299687e-01   +5.888443174877901e-01   +6.742666276874814e-01   +5.275622216108705e-01   +2.796022684687305e-01   +7.132430401697353e-01   +2.898084070853937e-01; +2.930973350488263e-01   +3.500817035145995e-01   +3.896494325811136e-01   +5.998942369377004e-01   +5.388574984078573e-01   +4.517370498280580e-01   +5.729392600172580e-02   +7.020462993451221e-01   +3.658292463012346e-01   +5.222282622924279e-01   +9.030630865321450e-01   +2.365637313098602e-01   +5.009357187670403e-01   -6.425495944691317e-03   +4.087970507722773e-01   +9.559947527758689e-01; +2.459837378306844e-01   +6.120066648210406e-01   +1.042158159483082e-01   +2.459082809463037e-01   +9.439566831107687e-01   +8.501830353455350e-01   +2.394318427902239e-01   +6.031212015305119e-01   +7.432444687292724e-01   +2.739201485361171e-02   +2.163189760674081e-01   +8.853947549587389e-01   +5.784953741786458e-01   +1.757748395317083e-01   +6.640869683789707e-01   +4.587787743930063e-01; +7.795483572572436e-02   +7.614890903516667e-01   +9.041782623616841e-01   +8.284787506577721e-01   +5.432845484899078e-01   +3.452837998547260e-01   +4.684042092519584e-01   +2.262633585367871e-01   +3.005199007107753e-01   +5.337221304432782e-01   +2.281605630614718e-01   +6.165417004603931e-01   +3.891459464498626e-01   +8.353383290372773e-01   +2.183930835857796e-01   +9.234328550657110e-01; +1.136685431887595e-01   +2.216725572484840e-01   +8.097297612694855e-01   +8.059763130095157e-01   +6.633517851075682e-01   +9.000758905153160e-01   +3.414380887006445e-01   +3.958493760144327e-01   +8.490385099251484e-01   +8.959475692975785e-01   +8.793037329323857e-01   +2.140563281563375e-01   +3.804577192668318e-01   +1.417119394529739e-01   +9.123162226089059e-01   +3.612439817272119e-01; +3.011563974877299e-01   +7.988589410147250e-01   +5.657818668779965e-02   +3.878138978054289e-01   +8.984881940577555e-01   +5.715182591102642e-01   +4.831239912324840e-01   +6.211496913256925e-01   +8.911677895212873e-01   +9.602599683325325e-01   +7.079865140978723e-01   +5.532296067805673e-02   +3.900636496574548e-01   +3.928016612738650e-01   +7.072719543045424e-01   +9.174546697885330e-01; +7.006445779654723e-01   +7.718551827770481e-01   +7.831482101093324e-01   +3.604895915633428e-01   +6.390167895180625e-01   +4.690523328904075e-01   +4.488610411185619e-02   +3.851220731265291e-01   +1.000000000000000e+00   +9.022859338368142e-01   +3.456784231560012e-02   +7.495564114178084e-01   +8.656416186754449e-01   +5.933395295148157e-01   +2.924094481714871e-01   +8.808158395110084e-01; +5.341804746999329e-01   +6.488390962459656e-02   +2.912876377072926e-01   +3.976136472486975e-02   +5.140145789447345e-01   +1.073322948212455e-01   +1.092162625902106e-02   +5.972601247864032e-01   +5.003380754194666e-01   +8.272315771942034e-01   +7.763020239539065e-01   +5.630264505579723e-01   +3.739007758642154e-01   +2.038435817675537e-01   +9.886823799025091e-01   +7.479725649025445e-01; +7.286806403180695e-01   +4.929649965294488e-01   +5.537264227044808e-01   +2.732037313266119e-01   +4.356479918765466e-01   +3.650948824637654e-01   +1.068184124441063e-01   +2.564607435494983e-01   +7.873062999748956e-02   +8.753098207531257e-01   +8.287768206437982e-02   +8.803670224835689e-02   +3.016007027709112e-01   +7.638174982192316e-01   +2.725165884558982e-01   +8.838950753085291e-01; +4.748253530500142e-01   +5.665219731143855e-04   +1.379664696353850e-02   +1.205318476443921e-01   +9.542707842178795e-01   +5.729138247106601e-01   +2.566445200802487e-01   +2.180162134969710e-01   +2.193237284534827e-01   +8.932713716484041e-01   +8.139715826950773e-02   +8.125841837450318e-01   +5.635393075922407e-01   +9.020923081427937e-01   +3.015174086150573e-02   +1.324921987126200e-01; +1.190840415481772e-01   +2.039806402208699e-02   +9.501879562602273e-01   +5.044213678371527e-01   +6.493256094690156e-01   +5.808811886527196e-01   +7.365575855353454e-01   +4.013962888803534e-01   +6.005797153831471e-01   +1.342791444925801e-01   +3.510568594464171e-01   +8.433414011561424e-01   +9.213967299954479e-02   +4.785549803457461e-01   +4.043284940425044e-01   +9.799425437533736e-02; +4.784156194355060e-01   +3.371062584678556e-01   +6.601266065649442e-01   +2.951274371672410e-01   +2.051443723873213e-02   +4.966388904425063e-01   +4.864543267994171e-01   +7.893713093745541e-01   +2.426074065296805e-01   +9.485658607396635e-01   +1.370555389591113e-01   +4.776412626456402e-01   +2.371368053145492e-01   +1.959316821519463e-01   +3.498344620019534e-01   +2.056023436853010e-01; +1.073997414962352e-01   +8.822913852274804e-01   +7.957453552463539e-01   +7.829386603488160e-01   +8.050842927371016e-01   +5.678530728664668e-01   +3.337982340513125e-01   +8.248385101840616e-01   +3.747030687697629e-01   +3.936304173467539e-01   +9.078536399544538e-01   +6.185293278659851e-01   +6.186021367604524e-01   +5.401233628615496e-01   +1.021994321633509e-01   +3.521176124221514e-01; +1.447255704441591e-01   +2.772305794438605e-01   +8.138466047552358e-02   +4.099661428588321e-01   +4.283967764759259e-01   +1.116588715628628e-01   +6.743061816560230e-01   +2.810776715279284e-01   +8.670053378918847e-01   +5.383470930380606e-01   +8.917793974954295e-02   +8.763080951607328e-01   +6.361665510442250e-01   +2.280097722905488e-01   +7.179151489211819e-01   +1.339182692835527e-01; +5.779252555023843e-01   +3.034522965190616e-01   +2.983980922907208e-01   +6.728254663517145e-01   +5.516231365579568e-01   +6.620270055025006e-01   +2.281422458599031e-01   +1.054700040964255e-01   +5.856119129390456e-01   +4.422317260413218e-01   +2.150053189943423e-02   +4.430498973906986e-01   +1.926665036441516e-01   +9.541574906647950e-01   +9.205616987864534e-01   +1.413653138000840e-02];
L1E_L1I_iGABA_netcon = [-9.507237506819761e-03   +2.790619386881350e-01   +9.060605271563030e-01   +2.906631347671739e-01   +4.103682120476216e-01   +1.363660975482456e-01   +2.806216174688530e-01   +3.898070340656164e-02   +2.085140424240195e-01   +4.846243982548626e-02   +4.665796650295750e-01   +9.736104111803449e-01   +1.662270128134823e-01   +8.563613534420884e-01   +1.128296869913752e-01   +4.468654178037160e-01; +7.336618255671454e-01   +7.853248403516052e-01   +5.163588511701637e-01   +8.640322231885609e-01   +7.629218993096460e-01   +8.656539685534267e-01   +6.293671648979149e-01   +8.783081376713223e-01   +9.595256622459315e-01   +9.473689218717799e-01   +1.441949728868053e-01   +1.107264069701789e-01   +6.110589622859578e-01   +9.456997299761278e-01   +9.931734610057542e-01   +2.947890743322087e-01; +3.368113497071532e-01   +8.269151826672413e-01   +1.053865604847231e-01   +9.285255816654860e-02   +1.018882564199017e-01   +2.436463880679400e-01   +5.792507877078510e-01   -3.315114197593784e-02   +7.932404838519701e-02   +1.020716182347471e-01   +5.212049474666067e-01   +4.318613231024201e-01   +8.330823483104001e-01   +8.274520264073825e-01   +7.901821356241127e-01   +7.494039211229097e-01; +3.671838964867805e-01   +5.237580781389526e-01   +6.350928137652216e-01   +7.526355773084978e-01   +6.477966152528059e-01   +6.581206466972236e-01   +5.924459123165259e-01   +8.884792801262362e-01   +7.286204454580059e-02   +3.291866489078038e-01   +5.426027594561135e-01   +2.095393342734229e-01   +7.910615283504352e-01   +4.328853616475076e-01   +9.286950335424066e-01   +5.415175388695268e-01; +7.598051123008011e-01   +6.000305142172552e-01   +8.386179625635356e-01   +3.539095558275904e-01   +9.751031701116191e-01   +5.327914383284650e-01   +3.525562531178114e-01   +4.614226682410469e-01   +2.774124829553198e-01   +1.128541800803384e-01   +5.172826537150120e-02   +5.553199318046332e-01   +9.146559457372533e-01   +7.681961386837175e-01   +1.070075455466187e-03   +1.817743589232068e-01; +2.651855955975225e-01   +1.911780287001293e-03   +2.658468397031345e-01   +1.676176936971094e-01   -1.506089043637415e-02   +4.231970167583187e-01   +9.172261942719293e-01   +3.220936635558665e-01   +5.462598353052688e-01   +4.075384124075315e-01   +9.180723632824540e-01   +1.957462596952980e-01   +2.962922616777552e-01   +2.368058725334192e-01   +7.435270413427449e-01   +4.229635161955467e-01; +6.583339770129003e-01   +5.452506568736547e-01   +3.517158812136674e-01   +7.893727523550571e-01   +2.923596615289670e-01   +8.862915303926473e-01   +6.614827137638614e-01   +5.332665872154677e-01   +8.546544259190435e-01   +6.396449129613574e-01   +9.261865794958229e-01   +3.165779447043290e-01   +7.866769865214965e-01   +6.192443907950459e-01   +9.543966226934735e-01   +8.121829283319882e-01; +1.000000000000000e+00   +1.541789362859622e-01   +5.579866359479403e-01   +5.147950295793570e-01   +6.421479688681742e-01   +1.972433103056848e-01   +3.285809128061264e-01   +5.912892165857324e-01   +1.931766442135291e-01   +8.118183469897515e-01   +7.858916657672276e-01   +9.417296089588845e-01   +2.899578396726861e-01   +7.729211818344827e-01   +4.847039238603590e-01   +5.895940908692496e-01; +5.435139677684319e-01   +9.998832038279029e-01   +3.674767700583065e-01   +9.425083257294504e-01   +2.165383734330764e-01   +6.986076178661400e-01   +6.127537373762790e-01   +9.849123851279985e-01   +8.352285587228544e-01   +1.302739854224350e-01   +2.034834093160127e-01   +2.113217322669023e-01   +8.696797076743604e-01   -3.092056481309457e-03   +6.986474895157280e-02   +4.542998525445926e-01; +2.542272164273425e-01   +3.951029222241866e-01   +5.511636463906056e-01   +3.148343842719594e-01   +7.903456770063373e-01   +4.027738653027729e-01   +3.462599521259567e-01   +8.608225091351797e-01   +9.277689325177946e-01   +9.141148043014807e-01   +8.080752313168369e-01   +9.324053951876291e-01   +4.965258164982400e-01   +3.767565494405465e-01   +3.352459833297629e-01   +8.598359162857667e-01; +1.210565413170135e-01   +2.193643051426797e-01   +8.070482136141779e-01   +9.225074557872265e-01   +1.305894759571861e-01   +6.293656492144658e-01   +8.004748395984031e-02   +4.500172184973233e-01   +4.010332225854948e-01   +6.912163396829506e-01   +3.161242799367923e-01   +9.035338740903054e-01   +7.622347999336347e-02   +5.075654554588463e-01   +4.535577899842603e-01   +5.004965164989624e-01; +1.479978535055957e-01   +9.330680980770842e-01   +7.555297126064217e-01   +4.972369474232834e-01   +4.904392664463814e-01   +5.324986551528872e-02   +1.751789045698247e-01   +3.404479604677135e-01   +1.269613756797669e-01   +5.562159944771935e-01   +2.833455268324580e-01   +4.437815511812102e-01   +3.885867954531355e-01   +8.733983219390599e-01   +4.591737684388782e-02   +4.822615168486589e-01; +8.990109653373818e-01   +1.328585620956678e-01   +4.971219450331658e-01   +5.372175923792721e-01   +6.577075045161296e-01   +5.914877010669947e-01   +1.832830867656733e-01   +5.410872512247944e-01   +5.130393601767783e-01   +3.145730850537075e-01   +9.345142813598822e-01   +9.631592206621477e-01   +8.655809325787107e-01   +5.733990059049489e-01   +2.915021349072704e-01   +7.787736716158475e-01; +4.335241858728192e-01   +8.361698719533543e-01   +2.862663600120068e-01   +3.982984068542296e-01   +7.398063332670127e-01   +1.851818813142532e-01   +3.748920770597116e-01   +6.372462981975597e-01   +3.226922796844026e-01   +4.599114234515507e-01   +1.855165423926852e-01   +1.487168993947651e-01   +3.092844725547068e-01   +2.524891673276650e-01   +5.996928844512694e-01   +9.092624093539091e-01; +6.063715557471960e-01   +6.041660404972938e-01   +6.535851687157198e-01   +7.053499303824730e-01   +8.152982858897683e-01   +3.172010677200857e-02   +8.334450770344137e-01   +3.288343496225561e-01   +8.229094624968681e-01   +4.809540052290008e-01   +6.656633590044743e-01   +5.723015751049517e-01   +2.400195826141034e-01   +5.052497699211205e-01   +9.118466697943758e-01   +4.955231111329292e-01; +4.195494238483290e-01   +6.117373704409061e-01   +6.264622973023771e-01   +2.891263387964774e-01   +4.710875512447247e-01   +2.910627331626855e-01   +5.636321054710645e-01   +2.501424719120684e-01   +8.774497706598768e-01   +2.860992427736691e-01   +2.313454049517674e-01   +1.363754628454607e-01   +8.372079933234615e-02   +4.857098791645125e-01   +9.230840440248387e-01   +9.356410326076855e-01];
L2I_L1I_iGABA_netcon = [+7.050621949749075e-01   +5.258985226513107e-01   +7.474355247960730e-01   +5.489757213306089e-01   +9.669478436929837e-01   +7.391653022388343e-01   +9.421367170867581e-01   +1.152651622163259e-02; +5.615723538671231e-01   +9.316092279145513e-02   +2.016119691532283e-01   +8.865305522393765e-01   +2.018540896358449e-01   +5.010984084589511e-02   +9.144697772462410e-01   +7.975102118908369e-01; +1.000000000000000e+00   +5.356514616937700e-01   +6.888700939444060e-01   +6.805916541157319e-01   +8.515091014115810e-01   +7.698999665598776e-01   +2.823522375491123e-01   +2.033724698062455e-01; +3.846363731811161e-01   +1.837442157056940e-01   +9.451928591726926e-01   +4.450066968061070e-01   +8.260915591780774e-01   +3.856045729627961e-01   +9.158116679387317e-01   +1.877677705574292e-01; +7.814191523216460e-01   +5.301176098778098e-01   +6.730741642889286e-01   +2.799319612340493e-01   +9.556812135317398e-01   +4.277998598585754e-01   +6.196901485514682e-01   +2.213175596523926e-01; +5.854864179897799e-01   +5.827835828502369e-01   +7.856157886606833e-01   +2.448641678534044e-01   +1.769845795106738e-01   +8.356681886158049e-01   +9.849117713870633e-01   +6.176972347331340e-01; +9.276741347842808e-01   +4.633041062788913e-01   +2.375467164773395e-01   +2.866291638853604e-01   +8.079523064444027e-01   +1.766350789017547e-01   +6.550086268079601e-01   +3.599310157784373e-01; +9.956581097420514e-01   +3.869792778872519e-01   +7.033373578828583e-01   +9.619219847620603e-01   +1.198895745158932e-01   +4.757110719694340e-01   +4.510795475908062e-01   +2.954722901267623e-01; +8.019388890049346e-01   +1.753974388821992e-01   +4.793267529391469e-01   +2.120270455149718e-02   +8.585137720674669e-01   +3.868159087178017e-01   +8.238382650711241e-01   +7.672499248468040e-01; +4.404383263113908e-01   +9.378016663872700e-01   +7.179832932934334e-01   +8.682702518512997e-01   +4.195502320982180e-01   +8.452539273650588e-01   +9.590246922259783e-01   +3.151256051817035e-01; +5.059480045609422e-01   +6.318177820310099e-01   +5.298214217207119e-01   +4.318127378731478e-01   +1.827981126591582e-02   +9.564575362122840e-01   +7.034763384623095e-01   +4.726029443877771e-01; +6.647069497732642e-03   +4.251149550764348e-01   +4.078991436222785e-01   +4.051166140309682e-01   +3.965346339054904e-01   +5.895095733531661e-01   +2.862299307937649e-01   +5.792173634279322e-01; +4.470368654022949e-01   +1.753779556697415e-01   +6.797183967969619e-01   +7.978962056258181e-01   +2.275697970195250e-01   +6.453002104280389e-01   +4.087519940632658e-01   +7.907789368297385e-01; +4.605741076434863e-01   +4.622127411689703e-01   +7.456067556020052e-01   +3.884396550096176e-01   +9.686261844295219e-01   +4.280719765521258e-01   +3.751327148308901e-01   +3.382668303767265e-01; +6.540664623460597e-01   +1.675938316067913e-01   +3.286623173019196e-01   +2.731771846529571e-01   +6.007719055615350e-01   +6.123507440534769e-01   +3.634519800410456e-01   +7.459191632995721e-01; +8.183528409006083e-01   +5.648303323970855e-02   +7.501172201348925e-01   +2.994706137370573e-01   +4.308837910657383e-01   +6.739585606596774e-01   +1.217415977776628e-01   +3.317532381645590e-01];
L1I_L2I_iGABA_netcon = [+5.528260931832397e-01   +2.066177396368293e-01   +7.861057653798748e-01   +2.793242666515948e-01   +6.256113256010312e-01   +2.974009292621256e-01   +8.817882768384931e-01   +2.333133830033045e-01   +6.026561543897279e-01   +9.320624345013212e-01   +4.413250228249823e-01   +4.607059244259298e-01   -9.798285732355904e-03   +7.647214348468968e-01   +6.443284529049217e-01   +4.918686052992980e-01; +4.516508033994824e-02   +6.829106843744540e-02   +3.607882644715362e-01   +3.191440512141678e-01   +9.188469492792655e-01   +3.468796813811166e-01   +3.305677567635038e-01   +1.364652690627379e-01   +4.647473626136575e-01   +2.119525830448162e-01   +3.080955972129709e-01   +2.920193381140186e-01   +9.334651784266249e-01   +1.647548919562944e-01   +8.769371240644994e-01   +2.551805975787402e-01; +3.637487761699095e-01   +6.632681974889265e-01   +3.921708016924690e-01   +7.223683942433792e-01   +2.361527695669220e-01   +5.060687183027298e-01   +7.891309049835090e-01   +8.575415565152784e-02   +7.826945977383664e-01   +4.940904810822742e-01   +6.309265782602522e-01   +8.560863154155314e-01   +9.766397065786840e-01   +6.603898720762850e-01   +3.233039289438066e-01   +1.211803035777244e-01; +8.523765665985857e-01   +1.339818643039752e-01   +6.339414036875383e-01   +9.428585358329742e-01   +4.950866775239363e-01   +9.220318683931402e-01   +6.367883135216743e-01   +6.434103397423374e-02   +5.471793136098503e-02   +3.514739341734788e-01   +4.260617202322264e-01   +5.063468890615117e-01   +3.181709135451001e-01   +5.065842701988802e-01   +2.136834029165848e-01   +1.172699912333699e-01; +9.945816541224480e-01   +8.058588371581479e-01   +7.399419766493885e-01   +7.124210346874046e-01   +2.843889316181504e-01   +6.723158021207755e-01   +6.955770381273608e-01   +6.580856290564854e-01   +8.161249755389036e-02   +7.111393449482116e-01   +1.825664152360430e-01   +3.923106311520300e-01   +4.810192948529927e-02   +2.163039920091186e-01   +7.496805125749835e-01   +9.843795756785334e-01; +5.489682498784202e-01   +4.090873662092329e-01   +1.267696381708222e-01   +3.394928234898592e-01   +9.645111276158731e-01   +1.391812340393627e-01   +6.958694212621014e-01   +6.853933244369826e-01   +5.682901445840322e-01   +7.596280251508321e-01   +3.493721561848736e-01   +4.897557358608723e-01   +8.916871647573120e-01   +7.430913438643354e-02   +1.954434489524458e-01   +7.026166023840776e-02; +8.084753349465543e-01   +7.984110999186135e-02   +4.205890936578212e-01   +3.213272523245564e-01   +5.651360731970442e-01   +9.320442292531024e-01   +8.382835710741308e-02   +2.403226360611422e-01   +7.439970580246281e-01   +9.406404196265985e-01   +8.896295952915269e-01   +8.894979066563508e-01   +1.622675160693858e-01   +3.110834797436608e-01   -4.977162970811158e-03   +6.397430503680330e-01; +8.742267972234489e-01   +3.817610449469727e-01   -3.278870624326634e-02   +9.052568795463634e-01   +1.764082976476727e-01   +1.000000000000000e+00   +8.141798986336297e-01   -6.195577203718386e-03   +7.984695201282862e-01   +5.082975001546516e-02   +9.188966075988529e-01   -1.618157395416077e-03   +8.316698489163333e-01   +9.048801586325987e-02   +9.620934273515870e-01   +7.151385458872799e-01];
L2E_L1E_iAMPA_netcon = [+2.675469326458610e-01   +9.111602853867508e-01   +6.706415955115235e-01   +6.162010537946330e-02   +3.348466152116357e-01   +4.013718251479869e-01   +9.971639085330893e-02   +6.225135494712267e-01; +2.878716059579539e-01   +1.714292062805075e-01   +7.706189242538635e-01   +9.116409360393963e-01   +3.338853967429583e-01   +5.706806866300215e-01   +2.817792456716421e-01   +1.345064357285388e-01; +5.221542680978949e-01   +9.233919072048601e-01   +7.858601097213742e-01   +1.717311412528466e-02   +6.806241786920517e-01   +3.929549076110287e-03   +4.280667802606913e-01   +8.379051928275775e-01; +5.423057254625925e-01   +6.016647370989393e-01   +5.192795000167297e-02   +5.838385848520786e-01   +2.783456173890366e-01   +4.944689310087179e-01   +2.386647328059307e-01   +4.484563098276848e-01; +8.473192419634438e-01   +7.369460248509808e-01   +7.916407885297686e-01   +5.325958313810358e-01   +7.954667663692954e-01   +3.645848521407577e-01   +4.775022721900442e-01   +5.030837599856722e-01; +4.873326751790055e-01   +6.859658497551532e-01   +5.301385704470737e-02   +6.129668346392407e-01   +6.556000009983319e-01   +8.689215865820983e-01   +2.413949628684472e-01   +4.020258181330016e-02; +4.927409173998503e-01   +3.401469307858824e-01   +2.483991126542603e-01   +4.066247824340201e-01   +3.961333844330898e-01   +2.663101720037329e-01   +5.423807214881750e-01   +2.982270673247787e-01; +7.285859259650566e-01   +1.705914565806965e-01   +1.857429124656423e-02   +9.363692106632141e-01   +5.149947320034473e-01   +3.558054476279068e-01   +5.667277962248424e-01   +6.121666357564921e-01; +7.584180483752062e-01   +6.202970932908296e-01   +6.442057191823322e-01   +1.337154242066763e-01   +3.810674134859528e-01   +2.207977286968805e-01   +8.256284524624914e-02   +1.000000000000000e+00; -1.112745696240224e-02   +1.425321901434533e-01   +1.208156037370289e-01   +1.966697013822603e-01   +2.212527080375369e-01   +5.569469130193145e-01   +8.828342549854356e-01   +8.444192624611018e-01; +1.957529655979051e-02   +2.309368651110667e-01   +6.170635356189664e-01   +5.159632685066088e-01   +1.398556021838284e-01   +4.418645290913673e-01   +1.775138227599340e-01   +7.383389597680974e-01; +3.966913348908359e-01   +5.243625976326501e-01   +5.995231497435870e-01   +5.240571347810740e-01   +7.001307621244441e-01   +3.297832110437160e-01   +6.272926153899723e-01   +4.553125734629229e-01; +6.631280266902888e-01   +7.085984475520063e-01   +6.527007769353815e-01   +2.598271876319968e-01   +1.813600051860118e-01   +6.648609056814088e-02   +1.177402219370546e-01   +5.709093364350575e-01; +7.493173342492534e-01   +8.225594901724292e-01   +5.985384308250760e-02   +8.924859415059062e-01   +4.658700409883826e-01   +8.651783673570774e-01   +6.051671793857744e-02   +2.310471832220416e-01; +9.421059267991202e-01   +2.091279704989744e-01   +4.124236423511002e-01   +5.668809261308121e-01   +3.699613980677566e-01   +2.479486009917581e-01   +6.144351673234846e-01   +3.918899239920944e-01; +8.453334083894520e-01   +6.020003585386819e-01   +7.059605828850557e-01   +3.632710830977378e-01   +4.846903061979918e-01   +8.985832577386895e-01   +7.451465993059826e-01   +7.844981739782718e-02];
L1E_L2E_iAMPA_netcon = [+8.665080072413557e-01   +4.517676381838989e-01   +5.800226716835316e-01   +1.170646271587782e-01   +9.453701042001937e-01   +2.938673901772620e-01   +5.560962462355655e-01   +5.179250549710146e-01   +9.553257178816599e-01   +5.461821989480593e-01   +6.567237796505151e-01   +5.004842988717942e-01   +5.269107841976366e-01   +3.707821446787360e-01   +5.377933336325238e-01   +2.069837333486145e-01; +7.799663411080746e-01   +2.203889690517151e-01   +1.182799951491864e-01   +5.918246949679941e-01   +8.179355852804908e-01   +6.369066425270922e-01   +8.951116218031315e-01   +2.542677211746275e-01   +3.504471784978991e-01   +3.290203094606763e-01   +7.688133656097742e-01   +6.681929399313824e-01   +6.925841178603332e-01   +8.818385133816149e-01   +4.084371082514715e-01   +5.372209215583653e-01; +7.986915955718157e-01   +8.066029241418841e-02   +1.070842215736938e-01   +9.625209199649417e-01   +2.616186858412484e-01   +3.708096821856411e-01   +9.291898193360103e-01   +3.080772362852961e-01   +1.626771104175946e-01   +5.929845184745645e-01   +8.494226640249525e-01   +4.761606272199366e-01   +8.623353597308145e-01   +9.734506580362360e-01   +8.401277699882237e-01   +6.537654789312943e-01; +7.291334007687619e-01   +1.011677233506422e-01   +5.379689107607798e-01   +3.783780880835682e-01   +4.126849544464469e-01   +8.480545648724543e-01   +2.159721198848572e-01   +1.189219962878704e-01   +6.231746819259207e-01   +4.348031857038560e-01   +3.726606866650541e-01   +9.445038752907846e-01   +7.443849686866035e-01   +7.484035896924281e-02   +7.581564742791078e-01   +7.857869717484899e-01; +2.268418861026731e-02   +2.519464294053998e-01   +1.681304548618568e-01   +7.596070055830134e-01   +2.054699337248315e-01   +4.865556565117740e-01   +1.000000000000000e+00   +3.038153232035090e-01   +1.034921202199639e-01   +7.775407031725500e-01   +5.497280084446812e-02   +5.874317718121894e-01   +9.282434874377496e-02   +6.517702363315367e-01   +3.824322733115240e-01   +9.366424175198712e-02; +6.692082975748253e-01   +4.394443340136612e-01   +3.988499347646555e-01   -6.267616311657422e-02   +9.262864968675951e-01   +8.124816060006214e-02   +4.588804537278007e-01   +2.109698801821902e-01   +7.561004144994590e-01   -2.844243890530248e-03   +7.656227698063272e-01   +4.921818522471766e-02   +7.540664001496253e-01   +5.099292687309476e-01   +7.080733168926393e-01   +3.404725090296458e-01; +2.970721587051958e-01   +6.653516396684774e-01   +3.702498275221803e-01   +3.772036691346349e-01   +3.551329604025063e-01   +8.779418526012560e-01   +9.317458732519528e-01   +4.249957900158245e-01   +6.842751596649516e-01   +7.686713583799868e-01   +6.051315949000196e-02   +1.250380738459897e-01   +1.031960129558622e-01   +3.681396751175637e-01   +3.414867532184176e-01   +7.837361174079625e-01; +1.738443110381888e-01   +4.602670833864557e-01   +2.961124746160695e-01   +4.363909891730737e-01   +9.641382836483452e-01   +5.084951251112967e-01   +9.714179895762760e-01   +8.879375532442055e-01   +3.653176827374557e-01   +5.908260015388776e-02   +3.664030414590151e-01   +3.332866849162714e-01   +3.298103430142949e-01   +7.557498881914263e-01   +8.394501173113357e-02   +5.533283252211574e-01];
L2I_L2E_iAMPA_netcon = [+3.564417436998047e-01   +2.499748162946588e-01   +4.053727345413446e-01   +5.624051410698663e-01   +1.814344891623316e-01   +8.656413102925904e-01   +6.591424582448528e-01   +2.710048676248682e-01; +5.147988848749544e-01   +2.098790453080921e-01   +6.316832868212509e-01   +2.511484811019491e-01   +6.798523820053882e-01   +7.932343994486921e-01   +7.422805853530141e-02   +5.318061290106092e-01; +6.151812057391329e-01   +2.046426593124332e-02   +6.993743651318671e-01   +6.125271394240580e-01   +1.405092748232958e-01   +5.798479164053610e-01   +8.162228295918804e-01   +6.751779409285424e-02; +5.052219001418843e-01   +2.918956958701766e-01   +5.872708256801998e-02   +9.591654956980669e-01   +3.598600872100244e-01   +6.095455217220958e-01   +9.638474524856628e-01   +2.226152445780420e-01; +1.654270428152681e-01   +4.348082210920240e-01   +4.086469335148081e-01   +8.297660420242622e-01   +8.425793554361983e-01   +5.914077754579183e-01   +6.977233790111416e-01   +3.044744714959629e-01; +9.157841879626054e-01   +5.071322148256383e-01   +9.154449380902132e-01   +8.433160968428091e-01   +7.277574296483698e-01   +8.501801807364764e-01   +8.729048347360954e-01   +4.980436449370694e-01; +1.100363174368964e-01   +5.699576503987480e-01   +9.174476214997952e-01   +9.058397399912834e-01   +1.073018548505580e-01   +7.459434922649270e-01   +2.440672021581908e-01   +1.029050461359104e-01; +5.548770945203917e-01   +3.741604383490270e-01   +2.151757863130018e-01   +2.730406422300489e-01   +7.457644222203652e-01   +4.105889963878275e-01   +9.656835894916944e-01   +6.136838960428632e-01];
L2E_L2I_iGABA_netcon = [+4.622538782907126e-01   +6.276902225142611e-01   +6.678020356586640e-01   +7.595003007613862e-02   +4.874780221684211e-01   +5.028599553757254e-01   +2.858194420775922e-01   +7.592533118063692e-01; +4.499841185364463e-01   +3.606140475838101e-01   +8.049150337739177e-03   +4.904718209650049e-01   +4.954444918349739e-01   +6.193514772708903e-01   +4.800891617449929e-01   +4.596390854186166e-01; +6.111078282475216e-01   +5.250716551115111e-01   +4.193878716965234e-01   +5.492344040681015e-01   +3.334868209306098e-01   +2.638250524760117e-01   +2.191985952835218e-01   +1.000000000000000e+00; +7.469059980307483e-01   +5.494907476750491e-01   +4.027864585017503e-01   +8.509779771181909e-01   +2.393964269484215e-01   +7.552816800082254e-02   +1.562889034404243e-01   +4.254698309142563e-01; +5.200429549631039e-01   +7.816316165585993e-01   +5.194065350397586e-01   +8.118027438180728e-01   +4.028287012433615e-01   +7.446031639417648e-01   +6.915256203597074e-01   +3.158537539622237e-01; +3.894982636890350e-01   +2.425180199248625e-01   +4.610522214129930e-01   +3.746033128991332e-01   +7.983605582910982e-01   +8.612441972237543e-01   +3.439359428236818e-02   +4.544221381960183e-01; +1.289036038683419e-03   +4.564687053391059e-01   +8.769638168946572e-01   +5.768180231284346e-01   +5.049159103949711e-01   +3.851670062488728e-01   +9.529983561075956e-01   -3.661414188090288e-02; +9.098121601566961e-01   +5.295846242011228e-01   +9.001601610360676e-01   +4.926756288159365e-01   +9.207905696696927e-01   +5.589170479419415e-01   +3.599387048798011e-01   +3.460473826499303e-01];
L3E_L2E_iAMPA_netcon = [+2.406517047624583e-01   +9.431852690473393e-01   +4.766978491018199e-01   +7.858267414308940e-01   +1.634284634032992e-01   +4.217347846660197e-01   +4.163458761505075e-01   +1.034170060547869e-01   +1.187883740995374e-01   +5.467642738342422e-01   +1.527533952797459e-01   +4.472962622169262e-01; +2.582943279585443e-01   +4.943959574401375e-01   +1.778065710168587e-01   +2.478126666384185e-01   +6.304924643299638e-01   +9.372780816642931e-01   +7.466479475829860e-01   +6.140525170634969e-01   +2.712966422153624e-01   +4.259659842119210e-02   +1.531108596290867e-02   +7.187131881926818e-02; +7.879960413235217e-01   +3.498265373858103e-01   +5.665734816844605e-01   +1.099182802554248e-01   +8.789990209350701e-01   +8.757643782948239e-01   +5.325842856641732e-01   +7.087014291606312e-01   +6.821198253585122e-01   +3.854917735937945e-01   +4.084187265459462e-01   +9.370146340931035e-01; +2.028640911554896e-01   +4.497103720110930e-01   +1.813123198041031e-01   +8.242647789230535e-01   +5.163971975783367e-01   +5.881366111479225e-01   +8.863675844326270e-01   +2.899092053000301e-01   +8.379656797275935e-01   +8.298590278219874e-01   +4.934645784910449e-01   +2.441595789594602e-01; +2.088164584871662e-01   +8.209777315773927e-01   +4.334814209565667e-01   +6.583239029225484e-02   +1.933376515899551e-01   +9.721149296584353e-01   -2.000654265277709e-02   +6.804924976106275e-01   +7.302953063102730e-02   +8.354758819439309e-01   +2.833626180908407e-01   +2.497601827785162e-01; +3.912903514691660e-01   +3.568083232713081e-01   +8.857015364130633e-01   +9.676342233776720e-01   +3.897424315914410e-01   +9.688054564261234e-01   +8.826545817287196e-02   +3.856961604589672e-01   +5.019817766933066e-01   +8.071458123539346e-01   +6.421827052368245e-01   +8.839301640110404e-01; +1.357089202499200e-01   +4.911934771711510e-01   +6.247998627855755e-01   +9.757937015586746e-02   +6.431193466734375e-01   +4.876408346280288e-01   +8.028477312781953e-01   +1.252451435767988e-01   +4.894779583318928e-01   +3.870346790989027e-01   +9.861282305209537e-01   +7.788276521168487e-01; +6.113889980924724e-01   +5.279957441023110e-02   +3.918496892043038e-01   +1.795620034500050e-01   +4.307423787804993e-02   +9.374884711607038e-01   +3.959545214530467e-01   +4.852376703792072e-01   +8.973782938900496e-01   +9.972821877829601e-01   +9.375925969825935e-01   +3.606453115948334e-01];
L3I_L2I_iGABA_netcon = [+1.237472255757106e-02   +4.256082647531585e-02   +5.280137785032765e-02   +6.603062920060369e-01   +7.823618810438328e-02   +4.818404076921829e-01   +8.128855393845804e-01   +3.825794367792132e-01   +4.131590959444483e-01   +9.857572801415375e-01   +8.849952164078515e-01   +6.249770990930058e-01; +3.457346881825222e-01   +4.385824367044809e-01   +3.126935733681530e-01   +9.009201996513571e-03   +4.628118357251989e-01   +6.100102439603032e-01   +4.635949908322334e-01   +8.957086131853814e-01   +1.056391850705428e-01   +9.275733125247592e-01   +3.133912054326924e-01   +6.391240635755001e-01; +3.530909555302247e-01   +6.977478771251130e-01   +3.064875026836741e-01   +8.053106195011019e-01   +3.644551269030042e-01   +8.263708292453861e-01   +9.353101428764514e-01   +1.641281674988865e-02   +6.486521342127499e-01   +4.961421411695978e-01   +1.491700023933470e-01   +5.755027131429158e-01; +6.487697614784208e-01   +9.531555187800892e-01   +3.531806448257876e-01   +2.782641039786971e-01   +1.762556403380075e-01   +5.804429708121510e-01   +1.838862111425597e-01   +2.766434697005537e-01   +6.408568667084219e-02   +3.484443480530407e-01   +5.132531045344679e-01   +8.156547290104085e-01; +9.590706121161829e-01   +1.259459057972329e-01   +5.013563419433791e-01   +8.402624261143493e-01   +5.035487984990576e-01   +9.013007816285871e-01   +1.023070572416886e-01   +5.729999289806434e-01   +5.870607939600377e-01   +8.003759193563541e-01   +7.702578688353543e-01   +5.265737950384012e-01; +9.064241897595320e-01   +1.800307572914967e-01   +1.332694419823982e-01   +7.523137719483244e-01   +9.099235827974675e-01   +7.327576892214879e-01   +8.900206516079979e-01   +5.444159572534779e-01   +1.491104130112084e-01   +8.515987216768593e-01   +3.738477680654215e-01   +6.237534081209684e-01; +1.127486388033616e-01   +5.456897734680041e-01   +9.514059570281039e-01   +5.651247796995005e-01   +9.502327013989685e-01   +8.428758365455807e-01   +8.268844383224322e-01   +8.115171286991183e-01   +6.074439058779088e-01   +3.744337745411754e-01   +3.018239718280292e-01   +5.730736375031580e-01; +3.134796213850045e-01   +3.151890402953001e-02   +7.577906359433880e-01   +1.948873289858343e-01   +4.479471144733904e-01   +5.358070440590985e-02   -2.927433808828709e-02   +9.926359497471310e-01   +4.658142403325179e-01   +1.018635238779451e-01   +7.231843563009446e-01   +6.073386912425461e-02];
L2E_L3E_iAMPA_netcon = [+9.054419672012857e-01   +2.858402035195699e-01   +5.636901473811509e-01   +6.867790846741368e-01   +2.554187226622852e-02   +7.264087642609609e-01   +7.557887642981004e-01   +7.349325268252289e-02; +3.272914347017176e-01   +5.968895962139179e-01   +6.849523854096099e-01   +7.504599362648660e-01   +2.364667032530484e-01   +2.145763003070449e-01   +8.433053723531032e-01   +7.810514848991268e-02; +6.275048757637742e-01   +5.374488141139754e-01   +9.050120702706691e-01   +6.397781482548798e-01   +9.061695376166857e-01   +4.628585415316627e-01   +9.694345386222983e-01   +4.786292778833846e-01; +1.689085298974704e-01   +9.344321698009606e-01   +8.940901995719820e-01   +4.459170661147028e-01   +3.688714164173652e-01   +9.610721322784120e-01   +2.636180638589661e-01   +5.260078421582143e-01; +7.384824200731345e-02   +2.191213473395309e-01   +6.817982982594109e-01   -2.223646025968857e-02   +1.717333789813657e-01   +5.308552695595866e-01   +5.173085328391031e-01   +6.624271974666476e-01; +4.162753403249604e-01   +7.681037345667439e-01   +1.849920393660588e-01   +7.934862102287041e-01   +2.849285821717147e-02   +3.804639918711035e-03   +4.931874199001601e-01   +2.952878899876228e-01; +4.609099479101704e-01   +8.002788866446224e-01   +7.982598443256549e-01   +2.502593166272948e-01   +8.404396187057958e-01   +2.055457745222139e-01   +6.958616053995565e-01   +9.466572344277221e-01; +2.814523175198554e-02   +6.056982888562430e-01   +8.885590062814919e-01   +4.719569905597301e-01   +1.072589947460875e-01   +7.500357369880062e-01   +1.123730498171653e-01   +3.586664130827373e-01; +1.000000000000000e+00   +9.370986271899786e-01   +6.145990702794048e-02   +1.430520889202235e-01   +1.236272359177586e-01   +9.151773394462314e-01   +2.839117363269654e-01   +9.340024170998406e-01; +1.820537355772211e-01   +3.444431136192885e-01   +8.165513929414238e-01   +3.693230284273241e-01   +3.915912264144926e-01   +9.251800922450569e-01   +5.128954377378125e-02   +9.824980618291592e-01; +6.801309303886737e-01   +3.955482227088764e-01   +2.530461478636665e-01   +2.064613348986185e-01   +1.017142647802467e-01   +3.491447172098893e-01   +2.228676778861703e-01   +9.034475712935239e-02; +1.062950438618794e-01   +6.290519840681863e-01   +8.019962779846164e-01   +4.324117857095713e-01   +3.821829512602833e-02   +7.514617301544280e-01   +7.994316327018314e-01   +7.564469764550076e-01];
L2I_L3I_iGABA_netcon = [+3.992561781095726e-01   +6.404581147474834e-01   +2.615131845602866e-01   +6.775771790553529e-01   +5.429264399663126e-01   +4.292411542179765e-01   +4.248453270782840e-01   +4.765082255333165e-01; +3.807640266460785e-01   +1.113519209731193e-01   +1.174387209278198e-02   +8.425541204349022e-01   +7.223657823263385e-01   +4.381676587564366e-02   +8.701371027533998e-02   +6.180065342196105e-01; +3.520430579902089e-01   +6.381625336054918e-01   +3.868716569594104e-01   +1.179410879702926e-01   +8.054249992698091e-01   +6.084678326757815e-01   +1.571791333009809e-01   +8.784612374935703e-02; +6.209363834140567e-01   +8.925651571663323e-01   +6.307787984500912e-01   +4.822454900486475e-01   +5.528676493719046e-01   +6.804962930704462e-01   +4.601882182505616e-01   +7.170841966554818e-01; -1.209349528422048e-03   -2.620549516036352e-02   +1.290241104893753e-01   +6.617556322654228e-01   +2.014838217060454e-01   +7.025547312722579e-01   +4.616791846554318e-01   +3.125222331555580e-01; +5.342532041025537e-01   +4.323174095826027e-01   +4.634799093223811e-01   +7.062754665773435e-01   +2.845970844086351e-01   +8.592775689359896e-01   +3.707774033024253e-01   +1.449847830565029e-01; +3.143444152031116e-01   +2.878459100319295e-02   +4.522284531733544e-01   +1.000000000000000e+00   +6.190253770912146e-01   +9.449262760465107e-02   +2.858404810446875e-01   +8.282845313056906e-01; +2.228440934779230e-01   +9.427904169187119e-01   +9.323696628953267e-01   +9.459734900908510e-01   +5.016793180129336e-01   +1.040734399828382e-01   +7.772069452901272e-01   +1.516584960067378e-01; +3.417576583706340e-01   +5.489562564067220e-01   +2.874768101509553e-01   +2.041208991884725e-01   +3.540012654580935e-01   +2.634784120190150e-01   +6.044486209961980e-01   +4.968611760792865e-01; +4.286249588119436e-01   +2.206159029002206e-01   +1.853330923159100e-01   +3.926548215928313e-01   +9.364409355927118e-01   +5.216774475869991e-01   +4.769076867851108e-01   +9.557966645582601e-01; +6.217890701747315e-01   +1.078839981984611e-01   +3.051467097086389e-01   +5.889234615459034e-01   +4.932027985698302e-01   +7.671245947443068e-01   +9.428510475555322e-01   +6.528611019326218e-01; +3.741622625911912e-01   +2.273023292115435e-01   +6.291414523865853e-01   +2.580844393770021e-01   +1.345837906513341e-01   +1.348024036083878e-02   +2.978055769165480e-01   +7.062234068812578e-01];
L3I_L3E_iAMPA_netcon = [+1.010982275996017e-01   +7.020534895336115e-01   +1.054186916709962e-01   +1.960781290308629e-01   +3.004183953197154e-01   +6.526819798726479e-01   +6.980484405479706e-02   +3.328688526834858e-01   +5.323363034166759e-01   +3.247443208752575e-01   +6.235668951306076e-01   +8.944146931079290e-01; +3.637673050624229e-01   +8.524163555701243e-01   +2.564380463837153e-01   +3.817863222891519e-01   +8.263351106893652e-01   +3.839232907797356e-01   +3.668032204179212e-01   +3.998081246491598e-01   +6.252779918392725e-01   +2.673794292980617e-01   +7.138954948924178e-01   +2.211975372372220e-01; +4.938995385858357e-01   +3.857440191963031e-01   +7.840167080397067e-01   +8.885276823998172e-01   +6.091218886049936e-01   +5.897964391835492e-01   +1.000000000000000e+00   +4.210276118083262e-01   +2.138615680720420e-01   +3.196634406923385e-01   +9.209720881358240e-01   +8.486715022427812e-01; +5.115886586271884e-01   +8.665016174551110e-02   +5.616693026545289e-01   +7.450293776700729e-01   +4.645875413391621e-01   +5.917214079795494e-01   +5.940988924237653e-01   +6.818218111716086e-01   +5.520649878531051e-01   +1.867308516852620e-01   +4.279693392473329e-01   +4.628555070543494e-01; +9.596225232476443e-01   +8.240452132829206e-01   +6.009211527557655e-01   +4.766798854252089e-01   +2.635621265759816e-01   +3.615489303334207e-01   +1.580392199462782e-02   +2.098601236122281e-01   +1.045323667013222e-02   +2.518794837886422e-01   +6.036173519859521e-02   +4.938278401177541e-01; +4.000468666747201e-01   +1.858371772955054e-01   +6.414272032715866e-01   +4.350000071305549e-01   +9.597763011901077e-01   +6.105256513571237e-01   +2.972832415895502e-01   +8.967629458798894e-02   +1.926113443296970e-01   +5.634856877996738e-01   +3.285350019223779e-01   +6.836616037791649e-02; +4.953035649605801e-01   +2.256788321614474e-01   +8.489554672885864e-01   +8.856824211863387e-01   +1.326438603880086e-01   +2.997490258250376e-01   +3.986275844968584e-01   +1.254635600331085e-01   +9.214419374699164e-01   +7.195572459681141e-01   +2.841195537944989e-01   +4.019671935186274e-02; +3.935370109322720e-01   +4.173018569692161e-01   +2.600334845632279e-01   +5.936054354808354e-01   +8.659657384832793e-01   +2.594033355248466e-01   +4.009923982856718e-01   +2.933991762110200e-01   +3.405605579084071e-01   +2.676703008074667e-01   +7.118565257617843e-01   +5.821503154114155e-01; +3.161298561932001e-01   +5.246768733031963e-01   +3.515659553635892e-01   +5.816156655640304e-01   +5.653179729738014e-01   -2.889289576319528e-02   +1.044554971741764e-01   +4.773147044371886e-02   +3.307590298153256e-01   +2.255779210144333e-01   +8.871782243343791e-01   +8.911379831334141e-01; +7.464618542290642e-01   +6.056333573251699e-01   +5.784193127583157e-01   +3.887510417914694e-01   +4.274179041702357e-01   +4.029929200097210e-01   -2.121728981227600e-02   +6.527053690811725e-01   +2.628143130237913e-02   +9.249153220366331e-01   +4.608875854721398e-01   +1.534700011265080e-01; +1.037377577968370e-01   +2.513118759207384e-01   +6.580021598010329e-01   +2.469572610100007e-01   +6.703676900782787e-02   +5.201593463035177e-01   +8.455575332951655e-02   +7.476841268201142e-01   +7.484244487580846e-01   +1.580102886085041e-01   +6.827053053127702e-01   +2.681462446599474e-01; +6.079725051791337e-01   +6.306844556494453e-01   +4.000309847642287e-01   +6.243529077409590e-01   +6.757126421229613e-01   +4.424032335558239e-01   +3.504178914834148e-01   +7.925984540676475e-01   +6.383656580696925e-01   +4.098015734647539e-01   +5.175767456821183e-01   +4.161553206772422e-01];
L3E_L3I_iGABA_netcon = [+3.181864686835002e-01   +7.029588139289797e-01   +7.233408978457611e-01   +8.856043740175462e-01   +4.479786994757040e-01   +1.171250370879154e-01   +2.592064283004822e-01   +7.115734076563610e-01   +7.998075501130028e-01   +2.510345049592292e-01   +4.984864788767097e-01   +2.848775094998727e-01; +8.658606817144516e-01   +3.660886951073290e-01   +6.247585374198567e-01   +5.703308367865952e-02   +8.997145799067702e-01   +3.896467232992453e-01   +8.395531618081954e-01   +7.300343259934464e-01   +6.135540126604713e-01   +7.537722654229811e-01   +2.512406252574922e-01   +5.056895534559968e-01; +8.227301652705524e-01   +3.269747113265921e-01   +3.941939719847087e-01   +4.687999466803680e-01   +5.685659816964800e-01   +5.535292130842998e-01   +2.443266561602691e-01   +8.396844932487512e-01   +5.795910138508790e-01   +1.211270362004436e-01   +7.538996547636768e-01   +8.577681855108228e-01; +1.439785728338480e-01   +6.585698941309303e-01   +3.212485374680404e-01   +3.029949969242058e-01   +9.141376909107800e-02   +6.914511226578424e-01   +2.663918192371678e-01   +9.557390555906597e-02   +2.831559746277220e-01   +5.204419096674989e-01   +7.495360578883572e-01   +5.596536838089762e-01; +2.091381142754035e-01   +7.174445792566670e-01   +6.184872464453118e-01   +2.680331603198434e-01   +1.278151227826388e-01   +5.874466691095142e-01   +9.253701252523008e-01   +2.667330413261549e-01   +3.091142121704696e-01   +8.330532529403846e-01   +6.282334405792386e-01   +2.088777602321013e-01; +4.471082495066163e-01   +8.224059388330422e-01   +7.610793497224900e-01   +5.268675958503339e-01   +7.800551734594993e-01   +8.408065213070363e-02   +3.957071117964092e-01   +3.227865905212824e-01   +8.388449758294106e-01   +8.597018791476408e-01   +8.236392663182254e-01   +2.865938254463208e-01; +5.192713876477135e-01   +7.975412509658469e-01   +2.165917184890617e-01   +2.794468754848329e-02   +4.258794143462275e-01   +6.322884308140392e-01   +6.285144581463131e-01   +1.972531195259610e-01   +9.716778659031453e-01   +5.993865431708478e-01   +4.989338523228345e-03   +3.872701821686486e-01; +4.791604944223909e-01   +4.255757495374173e-01   +8.621387112138662e-01   +3.870631880077432e-01   +8.911649281135520e-02   +1.022556104114274e-01   +5.899340890233410e-01   +5.113341528480350e-02   +6.068299863583589e-01   +8.299199242505420e-01   +2.050112101863776e-01   +1.000000000000000e+00; +3.256232965108971e-01   +5.710755822555392e-01   +2.404478604440460e-01   +7.116431917279123e-01   +8.856172050991161e-01   +3.712165527218492e-02   +3.669319257429967e-01   +5.801624881499895e-01   +6.005640378420261e-01   +9.081881269832967e-01   +7.014961982647594e-01   +6.472428930975797e-01; +7.167717799967498e-02   -1.014497920447978e-02   +3.598098899980639e-01   +5.748246807475802e-01   +7.570960123312788e-01   +2.154061439175609e-01   +1.616415711746151e-02   +3.393951442948250e-01   +6.800169905786428e-01   +2.956072825234006e-01   +6.314203439933040e-01   +5.187029002116246e-02; +8.892156850629941e-01   +8.585104610301006e-02   +7.165432650464264e-01   +5.042397161393239e-01   +4.166034168188401e-01   +8.522793057408954e-01   +9.518593146466624e-02   +8.107035940209294e-01   +3.482509956127677e-01   +9.563016819321919e-01   +4.637154130629225e-01   +7.443877404280720e-01; +6.376181005216773e-01   +8.241553127459600e-01   +5.167124765516884e-01   +9.188814765817908e-01   +8.457938856497507e-01   +4.951610373819102e-01   +9.615308810842499e-01   +8.941500370840040e-01   +4.639322679163035e-01   +8.981860947008597e-01   +5.413989985943342e-01   +9.098486375340673e-01];
L2E_Input1_iAMPA_netcon = [+9.730648633345480e-01   +9.649103648971160e-01   +9.404171642526303e-01   +1.000000000000000e+00   +9.360926004940424e-01   +9.923979928568193e-01   +9.712816961741733e-01   +9.579231164223064e-01];
L2I_Input2_iAMPA_netcon = [+9.677340524927395e-01   +9.686950405679804e-01   +9.981135331904677e-01   +9.196731968520990e-01   +9.474035827440095e-01   +9.590295847514650e-01   +9.532665041460621e-01   +9.746099281550873e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
