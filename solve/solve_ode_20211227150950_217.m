function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.699881438348986e-01   +4.576086771924157e-01   +2.287144025352883e-01   +2.528632658053191e-01   +8.878182212661533e-01   +7.466705388616869e-02   +4.071354179646443e-01   +4.485681115573901e-01   +1.887291998239708e-01   +6.398795963570676e-01   +9.018087499724721e-01   +8.669018894881150e-01   +3.089767119674837e-01   +6.326649783728904e-01   +7.968228163480587e-01   +4.558064473065517e-02; +2.700564634839973e-01   +3.436679293506231e-01   +2.740045526046725e-01   +7.449932728548556e-01   +2.255249586041359e-01   +6.054653224250071e-01   +3.140843153667597e-01   +2.453189315561879e-01   +3.185305404800837e-01   +2.816548150995629e-01   +3.505435507086213e-01   +8.842363260176191e-02   +7.732158130020449e-01   +3.006525647601532e-01   +4.507836967615294e-01   +5.313602208080059e-01; +5.432655967733009e-01   +3.938900622855808e-01   +4.394153868122431e-01   +1.724391104756585e-01   +3.719338791708262e-01   +2.624895185832772e-01   +6.781264492130334e-01   +3.764138729726375e-01   +2.093135607216673e-01   +8.799498094207973e-01   +5.255522223125476e-02   +8.517321206628010e-01   +1.027950399752342e-02   +6.452990213141586e-01   +3.484228102086027e-01   +7.448601074796041e-01; +7.941281674760031e-01   +8.014645183216834e-01   +8.761042205944002e-01   +7.944132300375962e-01   +7.447454093152833e-01   +5.324691368592611e-01   +4.091040146115770e-01   +7.894939630951787e-01   +1.822106550291679e-01   +6.260356270377272e-01   +1.429237674317026e-01   +5.464479884036177e-02   +4.926594053727023e-01   +1.678603030494311e-01   +7.690765623363716e-01   +5.822948242509077e-03; +4.202741622310902e-01   +6.672846886211898e-01   +7.742053912948955e-01   +5.638214660417461e-01   +9.287168957741822e-02   +1.879906879967899e-01   +8.566381146871328e-01   +5.020397499237662e-01   +1.801909391126273e-01   +1.283180236346475e-01   +1.643521815082156e-01   +4.029364554410949e-01   +7.340629846168284e-01   +4.501535404748598e-01   +7.279652377720151e-01   +8.543919439405484e-01; +4.757029140767877e-01   +4.206857550408317e-01   +5.225671409617123e-01   +8.281759456935904e-01   +3.117302504402302e-01   +7.017681061861279e-02   +4.375374270068450e-01   +6.085360080016736e-01   +7.412423867486742e-01   +4.549401235016179e-01   +8.432643202833427e-01   +6.516244146165445e-01   +2.812706658529786e-01   +4.897475548614120e-01   +4.498153700515922e-01   +3.602754885478873e-01; +8.719049450494731e-02   +2.454013218159735e-01   +5.327626921578972e-01   +7.572393580585622e-01   +2.665736706935138e-01   +1.501036257769184e-01   +5.063364515176757e-01   +2.116845052313471e-02   +8.116270862723496e-01   +3.921770552669611e-01   +6.867295966682679e-02   +4.507239104809602e-01   +3.311607972097509e-01   +3.978264465953978e-01   +6.865180482856901e-01   +6.363895675256177e-01; +6.984444637773068e-01   +2.900949893353030e-02   +2.480017740291593e-01   +1.604287271153833e-01   +1.990645801860249e-01   +9.259036826535516e-01   +2.462001899360451e-01   +3.314441874027831e-01   +2.811157580223822e-02   +1.930845393698124e-01   +4.140351393617160e-01   +4.853867417330598e-01   +4.366200949173759e-01   +6.828334040386248e-01   +1.357363298464321e-01   +2.531212874179541e-01; +6.064283750887041e-01   +2.630842082289833e-01   +2.202079724195548e-01   +5.939789040954607e-01   +6.009141025397112e-01   +2.509651117213779e-01   +4.684821753926945e-01   +1.049743813173450e-01   +4.719579994929503e-01   +5.787764985561501e-02   +6.399526153170191e-01   +1.126173045101852e-01   +2.792165101353727e-01   +5.251657446662689e-01   +6.418384939437959e-01   +4.427588789674758e-01; +6.080152258737112e-01   +4.240515030766617e-01   +4.874378413086249e-01   +4.057783485063524e-01   +7.871620939640083e-01   +8.897907390663122e-01   +1.588429601388665e-01   +2.890741677188578e-02   +3.183482637577260e-01   +7.323148654356212e-01   +5.812302457389257e-01   +2.689034098661410e-01   +7.906642289369964e-01   +6.097808616101458e-01   +6.528773393013346e-01   +1.582339133582241e-01; +3.178364636928945e-01   +1.668514659150983e-01   +6.776844529928393e-01   +9.654826471242922e-02   +2.521332578862293e-01   +8.837455447969753e-01   +6.764923093111557e-01   +2.515627722300564e-01   +3.853605141982608e-01   +1.942863190361734e-01   +1.453130802190411e-01   +5.641461069747996e-01   +2.645551305802946e-01   +1.642451549785904e-01   +5.636503269533476e-01   +3.558690923209332e-01; +1.459762719434932e-01   +3.292874418403068e-01   +2.061688260608910e-02   +6.084852146440723e-01   +3.847613017957819e-01   +2.895230704403696e-02   +8.834168610979632e-01   +7.785808117087862e-01   +4.167660258621095e-01   +5.093024039594866e-01   +4.506812870088705e-01   +6.087168642087367e-01   +6.254820076628053e-01   +5.519418400496825e-01   +8.914813403635892e-01   +8.204142419789159e-01; +7.305005641160056e-01   +8.908764681007715e-01   +1.037520903338309e-01   +1.314224947171819e-01   +6.775618072663665e-01   +5.151164155864001e-01   +7.837582633745476e-01   +3.925786664096151e-02   +8.839361490215112e-01   +7.877732330932070e-01   +6.781942080229534e-01   -3.270578701543803e-02   +4.313229487012630e-01   +4.244211101511076e-01   +4.575672420651702e-01   +1.883965291868077e-01; +7.571621550810474e-01   +2.156627806852483e-01   +6.387879907227458e-01   +7.479168186878496e-01   +7.550087973896097e-01   +1.283978425610141e-01   +3.602313651029798e-01   +3.030911942660923e-01   +5.442847345143619e-01   +6.554322295723081e-01   +7.099124164165698e-01   +8.327686179314422e-01   +4.953662039712211e-01   +5.772945663557744e-01   +8.698342286062140e-01   +4.602433017846502e-01; +7.521643342364047e-01   +2.188971766352973e-01   +8.410663087622865e-01   +7.167319992152371e-01   +5.018065295137237e-01   +1.212567995587432e-01   +7.779793041668071e-01   +4.074387313155924e-01   +5.278897728052101e-01   +6.126379278442147e-01   +6.968163965257511e-02   +9.764068687587492e-02   +8.157821149235126e-01   +7.330459716459592e-02   +3.887485934383684e-01   +8.916687242789215e-01; +8.014399388464741e-01   +4.247661367117420e-01   +6.301242246582175e-01   +2.059303956500742e-01   +7.238346217387801e-01   +5.443149350309653e-01   +6.642145402372542e-01   +4.661713944655950e-01   +4.233358848578175e-01   +3.467221061048674e-01   +1.880032471603814e-01   +1.511684697303741e-01   +1.477453263822996e-01   +6.719376399038283e-02   +4.869769466011876e-01   +5.356158712045236e-01];
L1E_L1I_iGABA_netcon = [+1.886900114688885e-02   +8.030048897942889e-01   +8.573574904885152e-01   +6.871778364580348e-01   +5.675736944291315e-01   +6.090956458249270e-01   +8.964020133915506e-01   +8.637535619949734e-02   +8.004404924915192e-01   +8.531113050487024e-03   +7.280895774956412e-01   +3.304032606201192e-01   +2.514901174643949e-01   +8.903657625030940e-01   +3.243558052877233e-01   +5.379577549334181e-01; +6.304895979631292e-01   +5.975353986689593e-01   +5.450655212602963e-01   +3.008121209784514e-01   +5.111206886149085e-02   +7.046524920555646e-01   +5.711401672630700e-01   +6.307776164973764e-01   +1.320252123468055e-01   +3.962300294229525e-02   +8.518775001304392e-01   +2.429833086845457e-01   +5.352818316173694e-01   +5.552011625958319e-01   +1.089489432791741e-01   +3.933033471622343e-01; +7.683143807420198e-02   +6.259707500964590e-01   +3.515740142026610e-01   +3.255994993903943e-01   +2.555564697229453e-01   +9.106063341644137e-02   +2.889135393836847e-01   +4.996614692059788e-01   +1.991499339027023e-01   +1.652593397101150e-01   +6.156450031942043e-01   +5.703895554358024e-01   +4.759003955998465e-01   +3.610665703299073e-03   +3.769282887261037e-01   +4.330469829050920e-01; +3.428424563844684e-01   +6.762240489453942e-01   +6.623200451170006e-01   +5.575812946931352e-01   +4.737778595477857e-01   +8.579049725176222e-01   +7.578836197767339e-01   +4.263253272502321e-02   +6.424927835833196e-01   +8.236225003078831e-01   +5.192646495963397e-01   +7.023669187352413e-01   +2.741697986794997e-01   +5.542129173418960e-01   +6.326092820347888e-02   +9.110167587644562e-02; +4.445540156716508e-01   +8.904116014443163e-01   +7.733435815259456e-01   +8.722069742388493e-01   +2.661403151831020e-01   +2.062206844463903e-01   +6.164335626681958e-01   +4.805276135323572e-01   +6.662919440590787e-01   +6.679675860289476e-01   +8.073708227103500e-01   +6.825330304078511e-01   +2.289679915920105e-01   +1.410427086809294e-01   +3.580432361332244e-01   +8.351736630479667e-01; +6.080965037086797e-01   +6.699299055133670e-01   +6.268488920837828e-01   +7.307602952692920e-01   +5.084292277216078e-01   +1.665673874755575e-01   +2.913260540890767e-02   +2.586152181386775e-01   +8.386541188121084e-01   +4.274498029280380e-01   +7.626889126826663e-01   +4.142871831310560e-03   +3.449974152453671e-01   +4.255526234352073e-02   +2.322283606212148e-01   +5.019792172953208e-01; +2.407499245683330e-01   +6.451859546190134e-01   +6.558797659438004e-01   +2.979023490473554e-01   +5.653065054763982e-01   +1.834737218082375e-01   +7.258760357488040e-01   +6.378744591682042e-01   +2.352290863296766e-02   +6.228065703864833e-01   +1.852651650502501e-01   +6.255078330211201e-01   +5.861336889329110e-01   +6.363623193488008e-01   +2.012822934563576e-01   +4.135103206232702e-02; +1.268821521399019e-01   +4.221406782529140e-01   +2.692285859822790e-01   +1.316097140493954e-01   +5.634203644191365e-01   +6.096650080829454e-02   +1.874725522154501e-01   +3.946842688099532e-01   +7.001026190850714e-01   +3.355251916096509e-01   +3.117467014068010e-01   +3.325421920405692e-01   +4.455619137461543e-01   +1.182104629427128e-01   +3.574356799750248e-02   +8.668036772558454e-01; +4.028573284814303e-01   +6.566149021273286e-01   +8.334387734906988e-01   +5.429943406973131e-01   +3.886621327955252e-01   +4.866654756548094e-02   +1.230605574633664e-01   +4.571421710764775e-02   +5.783151479599616e-01   +1.725426151769861e-02   +2.885520829895059e-01   +7.491189047854969e-01   +5.498398439350600e-01   +3.667385862123426e-01   +8.140537995835855e-01   +9.053474107660081e-01; +4.021146979880008e-01   +7.595598724530995e-01   +2.274020172446792e-01   +2.074980833771797e-01   +8.720664643113375e-02   +4.482522852116765e-01   +2.675789808176210e-01   +1.123519298514033e-01   +7.360124503773142e-01   +1.900527948937453e-01   +3.763752873373319e-01   +4.139683732442458e-01   +6.832617285429017e-01   +7.371601420447141e-01   +6.779802422876138e-01   +3.074972616383853e-01; +5.815377036735501e-01   +4.711929332174945e-01   +4.682380775207601e-01   +2.110541930063373e-01   +5.134590491559475e-01   +8.328960846728567e-01   +7.515817568679296e-01   +7.284519817726584e-01   +4.763457101972329e-01   +4.288006514684956e-01   +9.886192594751207e-02   +7.811158044950690e-01   +1.251800265046677e-01   +3.353020123956739e-01   +4.042859527403880e-01   +3.828027634521812e-01; +6.704442235824966e-01   +1.951489345364101e-01   +2.018890467385722e-01   +4.936612075983539e-01   +7.230022348348126e-01   +2.452908418025780e-02   +5.863536161335664e-01   +5.116464895593577e-01   +7.601418660913764e-02   +4.816608940473901e-01   +4.030961673809997e-01   +3.649962765225752e-01   +2.424028120055577e-01   +5.847524815960790e-01   +7.622825222802542e-01   +7.159515204732871e-01; +3.378864871487613e-01   +4.374844706952964e-01   +4.709895407161941e-01   +7.540368157011411e-01   +4.835593186988391e-01   +3.224842167654610e-01   +6.521330273209913e-01   +6.079112296142646e-01   +6.436620089564330e-01   +8.647742586237170e-01   +9.695798730863829e-02   +2.644148097499826e-01   +3.474458662856946e-01   +5.085048131315141e-01   +4.110714310090398e-01   +5.928656457147339e-01; +2.370894809737560e-01   +4.070263241485473e-01   +5.222674877807272e-01   +5.194666262684184e-01   +6.319687792228882e-01   +1.683959251935605e-01   +4.060617819872678e-01   +2.551445206090794e-01   +3.085315963994475e-01   +4.004182096608254e-01   +3.916907476597852e-01   +2.917944473980454e-01   +7.968550107725354e-01   +8.695806871692103e-01   +3.142371791983279e-01   +1.458348073140095e-02; +3.242452474327684e-01   +2.337927083205668e-01   +3.740996417672464e-01   +5.728894254281581e-01   +4.361165701378944e-01   +4.065199971835993e-01   +2.596090157477250e-01   +3.377639815103971e-01   +5.787085841058854e-01   +6.203976831041478e-01   +3.365841319356564e-01   +2.801959532440059e-01   +1.686616759123872e-01   +3.092010815464960e-01   +7.239184459654786e-01   +6.931131417308246e-01; +3.272343009877393e-01   +4.554161103131885e-01   +4.379525470329076e-01   +2.186269863611032e-01   +4.211385852182854e-01   +8.177417363390777e-01   +1.367263749661484e-01   +7.260306520887837e-01   +1.645553470237487e-01   +7.090281076215816e-01   +4.503541514580238e-01   +5.997770270685084e-01   +4.427827458410293e-01   +8.538120200006755e-01   +2.499104953658992e-01   +6.614775601747572e-01];
L2I_L1I_iGABA_netcon = [+6.621658917139940e-01   +8.408223907684550e-01   +6.184575765138591e-01   +3.345942996058479e-01   +1.822680961493598e-01   +5.339771134627116e-01   +3.128845705971681e-01   +8.259280402817770e-01; +8.586888994079747e-02   +4.219993050484673e-01   +2.028568004363590e-01   +6.653482328917766e-01   +5.373093516998854e-01   +7.028786033023219e-01   +6.118464282457194e-01   +7.449738685819582e-02; +1.653228422667775e-01   +3.265245107173301e-01   +6.253773326868782e-01   +4.748893046174261e-01   +6.788525489189582e-01   +2.807629928858752e-02   +5.281695643930193e-01   +8.205789965172045e-01; +2.124043151213960e-01   +7.583686840694284e-01   +3.540111749262622e-01   +4.667683352222805e-01   +2.380892810645408e-01   +6.297333997455968e-01   +4.165510263382068e-01   +8.027287609285831e-01; +7.542842776976607e-01   +3.631302449418052e-01   +3.912803501666819e-01   +2.647170276892117e-01   +7.706735528947963e-01   +8.277957569887093e-01   +3.761182207412878e-01   +5.400610920420298e-01; +5.980247660758325e-01   +4.878668706358212e-01   +8.120404733194010e-01   +5.124805901846677e-01   +7.176253918861484e-01   +4.355140540259971e-01   +2.879081963492289e-01   +6.146788017653433e-01; +8.881136347121953e-01   +5.278882820059336e-02   +2.019669571155856e-02   +7.559248398269690e-01   +7.581281206207705e-02   +2.246967533804262e-01   +3.897924173455392e-01   +2.455417239116000e-01; +5.522142718170717e-01   +2.785032113168897e-01   +2.654132848041358e-01   +8.266057669259622e-01   +2.597658448154745e-01   +5.472224681070385e-01   +3.419433126475695e-01   +2.260754539141231e-01; +5.675552949272765e-01   +4.946146642578530e-01   +1.259735606139170e-01   +2.931442379899957e-01   +4.608896000799272e-01   +6.123946027116400e-01   +7.593411745880331e-01   +2.330906642463024e-01; +5.229489993600562e-01   +6.816634723022936e-01   +4.172978387236108e-01   +8.377550949325306e-01   +7.433284491748194e-01   +1.485882276813184e-01   +2.353692814203157e-01   +1.243047538523169e-01; +7.069399789317239e-01   +7.479984369491292e-02   +5.173581440006051e-01   +4.113291504656746e-01   +5.919760461854352e-01   +1.000534293174072e-01   +6.203640335218450e-01   +4.518860490492493e-04; +5.190434761795393e-01   +9.033402363825068e-01   +3.188260100832294e-01   +6.295298429700703e-01   +8.192531684847194e-01   +3.298753261235948e-01   +4.150495744772651e-01   +4.143834403263004e-01; +3.418981793258958e-01   +3.376294858899925e-02   +9.879556142633780e-02   +7.738998021878433e-01   +2.667749303578163e-01   +8.798319273575909e-01   +4.656197119837966e-01   +5.129723854420772e-01; +6.605531633662901e-02   +7.182335598419421e-01   +8.751276907186997e-02   +2.037274315680766e-01   +2.296497732106977e-01   +3.490399436940637e-01   +8.539275282924471e-01   +2.115444811768023e-01; +6.108059727724080e-02   +2.613819772051608e-02   +5.015481208567362e-01   +5.024022501312670e-01   +4.152716849079410e-01   +6.414681363393667e-01   +6.757887381877598e-01   +2.592971588614730e-01; +2.506854185416592e-01   +6.851494439399209e-01   +1.764148903804593e-01   +8.415973912507108e-01   +3.127199672841942e-01   +4.771333175427121e-01   +3.221883147889955e-01   +2.618524931956759e-01];
L1I_L2I_iGABA_netcon = [+8.465047641144231e-02   +3.280341082882428e-01   +1.567311231429286e-01   +8.008600387025504e-02   +8.570700089345857e-01   +4.419493140850206e-01   +1.263007749034484e-01   +5.017344573429710e-01   +3.942151153802968e-01   +1.395209600174559e-01   +2.993340001207494e-01   +7.396972589352038e-01   +2.607345523231178e-01   +8.763777166564591e-01   +1.368577622362427e-01   +3.368738028828832e-01; +7.768172827965339e-01   +4.175436671267096e-02   +4.093905377249033e-01   +5.984208934570007e-01   +1.582979643687690e-01   +5.265573358882317e-01   +5.312937325847162e-01   +4.711689571468771e-01   +8.252854792138017e-01   +8.339405584599682e-01   +2.117823568375146e-01   +2.018106673783979e-01   +4.350909406321738e-01   +4.665031678976991e-01   +2.432313592249094e-01   +4.623212650241563e-01; +4.583238707969383e-01   +5.248985661534927e-01   +4.735477013809942e-01   +9.257606233381580e-03   +5.501142714226070e-01   +8.044620555326641e-02   +2.290980624984690e-01   +2.347473108466536e-01   +5.312877404364774e-01   +9.008899762927491e-01   +7.589330281167929e-01   +3.913478520292596e-01   +6.157753128131545e-01   +3.267065084895414e-01   +1.064603620433286e-01   +3.512251353579436e-01; +5.157374184072665e-01   +4.270415705623855e-01   +6.898886363839130e-01   +1.259859841656327e-03   +4.654080112381525e-01   +3.162198933448333e-02   +3.270685894378987e-01   +6.535247667195463e-01   +5.508314223277497e-01   +7.507126947624261e-01   +8.178398758066312e-01   +4.501543216672207e-01   +7.048791300008895e-01   +1.136985640185127e-01   +5.134411984724563e-02   +7.527153358609922e-01; +3.688766644259883e-01   +6.445694172891427e-01   +6.470745133392187e-01   +2.611851899872694e-01   +5.330241217160120e-01   +8.470740758669771e-01   +3.511994648430469e-01   +3.139698656210851e-01   +4.290846956903969e-01   +6.558200038024598e-01   +6.689851807582639e-01   +6.284160521578741e-01   +5.977323040903079e-01   +1.678578369168765e-01   +6.875481286703767e-01   +8.633470700252489e-01; +2.845391284855830e-01   +3.724054390158757e-01   +5.696349007302590e-01   +6.969398518097283e-01   +8.492191367128112e-01   +4.952972223883908e-02   +2.037745570098723e-02   +6.575742830346292e-01   +7.582809816291464e-01   +7.664057451373500e-01   +6.557099155888645e-01   +3.489687128070986e-01   +5.102684211195386e-01   +5.624731722667384e-01   +7.383995815808838e-01   +6.809575071523007e-01; +7.644616938069534e-01   +4.179381843119669e-01   +7.591990434721857e-01   +8.980634617444655e-01   +3.004953536627062e-03   +7.849519215741507e-01   +5.791922706078285e-01   -3.043104843506895e-02   +2.050087667940919e-01   +7.431460660309549e-01   +8.343197682826955e-01   +8.520499381202056e-01   +4.983677483107091e-01   +1.573351920174330e-02   +5.462419704785022e-01   +2.670861176557132e-01; +2.664454657105759e-01   +1.516860631383221e-01   +5.695659966261680e-01   +5.075901767333312e-01   +1.651784154443784e-01   +8.072516235601930e-01   +6.867681364276680e-01   +2.465003739988117e-01   +7.592982357187053e-01   +6.029940466702335e-01   +6.815166256954786e-01   +6.270314140101425e-01   +6.654095714585379e-01   +5.164638106641846e-01   +4.982600564962100e-01   +8.538780447245066e-02];
L2E_L1E_iAMPA_netcon = [+3.938208586383249e-01   +4.893797131276780e-01   +7.926823188968166e-01   +2.971081190134495e-01   +5.130358714145333e-03   +5.739900217588416e-01   +3.913750896157142e-02   +4.679418804741270e-01; +3.438404313680470e-01   +1.473131863087587e-01   +4.962522481026335e-01   +4.727293219378415e-01   +2.781260670199485e-01   +8.743609126559923e-02   +7.357753471774481e-01   +7.749703426094207e-02; +5.410479956649772e-01   +1.956455287652814e-01   +4.730243165510282e-01   +7.839191987846924e-01   +6.435462812305724e-01   +7.735038430856456e-01   +7.991887322524882e-01   +8.806336953374039e-02; +6.037600270427212e-01   +2.740191970662391e-01   +6.620725957559093e-02   +1.652567146844330e-01   +3.226728897019560e-02   +8.429919987413729e-01   +3.732483959479456e-01   +8.141303052370763e-02; +4.222372102405249e-01   +6.776910840315197e-01   +7.630780517948228e-01   +6.439608330844877e-01   +4.126928025484792e-01   +5.891862437136299e-01   +5.045871006508999e-02   -1.542401539986522e-02; +7.390185647018128e-01   +9.073177025333262e-01   +3.427689468622367e-02   +8.595318775981766e-01   +5.063425843238796e-02   +6.594573204118908e-01   +4.017380037462490e-01   +7.112093991897981e-01; +1.269775772405822e-01   +7.180442767632698e-01   +3.537220751942149e-01   +5.004945915588569e-02   -9.226681264085887e-03   +7.922062178743556e-01   +5.176464005880386e-01   +7.594829414356336e-01; +3.449498499577623e-01   +8.727830977701944e-01   +4.018860393514532e-01   +7.149247019580164e-01   +5.782012100795737e-01   +5.151425594485356e-01   +7.935532444519187e-01   +4.059311080600552e-01; +2.868322058865077e-01   +1.331512553395141e-01   +4.828785817844578e-01   +2.555292347326176e-01   +8.416697703089170e-01   +7.175343377119188e-01   +2.244991840499590e-01   +6.133660775787239e-01; +3.019234486114842e-01   +7.942244287041360e-01   +7.708260855855416e-01   +7.838176056369790e-01   +8.714526637394822e-01   +2.324700231427812e-01   +4.445046214271992e-01   +2.260835599599272e-01; +6.730553642309247e-01   +5.898504837704245e-01   +8.596102563209335e-02   +7.709953494391007e-02   +3.213404270254985e-01   +6.330681761238539e-01   +5.467954598209555e-01   +1.314910429184656e-01; +8.873017089936452e-01   +3.727455707305067e-01   +2.595600157409477e-01   +5.361824331545914e-01   +7.497308640788571e-01   +8.555818772682821e-01   +5.397192848173438e-01   +7.411268896068373e-01; +4.124767074984200e-01   +7.335985282281523e-01   +7.755127637821252e-01   +3.563391582314950e-01   +7.945041027783398e-01   +5.214934386700824e-02   +6.292068617823607e-01   +8.422708392464171e-01; +4.092552311560814e-01   +3.784010683706633e-01   +6.518539178645710e-01   +3.562534862629873e-01   +1.341479924500324e-01   +7.579846578430588e-01   +8.673575791151077e-01   +2.686603540558056e-01; +6.139310442227235e-01   +7.392552231537133e-01   +8.965338674941284e-02   +2.107248366216163e-01   +3.737456007562971e-01   +8.981338638908971e-01   +5.078958424920320e-01   +1.690804612949429e-01; +5.824244776342974e-01   +6.111682168781953e-01   +4.357334977708573e-01   +1.209043797411850e-01   +4.955893060500405e-01   +2.542590025620556e-01   +5.719728169844900e-01   +9.709809571667544e-02];
L1E_L2E_iAMPA_netcon = [+2.307143951957514e-01   +4.124223339320268e-01   +9.222168807273634e-01   +5.466186299935279e-01   +5.327888552482657e-01   +9.827636036911847e-02   +4.555530947414578e-01   +7.715149497810936e-01   +5.542759301642175e-01   +4.117660525069470e-01   +6.311655318727729e-01   +3.542494429303416e-02   +4.859246257826147e-01   +3.837701367122474e-01   +6.495590071466770e-01   +8.507509082208790e-01; +5.953755806182321e-01   +8.128139802239920e-01   +6.070832618151857e-01   +2.855776680097569e-01   +4.869765753503998e-01   +5.409122120415525e-01   +7.690369313420350e-01   +9.308918553170431e-02   +2.151863844529308e-01   +5.789312792748889e-02   +1.258169330524468e-01   +3.820310978120032e-01   +1.309249780030390e-01   +2.688252785190919e-01   +1.597561715443421e-01   +3.644649297381264e-01; +4.227033565318948e-01   +7.826011443363520e-01   +9.154483455048694e-01   +8.412189985366578e-01   +2.881637142954993e-01   +8.226933486072661e-01   +1.332195970790323e-02   +6.980969729555919e-01   +4.877451314276983e-01   +3.565918440529661e-01   +1.080576727743055e-01   +8.391172422793878e-01   +8.477459224337634e-02   +2.599165937471004e-02   +4.172595435495885e-01   +5.826582959804134e-01; +4.581498770922156e-01   +3.819266218200969e-01   +5.502902067979430e-01   +9.007425392811393e-01   +1.083770212441574e-01   +5.733922023400757e-02   +8.683879110375821e-02   +5.902090321181132e-01   +8.279865828853968e-01   +6.771646186316893e-01   +5.572124000008113e-01   -9.744096226591861e-03   +4.795533862416276e-01   +1.001804957674293e-01   +2.223917597439364e-01   +4.908816868456684e-01; +7.276770203920230e-01   +2.784361369443796e-01   +1.033044508280452e-01   -2.892549066100728e-04   +8.519416112028755e-01   +7.964443267972123e-01   +8.724169326023449e-01   +3.295101520495956e-01   +2.755334734157990e-01   +4.107453482143562e-01   +6.592514810991181e-01   +5.389378375731467e-02   +6.343537158839637e-01   +6.410387248945237e-01   +3.123018652286652e-01   +2.371527567295385e-01; +9.879811066885277e-02   +5.001231348025955e-01   +1.337373848602140e-01   +3.968668222782420e-02   +6.497079217922782e-01   +4.458841513125729e-01   +4.827806454812348e-01   +7.309391636037532e-01   +8.081678005500844e-01   +6.519087552997038e-01   +1.715902200321272e-01   +6.796054757980166e-01   +6.535035924748204e-01   +4.329157670448798e-01   +1.274790043382659e-01   +3.451659561152247e-01; +2.532927248279166e-01   +4.112135169226024e-01   +1.926997542430131e-01   +1.663491844970272e-01   +3.298672712080270e-01   -1.005286287004179e-02   +1.351146598172461e-02   +1.357553513047233e-01   +4.203813001892273e-01   +4.821894777432369e-01   +1.660551451029190e-01   +2.664658676088786e-01   +8.408788300328375e-01   +4.762767296554857e-01   +7.966796296954303e-01   +3.843612331408242e-01; +2.112136871606628e-01   +3.794470108130714e-01   +8.533491899163989e-01   +7.555685394519512e-01   +8.714723906314941e-01   +5.022888458123381e-01   +8.889561582580271e-01   +1.841410194998363e-01   +3.832505745769573e-01   +8.246697118124205e-01   +8.235867738501088e-01   +2.075082202197102e-01   +4.472071536988581e-01   +2.775241109279148e-01   +7.513722835580167e-01   +4.081823741987135e-01];
L2I_L2E_iAMPA_netcon = [+5.262906628273127e-01   +2.363490669520537e-01   +6.496413355436496e-02   +4.355116064915515e-01   +7.251862361051065e-01   +6.400784127800745e-01   +1.001418819301508e-01   +4.579866193504044e-01; +1.508674365392864e-01   +2.282505414563632e-01   +8.302406428823519e-01   +7.169828343042506e-02   +5.742538438105644e-01   +2.691714854932798e-01   +1.444927687023634e-01   +5.435132992619439e-01; -1.576189246821623e-02   +7.660937408832927e-01   +2.825844003244692e-01   +3.335369935013583e-01   +7.732946337381855e-01   +9.005744797920390e-01   +7.189225508135900e-01   +2.950951276439948e-01; +7.514462574170255e-01   +8.507223998471363e-01   +8.832037527044243e-01   +7.336189439829112e-01   +8.107032507193905e-01   +5.139685353349284e-01   +3.807612068909847e-02   +4.013665292297670e-01; +7.230075855803428e-01   +8.152567438500643e-01   +2.098516297978731e-01   +1.000092220565418e-01   +3.558282108655091e-01   +8.263407393117048e-01   +2.363740348557307e-01   +8.001340416242426e-01; +5.402349170471530e-01   +2.506773309919225e-01   +7.045271658465595e-01   +6.202171987197779e-01   +1.562922384706338e-01   +2.502469809249880e-01   +1.774445808648070e-01   +6.670723050061100e-01; +1.401059872170381e-01   +3.751278658515646e-01   +7.739584505194335e-01   +9.461851806709998e-02   +6.196620558397661e-03   +2.753697837467768e-01   +4.482460678020591e-01   +8.355952946341242e-01; +2.343358157220440e-02   +4.443871751677056e-01   +4.888806474357941e-01   +8.607972116437940e-01   +6.286483024743114e-01   +5.747234447101425e-01   +8.903335526761036e-01   +3.065079767007251e-01];
L2E_L2I_iGABA_netcon = [+8.069322064026589e-01   +4.319061775443430e-01   +4.185461012676568e-01   +3.078966648996996e-01   +1.340262958915109e-01   +8.849228000939814e-01   +7.950596167760741e-01   +5.931307323343470e-01; +9.098067029897302e-01   +3.105012009762281e-01   +2.304254803309169e-01   +8.660457396030158e-01   +8.102536153042386e-01   +5.431541431558558e-02   +3.910570907122325e-02   +5.187801815359141e-01; +3.369258043769748e-01   +5.912803900052316e-01   +6.490944220328587e-01   +3.347532113214572e-01   +2.005001399059243e-01   +8.149753341749345e-01   +4.964567471623896e-02   +3.693599562008609e-01; +8.576788139073976e-01   +1.035423448278710e-01   +2.949842029754307e-01   +9.814106886667817e-02   +8.381538037010324e-01   +8.980891590235015e-01   +8.218458709339683e-01   +4.158184039923520e-01; +4.737212712694032e-01   +4.953042722055405e-01   +8.981124734968007e-01   +3.075991666188364e-01   +5.245008050318833e-02   +1.674831162719418e-01   +8.530853739063912e-01   +4.054949530140921e-01; +5.630530293388107e-01   +3.374905746670155e-01   +2.994623146888339e-01   +4.588134471304925e-01   +2.523884047796017e-01   +5.759130005007460e-01   +5.147428986899987e-01   +9.129039536751864e-02; +8.273385866892690e-01   +5.573588067202185e-01   +6.392576336317849e-01   +2.036986867905539e-01   +2.469198727226399e-01   +5.407562699652162e-02   +6.200999847338976e-01   -7.583553642699609e-03; +1.677279010635291e-01   +3.320163644007242e-01   +4.993209955140260e-01   +4.195262205479218e-01   +8.098571521267258e-01   +5.909923500755487e-01   +2.833139450251704e-01   +2.291298527053119e-01];
L3E_L2E_iAMPA_netcon = [+4.732604645620269e-01   +5.567289401091127e-01   +2.255281047579410e-01   +2.707062804283718e-02   +5.237543264272022e-01   +4.795748820483538e-02   +8.163030342458634e-01   +5.841365812922473e-01   +6.696796867735385e-01   +6.082182910227203e-01   +2.161176900904524e-01   +4.765495845200485e-01; +2.630677956584545e-01   +4.818295320690336e-01   +6.030680499923265e-01   +1.368186902795968e-01   +6.973694037597412e-01   +7.717127218463610e-01   +6.291879375111782e-01   +3.229672952724795e-01   +7.486429087228964e-01   +2.414003729579079e-01   +5.857070944139575e-01   +7.080158831893160e-01; +6.035501634173261e-01   +4.095519073928753e-01   +8.099262951008882e-01   +7.746546096296034e-01   +2.686194768466020e-02   +2.435432112687217e-01   +4.650542642636157e-01   +4.989538397576287e-02   +5.302668972352750e-01   +6.599974602440504e-01   +4.804988311723050e-01   +2.640364795969045e-02; +5.856960121619215e-01   +4.820815152950879e-01   +1.365229121833002e-02   +7.602205044872400e-02   +6.913397320814068e-01   +3.162504097012704e-01   +8.572028151641362e-02   +4.727131365733664e-01   +2.370582868302250e-01   +2.645429115381160e-01   +5.400989597551037e-01   +1.270401412942836e-01; +6.016625094369147e-01   +9.080689136793012e-01   +7.424266949689857e-01   +7.829040470291463e-01   +7.026161714756151e-01   +7.977200739030806e-01   +5.855080535839676e-01   +1.610303142245032e-01   +1.082657417166129e-01   +2.191169131760211e-01   +6.817784199218978e-01   +5.397273896502014e-01; +2.060172536079944e-01   +1.659646840462842e-01   +1.622400622242781e-01   +3.607439329849617e-01   +6.839707865240189e-01   +6.078791730806206e-01   +8.735774675984264e-01   +8.179484308658498e-01   +8.744078472499281e-01   +3.616488072753758e-01   +8.183336202710509e-01   +7.513349919283636e-02; +6.933684122458567e-01   +1.040063779502720e-01   +1.101733157042352e-01   +5.935534560449244e-02   +6.371185014047784e-02   +4.265155585830784e-01   +6.597770427678503e-01   +3.077709070536481e-01   +3.537224604418824e-01   +2.643430159155733e-01   +7.940288221940940e-01   +8.713366659366576e-01; +7.489553913322244e-01   +7.236730776289390e-01   +5.820413238471760e-01   +7.823581894086706e-01   +7.149280501245799e-01   +2.576475353962615e-01   +4.604318283295335e-02   +2.596243821607006e-01   +1.819014927554078e-01   +6.755513968842898e-02   +3.853437116576953e-01   +1.413508794079198e-01];
L3I_L2I_iGABA_netcon = [+5.325231419623198e-01   +8.659828448291776e-01   +1.496398646226534e-01   +5.365446226374346e-01   +5.504480277254039e-01   +6.522759122288682e-01   +5.860603409577561e-01   +9.783738564024029e-02   +6.400349407128376e-02   +1.768425844591107e-01   +7.490214213462687e-01   +1.758631990140706e-01; +5.426283645772965e-01   +6.287086981953870e-01   +5.382474523190275e-01   +5.514175042729240e-01   +6.872692547501685e-01   +3.313958842020749e-01   +7.948658062018668e-01   +5.905772813307318e-02   +3.537285798991618e-01   +2.884893515890796e-01   +5.304585317393958e-01   +8.578092130359330e-02; +4.379126581644536e-01   +6.551639608646587e-01   +4.805105559909550e-01   +4.297039439167424e-01   +5.344967272933002e-01   +4.283277276551745e-01   +4.714473653415581e-01   +5.872546031909481e-01   +5.788472206361953e-01   +5.656690925849582e-02   +6.045450408449691e-01   +6.494198014296082e-01; +6.357630642482826e-01   +7.854657882137831e-01   +9.112515676408709e-01   +1.863944269726086e-01   +5.579403413531794e-01   +8.586370567772563e-01   +2.477132910396625e-02   +1.169034254073478e-01   +5.131323843625297e-01   +7.403019116377526e-01   +1.401704334038802e-01   +6.628825597597059e-01; +3.856996603765864e-01   +7.037909277030425e-01   +7.512948638424862e-01   +7.482286439744874e-01   +7.518889597609307e-01   +2.865460608460398e-01   +3.961699714329789e-01   +6.846982687611799e-01   +4.195085642720061e-01   +1.234447911035286e-01   +3.544465465704641e-01   +3.505248561579087e-01; +5.862608989778281e-01   +2.117863859911778e-01   +5.634565220550984e-01   +3.167320436165953e-01   +7.426792992520913e-01   +5.324053262531170e-01   +4.161740850342125e-01   +5.224964181052776e-01   +2.800342067479096e-01   +2.669917353280359e-01   +5.426975731527862e-01   +5.957902379754163e-01; +3.892991609299280e-01   +9.485220907945617e-02   +7.848594450298629e-01   +5.644418013663043e-01   +2.971896124683915e-01   +8.193575729659416e-01   +3.903242527031175e-01   +2.443909260734183e-01   +5.341951426477418e-02   +7.700775580170357e-01   +8.087170809820228e-01   +1.308271119041948e-01; +4.275017160504703e-01   +1.945651930317286e-01   +8.573392566809712e-01   +1.272923199954404e-01   +7.176837055657910e-01   +8.236297630790214e-01   +6.469124412419015e-01   +5.121949899155709e-01   +4.278004662346461e-01   +6.948087148123376e-01   +2.391670316566950e-01   +7.210884136824014e-01];
L2E_L3E_iAMPA_netcon = [+5.297841667478376e-01   +2.168742704352158e-01   +7.648671438179286e-01   +5.456813371544275e-01   +5.159120833395155e-01   +3.927971296843283e-01   +4.441227539539314e-01   +3.098255177899886e-01; +5.009503904090754e-01   +5.368454333517861e-01   +6.071804819871515e-01   +3.452410438479954e-01   +8.298357919860830e-01   +3.400587882693846e-01   +5.808812083088705e-01   +7.860992453445858e-01; +2.335603437949384e-01   +1.805229934650072e-01   +6.043931957300529e-01   +6.357800580468188e-01   +5.390733656944480e-01   +7.579029598094582e-01   +4.961006347887176e-01   +9.292178842973160e-02; +1.692668831081779e-01   +1.928152285374777e-01   +4.342271944423370e-01   +8.079211124397415e-01   +3.430517352152602e-01   +6.548321738338014e-01   +5.485114781422709e-01   +2.397787038858913e-01; +1.576430587671749e-01   +5.684577783415233e-01   +8.592265013762774e-01   +4.371349234599833e-03   +6.188733996442531e-01   +6.342686768178815e-01   +6.747387725045684e-01   +3.160006376765044e-02; +1.621896960686187e-01   +8.920789824488222e-01   +6.445694107729699e-01   +8.351189436553771e-04   +8.467713315686837e-01   +3.048815266883180e-01   +2.881924702451545e-01   +7.187721954467745e-01; +3.015727851195733e-01   +1.944575240873737e-01   +5.392279382244991e-01   +1.274846719758480e-01   +2.395187912383496e-01   +6.466668215997311e-01   +4.935395629139264e-01   +5.223956966835012e-01; +5.223151016898040e-01   +3.366597204946237e-02   +3.832749985918309e-02   +4.728481943895844e-02   +7.518165439400666e-01   +4.643179954516279e-01   +2.233933390867396e-01   +7.986319230832043e-01; +8.103784843537020e-01   +6.226388088576819e-01   +3.065737066404607e-01   +7.594879028038564e-01   +7.908641919576707e-02   +3.736596606350787e-01   +5.290004002022821e-01   +3.622112830062602e-01; +9.278450689798504e-02   +1.760245547264186e-01   +7.497024672274998e-01   +1.100849720304560e-01   +2.435621468767440e-01   +2.584664887535820e-01   +8.400102979853261e-01   +8.432259285807757e-01; +6.023426350607479e-01   +7.288614933482096e-01   +4.824928416463203e-01   +5.479580529678117e-01   +3.739997131373023e-01   +6.178179637624184e-02   +3.425237824955094e-02   +7.410035276123532e-01; +7.093406953976046e-01   -1.705073881834992e-02   +8.204533467947861e-01   +7.830596219500285e-01   +4.995717357247309e-01   +9.605463561727250e-02   +2.366183194590614e-01   +2.582383478715889e-02];
L2I_L3I_iGABA_netcon = [+3.050807957412657e-01   +4.074655495445244e-01   +3.387926924400760e-01   +5.754012808705753e-01   +4.134964132456296e-01   +3.975730607391939e-01   +4.783560603900795e-01   +5.530418972681983e-01; +3.456849378158082e-01   +7.356581758374745e-01   +1.728910822362064e-01   +8.068039379905931e-01   -4.955164099690393e-03   +5.288720092263162e-01   +3.492505692338363e-01   +3.408875151837875e-01; +2.168772772987810e-01   +5.658281010620368e-01   +7.250052909204211e-01   +5.591164620639080e-01   +3.537927149930353e-01   +3.961850069675361e-01   +5.969481279718062e-01   +8.409710649972876e-01; +6.375097377087855e-01   +1.246305155064189e-02   +7.925168615917777e-01   +2.461558654421528e-01   +4.661926154777339e-01   +5.035126621838997e-01   +7.883621297836859e-01   +1.440074782138869e-01; +4.759577342696312e-01   +9.099181750952784e-01   +6.714427490070947e-01   +4.779736148865131e-01   +3.451738573494145e-01   +7.591497775857399e-01   +7.936122246970090e-01   +5.479363789397491e-02; +7.119205281287456e-01   +5.022630013282877e-01   +1.508855434582202e-01   +8.003600231538074e-01   +3.147331117070953e-01   +2.172824978483268e-01   +3.497415146880536e-01   +8.080752719491784e-01; +2.713612529556381e-01   +6.834794384210124e-01   +2.924457908560781e-01   +7.173954416045625e-01   +3.126844276155151e-01   +2.582350298213650e-02   +4.225505075548605e-01   +5.609798151314044e-01; +3.480386327685908e-02   +2.342322641101721e-01   +4.970646659768233e-01   +8.005926028680310e-02   +5.840630429029754e-01   +6.123454383969205e-01   +1.430844967467242e-01   +9.879367439717925e-02; +4.202824030285675e-01   +6.501281491459673e-02   +7.638009973227378e-01   +8.671671301061928e-01   +5.706053937737552e-01   +9.367890155476230e-02   +2.902050857826097e-01   +7.397934789109964e-01; +3.453811171870144e-01   +1.182179550648888e-01   +7.071571410216944e-02   +5.270174897954636e-01   +7.613239608546449e-01   +4.498179290193183e-01   +7.521971740815935e-01   +4.594600660765954e-01; +4.491864174096377e-02   +4.010459808033930e-01   +1.595254795298724e-01   +4.370814737786768e-01   +2.014763325299333e-02   +5.103263362989096e-01   +4.051585376687057e-02   +1.778064380995830e-01; +5.777278042931815e-02   +3.217780620204392e-01   +9.865064767482422e-02   +2.291868758933582e-01   +5.240483648076983e-01   +8.120665772383429e-01   +3.525499341990508e-01   +2.510467489556709e-01];
L3I_L3E_iAMPA_netcon = [+3.725810635565310e-01   +4.324317169839809e-01   +5.934663627059671e-01   +8.338583868854565e-01   +2.627021942840378e-01   +5.650433012129783e-01   +3.098881606120792e-01   +2.077412547790900e-01   +5.637289762988262e-02   +9.124443346894578e-02   +6.222686445753824e-01   +6.412646470706668e-01; +7.083691545932460e-01   +3.354023815979120e-01   +3.517211980119583e-01   +7.893603998479818e-01   +7.479834524027223e-01   +4.253867645828067e-01   +8.195306530151286e-01   +8.723433348058921e-01   +4.123270565082443e-01   +2.251349548222567e-01   +5.461902284880754e-01   +7.596710521182196e-01; +2.695343659166576e-01   +6.723881406138088e-01   +2.339573994487497e-01   +3.078174039658867e-01   +6.435717873880771e-01   +7.315125522300452e-01   +7.192706227417329e-01   +6.932946128987749e-01   +1.747164022301335e-01   +7.120671381806616e-01   +2.774268121091960e-01   +7.854127374534743e-01; +8.564976906596168e-01   +5.271223732310678e-01   +5.280434105559941e-01   +7.378090272688670e-01   +2.852748695054935e-01   +3.899166167215761e-01   +3.879376874318395e-01   +6.982958036131134e-01   +7.240873993898620e-01   +8.552300016613507e-01   +3.999322022781603e-01   +6.770514963585270e-01; +7.508252909533469e-02   +6.956952434884021e-01   +4.016863665369897e-01   +1.065389190162259e-01   +2.399433142811493e-01   +1.839293605919120e-01   +1.320359773142372e-01   +3.491775589932919e-01   +4.669311416498833e-01   +1.723491519918593e-01   +8.410785762825647e-01   +6.330467156437329e-01; +3.487074632589923e-01   +6.739526122840187e-01   +3.498526848905358e-01   +8.369163707990495e-01   +1.709252432868306e-01   +1.018089176983522e-01   +2.755161071829798e-01   +1.224189400343612e-02   +1.658764170067848e-01   +9.111557060842400e-01   +6.554137025522760e-01   +8.068844905456347e-02; +5.645410820185767e-01   +6.951610893942335e-01   +7.234520257649650e-01   +5.548902511796866e-01   +5.127910121101162e-01   +3.530089443828391e-01   +3.045348100597415e-01   +8.440840912084149e-01   +6.337981584831984e-01   +4.001096345090215e-02   +1.459868074819202e-01   +3.857648446992477e-02; +7.972824714862552e-01   +7.784604665057819e-01   +5.024918303715310e-01   +5.841232308493092e-01   +6.959833483094396e-02   +2.380327702670111e-01   +5.271170789617163e-01   +8.349279308490732e-01   +5.535382782056356e-01   +7.794856841414336e-01   +9.687544735490411e-03   +4.572498445060677e-02; +1.687038987175416e-01   +3.362582395173823e-01   +2.970280242487602e-01   +4.362286395673527e-01   +2.725735335239984e-01   +3.846000143308093e-01   +7.834642306269419e-01   +1.448027203198042e-01   +5.539750164929375e-01   +7.371105111366160e-01   +5.961315681434145e-01   +7.785628442080691e-01; +5.844625083025151e-01   +3.163376443270494e-01   +4.830506931733194e-01   +4.044695872185863e-01   +1.446077479637391e-01   +4.656506316058083e-01   +4.529621913190080e-01   +9.241410546160547e-01   +7.572678003079106e-01   +3.020051020086308e-01   +2.909137154433269e-01   +3.103847587600515e-02; +6.213034524712879e-01   +6.598978875084174e-01   +3.984306596407566e-03   +8.284536775148092e-02   +1.805364511845712e-01   +6.379594252009462e-01   +2.418749929766530e-01   +5.561155808441794e-01   +1.067895135155391e-01   +1.659409691662974e-01   +4.419897976139994e-01   +5.898093095176284e-01; +3.326233081506265e-01   +1.501042434872076e-01   +4.006224896324936e-01   +8.379110068139549e-01   +9.062815147098641e-02   +9.221699546239928e-02   +4.558711320377893e-01   +6.044760207457508e-01   +3.389498920009096e-02   +2.206024205199309e-01   +3.337417045272638e-01   +8.020831997902875e-01];
L3E_L3I_iGABA_netcon = [+7.401715852822482e-02   +7.326881101315189e-01   +3.887983419915883e-01   +6.805192107245852e-01   +6.414104662445199e-01   +5.725344638193426e-01   +1.198844450358691e-02   +3.575583038330246e-01   +5.453238140049946e-01   +7.702924527733456e-01   +8.600419114314106e-01   +4.209986044685768e-01; +1.119730539474855e-01   +1.566405467366304e-01   +8.387419501336647e-01   +4.045171660533377e-01   +2.657883639232174e-01   +5.216589625850006e-01   +6.552750245831147e-01   +5.535599213629560e-01   +1.132995177031207e-02   +8.660530702969290e-01   +6.205991502207602e-01   +7.651341126634552e-01; +5.651703296948062e-01   +5.965616134227808e-01   +7.630383260828382e-01   +7.221231031579579e-01   +1.666406995759382e-01   +7.741672234772659e-01   +3.165761846937867e-01   +2.820607607404614e-01   +5.497975757707155e-01   +5.921930911615797e-01   -1.207760943776103e-02   +7.157787835614579e-02; +6.335037351789042e-01   +6.634120545667455e-01   +2.457140568797020e-01   +1.970349680718054e-01   +3.110180324863759e-01   +8.074327871994840e-01   +3.170158271336408e-01   +3.844947481422589e-01   +4.279682161356565e-02   +1.622144705417772e-02   +6.920626608191862e-01   +1.705086407130464e-01; +6.256067495409571e-01   +7.395278259586608e-01   +9.108808577858430e-01   +3.545962038766439e-01   +6.440410471297174e-01   +6.177455220899380e-02   +6.983556775686233e-01   +2.193889877489798e-01   +6.358819618894010e-02   +8.133223476502283e-01   +4.125179690015849e-01   +4.168056011067244e-01; +2.360687085011979e-01   +3.683483564312026e-02   +1.128228226286616e-01   +1.318921996781990e-01   +5.115546633436836e-02   +7.253204125340073e-01   +2.995178953612425e-01   +6.998844225698396e-01   +7.988966623930229e-01   +7.870130044315081e-01   +7.595612141914152e-01   +1.145130163089323e-01; +7.548601553111993e-01   +8.425082260485937e-01   +4.348213718889407e-01   +7.641416244143340e-02   +5.186213883958422e-01   +6.831510204412684e-01   +8.003194131777307e-01   +7.644013832167081e-01   +6.461405589859358e-01   +7.915914599737489e-01   +5.782153871008502e-01   +1.441766665435147e-01; +4.152739377698019e-01   +5.015549497064409e-01   +5.502836736735608e-01   +7.997315187579462e-01   +5.436311228713224e-01   +1.701414752162538e-01   +2.664863150142013e-01   +4.960028712546763e-01   +3.435857813892491e-01   +4.333725040789394e-01   +5.293262900732314e-01   +5.645132439082888e-01; +8.149831380908406e-01   +2.536014169507653e-01   +7.764306473803843e-01   +4.558103161419619e-01   +6.874083680104862e-01   +3.118207555186996e-01   +5.216176545589929e-01   +4.044663925181558e-01   +4.216995379781119e-01   +7.452129302179997e-01   +6.374819308068671e-01   +8.582087328202040e-01; +5.184001647130363e-01   +4.391071573037901e-01   +6.006808355642974e-01   +1.878876834544520e-01   +7.994462565147693e-02   +4.866387560919547e-01   +4.008180829316700e-01   +1.496906425277224e-01   +4.847717513346307e-01   +3.871893362433867e-01   +4.013469585303999e-01   +3.022064616666004e-01; +4.771682351616695e-01   +6.763901626492470e-01   +3.262379573117339e-01   +8.290320719398319e-01   +2.716874766538850e-01   +4.262195584964366e-02   +2.638625554173484e-01   +1.051450896037632e-01   +9.028974285428595e-02   +3.418344437097769e-02   +8.206725580271372e-01   +6.356654631534449e-01; +1.426832818593470e-01   +3.559458751156979e-01   +3.610135673988055e-01   +3.420400522193203e-01   +5.430903851608287e-01   +1.601991064363073e-01   +5.428618082960829e-01   +3.937261270300040e-01   +3.350391109788073e-01   +8.159980369690223e-02   +8.259859380121727e-02   +7.492718563902515e-02];
L2E_Input1_iAMPA_netcon = [+2.174073513694684e-01   +1.240489303517003e-01   +4.473026107809363e-01   +4.130926007360776e-01   +5.075450952079817e-01   +6.337474416043786e-01   +4.981023293021679e-02   +4.954286010267970e-01];
L2I_Input2_iAMPA_netcon = [+4.666260536508819e-01   +3.024453790117699e-01   +8.110668422477322e-01   +8.051054929551053e-01   +4.648013332732760e-01   +4.530547003709560e-01   +6.031542695364195e-01   +7.383760477878206e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
