function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.562917996599485e-01   +3.123897470849011e-01   +7.596760406387876e-01   +4.513553083513154e-01   +1.297559104346820e-01   +6.080119654548334e-01   -1.755781224342532e-01   +5.870159673763330e-01   +2.156154394984397e-01   +1.000000000000000e+00   +1.909528865105789e-01   +5.678241670831456e-03   +1.467838342396504e-01   +4.953735105370101e-01   +4.669949405195082e-02   +9.563125754797112e-02; +5.259279217703713e-01   +5.529599631379543e-01   +4.546914803497699e-02   +7.262440354580959e-01   +4.732008868433837e-01   +4.190093033499619e-01   +4.299881298269312e-01   +3.700104064146443e-01   +6.274770852026741e-01   +8.189204551029720e-01   +5.280361043670511e-01   +5.144373255557202e-01   +3.928781876907383e-01   +8.740704997864367e-01   +4.470075519915821e-01   +1.531886748564114e-01; +6.806248797668443e-01   +1.032741722618829e-01   -1.175626568715024e-01   +2.592600318279167e-01   +2.450024123168053e-01   -6.614148293912139e-02   +6.263657200995131e-01   +2.451223310238522e-01   +5.671492967222030e-01   +5.394764604043318e-01   +3.888051713569568e-01   -4.739880834276543e-02   +5.110607667472958e-01   -1.778260153962521e-01   +3.141157483561357e-01   +3.354348900727869e-01; +6.621892558995962e-01   -2.085421883231237e-01   +1.981624918518435e-01   +7.173421457796665e-01   +3.278988630813023e-01   +4.013445587220975e-01   +6.858590205630732e-01   +7.650473310034864e-01   +4.233508311855488e-01   +5.087595666756564e-01   +6.640153385580224e-01   +5.251139198673876e-01   +2.993385255041853e-01   +5.620487225174835e-01   +3.289755193883078e-01   +3.945986836450813e-01; +7.806649326211753e-01   +1.324928705918060e-01   +8.153884001786471e-01   +7.553607631120927e-01   -8.456923000575402e-02   +2.635346638785699e-01   +2.427100398438700e-01   +8.173375459487316e-01   +4.690675447068531e-01   +4.603302526898398e-01   +6.006246032542411e-01   +1.912926614909014e-01   +3.729116315074135e-01   -2.685463027720808e-03   +4.666680793919649e-01   +2.767621870240625e-01; +2.444595551640276e-01   +6.503764602441788e-01   +4.283996811155640e-01   +2.051271933256898e-01   +8.788460100782339e-01   +1.087270231649947e-01   +9.064933932358143e-01   +1.611244695984411e-01   +3.185689022786459e-01   -1.081953335924327e-02   +1.427373644856092e-01   +4.949271467968702e-01   +7.806723698995869e-01   +1.961754244724615e-01   +2.129616685493514e-01   +1.540615817979777e-01; +5.808105070786723e-01   +6.866440287302439e-01   +3.721379683089204e-01   +3.467788144348781e-01   +1.315304015978508e-01   +2.023851712929748e-01   +9.648791764545171e-02   -1.619999768926504e-01   +7.473095290009126e-01   +4.720528435260961e-01   +3.446094775506689e-01   +6.821876512350875e-01   +3.253595421009221e-01   +2.805745436436605e-01   +7.753286249597011e-01   +3.173646703564901e-01; +4.362181033523914e-01   +6.078419593663795e-01   +1.538251770403407e-01   +7.570650109949900e-01   -2.666552076461213e-01   -8.930481223852900e-02   +6.173260155694956e-01   +6.086306949983430e-01   +4.497802441093282e-01   +6.644311050273661e-01   +2.437754641855845e-01   +4.965044537727402e-01   +6.125562355384883e-01   +5.727463310268658e-01   +8.733832332419260e-01   +5.362708744743794e-01; +1.479855498914125e-01   +5.481948444307031e-01   +1.101022541431165e-01   +4.976962245442267e-01   +3.830186125212025e-01   +7.661034490184383e-01   +7.056203932572908e-01   -3.666849068516023e-03   +2.999681523683785e-01   +6.285636239664567e-01   +7.354706381002586e-01   -8.995768408094261e-02   +4.815566117931217e-01   +5.832242599011521e-01   +4.706186206172684e-02   +1.159561228134483e-01; -1.122189313560939e-01   +4.671877940735160e-01   +8.030177418902993e-01   +8.403793680385763e-01   +5.507299167308737e-01   +1.217176968827179e-01   +6.931165843509464e-01   +5.167318872886510e-01   +2.306889363865274e-01   +2.948272625833213e-01   +4.572951991929258e-02   +6.768296915857995e-01   +8.699522074792880e-01   +1.025132800658563e-01   +4.761878891887756e-01   +5.376910844769571e-01; +1.487742136543582e-01   +4.632724737614600e-01   +6.136508434514122e-01   +4.162346218283404e-01   +6.144110275134563e-01   +6.641193000128984e-01   +5.676387116256214e-01   +5.497261646628598e-01   +5.004966430998010e-01   +4.062721560840379e-01   +5.480148044861555e-01   +4.492144890956769e-01   +1.439455038217901e-02   +5.893747271806306e-01   +3.544006767308705e-01   +5.848780325269270e-01; +7.995353783936091e-01   +3.686781181180531e-02   +2.686323733493101e-01   +1.520971758752707e-01   +2.555348159442627e-01   +5.238549530492608e-01   +3.114816029724490e-01   +3.570161976433422e-01   +7.400276754270583e-01   -1.029159940753525e-01   +2.606780598171564e-01   +7.781342192901145e-01   +2.676992393854130e-01   +8.628268610572509e-02   +1.580148208225888e-01   +5.644426506816899e-01; -8.089190358663620e-02   +3.818462040051938e-01   +6.891772086249175e-01   +5.369644869338330e-01   +8.367896655755974e-01   +5.610853940532112e-01   +3.461878683568154e-01   +4.628648880627944e-01   +8.335246311276777e-01   +4.087236002589352e-01   +1.792829862305377e-02   +1.619722164812245e-01   +7.825029506075608e-02   +7.776732334970751e-02   +4.857993640690043e-01   +3.442570787269421e-01; +3.045442772733349e-01   +4.685074464359106e-01   +4.923800357096829e-01   -1.636518205448582e-02   +2.851719365663092e-01   +6.095751389775526e-01   +4.722702442225828e-01   +5.217550135786019e-01   +2.318892220316553e-02   +3.705976475270794e-01   +4.227221573463886e-01   +5.596005406813166e-01   +9.286744793337943e-01   +4.752512485486388e-01   +8.334446789313663e-01   +4.053861355988289e-01; +6.251114895309088e-01   +6.894876779789028e-02   +1.940513756203258e-01   +6.917386605669197e-01   +4.001969931575662e-01   +4.542290118949570e-01   +5.739830391256280e-01   -4.961746192978374e-02   +1.612599984194731e-01   +4.578191418318664e-01   +3.663514503420507e-01   +6.735501228643486e-01   +7.271914617608545e-01   +7.041691517053141e-01   +6.699914302882319e-01   +2.565110993340508e-01; -3.460261977925531e-02   +3.576538649366344e-01   +7.320457297282090e-01   +4.751232309847349e-01   +6.769584215195508e-01   +7.307651095215901e-01   +1.468233166678924e-01   +8.513514264985524e-01   -8.774525313688465e-02   +6.604525957170896e-01   +4.143545840798557e-01   +3.569006797094759e-01   +1.125311186063579e-01   +6.486137151597426e-01   +6.931196672971903e-01   +4.410128380951518e-01];
L1E_L1I_iGABA_netcon = [+6.857636318566912e-01   +5.153369602136003e-01   +6.009817750742945e-01   +2.508251173765442e-01   +2.734919102659463e-01   +2.104286159015147e-01   +7.002419901875689e-01   +2.315355792942823e-01   +5.416626621967190e-02   -3.054352530220508e-03   +4.329334953855925e-01   +2.816781255899299e-01   +5.637977941943947e-01   +8.838586230379990e-02   -6.345982227309452e-02   +8.858388234597665e-01; +3.652580422059003e-01   +7.432642529075727e-02   +7.306104429959832e-01   +5.119604575314569e-02   +4.130497479478141e-01   +6.415778282430010e-01   +4.418006546478622e-01   +6.402209216323171e-01   +4.722016262632343e-01   +3.537555020866534e-01   +3.983925822807136e-01   +3.193917864100580e-02   +7.999776727056036e-01   +3.468178162552530e-01   -1.250860384035080e-01   +1.801096024672716e-02; +1.934438632876326e-01   +6.088566780784920e-01   +6.213738040603669e-01   +9.316635091370695e-02   +6.231548546943116e-01   +4.472678312483587e-01   +5.853402484963829e-01   +2.855733869905345e-02   +8.015304587732969e-02   +8.556181416616165e-01   +4.310818991666519e-01   +4.764798041615015e-01   +1.079833493685345e-01   -5.552144392897514e-02   +7.293011952187385e-02   +7.868027264464952e-01; +7.567480047151826e-01   +1.353126076306566e-01   +3.525368852370815e-01   +5.347767238872784e-01   +2.454766888810707e-02   +2.422007935207501e-01   +1.575153885519103e-01   -2.713853833115702e-02   +2.212013000588250e-01   +2.230269180924527e-01   +2.681687333277452e-01   +8.305358823128419e-01   +2.441338272910460e-01   +5.885756195933320e-01   +1.640147528897353e-01   +4.301060281453552e-02; +5.350947845459406e-01   +3.068008252762026e-01   +1.228864225322757e-01   +3.200373866503138e-01   +6.803643197719073e-01   +2.761391199491518e-01   +5.377202143006385e-01   +1.621242756201364e-01   +6.194559624136465e-01   +8.508520610706520e-03   +2.289729383493246e-01   +5.414923404893945e-01   +3.261010670481577e-01   +9.067205045079239e-03   +1.526015026680273e-01   +4.780381362994152e-01; +2.464246217517451e-01   +6.625157123676237e-01   +7.121772331836649e-01   +7.183872125411846e-02   +6.249480067341295e-01   +1.224464323819365e-01   +2.509125368104610e-01   -3.797007903610374e-02   +1.690504232878489e-01   +2.230349675152486e-02   +6.291490027563665e-01   +7.493696593867492e-01   +4.442724043002751e-01   -1.107949188976319e-01   +4.434066847031716e-01   +3.277724630839420e-01; +5.948724559705144e-01   +3.090719644351360e-01   +3.026023436120492e-01   +2.500310558866611e-01   +7.154207445227724e-02   +2.845049006091191e-01   +5.451376634872616e-01   +1.876454536044602e-01   +1.393379018785529e-01   +1.484972745630788e-01   +4.000607425503563e-01   +4.899982595830865e-01   +7.667622562440034e-01   +3.550563703631495e-01   +3.589250163832571e-01   +2.959210474639975e-01; +7.842364931415957e-01   +4.944910423302404e-01   +2.282329475779461e-01   +5.781942072385337e-01   +4.187391800613150e-01   +1.930525760012926e-01   +4.095725357250241e-01   -4.038004530804565e-02   +1.000000000000000e+00   +1.609752804983888e-01   +7.064046352525541e-01   +3.862490423336849e-02   +2.374908600275255e-01   +3.758031199254316e-01   +1.132450884323333e-01   +4.509800925865640e-01; +3.996571782602671e-01   +2.485097795385079e-01   +2.034901424197887e-01   +7.083888927604171e-02   +5.473938950591768e-01   +6.901008164093683e-01   +2.507614524685312e-01   +3.773150355364875e-01   +5.134106364909923e-01   +5.263627164046868e-01   +4.582824350477016e-01   +6.342349026764618e-01   +2.347221738089034e-01   +2.936582688521396e-01   +4.135333037381143e-01   +2.869050359545147e-01; +1.017587461477033e-01   +7.435628885892285e-01   +3.782087518861352e-02   +6.272720343618978e-01   +2.400334672927263e-01   +5.806947186633270e-01   +4.525168370269974e-01   +2.612799837702857e-01   +6.133175008490002e-01   -1.640198166285743e-01   +1.343720450301653e-01   +5.261068855894604e-01   +5.652926207494404e-01   +5.421365965544707e-01   +3.363603513590986e-01   +5.218084552506868e-01; +4.752151354954018e-01   +3.067970015122595e-01   +3.141635830996788e-01   +3.050183686657689e-01   +2.431617272023097e-01   +3.418369041084114e-01   +6.217412949157343e-01   +1.016646619648610e-01   +6.365179402987117e-01   +8.650191833889224e-02   +2.404297906389918e-01   +4.631727281400926e-01   +5.452935387681759e-01   +3.038230911591239e-01   +2.419347682829907e-01   +8.107904586989848e-02; +4.140368834144116e-01   +3.371223390513675e-01   +1.094220421823490e-01   +7.157547918402389e-02   +2.795634095672437e-01   +3.030923454739033e-01   +1.648912502122354e-01   +6.234249879769803e-01   +2.252932101619298e-02   +7.132401567549322e-01   +5.050227672021512e-01   +8.703290543033159e-01   +2.086892852120667e-01   +1.628362575147147e-01   +3.765145730742832e-01   +7.579191819837682e-01; +6.120808085569331e-01   +2.452026405517453e-01   +1.490890897740104e-01   +6.619150395689075e-01   -1.161437937476948e-02   +2.375294849908720e-01   +3.860072932152520e-01   +3.991606856151776e-01   +1.007768658816511e-01   -1.846539277935727e-02   +7.914571319675223e-01   +2.968696810130750e-01   +4.782134869403228e-02   +2.176758901571643e-01   +4.929476819520816e-01   +5.768581623926236e-01; +3.332444354461346e-01   +4.046040638940260e-01   +3.008778459649221e-01   +6.283093116115256e-01   +8.474564838826394e-02   +4.048837335601279e-01   +5.951551389195082e-01   +2.532520807536549e-01   +8.031526505745680e-01   +2.040922870301302e-01   +3.184964380959923e-01   -2.797257874414952e-02   +2.844165778108593e-01   +1.231767083253867e-02   +7.994820922416240e-02   +2.341794290468048e-01; +7.435732569280988e-01   +4.073845802105953e-01   +2.147760936123809e-01   +1.977340382280348e-01   -3.000304530104927e-02   +2.864525957526067e-01   +2.102497048489972e-01   +7.278358539077435e-01   +3.982535841104707e-01   +4.418392713238116e-01   +6.620655197062193e-01   +1.626506465757355e-01   +1.015334922858705e-01   +1.518405734280984e-01   +2.366346380565360e-01   +5.637050977504759e-01; +6.069028556446119e-01   +4.308554054158381e-01   +7.790924071280082e-01   +3.417710037289264e-01   +6.808121191031814e-01   +3.362606772143982e-01   +4.859488232977422e-01   +3.492166972078538e-01   -9.194733003990063e-02   +4.403875742894724e-01   -1.377430825000441e-01   +4.838470205343605e-01   +4.172602006218805e-01   +2.737206042489833e-01   +3.976043965237615e-02   +3.698330317206917e-01];
L2I_L1I_iGABA_netcon = [+5.764386003180580e-01   +2.162257657826073e-01   +2.681487439932290e-01   +8.249616321477133e-01   +2.489153979926031e-01   +4.727958895821860e-01   +1.594009144732101e-01   +5.101688654271828e-01; +3.471949098750873e-01   +7.236658537019275e-01   +2.389044044073168e-01   +3.155329695151328e-01   +4.836635475928311e-01   +3.032819422757801e-01   +6.076415736836179e-01   -9.202710399000467e-02; +4.853762482793665e-01   +4.764110434889838e-01   +4.063957320394654e-01   +3.179780669009480e-01   +4.620182083318867e-01   +9.830776077163658e-02   +3.823718837279197e-01   +2.445039119409278e-01; +4.094390556911993e-01   +2.090933470758722e-01   +1.806377616431545e-01   -1.145694570880133e-01   +6.807599863462577e-01   +2.921884912204341e-01   +3.890357387196465e-01   +5.875514688382063e-01; +2.136653389144535e-01   +9.072519930927198e-01   +3.269811704883940e-01   +8.151688022615287e-01   +2.968134501162750e-01   +2.718993369110111e-01   +3.944434760947192e-01   +3.701557953755922e-01; +5.425980516298456e-01   +8.636203484209475e-02   +4.044692250085670e-01   +3.758824286898009e-01   +7.849960705028812e-02   +4.233430558386944e-01   +4.431274176644981e-01   +7.925606235461741e-01; +4.694562186327895e-01   +1.000000000000000e+00   +8.660894335738462e-01   -9.268963929323082e-02   +4.595830879305721e-01   +2.359460581414888e-01   +4.734706241139879e-01   +2.152791386682381e-01; +4.158976218517059e-01   +4.716917723767138e-01   +2.470186292351339e-01   +2.342844111131214e-01   +3.612053027469146e-01   +3.797848279275344e-01   +2.589881323743801e-01   +1.438999519072020e-01; +5.794073228233757e-01   +9.095211748021582e-01   +9.601694767254769e-02   +6.707752602756990e-01   +5.473756260512514e-02   +1.593213664751881e-01   +3.251381767121073e-01   +3.783583678132044e-01; -3.065189802378811e-02   +1.977402882841060e-01   +2.715564180518101e-01   +7.418421480971409e-01   +8.167181435879418e-01   +3.231027371257886e-01   +7.831210057822588e-02   +8.521183183389048e-01; +2.051338788209248e-01   +7.363263904850735e-01   +2.471911331356345e-01   +6.111197267261995e-01   +2.808983520636157e-01   +3.189324118496153e-01   +4.820070551522295e-01   -3.730503869637893e-02; +4.661885272444198e-01   +2.581519186441613e-01   +6.221289988923460e-01   +1.549718120640984e-01   -1.642495096454845e-01   +7.339558267235166e-01   +4.071899649558756e-01   +4.024188061069134e-01; +2.448055688537489e-01   +6.685741412948749e-01   +9.206238986929913e-01   +1.464626702395211e-01   +8.194052271260943e-02   +1.691995963604216e-01   -8.134689331088239e-02   -1.980475643431591e-01; +5.282890194892337e-02   +2.397838640533760e-01   +1.202731850829051e-01   +1.554267006304542e-02   +3.474283466813127e-01   +3.085412893713588e-01   +4.008811641129618e-01   +2.381484289569397e-01; +6.964836158614719e-01   +7.715121861538161e-01   +8.315084281321504e-01   +6.816575191052400e-01   +5.167245773807186e-01   +7.467487187698857e-01   +5.328382948787959e-01   +6.030750465328846e-01; +2.267908725702105e-01   +2.092367766121742e-01   +6.698168611467986e-01   +4.918928771616883e-01   +1.220613837072562e-01   +3.886117036441076e-01   +7.869662576810745e-01   +8.964736375614499e-01];
L1I_L2I_iGABA_netcon = [+5.903702825591326e-01   +5.482339342946076e-01   +3.695273084114997e-01   +5.550124988648246e-01   +3.864827472831533e-01   +1.678682571187886e-01   +6.921167131035215e-01   +4.242411088603411e-01   +4.554513712972339e-02   +5.992939372596696e-01   +4.580800487117657e-01   +2.633721268493170e-01   +6.535578042096344e-01   +2.345933163106323e-01   +3.390397723914708e-01   +4.012087374898815e-01; +4.524653999083827e-01   +7.859110815286822e-01   +1.074426523938437e-01   +1.586389150229037e-02   +3.115475589051048e-01   +5.561713997429130e-01   +8.218766801691688e-01   +1.756951383989896e-01   +7.413659806096673e-01   +7.106087036436988e-01   +4.104882726404877e-01   +2.951795266639987e-01   +3.712272962344112e-01   +2.818853189185441e-02   +7.711497107444797e-02   +4.793040158594859e-01; +2.069590062326795e-01   +2.791974937904643e-01   +2.747499352720133e-01   +4.296912054767477e-01   +5.852519495369763e-01   +8.144268175746340e-01   +5.080811680337555e-01   +7.061414204257078e-01   +6.673028438857581e-02   +2.351310169019362e-01   +2.327112394901705e-02   +5.847140405064446e-01   +4.345054272198964e-01   +7.775743719930618e-01   +3.424859170514201e-01   -6.069400872432847e-03; +4.999303828234744e-01   +4.691018697029269e-01   +2.132899411273842e-01   +2.556144147369898e-01   +5.477103218881200e-01   +3.693319790674496e-01   +6.397190075744574e-01   +6.817114975820058e-01   +2.964064587239312e-01   +2.567637619294594e-01   +2.966688879168037e-01   +1.420636466853930e-01   +4.379733231998970e-01   +1.529655622772187e-01   +4.544786946951854e-01   +1.841083452383588e-01; +6.038115523566377e-01   +1.174945475478428e-01   +4.912647731589723e-01   +8.638617143478308e-01   +1.741346218553804e-01   +8.735922383313878e-01   +6.181275182632191e-01   +2.659330517582963e-01   +5.689305126641839e-01   +2.729658200468679e-01   +3.417286616679280e-02   +4.217667174937111e-01   +1.328672862930692e-01   +4.150403412927715e-01   +4.284539144108453e-01   +4.794716878727980e-01; +1.870819716384415e-01   +3.786820575989858e-01   +1.017438242078510e-01   +6.180980557180589e-01   +1.104834842399594e-01   +4.590276227154718e-01   +6.309098965442267e-01   +7.576398107547998e-02   +2.642898062815684e-01   +4.994676333459962e-02   +5.567669477375168e-01   +1.813269634623004e-01   +5.809089060928130e-01   +5.326293659774380e-01   +1.868019635452298e-01   +4.995741868223645e-01; +5.186076034382792e-01   +5.305070430589101e-01   +2.933461362953957e-01   +4.958025223609779e-01   +8.845454185087573e-01   +2.273141583358473e-01   +6.015537522403326e-01   +2.418115127368468e-01   +3.273262201294930e-01   +7.048491678169010e-01   +2.376008638029354e-01   +5.589225264142705e-01   +4.091297901919865e-01   +2.213812293365560e-01   +1.640227187828789e-01   +4.680389167147311e-01; +5.292400082858202e-01   +2.510562908384710e-01   -9.770111010702916e-03   +4.403397962673337e-01   +7.996985659251973e-01   +5.663969245749091e-01   +3.066932995598938e-01   +3.070017530431846e-01   -3.550627248893504e-02   -8.029377442694600e-03   +9.478530407839734e-01   +3.269429865428280e-01   +5.631873738568923e-01   +1.344842678527977e-01   +7.508278704498300e-01   +2.028976031282622e-01];
L2E_L1E_iAMPA_netcon = [+6.958700539368742e-01   +5.910089900591282e-01   -2.535844463702610e-02   +3.121227316106228e-01   +9.055837830564829e-01   +5.182422972958547e-01   +4.239757539164136e-01   +4.476595568884684e-01; +3.462857098957935e-02   +5.257229186581714e-01   +6.839154871274888e-02   +2.408210354975396e-01   +4.327961407956076e-01   +1.970910294574923e-01   +3.923057955281135e-01   +5.080050511452475e-01; +2.850088781259173e-01   +8.731567702387520e-01   +4.117698505656308e-01   +1.955176253953519e-01   -6.547827039357509e-02   +5.543412189499947e-01   +4.855558802933229e-01   +7.120153693247590e-01; +5.044328475548082e-01   +2.521323713856997e-01   +6.907617595444046e-02   +6.910379284195337e-01   +9.833082063360188e-02   +3.126894319256807e-01   +3.199911990173505e-01   +3.132190630686046e-01; +2.771582005425127e-01   +4.026894855315750e-01   +1.385972052200096e-01   +5.343205816918754e-01   +6.008028744835969e-01   +5.226025831527555e-01   +9.485880731596688e-01   +7.795775898087831e-01; +6.494934312592235e-01   +1.263311970421309e-01   +6.370836713705197e-01   +1.853462399677590e-01   +3.724035582879070e-01   +6.091537409400953e-01   +7.273918706151546e-01   +2.437583418379182e-01; +3.751843933458260e-01   +6.017893835836425e-01   +2.094645900682613e-01   +3.033671854736429e-01   +1.082521652850560e-01   +2.333838498103690e-01   +5.497478625997453e-01   +1.318559444790747e-02; +3.427627494491933e-01   +5.977267185002988e-01   +9.043669404199770e-01   +3.886183242281309e-01   +1.864313445655755e-01   +5.693195215357352e-01   +4.777753564022414e-01   +5.259825888800325e-02; +7.396191545703922e-01   +5.209659996593151e-01   +1.415798059265075e-01   +5.341780018537439e-01   +2.494607878780735e-01   +3.736880095648463e-01   +2.221668865839086e-01   +3.511498944887036e-01; +3.679062194561700e-01   +5.866314099617770e-01   +6.415264939134663e-01   +2.708895465554620e-01   +3.527462655740133e-01   +2.938730794849106e-01   +6.377634259354119e-01   +6.434123387583934e-01; +8.160561123978784e-02   +4.145790860950504e-01   +4.609479491669090e-01   +4.169980407256406e-01   +4.568038990274229e-01   +3.119493592486328e-01   +7.735983934306713e-02   +6.583051993353333e-01; -4.660355842100984e-03   +3.183643746050973e-01   +5.509144483238149e-01   -2.419839629675109e-02   +3.248437573405404e-01   +3.409690720341523e-01   -2.019441880254473e-01   +2.740553102618702e-01; +1.165211032570209e-01   +4.328628734488813e-01   +1.608253958078282e-01   +5.104154851782686e-01   +6.712340665292742e-01   +2.112482478154238e-01   +2.665754677468654e-01   -1.133637766443079e-01; +1.717363057955334e-01   +3.545369179829620e-01   +2.450415009618045e-01   +7.378499348503355e-01   +4.737881893818925e-01   +3.198368557214606e-02   +4.851512179715154e-01   +4.337259695283046e-01; +1.785035312446262e-01   +1.781100865198010e-01   +8.607295813469553e-01   +3.468670638643513e-01   +3.054236516233574e-01   +7.245773281839276e-01   +2.973480814898784e-01   +5.712589913617505e-01; +3.644311623582055e-01   +1.542514844460904e-01   +1.844923077118225e-01   -6.482527666625482e-02   +6.322628370380547e-01   +4.243592145710766e-01   +2.999340890959856e-01   +7.923946730870870e-01];
L1E_L2E_iAMPA_netcon = [+2.100461493011092e-01   +1.119281029332989e-01   +8.647264808430950e-02   +5.228472622522327e-01   +2.188736872715882e-01   +2.788530154259145e-01   +4.248992454171442e-01   +3.524646218847919e-01   +5.704384113182343e-01   +5.642083896032332e-01   +4.635506206458745e-01   +5.364974421471684e-01   +4.461044681582181e-01   +1.177661156585352e-01   -1.416686366631949e-01   +2.652460545334002e-01; +4.248430331317395e-01   -3.817226506359958e-03   +1.811323715949740e-01   +4.597928915333134e-01   +4.031286584920403e-01   +3.797643324080525e-02   +2.250215454314344e-01   +3.892332674383653e-01   +3.286448165480946e-01   +1.512484284549891e-01   +5.165974063396319e-01   +6.432524881722602e-01   +2.514439348939257e-01   +1.734252507899015e-01   +5.725305568579304e-02   +3.941500350623171e-01; +8.762431038405988e-01   +6.047237063966192e-01   +1.244171892405948e-01   +1.127406607886379e-01   +4.939644347437059e-01   +7.030324363627773e-01   +4.177193283922699e-01   +7.934362232158998e-01   +4.718697135483851e-01   +3.467743473111100e-01   +1.902889835957687e-01   +3.478848907923955e-01   +7.417532013144690e-02   +3.246440757429320e-01   +5.385764039625178e-01   +1.020284170038296e-01; +4.036308391989372e-01   +5.388609420802688e-01   +5.743344091470999e-01   -1.437737580924850e-01   +3.980146665553865e-01   +2.911899417753969e-01   +6.845102093452687e-01   +2.695773249618063e-01   +3.481661543509970e-01   +4.535323875326076e-01   +6.570625880649640e-01   +2.685210044570470e-01   +3.253462540223777e-01   +3.337246650525073e-01   +6.354123579713965e-01   -9.218968474399157e-02; +2.531556678503096e-01   +6.803674437429756e-02   +7.293487023264215e-01   +4.138944528910117e-01   +1.774514993009387e-01   +7.437642551572778e-01   +3.788112899228607e-01   +4.419095112840661e-01   +8.801226260748619e-01   +1.669793523878832e-01   +3.718458727503680e-01   +1.460588987717612e-01   +4.027503376346721e-01   +6.271190850219830e-01   +8.065378232829635e-01   +3.229586632380060e-01; +5.252453182267041e-02   +6.134480116389173e-01   +1.610217204693957e-01   +3.747960174569081e-01   +2.021314007915563e-01   -1.148194063630715e-01   +4.724879346775706e-01   +5.490752986417448e-01   +6.409438575077137e-01   +3.733516072515667e-01   +5.797105824554332e-01   +2.663274222762943e-01   +2.286544305546827e-01   -8.680636714739025e-02   +6.666959985189400e-02   +1.375211098255925e-01; +1.058889932293336e-01   +1.032756323006059e-01   +5.827273825839174e-01   +7.518432358542968e-01   +2.984334937090644e-01   -1.673937381178374e-02   +7.502675357098014e-01   +5.742765914777807e-01   +1.214218291332251e-02   +7.898666584465768e-03   +2.439875578324544e-01   +7.543270186108120e-02   +2.579480772795599e-02   +1.851548391347996e-01   +3.590792224164780e-01   -8.202726900629839e-03; +2.072479513613550e-01   +3.447639837513587e-01   +5.990060222899624e-01   +4.448258692181378e-01   +7.566054094101600e-01   +1.000000000000000e+00   +6.204508041902828e-01   +2.110976803130690e-01   -5.423493751826112e-02   +5.274706669876371e-01   +8.020300369066691e-01   +2.584236404621236e-01   +4.701301090622318e-01   +1.418779316891608e-01   +3.279829962242885e-01   +2.905657870633166e-01];
L2I_L2E_iAMPA_netcon = [+5.141561527384331e-01   +8.258824282306496e-01   +4.775385113374109e-01   +4.317759753329602e-01   +8.199883236629502e-02   +9.789331594735154e-01   +4.179226094969200e-01   +4.847205517838292e-01; +7.289434057591204e-01   +2.533638493945279e-01   +9.119311244706938e-01   +8.094381309983312e-01   +7.414028691480253e-01   +1.508847756154717e-01   +3.456500026635523e-01   +4.232114248212983e-01; +8.164356991931297e-01   +1.728137966365595e-01   +1.944263913065810e-01   -1.665845541272828e-02   +3.610364902188328e-01   +7.695113123349689e-01   +4.817690461261394e-01   +4.975754300511171e-01; +3.035374965310850e-01   +6.195003874129258e-01   +4.056108336973330e-01   +1.000000000000000e+00   +4.973511193253774e-01   +3.376518292689492e-01   +2.267627295256469e-01   +5.284670365738598e-01; +6.654642811260997e-01   +3.820862225314712e-01   +4.780150709313224e-01   +7.418318209135780e-01   +7.322721231256728e-01   +6.873894009899729e-01   +9.018908573590951e-01   +2.578780313451552e-02; +3.263864710836106e-01   +6.102129436107561e-01   +2.922738340132041e-01   +8.004648345031625e-01   +1.465311235772331e-01   +2.736130016680748e-01   +4.715531244336696e-01   +4.290034289376528e-01; +5.695687547830042e-01   +3.451500295500763e-01   +1.913805766803668e-01   +8.256557786656268e-01   +5.656783996394036e-01   +5.164177511506473e-01   +8.143195702265633e-01   +2.606260106231405e-01; +7.399751181652874e-01   +3.420471811215741e-01   +1.111255330763994e-01   +4.979314822555611e-01   +7.126029756073395e-02   +8.154952431396849e-01   -3.111301228801135e-01   +6.457099082574798e-01];
L2E_L2I_iGABA_netcon = [+2.682437727852628e-01   +4.080327613466910e-01   +2.524064146905619e-01   +1.801434359080407e-01   +2.687198952332293e-01   +3.662055881521190e-01   +4.752616419588004e-01   +6.728965278916165e-01; +3.859039618528357e-01   +7.799631945949641e-01   +5.018682925404712e-01   +3.426697455618007e-01   +6.272190435249230e-01   +5.510696379329515e-01   +8.451335424716994e-02   +2.520598770461829e-01; +3.644478811994573e-01   +9.727526559870506e-01   +4.661111485081943e-02   -1.835327989580331e-01   +4.704802159734793e-01   +7.702835228431711e-01   +2.470514569924878e-01   +6.242891707470605e-01; +4.625563146587552e-02   +8.507999526433423e-01   +5.677021981114077e-01   +5.831273902042623e-01   +9.303990796761503e-01   +6.419948637587178e-01   +1.162141393352981e-01   +2.368055104435152e-01; +3.403083508801041e-02   -6.325965468946956e-02   +2.306066936978258e-01   +6.480488592221698e-01   +7.811350106873207e-01   +3.965059662963736e-01   +2.332881732193532e-01   -8.062761034088861e-02; +2.350533417850622e-01   +3.975150159142127e-01   +2.822409685013305e-01   +8.002484948915008e-02   +6.468956725964328e-01   -2.767261872421607e-02   +5.497395122641590e-01   +1.195424326682080e-02; +7.727955878929695e-01   +5.849658892998944e-02   +9.217015537675684e-03   +3.489852345392234e-01   -4.660214210096957e-02   +9.969701129007939e-02   +6.400841357133814e-01   +7.970156552191886e-01; +3.458598094953476e-01   +6.556591157839727e-01   +6.213032343317761e-01   -1.217434895391622e-01   +8.445826641837749e-01   +6.443035770047476e-01   +5.828900653682956e-01   +6.226087820039407e-01];
L3E_L2E_iAMPA_netcon = [+1.102477786620458e-01   -4.784818275365257e-02   +3.371110527743914e-01   +7.370655711806287e-01   +2.666943629823574e-01   +2.212730601497676e-01   +5.579915047619058e-01   +7.219539113418333e-01   +4.619387608552299e-01   +3.444544892929108e-01   -2.915914039746508e-03   +6.137332943758637e-01; +5.871718226395178e-01   +9.270128632859870e-01   +1.098163590907369e-02   +1.182425196638096e-01   +3.150667149613031e-01   -2.067176550593008e-02   +3.426012089600000e-01   +8.172795785353570e-02   +8.165689961155151e-01   +1.035504079970893e-01   +6.245130543642188e-01   +2.594558154840387e-01; +6.227395297652880e-02   +4.477996213814752e-01   +6.542794721713155e-01   +3.936103813274788e-01   +8.765529395779581e-01   +4.998781845975693e-01   +8.516225242456841e-01   +4.110518014008840e-01   +6.361027551072136e-01   +2.163580740275935e-01   +1.285150917036028e-01   +6.385285046581443e-01; +4.652519975137665e-01   +3.155945971485368e-01   +6.800472046423325e-01   +3.503338131416804e-01   +5.407198942126499e-01   +4.346476343052421e-01   +3.176507941211770e-01   +3.692258364539650e-01   +3.847987229243371e-01   +6.416702370726327e-01   +8.307007487109404e-02   +2.110821346519822e-01; +6.611392443402702e-01   +3.409071362936575e-01   +1.165828776267892e-01   +5.022578778689951e-02   +6.438869564219784e-01   +4.503312878961027e-01   +1.155890820898301e-01   +1.946894532046702e-01   +7.305888342205121e-01   +5.594761229543900e-01   +6.807043595933868e-01   +8.102588810566365e-01; +3.840414297358513e-01   +7.187532956792296e-01   +5.767293888263305e-01   +1.877627736280784e-01   +4.531508338255960e-01   +9.313034818541264e-01   +1.075065306028327e-01   +2.367830262975303e-03   +9.364295270319380e-02   +6.485138250467288e-01   +2.356485481475363e-02   +3.903637257305624e-01; +2.426628816862214e-01   +4.538526370730309e-01   +7.017853241642711e-01   +2.056381837679458e-01   +2.468065361690915e-01   +8.083254902502739e-01   +5.603273120047673e-01   +6.714090896436977e-01   +4.639991819731981e-01   +5.429068970669466e-01   -1.333943577711131e-01   +1.472008732218031e-01; -8.640206242823800e-02   +5.754873331402340e-01   +1.114841010954780e-01   -2.583331936855577e-02   +4.407885647795287e-01   +1.061137461869654e-01   +3.883459409850231e-01   +7.006433967466506e-02   +9.675006907567341e-01   +6.393833591185492e-01   +7.007517248705340e-02   +4.489265619980500e-01];
L3I_L2I_iGABA_netcon = [+7.628695161629806e-01   +4.320593912815535e-01   +2.325239782022550e-01   +7.449125277022394e-01   +1.007850417753083e-01   +2.432830568646763e-01   +6.947626772935707e-01   +5.032585960009232e-01   +6.698113069763175e-01   +9.887504953982328e-02   +5.876621777595158e-01   +7.404109892576852e-01; +4.829090509730606e-01   +2.656093093770289e-01   +3.711540341911366e-01   +3.117011262385049e-01   +9.703795438974296e-01   +5.751187441118769e-02   +5.851026716658860e-01   +1.548978077760382e-01   +5.396107520990626e-01   +4.303460319876311e-02   +4.445878707416731e-01   -5.594353033696780e-02; +4.829479436732051e-01   +4.906787461555171e-01   +8.203599063910604e-01   +2.682724935851162e-01   +1.966671733791214e-02   -8.786080748991201e-02   +5.623688701810109e-01   +8.028216945922219e-01   +9.662367721397910e-02   +1.391575082364092e-01   +9.393039301259012e-02   +5.691573918870635e-01; +4.080180658874863e-01   +6.998455575978147e-01   +6.148407360850525e-01   +8.457917368297455e-02   +1.008084748598270e-01   +6.585810564280753e-01   +1.880891629727649e-01   +2.753728329322527e-01   +3.965915862162050e-01   +7.481046975763987e-02   +6.949088843812454e-01   +5.229128627484074e-01; +2.226831126869449e-01   +2.432840959001774e-01   +3.514648432456631e-01   +4.484135101365824e-01   +6.543457269253287e-01   +9.199755307266652e-01   +1.198006405930671e-01   +7.896814928073915e-01   +7.690363594785141e-01   +2.555237616046530e-01   +2.504367687151767e-01   +8.302212503631328e-01; -7.425175363030133e-02   +7.013523456476830e-01   +3.098053080113679e-01   +5.652028482179782e-01   +9.322363188671570e-01   +4.800518050801708e-02   +5.033350023324790e-02   +6.324449733172105e-01   +2.791782400142034e-01   +1.810337220354010e-01   +2.426881873426316e-01   +8.448545563394597e-01; +7.942732752505388e-01   +5.047830346405117e-01   +5.730086222544386e-01   +2.589179150539147e-01   +1.278419434591005e-01   +2.828069742593186e-01   +9.464680583354972e-01   +2.087425065374799e-01   -1.126134303139466e-02   +4.517433406639769e-01   +4.888040605563654e-01   +1.890236210097063e-01; -8.657226351972930e-02   +4.979054567619400e-01   +8.813869750337899e-01   +7.902516516086593e-01   -1.014915095636365e-01   +6.500967746110486e-01   +3.456268013256052e-01   +2.707937548972624e-01   +6.329447299467204e-01   +5.585264702849583e-01   +3.341107365511076e-01   +5.422812768855655e-01];
L2E_L3E_iAMPA_netcon = [+3.854550391874197e-01   +9.292933583880687e-02   +1.524591062819473e-01   +2.902779072970696e-01   +1.305355884236468e-01   -2.906260850914523e-02   +3.927200913279768e-01   -2.120366584235318e-01; +3.862766882177441e-01   +8.047710567221895e-01   +4.099919351056829e-01   +5.210411006120318e-02   +7.752451695036393e-01   +5.121526516876714e-01   -8.153050036304857e-02   -1.153940292471454e-01; +3.553329776512787e-01   +2.062238549324436e-01   +6.338646301334353e-01   +8.660304336760296e-01   +5.198112986508510e-01   +3.550671056584162e-01   -2.466598622235408e-01   +3.584063896582593e-01; +4.457622426516907e-02   +4.974230824027878e-01   +6.246746194519818e-01   +5.409516602676072e-01   +6.547249052035995e-01   +4.513179066281641e-01   -1.815852621434734e-02   -3.391751864569920e-02; +1.260188120558208e-01   +3.920514984308948e-01   +3.861178165525366e-01   +8.337608181426389e-01   +7.608084321864875e-01   +1.155655254728821e-01   +9.394890379018581e-02   +5.815946190817630e-01; +5.456511699813672e-01   +7.591454081830608e-01   +7.888836914975991e-01   +5.717645451082087e-01   +2.361902792348242e-01   +4.484999669196356e-01   +9.338261643919235e-01   +5.388082340660131e-01; -1.585116521207738e-01   +3.598193061379670e-01   +8.645062465909925e-01   +9.075768866427889e-01   +4.056045041442337e-01   +4.170791260600934e-01   +4.708657724700431e-01   +3.346424253249958e-01; +6.479260103587148e-01   +3.510465011230554e-01   +2.249921514437418e-01   +4.601620113500336e-02   +5.282242526563290e-01   +4.927931318510858e-01   +7.507392543640756e-01   +8.523752923871034e-01; +7.728591026147152e-01   +1.559406054908753e-01   +5.829056720847094e-01   +2.949399872105469e-01   +2.831982112148786e-01   +1.540864809344166e-01   +7.642339049731917e-01   +3.442372279000308e-01; +7.026342505806227e-02   +5.437977772298859e-01   +1.403143272706286e-01   +6.825946844982752e-01   +1.734684860210661e-01   +1.570862533530419e-01   +7.800900911612887e-01   +4.044762324697467e-01; +6.678573935537081e-01   +1.720962678468382e-01   +4.287352140197213e-02   +5.163387429731712e-01   +7.913354848742959e-01   +9.699846545971353e-01   +9.458938402558142e-02   +8.409525847341843e-01; -1.204167465598034e-01   +6.599010378016602e-01   +8.562772163758363e-01   +4.436177349916798e-01   -1.654664208376913e-01   +9.598312506352718e-03   +1.203455676186659e-01   +6.161776661037847e-01];
L2I_L3I_iGABA_netcon = [+2.561458391422148e-01   +7.987281423494103e-02   +9.070555189355753e-01   +9.113040086968296e-01   -1.197277152854508e-01   +1.794556481440285e-01   +3.549960785357175e-01   -7.013934969956212e-02; +1.748646335623625e-01   +3.690892288749414e-01   +4.353728792225553e-02   +1.261570988205304e-01   +4.444503008652383e-01   +2.240335419963830e-01   +5.002738366090754e-01   +3.097985694787281e-01; +5.842077418481991e-01   +2.677148441212552e-01   +4.199038110316375e-01   +3.016721931189110e-01   +7.523163512057557e-01   +8.303349477200764e-01   +3.429286652631562e-01   +4.999145296360736e-01; +2.879376263529557e-01   +2.378430832468195e-01   +7.322804595581686e-01   -2.362695514990067e-01   +7.696370974521324e-01   +3.165258596530949e-01   +3.774839441276168e-01   +5.084450965587678e-01; +8.903466423845969e-01   +1.000000000000000e+00   +3.745018256245653e-01   +1.300084712724083e-01   +5.065905145074208e-01   +7.848262122819202e-01   +5.351559613959536e-01   -1.150093893132198e-01; +3.469759958493566e-01   +5.181713475896006e-01   +9.009838111234811e-01   -1.730181986451672e-01   +5.012270683563853e-04   +7.317044471190998e-01   +5.419470521608102e-01   +3.038391246212567e-03; +7.632670353041682e-01   +6.870712363986458e-01   +3.370261350278395e-01   +8.345022813089772e-01   +2.050584742998534e-01   +5.831960123927197e-01   +8.609843203816985e-01   +3.432212551213289e-01; +1.749864333583118e-01   +6.015504754225317e-01   +4.141921714980048e-02   +2.403779191795994e-01   +5.240886178937191e-01   -5.649279100066084e-02   +2.732409669254929e-02   +3.747846781555961e-01; -8.210118518354970e-02   +4.287686726233779e-01   +5.067056706391866e-01   +1.776982122582354e-01   +1.928717127808765e-02   +7.041040557288766e-01   +5.961657130156796e-01   +5.384020833976391e-01; +5.908895032198808e-01   -2.033161132873464e-01   +2.598598920823840e-01   +4.971553043384586e-01   +3.966691995160048e-01   +8.135217277626059e-01   +3.173828550758443e-01   +3.198910898806679e-01; +3.224027755860243e-01   +4.605963524505730e-01   +3.119733781234388e-01   +2.114090138990291e-02   +6.146171374233106e-01   +3.071725036338349e-02   +2.164288258222774e-01   +9.156339008060865e-01; +2.698093040284984e-02   +7.515453976717265e-01   -1.794539024126009e-01   +4.573080631729483e-01   +9.542541773932975e-01   +4.330433400189212e-01   +2.802439808141129e-01   +2.163091246157962e-01];
L3I_L3E_iAMPA_netcon = [+7.286577682182005e-01   +7.964943587537757e-01   -7.823778365459384e-02   +7.062676510761213e-01   +1.159338505783195e-01   +2.547476394208991e-01   +2.341401852328274e-01   +1.529155284954881e-01   +3.878831496439591e-01   +4.592260974372906e-01   +3.304845877120306e-01   +4.560150945514641e-01; +5.187263543547960e-01   +7.063644303533076e-01   +6.849128851044848e-01   +4.673898750345965e-01   +8.790763968709094e-01   +3.885574327507955e-01   +1.527893090277155e-01   +6.350574741860524e-01   +9.411997944207103e-01   -7.227156814974943e-02   +3.198917174454952e-01   +3.052748040252338e-01; +3.863040824133524e-01   +7.589021193880615e-01   +8.282006432642938e-01   +4.002711630590933e-01   +6.982267504191213e-01   +7.964125348293541e-01   +5.164046452523628e-01   +4.643610401114175e-02   +3.408568356823940e-01   +5.824680149362674e-01   +2.764312048148934e-01   +9.770498561065390e-01; +6.322646404993040e-01   +7.560408414635755e-01   +3.033079125269385e-01   +3.415357813704612e-01   +7.885186458921203e-01   +5.292793751563646e-01   -5.330410353089733e-02   +2.053744746255137e-01   +2.008935639211332e-01   +2.657047725457376e-01   +5.468333255345325e-01   +4.353432440769568e-01; +6.685769832906112e-01   +5.233271313858852e-01   +6.679212315695001e-01   +7.271167732278265e-02   +7.012940338727259e-01   +3.070255483741166e-01   +1.792264477408725e-01   +4.249846478873749e-01   +5.857674675289984e-01   +7.387841907624683e-01   +9.486313774505486e-01   +3.130464280844920e-02; +1.255461685089556e-01   +8.970704744669875e-01   +6.133121522948877e-01   +1.935408165958429e-02   +2.858545319307974e-02   +2.541995004543122e-01   +3.481852218297407e-01   -1.076357938974214e-02   +4.783221876314387e-01   +7.522613758044719e-02   +4.631653652395815e-01   +9.934921061466304e-02; -2.775040728669729e-02   +1.738399653707536e-01   +1.563110766929128e-01   +2.357171741212708e-02   +3.214803234889054e-01   -1.695623124412972e-01   +5.763949740815337e-01   +4.004277270549826e-01   +3.643231425042219e-02   -1.408885212778707e-01   +6.257948268943044e-01   +3.290483845725525e-01; +8.345986058441094e-01   +5.704693629638578e-01   +5.489169849823601e-01   +7.463199970467286e-01   -1.202105583208768e-01   +3.296497444110040e-01   +2.263517472493390e-01   +6.447760632187535e-01   +1.727154094124966e-01   -1.727831015779652e-01   +1.627946887250637e-01   +5.409445865292569e-01; +1.308299771196641e-01   +8.834679043186027e-01   +2.263418874827957e-01   +6.620511350709311e-01   +4.817619545908430e-01   +2.111130978854454e-01   +1.559985470133255e-03   +5.601611931369579e-01   +5.579100115945201e-01   +7.226787673369969e-01   +2.893133031475925e-01   +7.175624695680876e-01; +7.386403597003719e-01   +6.512217419804156e-02   +5.965815684878286e-01   -1.392575028880098e-01   +7.931150005696579e-01   +9.514955758919634e-03   +6.216751902247695e-01   +2.943132199890405e-01   +4.406635581754540e-01   +2.836107079817354e-01   +8.756278683799332e-01   +1.405530648965817e-01; +7.224734310720063e-02   +5.473665067839375e-01   +4.479158563904852e-01   +4.219386968563681e-01   +9.350326136294173e-01   +3.199927419936421e-01   +4.601685483757166e-01   +7.126565974223247e-01   +8.292921283977828e-01   +4.541517966547360e-01   +7.371574436707122e-01   +8.726568089104544e-01; +5.736684105610237e-01   +5.112702592081865e-01   +2.073045572661368e-01   +3.993355413300428e-01   +9.549152734538094e-02   +2.121100910753261e-01   +5.258989466999352e-01   +2.474806924647541e-01   +7.596061462119682e-01   +1.391956779003099e-01   +5.999112358486709e-01   +4.236746266360074e-01];
L3E_L3I_iGABA_netcon = [+1.474365115404231e-01   +8.369376202526184e-01   +5.999608956683391e-01   +2.523902899694735e-01   +2.981885413517358e-01   +9.490174723472253e-02   +8.447169004962593e-02   +4.050026526563960e-01   +1.042335187129936e-01   +7.118304372840936e-01   +2.689582197570430e-02   +1.892013273985818e-01; +8.108788085665969e-01   +5.590414428126023e-01   +7.079894556530908e-02   +2.150376454377089e-01   +5.213945431182530e-01   +3.407358795252066e-01   +2.920321800682645e-01   +5.722574972893624e-01   +2.719872670109130e-01   +4.289667055467948e-02   +1.296817456243044e-01   +3.973993505956352e-01; +6.023272716121579e-01   -4.685581591293588e-02   +6.304177685959930e-02   +4.890671026014518e-01   +6.085932332988265e-01   +5.706629600258353e-01   +4.725204102666672e-01   +3.489135997558317e-01   +2.639308487500792e-02   +3.610506612314740e-01   -1.177620840582275e-01   -8.510654910721704e-02; +3.905908056608156e-01   +5.736037590865906e-01   +1.239129703063469e-01   +7.635666832070941e-01   +6.312535246774572e-01   +3.896960417759203e-01   +2.452773599624590e-02   +4.123514045721432e-01   +4.647651042624413e-01   +3.788053727856643e-01   +5.534127171985939e-01   +6.115760195211045e-01; +5.959416558576769e-01   +4.292277371767532e-01   +5.996939345767586e-01   +9.646845089256223e-01   +2.505465190809467e-01   +6.580943420604216e-01   -9.106903375567056e-02   +8.417282030287140e-01   +5.574093106027769e-01   +7.063972623636187e-01   +6.552655864943787e-01   +1.638294151594861e-01; +2.107082660171029e-01   +3.761508637007667e-01   +7.594680272227103e-02   +9.733069581501219e-02   +4.639908999236217e-01   +8.631110681413512e-01   +2.720951757862666e-01   +3.468691608258641e-01   +7.051457710327755e-01   +4.311276078076202e-01   +5.763174891805707e-01   +5.079180184337159e-01; +2.649273664572678e-01   -2.018336720047779e-02   +4.461299476598496e-01   +8.327186932664660e-01   +6.698341640990326e-01   +3.373966975912157e-01   +7.548061600178548e-01   +6.377671176182520e-01   +3.598932762097179e-01   +6.631566141769607e-01   +7.636597491830388e-01   -2.580496721685714e-02; +3.720095218433346e-01   +2.847540474292520e-01   +6.033931508372181e-01   +5.821453655457347e-01   +8.918985581512402e-01   +1.030460395416099e-01   +4.541043960289053e-01   +1.010490513940157e-01   +2.480094045073080e-01   +4.667400298183262e-01   +5.864163658360727e-01   +3.533329920280161e-02; +2.931970456655023e-01   +6.976628059747199e-01   +4.896212385093927e-01   +3.824932625828510e-01   +5.136845944549585e-01   +2.532373142410403e-01   +2.131278832136341e-01   +4.698603746191727e-01   +6.029535002129656e-01   +5.176692670024938e-01   +9.156096391345843e-01   +4.976516480970467e-01; +1.644582789150311e-01   -1.814331699359838e-01   +6.691241701838631e-01   +3.541943586058537e-01   +1.358948192880662e-01   +5.578055772497451e-01   +5.480549937533096e-01   +6.944977481477898e-01   +2.862781379415031e-01   +1.907934767179698e-01   +3.187195023659135e-01   +9.798036890621247e-01; +7.089939498836866e-01   +1.377122752557041e-01   +2.725036719076580e-01   +1.180764114631204e-01   +2.937959736961505e-01   +2.525923541053725e-01   +1.395745602168079e-01   +6.251922237978165e-01   +2.148942747958298e-01   +6.244871380951283e-01   +9.432240635338035e-03   +2.660363121410108e-01; +5.120486475631101e-01   +4.495948601845096e-01   +9.449052358588823e-02   +9.013621508901811e-01   +7.126676295017950e-01   +5.733654268263189e-01   +6.067050440890375e-01   +9.209697174018552e-02   +2.028753350220602e-01   +1.409780928472828e-01   +3.688098512787693e-01   +1.999339654875134e-01];
L2E_Input1_iAMPA_netcon = [+6.688512795144380e-01   +7.893871928553615e-01   +1.000000000000000e+00   +9.483546356976996e-01   +6.487718114949632e-01   +9.367217926332022e-01   +8.103904064258309e-01   +6.300729496765946e-01];
L2I_Input2_iAMPA_netcon = [+9.065116149156087e-01   +8.700497807378502e-01   +9.941210780776082e-01   +8.386621395779235e-01   +5.904312728124054e-01   +8.395306428422800e-01   +1.000000000000000e+00   +6.659985417574578e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
