function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.498680306277629e-01   +1.698425376109115e-01   +3.947346255999964e-02   +3.320212314263957e-01   +5.200338408375555e-01   +3.395865147592379e-01   +4.977064835884918e-01   -1.568625956353564e-02   +7.314773095304851e-02   -4.465322427785300e-02   +4.809501347738726e-01   +9.325348698241971e-02   +4.430329701540131e-01   +4.974742519177265e-01   +1.642243486604552e-01   +2.835800889823227e-01; +4.751203430893491e-01   +2.688972801026772e-01   +2.468028042550044e-01   +5.071494080887446e-01   +2.245839999341738e-01   +1.833520344588958e-01   +3.777726032863535e-01   +1.696870560541290e-01   +9.477689857426438e-02   -1.164651920094622e-02   +1.722243459773631e-01   +2.814881783942529e-01   -1.087356700332201e-01   +5.152954322643188e-01   +1.191012385335115e-01   +4.353148619852938e-01; +2.954994308421974e-01   +9.928609321294131e-02   +5.154092010641792e-01   +2.919246238729308e-01   +2.761978937669775e-01   +1.859504823825157e-01   +6.427241862855100e-01   +1.930455002951861e-01   +1.640275143382631e-01   +1.125306138740871e-01   +2.542588228036818e-01   +6.188506077384510e-01   +3.145277199205213e-01   +1.666939969570131e-01   +3.520198696699391e-01   +6.228573592009080e-02; +3.245286764913703e-01   +2.861490282444244e-01   -1.931680321549781e-03   +2.183964055724757e-01   +3.194393155143266e-02   +4.226100938275538e-01   +4.305740038225042e-01   +3.192760677726723e-01   +5.189964633360118e-01   +1.636407007884067e-01   +3.548286648199578e-01   +2.251402744178271e-01   +5.561986971166716e-01   +3.963156388250077e-01   +1.375749376108565e-02   +2.956321226443652e-01; +1.109847947598105e-01   +3.495723373987478e-01   +1.375049810214710e-01   +1.122052753158600e-01   +1.005227500850240e-01   +2.717247064865320e-01   +1.060153955915812e-01   +3.233806908223655e-02   +3.071428094648950e-01   +2.635479660049257e-01   +7.352581788566986e-02   +4.475919197370092e-01   +3.843973989992249e-01   +4.665562405179928e-01   +1.934754765940028e-01   +4.551210665618646e-01; +5.878583363685956e-03   +1.769168146901759e-01   +1.906247828452031e-01   -5.363313432801365e-02   +5.558585158393158e-01   +5.598578480997463e-01   +3.631068684419014e-01   +3.124946491197485e-01   +2.140744497767726e-01   +1.198752154933519e-01   +9.926971107044077e-02   +2.029778275829028e-01   +1.208822878321456e-01   +3.142076600499817e-01   +2.220737355672313e-01   +5.758105988145117e-01; +4.908634756434653e-01   +1.513954144175942e-01   +4.716929453051749e-01   +4.185602408266424e-01   +3.309191740601722e-01   +5.217975524062720e-01   +1.285425794339642e-01   +1.306860563060339e-01   +3.544027187058186e-01   +4.964353176642156e-01   +1.600819002260067e-01   +1.373189942526143e-01   +2.524035499923614e-01   +2.274568875684907e-01   +3.574530732917437e-01   +9.235970718868380e-02; -7.781676555353971e-03   +5.318115258245761e-01   +2.536723378321507e-01   +2.271204249661260e-01   +2.609653056352066e-01   +5.759575882805322e-01   +4.257411890870181e-01   +3.940811326954543e-01   +5.224311475214143e-01   +1.987362508334468e-01   +1.206808765764642e-01   +2.152851070467783e-01   +4.662852410637562e-01   +2.584136844987648e-01   +2.215627779196327e-01   +4.885781804042760e-02; +6.198430983614729e-01   +5.897769216113984e-01   +3.284684955235180e-01   +5.656126116041496e-01   +1.726791113819849e-01   +1.335161199105330e-01   -9.931691100165282e-02   +2.531387750234675e-01   +4.106516459502859e-01   +9.945744718757396e-02   +1.833648953181193e-01   +4.526432163679110e-01   +1.437662295762562e-01   +6.365276450536320e-01   +1.475750005975126e-01   +2.016661004155626e-01; +2.033416375003009e-02   -8.460238514848498e-02   +4.700789259591092e-01   -2.386930274119816e-03   +6.248494797120172e-01   +3.910299788915500e-01   -1.998021073456002e-02   +1.667283140941359e-01   +9.471748586609741e-02   +4.011497006783589e-01   +3.751676202761883e-01   +3.004106108489033e-01   +1.469051205646752e-01   +2.355258848103243e-01   +7.874994076252624e-02   +3.579163751651588e-01; +1.709530448499841e-01   +1.500403176801828e-01   +4.081116904198137e-02   +2.886578595843430e-01   +3.271134289064825e-01   +4.843471960098418e-02   +3.805335753414564e-01   +3.706718671469906e-01   +5.996702314420369e-02   +3.849779875890053e-01   +2.394878781349484e-01   +4.594736426524422e-01   +2.988772102577260e-01   +1.647260908731552e-01   +2.320726380224325e-01   +1.611648119284707e-01; +3.368511099923134e-01   +3.554370639388511e-01   +4.080472531497458e-01   -2.780473806201164e-02   +4.004884629951684e-01   +2.439845349693726e-01   +3.090153273836138e-01   +4.738549904360498e-02   +5.254891079512014e-01   +1.878052438828631e-01   +3.162476113281620e-01   +4.926285596385330e-01   -2.126007288736637e-02   -2.292898694779617e-03   +3.122500317959466e-01   +2.706934164617432e-01; +5.930997819670428e-01   +5.205074251641564e-01   +3.842595654434974e-01   +2.341300482703963e-01   +1.038650091716006e-02   +6.540579685259569e-02   +1.946057950174787e-01   +4.263437753263260e-01   +3.408409006155889e-01   +9.893555132021915e-02   +1.697547764743199e-01   -7.776007481814171e-02   +5.345781845401192e-02   +2.161071239557467e-01   +5.606282503415106e-01   +2.849922494243725e-01; +3.766631661458063e-01   +1.638669679949653e-01   +3.753398263274842e-01   +5.037830640402980e-01   +1.714423773961476e-01   +8.213137522782850e-02   +5.744087232764257e-01   +4.539614078057146e-01   +1.858684490748063e-01   +5.642041619544366e-02   +4.208776678529224e-01   -5.426686802553830e-02   +3.675922599776057e-01   +1.190303746371453e-01   +3.175680264581034e-01   +5.422775943795919e-01; +1.105115205080744e-01   +4.100684727140051e-01   +2.574323056447588e-01   +3.450360718551129e-01   +2.857709607974573e-01   +1.231084485232533e-01   +2.663531527781621e-01   +3.703548172126447e-01   +1.555035524797696e-01   +2.907442282299937e-01   +1.460251973493323e-01   +2.244757701764638e-01   +3.584606191969709e-01   +3.794813281461579e-01   +2.681570201423616e-01   +2.737219561343649e-01; +3.839192889707608e-01   +7.622142656065718e-02   +1.609242801411871e-01   +5.461267948684740e-01   +5.682086792801275e-01   +3.179891015286188e-01   +1.082527798071674e-01   +1.731617538517130e-01   +1.659964613772278e-01   -1.223204992524787e-01   +7.185903868494013e-02   +2.900577848903046e-01   +5.199238167301014e-01   +2.968283145122518e-01   +2.857841217185200e-01   +2.733511703147068e-01];
L1E_L1I_iGABA_netcon = [+1.738556146753630e-01   +3.357107346233891e-02   +2.528604388164817e-01   +2.886710394371044e-01   +4.644423616606499e-01   +1.502620410690425e-01   +3.772861631685026e-01   +4.486586847735772e-01   -6.514870703372327e-02   +3.555035464765137e-01   -4.744262385806738e-02   +2.642927327739812e-01   +4.903217162195330e-01   +1.862741014421159e-01   +1.595085428197428e-01   +4.025617370676946e-01; +2.567608253766629e-01   +5.770524092966450e-02   +5.586839542858026e-03   +3.140253439722248e-01   -2.759416044760894e-02   +1.236168623676522e-01   +6.426783655639776e-02   +2.910313894027027e-01   +3.507376914445839e-01   +4.732217570117082e-01   +2.354068019690103e-01   +2.764268517893084e-01   +2.865702223111864e-01   +3.908962478936350e-01   +4.291341445245779e-01   +3.933261908835487e-01; +3.408749692280648e-01   +6.126057052587572e-01   +2.165884394902995e-01   +4.777777026564947e-01   +3.896226628237794e-01   +2.122504544484803e-01   +6.642051206095782e-02   +1.187121109097451e-01   +2.288252693969910e-01   +3.487821246788886e-01   +2.599439884489451e-01   +2.662692066452392e-01   +3.918622943262781e-01   +1.930836121206255e-01   +6.616106308192386e-02   +1.048255747585764e-01; +2.435805228940399e-01   +4.084379704324234e-01   +9.912403143397258e-02   +5.342699518175051e-02   +3.529793115957026e-01   +2.138697483020212e-01   +4.264294884618779e-01   +4.677376385946894e-01   +2.787522775585280e-01   -1.855194520725516e-02   -4.271206688751394e-02   +6.275463473516948e-02   +1.576657568601516e-01   +5.188368975862042e-01   +2.166557297333256e-01   +2.823563127406306e-01; +4.539453745771942e-01   +3.019144563575277e-02   +2.548581007340381e-01   +1.299947194125916e-01   +5.049814708539356e-01   +1.701461628281390e-01   -8.017259533213660e-02   +1.681447512340473e-01   +1.827964970427947e-01   +2.373986219031992e-01   -4.312294014793705e-02   +1.609126946317026e-01   +4.011860926563646e-01   +3.887771141363780e-02   +7.936907321104321e-02   +1.746562908808725e-01; +7.120894245896954e-02   +3.593232227294089e-01   +1.150992229502505e-01   +6.832687273241651e-02   +1.137521652525902e-01   +3.559457846858664e-01   +2.482331137371856e-01   +4.293778714388202e-01   +2.939553176400773e-01   +3.827031323983328e-01   +4.312519351650655e-01   +5.010423112869100e-01   +1.475813260882192e-01   +1.860302164983507e-01   +1.524092326744088e-01   +4.238647623189976e-01; +2.294887140178286e-01   +1.893374421071645e-01   +2.800866542293827e-01   +5.930956254892420e-01   +4.857603229518009e-01   +1.726311412611077e-01   +2.725756877636014e-01   +5.551566514727457e-01   +2.803927567259260e-01   +2.587079724057240e-01   +2.362971927451059e-01   +1.460744580345301e-01   +3.686871902553344e-01   +1.897665135658250e-01   +1.986781423753449e-01   +2.102511058991611e-01; -8.658806443286415e-02   +3.030500652280018e-01   +1.161644893684103e-02   +6.806908018671330e-02   +1.357279111021017e-01   +3.672360716416900e-01   +3.961285799373760e-01   +2.207014261284271e-01   +1.062295343330020e-01   +2.781640006170396e-02   +8.675355440771892e-02   +3.414332737790378e-02   +3.714651404525459e-01   +6.660623319006002e-02   +6.598826970394026e-02   +1.247712407245794e-01; +4.152639889782431e-01   +5.391899652089979e-01   +2.299161750836247e-01   +4.559456317552753e-01   +1.580981169699245e-01   +4.364043646593316e-01   +3.272360681615198e-01   +2.316639572324619e-01   +3.044243191851101e-01   +3.621269470916694e-01   +4.421599608043738e-01   +2.643061893401324e-01   +2.235262914628481e-01   +6.315513892648596e-02   +3.854067292661330e-01   +4.141527222837124e-01; +1.643629462726774e-01   -4.946086412270494e-04   +3.108855131206971e-01   +2.045977806062880e-01   +4.928899348823507e-02   +1.514047461527654e-01   +2.241368379943880e-01   +3.214423542100673e-01   +1.519734085489611e-01   +4.689390818737854e-01   +2.417897389230421e-01   +1.108208601232698e-01   +2.200179483172503e-01   +2.176776029594644e-01   +9.453906127872505e-02   +1.499518238861906e-01; +2.946872146247236e-01   +2.942576202735330e-01   -6.504180579397545e-02   +5.260134061515174e-01   +2.280367171694760e-01   +4.897444763647666e-01   +7.527661796732998e-02   +5.750660111480353e-01   +2.399542198356973e-01   +5.727512313642987e-01   +4.997772712804703e-01   +3.984322860844046e-01   +4.579046036678628e-01   +1.181417736605290e-01   +3.870140300527850e-01   +3.628889253139347e-01; +6.414727055381655e-02   +5.074285134168133e-01   +4.010868835995039e-01   -4.158244800969763e-02   -2.056629210363405e-02   +2.842538336815879e-01   +5.089912918753802e-01   +5.520357155696239e-01   +2.357930921295858e-01   +9.662366284406046e-02   -1.007550637641927e-01   +2.008162073445698e-01   +3.334646627781574e-01   +3.709277049703166e-01   +2.294966935939642e-01   +1.690218415634230e-01; +2.281781049970567e-01   +6.053459307306962e-01   +3.660666197462833e-01   +1.095703172882149e-02   +8.087188905790021e-02   +3.419489418649127e-01   +3.576688062579680e-01   +3.701602416042441e-01   +1.185213295476836e-01   +1.809166575036572e-01   +1.226285905484310e-01   +3.150665841039891e-01   +3.304502889476648e-01   +3.645547121365790e-01   -1.509174892873753e-02   +2.312811283733147e-01; +4.393435382361463e-01   +2.423664809188907e-01   +3.308352117144774e-01   +2.160077529262560e-01   +8.717626414587636e-02   +2.431182400388513e-01   +5.693486008175589e-01   -1.042768577057276e-02   +4.627750516748181e-01   +5.817875014269556e-01   +2.270768727405415e-01   +4.721850878927273e-01   -4.636277433403596e-02   +3.469976907460958e-01   +3.448899159947565e-01   +3.680725033124645e-01; +2.913817709649319e-01   +7.297630672980662e-02   +2.478226835519514e-02   +1.415949566028886e-01   +3.086160720255591e-01   +1.977126738777078e-01   +3.792628186049390e-02   +3.581716576006061e-02   +9.709977927633202e-02   +4.123464583689711e-01   +2.027157339844607e-01   +1.223681276873509e-01   +3.712514421882655e-01   +5.090391858339272e-01   -5.716698764262439e-02   +4.003778549254396e-01; +2.482159959667822e-01   +4.634600087674100e-02   +2.175092718605122e-01   +1.338121000529230e-01   +2.923605451275287e-01   +5.191240935620208e-01   +2.025950859254709e-01   +8.315756045167177e-02   +1.777756514182916e-01   +3.508726217531794e-01   +5.213937056977712e-02   +2.321292094439491e-01   +1.152077099059395e-01   +3.833545113570203e-01   +3.464972867710185e-01   +9.091602334828316e-02];
L2I_L1I_iGABA_netcon = [+2.853380814965175e-01   +1.430430886521218e-01   +2.960203811663085e-01   +2.282222772599874e-01   +1.062107318682513e-01   +4.126828890610615e-01   +6.672310513182968e-02   +3.933415973620781e-01; +3.746465281932815e-01   +2.474623729467834e-01   +3.482680137730497e-01   -5.044466555729184e-02   +5.204923349365385e-01   +4.725034518527019e-01   +3.891235690739328e-01   +2.780369934516605e-01; +2.348712034930715e-01   +3.518493926657312e-01   +2.454436533197169e-01   +2.211791288898579e-01   +2.767391342436722e-01   +1.935459418353250e-02   +4.100489154182667e-01   +2.069426296811304e-01; +7.351155037059032e-02   +3.516585513297477e-01   +4.845428876435083e-02   +1.733049433460572e-01   +2.148921686911371e-01   +3.931014744951216e-01   +4.921119850361150e-01   +5.912521038026187e-01; +5.722872116251247e-02   -5.854394144521256e-02   +4.270110412455629e-01   -1.544192182670333e-01   +1.320482804704101e-01   +3.805029382744939e-01   +5.167727245787758e-01   +4.107571617070738e-01; +1.093103781180225e-01   +2.660623850821329e-01   +5.458577966545182e-01   +3.331915848674256e-01   +2.882714632599292e-01   +4.020650459346971e-01   +1.664328370828501e-01   +2.596657522817102e-01; +6.286334026590055e-01   +1.542188680522650e-01   +2.518785114615784e-02   +2.336758309197426e-01   +3.289857186798260e-02   +5.483928801614322e-01   +6.365858793958322e-02   +4.732055666593674e-01; +1.461960980035723e-01   +5.268187506335686e-01   +7.911131894592381e-03   +5.362244839601932e-01   +3.359081808300936e-01   +2.904596936162260e-01   +4.322134272154977e-01   +2.146080638165829e-01; -8.925136279994939e-03   +1.895587254609542e-01   +4.677825033902880e-01   +4.447153997968862e-01   +4.079990907898667e-01   +2.102661155304257e-01   -3.839097300479689e-03   +4.309041492103439e-01; +4.008585456563348e-01   +2.848666635660650e-01   +1.185484544468498e-01   +1.604697724990405e-01   +4.614168258653813e-01   +4.721732454967539e-01   +1.433732169531652e-01   +3.259788365766834e-01; -7.102657199424878e-02   +1.672871543685940e-01   +3.971455463873739e-01   +2.771137469296307e-02   +3.511130391613217e-01   +2.505350035953696e-01   +4.751576461006316e-01   +5.203453324849525e-02; +1.744006687122243e-01   +2.789375320608070e-01   +4.114373037217875e-01   +1.817299899841624e-01   +3.565497829463697e-01   +2.048568513730738e-02   +3.230524250697133e-01   +4.104728119891697e-01; +3.365934178415938e-01   +2.159771275472450e-01   +3.459831377067323e-01   +3.018922346788520e-01   +2.106957162803148e-01   +4.787617968381462e-01   +2.497592002983965e-01   +1.142284803956720e-02; +3.371059024287301e-01   +3.931872460622579e-01   +2.548872304482783e-01   +2.376084150910313e-01   +1.004377382250825e-01   +3.325678270663727e-01   +3.804532625235624e-01   +3.039382359480122e-01; -7.725294227578634e-02   +3.904734698144365e-01   +2.444153133186905e-01   +1.967184384557498e-01   +2.666309927642462e-01   +1.136611724013817e-01   +5.364534516259285e-01   +4.753865370192510e-01; +5.061202395371838e-01   +3.511161946041056e-02   +2.374838599136782e-01   +4.672837128238849e-01   +4.403465233410148e-01   +4.030384740134693e-01   +2.319245942259375e-01   +4.952879071348708e-01];
L1I_L2I_iGABA_netcon = [+4.464872732258149e-01   +3.354151967425892e-01   +9.803020414327457e-02   +1.407231785206051e-01   +4.092348065308112e-01   +8.044780442971369e-02   +3.553762996667906e-01   +2.299250808488649e-01   -4.175291571262002e-03   +4.773007790071346e-01   +4.108852945445139e-01   +2.076750441972638e-01   -4.367147886356981e-02   +1.097590099497248e-01   +4.751832499636042e-01   -9.317178053203799e-02; +4.520763884417602e-01   +4.086192098512452e-01   -2.802557036181303e-03   +4.023666776216900e-01   -2.260543875140881e-02   +4.689429116184941e-01   +1.940726182833333e-01   +5.288030807789481e-01   +5.221529596128828e-01   +5.425609535813554e-01   +2.294509120917596e-01   +7.092679594029495e-02   +3.034718950461889e-01   +5.324013468928576e-01   +6.437068292941350e-01   -1.810153343518675e-02; +1.618598071293059e-01   +1.563500265894747e-01   +7.200250485696504e-02   -5.183785201544013e-02   +2.548247081519913e-01   +3.526556116908135e-01   +4.122239757536702e-01   +4.455872207315580e-01   +2.135330545573673e-01   +2.815363879375236e-01   +2.704507394222802e-02   +1.686251555807415e-01   +4.799826693149089e-01   +5.972250176181638e-01   +2.013419421143011e-01   +8.737370546665371e-02; +2.532699255278280e-01   +3.834088845577706e-01   +4.418896667508653e-01   +3.980960074666202e-01   +1.885750647981011e-01   +6.240224331582763e-01   +2.551900586835089e-01   +2.993107362453045e-01   +5.313407960369051e-01   +4.141444428054832e-01   +5.935211395020672e-01   +5.824143208811118e-02   +3.811064418228712e-01   +3.706110179758529e-01   +1.400123036590535e-01   +1.035358327384822e-01; +3.678499495213763e-01   -6.114365312453864e-03   +2.719769876198666e-01   +2.713810573281072e-01   +7.175371087478509e-02   +1.757311802416140e-01   +4.280609090813979e-01   +8.321294182340334e-02   +1.198270230676001e-01   +3.262134179736405e-01   +2.672176553566166e-01   +2.892644294237521e-01   +1.145497161125137e-01   +2.573478903502543e-01   +4.933463509397812e-02   +1.347085097468233e-01; +1.841593668175437e-01   +2.508184590625606e-02   +2.623552237109716e-02   +2.916924490546536e-01   +5.178367471649939e-01   +4.275630256489566e-01   +1.782117931227342e-01   +6.986421611821503e-03   +2.949613069573616e-01   +2.602280840987333e-01   -2.409171176222233e-02   +3.956803862944297e-01   +2.775333301339123e-01   +2.724891708791684e-01   +4.590165723868099e-01   +3.313782260469600e-03; +4.904452106570755e-01   +5.986144312203341e-01   +6.664249477643641e-02   -2.421300014645092e-02   +2.513118715088579e-01   +3.643973714741228e-01   +4.401474678315654e-02   -9.903671583694727e-03   +4.123183987825099e-01   +1.771216879128223e-01   +3.897999416555161e-01   +2.645429522225906e-01   -8.968292585179846e-02   +2.438036099218732e-01   +6.786641783942923e-02   +5.700718384839014e-01; +4.958059282340240e-01   +2.482282251171335e-01   +1.099892925173351e-01   +2.564430336412429e-01   +5.532113592007211e-01   +2.787467694377269e-01   +3.068952937520696e-01   +1.605385216157311e-01   +5.130536097105636e-01   +3.199956608606391e-01   +7.632977279854725e-02   +3.106776770531270e-01   +4.534648402205612e-01   +3.576772821911826e-01   +4.753319792522179e-01   +1.357967049370145e-01];
L2E_L1E_iAMPA_netcon = [+7.511280760272934e-03   +4.754660581502467e-01   +2.813628822251905e-01   +2.633393837914243e-01   -4.808156740327255e-02   +3.898913580714010e-01   +6.296160674208098e-02   -1.850571896365299e-02; -8.796415352712672e-02   +1.168988457413630e-01   -4.963074836164161e-02   +4.960145259933241e-01   +3.883817495297938e-01   +3.745307497285625e-01   +5.942559762294927e-01   +5.385139787624861e-01; +6.607807004416515e-02   +3.123959693646802e-02   +4.932089002030140e-01   +3.405787624240303e-01   +9.280146089675299e-02   +3.588834554606620e-01   +4.803750191709636e-01   +7.203376587878473e-02; +1.472202198557696e-01   +4.197733405184811e-01   +6.380114411281682e-02   +1.424230038155783e-01   +5.676371592761944e-01   +1.764385741582174e-01   +2.882670723642542e-01   -6.060527185752469e-02; +4.934909415970117e-01   +2.480347760442651e-01   +3.682001208430777e-01   +3.898638757880843e-01   +1.052371179812462e-02   +5.332381636840947e-02   +6.455169041427773e-02   +5.377424625206344e-01; +5.126503861937529e-01   +4.079391136910714e-01   +2.013045304133259e-01   +7.483922967842703e-02   +3.849585720137069e-01   +3.664654784308908e-01   +3.117058684909338e-01   +4.672922127089982e-01; +1.633925245948822e-01   +2.908864365234449e-01   +1.103596471138328e-01   +3.187310048197097e-01   +2.211172967821762e-01   +4.483059660507981e-01   +5.696071874527218e-01   -1.316887331338430e-01; +3.736297300831485e-01   +4.078715511785464e-02   +2.073930487248422e-01   +4.463358826779851e-01   +2.805911627738926e-01   +1.081059105578000e-01   +3.000824201006030e-01   +1.612379917194841e-01; +5.342499899563716e-01   +1.648750772211064e-01   +3.857827069217841e-01   +2.743872631593388e-01   +2.873516938151071e-01   +3.689685333360009e-01   +3.724184008728661e-01   +2.778845644092400e-01; +4.391191689292335e-01   +4.319855396216253e-01   +3.537254368819321e-01   -4.923637553639730e-02   +4.669812176850882e-01   +1.749091627593496e-01   +2.814262922992899e-01   +2.677522452538896e-01; +1.604400814431949e-01   +3.655006643873829e-01   +2.041853499447696e-03   +1.574914624345776e-01   +5.228715479552363e-01   +4.625540108634075e-01   +1.140641333361632e-01   +1.960324788562104e-01; +3.673501873104982e-01   -1.899162151576547e-02   +1.494583225586539e-02   +2.174187709874851e-01   +1.713871076690578e-01   +1.911626552090901e-01   +3.823608983933893e-01   +2.492080403687834e-01; +4.054910498102638e-01   +7.236845626651753e-02   +3.352856016097572e-01   +1.550981464374364e-01   +5.050563505467177e-01   +1.511376050625444e-01   +4.067350724101539e-01   +3.138042820960759e-01; +4.270473275427958e-01   +5.533493428374351e-01   +1.998768410767164e-01   +2.092454500580760e-01   +2.975927558923513e-01   +3.876201943518476e-01   +4.782172896728595e-01   +8.016469169440797e-02; -3.580279262520017e-02   +4.136848127952341e-01   +7.145015338072007e-02   +4.281427303850127e-02   +2.256026297747667e-01   +5.763639550496424e-01   +1.078253868446821e-01   +1.962515334201020e-01; +1.885245255406171e-01   +5.027465973223773e-01   +3.829445237937632e-01   +3.067456517109968e-01   +2.317315393431231e-01   +3.725542542137998e-01   +3.374800611696867e-01   +2.093858434153360e-01];
L1E_L2E_iAMPA_netcon = [+2.852277330714219e-01   +3.909198567381310e-01   +2.629580724912066e-01   +6.781637955090715e-02   +1.261019541487573e-01   +3.526273691427663e-01   +1.334357511461883e-01   +5.124478746553988e-01   +6.653545972588978e-03   +4.347224216208062e-01   +7.135354622653053e-02   +1.780150764608451e-01   +9.593035052878755e-02   +1.760057332544779e-01   +4.536021996726253e-01   +2.084042088166301e-01; +4.134035465877809e-01   +5.937781827960630e-01   +4.198748871029604e-01   +4.313977071440230e-01   +2.961026654068820e-01   +3.842297295257194e-01   +2.905290534139185e-01   +4.608318601360744e-02   +5.474878553244606e-02   -9.087762816549220e-03   +3.451093151659822e-01   +3.314447834931081e-01   +2.519135011903866e-02   +7.470969719364802e-02   +5.035982793683570e-01   +2.683877795627252e-01; +1.968369658543253e-01   +5.652448585112119e-01   +4.963074015911298e-03   +2.009238508919058e-01   +2.578506245050646e-01   +5.137794162595060e-01   -9.340043245484861e-02   +4.153103437487307e-01   +1.876321879922966e-01   +4.597079143456700e-01   +4.102995439370804e-01   +2.262619383194387e-01   +1.628551446687165e-01   +5.261996518433475e-01   +5.029058657699377e-01   +3.945229654364961e-01; +4.473870308249310e-01   +6.702284107391425e-02   +3.286232805325909e-01   +7.675665686995611e-02   +4.437677316537694e-01   +1.969114181886072e-01   +4.967317674348386e-01   +3.667149851954233e-01   +3.111113030670757e-01   +4.960430394599359e-01   +2.118518082029855e-01   +1.686771989799734e-01   +5.350806646689925e-01   +2.828488098876948e-01   +4.437582507893786e-01   +1.600639980640664e-01; +2.822218481695906e-01   +2.091929926437391e-01   +2.251846678843505e-01   +4.703728525780232e-01   +1.298550176194424e-01   +3.524959546411778e-01   +2.686679320171992e-01   +5.354646489377252e-01   +2.913469946382540e-01   +3.572353955462723e-01   +1.498998488549394e-02   +3.723691977204159e-01   +3.808823410534685e-01   +1.435990369668871e-01   +4.688282714172508e-01   +6.379301170959910e-01; +3.541932253398237e-01   +4.933407847375433e-01   +1.099466909760549e-01   +6.047708102483378e-01   -1.068458433418495e-01   +1.303937787144731e-01   +1.914566974309419e-01   +4.450491166942345e-01   +4.255546253336290e-01   +3.650881428247486e-01   -1.486201543344074e-02   +1.209808656164692e-01   +7.773331973280836e-02   +3.276150268844678e-01   +4.023163125015018e-01   +1.231309418102175e-01; +3.062362123847591e-01   +1.705291372916923e-01   +1.482394651657852e-01   -8.482099167092988e-02   +4.924850447282038e-01   +3.985876629214011e-01   +3.169837610564369e-01   +1.407787873817539e-01   -1.226668977068897e-01   -8.167678683928573e-02   +6.651467977653390e-01   +1.746696528945845e-01   -7.622088530764520e-02   +8.877843661148707e-02   +2.054687371079269e-01   +1.993211756020249e-01; +7.199658771869649e-04   +3.253998681755909e-01   +1.462496378366309e-01   +3.281804734640256e-01   +9.387066054288731e-02   +4.185850021734701e-01   +3.337093761907972e-01   -5.796586225360287e-02   +3.701238374205598e-01   +3.713242941923233e-01   +3.328328645347721e-01   +1.001562997977680e-01   +5.245095460384515e-01   +3.330433013730763e-01   +4.430769791085474e-01   +4.066073536514718e-01];
L2I_L2E_iAMPA_netcon = [+6.171773125120898e-01   +2.715347945193525e-01   +4.507599851174234e-01   +3.410672047140724e-01   +3.945239577960701e-01   +6.106310570701439e-02   +1.501374558795891e-01   +2.499440753512934e-02; +5.176580127003060e-01   +5.749169954029922e-02   +9.558558090290009e-02   +3.617135697429101e-01   +4.444242024248894e-01   +1.476978542215027e-01   +3.798536440207006e-01   +2.451420059127105e-01; +5.154274232715008e-01   +9.627438758413098e-03   +8.463119164048152e-03   +3.348966663127827e-01   +4.276570376697713e-01   +3.339568613304332e-01   +3.933589321410000e-01   +4.367168399157045e-01; +2.828895421124911e-01   +3.935822835770937e-01   -8.100856306352588e-02   +2.560209954742253e-01   +4.887024468179669e-01   +5.738054475678619e-01   +4.782602681119751e-02   +6.730422169943215e-02; +2.332058237902123e-01   +1.386520394690327e-01   +2.855869430033913e-01   +1.093468386155738e-01   +3.861073894591392e-01   +3.286894334105758e-01   +2.415498170334557e-01   +2.759830578823135e-01; +2.106646603590271e-01   +3.718213732432883e-01   +8.950423443663559e-02   +1.772595202338126e-01   +3.508013003630260e-01   +3.831585002706096e-01   +3.496397951283734e-01   +1.701728229866289e-01; -3.901176275728705e-02   +1.491650553220481e-01   +3.879648893062842e-01   +2.671188214496699e-01   +3.078095247124998e-01   +2.973726538017021e-01   +4.711969791424350e-01   +2.051514105411483e-01; +4.654039865826555e-01   +6.544476129186454e-01   +4.229027580989405e-01   +2.351402978167410e-01   -1.817214551019032e-02   +9.189656240669836e-02   +1.628169880817831e-01   +4.896802587091161e-01];
L2E_L2I_iGABA_netcon = [+4.810004512691998e-01   +2.614926230018044e-01   +4.590000793096461e-01   +5.486928664983314e-01   +1.510831298366863e-01   +5.352465619770410e-01   +3.814034648804011e-01   +1.491751227126189e-01; +4.010648895757009e-01   +5.057126859275034e-01   +4.987267518924337e-01   +8.337949265435834e-02   +4.374848535029937e-01   +2.731599304245219e-01   +2.137969021493713e-01   -9.981997062708534e-02; +5.222468936352191e-01   +1.703792564672901e-01   +3.000834786013511e-01   +4.031573228691679e-01   +2.580314417482705e-01   +1.979452809673091e-01   +3.893798167637744e-01   +3.207642994663252e-01; -8.670779846863151e-02   +4.528885751576847e-01   +2.985921007484212e-01   +1.679184767220681e-01   +4.290658568657322e-01   +9.540764313956032e-02   +3.945842088679493e-01   +2.434258143381824e-01; +3.224841430075255e-01   +1.573040909708209e-01   +4.723756058117010e-01   +3.364935544169069e-01   +1.025910942473232e-01   +3.526220763590548e-01   +3.134693652260417e-01   +3.421471085998443e-01; -1.264186559914939e-01   +8.289308323235977e-03   +3.227227669954184e-01   +2.643882669965316e-01   +3.836261462421121e-01   +5.609888425647594e-01   +4.675151481116417e-01   +2.759627300930927e-01; +5.425148531514921e-01   +3.908249798289798e-03   +2.955490847114773e-01   +1.121937749866827e-01   +3.690957778732185e-01   -2.058176704964774e-02   +4.504916255847858e-01   -5.681189552001566e-03; -3.296907467140718e-03   -3.490341596228828e-03   +3.267759621221695e-01   +2.488465894609631e-01   +2.340734303067028e-01   +3.445306632011712e-01   -3.868607449994266e-02   +4.043224285550011e-01];
L3E_L2E_iAMPA_netcon = [+3.309754923940699e-01   +3.388367601213901e-01   +4.578064293168889e-01   +1.218787173591818e-01   +5.964657337159325e-01   +3.048282846894770e-01   +4.559677551517735e-01   +1.788833650682248e-01   +1.321539702400076e-01   +1.189093969942400e-01   +2.160339929274239e-01   +4.029125418114916e-01; -1.654124108579285e-02   +3.832542890790917e-01   +8.697093838058637e-02   +2.857606238257700e-01   +2.609561007733125e-01   +1.669484331950785e-01   +4.980856669336000e-01   -9.677192923638721e-02   +1.591266671957150e-01   +2.341524320842769e-01   +1.289827171826044e-01   +4.533346670884916e-01; +9.790789703710262e-02   -9.136429383477074e-02   +5.398489005215713e-02   +5.082335773278823e-02   +3.749940983907322e-02   +8.259280632552300e-02   +5.356009390400597e-01   +3.120091452856354e-01   +2.235951116998735e-01   +3.277503440513222e-01   +5.483936980048814e-01   +2.267817286703403e-01; +3.010976715970792e-01   +1.995997326171479e-01   +2.272582486166287e-01   +2.936019932067672e-01   +3.168354058100043e-01   +1.585238935691577e-01   +4.275681709687915e-01   +4.651070738159607e-01   +2.388391661800763e-01   +4.261045082692451e-01   +3.009905370696925e-01   +3.884187863208905e-01; +3.186553202537566e-01   +2.913719445471949e-01   +3.604314847874259e-01   +3.355972185314260e-01   +2.098140715547737e-01   +3.010517966788042e-01   +5.615579735254332e-03   -2.700713688232510e-02   -4.108321238279476e-02   +2.807292100878288e-01   +3.179146512381435e-01   +5.138795393674755e-01; +7.633633648791865e-02   +2.617216120919017e-01   +1.408340797660418e-01   +5.794513500743820e-01   +2.256552698377324e-01   +1.534149809689648e-01   +1.327531719678699e-01   +3.627946941864319e-01   +4.416890871351036e-01   +2.685859529881903e-01   +3.638706351688993e-01   +5.684523437332871e-02; +2.529388286074240e-01   +4.375363087999649e-01   +4.030962475203672e-01   -9.724402795131616e-02   +3.852254901728108e-01   -2.606291571489586e-02   +7.971616962799494e-02   +3.522300583545999e-01   +1.986143962857047e-01   +1.867999913302151e-01   +3.582313899801778e-02   +9.619598337390350e-02; +3.444516383284867e-01   +3.007040217285352e-01   +3.116190319681655e-01   +3.447758578745290e-01   +2.364533866416278e-01   +4.494402685788513e-01   +4.171655901636435e-01   +1.960599934003840e-01   +4.130936236325486e-01   +4.654998183599861e-01   +1.924062256737860e-01   +3.958784615596120e-01];
L3I_L2I_iGABA_netcon = [+2.137802768173641e-01   +3.652582161098074e-01   +6.001034630230251e-01   +9.275178451523741e-02   +4.666753712249202e-01   +7.062482500230662e-02   +2.812720577481480e-01   -6.051446278509512e-02   -1.803049082796992e-02   +3.797835787035110e-02   +9.049301773391526e-02   +5.032621487479297e-01; +3.414525097202944e-01   +8.285908966186507e-02   +6.307819097235037e-02   +7.327645215906398e-02   +1.494024274624919e-01   +4.704120808739689e-01   +3.618536875957758e-01   +3.880700658987087e-03   +2.865178079242198e-01   +4.331497237388370e-01   +2.023519227990054e-01   +3.000287201434784e-01; -1.620361751509688e-02   +2.578873245078113e-01   +5.136258629084074e-02   +3.522065945052001e-02   +4.087041279246164e-01   -3.766906489107464e-02   +3.305587369140954e-01   +3.392889777279240e-01   +1.361361598046283e-01   +1.663956468739914e-01   +3.329069937683045e-01   +4.754280356198988e-01; +3.286468973174962e-01   +2.113661282301053e-01   +4.426620680919678e-01   +3.325086461166392e-01   +2.893242456567371e-01   +5.116730616461028e-01   +1.375588326716748e-01   +7.432899032738528e-02   +2.656113492559320e-01   +2.804419678470696e-02   +3.555543576394696e-01   +2.438433279950622e-03; +1.809607284054426e-01   +4.365691128663783e-01   +1.639528404257523e-01   +4.668259468030741e-01   +3.644240431090917e-01   +2.433464613905671e-01   +3.945680986852991e-01   +1.653814117648834e-01   +4.627843460683930e-01   +1.136575376843040e-01   +1.728250031489517e-01   +1.129438644000108e-01; +6.906479523021690e-02   +1.642366880821981e-01   +5.030620869472581e-01   +1.131167951925214e-01   +9.559007097975669e-02   +1.473477384560509e-01   +1.853610334648435e-01   +2.458841582761754e-01   +3.492170922277296e-01   +1.851493766651060e-01   +3.244439003524184e-01   +1.401208229950557e-01; +3.953112033112700e-01   +3.374074251718572e-02   +2.910584921268198e-01   +4.061092703134123e-01   +3.523410408078472e-01   +1.468198664326805e-01   +5.273936952031124e-01   +4.294828515404562e-01   +1.623908279030992e-01   +3.351129000414084e-01   +3.124977750199467e-01   +9.018669650511085e-02; +1.995029682367787e-01   +4.893841318248238e-01   -8.455508979822467e-03   +2.796863395374937e-01   +1.133323968342460e-01   -3.228592392722656e-02   +8.813481305877460e-02   +1.993818368228894e-01   +1.783508296485074e-01   -9.266790015551118e-02   +2.050704541684580e-01   +1.998308802668715e-01];
L2E_L3E_iAMPA_netcon = [+3.881272447657906e-01   +1.154626520134266e-01   +6.123425143574456e-01   -5.670973692376056e-02   +1.863797860083241e-01   +2.017632374005285e-01   +1.561001454732136e-01   +3.419412300105674e-02; +4.804338094715086e-03   +3.497842324279001e-01   +5.568451372425104e-01   +2.213926264455885e-01   +6.227506068960882e-01   +2.833667247035186e-01   +1.608682343342317e-01   +5.159841501106306e-01; +3.650993966982660e-01   +3.442333462785934e-01   +2.819729092059144e-01   +6.019894467369104e-02   +1.538464625004548e-02   +6.493336700346327e-01   +3.500189422116444e-01   +4.541598258886962e-01; +1.875427745707557e-01   +3.197665833278774e-01   +1.938363677548534e-01   +4.587106487899731e-01   +1.899964804419526e-01   +9.878752181928156e-02   +4.263420843350850e-01   +4.917749950099639e-01; +2.534143146911251e-01   +2.324338950671241e-01   -4.497006269866785e-02   +2.835108646647160e-02   +3.142872049242812e-01   +2.229003633197055e-01   +3.084414698885523e-01   +4.135614713449535e-01; +2.481155309655840e-01   +3.723421319176737e-01   +3.561559754463044e-01   +1.183783008894049e-01   +2.654343275154830e-01   -7.909544170743113e-02   +4.995107003011159e-01   +1.754216472136497e-01; +3.510245023343148e-01   +3.410150005415044e-01   +1.900061249970337e-01   +3.376652312447959e-01   +1.656693207855009e-01   +3.793200911175881e-01   +3.744412904994658e-01   +8.585754902227738e-02; +3.189478280754202e-01   +2.557855248541078e-01   +1.838662938625782e-01   +9.131891618995475e-02   +1.683604406004387e-01   +1.654972800571446e-01   +3.038682106346954e-01   +2.431364677199259e-01; +2.953081330142475e-01   +4.213201890646961e-01   +4.026417493113497e-01   +4.865116218208939e-01   +3.456787482891626e-01   +3.182668035518444e-01   +5.441571533897115e-01   +7.341117027623606e-03; +4.160188274746605e-01   +4.562711017644460e-01   +3.011201679095314e-01   +3.507040396332662e-01   +2.448566467315471e-01   +1.978072283058246e-01   +2.188402190454355e-02   +2.460546341837851e-02; +3.637727826408733e-01   +3.753157730707298e-01   -3.007704315101591e-02   +1.717321016098390e-01   +4.887170822101534e-02   +3.582612215113195e-01   +2.588721791572979e-01   +4.402352728195826e-01; +3.744495712548958e-01   +5.358796118897033e-01   +2.782670369528772e-01   +1.743744644164092e-02   +2.462141868804193e-01   +2.836803781211444e-01   +3.613420879929148e-01   -6.137858387942720e-02];
L2I_L3I_iGABA_netcon = [+1.105603433493100e-01   +1.734186846259893e-01   +2.262764879780057e-01   +3.999579575000430e-01   +1.591995244704934e-02   +2.077467845928239e-01   +3.002815947880089e-01   -4.935041469772284e-02; +4.477968166537758e-01   +3.428784048170297e-01   +1.681192496423592e-01   +3.459047705673779e-02   +4.202380558327607e-01   +5.462615781420035e-02   -2.660306608567840e-02   +2.710466725935031e-01; +2.586458542549641e-01   +1.786907333900348e-01   +2.278184085760856e-01   +1.984882340129414e-01   +2.417456363248014e-01   +4.140166874723405e-01   +3.406527289640099e-01   +3.642351893978952e-01; +8.515818202345957e-02   +3.049842672270541e-01   +4.625290411979605e-01   +3.888235275360742e-01   -3.161164968983245e-02   +3.149148194339998e-01   +3.062054320801691e-01   +3.848575431621945e-01; +7.694980668390969e-02   +1.881134973730220e-01   +1.893892316441305e-01   +6.881990076782909e-03   +2.024165362932511e-01   +3.458448838666705e-01   -3.282578513173112e-02   +5.709448397202862e-02; +3.745008974780242e-02   +3.512840860990299e-01   +5.000911331584272e-01   +4.128945233917423e-02   +4.394745328249077e-02   +2.547074301262973e-01   +1.559159092543119e-01   +3.293683764803719e-01; +1.388969072379754e-01   +3.142455724597106e-01   +4.118509132026473e-01   +2.705515582238781e-01   +1.711043295972648e-01   +2.419064853178330e-01   +3.179239901821059e-01   +6.965856593912878e-02; +3.185869783785955e-01   +1.007971266634696e-01   +1.464813847541186e-01   +3.502464431913836e-01   +1.835127896930172e-02   +1.659252776873751e-01   +2.294823351587173e-01   +2.269579873011970e-01; +2.698366822441977e-01   +6.149956007647020e-03   +2.234820867526615e-01   +1.945518004305161e-01   +1.077134753158239e-01   -2.919084632151618e-02   -8.306317092211810e-02   +3.636386820946496e-01; +3.541375240381017e-01   -1.155345364340984e-02   +5.389134337667245e-01   +1.788074919203812e-01   +1.443645984144993e-01   +4.715276745340288e-01   +5.556809322060720e-01   +2.294523104818478e-01; +2.788830619414424e-01   +1.214841982157817e-01   +3.033723824389863e-01   -4.480461741462369e-02   +2.142216839300686e-01   +1.561768245581269e-01   -1.217479317346772e-01   +1.671881737550079e-01; +2.876347936794779e-01   +1.631360128119490e-01   -9.577409101155787e-04   +1.049953624579434e-01   +3.643801373674792e-01   +2.914157994741990e-01   +4.551089292372417e-01   +3.981697934176537e-01];
L3I_L3E_iAMPA_netcon = [+2.258022764909106e-01   +3.161145899436842e-01   +3.322065483733397e-01   +3.647277367193005e-01   +4.308677627353645e-01   +8.384811239314363e-02   +3.426994204912722e-01   +4.285711918464574e-01   +1.183356419868543e-01   +7.554423298324052e-02   +2.393234813091427e-01   +3.232065861546207e-01; +2.813277605166639e-01   +5.606039828300777e-02   +1.660178118238868e-01   +4.122784058648886e-01   +4.815338988989681e-01   +6.454336351899354e-02   +1.919176855049164e-02   +1.383138452315537e-01   +2.671686402406585e-01   +2.434800481085393e-01   +4.946169232815398e-01   +3.716477036748606e-01; +3.757372938767419e-01   +2.805734913513692e-01   +4.464478706405783e-02   +2.929579589725113e-01   +8.598318154141549e-02   +5.134307614325384e-01   +4.520155199212058e-01   +3.002076408645520e-01   -2.919515684659348e-02   -3.184771662529075e-02   +2.098933753465275e-01   +1.249119345717893e-01; +2.343201021250286e-01   +2.820673980148608e-01   +5.728993823294221e-01   +1.202674600837158e-01   +1.594658244274945e-01   +1.833160284902666e-01   +3.671606982400246e-01   +2.389659139803283e-01   +3.648879782299659e-01   +4.555382931111240e-01   +1.075054010881156e-01   +1.200306295633441e-01; +2.916732629169220e-01   +2.896426668365849e-01   +2.048784639167001e-01   +2.649381229137427e-01   +2.074967120869197e-01   +3.671658716073716e-01   +3.253520717456638e-01   +3.212136153226225e-01   +3.033937903546657e-01   +2.104246204293343e-01   +2.024766038515070e-01   +1.230432339351591e-01; +1.210885437128993e-01   +3.875459364274674e-01   +5.227691194058134e-01   +3.008023688573382e-01   +2.048522904434264e-01   +2.325702548184982e-01   +3.295620354673280e-01   +2.466421864114480e-01   +3.267799260302944e-03   +6.601130538197247e-02   +2.236274144670719e-01   +8.447268103387674e-03; +2.557164980507920e-01   +2.710976088125687e-01   +4.372035658920986e-02   +2.666306625270588e-01   +5.347819893355681e-01   +3.648100905745283e-01   +1.718288181608626e-01   +8.795988839974928e-02   +4.933410779963850e-01   +1.690768985874154e-01   -2.524940793917102e-02   +3.630177332002005e-01; +1.016244346037330e-01   +9.608839844270242e-02   +4.676801506694338e-01   +3.119203158706130e-01   +2.942007260524787e-01   +3.432166681739014e-01   +1.815908552435970e-01   +1.311661294502471e-02   +3.917670048317523e-01   +4.664615989605386e-01   +1.262879973464524e-01   +2.326748299653599e-01; +1.509326416714964e-01   +3.665347377584695e-01   +6.250472575880728e-03   +1.722553477253729e-01   +3.218816862152287e-01   +2.165948103619774e-01   +5.627786869391715e-01   +1.827273873586513e-01   +1.018541660003839e-01   +2.660334666053518e-01   -1.018200485391459e-01   +3.603520667479516e-01; +9.790939660331596e-02   -4.407735377389048e-03   -7.549592901124182e-02   +1.375565945756803e-02   +1.298598675359062e-01   +1.419894296933082e-01   +1.668545062836624e-01   +2.802075895356304e-02   -3.516442415335658e-02   +4.491567837345078e-01   +4.056957911182428e-01   +1.317824517682062e-01; +3.342801516616811e-01   +3.503323422399831e-01   +1.018122525210942e-01   +3.884641236929713e-01   +2.104279098426280e-02   +2.782459814962378e-01   +2.355943213114929e-01   +6.248614806203139e-01   +2.096617346732865e-01   +1.802947120319807e-01   +9.902746543347909e-03   +3.486806127990418e-01; -5.443390576678449e-02   +1.844490195705951e-01   +1.698257042694558e-01   -3.424949258952314e-02   +2.148182435909660e-01   +2.276287526984471e-01   +2.015120697096331e-01   +3.110386071078231e-01   +2.431374903946984e-01   +1.020874281146025e-02   +2.959723703786982e-01   +1.032020076759855e-01];
L3E_L3I_iGABA_netcon = [+2.552421490915493e-01   +1.665679333424747e-01   +1.943337589219156e-01   +2.162729974417637e-01   +9.678584256104762e-02   +1.477644853513567e-01   +3.537193233568421e-01   +8.976593437859093e-02   +2.496740426418913e-02   +5.893873586056626e-01   +4.197819764391397e-01   +4.106859788921691e-01; +1.686842590704280e-01   +2.639982205773523e-01   +1.267130016668271e-01   -5.521448740309715e-02   +3.807842246722454e-01   +4.393597880058589e-01   +3.967327266537692e-01   +2.839297179177075e-01   +4.456515010721317e-01   +1.975389201987200e-01   +4.949745491821373e-01   +3.483414945014396e-01; +1.853979825528277e-01   +2.933300746048027e-01   +5.083615709464757e-01   +3.221489826590346e-01   +4.278311547270043e-01   +2.025630688085086e-01   +2.478492979426065e-02   +3.401573300460508e-01   +4.542953734785090e-01   +5.149677194383049e-01   +1.645506063197289e-01   +9.379451099179459e-02; +4.143391215179826e-01   +4.506302897675528e-01   +4.416255962743397e-01   +3.328963449150149e-01   +4.028443716616638e-01   +4.756561511365613e-01   +4.131257753905023e-01   +3.444705278598666e-01   +3.126783436953279e-01   +2.138987956422335e-01   +3.699572814261138e-01   +2.383076272729822e-01; +9.766656073150896e-02   +3.856210053332565e-01   +4.259191161327746e-01   +1.664142386247939e-01   +1.133481921471671e-01   +5.146212389488426e-01   +8.094041437536584e-02   +3.429590516613011e-01   +9.986982963041510e-02   +3.621627778430518e-01   +5.023166534185828e-01   +7.533006378655055e-02; +2.324034020890686e-01   +3.125394742561932e-02   +5.954853811384353e-01   +5.244370037782964e-01   +3.632321254086772e-01   +6.643862524060554e-02   +9.255100061829499e-02   +3.825896037085533e-01   +2.400506054689715e-01   +9.457456671223208e-02   +1.215798091210724e-01   +1.064439361363198e-01; +5.141258416507920e-01   +1.530381786770445e-01   +6.031540011075520e-01   +1.511404359067352e-01   +3.365466855749717e-01   -1.765007452912238e-02   +3.606941140841588e-01   +1.134603053727242e-01   +5.854764199086763e-02   +2.130885790822286e-01   +2.011230532470178e-01   +2.638298296059683e-01; +3.433864179874819e-01   +8.386541045980052e-02   +1.854323227239189e-01   +5.535341799225029e-03   +1.066645743901129e-01   +5.925177063964986e-01   +1.822382027029135e-01   +4.255895082733799e-01   +1.917663387766455e-01   +5.833288157263816e-01   +4.191938105595225e-01   +2.213520865415938e-01; +1.532856805766439e-01   +6.079989940926510e-01   +2.413796609654610e-01   +4.291936059096635e-01   +1.185709689817652e-01   +1.375522122912991e-01   +1.482479030512925e-01   +8.119630486399373e-02   +3.350645285974134e-01   +4.494922553304771e-01   +2.710677029231582e-01   +1.772022049625224e-01; +3.156164199979127e-01   +4.491888400420468e-01   +1.555374022941219e-01   +6.096355215237180e-02   +6.570621451575946e-02   +1.326694066414360e-01   +2.156792543549990e-01   +8.081481609741321e-02   +2.859599885048391e-01   +2.426329837039468e-01   +2.870976510523263e-01   +5.561250138046919e-01; +4.299024545493010e-01   +5.189009695608732e-01   +3.732799878335598e-01   +3.144514973987231e-01   +1.974393507690785e-01   -2.291530894747629e-02   +2.923297971756535e-01   +9.038654213178933e-02   +1.655947941072461e-01   +3.872541449886408e-02   +4.821901464763538e-01   +1.511380833578654e-01; +8.424324716715892e-02   +3.503339219136996e-01   +3.230902710979832e-01   +3.424495948186073e-01   +4.310956459373865e-01   +4.127788477821183e-01   +9.563321622167384e-02   +1.134883470145363e-01   +3.909923284862586e-01   +3.826708557775798e-01   +6.941636747387249e-02   +3.810337286314874e-02];
L2E_Input1_iAMPA_netcon = [+4.063056918998478e-01   +9.384724178965979e-02   +1.006372948216440e-01   +3.590740550390029e-01   +1.704982918162797e-01   +4.152102578629414e-01   +2.954703658601077e-02   -7.601296484813728e-02];
L2I_Input2_iAMPA_netcon = [+3.195028501197814e-01   +2.307255401870453e-01   +5.309492793220116e-01   +1.907967227984807e-02   +4.447083254845784e-01   +3.724583841396645e-01   +4.758668572547049e-01   +2.782346971722351e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
