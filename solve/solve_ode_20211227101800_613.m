function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.648364118671098e-01   -3.392265325254089e-01   +1.213146435616767e-01   -1.502137166677631e-01   +1.648064966656496e-02   -1.365334495868982e-01   -1.444829949654822e-03   +2.399401558369364e-01   +3.121068463323354e-01   +1.901092483185169e-01   +1.927172348338323e-01   -3.840309150076465e-02   -2.379546886599777e-01   -1.547308573988105e-01   -2.370986732881241e-01   +1.859874606687007e-01; +3.301984332102701e-01   +2.594269062584490e-01   +4.697351423351520e-02   -1.252854307845894e-01   +3.732285379076110e-01   -2.798636546337410e-02   -1.557695885138023e-01   +1.807714043706977e-01   +2.846232800674424e-01   -5.267250217850586e-02   -2.574872579965313e-01   +6.789226379057846e-02   -2.340390635871485e-02   +2.750464134251409e-01   -4.845561198380703e-02   +2.218799530197008e-01; -3.375943827261070e-01   +1.677915748663128e-01   +3.312066842423269e-01   +9.389960819714406e-02   -3.635488425639036e-02   -1.152507831165366e-01   -5.958365553075295e-02   -2.544114170708806e-01   +1.127023719883594e-01   +2.952040925821959e-01   -1.223274830301106e-01   +4.474704433008484e-01   +1.357981903819373e-02   +1.581193815666029e-02   +1.469980679879791e-01   -2.238318128070959e-01; -4.020576583833725e-01   +1.707040139294713e-01   +4.194639131713018e-01   -1.404987808332820e-01   +1.585162034128652e-01   -3.245464555130438e-01   -8.153347226853655e-02   +2.247278752460014e-01   -1.219895053907912e-01   +1.566507919139395e-01   -8.170650850988911e-02   +3.218418062956893e-01   -1.544137906872805e-01   +5.113312756818958e-02   -2.594356489610378e-01   -2.531885814061224e-01; +2.435553200101189e-01   -9.752220085851004e-02   +4.947390645432365e-01   -3.219061076898709e-01   -7.372956034704564e-02   +4.244565835263681e-01   -3.317710676014147e-01   +2.653292256783725e-01   +8.040676742754511e-02   -1.775680191354412e-02   +2.912225871232772e-01   +7.069347172479842e-02   -2.498061779797683e-01   -2.462693379664315e-01   -9.067908516210865e-03   +8.836911667156111e-03; +7.945421812699149e-02   +7.392326014911513e-02   +5.911344206532174e-02   +1.979603501355299e-01   -9.770199459947415e-02   +2.084243182796895e-01   +3.028107594801484e-02   +4.402116736427204e-01   -9.676820291340325e-02   -5.450307257579526e-02   -2.597743639408141e-02   -1.550459896561768e-01   +1.390694035927005e-01   +1.226488425645360e-01   -6.207221156802103e-01   +1.781947264629404e-01; +1.727427517079275e-01   +1.967383134028166e-01   -3.707169121815297e-01   -2.516012111758399e-01   +1.351881155194620e-01   +1.376843656526007e-01   -6.041107936587947e-02   -1.384485168751194e-01   -2.654384407155355e-01   -2.310104931278080e-01   -2.141290502893650e-02   +2.619371166800457e-01   -3.668006563956493e-01   +2.389780751500533e-01   -9.954649564131124e-02   +5.182395724278501e-01; +5.224451059887160e-02   -6.222158233920343e-02   +1.059728745876714e-01   +1.549791030053986e-02   -9.510682031148875e-02   +1.528085263581513e-01   -7.738159999539987e-02   +2.622439008583324e-01   +3.550139242086281e-01   +2.511228892669071e-01   -1.231172911616038e-01   +6.513139844824187e-02   +2.045013942179035e-01   +3.331463158033363e-01   -3.314816983354064e-01   +2.482036415599654e-01; -2.687624660195806e-01   -2.368158892590760e-03   +1.577032004715682e-01   -2.356752167285353e-01   -1.191483586742916e-01   -2.914831112914565e-01   +3.456538524471827e-01   +4.120772108502605e-01   +4.127732925688853e-01   -8.702436759165615e-02   +1.814849936804408e-01   -2.464009566702337e-01   -3.377552416596747e-01   +8.661811460296111e-02   +3.257068144128961e-02   +2.586543617228411e-01; -2.405906105065565e-01   -2.452386298740425e-01   +1.741238837967537e-01   +3.651614127870391e-01   -2.232654110019826e-02   -2.204649267179624e-02   +1.688620375749364e-01   -5.083826049236637e-01   -3.265160898627995e-02   +1.560056203505103e-02   +4.025767149153982e-02   -3.476551474684667e-01   +1.085186363711280e-01   +1.835206678506118e-02   -2.093284899832239e-01   -4.410723229246982e-02; -2.949961357438099e-01   -1.995606369027056e-01   -3.632879216278314e-01   +2.921091210908253e-01   -1.583066109240834e-01   +6.044895299756851e-02   +1.372341649649293e-01   +1.591272722388596e-01   -3.159934921825527e-01   -1.869695733228346e-01   +2.087077230266155e-01   -1.338419183555398e-02   +1.736256581731532e-01   +3.484103533365667e-02   +9.506875440876210e-02   +1.066861174172709e-01; -1.361824293053066e-01   -3.632724351363983e-01   -4.331524709135219e-01   +2.275423523042799e-01   -1.094396078250394e-01   -2.072068222829690e-02   +2.442443418235106e-02   +1.891833454747577e-01   -2.074178639537673e-01   +2.513507506933339e-01   -1.567423349526714e-02   +1.584699292949981e-02   +4.386572783990124e-01   +2.980321481079254e-01   -5.769301590558642e-01   -7.634023172731780e-02; +2.581196926558071e-01   +4.689727825811842e-01   +2.837444879492436e-01   -2.442519485537578e-01   +1.179931926325223e-01   +1.329030964387296e-01   -2.647457496112520e-01   -1.789427121277045e-01   -7.457372087468245e-02   -1.304757217476823e-01   +1.192256974642046e-01   +2.127360894408847e-01   +3.372706754398628e-01   -8.345074311765766e-02   -3.668761246969250e-01   +2.770168963724767e-01; +4.181403327267527e-02   +3.172679221613767e-01   -1.958002370233432e-01   -1.082379772825615e-01   +3.582846224034991e-01   -1.064377581364521e-01   -2.858907444259692e-02   +2.424349729817124e-01   +9.216916313389177e-02   +2.658439176145864e-01   +1.463923085224828e-01   +1.268568915186302e-01   -1.805326535116404e-01   -3.376700351380134e-01   +4.997783329264583e-01   -4.355000336724973e-02; -5.256364486884590e-01   +2.325297584705276e-01   -2.430877495762311e-01   -3.367549500605566e-01   -2.460122226310372e-01   -3.788785270404969e-02   +1.036500795031502e-01   +4.522383402944422e-02   +1.949723953090758e-01   +1.211680890689905e-01   -3.038757486647242e-01   +3.771199023907272e-01   -4.677371709954167e-02   -1.371345810781564e-01   -2.262149094814306e-01   -1.991632364520164e-01; +4.145927987823888e-01   -1.603551315137225e-01   -3.231239364009068e-01   +7.883691379485608e-02   -3.203779293180836e-01   +1.998454814346026e-01   -2.628447598033233e-01   +4.593160929522208e-03   -1.803161338296073e-01   +2.633781623563731e-02   -4.085146985384955e-01   +2.627669837408850e-01   -3.393432531733374e-01   -3.551721766424619e-01   -1.836931656936034e-01   -1.930491043628565e-01];
L1E_L1I_iGABA_netcon = [-3.227950436696105e-01   +2.324554818202499e-01   +3.389116703877588e-02   +1.183177792938396e-01   +1.201392132950949e-01   -1.194486795134818e-01   -1.439281118500821e-01   +1.453153588757894e-01   -2.433705430495346e-01   +2.759120491623368e-02   +2.785710650600158e-02   -4.078310759389802e-01   +1.689735042108224e-01   -3.811619847077607e-01   -2.693513877169953e-01   +3.418236707751694e-02; -1.185598193196794e-01   -2.348618728432418e-01   -1.479456919921047e-02   -1.994762713983880e-01   -1.933963320581677e-01   -7.869196725757535e-02   -1.537329631231455e-01   +3.396155109453523e-01   +1.553417301643492e-01   -3.924560198640476e-02   -5.600659656629556e-02   -4.429524793085954e-01   +2.171187948082719e-01   +2.459824173258232e-01   -1.126805068880291e-01   +3.593032112434962e-01; -1.523958718631683e-01   +2.390140277134286e-01   +2.088916242822602e-01   -6.022971947719910e-02   +1.730631073817639e-01   +2.078652164728825e-01   +1.783238970006261e-01   +2.377226603034631e-01   -3.855186743732874e-01   +2.870148554929268e-01   -3.457745407036348e-01   +9.730367486075979e-02   -1.091112467234016e-02   -1.437806336960529e-02   -3.550615611482758e-01   -5.774717892817521e-02; +2.493998065051825e-02   -1.139513808433166e-01   -1.770848434701827e-01   +6.976905785694158e-02   +1.013151678583143e-02   +4.542535425264255e-03   -4.432385796957071e-01   -1.686151150092456e-01   +1.637709972740445e-01   -3.827485487827337e-01   -4.413760694621861e-01   -1.543993331425411e-02   -2.909170287800931e-01   -1.403967187448562e-01   +6.277978461446138e-02   +1.754186335801909e-01; +5.493048202475329e-02   +1.294664422493665e-01   -3.760820166084030e-01   +1.864466503274096e-01   -3.055893886940344e-01   -6.102680718441109e-02   +4.826700339742050e-01   +1.085825008041072e-01   +1.380121572824863e-01   +8.208283129292127e-02   +8.907561057641909e-02   +6.026964701744351e-01   +2.890985261805235e-01   +2.110824223763235e-01   -3.515917854002525e-01   -1.578798466410207e-01; -8.848030577383978e-02   -3.787696202135408e-01   -1.918973284810016e-01   +3.096963903619379e-01   -2.607140745936684e-02   -2.130301577929468e-01   -5.722396030340803e-01   -1.549272416767986e-01   +2.835338258171325e-01   -3.513351873684921e-01   -3.030749217546763e-01   +3.477606824342085e-02   -1.370541657715590e-01   +1.785913706594411e-01   +6.252506936745282e-02   +5.698951333363352e-02; +1.632663395999610e-02   -6.161564888646139e-02   +2.618219310812946e-01   -1.510370764306931e-01   +1.347084022688489e-01   -1.920464743460072e-01   -2.253187498612765e-01   +1.426065251125749e-01   +1.105629622435376e-01   -1.814945236566715e-01   +1.534999318574405e-01   -2.964106198837568e-02   +5.880831767436147e-02   -2.124138991199327e-01   -1.397742417352298e-01   +2.535232742817477e-01; +3.241432152701764e-01   -4.024232291123491e-01   -2.945474077505353e-03   +4.126025938229306e-01   -1.307780239257447e-01   -2.338379366933771e-02   +1.433172473179990e-01   +1.147814004512939e-01   -3.752180500555604e-01   +4.178944766459218e-01   -1.451899894773743e-02   +2.218958829108844e-01   -3.230367776855373e-01   -3.898551027167244e-01   +1.072733153982318e-01   -1.175706393266627e-01; +3.694847061434870e-01   -7.761480027406553e-02   -1.338210643894368e-01   -1.220527985840830e-01   -4.243120218967995e-02   -8.873033532624811e-02   -1.315567801873297e-01   -4.939035083480413e-02   -2.375106290949668e-01   -3.814875199360223e-01   -4.926799436287833e-01   +2.323753585192427e-01   +4.060568997545320e-02   +8.651038313950646e-02   -6.597141364833736e-02   -4.169436312730088e-01; +2.550911841127176e-02   -1.897749903115419e-01   -3.109388043311246e-01   +2.228876446493734e-01   -4.014446438131088e-01   -1.419963527198990e-01   +4.837231080841220e-03   -2.835318955328266e-01   +1.253099628410256e-01   +8.665958458656858e-02   -1.135788077023729e-01   +3.360814965256416e-01   +2.029331778542486e-02   -1.653538046367810e-01   -2.427385664926426e-01   +2.170597659238072e-01; +4.622996127494183e-01   +1.030075987204960e-01   +8.110812175501916e-02   -4.450206422704681e-01   -2.252171052259758e-01   +1.549455213183149e-01   -8.745022177694771e-02   -2.354985622902360e-01   +1.967806469082671e-01   +2.237864146222377e-01   -6.974665346059525e-02   -2.599213933679979e-01   +6.040199828790624e-02   -5.830507362566531e-03   -2.945231038155761e-01   +8.015062692461661e-03; -3.878662306483798e-01   +1.945863264211488e-01   -2.105229293857123e-02   -1.438115290580606e-01   -4.187976163429693e-01   -5.417156875731466e-02   +2.058958874796149e-01   +3.005803481200262e-01   +1.327910152038313e-01   -2.781957865017783e-01   +2.221537971303995e-01   +1.118040967947057e-02   +1.029609129803193e-01   -1.267348319882072e-01   -3.289696723995947e-01   +2.383714885381716e-01; -1.578238455231220e-01   -4.388204147534660e-01   -1.766564857185668e-01   +4.176209623201400e-01   -4.112423970113842e-01   -4.303839217128006e-01   +2.947824325130908e-01   +9.766399830570713e-02   -2.153916589396860e-01   +2.786167204188602e-01   -8.632390139664084e-02   -2.705703650670952e-01   +1.666302582693171e-01   +1.485573272542727e-01   -1.107496253565587e-01   +3.466319668886872e-01; +6.373625047793169e-02   +3.384481799260458e-01   -1.656480080885291e-01   +5.041295591443442e-01   +1.734210107905059e-01   -1.999263884142378e-01   -6.176714759879047e-02   +1.025015710354828e-01   +3.771437063274010e-01   -1.509157948477306e-01   -3.152031589760842e-01   +2.721775890530673e-01   -8.089279404583716e-02   -1.343805409598539e-01   -3.176267630948063e-01   +3.257783989158267e-02; -2.647142236018183e-01   -1.556735427758629e-02   +2.325464944162229e-01   -2.302566594286015e-03   +2.466818737323149e-01   +1.998326924034393e-01   +1.349557352590267e-01   +4.198811693469356e-01   -1.359933101896767e-01   +3.457337233462405e-01   +3.528251558005537e-01   -1.200929645276126e-01   +8.020022414219806e-02   -3.438231050993402e-02   +6.019639062743529e-02   +2.381409829374563e-01; -2.894300288816207e-01   -3.882591305984050e-01   +1.561451254308367e-01   +8.009102290842890e-02   -1.266859567614350e-01   -4.315001122737422e-01   +3.324658792646190e-01   +3.485612341416431e-02   -2.877387064087135e-01   +2.230168182056083e-01   -6.151315806504158e-02   +1.925442355698434e-01   +3.009012268146902e-01   +1.876143266565742e-01   -3.988975636049497e-01   -2.310436727296543e-01];
L2I_L1I_iGABA_netcon = [+6.019309633844899e-02   +2.776205692596193e-03   +1.355196177927928e-01   +2.437801078481163e-01   -1.024433334070962e-01   -1.170109792059519e-01   -1.118855006785049e-01   -5.128983250509410e-02; +3.323012246926406e-01   -4.357531835566963e-02   +2.001512506969452e-01   -2.869236123266507e-01   +1.478913626975183e-01   +3.916054759276056e-01   +2.111692638134446e-03   +8.502678290389303e-02; +5.375635206189439e-02   -1.206694664759316e-01   -2.615987035698168e-01   +9.676651741129677e-02   -9.327866680544103e-02   -7.021267904870133e-03   -5.064536045500920e-02   -5.636240326146413e-02; -3.317299276705019e-01   -1.173213260341920e-01   -2.111562062942575e-01   +3.095371337393922e-01   -3.844968404695510e-01   -1.946550517176288e-01   -1.968722947749989e-01   -3.236526425893736e-01; +1.566072250664799e-02   +1.367309550104390e-01   +4.650338851725809e-01   +3.468573522364749e-01   -2.024086161384859e-01   -6.362281315034633e-02   +3.709527820880264e-01   -1.421576187895333e-01; +9.979215673636813e-02   +7.852846012996509e-02   -2.102148016689296e-01   -1.483687996134421e-01   +4.179044864061333e-02   +2.805686826314550e-01   -2.382147218574743e-01   +7.729167759165631e-02; +2.254698475118110e-01   +6.683190956716906e-02   +2.049095885273354e-01   +1.055931487529759e-01   -1.178953140169613e-02   +3.107490070996970e-01   +4.494926209354139e-02   +1.853343598600576e-01; +6.777437488538035e-02   +2.788076020192598e-01   -1.103666285629495e-01   +2.627638320252533e-01   -1.131047796447176e-01   -1.540398310496583e-01   +1.804480827455626e-01   +2.431030013424527e-01; +3.333130081507343e-02   -3.000048516853199e-01   -3.473655493159585e-01   +2.864561808485153e-01   -2.541693475848334e-01   -2.240302901016641e-01   -1.024926975233469e-01   +4.850034510512144e-02; -1.711785122715591e-01   -2.597491550466785e-02   +8.903186605863561e-02   -1.106643065039253e-01   +3.247720430878857e-02   +4.311251036304392e-02   -2.895098509642824e-01   -1.334241862454562e-01; -2.385659048121230e-01   -2.784958046236422e-01   +1.576770305696837e-01   -2.177302305812041e-01   +2.114127649082858e-02   -3.265803337516105e-01   +2.160093132704352e-01   -2.875839047001350e-01; +1.315094082035890e-01   +2.776986059971042e-01   +3.817106736361437e-01   -4.595379313980664e-02   +9.679004388662096e-02   -5.527493894070705e-02   +1.021390860214198e-01   +1.274996633515763e-02; -1.154703261843146e-01   +2.710017056200038e-01   -5.324046874392327e-02   -1.087799740467574e-01   -2.010412197360770e-01   +1.908421150998872e-01   -3.923438038233185e-01   -6.555187374049638e-02; -3.861327941601758e-01   +1.852636910322260e-01   +2.544937062203452e-01   +2.320993537832511e-02   -2.340544600716203e-01   +2.704595609771915e-02   +7.319931033549015e-02   +1.798390561827414e-01; +9.389848076913809e-02   -2.710182697042218e-01   +7.649609561500161e-02   +2.593428236113283e-01   +2.017742771228914e-01   +3.194073356929811e-02   +1.000434014879925e-01   +7.976164691302659e-02; +1.721970619686377e-01   +8.433175421163537e-03   +2.121849661824023e-01   -3.090915411632233e-01   +2.303815827542914e-02   +1.006868831692234e-02   -3.272021362780626e-02   -1.585028794706615e-01];
L1I_L2I_iGABA_netcon = [-4.515921052258640e-02   -2.924269272639290e-01   +1.509927747963037e-01   +6.888192602685592e-02   +2.745855086901261e-01   +9.085049272518012e-02   -2.446937472080669e-01   +3.013301894730359e-01   -3.669770780992666e-01   -5.974797080024041e-02   +7.791781673364853e-02   -8.924365627754254e-02   +5.531336484222946e-02   +1.226000840254612e-02   +3.430897199112663e-01   -3.895583719662754e-01; -3.139244556888415e-01   +3.007246355741733e-03   +3.389280758246642e-01   +4.233886089386515e-01   -1.356254467910067e-01   -8.890866955103356e-02   +5.789917169807772e-02   +4.704310845006787e-01   +2.087832365485540e-01   -1.838621667977293e-01   +1.403971701216837e-01   +2.098513473738528e-01   +1.196964074239322e-01   +4.126394030781030e-01   -2.197239788594374e-03   +3.457672515361600e-02; +3.308271043177030e-02   +2.939214213497188e-01   +2.400609572988924e-01   +4.086227095945935e-01   +3.794735982775925e-01   -2.679451610691878e-01   +1.363625490066746e-01   -3.092955468518725e-01   +9.449196960411207e-02   +7.355913999638493e-02   -2.531432985271946e-01   -1.204956376918004e-01   +2.311196927777666e-01   -2.822992064195583e-01   +3.038656575663566e-01   -5.514010130264955e-01; +1.688405692501497e-01   -2.054766843757012e-01   +4.374375708964207e-01   -4.356695654528294e-01   +9.784947510002859e-02   -1.795628109369300e-01   -2.877360185593694e-02   -1.626988447338367e-01   +2.859708240200457e-01   +2.984479775745696e-01   -3.602266948325056e-01   -9.276368240381722e-03   +3.685445880640695e-01   -2.268562290573896e-01   +2.694775763670603e-01   +4.087776062235394e-01; +1.904635692944765e-01   +1.244074623981857e-02   +7.790590592905641e-03   +2.476755338657794e-01   -4.886391801884964e-02   +9.682370016930249e-02   +1.542363821987665e-01   +1.397599041772063e-01   +5.749781009170463e-02   -1.608483538025564e-01   +2.048738789614837e-01   +2.941192638722209e-03   +8.800197809334323e-02   -1.145486257851485e-01   +1.115689380347773e-01   -5.361502215346605e-02; -2.342008124902527e-01   +4.700742198056385e-01   +3.860666852678877e-01   +2.121883364757337e-01   -4.912820661351636e-02   -6.922784644143855e-02   -1.030432870402486e-01   -4.184871301402808e-01   -1.449048200548524e-01   -2.752856676932090e-01   -3.527687744614241e-01   +1.653059794710235e-01   +2.270982154668056e-01   +2.385881885686376e-01   -5.313472198462676e-01   +2.151291523553022e-01; -3.634671586716701e-01   +5.967962518067263e-03   +1.435989068022283e-01   -1.038743485089779e-01   -4.081338871213179e-01   -5.000912108657612e-01   +1.781031736062150e-01   -1.472283892799858e-01   +1.591468638348396e-01   +2.140367679804779e-01   +1.427791037726061e-01   -2.861238807992875e-01   -1.890447147403271e-02   +4.110609752499231e-02   -9.747096653845487e-02   +2.523232206892967e-02; -1.550471734647320e-01   -3.189678467368294e-01   -9.679445922811933e-02   -1.030175294683773e-01   +7.573640561654081e-02   -3.228472298742797e-03   -1.971247652841800e-02   +3.029239553349294e-01   +4.388732723744738e-01   -2.083778309369424e-01   +1.858565256714522e-01   +5.643553460551949e-01   -1.504531131442745e-01   -1.416377517452594e-01   -3.330562181098316e-02   -1.155773739693679e-01];
L2E_L1E_iAMPA_netcon = [-8.231922123106533e-02   +1.802337622892264e-01   +3.114052664763190e-01   +2.399276854279604e-01   -9.136203444160337e-02   -1.273398086994394e-02   -5.120721382394849e-02   -4.432432048336150e-01; -1.996341192448465e-01   -1.394550943045927e-01   -1.474087413292862e-01   +8.653990855453665e-02   -1.037844153342509e-01   -1.076023669234319e-01   +7.500038773526016e-02   -1.097949704331465e-01; -5.548476290303088e-01   +1.303137473054645e-01   +4.307895268305240e-01   +3.248970345579130e-01   -4.907744947390792e-02   +3.714797420569732e-02   +3.163779127661593e-01   +4.893453388638640e-01; -8.951005227430428e-02   -2.425022596819585e-01   -8.577029313304074e-02   -3.056733832530194e-01   +2.705605573337393e-01   +3.098395187803319e-01   +9.110327679713454e-03   +2.227883055652088e-01; -2.637654487468931e-01   -1.257962044034875e-01   +1.744511369454689e-02   +4.581634700268528e-01   -2.759119319786985e-02   +6.656378781938674e-02   +7.190194816057296e-02   -3.921786406834198e-02; -2.604647876613008e-01   +4.360378783118544e-01   +2.791796559222827e-01   +3.450764219139071e-01   +5.853127632481381e-02   +8.201034544159033e-02   +1.161025126314745e-01   -8.328989068813322e-02; +2.717517153191996e-01   -1.841068054377819e-01   -6.311169787312636e-02   -5.181799540512970e-02   +1.185491495985696e-01   -3.638229745904730e-03   +4.533393859664092e-02   -2.292033233036398e-01; +4.719389934475442e-02   +1.226346308235982e-02   +1.102449353011946e-01   -3.465060344904980e-01   +4.680632359253208e-01   -3.920283003831180e-01   -2.380693075577774e-01   +2.363898706018866e-01; -5.679181682439870e-02   +2.230719726242594e-02   -2.853014689125055e-01   -3.255476573801260e-01   +6.087173632750738e-02   +1.164894596150033e-01   +2.761993775172064e-01   +1.702048006842041e-02; +7.238750991234613e-02   +1.663163444589255e-01   +2.165984718925872e-02   +2.271949947301106e-01   +2.445874265477367e-01   -1.754290468803799e-01   +1.717928905631233e-01   +1.149966341125388e-01; -8.482699007614887e-02   +7.163303737578974e-02   +4.051995501241060e-01   -1.674004422252427e-01   +2.126238382285964e-01   +4.380219907839484e-01   -1.680384351119090e-01   +3.185257705876338e-01; -5.960122760465271e-02   -1.174392956221638e-01   +1.091919994136423e-03   +2.987470560750773e-01   -8.894663659616794e-02   -1.022170121211552e-01   -1.284518017971716e-01   +2.412582593701978e-01; +8.328920749432329e-03   +8.911723493115103e-02   -3.420438408737236e-01   -3.042437267679123e-01   +1.063992655690742e-02   -1.041529611453378e-01   +2.121831024970797e-01   -1.085389397153581e-01; -2.572170004614803e-01   -4.142285086598453e-01   -9.696593976964372e-02   +2.032911914616719e-01   -2.023366279745389e-01   -2.037061883595117e-01   -1.443419972460629e-01   -5.513161617710010e-02; +3.627540578579251e-02   +2.829975188087655e-02   +5.510924133247288e-01   +2.677272223511862e-01   +2.563612913551930e-01   -1.565588937728143e-01   +1.483871890596171e-02   -1.567640913651996e-01; -3.233715933253235e-01   +1.985002210478933e-01   -4.397151380009344e-01   -3.012443636972224e-01   +6.706962916250661e-02   +4.080723622801880e-01   +1.795833105310460e-01   -2.415095540550761e-01];
L1E_L2E_iAMPA_netcon = [+7.991722864778063e-02   -3.216513373375781e-01   +1.173792248533806e-01   -1.299059582333544e-02   -1.976498226178313e-01   -3.624306940090010e-01   -2.118893258809695e-01   -2.079677648424850e-01   +5.034239897980088e-02   -2.727149386745792e-02   -1.346302564741706e-01   +5.197813978969736e-01   +1.707803223152513e-01   +1.237718924627814e-01   +1.557762252111619e-01   -2.777862396505103e-02; +3.450486113729132e-01   +3.014623111352143e-01   +5.676991470475574e-01   -7.102938322128752e-02   +1.796251952219276e-01   +2.084939699162704e-01   -5.850035524649402e-02   +2.368625632854577e-01   -2.288716406430589e-01   +3.036340975536608e-01   -4.091268168615427e-01   +1.320107841297361e-01   +5.819020702319841e-02   -2.281329896109189e-01   +2.062536575643142e-01   +4.111183805765282e-02; +1.498558193993915e-01   -1.098308181014572e-01   -3.693954759617917e-01   -1.255155765959147e-01   -1.830335752220086e-02   -1.921309760831660e-02   -5.227984793860790e-01   -2.047422205870356e-01   -3.350928946529087e-01   -3.458361163378076e-01   -1.119635046718456e-01   +1.990770774262499e-01   -4.495596660336444e-01   +1.462456486720318e-01   -1.666446166244222e-01   +2.342957700293588e-01; -1.416048447274528e-01   -1.495193032349300e-01   +4.876498072239746e-02   +3.866730324958054e-01   -8.145725704565850e-03   +9.624792594248228e-02   -9.978332495917400e-02   +3.509120747267512e-01   +1.492670166505092e-01   -2.285255577121588e-01   -1.768985056784418e-01   -3.326207723414972e-01   -3.274661889033804e-01   +6.678390792080528e-02   -7.774886151858554e-02   -1.205188259597837e-01; +2.205244034987474e-01   +2.061540019293573e-01   -2.215343705238644e-01   +3.611450334977433e-02   -3.619901365473834e-01   +8.563113405482767e-02   -3.471158846527948e-01   -1.142681146098639e-01   -1.660697470144670e-01   +1.119157496832526e-01   -1.110652327233814e-01   -8.769074808974869e-02   -1.535905326974399e-01   +3.079809825417253e-01   +3.380041072928546e-01   +8.390411965275693e-03; -4.035226020629588e-01   -2.090200102206584e-01   -8.678894940661842e-02   +1.175658862629952e-01   +1.017094485987628e-01   +1.867632603791178e-01   +5.273433583500344e-01   -1.678725007566463e-01   +2.592102953261832e-01   -1.690925824826891e-01   +3.288547106430521e-01   -1.780434858223932e-01   -1.993246605774750e-01   +5.223502492224544e-01   +1.220814862644763e-01   -7.942306634875809e-02; -7.365098549670951e-02   +2.792730061199713e-01   +2.151890729619617e-01   +6.282380501701380e-02   +4.842010020159547e-02   -3.837565951653590e-03   -1.888662957110869e-01   -2.263658102935076e-02   +2.241613840351552e-01   -2.092518874545951e-03   +4.725070432374070e-01   +3.828000920124658e-01   +3.626129090870589e-01   +1.097951540678022e-01   -3.670695675477963e-01   -1.838885735855545e-01; +7.076998238433907e-02   -2.857109109259806e-01   -3.664587726085045e-01   -2.088442298443650e-01   -1.216470448225611e-02   +2.393107000433940e-02   +1.234306002489323e-01   -2.885832754617572e-01   -2.758509737753295e-01   -8.329971238206688e-02   +1.001620044132255e-01   +1.494193120073299e-01   +8.478385862954055e-02   -1.401078234870203e-01   -4.195557399145292e-01   +1.234227096264242e-01];
L2I_L2E_iAMPA_netcon = [+8.670369463367186e-02   +3.329172101672757e-01   +1.890508992450869e-01   -1.014910715638669e-01   -1.903889177904580e-01   -8.580621407993466e-02   +1.565738161440252e-01   -2.269576947781853e-01; +8.422731298782583e-02   +5.038700767125035e-01   -2.086066458116425e-01   -1.480592381589494e-01   +1.381819129182920e-01   +3.374131829517110e-01   +2.980798236873483e-01   +7.677010423136124e-02; +2.022015837697779e-01   -1.545398309637677e-01   -1.574867322332211e-01   +9.124557041690486e-02   -1.278270890896929e-01   -1.062261760466106e-01   -1.466845509634992e-01   -3.432394538374797e-02; -2.361869982830268e-01   +1.299204223985383e-02   +1.316082435393180e-01   -1.549030589261240e-01   -3.535214340988250e-01   +2.307636865651896e-02   -5.997455927817230e-02   -7.931250104290306e-02; -1.421363491609939e-01   -1.452753460797545e-01   -2.305451419483862e-01   +2.032011114072124e-01   +1.894125319037503e-01   -1.368611857092922e-01   +1.466983260694668e-01   +1.887430767155934e-01; +9.051152009917435e-03   -4.862204894863217e-02   +2.838566921183860e-01   +1.708721045966580e-01   +1.583622206081598e-01   -8.165932639789653e-03   -1.241678451493399e-01   -2.518084780733308e-01; +1.839120865544471e-01   -8.521152397229476e-03   +1.901693449284944e-01   -1.657219418357481e-01   +2.784735354395330e-01   +6.141350382309860e-02   -1.620024455575562e-01   -1.273333905322725e-01; +3.576478470819910e-01   +3.612303468092749e-01   -4.113411703295363e-02   -6.376465663019071e-02   +4.141147030147148e-02   -1.617260843081360e-01   -1.091701783799942e-01   -1.157318680982370e-01];
L2E_L2I_iGABA_netcon = [-1.127253279284156e-01   +1.354634414368789e-01   -1.841610716752384e-01   -3.714232622275500e-01   +2.140968279057832e-01   -1.150269344737734e-01   -3.183450580505558e-02   -2.609533942325200e-01; -2.089608350284407e-01   +1.176894580736944e-01   +1.464347079262896e-01   +1.962853499254012e-01   -2.406767978715610e-01   -3.021966749071296e-01   -4.806767238472702e-01   +2.903004001613785e-01; +1.439578999911388e-01   -1.471357019483933e-01   -8.397207839145937e-02   -1.561099225599523e-01   +2.847208015447976e-01   +1.375617309427985e-01   -2.737837144274188e-01   -2.424457247485861e-01; -1.291381795996279e-01   -1.141685010706387e-01   -1.358128923103914e-01   +1.493289927804289e-01   -8.037068716585910e-02   +5.860444582553061e-02   +1.913578814465358e-01   +2.255087780382548e-01; -2.660805045671283e-01   -1.733527797901096e-02   +4.111894687871671e-01   -1.924841384163040e-01   +7.477130249955691e-02   -2.442799240409641e-01   -9.208889630610764e-02   +8.015720224828432e-02; +1.966246746307071e-01   +3.594303081853681e-01   +7.860380928994923e-03   +2.693090198468245e-01   -2.528168163030474e-01   +4.815088172478304e-01   -2.887608057576387e-02   +2.143116449069389e-02; -8.997070003702157e-02   -2.912887880898519e-01   +3.377710712038874e-01   -5.042096273761376e-01   -1.617961413435152e-01   +4.270481803558885e-01   -2.492915739404180e-01   -2.432371379645937e-01; +3.191246095295861e-01   -1.446770483302107e-01   +2.024718788373100e-01   +4.287309326637598e-02   -3.005313828742840e-01   -2.869801278083867e-02   +9.587008615786052e-02   +4.136513145041661e-01];
L3E_L2E_iAMPA_netcon = [-2.610795804526405e-01   +8.999011028925941e-02   +1.702414557056656e-01   -7.698927147494385e-02   +3.855105140996513e-01   -2.029723981478330e-01   +5.778777088877012e-02   -1.834346503117970e-01   -3.933196605583751e-01   +8.930797313322847e-02   +2.648786269460694e-02   +4.101388195356866e-01; +1.037411183715197e-01   -1.249453646898288e-01   -1.401788484128349e-01   +2.443420542968587e-01   -1.282236444017834e-01   +3.690959238516764e-01   +2.720058862164871e-01   -4.931304207895723e-01   -3.746081822312167e-01   +3.245070509092884e-01   +3.498646739255774e-01   -1.644027869313017e-01; +2.295204966602626e-01   +6.595803443973085e-02   +1.029326326243442e-01   +4.364465534783658e-01   -4.079330817382970e-01   -2.883474847781732e-01   +3.005765630936104e-01   -9.238301618060571e-02   -1.053786507883976e-01   -1.181939613203248e-01   +2.602250471623402e-01   -9.641019307224463e-02; +2.211321510029348e-01   -4.778489202012898e-01   -4.181295153425418e-02   -1.765935323968485e-01   +1.954432313568382e-01   +2.980283744093957e-01   -2.421583706113285e-01   -1.492152622964686e-01   -1.327627213653035e-01   +3.013223805163153e-01   -2.016618709775126e-01   +1.872982639358381e-02; +3.903803219876442e-01   +2.571400209216768e-01   -2.665260995256899e-01   +2.643640187173003e-01   -5.049985231478847e-02   +4.636226656196151e-01   -1.853694427840746e-01   -3.351698534923683e-01   -4.433922429375209e-02   -3.005438004404672e-01   -6.483796893487175e-02   +9.906140838386851e-02; +5.357596335870146e-02   +2.945829387695801e-01   +3.307245514530480e-01   +5.222682035912464e-02   +1.269428542849596e-02   -8.494779776885507e-02   +5.426762383032852e-02   -1.396784974007093e-01   -2.446578259449408e-01   -3.262246041027496e-01   -2.216706529068820e-02   -2.354925821154354e-01; -1.697453895153623e-01   +2.293003228030506e-01   -2.468628052493704e-03   +1.433997596472966e-01   -1.816668483230731e-01   +1.579737694950303e-01   +1.144732666539436e-01   -5.681300138683593e-02   -6.329469817796862e-03   -1.231633900548404e-01   -5.242048851833907e-01   -2.448818128040803e-01; -4.853663787071275e-01   +9.391200568254642e-02   -1.072421728243051e-01   -8.111310754170513e-02   -3.790848103537733e-01   -1.582924171973643e-01   +2.363715663016220e-01   -3.986140641583832e-02   +1.520208200137250e-01   -9.218846253468130e-02   -7.757735508373217e-02   -7.736484835787211e-02];
L3I_L2I_iGABA_netcon = [-2.922356386140074e-01   -1.700868045100121e-01   +1.352684530413878e-01   -8.716773355871998e-02   +2.107815504721470e-01   -1.050883670136759e-01   -2.171548814689402e-01   -2.652775953550067e-01   -4.484644412002683e-02   +2.451430346713074e-01   -2.780361139585956e-02   +2.968723606602571e-01; +3.128192802212755e-01   +9.729399980513082e-02   -4.888766150667033e-02   -5.924473215295062e-02   -2.570678770982107e-01   +4.373083438417132e-01   -4.426347986783352e-01   -3.001379061295195e-01   -9.435054997833114e-02   +3.623509357149767e-01   -1.524177571317726e-01   +2.073300473697416e-01; -1.033406349650851e-03   -1.706887646433955e-01   -2.301062180837154e-01   -3.162207109644897e-01   +5.897368072314335e-01   +2.093342323414162e-03   -2.185946277591737e-01   -1.195747495826199e-01   +3.247989929656241e-02   +1.016689509855308e-01   -4.097841585129521e-01   +1.106848209361768e-01; -3.409997257627713e-01   -9.147108946418028e-03   +7.467477586935314e-02   +2.386412747525047e-01   +3.933504584559439e-02   -4.589151650842856e-01   +8.456673952332991e-02   -5.440291931603732e-02   +3.916150518205122e-02   +2.755171515888256e-01   +3.645931620270090e-01   -2.397385196232740e-01; +4.301241803087603e-01   +2.460135963206001e-01   -2.651870836115832e-02   +2.449685741493522e-01   -2.130611938045684e-01   -1.437007217145553e-01   -9.918096733065285e-02   +1.021271711592229e-01   +2.533963643623752e-03   +5.129544146854091e-01   +1.591511149523592e-01   +4.447847189346007e-01; +2.623191874818550e-01   -6.237685037974567e-02   +1.191909568576750e-02   +3.177664543342845e-01   +3.220438119081506e-02   +1.669826776309944e-01   +3.163361975549810e-01   -1.260828899075155e-01   +3.089940356904908e-03   -2.476182541404007e-01   -3.683716334041217e-01   +2.411156218769051e-01; +1.708911582001306e-01   -1.472005973975719e-01   -3.053343119263810e-02   +8.981209936735259e-02   -2.268077200642588e-01   -1.009945791890653e-01   -6.993768617581625e-02   +7.355170968115099e-02   +2.817207492181749e-01   -4.414053143234489e-01   +2.301143273663214e-01   -2.599674069072938e-01; +3.724763581336565e-02   -4.565555629930085e-01   -1.012086370671494e-01   -3.620964303833746e-01   -3.603695227719732e-02   -3.910303257074493e-01   -1.256997472754577e-01   +7.026688004114207e-02   +1.883246992904483e-02   -2.772318300498404e-01   -5.268034701508184e-02   +1.293402342238475e-01];
L2E_L3E_iAMPA_netcon = [+1.598012629266740e-01   +1.422187938514828e-01   -8.157783926981466e-02   +3.637853877055114e-02   +1.169501881493684e-01   +4.537043289784018e-01   -1.220824184795077e-01   -2.367373290543175e-01; +2.065086722569511e-01   -2.567534681325733e-03   -2.678997467839824e-01   +4.002443410758181e-01   +1.535302976743254e-01   -3.008072558517714e-01   -4.460526915700446e-01   -5.753913576733086e-02; -9.289297571139649e-02   +7.018425380417066e-02   -3.727251233414508e-01   -9.554048984107032e-02   -2.610074597349474e-01   +8.969538954756787e-03   +6.495069375815025e-02   -3.291320688522630e-01; +3.448553909761574e-01   -2.776206519358143e-03   -3.060927184292844e-01   -4.706358424177781e-02   +8.069331583107023e-02   -2.900050043642782e-01   -3.031051044358239e-01   +4.469563270450568e-01; +7.502171690027787e-03   -9.204994300589678e-02   -9.908292575152616e-02   -1.103930899259613e-01   -1.573039459362079e-01   +1.083633976426941e-01   +8.996581030225266e-02   -1.769748941910417e-01; +8.638690360757806e-02   +3.556018538297803e-01   +2.463241109334637e-02   -6.811327312862082e-02   -3.015162002265974e-01   +1.329899190127684e-01   +2.665226898913116e-01   +2.953535476983012e-01; +3.116112488924014e-01   +2.911006104212273e-01   -1.830939522109637e-02   -2.249333362007404e-01   -9.273152582832880e-02   +3.255382053600355e-01   -3.720238319050918e-01   +4.250120280589945e-01; +2.295021673623654e-01   -3.435539346690708e-02   +8.668339011911939e-02   +1.333077690674509e-01   +3.635404961288058e-01   +4.348923733113923e-02   +3.113174941225921e-01   -2.136333662304059e-01; +6.038259760524967e-01   -4.571072113074306e-02   +5.705151861420970e-01   +2.959822887861056e-01   +1.107772069613278e-01   +3.027873005073783e-01   -7.130545917220821e-02   -1.166031683706254e-01; +4.478264673037102e-02   +1.021634067435826e-01   +4.979901550330550e-02   +3.312300223763326e-02   +2.584803828029441e-01   +2.683161474953455e-01   +2.477357541165865e-01   -1.208078700198532e-03; +2.763361933153423e-01   +4.054065048812986e-01   +1.024858279807862e-01   +9.490697570986215e-02   -1.134638887128093e-01   +1.638723314966796e-01   +2.839762183543530e-01   -1.216785198099623e-01; -1.118318741712941e-01   -1.736256259767334e-01   -2.011375993297531e-01   +1.894346945180946e-01   -1.595090051289930e-01   +4.512203778186383e-02   +1.516159051170829e-01   -4.632925829990323e-03];
L2I_L3I_iGABA_netcon = [-1.140470488159597e-01   -1.062541696215060e-02   +4.924668715948166e-02   +1.091850873581185e-01   +1.883411612998673e-01   +1.067380886458567e-01   -2.162666250893902e-01   -3.568119155491725e-01; +2.700021785644511e-01   +2.407587802485055e-01   -1.718562878506357e-01   +2.422874898001347e-01   -1.158603462413748e-01   +4.595166045408412e-01   +1.616038549191240e-01   -2.360897544819675e-01; +5.294893561048782e-02   +3.377992680360819e-02   +1.494343321964052e-01   +1.347907121998845e-01   +5.488532012550712e-01   -3.826657926473044e-01   +4.013138888942112e-01   +2.097630384839942e-02; -1.298922554352229e-01   -8.008764268111646e-03   -1.639749894227578e-01   -9.180953987109469e-02   -3.521949911900094e-02   +2.582631255969349e-01   -7.727059386762375e-02   -2.322688684369606e-02; +1.019015975970193e-01   +4.101200427102431e-01   -4.395028987924562e-02   -1.162594766948194e-01   -2.836966950045368e-01   +5.079364240734932e-02   +4.523750115661271e-02   -1.934557834961080e-01; +8.806395334038802e-02   -1.501222344727475e-01   +5.380965031008352e-01   -1.100829962732767e-01   +3.243474971073721e-01   +2.416947665636144e-01   +1.073888788723145e-01   +1.653187908205436e-01; -1.467561319307473e-01   +3.792914163492722e-01   -8.132013639925223e-02   -4.274856024849206e-01   -8.667317592643722e-02   -1.459581842292735e-01   -8.871865169028190e-02   -2.549607439638621e-02; +3.413396561604827e-01   +1.325862504184834e-01   +1.103212757438706e-01   +3.452973797318930e-01   -1.821081693738635e-01   +5.094665056704888e-01   +2.233284342905486e-01   +1.075119755906875e-01; +2.433461509239020e-02   +1.523438362592678e-01   +1.302691581484298e-01   +1.084526281850387e-02   +1.592537228750849e-01   -1.583440919348512e-01   -1.502003164834845e-02   +1.611860038325091e-01; +1.975308095232239e-01   +8.024543987208851e-03   +2.298919804082268e-01   +1.037383666795502e-01   -7.596938237777486e-02   +2.430003602335378e-01   -5.246586098595168e-02   +1.448958250085070e-01; -1.780621715626634e-01   +1.365335822719722e-01   -1.160981148059116e-01   +2.723617569798777e-01   +8.771979461359730e-02   -1.236285615920360e-02   +6.047402155303772e-01   -4.402465882746531e-01; -6.788852979120029e-02   +1.895226238859669e-01   -2.055597556074469e-01   +1.355582581434339e-01   -3.630970904822891e-01   +3.453932174997555e-01   -2.445056365096427e-01   -2.891190065138908e-01];
L3I_L3E_iAMPA_netcon = [+1.401782043401976e-01   -2.326894284345689e-01   +5.697207708763178e-02   +2.409231216304517e-01   +1.971673184039025e-01   -1.883647053944249e-01   -8.465388232122088e-02   +1.086419192225439e-01   -2.158611883804027e-01   -1.247804440500546e-01   -5.170475341894494e-01   +2.366951596883599e-01; +6.729051360431032e-03   -1.434229294806257e-01   -1.351606439943854e-01   -2.018718629489100e-01   +2.357987947163213e-01   -2.775251785810808e-01   -2.241968936803395e-01   +2.341613220335919e-01   +1.721493635318231e-01   -1.655359508961885e-01   +6.612844314225387e-02   +4.246697767851921e-01; +2.178341554417763e-01   -4.330711979761379e-02   -4.588767392049563e-01   -3.250493214142323e-01   +3.034723349256502e-01   -5.933486817924097e-02   +1.883258461170056e-01   -2.949922508223980e-01   -2.635220067411628e-01   -1.976801833844963e-01   +3.139461843169559e-01   -1.095194696631135e-01; -3.529789795418407e-01   +2.822438122370259e-01   -1.774643495101576e-01   +3.829116467579631e-01   +1.544809625404714e-01   +2.429660903993883e-01   -3.825691113549544e-01   -1.452507639929281e-01   +9.538275209083608e-02   +6.297150210674889e-02   -1.440352614441310e-01   -3.049978052037259e-01; +1.937609282757473e-01   -1.213613691162742e-01   -5.409576608556792e-02   -6.006577327513170e-02   -1.179818822271089e-02   +2.988668465745946e-01   -2.143024287279983e-01   -3.178484029693375e-01   +9.400869565406386e-02   +4.513464744164711e-01   -1.851158980865159e-02   -2.748362584429138e-01; -1.514512654149764e-01   -5.198840454126425e-01   -2.226525502906317e-01   +1.468866896457199e-03   +3.059556178057413e-01   +3.397764336493039e-01   +1.286617264707178e-01   -1.193072329523854e-01   -4.072250865987817e-02   +1.115757647977126e-01   -1.464875594286963e-01   +4.364355942922009e-02; +5.319572408844780e-02   +2.771180931717172e-01   -1.622169566535628e-01   -1.810023526805249e-01   +4.590945797657059e-02   +1.734726578501321e-01   +5.224986795124582e-02   -1.876757126518999e-02   +2.601602181148138e-01   -2.726467291352828e-02   -1.214415724206916e-01   +3.079211615547445e-03; +1.966701101367081e-01   +6.986244630646163e-02   -2.883588690352087e-01   -7.601718658660314e-02   +1.968513310409026e-01   -1.220976089878586e-01   -8.968471752158869e-03   -4.651878924513524e-01   +2.205390647359991e-01   -8.845738636209713e-02   +1.591650169129970e-01   -6.199507301763885e-03; +2.340476948967228e-02   +1.923476183620013e-01   -2.073089875750964e-01   +3.142176141759065e-01   -4.628905208814524e-02   +2.347370102389005e-01   +8.910214149970053e-02   -4.861371449026136e-01   +1.872924611125522e-01   -3.666524773848310e-01   -3.158342490608265e-01   -3.365472168594875e-01; -4.766974171192143e-02   +1.840952631396904e-01   +1.706454768782186e-01   +8.892734090096344e-02   +3.862015925478287e-01   -1.532149364582349e-01   +3.624269658072908e-01   +1.581157822141911e-01   +2.608504277653940e-01   +1.021620632105349e-01   +3.406765752638551e-01   +1.116593775118269e-01; -1.241499154632674e-01   -1.083873248094767e-01   -1.540769770348402e-01   -1.926158222973844e-01   +3.072370169082062e-01   -2.103633676419459e-01   -2.240181433611741e-02   -1.047324785863559e-01   +1.746200824324626e-01   +1.809771298709926e-01   -2.338060701848454e-01   +2.286186547107376e-01; -4.450308119797061e-02   -3.156872492221647e-01   +3.861075576572320e-01   -3.276707052326943e-01   +1.693068479286090e-01   -2.477534810413183e-01   -2.388607255276480e-01   +4.283137614996531e-02   -7.704693142096042e-02   +3.987746847261983e-02   +1.785164541119797e-01   +7.216247210238302e-01];
L3E_L3I_iGABA_netcon = [+2.597539540199192e-01   -2.338486091751248e-01   -1.640420759706862e-01   +1.900227995417101e-01   +3.909173320990670e-01   -1.888363448438316e-02   +7.156523399972661e-02   -1.495383658087293e-01   +2.720630618173339e-01   -6.967819586244114e-02   +5.579378221539915e-01   -1.509673692325991e-01; -5.225663849027971e-02   -1.199413409797524e-01   -1.975978870458819e-02   -8.107191702259399e-02   -1.357501576195082e-01   +1.693760999812350e-01   -1.679303104552556e-01   -8.597696607463005e-02   +1.711425148419837e-01   +1.047751090726861e-01   +1.682393848770705e-01   -3.494461045912997e-02; -2.661117470465492e-01   -2.519332419849432e-01   -6.629949995369724e-02   -2.673248235378694e-01   +6.298256098927826e-02   +6.764345480281780e-02   -2.602101631413439e-01   -3.425979550054915e-01   +7.459716063052066e-02   -1.278450398186137e-01   +3.046315774816640e-01   +1.844155101095376e-01; +1.128359494622146e-01   +9.958198808858938e-02   +1.122226449963545e-01   -1.331229866770538e-02   +5.678612846264497e-02   -3.333453632800664e-01   +1.034918290124039e-01   +2.171108398009709e-01   -2.294951003542370e-01   -1.158305130430329e-01   -3.060714206040300e-01   +4.179129405079502e-01; +3.859456019805013e-01   -8.728898360102869e-02   -3.661250944299655e-01   -1.834384289523371e-01   +1.041428681575392e-01   +3.020233950191074e-01   -2.715914154322797e-01   -1.850744782596116e-01   +5.346907090864797e-02   -2.729977237187184e-01   -2.276880014077301e-01   -2.141685361906890e-01; -3.117470953517198e-01   -1.893550562821624e-01   +2.658307189552010e-01   +2.931807723262119e-01   -2.711819810154462e-01   -5.811846239939199e-01   -1.718835419832857e-01   -1.094100820563122e-01   +2.324450207625445e-01   -1.515365406353123e-01   -1.103376188911424e-01   -1.907878111570624e-01; -1.297875701521293e-01   -1.048993928564157e-01   -1.811017142088384e-01   +2.272054419351374e-01   -1.729847477830228e-01   -1.113476778327134e-01   -1.932209363391306e-01   +4.074203540418520e-02   -1.492750121902583e-01   -4.467915564236642e-01   -6.600299767957868e-02   +3.375622640525869e-02; +1.250347527677868e-01   +2.189577117741390e-01   +8.467321153055385e-02   -5.735337223209464e-02   +1.493781638304708e-01   -1.147733595659004e-01   -2.558898150544370e-01   +2.376756696479207e-01   -7.855487060141322e-02   -1.791198057445297e-01   -2.537224230273768e-01   -2.204904469378320e-01; +3.862720149950755e-02   +9.876246767225941e-02   +3.048389592642316e-01   +6.915408326465958e-02   +3.376032059008477e-01   +1.878306736322164e-01   +4.359607059254965e-01   +2.797367088522713e-01   -1.598167921165818e-01   +2.011584960758723e-01   -2.357896226211096e-01   -1.536285859700277e-01; +4.501072000057004e-01   -1.957718805517191e-01   -1.525287838638326e-01   +2.904930039222361e-01   -2.380824962320214e-02   +1.493858521185577e-01   -2.240240873492436e-01   +7.180383943208467e-02   -2.763021263711013e-01   +7.415345251753168e-02   +1.299124722054730e-01   -3.674597190102447e-01; -4.591475556857015e-01   -1.010726857372570e-01   -4.441569305072942e-01   +3.003786503966903e-01   +4.309339180112658e-02   +3.952262607699387e-01   +1.452076710282977e-01   +1.178708499499794e-01   -3.520881567915861e-01   +2.193657903607504e-01   +2.523978114024278e-01   +3.768471360541564e-01; +3.562312347572716e-01   +9.289430703870330e-02   +8.092348294178331e-02   +1.352675811638566e-01   +2.277103105908682e-01   +4.994077713246824e-02   -7.033617077008886e-02   -2.868599521065675e-01   -3.445649550485358e-01   +9.713659078526282e-03   +2.413977041542621e-01   -3.929331907521219e-01];
L2E_Input1_iAMPA_netcon = [-1.762021681807076e-02   +9.773573695622784e-03   -4.076507852701722e-02   -1.874717997661957e-01   +1.682290978919695e-01   -2.102874287754074e-01   +2.114877330568337e-01   -7.270521483783925e-03];
L2I_Input2_iAMPA_netcon = [-1.332286080657190e-01   -3.611693423477527e-02   +3.385639636594287e-01   +1.473679732296632e-01   -1.072935974511067e-01   -1.924320750569980e-01   +1.789252048330432e-01   +1.569083495892673e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
