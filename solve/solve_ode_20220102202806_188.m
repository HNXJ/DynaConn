function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.213895459013263e-01   -1.918628396321103e-01   +5.010344160957557e-01   +2.824820429933900e-01   +3.261254239432591e-02   +7.905935487007348e-02   -6.521366381008454e-01   +2.013417713548502e-01   +5.774587214351468e-01   +6.288118446976072e-01   +1.477816082519983e-01   +5.566607562624345e-01   +3.041917917597042e-01   -8.435114213493893e-02   -2.319219537742115e-01   -2.211371312033202e-02; +5.094936337431200e-01   +1.315995616649871e-01   +7.054314902145035e-02   +3.877376028034730e-02   -3.255094492414723e-01   +6.258166758684975e-01   -6.419699871065122e-01   +1.143259637053331e-01   +6.596397392927462e-01   +1.335332499725120e-01   +9.106086647352103e-01   +4.982244094521294e-01   +3.742750786299622e-01   -1.920400060054587e-01   +1.231344877669739e-01   -6.740798887215237e-02; +5.351473332818169e-01   +3.090965388761676e-01   -6.009803484382209e-02   +1.834995117996553e-01   +1.910367354930111e-01   -1.534561682633853e-02   +3.600693359978794e-01   +4.455669606483439e-02   +3.451339612206703e-01   +2.958752988610004e-01   +3.665924400554839e-01   +3.272080512068916e-01   +2.763662543213979e-01   -4.538540017976991e-01   -6.210136365050745e-05   +1.462662479359508e-01; +4.259723838022392e-02   -2.128828181411807e-01   -1.239817552817476e-01   +5.511731073866619e-01   -1.456391444076698e-01   +3.158646590708239e-01   +5.716255846204207e-01   +8.298224576587804e-01   +4.340368343149754e-01   +1.808966758704948e-01   +3.910371519417368e-01   +4.382842120348320e-01   +1.477034102791678e-01   +3.383279059061917e-01   +5.297531317128729e-02   +7.360783586609925e-01; +2.905420444585495e-01   +2.699233467098231e-01   +5.609959293041259e-01   +6.231615441109821e-01   -2.790626464964731e-02   +3.068608808955022e-01   +1.409316809225119e-01   +2.802510642491670e-01   +6.188952080647889e-03   +3.980943311736697e-01   +5.574533191215832e-01   -3.036520408670074e-01   +3.186072747046757e-01   +2.692622113360402e-02   +4.062631459722220e-01   +2.503055420098302e-01; +7.748142219363527e-02   +5.751475932670375e-01   +9.546725921076810e-02   -4.766859150352765e-02   +5.586186506532447e-01   +1.959527555188276e-01   +5.323137268755983e-01   +2.683003351710159e-01   +2.650380166519125e-01   +4.198481002669120e-01   +1.222095093083907e-01   -2.959303529549977e-01   +3.005910932071554e-01   +3.351200236131004e-01   -3.919479150516965e-01   -2.451309010354591e-01; +2.866832056850040e-01   +1.760077454263229e-01   +4.460205566594836e-01   +2.301838506060609e-01   +1.141519892409104e-01   +4.211516638933893e-01   +4.631867628446003e-01   +2.698957341739365e-01   -2.491251330227477e-01   +9.433521561319683e-02   -5.786007771455552e-02   +3.356141195746298e-01   +3.090504926515171e-01   +1.424153078272321e-01   +3.506859031744180e-01   +4.716134079665726e-01; +4.898756806571478e-01   +1.176354957985120e-01   -5.173606906216184e-02   +4.065013354511446e-01   +5.600675000016106e-02   +1.156617208698873e-01   +1.504226934033243e-01   +6.225740423281759e-01   +3.315246939595677e-01   +2.802845645769959e-01   +3.503263881083574e-01   +2.603176399050008e-01   -1.307221949416570e-01   +1.598665489034516e-01   -2.871830023444122e-01   +2.808797017914471e-01; +7.282081727940684e-02   +4.550558171246550e-01   -3.356882830819729e-01   +3.292475196578784e-01   +3.512632005922277e-01   +4.405932983860714e-01   +7.131995554937995e-02   -4.209975914013708e-01   +3.073992988617416e-01   -8.148620557004374e-02   +6.428779807483490e-01   -1.665915496404079e-01   +3.731756548173020e-01   +5.049694722688783e-01   +6.033463545522341e-02   +2.041448160983826e-01; +1.419075111636350e-01   +6.939454935174436e-01   +5.727166947627541e-01   +1.671741315538161e-01   +4.303094540363298e-02   -2.309094141348198e-02   +4.896158365274415e-01   -1.607811071626070e-01   +1.301950457143507e-01   +7.712763029165456e-02   +4.964601870308026e-01   +1.924505184850664e-01   +4.704023514793461e-01   -9.586306798623645e-02   +9.368460110968213e-02   +4.181977551852505e-01; +1.390704722098798e-01   +5.694260403648924e-01   +6.690057033955638e-02   +1.678091867634325e-01   +5.791173327381128e-01   +1.372170551090266e-01   +3.514698486906883e-01   +1.631504028732797e-01   +1.459958190437400e-01   +5.629152442621700e-01   -4.057689754397201e-01   +3.079047659292198e-01   -4.864819969457458e-01   +3.609151455299989e-01   +3.435634959773018e-01   +2.281992099688601e-01; +4.516398402464881e-01   +3.246334002624279e-01   +1.181311012426622e-01   -6.543866685477047e-02   +8.172720401892898e-02   +2.088973264400038e-01   +3.578929699438441e-01   +2.250274078828853e-01   +6.151272675966617e-01   -1.222079184009341e-01   +2.888464993091514e-01   +5.632395889225527e-01   +5.744306363369965e-01   +1.706986336888631e-01   -3.743106526887123e-01   +2.250839258679202e-01; +9.637697730828290e-02   +1.854760999963860e-01   +6.663302160231340e-01   +1.129744200032285e-01   +6.589234412026794e-01   +4.956902975099901e-01   +2.947768151818890e-02   +2.742359191643010e-01   +7.463567395142624e-01   +7.820675536896157e-02   +1.714241211019699e-01   +4.239131952596347e-01   -1.160847113633343e-01   +3.220832183286793e-02   +1.721881932031792e-01   -1.837131777688930e-01; +4.727965535855826e-02   +2.237005054760502e-01   +3.374727526947687e-01   -6.492343383863981e-01   +2.609231788995773e-02   +7.808758529358784e-01   +1.302504427145575e-01   +2.463600453686342e-01   -1.600337909757185e-01   +1.145621561342133e-01   +4.355063914395247e-01   +3.355901392956538e-02   +3.043274485038538e-01   +5.129660395654844e-01   -8.752395643899913e-02   -1.898380027946731e-01; +2.983237077504179e-01   -3.343835821249588e-01   +6.316928646511397e-01   +3.898708245664801e-01   -2.624628607095102e-01   -1.032507154719812e-01   +3.036756931817174e-01   +5.732973162289018e-03   +1.642919475347367e-01   +4.988902268359931e-02   -1.415761894838633e-01   +2.314929690963818e-01   +4.573969056190051e-01   +1.671064343710208e-01   +6.396288993020256e-02   -3.680840006302174e-01; -5.603541656085861e-01   +5.836401221959150e-01   +1.033882039733500e-01   +5.324611664942605e-01   +8.055945420420314e-01   +6.368861502143200e-01   +1.117568279340841e-01   +6.683673436768793e-01   -1.223680445893307e-01   +3.594210873739677e-01   +3.189233390626156e-01   +4.474646939047061e-01   +4.529273338687463e-01   +3.893636850327202e-01   +4.734255747347310e-01   +2.008171515149272e-01];
L1E_L1I_iGABA_netcon = [+4.861287577677635e-02   +2.334481465182507e-01   -1.725704415632606e-01   -8.482175493135360e-02   +7.930054853396273e-01   -2.058923921549363e-01   +1.555044970469554e-01   +2.195866663318659e-01   -1.425255505223929e-01   +7.157131955247351e-02   +4.594314981054248e-01   +3.287982500736225e-01   +9.251409556144448e-01   -5.828625194610592e-01   -1.226857703412910e-01   +8.349078605120782e-01; -3.576258523409260e-01   -2.462555058581164e-01   +5.622969451772084e-01   -2.840000015613863e-01   +1.192139062674341e-01   -2.608490331988009e-01   +4.767094818018581e-01   +4.084225293096308e-01   +3.909858067032452e-01   +1.543959806887232e-01   +5.336133632178034e-01   +1.840921783321953e-01   +7.690272722478291e-01   +1.616148220105964e-01   +2.914154906764386e-01   -1.519574303901475e-01; +8.273139438091189e-02   +3.354883134586581e-02   -2.335161810010621e-01   +4.407369090672170e-01   +2.514904770220117e-02   -2.868513146847527e-01   +4.879284300748572e-02   +2.431498613082258e-02   -6.494955991421275e-02   +6.693328969200971e-01   -1.006027625607973e-01   +2.377142020839570e-01   +1.068543051501483e-02   +7.499361284081477e-02   +6.345745043781917e-01   +2.325261315000298e-01; +5.496679404450069e-01   -2.517396844116549e-01   +4.388113435003062e-02   +2.639785426836082e-01   +1.446377510628950e-01   +3.861086631099244e-01   +1.145890317527454e-01   -1.487919618149548e-01   +6.513338404201757e-02   +3.090702272967507e-01   +3.671062507307573e-01   +6.759854750922684e-01   +9.193457652765526e-02   +3.095668277703919e-01   +1.016751443718430e-02   -3.845967153520817e-01; +6.238792657107559e-02   -1.556796236051036e-01   -5.612887050673329e-02   +3.777700387346996e-01   +3.125282605181760e-01   -1.919591817977516e-01   +2.448295845370650e-01   -3.581540093054044e-01   +4.364128282517604e-02   +2.551774965498841e-01   -5.085136423057681e-01   +7.421357548747817e-01   +2.487033538730047e-01   +2.775344518348381e-01   +3.035621190002261e-02   +1.661248415996248e-01; +2.738499541396477e-01   +2.392330615434508e-01   +1.863865285482189e-01   -2.975620923551865e-01   -1.464635108077658e-01   +6.548431880637395e-01   +1.092470515332262e-01   -6.446980097179515e-01   -1.238249194164638e-01   +9.023269680714319e-02   -3.325279970294890e-01   +3.314000612786395e-01   +2.922952168611252e-02   -4.123451342957702e-01   +5.259709174775047e-01   +2.013246117240783e-01; -1.026795944988578e-01   +9.023304254925755e-03   -1.360619853650419e-01   -2.945891620264499e-01   +4.609526673189118e-01   +2.341976269221402e-01   +1.716381699036252e-01   -1.901733277876161e-01   +1.144694469692164e-01   +5.098875776957156e-01   +6.563628411150508e-01   +2.339909380321922e-01   +1.463264647301289e-01   +1.200853522476414e-01   +9.301671642073652e-01   -3.097119717847595e-01; +8.589900092086239e-04   +2.611534018516965e-01   +3.082992706829146e-02   +7.257756658837221e-02   +1.337153064376700e-01   -1.597216234438157e-01   +5.682160400101915e-01   +1.251217990456545e-02   +7.141414472695891e-01   +3.388246386656111e-01   +2.011110603584614e-01   -2.696224960843402e-01   +2.641685268717265e-01   +4.098638024566045e-01   +3.407596366062105e-01   +3.938998774184376e-01; +7.687730003801859e-01   +7.557443277530188e-01   +1.545647302557817e-01   -1.846726483862587e-01   -4.804538646543473e-01   +2.271632959261964e-01   +1.819768109301826e-01   -4.846748636380825e-01   +1.900792088575256e-01   -6.855726132208011e-02   +1.002553031778251e-01   -1.266518117136208e-01   -3.699062645840523e-04   -5.289926216990639e-02   +7.801300988876678e-01   -6.916463686847452e-02; +4.450244534492077e-01   +4.919720174553665e-01   -3.114897015414505e-02   -7.456051897555618e-02   -1.242535340796627e-01   +6.181457532338996e-02   +3.389249105276276e-01   +1.363241056361992e-01   +4.745289116555227e-01   +9.775981299580586e-02   -3.586443725875019e-01   -3.459173781670771e-01   +5.199062712857214e-01   +4.995745292472147e-01   +2.528188196450696e-01   +3.594357666338753e-01; +2.993713474773664e-01   +1.221167990822905e-01   +2.278947043314376e-01   +5.937785235422057e-01   +1.066001883305794e-01   +5.519796050858833e-02   +1.661742766171439e-01   -1.211425847202045e-01   +4.173969679877777e-01   +6.214510800298916e-02   +2.692099597794045e-02   +8.430354158574660e-01   +8.409954530448652e-01   +2.424724171631055e-01   -1.873532180559919e-02   -3.091739583378972e-01; +2.757619589551570e-01   +2.640265099525089e-01   -7.978683135744766e-02   -4.436282012778905e-01   -2.031819388108824e-01   +6.131927171185966e-02   -2.808284007917389e-02   +6.419174683494374e-01   -1.438296654660355e-01   -3.576433960193041e-01   +3.951980434105485e-01   +3.821646495772370e-01   -1.730671816491631e-01   +6.153784534393542e-02   +3.735450894442554e-01   +4.435467349847004e-01; +3.678354462873787e-01   +4.026559694039331e-01   +1.236662104022038e-01   +5.128524912140272e-01   -2.072928726680175e-01   +4.513671674692393e-01   +1.180475214629365e-02   +3.891437960523033e-01   +5.716270809836692e-01   -3.209982219187287e-01   +1.303873765500453e-01   +3.982943299541102e-01   +2.322063832239015e-01   +1.894717286917874e-01   +5.356069528865415e-01   +3.195519326783455e-01; +5.982781499057861e-01   -1.505869902827928e-02   -2.423427053239838e-01   +1.842641711261137e-02   +6.002798982945896e-02   -3.166609984291341e-01   +4.347864712067606e-05   +3.709800684448514e-01   +3.985461598046505e-01   -1.330617638860750e-01   +4.009090006896065e-01   +2.998712957702782e-02   +1.712359324838338e-01   -1.391161572938199e-01   +1.021197370863101e-01   -3.146766159440605e-01; +4.893656114226708e-01   +9.507773221493988e-02   +2.153954548904033e-02   +2.767964597001442e-02   +1.611428542469100e-01   +6.935406501522814e-02   +4.206952673374872e-01   +6.968845574173768e-02   +6.436852083674266e-01   -2.359540760879680e-02   +1.108014152455844e-01   +1.978800978267418e-01   +1.788786422210286e-01   -1.835652319864857e-01   +5.774448573278479e-01   +7.188609794876271e-01; -4.488166019537633e-01   +2.729148402112672e-01   +1.354939533334317e-01   -8.713141199193933e-02   +3.105146927084109e-02   +3.158738123483085e-01   +8.185617182549081e-02   +2.653220223616530e-01   -1.467332688461127e-02   +4.323347022054269e-01   -4.094857484751652e-02   +1.615098273246521e-01   +1.399135994241292e-01   +3.017209189534445e-01   -1.412164452161443e-01   +5.316758140426596e-01];
L2I_L1I_iGABA_netcon = [-2.214495345768202e-01   -2.551661038827363e-01   +2.307570287148691e-01   +5.060886293690154e-01   -7.909859505005599e-02   +3.208619218755681e-03   +4.027868669974421e-01   -3.839561500840081e-01; +4.242388030759295e-01   +6.597521605029015e-01   -3.363538978956185e-01   +5.554892041800442e-02   +4.619108436570933e-01   +5.866715685313958e-01   +2.384359790874544e-01   -1.000103898079144e-01; +4.897518978142461e-01   +4.768328104298287e-01   +8.952605335631714e-02   +4.305218790528861e-01   +4.717284892282562e-01   +2.137425388578708e-01   +3.991824178855609e-02   +5.541670155888216e-02; +5.891142145612488e-01   +2.599638461074363e-01   +5.715042489167680e-01   -4.674962711700106e-02   +4.260519760302799e-01   +3.415863340992131e-01   +6.294172313625218e-01   +2.896398442171149e-01; +1.690187164189870e-01   -5.157673951318190e-02   +5.002586124587289e-01   +2.609168937186390e-01   +5.296482776351280e-01   +1.253996680095530e-01   +1.579923994520494e-01   -3.572747968391791e-02; +1.954239980814158e-02   -8.773329751693792e-02   +1.948277080308491e-01   +2.126614386748428e-01   -2.297622538437125e-01   +2.115187475460159e-01   +3.379844460684691e-01   +5.048700734148994e-01; +6.905925428799335e-01   -8.657672273762784e-02   +2.882997377953840e-01   -1.256430412164388e-01   +3.328901243820400e-01   +5.149688531660651e-01   +4.477748382035663e-01   +1.604327261867764e-01; +1.288203804964704e-01   +5.132023870493867e-01   +2.497241088178683e-01   +1.966108037977565e-01   +1.658639485622653e-01   +1.524961441522976e-01   -2.185933677698996e-02   +6.625788049443299e-02; +2.329420770129773e-01   +1.000000000000000e+00   -5.965301448973451e-01   +3.244671443529474e-01   -2.565537353191910e-01   +2.294839786693172e-01   +2.086783500794045e-01   +1.800514241573231e-02; +4.789631117123374e-02   -3.195611119238341e-02   +2.049898397246462e-01   +4.307428936913641e-01   +5.596320933064318e-01   -2.008051260344450e-02   +6.373576585992172e-04   +2.658947053486276e-01; -6.286398758327827e-02   -2.790815030271108e-02   +4.578845641563923e-01   +1.267216605391463e-01   -7.931649489708185e-02   -1.636389164819650e-01   +1.501600781398338e-01   +2.011873860342161e-01; +2.714927394608649e-01   +4.910816724138218e-01   +5.559953738337612e-01   +4.435288590463952e-01   -5.592947835264083e-04   +4.233785347831479e-02   +4.929878399387702e-01   +3.348706200741206e-01; +3.795649739666609e-01   +5.469002783589525e-01   +5.316240485991558e-01   +1.636194392978391e-02   +1.341124517251579e-01   +9.322443177119100e-02   -2.348803188159131e-01   +2.039430246091945e-01; +7.495933456459826e-02   -1.880040916964393e-01   +2.920495525093045e-01   -1.350588442000242e-01   +4.294054248615845e-01   -1.513180328778874e-01   +3.633164393141782e-01   +1.045453420481702e-01; +2.307820369726843e-01   +9.122025162613488e-02   +3.879416322840489e-01   +7.994312675832427e-02   +4.821687318358525e-02   +8.205907797637196e-01   +2.507474653485697e-01   +4.012530823867644e-01; -7.147942928486264e-02   -9.086434609723849e-03   +2.708242435817130e-01   +3.108037116196279e-01   +2.906861021892393e-01   +1.645411375188762e-01   +2.060789569363944e-01   +4.282901734845124e-02];
L1I_L2I_iGABA_netcon = [+4.694703538033474e-01   -1.293452671059087e-01   -2.904821252401548e-01   +5.351122239772002e-01   -1.639868202616653e-01   +6.548453793068845e-02   +3.914849905618047e-02   +4.093324490523990e-01   -1.431274109543152e-01   +4.706470135884559e-01   -1.419516111582140e-01   +2.639128947271944e-01   +2.486860125613249e-01   +2.063744547627017e-01   +4.957024569209782e-02   +3.627080589698902e-01; +3.846589139253664e-01   +7.236944815554881e-02   +8.649283261626410e-03   -1.872829702657443e-01   -1.498684227809374e-01   +1.013711773733168e-02   +6.259291805375201e-01   +4.359564184939104e-01   +5.081831385659745e-01   +7.648725066757704e-01   +1.196147220458060e-01   -4.283386530163277e-02   -2.650180503642716e-01   -5.197634704714298e-01   +3.315117001008781e-01   +4.050840064469833e-01; +1.520817141076669e-01   -3.220585036862726e-01   +4.609832904533639e-01   -7.296437732143631e-02   +2.663565383947588e-01   -1.896298795989907e-01   +6.106807972615745e-01   +4.451420539901904e-01   -2.707833839897525e-01   +1.283025177925371e-01   +2.793470416342235e-02   +4.316195969548453e-01   +6.424471112702089e-01   +5.022460993245477e-01   +8.911623760929740e-01   -1.445706225710048e-01; +3.007902426577722e-01   +6.730931162951974e-01   +4.712751573940915e-01   +3.478401276159316e-01   +5.579812701854566e-01   +6.250997677891214e-01   +8.598158848039859e-01   +4.894991432332958e-01   -3.029662794702722e-01   +7.188426823345427e-01   +5.935879979453870e-01   +2.495524225351450e-01   +1.661674395080489e-01   +8.417555310291820e-02   +4.365890650302667e-01   +1.052821034366676e-02; -1.918424738604338e-01   +5.810150895408983e-02   -2.452834317390220e-01   +2.517731133261232e-01   -1.090923131074458e-01   +8.608375183242439e-01   +7.546511106299788e-01   +2.665781255894085e-01   +6.306991886045665e-01   +4.329137606459911e-01   -1.953741850900046e-01   +2.298493285201905e-01   -5.156566774081622e-01   +2.116913699336991e-01   +2.234270915499027e-01   +5.297615767496803e-01; +5.203249260437917e-02   +5.001916050109994e-01   -2.590586840975309e-02   +7.239634801026830e-01   -1.156620712163777e-01   +2.673548531624820e-01   +2.652902737955701e-01   -6.089494846833331e-02   -5.751999721105193e-02   +8.669405277876353e-02   +1.400623020255755e-01   +6.185012428134627e-02   +5.794515513793539e-01   +1.000000000000000e+00   +2.621122468630597e-01   +5.650977710107182e-01; +5.272145222046684e-01   +4.989936669080319e-01   -3.618156096223202e-01   +5.842463124470870e-02   +5.496230616216037e-01   -2.416001638525478e-01   +6.158139152003650e-01   -7.875595888406153e-02   -1.260709555325162e-01   +2.363741506567280e-01   +4.156665658542454e-01   +4.503951228606736e-01   +2.581805135477865e-01   -1.933491488372454e-01   +8.613193603932981e-02   +4.796757505878810e-01; +5.953463020867164e-01   +1.844233121057247e-02   +5.517600989083062e-02   -3.328338643500873e-02   +1.429873584007906e-01   +4.733682571048257e-01   +2.703288879413416e-01   +6.416586751295647e-02   -2.471892264647936e-01   +3.517993586112545e-01   +4.806638556881261e-01   +3.391610657803737e-01   +3.747951375366516e-01   -1.810875861294187e-01   +3.796182413027800e-01   +4.606207211307605e-01];
L2E_L1E_iAMPA_netcon = [+4.291992458639970e-01   +2.047938600259723e-01   +6.978169866526991e-02   +3.514024650540998e-01   +1.000000000000000e+00   +5.052511108243929e-01   +2.947055260795327e-01   +8.608742455776963e-02; -1.446674744653050e-01   +3.309733431284285e-01   -2.013811217160191e-01   +1.275011816214942e-01   +6.108341436232154e-01   +9.607901245539202e-02   +5.076369856844748e-01   +2.851750840392244e-01; +2.784691800797267e-01   +4.671494082693152e-01   +3.291656480836778e-01   +1.154280149323583e-01   +1.516243843279945e-01   -1.509251153544233e-01   +2.235426393957289e-01   +3.554261120289480e-01; +4.738679655961973e-01   +1.219899935436298e-01   -2.846094689029565e-02   +3.636835654896244e-01   +5.923512667934516e-02   +2.450889637295656e-01   +1.002453845057278e-01   -1.044928793411338e-01; -1.757452263844507e-02   +1.110368666996205e-01   +6.074999005257513e-01   -2.275393448160509e-01   +8.855707893984593e-02   +8.753871829079544e-02   +1.084944565871254e-01   +3.315977190808760e-01; +4.321996640216012e-01   -1.713282569920054e-01   +2.232795163575935e-01   -1.480950337685990e-01   +3.969679706905216e-01   +5.950203624681910e-01   +4.670306733004831e-01   +2.999383578894320e-01; +2.068394420205791e-01   +5.970225950642615e-01   +1.556053193026661e-01   -1.514721709585749e-01   -2.741180742329746e-01   +4.047963852364418e-01   +7.950794015482087e-01   -1.474306685022987e-01; +9.996614752472315e-02   +3.943085424731394e-01   +7.419984404120397e-01   +1.963103466541836e-02   +2.953039535064034e-01   +2.320627901213753e-01   +4.483899638729223e-01   +3.530369034194021e-01; +5.840471669300622e-01   -8.038028566305096e-02   +3.767813066941216e-01   +7.509456443339048e-01   -2.807852148175370e-01   +4.785596669291129e-01   +3.500967851828840e-01   -7.102176963520895e-02; +7.150352384986711e-02   +3.018043933651518e-02   +1.790819889417990e-01   +2.165794731823475e-01   +2.867019937623678e-01   -9.291893896096268e-02   -9.916602038502435e-02   +3.745094296457078e-01; -3.248104130141584e-01   +6.098378627998334e-01   +5.343610776140225e-01   -3.674760758764757e-01   +1.547137756656695e-01   -1.111954191568216e-01   +1.639327398692831e-01   +2.559995499360800e-01; +1.218764680219289e-01   +1.490444242257448e-01   +5.973880388284567e-01   +7.843813704382847e-02   -3.427737969998791e-02   +4.306034695331703e-01   -3.322521929774116e-01   +2.352257894973095e-01; -2.290717253627897e-01   +3.456009214133299e-01   +8.874825830242007e-02   -1.386472180811320e-01   +5.996728646260334e-01   +6.268897616453301e-02   +4.597861350105110e-01   +1.435984660597830e-01; +1.222847240661266e-01   +5.726923918833561e-01   -3.636404490211817e-01   +1.074168247449018e-01   +1.991574667992206e-01   +1.743123965890238e-01   -4.136270963862117e-01   +2.357587409690218e-01; +1.249859255311096e-02   -8.817648831353476e-02   +1.839261150438556e-02   +3.296660724771125e-01   -1.568163955481188e-01   -2.379809819543715e-01   -7.732750657955444e-02   +1.524094111585870e-01; +8.474173336653117e-02   -3.497814604615247e-02   -1.011697323318862e-01   -9.942849715235155e-02   +1.748820383179715e-01   +3.333283322253410e-01   +4.558176130926581e-01   +5.764281659412169e-01];
L1E_L2E_iAMPA_netcon = [+2.847302352158479e-01   +3.313995232896255e-01   +2.992428864079324e-01   +1.847064871561800e-01   +4.466374980780099e-01   +1.101359871891820e-01   +2.821530377982098e-01   +2.286131603340968e-01   -3.088606375008477e-02   -2.615317234452577e-01   +4.312736052569498e-01   +6.998278129090064e-03   +2.510470187908642e-01   +1.938488283201412e-01   -2.373718778002763e-01   -3.926666566408680e-02; +3.246267610368986e-01   -4.417809555968396e-01   +7.952966963866738e-01   +4.583707190844978e-01   +2.722592780057343e-01   +2.127102378525080e-01   +7.853768495928103e-01   +3.436159692554105e-01   -2.987064785167461e-01   +8.444696248939718e-02   +3.115055886484392e-01   +3.342380217504252e-01   +6.234550527811605e-01   +1.901484763657880e-01   +2.500176893094196e-01   -2.350070062169655e-01; +7.264250584068584e-01   +2.220687235900241e-01   +4.387132434775664e-02   +2.615833095807617e-02   -1.757640094677832e-02   +2.710739256584339e-01   +1.893110450696088e-01   +3.080872420181495e-01   +1.956554560644619e-01   -1.911268144279962e-01   +4.177948917756264e-01   +6.791274215479105e-01   -6.347481083454688e-02   +4.470939008698778e-01   +2.060833461833584e-02   -2.575903183529210e-02; +2.460432641301578e-01   +1.004621889374499e-01   +5.860179410406205e-02   +7.038406572881256e-02   +4.003151283405732e-02   +6.312603543653709e-01   +1.000000000000000e+00   +1.664155682110967e-02   -7.406452892077420e-02   +2.604853266893182e-01   +3.788998242694266e-01   -3.045142988711634e-01   -1.939638728500772e-01   +9.460898924385041e-01   +1.250527705086167e-01   -1.150279847513850e-01; -1.964450299320243e-01   -5.061210694801316e-01   +4.194855537744183e-01   +4.995506466305965e-02   +1.344462309477806e-01   -1.702540474699098e-02   +5.149489960565798e-01   +2.505107891817245e-01   +3.691053095881360e-01   -1.279998621845054e-02   +1.158376362698695e-01   -2.407637981190264e-01   +4.456602626751727e-01   +1.451013094920114e-01   +6.120550008615192e-01   -1.172720942953994e-01; +2.645938340931966e-02   +4.546528775373400e-01   +8.775227198872089e-02   +7.952517159485473e-01   +4.771789064233028e-01   +1.492263567637983e-01   +7.270865935016875e-01   -2.368328591619256e-02   +2.824961168914390e-01   +7.313279055459203e-02   +6.782649128589593e-01   -2.441534892443556e-02   -1.751080014155010e-01   -3.115812444257641e-01   -4.438348299607450e-01   +3.955043429338917e-01; +1.068304873100534e-01   +9.854151432045559e-02   -2.505861782778168e-01   +3.192519301986232e-01   +3.688022333656553e-01   +3.180232405874852e-01   +4.137684124220509e-01   -1.540187047960584e-01   -4.004359572435066e-01   +1.174986267170424e-01   -7.773908525991619e-02   -3.274186227384774e-01   -3.681857781983855e-01   +3.719690744615664e-01   +6.442016990807785e-01   +1.398031245423923e-01; +2.864638977895010e-01   +3.486576655478750e-01   +4.061216263520476e-01   +4.214458477697462e-01   +4.124386050610125e-01   +7.252519294716376e-01   +7.001624220105069e-01   +4.183079813028720e-01   +2.933885985309722e-01   +1.480113767522212e-01   +1.025474592966584e-02   +1.424128866524557e-01   -4.903005843270954e-01   +4.613542485796170e-02   +1.466397391440116e-01   +1.487295779545549e-01];
L2I_L2E_iAMPA_netcon = [+1.622462234221456e-01   +5.193982474389682e-01   +4.742466320117442e-01   +1.445257361808162e-01   -2.786534161054809e-03   +4.047276250557963e-01   +2.814746223805592e-01   +6.097904972871965e-01; +7.061553592447131e-01   +1.967494583140059e-02   +9.263346121801219e-01   +6.657888562454809e-01   +4.014980665339290e-01   +2.855294230378375e-02   -1.079518175547520e-01   -6.358451020747022e-02; +1.501059828191410e-01   +3.602156277564163e-01   +4.155536540944055e-02   -3.909370366806969e-03   -1.398871061569549e-01   +4.581519316999270e-02   +4.531869801737832e-01   +4.356290821808251e-02; +3.985142725935111e-01   -6.329629720964924e-02   -3.779127040412896e-01   +4.114253285432006e-01   +4.032959583222533e-01   -3.173859468622093e-01   +5.378553474679415e-01   +1.822677149912640e-01; +3.162937401910578e-01   +1.558023977139288e-01   +8.604116755943353e-02   +4.894095472701214e-01   +4.352329727812388e-01   +5.606119889207006e-03   +6.479747564528264e-01   -6.942499288076179e-03; +3.042987878195595e-01   +3.675759203137812e-01   -3.977655323868311e-02   +5.818893640304830e-01   +7.062390739708499e-02   +3.060455715485381e-01   +2.702266655312906e-01   +1.499189911292536e-01; +2.819989920380182e-01   -1.833788358851219e-01   +4.350403568816545e-01   +6.764024587456465e-01   +1.684023562153701e-01   -3.691522137552464e-01   +7.595418289059898e-01   -4.338683211269662e-02; +2.498046678404365e-01   +2.091210976171204e-01   -5.764303281650878e-01   +2.245315605134861e-01   -8.449978151413336e-02   -2.858718784322808e-02   -1.044182827246615e-02   +6.044571852448437e-01];
L2E_L2I_iGABA_netcon = [+1.436616719825814e-01   +3.748783130897058e-01   +5.137011152282599e-01   -2.455478442735879e-01   -2.377824324024477e-01   -6.428221225881407e-02   -9.984163587258717e-02   +3.937068762617835e-01; +8.911093259205413e-02   +7.023875398468470e-02   +2.095017530308877e-01   +8.318457021803934e-01   +5.152194763726174e-01   +1.565604332834966e-01   -4.655433152976743e-01   +2.643104774834355e-01; +1.361385109366856e-01   +8.202340936236071e-01   -3.687310321894728e-01   -3.947940268964577e-01   +3.222235578807892e-01   +5.546486646158403e-01   +2.672825681091329e-01   +3.635694383560029e-01; +8.871183548972315e-02   +5.340588182307011e-01   +4.135093424451917e-02   +6.720345371463456e-01   +7.752705192756199e-01   -4.002935390847805e-01   -2.437892036761953e-01   -5.169743214720039e-02; -2.270250809105703e-01   -4.205551427856149e-01   -1.134790027309915e-01   +3.298721836128803e-01   +7.695083240201570e-01   +1.652177984598893e-01   +1.592188981102749e-01   +5.127537809749419e-02; +7.095840976394675e-01   +5.008964686608017e-01   +2.713138078405496e-01   +5.339569183150249e-01   +3.168404568821745e-01   -4.241471066377686e-01   +5.779720136315794e-01   -3.004541623757055e-01; +2.159401842729741e-01   +2.301745083396202e-01   -3.501133303804357e-01   -4.901659917352817e-02   -3.956954744646923e-02   -3.566797895224447e-01   +7.027798498645510e-02   +9.076417830283970e-01; +2.865870756539964e-02   +4.799539112223761e-01   +6.001130830211238e-01   -6.927130816470534e-02   +2.698949736919754e-01   +3.455754892839286e-01   +3.523308727811296e-01   +4.890481541531277e-01];
L3E_L2E_iAMPA_netcon = [+2.965559623099762e-01   -3.843835437470483e-01   +1.881953967504805e-01   +2.143336630220973e-01   +3.856865688795212e-01   +3.636182359105440e-01   +1.067810781987631e-01   +5.095815548923480e-01   +1.662730313105259e-01   -8.704852013814258e-02   -1.227298399533185e-01   -2.107303260483616e-01; +2.354317278222102e-01   +4.164986729615853e-01   +1.303294122233474e-01   +2.916965689278700e-01   -1.291348682797756e-02   -4.212432060590221e-01   -5.478236774220698e-02   +2.074260044697142e-01   -1.340035291333953e-01   +1.938490383748235e-01   -1.317162391148687e-01   +5.456593873059588e-01; -3.170815909137095e-01   -2.031838628641165e-01   +4.725310656528138e-01   +3.676111716137647e-01   +6.029525354679259e-01   +9.180289035058778e-02   +4.337425777098974e-01   +3.908923464995376e-01   +7.004491151899719e-01   -3.657564957168573e-01   +5.955190863395521e-01   +5.979775109162206e-01; +1.956186570162873e-01   +4.236976439037994e-01   +4.128926747960083e-01   +8.634802378832827e-02   +5.842196614289960e-01   +2.248874222732262e-01   +1.795202910134146e-01   +4.274991982313520e-01   +5.398208603685189e-02   +1.510632461908311e-02   -1.222753102635707e-01   +5.574269819615939e-01; +2.098786994436017e-01   +2.465889688141767e-01   +2.585983144645093e-01   +5.449976262594339e-01   +5.720514280726774e-01   +3.293353521570080e-01   +1.415474057632766e-01   -3.444196423223669e-02   -6.605321377148735e-02   +4.375344799604224e-01   +5.584553329837350e-01   +5.762707397864333e-01; +3.835606676319622e-01   +7.923064660031974e-02   +1.556657378039397e-01   -2.468951811671573e-01   +2.923450422665106e-01   +4.768601194748583e-01   -7.977541820926543e-02   -3.044650715143413e-01   +3.599806370918239e-01   +3.887369320985803e-01   +9.275252706457664e-04   -1.072098064198859e-01; +1.745477807402386e-01   +3.486845513699238e-01   +6.600389291183992e-01   -2.976071585182091e-02   +3.364593839145946e-01   +2.254113040278243e-01   -7.994708052342747e-02   +6.706099162446663e-02   +2.527608903317508e-01   +5.399477671550720e-01   -1.569099318364600e-01   +3.839882197351400e-01; -2.463436854812339e-01   +8.304051746952862e-01   +3.824287284075227e-01   -6.044493697917316e-01   +5.543231055919107e-01   -1.467315519486691e-02   -2.069003157653713e-01   -3.508744524456106e-02   +3.274211303358995e-01   +3.350464823850787e-01   +4.544282721250680e-02   -6.381991246131014e-02];
L3I_L2I_iGABA_netcon = [+7.726841935529116e-01   +5.459340445627809e-01   +2.215281763119301e-01   +2.955304530229566e-01   -4.669542908738484e-01   -2.210432341538643e-03   +9.816621588389466e-01   +6.196853839237370e-01   +6.552118292583977e-01   +9.435546378546196e-03   +5.464292018995523e-03   +1.410121320108298e-01; +2.592186889033339e-01   +8.553099649799571e-02   +1.327668225835380e-01   -2.001572252221877e-01   +4.786591466233683e-01   +1.148434861846472e-01   +2.991424936390973e-01   +8.440808150343346e-03   -1.282069951961221e-02   -2.761922874679023e-01   +3.926151993606490e-01   +1.011873231308536e-01; -1.983889165470469e-01   +3.002176367719291e-01   +2.252124211398386e-01   -2.217607217132067e-01   -5.331354124541014e-02   +3.319786000685722e-01   +2.364262397530378e-01   +2.165569790287379e-01   +3.661814660559954e-01   -2.753516250353043e-02   -2.658854752468920e-02   +8.836602312314944e-01; +5.340687468435038e-01   +4.563335299626002e-01   +6.395147883947704e-01   -1.986497764461270e-01   +1.608123433677832e-01   -2.266104906254247e-01   +2.894575320516201e-01   -2.431849919411783e-01   +3.789035373024882e-01   +6.860817696209913e-01   +6.370048404294575e-01   +8.877670316880527e-02; +4.937285205426567e-01   +2.283269164468071e-01   -1.632813306091976e-01   -6.632100036544242e-02   +5.946023386233751e-01   +3.501112399579349e-01   -1.421428071580746e-01   +8.728401609227301e-01   +6.426154412048806e-01   +8.081136203671158e-02   +3.481516838938516e-01   +1.741340725692439e-01; +3.822392022207990e-02   +4.482663718893121e-01   +5.380218745259807e-01   -7.313425323095007e-02   +6.026560409664623e-01   +3.809084665769257e-01   +6.709454227592515e-02   -2.484554046075079e-01   +4.589948162477533e-01   +5.012156410587267e-01   -2.196344004113133e-01   +1.311630897323975e-01; +7.041948802905802e-01   -2.508394172418263e-02   +4.582820806810776e-01   +4.063757460001597e-03   +7.380700461446910e-01   +5.264828622114921e-01   +4.688717493038821e-01   +1.377857268295365e-01   -4.896634566511948e-01   +7.879685856933654e-01   +1.922189152834926e-01   -2.201839754590870e-01; +1.142854324698283e-01   +3.502355637468135e-01   +4.216654436919984e-01   +2.633252883312555e-01   +2.146904117557037e-01   +5.030440601709025e-01   +8.208443821808533e-01   +8.376142855540277e-01   +5.564277355986146e-01   +3.650869893391676e-01   +2.276624378360061e-01   +5.421833335917920e-01];
L2E_L3E_iAMPA_netcon = [+6.199249560216814e-01   +2.287156575270530e-01   +6.981135608911455e-01   -6.613278722722723e-01   +1.264551336171303e-01   +4.290508016895924e-01   +4.867875309196799e-01   +6.565895989461495e-01; -1.242893246719106e-01   +4.934263071695434e-02   +8.938241161938505e-02   +4.971121279629760e-01   +6.028748513208466e-01   -2.044497757037121e-01   -1.714021904646191e-01   -4.480402585851706e-01; +6.593000327275012e-02   -2.227634431912462e-01   +1.137644387480471e-01   +3.815554103493242e-01   +3.256271355090856e-01   +2.088731563961213e-01   +1.045748341503104e-01   +5.433059333304505e-02; +2.568557208407196e-01   +4.425883048510363e-01   +7.085405041781632e-01   +7.186159538610463e-01   +7.956909970615686e-02   +8.172766230911327e-01   -1.777308085509839e-01   -3.346456451384603e-01; +1.508183850580883e-01   +1.859832867981343e-01   +1.564924857845080e-01   +5.630164136103352e-01   +3.426689284417081e-01   +2.859012522355703e-01   +3.740158664881386e-03   -1.829631106971708e-01; +4.458528590878696e-02   +6.940013019357313e-01   +4.803026614446030e-01   +8.397278279660807e-01   +2.380469184119832e-01   +1.824582760705450e-01   +1.159295207074721e-01   +2.556959818025259e-02; +8.703650843724607e-02   +7.690984900145426e-01   +7.758231421518039e-01   -1.565723887393231e-01   +7.549862659002407e-02   -5.332258291371378e-03   -1.457214328344691e-01   +2.681817711812883e-01; +6.198922989565758e-01   +4.329635402612209e-01   +2.304802263780338e-01   +2.234357014965624e-01   -1.110495393769943e-01   +1.674894818620682e-01   +9.800163126716806e-02   +5.816188067489357e-01; +3.416339412561843e-04   +7.876926542381743e-01   +5.587869632205970e-01   +3.146800042106838e-01   +3.260053942900022e-01   +1.569570264943720e-02   +8.755069232127223e-01   -2.146187253592926e-01; -2.748086055953129e-02   +1.098972874902527e-01   +2.808292006479146e-01   -1.208786234747264e-02   -8.656447436013817e-02   -2.810318614315186e-01   +2.716982206611021e-01   -3.157150388470669e-02; +5.044391346781063e-01   +1.118594769189550e-01   -2.874295410172147e-01   +1.000000000000000e+00   +1.758660540026350e-02   +5.102273543365701e-01   -9.008786341952775e-02   +2.938977032672145e-01; +5.320417463433012e-02   +8.561498905293661e-01   +2.040986613092216e-01   +6.702082870176993e-01   +8.622958792097463e-05   -1.547069801788002e-02   +1.534978590000573e-01   +2.101165159320832e-01];
L2I_L3I_iGABA_netcon = [-2.859435156852808e-02   +1.058997875434620e-01   +9.121970929157597e-02   +3.603622822502664e-02   +1.315403017862271e-01   +6.725294764823796e-01   +3.382371365651426e-01   -9.572978495480410e-02; -9.662833940679885e-02   +3.230781166990843e-01   -2.149457057499254e-01   -8.830128045736442e-02   +4.229737003336978e-02   -2.286545323285858e-01   +3.976293952692301e-01   +3.083856113718590e-01; +6.575006932437830e-01   +1.000000000000000e+00   +1.238570280378187e-01   +6.454564152963038e-01   -8.832955733001005e-02   +6.767814685327073e-01   +1.485477478297219e-01   +6.864740639236093e-02; -2.251398071222120e-01   +2.441609639491667e-01   +7.011727041506519e-01   -3.623708814841063e-01   +4.201377647744858e-02   +7.365864000209501e-01   +2.932867986927931e-01   +2.549564733493795e-01; +5.052478447384022e-01   +5.095643275695032e-02   +3.500325233696522e-01   +3.529649426545144e-01   -2.015319748891666e-01   +2.539880530434047e-01   +2.434419704947131e-01   -5.166591325474001e-02; -6.230036408547943e-02   +4.397232352497026e-01   +6.326098801656878e-01   -1.734300461197006e-01   +3.745529987063421e-01   +7.321821647380172e-01   -4.300530969161057e-01   +1.328881619688674e-03; +3.315298689318105e-01   +3.400745615226755e-01   +8.542517153177323e-02   +3.733186097637013e-01   +1.074443241738195e-01   +2.273656172018728e-01   +8.566807108654398e-01   +4.928466761461510e-01; -3.364864808142859e-01   +3.314972678208887e-01   +4.538857193714471e-01   +2.268647990216538e-02   +1.566535601660794e-01   +3.746103613769745e-01   +8.583274237732982e-02   +7.840035206925540e-01; -6.833687039940423e-01   +6.785341160694512e-01   +5.759734451764101e-01   +1.577501404883286e-01   +3.867544353675248e-01   +2.378221214394261e-01   +4.622549857940408e-01   +4.047045349642718e-01; +1.685054708689331e-01   -2.671291414096546e-01   +1.391521775901058e-01   -1.929264387008130e-02   +3.013122679730591e-01   +5.809989974337396e-01   +2.009558720590273e-01   +3.147117692968950e-01; +4.672457070410341e-01   +1.706924956151832e-01   -4.465612662867609e-01   +2.688952478561744e-01   +2.525217710795118e-01   -1.057881604704295e-01   +5.308972614205215e-01   +4.791292113004755e-01; -4.528193599608201e-01   +6.949003965835665e-01   -6.693818732640300e-02   +6.732614047365677e-01   +4.959447305572717e-01   +3.571825013501060e-01   -4.563086610119486e-02   -2.320074269150180e-01];
L3I_L3E_iAMPA_netcon = [+1.829402028417585e-01   +2.639527464351424e-02   +2.925325327677327e-01   +2.660001781770047e-01   -3.953035601260914e-01   -2.049775481821307e-01   +1.876530648573033e-01   +3.694107052677446e-01   +2.449240021061813e-01   +5.502214799751950e-01   +4.769424378240468e-02   +4.204494070084129e-01; +2.387064168581871e-01   +8.397988875172378e-02   +2.291859408260963e-01   +7.365926692139180e-01   +1.460980800234151e-01   -1.527833230308563e-01   +3.949795684357714e-01   +3.760260674871662e-01   +4.989906342295477e-01   +2.758063403185489e-01   -2.694491130334241e-01   -1.611454687404897e-01; +3.693194309039724e-02   +5.225484023101536e-01   +4.245052544963860e-01   +2.035869696040325e-02   +7.921294327362657e-01   +3.561491588809061e-01   +6.278401380732320e-01   -1.215750070528231e-01   +3.215071206943380e-01   +4.152587096854434e-01   +1.646495470068558e-02   +3.750742576624073e-01; +3.642542598350020e-01   +1.780854066041677e-01   +5.341606006327305e-01   -1.518820762892603e-01   -1.842476668118646e-01   +3.928781553657035e-01   +1.386442536565827e-01   +2.099266437703441e-01   +1.551781969669286e-01   +3.506195645191505e-01   -1.953878054242087e-01   -1.597084160954967e-01; -7.533735736405162e-02   +1.575534484257731e-01   +7.964527917837882e-01   +4.889496341642668e-01   +1.812725159364604e-01   +1.643160344106047e-01   -5.912210044144101e-02   +4.181326496244900e-01   +3.614661376996159e-01   +2.765658679232784e-01   +3.476823209536929e-01   +1.042281635945273e-01; +1.984535983112923e-01   -7.668098311186342e-02   -2.738135840897538e-02   +1.172466295247614e-01   -1.948418025518371e-02   -1.561518147736315e-01   +2.052691080116225e-01   +2.571041933458364e-01   +3.769678160560447e-01   +9.822628697862729e-02   +2.492292527946882e-01   +7.644937186542993e-01; +3.502694102461119e-02   +1.166052121216377e-01   -2.997602039577375e-01   -8.189067370277789e-02   +3.538951004773034e-01   -1.929409977692750e-01   +6.385706687965405e-01   +7.227581859633653e-02   +3.288375213763787e-01   +8.013011662958106e-02   +3.687894424306659e-01   +9.391006251812672e-02; -2.481764605796769e-01   +2.824763215809246e-01   -9.800927917954752e-02   +1.161744259148132e-01   +1.808167575052277e-01   +1.376392630572407e-01   -2.081666129704584e-01   +3.063459498768214e-02   -9.874475076475420e-02   -4.352219676632491e-01   -1.337735717568251e-01   +1.829613213452814e-01; -2.547285922888767e-01   +6.019328119671622e-01   -1.548372684374122e-01   +2.613627343408459e-01   +1.354010647128628e-01   +4.268383181249742e-01   +2.010233157974148e-01   +4.946619270596626e-01   -9.547576046818698e-02   +7.076946443931596e-02   +4.218595558619028e-01   +6.306855472588584e-01; +8.074248358391761e-01   -5.522564771355954e-01   +5.912304334784141e-01   +2.895320552214350e-01   +1.722098220943028e-01   -4.508015811427682e-01   +2.960089733487294e-01   +2.869022686521687e-01   -2.928468796555679e-03   -2.583084699343795e-01   +8.849286060835676e-01   -5.048891455028356e-02; -3.373257740701450e-01   +4.583917518062450e-01   +7.019846217690418e-01   +3.084665414948919e-01   -7.103578721079397e-02   -2.796488264644153e-02   +4.359265824259071e-01   -1.653176964653455e-02   +4.678446412207191e-01   -7.140788553641207e-02   -1.212295537997749e-01   +3.625975541334292e-01; -1.674378950975225e-01   +1.507691842109261e-01   +1.412953283164372e-01   +5.747757561166481e-01   -2.043097975727146e-01   -2.074578771420344e-01   -2.612458386808620e-01   +1.854437478378269e-01   +3.045939649204710e-01   +2.823934616608187e-01   +2.343127758303422e-01   +1.253161133172840e-02];
L3E_L3I_iGABA_netcon = [+1.415449213830740e-01   +1.952139133808688e-01   +6.305559620927850e-02   +1.490865119382485e-01   +1.360274349412093e-01   -3.127830538749748e-02   -2.651627826938528e-01   +4.102472151794356e-01   -1.586053243660805e-01   +6.131050348181755e-01   +9.162553677511509e-03   -1.881349215333263e-01; +1.369061324238001e-01   +4.705700480202087e-01   +3.737164706626691e-01   +1.669021869453197e-01   +6.931573869319531e-01   +1.130289135584570e-01   -1.306062336775965e-01   +4.740030722197239e-02   -5.687812984211814e-01   +2.768388617985454e-01   -5.641494546109326e-01   -4.345700408196654e-03; +1.434365262770378e-01   +7.285059727602328e-02   -3.572686300833140e-01   +4.560689729017117e-02   +2.477209743346288e-01   +4.879271006666860e-02   +3.980075186526479e-01   +3.480383954294101e-01   -1.759524621742132e-02   +2.816725515870512e-01   -1.427893517305714e-01   -8.363289205673205e-02; -4.582049938797493e-02   +2.932949357028383e-01   -5.940544326844172e-01   +5.077579372296517e-01   +1.000000000000000e+00   +2.728103128909384e-02   -3.157159999595899e-02   +1.271229179861708e-01   +8.376181393484794e-01   +4.082239720341094e-01   -4.239861908672334e-04   -1.302823934467802e-01; +2.942709336462026e-01   +1.710676645143831e-02   -1.450785923240642e-02   +6.151905588082428e-01   +1.625415938789504e-01   +1.478059039126627e-01   -1.823718992869848e-02   +7.919897594565259e-01   -1.882422262743406e-01   +5.390197772777966e-01   +2.819163412164080e-01   +8.210206298037494e-02; +1.179869589287166e-01   -1.840043312328422e-01   -3.621622123193003e-02   -1.833821214000979e-01   -2.354330385941468e-02   +2.587679262220589e-01   +2.720597691279550e-01   +3.029636194294829e-02   +5.773809983321091e-01   +2.369940573037914e-01   -1.743774378063028e-01   +5.105159706018446e-02; -9.044574578231708e-02   +5.774240375354819e-02   +2.154709135671192e-01   +9.067969709923548e-01   +2.317820444515474e-02   +3.476502006570478e-01   +4.601568165772712e-01   +3.517841832033151e-01   -2.071210365570046e-01   +3.401154312017290e-01   +4.135343479777842e-01   +1.594065925552700e-01; +1.991195087045821e-01   +1.982848564997812e-01   +2.570546297527398e-01   +1.169569312597452e-01   +3.062832087931938e-01   -4.379381077602464e-01   -1.731937735474826e-01   +5.690477595744680e-01   -1.891656455541324e-01   -1.595722312114063e-01   +1.478370984026175e-01   +2.195185144416244e-01; +2.977937024424927e-01   -1.378110965720756e-01   +4.498800820596507e-01   +8.086223830974394e-02   +2.257295746242377e-01   +3.796521330162552e-02   -6.210698167302181e-01   -2.072856114035069e-01   +5.797725062814586e-01   +4.644259864653880e-01   +1.902708661704743e-01   +6.017165813471325e-01; +1.843232397387039e-01   +4.118870070244896e-03   +3.087793045243164e-01   +2.810432617959204e-02   -6.575853586038104e-01   +1.864889945656466e-02   -1.049825066451649e-01   +2.654552195068781e-01   -1.202426554101422e-01   +2.229727102200343e-01   +1.186260368650268e-01   +9.542699623709285e-02; +2.118367905936688e-01   -1.484630077734968e-01   +3.517572227780345e-01   -1.285957930947116e-01   +9.317558475431550e-02   -9.261877193941946e-02   +2.694208531007927e-01   +3.799734284699145e-02   -1.523491525868726e-01   +5.944984502751304e-02   +2.216166650543970e-01   +3.638805991499213e-01; +5.299619140528609e-02   +1.417851069642594e-01   -2.090874811409425e-01   -1.397078721744471e-01   +9.361814057503342e-01   +5.640192970389083e-01   +4.881097550237988e-01   +3.181004696437847e-01   +1.904307552961431e-01   -3.031491608883328e-01   +4.958262006508880e-01   -7.673630270071369e-02];
L2E_Input1_iAMPA_netcon = [+7.733066201115361e-01   +8.104839657480248e-01   +5.495709142359648e-01   +7.271300669864655e-01   +1.000000000000000e+00   +3.165948463645350e-01   +5.231965709875883e-01   +5.989871584895611e-01];
L2I_Input2_iAMPA_netcon = [+6.162665421020149e-01   +7.493721720680125e-01   +7.954237754391675e-01   +5.623590758779859e-01   +1.392766597360939e-01   +9.983050844219620e-01   +6.455069381459198e-02   +8.087789171161605e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
