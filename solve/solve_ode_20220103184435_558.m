function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.142567068616802e-01   +9.460101033308314e-01   +6.982474408497447e-01   +1.550380741067625e-01   +9.217878289326056e-01   +2.194184117614058e-01   +7.406413443640880e-01   +3.026700654273519e-01   +5.331000515056893e-01   +8.289098298458231e-01   +9.685835874637315e-01   +9.644868169035317e-01   +6.961316020750847e-01   +3.711913871678658e-01   +2.972513988767875e-01   +3.779429864221792e-01; +3.458382379289924e-01   +1.326680566449481e-02   +1.416709594399487e-01   +1.763057236480453e-01   +7.070575093747443e-02   +8.080114411443060e-01   +7.942142518457648e-01   +7.590227779757214e-01   +7.842305472543315e-01   +1.814019916038540e-01   +4.661429698424706e-01   +6.560328388782639e-01   +3.761844381393538e-01   +2.754387945884294e-01   +6.849923806943716e-01   +9.534968679451540e-01; +2.077644190637005e-01   +4.678407240390399e-01   +8.328514042332519e-02   +7.029418968446588e-01   +3.131802143542510e-01   +3.813019275322951e-01   +6.633709479873746e-01   +9.529766476548568e-01   +4.871091261254153e-02   +9.260350610616652e-01   +8.696315327980657e-01   +2.091645547114501e-01   +5.417366510985131e-01   +7.546151890742323e-02   +7.731006624679466e-01   +8.117274228569008e-01; +2.477205499504544e-02   +4.898133797319562e-01   +4.329022623568851e-01   +8.324999813602433e-01   +6.281400319677005e-01   +8.568261165932369e-01   +4.407858985918436e-01   +8.588889659049094e-03   +4.623720443932232e-01   +4.206090412215412e-01   +9.463317445803741e-01   +8.970424889876951e-01   +5.185185346752552e-01   +1.508468029614595e-01   +7.205395176171072e-01   +8.923165732820078e-01; +7.659414812033717e-01   +5.157611564235491e-01   +8.949133349348602e-01   +8.143401333383495e-02   +9.058282112333687e-01   +3.228474136923269e-01   +5.753739239192196e-01   +4.069301652452751e-01   +9.377668259112806e-01   +3.001688560967914e-01   +2.320197282412812e-01   +4.879720670097564e-01   +7.636567267285942e-01   +3.649557029085231e-01   +2.784616845617341e-01   +6.858623181177272e-02; +5.711027986073165e-01   +2.871135701573759e-01   +7.319903933511149e-01   +8.347147076823487e-01   +7.963203252716363e-01   +3.792060364094601e-01   +5.182003790839222e-01   +1.521432975689591e-01   +4.734140056242875e-01   +3.487838874062367e-01   +9.180428298698670e-01   +6.619936057385150e-01   +8.005738167609733e-02   +7.169852784540061e-01   +1.395201855069565e-02   +9.022642370976131e-01; +5.769128480930233e-01   +5.650686549779197e-01   +6.806302610944372e-01   +5.416659222322630e-01   +6.430398915680725e-01   +6.368604537228127e-01   +7.251409104600668e-01   +8.216823932012374e-01   +7.785443281148684e-01   +9.715112629686213e-01   +6.343370638826931e-01   +5.262167019021547e-01   +5.164076274125157e-03   +5.321247156346759e-01   +1.511744999134340e-02   +6.678424666378240e-01; +3.900937263720944e-01   +5.098160000551591e-01   +2.019562437898890e-01   +9.624044949283805e-01   +4.400760631981813e-01   +3.870536985274637e-01   +2.229196870640101e-01   +2.878239151483243e-01   +1.093025022046146e-01   +5.304131815217102e-01   +2.844387333876724e-01   +7.087864853610066e-01   +4.009055976139457e-01   +2.323839633732290e-01   +9.363517536347187e-01   +3.470613188983189e-01; +5.569934291720268e-01   +6.786885669611564e-01   +5.297783603276264e-01   +6.774260970280033e-01   +7.484233915571995e-01   +6.734011943670665e-02   +9.975816383405071e-01   +9.777138285354101e-01   +5.218480917142498e-01   +7.900512594225668e-01   +8.556004029372488e-01   +7.185795847455770e-01   +6.628426222481782e-01   +4.709796008193967e-01   +9.341279683012786e-01   +8.370799833228941e-01; +1.831283993307857e-01   +6.154405637861727e-01   +8.305335168794150e-01   +3.361743849765219e-01   +8.254717235690908e-01   +1.710213150514271e-02   +6.195938681621455e-01   +6.258653345310717e-01   +6.356493272364775e-01   +7.942193160468853e-01   +1.659303257212056e-01   +2.940185096825617e-01   +3.682337751958598e-01   +7.169878475968391e-01   +3.739062889331388e-01   +1.989935662215533e-01; +1.180196955980721e-01   +5.651440055425672e-01   +1.753333394646078e-01   +2.208446576624943e-01   +3.413192368338693e-01   +8.791964624174595e-01   +9.803174239075539e-01   +7.430825378462507e-01   +5.787183838625549e-01   +1.440013906021613e-01   +8.273410311742020e-01   +1.170390415362953e-01   +3.926156729362362e-01   +5.144322527135193e-01   +1.089803188073142e-01   +8.412997570581272e-01; +5.933523764584030e-02   +5.053519864376954e-01   +5.179400960268222e-01   +5.687355781859587e-01   +1.392629455320752e-01   +1.577168537504301e-01   +4.956578967451759e-01   +8.721787712949474e-01   +8.354732080884621e-01   +4.566925126437122e-01   +2.168125326606964e-01   +3.247520136588391e-01   +1.343923601253036e-01   +5.134690108348444e-01   +7.193037037822323e-01   +4.246594428686256e-01; +9.326243372268381e-01   +6.675054684530397e-01   +3.562707572901468e-01   +4.541992667657956e-04   +5.040691488648833e-01   +9.137192569721678e-01   +5.221313204529227e-01   +3.293472474590053e-01   +1.152857023902252e-01   +4.581751135678390e-01   +2.675033140893999e-01   +4.572144702467442e-01   +3.382450095361832e-01   +3.859778753147614e-01   +4.486510182773005e-01   +5.582625596836062e-01; +7.454351655272867e-01   +6.331286675072586e-01   +6.458336758695684e-01   +5.886703497223895e-01   +4.138488438874889e-01   +5.568354305819462e-01   +8.540448239135949e-01   +9.836019814386907e-02   +5.140842134980063e-02   +9.545095107183079e-01   +8.700331921114879e-02   +7.164203818189546e-01   +1.231237349733060e-01   +4.785027368012758e-01   +1.296296572109292e-02   +4.475232406320774e-01; +2.436073832885746e-01   +1.440499089959356e-01   +2.817201358154714e-01   +8.910342512701313e-01   +1.715077548759270e-01   +9.222935322495532e-01   +2.537011856757351e-01   +4.503913769106713e-01   +5.179261478663303e-01   +5.316357106035684e-02   +9.165540800481325e-01   +4.053709179340013e-01   +3.683845586973958e-01   +7.394837949723471e-01   +1.236434101711912e-01   +7.601797942983610e-01; +2.041523743338843e-01   +1.785554602541593e-01   +4.366068137889523e-01   +2.544636587064307e-01   +4.940760242370453e-01   +5.977923641425763e-01   +5.823950122705800e-01   +2.398364483121322e-01   +6.967041002338512e-01   +3.580684859297374e-02   +7.260602650304434e-01   +2.422061675691432e-01   +2.508285398697260e-01   +7.015315150045708e-01   +6.591782625231091e-01   +9.529790005837090e-02];
L1E_L1I_iGABA_netcon = [+8.431804966778966e-01   +7.524765771307543e-01   +8.742308136171167e-01   +4.359106014977540e-01   +9.180499599389681e-01   +7.793999554169674e-01   +3.217003721522018e-01   +6.411741294480894e-01   +9.435300378658842e-02   +2.613370915582720e-02   +1.291943470391509e-01   +5.196345056362793e-01   +8.695260497757021e-01   +5.758351220748936e-01   +1.661758410245045e-01   +6.276159118451670e-01; +6.208206086086001e-01   +9.954030212367705e-01   +3.095657359484899e-01   +1.474594832595349e-01   +8.831129459924381e-01   +2.727687782885513e-01   +9.629452307441960e-01   +4.297162763914764e-01   +2.929836090288754e-01   +5.141809904847352e-01   +4.244098639341417e-01   +2.039047474038366e-01   +8.028513154679350e-01   +2.884213244496381e-01   +5.451023465972062e-02   +3.368150156605870e-01; +6.710199791800671e-01   +3.709988869667970e-01   +4.330422526858170e-01   +6.543110864033334e-01   +5.857269897663272e-01   +5.267981261658725e-01   +3.526069396133266e-01   +4.783406703343669e-01   +3.265564901042335e-01   +8.626005225743753e-01   +4.811788107397961e-01   +7.753071059285723e-01   +6.461438112983123e-01   +1.320773966070783e-01   +2.117874759460627e-01   +1.567760090624654e-01; +7.819822329016136e-01   +5.027850121837869e-01   +3.815161645056009e-01   +7.214382579694388e-01   +8.354113258345924e-01   +4.030932392862380e-01   +3.200452349864269e-01   +1.001049572729520e-01   +4.829603850818004e-01   +5.820709754586653e-01   +6.737946994155424e-01   +3.911952479323716e-01   +7.348428351085131e-01   +5.034735662411158e-02   +2.041638807504099e-01   +4.019215556562357e-01; +3.092122599428223e-01   +7.581442194476260e-01   +6.565662341724948e-01   +1.616670535243142e-01   +7.758436227185815e-01   +7.795005765335519e-01   +9.087358243027587e-01   +8.064908689483674e-01   +2.412847051662643e-01   +4.220934897355110e-01   +3.569627485635896e-01   +6.672546089949397e-02   +6.671762961045269e-01   +6.235741347085746e-01   +2.177738695809359e-01   +9.130489733062828e-01; +3.297110220971619e-01   +1.265710942160391e-01   +2.376200290963124e-01   +3.431642162673461e-01   +7.856334368283491e-01   +2.576994548675325e-02   +8.851413078829423e-01   +6.468008750298473e-02   +4.537791713203332e-01   +7.135337948984255e-01   +4.973624117726885e-02   +7.564544932136955e-01   +8.810137885560065e-01   +6.052473266440588e-01   +5.784839265285322e-01   +1.491903466201187e-01; +6.338184155608976e-01   +5.181124154547163e-01   +6.863535767831471e-01   +1.061480997836229e-01   +7.015350570584427e-01   +4.115156105913274e-01   +3.531477071338550e-01   +9.544227903428639e-01   +7.582500767011787e-01   +2.339389978766568e-01   +2.905171595189284e-01   +4.533223643848495e-01   +8.527263693227133e-01   +3.714464457191057e-01   +3.367120519763262e-02   +4.639409971468285e-01; +9.020275950811534e-01   +9.063255693526047e-01   +3.266614985299627e-01   +4.116653466577776e-02   +1.777513810001850e-02   +8.261222196944612e-01   +7.500435733975219e-01   +7.736683876460518e-01   +7.179700618573203e-01   +5.930487662228581e-02   +7.943544588330236e-01   +3.197756606870800e-01   +4.037656741378995e-01   +8.318773114818665e-01   +7.954541424525510e-01   +7.778350356994689e-02; +3.714388694689129e-01   +9.939388602867948e-02   +8.803355962224154e-01   +4.783539653320742e-01   +3.302843720739033e-01   +5.929928813930698e-01   +1.270151179085220e-01   +4.407291064521796e-01   +2.383604309000910e-01   +9.767495038474456e-01   +6.513758165638760e-01   +2.773118084969435e-01   +1.049061444051111e-01   +5.200587576039306e-01   +1.350606121726007e-01   +3.426480646236749e-01; +8.817764154918725e-01   +1.787922175265653e-01   +9.989214381484659e-01   +4.773977250091399e-01   +9.470419445193111e-01   +2.128273886491572e-01   +5.994825698570129e-01   +1.655748325670609e-01   +6.988593578497112e-01   +9.693955266137700e-01   +7.098037923662117e-01   +5.842188041356414e-01   +4.036331565394869e-01   +8.008067069198276e-01   +5.828480997313724e-01   +4.959576849202127e-01; +1.242113400506480e-01   +1.727609158454105e-01   +6.810025630346221e-01   +5.459413819929544e-01   +3.988005488665118e-01   +2.968439250899301e-01   +4.369926943656900e-01   +8.099547802816812e-02   +3.061145502807319e-01   +1.371123412629147e-01   +7.646022805946130e-01   +9.114889323485397e-01   +3.404812378567021e-01   +5.700370522352636e-01   +8.586222035486010e-02   +4.898054617787418e-01; +8.821240115077457e-02   +5.344464994773656e-01   +3.450944970839763e-01   +6.525780889716326e-01   +6.318509652430483e-01   +2.686564389812750e-01   +9.584976745025969e-01   +7.419185156729166e-01   +4.695186674112479e-01   -3.140189552520474e-05   +3.845206196443473e-01   +4.510652895462742e-01   +1.146791669861794e-01   +7.145012444404240e-01   +2.283936763083191e-01   +1.276953124007024e-01; +5.460125374004863e-01   +9.790784766639673e-01   +5.611807747927289e-01   +3.490770109641701e-01   +8.594068819616930e-01   +9.285643056812840e-01   +9.644919842015488e-01   +5.439565484933182e-01   +4.443936358044407e-01   +9.361758950290283e-01   +3.616821343495451e-01   +9.802886913451689e-01   +8.521269935735655e-01   +7.330637708115758e-01   +4.523554710255736e-01   +8.512571069046086e-02; +6.103860824728908e-01   +8.435735001992164e-01   +8.905500250981870e-01   +2.565342785359687e-01   +3.765732770736505e-01   +5.531401437577894e-01   +2.425026809488891e-01   +4.853444101874679e-01   +7.337685690162267e-01   +7.408755020810754e-01   +8.105286382717125e-01   +1.106103076227348e-01   +8.920002007756447e-01   +4.545684160656989e-01   +1.793033250681716e-01   +6.736789486523526e-01; +7.278051275308388e-01   +6.725713118415091e-01   +6.466869427967004e-01   +1.763222111449540e-01   +2.042653254447293e-01   +4.330941377576502e-01   +7.703853279942798e-01   +8.952863978645791e-01   +8.755271023994418e-01   +4.332301368350919e-01   +3.851356144170581e-01   +4.159002881698848e-01   +6.858881917496745e-01   +2.828066833572671e-01   +4.153514031140111e-01   +1.220979987505264e-01; +9.914010796599861e-01   +8.764779867846219e-03   +3.771760151910835e-01   +4.780925398782741e-01   +9.117830506434152e-01   +3.282521002098028e-01   +7.126266714337492e-01   +5.831386487923242e-01   +9.130877278576047e-01   +9.439608679323939e-01   +8.713188026247775e-01   +3.831170291401624e-01   +7.426134018003542e-01   +1.518088852789422e-01   +9.654325929673279e-01   +9.894602792108829e-01];
L2I_L1I_iGABA_netcon = [+5.744124983333920e-01   +5.644165733680718e-01   +1.082098740281842e-01   +4.591479619533702e-01   +7.964224857265096e-01   +9.785456425349925e-01   +2.241183585629421e-01   +7.584904229780732e-01; +5.577946234569615e-01   +9.527810912090945e-01   +1.193055150002703e-01   +5.679920978584974e-01   +5.418138827334821e-01   +4.231016243692535e-01   +6.565655781059307e-02   +5.058963697972541e-01; +6.112149779754573e-01   +8.875106027788342e-03   +4.334508942829180e-01   +8.179105262776282e-01   +2.572370696640180e-01   +3.934582950546885e-01   +8.356787114673687e-01   +8.278893629249495e-01; +4.670093587088037e-01   +1.269041275993919e-01   +9.329420065786294e-01   +3.547664353709166e-01   +7.817913951505773e-01   +4.608028898038955e-01   +4.153422154080096e-02   +9.273214761353683e-01; +4.344505065042513e-01   +8.531469395592232e-01   +1.401280085207054e-01   +2.484914641928839e-01   +7.788292933760228e-01   +1.212330426037246e-01   +9.095858931013552e-01   +7.106135247174360e-01; +6.298046581592055e-02   +2.180370056795496e-01   +8.261913999036798e-01   +7.710686070044026e-01   +1.444193964350511e-01   +4.546898762017046e-01   +4.503518846742503e-01   +7.978553108348628e-01; +6.466443550290932e-01   +7.096341422589107e-01   +9.324930000263358e-01   +2.345833449894237e-03   +8.230876985015370e-01   +2.655989268956513e-01   +2.853477200911341e-01   +9.581118535768214e-01; +4.258218452849049e-01   +7.744238772630690e-01   +5.729513425283084e-01   +2.760103189290616e-01   +6.231313989623403e-01   +9.299065686737215e-02   +7.544269494525919e-01   +9.510302174101539e-01; +7.561227745262892e-01   +4.207716928720917e-01   +4.987814293996446e-01   +2.332094542929036e-02   +4.575239130290385e-01   +6.619982083228003e-01   +9.264331746442497e-01   +2.957320496827566e-01; +3.072132934528607e-01   +7.250345513589073e-01   +9.311253764932369e-01   +6.699798946256521e-01   +4.841242814109277e-01   +9.453597015005158e-01   +1.417133221955865e-01   +3.521517654314635e-01; +5.983959045725367e-01   +4.581936374169599e-01   +8.617118378520937e-01   +9.670890447132390e-01   +2.190796963002064e-01   +7.646200796072058e-01   +9.561332925485727e-01   +5.411045870197791e-01; +3.347203149801619e-01   +8.047729996436426e-01   +2.531659531795774e-01   +9.455036065886612e-01   +8.577181090632701e-01   +4.276285731465605e-02   +3.036485063543707e-01   +2.135041877564092e-01; +6.434694442643398e-01   +4.276865788697327e-01   +4.586166195923781e-01   +4.733061915766541e-02   +8.798424229011835e-01   +2.616414398828371e-01   +2.094237895472859e-01   +8.118082932800229e-02; +1.599490118420683e-03   +1.487096286401998e-01   +7.406898336390169e-01   +2.861555176114899e-01   +8.453705247412693e-01   +6.345597223862877e-01   +4.640583660283297e-01   +5.066419334480257e-01; +1.442442470174851e-01   +8.045173588847869e-01   +7.525787946889452e-01   +4.870647099645248e-01   +4.427264565938324e-01   +8.999925442775381e-02   +5.970764795926652e-01   +1.947639158898445e-01; +2.479304334994397e-01   +3.816586283205489e-01   +2.304339660606053e-01   +8.867820191906109e-01   +5.435368759531609e-01   +7.478249549277267e-02   +5.523876241221721e-01   +1.449906437849329e-01];
L1I_L2I_iGABA_netcon = [+6.983617634287367e-01   +8.672481052021097e-01   +6.138659284922557e-01   +5.500336500500493e-02   +1.428513431151003e-01   +2.352452113376590e-01   +8.387396536309223e-01   +3.706875723989000e-01   +7.062789439965262e-01   +3.845395273607934e-01   +2.393317444454840e-01   +6.664082758269568e-01   +1.673394149194566e-01   +5.701121072843249e-01   +4.387613805320512e-02   +4.955609448102516e-02; +5.974863595224427e-01   +7.982609193968561e-01   +6.104645755996817e-01   +5.747913545522053e-02   +7.446167526206833e-01   +5.564425217370902e-01   +1.977081660920121e-01   +5.592900518330730e-01   +1.869875145313371e-01   +7.198992571189683e-01   +5.132638042256946e-01   +3.300868067783634e-01   +1.158794710499605e-01   +8.095867849187918e-01   +4.422146711120635e-01   +9.212954495895004e-01; +1.628551023491223e-01   +6.273715055064135e-01   +3.134192771962168e-01   +5.968199382822035e-01   +9.509847228672029e-01   +1.136207875869484e-01   +6.170799687662257e-01   +8.301595501916444e-01   +2.307773939304060e-01   +6.413924812007094e-01   +7.320271106718936e-01   +5.515714840579167e-01   +7.367268324635715e-01   +6.734795783593049e-01   +9.167960975878563e-01   +1.740176093379008e-01; +4.827000847124922e-01   +4.722022553042680e-01   +1.421105409485713e-01   +6.572489021004457e-01   +2.659254661950894e-01   +8.186144747887248e-01   +1.547796933103029e-01   +7.073885665412369e-01   +9.986167545934989e-01   +1.009415783413019e-01   +7.712704195608421e-01   +5.322945800781012e-01   +2.105659297442074e-01   +4.439101450111673e-01   +8.842570676181164e-01   +7.434769363989566e-01; +2.857108040268600e-01   +1.950708554902520e-02   +6.050277207733268e-01   +4.794968898334381e-01   +9.540049914476538e-02   +6.508181254663615e-01   +5.836019907622059e-01   +1.154493911705339e-01   +9.051788727888722e-01   +4.921483000717626e-01   +6.769253442717293e-01   +9.015797154277181e-01   +4.836941374555820e-01   +8.938457585517005e-01   +9.274100207515634e-02   +4.759604306561317e-01; +4.033113411880306e-01   +1.178376968741134e-01   +8.901314523813768e-01   +9.786810699037872e-01   +2.307786674535469e-01   +2.373335079145233e-01   +5.451034259356777e-01   +7.401297557958281e-01   +1.147977540070716e-02   +5.623219180331034e-01   +8.129490096311811e-01   +2.843518462286673e-01   +5.081362113906049e-02   +7.836948561277164e-01   +6.752560438401305e-01   +2.461758153686911e-01; +4.907737961979268e-01   +7.192789224436248e-01   +5.622514416350848e-01   +8.634341732620197e-01   +8.960468503584905e-01   +3.016008740208621e-01   +6.818692806281751e-01   +9.242789884102300e-01   +8.346043548117431e-01   +5.620443544586878e-02   +4.182098735707972e-01   +1.393977633138638e-01   +5.712204109186646e-01   +5.818203606414455e-01   +9.148371375931321e-03   +6.630395475466697e-01; +8.620905168084523e-01   +6.824445322545996e-01   +6.329872250845993e-01   +9.539053019336989e-01   +1.994359426070717e-01   +3.305614792108035e-01   +6.984358434684970e-01   +9.235766968843905e-01   +2.524718694195320e-01   +8.941902308741453e-02   +4.974148457582810e-01   +9.568542242065698e-01   +4.912063157430692e-01   +6.158765344124956e-01   +1.211544165043394e-01   +6.084794817465464e-01];
L2E_L1E_iAMPA_netcon = [+3.679156934734980e-01   +5.624893119484395e-01   +2.008043191790543e-01   +5.146684693134709e-01   +2.897849438379620e-01   +7.478849099925157e-02   +2.783789787869512e-01   +2.667601857283753e-01; +4.374713010329896e-01   +1.931287386860616e-01   +1.371164331039249e-01   +6.850044261612502e-01   +6.201301048806547e-01   +5.941345521851129e-01   +9.282430040407665e-01   +9.046151996397054e-01; +7.181238309823615e-01   +6.133259002114048e-01   +8.174165507356210e-02   +2.074315826172763e-01   +8.629897445210515e-01   +7.704204746461739e-02   +7.640779277648009e-01   +1.596250899731954e-01; +1.914297490755971e-01   +7.405373220169965e-01   +9.112644931417296e-02   +9.718346927291802e-01   +8.208422538064196e-01   +3.974016664952599e-01   +2.630205242414816e-01   +5.542250732330957e-01; +4.065673150462721e-02   +8.322358433494210e-01   +5.514740393641822e-01   +3.507460271383122e-01   +2.062255346499006e-01   +5.982861171007060e-02   +2.426006261289417e-01   +4.232583030219716e-01; +3.149795379812604e-01   +2.780199395220708e-01   +7.316125327631129e-01   +1.840238524532688e-01   +7.507136806521504e-01   +1.285710658593754e-01   +1.656274775338533e-01   +5.477067151691929e-01; +7.898710474764373e-01   +6.083839255046002e-01   +5.441851802587421e-01   +2.383029425607928e-01   +1.987509716105686e-01   +2.438729031137478e-01   +2.873762135721110e-01   +7.542792091315147e-01; +4.763800703462837e-02   +5.472747516359568e-01   +5.471310584568802e-02   +2.544369554554873e-01   +5.775474019264935e-01   +9.438265323502734e-01   +5.644578323714274e-01   +1.313762245921587e-02; +2.159820246596972e-01   +2.747938214473853e-01   +6.327339795909102e-01   +2.221085133229384e-01   +8.769841486776855e-01   +2.034855607904730e-01   +4.047317381123978e-01   -7.492715271883438e-04; +2.738019731830224e-01   +3.401286513136874e-01   +9.942855816762317e-01   +3.573971410477906e-02   +7.137574999900482e-01   +3.268151940838890e-01   +9.862012901339132e-01   +2.130037552007666e-02; +7.891831326733424e-01   +5.669264901211525e-01   +9.146569877186571e-01   +3.565688957309419e-01   +7.008053048148533e-01   +8.665388235010849e-01   +5.444330675809133e-01   +3.590907134179365e-01; +9.906297031213800e-01   +7.436387098447221e-01   +7.682196221104443e-01   +8.991026913271246e-01   +4.678581948390602e-01   +9.226432464761071e-01   +9.286895783284441e-01   +4.266022351055660e-01; +9.487001315166893e-02   +7.713819589146584e-01   +1.919562492735087e-01   +1.397428925610520e-01   +5.047112477354245e-01   +2.329879522595531e-02   +9.921751677488639e-01   +5.452496268693668e-01; +1.957641715969541e-01   +3.982535806446938e-01   +3.252593728059838e-02   +9.553335159759071e-01   +7.966196684990157e-01   +3.643221041545468e-01   +8.357111412353647e-01   +4.923335440846964e-01; +1.163341426832322e-01   +1.491727314244063e-01   +3.738172169510144e-01   +9.021126743789684e-01   +9.397322103111927e-01   +5.281532601018181e-01   +1.802061939114319e-01   +9.204403939844447e-01; +6.472212882033582e-01   +2.078322253157640e-01   +5.753689414576695e-01   +4.100140462173220e-01   +7.819864368220878e-01   +4.064500967453035e-01   +3.134437982578682e-01   +4.161500585253302e-01];
L1E_L2E_iAMPA_netcon = [+4.970920648592443e-01   +4.501660873332040e-01   +6.165392591847346e-01   +4.905039976835290e-01   +2.300436953675887e-01   +7.215967429620982e-01   +6.944138639701016e-01   +6.325827382261663e-01   +5.224012220418695e-01   +2.404278002947815e-01   +8.771711804835265e-01   +1.741159094384642e-01   +1.368348594432142e-01   +2.434888684801852e-01   +1.835074301652772e-01   +2.305758599679251e-02; +8.384537761006015e-01   +3.697196027261710e-01   +1.030820638765062e-01   +6.615402806701217e-01   +8.360204036128349e-01   +3.810154178684125e-01   +9.801097808649832e-01   +6.265758059612404e-01   +6.730317024935416e-01   +7.291748496713532e-01   +6.585099503552651e-01   +3.031001227400962e-01   +2.829752572764886e-01   +7.483240191283667e-01   +1.464607745586441e-01   +2.513389013171032e-01; +1.853674043420369e-01   +3.001833821053516e-01   +7.520620148439585e-01   +1.781232848396400e-01   +7.344190186500505e-01   +3.843875032220710e-01   +7.504272379378456e-01   +4.072472466029300e-01   +7.767234084304472e-01   +1.359654504774796e-01   +5.375288275672834e-01   +1.093315690979076e-01   +7.085585575263727e-03   +9.367476027291549e-01   +1.325881723563705e-01   +9.893211447651289e-01; +3.366540596256966e-01   +2.333293329471088e-01   +5.369987183934675e-01   +4.784450829751095e-01   +4.891361703746285e-01   +7.156689091468987e-01   +5.531549633578041e-01   +4.248979452940143e-01   +4.634693409893875e-01   +4.084395958226534e-02   +2.519738705716426e-01   +4.513934070757101e-01   +3.059855588853228e-01   +2.999385509269991e-02   +1.722364281526351e-01   +6.295887776248253e-01; +6.930256611748612e-01   +1.367549311314022e-01   +4.437408683163468e-01   +4.991893845092334e-01   +8.487772071759083e-01   +8.384730239877918e-01   +2.964830615617915e-02   +5.102966583334925e-01   +9.076492420183810e-01   +6.499709821348888e-01   +1.052706979061045e-01   +5.844156719932957e-01   +9.047566282053627e-01   +4.352970159349367e-01   +9.225275935331193e-01   +3.578569592589062e-01; +6.923078942327837e-01   +9.980011961419862e-02   +7.437046687114799e-01   +6.005087700022171e-01   +7.144482469943967e-01   +6.680750327702655e-01   +1.955389849332887e-01   +2.592587293623826e-01   +2.521921186517743e-02   +2.001386274976164e-01   +9.716949492339900e-01   +2.247467714425994e-01   +2.937466583754831e-01   +8.315040809104491e-01   +2.594002101017194e-01   +9.391749196292297e-02; +3.679518127036765e-01   +2.268067770562289e-01   +3.873718967129395e-01   +2.405775095631786e-01   +5.224145639279441e-01   +6.504757502811512e-01   +9.416065128957498e-01   +4.229866822945841e-01   +4.806729384319648e-01   +9.731482569414812e-01   +5.975139864977126e-01   +1.105237145619537e-01   +8.333479967319066e-01   +9.990494667690085e-01   +2.057497846095386e-01   +4.090428740262494e-01; +3.409137232824225e-02   +3.467196513094301e-01   +5.262553397756393e-01   +5.171555307397835e-01   +9.379870275950848e-01   +5.638285013170800e-01   +3.972050348139464e-01   +5.234303061475344e-01   +2.709798879907873e-01   +8.204570956916393e-01   +8.195349059947398e-01   +5.611895219148990e-01   +7.453219207132900e-01   +9.204657490909713e-01   +6.136022824933306e-01   +9.313158372020828e-01];
L2I_L2E_iAMPA_netcon = [+6.773045795911676e-01   +6.145110766101527e-01   +4.185323993063611e-02   +7.925638089560957e-01   +5.236405102601956e-01   +8.258774444548806e-01   +6.442339280674757e-01   +3.865638584087896e-01; +2.320627844092255e-02   +9.449357639390609e-01   +5.485601151234286e-02   +9.303691946211462e-01   +5.363166523978707e-02   +1.082837289217632e-01   +3.950840370620490e-02   +1.671341221369721e-01; +7.341884271914819e-01   +9.641589750913794e-01   +4.016208945504872e-01   +9.364684409339474e-01   +2.873566669057290e-01   +2.289767264081531e-02   +5.681134196051639e-01   +4.439637659785791e-01; +2.137153382394369e-01   +3.693712138689839e-01   +9.840048597713048e-01   +1.461721445473392e-01   +7.095956245833785e-01   +1.232598102387886e-02   +3.050347440995369e-01   +8.732512228391756e-01; +8.611244757951966e-01   +7.951302215947355e-01   +7.121672344751442e-01   +3.195618926060842e-01   +8.779719767448273e-01   +3.363038744056810e-01   +2.605753520339912e-01   +4.112972262983117e-01; +1.567687242703917e-01   +7.286217824413910e-01   +9.886858565377280e-01   +4.287453921834268e-01   +3.655824654194687e-01   +6.635372769604879e-01   +7.216743940222742e-01   +1.626833935081169e-01; +6.683620804800871e-01   +9.537548336590216e-01   +6.456816864915064e-01   +7.020792779189711e-01   +5.605977572096343e-01   +5.955166765893452e-01   +3.057675788203852e-01   +6.622064032754511e-01; +9.350143945417514e-01   +1.125457296012278e-02   +5.018159791503589e-01   +6.148017634685419e-01   +8.841446646757666e-01   +8.002044051839076e-02   +8.959640921921904e-01   +9.252437742164551e-01];
L2E_L2I_iGABA_netcon = [+5.962422467713677e-02   +5.202009562871808e-01   +3.523877823459530e-01   +2.616609042270229e-01   +4.203576148021380e-02   +8.906004796876900e-01   +3.441683116966316e-01   +4.512630746722698e-01; +3.538976805831239e-01   +6.935632879747636e-02   +5.571607946298460e-01   +9.842235454955918e-01   +3.608100905245080e-01   +5.402912319305685e-01   +9.350040486770415e-01   +6.711529702920895e-01; +9.330931945810587e-01   +1.846702778232516e-01   +6.918250026838876e-01   +3.495762497222948e-01   +3.620290397188110e-02   +7.171192809123206e-01   +9.186944917238096e-01   +7.690764232909841e-01; +2.409854840854826e-01   +3.167111282818764e-01   -5.942079785228658e-03   +4.018802230188093e-01   +4.859775671712480e-01   +7.102866404328644e-01   +7.249373907868641e-01   +9.268229381558459e-01; +1.027755197536729e-01   +2.441823105396369e-01   +4.834695963786054e-02   +7.522003671000254e-01   +7.227974345865142e-01   +1.686647755876590e-01   +4.430921083518718e-01   +6.585160498981246e-01; +7.161597374458306e-01   +3.216159217797195e-01   +3.085197267075559e-01   +1.015592413674816e-01   +1.466687866685639e-02   +3.514326895123009e-01   +1.519701875293244e-01   +5.014637973911598e-01; +5.862754544627632e-03   +8.793439338849580e-01   +8.688544626483332e-01   +5.902769566675652e-01   +5.172213647497397e-01   +3.793960721570386e-01   +8.319026667320749e-01   +3.425154242031262e-01; +1.852010376681854e-01   +3.013191047873060e-01   +6.276971039997659e-01   +1.229275228799485e-01   +2.395205076853574e-01   +7.581366475205109e-01   +2.571556829762224e-01   +9.460188696716200e-01];
L3E_L2E_iAMPA_netcon = [+7.923542331098755e-02   +1.610779893582407e-02   +3.678846495541231e-01   +4.965948775285018e-01   +1.839496892313979e-02   +9.555064654812269e-01   +3.599319884180261e-01   +1.397151905330993e-02   +2.037280764459729e-01   +6.188969227214976e-02   +2.429098358171289e-01   +9.988160801144453e-01; +9.518411554655223e-01   +9.770357299815711e-01   +1.153248081255718e-01   +6.553803657925546e-02   +8.063451846558879e-01   +3.873424525183849e-01   +2.241885502788411e-01   +1.223248027175939e-01   +3.556886780246969e-01   +7.416639733980467e-01   +5.332917408933827e-01   +3.448005185156118e-01; +6.626838891949213e-01   +7.248189769987610e-01   +5.141792824453686e-01   +8.618845488237404e-01   +7.924201465202964e-01   +6.643300462638311e-01   +7.247585421457156e-01   +6.695010551126217e-01   +8.877412140826979e-01   +9.904639766366257e-01   +3.331292269534011e-01   +8.224246663035403e-01; +1.686032440242395e-01   +8.717552420425542e-01   +6.821050720887181e-03   +9.965564792172328e-01   +4.233962542937427e-01   +5.844834750584567e-01   +7.725142558289986e-01   +5.083066095688255e-01   +8.091118204315415e-01   +7.676515863303125e-01   +6.743082146059729e-01   +1.098879117659323e-01; +1.966496887365890e-01   +8.141895179339659e-01   +8.692123425762718e-01   +1.225800462101648e-01   +6.304245043412068e-01   +5.934119345254399e-02   +3.424348453512251e-01   +7.041892673353925e-02   +3.191986681329794e-01   +8.811500378902017e-01   +8.752131058103054e-01   +7.732796959281176e-01; +9.948916561564705e-01   +3.083520896794475e-02   +9.044119594538562e-01   +9.974744378400191e-02   +5.679923879439052e-01   +7.615985593258345e-02   +5.768592295281451e-01   +5.360274810270708e-01   +5.996210085688083e-01   +3.632458700442266e-02   +9.825893654185658e-01   +1.502620496147369e-01; +9.255286388224548e-01   +9.598798660644475e-02   +1.130383289389890e-01   +1.489859988469008e-01   +8.960071247106757e-01   +2.273820493251175e-01   +6.427537746370008e-01   +6.779546110375738e-01   +6.986261175623132e-01   +7.937762931919667e-01   +1.451368667720834e-01   +7.318762935932814e-01; +9.817855483340953e-01   +8.574774458326651e-02   +4.443870589410535e-02   +1.287714123410794e-01   +7.488888980732179e-01   +4.199777932703054e-01   +3.654770343700786e-01   +5.878855121620536e-01   +1.784218906855014e-01   +7.065313236617888e-01   +8.770175743624622e-01   +1.094420272707530e-01];
L3I_L2I_iGABA_netcon = [+7.675119624219935e-01   +5.359491179587550e-01   +5.973080471462815e-01   +3.049797227479431e-01   +9.667175624644193e-01   +1.151735574210088e-01   +2.982887382977369e-01   +7.956075047814585e-01   +9.140313656579037e-01   +9.945233632738372e-01   +3.094756631366122e-01   +9.962556232476324e-01; +6.373801048728729e-01   +4.527679695117442e-01   +5.623508284678992e-01   +7.624478471953542e-01   +5.444534247119086e-01   +7.005669196217089e-02   +1.686502569381717e-01   +5.261043744778300e-02   +3.860099293312186e-01   +2.871962257755994e-01   +4.426551507310089e-01   +9.146150725512479e-01; +7.964859571262184e-01   +1.146670986219900e-01   +6.815765452425834e-02   +6.470402463043854e-01   +9.816897423811671e-01   +5.123392349501687e-02   +7.238433782357127e-01   +1.817800174542041e-01   +7.501551600451998e-01   +5.157487522416596e-01   +2.085579299528567e-01   +6.918491488456812e-01; +9.600895660060543e-01   +7.200825021135869e-01   +7.683053795288410e-01   +3.316120958780378e-01   +1.243000062818726e-01   +1.298080805545822e-01   +2.987284789441345e-01   +2.463668855640996e-01   +8.790902748677856e-01   +3.592237698105959e-01   +9.413204069095932e-01   +2.217002605425109e-01; +7.166621130705650e-01   +1.862414003843912e-01   +8.681210431169727e-01   +9.708830670350551e-01   +1.683251152420537e-01   +4.919596754668584e-01   +6.774784855483925e-01   +2.616862295064150e-01   +3.924773351900072e-01   +5.170764928339838e-01   +2.896814859631375e-01   +3.150733978491097e-01; +6.433143471099007e-01   +3.247611824004411e-01   +7.082873843923746e-01   +5.318834227757426e-01   +3.344942493703215e-01   +4.676770340659652e-01   +7.458170853625563e-01   +6.473656813345772e-01   +1.679369568326469e-01   +5.010025456107768e-01   +1.227521499638412e-01   +2.369209534494241e-01; +5.122940125922297e-01   +9.668197499282004e-01   +1.078622725024284e-01   +7.516310622902856e-01   +5.311766284265032e-01   +1.585199193246947e-01   +7.462804214573256e-01   +9.834201585854099e-02   +4.366192560171195e-01   +1.879108427294155e-01   +6.926052105628915e-02   +7.077137433498432e-01; +9.518253817442202e-01   +7.011400211170467e-01   +6.659470833042255e-01   +2.692244949579857e-01   +6.923817827976587e-01   +1.379997852023958e-01   +7.843933134869191e-01   +4.688137392303724e-01   +8.574743526648888e-01   +4.774665001994250e-01   +7.295664766777035e-01   +3.757696121290948e-01];
L2E_L3E_iAMPA_netcon = [+6.568270062325779e-01   +3.865520907751936e-01   +2.348320051450676e-01   +4.644322974866328e-01   +9.045954073569208e-01   +9.499816930724860e-01   +7.620052744196388e-01   +3.546421523404242e-01; +3.839484303333409e-01   +2.304160485324060e-02   +9.053375958125182e-01   +2.836027167070073e-01   +6.790778258584368e-01   +2.544739068896658e-02   +9.037237682411520e-01   +6.637154718513019e-01; +3.079176077827475e-01   +3.294996769113990e-01   +4.870374858587057e-01   +2.761363409174197e-01   +8.430397665608590e-01   +5.016665801951327e-01   +7.965020691636909e-01   +5.923305599855372e-01; +1.575302765686050e-01   +4.848625362681124e-01   +5.957582265935226e-01   +1.426789756969974e-01   +9.515823688438413e-02   +3.396397009141806e-01   +9.563679750767886e-01   +5.379600992293408e-02; +7.776548184384003e-01   +2.628187701291752e-01   +9.553730847780940e-01   +1.400001341921732e-01   +7.349978423279073e-01   +6.724921866473258e-01   +5.350393616293687e-01   +2.162271996821861e-01; +7.089931056124754e-01   +5.256925176743659e-01   +8.472793629542455e-02   +2.645348055469856e-01   +5.438146164487588e-01   +1.675092100654216e-01   +1.636928210870439e-01   +6.015262852849760e-01; +1.728964626763799e-01   +4.161335960676586e-01   +2.215074691937892e-01   +6.113091074017576e-01   +2.563754659347270e-01   +2.261124961158969e-01   +1.342369179548773e-01   +2.695733003500390e-01; +4.483701925062903e-01   -4.548645175966768e-03   +1.524892857508121e-01   +1.062809427184998e-01   +7.147807656725184e-01   +1.179903791873730e-01   +3.370680998075382e-02   +1.096287147588290e-01; +8.380401719976976e-01   +8.938366153399724e-01   +3.900425167971349e-01   +4.847404937136940e-01   +3.602205726201990e-01   +9.937234371905141e-01   +6.810938110240180e-01   +2.110349493627695e-01; +6.981391006152361e-01   +2.397804751277276e-01   +1.850065413076140e-01   +8.939736529835179e-01   +8.533395096819821e-01   +1.397160024992133e-01   +5.866630730029715e-01   +8.734774238220014e-01; +7.659242226283565e-01   +7.920259018274505e-01   +7.632877985169397e-01   +1.886114008608102e-01   +8.193439970104295e-01   +7.694129674829047e-01   +2.987424451526393e-01   +4.590929212643360e-01; +9.807782441464002e-01   +5.779458942604788e-01   +2.278181527652135e-01   +5.234886737626353e-02   +6.104292019450509e-01   +6.341777563893967e-01   +7.372241261386783e-02   +7.268446804398130e-01];
L2I_L3I_iGABA_netcon = [+5.895045339909355e-01   +1.468284200577491e-01   +3.442429095585113e-01   +3.692852284025847e-01   +5.994308167709519e-01   +5.070003140114864e-01   +7.729349657780404e-01   +2.646914096449249e-01; +8.460379647169904e-01   +9.901600766618518e-01   +4.568411694036534e-02   +5.376132480684270e-01   +4.784883598484168e-01   +2.372137367542262e-01   +1.786461523414625e-01   +5.853263967548835e-01; +6.043307890224699e-01   +4.809391079320756e-01   +9.415970680560066e-01   +9.744338555669741e-01   +3.770626431656291e-01   +2.721624516015722e-01   +4.537155860613128e-01   +6.795670372800658e-01; +7.448864853690186e-01   +3.614071513850355e-02   +8.661196204168912e-01   +9.965205849449076e-01   +9.786870844253157e-01   +4.053290383513676e-01   +3.059208834831595e-01   +4.157587578373203e-01; +8.498370884440377e-01   +2.698545695782917e-01   +1.339349998670641e-01   +4.143627674990543e-01   +1.385329841974347e-01   +2.605354028558281e-01   +3.879802589518330e-01   +5.112042983888943e-01; +1.462643016499766e-01   +6.756161181354767e-01   +5.898521162633247e-01   +4.505626607589024e-01   +2.712834606853131e-01   +8.544099600498613e-01   +8.034189412678436e-01   +8.141041397430033e-01; +7.419896099518078e-01   +1.462948557772243e-01   +6.253368170200559e-02   +2.549476295399749e-01   +2.258717495967737e-01   +4.786780626546576e-01   +7.778147771123946e-01   +5.443019355471572e-01; +1.725351487326183e-02   +7.737026594409637e-01   +9.465136865515621e-01   +6.010312576185607e-01   +7.922373399654667e-01   +3.415337896857298e-01   +6.463790273780082e-01   +5.895235885446126e-01; +2.281127339127254e-01   +2.669207959830901e-01   +4.971608175398983e-01   +7.785203935709442e-02   +8.181468173672078e-01   +6.392209537986402e-01   +2.424098478364522e-01   +5.352870328268855e-01; +5.379343410624923e-01   +8.806861709999410e-01   +2.653594280677782e-02   +9.121155995303275e-01   +7.924381529687299e-01   +4.158261330872843e-01   +6.081800899686713e-01   +5.410342889366840e-01; +7.198612537922278e-01   +3.690661345080644e-01   +5.717241639546736e-02   +4.733369833493631e-01   +1.130605843216587e-01   +5.439887236379711e-01   +4.189278512697706e-01   +1.511961677806766e-01; +4.342157044836001e-01   +9.703865489395338e-03   +3.010244476615873e-01   +5.074694909150682e-01   +6.325821430385328e-01   +3.401514338481812e-01   +2.942826622555338e-01   +7.040255048653730e-01];
L3I_L3E_iAMPA_netcon = [+6.352593003440447e-02   +7.730623419226250e-01   +5.547949964143982e-01   +5.734342967116222e-01   +9.202691296813990e-01   +8.351967105203727e-01   +8.497804115958433e-01   +8.628910712538184e-01   +5.335904555702887e-01   +9.880040384507742e-01   +4.820831205857080e-01   +3.498559857917303e-01; +9.221465513023086e-01   +8.386797568465552e-01   +8.440939471585073e-01   +9.358818072637375e-01   +5.927422333627202e-01   +3.925685074225292e-01   +6.284229906508754e-01   +8.565905248534607e-01   +5.678343582171907e-01   +7.012554160590113e-01   +7.400321065989417e-01   +4.001245219523081e-01; +1.804436804689581e-01   +5.930967168821452e-01   +9.699190813235841e-01   +7.790368279633205e-01   +5.760636345104012e-01   +7.030640208973876e-02   +4.442562466285542e-01   +9.490479178973548e-01   +9.800267649636839e-01   +8.440713151934417e-01   +5.949790554268043e-01   +9.878197491102911e-01; +5.432651414207307e-01   +7.669698383063088e-01   +4.656476201843773e-01   +5.960806454718737e-01   +6.583212549824771e-01   +3.737909956315684e-01   +2.345860015540630e-01   +6.943185420306767e-01   +9.682094482742242e-01   +7.382913143886858e-01   +2.635506652103976e-01   +2.977741347131685e-01; +3.977784269469583e-01   +6.586691331827018e-01   +7.762522812245010e-01   +5.814139759646154e-02   +4.357640880878464e-01   +8.492660682970564e-01   +5.095040617005339e-02   +3.630877403544785e-01   +5.601260194214303e-01   +9.957966919666617e-01   +6.073539418588773e-01   +2.246184690436969e-01; +9.164588932490036e-03   +5.888331111209218e-01   +2.207375068035907e-02   +5.438142902514729e-01   +9.353171806173972e-01   +2.499716056114012e-02   +7.125977739645396e-01   +3.731453891815200e-01   +5.323216022176926e-01   +5.073735582466324e-01   +2.320819335550086e-01   +3.305251554440872e-01; +1.026683220408769e-01   +2.614362966949641e-02   +6.774479268514705e-01   +8.644154204909325e-01   +1.028339059705932e-01   +4.210782225444445e-01   +8.477470193431020e-01   +8.417578246957531e-01   +4.791078287911981e-01   +1.893914056422239e-01   +1.947801136151768e-01   +1.647486809877942e-01; +8.559038316319062e-01   +6.926409648495283e-01   +8.350340911507000e-01   +3.384609624285591e-01   +4.090402264568092e-01   +2.539718250061750e-01   +4.051517660602861e-01   +3.844725956903348e-01   +9.015311537506181e-01   +9.591405809996590e-01   +1.948378400744718e-03   +3.839157317476771e-01; +3.376970014118339e-01   +3.278269857396496e-01   +6.841520068354449e-01   +1.784162261586853e-01   +8.924864750692093e-01   +7.413955041657119e-02   +2.869668599431975e-01   +7.705361109529163e-01   +4.819720498043270e-01   +4.516201615869348e-01   +6.461955607797635e-01   +5.260321449346249e-01; +1.494279100964531e-01   +7.623136016744635e-02   +8.958823921483234e-01   +8.808341892501819e-01   +7.387443286964568e-01   +9.202817409453913e-01   +2.624738743068111e-01   +7.736331461453727e-01   +4.866077395178208e-01   +6.059174404233152e-01   +4.001260964794074e-01   +5.955511165743261e-01; +8.077675993557376e-01   +7.444614472887200e-01   +9.556292005459086e-02   +8.417514539175482e-01   +9.585679209213054e-01   +2.688552763757174e-01   +5.054888090112811e-01   +4.332707636885242e-01   +3.138790994232804e-01   +6.450545584535368e-01   +2.719221485129527e-01   +1.694657439317012e-01; +6.551407785551558e-01   +9.653683961519052e-01   +7.007341153512876e-02   +8.338167585818621e-01   +9.696121681533771e-01   +1.012401296152461e-01   +1.171644666408458e-01   +4.872507423210907e-01   +8.592217159730362e-01   +7.661204493607158e-01   +3.177207162135844e-03   +7.295805258361654e-02];
L3E_L3I_iGABA_netcon = [+4.370205988751703e-01   +7.152154514802077e-02   +5.932000823560764e-03   +4.952050629429536e-01   +5.437276155102447e-01   +2.523171666403418e-01   +7.182793011562452e-01   +7.615504050015776e-01   +3.784770144397961e-01   +4.486466966298656e-01   +2.001524120962278e-01   +6.498234348942215e-01; +5.742063348435366e-02   +8.073338717040388e-01   +1.324010451193836e-01   +1.928058298459437e-01   +2.116296406071956e-01   +3.340121871509640e-01   +2.223412041024741e-01   +8.888976675855931e-01   +6.106468441929668e-01   +3.940721850773576e-01   +8.282030545672103e-01   +8.991530362824096e-01; +6.265266677689332e-01   +9.090109580933705e-01   +3.085970284767853e-01   +6.423964253104933e-01   +2.699631038216869e-01   +5.911096641662528e-01   +4.978759711654835e-01   +7.315512633704281e-01   +1.677354369340913e-01   +6.682257111462645e-01   +4.469748117146180e-01   +8.386453349159340e-01; +7.989167583693889e-01   +4.258186934706610e-01   +2.388159211253612e-01   +2.554443024189940e-01   +1.322891549581365e-01   +4.818885636531899e-01   +4.759147547254309e-01   +6.975910466335036e-01   +1.056249589877612e-01   +3.347794936419586e-02   +4.158652339647140e-02   +1.703706373440929e-01; +4.009012140721901e-01   +1.839219136920137e-01   +6.487583907863677e-01   +9.488445871021782e-01   +1.581867902371090e-02   +8.980854420200520e-01   +4.309584471492917e-01   +6.462185197710334e-01   +6.257553977181642e-01   +7.869526244583855e-01   +7.687501859024751e-01   +1.610351558587508e-01; +8.835168218014349e-01   +1.830764643762732e-01   +8.076499183522377e-01   +2.871786000073920e-01   +1.481043282178066e-02   +2.949007534359719e-01   +5.564520098212908e-01   +6.200490983757025e-01   +9.519557497720776e-01   +3.785054116423657e-01   +9.784653421068663e-02   +1.353817491656618e-01; +7.228363059258788e-01   +6.724617959247270e-01   +7.413628132722887e-01   +1.494598559751976e-01   +9.790589145340084e-01   +7.900629266349452e-02   +2.068840680620141e-01   +7.820918970474103e-02   +6.653033802887325e-01   +6.513900200440736e-01   +6.525013994399168e-01   +1.591884482653306e-01; +1.971461288290710e-01   +5.244032500924918e-01   +1.222060680914198e-01   +8.702457002123729e-01   +6.473728147598966e-01   +3.918956590627277e-01   +2.767103832105450e-01   +5.488500269527501e-01   +4.722691839526473e-01   +4.974419609285299e-01   +2.707173250698643e-01   +3.944106260687587e-01; +3.747289777378461e-01   +7.768854449240992e-01   +1.719037795509959e-01   +8.867761863985846e-01   +8.163606389949438e-01   +1.988292751976417e-01   +8.124537565195395e-01   +8.842531132332681e-01   +3.402604637414524e-01   +2.125888683459154e-01   +4.369048426129434e-01   +6.667541723936796e-01; +2.128203841582570e-01   +2.994132150066184e-01   +2.735487145134263e-01   +6.686013255104710e-01   +2.762480917820846e-01   +7.226817433076920e-01   +9.537807799410079e-02   +9.875121992692873e-01   +5.909422389440239e-01   +2.158820100344800e-01   +8.487081636520473e-01   +2.231211275715378e-01; +2.593086738601250e-01   +4.739560281935175e-01   +8.146776304176143e-01   +9.975874866092226e-01   +1.484144056399815e-02   +4.217594592576186e-01   +3.350993984422827e-02   +7.123889156026073e-02   +5.464619597306808e-01   +4.515856772345196e-01   +9.024417535157119e-01   +6.433025661693782e-01; +9.924604452887529e-01   +7.073292061322837e-01   +5.917173407763148e-01   +2.673984339778204e-01   +1.018802174541167e-01   +2.682003459225882e-01   +6.436542640887155e-02   +3.284975027997659e-02   +3.877451396746063e-02   +6.295759556425670e-01   +2.855917920871819e-01   +6.119775259253156e-01];
L2E_Input1_iAMPA_netcon = [+9.923070956201401e-01   +9.896793544840499e-01   +9.994841909471053e-01   +9.874092622472744e-01   +9.851952127735163e-01   +1.000000000000000e+00   +9.837204554301296e-01   +9.978149564377808e-01];
L2I_Input2_iAMPA_netcon = [+9.915028533090312e-01   +9.990436517380337e-01   +9.846425118022719e-01   +9.953598794359528e-01   +9.885808968907881e-01   +9.893810233776050e-01   +9.959356002402218e-01   +9.968529932553959e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
