function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.906226327562745e-01   +8.823677019057641e-01   -7.169075276776958e-01   +2.493605385925012e-01   -2.612819592997864e-01   +7.731488612601523e-02   +5.156237236156933e-01   +5.895268004795973e-02   +1.110091552875603e-01   +4.623470567200680e-01   +1.431380381145510e-01   -3.535783386777526e-01   +4.207445741524478e-01   -7.964668709168365e-01   -8.218293713068078e-02   +3.549578582595163e-01; +7.591844817540263e-01   -2.706327113376561e-01   +4.525135707210085e-01   -2.235224023748926e-01   +1.503343147472494e-01   +5.032120218907421e-01   -2.267932558276586e-02   -2.852653801994429e-01   +2.942402707095404e-01   -1.669013974831940e-01   -2.877372191307316e-01   -2.455486387832658e-01   -2.073072004454926e-01   -7.504993842612977e-01   +6.372061995003541e-01   +2.712946187485339e-01; -1.346582031964315e-01   +8.671320271895823e-03   +4.003851991781518e-01   -2.234368526650896e-02   -2.919071469636911e-01   -4.649873534203000e-02   +1.229578742645415e-01   -4.940810352140390e-03   -6.796638625701584e-02   +4.685361899618883e-01   -7.578291618045537e-01   -1.963291992055195e-01   -3.642855488011151e-01   +3.722843462418761e-01   -3.596222724391787e-01   -6.770296913163438e-01; -6.123419511608474e-01   +4.502270369755603e-01   -1.782008383097070e-01   +4.329244388867537e-01   -2.072542080989442e-02   -2.486366138110446e-01   +4.216284368928307e-01   -2.890392699310070e-01   +3.188074582496125e-02   -5.849400293182874e-01   +2.998188328801810e-02   -1.746787924626723e-01   -2.192834841965587e-01   +2.327891901431712e-01   +4.145132246324498e-01   -7.992499417955221e-02; -8.798622792240865e-02   +3.073070657393950e-01   +3.639139855489187e-02   +4.665880101785204e-01   +2.625599863304462e-01   -3.282657403337144e-01   -1.662323443431400e-01   +1.895236820230013e-01   +1.251355949356763e-01   +1.858897538692589e-01   +3.055601862797900e-01   +2.424713677318316e-01   -2.229799025633942e-01   +2.780790289833022e-01   +5.838436495832235e-01   -9.705841810623506e-01; +3.793099174339986e-01   -2.107930233004862e-01   -1.605564884698791e-01   -5.369451226293102e-01   -1.751489350691217e-01   +7.106344040886874e-01   -4.319083202767657e-01   +4.426121253019494e-02   -7.608416226998940e-01   -1.876842862366593e-01   +3.203161462553027e-01   -2.837276821845265e-01   +3.142815201286862e-01   +1.011117304558651e-01   +6.232545981574178e-01   -3.832925142351552e-01; +3.543461121713133e-01   -3.168980555191075e-01   -7.835405630196894e-01   +5.704579105071428e-01   +1.285649105500733e-01   +1.787881787375390e-01   +3.395599714113434e-02   +2.751468696025660e-01   -2.590427098827076e-01   +3.594178793789828e-01   -3.991008575248775e-01   +8.366578329128531e-01   +5.025890065687892e-01   +3.513553815151849e-01   -6.384760267435479e-01   -7.391008723075322e-01; -3.637558446583183e-02   +1.502494246433385e-01   -2.859250964152238e-02   -4.166548127808996e-01   +3.221215350117250e-01   -1.661289713026046e-01   -2.220301199982438e-02   +3.848573803056500e-01   -3.760542153509558e-01   -7.056632579539565e-02   +4.266489314776137e-01   +3.671850774807574e-01   -4.078612517240047e-01   -1.848003473480903e-01   -7.307738975504856e-01   +5.020610153291424e-01; +6.124729441573462e-01   +3.047889344928376e-01   -1.992290937444022e-01   +6.746529471086607e-02   +5.490863581497328e-01   -3.380604068162170e-01   +5.982643373520482e-01   -3.666282377207078e-01   +2.099799080840510e-01   +8.200413978620543e-01   +8.162857133433549e-02   +4.986760800998882e-01   -5.142856513300426e-01   -2.592531394724151e-01   -4.178828350023021e-02   -5.032238097083714e-01; -2.580002413664534e-01   -2.192310498476271e-01   +2.713984869614072e-02   +2.839290739606349e-01   +4.936363118048039e-01   -8.585185718354704e-02   +1.640094932651504e-01   +2.541814890704397e-01   +6.362869735710101e-01   -2.021990916193561e-01   +1.155063294609306e-01   -5.016875111313437e-01   -6.448487964038253e-02   -3.429272700910463e-02   -4.373376740185144e-01   -2.325175313158141e-01; -1.925549664267512e-01   +3.335710911951703e-01   -2.062117415948819e-03   +1.448254004149724e-01   -2.438853634900497e-01   -9.664964274995130e-02   -8.518424602754027e-01   -2.864507609048091e-01   -4.547958857226864e-01   -4.976797486414901e-01   +5.921386108281107e-01   -1.362067526005731e-01   +4.705916169288660e-01   -8.858242955863456e-01   +1.733318597553266e-01   +2.474808912825673e-01; +1.621896586342458e-01   +1.223734948355785e-01   +8.506722287538175e-01   +3.417769450780300e-01   +1.062080575835012e-01   +4.328423187990678e-01   -6.189941813188347e-02   +3.778834832228951e-01   +1.701371358835178e-01   +3.875517265617945e-01   +1.984568629478832e-01   +1.312267982305534e-01   -9.199878731377400e-01   +3.968871019427319e-01   -2.492437643732526e-03   -1.043709757652910e-01; -5.282237271464867e-01   -9.972266752642880e-01   -3.224545718009295e-01   -1.757927712105059e-01   -4.577760859812487e-01   -5.335468933377875e-01   +5.615551205204657e-01   -3.931148315243410e-01   +4.492646668099488e-01   +2.342208548336298e-01   +7.541848104430311e-01   +4.073429338775467e-01   -9.204457709136465e-02   +1.162461958984417e-01   -2.129026663942470e-01   -2.587258982169122e-01; -1.500616154244979e-01   -4.210925880097194e-01   -4.906573384529267e-02   -6.874991173193521e-01   +5.990051744086324e-01   -1.096748203456632e-01   +2.679180666132743e-01   +3.833940831329150e-01   -6.145009676268870e-02   -1.566946511398986e-01   +5.180229248999106e-01   +9.436554710848612e-03   +4.108100082993277e-01   +3.877908806450142e-01   +3.637258552522181e-01   -5.299195960559432e-01; -7.211619026794995e-01   +3.325845181281436e-01   +3.784817969300921e-01   +1.081516644359938e-01   -2.722949056498162e-01   +2.889575524108964e-01   -7.719300675076135e-02   -1.773480896367489e-01   +5.562649648641550e-01   +6.195729511696734e-01   -2.456578918618869e-01   -1.783348335619369e-02   +3.345687847412927e-01   +6.119878890150101e-01   -3.092635852543541e-01   -6.245635613939031e-01; +1.620019121304914e-01   +7.739693938264363e-01   +3.142259232439413e-01   +2.211713590493339e-01   +1.105415843357027e-01   +7.878082690923442e-01   -3.433295834601827e-01   +5.825820718645517e-01   -3.571205758930409e-01   -1.320160553888036e-01   -5.643907262143426e-01   -4.067231510235177e-01   +6.967196236631160e-02   -4.246081025993663e-01   +2.639199567206186e-01   +3.627904663697511e-01];
L1E_L1I_iGABA_netcon = [-8.641926946105540e-02   -2.223096826009250e-01   -2.512176979621654e-01   +8.615303840739096e-02   +2.062805653674627e-01   +2.069983499014883e-01   +1.848668308258491e-01   -8.161409783480809e-01   -9.330844792875112e-02   -4.143820651220923e-01   -3.178626414455195e-01   -5.245918618152680e-01   -3.094101146997005e-01   +1.022523852767638e-02   +6.047669690553740e-01   +2.625597671066442e-02; -9.000481832502578e-04   +4.225873886396521e-01   -6.847409525206145e-01   -3.165552021385802e-02   -5.157733576549438e-01   -7.837563671212086e-02   -3.807948920884741e-01   -1.906420730616618e-01   +6.816018767256868e-01   +5.388143477722642e-01   -1.948975950442732e-01   -8.567623953534680e-02   -1.019530927745380e-01   +5.383712954391979e-01   +2.914279443438575e-01   -1.264918582462354e-01; -9.878695023371720e-02   +3.199499488290764e-01   -4.826123048668628e-01   -1.619532742408277e-01   +5.810557272165686e-01   -8.486180821301507e-01   +1.316557706339129e-01   -8.638474565221345e-01   -3.783394330425856e-01   +2.514899406235020e-01   -7.312320880128151e-01   +1.946974077088493e-01   -8.947510027766961e-02   +4.017033035067784e-01   -1.957105616974936e-01   +6.978973756342468e-01; -6.405097504924259e-01   -6.049580848088010e-02   -5.671378510653410e-01   +1.738911845282406e-01   -6.284917528536368e-01   +8.737217099985953e-01   +2.457579104952018e-01   +3.620616165133492e-01   -4.477245331897857e-01   -3.685438132585421e-01   +7.079375915718596e-01   +1.757811416915719e-01   +8.106348954878266e-01   +9.499582186491519e-02   +1.985898945219815e-01   -1.770778904437004e-01; -4.865326344065661e-01   +6.101799013211684e-01   -6.361873500320563e-01   +6.718523804204414e-01   -2.911999280810963e-01   -4.803304810599465e-01   +1.273618627528418e-01   -9.255551915250428e-01   +6.521336386826410e-02   -2.808135525077943e-01   -7.856732737192083e-01   +2.032078303750214e-01   -2.143980911360440e-01   +7.022786577555368e-01   +3.536212145767936e-01   -3.512927739924547e-01; -2.910680777457136e-01   -4.042562231217761e-01   +1.091610373066626e-01   +2.273670247381231e-01   -4.033105222376641e-01   -2.172889416885981e-01   +5.257046651670007e-02   -3.777656908210371e-01   +6.976790137194212e-01   -5.825141321828636e-01   +2.327449434923024e-01   +2.644151918393924e-01   +5.247337212198037e-01   -3.490783829575678e-01   -1.000000000000000e+00   -1.713497931155800e-01; -3.620724458201683e-01   -2.312200657095181e-01   +2.016056003781174e-01   +3.934064493348626e-01   -2.030879122199661e-02   -2.703845172301060e-02   +8.142703202658541e-01   +2.246351125794576e-01   +1.074747524469176e-01   +6.028894030936548e-01   +8.961772533920073e-02   +5.796953636064294e-01   -1.514980270673310e-01   -7.982589013313489e-01   -3.115724432363979e-01   -4.386298495793364e-01; +4.239944545726204e-01   -1.608050971529931e-01   +3.150297676559741e-01   +8.917085165206685e-01   -2.215802106614207e-01   +5.597277340550930e-01   +7.190895772026845e-01   -2.974544899588402e-01   -7.385730190623604e-02   -5.060892515290732e-01   -4.820106274267466e-01   -3.848536070973553e-01   +3.816739943519563e-02   +4.894288726481706e-01   +7.697799220676866e-01   +6.115744127832793e-01; +2.477730955460626e-01   -2.835542270296936e-02   +8.267492044082554e-01   -1.143470511997660e-01   +9.836353570851582e-04   +4.414145798062972e-01   -6.864972675815392e-01   -4.879097626292107e-01   -2.201867193977716e-01   +1.100821409507190e-01   -6.146800066832184e-01   +1.142852833329980e-01   +4.022554842167733e-01   -6.755089081922595e-01   -1.824209015675141e-01   +6.839294934871946e-01; +3.717745245433905e-01   +7.562622678242811e-02   -8.118975546229037e-02   +4.098741766751304e-01   -3.240087512256880e-01   -1.584491453553693e-01   -4.699598463089102e-01   -1.963814529170129e-01   -2.119541697051337e-02   -1.408923878353467e-01   +7.207887347380314e-02   +4.267061456395603e-01   +5.719431557633309e-01   -1.901387830447440e-01   +6.444217664948283e-01   -3.517283591182193e-01; -9.069589208448700e-01   +9.813200318169674e-02   +7.805396756894388e-01   +1.231144919529575e-01   +3.576375409406359e-01   -9.016558649808304e-01   -4.120628264466524e-01   -8.736207879866543e-01   +4.074462140296871e-02   -5.036237080428477e-01   +7.268824244560094e-01   -6.939047682840276e-01   +2.823393354211034e-02   -4.531404565242585e-01   -2.396311519242072e-01   -8.201807423151512e-02; +7.557707777178195e-01   +7.687276382692669e-01   -7.929839345847452e-02   -5.530514197939891e-02   -1.072995631846803e-01   +1.559683879982244e-01   -6.810507631526539e-01   +4.559780554724153e-01   +4.988783268810617e-01   +8.177164456871524e-01   -4.141433184200115e-01   -7.452708166458191e-01   +4.773664069443494e-01   -7.867119120239109e-02   -2.005345835359604e-01   -6.843074332541150e-01; +8.489093927904237e-01   +4.691601156161637e-01   -4.410775415329174e-01   -8.743330180171418e-01   -2.913287576545270e-01   -9.352633547794818e-02   -5.852889033466154e-01   -4.080633467701681e-01   -7.288761964836556e-02   -2.567602161124825e-01   -1.869565191849275e-02   -1.530882124829052e-01   -9.648371900850928e-01   -9.310738025340572e-01   +1.911562135845691e-01   +2.186694889700949e-01; -1.472342995195441e-01   -2.572959744083399e-01   +9.270886478824129e-02   +1.097641552440222e-02   +2.029406812480719e-01   -5.504815851583418e-01   -1.885468354009501e-01   +5.493846078929004e-02   +2.728618507368366e-03   +2.570710603191982e-01   -8.899941811752765e-01   -9.788034750939637e-01   +1.803265045165141e-01   +2.053206945776661e-01   +5.963425064525137e-01   +1.403834053951206e-01; -7.384530974490072e-01   -5.450808174657311e-01   -3.113503509415371e-01   +8.518148617025596e-01   -9.660794113827565e-01   +8.967750642167986e-02   +4.685285506349882e-01   +8.337533666134708e-01   -2.069139518021149e-01   +3.448920101520644e-01   -3.323318900853944e-01   +8.169294461032311e-01   +3.253885442365997e-01   -1.057373468028762e-01   -5.490558282280257e-02   -8.631105812153531e-01; +6.389050793002908e-01   +4.603195972717071e-01   +1.349836634210695e-01   +1.641313706465077e-01   -1.091192696494761e-01   -7.440532406408913e-01   +3.124784185830502e-02   -9.801072069689172e-02   +4.505650764145570e-01   -6.863922472466312e-01   -4.673934047599201e-01   +5.508927425321030e-01   +7.678994601995623e-02   +2.131237569041895e-01   +1.793880675739227e-01   +5.817134219362377e-01];
L2I_L1I_iGABA_netcon = [+3.168374457578882e-01   +8.386169681146213e-02   +4.267447175313032e-02   +9.291424297176319e-02   -1.117648416623708e-01   -2.363601879781908e-01   -6.094411649732561e-01   +2.004851626747152e-01; -6.619814103601868e-01   -2.516022152586259e-01   +6.562535389565412e-02   -3.835729571752214e-01   -6.637898287652633e-01   +8.808649357048505e-01   +7.977326053561114e-02   +4.264972210595418e-02; +1.625375045823098e-01   +6.475736182371293e-02   +4.356893364561565e-01   +2.060906516511085e-01   -7.846708364626694e-01   +1.043149078042574e-01   -4.896415007078733e-01   +1.744221728880047e-01; -7.379250846779696e-01   +3.340487033105343e-01   +3.138752503353522e-01   +9.316417033595062e-02   +2.249691273729550e-01   +2.943698970909630e-01   +3.657562288148040e-01   -2.642928147973838e-01; -3.057093386796537e-01   +1.000000000000000e+00   +3.970141191490111e-01   -3.700614303541280e-01   -1.236269597121901e-01   -8.683761702252624e-02   -2.124595344946199e-01   +4.773266090278622e-01; -8.700741690168969e-01   -2.613467243909888e-01   -3.312438196200221e-01   +8.219482306294491e-01   +1.682002164747273e-01   +1.394788322423159e-01   -4.702544323319501e-01   +2.645502278506786e-01; +1.720057375372983e-01   +6.987550180147664e-01   -2.899703127406576e-01   -1.619813329061845e-01   +6.773221519929634e-02   -7.809071878435723e-01   -7.187936460768554e-01   +5.916451425089500e-02; -2.119596375612717e-01   -1.342239787556053e-01   -9.287965858348741e-01   -2.033695161770492e-01   -8.183207994280991e-01   -3.213383098624281e-01   +3.489763471161896e-01   +3.540205450833821e-02; +4.355011704706901e-02   +4.323771355835405e-01   +6.631033962243137e-01   -3.497123849057143e-01   +2.275329248602495e-01   +6.051887813961686e-01   -3.762822590568018e-01   -3.491173414050769e-01; -3.129573553578512e-01   -4.742244190686112e-01   -6.090863470245252e-01   -4.197714136108199e-01   -1.975537989555876e-02   -2.156371464924673e-01   +7.979888826788642e-02   +3.044753488085509e-01; +5.784912936778320e-01   -2.889158069660515e-01   +6.134709522835842e-01   +3.852069221188371e-01   +5.761107480269991e-01   +1.083576180631151e-01   +2.004026966894791e-01   +2.634728904806106e-01; -5.026128803312521e-01   -2.401388066226369e-01   +1.636269480952530e-01   -1.047850279989417e-01   +3.447845335107396e-01   -3.182324380713005e-01   -6.203032387216302e-01   +4.557773592280648e-02; +6.810793503766369e-02   +3.562296164010139e-01   -3.641173359810246e-01   +5.691867750185484e-01   -4.504328042833350e-01   -5.536081330876630e-01   -7.333772636034452e-01   +1.548602134904225e-01; -7.792992724809331e-03   +1.764728453998534e-01   -9.383045535750638e-02   -2.142432322925715e-01   -4.334452947828798e-01   +4.799397493308413e-01   -4.666445335217959e-02   +4.599438767973433e-02; -4.398770864323969e-01   +6.843858499209904e-01   -1.237095343771109e-01   -2.815199122252982e-01   +2.658584382516642e-01   +3.940128569890528e-02   +5.200364631700521e-01   -1.059887832276900e-01; -3.687700226971597e-01   +2.596640042690863e-01   -8.811278891470313e-02   +5.058174761592649e-01   -3.220933609288472e-01   +3.982113121000992e-01   +3.361054906608714e-01   +6.627408963247110e-01];
L1I_L2I_iGABA_netcon = [+2.109216800401121e-01   -9.725528579024233e-01   +5.710920953331095e-01   +2.531176004603806e-01   +7.871386932146615e-01   -9.265741874771023e-02   -5.548157156842694e-01   -6.514270073006529e-01   +7.426131695034954e-01   -3.147571767583350e-01   -2.506181791751093e-01   +2.732526915812137e-02   -4.567369844575117e-01   -5.606780336716973e-02   +6.505822601826504e-01   +5.759064862347266e-01; +3.983454995231041e-01   +3.994138945443590e-01   -5.242012355994012e-01   +2.254188073521075e-01   -2.839185340583982e-01   -5.982863447528119e-01   +5.422438495583165e-01   -4.461985923772041e-01   -5.989851453729238e-02   -4.905544230988456e-01   -2.368840745117392e-01   +1.228281886695810e-02   -9.509684825238975e-01   +2.189032544401204e-01   +2.278024331014041e-01   -2.859321581540125e-01; +3.844492855308433e-01   +1.799706167963547e-01   +3.338675315876237e-01   +6.179440654528662e-01   +2.783673462384936e-01   +4.972638523108814e-01   -1.335795739576446e-01   -5.580853348053410e-02   -1.439503917955984e-01   -7.665389436279343e-01   +3.567226590698713e-01   -3.159265277349109e-01   +5.464778705982157e-01   +7.843735468937235e-01   -2.538683726358936e-01   +4.423568322322703e-01; -6.184543887785254e-01   -5.661290554374865e-01   +1.674356465507082e-01   -1.118198598186698e-02   -2.218830070919087e-01   -2.685875532553783e-01   +4.809919408112999e-01   -5.248569902062158e-02   +4.995563474494530e-01   +2.171174221273088e-01   +3.307749605717443e-01   +2.953647924203677e-01   +1.897219566441154e-01   +5.657962646996940e-02   -1.655519362625886e-01   -2.113182424501257e-02; +3.327928954322900e-01   -8.773238050564861e-02   -2.937278738349157e-01   -4.303882506746186e-01   -6.265890757786482e-01   -3.356947267096478e-01   +3.102960507858085e-02   -1.000000000000000e+00   +5.833796395226560e-01   -2.837868074833096e-01   -4.547145763512023e-01   -1.981627766040691e-01   -1.314207213171932e-01   +6.477454076915015e-01   +5.897893905722091e-01   +4.565968484107715e-01; -5.983861580797845e-01   +5.796713411946945e-01   +9.138889129927056e-01   +1.419735684158715e-01   +5.378228310765557e-01   +2.775314989168428e-01   +6.184055309778913e-02   -4.938618921707691e-01   +5.111867789534645e-01   -3.826685730205323e-01   +4.510925273905530e-01   -2.385980709232169e-01   -5.599734804682112e-01   -3.334775805873195e-01   +5.605906692135045e-01   -5.733292487672343e-01; -2.604481888446705e-01   -6.240898824085790e-01   +3.270699355023878e-01   -4.674243801643574e-01   -4.021249020121936e-01   +2.434093986639409e-01   -3.467129580615720e-02   +1.909276211320957e-01   +6.277447997958964e-01   -2.481214485573937e-02   +7.172712981710659e-01   -3.992725680952132e-01   -5.850867287463686e-01   -6.393948737726689e-01   -2.356723731494265e-01   -2.452070261233552e-02; +5.068599900565202e-01   +2.442632094221099e-01   -1.884188691407651e-01   +2.350215955222248e-02   -1.009772488876564e-01   +5.648745691094492e-02   -4.151031041954871e-01   -2.640664068719803e-01   -1.372690506110880e-01   -3.344315448831958e-01   +2.678649336033124e-01   +2.045976718377002e-01   +2.207521030443658e-01   +6.239506725124722e-01   +2.904728047219011e-01   -2.348125194948128e-01];
L2E_L1E_iAMPA_netcon = [-1.683352440381997e-01   -4.071326526650123e-01   +2.696005614352358e-01   +1.107968434149047e-01   -1.558403709122720e-01   -2.713860442659780e-01   -4.476122583088914e-01   -1.678948509439148e-03; +1.034846534537499e-01   +3.506929262707844e-01   +1.199750034560575e-01   -1.022644619653640e-02   +4.745936556016140e-01   -7.603643355383337e-02   +5.730607678284646e-02   -5.116312150904765e-01; -3.187720152016941e-01   +5.399053465447045e-02   -2.973602946248903e-01   +1.554604190277989e-01   +1.036989269832061e-01   -8.028350510335290e-01   -9.100647536253431e-01   -7.512594494474388e-01; -4.135142618826868e-01   +4.610204453754859e-01   -6.521991487130666e-01   +2.652774730947438e-01   +1.611391800529819e-01   -1.000000000000000e+00   -2.189996265590134e-01   -4.366800400108093e-01; -3.812358899294868e-01   +1.983628424301597e-01   -2.488713044031341e-01   +2.799388531387118e-01   +7.239516058231063e-02   +7.254169711679753e-01   -3.649067236212525e-01   -9.851678728143757e-01; -1.166762742642453e-02   -2.639889115949109e-01   +2.341843239284091e-01   +2.336961629725296e-01   +3.767463026228807e-02   +6.606615709304547e-01   +4.019579911719453e-01   -1.332669958658445e-01; +5.498909508799688e-01   -4.117589011073359e-01   +3.163465715216955e-02   +6.078657511653541e-01   +8.328224611310724e-02   -1.859262174794527e-01   -4.574627156700244e-01   +4.756334808218399e-01; +5.300560461975807e-02   -2.716140267670786e-01   -3.696318114415386e-01   +9.759390065402393e-02   +3.738993659659625e-01   -3.426950146837554e-01   -3.975043422836830e-01   +1.507336440414314e-01; +3.365518056342811e-02   +7.567867757891515e-02   -2.658688935629097e-01   +2.528261569933971e-01   +6.084186741663641e-02   -6.267102602301832e-01   -1.214021691765563e-01   -7.685331378957122e-02; -1.740436079145809e-02   -3.394782214836399e-01   +1.369883375192057e-01   -5.406819829526585e-01   -2.616043263594385e-01   -7.761668116508476e-02   -1.904812181253377e-01   +7.257925315267993e-01; +8.409182520371423e-02   -1.845934025407429e-01   +2.208551936564519e-01   +4.046268948790541e-01   +7.872466195301857e-01   -3.189962204685155e-01   -2.089820184346545e-01   -1.138119327399930e-01; -4.258946281217416e-01   -6.906579256244186e-01   +1.108596981518950e-01   +7.167629177087018e-01   +8.721175863581201e-02   -3.632932855644146e-02   -3.817673095558951e-01   +1.776764975945250e-01; +2.247582082107767e-01   -1.372509870846128e-01   +6.197134702341803e-01   -9.315489015107189e-01   +9.250052441522659e-01   +4.601616706818714e-01   -2.549482328739227e-01   +6.282723252991361e-01; +2.706819641107333e-01   +3.414091409723116e-01   +6.035649654174220e-01   +6.078733026767656e-02   +2.675531135266547e-01   -5.390170267142848e-01   -3.965152937285077e-02   +3.872801175946964e-01; +1.373446739371937e-01   +4.048246591904645e-01   +2.343142833328564e-01   -5.168069500416410e-01   +3.726255749830476e-01   -1.064507963637238e-01   -2.686054437658305e-01   -6.127380643218732e-01; -7.652976247892716e-03   +2.496294007908857e-01   +4.107779538583590e-01   -2.447918779798500e-01   -4.973312978795360e-01   +2.395172556463034e-01   +2.603053024482305e-01   +8.517991541449295e-01];
L1E_L2E_iAMPA_netcon = [+2.815807989587853e-02   -7.708741148779974e-01   +3.445841751935146e-01   -1.914910997521246e-02   -6.593499098199463e-01   +6.946515884719568e-01   -4.106350661644513e-01   +4.321194432458029e-01   +1.567332871157526e-01   +2.462417732751696e-01   +2.353216547354323e-01   +4.009270437158201e-01   -2.090845067069342e-01   -4.497674938531795e-01   +4.400659731741498e-02   +1.507269580888780e-01; +9.754380787353968e-02   +3.862399407324253e-01   -2.424772829343350e-01   -1.809552926921428e-01   +4.509999291882193e-01   +1.079595677713447e-01   +1.512482765008344e-01   -3.622437920904580e-01   +2.439042604077391e-01   +4.178016204541071e-01   -2.080284328103093e-01   +9.149981257337551e-02   +2.633400380885354e-01   +1.562684127126981e-01   +3.998832257902594e-02   -1.361301083102730e-01; -3.855408090443732e-01   -2.382106852033078e-01   -1.451158471288358e-01   -9.455729763580654e-02   -5.987916197738119e-01   -5.922762529976668e-01   +5.350345998642948e-02   +2.118440414552134e-01   -7.440300277282351e-02   -3.261491601478351e-01   +3.998440740294170e-02   -6.865768233783388e-01   -8.003283817788039e-02   -3.735155293915459e-01   -1.498570251677535e-01   -3.842984817134810e-01; +6.079996379582748e-01   -4.403507718663847e-01   -3.269890357428557e-01   -3.576233314986588e-01   -4.127811933250636e-01   +3.543621035462304e-01   -1.021074593606252e-01   +4.600742938794803e-01   -2.322421548996597e-02   +1.010276865070565e-02   -3.464003879652074e-01   -3.700392903583593e-03   -2.368183895249765e-02   +5.663150727454129e-01   -1.012092209918798e-01   -8.532415461036592e-01; +4.756593335622188e-01   +1.507903822751109e-01   -5.633829636147690e-02   -6.259737822562729e-01   +2.429263866716408e-01   +1.456498265717994e-01   +3.789055109889534e-01   +1.439245495099987e-01   -4.281203172474444e-02   -1.574730594548469e-01   -1.529987511296583e-01   -1.242502346346972e-02   -5.327384723293717e-01   -1.948264472579118e-01   +6.332170912585311e-01   +3.358700673954385e-01; +3.657276782764939e-02   -1.000000000000000e+00   +5.570741647445075e-01   +3.425858392663322e-02   -4.164354444820375e-02   +3.848748884986107e-01   +7.071587055988625e-02   +1.733138100540170e-02   +2.402978469213392e-01   -4.357674279459307e-01   +4.823332104660700e-01   -1.900879099365670e-01   +2.423993940296679e-01   +8.589873267012707e-03   -3.620223496416028e-01   +2.685525036456751e-01; -1.623790098214512e-01   +7.862291654641411e-01   -8.598902881942364e-01   +9.571251092301754e-02   +4.581885279795991e-01   +3.250533425229164e-01   +3.279332745788149e-01   +2.164627411536852e-01   -5.751658809417056e-01   -1.915761366852092e-02   -2.946443665454427e-01   -4.768032297073536e-01   +8.045294832491203e-01   -1.913034278954094e-02   -5.904416585310222e-01   -3.074522676825146e-01; +5.323106724149117e-01   +2.266760693964806e-01   -9.282983859447824e-02   -1.198346685617079e-01   -3.977421628641102e-01   -3.603562832280839e-01   +3.912937343806704e-02   -3.854122217864690e-01   -1.288380043774553e-01   -2.795634213560741e-01   +2.249719113523338e-01   +8.163890854860333e-02   +3.020620878777879e-01   +2.600257222314437e-01   -2.125242033158079e-01   +5.793426542703062e-02];
L2I_L2E_iAMPA_netcon = [-3.221465505218450e-01   +8.102961213969635e-02   -1.308518366623948e-01   +2.073387103753521e-01   +8.514742711662306e-02   +3.351370139254483e-01   +1.480988238830893e-03   -3.705578094321664e-03; -1.000000000000000e+00   -1.250605866052757e-01   +7.509492024389747e-02   -2.183878406756598e-01   +1.735251889034835e-01   +7.526281653220084e-02   -4.649170540721846e-02   +1.623439812457012e-01; +5.181534413032405e-01   -5.329307391456801e-01   +3.215910819300194e-01   -6.202964498744327e-01   -6.804962700424544e-01   -1.903756912353206e-01   -2.521250547225999e-01   -2.737976764953092e-02; +2.782392334419995e-01   -7.281720636411783e-02   +8.847047280552264e-02   -6.394301527247951e-01   -3.063847359512968e-01   -4.236173275994509e-01   -6.622984577217039e-01   +5.872243426712650e-01; +3.443589022271156e-01   +3.173997593268340e-01   +1.931502643947961e-01   +5.287947367288576e-01   +4.036248846605102e-01   -3.417419796908157e-01   -2.811331489347197e-01   +3.607131807234110e-01; +6.341116380453690e-01   +2.057215521355471e-01   -4.470120138610625e-02   +1.198219821488191e-01   +2.262354229963951e-01   -6.247949716139656e-01   +6.326759748302665e-01   -4.481211185988379e-01; +1.297310791693656e-01   +9.573962158352402e-03   -4.922551762690915e-01   +9.105893900256806e-02   +7.189401055337271e-01   +1.438982815815578e-01   +4.673476998347906e-01   -3.379022653247027e-01; +3.032730861330161e-01   -4.933726082524580e-01   -6.094256984890573e-02   -7.971556903341512e-01   +1.592975503934156e-01   -2.769716061936068e-01   -1.084385982501805e-01   -1.514473957323370e-01];
L2E_L2I_iGABA_netcon = [+6.028743600390628e-01   -9.064917591376503e-01   -2.103363279038982e-01   +1.833462218630905e-01   +1.067736223244288e-01   -4.860742697215569e-01   -1.384055567766466e-01   -1.388858476605245e-01; -1.145819917034378e-01   +1.459417002417173e-01   +5.862822547769660e-01   +2.219622201079121e-01   +4.786206397708401e-01   +1.260380787931114e-01   -6.632288406003072e-01   +2.810413523599591e-01; -1.259773227738445e-01   +3.658758656705037e-01   +1.219657413624977e-01   +1.000000000000000e+00   +2.002384702624816e-01   -2.848441539963257e-01   +4.480077390888021e-03   +3.263690508642664e-01; -1.527924434381741e-01   +1.837054359535401e-01   +8.037005747677249e-02   -2.301894184999307e-01   +4.493025228857419e-01   -6.899050650115544e-01   +4.155862782323219e-01   +1.305021289613275e-01; +6.702617273354274e-01   -2.837646471728066e-01   +4.575871417788663e-01   +5.721942182051354e-01   -3.513121297251494e-01   -8.733910559015574e-01   +1.078477291169641e-01   -1.052486556775488e-01; +2.121215716030853e-01   -3.845667527379299e-01   +4.019951932937624e-01   +8.087096125864196e-01   +1.827747662855504e-01   +1.550459239804825e-01   -4.799219768515487e-01   +1.300903253529876e-01; +5.507772620183614e-01   +6.390198114655249e-01   -6.319463511347556e-02   -1.133191137324249e-01   -3.562445557117606e-01   -3.010401545517114e-01   +4.449970811259911e-01   -4.245146956959302e-01; +3.104557330736178e-01   +1.950285841231122e-01   -5.755939773321110e-01   -6.518002556148553e-01   +4.405117332660182e-01   +3.453663382563511e-01   +3.856536205491489e-01   -8.068274292498467e-01];
L3E_L2E_iAMPA_netcon = [+2.073230674270331e-01   +3.583653236501935e-01   +2.692316712372847e-02   +2.383025797432384e-01   +8.105889149439220e-01   -4.908984730604540e-01   +1.094283051053341e-02   -3.491189785014062e-01   -1.005325360118883e-01   -1.029985817949998e-01   +5.011847177319341e-02   +6.691210012424187e-02; +6.026189465656130e-01   +3.913665477492536e-01   +5.758532911864149e-01   -2.651949072418932e-01   -1.435071924505053e-01   -9.294901912660730e-02   -4.248208481170401e-01   -4.170505043802114e-01   -2.467384603225339e-01   -3.780419478141803e-01   -4.613489860066582e-01   +1.898273105359392e-01; -2.820409469745096e-01   -8.067244401639284e-01   -4.791591259615544e-01   +2.790594415408808e-02   -2.058359517024123e-02   -3.496885379288712e-02   +5.377233580986581e-01   -1.603388051089553e-02   -4.079743820894521e-01   +1.681937910957223e-01   -3.635187492993816e-01   +3.282917071854858e-01; -2.888173299868024e-02   -9.023525399707745e-01   +2.307855900447503e-01   +1.018973818816099e-01   +6.720704483078581e-01   +2.585960595890002e-01   +2.075978671386440e-01   -6.433818984503674e-01   +5.345418476102152e-02   -6.614428548751659e-01   -9.237971655671164e-02   -1.370644402080003e-01; -3.086595286278251e-01   +5.552658934530386e-02   +1.839529431765574e-01   -1.709975791280925e-02   +2.943242667167353e-01   -7.998570355416842e-02   -2.688407564415884e-01   -1.220917987446987e-02   +1.146597724413692e-01   +1.654997529470799e-01   -7.385710968640868e-01   -5.580382604390181e-01; +1.000000000000000e+00   +1.814880460718623e-01   +1.156332841407255e-01   +3.746149411249721e-01   +1.118310671022721e-01   -5.673404715902930e-01   -2.976363865637454e-02   -1.701083584997608e-01   -1.428207558668692e-01   +3.414222395748537e-01   -4.581339590539120e-01   -4.040213956381316e-01; -4.033649494829770e-01   -6.320961398251017e-01   -2.702206774771263e-01   -4.080816969802167e-01   -1.684425296388438e-01   -2.772901171724993e-01   -1.596389949845176e-01   -4.239434128158220e-04   -2.516497663095480e-01   +1.929171540712001e-01   +2.031570541992140e-01   -6.234235582906642e-01; -3.354057173777547e-01   +5.426625430510387e-02   +4.665649958440765e-01   +5.153448071376124e-01   -1.452042341633304e-01   +3.739431167201546e-01   +4.185651451093059e-01   -3.712611032471028e-01   -6.171582837989009e-01   -7.695982210105883e-02   +1.757827233723903e-01   -2.087269896910971e-01];
L3I_L2I_iGABA_netcon = [-6.013786743420190e-01   -4.395422389260033e-01   +4.548405868951966e-02   +2.101320639662680e-01   +4.012972232926071e-01   +5.703227039250665e-02   +1.850844912407355e-01   +3.612777335306250e-01   +5.937384327166159e-01   +2.981873872980627e-01   +2.286169335325219e-01   -4.259406067751224e-01; -3.837793784097008e-01   -2.530202450943956e-01   -7.357456165090611e-01   -6.923623519391392e-01   +8.603634876502758e-01   -6.616097590407112e-01   -3.966231266033950e-01   -5.325235289378106e-01   -8.020901534344663e-02   -4.889867307516931e-01   -1.368785397945723e-01   +1.293540599838379e-01; +8.873615625377186e-01   +1.856951561044203e-01   +1.774957286347739e-01   -7.844765016305739e-02   +4.134003459973751e-03   +8.033721322829792e-01   +5.735481144475717e-01   +1.000000000000000e+00   -3.355991662552665e-01   +3.456715074880709e-01   -6.397915902338387e-01   +3.158549526466570e-01; -2.336569461925915e-01   +1.312269283945489e-01   -6.608706866013675e-01   -4.635010033898083e-02   +6.856848512755017e-01   +3.829987241704771e-01   -2.997670782502535e-01   +2.495018398198413e-02   +7.916614886217481e-01   -3.392481086200650e-01   -5.907477926413526e-01   +2.467667482206664e-01; -4.575786008524205e-01   -4.088133453571917e-02   -5.525416947898769e-01   +4.849519572668797e-01   +1.613475816090977e-01   +2.336387779773487e-02   -3.714131044722179e-01   +1.537133160676420e-01   +2.163985629551262e-01   -8.014989207798897e-01   -2.659842553110399e-01   +4.691000752134197e-01; -4.052329340680683e-01   +2.489988757205899e-01   +6.759159975860949e-01   -8.129120659188529e-01   +1.359768471692361e-01   -1.539919444014760e-01   -2.786454826000264e-01   +5.485887623685625e-01   -1.890726506010599e-01   -5.852850201289407e-01   -2.338527159858943e-02   +7.749771108945851e-01; -8.502862269531454e-01   -9.796715000215324e-02   -4.687155470935412e-01   -5.525559787270982e-01   +1.165194404658458e-01   +2.819375074846455e-02   +4.702701021961691e-01   +9.223802020794540e-02   -1.746030788925407e-01   -4.052409592272847e-01   +3.677541071792113e-01   -3.903853251090453e-02; +5.264784948883018e-01   -4.604671371970539e-01   +7.456612629652128e-02   +3.153037859563343e-01   +5.109274199597225e-01   +1.590850586084252e-01   -8.128825608977314e-02   +4.047035100280996e-02   +2.907439445126083e-02   -1.277102085576388e-01   +5.366753710191916e-01   +3.786840464662875e-01];
L2E_L3E_iAMPA_netcon = [-1.708812118947537e-01   +8.068786424899005e-01   -2.849474250943552e-01   +5.995431226320114e-01   -1.731037603651275e-01   -4.181852656650726e-01   +1.217109355832158e-01   +3.095098068162887e-01; +3.876421872797240e-01   +3.544927882294342e-01   +1.521546148359139e-01   +8.012518825330098e-02   +5.377406057009676e-01   +4.086207449694041e-01   +8.462891579417737e-01   +3.470309529593354e-01; -2.994015877615654e-01   -3.821804074605413e-02   -3.787218995995481e-02   -6.742308501604666e-02   +7.613182811052549e-02   +5.566803425575798e-01   -4.601063722848188e-01   +3.840169200226856e-02; -6.066246585385228e-01   +5.637471527119048e-01   +3.731191153138777e-02   -9.121014650093680e-02   -8.558671586831028e-01   -8.817664586297933e-01   -3.088030075599332e-01   +8.962499273444716e-01; -4.448917101435310e-01   -5.434798470112832e-01   +7.443997370068622e-01   +1.347977951360166e-01   +6.959200141607735e-02   +6.223318729331838e-01   +6.582502686131395e-01   +2.459249423679732e-01; -7.655910393557045e-01   +8.337728879464708e-01   +3.996573602226449e-01   -1.915023597030005e-01   +1.884726679556756e-01   +5.936303566704302e-01   -1.083930120583951e-02   +1.640866153628952e-01; +6.564737425446500e-02   -3.574229517171029e-01   +7.796302360718155e-02   +6.610426272831530e-01   -7.023433520259520e-01   -1.479245758606216e-01   -1.344933170359073e-01   +3.580472648220245e-01; -5.498265523767837e-01   +5.300763820838473e-01   +2.798698325382791e-01   +1.753666529043483e-01   +1.721788011271822e-01   -1.614351760620747e-02   -1.961990887595668e-01   +1.058545186792018e-01; +1.474653228721456e-02   +6.117802649845713e-01   +1.533089494780653e-01   +7.350388298083230e-02   -5.253972401525433e-01   +3.043565744685400e-01   -7.066774268144085e-01   +1.793725500047666e-01; -2.423968277218542e-03   +8.859600510351556e-02   +3.201926059546487e-01   +4.175818921629494e-01   +6.589846579661903e-01   -7.174055180664882e-01   -1.350924531122617e-01   -6.920591017689011e-01; +6.588040755449567e-01   -1.486383889750751e-01   -2.207754118278965e-01   -3.734511860461260e-01   +6.041416967469193e-01   +3.183519725297574e-01   +6.150729397670276e-01   +3.722375791169825e-01; -1.158276321292413e-01   -4.030154627655516e-01   -5.680237322826278e-01   +8.545083737214281e-01   -3.275334249393556e-01   +4.570823807489870e-01   -3.647485015317856e-01   +4.563145040397970e-02];
L2I_L3I_iGABA_netcon = [-1.752724310439793e-01   -4.487676217123964e-02   +3.254946028827815e-01   +2.925911744474251e-01   +6.918068642762538e-01   -7.296722044902803e-01   +4.343097236227522e-03   -4.909489515505427e-02; -7.430470607258233e-01   -1.119928124348469e-01   +2.809842202337289e-02   +2.822013401777445e-02   +3.949747303899594e-02   +5.948309189031494e-01   -5.927846209537620e-02   -4.530264908743434e-01; +1.244229453189626e-01   -2.000053333611329e-01   -9.770946824426444e-02   -6.366159529400875e-01   -1.663490559620306e-01   +4.136229838953911e-01   -7.928182854025533e-01   +6.718882804704940e-02; -1.048444205194574e-01   +3.346458326688559e-01   +2.609085962650431e-02   -3.445298572032420e-01   +1.283988261626476e-01   +5.302034664961177e-01   +1.155264224176592e-01   -4.134471328677315e-01; +4.615575073694600e-01   +1.259853412746484e-01   +5.533753283668064e-02   +2.546827326250979e-01   +4.623273538807455e-01   -1.156171617073675e-01   -6.726464067651930e-02   +5.270546158155209e-01; -8.593196081196322e-02   +2.641390774032734e-01   -4.089626916745627e-01   +5.358949517077068e-01   +7.340868316849090e-02   +5.484335443159599e-01   -2.165989400035580e-01   -1.363398605319291e-01; -4.321270353064036e-01   -1.541358110768567e-01   +2.722876032515704e-01   -6.786841061598681e-02   +3.472144509676922e-01   -2.848946101586005e-01   +3.431077601108281e-01   -1.055546137227861e-01; -4.364162951932309e-01   +4.237870056446045e-01   +6.491042968436104e-01   +2.409045608594172e-01   -1.000000000000000e+00   +8.240137677716113e-01   -6.065846366192876e-02   -3.245830988538017e-01; +2.991820629768451e-01   -2.039452032841348e-02   +2.158075752767750e-01   -7.813329394968944e-02   -4.550837081781234e-01   -3.149248194692569e-01   +1.985233971242372e-01   +9.912398122332977e-02; +1.123835983466596e-01   +1.945475189384462e-01   +8.321198452385141e-02   -5.351049144446578e-02   -1.008455167239155e-01   +2.623640196210330e-01   +9.472488302318009e-02   +1.734722321960646e-01; +7.419817615349179e-01   +3.766252936775338e-01   +1.267427586693265e-01   -3.472755074042774e-02   +3.395081998374030e-02   +5.459618689661177e-02   -6.482958740317083e-01   +1.109886307341316e-01; -2.984115455353561e-01   -5.014036308146893e-01   +1.775907571520145e-02   -7.162081647072545e-01   +4.063590763481292e-01   +6.479392975949243e-02   -1.751681890253052e-01   +1.135218026372501e-01];
L3I_L3E_iAMPA_netcon = [+3.463074163776402e-01   -4.980227732693136e-01   -4.603413299689973e-01   +2.202817237262410e-01   +2.362672124065413e-01   +5.643769369716409e-01   -1.374425623983545e-02   -3.535980417414369e-01   +6.598227053259598e-01   +6.663034560339948e-02   +3.235613542645158e-01   -6.538157937605272e-01; +1.498356136198814e-01   +6.488817383753511e-01   -1.772494554543056e-01   +3.711020800926886e-01   +9.043210218059147e-02   +2.246189196932339e-01   +3.675944602448054e-02   +1.181389344826370e-01   -6.656878593572146e-01   -3.112211920254072e-01   -7.247275165871096e-02   +3.188784238812836e-01; -4.179515269732425e-02   -3.544457385801040e-01   +4.061888228386455e-01   +5.721879058922941e-01   +3.624837509845172e-01   -2.835728732379627e-01   +1.515782323461564e-01   +3.482348815864778e-02   +3.554443255173508e-01   -1.004754837787097e-01   +3.013644540032879e-01   -2.121184785316737e-01; -1.409433190571050e-01   -5.247237053191619e-02   +4.027808098030532e-01   -1.961693920980850e-01   -4.326858779727206e-01   +8.940975170412394e-02   +4.118539449803362e-01   -3.836646482772970e-01   +6.367279756075056e-02   -2.507863492484471e-01   +6.016392083787797e-01   -3.658738157708256e-01; +8.219324029365947e-02   -2.188759278489444e-01   -9.965170741296329e-02   -1.643132962352611e-01   +2.624916190000352e-01   +5.814818020510016e-01   +3.647049414411519e-01   +4.368604052781270e-01   -5.173852538000212e-02   +1.033078355961785e-01   +2.344038348070268e-01   +3.111309973003128e-01; -6.489677666906536e-02   -3.912714442067112e-01   -4.827318374624498e-01   -2.578457009761211e-01   -4.664969873544790e-01   -5.121769691505362e-01   +3.794937842640771e-01   -4.197663228454451e-01   +1.979767872934071e-01   +2.241299251739873e-01   +9.516854026366622e-01   -1.521868303561693e-01; -2.271800936100344e-01   +3.708108150785562e-01   -2.492784225080172e-01   +3.323665580777899e-01   +3.403380977042356e-01   -4.426333419650538e-01   +1.207403862529086e-02   +4.837797161655278e-01   -4.984482565016820e-01   -2.696611864996353e-01   -2.755780445944483e-01   +3.986810755920144e-01; +2.931552328760654e-01   -2.763540563685665e-01   -1.412608912695651e-01   -5.629823214934250e-01   +2.847215663527140e-01   +2.094289980439063e-01   -4.352741547884205e-01   -6.884135315283681e-01   +4.711385484568086e-01   +2.629846145040226e-01   -1.231982843586642e-01   +6.531962027550685e-01; -7.340502934127474e-01   +7.813402205538918e-02   +4.117473549881854e-01   +2.795997480312057e-01   -2.477227371581968e-01   -6.476432171108759e-01   +3.728587766473905e-01   -5.649730552085352e-01   -4.044251150876126e-01   -2.939103091031214e-01   -3.204019686910005e-01   +2.718158626495314e-01; +1.153942733156317e-02   -7.015049226774753e-01   +2.227654499955346e-01   -4.687736820684500e-01   +9.699428545413620e-01   +7.211425151231978e-01   -1.144372947509531e-01   +1.000000000000000e+00   -4.754211753822250e-01   -1.313696757569559e-01   +6.737668936467562e-01   +4.438451021602125e-01; +3.488550331986855e-01   -4.537538148783008e-01   +5.156475925040731e-02   -1.944074870210394e-01   -1.465799002269222e-01   +2.185818524604569e-01   +5.669832495944990e-01   -5.196770071154401e-01   -2.914015594900938e-01   -9.365934568115701e-02   -6.930487537759651e-01   -4.655288704142583e-01; -6.586740680585227e-01   -1.869849351069761e-01   +3.016636459313926e-01   -4.682793890543299e-01   -4.578816903628002e-02   -1.299492549394090e-01   +5.660640272814527e-01   -1.253849244978837e-01   -4.984537371163587e-01   +8.344412429399771e-02   -4.451713692382224e-01   +2.163638673843673e-01];
L3E_L3I_iGABA_netcon = [+5.710828533348542e-01   -7.369399602154022e-01   +1.406001100053109e-01   +2.874721928638751e-01   +1.974357004176445e-01   +6.121471903447333e-01   -1.595681383489627e-01   -5.137165725082349e-01   +7.418042588597802e-02   -3.997056960295562e-01   -1.371353254343198e-01   -5.388057290539033e-01; +9.654674718937220e-02   +4.122537507044956e-02   -2.586638170209696e-01   -7.951492600289713e-01   +5.808155915095130e-01   -8.716514045211934e-01   +4.313693878783741e-01   +1.070241800873855e-02   -7.158577945831309e-01   +2.128104296189453e-01   +4.086740874787052e-01   -2.554299488855326e-01; -7.289442926728846e-01   -4.463118372594097e-01   +2.090765027313735e-01   -4.541782642184547e-01   -1.980412459776772e-01   -3.185599847460713e-01   +1.123726741632310e-01   +9.625972551302964e-02   -8.945555674047226e-01   +6.878387349639724e-01   +1.352401320988786e-01   +6.580792532855442e-01; +1.896814158478869e-01   -1.660946263060550e-01   -2.215936949693466e-01   -5.478945323246068e-02   +2.288108823580948e-01   +9.455774344981267e-02   -5.566140329447858e-01   +1.822087430521561e-01   +2.570615843476510e-01   -3.041619207459689e-01   -3.669925779733210e-01   +4.072762972303678e-01; -4.726594082739484e-01   +4.222381366657701e-01   -6.423282761170725e-02   -2.457979714783839e-03   +7.560509830134013e-01   -7.680073865990337e-01   +4.939330109324551e-01   +8.384679597263086e-01   -2.736962051873824e-01   +4.614432701082991e-01   -6.003445144988023e-02   +1.639112037788934e-01; +3.218645689652568e-01   +1.000000000000000e+00   -9.341718557576953e-01   -1.389890306539737e-02   +1.050641865902081e-01   +6.528363670775931e-01   +5.934057459055677e-01   -1.031899002469223e-01   -1.776967243371363e-01   -3.773997158363811e-01   +2.243927176775351e-01   +4.320534452600308e-02; +2.099263494344344e-01   -2.864861422960707e-01   -3.139436967534886e-01   -1.589224884799512e-01   -6.748678263476994e-01   +4.290418217765268e-01   +3.146042862294727e-01   -9.930619020770264e-02   +1.274873761215493e-01   +3.298255059706718e-01   +3.703708080060247e-01   -2.206162921701207e-01; +5.081510028360683e-01   +5.847238159870078e-01   +4.416745688409485e-01   +2.550244453327228e-01   -1.388274597816453e-01   +4.398869408042480e-01   +9.704002105705254e-01   +4.417404136877167e-01   -2.474962312562826e-02   -3.086588340742579e-01   -6.940910862282637e-02   -1.885635853325482e-01; -1.877453771324643e-01   +3.238051784065952e-01   -2.627760488369372e-01   -3.836255023525729e-01   -1.938938956376632e-01   +4.118214224813262e-01   -3.280859337694976e-01   -3.929046715518517e-01   +2.633989673085179e-03   -9.459226384274175e-02   +6.503292245320804e-01   -2.758140895295475e-02; +1.387975616488795e-01   -6.162013150978416e-01   +1.882195257386897e-01   -4.692913979284905e-02   -1.907939119659437e-01   -2.341200743288135e-01   +3.789221848882592e-01   +1.590029885413500e-01   +3.576836229464358e-02   -1.771481079226922e-01   +2.048879401455382e-01   -3.752502892500247e-01; -3.505812666730985e-01   +3.316606808225973e-01   +8.147415570315631e-01   +9.017890374064044e-01   -3.132024994420184e-01   +2.645296587305317e-01   +4.022867431619235e-03   +9.220387285582407e-02   +5.521601385509980e-01   +1.056920346710582e-01   +7.447457274804465e-01   +1.627329512013594e-01; -3.419643787981443e-01   +5.606746486422290e-01   +1.467313202738975e-01   -6.337287097759188e-01   +2.283609557696465e-01   -7.194539615848179e-01   -3.220182517411206e-01   -5.021289736985998e-01   -6.105995817568901e-01   +1.446350467941372e-01   +2.998956367292956e-01   +9.264103742494453e-02];
L2E_Input1_iAMPA_netcon = [-1.176966886351192e-01   +4.878159742974770e-01   +5.130101024540390e-01   -8.001279493520502e-01   -1.687620308603511e-01   +2.804013555266124e-01   -3.947317271608544e-01   +2.938976631350812e-02];
L2I_Input2_iAMPA_netcon = [+4.434190265863813e-02   -8.759011874345479e-01   +5.003608888220770e-01   -7.881530023211745e-01   +1.716751541059771e-01   -4.411341225624628e-01   -4.586386263728557e-01   +7.347907708548450e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
