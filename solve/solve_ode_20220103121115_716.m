function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.050149075766835e-01   +1.617353557275730e-01   +4.507043514380719e-01   +3.518572762813924e-02   +1.313905927264478e-01   +4.948258393292671e-01   +8.290732190130896e-02   +2.737951972329034e-01   +1.027832714989938e-01   +5.377709273761621e-01   +8.852504381380769e-02   +2.632676635195290e-01   +2.133551853061896e-01   +3.538817845632639e-01   +3.575724502764223e-01   -2.804285070153402e-02; +4.872356257634653e-01   +1.401866461792264e-01   -2.215150519347951e-01   +2.837235313590810e-02   +4.047338580838206e-01   +4.456762142912401e-01   -6.686793689890468e-02   +2.794656342888251e-01   +3.587229028020921e-01   +3.276206237960585e-01   +3.038806004159579e-01   +3.818140463583783e-01   +1.342205827026730e-01   +5.419426921592368e-01   -2.637926399133244e-01   +2.993689444382494e-01; +3.327848770402011e-01   +4.539968863957681e-01   -1.824626966853883e-01   +1.274926721000765e-01   +4.349257191635040e-01   +2.421463560667985e-01   +1.692899784888065e-02   +3.527269258863278e-01   +9.291079954864415e-02   +6.188800454922978e-01   +5.081792369702871e-02   +2.811032230884003e-02   +3.843414546083858e-01   +4.202402809296894e-01   -1.536889035287407e-01   +2.610823978922271e-01; +5.093102709297660e-01   +1.719017314128491e-01   +5.054170122887399e-01   +8.471164637560405e-01   +4.569119547779847e-01   +5.349779527766170e-01   +6.909736017414833e-01   +8.161334609496654e-01   +8.707359854116975e-01   +3.793300757330035e-01   +2.522928655917372e-01   +1.362427067736237e-01   +3.251421969256169e-01   +4.758912917836286e-01   +1.726713488162955e-01   +3.879946697375396e-01; +4.982339855558540e-01   +5.630155800959933e-01   +4.548913592978915e-01   +9.942991273868464e-01   +5.055112016719328e-03   +1.920442045300100e-03   +1.754902627851039e-01   +8.061849577950827e-01   +4.834618183920434e-01   +2.191301552731244e-01   +7.230813180196556e-01   +2.495246466756461e-01   +7.988150525551898e-01   +1.172281961772882e-01   +7.456736645477643e-02   +5.448968472007095e-01; +5.155353551112719e-02   +4.639356934888563e-01   +5.200840285740459e-01   -6.051903413530613e-02   +1.459978622137888e-01   +5.560510269029637e-01   +3.819887165115466e-01   +5.677748607384920e-01   +2.207513301263709e-01   +3.513966654467788e-01   -5.144211383641859e-02   +4.404405560402413e-01   -4.806719314098575e-02   +4.328847539912279e-01   +2.325597819306080e-01   +6.335702778941043e-01; +3.673557373510762e-01   +6.800275433041513e-01   +9.540177002355280e-02   +6.373104663580545e-02   +2.049011521695355e-01   +5.747309347121596e-01   +3.645687769103549e-01   -2.301506140867990e-02   +2.402314119217059e-01   +1.158878425964185e-01   +4.667000871454114e-01   +4.267276509832612e-01   +5.268187690163233e-01   +3.063076769369260e-01   +4.336532738894979e-02   +1.908474549174773e-01; +5.503472678627377e-01   +6.838060956443678e-01   +4.942966783340395e-01   -2.100515890767555e-01   +3.600175988063288e-01   -1.052180210547041e-01   +4.363697871121204e-01   +2.081111190334966e-01   +2.853394675521066e-01   +4.059577099871975e-01   +1.982477494710692e-01   +4.105145248564523e-01   +3.057336618743607e-01   +3.293259921451540e-01   -6.128420459503973e-02   +4.249353100096317e-01; +2.545565275682473e-01   +4.639051159719263e-01   +5.012637858682054e-02   +1.065384649156981e-01   +7.057688023530007e-01   -1.011925285895572e-02   +3.595354374937825e-01   +4.753476105243307e-01   +2.022924383186497e-01   +2.083165641702547e-01   +4.696853369050861e-01   -1.309976283053011e-01   +1.245782107018130e-01   +2.351436938595262e-01   +3.116278542512910e-01   -5.553790670666536e-02; +3.741577329342239e-01   +6.244420863184981e-01   +4.327484272995994e-01   +2.904468116575659e-01   +3.171980427813788e-01   +5.630444389993670e-01   +7.305305459503019e-01   +1.378746013259285e-01   -1.849033130393940e-01   +3.054962950749781e-01   +3.336197568327970e-01   +3.437118359656435e-01   +6.234505004265111e-01   +5.527447591598328e-01   +5.087451241023999e-01   +2.078389637871496e-01; +2.561828373014272e-01   +2.079539863983358e-01   +2.637111600244278e-01   +5.326256773805330e-01   +5.548285771390397e-01   +3.076335628712398e-01   +3.310988683429678e-01   +5.801145573629830e-01   +2.880526596601772e-01   -2.300497501575772e-01   -3.143497935196108e-01   +4.560561118725446e-01   +3.676093805471077e-01   +2.325658670544059e-01   +3.671771144204381e-01   -1.025189535889190e-01; +3.582247191100059e-01   -1.650859725863182e-02   +3.711544834852148e-01   +2.830814611564197e-01   +3.748050314818024e-01   +5.695766123772984e-02   +1.712866959664127e-01   -1.325042219484565e-01   +1.462973516188196e-03   +5.587145197306016e-01   +2.302663465033719e-01   -3.484318773053609e-01   +5.377066646673694e-01   +5.217948336892311e-01   +1.230200435771078e-01   +2.748487824150747e-01; +2.882104573102940e-02   +3.113467074618658e-01   +7.993013340376676e-01   +4.875173649793983e-01   +4.797442351694101e-01   +6.629310347525501e-01   +2.504178562769467e-01   +4.299742184953596e-01   +4.638441836763461e-02   +8.011857651518994e-02   +3.488070532074310e-01   +6.013485486309168e-01   +5.673647662086853e-01   +5.160947246224866e-01   +3.135882725498190e-01   +2.413353230764002e-01; +4.313782957241752e-01   +4.687693929033009e-01   +4.931670564469396e-01   +4.902265588548585e-01   +6.267504628007533e-01   +4.396455114413245e-01   +1.855391041905339e-01   +1.119377839563868e-01   +5.205920225810033e-01   -2.415657547893156e-01   +4.172452657232923e-01   +1.608818214494417e-01   +1.006919920410673e-01   -2.633417095710594e-02   -1.180804047962084e-01   +1.874637103633043e-01; +6.138551198867304e-03   +3.875263990661872e-01   +1.522730926203449e-01   +5.155299294388884e-01   +2.735184894775907e-01   +8.202478859166530e-01   -1.405896441716762e-01   +7.119140806130825e-02   -2.718688473133918e-02   +3.675702004001711e-01   +5.436040306371831e-01   +5.377349955239441e-01   +5.096165498354583e-01   +7.002316160837350e-01   +4.052530099136151e-01   +1.778777040578567e-01; +3.095414133380224e-01   +2.155917588624379e-01   -1.547843911272114e-01   +9.417156959917186e-02   +6.353459504076129e-01   +2.464843464948981e-01   -8.284472699305916e-02   +1.070873985842509e-02   +2.790832685039612e-01   +2.682578604655355e-01   +2.360429980180049e-01   +2.062203733781154e-01   +4.203798587022887e-01   -6.897540881176056e-02   +6.521114734384315e-01   +2.459870606996089e-01];
L1E_L1I_iGABA_netcon = [+3.153126573098110e-01   +3.963522864865103e-01   +6.207117199768325e-01   -6.120102190618095e-02   +9.039951369078042e-02   -4.623714276091844e-04   +3.816271663573414e-01   +4.645897491873965e-02   +5.702824195873896e-01   +5.461065797775018e-01   +5.631270601261834e-01   +4.969648085711102e-01   +5.825678518985946e-01   +2.671401459261715e-01   +2.358968885672431e-01   +2.198965801318216e-01; -7.433430386054748e-02   +2.465109091674473e-01   +2.077010030023671e-01   +1.520246506539300e-01   +2.608731942763103e-01   +3.695059097674288e-01   +2.476350876498198e-01   -2.907651069010994e-01   +8.023388998962254e-01   +4.508992921489017e-01   +5.231561002297666e-01   +8.096707059786076e-02   +4.295001394614748e-01   +1.235947607151262e-01   +3.442490534279362e-01   +2.210523540919677e-01; +6.219225324647663e-01   +2.621806112241672e-01   +5.074044455022335e-01   -2.358857598229761e-02   +3.776556087322593e-01   +7.471898471539025e-01   +3.739176227761048e-01   +2.134168169170818e-01   +1.615080220235108e-01   +2.187826611579877e-01   +6.127742422327207e-01   +5.043782850655025e-01   +6.147718517238073e-01   +7.940535750141815e-02   +6.192122698401037e-01   +7.535937344774062e-01; +1.590983104570066e-01   -2.278147063999468e-03   +4.789249860335948e-02   +4.845994624616067e-01   +3.113794010969646e-01   +2.601548255324259e-01   +6.993968239756184e-01   +2.618342662628941e-01   +5.147942549681438e-01   +7.751783656648893e-01   -1.470332556095011e-02   +1.308547019102914e-01   +6.268248956066408e-01   +4.078246323973420e-02   +4.023254094644368e-01   +5.390688890952600e-01; +8.878449738345189e-02   +2.113982537374062e-01   -1.876927547220374e-01   +8.710052313427635e-02   +2.859543698540258e-01   +5.570635796057128e-01   +5.341976644270510e-01   +5.108391575197334e-01   +2.587436136034612e-01   +5.427914353371620e-01   +2.111447170600952e-01   +5.260253076740682e-01   +2.403195272936775e-01   +3.509777108153930e-01   +3.818847755931501e-01   +2.171158442812389e-01; +5.606339459689436e-01   +1.829005052503110e-01   +3.032146939633847e-01   +9.384591955600080e-02   +3.789697777233050e-01   -7.514111550762639e-02   +4.246409951064608e-01   +2.751227523620518e-01   +1.297760150178452e-01   +5.257650272042026e-01   +3.308374687958437e-01   +3.168801198833507e-01   +9.586631596661532e-02   +3.312069185678685e-01   +3.187351597465297e-01   +4.686461805800297e-01; +1.723312887169464e-01   +4.769451470691473e-01   +1.163571609938638e-01   +1.769841633086569e-01   +8.139400542948315e-02   -3.028828503074651e-01   +5.683815857026504e-01   +5.889151134731769e-01   +2.526646271695624e-01   -1.243656887668150e-01   +3.411196777608410e-02   -7.943407882571139e-02   +3.361998189155782e-02   +4.014322536459850e-01   +3.960830226068841e-01   +3.024829400845939e-01; +3.139422379060754e-01   +6.436925250964640e-01   +6.067640368194812e-01   +9.799019700481205e-02   +3.886523961247296e-01   +6.003146410227905e-01   +5.371351972930071e-02   -1.866837387208801e-01   +1.369553550551254e-01   +2.330510313407971e-01   +6.610938671097245e-01   -1.120446473449005e-02   +3.712568217227314e-01   +7.170307702619774e-01   +2.527793457319660e-01   -4.283176950588783e-02; -8.258181859156290e-02   +8.592706190861950e-02   +3.446106474520710e-01   +4.525949701841371e-01   +6.016153823176996e-01   +1.365974460846639e-01   +4.862490069756339e-01   +2.626766197201258e-01   +4.760901958212146e-01   +1.483756696276265e-01   -1.002654919095506e-01   +3.217846889797282e-01   +2.279751028008898e-01   +5.972348294831488e-01   +3.838811916182348e-01   +1.409940447568487e-01; +6.910573814532918e-02   +8.542637068169089e-01   +5.029023351992346e-01   +9.238163852304544e-02   +2.803974054808001e-01   +5.365598390862543e-01   +1.467006599070079e-01   -1.477234316075349e-02   +2.587560188838867e-01   +3.589318518845360e-01   +3.188220747179002e-01   +6.253928227372368e-01   +2.439350643154056e-01   +4.217328037720059e-01   +3.116888455424918e-01   -7.862424275098058e-02; +1.238696655453855e-01   +7.145026916764274e-01   +5.539949521553594e-01   +6.921261727411067e-01   +3.280888423127647e-01   +6.733944304688687e-02   +9.278216477192981e-02   +6.536867289098205e-01   +4.145933687391963e-01   +2.879963210770362e-01   +5.482785702442221e-01   +4.063190550519246e-01   -8.921231272881285e-02   +5.211790196655745e-01   +1.012610572891507e-01   +4.797994287114066e-01; +6.544548422075560e-01   +8.987123200328567e-02   +1.196188096279316e-01   +4.522460908524239e-01   +6.113630884333896e-01   +1.021043802521018e-01   +1.856276411685827e-01   +4.354551703135117e-01   -8.478136295903536e-02   +1.485006294682017e-01   +5.070869446225461e-01   +5.213324972874823e-01   -1.417578265373989e-01   +5.434067298639137e-02   +2.359253279716781e-01   +5.588095766018035e-01; +5.959223619773582e-01   +7.378216343186560e-01   +7.270296161346622e-01   +2.180656037617951e-01   +2.891919316704146e-01   +8.425814707465747e-01   +7.889359453768331e-02   +1.517811723930870e-01   +5.679857408368915e-01   +4.613550455874765e-01   +6.380436156453040e-01   -7.356705690770383e-02   +5.592859148404522e-01   +1.465112196127441e-01   +8.439970038763873e-02   +4.093613236003240e-01; +3.406353401689344e-01   +2.018157594202772e-01   +5.054787480238406e-01   +6.151900821745163e-01   +9.013354094646978e-01   +6.138895814021068e-01   +7.046776869549493e-01   -2.284832210741260e-02   -2.739931936941445e-02   +2.986784319657488e-01   +6.109806383380913e-02   +6.109444798385679e-01   +4.129877592916512e-01   +3.073008946509175e-01   +5.216235236344536e-01   +3.527002370731985e-01; +3.838337947154137e-01   +1.000000000000000e+00   +1.034395437010306e-01   -1.752535424755018e-01   +4.819241786085253e-01   +1.958948936514026e-01   +1.941879222784287e-01   -1.459175480438282e-02   +4.609624221227244e-01   -1.576876591368566e-01   +3.231260060852385e-01   +3.465505299115445e-01   +5.650074706055898e-01   -1.598529151247779e-01   +2.043509847296434e-01   -3.842919852446557e-01; -1.089056532354391e-01   +4.350870671536702e-01   +6.575762530138091e-01   +2.215652270422527e-01   +2.477282216688746e-01   +2.984793368384077e-01   +6.392663550662968e-02   +6.286210111511769e-01   +3.707603314616417e-01   +1.444822836111309e-01   +2.454899475885295e-01   +6.940060221306613e-01   -4.715593587243070e-02   +6.387681396593355e-02   +2.659919152133829e-02   +5.340624867414005e-02];
L2I_L1I_iGABA_netcon = [+1.703664251369341e-01   +7.824839419444699e-02   +7.782731524241712e-01   +2.550769636722909e-01   +4.659394904211389e-01   +4.779074106400006e-01   +6.764304392027319e-01   +8.783654085008504e-01; +1.355440444132719e-01   +3.629100025622077e-03   +2.023301420534241e-01   +4.442101758335902e-01   +6.200252213099126e-01   -2.210858608226484e-03   +3.120777321985547e-01   +5.456348544982104e-02; +4.988420399531562e-01   +5.322505528745121e-01   -1.112183281570719e-01   +3.138690392121264e-01   +5.179818333413632e-01   -1.349940057529551e-03   +3.028323940465032e-01   +3.840375345564802e-01; +2.972799125536508e-01   +4.229679314649749e-01   -2.440611530875859e-03   +4.953029614316544e-01   +1.572399832903063e-01   -1.665903355788922e-01   +6.003638512369995e-02   -5.358984819030864e-02; +1.767985292825168e-01   +5.217250987124549e-01   +7.727197273227740e-02   -8.130830016010247e-03   +4.954247491487525e-01   +3.208010231253415e-01   +4.789352318196904e-01   +5.134050638113310e-01; +4.651644479072546e-01   +3.646701482163808e-01   +5.222229817688664e-01   +5.779175578714247e-01   +2.712536405191092e-01   +1.668418698796585e-01   +3.759155157735748e-01   -1.931795571633278e-01; +2.336601694662699e-01   +6.739760919613840e-01   +4.024320513049785e-01   +7.735868391869174e-01   +2.958567133499859e-02   +5.117799838315521e-02   +1.287590379734129e-01   +3.372543362766295e-01; +5.145793931084134e-01   +2.577515365940349e-01   -5.644913978430726e-02   +2.981265957737869e-01   +2.876464857030704e-01   +3.333336641478855e-01   +3.547567701158008e-01   +6.579345092293554e-02; +3.354544888854303e-01   +2.171361391371199e-01   +5.419114701061805e-01   +1.862926703381119e-01   +2.139309514891342e-01   +9.728909499305844e-01   +2.153521838362920e-01   +9.291074708578925e-01; +6.425630452287776e-01   +2.756538168496889e-01   -1.260409234182941e-01   +5.852218920688571e-02   +4.916947825599694e-01   -1.402378707241188e-01   +1.225538695977112e-01   +4.327624493796958e-01; +1.726652588634689e-01   +6.007647380825311e-01   +2.801331260929092e-01   +6.385867799084893e-01   +2.607827156443105e-01   +1.686776755893094e-01   +7.789770449308043e-01   +6.709289619301173e-01; +6.140015992382427e-01   +9.672028848411224e-01   -2.271036582993932e-01   -2.874203390296435e-02   +1.699185000763703e-01   +3.722247832553978e-01   +2.587404508895878e-01   +2.256315894528341e-01; +9.984373846498319e-01   +3.027640132988909e-01   +6.058014492930122e-01   -1.796541811140086e-02   +2.906773119168823e-01   +1.191715649865241e-01   +7.379347785202550e-01   +1.692799464152293e-01; +6.423507426724774e-01   +2.520638032821873e-01   +2.650752820463111e-01   +1.913864849124625e-01   +3.326188441378502e-01   +2.895083222850927e-01   -6.793219728054806e-02   +6.626773198665116e-02; -1.179810749771935e-01   +8.561172174494416e-01   +5.690990742842192e-01   +1.206690204925114e-01   +3.145066499741606e-01   +5.370994385777387e-01   +2.758123782896475e-02   +2.841561985787875e-01; +1.562662630991368e-01   +4.916090511163828e-01   +6.953069602787808e-02   +4.395470941458588e-01   +1.971323606920971e-01   +3.360127786901118e-01   +1.265067689799841e-01   -9.339343425330272e-02];
L1I_L2I_iGABA_netcon = [+3.476649060965619e-01   +5.596432784954587e-01   +6.674638840308741e-02   +2.491416489950700e-01   +8.053222126685901e-01   -2.198962527979868e-01   +4.792428263334739e-01   +1.856233456502933e-01   +1.033650510653605e-01   +4.074740885222728e-01   +4.686882101590205e-01   +5.028407596665703e-01   +5.743320066979309e-01   +2.183776318023009e-01   -5.545843767873312e-02   +3.864060658884624e-01; +7.431105981643769e-01   +3.317445338147851e-01   +5.449956307822813e-01   +6.494205150677336e-01   +4.803671321460628e-01   +1.000000000000000e+00   +4.262032850887004e-01   +2.312744887316302e-01   +4.697255669694411e-01   -5.678673931052679e-02   +8.067508129571309e-02   +7.813814436599845e-01   +5.734362703391883e-01   +1.478028650935059e-01   +4.649087479881990e-01   +7.011758409361339e-01; +2.825856893671148e-01   -1.587661484594778e-01   +7.116463830584929e-01   +5.716530689868048e-01   +4.279679184080820e-01   +3.774644796010812e-01   +2.837413878938090e-01   +6.605321993758354e-01   +4.420411423012282e-01   +3.816857717171086e-01   -9.704454331270181e-02   +3.331390797714341e-01   -8.057773875937589e-02   +6.772419357943136e-01   +3.971338802188086e-01   +2.645910542310206e-01; -1.282104465076785e-01   +4.033149422954770e-01   +3.726280041780828e-01   +8.079253450814350e-02   +3.489116831660437e-01   +4.870519905163972e-01   +8.658311435761180e-01   +2.661892249407759e-01   +7.037598648100375e-01   +1.640518135733649e-01   +3.625012847259523e-01   +7.783692666018002e-01   +4.490338961704627e-01   +4.180664240190222e-01   +7.000448871369171e-01   +3.014981055985065e-01; +6.137823436867988e-01   +7.300046378255752e-01   +1.307209417692358e-01   +2.802522143975194e-01   +2.111332703133226e-01   +1.646473438012993e-01   +7.154832500587679e-01   +1.561864567147345e-01   -2.694328174331183e-01   +3.333342339182661e-01   +4.248360918854490e-01   +6.230365877667702e-01   +1.678940628662207e-01   -4.318163560483402e-02   +5.783996576907361e-01   +7.118818559180308e-01; +6.408634706528988e-01   +5.103637320295412e-01   +4.966829431267129e-01   -5.993096215885971e-02   +3.096840393240086e-01   +2.248810969026470e-02   +8.699421433149302e-01   +1.689716889873472e-01   +5.121662041849280e-01   +6.160539120319583e-01   +9.426774671834287e-01   +1.332029457491397e-01   +2.461669691220868e-01   +3.618285334766334e-01   +2.065600213794062e-01   +2.532411912125135e-01; +1.173100328124346e-01   +6.935214059851812e-01   +5.377760185568102e-01   +3.403504568511689e-01   +3.152423049961582e-01   +9.106672960309745e-01   +7.195780663254189e-01   +2.687160513498201e-01   +1.253196645486162e-01   -1.233157930951716e-01   +6.236954884345843e-01   +2.058863898735271e-01   +6.235289252484787e-01   +8.411947273421920e-01   +1.628111856085803e-01   +5.222371805229749e-01; +2.159976866881354e-01   +7.321634433210893e-01   +3.361334044637839e-01   +6.862557014159356e-01   +4.978320033029240e-01   +3.713256633093254e-01   +4.495250889737461e-01   -2.609230723153494e-01   +1.481192247182334e-02   +1.940241043045530e-01   +8.711981368697629e-02   +6.210675280436233e-01   +7.782537060293719e-02   +8.623254932546972e-01   +4.374091864058078e-01   +3.671832883456961e-01];
L2E_L1E_iAMPA_netcon = [+9.325714326162249e-02   +2.866931761032926e-01   +5.457318238409545e-01   +4.566001021302735e-01   +4.822406001455404e-01   +2.340227527816756e-01   +4.603012603092122e-01   +6.059529306310231e-01; +4.816811465009390e-01   -3.444390858520666e-02   +4.260051878931781e-03   +1.108003015442668e-01   +2.768331117178450e-01   +2.755553533662390e-01   +3.415504621060363e-02   +4.352721301687013e-01; +2.522837921567134e-01   +2.860188755222983e-01   +3.324299617093860e-01   +1.000000000000000e+00   -3.477236235412882e-02   +2.329652194333140e-01   +7.974984300963831e-03   +5.330035742410929e-01; +1.433665785608385e-01   +7.759485561129154e-02   +3.060443823450986e-01   +4.345803113335547e-01   +6.289525015231174e-01   +1.663270848224157e-01   +6.001188595613126e-01   +2.967157221954652e-01; +6.965690952284928e-01   +5.771765242770074e-01   +1.778956467609089e-01   +3.223052252433570e-02   +2.402010433357124e-01   +2.933615864383969e-01   +1.922174833394746e-01   +9.692238935364481e-02; +5.842755790530013e-01   +3.124732037978141e-01   +6.390652507447877e-01   +5.493252897957703e-01   +6.676511251937216e-01   +4.162594265441049e-01   +3.426871516428179e-01   +6.897945936068048e-01; +7.160621156559804e-01   +2.203360611479477e-01   +1.494368632651735e-01   -1.728070028780003e-01   +2.631046384606833e-01   +3.931693091371722e-01   +3.497231759818457e-01   +6.948336218355423e-01; +5.780914049957580e-01   +4.212773775411256e-01   +1.842600772566985e-01   +5.472908889842208e-01   -6.261385282348463e-03   -7.666473975640006e-02   +3.851033973354243e-01   +9.453378975384046e-01; +1.397108732976130e-01   +9.733575601621550e-02   +3.536767194253113e-01   +3.993510072109079e-02   +4.262755401919142e-01   +5.088611353546090e-01   +3.400276399980721e-01   -6.116880731395496e-02; +3.359570254605738e-01   +4.874813849741798e-01   +2.777359512272105e-01   +6.554586113151901e-01   +5.032269096680860e-01   -2.652810467799514e-01   +6.264412193905350e-01   +1.995229807076655e-01; +1.676453256737291e-02   +1.820365957366754e-01   +4.556806524892515e-01   +5.679215229570752e-01   +6.069091966086564e-03   +2.132617383909696e-01   +6.019977796794711e-01   +4.457562258208166e-01; +6.049222412631168e-01   -1.337704087456195e-01   -2.121823317823209e-01   +6.586277704437884e-01   +4.113178736303844e-01   +1.271694288687829e-02   +3.052144448827616e-01   +3.630491285940985e-01; +9.326729086752525e-02   +4.775937844152569e-01   +2.183587170666308e-01   -4.821604271115004e-02   +3.419913553539027e-01   +2.019419325998600e-01   +2.773731033508612e-02   +3.567410508167358e-01; +8.220521993565048e-02   +4.716127223760009e-01   +7.033576518414629e-01   +4.186170981145714e-01   +2.014275320995051e-01   +3.418454093833130e-01   +1.297090489917150e-01   +5.293540292343992e-01; +2.697178876879442e-01   +2.332333644938148e-01   +1.829475737063792e-01   +5.705645257012677e-01   +5.267926750450448e-01   +2.755194328219848e-01   +3.733540286371086e-01   +7.233327303503089e-01; +2.217561511954282e-01   +1.625662350867294e-01   +2.711826775595256e-01   +2.078115377828069e-01   +6.102195568122208e-01   +9.406577476422677e-02   -1.050672315320228e-01   +2.186273442257710e-01];
L1E_L2E_iAMPA_netcon = [+4.458082671812953e-01   +7.783583040738323e-01   +5.439647743540513e-02   +3.966896134424278e-01   -3.714998469782748e-01   +3.025212284746335e-01   +1.403332637196002e-01   +7.819825161166133e-01   +8.057738281331229e-01   +2.848439185964394e-01   +6.144985921125657e-01   +6.379768758320090e-01   +6.282322272304536e-01   +1.731348780411657e-01   +6.270415369565981e-02   +7.038519848485713e-01; +4.264206508613165e-01   +6.273380021154968e-01   +7.571195578691206e-01   +5.973432297535736e-01   +3.596843411743196e-01   +4.413576429610243e-01   +5.011367804885908e-01   -2.939821024178980e-01   +2.931308972744915e-01   +6.171328052827038e-01   +4.495682017037314e-01   -2.152944903238577e-01   +6.237221289264605e-01   +2.336833154814042e-02   +1.836202671100440e-01   +9.027305266276218e-02; +1.089328906377928e-01   +3.977578633622022e-01   +5.624775998204916e-01   +7.223716531502354e-01   -8.534918580891132e-02   +3.292831142828050e-01   +6.613479097518754e-03   +4.318674695430514e-02   +3.787167180620875e-01   +1.076199215581371e-01   +7.465229700405789e-01   +4.180555680455970e-01   +1.181478618340381e-01   +6.415988203277119e-01   +6.662392872949715e-01   +4.955115039285291e-01; -8.391671216989903e-02   +5.353579820908181e-01   +2.264119660383435e-01   +6.129378971214974e-01   +1.350032966616997e-01   +6.045284104210181e-01   +4.219556567561435e-02   -1.111950158065438e-01   +1.162274043897225e-01   +3.826065716522044e-01   +4.597927938060928e-01   +1.671988879128788e-01   +1.973865322308408e-01   +2.823829399447614e-01   -1.260857032749119e-02   +7.752432893517541e-02; +2.602896478523088e-01   +7.529082129699399e-01   +7.015818694277215e-01   +9.180400738216993e-02   +4.417448741243076e-01   +8.589902380437663e-01   +4.487856412920085e-01   +2.136714415199948e-01   +5.144223470672135e-01   +6.092908386558135e-01   +1.000000000000000e+00   +5.122954368930738e-02   +6.971254614363092e-01   +6.769834089564117e-01   +3.520310910381123e-01   +3.038340411162748e-01; +4.300715482474747e-01   +1.430174439548251e-02   +4.648010334305048e-01   +6.107160214486163e-01   +3.656050555773769e-01   +5.583360578485046e-01   +7.635698013395271e-01   +3.279424055542748e-01   +2.068449592397128e-01   +6.273667535347229e-01   -1.822280382084467e-03   +5.327722405094706e-01   +4.547457934474855e-01   +2.966644669023576e-01   +7.363973390193048e-01   +7.212779391034494e-01; +5.477620779461829e-01   -1.272682147182887e-02   +2.700059705421987e-01   +4.497235147697609e-01   +3.761396539745620e-01   +1.613424883906988e-01   +9.008924340514103e-01   +9.391334254278165e-01   +2.972111117696761e-01   +3.550458913145468e-01   +5.478661035286311e-01   +4.904252009813491e-01   +2.347462822186001e-01   +5.759403604203602e-01   +2.312183218976160e-01   +1.917295252285727e-01; +4.725207643030134e-01   +6.341424806380105e-01   +5.825550937523248e-01   +1.210003886880261e-01   +8.597761443792633e-01   +2.143880801351967e-01   +3.041609446669705e-01   +5.265333989110393e-01   +5.792448760237847e-01   +2.754788399351782e-01   +3.058753009801671e-01   +2.025281713210621e-01   +7.633236374389352e-03   -1.452625232938805e-01   +2.612602077200166e-01   +4.556998450317535e-01];
L2I_L2E_iAMPA_netcon = [+2.917007513398395e-01   +9.539795536788591e-01   +6.240314571302886e-01   +6.950751366290476e-01   +4.098241680967427e-01   -4.835864923413827e-02   +8.134753222820419e-01   +6.866311194225079e-01; +8.830839033572317e-01   +8.480576876961036e-01   +1.573046574936694e-01   -2.039685973386984e-02   +4.877488747354796e-01   -1.596817260885532e-02   +3.470471812009345e-01   +1.752278093513793e-01; +4.967116102191956e-01   +6.876580010110805e-01   +7.021662188760318e-01   +1.218069377505655e-01   +3.548499390456100e-01   +7.698613589230173e-01   -1.480305787309887e-02   +3.313475231132607e-01; +6.079509879682122e-01   +7.861295539345066e-01   +3.992452204994582e-01   +2.055655879845145e-01   +7.596879732455641e-01   +9.786354914080049e-01   +8.758703552305457e-01   +9.543368188348664e-01; +9.871121563021069e-01   +1.101201282840392e-02   +3.320963561021950e-01   -1.300274049383192e-01   +1.176640694212712e-02   +7.049872886785978e-01   +5.156964225063351e-01   +3.550222708035863e-01; -2.861723970506987e-02   +1.673418529253938e-01   -9.403342875594170e-02   +3.776510565802123e-01   +3.759281883990734e-02   +6.765597367083431e-01   +6.202746750593493e-01   +6.216775194822118e-02; +8.494253581542035e-01   +5.458383107980105e-02   +2.871539995276339e-01   +9.696993474050153e-02   +2.632873199205507e-01   +4.444492521091281e-01   +5.408259327862277e-01   +2.939798440561746e-01; +5.698132471400322e-02   +2.488838572991345e-01   +2.826476576428005e-01   +1.764272615334425e-01   +7.895058393747709e-01   +5.621296953479860e-01   +3.807810206527777e-01   -5.648549426970120e-02];
L2E_L2I_iGABA_netcon = [+7.919450943816934e-01   +6.375719170706725e-01   +6.877298085174605e-01   +5.818391499288381e-01   +3.398395104821651e-01   +1.699606281756899e-01   +2.681766197051491e-01   +1.629322876643007e-01; +3.383264446296443e-01   +7.796110288469836e-01   +8.504168207969298e-01   +1.000000000000000e+00   +2.865126136221470e-01   +4.087478406325298e-01   +9.316473917121224e-02   +6.173744275437635e-01; -9.041648296499474e-02   +5.408558555962564e-01   +8.002410494319052e-01   +6.645247023818927e-01   +5.514790646445201e-01   -7.930419278151772e-02   +5.345556040275585e-01   +1.730903369432207e-01; +4.563551224371470e-01   +1.487620620827255e-01   +6.795052451628947e-01   +1.417212955744000e-01   +4.349491511487130e-01   +2.537145756351756e-01   +2.038572270289729e-01   -2.250025893771292e-01; +4.176976398053379e-01   +7.081993736395606e-01   +4.866801219487324e-01   +3.842458735356156e-01   +2.716174611303012e-01   +1.080221654210582e-01   +6.543233348951414e-01   -9.048685085215523e-02; +9.105178883836818e-03   +9.146267463804324e-02   -2.010008120656149e-01   +1.945314369318663e-01   +6.660758026120567e-01   +3.709899364077807e-01   +3.145344832244333e-01   -4.928147443639581e-02; +4.425860297931714e-01   +4.475777562044077e-01   +9.688216266052049e-02   +4.672198391476123e-01   +3.941725477699858e-01   +6.255474219656816e-01   +5.381292477401330e-01   +7.090515460424160e-01; +3.253385462097281e-01   +1.522273199058958e-01   +3.773317302114891e-01   +5.089676416020158e-01   +3.010330832698213e-01   +1.215277318789768e-01   +1.322804286819140e-01   +6.474796513723224e-02];
L3E_L2E_iAMPA_netcon = [+1.795730893831108e-01   +1.129150341043139e-01   +5.330003192039333e-01   +2.638825964752530e-01   +4.833990786470698e-01   +3.265266100482653e-01   +4.723597689830366e-01   +5.325687519074459e-01   +2.884612653955198e-01   +7.198746690215172e-01   +7.223955673852949e-01   +3.771871640882482e-01; +3.286771505811132e-01   +3.192582389634522e-01   +5.269788913353320e-01   +3.501932400620664e-01   +5.596940539653410e-02   +2.286619819410282e-01   +1.724969064664363e-01   +7.477096933521264e-01   +3.285463426535770e-01   +4.218730346520033e-01   +4.796784029355442e-01   -1.591648141552835e-01; -1.278973711161266e-01   +3.264117257693169e-01   -2.731036263812160e-02   +4.378253443887930e-01   -1.548215873798447e-01   +1.695016772146632e-01   +4.844086423332637e-02   +2.287077802275611e-01   -1.660025608280584e-01   +5.478113711909756e-02   +1.792651374761188e-01   +3.426510669944323e-01; +3.875776204484768e-01   +1.709752146167175e-01   +1.213102529963846e-01   +2.835150165206786e-01   +4.255496223627068e-01   +3.634020638032285e-01   +8.328443265991768e-02   +1.817614097970693e-01   +4.569893500905402e-01   +2.096267287888817e-01   +4.292636403380976e-01   +6.750415208754437e-01; +6.461445725300479e-01   +2.024460958124250e-02   +5.927503603145428e-01   +4.088067838583272e-01   +2.734322342100770e-01   +7.203760980301404e-01   +4.551123504106412e-01   +7.260505064998877e-01   +3.830923614862505e-02   +4.996143093274071e-01   +3.312060268523698e-01   +2.461126290760184e-01; +6.197283029213648e-01   +2.847970500035399e-01   -2.505018856677511e-01   +5.765995145179261e-01   -4.712754018328985e-02   +5.842190759713107e-01   +7.814534889126510e-01   +9.998051816211689e-04   +4.909796640898362e-02   +7.395494456951441e-01   +2.078781139076299e-01   +4.773908267915448e-01; +1.630430164630894e-01   +4.230771421620686e-01   +1.137065524330858e-01   -2.397897841914695e-01   +9.511782011304538e-01   -1.738531278362964e-01   +3.032562975842012e-01   +6.318604260736947e-01   +1.489499592600195e-01   +5.479645869443968e-01   +2.828041134680621e-01   +7.277555377575986e-01; +3.878339761010058e-01   +6.161237885053199e-02   +4.852912506717137e-02   +1.224054388715357e-01   +6.071414240153273e-01   -2.770013429997963e-01   +4.903059751674657e-01   +1.553283668051010e-01   +1.490846313813809e-01   +3.639147514438548e-01   +6.638464246734471e-01   +5.840116861677985e-03];
L3I_L2I_iGABA_netcon = [+5.230047139951721e-01   +3.544149808483933e-01   +6.240433180639339e-01   +1.300991522488571e-01   +2.160528152389213e-01   +5.863161423492891e-01   +5.055956673703332e-01   -1.957964913485758e-02   +1.155747133345066e-01   +4.828396443216102e-01   +5.027191544156592e-01   +6.206961885110894e-01; +3.119633077364753e-01   -2.578353082884635e-01   -1.632454224833809e-01   +7.229867133154453e-01   +2.610603165018280e-01   +6.067111370473264e-01   +3.219099446156187e-01   +1.859645322733857e-01   +7.950660134584064e-01   +2.041011421369560e-01   +7.566948432442172e-01   +4.036399262101593e-01; -1.774567238892829e-02   +6.286525408601410e-01   +7.400627134071748e-01   +4.634446459050244e-01   -4.539910888789670e-02   +3.810136054743740e-01   +1.545576467358103e-01   +6.900208309112590e-01   +4.411363616958089e-01   +4.079111881605462e-01   +6.425399734186414e-01   +5.477859565987240e-01; -2.696550572156247e-01   +1.573419163300037e-01   +7.941547591838093e-01   +3.645264882384305e-01   +4.668192416873236e-01   +5.147364572813331e-01   +9.111940864374038e-02   +3.101174500670993e-01   -1.663646901296832e-01   +2.575518741123118e-01   +1.751863888996991e-01   +4.900538790956843e-02; +1.357011067679673e-01   +2.694040455310651e-01   +6.625885339158057e-02   +1.140255881028669e-01   +3.404739197546098e-01   +4.145774296637657e-01   +4.551526968152691e-02   +1.597200262689702e-01   +1.360204581225813e-01   +4.816378865663108e-01   +6.730891653468055e-01   +5.282271701280767e-01; +4.017568682850828e-02   +5.573399585401220e-01   +1.489673838915065e-02   +4.872181300341329e-01   +6.330948302676884e-02   +2.327453822017858e-01   -1.752901000430555e-01   +1.171251255712053e-01   -1.583788859815991e-01   +8.676687814659615e-01   +6.652263059600105e-01   +5.543310335332315e-01; +6.146279501573694e-01   +4.279206147661439e-01   +5.804899414509055e-01   +5.295056453116783e-01   +3.485409065167890e-01   +2.949323172085494e-01   +4.225374102477023e-01   +9.865081244995982e-02   +2.329290894677905e-01   +7.615915900017035e-01   +1.265822670652691e-03   +3.528455685701809e-01; +4.331123504501136e-01   +6.209156562464567e-01   +3.210901714842646e-01   +4.478137232247532e-02   +4.438055942227961e-01   -2.664220111355342e-01   +9.427015577415747e-01   +5.926157482922474e-01   +8.593805349628950e-01   +5.540768775206715e-01   +2.855536813604598e-01   +6.438372602338389e-01];
L2E_L3E_iAMPA_netcon = [-4.260926720650327e-02   +2.264703583349740e-01   +1.490852708176238e-01   +5.625422073372737e-01   +3.902094576302151e-01   +1.039956465393819e-01   +1.165112378768712e-02   -4.450504806372461e-02; +4.352318603286502e-01   +5.222707059109796e-01   +6.713606719229992e-02   +5.668545113159438e-01   +1.340897095116257e-01   +4.403770151818879e-01   +1.240041245803706e-01   +6.155738437962333e-01; +4.785031256851523e-01   +3.967778453049025e-01   +1.696887870999008e-02   -2.802393562792124e-02   +6.273136733751056e-01   +1.625780924759174e-02   +1.922198214418177e-01   +2.288902010920337e-01; +2.545777421898943e-01   +5.716144210962042e-01   +4.445369263416632e-01   +2.708176873943306e-01   +6.340444229225439e-01   +3.615237298800442e-01   +1.170756582965998e-01   +4.847600177438636e-01; +8.773791732037084e-02   +1.090850923913725e-02   +4.539407206900972e-01   +4.335159990553573e-01   +3.353229837388911e-01   -1.416149243710455e-02   +4.958260088500263e-01   +1.161952570688258e-01; +5.112674174164116e-01   +5.223049317583690e-01   +1.592314104911406e-01   +6.512206136435728e-01   +1.207472942721900e-01   +3.021501860278247e-01   +4.534160780681919e-01   +4.737248552547745e-01; -1.512965632361721e-01   +3.712728351110063e-01   +4.036320246187697e-01   +3.653788160850020e-01   -4.838694414144171e-02   -7.140027358218462e-04   +7.218910212220837e-01   +2.255691106531124e-01; +9.559877607979181e-02   +6.866460446447870e-01   +3.819321840097675e-01   +3.282454224539070e-01   +3.177800239739637e-01   +5.347670103030361e-01   +5.378242567020937e-01   +1.092509760179812e-01; +7.954756608785755e-01   +5.926689537933307e-01   +3.456932396490008e-01   +7.345042666363677e-01   +9.335326060732028e-02   +3.127872534266188e-01   +3.473614048030148e-01   +9.798981459602532e-01; +1.873946069994003e-01   +4.163957410971433e-02   +3.254642830324448e-01   +5.439116130250233e-01   +3.242526129383927e-01   +1.640022700209680e-01   +6.362109019960108e-01   -3.560877494866398e-01; +1.720043464783448e-01   +2.057926513295384e-01   -1.304872531870207e-01   -5.824587615882295e-02   +2.715200088531443e-01   +3.125618953444419e-02   +1.242019813720932e-01   +7.423592192045203e-01; +2.758054420301837e-01   +1.567942794911100e-01   +5.319368306932717e-01   +4.080049637759057e-01   +6.113427830533174e-01   +6.032456721144731e-02   +5.548438492271733e-02   +2.970800962675221e-01];
L2I_L3I_iGABA_netcon = [+2.612544835676537e-01   +2.611772686087526e-01   +3.381714258606154e-02   +9.178261171741403e-01   +1.750300393997357e-01   +4.470273179804193e-03   +3.792690658773762e-01   +3.369515301617454e-01; +3.275716327880079e-01   +9.584107378016632e-02   +8.717657354456652e-02   +1.761942539049566e-01   +1.555570251673577e-01   +2.724233807724887e-01   +1.000000000000000e+00   +1.605834853364716e-01; +3.909406793574780e-02   +2.504131266370248e-01   -1.253351411470421e-01   +5.166258176190298e-01   +2.143818061929784e-01   +2.002348890024849e-02   +7.118511183476631e-02   +3.717333741415887e-01; +1.260099897180101e-01   -3.179908491645537e-01   +3.030504011837727e-01   +4.973978038864160e-01   +6.148029543320368e-01   +1.552341276967268e-01   +4.761392696322448e-01   +1.761825074219553e-01; +2.493732635007081e-01   +5.363880995951781e-01   +3.341277172581267e-01   +8.746958752923543e-02   +3.105129104791525e-01   +2.607216921134037e-01   +1.869659736744229e-01   +4.599248348406608e-01; +7.276100610170540e-02   +3.183382765764288e-01   -8.526198250846401e-02   +5.941687969320553e-01   +3.254538856626071e-01   +6.588711090413778e-01   +1.306113718460565e-01   +4.342550668153151e-01; +4.504264007916446e-01   +3.711530709082432e-01   +2.718145893391792e-01   +4.399558295348087e-01   +4.460915490667131e-01   -1.211086619951166e-01   -3.439914267758437e-03   +2.317279707257426e-01; +4.475784105279234e-01   +5.469762620772520e-01   +6.285876228068012e-01   +2.720143779572629e-01   -4.505657672091146e-02   +4.709516466263773e-01   +1.836244160966322e-01   -1.324816808930573e-01; -4.761970733733321e-02   +1.169757298836665e-01   +2.354587825924032e-01   +3.106836866489999e-01   +4.290423605821559e-01   +4.379425074833490e-01   +4.920014462886537e-01   +2.859164162652673e-01; +5.097850533021473e-01   +1.182866140049398e-02   +3.880875791140412e-01   +4.229265228251857e-01   +3.873661792116193e-01   -4.249433181897351e-02   -9.504505816885016e-02   -6.233496330933183e-03; +3.066555321528443e-01   +6.934233068986495e-01   +3.176977960631813e-01   +4.928424600110274e-01   +1.308905134624092e-01   +7.161540300188421e-02   +3.610047645596443e-01   +1.221970608271274e-01; -7.278601788734304e-03   +1.958976964684246e-01   +1.018859441949824e-01   +2.200710985978668e-01   +6.276267696671476e-01   +5.083284799618043e-01   +5.791254446906373e-01   +1.723871611201308e-01];
L3I_L3E_iAMPA_netcon = [+1.334175146855251e-01   +6.968645759387848e-01   -2.380613395767716e-01   +4.697955812891528e-01   +9.234891388194471e-01   +2.199809553486699e-01   +4.244938553516742e-01   +5.841478577684329e-01   +1.620967133738739e-01   +1.285063901461129e-01   +2.879458902636343e-01   +3.616446839478663e-01; +6.673628917432628e-01   +9.820918105896658e-01   +3.331348650500411e-01   +3.033315884700182e-01   -1.098638961941630e-01   +6.113184275849164e-01   +5.182481082033950e-01   +9.493249939729346e-01   +3.760734993395404e-02   +8.796264620785573e-01   +4.483264493778391e-01   +5.377975008427842e-01; +3.926368501243493e-01   +4.422928777796038e-01   +1.145124646205898e-01   -2.364751558617494e-01   +8.874291813401654e-01   +5.604007965121646e-01   +3.572016301089267e-01   +7.395704458978212e-01   +2.904520315306220e-01   +3.769020230163135e-01   +8.105008452516121e-01   +4.774574990812406e-01; +8.316257316383147e-01   +4.571279608450481e-01   +3.960808918147572e-01   +9.330173608005745e-01   +7.677670379653242e-01   +8.129302862208028e-01   +7.460177025245741e-01   +6.516562034531105e-01   +1.998841028324884e-02   +7.008411519126813e-01   +3.454796995652271e-01   +7.818312009002023e-01; +1.512508778471118e-01   +2.379576464202520e-01   +4.001825373125495e-01   -1.052785105697683e-01   +5.651752748096494e-01   +9.814976910386101e-01   +1.047544278848455e-01   +7.837004390766381e-01   +9.863002528816128e-01   +1.397152006617800e-01   +8.297089731415875e-01   -2.522364619658654e-01; +5.437299413142941e-02   +7.988109779896587e-01   +3.057336699421863e-01   +3.099473947991127e-01   +3.472841125903016e-01   -7.722116599901251e-04   +5.010750757976302e-01   -9.113340780666251e-02   +3.900990983512905e-01   +3.872472347990469e-01   +4.124668896026535e-01   +3.091023453854977e-01; +1.230110464522492e-02   +2.569490450091306e-01   +2.330513807414915e-01   +2.760101481749305e-01   +8.691300140633050e-01   +4.728658199019321e-01   +4.164132629836615e-01   +5.628187647092081e-01   +1.570949135088913e-01   +5.540133400526014e-01   +1.059909467586986e-01   +2.647158927631049e-01; +3.256526768805503e-01   +3.006924860111612e-03   +3.037581292935328e-01   +1.982561704993664e-01   +2.215485325027801e-01   -9.626212604240378e-02   +1.676888534319046e-01   +2.102481599853851e-01   -8.913578264750738e-02   +8.475036366367462e-01   +4.068692805521276e-01   +2.485111106559799e-01; +1.999086713704631e-01   +4.566619619252441e-01   +4.061072652793286e-01   +1.637935643915227e-01   +3.354044635977422e-01   +1.784692726774406e-01   +4.429551195895129e-01   +1.817207433294448e-01   +5.621949363044011e-01   -1.682049118316109e-01   +4.891626152628661e-01   +3.923141003201021e-01; +6.616000595042479e-01   +7.210279857441541e-01   +3.511744666983643e-01   +4.617945494969939e-01   -1.308909424512719e-01   +5.959223170280230e-01   +5.813043865046508e-01   +6.556658976647761e-01   +5.669481005136077e-01   -1.833837418135481e-01   +7.185893761089218e-01   +2.007630415591314e-01; -2.240861190298535e-02   +1.554848583161592e-01   +2.970469124915116e-01   +3.952909246542441e-01   +1.332027875308386e-01   +2.766863024355111e-01   +1.457387144665540e-01   +6.073086184435589e-01   +8.381182224014754e-01   +6.362687078797643e-01   +3.538223200610369e-01   +5.519657327499102e-01; -1.058288031024036e-02   +5.682091594289636e-01   +1.824007900581736e-01   +7.090011935414736e-01   +9.006894531672485e-01   +1.720981613396507e-01   +2.223252222193272e-01   +4.914112369105910e-01   +5.028977072428588e-01   +2.058524448031938e-01   +2.812435781346514e-01   +2.502522667231171e-01];
L3E_L3I_iGABA_netcon = [+6.606756472619689e-01   +1.290917974414084e-01   +1.977908904704864e-01   +5.327808459547889e-01   +4.858716850298654e-01   +9.353020519788265e-01   +6.584478953700910e-01   +8.231820059991929e-01   +5.790866821335218e-01   +2.426373884294676e-01   +3.311006398107278e-01   +5.179474042701674e-01; +3.534332718152240e-01   +1.622137807327721e-01   +7.116136833242919e-01   +7.751264737720417e-02   +3.660212621018288e-01   +8.195436905469820e-01   +9.449347742502844e-01   +1.588972484041102e-01   +1.519115217393531e-01   +3.259157160865485e-01   +4.294513565819097e-02   +5.309887352282863e-01; -3.271478792095901e-02   -6.227514100583930e-04   -3.900359966675923e-01   +5.584737632599993e-01   -1.087294805823799e-02   +4.742997279113253e-01   +4.251829116079887e-01   +6.071781591162244e-01   +5.757718752205946e-01   +5.321243827117188e-01   +4.618766430633846e-01   +3.061400158081000e-01; +3.757570311460700e-01   +6.418419957428118e-01   +4.706271020547945e-01   +2.436879581373912e-01   +5.631985215184405e-01   +4.285786656768428e-02   +4.586513066493667e-01   +2.624455188226869e-01   +5.062605644253413e-01   +1.464713054950607e-01   +5.859349825543045e-01   +2.180591277762706e-01; +2.317452477753564e-02   -2.281404896314163e-01   +4.120540453625035e-01   +5.316892982301646e-01   +2.129788670961757e-01   -6.128372982291824e-03   +4.450357455798281e-01   +3.778602113836080e-01   +2.550732629982528e-01   +1.969408264501850e-01   +4.323623272547305e-01   +5.760658046836355e-02; -2.004503635200194e-01   +5.455917836827907e-02   +6.985353569921362e-01   +5.801354129658969e-01   +4.383085718437691e-01   +9.473140909129038e-02   +3.413720133826299e-02   +2.056407163184684e-01   +4.126582893230323e-01   +3.597932986234428e-01   +4.691037913796897e-01   -1.667476286360835e-01; +6.330366068719999e-01   +2.275106966670605e-01   +4.276205035879047e-01   +7.501311043686278e-02   +5.808097711909530e-01   +3.646785652228032e-01   -1.329453727039986e-01   +6.761971822843436e-01   +4.085094989979714e-01   +3.896026816565570e-01   +4.246840422302298e-01   +1.885573749285560e-01; +2.525128666988912e-01   +4.844584261989898e-02   +1.381201098501640e-01   +5.522726540207773e-01   +6.031489497537930e-01   +3.011121183001422e-01   +3.942826873586618e-01   +6.671349110469095e-02   +4.741740489884734e-01   +1.757876119903522e-01   +5.099927197271811e-01   +6.734578702138823e-01; +2.023743797524153e-01   +2.613890585802692e-01   +4.758369427980431e-01   +6.674772907001442e-01   +4.595015649938573e-01   -2.910350450067359e-01   +5.351157626965785e-01   +4.517804267110541e-01   +2.218348110388001e-01   +1.735711739504833e-02   +5.841252755688925e-01   +7.219625807386549e-01; +3.033542442868901e-01   +6.708967191814045e-01   +8.028275516974884e-01   +9.518238744812990e-01   +4.795677940905178e-01   +2.817551186705860e-01   +7.931536173502413e-01   -3.011087573079720e-01   +7.895339945097162e-01   +4.892315900548896e-01   +1.421592513846677e-01   +1.283344591770362e-01; +2.514992625164531e-01   +3.891773779124871e-01   +1.117811673795845e-01   +6.845567044345932e-01   +5.229580569196071e-01   +2.484541967793658e-01   +6.252377543702121e-01   +5.889796509899637e-01   +7.067338163475052e-01   +7.062294669729335e-02   +3.042565833836530e-01   +7.645937178424312e-01; +7.308869178720456e-01   +1.669402220631176e-01   +4.008593249817203e-01   +4.465309266455449e-01   +3.270610918134922e-01   +3.588772545070233e-01   +4.316709889554831e-01   +3.064535208411719e-01   +3.360187540452732e-01   +2.093857063518552e-01   -2.677168984801802e-01   +3.363439837294240e-01];
L2E_Input1_iAMPA_netcon = [+4.502277599928549e-01   +6.346626979551312e-01   +4.740604034994049e-01   +6.545056957372396e-01   +9.347853353308828e-01   +6.302094397330117e-01   +1.000000000000000e+00   +4.887464205181067e-01];
L2I_Input2_iAMPA_netcon = [+9.851743778784278e-01   +5.599796851352001e-01   +6.316479192088129e-01   +6.066173708349434e-01   +4.731957285550202e-01   +9.401182163287457e-01   +1.780641829206383e-01   +6.583018433659310e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
