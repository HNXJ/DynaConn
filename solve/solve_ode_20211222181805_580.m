function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.105643962658104e-01   +4.728990750074540e-01   -1.179051593590139e-01   +3.415948055484147e-01   -2.250368374433242e-01   +9.676249643850675e-01   +2.430196880731962e-01   -4.734632144817003e-01   -2.120655151721310e-01   +3.246207643742879e-01   -4.417298444239178e-01   +8.408146874955338e-02   -8.727616228758132e-02   -3.047586492015839e-01   +6.760530925195367e-02   +3.485614764441110e-01; +8.679626321723765e-01   -2.652739489668424e-01   -2.532891290589676e-01   -3.948577833033749e-01   -3.015632146412880e-02   +2.779729249079264e-03   +3.046484522315993e-01   -2.047480755057010e-01   +6.718345432667189e-01   +1.344110085359580e-01   -2.515419988656359e-01   -1.795682944993013e-01   -7.762092693172783e-02   -7.280648027459778e-01   +5.163658066803561e-01   -1.787097049313642e-02; -4.846383390107362e-01   +1.306407642802678e-01   -4.764702593894702e-01   +2.710329590359430e-01   -2.695713268111148e-01   -3.428784769517533e-01   -4.295109766554351e-01   +2.963993965602421e-01   +7.660855130308816e-02   +5.824538216072542e-01   -2.526720312089893e-01   +7.407329216076015e-02   -1.051349070960837e-01   -4.827784467861759e-02   -1.503358994855185e-01   -4.707795717320687e-01; -2.887679321213852e-02   +5.135731672316144e-01   -1.788105924852008e-01   -2.592131788927814e-01   -3.395397493162887e-01   +5.308161846197133e-02   +3.663721741200024e-01   -6.851509429525012e-01   -3.052952068560824e-01   -4.809780847094660e-01   +3.363894569484305e-01   +1.218887851315789e-01   -7.457299007514998e-01   +5.042452400437500e-02   +4.749735494472352e-01   +9.360215376512290e-02; +4.349266935165096e-01   -5.183549454483339e-02   -5.327242377804651e-01   -1.399121348193882e-01   -5.730747019518716e-01   -1.710036112187303e-01   +6.774961245326419e-01   +1.080699820170615e-01   -1.218207922961218e-01   +3.067728496860005e-01   +3.131576697713507e-01   -2.591106194657677e-01   -2.944130547887462e-01   -2.818444561226233e-01   +6.207209922350401e-02   -2.779360733140230e-02; -4.929517773495031e-01   -1.000000000000000e+00   +7.775577031732744e-03   -7.791202962188134e-03   -2.556747672276762e-01   +1.687403704215166e-01   -4.869158274260396e-01   +7.174809736318207e-01   -2.944930008617562e-01   +6.150991694246469e-02   +3.530750785457492e-01   +3.861603658411875e-01   -3.578266045238623e-02   -3.260161170448333e-01   +1.241568504688603e-01   +1.124120065762815e-01; -3.313398249504214e-01   -5.961066232443770e-02   +5.921359940800931e-01   +2.696069318941604e-01   +3.378636846961399e-01   +5.349614996835774e-01   -4.868694585470186e-01   -2.024351948511779e-01   +4.116011842728769e-01   +1.287741890970409e-01   +2.674257574555599e-02   +2.232373480897149e-01   -3.000778212751717e-01   +6.695625183868181e-02   +5.335168128834004e-03   -1.485605649471351e-01; -8.871840330988465e-02   +8.337062542265994e-02   +1.937264029786027e-01   +1.050882493619122e-02   +1.085198532059403e-01   -3.032446438005641e-01   -3.127439384708236e-02   -4.239106684660518e-02   -1.419511319676558e-01   +2.221621731273830e-01   -6.953449224930677e-01   -1.302714919767763e-01   -3.921411947445317e-01   +2.803561584525108e-01   +5.163532886967320e-01   +5.372893654413952e-02; -6.555393102322167e-01   +2.888235698195276e-01   -4.295208149791733e-01   -2.870783701915547e-01   -4.234893776756643e-01   -6.211186061441889e-01   +3.299871432608643e-01   -3.646288519653724e-01   +3.059966408717164e-01   +2.266593704405061e-01   -3.245191517178546e-01   -6.906213144179095e-01   +7.991075614834504e-02   +1.494369078599726e-01   -4.703417975970201e-02   -1.954316103267284e-01; -4.301443644909559e-01   -1.244447991357485e-02   -6.625955001524814e-01   -4.313202192176459e-02   -4.730905643474032e-01   -3.382887957277646e-01   -1.178281318948408e-01   -3.432830865996310e-01   -1.907385181594372e-01   +2.846401963907904e-02   +1.917486695831543e-01   -5.769238385776793e-02   +6.066550206938692e-01   -5.362494258225340e-02   +1.738053059083439e-01   -2.419946725956499e-01; -2.618969438891035e-01   +4.148309792901755e-01   -4.869523341714477e-01   -2.633321619113473e-01   -1.067877613442587e-01   +2.301344897119643e-01   -9.431960092327224e-02   +5.980116475896461e-02   +3.382071136752562e-01   -5.138853349691311e-01   -1.179517997150690e-01   -3.649363160635000e-01   -2.324454924118448e-01   +4.272271655654838e-01   +1.612773121146411e-01   +4.291060010920846e-01; -4.560915488675610e-01   -5.058166835412164e-01   +8.261499175742053e-03   -8.319152321387266e-01   -3.975247900380028e-01   -4.517182716865326e-01   -2.651765144825000e-01   +6.154842318748772e-01   +2.488758243762371e-01   +2.784298045709401e-01   -4.419005178576179e-01   +3.178273951650472e-01   -4.227217294468225e-01   -2.035763903476677e-01   +2.157240657571757e-01   -4.571542946074644e-01; +5.636196827882046e-01   +1.669829137561075e-01   +2.729714081837740e-01   +5.876802597267340e-01   +3.566134850425150e-01   +1.674543763264184e-01   +4.543686023704018e-01   +5.678475657704499e-01   -2.971573666072063e-01   +4.846478310916492e-01   -2.825912231218626e-01   -4.339603214050039e-01   -3.576151200361193e-01   -7.680110238198388e-01   +7.459217197131321e-01   -4.018729754388360e-01; +5.998946510636979e-01   +3.144682373161130e-01   +5.022571466016071e-01   +7.583632859131592e-01   -2.622522237742753e-02   +4.928251357390730e-02   -1.420221299879318e-01   -1.338254360194378e-01   +6.237635263919097e-02   +2.141721949645327e-01   -1.395103480659894e-01   -6.409412416765996e-01   +1.762038083800886e-01   +9.413328112489439e-02   -3.892572140957435e-02   -1.120006795161357e-01; +2.380472970373708e-01   +5.079627487030133e-01   +2.185511163090391e-01   -4.254887623616160e-01   +1.467453459427526e-02   -6.032528731972816e-01   -2.452086327090485e-01   +2.170320434453363e-01   -4.253994800414197e-01   -4.846892966710412e-02   -7.303988636187771e-01   -6.089022347776020e-02   +1.717018697020281e-01   -4.879819848405070e-01   +2.080843308293910e-01   +1.894777904815780e-01; +6.104931973570461e-01   -3.979719235512952e-02   +5.632665304208586e-01   +1.895996170211110e-02   -7.611696692614127e-01   -3.329027493001251e-01   +1.530501419756400e-01   +3.019528443054116e-01   -1.733221760421055e-01   +2.940290289706613e-01   +2.608030650869347e-01   -1.968665606341365e-01   +1.339069294945593e-01   +8.162406326658997e-04   -6.184116557163912e-01   +4.119967650243930e-01];
L1E_L1I_iGABA_netcon = [+7.741342140747353e-01   -6.095589361425493e-01   +5.320449193798352e-01   +2.465289886673831e-01   -2.578831934270231e-01   -4.999450088166726e-01   +4.819200267328807e-01   -3.810116849623479e-01   -3.538390385147192e-01   -3.579815691634188e-01   +3.016902446771018e-01   +2.066407056702448e-01   -2.631142236857215e-01   -1.628532766353620e-01   -3.546622414159166e-01   -1.559048352094645e-01; +2.320314149611329e-01   -2.302651411782320e-01   +1.293417670169804e-01   -2.257278680160732e-01   -3.802268569289760e-01   -3.496742841510021e-01   -5.220745077912924e-01   +1.793879779840214e-01   +7.522143256131584e-01   +5.064112824101034e-01   +2.509587604419283e-02   +4.694569048953760e-01   -2.107009319519710e-01   +1.303772797671692e-01   -3.503564925302678e-02   +1.443467031300076e-01; -2.207075970492436e-01   +7.815315230247667e-01   +8.352881884492291e-01   +4.202035804017292e-01   +2.465490983596264e-01   +3.543441876213450e-02   +6.071159497958453e-02   +7.476549904552129e-02   +1.897895787741637e-01   +9.918029737393957e-02   +3.994892983184454e-01   -1.717826059885606e-02   -3.668481669471023e-01   +9.226090467936182e-02   +1.729205179325569e-01   -4.009969607343460e-02; -7.163613570797160e-02   +3.229893249232913e-01   +1.426823436026609e-01   +4.849154657895087e-02   +1.805319172096932e-01   +5.894048179509345e-01   -2.905407981535161e-01   +2.073681213632770e-02   +4.382168749860715e-01   -5.693183809738112e-02   +1.000000000000000e+00   -6.234237904760308e-01   +3.125575186039359e-01   -9.094762028629286e-02   -4.506994118072179e-01   -5.450534505278100e-01; -5.749871041867811e-01   +8.262338877821516e-04   +3.512001909297799e-01   +3.202773033699349e-01   +7.981887115358045e-02   -3.431596860213957e-01   +2.004919416908700e-01   +6.037507158478826e-01   +6.517925824428279e-02   -5.093977109267310e-01   -1.206888087862979e-01   +9.323110655083761e-02   +1.221011079265350e-01   +5.560745024406921e-01   +6.043489306644885e-01   -1.299083384939387e-01; +8.615447873548472e-02   -4.074607188749975e-01   +1.939034706234528e-01   -1.927826648588391e-01   -4.211173483086287e-01   +7.278770044196429e-01   -6.890944013047885e-01   +1.411458348786863e-01   +2.399718876070843e-01   +2.636331188128705e-01   +4.917926996899424e-01   +2.301898394303787e-01   -1.871484908352283e-01   +5.432986501770651e-01   -2.638903107585131e-01   +5.682180646812954e-01; -3.887772747121442e-01   +1.924947630938286e-01   -5.222003551923979e-01   +1.672559806091534e-01   -3.014503870367388e-02   +3.657928745155448e-01   -1.095557165923479e-02   -3.276658922045175e-01   +5.058359644802279e-02   -4.607789495712005e-01   -3.207797146136080e-01   -6.270879589966150e-02   -2.606486554352507e-01   +2.037330332298399e-02   +8.421138934125602e-02   -3.504348076757644e-01; +8.777025301861206e-02   +5.006847338348330e-03   +4.910228292473442e-01   +7.304582246585467e-02   +2.555021292738783e-01   -4.067709066670632e-01   -4.953021481828146e-01   +1.901709724985067e-01   +2.538748548862015e-01   +1.801028452509646e-01   +8.077977658519915e-02   -2.000462334724477e-03   -3.348691251353748e-01   -4.277180785688595e-01   +2.433211661524469e-01   -2.033533653001407e-02; -2.446041751399923e-01   +1.912523347313447e-01   -8.801741006386993e-02   +1.834228133799223e-01   -1.357065668719403e-01   -4.440184969167883e-01   -4.818424506637888e-01   +2.683537620464401e-02   -2.059417056850077e-01   -7.066128509245910e-01   -3.979150202903981e-01   +2.279388622349822e-02   +5.086067887033687e-03   +1.737712930958615e-01   +5.927445496270929e-01   +3.140594759576611e-01; -1.405666621343686e-02   +2.975908116415560e-01   +3.349024333033643e-01   +3.327851400208481e-01   -6.692372609723002e-02   -5.991295176792417e-01   -8.001023074017312e-01   -3.159090216850929e-01   +2.011598936156380e-02   +3.841485080612698e-01   -4.342221038977276e-01   -2.167166104254642e-01   +5.391452105938084e-01   -1.189969483516907e-01   +2.590873575762064e-01   +8.153084190791733e-02; -2.206479721596599e-01   +3.130473351058041e-01   -8.063598848213338e-02   +1.568025337980258e-01   -1.066522497112746e-01   -1.116216333735186e-01   -4.805037611880340e-01   -3.716127494581895e-02   +1.736410015300049e-01   -1.958134531286388e-01   +7.769380652385920e-02   -1.522053079051012e-01   +6.256161195414168e-01   +2.237409816092482e-01   +3.521323173737224e-01   +3.582096610480912e-01; +2.089983292531912e-01   +1.742239606943954e-01   -2.291925047442514e-01   +2.432635189904380e-01   +2.569991095289993e-01   -3.433650431126819e-02   +5.556233903946802e-01   -2.695485536082612e-01   -2.027712961904888e-01   +2.046387954723064e-01   -5.357453399192100e-01   +6.416866373393646e-01   +1.015701991781033e-01   -2.287682754401607e-01   +4.103943271681914e-01   -8.636593807396464e-01; +5.928663663571447e-01   -3.719443773780371e-02   -5.555909044397407e-01   +5.650534536494256e-01   +1.356263682790601e-01   +8.163658910070437e-02   -6.063805370124786e-01   +4.518385332415287e-01   +3.317099191466169e-01   +4.436571767591982e-01   -3.214478164857525e-01   +3.270273355796215e-01   +2.014530085991210e-01   +3.008402301834012e-01   +6.189134135683768e-01   +5.677898858259316e-01; +4.556084554439928e-01   +1.158640782106794e-01   -2.913525788778296e-01   -3.300022072966385e-01   +6.045738762961676e-02   -6.534973173025256e-01   -2.972168607974423e-02   -1.362140679534808e-01   +1.246519358671381e-02   +2.109364947022988e-01   -5.165698207493081e-01   -3.712074909778401e-01   +6.469012551488931e-01   -4.051465434820337e-01   +5.502435032900640e-01   -3.230731686366944e-02; -6.877091114500143e-01   +2.546716336568050e-01   +3.484468368026034e-02   -2.273391663124445e-03   -1.441079379474537e-01   -3.812283616312902e-01   +4.806864976350927e-01   -4.965766325962716e-02   +2.329326052330066e-01   -1.418848338227332e-01   +2.510424405476017e-02   -2.871215563285459e-01   -7.141319074638017e-01   -2.567576052990234e-01   +5.388798188899901e-01   +8.815559706499111e-02; +1.811190461144473e-01   -3.404572601114055e-02   +7.938559527591861e-02   +3.755173286953066e-02   +9.388569958231988e-02   +2.318437236023214e-01   -7.829125016772938e-02   +5.898945225924810e-02   -7.472053239115889e-02   -2.866050016731395e-01   -8.004362169328499e-02   -2.820842543564290e-01   +5.317325594349018e-02   -1.342965669871825e-01   +4.580114570533113e-01   +2.095609147855595e-01];
L2I_L1I_iGABA_netcon = [-3.864020748250092e-01   -6.166405320462174e-03   +2.641699589579886e-01   -4.267204910148071e-01   +7.918917125682171e-02   -1.892319149667849e-01   -6.204222796672456e-01   +3.393806831728790e-01; +3.493521952240426e-01   +5.034171001279197e-02   -2.145586276049929e-01   -1.142071881588432e-01   +8.040851162237888e-01   -1.788966413342044e-01   +1.000000000000000e+00   +2.689235012508304e-01; +7.664249291032227e-01   -2.445828421820525e-01   -1.214713144802880e-01   -2.220965838748842e-01   +2.674820816091614e-01   +1.440542065660098e-01   -3.604337995272119e-01   +7.194815890106125e-01; -6.742993658371560e-01   +2.163478277931161e-01   +4.067220809252335e-01   -4.233499944671665e-01   -7.838456261645436e-01   -6.055860742418193e-01   +8.048730119206370e-01   +1.236297964799012e-01; -1.994253944771116e-01   +1.226763265387601e-02   +1.701140239725367e-01   -2.352033214272661e-01   -2.887259626333563e-01   +5.853419673388197e-01   +6.522238840172051e-01   -5.082250324115944e-01; +3.679560566604204e-01   -3.686840349871123e-01   -9.470661253523693e-02   -4.976980076063247e-01   -8.901376847219407e-02   -2.555209603969833e-01   -1.725645653836505e-01   -1.550439366578349e-01; +5.779841740405215e-01   -6.539502187484074e-02   -1.870703249429493e-01   +1.534945326625766e-01   +4.553666473920047e-01   -6.648504936005029e-01   +3.108190863009900e-01   +4.511419383215756e-01; -4.646669295579207e-02   -3.819027952244310e-01   -4.357235382307992e-01   -4.956388907925562e-01   +6.777221009207075e-01   +2.619159814816581e-01   +2.947070931934355e-01   -1.755679273175418e-02; -7.744103482168303e-01   +7.772654901814030e-01   -3.061248637303246e-01   +6.662149090825997e-02   -3.315569574213225e-01   +8.168274490772094e-01   -2.785124357293406e-01   -1.403435863680895e-01; +2.005165427401740e-01   +4.621394230708851e-02   -3.459716306214351e-01   -5.751114059443928e-01   +5.381736750954066e-01   +2.020489643186735e-01   -2.662337182171218e-01   +3.832062201584525e-01; -4.858977903972861e-01   +4.456785516750474e-01   -1.120087920400436e-01   -1.748684178378375e-01   -1.661547365314389e-01   +9.931705663894933e-01   -4.341145936021600e-01   -2.422339050513129e-01; +5.451148790904715e-01   +3.782630133362762e-01   -3.887056334337002e-02   +1.371596263633503e-01   -4.600869625456500e-01   -6.506559183848339e-01   +1.451177227998643e-02   -6.137282125837417e-01; +2.219271130659730e-01   -1.636996273893740e-01   +4.750676061035831e-01   -1.002149697160476e-03   +4.318564130285687e-01   -8.123293315996827e-01   -2.638311297381319e-01   +6.723061044658088e-02; +1.353921932257721e-01   -4.633777284500071e-01   -7.958204978836602e-01   +2.043753487882285e-01   +2.371355627794312e-01   +1.958151863658048e-01   +1.009406164097952e-01   -1.300552074012415e-01; +8.199401412058508e-01   -3.446551201415070e-01   +8.613637437469616e-02   +4.059967331189133e-01   +6.290844865364326e-02   +4.613146982542758e-01   +6.131343583641176e-02   -5.600094947053947e-01; -1.894115223876035e-01   -2.865850579001867e-01   +4.476216644230711e-01   -3.868483410170631e-01   +5.848000086377235e-01   -2.887953553009704e-01   +2.297469611715437e-01   +3.406365177277199e-01];
L1I_L2I_iGABA_netcon = [-5.467083769199349e-01   +5.280622785689892e-01   +2.422280696415877e-01   +3.233425554635551e-02   +5.622903525049994e-01   +4.427563194073012e-01   +4.168574847865670e-01   -1.941394642288459e-01   -4.632475376571071e-01   +5.252787636933605e-01   -4.577682917505522e-01   +4.219434876869146e-01   +7.223581802106389e-01   -5.788084420149766e-01   +2.433597631903994e-02   +5.531635123732696e-01; -8.546224561866402e-02   +1.821693578375550e-02   +2.202652764238651e-01   +4.629574718984831e-01   -1.057908804602529e-01   +4.942249534032334e-01   +1.512530202434707e-02   -1.992636880534128e-01   -5.238546732407194e-01   -4.640260450786964e-01   -1.700820931605476e-01   +7.592336554753454e-01   +6.780149171781722e-01   -1.469183315891308e-01   -3.827353308258103e-01   -3.353249931795649e-01; +2.482996457873537e-01   -2.697618925532448e-01   -3.599887260982446e-01   -6.129390110932428e-01   -5.585376839236521e-01   +9.796437370058432e-02   +3.341075347891443e-01   +7.293778489552094e-02   +1.798878814580549e-01   -2.852896899036000e-01   -8.154493845887100e-01   +2.709644648695336e-01   +2.533545039226044e-01   +6.402546991009200e-01   +4.205680746261551e-01   +3.332533092923634e-01; +1.000000000000000e+00   -2.055795333149562e-01   -4.714869528029913e-01   -3.758681476504684e-01   -5.141210714659035e-02   +2.662721222476702e-01   +3.030011078091800e-01   -6.368779436444058e-02   +7.453113034865835e-02   +1.978755993032484e-01   +8.266327550742717e-01   +4.520871306001085e-01   -3.499125838343782e-01   -1.048567348903029e-01   +2.988927717606357e-01   +2.733379062475381e-01; -4.182857104730803e-01   -2.016209463355320e-01   -1.433116040668301e-01   -8.176019316441845e-01   -3.537472416273724e-01   -1.737610090781947e-01   +1.327254990828778e-01   -3.420077075677633e-02   -2.780788096948440e-01   -1.544992187470935e-01   -1.134703722426583e-02   -3.399769926409195e-01   -1.746807456093102e-03   -5.791668975784331e-01   +2.697146017068264e-01   -4.263144489017975e-01; -2.206833905881630e-01   +4.581336686301073e-01   +2.658037446862989e-01   -5.983467685285865e-01   +7.119449221564900e-02   +6.223689226977345e-01   +3.762261008755451e-01   +3.746601134906145e-02   +4.460454185814351e-01   +3.513225634235848e-01   +6.892510235636946e-01   +9.459108850742555e-01   -3.157457688965922e-01   -4.442439201289993e-01   -5.273701379453519e-02   +8.388563962141182e-02; +9.018733772823244e-01   -3.178568092332697e-01   -3.343572852990596e-02   +3.628893182492767e-01   +9.197800652713568e-01   +3.045761846011418e-01   -7.271084496593507e-01   -4.680124648599763e-01   +2.430247658585904e-01   +7.863442065346722e-01   -9.656322941954780e-01   +2.553342132658147e-01   -1.963778306768582e-01   -3.121544408723880e-02   -4.448651935607177e-01   +3.376759480578381e-01; -7.859663669749861e-01   +2.362937237548337e-03   +7.898538401457959e-02   -1.782982022812323e-01   -4.392960842019039e-01   -7.849290721153992e-01   -7.368514891910964e-02   +2.400718213380719e-01   -2.019951222289104e-01   +1.981062073675857e-01   +2.837775494433359e-02   -4.370890772841244e-01   -8.031761677186755e-02   +2.203606589367907e-01   +7.856839464518591e-01   +6.464340924438298e-01];
L2E_L1E_iAMPA_netcon = [-8.984507595903277e-03   +1.314386011571878e-01   -3.541163414179487e-01   -4.240318314312133e-01   -2.291391190235647e-01   -1.166815940247250e-01   -2.031671287526826e-01   +5.497368614241144e-02; +1.976882008661828e-01   +1.115873072910590e-01   +4.082461909692988e-01   -1.879752290579585e-01   +1.023831229138105e-01   -6.529879808255677e-01   +6.162572486725695e-02   -2.058836763798380e-01; +5.043893211814728e-01   -1.175402409756323e-01   -1.052247840387848e-01   +2.195627623910804e-01   +8.847526571629281e-02   +2.731930106334003e-01   -4.580248369708285e-02   -2.350844243997326e-01; -6.141524149444820e-01   +1.959416811632273e-01   +2.038185082534135e-01   -1.690722297180357e-01   +3.913492752012973e-01   +1.279219858374744e-01   +5.218578408190826e-02   +2.231484617701040e-01; -1.187746711528280e-01   -2.803332245163996e-01   -3.863989047678290e-01   +1.000000000000000e+00   -1.133976487062959e-01   -1.100956986600728e-01   -3.734295773060111e-01   -4.728473017061290e-01; +3.101901072788478e-01   -6.845522951304353e-02   -1.610880416022117e-01   +3.625611008503767e-01   -1.987897216262285e-01   +4.581995609245912e-01   +1.566497889770602e-01   +3.176424887671379e-01; +1.607274376114105e-01   +3.697898280342262e-04   -4.733386318471927e-01   -9.249377542730224e-02   -5.703234729961030e-01   +4.351670778003661e-01   -5.935872322509470e-01   -2.072582826595842e-01; +2.760571475548603e-01   +2.973249786135894e-01   -1.051477506236830e-01   +6.687865481020867e-01   +3.278235244912048e-02   -6.548134007878120e-01   +1.931805604313614e-01   +4.642570336893629e-01; -5.689173323675327e-01   +1.121290263088629e-02   +5.223094933179940e-01   +1.860209974909530e-01   +4.251583368881023e-01   -3.479135471149062e-01   -4.633600931131761e-01   +6.258470528062876e-01; -8.893849823894086e-02   -4.777870719109827e-02   +3.300114000392585e-01   +2.267126307803830e-01   -1.626221939859794e-01   -1.600576624624326e-01   +2.349910780993738e-01   +4.115779708852519e-01; +6.948415038743067e-02   -2.022692530714946e-01   -1.301537774875745e-01   -5.785086377897071e-01   +1.920505622848733e-01   -6.176183959489707e-01   +5.102719230391804e-02   -3.980632658457688e-01; -2.820643489106172e-01   +1.099806688066232e-01   -6.707000047908833e-02   +1.490374702050917e-01   +6.289180524855958e-01   -9.968694131208976e-02   -8.693029902028807e-02   -5.641839605067537e-01; -2.617957173369331e-01   -5.948348231701505e-01   -6.480323866912234e-02   -2.921255766158196e-01   -8.242145746611944e-02   -3.673342255763296e-01   +6.190975829085462e-01   -7.770661639894436e-02; +2.527494810463197e-01   +2.993810800776773e-01   -5.286217369908645e-01   +8.284850482675769e-02   +1.131417785839269e-01   -3.088469587479828e-01   +1.517066785407635e-01   -2.112842193734913e-01; +6.719258064506192e-02   -4.445949633778831e-01   +1.653366753322080e-01   +5.427385143177695e-01   +8.604131997919869e-02   -3.260598951190643e-01   +8.942031067436726e-02   +5.539749816225470e-01; -1.874708922111707e-01   +6.473202285553166e-01   -2.703091448194304e-01   -1.342296951670911e-01   -2.061713435187606e-01   -6.191383938613047e-03   -1.969141779119500e-01   -3.406819684391073e-01];
L1E_L2E_iAMPA_netcon = [+2.630102334567497e-01   -6.506186937127809e-01   +2.715351903536532e-01   -8.616861529547154e-02   +5.264959039548802e-01   +2.050884779176134e-01   +4.578062067404453e-01   -3.559652173713013e-01   +1.235746948192750e-01   -3.520360155973691e-01   +2.599531578889582e-01   +8.213386243574175e-02   +1.383346929574253e-01   -5.523631854413339e-01   +3.771982141866817e-01   +2.250010635471978e-01; +1.537976085250841e-02   -3.085762868083448e-01   +2.578189969953408e-01   -2.525869576576826e-01   -7.785121151607633e-03   +7.858774627651954e-01   -2.479894999530810e-01   +7.379670258702307e-02   -1.302070594408510e-01   +5.691967792776418e-01   +1.127840579290345e-01   +1.653873003251111e-01   -1.477093212769996e-01   -4.039635158829544e-02   +5.775482859254990e-01   -1.046496812428476e-01; -1.000000000000000e+00   -3.346084301175250e-02   +6.457268391222024e-01   +1.414431873346974e-01   +3.249198836739364e-01   +1.868930770212443e-01   -2.353460446698334e-02   -4.923045627444114e-01   -3.730483991780718e-01   +4.676941686104005e-02   -3.442586665662032e-01   -9.082810106464180e-02   -7.061901265984601e-01   -4.986039585079168e-01   +1.345672828409603e-01   +2.759280877346992e-01; +8.329104916414509e-02   -2.281505243647831e-01   -7.041576865050715e-02   +3.374499613732675e-02   +8.168088257037738e-01   +2.440339609970291e-01   +1.539115291865884e-01   +2.939802172934815e-01   -2.889780886315451e-02   +1.704315615572010e-01   -3.674197654992353e-01   -2.769025922223316e-01   +4.068007382251089e-01   -5.167368883807083e-01   +4.008614609134147e-01   -3.563726728863717e-01; +5.659547411907102e-01   +3.831398184726109e-01   +1.850246384777626e-01   -1.538775605684526e-01   -2.338365718868909e-02   +2.912590748793934e-01   +4.330828592468977e-01   -3.996257086168123e-02   +7.976229943597515e-02   -5.170468134109710e-01   -2.191711169934945e-01   +6.698731862959058e-02   -9.579991054159173e-02   +2.933396689909302e-01   +3.605574442595966e-01   -1.068566678716158e-01; +5.081804039643325e-01   -2.350209872654632e-01   -4.603995391262692e-01   +4.103902260197336e-01   -3.683469745115582e-01   +3.583747401905811e-01   -1.699953274639781e-01   -4.483306812490174e-01   -3.069211420610620e-01   +6.472568212554014e-02   -1.614043605932965e-01   -9.907331771631675e-02   +3.760086720278915e-01   -3.851374236599063e-01   +1.981386575662811e-01   +5.079764622128784e-01; -3.736184335743332e-01   -4.871052053912373e-01   +7.040383747462683e-02   -4.748105999192118e-01   +9.427682905516993e-02   -1.133477230359172e-01   -2.853100358589823e-01   -2.477588375162265e-01   +2.352136583733540e-01   +3.182176129434516e-01   -1.568537120640780e-01   -8.845533867766128e-02   +2.989971753102814e-01   +3.266769357985257e-01   -1.882977672778766e-01   +6.290999056759938e-01; -1.561070299543299e-01   +1.415426688169004e-01   -5.224176593690970e-01   +3.334949489346600e-02   -2.407522596727008e-01   +3.514017035884584e-02   -3.324481662904023e-01   +3.272601772546192e-01   -7.246745511821385e-01   +6.325124123733650e-02   +8.335322469668655e-02   -2.457112051357145e-01   +2.550524259913816e-01   -1.765189717993353e-01   +3.116920812579876e-01   -1.276802622506314e-01];
L2I_L2E_iAMPA_netcon = [+5.255540404229582e-01   +2.581207619116164e-01   -4.377796942991541e-01   +1.406509956200202e-01   -5.236014767198166e-01   -5.643231135360376e-02   -8.330903517635728e-02   -3.368955677425918e-01; -3.320633486001274e-01   +2.012687101224916e-02   -2.732039958731422e-01   +1.587492495707594e-02   +6.963881239263989e-01   -6.268169978647765e-01   +3.646793523910797e-01   +1.116561450635231e-01; +1.864797892248291e-01   +2.864336892788995e-01   -1.844196883932629e-01   +1.565445182651962e-01   -2.763502191910505e-01   -4.688362951243022e-01   +3.802228814849246e-01   +6.283973687695321e-03; -7.426633551018191e-02   +9.019908824984488e-02   +1.000000000000000e+00   -1.267822323512394e-02   +3.097371047382549e-01   +2.437026792967190e-01   +3.204728952957780e-01   -3.350319205300396e-01; -3.392131759529418e-01   +6.868305279637983e-02   -2.806176776605802e-01   +2.653868842488044e-01   -3.599595159082463e-01   -3.122674283118668e-01   -4.147361378383911e-01   -1.046649152580124e-01; +3.868062813216859e-01   +1.477447112667277e-01   +2.468156514209836e-01   +1.591091707362889e-01   +1.342762847322071e-01   -3.609949395527934e-02   -3.168656563334149e-01   +5.604146786056828e-01; +3.903543692411323e-01   +1.876739426615682e-01   +2.298710620804865e-01   +9.891857331213164e-02   +7.075250291616951e-02   -8.858325420980306e-02   -2.746009963583115e-02   -2.326842511576434e-01; +9.070542449752134e-02   -7.714079007122598e-01   +2.748262554414419e-01   -9.668750140608498e-02   +6.222716370438236e-01   -6.830263335852872e-01   +3.330494836569772e-01   +6.652820963978981e-01];
L2E_L2I_iGABA_netcon = [+6.848157689122488e-01   +2.417121022715966e-01   -3.755655364165363e-01   -5.780776765542138e-01   -2.814616463817584e-01   -3.795760077538281e-01   +6.048791910471165e-01   +1.870537901283337e-01; -4.862050779790859e-02   -3.625001388001777e-03   -1.416924646017277e-02   -2.340911337327466e-01   -1.593885158369069e-01   +5.417724274179178e-01   -9.980158482571552e-02   +2.580628207316435e-01; -5.022094398162814e-01   -2.249640802989094e-01   -1.873326972911563e-01   +4.058050897913287e-01   +3.555743213413524e-01   -2.706038316314084e-01   +4.434381792445269e-01   -6.034817738278341e-01; +6.461331903651248e-04   +3.423579909389142e-03   -7.012608409953427e-01   +2.453465054847544e-01   +6.437190993589813e-01   -2.707332838299132e-01   -2.418674751067479e-01   -2.478195555299172e-01; +4.572201474885402e-01   -7.964370482606244e-02   -3.267096330141893e-01   +9.429030035246259e-02   +5.503453125687713e-02   +7.452324307889578e-01   +2.310276403598598e-01   -1.361041187227267e-01; -8.288474608673382e-01   +4.410073735168398e-01   +4.737974945460799e-01   -7.515067300353735e-02   +1.803932334906857e-01   +6.184020812013295e-02   -1.081810774417677e-01   +6.958882227804215e-01; +1.000000000000000e+00   -4.259024886215647e-01   -7.048229306343572e-02   +2.922966239515190e-01   +2.082225186594659e-01   -2.988335716467265e-01   -6.834964716661316e-01   -4.934218556263715e-01; -4.024717560283640e-01   +7.934285043449724e-02   -5.508101598923114e-01   -5.248199232264071e-01   +1.052674472519111e-01   +3.428822801938027e-01   +6.002822869433114e-01   +4.424603255811621e-01];
L3E_L2E_iAMPA_netcon = [+5.932976461514198e-01   +8.932552280966505e-01   -3.304493099919545e-01   +7.982796623304178e-02   +2.115935877996110e-02   +3.058580774909029e-01   -8.727258322965156e-01   -2.099100558518139e-01   +1.716200650788767e-01   -2.382777522394475e-01   +1.455697734412836e-01   +6.488317898865186e-01; +1.821778504368453e-01   +7.158463842335259e-01   -3.930787136773998e-01   +8.473011068081673e-01   -1.365575887778455e-01   +3.659739082124153e-01   -1.402107692283582e-02   +1.843356231187243e-02   +5.861674987909704e-01   +7.737675981150027e-03   -5.986430441800627e-02   -2.771268443581406e-01; +1.174055068528093e-01   -5.330780205620462e-01   -2.546086798915850e-01   +4.904159385278901e-02   -7.124113712761569e-02   +4.604120101952155e-01   -5.355853454726660e-01   +2.348663039525516e-01   -2.395248387860626e-01   +4.954936467107362e-01   +4.519174855135539e-01   -4.995600438769193e-01; +1.265195651979896e-01   +1.234601993790795e-01   +5.913738396958264e-01   -1.481234817373128e-01   +8.364836419263609e-02   +5.716470325323072e-01   -9.262862544756230e-02   -5.147850830545667e-01   +3.671687608832294e-01   -4.191701979463767e-01   -8.571625421380192e-01   +2.041647783268438e-01; +4.736843419065347e-01   -9.995617392044212e-02   -1.335729815811332e-01   -7.932124921354821e-01   +6.772413638934182e-01   +4.408703298033756e-01   -4.051799010656676e-01   +5.851093873876093e-01   -3.600641257063002e-01   +1.788214841171041e-01   -1.359263969643411e-02   +2.084799210078470e-01; +4.861365597033845e-01   -8.599661486953325e-02   -1.000000000000000e+00   +5.254563942352737e-01   +2.754181278045674e-01   +2.614519029642182e-01   +4.392127973577242e-01   -2.069156207229629e-03   +2.169158404964873e-01   +3.821045470860319e-01   +8.511853975552063e-02   -6.479750092952207e-01; -6.431357707314221e-02   +2.584619900614880e-01   -2.607014194332476e-01   -7.943231180841056e-01   +6.734145872810098e-01   -6.246545800123647e-01   +6.095299330122016e-02   +9.818675125752982e-03   +7.665475147427578e-01   -6.325238303706751e-01   +1.769967564088796e-01   -8.456644328694221e-01; -4.773210464696394e-01   -2.966690612242675e-01   -5.739517203179723e-01   +1.190257338534869e-01   -6.863263235906073e-01   -4.738524532234218e-01   -8.729808162877930e-01   +1.854387658684501e-01   +6.821516962239145e-01   -3.830894282404604e-01   -5.752932372265250e-02   -2.418680666783533e-02];
L3I_L2I_iGABA_netcon = [+8.698101399615972e-01   -3.037807054375107e-01   -2.488410602263688e-01   -4.140059489498190e-01   +3.592959527529978e-01   +8.811027241470867e-01   -4.342502219937432e-01   +3.939316756251025e-01   +6.270995507322097e-01   +7.229115834938293e-01   -8.443395908439297e-01   -6.622556558164192e-01; +3.403136596498251e-01   -5.662108425413085e-01   -3.597414609505812e-01   +6.633241348079295e-02   -3.132308480410882e-01   +2.010464732439053e-01   -1.391143998203170e-01   -3.109720137188710e-01   -1.492096451926615e-01   +6.066217716210942e-01   +3.949170939142730e-02   +6.270135584381100e-01; +4.363360358379894e-02   -1.614124836415695e-02   -4.158157259016516e-01   -3.111555362429495e-01   +2.481154532928845e-01   -9.051471270025702e-03   +1.906294199120419e-01   -7.531949572349760e-01   -7.426671636190481e-01   -1.354830405888011e-01   -5.964188711295699e-01   -3.237388583494342e-01; +5.416432331890995e-01   -2.492567735477935e-01   +7.353445969522677e-01   -5.213628278045717e-01   +6.359985390456246e-02   +6.065037949371870e-02   +3.350665934576630e-01   +3.356769449132824e-01   +8.448224841791733e-01   -6.534176239589792e-01   +2.716724840853464e-01   +9.340981613262686e-02; +7.252741281864702e-01   -7.758046658796405e-01   +1.687032903243707e-01   -1.049492143656860e-01   -7.057821879189158e-01   +7.301913546252197e-01   +2.387861851856936e-01   -3.096973070589628e-01   +5.029596928054286e-01   +7.548722166781896e-01   +4.931250921736031e-01   +7.203072245476592e-01; +1.551287923223585e-01   +4.089350044111130e-01   -1.000000000000000e+00   -1.954138806630220e-01   -2.266896603559068e-01   +6.770580714105144e-04   -7.176103190506775e-01   +2.944738403696870e-01   -2.762353414198965e-01   -4.806381599854472e-02   -2.754019909419855e-01   +7.558761977620335e-01; -4.796541837235022e-01   +3.420559188695846e-01   +4.979105477635742e-01   -3.005340278852081e-01   +1.248894330736095e-01   -7.245016600309258e-02   +2.471842465388306e-01   -4.510764713073992e-02   -7.253029577649382e-01   -1.279276241894168e-01   -3.278022803154284e-01   -4.782132067626508e-01; +4.991094680585262e-01   -4.804117160668313e-01   +6.478202222475509e-01   +3.214339316737441e-02   +6.674335443194571e-01   -1.937256944297465e-02   +7.723696916143344e-02   -7.105388450490047e-02   -5.639796477406074e-01   -5.751615405981764e-02   +7.856905848030726e-01   +2.086703645961700e-01];
L2E_L3E_iAMPA_netcon = [-9.970954022068557e-02   +9.502242168936949e-01   +6.443003720320775e-01   -3.285497366761490e-01   +5.965062316404808e-02   -3.065849049801052e-02   +3.176207285877619e-02   +4.280894485742978e-01; -4.749517075183148e-02   -6.086166545273184e-01   +6.329598435375612e-01   +1.019054716017924e-01   +4.769310467189068e-01   -1.491781721582484e-01   +1.385491148917516e-01   +4.709283145347906e-02; +8.540995471202566e-01   +1.116286858865586e-01   -5.239391827297901e-01   +5.952431648180307e-01   -7.087838914293629e-01   +5.380327575669409e-01   +4.362473858715779e-01   +3.012039348330768e-01; -1.454815625455068e-01   -2.171659060576732e-01   -2.528234144129364e-01   -7.133527418899077e-01   -2.823781665958309e-01   +6.403765924907613e-01   +1.628251212652170e-01   +6.758525189036808e-01; -2.203158367600824e-01   -2.196427891629172e-01   -5.705618980124569e-01   +2.985486647750010e-01   +4.334667832338426e-01   -5.913039061819129e-01   +1.435515185332678e-01   +4.949192104239906e-01; +1.990182396736669e-01   +3.814793939896847e-01   +1.443782097956450e-01   -7.424935676836575e-01   +5.087869568074918e-01   -3.814372143606162e-01   -6.316829026082473e-01   +2.579189943412522e-01; -3.357486772322157e-01   -3.003414355735212e-01   +4.831979253499102e-01   +9.658010611725387e-02   -3.140036311409921e-01   -6.159262053977130e-01   -1.065002706805387e-03   -7.787241698164968e-01; +2.982156434848760e-01   +6.548122100941240e-01   +4.456331616690521e-01   -5.568797916188551e-01   -4.064521623429598e-01   +4.775327602321097e-01   +7.771265649274062e-02   +6.079251142980874e-01; +2.648638114311063e-01   -4.720105739439562e-02   +3.876232804438217e-01   -5.554682380837923e-01   -9.980166762352938e-02   +8.008025298883448e-02   -4.694222402512329e-01   -4.755797872433858e-01; -4.163717759975168e-01   +2.662419255157337e-01   +1.869923274765789e-01   -2.188383492176752e-01   -4.552978939205172e-01   +2.323666380893043e-01   +2.873220324767731e-01   -8.841401189471380e-01; -2.567551520915284e-01   -3.300820575041711e-01   -1.349175766954345e-01   +1.484397319389475e-01   -7.994915988646367e-01   +1.747077956781709e-01   -3.941535053288089e-01   +3.760869198501222e-01; -4.031961241430308e-02   +1.406421427201397e-01   -1.699925634228798e-01   +2.947670917625240e-01   -6.332135102139569e-01   -4.918740712848289e-01   +1.510828278019309e-01   -4.090285893660622e-01];
L2I_L3I_iGABA_netcon = [+3.160825991766210e-01   -5.527423012187366e-02   -9.147491911359124e-01   -7.868857776351206e-01   +4.477455819537549e-01   -2.398876323329295e-01   +1.249389735949225e-01   +5.645428276018993e-01; -4.875472353280203e-01   -8.170197168228306e-02   -9.176764410628255e-02   -4.975256950084982e-02   +4.816094088658808e-01   -6.567923760915793e-01   +4.879967382923643e-01   -1.157523203173263e-01; -6.842678578154439e-02   +9.530907656710584e-02   -2.397895447852487e-01   -1.467772855952001e-01   -2.604165598084296e-01   +4.791525717018771e-02   -3.189515175422146e-01   +6.139885597001937e-01; -1.561904201758824e-01   -5.731329040172197e-01   -9.455512299300154e-01   +7.531405901269674e-01   +5.773990942471915e-01   -4.327041763594708e-02   -1.631503491524174e-01   +8.543471478076324e-02; -4.478624877582555e-01   -5.877349817214116e-02   -4.926069999238154e-01   +7.737530741165071e-01   -8.452902011821931e-01   +1.129403371859416e-01   +2.344025607566129e-01   +3.173193145438605e-01; +7.553639150803634e-01   -3.952136742415073e-01   +2.321253489931978e-01   +8.042411144875662e-01   +5.436001630295328e-01   +1.433937362442066e-01   -4.778860810738243e-01   -1.126296927206643e-01; -6.564623776899668e-01   -5.832780732368751e-01   -1.979474792759065e-01   +8.832878021547398e-02   -2.261069002941931e-01   +6.870792544989006e-01   -9.248727323625026e-02   +3.013444921895995e-01; +5.467070129417376e-01   +5.506216099639913e-01   +2.843170936869753e-02   +7.723302796717544e-01   -2.320941110889252e-01   +9.808631510554150e-01   +2.746445433069102e-01   +3.385504553873286e-02; +1.127616430236529e-01   +7.283719156063087e-01   +1.000000000000000e+00   -8.839013316736420e-01   -2.648345094545305e-01   -4.323138035070812e-01   +2.641586215726888e-01   +1.319621570972479e-01; -1.518538939755661e-01   -5.754670887709988e-01   +5.428353951374318e-01   +3.757845698209725e-01   +8.522980650624837e-01   -9.674805593938945e-02   +4.561243125834568e-01   -4.605283189569007e-01; -3.812879970164766e-02   +3.705725632532096e-01   -3.038048102411415e-01   -1.256012333866245e-01   +1.905040208231478e-01   -7.144868354053086e-02   -3.226352588348955e-01   +2.246932938711450e-01; +1.966878963894295e-01   +6.174928851868102e-01   +3.787843925329035e-02   +4.147003986389698e-01   -5.615019481608981e-02   +1.016645592352789e-02   -1.026800354697999e-01   -3.426265002871990e-01];
L3I_L3E_iAMPA_netcon = [-7.099625273040709e-01   -9.792050413486110e-01   +1.772758544403823e-01   +4.198123033660054e-01   -1.137672056061075e-01   +1.465793174420452e-01   -3.799804606587638e-01   -4.409231252484344e-01   +7.378208334404609e-01   -5.496352786808618e-03   -3.252504850417371e-01   +2.217581298921959e-01; +1.551297719406090e-01   +8.786614891752297e-02   +8.494888136701603e-02   -3.081253866880719e-01   +2.195836748631115e-01   +3.803930346289346e-01   +6.727100082519009e-01   +4.908189428580769e-01   -8.045861161090618e-01   -7.016598784598954e-01   -2.271833855194371e-01   -4.073419105371537e-01; -9.576093809787196e-01   +3.904121615051909e-01   +1.381909645752585e-01   +3.463796358654596e-01   -2.754492546734676e-01   +5.936328165906434e-01   -3.866885400449318e-01   -4.718387029974472e-01   +6.966218864492182e-01   -2.158326071037365e-01   -2.319921184897304e-01   -4.499194094831835e-01; -5.258124503317665e-01   -2.150098964984919e-01   -6.219734434061825e-01   -6.678406355602871e-02   -4.117485516327954e-01   +2.234892797005431e-01   +1.780301882745246e-02   +5.385547371479978e-01   -5.662111457423767e-01   +5.079391866572162e-01   -2.657479246849661e-01   +4.156146253830880e-01; -4.650471945693637e-01   -2.511423335891964e-01   +4.302572781720415e-01   +9.703317551790598e-02   -2.506507825383961e-01   +3.509792255465031e-01   -7.601582427753643e-02   +2.119233256149912e-01   -1.183208718329499e-01   -5.374038028981237e-01   -1.069118868722981e-01   -7.100829443778075e-01; +2.298900018721432e-01   +2.825459490195627e-01   +6.125935267749263e-01   +4.509048135051335e-01   -3.856909736468023e-01   +5.303933518950465e-01   -8.769679354551925e-01   +4.217035193702775e-01   -1.763819096741881e-01   +4.825197334036178e-01   +2.840567761510289e-01   -2.286200285021117e-01; -1.584165066413776e-01   +7.104795065505475e-02   +1.020372713771983e-01   +2.378052802679411e-01   -4.858160149492571e-01   +2.962729537524398e-01   -6.285322382310547e-02   +1.217805582158764e-01   +2.380205169851410e-01   +5.953784652243116e-01   +6.083723235579699e-01   +5.066589602327249e-01; +4.094728813177763e-01   -1.197648550491433e-01   -4.346743855748245e-01   -5.408758940757115e-02   +3.202585716663904e-01   -6.417973022164472e-02   +1.973198385991895e-01   -1.688416695580687e-01   +9.113697143530924e-01   -1.622070688629030e-01   +8.197961595384617e-02   +1.967177808145256e-01; -8.604726523055527e-01   +6.157043410380068e-02   +3.933156463734067e-01   -1.577231913271463e-01   +5.190908967065933e-01   -9.171392151625654e-02   +6.053839808382163e-02   -2.152073565831339e-01   -2.093181513877622e-02   -6.842930115766932e-02   -1.053528132084802e-01   -4.052846371196131e-01; -3.015711100714952e-02   -4.684806467066488e-01   -3.934815709214518e-01   -6.671445479045188e-02   +3.467838828931526e-01   +2.001106663601072e-01   -1.495421613279063e-01   +4.947405822346554e-01   -6.813641040048221e-01   +4.619989137337711e-01   -1.000000000000000e+00   +1.785430379245994e-01; -4.254778163448882e-01   -1.312479969355401e-02   +4.479661443508253e-01   -3.129776552777030e-01   +2.736691672051223e-01   +2.104554963624733e-01   -1.261533292670228e-01   -3.845339474589199e-01   -4.218660040677669e-02   +3.775614694639344e-01   +6.817372706128220e-01   -5.939663793522328e-01; +8.036728479346818e-02   -3.988932024099790e-02   +7.548569264531790e-01   -5.517489837149550e-01   +5.744094492678152e-02   +2.286439450010263e-01   +1.915945842119725e-01   +2.166959709885139e-01   +3.284362123959528e-01   -6.607882830777655e-01   +1.429243903022722e-01   -2.733320775612645e-01];
L3E_L3I_iGABA_netcon = [+1.997172242849190e-01   +4.936108566829358e-01   -8.093934042015472e-01   +4.466060338663630e-02   +1.206767503008942e-01   +1.544541488705054e-01   +4.263530414723379e-01   +2.402710593785293e-01   +3.774353309968702e-01   -6.116817728578018e-01   +4.921240725774340e-01   +4.829294525570798e-01; -1.713641290200218e-01   -1.487503187402849e-01   +8.100406062160601e-02   -4.335838404121988e-01   +1.336465367862912e-01   -6.452777822664196e-01   +3.409210229475885e-01   -4.913739881855951e-01   +7.264309584367208e-01   -7.044685729421127e-01   +7.563964323773659e-01   -3.357870389992151e-01; +6.157329543425897e-01   +1.196115062257470e-02   -3.268549848038960e-01   -3.735578066052931e-01   -2.548373964799132e-01   -5.131540690423079e-01   -3.168126214654902e-01   +3.018609586725612e-01   +1.492696085116952e-01   +2.560949347382291e-01   -2.596306820485082e-01   +3.874521098221957e-01; +5.219122600245233e-01   +1.284508318277836e-01   -5.615149491368192e-01   -1.966642193693866e-01   -4.204745485085100e-01   +4.411129906999748e-01   +7.622865199493420e-01   -5.432057876489995e-01   +4.371149207009294e-01   -2.928117537267340e-01   +2.286947180658151e-01   -3.702291133043306e-01; -2.665603645812673e-01   -3.959048609400397e-01   +3.124176576576254e-01   -1.655841481401707e-01   +3.866876387387581e-02   +2.198262424353035e-01   -3.082137485591142e-01   -4.639298657434722e-01   -1.731341528865454e-01   +6.165954174060378e-01   -5.588499349575222e-01   +1.918294003596243e-01; -2.970660659444102e-01   -6.977261733306388e-01   -9.611120706724745e-02   +4.494025761030511e-01   -1.119249126055700e-01   -4.845535391375307e-01   +3.335696243950580e-01   -2.867595518105081e-01   -2.847506531217171e-02   +1.557032132586965e-01   +1.537764782484507e-01   -5.494562075316566e-01; +2.463329471218373e-01   -6.142028027864050e-01   -3.375322621761067e-01   +3.815022133243259e-03   -2.603899276345006e-01   -2.158978933454154e-01   -5.195537889249076e-01   -3.049212690573420e-01   -6.419368434522462e-01   +2.918569691583083e-01   -3.310933150986772e-01   +1.995813485097167e-02; +5.920743047257455e-01   -1.608528833593480e-01   -3.674605443642025e-01   +3.207056513033912e-01   -3.403940209577392e-01   -2.206120113488265e-01   -1.600534007844518e-01   +5.653086288015674e-01   -2.275449831520308e-01   +5.161601552898415e-01   +3.374372364649892e-01   -3.985362156674941e-01; -1.537698611362916e-01   -2.635102998639223e-01   +3.550184297389747e-03   +2.714321334684618e-01   +7.735308709113327e-02   -4.154819384165356e-01   +4.020361583868225e-01   -3.705978407459185e-02   -1.120205972707284e-01   +3.895918582748759e-02   +4.398103742206626e-02   -6.302704490472708e-01; +1.386864541953185e-01   +4.083790716946121e-01   -1.346267665927724e-01   +5.320548639690202e-01   -7.386998817446381e-01   +4.358779248840535e-01   -1.000000000000000e+00   -4.860491014933181e-01   -5.862084758386520e-01   -1.104391275955964e-01   +1.994678958440305e-01   +4.998504423437965e-02; -2.585896918929230e-01   +2.322727703791215e-01   -1.952896472215377e-01   +7.381307978150040e-01   -7.017426121507866e-01   -8.863124995517484e-02   +6.602420891813963e-02   +4.785375620111224e-01   +1.146334397214304e-01   -1.455814077422138e-01   +5.434902157255920e-01   -4.481803336373210e-01; -1.250781717684105e-01   -7.159285360944534e-01   +8.402014543767625e-02   +4.549467223398602e-02   +1.557733641372584e-01   +3.108264507434489e-01   -1.293509478021227e-01   +1.353114023617205e-01   -2.011976470140126e-01   +7.127140342904428e-01   +8.216597281950595e-01   -4.233885832779997e-01];
L2E_Input1_iAMPA_netcon = [-4.650091319738852e-01   -1.259120913655097e-01   +7.436791135971421e-01   +8.023039671368821e-01   +3.546264529349140e-01   -7.403262938475160e-01   -5.047056326341420e-02   +4.369390213777788e-01];
L2I_Input2_iAMPA_netcon = [+6.833120131492962e-01   -9.896747672411650e-01   +7.523768291071822e-01   -5.322726014526412e-01   +3.528417060449427e-01   +2.037906683085526e-01   -7.728219259705575e-01   +7.151735753735036e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
