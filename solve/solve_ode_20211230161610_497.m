function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.884747540175130e-02   -1.514252603842862e-02   +4.520380836899208e-02   +1.555921421806792e-01   +4.179247887209703e-02   +3.719464878865811e-02   +4.712275669304240e-02   +1.467671649912824e-01   +4.068913679294920e-02   +7.282323450530738e-02   -2.045379121675007e-02   -4.118515601642107e-02   +1.382615319866848e-01   -4.400743863009522e-02   +7.409284909189190e-02   +4.654643149679674e-02; +2.637523672858393e-02   +1.059925957594133e-02   +1.261658762417161e-01   +1.459192822250299e-01   +8.228506688224521e-02   +1.289325289223674e-03   +9.193411010449047e-02   +1.533131390138397e-01   +6.816640477415475e-02   +3.118845574625070e-02   +7.319873131130439e-02   +1.019918681444924e-01   -2.872158878785574e-02   -5.716313743115524e-02   +8.641500110180535e-02   +2.922019327948779e-02; +1.693739849945999e-01   +7.394004362817036e-02   +8.671891339563399e-04   +1.207668449119908e-01   +3.667629199086633e-02   +6.327838453429751e-03   +1.078418926760418e-01   +2.047663918213929e-01   -3.218487185845371e-02   +1.316331108527150e-01   -2.493754449701330e-02   -8.863768251196241e-02   -7.210909328941894e-03   +2.059740434732044e-01   +1.008551254979144e-01   +4.026123915326413e-03; +7.713163599509820e-02   +5.283004196148901e-02   -3.675815722706345e-02   -7.786839416848768e-02   +7.399872233090672e-02   +4.308563957426555e-02   +6.163645345057200e-02   +9.748901638459984e-02   +4.228225245564021e-02   +1.333618361534100e-01   -3.422097366886676e-02   +9.171831658215775e-02   -1.860393824799358e-02   +5.530337240810145e-02   +1.476169913046336e-01   -2.921071984896828e-04; -1.389591702195478e-02   -6.325189517086578e-02   +5.176072068681468e-02   +9.553859089389785e-02   +1.616005499283457e-01   +3.635689791592836e-02   +6.189906753443861e-02   +3.645095971262523e-03   -3.059139631830833e-02   +6.159721843960445e-02   +5.573657650121378e-02   +6.048563384227395e-02   +7.016407909463807e-02   +5.945955465954719e-02   +8.096450348923495e-02   +8.920444931049983e-02; +7.101369746093980e-02   +1.771066517447310e-01   +1.228250640120875e-01   +1.003394295454136e-01   +1.817611251602145e-01   +1.222280550076244e-03   +9.663566123812913e-02   +9.791711354262006e-02   +8.522645643285422e-02   +1.079643054513338e-01   +1.317283905647661e-01   +2.314830461870541e-02   +1.184084036934973e-01   +4.771505160578005e-03   +1.251313697959134e-01   +1.995131625771840e-01; +1.228149386289680e-01   +7.308614859644066e-03   -1.583529420346972e-02   -4.917369644254125e-02   +1.682622788374130e-01   -5.462076090686770e-02   +4.253586331943979e-03   +9.000191216514307e-02   +2.827082631076058e-02   +1.447846889769205e-01   +5.875592381159189e-02   +7.171183049030991e-02   +7.634849844092096e-03   +8.515811617111976e-02   +3.790279273254987e-02   +1.765059584189062e-01; +8.681130368478884e-02   +8.031216093521296e-02   +9.400865558982538e-02   +1.545319703457707e-01   +1.275880762578035e-01   +7.675965937310303e-02   +1.991873138254649e-01   +2.361016195366273e-02   +1.052682825343682e-01   +5.590210598728337e-02   -4.964792435197815e-02   +4.415712186034127e-02   +5.107643606930576e-02   +1.580046638406789e-02   +1.962712529220807e-02   +6.262014623235872e-02; +1.070442916932347e-01   +1.229822626824148e-01   +5.202364083273380e-02   +8.627066225086452e-02   +9.392807169692209e-02   +1.052166730645132e-01   +1.511841901397754e-01   +8.634617706921173e-02   +1.483500823415844e-01   +1.326202930932190e-01   +1.841997907815449e-02   +9.475395026061675e-02   +1.422137614045960e-01   +9.649389970892443e-02   +1.075622639161005e-01   +9.753995315281079e-02; +1.183151770518943e-01   +3.454039465361948e-02   -3.443730719008810e-02   +5.410724874281087e-02   +5.843114118738357e-02   +1.103980916056898e-02   +6.673919760425709e-02   +7.290550699801795e-03   +1.522564419644993e-01   +1.327534360820187e-01   +2.910411388659644e-02   +8.043828005920386e-02   +5.364309158961032e-02   -4.434964939773096e-03   +2.075674075903905e-02   +4.723149571134824e-02; +5.288406977442830e-02   +7.933217201146582e-02   +7.155653947604755e-02   +5.063215581617532e-02   +1.350686243827606e-01   +1.535848546677342e-01   +3.876114486232579e-02   +6.134788090261638e-02   +5.202107891292631e-02   +1.746953196812312e-01   +9.943228641913736e-02   +2.131140329842458e-02   +1.330262840993968e-01   +9.555258926002633e-02   +1.485728701855919e-01   +5.010937129723154e-02; +9.406790574500240e-02   +4.215770737378643e-02   +4.566285269028603e-02   +1.688869168867466e-01   +3.131077683494442e-02   +7.627394453584560e-02   +1.274534814444500e-01   +1.243212001738265e-01   +2.927004741229422e-02   -7.834157984319891e-03   +8.347516733096815e-03   +3.867460880862165e-02   +7.013288970566209e-02   +5.747078039293205e-02   -1.454109046142110e-02   +5.156424226205512e-02; +2.833566638931310e-02   +1.118281798989250e-01   +1.246092262808267e-02   -3.538615187051899e-02   +3.963578282417887e-02   +2.561324824707827e-02   +1.696056330930931e-01   +1.341939426631970e-01   +9.412867542422997e-02   -1.882052132932332e-02   +9.463913610966189e-02   +2.492108768959227e-02   +3.130282628110202e-02   +8.227089941370266e-02   +9.512318472248875e-02   -3.051568205714689e-02; +4.896312594120970e-02   -2.711773621603980e-02   -2.120221046337969e-02   +7.374490722963890e-02   +5.832121495994154e-02   +1.301124246172290e-01   +7.810365003771604e-02   +3.202931034620801e-02   +3.423454439501050e-03   +1.042542287380148e-01   +6.683602554285688e-02   +9.162230673526171e-02   +7.173265786561739e-02   +1.646284606621327e-02   +1.008049675305957e-01   +8.567015358877012e-03; +9.388496654397636e-02   -2.806816173940852e-02   +5.393241389254282e-02   +3.462204920309132e-04   +1.088885849015243e-01   +1.431978855528026e-01   -2.920345714748102e-02   +1.231019786715734e-01   +1.216695995543424e-01   +1.223756921318382e-01   +9.725441270942844e-02   +1.108416837040251e-01   -1.898049463699758e-03   +1.305636343509005e-01   +1.457406461846012e-01   -2.509575707520099e-02; +6.022935021964174e-02   -4.098675914493331e-02   +1.785639337008931e-01   +1.136777612126036e-02   +9.523659208071371e-03   -1.119824489388154e-02   +9.549027222632626e-02   +7.842751353449888e-02   +1.588671627299383e-02   -2.998346519044018e-02   -6.550457694244958e-03   -3.506050528949718e-02   +6.460365891346138e-02   +6.848233801808733e-02   +5.053603821688462e-02   +7.604261731289201e-02];
L1E_L1I_iGABA_netcon = [+3.439709314065426e-02   +6.766125469787185e-02   +1.413518589695799e-01   +1.144319355205538e-01   +1.154888452797473e-02   +5.883965589713382e-02   +6.788698983038489e-02   +1.592981492354213e-01   +8.013462779265504e-02   -3.076977750593181e-02   +1.653189807607860e-01   +2.112479941347321e-03   +8.963500865502189e-02   +7.973463352029637e-02   -1.976484879468297e-02   +1.019625637659317e-01; +1.630586559145801e-01   +1.988595049970417e-01   +1.250805443210680e-02   +1.335881084622075e-02   +6.161886010041025e-02   +1.089468343997651e-01   +1.646995679022555e-01   +1.939617575919702e-01   +6.293836667277965e-02   +3.528039813101591e-03   -4.691894193958279e-02   +2.741764166929284e-02   +8.456553398490921e-02   +8.003599921402343e-03   +8.385246291185768e-02   +1.186958148911393e-02; +8.501934291432039e-02   -1.488329206809694e-02   +1.267424145927878e-02   +1.006521047636643e-01   -3.877262554386785e-02   +4.596757702729474e-02   -2.432790907706534e-02   +9.383458886950115e-02   +1.561928719986760e-02   +6.908195344775120e-02   +1.218272464394623e-01   +7.459205073480732e-02   -3.944985647673985e-02   +1.129215880927786e-01   +4.622470352308850e-02   +2.792059934083164e-02; +6.190733943448154e-02   +1.669434604474844e-02   +6.819967440233252e-02   +1.162264359208210e-01   -7.424259381456097e-02   +7.498399680654827e-02   +1.160943619718098e-01   +2.192779894473037e-01   +7.182427975501423e-03   +2.160481732532977e-02   +1.191757704015730e-01   +1.616878055228423e-01   -3.925089267592985e-02   +1.358673483916712e-01   +4.236180983447149e-02   +1.453247880202041e-01; -1.832205685798284e-02   +5.778597151440451e-02   +2.010869602657376e-01   +4.610439398133956e-02   +2.852579162504774e-02   +7.270195954112116e-02   +2.268885045330844e-01   +4.007799015561322e-04   +1.071239814671415e-01   +1.256102827978542e-01   +1.598319416729744e-02   +7.780831375501861e-02   +4.222747393072959e-02   +1.337976422712906e-01   +4.030419476793828e-02   +1.709932031123559e-01; +9.517066200422182e-02   +1.412004466825120e-01   +1.157531229431972e-01   +4.859350400890070e-02   -1.876711505995150e-02   +1.380694651393480e-01   +1.086000079202579e-01   -1.733482407118270e-02   +1.722588931824394e-01   +1.135200528714595e-01   +5.053587772731304e-04   +3.345596594452292e-02   +6.444502935835177e-02   +6.953195552091290e-02   +5.704589577764997e-02   -2.718257021132779e-02; +5.070258659812888e-03   +4.105842440865923e-02   +5.374066235288759e-04   +4.249721324188553e-02   +1.505804293493987e-01   +1.236426637061286e-01   +1.244167340836987e-01   +1.220406237796033e-01   +6.820811060839300e-02   +1.253972195809401e-01   +6.183558974885439e-02   +1.293693433699371e-01   +5.932969321342009e-02   +4.724130576357361e-02   +6.035199328666598e-02   +3.214167911356820e-02; +1.124057529599131e-01   +5.467944932243434e-03   +1.078864789560444e-01   +8.368029034063776e-02   -1.642406870576565e-03   +5.290782671753930e-02   +6.248714327665063e-02   +5.634817834175508e-02   +5.801077215001679e-02   +1.678319969082344e-01   +8.450798625714361e-02   -5.348297976058327e-03   +1.345315733799707e-01   +1.434227938297163e-01   +3.525587616366574e-03   -1.660923635726065e-02; +3.210278045448433e-02   +1.605346073731161e-02   +1.446421162739421e-01   +4.704383123691396e-02   +6.170842548112888e-02   +5.918295272540984e-02   +3.730311799787105e-02   +1.030465926694147e-01   +5.036520828694326e-02   +4.447978191337913e-03   +1.442913679170845e-01   +8.555100096124763e-02   +1.314285564255129e-01   +3.965356539117224e-02   +7.804271694109798e-02   +9.428818075616238e-02; +1.680565628559254e-01   +5.564061241331656e-02   -1.387989843572201e-03   +1.700319197246268e-01   +5.921194233774026e-02   +9.445077581497523e-02   +2.935391185089632e-02   +3.834362674330777e-02   +1.267704941303824e-01   +2.516765108638783e-02   +3.957966344612514e-02   -1.411282284860318e-03   +9.616685834456270e-03   +1.354682415797551e-01   +9.637679211048811e-02   +1.300028313867938e-02; +1.399952342555515e-01   +1.531962469872695e-01   +1.050714923665836e-01   +2.444999123053612e-02   +1.082538653850786e-01   -6.582417780172864e-03   +7.185510571356926e-02   +1.197664649136087e-01   -4.411801503854582e-02   +3.223706227032565e-02   +6.848067301849779e-02   -9.584863263516817e-02   +1.120854660651721e-01   +9.025764368873249e-02   +1.611473676697605e-01   +3.326269192398346e-02; +1.542262942734896e-01   +4.224848311058069e-02   +1.290705023611979e-01   +1.524824471444186e-01   +1.072760679522616e-01   +2.774846796231924e-02   -4.527145398386184e-02   +8.759677944733740e-02   +4.070461717221602e-02   +9.200521223495586e-02   +1.648426099916440e-01   +5.522667488663469e-02   +6.688106914924666e-03   +1.294324340940904e-01   +9.730754416800454e-02   -3.485758446832616e-02; +7.787527988714985e-02   +8.704495655689963e-02   +1.832317494782474e-02   +1.357459863056936e-01   +1.863456385088286e-01   +7.542049820468205e-02   +9.082784228528541e-02   -7.336760553155443e-02   +1.930959287470239e-01   +1.100113059659352e-01   +5.462144901227788e-02   +1.429447271894099e-01   -2.660464300620956e-03   +4.301788274395478e-02   +6.866713566965256e-02   +7.759248725114061e-02; -1.729451769093610e-02   -4.394739769895280e-02   +1.210377690899001e-02   +7.839533340765105e-02   +4.241830913164130e-02   -4.343457239442311e-02   +9.699259152510899e-02   +1.574876478524903e-01   +1.195419050187288e-01   +4.889439811588725e-02   +4.605588291709255e-02   +2.541830706851785e-02   +1.748158232033497e-01   +1.545665770607563e-01   +9.241106625863009e-02   +4.538200391403178e-02; +1.379664539707341e-01   +9.236942168478751e-02   +2.005629993768203e-01   +9.817701105361568e-02   +1.057126362682535e-01   +4.723578392117685e-02   +1.615016180560089e-01   +8.532341271509955e-02   +1.421146182107890e-01   +6.226810988552428e-02   +4.752827680679030e-02   -8.792622122436731e-03   +2.520208209533153e-02   -6.053512728792072e-03   +8.963116261151266e-02   +4.906872746221688e-02; -5.748038123492326e-02   -2.609082807928059e-02   +8.603311409162086e-02   +3.784147076409316e-02   +1.171486458076948e-01   +1.990321342931235e-01   +1.993026563852854e-01   +1.030758156707476e-01   +7.588170931171614e-02   +1.787916757715165e-02   +1.863068473411252e-01   +7.584993871090122e-02   +2.075436840954454e-02   +1.057860405548721e-01   +6.503945912707912e-02   +1.136044767702235e-02];
L2I_L1I_iGABA_netcon = [+9.247797437951834e-02   +1.438653287632105e-01   +1.738966773984645e-02   +5.805503944053304e-02   +6.600246258340939e-02   +9.053095939596190e-02   +7.113415824772877e-02   +6.863566864658835e-02; +5.045778703358798e-02   +4.791490675845430e-02   +1.036840288059361e-01   +4.612661029367047e-02   -9.247938260829029e-03   +7.774098772690204e-02   +1.822601197829327e-02   -1.282226521283703e-02; -4.468454728828112e-02   +8.075830322286275e-02   +5.054923006286425e-02   +2.064995931979401e-01   +7.631484086695884e-03   +7.124560897440950e-03   +4.585991032232374e-02   +5.686089834118417e-03; +7.074454487809806e-02   -7.763774655021856e-02   +2.336556757096637e-02   +1.126352553089656e-01   +4.268255604910773e-02   +1.122556273400716e-02   +3.145947165881114e-03   +1.857849059109491e-02; +1.314315603071279e-01   -2.823661047041596e-03   +5.109480299896543e-02   +1.554953478014003e-02   +2.114989831532159e-01   +1.340579747691421e-01   +1.351825040295152e-01   +4.645506057006484e-02; +5.605569736803249e-02   -8.222186553320783e-02   +1.863603367282340e-02   -9.245691183027974e-02   +1.695572520959492e-01   +6.666262435175412e-02   +1.819805362744924e-02   +3.931286746649412e-02; +5.824916444631863e-02   +4.205628574858778e-02   +1.317534102666595e-01   +8.993349579840881e-02   +5.269606616073862e-02   +8.749545444430618e-02   +1.293451343336551e-01   +4.645652568311041e-02; +1.106267516845789e-01   -1.391168346893394e-02   +1.838839651938962e-01   -5.997720212852863e-02   +2.028073012038704e-02   +4.619021409909664e-04   +6.649756267233549e-02   +1.000812612095809e-01; +8.116118632416468e-02   +3.019320358750680e-02   +1.451054893248107e-01   -2.282932073593658e-02   +5.303515046354951e-02   +1.216161360874873e-01   +1.300616422880991e-01   +4.460578752877353e-02; +8.417211854629805e-03   +4.454236596960123e-02   +9.733035908337768e-02   +4.519638989898563e-02   +1.136397374611271e-01   +6.969788597832771e-02   +1.563039892321041e-01   +7.815920979987286e-03; +1.737490839091815e-01   +1.539229799043353e-01   -3.090596002969414e-03   +1.231737539145278e-01   -4.290153623387789e-02   +1.298088091157506e-03   +9.915403032345829e-02   +1.404750889937258e-01; +1.132048137534610e-01   +1.026292194423122e-01   +4.063473766579806e-02   +8.499399712945831e-02   +1.474206095278990e-01   +2.913495804208930e-02   +9.500564279840691e-02   +5.964095829642835e-02; +1.291655391094988e-01   +1.663388399967510e-01   +5.345853848750001e-02   +1.600466698294138e-01   +1.029466528024711e-01   +6.907234776771487e-02   +4.933827934391954e-02   +4.872650195033003e-02; +9.604865072107920e-02   +1.981934766485530e-01   +1.771170603191006e-01   +3.546513731941236e-03   +1.471525007418787e-01   +1.039540081369241e-01   -5.951994784440280e-02   +1.903439948738336e-02; +5.094325532061309e-02   +1.318313190923199e-01   +5.052787012336822e-02   +9.684825820800280e-02   +7.287070414785780e-02   -2.469034121200467e-02   +2.730623450833213e-02   +5.622352967593723e-02; +1.051476651230040e-02   +1.205864339762402e-01   +2.072900084132665e-02   +1.020463314778920e-01   +1.106616894377678e-01   +1.841872622708953e-02   +1.543503117557138e-01   -2.504197951459399e-02];
L1I_L2I_iGABA_netcon = [+6.581652739620117e-03   +1.594822455214719e-01   -1.476176440200936e-02   +1.835234413122961e-01   +1.860957957435653e-01   +7.066275771160038e-02   +1.064098075660880e-01   +2.503883120854623e-02   +4.732178307012967e-02   -3.939423229431591e-02   +7.550319785916340e-02   +7.156130187778913e-02   +1.081606064783471e-01   +6.188538501205105e-02   +1.579773912580582e-01   +2.967770493090835e-02; +7.722685694888119e-02   +2.137699938091771e-01   +1.069998621325082e-01   +4.833697528063728e-02   +1.995035895452710e-01   +7.210864490586823e-02   +8.680848786080345e-02   +9.657964627903708e-02   +1.333462297725761e-02   +2.225661917513811e-02   +6.884536566103996e-02   +1.134877072592397e-01   +1.381484131847399e-01   +2.351639505163256e-03   +4.590239446045224e-02   +1.131684769682336e-01; +8.316800692519603e-02   +1.470475244358022e-02   +6.668301366327191e-02   +8.703073370791739e-02   +5.542278433944366e-02   -1.159301280890521e-02   -4.928235241126951e-03   +5.162573948046914e-02   +9.769555448003714e-02   +6.001583987111613e-02   +1.693552177350853e-01   +6.295978322181238e-02   +3.323837538370703e-02   +8.876239622122591e-02   +4.487110811720031e-02   +3.701501270754899e-02; +5.337585291852965e-02   +1.082872736166122e-01   -8.925748817171439e-03   +3.121421089526544e-02   -4.867617475517926e-02   +4.910011273800408e-02   +5.503324730501089e-02   +1.113383714204701e-01   +4.395514437097427e-02   +1.101180614505777e-01   +4.422469504401412e-02   +1.060557668323096e-01   +6.072262192405020e-02   +1.263775741297639e-01   +9.354582244550040e-02   +8.948550450960800e-02; +6.746814709655909e-02   -4.209142600721379e-02   +1.832796537198497e-01   +2.353070340632048e-02   +1.322910046752488e-01   +3.943088321811212e-02   -6.633677564260582e-02   +9.848099565502577e-02   +1.248172410253778e-01   +2.047244854743254e-02   +7.425340830149221e-02   +1.458717705875348e-02   +9.646965294781265e-02   +3.064660807621274e-02   +8.941828561234794e-02   +8.870593420747083e-02; -9.663661508705920e-03   +1.008484402523066e-01   -3.293274640319793e-02   +1.678755064135782e-01   -6.737478942615654e-02   +2.197614796633292e-01   +1.808399518412619e-01   +1.279851208071399e-02   +1.203711184635582e-02   +8.472860738231378e-05   +1.137280698663077e-01   +7.482788540039552e-02   +5.527258223785485e-02   +7.303498125280874e-02   +5.930220353882709e-02   +1.305080371054230e-01; +2.633373147529404e-02   -3.528315659049182e-02   +1.480991915108986e-01   -1.191887563043895e-02   +6.863906909728003e-02   +2.944632136572591e-02   +1.172847031953566e-01   +6.864385521896073e-02   +1.181864296163174e-01   +1.138151403138151e-01   +2.875415808848778e-02   +1.363073103346396e-01   +7.082970343340629e-02   +4.888032473088502e-02   +1.290310006759358e-01   +1.111569215427361e-01; +2.913464287799879e-02   +3.114427953755377e-02   +1.699122553532231e-01   +6.740220742493873e-02   +5.099789683607840e-02   +1.072058081472301e-01   +4.188883639381356e-02   +1.912543658194912e-01   +2.169131399532675e-01   +6.035305998545430e-02   +4.358972975675198e-02   +5.652634094086071e-02   +4.101537261225262e-02   +9.485570257344154e-02   +9.211662167004356e-02   +1.317295655092340e-01];
L2E_L1E_iAMPA_netcon = [+9.559122394928551e-02   +1.059106275172344e-01   -1.689268992048558e-02   +9.654206448336825e-02   -2.547935276711077e-03   +5.776939188661913e-02   +1.345080777036072e-01   +7.965139300786631e-02; +1.057354082120052e-01   +7.513378071093165e-03   +1.258299807644197e-01   +2.024334998876775e-02   -4.033676093544775e-02   +7.804811399857163e-02   +4.739818578550355e-02   +3.116311231190259e-02; +6.060598973169917e-02   +1.040419946782025e-01   -1.702450773786683e-03   +9.160836784997008e-02   +1.351299800671921e-01   +2.136568195824041e-02   +6.560898765177495e-02   +7.213402090754421e-02; +1.089081963423691e-01   +1.056740771656449e-01   +9.369928033684458e-02   -3.968130926729961e-02   +7.804242005720687e-03   +1.902677025619384e-01   -3.075428175583275e-02   -3.958138790410640e-04; +2.443114786547771e-02   +8.986783844815253e-02   +6.536292859673666e-03   +1.261420131880882e-01   +8.479204280433345e-02   +5.448289471670695e-02   +4.327151475180817e-02   -2.562581902098582e-02; +1.229302315064360e-01   +1.003066581889367e-01   +1.731581863816142e-01   +8.394500637871212e-02   -5.496493094198571e-03   +1.149127293769443e-01   +1.084513881768280e-01   +2.106956083657213e-03; -6.395366938242414e-02   +1.075645856389218e-01   +9.178622262906395e-02   +1.852404434812052e-01   +5.189712726349911e-02   -5.577434242410308e-02   -9.028134933634101e-02   +1.398531618098665e-01; -5.826730963089982e-02   +6.780472576671401e-02   +1.319045949164732e-01   -2.899495206325085e-02   +8.904751095998185e-02   +3.319487069632259e-02   -3.348808290275707e-02   +5.075941001835918e-02; +9.476172465084265e-02   +9.847354268964946e-02   +9.951469965289282e-02   +9.734473054712393e-02   +5.920513840986914e-02   +1.417569360046797e-02   +5.055060970692818e-02   +1.278727990428384e-01; +1.211290193965730e-01   +2.173827568283657e-02   +2.557862806763649e-02   +3.020376343321270e-02   +6.337181335140181e-02   +1.245435245231837e-01   +7.351930831275291e-02   +3.308527729650990e-02; +3.154915014434494e-02   +4.737871478645525e-02   +6.439563040431204e-03   -5.440135419071380e-02   +1.654238730930674e-01   +2.516659793254284e-02   +1.637767453959102e-02   +7.918174646430426e-02; +1.389842784818137e-01   +5.424540153171815e-02   +1.292220875876352e-01   +2.630007254710461e-02   +1.212627903893445e-01   +6.321074572209832e-02   +3.247162567597435e-02   -3.452172567804320e-03; +7.629927230519874e-02   +1.365393896394714e-01   +7.316718919797710e-02   -2.313086252294928e-02   +9.889255849009607e-02   +1.060014170861735e-01   +1.095839668392461e-01   +1.964888017281559e-01; +2.793662959112972e-02   +4.316169183182046e-02   +1.464017172046975e-01   -4.688549063502020e-03   -1.305834244002724e-02   +2.072839331441308e-02   +2.025779481759254e-01   +6.981417504460184e-03; +1.094652127796160e-01   +1.348278379791231e-01   +8.732342305328382e-02   +7.009414195726116e-02   -2.199416931080053e-02   +2.067810675319702e-02   +2.414468635160968e-03   +4.807302623263995e-02; +9.570572620690970e-02   -1.280702473314777e-02   +6.027438365050931e-02   +4.842890641124697e-03   +1.178831487482166e-01   +1.779044509402224e-01   +8.937974084172760e-02   +1.636247138683832e-01];
L1E_L2E_iAMPA_netcon = [+4.597661006587210e-02   +8.864643616731090e-02   +1.018290293030606e-01   +8.228669039136813e-02   +3.424389324017982e-02   +1.555251411200969e-02   +5.107471015453383e-02   -3.517576831552682e-02   +2.859747119513345e-02   +1.524062568833902e-01   +6.686078513931804e-02   +1.823612701235022e-01   +1.782145415093149e-01   +1.598371084968106e-01   -2.751997021886732e-02   +7.748017807646448e-02; +1.539661390968923e-01   +2.685754012847606e-02   -5.626461376490356e-02   +8.390132788250794e-02   +9.943669339959860e-02   +4.402754235239150e-02   +9.099461029918107e-02   +3.322137123955044e-02   +2.058965933333318e-01   +4.852846911806310e-02   +2.177918630366115e-02   +8.061903281535165e-02   +9.204396517138341e-02   +1.429281768616325e-01   +4.982215873292736e-02   +6.593384866911396e-02; +5.383232176790928e-02   +5.564137670771882e-02   +2.543800972895679e-02   +1.054338734514609e-01   +1.414933567997364e-01   +4.758757411943923e-02   +9.773064098786070e-02   +7.625904887520939e-02   +9.662040648547367e-02   +6.537469656224218e-02   +9.713813892351748e-02   +1.485977319801553e-01   +2.242347959155956e-02   +7.737861750382391e-02   +4.217373579570452e-02   +6.017924354294601e-02; +1.863727119906474e-01   +2.136263638813076e-01   -5.548156622797540e-03   +5.374297968955115e-02   +9.363543997060819e-02   +2.239770821232686e-02   +8.544118364231502e-02   -7.398764918544960e-03   +7.034215085736675e-02   +1.571734208777289e-01   +3.886095736994541e-02   +9.616157102775402e-02   +1.156523406466456e-01   +1.764417876292868e-01   +1.511196236913887e-03   +3.932110851326118e-02; -3.249907240258177e-02   +3.181255040818028e-02   +2.566084771923020e-02   +1.418131754367716e-01   +3.388124059672731e-02   +1.303598324959147e-01   +1.275691843103123e-01   +5.492694401745524e-02   +4.283328264388794e-02   +6.867486003212989e-02   +1.292470315280824e-01   +6.763653156406049e-02   +7.690860668091810e-02   +7.519552928111593e-02   -1.076441859439870e-01   +1.057157580779959e-01; +3.673494396910824e-02   +1.817363737534304e-01   +1.405816372619943e-01   +2.671385137011940e-02   +6.762087375341991e-02   -3.200703540596270e-02   +1.107381354868038e-01   +4.128312027120404e-02   +8.350479830690873e-02   +1.096399562459850e-01   +1.012066466756674e-01   +1.095818331674139e-01   +1.230150767018665e-01   +2.326950952297932e-02   +5.409464466713890e-02   +1.343604260270074e-01; +1.035995976681632e-01   +9.488665248364132e-02   +1.104870166777265e-01   +1.349456955643430e-01   +6.142968848263165e-02   +2.268278721244532e-02   +2.673679148843997e-02   +1.196366639222335e-01   -8.625927383513268e-02   +1.278475625692162e-02   -7.065250211835769e-02   +1.583200470748729e-01   +3.433809896429574e-02   +2.006616949288116e-01   -5.243580738672983e-03   +3.345118375962573e-02; +5.295066957202971e-02   +1.379168637766087e-01   +1.152326561324841e-01   -2.074364915129978e-02   +2.379457522328357e-04   -3.176879460551751e-02   +1.406060362259725e-01   +3.966193623857759e-03   +4.803608192970039e-02   +1.112325906694118e-01   +5.684554740933354e-02   -4.817634623076997e-03   +9.414402555519935e-02   +4.206214429122632e-02   +8.898242652794339e-02   +7.590236420015736e-02];
L2I_L2E_iAMPA_netcon = [-2.376695096078617e-02   +9.060760263289848e-02   +1.133886975836233e-01   +1.133137296826611e-01   +1.018851608552521e-01   -6.685376012244120e-03   -4.029077628908012e-02   +2.899157991510155e-02; +6.641649214079742e-02   +2.061752108693538e-01   +8.107799464324696e-02   +1.723123157870734e-01   +8.974663530071819e-02   +1.518640588617555e-01   +1.015529217382112e-01   +1.555129894025694e-01; +4.812138985657953e-02   +8.796531837061755e-02   -2.400360619593776e-03   +7.378054867626935e-02   +4.045729325465395e-02   +3.704109493891819e-02   +7.773262698570418e-02   +8.609548898416593e-02; +1.594463462182291e-01   -5.243777665434274e-02   +8.165885057397820e-02   +8.032783471836624e-02   +8.359046621375295e-02   +7.784384448817358e-02   +7.835756578458089e-02   +5.397001041549662e-02; -1.609782659587606e-02   +1.965671263670998e-01   -6.623438726299313e-02   +3.360342820745917e-02   +5.439525597363967e-02   +9.968246840941197e-02   +1.481682636597022e-01   +1.237022927249526e-01; +3.247745239448264e-02   +5.541441932706471e-02   +5.595250240341437e-02   +1.420653712158745e-01   +8.877402115930010e-02   +1.812891142215640e-01   +1.629585542338111e-01   +1.541228394647201e-02; +8.958765741756225e-02   +1.086623674734456e-01   +1.781525509013764e-01   -1.778103885162151e-02   +4.169722066093938e-02   +6.587827495096263e-02   +4.364642789741599e-02   +1.849075418435239e-01; +7.376594980875928e-02   -1.083376280721051e-02   +1.527518651624346e-01   +1.180223182733919e-01   +1.331971912181598e-02   +1.290875621605441e-01   -1.432079466262864e-02   +1.376946119026915e-02];
L2E_L2I_iGABA_netcon = [+6.050594813089481e-03   +1.466049962516299e-01   +1.170173582685800e-01   +5.086483055094507e-02   -1.919680973976461e-02   +1.139952037060026e-01   +1.407585783530179e-01   +7.887489534658193e-02; -3.555598592754144e-03   +3.516228845091342e-02   +3.539051782111634e-02   -1.476732468990771e-02   +3.759420379239700e-02   +6.724193942375017e-02   +8.212537422073138e-02   +6.322865323994328e-02; +9.175999876372565e-02   +1.207428577989823e-02   +1.698487086947299e-01   +1.249858952222302e-01   +2.949922887971369e-02   +1.320386271208675e-03   +1.198835155797389e-01   +7.315723995976563e-02; +9.353071292554062e-02   +1.392075859766522e-02   +4.018343218784979e-02   +1.104083542218550e-01   +8.409996821583814e-02   +1.506719053720215e-02   +2.740037314187787e-02   +4.708807174508391e-02; +1.054349030496572e-01   +1.129261945467755e-01   +3.585929011107750e-02   +7.649266614225315e-03   +4.680903057848475e-02   +7.683929232395433e-02   +1.716052900129433e-01   +1.281031807373420e-01; +2.530784250735468e-02   +7.731124074562346e-02   +1.446930466818943e-01   -6.227017338291975e-02   -4.309052734711342e-02   +7.837879442267007e-02   +4.198311717546581e-02   -3.418326744428390e-03; -4.036636752172120e-02   +6.585594021904020e-02   +1.408490834175201e-01   +1.753150656275294e-01   -5.415035076891743e-03   +1.453798841904249e-01   +1.225545192015436e-01   +9.638148623638090e-02; +1.312282405903225e-01   +2.120765590084275e-01   +2.065553869045974e-03   +1.334090189377004e-01   +6.746887427883311e-02   +1.431143602353865e-02   -3.124754629095785e-02   -6.583762605314009e-02];
L3E_L2E_iAMPA_netcon = [+1.139427316176820e-01   +1.159859415506014e-02   +4.460113869546262e-02   +1.677547797236165e-02   +2.572179346541687e-02   +3.497787993868176e-02   +3.970661237255615e-02   +1.687689933235517e-02   +8.116884579014647e-02   +4.677012541797129e-04   +1.389714497145605e-01   +8.622945378020191e-02; +4.354342546767944e-02   -7.689962090249892e-03   +2.436516154433043e-02   +1.014973690420517e-02   +7.460229002869402e-02   +1.278726521717594e-01   +1.069817567368875e-01   +4.510810104233089e-02   +1.212076299739349e-01   +4.075128010709063e-04   +1.866488775633906e-02   -4.803062143369035e-02; +1.802758806110676e-01   +1.242177223626125e-01   +1.139410584976242e-01   +1.011050959159404e-01   +1.076147393528908e-01   -2.916461999173782e-02   +1.442675275579763e-01   +1.235363829311199e-01   +1.413137827120757e-02   +4.119509971934038e-02   +9.224246858558098e-02   +8.527563411413390e-02; +1.101568949603820e-01   -6.710670135878809e-02   +7.805107233559186e-02   +1.168268641006642e-01   +2.659592384854144e-02   +2.244628865807338e-03   +2.051346816252167e-01   -2.962120566208161e-02   +5.136727863153930e-02   +4.083780678092003e-02   +9.871228279392515e-02   +1.291300017360633e-02; +1.885812166290932e-02   -2.446561097472107e-02   +1.297047445800130e-01   +5.362663398729511e-02   -5.111347275859034e-03   +5.734422427303772e-02   +1.130115483527528e-01   +1.389948768961421e-01   +1.000516919690592e-01   -3.422162867321429e-02   +1.085148113259658e-01   +1.345347697169652e-01; +8.533045928144994e-02   +2.924423977635708e-02   +1.079693932235487e-01   +5.859484814689446e-02   -2.406724573494800e-02   +1.353312402611101e-01   +1.236851847655824e-01   +2.723227759040673e-02   +2.070378045887869e-02   +9.301925565355870e-02   +1.644939728955626e-01   -3.716966393191853e-02; +1.299367589254874e-01   +1.083371883565699e-01   +9.370657422593097e-02   +4.316527896200384e-02   +2.005414160622400e-01   +3.460357080011285e-02   +5.774729325165819e-02   +8.814820446142577e-02   +5.040087120004579e-02   +4.155967422060840e-02   -2.474027520154091e-02   +1.714257071061454e-01; +1.079893937985893e-02   +6.386777104632124e-02   +5.560252075409736e-02   +5.802966901752735e-02   +1.295823692913309e-01   +2.230991607773417e-02   +1.534782788368428e-01   +5.589285043634397e-02   +1.626179046306850e-02   +3.998536941618008e-02   +9.045334116020654e-03   +1.088272680409006e-01];
L3I_L2I_iGABA_netcon = [+9.754080475519987e-02   +9.393046824658073e-02   +1.356632770948865e-01   +2.165598819130922e-02   +1.100308399880573e-01   +1.211405230710108e-01   +1.280516290631430e-01   +5.621340010966954e-02   +1.235789290621499e-02   +5.795620244414207e-02   +8.305288627629038e-03   +9.426484220557935e-02; +1.286091663538182e-01   -1.567296058576865e-02   +6.889232263636545e-02   +1.302249966995524e-01   +1.006289999832350e-01   +1.078355252920473e-01   +3.138482345059618e-02   +1.400848204657345e-01   +2.390476993444288e-01   +1.431395647847017e-01   +5.859953694497548e-02   +1.493515692663217e-01; +7.797890935391905e-02   -1.533303837721156e-02   +1.127556433979039e-01   +9.005384440307551e-02   +1.310465821401596e-01   +1.152997899315368e-01   +3.063639610918289e-02   +4.250770910587495e-02   +1.348982417417354e-01   +1.569656440762049e-01   +4.886935914422445e-02   +1.609299353404002e-01; +5.435137999741064e-02   +3.061785743263518e-02   +1.312857157744189e-01   +7.198987572169006e-02   +3.653740928350453e-02   +7.698129169576697e-03   +3.498769659342620e-02   +7.072291846648056e-02   +1.078874561042144e-01   +6.275922090214435e-02   +1.420515274585813e-02   +6.455043086449952e-03; +6.655590642667766e-02   +1.148364462226122e-01   +2.697644006365714e-02   +2.524154873280935e-02   +1.034619582237604e-01   +1.108918961817245e-01   +3.782947229520806e-02   -1.532136798259552e-02   +1.069985673371872e-01   +1.121927289481730e-01   -3.506856210861334e-03   +1.130129358134740e-01; +7.877813848850186e-02   +9.134855639546799e-02   +6.362448557194689e-02   +1.213788522895779e-01   -5.230897145384138e-02   +4.977104229801645e-02   +1.098028912693259e-01   +4.149908299460838e-02   -7.935186734273706e-03   +4.799514960769449e-02   -9.241795358455319e-02   +1.780990594896139e-01; +3.445862493270681e-02   +7.006513636241350e-02   -1.501338702547950e-02   +1.451708039519081e-01   +1.028526280446236e-01   +2.553370616165118e-02   +1.756621496521572e-01   +5.614229595586757e-02   +1.810971560081553e-01   +7.997651980093573e-02   -1.322043876946805e-02   -2.537741119847547e-02; +2.504004269376216e-02   +9.188570625058477e-02   +1.433907810855455e-02   +9.161056078428334e-02   +1.854333574016911e-01   +1.958993451195421e-01   +7.923825120917190e-02   +1.648487716898721e-02   +2.911804933793245e-02   +3.139911766391646e-02   -3.356656185575816e-02   +1.684733807960533e-01];
L2E_L3E_iAMPA_netcon = [+8.927363304716669e-02   +7.576350437141918e-02   +3.696998509294722e-02   +2.142920259250268e-01   +2.622303378922234e-02   -1.159201849987521e-02   +7.274928885891033e-02   -3.368874855070390e-02; +1.447394557281643e-01   +1.214002522938327e-01   +6.829173719819549e-02   -6.024544821193653e-03   +1.216416770046436e-01   +6.190603617521395e-02   +9.810882960190007e-02   +3.748506280878439e-02; -4.336742998199436e-02   +2.196936286980670e-02   +3.227558323006178e-02   +7.171705289551349e-02   +7.151751832531450e-02   +1.398879441184885e-01   -5.822181778699773e-02   +1.499027077804524e-01; +1.107891460974329e-01   +9.850790279258828e-02   -8.766373984684817e-04   -4.800808874895809e-02   +3.301473625407932e-02   +4.605139215849194e-02   +5.358533159332721e-02   +9.685494087790635e-02; +1.184930144478678e-01   +1.367861166394713e-01   +7.090901060303373e-02   +1.392384549671472e-01   +4.095608850301656e-02   +2.782927928814191e-02   +1.485158701301284e-01   +1.113102228781461e-01; +8.329130267910848e-02   +1.426504734954792e-02   +2.873611522496347e-02   +9.500155205599085e-02   +1.493748145989971e-01   +1.254106774346469e-01   +6.249420536741215e-02   +1.358310791150082e-01; +1.627859986528573e-02   +1.105485004007827e-01   +1.136815560654435e-01   +9.974066172419781e-02   -1.156909651126925e-02   +8.427125869985697e-02   +5.419132453147757e-02   +1.233085207574899e-01; +8.314745463015674e-02   +1.793293358586769e-02   +1.053365851840842e-01   -7.378973310801073e-03   +8.688548280417469e-02   +5.069759024238792e-02   +8.359966902896127e-04   +1.260967430674568e-01; +4.457328094606085e-02   +5.947908945178965e-02   +4.922948041739147e-02   -1.806484094515684e-03   +3.595370028064637e-02   +9.586354221446451e-02   -6.302222304255398e-02   +2.355888812546156e-02; +9.110450970162673e-02   -2.437851891528434e-02   +9.494758546735764e-02   +7.922748166036200e-02   +6.028639425668766e-02   +9.769738845498981e-02   +1.206058294008248e-01   +1.068608208970692e-01; +5.893294026009228e-02   +8.719984826038220e-02   +1.556967694654196e-02   +6.954303066153397e-02   +2.136296840796121e-02   +8.706293661703501e-02   +1.027626591972603e-01   +1.355243946794815e-01; +4.418468310011892e-02   +4.634648728984298e-03   +9.430090993204711e-02   +7.918780748952561e-02   +2.093332369049751e-01   +7.923101485684124e-02   +4.170734429133321e-02   +2.593935118907563e-02];
L2I_L3I_iGABA_netcon = [+8.708790777417792e-02   +4.187463351167010e-02   +6.002309143524685e-02   +1.426319185984181e-01   +7.626257075327755e-02   -1.623877574040696e-02   +5.635155006936174e-02   +2.955727567019704e-02; +1.409630684733364e-01   +1.034589911702851e-02   +2.119448629224901e-02   +2.804294517037102e-02   +8.430891195522035e-02   +3.352523758466252e-02   +1.340906201198132e-01   +1.795347207803160e-01; -6.351037536398743e-02   +1.273114939082702e-01   +6.499736611136792e-02   -5.758885792344256e-03   +1.177290295719058e-01   +8.440194198995137e-02   +1.729694571813424e-01   +1.519947018541296e-01; +8.298343256683700e-02   -1.434198039238041e-02   +1.299011039086301e-01   +9.186785346276484e-03   +7.515966149936745e-02   +3.705167241294790e-02   +2.000085002425769e-02   +6.094159834647883e-02; +1.226011425148877e-01   +7.733357314361688e-02   +5.657079450082671e-02   +9.960018697344276e-02   +7.931429660206238e-02   +8.311191517626726e-02   +1.102674792651912e-01   +1.676245193751142e-01; +9.705440030958666e-02   +5.265042491265745e-02   -1.065011631723319e-01   +1.151364390791186e-01   +7.333522775492818e-02   +9.596789471163614e-02   +9.863300568011599e-02   -7.346937694452026e-02; +3.961040529104909e-02   +1.045068794072987e-01   +6.036421403514049e-02   +1.558464150465473e-01   -1.365688198085016e-02   +3.547079703668942e-03   +2.215496067719118e-02   +6.676515190545115e-02; +1.780446764579695e-01   +9.444419397584206e-02   +5.525749576390160e-02   +6.079631160695499e-02   +2.052561602819697e-02   +4.829396659030750e-02   +4.419365178209723e-02   +1.131999263902485e-01; +1.499434576824170e-01   +8.383830198548201e-02   +3.903443127818516e-02   +1.405937153653348e-01   +1.250963835376503e-01   +4.200132559390878e-02   +5.957239420438545e-02   +6.827670928173309e-02; +9.537510218310664e-02   +1.308481926495905e-01   +9.808939706190033e-03   +1.556859838095081e-01   +2.981843713819122e-02   +1.007368082865225e-01   -2.774583116049980e-02   +1.347567087722732e-01; +1.344050860463619e-01   +2.950383703790635e-02   +2.019583549165716e-01   +1.425475352124393e-01   +1.100953804121862e-01   +7.070342498884837e-04   +1.147913032085132e-01   +1.406075577745772e-02; +1.368498990518395e-01   +7.817831908362655e-02   +9.972250426788536e-02   +1.041984370437604e-01   +4.894315003089812e-02   +5.648125958899115e-02   +1.094103559992249e-01   +9.728921958515158e-02];
L3I_L3E_iAMPA_netcon = [+5.658232337226628e-02   +2.783565676230186e-02   -7.371449727150430e-02   +6.209969731001066e-03   +4.656556333003488e-02   +1.622932085065178e-01   +7.338252369675452e-02   +1.268302818893949e-01   -1.428073782786331e-02   +2.982605172653276e-02   +1.465168169281124e-01   +1.576215640647554e-01; -6.123518170093521e-03   -1.048795382501513e-02   +1.128937798746608e-01   +8.041993879925508e-02   +8.074661617920750e-03   +7.213658928400379e-02   +2.176497753574261e-02   +3.162471086582580e-02   +8.594767079575291e-02   +2.857855379776622e-02   +1.163935652937903e-01   +1.596930123821909e-01; +1.309085461951797e-01   +6.439829595059615e-02   +1.114168886661254e-01   +9.846270128096883e-02   +1.032772510423394e-01   +2.118500892166992e-01   +8.942082025848379e-02   +1.877166239607460e-02   +8.062454638108602e-02   +3.576847230139677e-02   +1.219612686748796e-01   +2.677729684237159e-02; +6.168531278923577e-02   +9.576538571617910e-02   +1.126113797082590e-01   +6.167265544230760e-02   +7.430337183922749e-02   +1.020072520751386e-02   +1.172010542659025e-01   +1.394770803626737e-01   +8.482022550370379e-02   +9.496699530918014e-02   +9.562930653027246e-02   +1.382935715624682e-01; +9.734491817897786e-02   +1.016521780354539e-01   +6.822274936117910e-02   +7.383888347490074e-02   +1.668681299097787e-01   +8.002323687696648e-02   +4.062106548529637e-02   +1.076183747121622e-01   +8.593616225883392e-02   -8.127873237332478e-02   -5.064813921468093e-02   +1.460286450931522e-01; +9.044138996305032e-02   +1.475862937874926e-01   +1.165487915781778e-01   +8.231814775242670e-02   +4.296332487582127e-02   -3.266077160765243e-02   +8.538419499417670e-02   +7.352881636064872e-02   +1.690449007779046e-01   +2.893576465499490e-02   +5.939438569480563e-02   +2.767337355328313e-02; +4.234221500493181e-02   +2.836945680835831e-02   -3.541168422999043e-03   +9.116580333222159e-02   +8.857149345470636e-02   +5.789633232718443e-02   +4.059753402215649e-02   +9.330346719542568e-02   +6.071405554526214e-02   +9.977384520529919e-02   +6.221294051301379e-02   -8.863334784006138e-04; +5.578590406979542e-02   +2.822708335104410e-03   +1.073711253735100e-01   +4.538975749661397e-02   +6.675101939406461e-02   +3.307201480995447e-02   +1.171874625529853e-01   +4.084352299969591e-02   +1.188447578073607e-01   -1.983798744821776e-02   +5.476312213693148e-02   -3.110746059292671e-02; +1.770787984701194e-02   +6.261224348232913e-02   +3.672237094266914e-03   +1.396485601078446e-01   +1.515839147080048e-01   +4.012545718659556e-02   +3.138962954083727e-02   +1.606673094284114e-01   +4.005191333215149e-02   +1.556374229088863e-01   -1.874735457476528e-02   +6.031276826892322e-02; +9.212583779668095e-02   +1.724572537211510e-01   +1.646797842339761e-01   +1.066161473953489e-01   +8.862679083411082e-02   +5.861677518422428e-02   +1.076500662325955e-01   +1.505024262743643e-01   +2.294101300149693e-02   +1.616774609749148e-01   +8.967730416393048e-02   +9.307951428904293e-02; +1.197756973794884e-01   +4.714635902128689e-02   +1.423952594988727e-02   -1.182185855416941e-02   +9.092458461158096e-02   +1.847463914148964e-02   +9.498838528770288e-02   +8.547318311500476e-02   +1.180369757240940e-01   +5.352827200953037e-02   +1.032729835936057e-01   +3.610160931348520e-02; +1.572258362439741e-03   +4.532212928506153e-02   -2.129035436555449e-02   +1.329182137718764e-02   +7.859202465953209e-02   +9.778319122764050e-02   +1.201864660702796e-01   +3.461977687065194e-02   +8.772413863195068e-02   +1.876247364816710e-01   +1.488214607394009e-01   -5.470722210624382e-02];
L3E_L3I_iGABA_netcon = [+4.915600574341046e-02   +6.247124301078258e-02   +1.169053537234551e-01   +1.109987397998355e-01   +9.647959375516343e-02   +8.355766803795031e-02   +9.850094632898472e-02   +1.491882010481032e-01   +1.684019290791859e-01   +4.513960516806093e-02   +9.588866794826402e-02   +5.458704368256814e-02; +1.300661063373910e-01   +7.389684422079944e-02   +4.599942410389259e-02   +2.824676413262372e-02   +3.505118574300777e-02   -1.626391755408400e-02   +1.857792212053729e-02   +5.616020418996649e-02   +3.620236153947157e-02   +1.215070629853479e-01   +5.126912910765388e-03   +1.064611405174205e-03; +8.546816889487005e-02   +5.585077506791701e-02   +1.483327370574693e-01   -2.634318925653902e-02   +6.391759484171497e-02   +1.049256607094499e-01   +2.605746226846040e-02   +7.217622193484859e-02   +7.763396250960625e-02   +4.889991823155813e-02   +3.962430174622743e-03   +9.758705209209884e-02; -3.627414811394450e-02   +1.363640609170018e-02   -4.987097429781130e-02   +4.946135964222367e-02   +9.246703112303670e-02   +1.962104878769907e-02   +9.086416115640042e-02   +6.416297635936359e-02   +9.379806058888621e-02   +6.387788221769519e-02   +1.183250128710579e-02   -1.800423076084736e-02; +5.534224867802010e-02   +7.796521380594909e-02   +1.324071793844242e-02   -6.928909468042754e-02   +9.346991294518818e-03   -4.178185019412566e-02   +9.552077764416437e-03   +1.703733969174381e-01   +4.528356632937827e-02   +6.576439961025338e-02   -1.146365972097383e-02   +1.391976535737363e-01; -1.325491211817805e-02   +1.518509949474850e-01   +1.456300846148588e-01   +3.751333489210017e-02   +9.604687693268052e-02   +1.177741220045920e-01   +1.070661636812727e-01   +6.892899233618778e-02   +4.953035107799746e-02   +1.525824276023640e-01   +8.275451422857305e-02   +8.732518130572435e-02; -1.005117318671125e-02   -3.656163024014545e-02   +4.687566619410004e-02   +1.402718538368130e-01   +3.607807202665381e-02   +5.607408398858764e-02   +2.626495727562991e-02   +4.682819501841393e-02   +1.008441289649928e-01   +4.563796604742405e-02   +6.385949366598964e-02   -9.331128542904835e-02; +4.488124414964497e-02   +1.090300380574871e-01   +5.530180122063011e-02   +7.635950151979430e-02   +1.860886079623456e-01   +1.019750358621747e-01   +6.917624424517264e-02   +6.530461845339361e-02   +6.932105644716594e-02   +8.702745162016427e-02   +3.458376898075164e-02   -5.205657664431726e-02; +2.717248837946210e-02   -1.807483307542622e-05   -8.737586156302381e-03   +1.394178813984299e-01   +8.567160442809833e-02   +4.307871575469203e-02   +1.078948584782751e-01   +2.525168806337599e-02   +1.527907579410197e-01   +1.305881161456312e-01   +5.041225935295336e-02   +1.635138109469715e-01; +8.547876192037246e-02   +2.537393195305249e-02   +8.551508800483276e-02   -8.378164652523681e-02   +1.339969233834171e-01   -1.497942764684873e-03   +9.224159793169762e-02   +7.219441380451397e-02   +1.756287838023232e-02   +1.132507437410018e-01   +8.737940203539740e-02   +5.222783140363003e-02; +2.340897616715559e-02   +2.144822987794523e-01   +5.252417929657367e-02   +1.072616562092659e-01   +1.283833362381140e-01   +7.746592563185186e-03   +9.199077761245134e-02   +2.956450418618159e-03   +1.086241689041075e-01   -2.046042111655814e-02   +1.383165114201693e-01   +1.391274125416236e-01; +1.408770222647111e-01   +5.132106256561200e-02   +9.194666458875538e-02   -1.707573116834912e-02   +1.318762813735178e-01   +1.008572716438747e-01   +7.169004650683028e-02   +5.888548576483831e-02   +1.222328286140690e-01   +1.137892948660053e-01   +8.499070511129229e-02   +1.101892036223543e-01];
L2E_Input1_iAMPA_netcon = [+8.692368013967315e-02   +9.986036605617066e-02   +6.329166290737476e-02   +3.341523951792089e-02   +1.471053823900056e-01   +2.904131354302365e-02   +1.306455415210391e-01   -1.881955265650541e-02];
L2I_Input2_iAMPA_netcon = [+9.490740805093505e-02   +9.901878530194687e-02   -1.760984193243302e-02   +1.306805477953971e-01   +3.902124527385285e-02   +1.217705248444955e-01   +7.592524742903928e-02   +1.273859894757273e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
