function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.057464759385459e-01   +4.320419274050757e-01   -1.191346181201899e-01   -6.823973857712271e-01   -1.775264944982991e-01   +5.384395173711680e-01   -8.602111707905066e-01   +5.021410514281368e-01   +7.648783542504721e-02   -4.680071896387907e-01   -4.679410842637239e-02   -3.054176684499013e-01   -1.696269559280064e-01   -3.549901455620615e-01   +7.988432424541798e-01   +7.815450631335091e-01; +6.625676203788740e-01   +3.227965862013129e-01   +3.385299310228876e-01   -1.921508125916828e-01   -1.457647808507486e-01   -1.780027791207338e-01   -2.491149697622183e-01   -6.549006463521356e-02   +8.607209193145327e-03   -6.245494660136174e-01   +2.488655681552560e-01   -3.693669061367679e-01   -4.775132921184550e-01   +2.524941604340407e-01   +5.314522503240064e-01   +4.218970441638592e-01; -6.905501154635921e-02   -5.651103919619166e-02   +6.060082364952867e-01   +6.153854778263788e-01   -6.056584717018081e-01   -6.881068320766015e-02   +5.924861290478238e-01   -6.739279678499717e-01   -3.327695669055634e-01   +7.653187205385494e-01   -5.880938846984241e-01   +8.120070352674368e-01   -3.995034646977825e-02   +3.386235248604935e-01   -3.936129717084504e-01   -3.839495072133238e-01; +5.202545248923757e-01   -1.448714900145736e-01   +4.873211557075151e-01   +5.032963308061562e-02   +4.972133575312662e-01   -3.842188691722375e-01   -2.190779581586451e-01   +6.361758376882543e-02   -6.516180311495162e-01   -1.654329345287043e-01   +1.536096586166111e-01   +1.328597436035079e-01   +1.490816172053127e-01   -7.899732486067014e-01   +5.891915063606058e-01   +5.781230610222738e-01; -5.637381598944869e-01   +9.340731800550706e-02   +2.593495530539468e-01   +1.472199419492699e-01   +3.477410122856157e-02   +4.269589399921810e-01   -3.092019561473555e-01   +5.851067397704834e-01   +6.814911350494942e-01   -1.740270241736080e-01   -2.250216800173557e-01   +3.734941507753998e-01   -2.379415267592142e-01   +8.226915453186708e-01   -4.715901315645297e-01   -9.381253995383898e-01; -1.370194200527479e-01   +4.081348740346837e-01   +1.023629436336626e-01   -5.508441695193032e-01   -2.716876828040852e-01   +3.589794306805471e-01   +5.824193442325535e-01   -3.251854382167694e-01   -5.872771102983393e-01   -3.826498966210534e-01   +5.371825064383045e-01   -6.486939876206466e-01   -9.410728545625840e-02   -3.120903943579081e-01   +5.433379682983849e-01   +6.462486541114210e-02; +3.425619097651081e-01   -2.731526157067684e-01   -2.599372722208841e-01   +7.238412928838356e-01   -6.598876341859660e-03   +4.527496145856357e-01   +2.570617058988768e-01   +2.888413051907427e-01   +2.175340845948924e-01   +1.335251147494266e-02   -1.701582055057839e-01   -1.547059246845794e-01   +2.003034111231758e-01   -6.075663167745615e-01   -1.879177551171999e-01   +1.831091673397446e-01; -7.018548470293798e-02   +4.846891626444813e-01   +1.017231813517548e-01   -2.100543242067285e-01   +5.146752953181173e-01   +5.543267932130397e-01   -2.282894253231274e-01   -5.475037450506145e-01   +4.818925865544910e-01   +2.051626616033842e-02   +2.731860936188179e-01   +2.833083190100644e-01   +6.063551186080022e-01   +6.414457979653510e-01   -1.644244066459188e-01   -6.329315759032451e-01; -5.702171020117287e-02   -3.911034935535829e-01   -5.030248037966116e-01   +5.607093152769018e-01   +4.037988805960508e-01   +6.145215397049705e-02   -1.033442797968950e-01   +2.773914400784731e-01   +3.946296176987672e-01   +5.443675831276912e-01   -5.958906693011536e-01   +6.539924588321536e-01   -1.963868178486302e-01   -6.309758927926468e-01   +2.373147547312003e-02   -5.969675961228549e-03; +2.846812664252851e-01   -7.240256246999978e-01   -1.035673719098246e-01   +4.582709160033880e-02   +2.330064149951437e-01   +1.224012479796219e-01   -1.000000000000000e+00   +3.306787444020968e-01   +2.601850015709530e-01   +4.675968438543700e-01   +5.410232642872549e-01   -6.825573817888390e-01   -3.906251468353543e-01   +6.639870548515266e-01   -7.963001430888468e-02   -4.138454692449423e-01; +1.331218102940908e-01   +1.631469067707834e-01   -4.677767456735753e-01   +7.105267282188582e-01   -1.815696468004657e-01   +1.528984732366645e-01   -1.896977938553583e-01   -1.256615622420416e-01   -3.018163762376577e-01   +2.073659806301172e-01   -8.917486836769686e-02   +5.922525175954956e-02   +3.650219636459053e-01   -4.592391642997675e-01   -3.463688673944598e-02   +6.082084716657732e-01; +3.618396364016255e-01   -1.300450182549417e-01   -2.824752915861979e-01   -6.488418970736108e-01   +3.545501646173214e-01   +2.765635405893386e-01   -2.739305966557402e-01   +3.247030185773108e-01   +3.203958898063254e-01   +8.261911461411156e-01   -2.318018596151406e-01   +2.296562443347780e-01   -4.134621791020613e-01   +5.397269948197635e-01   -4.738149638519996e-02   -1.609984467586917e-01; +5.121621131444563e-01   -5.893562025361579e-01   +1.548378933218566e-01   -1.182759409334617e-01   +4.999347153838781e-01   +7.433111276504774e-01   -1.206252673400163e-01   -4.904101630793152e-01   +6.113537513985055e-01   -3.340297715546486e-01   +1.554956459024198e-01   -4.766229519613259e-01   -3.032279220827561e-01   +2.493054858076757e-02   -4.696617150463532e-01   -1.722407147842284e-01; -8.488111161088749e-01   +5.111104653982469e-01   -5.067006791406005e-01   -2.431637103112450e-01   -4.632210460836470e-01   +4.525438181449609e-02   -3.985970244664565e-01   +7.337238518205637e-01   +1.273320467702277e-01   -3.241353559495969e-01   -4.257778965659682e-01   +8.534695309822504e-01   +1.921313563396345e-01   +6.108184272308199e-01   -4.160881884544020e-02   -3.710054413152581e-01; +1.718970522482406e-01   +6.055223534576987e-01   +1.006059564961504e-02   -9.254250934323364e-02   -3.217798296240570e-01   -2.512486938876773e-01   -2.153780895135080e-01   -2.508454714760837e-01   +5.719631383672099e-01   -3.573202238973477e-01   -5.741103105280063e-01   -5.822230059676905e-01   +6.182177377267694e-01   +3.441683381109886e-01   -4.231256986015107e-01   +1.405143569569220e-01; -2.329535559044910e-01   +2.322670478218238e-01   -3.911879192360148e-01   +1.732594733509412e-01   +2.449004371939990e-01   +2.647836177327542e-01   +3.650980167429430e-01   +3.131370653401358e-01   +6.943103383525510e-01   -4.328973987732408e-02   -7.013026176300925e-01   -6.447865978927919e-02   -5.865452171495462e-01   +7.727500858385599e-01   +2.148856808207031e-01   -8.109199676251858e-02];
L1E_L1I_iGABA_netcon = [-7.212257153656015e-01   +1.261189515911749e-01   +3.097290442754113e-02   -9.300955636961143e-03   -8.173407917842836e-02   -6.457760367721258e-01   +5.371968304433002e-01   -1.748026941156725e-01   +1.042889035297389e-01   +9.019277434168613e-01   -7.118036711376463e-01   +5.992447292507693e-01   -3.430305347501921e-01   +2.603012287659092e-01   +5.033752066089553e-01   -9.976102663729183e-01; +3.483976612428410e-01   -3.067802408125066e-02   +5.397504422634150e-01   -7.558997136437059e-01   -8.618200953520767e-02   -6.196315911112498e-01   -1.638505628151070e-01   -1.084830296085761e-01   -6.686446714685616e-03   -7.325577518641425e-02   +2.318171493247320e-01   -3.168079311315763e-01   +4.647019034667446e-01   -3.612055379896466e-01   +1.743392143844387e-01   +5.627325429748906e-01; +3.264683516384876e-01   +9.206757216890418e-02   +3.596832878885236e-01   -1.967789059441194e-01   +4.512450431532795e-01   +5.719102481744125e-02   -6.186904319239052e-01   -4.998500197511280e-01   +4.395966326528591e-01   -3.217126177944121e-01   -5.595062044325829e-01   +8.417480507615681e-02   -7.443628531803826e-01   +5.982434929961432e-01   -5.506595624060210e-01   -2.892100176107539e-01; +3.202810280466996e-01   -1.802851956241384e-01   -1.793076769991551e-01   -5.054049465294140e-02   +1.258212802336440e-01   +8.835611162113139e-01   +3.524809154575874e-01   -1.425434247613478e-02   +4.742166557530235e-01   +2.134321167861478e-01   +3.402228517033762e-01   -8.634783097779407e-01   +1.259799191211526e-01   -8.270258433815207e-02   -3.166159606096036e-01   +6.306045412554434e-01; -8.221062639936428e-01   -2.865419949663043e-01   -2.883657253834938e-01   +6.489594008247807e-01   -4.040242613837453e-01   +1.020114781820340e-01   +8.091596708250374e-01   -2.658674811659122e-01   -1.912488549814971e-01   +7.924791492187010e-02   +1.621980052482308e-01   +5.867165100823395e-01   +2.904048168232876e-01   -5.260543296435362e-01   -3.322880073192899e-01   +1.855356901546369e-01; +2.253939870498301e-01   -2.950127077084799e-01   +1.679056953474643e-01   +3.876752833008510e-01   -4.252340743564669e-01   -5.058711638364530e-02   +1.429658461980431e-02   +2.896709213319525e-01   -7.092166370210825e-01   +3.196946035515720e-01   -1.234549638816473e-01   +1.227648114446101e-01   +7.004564351614072e-01   +5.944638061134022e-01   -8.893491414400648e-01   -3.641154221552012e-01; +6.569089111796043e-01   -3.292023553322967e-01   -5.944214871874960e-01   +2.693868624928713e-01   -7.147858411815444e-01   -3.858466751199581e-01   +7.897805373120872e-01   +1.633261991931216e-01   -5.167917336610934e-01   +4.779783737620126e-01   -3.524059562090420e-02   -5.941853249638986e-01   +3.973542096412442e-01   -5.724400803011517e-01   +4.864864547625629e-01   -3.257302676747699e-01; -4.998254151293903e-01   -1.447076464392185e-01   +1.628630859211979e-01   +4.628363622043883e-01   +3.194830717946114e-01   +7.008355785963117e-01   -2.651106093226630e-01   +1.745122265426942e-02   +3.263512091721258e-01   -6.394333328231209e-01   -1.000000000000000e+00   +2.400794931358771e-01   +1.984015792354283e-01   +2.890832453113740e-01   +1.289364206235760e-01   -6.995334216003625e-02; +7.624491501211571e-01   +4.452482132252812e-01   -2.672510738094447e-01   +3.408319735253809e-01   +5.293292600281330e-01   +1.882323476217267e-01   +5.448564268057644e-01   +3.186395928020946e-01   -1.978330424692161e-01   -4.303019745200564e-01   -3.384233749828335e-01   -1.902821655100236e-02   -3.735241862466437e-01   -6.427579939011195e-01   -5.028060704537342e-01   -5.282113353129253e-01; -4.287728806156230e-01   +4.564509277304644e-01   -2.737003800121942e-01   -4.229773296851222e-01   -9.419711096957241e-01   +8.707541159009247e-01   +9.711031277066499e-02   +2.045896268007618e-02   -4.417898462296575e-01   +5.905372019492314e-01   +1.439562608795076e-01   +8.613107663934258e-02   +5.003590392268913e-02   -5.541547208467510e-01   -1.380038520316033e-01   +1.721287647512490e-01; +2.283534630304778e-01   -8.254048358222629e-02   +4.773301915268444e-01   +3.550496733186961e-01   +3.789972405609275e-01   +4.155705512182733e-02   +8.143494106768818e-01   -4.578915595866434e-01   -4.371728632522852e-01   +7.044291282224385e-01   -4.356310873681619e-02   +5.367934109335252e-01   -2.236709931127647e-02   -3.271384097928407e-01   +4.467228991891834e-01   +8.028620004994301e-02; -9.381615029834072e-03   +1.790965904422727e-01   +2.177803597065479e-01   +7.033738194472149e-01   -1.384651576989848e-01   +4.508940711259676e-01   +2.827266890346792e-01   -3.884853501492216e-02   +9.662801894552069e-01   +6.647269480427968e-02   -4.145530060891265e-01   +6.185016391610032e-01   +3.918744762371965e-01   -3.577649912282242e-02   +8.790769378923251e-03   -8.615224018990804e-01; +4.759873145822835e-01   -6.144894176134603e-01   -7.473363013954331e-01   -9.573605914489614e-01   +3.621073829026640e-01   -3.834182719723762e-01   -6.723069522634887e-01   -3.609988822893817e-01   -5.032417985196147e-01   -3.416614678910642e-02   +2.444964813447571e-01   -9.259921237188994e-02   -5.147550250867923e-01   -6.947255713007937e-01   -2.570566105015346e-01   +9.135724292068582e-02; +2.424108501194513e-01   -1.050011250065566e-01   -8.692297280143975e-01   +9.887658050322663e-02   +7.544247127749478e-01   +2.223874719703760e-01   -3.368232283513422e-01   +2.121374467203867e-01   +6.855409166000683e-01   -3.433737100479297e-01   -6.600140338873555e-01   -4.234465755256976e-01   +5.707097694507738e-01   -2.467378448630647e-02   +2.014222843909589e-01   -6.926998465971954e-01; -8.282144103581195e-01   -4.513323731416037e-03   -1.666980776715192e-01   +2.321987191606501e-01   -6.773524061038461e-01   -6.636796606632639e-01   +6.290283748299939e-01   +7.482331841593053e-01   +4.883912720558103e-01   +5.469985236173124e-01   -2.622770790201043e-01   +3.631179758081013e-01   -3.761382136271260e-01   +8.279758651111123e-01   -4.512539759325374e-01   -3.989901237953955e-02; +6.570538991207254e-01   +1.444384148298297e-03   -2.062768984284444e-01   -4.247437786343316e-01   -3.461098289130222e-01   -2.640073552320001e-01   -1.153481740765559e-01   +7.658928632319047e-02   -1.588253192239550e-01   +2.692205168220273e-02   +1.664550576470532e-01   +1.216891113817275e-01   -4.227666135434169e-01   +2.489928999416420e-01   -1.737394745138206e-01   +2.977429982368565e-01];
L2I_L1I_iGABA_netcon = [+5.662934230853124e-01   +6.621181821562264e-02   +6.600457832202282e-01   -6.020587971823491e-01   -2.833402935642848e-01   +3.137015395176351e-01   +7.267450463665643e-01   -1.452206668204768e-01; +5.241864109810718e-01   -3.279491844857899e-01   +6.374792051183026e-01   -7.001939753281440e-01   +1.176558269973850e-02   -6.218175322413235e-02   +6.547735239991413e-01   +2.708375126111995e-01; -1.486497168566333e-01   +5.731215935734563e-01   +4.882302539279771e-01   -5.218248639174580e-01   +3.114904288358040e-01   -6.649818510732635e-01   +1.164723815315052e-01   -2.200382522549340e-01; -4.921569585014632e-01   +2.213142219927586e-01   +5.294788358162860e-01   +3.247412119349821e-01   -7.455837371408948e-01   +2.089723314092273e-01   -4.160391767011378e-01   -4.907260128530970e-01; -4.167358510756659e-01   +5.161821168620055e-01   -4.084750058976481e-01   -5.995126846593875e-01   -3.272963476492291e-01   +1.636798356074700e-01   +4.943922308080588e-01   -8.049680070448641e-02; +1.885776205738886e-01   +5.181027535839546e-01   -3.084652383218843e-01   -5.494335871188889e-02   +2.017589170636161e-01   -5.541286099259199e-01   +5.999836039502419e-01   -3.406437779830887e-01; +3.050484960969205e-01   -2.222959886096915e-01   +8.866092136718168e-01   +2.764429434709655e-02   -5.790039530816686e-02   -5.008205664436208e-01   +5.044391929833731e-01   +4.616831852667761e-01; -4.696750395229919e-01   +5.136694649387223e-02   -8.901422642648535e-01   -4.004991662282836e-01   +1.246097970614736e-01   +4.579387764388115e-01   -4.897782553367996e-01   +5.771218858947058e-01; +2.313048955296775e-01   +2.832436936513853e-01   +2.477228010247868e-01   -1.364242731673303e-01   -6.763295600883242e-01   +6.435821077452187e-01   -5.997247016901158e-01   +1.943344938026400e-01; -2.336629225773796e-01   -1.768355929415365e-01   -5.144260399911530e-01   -6.798158459844826e-01   +5.688542024167440e-01   -1.904406388468366e-01   +4.250832357888026e-01   +5.270238064779392e-01; -8.394386513495677e-01   -4.178369405500683e-01   +1.667305434449332e-01   -2.777835581213142e-01   -1.165620294366540e-01   -3.144236229861349e-01   -2.017562203415269e-01   -6.920246345381204e-02; +3.344305765351716e-01   -1.255975717322761e-01   -3.879844413637796e-01   -5.365473955052968e-01   +1.660867143538703e-01   +1.759934209701253e-01   +4.092934762094544e-01   -2.088189389768457e-01; -3.920276450848987e-01   +2.213166284794919e-01   +7.670269068067277e-01   -3.528519526185033e-01   -7.643550191681547e-02   +1.583672397287788e-01   -5.143871111561892e-01   +7.040058764625609e-01; +2.827080496660804e-02   -2.496118048838789e-01   +2.307562050934780e-01   +1.697483190365134e-01   -3.252514929979758e-02   -4.847930298301453e-01   -3.060854119949745e-01   -3.930308820413710e-01; -4.222566268838114e-01   +5.820634019526374e-01   +3.599944325956027e-01   -1.093942671562560e-01   -7.808006756258242e-01   +2.289147636427523e-01   +5.370158779431319e-01   -3.345440224516641e-01; -6.039918608073137e-01   +1.000000000000000e+00   +1.221874229843375e-02   +1.551254704780143e-01   -6.302304866703216e-01   +4.372304628619437e-01   -9.208817903772196e-02   -1.921615834218546e-01];
L1I_L2I_iGABA_netcon = [+5.966990571557542e-01   -1.461734537477599e-01   +4.494238258013276e-01   -1.179808679426932e-01   +1.829147176576781e-01   -5.708625099471364e-01   -1.507234750703393e-01   -1.908801038115823e-01   +2.063835560854062e-01   -1.637439056478035e-02   +1.534554711301571e-01   -1.994878684552883e-01   +8.612473019300375e-02   -1.335422192832630e-01   +2.492278738957109e-01   +3.993412910165861e-01; -8.066571096469998e-01   +4.221738922958377e-01   +6.854749115860889e-01   -8.315712488378275e-02   +3.728659098228958e-01   +3.205492641658258e-01   +5.162921285569525e-01   -1.985423220932678e-01   -4.635773742990073e-01   +6.098702223385273e-01   +1.977656517229489e-01   +5.537987176980299e-01   -4.452921203536914e-01   +8.301190923280818e-01   -1.250513044596294e-01   +1.000000000000000e+00; +4.340759427849426e-01   +9.194049794769067e-02   +6.956370641492789e-01   +5.524796072989639e-01   +2.138197488483905e-01   -1.349478775992757e-01   -4.816540266223711e-01   +4.558267130547554e-01   -5.841006990743617e-01   +3.778422432944309e-01   -6.370338616630529e-01   -1.199711750123862e-01   -3.971646533875762e-01   -1.783329605506608e-01   -3.951146206175514e-01   +1.039053167825223e-02; +7.219141202719849e-02   +1.219451158873964e-01   +4.830915874308884e-01   -3.853617574704947e-01   +3.999557938227368e-01   -1.544536132334972e-01   -4.692114928186594e-01   +3.419416501360402e-01   +5.046698684897474e-01   +4.788175236789912e-01   -3.237710120784605e-01   +3.523019662601653e-01   -3.580357361198284e-01   -1.696963994375120e-01   -4.346282540919496e-01   -2.807711699628433e-01; -1.336016818052068e-01   -5.573437986376329e-01   -6.935620683887967e-01   -3.249520304961984e-01   +2.804429219737564e-01   -6.464071320142377e-01   -4.027209385421668e-01   -2.384086083232480e-01   +7.291223902713768e-02   +1.671195709318787e-01   -4.569664483677260e-01   -1.341529989408009e-02   -4.618981456185941e-02   +6.928397950551294e-01   +4.023762371446307e-01   +1.381717643239964e-02; +4.613819673305329e-01   +4.346659358148391e-01   +4.702430847726768e-01   +2.577311558821862e-01   +2.751453696717441e-01   +2.882122073775132e-01   -4.107413664822483e-01   +3.177481229700364e-01   -1.718177825775369e-01   -1.120452509131177e-01   -2.749012816682871e-01   +1.963257965548501e-01   -5.259547568130558e-01   +3.784191325406963e-01   -1.471186863431979e-01   -6.750910466886344e-01; +1.637036397571708e-02   +3.389108312809692e-01   +2.367168012209875e-02   -7.232195833713019e-01   -1.290425527949557e-01   +1.395041376601805e-01   -3.692436833639987e-02   +6.844873687687934e-02   +4.610745504234133e-01   -1.487284136781042e-01   +4.345894904682173e-01   -8.917177599555653e-02   -3.670163064051132e-01   -5.471434119988347e-01   -5.108910169842770e-01   +7.791838974207951e-02; -1.955945176026473e-01   -5.894160219455573e-02   -3.523851498971906e-01   +2.616659395476821e-01   +5.923701265097611e-01   +2.400900203797615e-01   +3.579086592253290e-01   -7.246520248474204e-03   -3.554146298573068e-01   -5.811047779407839e-01   -5.897361906023632e-01   -1.637113211041334e-01   +3.080225354760698e-01   +5.487844208368813e-01   -9.256069476843669e-02   -5.990514869837477e-02];
L2E_L1E_iAMPA_netcon = [+1.366194253916991e-01   +1.199376191801317e-02   -6.770449391846923e-01   -3.087128743691223e-01   -1.988038291948045e-01   +2.609592215715406e-01   +4.725382754940197e-01   +7.398123575166684e-01; +2.017836483820537e-02   -2.013934822290047e-01   -9.117423048622098e-01   -3.801348283441448e-01   -6.780386954387815e-02   -3.186478528052391e-01   +4.421859230790415e-01   -7.098189471873068e-02; -7.612536123446619e-01   +9.367452345027454e-01   -6.043522981769126e-01   +8.983671380610360e-01   -3.872193969537712e-01   -5.240847879240471e-01   -2.043399467690658e-01   -2.394361409329306e-01; -8.351003412347376e-01   +8.942219524286127e-01   -4.548119157316958e-01   -2.446699434418812e-02   -6.803390093890485e-02   -8.956556712402920e-01   -1.144829806912313e-01   +4.991475677011443e-01; +1.973769845266013e-01   -8.430227912185102e-02   +4.535917854566863e-01   +1.401320804407354e-02   +1.424102894494527e-01   +3.788371916724725e-01   -2.951218108996953e-01   -1.890797853417304e-01; +8.673043243125373e-01   -8.124703793060560e-01   +4.357206132303032e-01   -1.898426045336537e-01   +7.713542585924350e-02   +6.907222849408682e-01   +4.374896711916535e-01   -3.249953190909087e-01; -3.187141708352127e-01   -2.544800021904834e-01   +3.625253641180170e-01   -8.017608705328284e-02   -5.732045758411820e-01   -1.202711616387273e-01   -8.095370557524482e-01   -3.070070848389446e-01; -4.420645564136796e-01   +8.910901284651951e-02   -6.156833686520902e-01   -1.542877279354603e-01   +5.731784133505009e-01   -3.825858757863700e-01   -1.329309591020072e-01   +5.299527587277890e-02; +9.913112911235223e-01   +5.321193240479776e-01   +2.898866419454411e-01   +2.911478449174952e-01   -1.365371519873123e-01   -1.813599014882888e-01   -4.129208582882239e-01   -3.745324523818847e-01; -1.108677173517861e-01   +6.929470195652617e-01   -4.098314585146782e-02   -2.948628920846155e-01   -4.825532957645539e-01   -2.547338010527897e-01   +5.185164273556661e-01   +8.489659758442890e-01; -3.716394421188263e-01   -3.954986856587001e-01   +4.493196354892866e-01   +6.029349480257927e-01   +3.442554568188697e-01   -9.611927078009212e-02   +2.037591103384867e-01   -4.757665313881176e-01; -8.310476963177781e-01   -5.505297432742511e-02   +4.650563283730539e-01   -4.810625691449512e-03   -7.035407345318619e-01   +5.739231140826769e-01   -5.691431966627422e-01   -4.176601177302220e-02; +1.000000000000000e+00   -4.155413835835683e-01   +6.242078234537058e-01   -8.165953219064173e-01   -1.292248853689918e-01   +8.291355231917467e-01   -2.531451443115564e-01   +1.086169365448626e-01; -4.227467364097793e-01   -3.018635226408323e-01   +2.549391045343797e-01   -4.549504903000774e-01   +9.727080588760150e-01   +7.217766720201585e-02   -1.744747314724681e-02   +1.863877109605157e-01; +1.663090105692261e-01   +1.458208066097506e-01   +8.042219056358721e-02   -2.638354390449023e-01   -6.212347276735269e-02   +4.457545629461145e-01   -1.677855549062666e-01   +7.004673133619147e-01; -2.362508838084273e-01   +1.297775021926257e-01   -7.698943469603575e-01   -1.883119348712453e-01   -8.947947024208560e-01   +2.795477586845824e-01   -3.401234792593134e-01   +4.100003822401165e-01];
L1E_L2E_iAMPA_netcon = [+4.185945943748067e-01   -1.498900566329199e-01   +1.178688942621083e-03   +3.080907287085511e-01   -4.617224045900853e-01   +6.112070982960053e-01   -4.280444765142992e-01   -1.431067994961057e-01   +2.777293451735142e-01   +4.164487307842470e-01   -3.216658837808440e-01   +9.877951497138583e-02   -7.037760466213444e-01   -5.860720665129016e-01   +2.235023465159205e-01   -9.041950226785574e-01; +4.170146055881536e-01   +5.929340904990091e-01   +4.005982464327070e-01   +3.601923723025141e-01   -4.242048644815644e-01   +1.728153844549962e-01   +6.538589098817617e-01   -5.205976615853055e-01   +1.620809229974879e-01   -2.754079185800832e-03   -1.662152981609693e-01   +9.474722790999119e-01   +7.107869793441828e-01   -1.342694462808831e-01   +3.004838070077510e-02   -5.805139915556873e-01; -4.284376765254174e-01   +2.307520265622922e-01   +8.056818922715846e-01   +6.025849746041788e-03   +5.804883504308452e-01   +9.487897159956115e-01   -6.559154774526079e-01   +1.000000000000000e+00   +8.876213610410427e-01   +4.700777922416436e-01   +5.726437293788136e-01   -3.781826927592857e-01   +1.857637345168085e-01   -9.092535742824437e-01   -1.290891721791115e-01   +1.297032555190697e-01; +1.927919756281018e-01   -6.551850664453865e-01   -8.025630738587950e-01   -6.071080491087295e-01   +3.622375492860136e-01   +2.040272960156345e-01   -5.478391400247059e-01   -2.347570498169462e-01   -6.152570056112707e-01   +1.090425998754087e-01   -2.002106449022374e-01   +5.053367247909316e-01   -6.059850224254099e-01   +5.666068150512296e-01   -4.795474748551495e-01   -6.967772676844520e-01; -3.866702813381490e-01   +4.384892543430984e-01   -3.173878089126281e-01   -1.617583819410160e-01   +6.322838005405864e-01   +6.132028650127409e-01   -2.795868780486104e-01   +2.004626960952701e-03   +3.456811642282424e-01   -6.478002385854962e-01   -2.726824754216474e-01   -5.381195822894562e-01   -3.137736316948828e-01   -7.195973859686230e-01   +2.795243812651413e-01   -7.967598775899172e-02; -3.388824429306226e-01   -4.237082229317111e-01   +4.602020051305318e-01   +1.735175340798106e-01   -1.556593378961212e-01   +2.562402738202175e-01   -2.853536028383823e-01   -4.017718280024265e-02   +5.040460964989082e-01   +1.874534223811539e-01   -3.067080730599879e-01   +2.416891411042446e-01   +9.236863411822508e-01   -6.318298941603796e-01   +6.883184008936234e-02   -7.283816380003821e-02; +3.724524797365652e-01   +4.232786919001367e-02   -3.302114683225165e-01   +2.390690627649183e-01   +4.632539109867010e-01   +4.965280781395645e-01   +1.771453526559582e-01   -2.107225440393797e-01   +2.815694761401294e-01   +9.597061360107560e-02   +3.125647758058159e-01   +3.283664664196911e-01   +8.464060468329739e-01   +6.822623688716879e-01   -2.109414892282216e-01   +8.141974985894672e-02; +1.735225069053919e-01   +5.474565151400598e-01   +2.384438999747277e-01   -6.009684961787297e-01   -1.880071872755057e-01   -1.408576879215627e-01   +4.475123442173947e-02   -1.705712529337565e-01   +1.904402287325104e-01   -4.691491253574465e-01   +2.874203316251912e-01   +1.080753008771412e-01   -3.191219076605792e-01   +2.152267276917060e-02   -5.304667929994735e-01   -5.048027546977456e-01];
L2I_L2E_iAMPA_netcon = [+4.088874764319331e-01   -2.291388860021269e-01   -8.329035259517320e-01   +5.508811660875794e-01   -3.773732873698449e-01   +4.265170703323785e-01   +7.935461162236400e-01   +5.126902394708484e-01; -1.533334667222990e-01   -1.587642066293732e-01   +4.957748310775346e-01   +2.903822237889477e-01   -1.703606967513104e-01   +5.001785191579728e-01   -1.933873506225496e-01   -7.540291063921998e-01; -6.999420491188574e-01   +5.863916384570265e-01   +3.025037688078368e-01   -1.000000000000000e+00   -6.101617560591556e-01   -4.165533164083102e-02   -5.585219314501813e-01   +4.087777463510758e-01; -5.167653819713265e-01   -8.681616187228218e-01   -6.226860453185310e-01   -3.851987608137610e-01   +2.198239320742122e-01   +3.218573621793570e-01   -8.678753515826075e-01   -4.571663567485704e-01; -5.099248993412719e-01   +5.025689717903157e-01   -3.725853850986444e-02   -3.607718212512774e-01   +3.991778985873793e-01   -2.352004738155755e-01   +3.500599887096054e-01   -1.622424529604413e-01; +4.212561071504127e-01   +3.456936408388391e-01   +3.677964349842784e-01   -8.143069746536082e-01   +6.639987267018119e-01   -1.623025389863010e-01   -3.836623127226328e-01   +7.090639907049431e-02; +5.174314039035215e-01   +5.468230150981129e-01   -8.068063692086916e-01   +3.511396552725630e-01   +6.168257887956411e-01   -2.228684295899324e-01   -4.468062575778245e-02   -8.156400286855758e-01; +5.695231180810901e-01   -5.848182546973144e-01   -3.367962814923447e-02   -3.186891891678378e-01   +7.444612003632696e-01   -8.265880440428733e-01   +3.505957666144440e-01   -6.973728860783144e-01];
L2E_L2I_iGABA_netcon = [-4.658185091831252e-01   -6.054796424613351e-01   +1.461189085142178e-01   +1.874557312629068e-01   -1.303851592395542e-01   +8.241212563931619e-01   +3.612943908119710e-01   +3.627594465494691e-01; -5.299257678095088e-01   +7.476891203565584e-01   -1.373965527948635e-01   -8.160919644141834e-02   -1.762966192469570e-01   +2.488842219219112e-01   -7.777012962008745e-01   -3.628068631825531e-02; -3.689078553988783e-01   -7.773723770582509e-02   -6.286152081834855e-03   +4.530508298736816e-01   -3.379668407514321e-01   -5.370134652567264e-01   +4.364840877064876e-01   +7.469726020612676e-02; +7.232742836577620e-01   +9.360237475662154e-01   -1.688867631486645e-01   +3.779868719812552e-02   +6.411952078424832e-01   -4.731731054208678e-01   +7.270574740137231e-01   +3.627895338992388e-01; +1.453963902683959e-01   -6.441099759876624e-01   -5.349752308195737e-01   +3.681201554876616e-01   -3.216541410176963e-01   -7.242937829107059e-01   +1.000000000000000e+00   +2.903780586625254e-01; +5.173231147881734e-01   -2.223043481765757e-01   +8.716054523969013e-01   -5.761993976792063e-02   +1.036632419724265e-01   +1.154953258962926e-01   +6.564620253049069e-01   -1.086682643866117e-01; -6.998404844660318e-01   +1.384501469222833e-02   -2.367446978711941e-01   -4.165279275682569e-01   +3.021171315703257e-01   +1.041964818212770e-01   +8.217028360211399e-01   -3.186404793927405e-01; -8.250983635083899e-01   +7.380977850453642e-01   -5.094545815848566e-01   +4.091820021655140e-01   +2.977569134699427e-01   -3.571099616793331e-01   -1.385331894391168e-01   -2.575133277775506e-01];
L3E_L2E_iAMPA_netcon = [+5.660704630892412e-01   +1.547157856584362e-01   -4.426401152699904e-02   -4.820093233507063e-01   +3.278402769178969e-01   -2.805008403990650e-03   -4.551671837706208e-02   +2.749067558487534e-01   +4.388359034325041e-01   -9.170681924856915e-01   -5.803745525944030e-01   -6.506355383466979e-01; +2.031747994563300e-01   +3.455422264759946e-01   -6.010161970917841e-01   +1.534909231439571e-01   -2.685924234790993e-01   -8.170889930201141e-01   -2.311088401266055e-01   -3.811135340312495e-01   -2.116994671696608e-01   +5.953515025828278e-01   -8.421027989335758e-01   -1.930294633061135e-01; +5.452434566042221e-01   -2.556637757619151e-01   +6.238188327583132e-02   +9.661641033306566e-02   -6.883667954712438e-01   +1.368889276678348e-01   -5.580522924282666e-01   +6.185570458604535e-01   +5.790672598476581e-01   +3.240905284861985e-01   +3.833726476857948e-01   +8.247476197445049e-01; -1.582629011095396e-01   -6.345798440868573e-01   +3.009593956821572e-01   -1.000000000000000e+00   -4.554420587059496e-01   -1.592182735442413e-01   -7.544961094425232e-01   -4.957424372550100e-01   -6.768867508120712e-01   +9.893857928318477e-02   +4.790595369230749e-01   -5.114041210600581e-01; -6.675899814353603e-01   -4.195389671971338e-01   -3.912917375334597e-01   +6.519444390525214e-01   +7.321876488472352e-01   +1.347981554127294e-01   -3.055710256022685e-02   +3.384983019803774e-01   -7.506403688258589e-01   +4.213703815954057e-01   +4.603781274709051e-01   -5.053124701689040e-01; +6.037287921198734e-01   -1.730409586066620e-01   +2.914862632365030e-01   +7.865746814407371e-01   -3.742760535492544e-01   -5.175484523488664e-01   -4.083343829662145e-01   -6.727496209376196e-01   -5.969106538350469e-01   +2.934913284467848e-01   -5.369931353698270e-01   -6.486719147581956e-01; -2.982271055223838e-01   +2.550433343516431e-01   -2.663051083688696e-01   -5.005517739792519e-02   -3.748331130538265e-01   +1.185483213702773e-01   +4.178326832547162e-01   -2.205745563748943e-01   -5.229818420724957e-01   +6.073989666572127e-01   +3.912534714273777e-01   -2.924556586942592e-01; -4.210483596136349e-01   -2.654462201097219e-01   +1.348646698459965e-01   -9.497659105945081e-03   +2.670958106567188e-01   -2.424577228271254e-01   +1.114089078232843e-01   +1.324129024871446e-01   +1.784122615807723e-02   -1.259596771535405e-01   +4.589850448395769e-01   -9.507670719114025e-01];
L3I_L2I_iGABA_netcon = [+7.275865829966036e-01   +6.123585838164481e-01   -1.417648234544245e-01   +2.575661033408727e-01   +3.761284244327738e-01   +2.774114642909351e-01   +6.992054350370147e-01   -6.195465744699674e-01   +2.269358838647696e-01   +3.283799529189660e-01   +2.940573420113849e-02   -5.731468642783027e-01; +1.488514448204627e-01   -3.423454534547083e-01   -2.658045941899935e-01   +4.699528140885238e-02   +3.889131367237895e-01   +2.242249024758891e-01   +4.065992163345510e-01   -5.639316568766242e-01   -4.484240687334472e-01   -4.065344881236380e-01   -1.000000000000000e+00   +1.513897500291734e-01; +4.448241342418326e-01   +3.614968074520534e-01   -4.896935358090586e-02   +3.453514666407967e-01   -2.794031467904748e-01   +2.596620492174597e-01   -2.915497808783373e-01   +6.054294668693699e-01   +5.131500356706545e-01   +2.823602702642043e-01   +1.057954714846367e-01   +5.348658768422813e-02; +1.523002402902141e-01   +3.250125532963242e-01   -6.932671752503164e-02   -2.116405011169879e-02   +7.839545698680079e-01   -5.767513558139076e-01   +8.996435036888351e-02   -9.842388177547983e-01   +2.455786885428427e-01   -3.271292775493195e-01   +1.408016454319037e-01   +2.573156692484011e-01; +2.556361955758431e-01   +6.561658587372283e-01   -6.094008974291378e-01   +2.210598719424420e-02   +3.215052505871937e-01   -5.797620231435942e-01   -1.328192692472119e-01   +1.529704359644199e-01   +4.344503940910775e-02   -6.260124865174119e-01   +6.732416899611003e-02   -5.418791528913320e-01; -4.825192376163377e-01   -2.462042571547143e-01   -5.951144296698052e-01   -3.948501211062609e-01   -3.807307348652486e-01   +6.409033784959975e-01   +3.100394139305386e-01   +8.825279589670074e-02   +6.514142086891777e-01   -5.564668919210966e-01   +2.817068691859296e-02   +2.924110774637338e-01; +4.747438083793665e-01   -4.992048078265824e-01   +1.343007197152275e-02   -6.386764272198009e-02   +2.933943889536415e-01   -6.004171779490435e-01   +3.959042680975811e-01   -2.776235496201035e-01   +2.221065782394862e-01   -4.784889319541155e-01   -6.786632552286240e-01   -7.217166476838388e-01; -3.480832499266483e-01   -6.999598470916082e-02   +6.961404383935820e-03   +3.525344589711764e-01   +2.739602669241131e-01   +1.040398617925307e-01   +4.160347714310652e-01   +5.084311213341299e-01   -8.394675335292903e-01   +3.804398247775177e-01   -4.309461339120991e-01   +4.611225083869315e-01];
L2E_L3E_iAMPA_netcon = [+6.396218101306769e-01   +6.815371140417286e-01   +2.097753246314500e-01   +4.009308032209883e-01   -8.179697002351001e-01   -3.304428242297022e-01   -4.603552631703033e-02   +5.665694205492655e-01; +1.298375920335170e-01   +3.698215457508874e-01   -1.564346956851293e-01   -3.144039226757604e-01   +4.327905931808991e-02   +3.863923508302093e-01   -3.742009365194115e-01   +5.213838526055634e-01; -2.959637581520145e-01   +4.174985315115735e-01   -1.739183471352518e-01   +4.000652779803657e-02   +6.108576587726749e-01   -8.357641170411539e-01   +2.289979202432475e-01   +2.764045477319228e-01; +7.688426572792479e-01   +4.422486184951223e-01   +7.848369016209030e-01   -8.499109351092344e-01   -2.873332710580409e-01   +1.861550877124228e-01   +4.602273835285019e-01   -9.734962333297184e-02; -1.916933370601286e-01   -4.054411285822345e-01   +1.229205584098539e-01   -3.461788774865796e-01   -2.360203506138276e-01   -9.363696755106307e-02   -4.486843850977771e-01   -1.153348262981620e-01; -8.928961263112970e-01   +5.394885620734076e-01   +8.589353770410598e-01   -1.737224427795421e-01   +3.783935817854317e-01   -3.940437204617348e-01   +1.193865561795021e-01   +3.688936871975413e-01; -2.018834477098849e-01   +4.281691734915444e-01   -8.153881568788462e-01   -3.596017481501556e-01   -2.512310484481146e-01   -5.721020435428149e-01   -3.708184334847681e-01   -1.237667820229646e-01; +5.526780855218290e-02   -3.900828757278393e-03   +1.526026082780026e-01   +1.000000000000000e+00   -8.140221665658417e-01   -7.153684308857543e-01   -6.365795348072725e-02   -1.980830038609996e-01; +2.357987345230168e-02   +2.848880713854173e-01   +4.791387996663076e-01   +4.347389192882954e-01   -2.237370853766803e-01   -4.166307918516504e-01   -2.706195557329670e-01   -9.301510254763087e-01; +1.614791317464261e-01   +7.299293936667266e-01   +3.962994276247475e-01   +3.998077420926539e-01   +5.855377676464345e-01   -7.716451735501575e-02   +1.826013448281395e-01   +5.138849894766848e-01; +2.149822114227684e-01   +3.376327093853503e-01   -6.678667329107223e-01   +2.000860299148963e-01   +6.782085374080815e-01   -6.787592499534332e-01   +4.962750160958998e-01   -2.875328220078726e-01; -2.604000990729631e-01   -2.077826630678558e-01   -2.514284482487808e-01   +5.638824543749092e-01   -5.327689049673233e-01   +5.036702230753654e-01   -5.622002351011752e-01   +5.389578680829653e-01];
L2I_L3I_iGABA_netcon = [-6.314631759839590e-01   +3.572226665321466e-01   +3.527966968359081e-01   +8.933143290916769e-02   +6.056131605898437e-01   +2.879177462599565e-01   +4.200647700272110e-01   +9.720059649166021e-02; -2.504208245427319e-01   +3.291220523776802e-01   +2.396648189313382e-01   -4.336087252177258e-02   +1.760670387440919e-01   +2.436703570040311e-01   -6.444741276539494e-01   +5.763289480104901e-01; -3.206793253457583e-01   -3.505172205031508e-01   +5.368964662376462e-01   -3.658181117007102e-01   -2.501976969644745e-01   +7.623901156882024e-01   -2.409661161251863e-01   +3.499050679017284e-01; +2.396836629231497e-01   -2.611312997525721e-01   +4.918145786208154e-01   +2.097165164455508e-01   +1.891449030365185e-01   +1.825248286840845e-01   +3.837161664756121e-01   +3.741093043617593e-01; +3.895052255774611e-01   -1.388792658566076e-01   -2.229663955997945e-01   +1.366068291667038e-01   +6.734577577717280e-01   +4.362189406898656e-01   -1.964535088819552e-01   +9.327320481562514e-02; -5.276476181744002e-02   +4.274055743103425e-01   -1.000000000000000e+00   +5.226690928466248e-01   -3.259240230948162e-01   +5.511661287382750e-01   +3.699228081493920e-01   +5.907642720246034e-02; -4.462114917218046e-01   -4.880353482733851e-01   +4.449097887409788e-01   -5.301400255448849e-01   +1.999340100915776e-01   -4.106798767638297e-01   +7.539449717704070e-01   -2.070655842439404e-01; -5.104928898766401e-01   -6.744537476047077e-01   -4.198574808010789e-01   +3.800061339861724e-01   -6.275918333546271e-01   +4.597697375628243e-01   +3.724159582183159e-01   -1.738726703188345e-02; -5.679987612197994e-01   -1.627291451190773e-01   -4.636749924008005e-01   +1.530079135677317e-01   -1.857193795290113e-02   -5.010085805675869e-01   -3.335562247494164e-01   +2.765829680690652e-01; +1.095227244969498e-01   +3.857167683012441e-01   +3.685007212555180e-01   -4.290401254364011e-01   -2.623933473601597e-02   +2.369259167319839e-01   -3.434382031667298e-01   +5.305758765104671e-01; +4.484963539743563e-01   -1.789359478259797e-01   +4.291992662219721e-01   +4.019746424575478e-01   +3.954173794447973e-01   +9.923730651793029e-02   +1.297053399277824e-01   +3.343286888688343e-01; -7.938897816976144e-01   -6.487593196186188e-01   +5.338587144809611e-01   -4.682761817945870e-01   -6.559730344691213e-02   +5.856851246367193e-01   +9.831959268492058e-02   -1.952268580411576e-01];
L3I_L3E_iAMPA_netcon = [+4.031463359534941e-01   -1.354693779343065e-01   +3.152935387006006e-01   -4.416952153337538e-02   +2.230701571398656e-01   -4.625065710048803e-02   +3.354461978703778e-01   -3.772585186938987e-01   +4.260167982387830e-01   -4.472488359562665e-01   -3.592928210716100e-01   +4.254110235231540e-01; +5.465556916418884e-01   +5.387870061539035e-01   +8.499620542778138e-03   +3.379460622825676e-01   +8.875005122729983e-01   +6.675633708988739e-01   +5.116571088497786e-01   +5.320247198182049e-01   -3.386126895237990e-01   -8.517875483583761e-03   -5.142407990976287e-01   +2.360774120275947e-01; +3.840902657335023e-01   -5.230034338720444e-01   -3.950774014274707e-01   -3.749275637812862e-02   +4.754702157707074e-01   +4.572620326306068e-01   -2.565994820538808e-01   +2.434678822543206e-01   +2.258995362263958e-01   -4.475366529922082e-01   +3.563353739101771e-01   -1.416213878513522e-01; +5.072946033471125e-01   +3.911700679931134e-01   +4.872902051734317e-02   -8.315575590861087e-01   +1.318324419095151e-02   +5.517384929702833e-01   -3.968605216688089e-01   +8.458853857264558e-01   +3.964218030789127e-01   -1.555977331584892e-01   +6.316054871116704e-02   -9.178988509863378e-02; +5.361560998886465e-01   -7.833392054814725e-01   +5.747146169229329e-01   +9.489506645558642e-01   +9.450620148866208e-02   +2.708600344197596e-01   +1.185914424463505e-01   +2.062925393928129e-01   -3.258316764879072e-02   -1.000000000000000e+00   -5.962810905280336e-02   +4.846032127994492e-01; +2.391448210020218e-01   -2.538813899471377e-01   +5.205985028685878e-02   +6.018621751886151e-01   -4.988353438377130e-01   -1.461047608556317e-02   +1.351368489441877e-01   -1.934575589712983e-01   +1.799443401074482e-01   -4.737998130934162e-01   +3.894375814280838e-01   -1.371592195846968e-01; +6.821539642985911e-01   -2.858245800303172e-01   +2.840599743074098e-01   +6.998184712176865e-01   -3.755171321378345e-01   +3.024644609104390e-01   -4.848414121937061e-01   +2.418331685805873e-01   +4.422395533268312e-01   -1.011501588934196e-01   -4.068758692297529e-01   -1.594036726253047e-01; +4.856864220100482e-01   -3.571027844431440e-02   +4.250368154814615e-01   +1.560182649293310e-01   +2.030874593476284e-01   +2.316475919004322e-01   -6.856308840995182e-01   -6.062661192597045e-01   -5.925749144263366e-01   -2.655171689000787e-02   +4.233047690101563e-01   -3.521871602951223e-01; +6.000264030261371e-02   -1.199499781535959e-03   -4.281202711340993e-01   -2.137292574993686e-01   -5.295325575621878e-01   -2.386666944428164e-01   -1.693181747517946e-01   -7.030106550795354e-01   -2.937165323744988e-01   +6.861850286646189e-01   -2.349815858570980e-01   -3.413245730608291e-01; +2.453898654265694e-01   -4.435473088384819e-01   +4.006056947385853e-01   -5.140178389512040e-03   +3.323911032533533e-01   -5.304402189241219e-02   +2.704703469375602e-01   +1.124883029949863e-02   -2.972371819278548e-01   +2.629034576434958e-01   +3.021443653392223e-01   +1.493862971403607e-01; -1.054156316980870e-02   -5.287892484867101e-01   +2.298262503166755e-01   -1.309577245375407e-02   +6.815556306734506e-01   -2.157473366209111e-01   -2.130573807060788e-03   +8.420822393258448e-01   +2.156204494404723e-01   -6.441263413849695e-01   -1.291719387302280e-01   -6.789903619769510e-01; +2.865396125121086e-01   +1.339643107707952e-01   +8.920564496850267e-02   -6.053978782737577e-01   +4.347235741319731e-01   +3.361687686621725e-01   -2.268057502900485e-02   -1.238945907821796e-01   +1.574185781576252e-02   +5.805139776407023e-01   -2.338034052167350e-01   +1.411738623682891e-01];
L3E_L3I_iGABA_netcon = [+2.468489890118822e-01   -5.230109104444407e-01   -1.539083617125725e-01   +1.785142675676055e-01   -4.204817081946354e-01   -1.412374032947638e-01   -3.074958935020343e-01   -7.456022192779306e-02   -1.630850785492867e-01   +2.254115865828319e-01   +4.975670143935813e-01   +3.932194716987152e-01; -5.658642435408566e-01   -4.496213542274760e-01   +2.078833423039590e-01   -3.180317452778321e-01   +2.041440637433531e-01   +4.290698790642979e-01   +6.431758541267245e-01   -2.668118387426890e-01   -2.641064337090273e-01   +5.800330747394842e-02   +4.323946905866895e-02   -7.248974345625392e-01; -9.750122060864289e-01   +7.354240073302952e-01   +9.180330151864124e-01   -2.340514094178598e-02   +3.747723878375393e-01   +4.328489926672454e-01   +2.532999445925793e-01   +3.474466619630781e-01   -2.457709425712751e-01   +1.402426320271061e-01   -6.421552718786376e-01   +2.096599696191740e-01; +5.259541004920506e-03   -9.222095304119650e-01   -5.010513869082686e-01   -1.604782119078355e-01   +2.652125061400483e-01   +6.068376236428878e-01   -6.382437547699479e-01   -6.185484643003101e-01   -4.042427574192247e-01   +1.448825252671934e-01   -4.261494317034725e-01   -4.596986586666668e-01; -1.000000000000000e+00   -5.423186456467252e-01   +3.911902931456150e-01   -4.198542504549803e-01   +7.883100378937334e-01   -2.955582898198057e-01   +5.024968772940129e-01   -5.117822528066782e-01   +8.385869010777388e-01   +7.285661563071147e-03   +4.608927546209901e-01   -7.633597410758713e-01; +1.833848928252382e-01   +6.124236708811580e-01   -2.944318474751605e-01   -4.149901247203843e-01   -3.108736021965467e-02   +3.118057492266207e-01   -7.703566931399372e-02   +2.139232259789453e-01   -9.045255161029929e-01   -4.279597581553770e-01   -5.670515512476495e-03   +1.808947897285418e-01; +5.682366967986068e-01   +1.370881580326998e-01   +4.101321195795036e-01   -7.750880570354418e-02   -7.642953713614931e-02   +6.969359968152616e-01   -8.602990938275207e-01   +8.793338604882792e-01   +1.209796710911055e-01   +2.908077322144387e-01   +1.971155759885600e-01   -3.949796543892473e-01; +1.536240099854944e-02   +8.028751072391095e-02   +2.564306220001861e-01   +2.422157102673703e-01   +4.443422887958502e-01   -4.355131353301732e-01   +5.210848761459691e-01   +8.875491661332739e-01   -7.333597967040335e-01   -8.804347553909515e-01   -3.363688593213182e-01   -2.292298491898471e-01; -5.870417191285198e-03   -2.274719546601970e-01   -3.834998076217655e-01   +2.761278621272721e-01   +3.467377688116970e-01   -8.384012164393938e-02   -1.995480475943321e-01   -5.011098901561853e-01   -5.044209363719432e-01   -4.882325974346612e-01   -3.080589038101391e-01   +5.963618239993604e-02; -7.215699233068927e-01   -4.376282713478915e-01   +4.111871626860449e-01   +1.171151787207924e-01   -4.893574691354943e-01   -2.225112115598430e-02   -2.337038908946040e-01   +5.234859601279142e-01   -3.143999229010165e-02   +1.624351308093338e-01   -1.261268901399069e-01   +7.175225859394107e-01; +5.631268312604008e-01   +2.904985722960405e-01   +2.936917205419448e-01   +1.060780799603697e-01   -4.573647161274881e-02   +8.098366612496001e-01   -4.391519576226948e-01   +5.953199295056675e-03   +4.035576694111981e-01   +2.998226425263328e-01   +3.414148636053818e-01   +6.629429067617585e-01; +5.174744727436171e-01   -3.299574557537448e-01   +3.815103243754065e-01   +3.203107526670740e-01   +4.733196817449605e-01   +1.422077874304866e-01   -3.705616078600611e-01   +1.150942161485142e-02   -1.059889145338428e-01   +1.254060131594005e-01   +9.002980161781324e-01   +9.645455265046418e-02];
L2E_Input1_iAMPA_netcon = [+9.602595310910089e-02   +3.242044001927907e-01   +5.093578203070568e-01   -8.399020037497957e-01   -1.686527347115319e-01   -4.454922412840047e-01   +2.928936722246166e-01   -5.218301489172767e-01];
L2I_Input2_iAMPA_netcon = [-5.793042888944665e-01   +4.699102916249312e-02   +8.024731142981406e-01   -1.070837982734412e-01   -7.331851083410654e-02   +3.815392742276461e-01   -5.031088494715468e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
