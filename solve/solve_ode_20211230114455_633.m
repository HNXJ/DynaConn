function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.057809422957466e-01   +1.503018362590614e-01   +3.128054531475416e-01   -1.389335796605133e-02   +3.878111001097774e-01   +3.855910197453986e-01   +2.362543558773188e-01   +2.634472566993338e-01   +6.385022174624259e-02   +3.157020587892647e-01   +2.714526708471247e-01   +1.545443261328273e-01   +6.029771627168825e-02   +3.597495272763772e-01   +1.309348372886467e-01   +2.724608258112882e-01; +3.157950464688901e-01   +4.140892513782986e-01   +1.500896421299689e-01   +2.104571743200721e-01   +3.240163724148432e-01   +6.927866543833749e-02   +2.232195852610146e-01   +1.638280073763497e-01   +2.230335414368077e-01   +3.432829548839219e-01   +3.250571079802914e-01   +3.088177641826657e-01   +2.810068754451889e-01   +2.311522205153294e-01   +2.205915921155666e-01   +2.765560437734619e-02; +1.771978829706365e-01   +7.024381876130932e-02   +2.923344794035084e-01   +5.940266887803079e-02   +1.182892462150107e-01   +4.238429505746547e-01   +1.535800360512452e-01   +1.887619494502368e-02   +3.538520179222248e-01   +3.882884097302100e-02   +1.882641004638803e-01   +3.646956514672402e-01   +1.743574251618628e-01   +2.320030115587657e-01   +3.287433461730719e-01   +1.358755647327091e-01; +2.879596332122182e-01   +7.212153506079816e-02   +3.105689469156456e-01   +3.455572609810301e-01   +2.152213496100646e-01   +1.017380375762228e-01   +1.100678351218143e-01   +7.270818437216853e-02   +2.663425193210555e-01   +2.556294528775320e-01   +1.648219802986935e-01   +7.788077874013155e-02   +9.375894553853259e-02   +1.428486826514060e-01   +3.498995212056616e-01   +3.564632999902170e-01; +3.086585108359781e-01   +2.150851681312143e-01   +3.743080063362670e-01   +1.564206193271901e-01   +1.401338847782057e-01   -1.358129194542261e-02   +1.908177536932392e-01   +3.860924727876149e-01   +2.552406948387096e-01   +3.413775461985801e-01   +4.440686411890164e-01   +1.874697760877543e-01   +8.253881334584295e-02   +6.280575040201575e-02   +4.257835732617968e-01   +1.753422959655374e-01; -9.655276352337772e-02   +1.647993304424100e-01   +3.643393395062443e-01   +1.598883772723869e-01   +1.295626993704736e-01   +3.616843418733467e-02   +2.522536982596404e-01   +2.353211323436279e-01   -2.351085490707699e-03   +8.916589189951823e-02   +4.682858375979628e-02   +1.399396186047700e-01   +3.904612784832642e-01   +1.066574017547122e-01   +3.697407734861290e-01   +3.154737944977151e-01; +4.689273303992838e-01   +3.298435631881661e-01   +3.722208394489380e-01   +4.137968532108042e-01   +1.873585613283118e-01   -1.289482212595743e-01   +6.169524228212915e-02   +6.472023710324343e-02   +3.368732678373989e-01   +1.638528824373199e-01   +2.188496242827696e-01   +1.479532076216945e-01   -4.028577411353965e-02   +2.788049650656404e-01   +2.310144941563647e-01   +3.376802984719087e-01; +3.131971645986034e-01   -6.691407424266804e-02   +2.131236666268388e-01   +3.296291671990619e-01   +4.355039594727864e-01   +2.859891548902772e-01   +1.504013408989427e-01   +1.307566738014808e-01   +1.356032531352169e-01   +2.702944828494829e-01   +1.183409034061372e-02   +2.611624238464262e-01   +2.595798890749637e-01   +2.316139686911441e-01   +5.783945932570019e-02   +3.074092624876387e-02; +2.597835202047812e-01   +2.802836800399575e-01   +3.282799610222831e-01   +2.280275515949813e-02   +4.623503238693871e-02   +1.192744112040303e-01   +2.458390676077028e-01   +4.466376058253892e-02   +3.460328162709691e-01   +5.517051676481721e-02   +3.758241780064315e-01   +2.309239904368343e-01   +1.860231386051764e-01   +2.479503760119472e-03   +3.608847967249223e-01   +1.380926696389175e-01; +2.823151792731533e-01   +4.193772269783412e-01   +3.464007455150481e-01   +1.747961151672804e-01   +2.789462900847376e-01   +1.922452797573991e-01   +3.819284101994396e-01   +3.926738648765198e-01   +4.006727179469006e-01   +1.455204507495967e-01   +3.642865202684366e-01   +3.334092229439906e-01   +2.653183645359005e-01   +2.971256337818993e-01   +3.348819329674579e-01   +2.802574329426430e-01; +1.448909962388165e-01   +3.702725781426236e-02   +7.346328548501015e-02   +3.182595405600476e-01   +4.221405276936868e-01   +8.051052440579516e-02   +4.625737775314997e-02   +1.960137723932911e-01   +2.748735031312782e-01   +1.879023924614442e-01   +2.468009290114612e-01   +4.092731915555269e-01   +1.419261203761231e-01   +1.134166143815070e-01   +1.544115682265874e-01   +1.737756350448096e-01; +2.884199732990728e-01   +2.922103877501477e-01   +2.747581564656275e-02   +1.972622445397505e-01   +3.376102266396497e-02   +1.631376768148490e-01   +1.349317653410581e-01   +9.702961561166994e-02   +2.974983602577108e-01   +6.554751932489813e-02   +3.620070267411522e-02   +2.010414233230405e-01   -4.531573427649448e-02   +3.963732896337170e-01   +2.935220333298375e-02   +4.233284395543251e-01; +4.872333414969658e-02   -2.934012874272515e-02   +3.076290541615656e-01   +3.588262021454793e-01   -5.750376502371204e-02   +4.007968986466358e-01   +1.776745883496075e-01   +2.161070532759415e-01   +1.315705317959612e-01   +1.022825193484823e-01   +2.994690137995689e-01   +1.892945610970315e-01   +3.184390529405814e-01   +3.103442530412914e-02   +1.032476816924395e-01   +3.129282121464663e-01; +2.432478822719606e-01   +4.167270106888985e-01   +5.744231313909010e-02   +3.672501661070019e-01   +3.409492221953245e-01   -8.142774558059201e-02   +2.250836672446117e-01   +3.059173093649339e-01   +3.159560555123059e-01   +4.199974798715949e-01   +3.961679391302054e-01   +1.585729323753183e-01   +9.048798927165130e-02   -3.312560596150144e-02   +1.776013326032024e-01   +2.513175401992917e-01; +2.312564323838835e-01   +5.394587730414228e-02   +3.628061261076541e-01   +3.571139181833984e-01   +2.203043414450289e-01   +1.931014228611271e-01   +2.172602353294949e-01   +1.874181151204720e-01   +3.374188006718577e-01   +4.520648133593892e-01   -3.499438119000913e-02   +1.284518728961649e-02   +8.010180601345293e-02   +3.202239358707927e-01   +4.472138695035953e-01   +1.512277019487572e-03; +1.472148179250741e-01   +2.990389103616456e-01   +1.398319763565389e-01   +1.489229162360343e-01   +2.300695714948171e-01   +2.890077625812816e-01   +2.509115690504958e-01   +1.571981070067572e-02   -1.541703223076943e-02   +1.729328798269573e-01   +6.227009629410005e-02   -7.386655609098947e-02   +1.733140869586775e-01   +3.437157484113251e-01   +3.637846247566784e-01   +3.834475835341701e-01];
L1E_L1I_iGABA_netcon = [+2.255620134795712e-01   +1.866864930619370e-01   +3.338308488112646e-02   +5.215649255592787e-02   +2.206627793066412e-01   +1.246592428608884e-01   +1.393644824093651e-01   +1.605143481777722e-01   +3.120501939535988e-01   +9.366743416805373e-02   +1.803574331921163e-01   -4.181341851401996e-02   +1.294043902941319e-01   +1.257421620120560e-01   +6.588559644118433e-02   +1.468804937209807e-01; +1.814275845025593e-01   +1.041609388857423e-01   +3.629581139688156e-01   +8.648025958355318e-02   +2.554701222689043e-01   -4.415570684056639e-02   -1.851918221836776e-02   +6.718364890404797e-02   +1.819263734005321e-01   +2.293853833496823e-01   +3.561906901905876e-01   +2.618427637025986e-01   -5.610106880059411e-02   +1.627572203784273e-01   +4.052868789874661e-02   +4.127959174253236e-01; +2.751575032782114e-01   +2.968706323673565e-01   +3.167673570652623e-01   +2.731507317182824e-01   +4.093787260286502e-01   +4.389673442069355e-01   -2.522689091861551e-02   +1.784181718930670e-01   +1.861737654529722e-01   +4.094148135497521e-01   +2.636647603335037e-01   +4.007939479793322e-01   +1.875801413676840e-01   +4.488523648141442e-01   +4.436655886260503e-01   +1.791900610260529e-01; +1.329187872228270e-01   -1.891245870636843e-02   +1.048835691920241e-01   +4.242416785898611e-03   +1.642397250516810e-01   +3.159785409428947e-01   +3.051192890721441e-01   +3.047034382499483e-01   -6.528047193242320e-04   +2.510389298178196e-02   +1.153297518145608e-01   +1.887387790744791e-01   +2.854903197202396e-01   +1.188760505375594e-01   +1.193837665863114e-01   +7.082743152679527e-02; +1.126669388846927e-01   +4.220177565787946e-01   -1.123385157279554e-02   +2.468169558009500e-01   +1.635457435259664e-01   +2.952990503161496e-01   -3.227252368123679e-02   -7.630355604196955e-03   +4.136203836673112e-01   +2.819911893441241e-01   -7.334489978165204e-02   +3.457668259048666e-01   +3.801856391142291e-02   -4.748738211566322e-02   +2.966936241892946e-01   +1.833612740724405e-01; +3.616418672734975e-01   +1.346998223917166e-01   -2.833450474464059e-02   +5.776864310084236e-02   +1.669139886640984e-01   +3.157060488024492e-01   +1.767013162895419e-01   +2.509555161993902e-01   +2.720524811329139e-01   +2.729704052628293e-01   +1.944788132292588e-01   -4.300177108575020e-02   +7.575126285154068e-02   +3.240349327231381e-01   +4.200339986253405e-01   +2.820529004579657e-01; +1.045481833580833e-02   +3.615065988245872e-01   +1.438278848383460e-01   +4.398023993784264e-01   +3.755450445996756e-01   +3.054269191775325e-01   +4.890100670985004e-01   +2.262358251781129e-01   +1.535639615712629e-02   +1.295400090340506e-01   +3.502956386409396e-01   +2.152928480119110e-01   +1.073219622883894e-01   +8.844687613448786e-02   -1.186582782263134e-01   +3.589424498435022e-01; +2.463611083067364e-01   +1.042802462874343e-01   +3.283193197191392e-01   +1.977175592943205e-01   +2.028714247531340e-01   +2.161623734776085e-01   +2.757099719986075e-01   +1.768994865443610e-01   +2.440190287352246e-01   +6.965650022726620e-02   +1.703101104961162e-01   +2.441967398528891e-01   -5.915721638056821e-02   +4.720491902433369e-01   +1.459229967527880e-01   +3.320995216037257e-01; +1.326866478520914e-01   +3.749616066745645e-01   +3.472382576020624e-01   +3.609158417197844e-01   +2.567532192014689e-01   +1.743132837855135e-01   +7.261044927483770e-02   +1.490362608540777e-01   -1.025615953827709e-02   +5.784866613596154e-03   +3.410850243123716e-01   +3.181090017763411e-01   +2.731267159111231e-01   +1.499245594133609e-01   +1.217888198838744e-01   +4.686928226266472e-02; +1.161440717890525e-01   +4.465129159499597e-01   -1.477402515356052e-02   +3.777226652956232e-01   +1.884050636722486e-01   +2.397903981641832e-01   +9.536005920065653e-02   +1.929087685148135e-01   +7.224551985320776e-02   +7.725432924199402e-03   +7.674279134283671e-02   +1.484075610791956e-01   +1.390359734013124e-01   -5.457739691847656e-02   +6.965216203556690e-02   +1.664826191110624e-01; +3.395334147909335e-01   +3.829833077195480e-01   +3.661784547509863e-01   +1.342035018949085e-03   +3.739388507150497e-01   +8.538735416401355e-02   +3.608546525325668e-01   +1.841198290725314e-01   +1.471889537656541e-01   +1.014445731608283e-01   +3.440042474665548e-01   +3.187379949118769e-01   +3.861307956569388e-01   +2.127359551724553e-01   +2.444131242384975e-01   +1.200923495546322e-01; +3.288230980272476e-01   +1.220778188607548e-01   +1.740300974872331e-01   +2.371250323974440e-01   +2.568706562676237e-01   +2.243984969672011e-01   +4.176794748090515e-01   +5.395612836732776e-02   +2.924814869507433e-01   +9.615336505999221e-02   +3.818791384605814e-01   +3.587719125009746e-01   +2.735641491442923e-01   +2.938243710451151e-01   +6.351416721579031e-03   +4.520313792240335e-01; +1.610468728175355e-01   +2.732342065773887e-02   +3.917239103989473e-02   +7.978658555138558e-02   +1.808176830938323e-02   +1.076836670015796e-02   +1.260306087812801e-01   +4.732897890214599e-01   +7.642839074700805e-02   +3.326414231162417e-01   +1.739216966239055e-01   +2.177205502792642e-01   +1.294932300607844e-01   +1.045944878825785e-01   +2.312444256989223e-01   +2.599687842126340e-01; +1.739594750137681e-01   +3.301779392432200e-01   +3.966032732982254e-01   +8.495957944275531e-02   +3.557975764583872e-01   +1.105329933867976e-01   +3.844192086495012e-01   +1.693226458848263e-01   +1.737666010770367e-01   +1.513339397812431e-01   -1.356353217465302e-02   +4.519326628611186e-01   +1.447501371041669e-01   -4.681635601413089e-03   +5.171412658949195e-02   -8.005621119725713e-03; +4.234802904308446e-01   +2.821827182285143e-01   +2.163812862888239e-01   +1.067502646260822e-01   +1.275506030799630e-01   +2.118244336194859e-01   +4.365966685374502e-02   +9.685109712822546e-02   +7.162887974143139e-02   +8.494949239160196e-02   +2.261360483207283e-01   +1.871638795299471e-01   +3.761598006867209e-01   +1.726095457753839e-02   -2.137394348055260e-02   +9.623064513939536e-02; +3.609617867351129e-01   +3.111135674516879e-01   +3.869113914446946e-01   +7.005813997456214e-02   -2.212221634410382e-02   +1.133757301819485e-01   -6.659545057773776e-02   +3.429607029670413e-01   +2.156846932471310e-02   +2.572849380771122e-01   +1.718535655249943e-01   +3.256854602945278e-01   +1.484061353527453e-01   +2.219210476840403e-01   +3.599239977901318e-01   +3.392877152457586e-02];
L2I_L1I_iGABA_netcon = [+3.846497649942874e-01   +1.563948163194577e-01   +9.593587958208645e-02   +3.384047230171507e-01   +1.690386907966568e-01   +2.548873529651847e-01   +1.237165527361559e-01   +3.934975345888761e-01; +1.301032120358987e-01   -5.536224003755044e-03   +5.408649967537872e-02   +2.130424698442972e-01   +1.544027597651899e-01   +1.921362887206936e-02   +2.258251193196746e-01   +1.083795052821809e-01; +1.744038601731891e-01   +2.759519428353924e-01   +2.615142179581820e-01   +6.578607859997296e-02   +3.361717832528901e-01   +3.397666888897796e-01   +2.378698036206613e-01   +4.686395368066863e-02; +4.163574614001823e-02   +3.598882577447765e-01   +1.460143550918236e-01   +3.997437486594588e-01   +1.050104514881142e-02   +3.125395026599201e-01   +2.740315484409183e-01   +8.367569362506100e-02; +3.324516944129338e-02   +9.851791558966722e-02   +2.082016949316821e-01   -4.254248792110708e-02   +2.608783761574442e-01   +2.144690562221839e-01   +3.101961574607042e-01   +2.236603342605243e-01; +1.781288682480693e-01   +2.743188481708126e-01   +5.181036711788397e-02   +7.544713770179212e-02   +3.585108796287468e-01   +7.659386164732768e-02   +3.963131843220803e-01   +2.144983250989959e-01; +7.205061507480021e-02   +1.063047697524312e-01   +1.854705349232584e-01   +7.128735966325966e-02   +4.778926250454625e-02   +3.543827550951034e-01   +2.271144695589746e-01   -3.141286151676986e-02; +3.462168754388235e-01   +1.971101137406156e-01   +3.400349181230495e-01   +2.591830387623121e-01   +1.882753112251813e-01   +1.768268332603203e-02   +2.986711572338778e-01   +1.320039110442460e-01; +7.943448141099008e-02   +2.919407188762332e-01   +7.556039697730062e-02   +9.399046685592282e-03   -2.136586214271049e-02   +2.552725555936906e-01   +3.151437481571041e-01   +3.979710784088840e-04; +7.887142158793836e-02   +3.967692229454365e-01   +3.582285899142536e-01   -2.085205546408016e-03   +2.312429091408938e-01   +5.349665805891737e-02   +9.006043791541403e-02   +2.937056588688471e-01; -4.742517956985387e-02   +3.621506619081062e-01   +2.948135846395759e-01   -1.375518447202186e-02   +2.745069229693894e-01   +7.811795713853878e-02   +1.920584199542779e-01   +2.131844717200462e-01; +2.654887825205264e-01   +1.061456650836550e-01   +1.983376062920722e-02   -9.187942727021593e-03   +1.637410921888061e-01   +1.541962456251782e-01   +2.028165914007469e-01   +2.418581283274546e-02; +3.200276195453748e-01   +3.486181705234211e-01   +1.058228850299873e-01   +1.773257906261220e-01   +2.146545554792178e-01   +2.983564804963664e-01   +1.018382396082654e-01   -5.035027982452164e-02; +2.479985607760051e-01   +7.445508848135894e-02   +1.255534837813991e-01   +1.936609715753010e-01   +2.290135068486013e-01   +1.033914015723468e-01   +3.526456355971858e-01   +1.665924105504528e-01; +2.800395868079399e-01   +1.761996564270308e-01   +3.142913912115682e-01   +4.174782421254353e-01   +2.705505799813199e-01   +2.266380287269436e-01   +6.967109241760779e-02   +1.600387620903167e-01; +2.793275882261511e-02   +4.434218459678185e-01   +2.086250247722561e-01   +2.751489851627207e-01   +2.562031842540242e-01   +3.608949603486836e-01   +2.613743339220269e-01   +3.505150653024215e-01];
L1I_L2I_iGABA_netcon = [+3.001759218184026e-01   +2.724343271254700e-02   +4.070564658461657e-01   +3.033679184907761e-02   +2.070031820764836e-01   -1.098802926776719e-02   +4.559438889903827e-02   +1.701714250170504e-01   +3.949899116588346e-02   +2.249658011052249e-01   -1.321210534295681e-01   +1.219495975557107e-01   +1.680123670981194e-01   +7.377639047034938e-02   +2.826081232277915e-01   +7.727105157471187e-02; +1.843167393062841e-01   +4.082506847658252e-01   +1.310868616973885e-01   +7.712365014715458e-02   +2.270657583990758e-01   +1.253522938897054e-01   +3.868239565047084e-01   +2.864914296090922e-01   -1.217490549238007e-02   +1.381127214027099e-01   +1.817248122360345e-01   +7.619012446331688e-02   +2.033817621160145e-01   +2.132946089528291e-01   +6.804251471120906e-02   +3.934860572127911e-02; +5.179611633088103e-02   +1.525900444540304e-01   +9.409296022965155e-02   +3.993490297616730e-01   +5.075465480316367e-02   +3.038138190220597e-01   +1.449095146724666e-01   +2.093678375159796e-01   +4.301389849255922e-01   +1.149515454668439e-01   +1.521172065456814e-01   +2.952210277446271e-01   +5.806365107292005e-02   +2.449935618874943e-01   +1.128780084425201e-01   +3.345101663660630e-01; +1.318607861949093e-01   -5.676966003058719e-03   +3.750562437015106e-01   +2.094400536415757e-01   +7.248106520668891e-02   +3.227329643216071e-01   +1.823310048532662e-01   +2.727476713184626e-01   +2.053272270784420e-01   +1.684825186429554e-01   +3.935920700685696e-01   +1.364905389295027e-01   +2.474910376084042e-01   +3.677594610341691e-01   +1.563075220743924e-01   +1.503009508445468e-01; +1.249792146535952e-01   +3.856103479516348e-01   +1.083820155411281e-01   +2.639653038088427e-01   -3.065021500005276e-02   +2.624343115154006e-01   +3.563913766166599e-01   +3.403719319789007e-03   +1.635359134910383e-01   +1.888838781649212e-01   +1.444723879430040e-01   +1.765014194155719e-01   +2.869650490994469e-01   +1.250116137335284e-01   +1.840391913409570e-01   +1.359653969872067e-01; +2.383718004771502e-01   +2.929499677766178e-01   +2.393035755177732e-01   +3.033131170950205e-01   +1.181247068511430e-01   +1.872066851373483e-01   +8.764589786232024e-02   +5.639213104864207e-02   +3.904866989238351e-01   +3.468598368405260e-01   +4.309676771286483e-01   +1.875011670942184e-01   +3.133194971662673e-01   +2.058754009246571e-01   +2.600563539259982e-01   +4.168082472518591e-01; +2.840060614907976e-01   +2.720541593121883e-01   +2.771477418381019e-01   +3.610595902183134e-01   +3.173311641194498e-01   +4.001872368860452e-01   +2.672754716237615e-01   +2.712345638053305e-01   +1.584646794234117e-01   +3.914695588309517e-01   +6.455832411313281e-02   +1.088338281559836e-01   +5.777270464994686e-02   +2.085736941625219e-01   +2.960945090883794e-01   -8.799672971574052e-03; +3.317527296303733e-01   +1.328072337968782e-01   +4.042310253690062e-01   +3.822522384159956e-02   +9.818527143526498e-02   +4.248015156610066e-01   +1.095793555793834e-01   +2.610614992839708e-01   +1.382788721495651e-01   +4.367834748221719e-01   +2.840584174339517e-01   +2.730248579421565e-02   +1.152860285861809e-01   +7.987104859125932e-02   +2.521936650156279e-02   +1.050764485484878e-01];
L2E_L1E_iAMPA_netcon = [+1.581773550897410e-01   +1.723105739708857e-01   +4.068315128494979e-01   +8.989472348338841e-02   +4.681426554663382e-02   +1.439972106038926e-01   +1.090602393536463e-01   +3.513357347792576e-01; +2.530367011252784e-01   +2.606305813115589e-02   +3.746081663307512e-01   +2.760755116570054e-01   +3.619169306848332e-01   +2.427550788656862e-01   +6.163964079152115e-02   +1.771640416720013e-01; +3.067330511685963e-01   -7.794905566407342e-03   +1.148326762336232e-01   +2.877387871815977e-01   +7.425017223570242e-02   +2.286629490473676e-01   +1.960548403444699e-01   +3.566385816832680e-02; +2.747541522157178e-01   +1.981756986288630e-01   +9.450323295876514e-03   +8.508595496396323e-02   +1.168925598485746e-01   +1.094806130163061e-01   +1.045620631678756e-01   +2.940322180727528e-01; +1.137659920291484e-01   -4.312106539579154e-02   +1.469610118756330e-01   +3.199671537222425e-01   +7.350294565814899e-02   +2.390726274767026e-01   -3.920488313343071e-02   +1.743763341621662e-01; +1.700759493650218e-01   +2.255970397831251e-01   +1.839439730532170e-01   +4.301070553285676e-01   +4.265948332260834e-01   +1.729542787202467e-01   +2.660321282594099e-01   +3.580948381331114e-01; +2.986991452780668e-01   +2.330114886335201e-01   +2.883122994694352e-02   +2.926326209901833e-01   +3.927875695628577e-01   +1.678389945279884e-01   +2.267945524041790e-01   +9.096875906090182e-02; +4.494560549803189e-02   +1.569803744361486e-01   +4.758903981238488e-03   +3.630749582848483e-01   +1.081335112281797e-01   +3.103641982862437e-01   +2.371557984092268e-01   +3.563046867792896e-01; +7.457120376571676e-02   +2.048673836675872e-01   +1.768258174015681e-01   +4.147185033067151e-01   +8.432971649206714e-02   +2.753139695594349e-01   +3.056231436036337e-01   +3.965279000112024e-01; +2.173331916460102e-01   +3.745412743397213e-01   +1.237880798258352e-01   +1.860134375755003e-01   +1.383971870628201e-02   +9.289294873287718e-02   +7.185283336768811e-02   +1.531149639975100e-01; +1.674936257423586e-01   -6.064155832929644e-03   +1.953839505079593e-02   +3.666626617733744e-01   +8.549637377357550e-02   -3.617550219247729e-02   +3.005402382786023e-01   +5.485654767903943e-02; +2.118247679703971e-01   +2.305773366781108e-01   +3.120749348783246e-01   +3.101574812752130e-01   +1.705281406522953e-01   +3.269963980368319e-01   +3.782918384293957e-02   +1.928107640589245e-02; +1.272392791829985e-01   +3.325053706590148e-01   +4.648546335918066e-01   +2.613810174787708e-01   +3.257448238442840e-01   -2.541134379411132e-02   +1.736161931859843e-01   +4.296598169009245e-01; +3.858952731345955e-01   +2.425049711395038e-01   +4.000025546546599e-01   +8.108856738104445e-02   +3.910788313333948e-02   +9.971968697281929e-02   +2.907709347133831e-01   +3.300283820223395e-01; +2.104575751836489e-01   +3.655313669692362e-02   +3.417375202279105e-02   +3.256608282322709e-01   +4.291688199287075e-01   +3.720873621511182e-01   +5.714052783697524e-02   +9.850140957391587e-02; +1.530559619951177e-01   +3.962236095849009e-01   +4.930907255117387e-02   +2.353264965597290e-01   +2.899088534620439e-01   +3.818384264099902e-01   +1.130292388860253e-01   +2.453797274782634e-01];
L1E_L2E_iAMPA_netcon = [+1.976005986905225e-01   -2.623214267486628e-02   +4.053918981942719e-02   +1.442324053935009e-01   +3.665834126718546e-01   +3.870246810297671e-02   +1.263766527415024e-01   +3.128741937004612e-01   +5.139078963952661e-01   +1.485750598686339e-01   +3.415495659190078e-01   +3.341674543335807e-01   +5.518279749732338e-02   +2.106430498383855e-01   +2.298892269855612e-01   +1.515886473134335e-01; +2.768788883774638e-01   +2.342874973391069e-01   +1.465957761204174e-01   +8.581373032691532e-02   -2.885306837105888e-02   +9.499527454079944e-02   +5.072363092343830e-02   +3.230069377271153e-01   +3.939374058077894e-01   +3.707828890063028e-01   -9.268373371959893e-02   +4.163504623717566e-02   +2.740916464324992e-01   +2.480888085712709e-01   +4.323634642754643e-02   +9.157318188461172e-02; +3.987764312418999e-01   +3.407993495487373e-01   +1.753313606497094e-01   +2.692550414193051e-01   +1.571523490691772e-01   -1.077790789924095e-02   +2.004663666850414e-01   +1.523081883510088e-01   -5.109744076056499e-02   +1.260649810236405e-01   +2.050941906782646e-01   +3.048861560251006e-01   +3.040144366978291e-02   +4.304278615336066e-01   +2.221230351975273e-01   +3.736854165592207e-01; +2.085964800597178e-01   +3.083502984606389e-01   +3.073991937174427e-02   +9.382635199119256e-03   +1.866657743947499e-01   -5.229439068361985e-02   +1.415425025526165e-01   -8.098098840774545e-03   +2.186489637552625e-01   +4.118409396779374e-01   +2.778363734261227e-01   +2.426242338927319e-01   +9.559817830952230e-02   +3.536330251589468e-01   +2.746631647441982e-01   +1.867423476771665e-01; +1.463092552919050e-03   +1.731172651921314e-01   +3.237048528884789e-01   +5.034359063925707e-02   +1.188382891175612e-01   +4.358705203463323e-01   +5.722775323364196e-03   +4.466501768730129e-01   +2.534829968239221e-01   +3.009639249785599e-01   +8.989007998168315e-02   +1.433197556611196e-01   +3.247455385881098e-01   +3.155093459016676e-01   -3.098651732514639e-02   +8.906981076138121e-02; +8.662476828476456e-02   +3.562516733409466e-01   +1.285841801883316e-01   +4.052134095986015e-01   +1.534007451256123e-01   +3.527019009938095e-02   +4.098615808025008e-01   +4.228133567933659e-02   +3.290901053118555e-01   +1.765494962387268e-01   +1.639011847958825e-01   +2.024895177874782e-01   +6.534468390221523e-02   +2.865670858710340e-01   +2.246685433546287e-01   +1.018141227140346e-01; +3.203260400491134e-01   +4.075676365934092e-01   +2.347643141839105e-01   +2.516366091998011e-01   +4.115409810349913e-01   +3.493800612450224e-01   +3.463854046694431e-02   +3.185092309716089e-01   +2.215194840988505e-02   +3.549660724526887e-01   +1.796627052548140e-01   +4.913858457376404e-01   +3.649984129816726e-02   +1.406144779080338e-01   +1.694138776484022e-01   +1.904598511186986e-01; +1.986444748572548e-03   +7.489906688818547e-02   +2.288022954162997e-01   +2.812271721699886e-01   +1.234516956590517e-01   +3.421919657867881e-02   -9.342966598324487e-02   +1.056355227894710e-01   +1.727399010497080e-01   +4.217527917738561e-01   +5.143704621425944e-02   +2.044630642921300e-01   +1.920119501064241e-01   +2.254485554857170e-01   +2.048720490934497e-02   +7.235915403111978e-02];
L2I_L2E_iAMPA_netcon = [+1.342911853629564e-01   +2.609443818370373e-01   -9.212161299334470e-02   +4.840224592258655e-01   +1.627403349680867e-02   +2.613583912937490e-01   +7.097989118127046e-02   +2.654276561548037e-01; -4.810819558415411e-02   +3.012613536942540e-01   +1.739460186317666e-01   +1.467610192239527e-01   -3.718485517503851e-02   +3.076461734251584e-01   +2.475649078111038e-01   +2.234383544222052e-01; +2.397013979122415e-01   +8.337844354840761e-02   +3.366840851315213e-01   +1.303243834365004e-02   +4.804386379112883e-02   +2.724250421574189e-01   +1.838332419331506e-01   +3.063563102988772e-01; +2.400239156809291e-01   +8.719305456602708e-02   +2.455075835096578e-01   +2.605237543247271e-01   +7.848663057543087e-02   +2.343935890714246e-01   +2.936895783059983e-02   +2.289371687998900e-01; +2.938038886215375e-01   +3.658766793166506e-01   +9.022859527813007e-02   +2.162748059430848e-01   +6.883149800031654e-02   +2.760803989273737e-01   +3.399288576151576e-01   +1.930773056310960e-01; +4.331684160419561e-01   +7.581981304771651e-02   +1.154513918654892e-01   +9.758745864633669e-02   +1.040502282002190e-02   +5.023313211813282e-02   +3.485570613619793e-02   +3.124499048090297e-01; +2.489605330123601e-01   +3.353915864475008e-01   +3.505013918020294e-02   +2.662961493391087e-01   +4.476826497416617e-01   +1.761623266101087e-01   +4.064561109685547e-01   +3.629083846881870e-01; +2.806335402082328e-01   +4.591537331773186e-01   -6.168228114947139e-03   +1.092575607181930e-01   +4.296669840212113e-01   +1.159713166666001e-01   +3.836369820931410e-01   +1.810645730096386e-01];
L2E_L2I_iGABA_netcon = [+3.500991742628031e-01   +2.212527260869053e-01   +1.797250409899881e-01   +3.309620241181530e-01   -3.267115551905841e-02   +3.414307596156214e-01   +4.182201299364475e-01   -4.449962146923602e-02; -8.656218635574572e-03   +8.007724297095832e-02   +3.582644036863349e-01   +2.474128861512185e-01   +5.043340676145265e-02   +1.486401647733667e-01   +4.734452964801043e-01   +3.942955231877366e-01; +2.925910451897905e-01   +9.113330546518947e-02   +2.819202084773328e-01   +1.650019187304849e-01   +2.414363834559249e-01   +1.800559671909099e-01   +3.520621603142001e-01   +1.135075651498886e-01; +2.653376702867665e-01   +3.305805522484275e-01   +7.324892869751259e-02   +3.925482234854173e-02   -4.383618391546944e-02   +2.938003831528234e-01   +2.056741296860673e-01   +1.263584657035778e-01; +2.974907040266683e-01   +1.883353537006637e-01   +1.052936893497554e-01   +7.894299980007989e-02   +3.300571336915800e-01   +3.976267084557840e-01   +1.260272389415504e-01   +2.413230542243208e-01; +4.557963684916279e-01   +1.886718999681451e-01   +1.437221480987109e-01   +8.656993813422301e-02   +3.374855906550848e-01   +2.356477787571300e-01   +1.351093580427162e-01   +3.745940510965124e-01; +5.608347800839621e-02   +2.060159843711963e-01   +3.209992270190895e-01   +1.175736488248321e-01   +3.773279799907826e-01   +1.914485461218555e-01   +5.355756825300725e-02   +2.415433931075337e-02; +2.209744570989282e-01   +1.048817764175475e-01   +4.940476081536676e-01   +1.909552845682422e-01   +4.197483295640518e-01   +3.470182511304282e-01   +3.060747200941401e-01   -1.614655915480556e-02];
L3E_L2E_iAMPA_netcon = [+3.231324335308303e-01   -7.951701901950144e-02   +1.668361051702284e-01   +2.213194427160498e-01   +4.684220901483207e-01   +3.476759600767391e-01   +1.471995712834571e-01   +4.232192933158521e-01   +1.289564223050246e-01   +8.539059847186160e-02   +3.085011557091609e-01   +2.841753966610918e-01; +3.817107450979915e-01   +4.644585431247959e-01   +2.658675913203732e-01   +3.053710092455634e-01   +1.389502975833018e-01   +1.906266948124085e-01   +1.511939706494910e-01   +7.037831023062942e-02   +5.132389014611833e-02   +1.949006546569053e-01   -3.877239539867645e-02   +7.686336203510420e-02; +4.471185688719574e-01   +2.363571966200449e-01   +2.930848870988680e-01   +3.473216023567759e-01   +2.981707206848908e-01   +7.461981394451239e-02   +3.273120579659259e-01   +6.957301888613111e-02   +2.139906260444510e-01   +2.001098085666724e-01   +1.865648323196759e-01   +1.394977247158763e-01; +2.234840879598214e-01   +1.549314646248161e-01   +1.005244501838813e-01   +8.102511136695338e-02   +2.334329756215839e-01   +3.368999147266176e-01   +2.356074680034470e-01   +3.113695159525603e-01   +3.364865329018853e-01   +5.007227968965644e-02   +1.311222138084854e-01   +1.216892484314364e-01; +3.328109095206379e-01   +2.298763895418013e-01   +1.193056170111260e-01   +4.301187519487319e-02   +2.746958044479107e-01   +3.612433713259977e-01   +3.580838021198256e-01   +8.063462728129468e-02   +3.242501915346753e-02   +6.543948004626265e-03   +4.061801564867697e-01   +3.245162110607692e-01; +1.784004302687544e-01   +4.309871612180892e-01   +3.455305050851420e-01   -4.908998938055830e-02   -1.572702360590350e-02   +2.850862537833402e-01   +2.837062675740197e-01   +3.372706004699177e-01   +9.471530929234655e-02   +6.335386184625164e-02   +2.675997163144866e-01   +1.560315495381787e-01; +2.448330023813787e-01   +2.250603510789376e-01   +3.683141364541954e-01   +4.367980766926983e-01   +1.274898793661453e-01   -3.832299658437559e-02   +3.437736084809981e-01   +1.575499461269034e-01   +1.098045309048007e-01   +1.022365681436291e-01   +3.556440468166392e-02   +9.362789841442939e-03; +1.351102636017126e-01   +2.835326898236529e-01   +3.260635670841202e-01   +2.722812656595597e-02   +2.996677897876577e-01   +2.329201611778055e-01   +3.469719223683367e-01   +1.817838108915662e-01   +1.215102909111824e-01   +1.526170592194792e-01   +4.042661850791360e-01   +1.311954985991397e-01];
L3I_L2I_iGABA_netcon = [+2.982218081161336e-01   +3.023606274850432e-01   +3.152090972601641e-01   +2.017531323444138e-01   +1.520392944643802e-01   +3.145605433527742e-01   +3.131473456966206e-01   +3.006359809527297e-01   +2.773965009713920e-03   +1.641500616281101e-01   +1.879299713798669e-01   +3.075329834163687e-01; +1.333136427338673e-02   +3.347667916394005e-01   +3.467166102800083e-01   +2.111954497436257e-01   +4.302471093023582e-01   +4.124158429022506e-01   +5.688865338635279e-02   +3.980881024787992e-01   +1.279829388730911e-01   +2.216741630720754e-01   +4.343760902682510e-02   +7.300456858171718e-02; +1.457405302796089e-01   +2.909832466485524e-01   +3.678026740239081e-01   +4.135723346803835e-01   +2.485783618312518e-01   +1.507772344126823e-01   +2.648024849646063e-01   +1.388022051860666e-01   +4.732860198326848e-01   +2.608326860250579e-01   -4.486171759712679e-03   +1.220941651884939e-02; +3.584200101261918e-01   +2.187016486294878e-01   +2.233357558771458e-01   +1.285946529972452e-01   +3.641375189868727e-01   -3.092731837555606e-02   -2.073228264760594e-02   +7.996594781517549e-02   +2.790164391249483e-01   +3.561949569912763e-01   +1.992617189870605e-01   +4.339495066014788e-02; +2.505071659865065e-01   +1.373118038227337e-01   +2.978485839068741e-01   +8.892514162150612e-02   +1.499791881107395e-01   +4.184753353303954e-02   +9.072335894007691e-02   +5.733158601217569e-02   +4.236907397594154e-01   +1.379863587594403e-01   +4.422630908073067e-01   +7.743903092634247e-02; +3.085061551527600e-01   +1.313925758267494e-01   +2.683517600884474e-01   +8.613490391017188e-02   +2.173370595251307e-01   +2.091722098952007e-01   +4.481432330476565e-01   +1.995594125398998e-01   +2.861300341384923e-01   +4.139224785401198e-02   +1.378845923149182e-01   +6.473676120053054e-02; +1.534617430437618e-01   +2.969196673114800e-01   +8.655814911806099e-02   +7.833549360660214e-02   +3.930586137256861e-01   +3.908759069303300e-01   +2.207483377940671e-01   +5.473904123587449e-02   +3.299535982668373e-01   +2.336397531712643e-01   +9.858342496784417e-02   +1.126506851837920e-01; +1.626599369100027e-01   +2.076529315778808e-01   +3.043112105094976e-01   +2.793818647599254e-01   +1.913569760974423e-01   +1.869584604895811e-01   +2.267222745807545e-02   +2.602910253325428e-01   +1.551937229699420e-01   +1.777310211479184e-01   +4.643108304590185e-02   -4.048533666886378e-02];
L2E_L3E_iAMPA_netcon = [+1.585591107758129e-01   +2.873945550408023e-01   +3.849652819017316e-01   +1.959956325978369e-02   +1.250586637876893e-01   +2.485704300124239e-01   +1.701266506570110e-01   +4.921807439566796e-01; +3.411832951787911e-01   +2.380734655185922e-01   +3.315648381001822e-01   -2.719750778132685e-02   -1.649956047182227e-02   +3.196085718021793e-01   +2.842697396356986e-01   +2.728655384741346e-01; +6.139511756823738e-02   +1.175995039124650e-01   +1.060658055033019e-01   +2.919582043666121e-01   +2.347246736832741e-01   +1.188966177657216e-01   +3.166924626006102e-01   +4.430879098841847e-01; +9.790240999858592e-02   +6.935078486307787e-02   +7.188926254213254e-02   +2.513925627420814e-01   +7.465796175270889e-02   +2.975827939460415e-01   +8.785887515192967e-02   +4.375593004570869e-01; +2.290739805229094e-01   +2.710841817143796e-01   +3.323326942467628e-02   +3.715552111927517e-01   +8.518197330550342e-02   +7.672950088292396e-02   -6.142102369186242e-03   +2.969091193764363e-01; +1.901079402286395e-01   +1.356649640377958e-01   +1.621142889708471e-01   +1.365306048971080e-01   +3.217126228172513e-02   +2.459434850437023e-01   +2.877188536970681e-01   +2.604294674582388e-01; +2.236833034956379e-01   +3.912400717737014e-01   +2.058107075769209e-01   +1.411035659740611e-01   +1.403852276659109e-01   +5.852739147937852e-02   +1.885185712119792e-01   +3.258476085281413e-01; +2.393789684199158e-01   +1.482409885162249e-01   +2.556229224096448e-01   +3.570503714680672e-01   +2.439697819916564e-01   +3.231454030559148e-01   +2.179931684823442e-01   +1.306486143284543e-01; +1.061143834888301e-01   +2.351597311088306e-01   +1.617933318921163e-01   +2.428737292563771e-01   +2.006017728930873e-01   +2.737776331719250e-01   +1.284923015856231e-01   +4.102738340051629e-01; +8.206718780204617e-02   +7.886203453394068e-02   +3.704851960578043e-02   +1.249834386438256e-01   +4.195321865155269e-02   +2.541220092475582e-01   +3.193051907992184e-01   +3.795997693335994e-01; +2.681196134839726e-01   +7.082774287648716e-02   +3.952822740203386e-01   +2.315755135898915e-01   +4.647599914939041e-01   +5.021708934290753e-02   +3.014945884870004e-01   +1.320847227897602e-01; +2.911281931457951e-01   +1.360517432168323e-01   +1.182680469194405e-01   +1.215380466399424e-01   +3.285140090448072e-01   +1.475472822404254e-01   +2.529730918446047e-01   +2.248636960845212e-01];
L2I_L3I_iGABA_netcon = [+1.481962948783352e-01   +3.971225156073470e-01   +2.830437736938918e-03   +2.092775189726324e-01   +4.663641460718124e-01   +3.449569394536057e-01   +2.757351682751035e-01   +3.322832018679419e-01; +3.037605746638313e-01   +3.039143106026257e-01   +1.290067831632971e-01   +2.746862976345482e-01   +2.609079252359208e-01   +2.663717951431423e-02   +1.422405896061665e-01   +3.224440742450818e-01; +4.081559519045581e-01   +2.701004205362439e-01   +3.312518126326682e-01   +2.480143616483747e-01   +4.827057193533651e-02   +2.116891602227486e-01   +2.516361320581477e-01   +4.317889919937463e-01; +2.213192549718462e-01   -2.151833848280694e-02   +1.797372779015925e-01   +1.630309105673734e-02   +9.665408124380376e-02   +3.147749375723283e-01   +3.017681367804187e-02   +2.252862226243350e-01; +4.075154234369711e-02   +3.404768978741204e-01   +1.164982841166832e-01   +1.998771643396677e-01   +2.114640570958980e-01   +2.753353973868243e-01   +2.491169439637010e-01   +2.746018136907649e-01; -1.721434386671004e-02   +5.434596494657301e-02   +2.224542514179376e-01   +2.125522625559284e-01   +7.182910083386851e-02   +1.987663496972206e-02   +3.432306509684909e-01   +6.117075737665523e-02; +1.640365889295581e-01   +1.453685455169175e-01   +2.982935113649449e-01   +6.974681009339682e-02   +2.291074290596021e-01   +1.087148392308918e-01   +4.739377648859079e-01   -4.187265916381907e-02; +5.042087699174839e-02   +3.230011805103864e-01   +2.823026685133825e-02   +2.513339383052577e-01   +1.288749224204279e-02   +3.146143259313798e-02   +3.055719657694415e-01   +2.977802346027922e-01; +1.901275825670327e-01   +1.350276122158274e-01   +2.070204436900234e-01   +2.858803010425321e-01   +3.329184154120286e-01   +3.935173045421224e-01   +8.845539608865127e-02   +1.479765830786902e-02; -2.231769193144454e-02   +7.467561453698038e-02   +1.128153365854917e-01   +2.988662384981216e-01   +2.901560372315602e-01   +8.179491096611016e-02   +5.533059906379513e-02   +1.530507914551433e-01; +2.131426549878110e-01   +2.758809244490915e-01   +1.095433204897706e-01   +4.085936881183619e-01   -3.468772031192606e-02   +3.777675782360196e-01   +4.075033311330536e-02   +4.024819650219525e-01; +3.184774095461042e-01   +9.181257202930028e-02   +1.995820039335088e-01   +1.042347226681527e-01   +3.938348505222255e-01   +3.141036000678149e-01   +3.461841679656115e-02   +2.082122022549813e-01];
L3I_L3E_iAMPA_netcon = [+3.702641954563745e-01   +1.481308231762647e-01   +3.334395286708852e-01   +2.221271845834171e-01   +3.521244203353818e-01   +2.102263464820207e-01   +1.756029585727134e-01   +7.351647489189081e-02   +2.453061902970347e-01   +1.979818321020573e-01   +2.618919304032460e-03   +1.242011602146973e-01; +4.201833591063990e-01   +4.365298479114040e-02   +1.377146863709869e-01   +1.464350614685707e-01   +5.533178154340201e-02   +1.144607269797351e-01   +1.267836001487233e-01   +4.106984382982475e-01   +3.039856779611067e-01   +3.583182553696551e-01   +4.854234637572463e-01   +2.553177412520389e-01; +3.038225069531558e-01   +1.292641136454047e-02   +3.212880015213364e-01   +1.431529158720643e-01   +1.037769193247066e-01   +3.815587627354011e-01   +9.055195035187440e-02   +2.568843661974096e-01   +1.410284409441174e-01   +1.939127351495036e-01   +4.036046453175799e-01   +3.070483141608760e-01; +2.380554879220049e-01   +3.196597114530478e-02   +2.363462685491551e-01   +3.707343897584385e-01   +1.560358046559423e-02   +1.108931405318485e-01   +3.632343303461280e-01   +1.707229599060639e-01   +1.855992839654451e-01   +5.410022069505033e-02   +4.542809377274790e-02   +1.421544289330465e-01; +3.562880306038403e-01   +2.011617240975722e-01   +1.830953433796564e-01   +3.283048388647267e-01   +1.845070956824219e-01   +1.404365018336387e-01   +5.333870286854703e-02   +1.552493594942672e-01   -9.559142981460742e-03   +3.431120022870466e-01   +2.733201739144093e-01   +2.142145135443688e-01; +4.306968238299944e-01   +3.626468920776006e-01   +7.057779436120003e-02   +2.839502191170052e-01   +3.891400236006841e-01   +2.599666431960996e-01   +5.158706765068832e-02   +8.673484822755161e-02   +2.374894785137336e-01   +1.899601823704959e-01   +3.235717163068875e-01   +4.361908909756722e-01; +2.178016292740244e-01   +2.223253674072436e-01   +1.188254127084349e-01   +1.520883267679723e-01   +1.309710179083233e-01   +2.917031535528047e-01   +3.106714378619834e-01   +2.561360576574203e-01   +3.584225788819458e-01   +3.154911722804563e-01   +1.178015860330020e-01   +2.855139995302871e-01; +2.236022050286959e-01   +3.714842753100910e-01   +2.648740670980013e-02   +2.166676422916173e-02   +3.793334496582274e-01   +6.726498220161023e-02   +2.110433404010831e-01   +3.725257233829434e-01   +2.899459220503348e-01   +3.445293078247932e-01   +2.299826150599004e-01   +3.589971888663519e-01; +7.122271481748893e-02   +4.316112053028326e-01   +1.435948415720092e-01   +3.008115442257454e-01   +2.334779091912025e-01   +2.480758824283603e-01   +6.494754400136940e-02   +3.805956381893688e-01   -6.255428300886947e-03   +2.724685982873770e-01   +3.070523675490273e-01   -1.163320609945360e-02; +1.534995437121673e-01   +8.086734878619158e-02   +7.517227291420010e-02   +3.015522465291958e-01   +1.377952129469431e-01   +4.133835029210003e-01   +1.816814651018933e-01   +3.970691381085541e-02   +2.562922031869488e-01   +2.711603771565819e-01   +3.796914741453939e-01   +2.413949077504831e-01; +2.913431496855694e-01   +1.569741876984537e-02   +3.805301242115731e-01   +1.414694774034655e-01   +2.093616910244253e-01   +2.819423305735737e-01   +1.781375484036515e-01   +1.311836175503978e-02   +1.447273908721492e-01   -3.873822460695359e-02   +2.931896756920265e-01   +9.747327800764209e-02; +2.199391147036562e-01   -7.987433789837423e-02   +1.833321686553109e-01   +2.200641737257849e-01   +9.485888233774388e-02   -1.339015264827403e-02   -1.519468257855077e-03   +2.563885614493009e-01   +1.100427541484350e-01   +2.491121362602453e-01   -5.043394466802111e-02   +1.657712380787300e-01];
L3E_L3I_iGABA_netcon = [+2.877832205909363e-01   +1.570486447303424e-01   +2.495010018815083e-01   +3.498076836574883e-01   +3.344063425335259e-01   +4.035024307391726e-01   -5.219786282323946e-02   +2.227371394926092e-01   +3.471277956303412e-01   +2.570247577940125e-01   +4.038016550159995e-01   +2.985719888330395e-01; +2.597521690291836e-01   +2.524176538406739e-01   +6.771753457978522e-02   +2.554561912096246e-01   +4.518017970400091e-02   +3.589071487738011e-01   +9.738348655898912e-02   +2.054474730095032e-01   +1.111492132574811e-01   +1.394681057272195e-01   +2.995124161792080e-01   +3.315988359789930e-01; -2.070480350634265e-02   +3.494359279166443e-01   +1.943392756417386e-01   +2.854139349664309e-02   +2.208911754168796e-01   +1.849710162693414e-01   +6.995286160816364e-02   +7.710199353166824e-02   +3.596848790742984e-01   +1.955310360492340e-01   +1.938930466800604e-01   +4.495197789683401e-02; +2.666152629208585e-01   +9.581002277399692e-03   +3.019769331914369e-01   +1.828998520842202e-01   +3.743781575706970e-01   +5.247395599638410e-02   +1.289620855057462e-01   +1.690586410968410e-01   +3.693560971875894e-01   +3.402426039615298e-01   +1.754898057340651e-01   +2.426161419542300e-01; +3.431869001585313e-01   +2.723425929990609e-01   +4.374503648976936e-01   +3.936281540345060e-01   +3.258814477436808e-01   +2.249660673433051e-01   +2.428186927186364e-01   +2.317669679802946e-01   +1.947246507588770e-01   +2.856904534128057e-01   +1.343099092877352e-01   +2.930813954057297e-01; +1.822377784260119e-01   +3.620560573990018e-01   +2.510418223218222e-01   -2.583572958353306e-02   +2.961569431242047e-01   +1.907477918256527e-01   +2.175817185741772e-01   +3.943487862581658e-01   +1.556690521477982e-01   +2.499814736176010e-01   +1.737632681271740e-01   +4.281644056921693e-01; +4.062422328660872e-01   +1.362350086805643e-01   +7.104284386325278e-02   +5.736718247371281e-02   +9.614567610445604e-02   +1.721098602527146e-01   +3.349823029144812e-01   +2.416287248623692e-01   +4.067387646694477e-01   +2.535539757083027e-01   -2.349505376197692e-02   +5.949319056750779e-03; +6.918315874280002e-02   +1.420366770084972e-01   +2.403195330110249e-01   +3.083439716078870e-01   -7.756072344325689e-02   +2.217077753903215e-01   +1.738849306522010e-01   +2.844461765320946e-01   +3.779815891038251e-02   +1.750214318138848e-01   +2.929145297274166e-01   +1.102016021917250e-01; -2.690910409855232e-02   +7.343007447976224e-02   +3.205073691216982e-01   -8.478460959609078e-02   +3.112104856533274e-02   +3.544112375212696e-01   +4.878962091346760e-01   +3.912911566073121e-02   -9.697688562193701e-02   +2.573290266506436e-01   +2.839783958832332e-01   +1.149724087414735e-01; +4.442252312908261e-01   +4.416807018921552e-02   +1.132694615402629e-01   +2.260699424154392e-01   +2.707120713569648e-01   +2.675968116682553e-01   +3.356781752641979e-01   +2.947629732990426e-01   +4.342166280107760e-02   +1.496170890928494e-02   +1.791464670762123e-01   +1.182027537587103e-01; +3.194361225925107e-01   +1.716099034469515e-01   +2.256987744450744e-01   +3.631082322588546e-02   +3.216184138126413e-01   +4.944652451362512e-02   +3.780966787997682e-01   +4.008643841025540e-01   +1.653723340333287e-01   +3.108722348104801e-02   +2.434823467531445e-02   +1.742342300621829e-02; +3.513418582613392e-02   +2.722353941283072e-01   +2.266890054439911e-02   +3.872620538490573e-01   +3.128290040890372e-01   +4.300034082917458e-02   +2.097094328846450e-01   +3.437719368597963e-01   +3.290030023851125e-01   +4.872865563685411e-02   +2.390782654615858e-01   +6.918310955663043e-02];
L2E_Input1_iAMPA_netcon = [+1.121601250945927e-01   +1.349916994655652e-01   -4.806616755169078e-02   +3.566219556787362e-01   +1.907228883213510e-01   +1.769220806694333e-01   +1.120795147995218e-01   +2.400207363322409e-01];
L2I_Input2_iAMPA_netcon = [+1.002038680073885e-01   +6.520808588868124e-02   -1.934799038012973e-02   +1.477401010879830e-01   +4.340037460298414e-02   +4.121140778253487e-02   +1.515019669173746e-01   -4.500511285706961e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
