function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.444032457112833e-02   +5.860858103256191e-02   +2.912835127614824e-02   +1.034794065686491e-01   +4.669628323675894e-04   +2.054395447741336e-02   -3.507446544689444e-03   +3.571246188281084e-04   +3.162202159073963e-02   -1.669163453916139e-02   +8.022190563158660e-02   +9.505355564913883e-03   +2.349299171003937e-02   +6.314365113567413e-02   +3.686958895538599e-02   +8.566232481143318e-02; +2.837113444152280e-02   +2.025953266584756e-02   +9.162462139626697e-02   +6.075594312664280e-02   +2.993768042711232e-02   -4.443400511653320e-02   +7.473807303819008e-02   -2.758158713510577e-02   +7.084905263177539e-02   -1.552815375056591e-02   +3.051911335550130e-02   -1.738345970962955e-02   -9.411207269013400e-02   +2.649382409329516e-02   -3.487238570563467e-02   +1.491375986641202e-02; -1.423278025557700e-02   +5.560432797319262e-02   -4.139692536844503e-03   +2.918680165372944e-02   +3.856229374675162e-02   -1.233894930885386e-02   +4.817492232401135e-02   +4.052681696233167e-02   +1.477796528653973e-02   +5.721155462712579e-02   +6.547008978782903e-02   +3.997093598230594e-02   -3.306682897841715e-02   +4.353158770585138e-02   +4.309401767296241e-02   +4.110205265958219e-03; -3.273684141366934e-02   -1.058724374713318e-02   -3.054691143169142e-02   -2.663104589473225e-03   +8.303285403992133e-02   -4.382986854412157e-03   -3.067938503090850e-02   -6.015251224942189e-02   -9.286035076782100e-03   +2.685357975658359e-02   +2.948030853203880e-02   +2.770173569250861e-02   -2.446499385753716e-02   -2.432011103709624e-02   +7.839802897518647e-02   +2.357968376397224e-03; -8.988714376375596e-02   +1.035456992233045e-01   -5.766375465040047e-02   +1.162266367713486e-02   -2.232470811562587e-02   +3.429898215457243e-02   +5.685456100180576e-02   -2.084152992075899e-02   +1.899625407039025e-02   +3.214677512397613e-02   +1.582342708994880e-02   +3.668216248715706e-02   +3.554982436625737e-02   -9.164885754948542e-02   +2.501123636656996e-02   +5.012640484394891e-02; +2.400576583815593e-02   -9.454799842229533e-02   +3.189028878875185e-02   -5.684850729594308e-02   -1.044257288991086e-02   +3.004230552154780e-03   +6.131827556219468e-02   +6.266704003832602e-02   +4.207816524175552e-02   +1.102682565174718e-02   -5.255286306864566e-03   +1.076524148154102e-02   +2.094318918739771e-02   +2.984121263707268e-02   +2.334856333878729e-02   -2.120850889026146e-02; -2.233364630019900e-02   -2.806405892374442e-02   +8.777458284289209e-03   -1.455954820565957e-02   -3.608683447344307e-02   +5.742839879881535e-02   +3.800362081398216e-02   +6.908114303621710e-02   +8.153409086840709e-02   -9.205924390428472e-03   +2.632705781706209e-02   +2.664701516080504e-02   +1.334866792864954e-02   +2.809665328278319e-02   -5.314301597567902e-03   +2.881976983283082e-02; +4.869622438256457e-02   -1.375917426946132e-02   +6.884844774548171e-02   +6.253258887454302e-02   -4.657928726256514e-03   +1.185659040615654e-03   +6.229463697994680e-03   +9.157654584548310e-03   +1.827243284776072e-02   -9.744463093391879e-03   +1.604294306220813e-03   -7.993445824289425e-02   -1.710266832706506e-02   -5.551311606330473e-03   +1.030172384006121e-02   +2.766144202301937e-03; +3.424401306315974e-02   -1.596535119093335e-02   -2.142302544966742e-02   -5.975528768935019e-02   -3.119471332916351e-02   -7.689104552738675e-02   +4.804930457531826e-02   +2.374321030834987e-02   +6.816008109267978e-02   -5.028244109736422e-03   -8.391208036545598e-02   +2.633167537927475e-02   +2.685568546146745e-02   -8.628767545985300e-02   +7.247979301909691e-02   -1.509511735378832e-02; +1.059034526304043e-02   +5.008399509500187e-02   +3.680000541524570e-02   -8.768019427122527e-02   -3.603313836812147e-02   +2.878071567646768e-02   +2.264182408246587e-02   +1.770937739688903e-02   +1.358269776977019e-02   -3.562048897501959e-02   -2.434911590897589e-03   +5.093992804564151e-02   +3.264307799882359e-02   +3.594044523145472e-02   -3.691462506878637e-02   +7.219927356599350e-02; +1.521697077733611e-02   -7.766619855269305e-02   +3.468734840988608e-02   +5.666535364426470e-02   -3.755008541604301e-02   -1.874112974340091e-02   +3.928028056391650e-03   +2.337228449721450e-02   +1.539546878389153e-02   +4.816087217283321e-02   +4.271989143145982e-03   -4.269369834737947e-02   -4.462002383914110e-02   -9.025110937492592e-03   +6.102140569556584e-02   +6.489015728494418e-02; +5.188152494431782e-02   -8.004820648292599e-02   +1.062970244507149e-02   +8.784677302654080e-04   +6.014454304447223e-02   -5.015624687774587e-03   -8.526553281593303e-03   +5.429672980998787e-02   +2.503567761816881e-02   -1.763429832478445e-02   -4.184773265423686e-02   -5.293354665834643e-02   -6.603613280889607e-02   +3.272996853679729e-02   -4.880709306609619e-02   +1.676440783115902e-02; -2.002931359556790e-02   +2.297647889355536e-02   -9.126527480462396e-03   -5.228966655548430e-02   +1.433231050058878e-01   +2.517928037441675e-02   -2.470194813982145e-02   +7.084461893739016e-02   +2.190842981714707e-02   +1.191619465502240e-02   -5.551121911255099e-02   -2.904523850350891e-02   -1.636716102319862e-02   +1.039183650970971e-01   +5.034465747558384e-02   -1.953358327564294e-02; +2.970726358811338e-02   +5.880203224365177e-02   +6.360329111672409e-02   -8.307614168464972e-03   +5.385811955814236e-02   +9.138306804649179e-04   -1.237914925792967e-02   +4.228193244744195e-02   +2.459368298650722e-03   -1.798499519480407e-02   +1.141499917818245e-02   +3.399205373346650e-02   +8.689159715104925e-03   -2.098296329156954e-02   -7.918598903238505e-02   +5.878930567270929e-02; -6.266498441423973e-02   -2.293479302551402e-02   -4.651561941650551e-03   -2.474719926366472e-02   +4.517953953608074e-02   +3.391809725438565e-02   -5.143005471087950e-02   +1.185385615944974e-01   +6.918385373252242e-02   +1.272128989164064e-03   -5.574440396001399e-02   -3.562747017095604e-02   +3.654922126498363e-02   +2.032636563332512e-02   +5.589493847579032e-02   +2.160496921882961e-02; +2.790254078035251e-02   +9.083804690353629e-03   -1.613401388107662e-02   +3.740508291711468e-02   -1.679255201172068e-02   +1.507883225603284e-02   +4.934884402713708e-02   -1.129845108050339e-02   +1.406050390665728e-03   +4.959412391066795e-02   +1.038344257783859e-01   +6.379280880061890e-02   -6.859722791035069e-02   +8.700756045307878e-02   +7.531897170771784e-02   -1.240575975136936e-02];
L1E_L1I_iGABA_netcon = [+3.683882450673432e-02   -5.644793075212488e-02   -1.350622725998122e-02   -7.683346342055375e-02   -1.203953288609808e-02   -7.909058332597543e-04   -4.986088004083091e-02   -8.742090209529138e-03   +1.581354313564833e-02   +7.241212540950770e-02   -4.245382862076303e-03   +4.267668814737534e-02   -4.659268474491239e-03   -2.311236732029973e-02   +2.101921763886367e-02   -3.704783995333138e-03; +5.449583137974335e-02   +6.130548390896659e-02   -6.253756175382853e-03   +4.749942752227612e-02   +3.875355708347177e-02   -6.092743110941963e-02   +5.413925605221574e-02   -7.615137738303424e-02   -2.572786553295453e-02   +2.432813878700101e-02   -2.268201630551449e-02   +7.453119292172508e-02   -3.095209008940382e-02   -3.516703743473318e-02   +7.569698722305697e-02   -5.424100981497615e-02; +2.263650815777054e-02   +3.270091200963348e-02   +3.305069750864419e-02   -1.584659385148905e-02   -3.850345592694768e-02   +9.777151269850388e-02   -4.378704421926503e-02   -8.450753026302124e-03   -5.221857258863576e-02   -2.814726450108315e-02   -1.982734897846760e-02   +6.919825416271919e-02   -5.318992958290795e-03   +2.946707939588349e-02   +3.772747241435039e-02   +1.476538903779390e-02; -3.494164015280016e-02   -6.400427619414081e-02   -1.480444951250154e-02   -7.859968431125205e-02   +6.742615475961997e-02   -3.166738916243074e-03   +6.163781083448746e-02   +3.843426314879354e-02   -2.252698266086935e-02   +1.458826674907727e-02   +1.050801684417456e-01   +2.026439916815942e-02   +6.066891522766209e-02   -3.396124636956723e-02   +2.952316835900251e-02   +1.990111084714194e-02; +5.578580741501321e-02   +7.702475036002178e-02   +1.089494754282180e-02   +9.241236738431052e-05   +1.735071882807170e-02   +3.168374093126719e-02   -5.973598396294821e-02   +4.574528051848858e-02   +7.056967472544601e-03   +5.224890301239844e-02   +5.045569407973256e-02   +1.318808938087097e-01   -5.151467155537037e-02   -8.787453666533915e-02   +7.188688898342130e-02   +1.667693146847773e-02; -1.247196263974172e-02   +6.256445788602008e-02   -7.985038327956653e-02   -5.130600536444403e-02   -4.638563296831089e-02   -1.563529016696542e-02   -1.186183533986386e-02   -6.455741235480021e-02   -1.976235449937164e-02   +8.227824418867732e-02   -9.744590081267976e-02   +1.267964950301659e-03   -8.762383318041658e-03   -9.111957549141573e-03   -1.170707482189745e-02   -1.578266195691991e-02; +6.819655435822031e-02   +7.877214542509647e-02   +1.405369878072354e-01   -5.073265000920100e-02   +4.612784737214285e-02   +3.667131198787441e-02   +2.317511458933294e-02   +9.619083282148748e-02   -1.665468045881170e-02   +3.633336603792778e-02   +3.175940587531408e-04   +7.085347213761028e-03   -3.155934484310113e-02   -5.928002030258567e-02   -5.608001979279259e-02   +2.717560170236293e-02; +3.917181803208975e-02   +7.816367163694912e-02   -5.679577405716537e-03   +9.692358041407101e-02   +6.507563796745459e-02   -7.024540251439079e-02   +3.700090472828114e-02   +4.834436603742470e-03   +3.999055392478185e-02   -1.638688902581178e-02   -7.499283327342114e-02   +2.461829125763538e-02   -3.330793286756076e-02   -4.092530276268944e-02   +4.624314639319958e-02   +3.446052520541806e-02; +2.007154049378352e-02   +6.834680094663725e-02   -2.116318018198730e-02   +9.456900184034882e-03   +6.780078975003342e-02   -1.314370748771229e-02   +2.401286419803096e-02   +2.269445895072773e-02   +2.743638380179293e-02   -3.337378959539684e-02   +1.002411381990341e-02   +2.489916459681914e-02   +1.093626257889721e-02   +4.986255796402360e-02   -1.485675692320795e-02   +4.665884034423247e-02; +7.388043954046628e-02   +4.847675520293743e-02   -4.935701016437394e-02   +3.396028126512386e-02   +1.586795663731213e-02   +1.057421335109834e-01   +3.832130848879779e-02   +9.768958900028803e-03   -1.163818046143994e-02   -2.757522698025847e-03   +5.488684153363002e-02   +4.232337311884141e-02   +3.772826309632050e-02   +9.517573569231157e-02   -6.027512682556688e-02   +6.992576987042461e-02; -1.367672762986404e-02   +6.581393885590409e-02   -6.360351161363348e-03   +2.644613288765229e-03   -4.177785935884754e-02   -1.559892730240460e-02   +3.817010961087905e-02   +3.772830239333557e-02   +1.208088429062826e-02   -7.261565432864794e-03   +3.641307702572440e-02   +8.455518163073765e-02   +2.728940259573041e-02   +2.294681817925349e-02   +2.858799328650439e-02   +5.369743924125078e-02; +7.433705129789168e-03   -7.922723965814352e-03   +8.903182895250684e-02   +6.062217982713543e-02   -3.819167655729440e-03   -1.412001392358760e-02   -1.907783330096859e-02   +3.334700500256133e-02   -2.375973773995799e-02   -5.229506637050090e-02   +7.458352914080706e-02   -1.849683320179147e-02   -8.982215953731516e-03   +6.258407226233902e-02   -6.965040705247447e-02   +3.728324819556036e-03; -1.077028140509400e-01   -2.702648053038808e-02   +3.495880391896268e-02   -4.249934303810522e-02   +2.145225592044465e-02   +2.634580462837627e-02   +6.881269907432720e-02   +9.366742280643436e-05   -6.409440503174633e-03   -5.464688991421493e-02   +1.751021300526713e-03   -3.253827176593211e-02   +2.131107084464743e-02   +1.131084709658422e-01   -4.499027422642840e-02   +2.326090486224763e-02; +7.326314743800882e-02   +5.907464288604555e-03   +8.514353879698594e-03   +3.009966973822114e-02   -9.813124798734807e-02   -7.111302477094790e-02   -4.888503269310320e-04   -6.626883029134296e-02   -7.288023213977925e-02   +4.022549113664868e-02   -1.345497334528963e-01   -4.588443521725227e-02   -4.851943464841741e-02   +5.872423121959342e-02   -2.809562530046312e-02   -9.765402301799495e-02; -1.170718281071058e-02   +1.737502479433668e-02   -6.216504531698538e-02   +6.316290098958158e-02   +1.899893471190412e-02   +1.871482675336301e-02   -2.817690589190980e-02   +2.025476034111221e-02   -1.083608640316907e-03   +1.899546167966554e-02   +6.932992083871564e-03   +7.992109808582074e-02   +2.787014773117536e-02   -7.793531794646408e-02   +1.865243443465702e-02   -1.534897231332370e-03; +6.127039138680043e-02   +1.563054681407286e-03   -6.900513387588174e-02   +4.953465521277544e-02   -1.021321918144365e-03   +6.426354419250038e-02   -1.983912008006007e-03   -4.169814272296397e-02   +6.596428030299534e-02   +1.561683130672097e-02   -8.855508889584193e-02   +7.496548047817365e-02   +6.642683142606412e-02   +8.100155999734626e-02   +1.549141361067129e-03   +6.968338809867013e-02];
L2I_L1I_iGABA_netcon = [+1.146940408500462e-01   +2.683465828921695e-02   +1.630263464841316e-02   +1.486187918009925e-02   +1.048387800970556e-01   +6.546032550238534e-02   -3.755831429759914e-02   +8.775751846488482e-03; -1.852919998957117e-02   -2.301401408353179e-02   -4.292080485591011e-02   -2.307733245848889e-02   +2.478987552561290e-02   -8.616197370313253e-02   -4.538743553647479e-02   +8.743324581745462e-02; -3.115735584910724e-02   -2.255831517491326e-02   +1.901101570038957e-02   -8.552260341832874e-02   +1.764436482845099e-02   +4.940345434057661e-02   -1.906128812758046e-02   -4.392943886546384e-02; +9.446703200445762e-02   -5.882306422017791e-03   -1.084680373232251e-02   +2.103863475997164e-02   -8.125549904687529e-02   -6.383428879874798e-03   -8.567145637642106e-03   -3.678528764133987e-02; -1.198994688895817e-03   +7.895945685025982e-02   +7.357117516579068e-02   +1.348180688917535e-02   +3.519850952042560e-02   +2.838472823220690e-02   +8.466314943688509e-02   -6.754134063315218e-03; -1.026116286339916e-02   +3.673672122400200e-02   -3.131533045891399e-03   -6.930012021484950e-03   -6.456828154273497e-02   -1.288116369609029e-02   +2.394553969368608e-02   +4.008423304365741e-02; +1.890311531320534e-02   -4.105085088493841e-02   +3.961110123401100e-03   +2.357568232931569e-02   +1.917152212775788e-02   +6.557551493082796e-02   +1.350725902462182e-03   +2.121817128670087e-02; -1.227267879944467e-02   -1.464218687836546e-02   +6.078268858836599e-03   -3.554906568873820e-03   +2.384935857000358e-02   -1.299662450833455e-01   -4.528028922137086e-02   +8.862018007330584e-02; -4.006788485831132e-02   +6.698788245078714e-02   -1.406234737271147e-02   -1.045616049060948e-02   +4.190906295757096e-02   -3.402229624618908e-04   -1.295104083592695e-02   -4.196485790451525e-02; -3.992356810045354e-02   +6.374467659391123e-02   +8.402659425186497e-04   -2.730341583518838e-02   +3.808447832312471e-02   -1.648095400316127e-02   +7.510468818090039e-03   -4.717948411861586e-03; +8.796740288608793e-02   +5.375740304272417e-02   +7.727183934286428e-03   -4.628339107164041e-02   -2.059689366258128e-02   +7.612716522321010e-02   -2.824056568219117e-02   +1.207062863167025e-01; +4.125162502469502e-02   -1.697887035560786e-02   +4.351578772683690e-02   +1.078541543971021e-02   +1.441066605550414e-02   +3.800357492666794e-03   -5.425771742924046e-02   -6.275901756508975e-03; +4.649661836614272e-02   +4.093468630501336e-02   -3.875910548952843e-02   -6.503480255042220e-02   +3.473153416468137e-02   -1.892774223730830e-03   -2.458042551435698e-02   +4.196044862778756e-02; +2.180680361009844e-02   +1.540068755384390e-02   +1.182032767142027e-03   +7.444859386386302e-02   +9.296093627526109e-03   -3.801003330146989e-03   -1.107284848261215e-02   +3.202542339099833e-02; +3.336777421709652e-02   -1.726332566549455e-02   +5.226593870720070e-02   +9.222885985778569e-02   +4.595321253219510e-02   -9.582184872269230e-03   -3.028453947283972e-02   +6.164759365098758e-02; -2.543520003134767e-03   -3.850563745848043e-03   +3.143117456505949e-02   -2.261149131986546e-02   +5.342015949413962e-02   -7.551875048849600e-02   +1.904342983619094e-02   +8.063789299526565e-04];
L1I_L2I_iGABA_netcon = [-3.454785349560408e-02   -3.695551057519202e-02   +6.048475847425416e-02   +4.875297206704463e-02   +1.013262844529264e-01   -6.600612392286251e-02   +4.874022030664089e-02   +1.471278587298371e-02   +3.521703505485325e-02   -6.106400445109455e-02   -5.611421398588855e-02   -2.164754243669056e-02   -1.188714772584800e-02   -1.877914600790417e-02   +3.968282990936667e-02   +3.880450972401048e-02; -5.057671545553994e-03   +3.244532875150452e-02   -4.909333206154437e-02   -3.765598046972233e-02   -2.582123304070887e-02   -5.399646593278831e-02   +3.859921845891803e-02   +1.923940424023731e-02   -2.405696956418707e-02   -2.483780503119105e-02   -7.047890599499221e-03   +5.538407019759881e-02   +5.202148906836293e-02   +5.661718562880550e-02   +2.288828872282874e-02   -1.676902991809444e-02; +5.397340141771828e-02   -8.451661273916262e-02   -7.852719708244646e-03   +1.230498397982244e-02   +2.414615923638648e-02   -5.977698204550750e-03   +7.446461880217432e-02   +4.943253807805340e-02   +1.600912136611428e-02   +3.665456286524435e-02   -1.708050364371809e-02   -6.018538014194923e-03   -5.847126989291448e-02   -8.110924373393603e-03   +4.222268101986898e-02   -1.641904312365652e-02; -4.094964702636168e-03   +1.512626406661157e-02   +3.177965406708180e-02   +2.719660692804532e-02   +1.831493247986663e-02   +7.372487071621521e-02   -2.149665099613396e-02   +3.190969629993273e-03   +5.483943757025091e-02   +3.706916715825954e-02   +1.248650500469202e-02   +1.159743846408144e-02   -3.349026171954742e-02   +5.158840779016051e-02   +9.059742094038266e-02   -1.193471387736210e-02; +2.513213063347971e-02   +1.102075829871870e-02   -1.188654176490945e-02   -8.599777984929419e-02   +1.187263503416332e-01   -8.055763032347042e-02   +1.136524203404187e-02   +2.642033079194689e-02   +2.842165796016770e-02   +1.865191311936800e-02   -3.263984875755271e-02   -4.222560001843572e-02   +8.798048588999269e-02   -2.326991829561570e-02   +5.300782685188179e-03   -8.086733851383217e-02; +9.408201551868015e-02   -5.796354534189740e-02   -1.688979915446502e-02   +4.769661223071316e-02   -7.998164535254990e-02   +9.050589588338455e-02   +1.888652189779135e-02   +2.702577558174845e-02   +8.687601443627180e-03   +4.023904025960963e-02   -2.392651729238122e-02   +7.249398700321606e-02   -9.860048476948663e-02   -1.778495720119223e-02   -5.738001608428450e-03   +1.241335659941186e-02; +4.389388284352992e-02   +2.252071422607304e-02   +2.963459856136747e-02   -5.143294260679708e-02   +5.367700171251182e-02   +2.750771748738760e-03   +4.309466907722172e-02   -1.264835328173000e-02   +2.340096232778701e-02   +6.174425384415398e-02   +5.307188802284841e-02   -3.672431901537540e-02   +3.702820583016712e-02   -2.648305260181875e-02   +6.207990946307243e-02   +4.271483494914528e-02; -4.734707101021195e-02   -1.053137526847823e-02   -4.052425088298632e-02   -8.025994203856561e-02   +1.309917522914573e-02   -6.806591538140709e-02   +2.344340751271760e-03   -7.479950639599220e-04   +4.284444572431825e-02   +1.851789166656836e-02   -5.606368354159462e-02   +3.829597736635013e-02   -5.085422678315077e-04   -3.387331843453937e-02   -9.723483790393776e-03   +4.292984327243093e-03];
L2E_L1E_iAMPA_netcon = [-2.365161253673537e-02   -7.994501815067590e-02   -9.400837672662808e-02   +1.714447875290897e-02   -4.887219874596821e-02   +6.014926328091421e-02   +2.547614478359664e-02   +1.143948650135959e-02; +5.166353378723750e-02   -3.652848221336276e-02   -1.674946934260713e-02   -3.356232324943241e-02   +9.447530831762319e-02   +9.472624616194901e-03   -4.262962770769254e-03   -6.828360834479566e-03; +5.069543577051318e-02   +5.310871454463702e-02   -3.069531099723708e-02   -1.172471525369055e-03   -1.833317067981753e-02   +9.024453804806449e-03   -5.098485768292105e-03   +4.760693129365699e-02; -3.792055822829039e-02   -4.359699892438464e-02   +7.461937014444288e-02   -1.211062553818171e-03   +1.100332312986371e-02   +6.807861036239182e-02   -1.352660934747089e-02   -5.426498806317383e-03; -1.987498340640721e-02   -2.290558535034677e-03   +2.190156850000966e-02   -1.045872149992649e-02   -5.301032531956113e-02   +5.378181131582199e-02   +1.428319414139666e-02   +3.294420517110816e-02; +4.665730279620625e-03   +2.489217785621291e-02   +7.850833106567288e-03   -6.098592472894907e-03   +1.297009772340509e-01   -5.486718550321460e-03   +4.902446437602394e-02   +8.134598510832931e-02; +4.010738893834769e-02   -2.503664420844790e-02   -5.408385746779464e-02   -1.962656991291497e-03   +4.602776673229883e-02   -8.466987004281477e-03   -2.231395668186102e-02   +3.492327467894935e-02; -1.976375636161052e-02   +4.652273567590776e-02   +2.816432429016170e-02   +2.044324387001650e-02   +5.879037668324819e-02   -1.449870135801438e-02   -1.463115457898215e-02   -1.823296943772561e-02; -3.220801840186104e-03   -3.016330257086598e-02   -3.171991936655466e-03   +3.507599932230301e-02   +6.727252768890556e-02   -5.899598572383034e-02   +1.109292846706946e-02   -8.527357511488641e-02; +5.561072165950819e-02   -5.804400343803734e-03   -2.131199959259753e-02   -8.346154425059742e-02   -2.480909955033202e-02   +4.000506102986674e-02   -2.769339698686259e-02   +5.637411083558154e-02; +3.304052966892727e-02   -5.496362651761531e-03   -1.132065303709416e-02   +8.269648278413715e-03   +7.083155888233615e-02   -7.476568880280918e-02   +3.794422478590639e-02   -6.446610546763984e-02; +8.880733219151966e-03   +1.355103760366113e-02   +1.306236558490743e-02   -1.263864523275398e-02   +1.484357122831492e-02   +1.285409080612487e-02   +3.203012819402479e-02   -5.297851390048038e-03; -1.474652621863147e-02   +3.593980275142537e-02   -2.964312765127736e-02   +3.942981465397177e-02   +2.381275405918386e-02   +2.455035488037052e-02   -2.563951073362228e-02   +3.420009479891241e-02; +4.370338692435403e-02   -6.217429495527553e-02   +8.997798135726362e-02   -8.317229392335972e-03   +2.757401272512403e-02   -5.157105664215360e-03   -6.055370397148997e-03   -8.815215365303539e-02; +7.027457913686648e-02   -2.821813240977131e-02   +3.760537260402717e-02   +3.354410027719431e-02   -7.073471712816526e-05   +3.152767669202806e-02   +4.142665232298474e-02   +5.441019829179657e-02; +9.532572506103149e-02   +1.473224413462202e-02   +3.901906399481645e-03   +2.398469327673182e-02   +4.406452970981373e-02   -2.055993724188330e-03   -3.121124957380477e-02   -1.583588003534080e-02];
L1E_L2E_iAMPA_netcon = [-5.279602911433215e-02   +4.613078981323647e-04   -6.386178649526022e-03   -3.494594315300999e-02   +3.349265775180518e-02   -2.227521737701155e-02   -4.882130702088408e-04   -2.120663264669683e-02   +3.575372573207411e-02   +8.453801415079107e-03   -5.547733903638339e-03   +5.828404802589139e-02   +2.275827696631833e-02   -2.617945198821333e-02   +4.677072989891443e-02   -1.591423810845384e-02; +1.997864451349798e-02   +7.778596753050036e-02   -2.459018710748533e-02   -3.405933176473853e-02   +5.208203884676501e-03   +9.994686780893712e-02   -7.437816218466820e-02   +4.085888416563779e-02   -8.314408816597334e-03   +2.394664988184536e-02   -6.286658194514944e-02   +1.578041950473837e-02   -1.074707713793189e-02   +1.782404998608445e-02   +7.312215421273942e-02   +4.325105608340656e-02; +2.329887853895135e-02   -1.574231246684516e-02   +1.158837129215960e-02   +2.814606955494191e-02   +9.315613669663686e-02   -9.264901982286279e-03   -4.877097258687956e-02   -3.520998076536311e-02   -8.530266973786576e-04   +3.607513460231609e-02   -2.290882720648411e-02   +1.414836612945316e-02   -3.596119977171436e-02   +4.008110710507594e-02   -3.630489571605838e-02   +1.235566859206003e-01; -2.678541758182697e-02   +7.467751146665194e-02   +2.429450691805945e-02   +5.147120119232982e-02   +6.415865299420703e-02   +7.202724248359978e-02   -3.744763565016518e-02   -5.459713413635159e-03   +3.638117586321189e-02   +1.653819449892015e-02   -4.053570166334165e-02   +6.101288509085673e-02   -6.530882368764945e-02   -1.076856920906745e-02   +6.508044083829881e-02   -4.680197330435400e-02; -1.142267902544797e-01   -1.021099447513372e-01   -1.661433702287716e-02   -5.517307666623785e-03   +5.721375330309725e-02   +5.529900729502991e-02   +8.673523065793219e-02   +2.508829857524066e-03   +2.805829419078783e-02   +2.424943735067584e-02   -5.490402595629957e-02   +3.500114954360695e-02   +6.858524363090154e-02   -1.097411490429289e-02   -4.481193878232359e-02   +7.502228552862035e-02; +8.227510109933859e-04   +6.759794518105360e-02   +2.861793784813255e-03   +5.339306809132160e-02   +2.819477733152034e-02   +8.945029664000460e-02   -3.534436157209095e-02   -1.629984307050679e-02   +4.469561085512049e-02   +1.744136180654430e-02   +6.598257187805610e-02   -7.640965359907661e-03   -1.037968983421428e-03   +7.698485306826899e-02   +4.910817817286997e-02   -1.083013085557454e-02; -3.226500423275475e-02   +3.642502928563519e-02   -1.341197548030734e-02   -4.972419707202255e-02   +4.877968510171392e-02   -5.458518521429134e-02   +5.541415176879252e-03   +5.981371643181542e-02   -1.280620528500324e-02   +5.107525781250982e-03   -8.544489713617270e-02   +3.917803399400344e-02   +3.601902364522695e-02   -1.917882717506385e-02   +2.523449962134874e-02   -4.489008048416878e-02; -5.646873837876716e-02   -8.179373290083893e-02   -3.439445825642793e-02   +5.015279345991640e-02   +4.522145270909308e-02   +5.131199381186231e-02   +4.990737628934754e-02   +5.522036770171204e-02   +4.599925258467413e-02   +2.146362846246633e-02   +1.115051919872677e-02   +1.930701538256315e-02   -5.100739950600715e-02   +2.927859566434916e-02   -3.068822083761974e-02   +5.228938541802602e-03];
L2I_L2E_iAMPA_netcon = [+4.404173539924559e-02   -2.236458732360834e-02   +7.650601089352142e-02   +5.749115545204986e-02   +1.584275886714917e-02   -4.340954544388028e-02   +1.117487653584375e-02   +4.162861476399327e-02; +4.484257102627685e-02   +2.388243049701332e-02   -4.479440689770169e-02   +4.631228101232399e-02   +2.980815026354521e-02   -4.795182494885390e-02   +3.682316774235377e-02   +1.082107237793465e-02; +3.204178847824088e-02   -3.603140307667210e-02   +2.956452563169682e-02   +1.176645765307320e-02   -8.500211710274318e-02   -5.788672296615244e-02   -5.246986823843072e-02   -3.253211522583139e-02; +4.981150589088996e-02   -8.291605629858026e-02   -7.338561063554305e-02   -1.190629247224425e-01   -3.157191808145764e-03   -1.282709867717461e-02   -4.760286442894973e-02   +4.461946578571154e-03; -3.570508145538740e-02   +1.043463132742307e-02   -1.830053196867820e-02   +5.856051205152524e-02   +5.972882773691715e-02   +4.998682151731236e-03   +4.490058035743933e-02   +4.737502635453630e-03; +2.158122439309157e-03   +1.303099490106634e-02   +9.519172624385296e-03   -6.606164581328007e-02   -1.685049599249175e-02   -2.240109783082048e-03   +3.625538775053230e-02   -2.476213034951285e-03; -1.927790722941107e-02   +4.255651164347671e-02   +1.278287259125932e-02   +5.000859500382071e-02   -4.061522181050118e-02   -7.509173256487491e-02   -2.069599613973350e-02   +9.433078884947035e-02; -6.053197102948016e-02   +3.365315898789278e-02   +2.830778256978373e-02   +6.053375047754178e-02   +1.038942143365539e-01   +2.523557995531167e-02   +1.274395505708294e-02   -2.173782031913046e-03];
L2E_L2I_iGABA_netcon = [+2.735920115711272e-02   -5.949261320803188e-02   +5.181240977884656e-02   +3.401694171462499e-02   +3.082367629140206e-02   +8.019111986938267e-02   +2.322132690842159e-02   -2.433287109059262e-02; +1.644635248688816e-02   -4.521696284018610e-02   +5.946311245765279e-02   -5.542015749779440e-02   +1.650486263614998e-02   -3.341927803840412e-02   +6.768837228478281e-02   +2.520848193183325e-02; +3.085677180232810e-02   -4.455435606755223e-02   +2.003769852743829e-02   +1.314412946428128e-02   -2.513585063763590e-02   +4.399960613672395e-02   +6.504207288318085e-02   +2.842585959833221e-02; +1.767113144743306e-02   -2.348628072487601e-03   -2.258133097919227e-02   +3.227482100293805e-03   -1.639493950895069e-02   +6.674030201431259e-02   +6.354730648029074e-02   -9.521061764462468e-02; -2.356366184904964e-02   -4.082045972850665e-02   +2.813044908853651e-02   -5.767551601034123e-02   -6.279222751988227e-02   -1.677372200486352e-02   +5.961964709917834e-02   +1.940682476620145e-02; -6.139848350485075e-02   -9.196911458843848e-02   -4.902375505318880e-02   -1.113319861356432e-03   -6.053289388119886e-02   -1.646588157957669e-03   +3.405343289308725e-02   +1.530022239906417e-02; -5.982042039859012e-03   -1.355165031603753e-02   +4.042763648658972e-02   +7.071154385455899e-02   -9.368441535649648e-03   -6.584059321045106e-02   +2.889953325731862e-03   +6.156342752284034e-02; -5.978596441285300e-02   +1.581124396300727e-02   +8.952583339038545e-02   -1.477852644139038e-02   +3.221806378421937e-02   +7.590167481518330e-02   +6.060727915873275e-02   -2.139129502517385e-03];
L3E_L2E_iAMPA_netcon = [+2.669761947784388e-02   +3.984408039769192e-02   -3.493117553692140e-02   -4.363795933874902e-02   -1.098194042521210e-02   +5.528337601180952e-02   -3.393178709581123e-02   -3.564203773304841e-03   -8.875440106885869e-02   +1.570269780298411e-02   +3.804358655756548e-02   +4.626670991234865e-02; +8.921422468201684e-03   -1.553358175079044e-02   -1.026180029464141e-01   +3.748422549441482e-02   -2.464078343384995e-02   -1.285383934341411e-02   +1.575485430468078e-02   -4.081814351269807e-02   +5.400346394920756e-03   -4.187727128439778e-02   +2.060283521091848e-02   +4.398936870617490e-03; +5.813078529595422e-02   +8.177013407659525e-02   +2.084204269268342e-02   -2.767374847506984e-02   -3.734324934764333e-04   -2.944547246343309e-02   +6.227938001324750e-04   +1.143859463911340e-02   +1.254128954356210e-02   +7.689785419854732e-02   +1.929965117884462e-03   +1.087821520498840e-02; -1.284314668598540e-02   +4.832741875102264e-02   +3.973992725617322e-02   +3.512252652613106e-02   -6.680208684137360e-03   +9.485790440985074e-03   -7.930109268443705e-02   +7.219913785610313e-02   +1.900616912705421e-03   -2.250674705405107e-02   -1.222751874468896e-02   +7.293378343601631e-02; +9.046680482255019e-03   +1.120212384742305e-02   +8.300261545438381e-02   -8.407162328588647e-02   +6.218056466304542e-02   +4.310768134055373e-02   -1.019081615200327e-02   -3.262698777914910e-02   -3.224622167062653e-02   -1.093180516844536e-02   +5.194467965193619e-02   -5.536104134086968e-02; -2.127653973504325e-02   +7.340846256573934e-03   +5.139122927795497e-02   +3.514453024911001e-03   -1.567914693229976e-02   -3.444628752341128e-02   -6.221570206105918e-02   +7.709658230914468e-03   -5.022651951439206e-03   +1.632530717663076e-02   -4.510399812579954e-02   -1.392075696920013e-02; -2.397792937106826e-02   +1.014636567855929e-02   +5.274796845288150e-02   +6.147369391551545e-02   +6.249090506496067e-02   +2.193012460277022e-02   +9.543038522577843e-02   +2.121108434759374e-02   +7.454098447406220e-02   +8.701980687003448e-02   +2.860936052250997e-02   +5.811658366848589e-02; -2.505583781610986e-03   +4.923959411640638e-02   +1.735180222138850e-02   +2.200988676746235e-02   +1.628000104284303e-02   +2.452018576183881e-02   +8.849787379447027e-03   -3.343578057988619e-02   +8.255080488254012e-03   +6.323724703588558e-02   +5.796151727928679e-02   -2.337380026209524e-03];
L3I_L2I_iGABA_netcon = [-1.009147441768613e-01   -2.717291826515618e-02   -2.095843552336410e-02   +4.697673013307426e-03   +5.032762680322424e-02   -1.619681260890802e-02   +4.323582434719467e-02   -1.844121319645468e-02   +4.323570867623469e-02   +7.109945703590212e-02   +1.570158143065120e-01   -4.561203010029635e-03; -1.851411500405775e-02   +1.891368530640076e-02   +7.714617081279952e-03   +4.402450439704306e-02   +1.676322359911712e-02   +4.617762245093551e-02   +7.564665422257047e-02   -4.043659811889736e-02   -7.716469389663129e-03   -3.436544501023134e-02   +8.671549422791965e-04   +3.728773936765897e-02; +7.819150928538530e-02   +7.916184189148007e-02   +2.418947526785899e-02   +7.064848755076873e-03   +2.618479077982297e-02   -4.864843174878343e-02   +4.514474644798996e-03   +8.938357743620191e-03   +3.433047530191442e-02   -5.452797114529407e-03   -1.772024252249735e-02   -2.155738510517665e-02; -1.604246331297966e-02   -3.298418872594967e-02   -4.097321070980831e-02   +1.733819279086213e-02   +8.253852707021576e-02   +5.745692756706589e-02   +2.730407933398870e-02   +1.159509204370129e-02   -7.597528513699305e-03   +5.900955264786212e-02   -4.088017678104987e-02   -2.514600505791127e-02; -3.113076734295405e-02   -2.321242910402259e-02   +3.463078305945686e-02   -3.263174764511356e-02   +1.047289785916115e-02   -2.847103377279652e-03   +2.524969371738502e-02   -3.748200501561336e-02   +8.942038436631989e-03   -9.863441348082624e-02   +1.883874696085761e-02   -6.728184882201841e-03; +7.761911459349565e-03   +8.429720459516366e-02   +2.986174958436603e-02   -8.441696117732088e-03   +2.299215516751591e-02   +4.945365179864093e-02   +2.312465083158674e-02   +2.291949665517028e-02   -7.071982211161051e-02   +3.054431221148693e-02   +3.787714537027684e-02   -3.447271506089025e-02; -4.728288458047705e-02   -7.072717285413928e-03   +9.794812878476655e-02   -5.246410738612393e-03   +6.341356850469193e-02   +9.632648662668372e-02   -8.282073564212110e-02   -6.264413380675545e-03   +6.052743929006547e-02   +5.103439937390709e-02   -1.051163982574382e-02   +2.354116482948129e-02; +4.951891544698361e-02   +7.900147605328148e-03   -1.877439599393111e-02   +5.175324643477212e-02   -6.751055637594858e-02   +1.563074870772157e-02   -4.104254469052968e-02   -2.748609460173148e-02   +1.233934872676901e-02   -2.752302746559387e-02   +9.294013837241202e-02   -6.174625091610821e-02];
L2E_L3E_iAMPA_netcon = [+1.161664747552767e-03   +1.388149038953632e-02   +1.237742310981285e-02   -5.087783181006394e-02   +3.781365276702846e-02   +5.185810067195010e-02   +4.303342898751168e-02   +5.253971339402419e-02; +8.948068830441454e-02   +3.628888930723435e-02   -7.386083906529892e-02   +7.116763965422939e-04   -9.259314791702325e-03   -1.288104017548843e-03   +4.760132297418180e-02   +3.314290042890598e-03; +4.939318197781029e-02   -8.011377227126687e-03   +5.261254000164499e-02   +9.326125473253818e-02   +1.151617545933680e-01   -4.085864141610701e-02   +2.424332687819077e-02   -7.492689268963828e-03; +1.910174587291377e-02   -7.448202914422425e-03   -2.242299518543057e-02   +3.587589261249929e-02   +2.658908441547826e-02   -4.483119130357746e-02   +7.748879096667086e-02   +2.539365339931971e-02; -7.097274998864880e-03   -4.971705286517891e-02   +5.669518249840395e-02   +6.972553591210624e-03   -2.375844637828160e-02   +5.177620307034975e-02   -7.058606557686489e-02   +2.888728543216440e-02; +4.642685661285443e-03   +3.358370641679146e-02   -1.783081138141486e-02   -4.825666022673031e-02   -6.519146128534650e-02   -6.493336204343027e-03   +3.968523354315861e-02   +1.830628868432932e-02; +4.954012537592041e-02   +7.004104653806404e-03   +1.205877248242903e-03   +1.071930915595522e-01   +2.465286544454770e-02   -1.043359861514330e-02   +4.107332421004316e-02   -3.216086696905605e-02; +9.344485208548463e-03   +1.947681457108722e-03   +2.268704639468252e-02   +3.152339685903640e-04   -3.770210631434649e-02   +2.931612047264946e-02   -2.502281554470524e-02   -6.519746680546062e-02; -1.199328000661099e-02   -8.410134409999770e-02   -1.231048043466211e-02   +4.263240923782845e-03   +2.130491322054902e-02   +5.344963470171744e-02   +6.047174531726325e-02   -4.004769226592064e-02; -4.684643974349745e-02   +2.872934245311051e-02   -6.182311450375461e-02   -5.608566698912965e-02   +3.983481145352820e-02   +4.740156404695234e-02   +5.276730798946162e-02   -4.426770663820623e-02; +5.306753726695895e-02   -5.558812524451227e-02   +4.990082324055836e-02   +5.002748392619968e-02   +1.521848441246610e-02   +3.221047968255580e-02   +1.943081953521614e-02   +1.039457944912130e-01; -2.661576623673310e-03   +8.266024298668387e-03   +6.235668912323359e-03   -7.410133841284577e-02   -2.580405101804080e-02   -1.389293793379730e-03   +1.028367853345651e-01   +1.017948717624291e-02];
L2I_L3I_iGABA_netcon = [+2.662658434226449e-02   +4.084967370520740e-02   +3.765392867456928e-02   -6.673493253818136e-02   +5.509857763427597e-02   -2.983058802463306e-02   +7.884179789287014e-02   -6.836510964947145e-03; -2.734883548216944e-02   +3.843209248749513e-02   +9.783597836343957e-02   -2.030592620870677e-03   -6.761569293692904e-03   +4.367415540541252e-02   +1.071242277577128e-01   +4.364288539326126e-02; -7.927292214486410e-03   +1.715443054528433e-02   +1.914972969962855e-02   -2.844079913429265e-02   +6.908834366583977e-02   +4.571931131677699e-02   -2.487036410642271e-03   +4.957148306890939e-02; +4.714924934185919e-02   -2.658995462798348e-02   +4.497504868556358e-02   -4.732421673967231e-03   -2.788322869935939e-02   -7.724853252244213e-02   -7.377561164164936e-02   +1.877461940225919e-02; +3.692638723007893e-02   -3.573640595732087e-02   -3.014907886827325e-02   +5.357320517794188e-03   -8.716017964550395e-02   -2.281501429141725e-02   -2.246785388968083e-02   -4.842045343702329e-02; -4.390276630281317e-02   +6.450138887771073e-04   +4.854374108324572e-02   +4.232536021695740e-02   +4.876391684827794e-03   +2.941227944905965e-02   -6.303859709218917e-02   -5.382698821591878e-02; +5.441075729287526e-02   +8.338047697995787e-04   +9.252656182268749e-02   -1.030431494006012e-02   +5.924698785118249e-02   +4.475154798036930e-02   +4.031318350705836e-02   -3.259798822171026e-03; -3.748892371583583e-02   -4.928862113738109e-02   +3.251073616114400e-02   +1.197597394807280e-02   +4.261176784570955e-03   +1.523727033337849e-05   -4.307412753366426e-02   +7.987486788582668e-02; +7.615895769789063e-02   +3.245128269865553e-02   +6.133727623405689e-02   +4.894195356370173e-02   +5.344876384493143e-02   +6.387063241127461e-02   +6.695793059138688e-02   -8.905068038747853e-02; +3.189278689442829e-02   -2.240561966577788e-02   -2.489130342164577e-02   -1.157621600242100e-03   +9.669999707503872e-02   +4.674888775254479e-02   +5.879068464347700e-02   -2.204140701911632e-02; +7.263413788448941e-02   -2.036941618370424e-02   -3.768055402474010e-02   +2.993372185114887e-02   +5.748903236613334e-02   -2.495957952328093e-03   -6.904217536742781e-03   +2.176813596557624e-02; -2.290725059693254e-03   -1.597834405316290e-02   -2.964467669641332e-02   -2.418332137779527e-02   -5.547993408915258e-02   -7.966961090088773e-03   +1.461758846125616e-02   +5.945812895536457e-03];
L3I_L3E_iAMPA_netcon = [+5.738934649679919e-02   +2.921687428687431e-02   -6.043350599396732e-02   -2.465181415561931e-02   -3.518563830647937e-02   -5.794343717450411e-02   +4.182278515563382e-02   +1.559786189804802e-02   +1.353487099001031e-02   -6.353982905786230e-02   +8.991027888169384e-03   +1.760674494175351e-02; +5.453626307225547e-03   +6.425365495424418e-02   +6.289010382819257e-02   -5.245781936106340e-02   -1.457121220605133e-02   +3.358751282458057e-03   +3.748536553035317e-02   -4.413610931660810e-02   -2.726282561108412e-03   +9.291589124472276e-02   +2.756534195564864e-02   +1.610343785687136e-02; +2.352059740898098e-02   -1.600921105635749e-02   +2.476081767712893e-02   -4.193742572546207e-02   +2.622107638921664e-03   -3.171762695673969e-02   +2.726447676348844e-02   -1.051720705744399e-01   +7.545170627031533e-03   +2.157781388133131e-02   +5.146278730538233e-03   -5.757317909520585e-02; +1.159382723399903e-02   +4.566711470369594e-02   +5.998023593316524e-02   +7.457615560446554e-02   -2.535251911865544e-02   +2.709560200209787e-02   +8.070142914144566e-03   +3.627161855475321e-02   -1.083336754788818e-02   +6.304796400724597e-02   +3.333684852421179e-02   -2.891695667320582e-02; -3.535492668867268e-02   -4.064729556528852e-02   +1.997778239329978e-02   -4.112345443466426e-02   -8.212953460157520e-02   +4.387262001420637e-02   -3.012678701285806e-02   +1.168010126359969e-02   -1.525464234255378e-02   +2.388078795130738e-02   +3.237264277555504e-02   +1.208951777410155e-02; +3.323633213244707e-02   +1.034747264762022e-01   +7.962247992075750e-03   -3.874526972982783e-02   -5.431038873212061e-02   -8.744784720063594e-03   -2.838628202310737e-03   -2.109657174633222e-02   +3.443317681715675e-02   -1.466823335858814e-02   -2.972853610640810e-04   +1.035930447390602e-01; -5.625067835156451e-02   +3.668708155264459e-02   +4.156363703746301e-02   -2.388678739299662e-02   -3.038480678803863e-02   -7.784114105740628e-02   +5.522732776842905e-03   -5.197596874923797e-02   +6.631013670715316e-02   +5.144571150275370e-02   -5.079488851909174e-02   -3.779650007799268e-03; -1.152120509529159e-02   +4.016436707826972e-02   -2.367793734887328e-02   +6.525921559700536e-03   -7.227961030180086e-02   +1.425662433964624e-02   +5.212656105982490e-02   -5.479760308683147e-02   +6.332097688253413e-02   -8.688560193594735e-02   +6.174518929415605e-02   -1.872922047680750e-02; -4.796063700376592e-02   -2.336966010886943e-02   -1.214200972721142e-02   -9.312615049870776e-03   +1.725538784860935e-03   -2.120488398595335e-02   +1.222400114875358e-01   -6.497762018426578e-02   -9.517021307279652e-02   -4.775281525398406e-02   -2.594599958080606e-02   -5.988028586038359e-03; +3.718695475236655e-02   +1.259289044465329e-02   -8.389866378109996e-03   -7.885427467736889e-02   +4.126623720171135e-02   +7.231190585193938e-02   +5.352553790109120e-02   +8.271402797597703e-02   +3.245600152306752e-02   +3.037351264993057e-02   -4.564168390186045e-03   +5.293518590085530e-03; -7.334904458444483e-03   +4.424100892194308e-02   -4.353787273638251e-03   +1.689358441300810e-02   +1.248848595014216e-02   -2.103428451688062e-02   +9.141922615880418e-02   +1.998704459464797e-03   +1.476896279547847e-02   +4.628006766191506e-02   +4.293361544885840e-03   +3.324751707575701e-02; -2.246711021029516e-02   +7.440112771023305e-02   +9.346326963568899e-02   +3.301884314621014e-02   +5.657430107267029e-02   +5.208168002656469e-02   +6.776526694309196e-02   +2.545389901255059e-02   -1.300351378453505e-02   -2.540127675897558e-02   -2.766114234238982e-03   +2.033215019204318e-02];
L3E_L3I_iGABA_netcon = [+4.038774931447093e-02   +7.875814986755377e-03   -4.915260238739252e-03   +8.411577534454408e-02   +5.676457178037939e-02   +3.192945172203371e-02   +8.337086446976341e-02   +1.364952720081780e-02   -1.296828240947210e-02   +2.465884104053393e-02   +5.646119620886365e-02   -3.696718052038295e-02; +6.501042733361180e-02   +7.803418284084516e-02   +1.084213714733018e-02   -1.402919716753704e-02   +6.149600723263780e-02   +8.931494383475089e-02   -9.420063376300167e-03   +5.888773250093283e-03   -8.109967944572397e-02   +7.818507249962778e-02   -7.737830395082632e-02   +6.956491744588410e-03; +6.104891805012439e-02   +1.747471260784549e-02   +6.293012270245880e-03   -1.333467224178991e-02   +8.773704761155968e-02   -4.674854637826747e-02   -4.441036682409238e-02   -1.174227602011029e-02   +6.754414121454382e-03   +4.563228556530510e-02   -8.237092014024283e-03   -2.263258000178893e-02; -1.563516203023824e-02   -3.630563291862282e-02   +6.243448603102870e-02   +5.289171188158115e-02   +9.924321460601881e-02   -1.586554307464234e-02   -1.717456573386508e-03   +2.886513392966489e-03   -8.736446460734508e-02   +7.778606202043746e-02   -4.429542265085126e-02   -1.035301254494107e-02; +1.949669749712920e-02   +4.534000573653708e-02   +6.104812217018819e-03   +5.195384909572507e-02   +9.340781006526962e-02   +4.725651812305726e-02   +6.807347311963075e-02   -3.308607461803312e-02   +3.524314098335424e-02   +5.530996617652612e-02   -7.885178847696056e-02   -2.025050191142347e-02; -3.253204306965998e-02   +1.475682327608611e-02   +7.283491724966634e-02   -3.371067197905778e-02   +3.718667260286772e-02   +6.626406685959460e-02   -1.308037069861877e-02   -5.634951331570215e-02   +8.665252593770024e-03   +2.105176547287620e-02   +1.364371990458499e-02   -1.791112839985956e-02; -4.496452615329309e-02   +1.976676582687908e-02   +1.033682975241148e-02   +3.132380358411855e-02   +9.308266774501459e-03   -8.521055598789140e-02   -8.682430552273170e-04   -4.917246718837549e-02   +3.265773966163385e-04   +2.984514375888010e-02   +3.512961133196518e-02   -4.265623315021588e-02; -2.134952522091483e-02   +5.393579715360773e-02   -4.660544380782138e-02   -3.900243312937498e-02   +2.754107218682881e-02   -2.073355345439907e-02   -8.801880719298230e-03   -6.764400267490270e-02   +3.568580933047578e-02   -4.121677995875185e-02   +3.053885449963408e-02   -4.926501079439453e-02; +3.528185163098208e-02   -3.113570280622704e-02   +6.024412737725682e-02   +1.905497359149518e-03   +6.690780253556439e-02   -1.999483963979387e-02   -1.832787348826598e-03   +3.180086720166826e-02   +1.855137916053363e-02   +4.207767430916305e-02   -4.174164647555819e-03   +5.376967053431827e-03; +9.486005970884631e-02   -4.459622270751053e-02   +7.639918133866443e-02   -3.291438370052273e-02   +4.440951198986058e-02   -6.803178885056713e-02   +2.643693983594714e-02   +6.709737743872108e-03   +5.312126582350372e-02   -3.126054731724682e-02   +4.117509575752152e-02   -3.906159424657336e-02; -9.398117288363150e-03   +7.366530011207288e-02   -3.431597565728609e-02   +9.956525627092103e-03   +5.293814168652317e-02   +7.282790675791503e-02   +9.998765667310383e-02   -3.188764769796835e-02   -3.901833376907494e-03   +6.269210103038797e-02   -1.794736441439498e-02   -2.481252885078095e-02; -1.504182163821114e-02   +2.895403788869158e-02   -4.588859615632462e-03   +7.581870926989266e-02   -8.539857385174541e-03   -5.115622051069212e-02   +2.057536005112415e-02   -6.119126706019958e-02   -7.946562257322824e-02   +3.648875628220707e-02   +1.234129831847673e-02   -7.718388055126708e-02];
L2E_Input1_iAMPA_netcon = [+2.705530331517316e-02   -8.961571503768725e-02   -1.543364122438880e-02   -1.254028035032217e-02   +1.521709973869335e-02   -3.664740054526078e-02   -2.752953759526739e-03   +2.267406294407333e-02];
L2I_Input2_iAMPA_netcon = [+5.538115288727158e-02   +8.045138884850520e-02   +2.709306962654318e-02   +1.169910781986869e-02   -5.839068635839435e-02   +4.109592688356954e-02   -3.976930611751929e-02   +7.544457914556958e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
