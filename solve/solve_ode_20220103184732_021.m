function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147760265070258e-01   +9.465854266739435e-01   +6.993254200971907e-01   +1.553874460908992e-01   +9.219090831292034e-01   +2.196585282769412e-01   +7.406910373066812e-01   +3.018776390197533e-01   +5.329818150153137e-01   +8.293111462974195e-01   +9.688877939561704e-01   +9.644307844934301e-01   +6.960280975484862e-01   +3.709143758616575e-01   +2.976884526037419e-01   +3.790178542258263e-01; +3.448781340951376e-01   +1.335774526971523e-02   +1.415700919044809e-01   +1.754853774426137e-01   +7.120272151379259e-02   +8.071919855704770e-01   +7.949656139738536e-01   +7.581830198959680e-01   +7.845153142664860e-01   +1.813253611186770e-01   +4.663619075915725e-01   +6.566347025696078e-01   +3.753700946559767e-01   +2.748129437930295e-01   +6.851529316157332e-01   +9.534112220937798e-01; +2.076094957893048e-01   +4.674391756070095e-01   +8.336623836654096e-02   +7.036301057194688e-01   +3.138705586669634e-01   +3.821712815443790e-01   +6.637909544644434e-01   +9.528118566047611e-01   +4.889514577217033e-02   +9.265808432628455e-01   +8.696332283533992e-01   +2.093402778024399e-01   +5.411053261454325e-01   +7.537559097115579e-02   +7.720152116602677e-01   +8.111157222801700e-01; +2.510644351736388e-02   +4.898401744635695e-01   +4.333545883927217e-01   +8.321879258420775e-01   +6.275920470849632e-01   +8.562674407954464e-01   +4.418852704879695e-01   +8.453176669253862e-03   +4.625808707793901e-01   +4.206359444390939e-01   +9.461043233439165e-01   +8.975948712956990e-01   +5.180593138304943e-01   +1.510217000266065e-01   +7.208203110797970e-01   +8.916227037772068e-01; +7.655608778916237e-01   +5.153126498091651e-01   +8.951128672608301e-01   +8.139139781234249e-02   +9.056941144631353e-01   +3.242646348533819e-01   +5.752210955633952e-01   +4.071312450732805e-01   +9.380774353390917e-01   +3.009061133988894e-01   +2.326540794129468e-01   +4.881299739144094e-01   +7.642728369269087e-01   +3.650001686540127e-01   +2.786060120106587e-01   +6.842047981691017e-02; +5.711908103276193e-01   +2.870922100556701e-01   +7.320739871913248e-01   +8.356368012877752e-01   +7.968713164734810e-01   +3.789281886146327e-01   +5.180464025024533e-01   +1.511434319438409e-01   +4.725665337905309e-01   +3.486690154341286e-01   +9.183633921392155e-01   +6.615554130884505e-01   +7.983648829629141e-02   +7.183651189778857e-01   +1.379132882606338e-02   +9.027558538856586e-01; +5.765109267744186e-01   +5.647255676877037e-01   +6.802896897020397e-01   +5.411458414900379e-01   +6.427945278323293e-01   +6.370003689829689e-01   +7.249587244215111e-01   +8.214184101336282e-01   +7.792061524742556e-01   +9.722027603360300e-01   +6.349035154198420e-01   +5.258862287155744e-01   +5.127132487246925e-03   +5.325764035785615e-01   +1.459377120758291e-02   +6.682255749777709e-01; +3.905361316978877e-01   +5.098512658649957e-01   +2.013261812183293e-01   +9.629529308497347e-01   +4.400339197518588e-01   +3.881386526179926e-01   +2.224100781058066e-01   +2.876015223354969e-01   +1.090746119442554e-01   +5.307104676990594e-01   +2.837477910329765e-01   +7.087100898112546e-01   +4.004687877989386e-01   +2.325290654718029e-01   +9.366833016015872e-01   +3.466143133235287e-01; +5.566638073289392e-01   +6.781759514730543e-01   +5.296387768470517e-01   +6.775721591198841e-01   +7.479923390051649e-01   +6.748925625442093e-02   +9.982634463840669e-01   +9.781309817283271e-01   +5.225083230429877e-01   +7.902610640024644e-01   +8.552760681641148e-01   +7.187900988457497e-01   +6.618497845598256e-01   +4.705907260072724e-01   +9.339242444951726e-01   +8.367006848551630e-01; +1.836574063681514e-01   +6.157413654181585e-01   +8.304162151476382e-01   +3.364242819456902e-01   +8.250762729980190e-01   +1.710044433841675e-02   +6.200792023826909e-01   +6.253561063797969e-01   +6.360875241599516e-01   +7.937321675937146e-01   +1.654151366705918e-01   +2.947325760120822e-01   +3.682421211246327e-01   +7.170604527998242e-01   +3.744454158685964e-01   +1.986201646242729e-01; +1.182899157689769e-01   +5.653476956021455e-01   +1.747833195041692e-01   +2.209199484302904e-01   +3.411907128187414e-01   +8.792165598986943e-01   +9.798238635042078e-01   +7.440524630008162e-01   +5.784418230478094e-01   +1.451308210680190e-01   +8.282858997601082e-01   +1.170583794752981e-01   +3.923839984323145e-01   +5.146234168118725e-01   +1.093081753854539e-01   +8.420592283194189e-01; +5.875407875757876e-02   +5.045006003691611e-01   +5.184109237049178e-01   +5.693654333363279e-01   +1.392351225208076e-01   +1.575402914927685e-01   +4.952049818138274e-01   +8.727074147787456e-01   +8.352880159697366e-01   +4.561158293138910e-01   +2.165613129103016e-01   +3.251320634625939e-01   +1.345607477977156e-01   +5.142080259407235e-01   +7.194263506675765e-01   +4.251876332393395e-01; +9.327601556705296e-01   +6.679707486639084e-01   +3.557969266130175e-01   -3.632357847175194e-04   +5.038843685689652e-01   +9.139129485531864e-01   +5.229882322578462e-01   +3.291480434482013e-01   +1.160902930010449e-01   +4.588663056116375e-01   +2.686424683630856e-01   +4.566754984108267e-01   +3.385048006292958e-01   +3.858994436399561e-01   +4.495257561008227e-01   +5.590051912202647e-01; +7.456156370914285e-01   +6.330144411258499e-01   +6.448159526585314e-01   +5.885664927694441e-01   +4.137407559611552e-01   +5.558820289163467e-01   +8.546514945903848e-01   +9.901773986023692e-02   +5.219969794632535e-02   +9.540677845160441e-01   +8.660858653495387e-02   +7.171441595303217e-01   +1.220102753902562e-01   +4.795873767775363e-01   +1.254088034402560e-02   +4.485386846286946e-01; +2.430441797729001e-01   +1.450986061568846e-01   +2.819076653009693e-01   +8.913565746059250e-01   +1.715007007907207e-01   +9.222499726985595e-01   +2.541049504172435e-01   +4.507688930387848e-01   +5.175466094217080e-01   +5.347685875740204e-02   +9.166064827783592e-01   +4.050292064563062e-01   +3.689503629761935e-01   +7.397828953540150e-01   +1.241152356509708e-01   +7.597056910098074e-01; +2.044820928574857e-01   +1.792089311688411e-01   +4.366488542476755e-01   +2.549190685366194e-01   +4.939809999590342e-01   +5.977000574886913e-01   +5.828674712498583e-01   +2.396920853023960e-01   +6.975970909550755e-01   +3.657481349217614e-02   +7.263187437071407e-01   +2.417869111883797e-01   +2.507408278183137e-01   +7.019303624147141e-01   +6.587526116260048e-01   +9.588161625745141e-02];
L1E_L1I_iGABA_netcon = [+8.440028655515937e-01   +7.527517749847368e-01   +8.744502458109636e-01   +4.350445294828622e-01   +9.179573335993714e-01   +7.788800358535927e-01   +3.218498222814772e-01   +6.409580847017033e-01   +9.417797270477445e-02   +2.657053120512559e-02   +1.292321005685751e-01   +5.201587246414111e-01   +8.702385409873820e-01   +5.765319589337020e-01   +1.657923313529726e-01   +6.271445594531893e-01; +6.213620818338232e-01   +9.954651139796505e-01   +3.092552054821857e-01   +1.472708115286409e-01   +8.832704040981716e-01   +2.728960393436392e-01   +9.631101556312268e-01   +4.292797955231659e-01   +2.925274236979324e-01   +5.144081302507133e-01   +4.250155063885581e-01   +2.041691862650787e-01   +8.029256026004529e-01   +2.882032099108830e-01   +5.489342963359328e-02   +3.361853709717001e-01; +6.718153167831429e-01   +3.709859613827119e-01   +4.336124445328340e-01   +6.543278523475381e-01   +5.858601251625457e-01   +5.269235445483375e-01   +3.527359660454176e-01   +4.778256138467811e-01   +3.261097174461463e-01   +8.633091286290538e-01   +4.807524692901548e-01   +7.750016887969936e-01   +6.468309532386676e-01   +1.320891527824663e-01   +2.110827503088716e-01   +1.561347672417467e-01; +7.819625942986888e-01   +5.019979213140439e-01   +3.815877409724314e-01   +7.212034065918616e-01   +8.353466674369223e-01   +4.029982143078948e-01   +3.201895085191876e-01   +1.002631189632499e-01   +4.829477132476637e-01   +5.812127136296666e-01   +6.739211053476454e-01   +3.911932040684197e-01   +7.347746198572711e-01   +4.958055933006868e-02   +2.040520456894055e-01   +4.022329634476864e-01; +3.090789537788352e-01   +7.588489484687515e-01   +6.566769989069554e-01   +1.618683349299858e-01   +7.766209264963029e-01   +7.790916662849905e-01   +9.082195647763368e-01   +8.072900679930436e-01   +2.416504767383402e-01   +4.222980786896987e-01   +3.574775518371570e-01   +6.677046307433425e-02   +6.671880353191638e-01   +6.241733071206318e-01   +2.173137820332508e-01   +9.130425956202654e-01; +3.303000303669817e-01   +1.272996136771778e-01   +2.369171240402506e-01   +3.426960007867479e-01   +7.848774901978669e-01   +2.574635093730536e-02   +8.847332538813826e-01   +6.536566548020462e-02   +4.537113049332954e-01   +7.132305312407003e-01   +5.019116397800337e-02   +7.561739527084422e-01   +8.809940184733486e-01   +6.059443984732733e-01   +5.782868154938690e-01   +1.489702699114626e-01; +6.340783736585249e-01   +5.178710658208677e-01   +6.857844346158195e-01   +1.062956779511235e-01   +7.015373624899467e-01   +4.120327400466378e-01   +3.524095003634284e-01   +9.543460039681506e-01   +7.585285496386149e-01   +2.338750275988205e-01   +2.906684243819198e-01   +4.529822414407608e-01   +8.530887583323096e-01   +3.712250159972720e-01   +3.338550222063709e-02   +4.640556075864708e-01; +9.018967296741504e-01   +9.059940537112954e-01   +3.268217058094802e-01   +4.131400908060452e-02   +1.852823425382046e-02   +8.264734037596764e-01   +7.499154315322009e-01   +7.730018811554417e-01   +7.188424369419796e-01   +5.868474141094585e-02   +7.940895822412366e-01   +3.190339753799149e-01   +4.037149636701096e-01   +8.318512648629163e-01   +7.954304106531844e-01   +7.856133565145494e-02; +3.711562321668302e-01   +9.912418979491157e-02   +8.811489011318261e-01   +4.785487575666036e-01   +3.306162525529244e-01   +5.925661279922054e-01   +1.262772542592634e-01   +4.403860092496559e-01   +2.376578756300659e-01   +9.762821462045199e-01   +6.519734968099281e-01   +2.781003457070791e-01   +1.054179366628859e-01   +5.197134927815483e-01   +1.342180838631751e-01   +3.422898045652284e-01; +8.818664777277001e-01   +1.789135353147435e-01   +9.990610734576896e-01   +4.771862316942312e-01   +9.477254482254637e-01   +2.134970880612154e-01   +5.992475248615204e-01   +1.657600203591224e-01   +6.994185981741822e-01   +9.697225918010979e-01   +7.099792275736857e-01   +5.837919663902162e-01   +4.032743988345195e-01   +8.008517097029201e-01   +5.823649464725336e-01   +4.966102863909942e-01; +1.241906530318692e-01   +1.728771345768991e-01   +6.805827413133104e-01   +5.462022620473848e-01   +3.987869661341930e-01   +2.961125334182357e-01   +4.369190640707639e-01   +8.100654201435872e-02   +3.049378406233663e-01   +1.369115454115027e-01   +7.655959291846438e-01   +9.117405360817916e-01   +3.405928935805486e-01   +5.703709192261532e-01   +8.552227159906731e-02   +4.892302195039980e-01; +8.866601448404271e-02   +5.338318802141725e-01   +3.445498729250461e-01   +6.513389215234388e-01   +6.322412843518177e-01   +2.680784174118337e-01   +9.590529468557915e-01   +7.424056224747468e-01   +4.700201725607165e-01   -3.251791784843807e-04   +3.838465816180145e-01   +4.507526899781771e-01   +1.146276551589310e-01   +7.149275243683554e-01   +2.289625282708979e-01   +1.275331617491169e-01; +5.460181575592791e-01   +9.792159701740802e-01   +5.605319156616455e-01   +3.489779730048386e-01   +8.589060717267373e-01   +9.283683545956289e-01   +9.640777175858921e-01   +5.441651106702102e-01   +4.443883067562306e-01   +9.368133654937436e-01   +3.616722050309592e-01   +9.802588728047690e-01   +8.517270649740027e-01   +7.326660189190954e-01   +4.518758724324852e-01   +8.592803465639375e-02; +6.105136832880220e-01   +8.432511832561547e-01   +8.904848823177849e-01   +2.559338090952794e-01   +3.772816056889481e-01   +5.526407843887737e-01   +2.422471198396792e-01   +4.858008317756138e-01   +7.343300334795646e-01   +7.410307116960596e-01   +8.101310777555422e-01   +1.110610898793652e-01   +8.924625290395448e-01   +4.549232870906325e-01   +1.787904941345085e-01   +6.742569501014664e-01; +7.274800974084367e-01   +6.728915250128604e-01   +6.464321362400445e-01   +1.763369123101270e-01   +2.047240463039539e-01   +4.322715348523466e-01   +7.704924830810078e-01   +8.954983598086583e-01   +8.763521599049443e-01   +4.324689089688759e-01   +3.858435589433795e-01   +4.154243669458116e-01   +6.856568159943494e-01   +2.831415842914509e-01   +4.140923453059576e-01   +1.220928444702470e-01; +9.920080033897450e-01   +9.229508517392609e-03   +3.769299272817871e-01   +4.785342067860605e-01   +9.121274569560700e-01   +3.280244590910599e-01   +7.125214109997513e-01   +5.823712789412715e-01   +9.135201983571062e-01   +9.441833262390155e-01   +8.716237040913751e-01   +3.827638872507829e-01   +7.429437318432230e-01   +1.516189758807586e-01   +9.650795112073787e-01   +9.889545663426702e-01];
L2I_L1I_iGABA_netcon = [+5.740936494895382e-01   +5.647841186365835e-01   +1.078677042055641e-01   +4.598252381615007e-01   +7.966784386445406e-01   +9.779946614178324e-01   +2.238899992146655e-01   +7.583165980648188e-01; +5.581888344234607e-01   +9.535101394561026e-01   +1.188403182605982e-01   +5.667211673148576e-01   +5.423192433871490e-01   +4.225643314180744e-01   +6.617176079560504e-02   +5.062499538416013e-01; +6.109736363626856e-01   +8.630082934968473e-03   +4.341074659496050e-01   +8.168300950318899e-01   +2.571153331707736e-01   +3.930761005845882e-01   +8.355836064074363e-01   +8.283016578587867e-01; +4.668977337199721e-01   +1.261309176129382e-01   +9.321536279402409e-01   +3.555433185808789e-01   +7.814073016682265e-01   +4.608722924507521e-01   +4.148270576046912e-02   +9.275192268586688e-01; +4.343851608094468e-01   +8.538206970749621e-01   +1.399327649810818e-01   +2.484153910021705e-01   +7.794388266567632e-01   +1.215489879880759e-01   +9.094511200841354e-01   +7.107602247573688e-01; +6.258168036490933e-02   +2.180598808324620e-01   +8.260797369467991e-01   +7.711459639107379e-01   +1.443023094207011e-01   +4.544847710791706e-01   +4.492778405221707e-01   +7.975442832206064e-01; +6.467516516078128e-01   +7.097993266707567e-01   +9.326820458266766e-01   +1.700242054806879e-03   +8.235326364252803e-01   +2.646706041649061e-01   +2.845300157523752e-01   +9.589153499829414e-01; +4.263592799295492e-01   +7.748434008105445e-01   +5.728286798444354e-01   +2.765603225958553e-01   +6.233847582064730e-01   +9.288709337373897e-02   +7.555625476643455e-01   +9.514310607600855e-01; +7.561797323620050e-01   +4.213851111015174e-01   +4.986722526827579e-01   +2.320093751644198e-02   +4.569384935835742e-01   +6.619168208524344e-01   +9.269422921888326e-01   +2.954786294377299e-01; +3.064416299046542e-01   +7.256864395041049e-01   +9.315184510206820e-01   +6.702429046493500e-01   +4.835621017503147e-01   +9.450428765037725e-01   +1.408262298192728e-01   +3.521330373151549e-01; +5.972675831949085e-01   +4.582417346422337e-01   +8.623699176682921e-01   +9.673422750523756e-01   +2.190034870765489e-01   +7.646654798798304e-01   +9.555452278004608e-01   +5.412838560072291e-01; +3.346910526148226e-01   +8.050457089860074e-01   +2.537778276234268e-01   +9.455282000722864e-01   +8.578419709701522e-01   +4.338496428283900e-02   +3.043587782349818e-01   +2.128870774363202e-01; +6.431398494057453e-01   +4.279376036831918e-01   +4.585171946979531e-01   +4.635122138628162e-02   +8.799378603365998e-01   +2.608931177016623e-01   +2.095766586833380e-01   +8.087387235419674e-02; +5.482741830713895e-04   +1.490351971433091e-01   +7.409510427014528e-01   +2.866709166812506e-01   +8.457493681283685e-01   +6.345841678864230e-01   +4.638010162845616e-01   +5.065423461765814e-01; +1.444471839909559e-01   +8.052709496556170e-01   +7.524007112231109e-01   +4.878127668870340e-01   +4.431104868376958e-01   +8.945203949345139e-02   +5.972657966339620e-01   +1.947200148342674e-01; +2.478629683256511e-01   +3.814831104000059e-01   +2.299779744649161e-01   +8.876993386601061e-01   +5.429002012202173e-01   +7.497727774076715e-02   +5.519204272696573e-01   +1.458659757833099e-01];
L1I_L2I_iGABA_netcon = [+6.987623325439893e-01   +8.673302149832227e-01   +6.140647984437871e-01   +5.534726618430337e-02   +1.433801454896132e-01   +2.346246946438053e-01   +8.383048765876023e-01   +3.707952038311927e-01   +7.066186602838883e-01   +3.843850334268659e-01   +2.395682760580888e-01   +6.668737626954950e-01   +1.682444794129134e-01   +5.697916814872371e-01   +4.343792808807081e-02   +4.870604812657540e-02; +5.985945623066081e-01   +7.976490453620257e-01   +6.102380860825064e-01   +5.786615108416222e-02   +7.446947009497880e-01   +5.564218549393685e-01   +1.977672911601233e-01   +5.586210972611018e-01   +1.868096910576430e-01   +7.196227836381967e-01   +5.138186228473793e-01   +3.291685429244917e-01   +1.151053417599107e-01   +8.098112788020541e-01   +4.422454663167618e-01   +9.216886216137639e-01; +1.630250003236960e-01   +6.270359027693596e-01   +3.142366613743615e-01   +5.970566912060897e-01   +9.515536815054966e-01   +1.137803015047482e-01   +6.173583436559301e-01   +8.297139144290523e-01   +2.311140488218582e-01   +6.421234893022374e-01   +7.319546157155328e-01   +5.514013458409232e-01   +7.356463909033375e-01   +6.741515643909601e-01   +9.167796633045083e-01   +1.743070137471277e-01; +4.837318776841698e-01   +4.723595019055236e-01   +1.420545235194256e-01   +6.573512528547769e-01   +2.656181085195852e-01   +8.179253406862277e-01   +1.550100199758052e-01   +7.066907234466040e-01   +9.982447812913937e-01   +1.015374778507324e-01   +7.705488139336543e-01   +5.325874780318299e-01   +2.107899355285746e-01   +4.434883675815670e-01   +8.851412890163207e-01   +7.440487487375198e-01; +2.854328345481880e-01   +1.858348837218644e-02   +6.052651292541791e-01   +4.805874116640974e-01   +9.513442223999402e-02   +6.508173546979822e-01   +5.833063902095033e-01   +1.158045358512027e-01   +9.055991708978337e-01   +4.918800909578369e-01   +6.773132377156622e-01   +9.012710848695734e-01   +4.836797140141810e-01   +8.938550286417088e-01   +9.255203874954940e-02   +4.755113583481995e-01; +4.038011389835326e-01   +1.180735957898506e-01   +8.894778911797230e-01   +9.780992445247368e-01   +2.314323376034426e-01   +2.374505753740660e-01   +5.447596263504744e-01   +7.409651454611390e-01   +1.143041586665270e-02   +5.612183004028384e-01   +8.131989117704294e-01   +2.839304703749350e-01   +5.063482502017557e-02   +7.829708775518398e-01   +6.753906156020668e-01   +2.462930005300066e-01; +4.914769671936284e-01   +7.193013994685959e-01   +5.626152695596053e-01   +8.640627268722318e-01   +8.960121992193523e-01   +3.018664971469742e-01   +6.813107086477211e-01   +9.241390259796984e-01   +8.341163481005878e-01   +5.562849327209715e-02   +4.184833483985405e-01   +1.389494529699867e-01   +5.711917714805482e-01   +5.816819096513709e-01   +9.720525978674040e-03   +6.632056523620261e-01; +8.625136591117385e-01   +6.820720397243045e-01   +6.329093356601190e-01   +9.544435651315638e-01   +1.995881595060500e-01   +3.303222028248557e-01   +6.985588596339870e-01   +9.235474866633078e-01   +2.529430460272649e-01   +8.939042124330382e-02   +4.977744161058269e-01   +9.574301740711777e-01   +4.909887925676301e-01   +6.162089186800431e-01   +1.213636557625800e-01   +6.088825445897690e-01];
L2E_L1E_iAMPA_netcon = [+3.675145715626013e-01   +5.617157785431490e-01   +2.004869350446678e-01   +5.137847471648793e-01   +2.898891412779926e-01   +7.413825860930374e-02   +2.789787685861983e-01   +2.673266187610828e-01; +4.377624129208263e-01   +1.935330486574953e-01   +1.371790886889216e-01   +6.851265866201801e-01   +6.202271886544113e-01   +5.938014104103105e-01   +9.293506642285810e-01   +9.046274573699028e-01; +7.183352239359098e-01   +6.128713716870877e-01   +8.184762343778754e-02   +2.071572046452131e-01   +8.629975489282783e-01   +7.580479876434039e-02   +7.640541174563255e-01   +1.592735006071850e-01; +1.918997593596232e-01   +7.407271721710569e-01   +9.093495493590806e-02   +9.717472930377243e-01   +8.200685573353956e-01   +3.971239459330000e-01   +2.619583115582010e-01   +5.540649343312455e-01; +4.009971752175102e-02   +8.310842312981684e-01   +5.511202003011267e-01   +3.504737012857747e-01   +2.057800086365432e-01   +5.888742440522544e-02   +2.430485460193100e-01   +4.220963034119933e-01; +3.146283690211051e-01   +2.769952554540625e-01   +7.321320320856928e-01   +1.848121874435622e-01   +7.508772945986233e-01   +1.290194007011125e-01   +1.660210633596222e-01   +5.469048732505815e-01; +7.902923406480675e-01   +6.083829004600434e-01   +5.443230722655660e-01   +2.380365789147301e-01   +1.984512791221949e-01   +2.445820806222657e-01   +2.874794637476606e-01   +7.544270261782846e-01; +4.718520902942886e-02   +5.478955494002089e-01   +5.452792712790364e-02   +2.538370399468848e-01   +5.775225399465231e-01   +9.437460561385468e-01   +5.643703623530704e-01   +1.391838752582375e-02; +2.160783967873840e-01   +2.742182332786253e-01   +6.323046755409455e-01   +2.226968572551458e-01   +8.768302768480279e-01   +2.032591168048113e-01   +4.048397648863502e-01   -1.626506131380328e-03; +2.740822096126087e-01   +3.398789150878646e-01   +9.945031649217264e-01   +3.586712533136532e-02   +7.140629201285206e-01   +3.274580187537196e-01   +9.871322807078277e-01   +2.124719412615515e-02; +7.896089391491801e-01   +5.665616433251104e-01   +9.153124782457033e-01   +3.569621578960739e-01   +7.005682128146740e-01   +8.669522904272150e-01   +5.445708813459985e-01   +3.592082284654206e-01; +9.903463813321481e-01   +7.439706130600225e-01   +7.686234253429813e-01   +8.984991702449756e-01   +4.676451297288528e-01   +9.220601946889531e-01   +9.287920561272097e-01   +4.266917308036011e-01; +9.455964860405197e-02   +7.718921121397410e-01   +1.909765117718187e-01   +1.400931482649464e-01   +5.041293461454616e-01   +2.356510435455645e-02   +9.924385325290404e-01   +5.447331447964011e-01; +1.964257248494932e-01   +3.979582080123979e-01   +3.206102022152251e-02   +9.556166700142040e-01   +7.960487648958927e-01   +3.648852567736320e-01   +8.363101921411673e-01   +4.924611944048264e-01; +1.166266116330364e-01   +1.486782648490544e-01   +3.730481800367093e-01   +9.025296433078926e-01   +9.401187723949943e-01   +5.282507923199363e-01   +1.808533585970391e-01   +9.201765313056793e-01; +6.471542788242423e-01   +2.075275328160156e-01   +5.757239434635230e-01   +4.105280830552464e-01   +7.820135726977958e-01   +4.066571299393507e-01   +3.132802483083454e-01   +4.165859114396603e-01];
L1E_L2E_iAMPA_netcon = [+4.969578444148111e-01   +4.494403925212292e-01   +6.162426766622056e-01   +4.906774797834687e-01   +2.304107175980090e-01   +7.206009215820872e-01   +6.945823745664610e-01   +6.325226634734576e-01   +5.224189030613203e-01   +2.415029655125617e-01   +8.764248265755242e-01   +1.740328015899800e-01   +1.379488090452634e-01   +2.436449874526148e-01   +1.833490385629657e-01   +2.383649170078521e-02; +8.383293194966674e-01   +3.694313819982123e-01   +1.038850358183464e-01   +6.609466632933430e-01   +8.359322877112971e-01   +3.807545950138899e-01   +9.788651493622933e-01   +6.264708845426757e-01   +6.729170147798558e-01   +7.286820806205941e-01   +6.588643980278817e-01   +3.025979178104133e-01   +2.826066652838339e-01   +7.487077261021070e-01   +1.461071563738600e-01   +2.509554499833545e-01; +1.849935387540687e-01   +3.007668306319201e-01   +7.521575647550486e-01   +1.790087148606657e-01   +7.342516293939645e-01   +3.839388238615918e-01   +7.503706199722567e-01   +4.072336270621221e-01   +7.776560014599987e-01   +1.363439406949427e-01   +5.382026131108140e-01   +1.093709260352234e-01   +6.969992575097705e-03   +9.371074292752237e-01   +1.323605864747611e-01   +9.889573950901565e-01; +3.369832349689221e-01   +2.326899506496300e-01   +5.364517124123164e-01   +4.795076021098885e-01   +4.889304932017406e-01   +7.159181940387348e-01   +5.535905081409982e-01   +4.252106844461850e-01   +4.639709822752426e-01   +4.136531738445949e-02   +2.522412401285853e-01   +4.513711260482035e-01   +3.060383038422623e-01   +2.947325744611792e-02   +1.717855845492658e-01   +6.295143534551828e-01; +6.925628844090755e-01   +1.369164966763306e-01   +4.436093135823335e-01   +4.986259888433893e-01   +8.492255729164666e-01   +8.388955442569770e-01   +2.981161729292413e-02   +5.103244255472383e-01   +9.074240172556644e-01   +6.499676554805045e-01   +1.049811596595654e-01   +5.840792310034448e-01   +9.050902313432487e-01   +4.352160291393135e-01   +9.228572184526149e-01   +3.573966413638858e-01; +6.925845499739147e-01   +9.950145284559964e-02   +7.429673859416598e-01   +6.004442941702735e-01   +7.152792814979163e-01   +6.676549347017265e-01   +1.950828183510754e-01   +2.598919335182355e-01   +2.542101211597107e-02   +2.003235687448633e-01   +9.714092317720796e-01   +2.243950871737108e-01   +2.946971757564394e-01   +8.309427305997349e-01   +2.590438210630689e-01   +9.389117257284785e-02; +3.681366633789360e-01   +2.267765997080868e-01   +3.874310197204121e-01   +2.408537968081675e-01   +5.214634582313563e-01   +6.510774829954633e-01   +9.418480880243001e-01   +4.232522323477275e-01   +4.795089338784187e-01   +9.734086907669329e-01   +5.967390101435586e-01   +1.104704263089505e-01   +8.330482439802881e-01   +9.997495677395575e-01   +2.054307042220451e-01   +4.095431562085354e-01; +3.491767585520895e-02   +3.463195831256906e-01   +5.259294049244546e-01   +5.173776753754566e-01   +9.376241280122909e-01   +5.635469225732254e-01   +3.972030880326373e-01   +5.236356545266521e-01   +2.713646919910628e-01   +8.207854795437365e-01   +8.193547333810283e-01   +5.604315569783216e-01   +7.451143286769762e-01   +9.202366311441080e-01   +6.128593058462910e-01   +9.312305148312493e-01];
L2I_L2E_iAMPA_netcon = [+6.775983721393327e-01   +6.148314359336757e-01   +4.184335467998265e-02   +7.926407148662855e-01   +5.240767136517813e-01   +8.264152916999831e-01   +6.439478283723802e-01   +3.860578398789731e-01; +2.334816933924510e-02   +9.451219978023386e-01   +5.450633578464412e-02   +9.294318599798992e-01   +5.425358928520876e-02   +1.077509241936872e-01   +3.953466308526601e-02   +1.673634723800090e-01; +7.336214698178463e-01   +9.639037869238566e-01   +4.015372897320008e-01   +9.361644686638705e-01   +2.873148686908101e-01   +2.308093009293855e-02   +5.683155230804487e-01   +4.440771703970495e-01; +2.127553532953839e-01   +3.690676918876580e-01   +9.837206305249161e-01   +1.460009416252317e-01   +7.094860746353895e-01   +1.143006537575107e-02   +3.040714241545235e-01   +8.733524532395092e-01; +8.599969053677331e-01   +7.950772174679913e-01   +7.121763184486273e-01   +3.192020019311428e-01   +8.781639790612383e-01   +3.363249709983425e-01   +2.610110571933288e-01   +4.116764096533438e-01; +1.568313796533985e-01   +7.286534075073928e-01   +9.887784059586521e-01   +4.282163681918552e-01   +3.665720926768433e-01   +6.634078511510960e-01   +7.214411053155598e-01   +1.625676949353841e-01; +6.689998974636361e-01   +9.539847420222791e-01   +6.459939830933572e-01   +7.015044640320638e-01   +5.605967575649001e-01   +5.953743051671982e-01   +3.055098488034677e-01   +6.623511592668622e-01; +9.363683400785073e-01   +1.112712077770577e-02   +5.023102009284427e-01   +6.152567458538205e-01   +8.836125591633357e-01   +8.031761558127440e-02   +8.952277749238384e-01   +9.253989723954124e-01];
L2E_L2I_iGABA_netcon = [+5.995315435736073e-02   +5.193914571602227e-01   +3.525805101844399e-01   +2.618800842089434e-01   +4.204597088538218e-02   +8.905585453930197e-01   +3.446141744163249e-01   +4.510856043099018e-01; +3.539342902094681e-01   +6.927463600439329e-02   +5.568992463445326e-01   +9.843396702233767e-01   +3.606943587402885e-01   +5.404661162583575e-01   +9.351516354960823e-01   +6.718188746552661e-01; +9.320862197349806e-01   +1.842688829968862e-01   +6.926961805330478e-01   +3.494471434041027e-01   +3.538368955473244e-02   +7.174376392900175e-01   +9.182024918973422e-01   +7.691713051583242e-01; +2.420742270478307e-01   +3.174363281436172e-01   -6.141366049593125e-03   +4.022379170964558e-01   +4.857915647933803e-01   +7.110517273438519e-01   +7.248770305200509e-01   +9.268187105916658e-01; +1.019242792315978e-01   +2.438001153716303e-01   +4.776506353155236e-02   +7.524893457609857e-01   +7.237288742328356e-01   +1.692184761886680e-01   +4.426691861441163e-01   +6.579402205884231e-01; +7.163873970214488e-01   +3.225572234256183e-01   +3.080833843665383e-01   +1.010249659131458e-01   +1.403363575028722e-02   +3.523256042284593e-01   +1.511516711612471e-01   +5.019324077377213e-01; +5.513851413547713e-03   +8.792753971328187e-01   +8.691705101290084e-01   +5.905422317309699e-01   +5.171458602039252e-01   +3.793179845025889e-01   +8.313255382735719e-01   +3.421438084666331e-01; +1.849338722313582e-01   +3.013299084484013e-01   +6.276196881190079e-01   +1.236288932304190e-01   +2.391684938496438e-01   +7.578252972583311e-01   +2.569255030973119e-01   +9.465268519046570e-01];
L3E_L2E_iAMPA_netcon = [+7.925824416141131e-02   +1.547107960916394e-02   +3.681883203853886e-01   +4.964384167847813e-01   +1.776799988733240e-02   +9.559555179273228e-01   +3.592405678607701e-01   +1.381347725264574e-02   +2.038198264667977e-01   +6.197174540156426e-02   +2.429775492418794e-01   +9.987380024228792e-01; +9.524016837721920e-01   +9.772697207318695e-01   +1.163839307474644e-01   +6.568335281675133e-02   +8.063540725665905e-01   +3.869971088061833e-01   +2.241851270974866e-01   +1.214777839968146e-01   +3.563598779862434e-01   +7.417381947445171e-01   +5.338775096929264e-01   +3.445981317451236e-01; +6.625714338178754e-01   +7.245404084089583e-01   +5.144325619132607e-01   +8.623132213171355e-01   +7.917799128726409e-01   +6.644714405674188e-01   +7.244682377099668e-01   +6.699014992425011e-01   +8.876711809182777e-01   +9.907292925916825e-01   +3.333490708532735e-01   +8.224051244445315e-01; +1.689055025763218e-01   +8.718410342867516e-01   +6.896087548401228e-03   +9.968699129681053e-01   +4.234434285488479e-01   +5.855225444524295e-01   +7.724596987214746e-01   +5.084701903563541e-01   +8.085470725168461e-01   +7.677290800758553e-01   +6.745531283643639e-01   +1.090885842565357e-01; +1.971947873315625e-01   +8.146731806534181e-01   +8.685963151009635e-01   +1.226721234618926e-01   +6.305628360591250e-01   +5.922803719101672e-02   +3.421282844308596e-01   +7.045105441452715e-02   +3.197718241089864e-01   +8.818348827364072e-01   +8.752417130577730e-01   +7.737775689070107e-01; +9.952678338078612e-01   +3.034866373054006e-02   +9.041849902473064e-01   +9.992128955923024e-02   +5.682971832735009e-01   +7.586811304224929e-02   +5.764383274546254e-01   +5.353170660509199e-01   +6.011773635974239e-01   +3.623564317395501e-02   +9.833234707758335e-01   +1.499562720580930e-01; +9.259479009382784e-01   +9.703876551491342e-02   +1.133542343552252e-01   +1.490206126841460e-01   +8.961854976635502e-01   +2.279909297975697e-01   +6.430299451484299e-01   +6.777576395558966e-01   +6.982843693269601e-01   +7.943769595368431e-01   +1.457440634747257e-01   +7.313245540151758e-01; +9.821675753030030e-01   +8.526048722196859e-02   +4.417792075125389e-02   +1.291130263966520e-01   +7.487961325838275e-01   +4.210256798077248e-01   +3.664058206265154e-01   +5.881482787110143e-01   +1.780380714001349e-01   +7.067281693756949e-01   +8.772587611025335e-01   +1.087740189012530e-01];
L3I_L2I_iGABA_netcon = [+7.680626639819286e-01   +5.351149947697813e-01   +5.970557112800927e-01   +3.039470972359670e-01   +9.655232388684974e-01   +1.150951927745794e-01   +2.978194159866127e-01   +7.949419490274026e-01   +9.136509159090418e-01   +9.955465036851147e-01   +3.096784586734220e-01   +9.963474606670252e-01; +6.367489138331546e-01   +4.531498282404640e-01   +5.630196189674266e-01   +7.628954094075912e-01   +5.440095639856298e-01   +7.066652137135027e-02   +1.676283582517934e-01   +5.261875882131627e-02   +3.857394925354819e-01   +2.874658076826126e-01   +4.422435285737286e-01   +9.152892894928166e-01; +7.960524960672295e-01   +1.144596908541483e-01   +6.814324902430198e-02   +6.477942843384198e-01   +9.819804541311947e-01   +5.051746091325793e-02   +7.243205412559686e-01   +1.808745596622714e-01   +7.509544788529698e-01   +5.161006178146607e-01   +2.089994512860749e-01   +6.906935104732604e-01; +9.597841836450481e-01   +7.205637009262010e-01   +7.684220176696654e-01   +3.324077002317585e-01   +1.248544952108710e-01   +1.303991087872798e-01   +2.986914838875909e-01   +2.463118816522954e-01   +8.785374310947019e-01   +3.585675047573634e-01   +9.411989374180378e-01   +2.210740289208667e-01; +7.169166181427292e-01   +1.857372299768582e-01   +8.682036354890222e-01   +9.711304040791933e-01   +1.684092034549456e-01   +4.911402676730352e-01   +6.780170817265800e-01   +2.618048525991067e-01   +3.925108348182985e-01   +5.168580035950675e-01   +2.900541817394527e-01   +3.138789020924821e-01; +6.438385863448473e-01   +3.246385922517858e-01   +7.088698888756044e-01   +5.317582584397219e-01   +3.342554054839560e-01   +4.681152337802978e-01   +7.464524197619625e-01   +6.474776356783625e-01   +1.671507782493322e-01   +5.011266409263664e-01   +1.224273639398655e-01   +2.368119292249034e-01; +5.120548185860735e-01   +9.670310977518104e-01   +1.085824430150338e-01   +7.514336918556733e-01   +5.314756254796148e-01   +1.586660533934940e-01   +7.450602266420132e-01   +9.769640207139668e-02   +4.367032281632177e-01   +1.885812474743161e-01   +6.992204687665043e-02   +7.082552546971529e-01; +9.518075652238080e-01   +7.005951250198561e-01   +6.658492741840067e-01   +2.705642255932865e-01   +6.928120531293915e-01   +1.387581162761280e-01   +7.846927620780553e-01   +4.690289748710779e-01   +8.584697816905013e-01   +4.772498609305312e-01   +7.292038949592798e-01   +3.756236351172413e-01];
L2E_L3E_iAMPA_netcon = [+6.563113856485441e-01   +3.868439310940603e-01   +2.344994318706498e-01   +4.634498686525002e-01   +9.051485903486916e-01   +9.504661746975871e-01   +7.621415418094245e-01   +3.545400816485105e-01; +3.842618933469020e-01   +2.285333209965565e-02   +9.047604543426928e-01   +2.830941892468626e-01   +6.794894649740085e-01   +2.630492422764667e-02   +9.031009682656109e-01   +6.635430483546704e-01; +3.085311292044395e-01   +3.297265816119427e-01   +4.874692569316640e-01   +2.761046980555693e-01   +8.428739190193207e-01   +5.019068870750523e-01   +7.965294265996546e-01   +5.921487547509402e-01; +1.573896572478384e-01   +4.846238963329126e-01   +5.959050484416514e-01   +1.424334070577921e-01   +9.474457295919597e-02   +3.393656476147825e-01   +9.564668651251835e-01   +5.428525831979474e-02; +7.781422886754968e-01   +2.622152780625046e-01   +9.549371442287554e-01   +1.394086826180516e-01   +7.353863681207390e-01   +6.723276292402623e-01   +5.351043679480718e-01   +2.168118490841533e-01; +7.089505973386757e-01   +5.265539632254912e-01   +8.483343006956207e-02   +2.652359836381182e-01   +5.437108206749048e-01   +1.676463845632483e-01   +1.639626422717054e-01   +6.021712464834260e-01; +1.727101633076073e-01   +4.165416001664385e-01   +2.220795154733197e-01   +6.102212656943267e-01   +2.565484563238684e-01   +2.271523187805285e-01   +1.348013248236903e-01   +2.693260760814081e-01; +4.481964502978983e-01   -4.602196861523202e-03   +1.516084592883924e-01   +1.062511326631553e-01   +7.147784121610115e-01   +1.176196535648792e-01   +3.399696976688374e-02   +1.094775079262804e-01; +8.378731256187179e-01   +8.939589494748844e-01   +3.896126481665824e-01   +4.851253670332324e-01   +3.604016669805323e-01   +9.927715913956823e-01   +6.806842158618386e-01   +2.114740933198540e-01; +6.976523835403292e-01   +2.389060848891423e-01   +1.851417030825755e-01   +8.932477995797445e-01   +8.544626690834711e-01   +1.397386770479067e-01   +5.870858244588690e-01   +8.731995245376319e-01; +7.657397485187105e-01   +7.920661818726402e-01   +7.635698155493333e-01   +1.884506517694371e-01   +8.185773684527030e-01   +7.693251601267349e-01   +2.984610750138494e-01   +4.591681972961483e-01; +9.802900747824608e-01   +5.789337807290025e-01   +2.287429402038775e-01   +5.184926850103717e-02   +6.108337102393204e-01   +6.340333071902569e-01   +7.391859801091406e-02   +7.271317265948335e-01];
L2I_L3I_iGABA_netcon = [+5.891637235749879e-01   +1.476629439220717e-01   +3.444141038609108e-01   +3.700116410815044e-01   +5.993936137977833e-01   +5.069526937448841e-01   +7.729864990152772e-01   +2.649679104114707e-01; +8.458765221983926e-01   +9.902045238971681e-01   +4.642008410340746e-02   +5.376191025106345e-01   +4.786994549451973e-01   +2.368542374390067e-01   +1.789586471679299e-01   +5.849736707582438e-01; +6.049090182317567e-01   +4.808565139308377e-01   +9.421505098835213e-01   +9.745677342807046e-01   +3.765699107903954e-01   +2.719419659305587e-01   +4.543403976362564e-01   +6.789789023725487e-01; +7.445527713618922e-01   +3.495133662568384e-02   +8.671832610941875e-01   +9.968555315257357e-01   +9.783834914932451e-01   +4.052652948533632e-01   +3.058246309586705e-01   +4.151641545052496e-01; +8.490703427658322e-01   +2.697795370191028e-01   +1.336760924475063e-01   +4.149326997739809e-01   +1.382971488404008e-01   +2.603065355129884e-01   +3.876220702515242e-01   +5.114039155752826e-01; +1.465578693495391e-01   +6.758869121205059e-01   +5.908425433009250e-01   +4.509966852072075e-01   +2.710946572107161e-01   +8.539991104985101e-01   +8.032992537568473e-01   +8.144649709043794e-01; +7.418019305722919e-01   +1.469281198606723e-01   +6.202329618181973e-02   +2.550999972549109e-01   +2.256018373188975e-01   +4.792390675338524e-01   +7.780151000497413e-01   +5.444722355003677e-01; +1.710901240238667e-02   +7.738300970524038e-01   +9.471988969978470e-01   +6.011035594782808e-01   +7.910519814886053e-01   +3.413116032040160e-01   +6.455400348190520e-01   +5.892659527148861e-01; +2.278231302806240e-01   +2.674262365322804e-01   +4.969706879738740e-01   +7.818057571852516e-02   +8.175614720709449e-01   +6.387600233064272e-01   +2.420412579297124e-01   +5.349834031708851e-01; +5.374124778016048e-01   +8.804819443323111e-01   +2.646375012060058e-02   +9.122401996266478e-01   +7.920666504312571e-01   +4.152518835632107e-01   +6.092711756343518e-01   +5.412936791990580e-01; +7.208110642035562e-01   +3.686247879937296e-01   +5.754056498390338e-02   +4.729674487019821e-01   +1.126157751067286e-01   +5.433902527594625e-01   +4.198045378381983e-01   +1.519022244189148e-01; +4.339614167545523e-01   +1.021242984767902e-02   +3.008095783270334e-01   +5.081140470256479e-01   +6.329624259655897e-01   +3.393655976480663e-01   +2.942307783147677e-01   +7.030826227883050e-01];
L3I_L3E_iAMPA_netcon = [+6.429145936654515e-02   +7.734308203813507e-01   +5.554117652110675e-01   +5.731120137002189e-01   +9.201142715474091e-01   +8.349403517730877e-01   +8.491752539056326e-01   +8.626362099108628e-01   +5.340541325626703e-01   +9.883591742443344e-01   +4.817234802830473e-01   +3.506763790148151e-01; +9.227382782221152e-01   +8.387888842825739e-01   +8.440513089666997e-01   +9.353232616281502e-01   +5.921181851874736e-01   +3.923560542864021e-01   +6.279617722170594e-01   +8.560472893778138e-01   +5.667366655488886e-01   +7.007931782546590e-01   +7.397767169467045e-01   +3.996975903303758e-01; +1.803669624594013e-01   +5.930730954787991e-01   +9.692852761502073e-01   +7.786565610171677e-01   +5.752146310655892e-01   +6.996296056090209e-02   +4.449735029080664e-01   +9.494294709322922e-01   +9.803161998034222e-01   +8.440545138845147e-01   +5.950290183228346e-01   +9.878079264458178e-01; +5.434496276455330e-01   +7.671350438893174e-01   +4.668155510425636e-01   +5.970124466308496e-01   +6.584850574072191e-01   +3.735100143493557e-01   +2.344043219021372e-01   +6.937841766474937e-01   +9.678474018250893e-01   +7.377814609003719e-01   +2.626161341821175e-01   +2.970903423873373e-01; +3.969827694649180e-01   +6.588205080725600e-01   +7.764168514501184e-01   +5.845765008322137e-02   +4.357965818796238e-01   +8.492274536298859e-01   +5.112584382344643e-02   +3.633070512638926e-01   +5.603635589239290e-01   +9.959627543517994e-01   +6.071132449566029e-01   +2.246033489284199e-01; +9.245468756874639e-03   +5.891735027555910e-01   +2.167212829517024e-02   +5.436743692914681e-01   +9.352272196014725e-01   +2.412739134102125e-02   +7.128234280113537e-01   +3.733853278330627e-01   +5.322791031026260e-01   +5.078135593139136e-01   +2.323403491809406e-01   +3.308494354857037e-01; +1.028365973227094e-01   +2.661185345911753e-02   +6.777817799831863e-01   +8.646462949503326e-01   +1.024962008351783e-01   +4.217904395841954e-01   +8.485592946924309e-01   +8.425677233439610e-01   +4.787514058019092e-01   +1.893789159007388e-01   +1.947080171107881e-01   +1.647866497007906e-01; +8.564420298239069e-01   +6.926711002627486e-01   +8.355724510543276e-01   +3.382842989226174e-01   +4.097616504522899e-01   +2.549269958030612e-01   +4.043960301691605e-01   +3.840322971347073e-01   +9.012402149974542e-01   +9.595521821539500e-01   +2.033274225178296e-03   +3.841815097552964e-01; +3.378937748583060e-01   +3.269271588275710e-01   +6.843202930208230e-01   +1.786526720520859e-01   +8.926965310442976e-01   +7.446291485148479e-02   +2.867849999714216e-01   +7.701158555166985e-01   +4.821378277771806e-01   +4.521194449282995e-01   +6.463904843859225e-01   +5.257286775295228e-01; +1.497209406805870e-01   +7.591426085898798e-02   +8.958617201198674e-01   +8.814511470246563e-01   +7.385053776059813e-01   +9.208917315052045e-01   +2.627218041624638e-01   +7.724281129344619e-01   +4.871979065050170e-01   +6.058456891063970e-01   +4.001607166557395e-01   +5.952441378024194e-01; +8.071398165895736e-01   +7.440357952800442e-01   +9.561002153237090e-02   +8.417347355851907e-01   +9.586370579307794e-01   +2.679543531102596e-01   +5.048021032608646e-01   +4.334246266360342e-01   +3.140016108197742e-01   +6.440489172013319e-01   +2.723011991239901e-01   +1.701172527945252e-01; +6.556918402720201e-01   +9.652722973148390e-01   +7.102636863547634e-02   +8.336604393281892e-01   +9.699904309938807e-01   +1.010168753160048e-01   +1.168273316391074e-01   +4.879694374964717e-01   +8.593110022173839e-01   +7.661540427892014e-01   +3.955129557261416e-03   +7.244423344592520e-02];
L3E_L3I_iGABA_netcon = [+4.374248409372230e-01   +7.064135990795968e-02   +5.428969445292139e-03   +4.950911485018995e-01   +5.437876199518455e-01   +2.520557778481464e-01   +7.177115280692055e-01   +7.610635296068059e-01   +3.785508135042714e-01   +4.489500620008557e-01   +2.002120633566411e-01   +6.490410727856035e-01; +5.801902099991520e-02   +8.079231238551536e-01   +1.325848758176814e-01   +1.935087413033438e-01   +2.112679351111026e-01   +3.344265619433826e-01   +2.225798807480122e-01   +8.883914635056616e-01   +6.107984950252746e-01   +3.947466139917141e-01   +8.278013335061327e-01   +8.984172411410424e-01; +6.253153675825259e-01   +9.095340631678563e-01   +3.083520106694623e-01   +6.419316045361353e-01   +2.699063626024664e-01   +5.917767902623257e-01   +4.986759446217298e-01   +7.312165373908757e-01   +1.679270038399383e-01   +6.682621045952108e-01   +4.465191972219448e-01   +8.386687429836980e-01; +7.984419417481246e-01   +4.259179295421802e-01   +2.385687137457841e-01   +2.551408237548253e-01   +1.326875065646823e-01   +4.813951188087187e-01   +4.752535132462764e-01   +6.980317089732982e-01   +1.053640455336604e-01   +3.337898686167406e-02   +4.232083658892898e-02   +1.703073975026558e-01; +4.010745989586411e-01   +1.843570557396748e-01   +6.491701894583020e-01   +9.482177339213702e-01   +1.614238713906736e-02   +8.972551826195899e-01   +4.310995003238333e-01   +6.465831162715058e-01   +6.259318466811747e-01   +7.868471720650509e-01   +7.686539067319215e-01   +1.612979079603344e-01; +8.842580165933260e-01   +1.834566405020931e-01   +8.084489420475176e-01   +2.880637464930536e-01   +1.533241905593331e-02   +2.948252812675478e-01   +5.567629606929980e-01   +6.205524198537605e-01   +9.527336528345738e-01   +3.784638864806036e-01   +9.774871350378292e-02   +1.357356463333844e-01; +7.221089602248544e-01   +6.723569053031818e-01   +7.400723501767213e-01   +1.491286406588930e-01   +9.791394593051717e-01   +7.914783559180912e-02   +2.072563611022592e-01   +7.826715204784387e-02   +6.653337559369733e-01   +6.515214809746673e-01   +6.520809030810328e-01   +1.587213322192023e-01; +1.968836249474825e-01   +5.242397558173749e-01   +1.222694862576242e-01   +8.704789186581138e-01   +6.472852929960499e-01   +3.920221947656296e-01   +2.773735796815192e-01   +5.483264095399468e-01   +4.733906274041294e-01   +4.968535001626362e-01   +2.706657149235988e-01   +3.945099012486422e-01; +3.746666330335621e-01   +7.766352503190158e-01   +1.727160039669905e-01   +8.866169061271039e-01   +8.159252040447121e-01   +1.987694715883686e-01   +8.126164704350587e-01   +8.838322317052384e-01   +3.406312288542730e-01   +2.131888384068807e-01   +4.370584640003936e-01   +6.669246981537013e-01; +2.118668090628842e-01   +2.994395824650195e-01   +2.740264371463392e-01   +6.685378666995406e-01   +2.759036430409890e-01   +7.224756605452547e-01   +9.561892976138071e-02   +9.875371978132925e-01   +5.911960911344222e-01   +2.163592461383242e-01   +8.485097182269916e-01   +2.227878435947674e-01; +2.594279845195193e-01   +4.745080532453890e-01   +8.149695232541455e-01   +9.974238493203400e-01   +1.556437753563314e-02   +4.216731902680338e-01   +3.323748709956938e-02   +7.069534101249281e-02   +5.457867661101846e-01   +4.519334363806820e-01   +9.020008876110199e-01   +6.437985167549326e-01; +9.921268249405313e-01   +7.066623169196953e-01   +5.914690114688838e-01   +2.680712417031297e-01   +1.011856052984417e-01   +2.679897210625541e-01   +6.478882012013400e-02   +3.273010418755525e-02   +3.933559010569559e-02   +6.291695978441437e-01   +2.852074930836487e-01   +6.120178259934497e-01];
L2E_Input1_iAMPA_netcon = [+9.920413905324506e-01   +9.896008380485490e-01   +9.998499829155002e-01   +9.878645458823758e-01   +9.852573743098527e-01   +9.992262833381654e-01   +9.835172594915874e-01   +9.969120049412957e-01];
L2I_Input2_iAMPA_netcon = [+9.919382980609871e-01   +9.986395553768196e-01   +9.853968592288007e-01   +9.946411256249541e-01   +9.890314290269715e-01   +9.901449626956284e-01   +9.955842290289356e-01   +9.966731208692927e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
