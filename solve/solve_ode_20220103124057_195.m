function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.395864311461501e-01   +7.763465954397885e-01   +9.582886146527265e-01   +1.907476652136569e-01   +2.408283920138116e-01   +7.579062937670722e-01   -1.553063270658683e-02   +4.619593821256864e-01   +3.602721735035092e-01   +2.293330559562971e-01   +3.712521542818679e-01   +1.574987835684027e-01   +5.187285995775931e-01   +2.784317298087839e-01   +2.745216390007523e-01   +4.898427207040291e-02; +1.065091564019554e-01   +9.841713657387483e-01   +8.656009637260287e-01   +7.502965284427078e-01   +3.383391643633789e-01   +7.535586822533770e-01   +7.174725328725351e-01   +1.478481569302542e-01   +8.120138063759651e-02   +7.449925876875501e-01   +5.963724381001627e-01   +6.855817031579904e-01   +5.417514361114599e-01   +2.794474541976474e-01   +7.184248585775886e-01   +2.951992931737165e-01; +2.979806726727875e-01   +3.614688397251845e-01   +3.704987242191350e-01   +5.974756323280963e-01   +5.164993714651246e-01   +4.359161903208900e-01   +3.473220189974768e-02   +7.224909118790815e-01   +3.436379150115257e-01   +5.161661891667394e-01   +9.031727353617187e-01   +2.451532522519187e-01   +5.088990848936659e-01   -1.782495391815416e-02   +3.984836312394534e-01   +9.386185924336109e-01; +2.493599662143516e-01   +6.175001741297994e-01   +9.622948191658123e-02   +2.306849174665175e-01   +9.455852589710940e-01   +8.396879271898602e-01   +2.519477549319974e-01   +6.172117318304151e-01   +7.495851747477627e-01   +1.820218228045231e-03   +2.269918681336493e-01   +8.834677892933258e-01   +5.946625778779351e-01   +1.668402910801680e-01   +6.750772729259545e-01   +4.520990189860741e-01; +7.464149310465946e-02   +7.469401704745536e-01   +8.847031375172409e-01   +8.353582227666470e-01   +5.223186578334660e-01   +3.392425228407375e-01   +4.929160826677321e-01   +2.232931376869752e-01   +2.864259466464092e-01   +5.556574543028620e-01   +2.505917521928963e-01   +6.363453234919688e-01   +4.016058021208746e-01   +8.625315941210373e-01   +2.121783266275384e-01   +9.036346296213699e-01; +1.253263203547979e-01   +2.125455800131976e-01   +7.978936466187467e-01   +8.021748977328428e-01   +6.606331956504884e-01   +9.167952026388873e-01   +3.571437569634186e-01   +4.153273479207361e-01   +8.593475056467497e-01   +9.168207038018363e-01   +8.693514122551924e-01   +2.278873058645858e-01   +4.005511238203334e-01   +1.299934367206158e-01   +9.147945016620447e-01   +3.665071649842480e-01; +2.915359389217016e-01   +8.172872542040760e-01   +3.912275844599832e-02   +3.958193069428322e-01   +8.978561316068793e-01   +5.547639210140578e-01   +4.592826893633664e-01   +6.177985792383889e-01   +8.865546299021292e-01   +9.664551465370981e-01   +7.094795164098774e-01   +3.622619857685051e-02   +3.959474217059488e-01   +3.912349395474504e-01   +7.032861918284359e-01   +9.152301661025717e-01; +6.830692324885509e-01   +7.577327962329703e-01   +8.020515195634301e-01   +3.735371425341878e-01   +6.284873375554956e-01   +4.466180329522444e-01   +6.534452421639632e-02   +3.909854226039352e-01   +1.000000000000000e+00   +9.020918756849146e-01   +5.282665837954029e-02   +7.647549182359082e-01   +8.879032121719375e-01   +6.230661984427280e-01   +3.011121391500595e-01   +8.838954091840896e-01; +5.487606813271224e-01   +5.654852110807976e-02   +3.209435918687710e-01   +5.977865321730552e-02   +5.130167038880397e-01   +9.772110443881692e-02   +1.691748511684157e-02   +6.115314208525501e-01   +5.255852018818745e-01   +8.439343169714242e-01   +7.613834490849759e-01   +5.760778865008009e-01   +3.832112115989116e-01   +2.237534330485254e-01   +9.733986034538098e-01   +7.666217128490023e-01; +7.585657173935705e-01   +4.851286441337441e-01   +5.616679042615350e-01   +2.675917117217206e-01   +4.342360928416532e-01   +3.586083748495837e-01   +1.297848204342535e-01   +2.774258850239257e-01   +7.393117728788164e-02   +8.871702144882467e-01   +6.913224562339762e-02   +1.003473851407402e-01   +2.875386330647275e-01   +7.526365380987499e-01   +2.809324652493594e-01   +8.750692146600303e-01; +4.551877752888152e-01   +2.031621443083939e-03   +3.475719563425517e-02   +1.186134866928466e-01   +9.575262666417070e-01   +5.507893213927108e-01   +2.433195127636393e-01   +2.336780061700167e-01   +2.460519137665720e-01   +8.940885534464947e-01   +9.110196000244171e-02   +8.193600725963509e-01   +5.870802207179765e-01   +8.967346795917533e-01   +2.944868771199926e-02   +1.336062169157228e-01; +1.279863054641551e-01   +3.577910579360048e-02   +9.550254567455981e-01   +4.861538046757419e-01   +6.366082974240670e-01   +5.823195513582156e-01   +7.372967015077274e-01   +4.090797060782072e-01   +6.003494350407488e-01   +1.457978847386781e-01   +3.653226224400629e-01   +8.687649080593179e-01   +1.069025741496569e-01   +4.828593211742621e-01   +3.999922635505346e-01   +9.757694540193158e-02; +4.914972679092991e-01   +3.185989484257685e-01   +6.774351777421246e-01   +3.199393596011046e-01   +1.406146454946119e-04   +5.205209982230243e-01   +4.717728685547883e-01   +7.756830647948849e-01   +2.297523468079177e-01   +9.366692308036644e-01   +1.287361661146567e-01   +4.529648586437772e-01   +2.354049929384444e-01   +2.029789965455423e-01   +3.385566612261987e-01   +1.841149048472221e-01; +8.876617431236750e-02   +8.999844096372988e-01   +8.031948548111613e-01   +7.839044209708952e-01   +7.937180957167346e-01   +5.464151054354345e-01   +3.542871542595861e-01   +8.416842775009283e-01   +3.769363870224705e-01   +3.761971688384508e-01   +9.133469662647000e-01   +6.402700285930824e-01   +6.238095226399816e-01   +5.259674094720108e-01   +1.178199254167859e-01   +3.559856387984168e-01; +1.647857981370384e-01   +2.778829467543429e-01   +9.071826906316525e-02   +3.935346561956752e-01   +4.226697686845561e-01   +1.096369207882246e-01   +6.701307348258464e-01   +2.585590946242311e-01   +8.731101093117354e-01   +5.538476042714433e-01   +1.029356731996539e-01   +8.943102404768114e-01   +6.552063499638048e-01   +2.296813310364738e-01   +6.988260586562957e-01   +1.322289988667922e-01; +5.962477307321989e-01   +2.985298110466041e-01   +3.075399803978969e-01   +6.652220202911359e-01   +5.658498293407386e-01   +6.615772395868418e-01   +2.243730728248876e-01   +8.464568873267930e-02   +5.775190850973254e-01   +4.543556333944401e-01   +1.203198207488969e-02   +4.374152436149946e-01   +2.057340716411744e-01   +9.453195093747118e-01   +9.054868304798981e-01   +2.082008956647217e-02];
L1E_L1I_iGABA_netcon = [-1.116979739751046e-02   +2.569850076092605e-01   +9.264231653393393e-01   +2.876299270400454e-01   +4.358551185272569e-01   +1.141680529600384e-01   +2.845341906410462e-01   +4.920319782675081e-02   +2.218102400717293e-01   +5.236402884518738e-02   +4.541127880251701e-01   +9.679567201752310e-01   +1.577003347699920e-01   +8.651300742501715e-01   +1.062532411597243e-01   +4.677012699614894e-01; +7.459612273057140e-01   +8.161931953680873e-01   +5.020781131503930e-01   +8.566971101755395e-01   +7.658690458080797e-01   +8.866593956554915e-01   +6.139510905854084e-01   +8.801830066995701e-01   +9.780964021876761e-01   +9.463518010121503e-01   +1.264917302626029e-01   +1.339882688336935e-01   +5.977636617092212e-01   +9.481015137457305e-01   +9.888372082688529e-01   +2.886360493400985e-01; +3.273252780896813e-01   +8.351790094541608e-01   +1.007063710611229e-01   +7.919347799964428e-02   +1.153335308189958e-01   +2.304747601723151e-01   +5.961422392425710e-01   -1.917737568510891e-02   +9.264707783161449e-02   +1.046935635851030e-01   +5.346422179465856e-01   +4.499407968921866e-01   +8.369268276580291e-01   +8.283953181476531e-01   +7.993734263345766e-01   +7.787289716373973e-01; +3.564825811854231e-01   +5.487814162092165e-01   +6.412892154563168e-01   +7.807134662792545e-01   +6.555176049496310e-01   +6.706752561866581e-01   +5.908654560647664e-01   +9.164243297191482e-01   +5.106944101083454e-02   +3.542220900875144e-01   +5.435685174769258e-01   +2.239290893880661e-01   +7.951102166026235e-01   +4.286635008405860e-01   +9.400381196209276e-01   +5.608400862071453e-01; +7.431275308233901e-01   +6.204560872278317e-01   +8.366922946090147e-01   +3.539695631852790e-01   +9.853847334105309e-01   +5.151487798035174e-01   +3.661221782438261e-01   +4.755441041845385e-01   +2.974805993161025e-01   +1.192926189089248e-01   +4.973912521322303e-02   +5.429952334695445e-01   +9.250343948278245e-01   +7.877769839764662e-01   +1.540822147358830e-02   +1.706949457562065e-01; +2.896784130845539e-01   -7.035885843051310e-03   +2.601125449060849e-01   +1.516317206907521e-01   -1.583953561160361e-02   +4.058566508516363e-01   +9.018418939313602e-01   +3.280256382639979e-01   +5.649966269617075e-01   +3.994988239791562e-01   +9.457537460721819e-01   +2.116682939385975e-01   +3.004732835895614e-01   +2.121440022739143e-01   +7.327043295608584e-01   +4.445116096533206e-01; +6.800775789041924e-01   +5.617325916006821e-01   +3.773094701364046e-01   +7.816086669758572e-01   +2.874469998951454e-01   +8.706464521391534e-01   +6.706792619003965e-01   +5.158126254966984e-01   +8.719260950827256e-01   +6.416122822748949e-01   +9.469186260772312e-01   +2.993356240668747e-01   +8.189972795694718e-01   +6.498855562532490e-01   +9.480387773713956e-01   +8.311488932628959e-01; +9.849820216086457e-01   +1.542054625581920e-01   +5.806898850834700e-01   +5.286261488397497e-01   +6.626797182139453e-01   +2.159908375590622e-01   +3.205688494357795e-01   +6.117507282313974e-01   +2.079424069608845e-01   +7.978763385743893e-01   +7.929511052783145e-01   +9.602321021833684e-01   +2.944047952255198e-01   +7.855624900884793e-01   +4.913192743429904e-01   +6.199216782130103e-01; +5.708667917316254e-01   +9.974297835179460e-01   +3.849017498160754e-01   +9.599053724483271e-01   +2.226362119832307e-01   +7.025408620124934e-01   +6.222122061163107e-01   +9.947139432298705e-01   +8.525892589134308e-01   +1.273211851941365e-01   +2.195466266162812e-01   +1.946617444201218e-01   +8.708631399399178e-01   +1.646369154704093e-02   +5.480286937767322e-02   +4.564010735038027e-01; +2.799175037379040e-01   +3.780415821425742e-01   +5.676215433516826e-01   +3.025106220321598e-01   +7.850643460479264e-01   +4.264514140407898e-01   +3.424245228893229e-01   +8.903084037568731e-01   +9.160350499872767e-01   +9.421376145790098e-01   +8.056668353880476e-01   +9.486353895455808e-01   +4.963441261105684e-01   +3.987861152682615e-01   +3.525196888615084e-01   +8.734266716156965e-01; +1.153727021141756e-01   +2.425772416068977e-01   +7.982036318809034e-01   +9.033281140502678e-01   +1.309674047848009e-01   +6.098598438874170e-01   +9.322298775061980e-02   +4.710270915995388e-01   +3.768703600736996e-01   +7.178593002632573e-01   +3.052491684586886e-01   +9.015607499363686e-01   +6.534330976096313e-02   +5.065499176993216e-01   +4.734553148483008e-01   +5.103087266523975e-01; +1.551634644513324e-01   +9.308927181962633e-01   +7.537173465118718e-01   +5.154853949315695e-01   +5.003130446611951e-01   +6.639246815611478e-02   +1.624979571024893e-01   +3.559184987113218e-01   +1.291819425171844e-01   +5.542711205484103e-01   +3.039350361259667e-01   +4.523321827158884e-01   +4.074748068000226e-01   +8.842302726578725e-01   +6.308185754075972e-02   +4.674241644971497e-01; +9.132206060321066e-01   +1.171410653012528e-01   +4.824933729882050e-01   +5.631918359499767e-01   +6.649416516988755e-01   +5.882482403243585e-01   +1.668810721847190e-01   +5.524264978822355e-01   +5.282321379425915e-01   +3.406680498494011e-01   +9.613526972220126e-01   +9.615797511514833e-01   +8.635839342226874e-01   +5.737308279244837e-01   +3.174028009320402e-01   +7.608379040204778e-01; +4.609366759737127e-01   +8.622706285247201e-01   +3.087279427628756e-01   +4.129533847911238e-01   +7.645584711064326e-01   +1.656376054673856e-01   +3.683243869876359e-01   +6.217512071380411e-01   +3.364010702292985e-01   +4.605256716441727e-01   +1.700118128884201e-01   +1.309516012269953e-01   +3.088773460660896e-01   +2.754194889415874e-01   +6.264637757276855e-01   +9.109753177460100e-01; +6.236112872801352e-01   +6.149985630349506e-01   +6.716777527919614e-01   +6.965961977074651e-01   +8.287838882526722e-01   +9.280473525941685e-03   +8.572783385118985e-01   +3.319876500535031e-01   +8.143348173727376e-01   +4.749448133842926e-01   +6.991880008002150e-01   +5.672514251472682e-01   +2.414365608965344e-01   +5.104294409539168e-01   +9.112882950693685e-01   +5.234409825138601e-01; +4.425628250869215e-01   +6.407265143046508e-01   +6.208588189951542e-01   +2.724647600165803e-01   +4.678164932972410e-01   +2.999903895271880e-01   +5.934950128595359e-01   +2.355542417572721e-01   +9.041674718401371e-01   +3.059446673827860e-01   +2.308903281576521e-01   +1.568743048157943e-01   +7.921152053209263e-02   +4.883328979581554e-01   +9.295016604103207e-01   +9.468798406765564e-01];
L2I_L1I_iGABA_netcon = [+7.232973730603950e-01   +5.045505464884835e-01   +7.403736945324972e-01   +5.736976172360345e-01   +9.984763109649646e-01   +7.509566044976095e-01   +9.492449567427860e-01   +2.131533617497542e-02; +5.529938010123551e-01   +1.025215655218248e-01   +2.133772290078716e-01   +9.048225822331026e-01   +1.952844742295546e-01   +4.473748455808500e-02   +9.224319528938429e-01   +7.770484951496703e-01; +1.000000000000000e+00   +5.320990509912720e-01   +7.084101162157995e-01   +6.905356113790256e-01   +8.767443973270065e-01   +7.784211285531873e-01   +2.711891822975884e-01   +1.908529971580233e-01; +4.034680583546483e-01   +1.739737162423334e-01   +9.472736620079547e-01   +4.614350194256061e-01   +8.212022928372384e-01   +4.012453528840013e-01   +9.164707151406133e-01   +2.092397052238649e-01; +8.000169557272682e-01   +5.404684193326609e-01   +6.937339531488921e-01   +2.921772193030734e-01   +9.756970911330517e-01   +4.342164484536141e-01   +6.195567205220491e-01   +2.125779877264801e-01; +5.626572316028122e-01   +6.074540961287240e-01   +7.960859312902635e-01   +2.420677590505024e-01   +1.924879315137947e-01   +8.315748123952534e-01   +9.705312988802646e-01   +5.981138256838899e-01; +9.425587154416549e-01   +4.927901010852777e-01   +2.402197348454359e-01   +2.864419055645955e-01   +7.977579695770048e-01   +2.007255208939268e-01   +6.785760793158868e-01   +3.483600769897503e-01; +9.925328811092576e-01   +3.863027274464259e-01   +7.157440590234081e-01   +9.410602845638242e-01   +1.166625564093933e-01   +4.836430158827348e-01   +4.371313967383419e-01   +2.932138450056226e-01; +8.251897321757495e-01   +1.592481692799284e-01   +4.947862837832820e-01   -3.534875305137331e-03   +8.544177521162757e-01   +3.679643054850105e-01   +8.125331084164386e-01   +7.798057792285193e-01; +4.337441732551489e-01   +9.584374315817830e-01   +7.310725040656575e-01   +8.547035653324212e-01   +4.177291769440930e-01   +8.404517735202196e-01   +9.835338008114669e-01   +3.081666155488069e-01; +5.162477148591224e-01   +6.450424394400452e-01   +5.457427268887080e-01   +4.291516854072251e-01   +6.321622112872008e-03   +9.626086610388743e-01   +7.350510487337922e-01   +4.609758901812770e-01; +1.664782242684949e-02   +4.028900379539336e-01   +3.881098513499665e-01   +4.179414410047388e-01   +3.724447804519734e-01   +6.003350925681182e-01   +2.774832635965139e-01   +5.884156898615629e-01; +4.551281819168060e-01   +1.955030668278273e-01   +7.023412389347822e-01   +7.834073853370211e-01   +2.239061321933788e-01   +6.657121987307391e-01   +3.969293985980145e-01   +8.149982246575684e-01; +4.426915148447303e-01   +4.565624169610852e-01   +7.450698487713275e-01   +4.089967506912324e-01   +9.966777051431845e-01   +4.411281393288631e-01   +3.796330366362182e-01   +3.456901202054942e-01; +6.724867782927167e-01   +1.467301106902982e-01   +3.231588358223145e-01   +2.852531778569284e-01   +6.232040784490045e-01   +6.415427843953343e-01   +3.430460838335744e-01   +7.633945645313777e-01; +8.270435517714095e-01   +5.133518614095689e-02   +7.595248036933603e-01   +3.093116377574879e-01   +4.431202647787926e-01   +6.814502266323120e-01   +1.336693372225033e-01   +3.353541516706517e-01];
L1I_L2I_iGABA_netcon = [+5.670197820756001e-01   +1.897266364599994e-01   +8.128959491490743e-01   +3.004836090309700e-01   +6.454094764925465e-01   +3.192914576153633e-01   +8.715350484091778e-01   +2.187270596619271e-01   +6.162787754712823e-01   +9.409905019950900e-01   +4.274275404490737e-01   +4.713229664214765e-01   +4.124200619944215e-03   +7.978861167603647e-01   +6.570753792063266e-01   +4.711818925910532e-01; +3.778908665214580e-02   +5.799309471520194e-02   +3.495936614921510e-01   +3.297359327183383e-01   +9.364334431268228e-01   +3.633244855308471e-01   +3.299599902645606e-01   +1.593030129483530e-01   +4.622662953686570e-01   +2.283039340710229e-01   +3.235004532426962e-01   +2.957382431884266e-01   +9.498403883792426e-01   +1.829826288819766e-01   +8.979843971621519e-01   +2.369755588310690e-01; +3.578842683660539e-01   +6.547261489042686e-01   +3.906596197155119e-01   +7.353768518139171e-01   +2.449475687344166e-01   +5.275003033447131e-01   +7.745426593726842e-01   +9.683179760405110e-02   +8.021169050509849e-01   +4.993013782007847e-01   +6.442634628097889e-01   +8.877603368122386e-01   +9.686362755708359e-01   +6.814523909690874e-01   +3.374154788852347e-01   +1.107566075956647e-01; +8.788121434483892e-01   +1.556946456210843e-01   +6.199907988746487e-01   +9.648745426400690e-01   +4.851881768344611e-01   +9.387790448978024e-01   +6.578916388739200e-01   +4.865625616745422e-02   +5.988431000297152e-02   +3.766834899450294e-01   +4.513182261455115e-01   +5.358545836952536e-01   +3.282547292611592e-01   +4.963005928598606e-01   +1.998076707303257e-01   +1.363423839201118e-01; +9.794032929694916e-01   +8.096875416844709e-01   +7.568733178598136e-01   +7.061765254379390e-01   +3.010655121328949e-01   +6.677842070054486e-01   +7.189577541619558e-01   +6.878968792841210e-01   +6.468659100005728e-02   +7.088208773589344e-01   +2.002474025701559e-01   +4.076448686367523e-01   +6.346504945166404e-02   +2.317765611334887e-01   +7.428387682980322e-01   +9.926088571373974e-01; +5.800183467014278e-01   +4.325846169605709e-01   +1.280798706730464e-01   +3.654242966050880e-01   +9.685310486367327e-01   +1.542281614131853e-01   +7.113921866383817e-01   +6.767959955235058e-01   +5.601615276828396e-01   +7.604829791052821e-01   +3.449828577786516e-01   +4.963930637686463e-01   +8.921413401349945e-01   +7.181565219604752e-02   +1.845302637348350e-01   +5.633391613831935e-02; +8.019264282297183e-01   +9.393376964597450e-02   +4.101270472327129e-01   +3.166223238658016e-01   +5.725927971592748e-01   +9.298152576306652e-01   +6.195445889330258e-02   +2.428376359707323e-01   +7.740833116772146e-01   +9.392188380495959e-01   +9.105079783261858e-01   +8.959617860151617e-01   +1.503198902483218e-01   +3.411179026750250e-01   -2.057622004562580e-02   +6.289501547160649e-01; +8.687518636678304e-01   +4.026212127256515e-01   -2.310355800472996e-02   +9.008429141140430e-01   +1.988883834583876e-01   +9.817248318197277e-01   +8.215797725117410e-01   +1.278871398171522e-02   +8.001639085326927e-01   +5.514172625691818e-02   +9.150175661720373e-01   -1.472746632871577e-02   +8.452049798874295e-01   +1.074161188391785e-01   +9.777477923152124e-01   +7.143453653875073e-01];
L2E_L1E_iAMPA_netcon = [+2.741361096193651e-01   +9.070644725528616e-01   +6.489688919188971e-01   +4.699749743997513e-02   +3.224901700062384e-01   +4.013652325039557e-01   +1.273935191693727e-01   +6.101768467435205e-01; +2.957727469159590e-01   +1.949134076762088e-01   +7.481707105609382e-01   +9.027209079212994e-01   +3.570313636492648e-01   +5.598233681337654e-01   +2.888914504696755e-01   +1.250664888964134e-01; +5.395115006393624e-01   +9.206101852538611e-01   +8.041834443030662e-01   +1.153917791013181e-02   +6.656734798944592e-01   +1.038728725599038e-02   +4.279921090490683e-01   +8.305916269412497e-01; +5.233427689572329e-01   +6.099917295353430e-01   +6.104327450486192e-02   +5.741298742189115e-01   +2.541861357541590e-01   +5.049954793710550e-01   +2.161453249341289e-01   +4.560652331551976e-01; +8.295807551495137e-01   +7.548204086325089e-01   +7.902541607491165e-01   +5.127433135863300e-01   +7.802433663814020e-01   +3.642188076538790e-01   +4.935943559148173e-01   +5.184540728248659e-01; +5.007585322663139e-01   +6.876233210523396e-01   +3.069925355118272e-02   +6.328371015923719e-01   +6.477392556713537e-01   +8.636870412385086e-01   +2.280205264559214e-01   +3.872246975079477e-02; +4.673216303924729e-01   +3.442898693404047e-01   +2.561724586274201e-01   +3.898183899115609e-01   +3.882780013135171e-01   +2.623199679915583e-01   +5.370750583479750e-01   +2.868204426785097e-01; +7.344578335978318e-01   +1.628209019944592e-01   +2.884927472601750e-02   +9.340389321402718e-01   +5.310333470985722e-01   +3.722964785244873e-01   +5.479742514030836e-01   +6.276184433731826e-01; +7.404732288284489e-01   +6.117064432797483e-01   +6.482672827227193e-01   +1.235535365181297e-01   +3.645669202129774e-01   +2.249306084761294e-01   +9.874317931442395e-02   +9.858292998645681e-01; +5.816980998091213e-03   +1.593119510773519e-01   +1.249395498999911e-01   +2.071232969097159e-01   +2.428776661416532e-01   +5.827689655136027e-01   +8.639815642794693e-01   +8.347723063258407e-01; +1.973884091883434e-02   +2.306592491606624e-01   +6.043124741436058e-01   +5.424411187357178e-01   +1.491626422664034e-01   +4.433412597814055e-01   +1.629096761729749e-01   +7.185571628972207e-01; +4.177866588827857e-01   +5.086229381709104e-01   +5.881314917971414e-01   +5.124709343270225e-01   +6.987688613230481e-01   +3.224971513008051e-01   +6.289425208266717e-01   +4.644300671070994e-01; +6.539664151543890e-01   +7.172365948639455e-01   +6.649823957138266e-01   +2.705202584469725e-01   +2.035777327889894e-01   +6.141751692566376e-02   +9.908141893160743e-02   +5.677999996464915e-01; +7.513997895711040e-01   +8.409356225738966e-01   +4.329846782695491e-02   +8.898994091003823e-01   +4.679688044235012e-01   +8.759972114927103e-01   +5.164413428374912e-02   +2.208763211496335e-01; +9.398183085818086e-01   +1.966556792553550e-01   +4.205270426834982e-01   +5.455230998769977e-01   +3.594819875113949e-01   +2.379188138727833e-01   +6.364558318115019e-01   +4.013419678379664e-01; +8.399531688030443e-01   +5.926716407839816e-01   +6.823461641762438e-01   +3.638125108086708e-01   +5.039297077126541e-01   +8.797075273334983e-01   +7.637444091200275e-01   +1.016336689998912e-01];
L1E_L2E_iAMPA_netcon = [+8.692020664736695e-01   +4.786339575547304e-01   +5.649220301751281e-01   +9.643146054119348e-02   +9.723700376439623e-01   +2.777604127940625e-01   +5.401754922883849e-01   +5.183935692924674e-01   +9.872271985836548e-01   +5.544864410040696e-01   +6.503337977016005e-01   +5.061540399391163e-01   +5.247760910969178e-01   +3.683204465425593e-01   +5.453866370383474e-01   +2.023335614300561e-01; +7.911398793947485e-01   +2.404330748629351e-01   +1.183817622705115e-01   +5.794543863823902e-01   +8.038221362481078e-01   +6.259161651560871e-01   +9.277994499477750e-01   +2.801700722105745e-01   +3.674930375925765e-01   +3.499071800861497e-01   +7.972901131158899e-01   +6.705039463893412e-01   +6.849717821922913e-01   +8.909920953866159e-01   +3.865436754054267e-01   +5.326908659634966e-01; +8.082301937884682e-01   +8.743424803305611e-02   +1.254064501082562e-01   +9.582751366426324e-01   +2.870246403742430e-01   +3.945241369619961e-01   +9.567977673039856e-01   +3.085944093114485e-01   +1.753579337264417e-01   +6.125214207258874e-01   +8.675456475003895e-01   +4.642123804728217e-01   +8.613064055967998e-01   +9.764050294041499e-01   +8.364951207927775e-01   +6.622515002285329e-01; +7.404731804168202e-01   +1.066945521025843e-01   +5.537279430867652e-01   +3.904868306916284e-01   +4.060884247329770e-01   +8.417065426625489e-01   +2.165631910855792e-01   +1.314962675427964e-01   +6.212504487721702e-01   +4.614526100776074e-01   +3.694601825845816e-01   +9.734552122351190e-01   +7.638382357281759e-01   +9.177812676180815e-02   +7.560464269443248e-01   +8.084552399216570e-01; +4.362440472139180e-02   +2.602917813967746e-01   +1.667327058767145e-01   +7.790209384887734e-01   +2.009508935039714e-01   +4.921943501916236e-01   +9.895953243219510e-01   +2.871976601980157e-01   +1.171476769774894e-01   +7.695786921928196e-01   +5.212171715315962e-02   +5.819720951805981e-01   +9.049242292459146e-02   +6.346821184451245e-01   +4.114890584444189e-01   +1.145543987380641e-01; +6.807969766892451e-01   +4.563066873262881e-01   +3.949464192290235e-01   -3.633644113396856e-02   +9.443769518313710e-01   +1.018563718257469e-01   +4.794593305629503e-01   +1.873235452025874e-01   +7.738984196909230e-01   -1.960369276299901e-02   +7.480584308934271e-01   +7.296620421837342e-02   +7.473455039073930e-01   +5.258950514617179e-01   +6.999472563166967e-01   +3.464608265528451e-01; +3.230998660493050e-01   +6.532290508911820e-01   +3.911497699138280e-01   +3.943202522587013e-01   +3.797957744848434e-01   +8.943007344789928e-01   +9.187584529243474e-01   +4.102050629965425e-01   +6.921130123468600e-01   +7.652844463810079e-01   +8.304762145401597e-02   +1.408125862158506e-01   +1.062777904296954e-01   +3.773264943717964e-01   +3.238476696787335e-01   +7.871028771794238e-01; +1.799851726268859e-01   +4.666338548024694e-01   +3.264516673416357e-01   +4.131126569674622e-01   +9.557674433069122e-01   +4.984397133114810e-01   +9.639976810652338e-01   +8.985748798747186e-01   +3.595678774495489e-01   +8.049862602472903e-02   +3.580670014196476e-01   +3.270461016520058e-01   +3.229561591747905e-01   +7.704239940709205e-01   +7.552072378367797e-02   +5.716750849148458e-01];
L2I_L2E_iAMPA_netcon = [+3.737565765313148e-01   +2.295286758366930e-01   +4.259150719183720e-01   +5.741389785631950e-01   +1.906248997869935e-01   +8.825761181701811e-01   +6.539748894516468e-01   +2.867841203846653e-01; +5.243881004693781e-01   +2.140053191428873e-01   +6.232603565222011e-01   +2.673707752693200e-01   +6.763020427048186e-01   +7.992751260637661e-01   +9.931861896849783e-02   +5.063995334007497e-01; +6.303009272416665e-01   +2.785404553513992e-02   +7.033822900906834e-01   +6.229726784712950e-01   +1.526761885423302e-01   +5.952284718063747e-01   +8.325361523109345e-01   +4.981848619295068e-02; +4.807730099074857e-01   +3.011268227356726e-01   +6.416913773168721e-02   +9.764462690795872e-01   +3.694322373835380e-01   +6.187107320764424e-01   +9.583508176574048e-01   +2.057735736791808e-01; +1.581921025050360e-01   +4.363657595958895e-01   +3.952543495054810e-01   +8.117944931358424e-01   +8.365700772512610e-01   +5.981398037210345e-01   +6.827549661800641e-01   +3.124502671341950e-01; +9.183081231366251e-01   +4.983886123982758e-01   +9.059750559877444e-01   +8.378135925431131e-01   +7.220004679241728e-01   +8.363069034363867e-01   +8.834865052704227e-01   +5.168429043524343e-01; +1.266602575966526e-01   +5.533069352916575e-01   +9.412589162578404e-01   +9.202355121618058e-01   +8.331191909651232e-02   +7.614408945220901e-01   +2.619650980198521e-01   +1.009091972317171e-01; +5.449385434129405e-01   +3.741517120438230e-01   +2.070652047791039e-01   +2.872108840575140e-01   +7.408436688380228e-01   +3.980032800079267e-01   +9.520768221189367e-01   +6.219081128369952e-01];
L2E_L2I_iGABA_netcon = [+4.901679895108055e-01   +6.449575723362859e-01   +6.501644312038933e-01   +6.888272635231077e-02   +4.909904267196778e-01   +5.162041205534588e-01   +3.028163104915708e-01   +7.645145637120675e-01; +4.658329964835885e-01   +3.780474520807199e-01   +1.387479440054922e-02   +4.900970546695317e-01   +4.910665274244904e-01   +6.199669264050405e-01   +4.572741966286766e-01   +4.855932791549319e-01; +6.258712436761509e-01   +5.068864047376560e-01   +4.163137186906665e-01   +5.640874843272089e-01   +3.260116169898865e-01   +2.576347555306965e-01   +2.017696636860186e-01   +1.000000000000000e+00; +7.517199141072261e-01   +5.574879051798306e-01   +4.000480030890516e-01   +8.788100987490471e-01   +2.276777655446583e-01   +6.948273842334968e-02   +1.575741778896144e-01   +4.457852374095442e-01; +5.082031571310558e-01   +8.110421162054503e-01   +5.410002017681917e-01   +8.243714067117630e-01   +3.968888447710971e-01   +7.565801441947113e-01   +7.099136502002902e-01   +3.132567430448376e-01; +4.157115184009766e-01   +2.643274293399629e-01   +4.761820591717512e-01   +3.640494208995731e-01   +7.961595270346906e-01   +8.537006363873323e-01   +1.121761945473598e-02   +4.532865951617622e-01; +7.814619033845128e-03   +4.900553077772373e-01   +8.740067657056914e-01   +5.638411864716549e-01   +5.089954565792781e-01   +3.887957719600173e-01   +9.526439794385732e-01   -1.529267618451434e-02; +9.408983133398781e-01   +5.382220766410097e-01   +9.282741833964733e-01   +4.901746808818491e-01   +9.224565556731384e-01   +5.614996828350186e-01   +3.696763832911706e-01   +3.673571569484229e-01];
L3E_L2E_iAMPA_netcon = [+2.381997013732444e-01   +9.556951156604423e-01   +4.585922021055877e-01   +7.616587938583927e-01   +1.620798411760999e-01   +4.378895546108085e-01   +4.335629950797790e-01   +1.050613730461368e-01   +1.242151220419022e-01   +5.503268158953866e-01   +1.394896546397992e-01   +4.622646029508363e-01; +2.557198052255811e-01   +4.938584815227441e-01   +1.859547723574901e-01   +2.440870675419139e-01   +6.373474887256209e-01   +9.239678740723812e-01   +7.488699432342364e-01   +6.326123810701353e-01   +2.803986404482965e-01   +4.206052647144164e-02   +3.062265433930331e-02   +8.780553426118165e-02; +7.999965221721923e-01   +3.728910958565539e-01   +5.622357894422207e-01   +9.693317250380659e-02   +9.004530641765204e-01   +8.590667606962523e-01   +5.186503434609773e-01   +7.181812806324391e-01   +6.652720292192024e-01   +3.726611469787838e-01   +4.236217328765434e-01   +9.247259069326498e-01; +1.886735598346212e-01   +4.379027858338433e-01   +1.924638719078991e-01   +8.094921114710630e-01   +5.328192553387658e-01   +5.877677079853298e-01   +8.777217040548684e-01   +2.876264344083957e-01   +8.224349523053469e-01   +8.108923422060148e-01   +4.881254501224587e-01   +2.359706849140886e-01; +2.133839251092441e-01   +8.287075474945045e-01   +4.154149895545649e-01   +6.023864459766180e-02   +1.966119890634472e-01   +9.690911143091678e-01   -2.035291275531287e-02   +7.037760556753647e-01   +5.137365332944469e-02   +8.232680777799901e-01   +2.990041470903912e-01   +2.332143772576405e-01; +4.106420152155725e-01   +3.494962796552498e-01   +8.669507853621737e-01   +9.836885983927360e-01   +4.045264828622842e-01   +9.941858285046865e-01   +1.064168574634878e-01   +4.047426389344468e-01   +4.788021418393301e-01   +8.012134392989337e-01   +6.668654259112510e-01   +8.668514935714092e-01; +1.508660548725817e-01   +5.070403701445729e-01   +6.100612728877488e-01   +1.117745958778466e-01   +6.539682427281017e-01   +5.126643851626640e-01   +7.923229571346676e-01   +1.441325226096553e-01   +4.769495126541488e-01   +4.072733404163832e-01   +9.803179739617239e-01   +7.719317057496539e-01; +6.008870138577249e-01   +6.204673142734213e-02   +3.962297637832215e-01   +1.904147065672379e-01   +4.633931151275172e-02   +9.149863877927156e-01   +3.951108727378552e-01   +4.627803964286056e-01   +8.873132642885240e-01   +9.750460801624395e-01   +9.427957367667317e-01   +3.408087022473242e-01];
L3I_L2I_iGABA_netcon = [+3.133420892421841e-02   +3.410061415213776e-02   +6.136413492632106e-02   +6.656617808873897e-01   +8.401878970402765e-02   +4.748013646355286e-01   +8.375390312578594e-01   +4.027793136305083e-01   +4.223273673522137e-01   +1.000000000000000e+00   +8.921879101156815e-01   +6.175162500495830e-01; +3.513154856064762e-01   +4.361212876951723e-01   +2.933294056518199e-01   +1.474760210000435e-02   +4.520354667492988e-01   +5.999441284842071e-01   +4.416644001189248e-01   +8.810382572030478e-01   +9.215374250553608e-02   +9.276775777748533e-01   +3.139205019179713e-01   +6.530760387891761e-01; +3.288898810867441e-01   +7.092718654474962e-01   +3.198596334962692e-01   +8.174796024858358e-01   +3.517963771143408e-01   +8.286838350627062e-01   +9.570632307089105e-01   +3.184984710081848e-02   +6.259406877628111e-01   +4.889407608425761e-01   +1.551060584640394e-01   +5.647814552007601e-01; +6.402933515484011e-01   +9.746675991850267e-01   +3.253962903956626e-01   +2.529114708771760e-01   +1.590330755383736e-01   +6.063481626351337e-01   +1.950712767499921e-01   +2.911220311221136e-01   +8.281921913290637e-02   +3.521069012249979e-01   +5.330068660037574e-01   +8.358041556810765e-01; +9.747346194182397e-01   +1.120039079870209e-01   +4.946397603418932e-01   +8.227980344233129e-01   +5.117152516517015e-01   +8.857761448103835e-01   +9.894275657635579e-02   +5.496256708376437e-01   +5.693967125885809e-01   +8.098153908560445e-01   +7.582655382092390e-01   +5.336292923546091e-01; +9.248938925969865e-01   +1.979808264638768e-01   +1.204533430361136e-01   +7.272467000668502e-01   +9.052959243544826e-01   +7.142155138688464e-01   +8.946730060339658e-01   +5.179774212636664e-01   +1.670192981025235e-01   +8.416855165745706e-01   +3.941824712190063e-01   +6.027766935479446e-01; +1.087509429843746e-01   +5.720300559061262e-01   +9.419538401494117e-01   +5.780663953019843e-01   +9.376257248242336e-01   +8.484962108272809e-01   +8.308215539133276e-01   +8.283523817546473e-01   +5.951054546148966e-01   +3.761072643249214e-01   +2.882136781712469e-01   +5.555076730239636e-01; +2.953517205600638e-01   +2.059047361297055e-02   +7.759184704496674e-01   +1.839491957046873e-01   +4.272567957999101e-01   +6.301710407528609e-02   -1.962008745579493e-02   +9.813702907274853e-01   +4.746028191797357e-01   +1.253078241208174e-01   +7.469333148343879e-01   +4.843839256556257e-02];
L2E_L3E_iAMPA_netcon = [+9.254020806300641e-01   +3.000778429396967e-01   +5.880693943442641e-01   +6.757597747501131e-01   +1.880600148036263e-02   +7.090029970951114e-01   +7.482437124980122e-01   +5.136497587181371e-02; +3.489588621230392e-01   +5.895488048176371e-01   +6.891418825786918e-01   +7.681791282849942e-01   +2.176908409021782e-01   +2.387087139873839e-01   +8.555905324609455e-01   +8.689104625537633e-02; +6.272515578262328e-01   +5.239406356864874e-01   +8.916326209013257e-01   +6.653073941465439e-01   +9.205148641911407e-01   +4.807244005162660e-01   +9.549509254395774e-01   +5.072197906719473e-01; +1.812744432065005e-01   +9.313624308480095e-01   +9.142651364827997e-01   +4.326915927456639e-01   +3.655530382048307e-01   +9.609559052660105e-01   +2.516533404815679e-01   +5.065629276339175e-01; +5.028137185485353e-02   +2.193557580659065e-01   +6.949992572319297e-01   +1.966529554717092e-03   +1.898623222955518e-01   +5.136995619388841e-01   +5.401317910198994e-01   +6.476204226481646e-01; +4.084192527908331e-01   +7.681703934579796e-01   +1.921391978598027e-01   +7.942559589706730e-01   +1.450950470418460e-02   +1.903895657806389e-02   +4.848399537439643e-01   +3.075134780873972e-01; +4.872170459514802e-01   +7.817484874130533e-01   +7.950831695326370e-01   +2.677218381367239e-01   +8.712175889682875e-01   +2.199115178054690e-01   +7.169122066347479e-01   +9.474014951880064e-01; +4.489733276823266e-02   +6.176978847945311e-01   +8.945052781850168e-01   +4.683229852138713e-01   +1.008820126986730e-01   +7.443319332996828e-01   +1.268111653623747e-01   +3.556195863315038e-01; +1.000000000000000e+00   +9.545372195194786e-01   +3.922057345297209e-02   +1.414529725258022e-01   +1.258881513386694e-01   +9.254775589035863e-01   +2.725746969343667e-01   +9.298246076148978e-01; +1.739130574652626e-01   +3.412267369231748e-01   +8.041185252269981e-01   +3.601368424126646e-01   +3.746700445914539e-01   +9.453886368875509e-01   +6.553837139773705e-02   +9.965507116362289e-01; +6.727778516361624e-01   +3.852495054712674e-01   +2.387393078835741e-01   +2.025282243646679e-01   +1.109168008574053e-01   +3.364616082252203e-01   +2.072264343226458e-01   +1.146114980634268e-01; +8.626116863843336e-02   +6.213550732612724e-01   +7.913401797193645e-01   +4.408208597063008e-01   +3.411718769059545e-02   +7.718689860999345e-01   +7.909238568401085e-01   +7.826484722175294e-01];
L2I_L3I_iGABA_netcon = [+3.833912669917254e-01   +6.358880083337877e-01   +2.416248276493583e-01   +6.978832114749305e-01   +5.617412443371504e-01   +4.517100299485683e-01   +4.137815472190600e-01   +4.763790710501221e-01; +3.566153533563344e-01   +1.169087612474454e-01   -1.561480439912816e-02   +8.544425869327505e-01   +7.451824080294274e-01   +7.094346117931050e-02   +8.781432566605957e-02   +6.205210897144957e-01; +3.728510475658908e-01   +6.403459100658986e-01   +3.873958146745843e-01   +1.013169024004577e-01   +8.093157849428825e-01   +6.052114401885589e-01   +1.778785211119708e-01   +8.340702754000770e-02; +6.058591663989807e-01   +8.872354663335961e-01   +6.132394816229573e-01   +5.072321954207868e-01   +5.627677249434057e-01   +7.026756872714538e-01   +4.393998781710223e-01   +7.046605409910612e-01; +9.571117321103696e-03   -9.577533869434161e-03   +1.096803611784464e-01   +6.444484111957467e-01   +2.180833938988300e-01   +7.017950805571460e-01   +4.432451316954979e-01   +3.289943846432465e-01; +5.189499589559116e-01   +4.576306271456740e-01   +4.428431432321278e-01   +6.946493631197322e-01   +2.798030308222730e-01   +8.800629412514531e-01   +3.737006266626808e-01   +1.525495371477866e-01; +3.019490476234820e-01   +2.765174990183258e-02   +4.706618165839369e-01   +9.911786476405600e-01   +6.423128090109199e-01   +8.926099883951630e-02   +3.068369470519660e-01   +8.185367485378896e-01; +2.008182127149183e-01   +9.516374788641828e-01   +9.513171041572516e-01   +9.439717866388625e-01   +4.940971018127608e-01   +9.035288425948076e-02   +7.623534075659657e-01   +1.416658493537802e-01; +3.450613415526497e-01   +5.301792543654051e-01   +2.935637189253327e-01   +2.145439131360807e-01   +3.426292983783050e-01   +2.492406163463244e-01   +6.144721720325549e-01   +4.997063347801738e-01; +4.303614609330660e-01   +2.163812970440046e-01   +1.898287279698457e-01   +3.734619841535639e-01   +9.505201351171844e-01   +5.099382717935166e-01   +4.967373131122873e-01   +9.509788938097107e-01; +6.502958047825120e-01   +1.215124937069414e-01   +3.308881028521951e-01   +6.045980391010457e-01   +5.048197165657337e-01   +7.806402234293756e-01   +9.277556129522407e-01   +6.749737916126011e-01; +3.685148190413154e-01   +2.310070707721620e-01   +6.473417623663390e-01   +2.546049720602777e-01   +1.150114266258432e-01   -6.079117855193042e-03   +3.007444940853297e-01   +7.009079281634694e-01];
L3I_L3E_iAMPA_netcon = [+8.373302898444747e-02   +7.250831923476933e-01   +1.212183196527682e-01   +1.936187178035162e-01   +3.055796411296583e-01   +6.671919990173463e-01   +6.332643025978822e-02   +3.590769608880342e-01   +5.518640820645349e-01   +3.030176711957225e-01   +6.217185528915515e-01   +8.806673822421296e-01; +3.543342445218396e-01   +8.353880505430920e-01   +2.438580459293337e-01   +3.654101679479930e-01   +8.117677015779334e-01   +3.730375930610467e-01   +3.721762300286328e-01   +4.113870204280492e-01   +6.462823778955014e-01   +2.865119456851631e-01   +7.129553169193897e-01   +2.337019039353395e-01; +4.962643622128431e-01   +3.891200995347341e-01   +7.596843867951292e-01   +8.849944012015005e-01   +6.196490064977804e-01   +5.811892876372822e-01   +9.834453987401917e-01   +4.290019093168551e-01   +2.163925124834144e-01   +3.129396449606626e-01   +9.270981915513082e-01   +8.487370661360917e-01; +5.266313243113738e-01   +7.808912062225921e-02   +5.609558831645773e-01   +7.599003608157295e-01   +4.551780221100881e-01   +6.046771938159623e-01   +5.924832176247319e-01   +6.778828252973701e-01   +5.731907499415942e-01   +1.747449687106874e-01   +4.231003865761596e-01   +4.806226399716687e-01; +9.776755035844604e-01   +8.441456637565987e-01   +5.830718296560383e-01   +4.658934930820385e-01   +2.871633123744745e-01   +3.705231638502953e-01   +1.243024914036760e-02   +2.157229684229669e-01   +3.158037587174294e-02   +2.471591399844784e-01   +6.385659237482690e-02   +5.185280082719752e-01; +3.931339270401289e-01   +2.082719898174220e-01   +6.626903360342284e-01   +4.442739964800412e-01   +9.484266287729238e-01   +6.215473055137863e-01   +3.019317728071307e-01   +1.106561849353883e-01   +1.687366619008118e-01   +5.478388131307484e-01   +3.488118200597500e-01   +6.042042753649787e-02; +4.784564557530870e-01   +2.153274032263719e-01   +8.461984829497960e-01   +8.807471742611087e-01   +1.479514571899664e-01   +2.897499069383566e-01   +3.802692072312260e-01   +1.190870411017125e-01   +9.039955241665808e-01   +6.994761662538433e-01   +2.717233640890564e-01   +2.742060653948294e-02; +3.695241142318754e-01   +4.349667597884475e-01   +2.454797415126430e-01   +6.025378623886471e-01   +8.623712954547841e-01   +2.555476008836060e-01   +3.916757106784777e-01   +2.908432523766041e-01   +3.516713144027326e-01   +2.646365189413963e-01   +6.953430288685911e-01   +5.735923605206075e-01; +2.997338780366527e-01   +5.186075615468375e-01   +3.655897151272914e-01   +5.952549158780278e-01   +5.732667289066009e-01   -2.853007993583241e-02   +1.083537989875295e-01   +4.980292165877214e-02   +3.346849023396887e-01   +2.071260827574360e-01   +8.893697413212915e-01   +8.888311856183474e-01; +7.452099199902816e-01   +6.136079668074323e-01   +5.783106484189973e-01   +3.834085773852320e-01   +4.361043649378889e-01   +3.872778147561821e-01   -7.388675140029761e-03   +6.382040873674257e-01   +3.200233469103669e-02   +9.538705407978436e-01   +4.641320998552896e-01   +1.769104633969766e-01; +1.145201879337859e-01   +2.665377557292453e-01   +6.657029391931677e-01   +2.268511809560868e-01   +6.198200149046536e-02   +4.978104545430770e-01   +9.427759192195104e-02   +7.557813657352317e-01   +7.681015341360098e-01   +1.365988254386943e-01   +6.752902101375088e-01   +2.531631731590693e-01; +6.158897208445353e-01   +6.051113707724209e-01   +3.929835191780724e-01   +6.067544036579832e-01   +6.630040515065332e-01   +4.503762463488571e-01   +3.394909297573632e-01   +8.138775634427456e-01   +6.306650689006940e-01   +4.293011835941218e-01   +5.141203096767278e-01   +4.198669642045279e-01];
L3E_L3I_iGABA_netcon = [+3.368740990565883e-01   +7.309382201167376e-01   +7.384818223164993e-01   +9.043123723284623e-01   +4.460012774871947e-01   +1.272281371736152e-01   +2.707182511719739e-01   +7.182808608685090e-01   +8.168323670252116e-01   +2.778540560315900e-01   +5.094827585882762e-01   +2.916680823948457e-01; +8.796509617774160e-01   +3.841419106104388e-01   +6.126031479043771e-01   +3.617140025074858e-02   +9.105632245521775e-01   +3.964712022301036e-01   +8.205294919776334e-01   +7.510851860240015e-01   +6.325461519686063e-01   +7.537510483062024e-01   +2.650587492864445e-01   +5.001751568815188e-01; +8.410616243757223e-01   +3.404528961478084e-01   +3.804223744691653e-01   +4.660788893318887e-01   +5.881088772011982e-01   +5.651009464933314e-01   +2.624812329762292e-01   +8.274345537890589e-01   +5.857785061802983e-01   +1.123785586811952e-01   +7.706204571635837e-01   +8.825497829442810e-01; +1.331279151072048e-01   +6.715810615205351e-01   +3.086122053392928e-01   +3.141634487393044e-01   +1.066523631074533e-01   +7.042125006652707e-01   +2.560338386498973e-01   +9.321197871317459e-02   +3.058824093761271e-01   +5.091677630096442e-01   +7.574464691926794e-01   +5.824756896730652e-01; +2.281247171624582e-01   +7.427190769909316e-01   +6.090001439413374e-01   +2.881083501314026e-01   +1.087673627967820e-01   +6.117820407646437e-01   +9.138064036215882e-01   +2.713237189177691e-01   +3.345781081786300e-01   +8.357422496732696e-01   +6.211113607397403e-01   +2.162571976225232e-01; +4.397446008351461e-01   +8.161600985009072e-01   +7.549632990970553e-01   +5.151139699520589e-01   +7.702713856440634e-01   +9.673084890131563e-02   +3.727175762165786e-01   +3.307502022501317e-01   +8.474480925819375e-01   +8.383514431896543e-01   +8.188215757194086e-01   +2.978567151291149e-01; +5.062380859627909e-01   +8.161905985510757e-01   +2.142786706340178e-01   +4.005060688267332e-02   +4.249091717662115e-01   +6.322109029532774e-01   +6.409104134597292e-01   +1.909891639653186e-01   +1.000000000000000e+00   +6.187583615575349e-01   +2.200139939394925e-02   +3.854006870079598e-01; +4.873503159687358e-01   +4.255468009670041e-01   +8.409434097096069e-01   +3.957839100951144e-01   +8.529485853098534e-02   +9.272966067895452e-02   +5.993124454199312e-01   +5.317155478298365e-02   +5.928780657150226e-01   +8.185537065219772e-01   +2.287139758800298e-01   +9.910732047562444e-01; +3.160106212246305e-01   +5.724972070745638e-01   +2.234621397252688e-01   +7.107197319009090e-01   +9.075474234062156e-01   +1.595921591833425e-02   +3.609573592803746e-01   +6.112424181036515e-01   +6.014405413758700e-01   +9.281149694351714e-01   +7.042855559516437e-01   +6.576371054439791e-01; +7.302856714998726e-02   +7.272872935969921e-03   +3.365460055584086e-01   +5.589419430054906e-01   +7.782529441108661e-01   +2.146594564006641e-01   +2.599858717631662e-02   +3.226731047408848e-01   +6.930531430253712e-01   +2.905843922846442e-01   +6.397301176087277e-01   +5.537311716512374e-02; +9.013428094994970e-01   +9.628911059169065e-02   +7.272156903904717e-01   +5.030366036930994e-01   +4.191683510153184e-01   +8.627083041134304e-01   +9.956091607365218e-02   +7.985490337955469e-01   +3.492258423706239e-01   +9.854094374157426e-01   +4.452045067449103e-01   +7.258951572412359e-01; +6.572062264446382e-01   +8.253347406922850e-01   +5.193762936079234e-01   +9.041665486630507e-01   +8.497493843673511e-01   +4.942664800273937e-01   +9.653700251145413e-01   +9.146733013023263e-01   +4.394830453307166e-01   +9.038532543585761e-01   +5.427009242973535e-01   +9.260719667572338e-01];
L2E_Input1_iAMPA_netcon = [+9.865483885663253e-01   +9.827057322917075e-01   +9.614421297980831e-01   +9.981464906014663e-01   +9.577968663519832e-01   +9.944153089726788e-01   +9.644099503858267e-01   +9.810970376701889e-01];
L2I_Input2_iAMPA_netcon = [+9.583151549515625e-01   +9.729689024386960e-01   +9.926186814527830e-01   +9.297103406719691e-01   +9.554145903646125e-01   +9.562366206170722e-01   +9.521638079795118e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
