function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.258810644079867e-02   +8.046250343327378e-03   -4.613472588601045e-02   +9.173092742182169e-02   +1.362755495837575e-01   +9.657938765553438e-02   +4.844462286795291e-02   +1.853611768762668e-02   +9.894002421738806e-03   -2.298551690884501e-02   +1.912366492306085e-01   +2.709366252954836e-02   +8.514606076244288e-02   +1.594557964454250e-01   +9.042674153279970e-02   +8.224634273205664e-02; +1.681399264116342e-01   +3.324990700180607e-02   +6.401813117570773e-02   +6.144888945258398e-02   +5.689086983101722e-02   +1.847244351405670e-02   +6.627347034821829e-02   +5.135224785658764e-02   +1.201748531475342e-02   -1.729122349875483e-02   +6.695372734904860e-02   +4.659411137007700e-02   -7.829728358136820e-02   +1.270838954049589e-01   -7.644670076756309e-02   +8.805115121634002e-02; +1.241915309704510e-01   +7.337423765005006e-02   +1.383122184423815e-01   +3.988041954429444e-02   +8.807022060988307e-02   +4.889028658356022e-02   +1.394500143913577e-01   -2.861812630852300e-02   +1.477265385457283e-02   -6.611713148135856e-03   +5.095660228822135e-02   +3.358959690864635e-02   +4.079416059970423e-02   -8.154053167007391e-02   +7.050533106992829e-02   +2.217154869067408e-02; +3.055098757584843e-02   +4.374574221358059e-02   +3.980373246350109e-02   +2.013383259850563e-02   +3.887887763599420e-02   +1.363481307759502e-01   +4.295312693962655e-02   -3.973390500315296e-03   +6.755342106120535e-02   +8.397689873610313e-02   +1.124369311754985e-01   +4.815018457482964e-02   +6.852260594530128e-02   +1.552816981881984e-01   -3.851656733810638e-02   +7.153364150158190e-03; -2.401530711964924e-02   +1.234473667980522e-01   +4.539706254457427e-02   -4.849225839607768e-02   -3.654186621243028e-02   +4.717042830246717e-02   +7.260828086337900e-02   +5.269562480859153e-03   +7.048149959725204e-02   +2.201894790599029e-02   +5.870301174150082e-02   +1.670873561490318e-01   +3.729756147969245e-02   +2.280916102794849e-02   -1.824713962968459e-02   +1.021740011534680e-01; +5.334419522110329e-02   +3.663450196411656e-03   +7.322558983567429e-02   -2.627746246438528e-02   +1.004541790823435e-01   +7.161051819628517e-02   +2.869413106502487e-02   +8.492795778668756e-02   +6.909577426186322e-02   +2.025866337372021e-02   +8.350187545572524e-02   +5.057010951134445e-02   +5.702617837272012e-02   +8.173415202039873e-02   +4.214274310265564e-02   +1.673272524310750e-01; +8.384713625032508e-02   +2.856088297302269e-02   +1.177812236430915e-01   +1.270982400202186e-02   +2.291579984127066e-02   +9.590402663534331e-02   +1.464102977204871e-01   -5.865781300760601e-03   -7.022150384760013e-03   +1.687514190685753e-01   +2.177320236470379e-02   +1.077907632763808e-01   +6.917524344710273e-02   -3.239840438247141e-04   +1.409948609074627e-01   +3.824483185960533e-03; +6.318896800719669e-02   +8.796730586479884e-02   +1.082595157142922e-03   +5.338459718071800e-03   +1.287723109631267e-01   +1.107505950114270e-01   +9.957092926058446e-03   +9.178609654833710e-02   +6.201974432874870e-02   +2.265288815687268e-02   -5.027434153434195e-02   +2.562776909059505e-02   +5.282320306644666e-02   +3.339719226146573e-02   -1.995156638442172e-02   -2.549706909893528e-02; +1.118571647917690e-01   +7.925784898578410e-02   +6.737059843620039e-03   +1.873427562432523e-01   -2.356707442856319e-02   -2.378057446084348e-02   -3.879243960700431e-02   +5.506713079828260e-02   +9.536060344534099e-02   +3.364295302011994e-02   +8.791953600489166e-02   +3.786310518660067e-03   -8.561813854992353e-02   +1.807938443897051e-01   +2.304992961146302e-02   +1.102690811176430e-02; -5.231653304199424e-03   +5.925694149854328e-02   +1.563113472183812e-01   -7.028392310563443e-02   +6.308066177962311e-02   +6.652217066987268e-02   -7.725695361634082e-03   +7.824333476360981e-02   +2.377327902356041e-02   +1.030745955088999e-01   +1.242264298222573e-01   +1.058845226587625e-02   -6.626981161484170e-03   +4.243217689727656e-02   +1.064795955080957e-01   +5.463395264846616e-02; +8.048071604273183e-02   +5.056614663670932e-02   -3.472086408072519e-02   +5.675728249178716e-02   +1.509377593418332e-01   -2.062984713686799e-03   +1.001561165881223e-01   +1.316312531396826e-01   +3.155184398388876e-03   +8.350314715348106e-02   -6.082039375662377e-03   +1.205792909862016e-01   +9.741249933961224e-02   +7.306215399717808e-02   +2.304961146452558e-02   +8.993575141467369e-03; +1.016711525970326e-01   +3.816140363699794e-02   +3.734799370065276e-02   +7.896656035723344e-02   +9.779495744169030e-02   -2.436455497867085e-03   +4.785823780513009e-02   -5.933728447742152e-02   +6.184246081933101e-02   -1.881938314436273e-02   +2.672458675176334e-02   +7.979033957577451e-02   -7.014283637062130e-02   -1.502191871440126e-02   +1.146423202059924e-01   +1.025702188948470e-01; +1.729801013488602e-01   +7.777259713952504e-02   +3.818583319517448e-02   +8.777522828196549e-02   -4.202922245702730e-03   -3.232070097289087e-03   +1.030276373790639e-01   -1.591758610382915e-02   +1.001073161552493e-01   -2.034027756253142e-02   +4.232465565456255e-02   -8.801089644831395e-03   -1.803633438879030e-02   -1.851394662416211e-02   +1.116347131808090e-01   +1.896590663388203e-02; +1.649060584197736e-03   +4.558270129575906e-02   -3.241298859212698e-03   +1.020107937047175e-01   +4.226149214356661e-02   +4.142096207116756e-02   +7.514377620494719e-02   +1.725879853104345e-01   -5.190936310667305e-02   +5.769895633921392e-02   +1.952700310506873e-01   +3.618032694208878e-02   -2.303670584848262e-02   +5.161430587947152e-02   +5.450258339006431e-02   +1.454809774224297e-01; +1.101346746697957e-01   +8.340889992598487e-02   +6.247766696428811e-02   +1.372156433640104e-01   +7.931097774248103e-02   -1.092235241094786e-02   +1.362447077561001e-01   +1.506268896623809e-01   +5.487603314545796e-03   +3.797706077654014e-02   -3.775059652759562e-03   +3.070799975739560e-02   +2.824658691250453e-02   +2.729578966140012e-02   +1.026343620631425e-01   +1.281336765121113e-01; +5.673149130289107e-02   -7.794364910206839e-04   +4.057289480498451e-02   +1.145164436448541e-01   +1.952793050069414e-01   +1.099130736702771e-01   -3.107659446090802e-02   -2.548596049450969e-02   -7.311576369821784e-03   -1.063154511466668e-01   +8.754357626200165e-03   +1.066320796682592e-01   +1.210111713788142e-01   +6.206496348350497e-02   -4.817408802442857e-03   +1.283916408919898e-01];
L1E_L1I_iGABA_netcon = [+1.421431631851438e-02   -3.297117395546702e-02   +5.470553608420962e-02   +9.788535127716261e-02   +7.415034430254844e-02   +1.407487281881085e-01   +1.039183552998954e-01   +1.096978672995734e-01   -6.564061276419665e-02   +8.117571687320030e-02   -2.020283937921880e-02   +3.769288326754975e-03   +1.634766049623655e-01   +1.298929860266636e-02   -1.248826858234771e-03   +1.533674720288093e-01; +3.320464388043522e-02   -4.165060983009317e-02   +3.351198672144833e-02   +3.795622048981651e-03   -1.468250985402045e-02   +9.988665751597553e-02   +4.958417441519732e-02   +7.188656470780083e-02   +6.117864528289678e-02   +8.904394892717342e-02   +6.696973215416284e-02   -3.215362126707177e-02   +6.798506168542147e-02   +4.848592366482350e-02   +8.991744343894092e-02   +1.074524497058340e-02; +4.218687436794344e-02   +9.022682332201204e-02   +7.515543416598205e-02   +1.714049709587838e-01   +5.372154822920323e-02   +9.496404517337333e-02   -1.580862612981089e-02   +7.012945763894103e-02   +5.493219352917734e-02   +7.001073236185747e-02   +5.369427986748978e-02   +1.076435428487048e-01   +5.722665214178103e-02   +5.380479866119567e-02   +2.328432470457594e-02   +3.032535422892754e-02; +6.238292423306205e-02   +9.349401128362039e-02   +2.468585785468662e-02   +6.577840476605357e-02   +1.404645632618012e-01   +2.275540156267888e-02   +3.571488665966983e-02   +1.316496998374720e-01   +3.911910688991780e-02   +3.565121919467888e-02   +8.340661910115801e-03   -8.560732588246915e-02   -2.208761036895070e-02   +9.272427023862581e-02   +8.884215182972841e-02   +1.187329057059265e-01; +9.085114822599344e-02   +9.199511068816463e-02   +6.038267370085357e-02   -8.136405365060030e-03   +8.224760535880896e-02   +4.012431682426798e-02   -8.214056532047082e-02   -7.044553696976012e-04   +8.788754393475035e-02   +1.004609462403052e-02   -3.244301671369361e-02   +4.240455708641406e-02   +1.838414139177215e-01   +4.268982543136021e-02   -1.217874372565454e-02   -1.705474350949451e-02; +7.677466602919285e-02   +6.234275497256771e-02   +3.576958478313108e-02   -3.596880074019140e-02   +5.113430436563386e-02   +5.181849150727308e-04   +9.261212258294345e-02   +1.418204400885766e-01   +7.034633871396667e-02   +1.662823143772638e-02   +1.110705364254082e-01   +7.315444503173152e-02   +7.712487829721684e-02   +9.939556979576655e-02   +3.151761759743786e-02   +1.176940419190762e-01; +7.657428581300404e-02   +4.866658999918094e-02   +3.640898728274238e-02   +1.126383321180499e-01   +1.660152851516220e-01   +8.092748822909285e-02   +8.695779538131844e-02   +6.831399787682471e-02   +5.865339602992980e-02   +2.370333571252343e-02   +5.670396842085684e-02   -2.423704073963222e-02   +5.301552118903719e-02   +1.172496726862853e-02   -4.361787446857171e-03   -3.762034463464473e-02; +1.130092852429698e-02   +9.565035104143989e-02   +5.805239350379152e-02   +7.365978275633522e-02   -4.988597294674171e-02   +4.135748371611946e-02   +1.459356489994728e-01   +3.500333899009452e-03   +1.465211778447398e-02   -9.286282470839062e-03   -6.609216347025732e-03   +1.201773747635612e-01   +9.361834285210464e-02   -2.034591701431463e-02   +2.078603424815609e-02   -5.986734265941556e-03; -2.689267954478068e-03   +4.344841849787630e-02   +3.456476865223096e-02   +7.462739706328020e-02   +5.572055364105408e-02   +1.361716776365110e-01   +6.409152705563007e-02   +4.277678327733237e-02   +1.238073164580844e-01   +1.057059771405526e-02   +1.044180242418656e-01   +2.834807922549270e-02   +6.437307495452066e-02   -1.448949237777705e-03   +1.100881759871135e-01   +1.593996985348713e-01; -2.080777233308505e-02   -7.187210862126509e-02   +1.134089723788856e-01   +4.751310546511081e-03   -1.252403684053087e-02   +9.138268141274289e-03   +7.879329541571076e-02   +9.080757036485386e-02   -2.318318043778692e-02   +9.279176184412552e-02   +6.154578127583479e-02   -2.014616653559750e-02   +2.308635757903618e-02   +5.436730301725430e-02   -1.850009174507450e-05   +1.805879750645931e-02; +8.730588718197387e-02   -8.893664288711425e-04   -2.680444695285583e-02   +8.375378769495478e-02   +3.560492780831685e-02   +9.040126238484898e-02   +9.576763034290939e-02   +1.551780632626543e-01   +1.195305308734492e-01   +8.175824945309650e-02   +8.444779207371364e-02   +9.323110996597413e-02   +1.388907779029763e-01   +3.338360550418615e-02   +1.408359531568699e-01   +3.699127250899742e-03; +1.008337515811467e-02   +4.775175701090227e-02   +2.682793267206456e-02   +3.938153883676158e-02   -2.714607180839997e-02   +1.079951193665911e-01   +3.746538157418932e-02   +4.864119581070920e-02   +1.646049797208514e-02   +1.584641726692407e-02   -8.334303057178468e-03   +2.816361865570254e-03   +2.960574889828062e-02   +1.076118083528812e-01   +2.415713404501758e-02   +7.954041860067507e-02; -2.640778901292020e-02   +1.276984351389224e-01   +6.324151718254874e-02   -5.481383949509805e-02   -3.637192636862382e-02   +5.837843950835317e-02   +4.479316993205216e-02   +1.385263771453681e-01   +1.018550956532047e-01   +6.159688257950982e-02   +2.025253589220085e-02   +9.040483528144055e-02   +7.664430980147230e-02   +1.174715592189316e-01   +6.589386136983959e-02   -5.848466722359304e-02; +1.065182061290753e-01   -2.028899737768331e-02   +1.305137562924647e-01   +9.761435867200061e-02   +3.968357824045764e-02   +3.297948209380887e-02   +1.426304095014695e-01   +3.752540426038131e-03   +1.850691572956471e-02   +1.162295401539494e-01   +6.410929296676819e-02   +8.054085606277341e-02   +1.160581753620318e-02   +5.976817252717495e-03   +5.753395771986460e-02   +3.238971949279781e-02; +4.080285949945842e-02   +1.163557872486368e-02   -1.774362133820553e-03   -2.241285696655603e-02   +6.341891579182674e-02   +9.735323047676481e-02   -8.213424611173033e-04   +5.435739859511027e-02   -3.481869286289652e-02   +8.197870871335353e-02   +8.673687894310970e-02   +2.733384940371602e-02   +4.803410693119066e-02   +1.540270557362483e-01   +1.194227073014430e-03   +7.328870549797803e-02; +1.107096307620181e-02   -1.003599373430464e-02   -5.591604298308865e-02   +3.743475999326183e-02   +2.294408040723928e-02   +1.122880406665800e-01   -1.091925670521562e-04   -4.550332048765234e-02   -3.410147087998729e-02   +1.340912564493180e-01   +1.310379362728923e-02   -3.161471314998495e-02   +1.007728897355068e-03   +7.337977194495698e-02   +1.263532925383669e-01   -7.041102384603240e-02];
L2I_L1I_iGABA_netcon = [-1.301009121601213e-02   +5.474338017973625e-02   +1.507087471915343e-01   +3.565680762450987e-02   -5.345891675330861e-02   +3.209163074141226e-02   +5.443226434981101e-02   +9.589034534139650e-02; +1.111003879321293e-01   +9.770395485231219e-02   +1.810607761880518e-02   -1.816762184079349e-02   +4.114174378601382e-02   +1.403052420095580e-01   +6.293288780791094e-02   +5.678894450482766e-02; +3.706776597217058e-02   +4.436304342882272e-02   +2.769098463929041e-02   +5.876730004531745e-02   +4.140818853928241e-02   +4.700935199354196e-02   +6.991689447954877e-02   +5.522099385854377e-02; +2.264912747520027e-02   +5.090738668508602e-02   +7.464923853161851e-02   -3.031215598746823e-02   +7.600419352748540e-02   +1.203626730164954e-01   +9.170299791330926e-02   +1.103149692967231e-01; +8.020264053881522e-03   +6.036906266630229e-02   +1.355306977899440e-01   +3.631234716860744e-02   +2.125447874590985e-02   +1.424454157328682e-01   +7.019105571102542e-02   +6.312353395459111e-02; +8.752098455213037e-02   +5.809654093833169e-02   +1.653005344122687e-01   +1.432547654904702e-01   +1.092480068665603e-01   +7.773777177961062e-02   -4.374734763315680e-03   +9.482151841856437e-02; +2.036653286639294e-01   +4.625735769357292e-04   +9.584000610068652e-02   +9.681737970904984e-03   +3.021097820847801e-02   +1.649890259152292e-01   +6.022547694218148e-03   +9.718906223568581e-02; +7.048815962024026e-02   +1.226388694176349e-01   +5.944384358942852e-02   +8.963311293209222e-02   +1.553078341213741e-01   +3.659252949132219e-04   +6.950099066480706e-02   +6.120863951429821e-02; +6.636885776847870e-02   +4.068521420069958e-02   +1.918740032676949e-01   +6.966427991884347e-02   +5.424706578769373e-02   +3.077544562221628e-02   +1.740123153381090e-02   +1.416227790641280e-01; +4.718837921638510e-02   +2.229473003358479e-02   +3.825207231856458e-02   +6.078156660818784e-02   +8.737266275581880e-02   +7.532883906254523e-02   +3.720482697553261e-02   +2.167921025106941e-02; +4.853911103949352e-02   -3.295427601814029e-02   +7.502336604730220e-02   +2.353642932208865e-02   +1.034934167959651e-01   +6.657340887291668e-02   +1.681858577649497e-01   +4.016932024766106e-02; -3.646124941467183e-02   +1.403846245807235e-01   -2.089949964053467e-02   +2.523834988907764e-02   +4.008673622209125e-02   -4.046708828293080e-03   +1.233301925852287e-01   +7.814087472938865e-02; -2.131918405419354e-02   -2.110507548488254e-02   -1.003586138733378e-02   +3.885812437833686e-02   +6.106804561934320e-02   +2.270377728510108e-02   +9.917060043210005e-02   -4.582462094325092e-02; +1.673247227565321e-02   +1.281285497622758e-01   -1.732130913670856e-02   -3.165908077196221e-02   +6.330318118689406e-02   +5.441419482337953e-02   +7.883177012755245e-02   +7.414152373816599e-02; -8.141623625176659e-03   +3.665517294988124e-02   +1.564468118380524e-02   +1.094320905578744e-01   +6.782817327146762e-02   +4.812508171487688e-02   +3.795941127252414e-03   +4.597952639608000e-02; +1.591337169862908e-01   +3.023840614828626e-02   +7.057680939692168e-03   +1.141993497350907e-01   +2.085993626201931e-01   +1.532450982571318e-01   +2.760373353406547e-02   +7.386172743076710e-02];
L1I_L2I_iGABA_netcon = [+1.116620096991292e-01   +1.140104194907032e-01   -6.752820785349771e-02   +8.002678527704317e-02   +4.952298584787844e-02   +1.524160452021943e-02   +3.062187464399208e-04   +7.153781633619566e-02   -1.886172100768783e-02   +1.283479532852189e-01   +7.897238232315781e-02   +9.450243660376714e-02   -8.330205958165018e-02   +1.441727030107474e-01   -3.654869347874817e-03   -5.965098733499481e-02; +1.375197019687202e-01   +1.425382180641253e-01   +5.640419791372095e-02   +1.299824724567289e-01   +6.554332207196138e-02   +4.589791284264076e-02   +6.879220066813168e-03   +1.440028691848491e-01   +6.290455141036982e-02   +1.251496651470352e-01   -1.018688959501932e-02   +3.303251431856629e-02   +9.535485747354208e-02   +9.829869932914607e-02   +9.395876514479509e-02   -2.281981517127733e-03; +6.452098262838260e-02   +7.480000261903058e-02   -8.574523434369721e-03   -3.274668205152786e-02   +1.268472578192366e-01   +1.508269685248214e-01   +6.401324552024922e-02   +1.039474047919157e-01   +4.579409387923598e-02   +4.366231682355276e-02   -2.171864170825938e-02   +4.552937883116945e-02   +4.775656191871989e-02   +1.209389701472918e-01   +5.704049550069230e-02   +4.784581432272776e-02; +2.211972127967213e-03   +1.450805434046391e-01   +9.421258427968571e-02   +1.031901378178913e-01   -7.901426107862944e-03   +1.660777111512744e-01   +6.623715275190024e-02   +1.366928474427492e-02   +9.527119863005427e-02   +2.376616331612899e-02   +2.190531236753814e-01   -2.729171675858432e-02   +1.449684025506005e-02   +1.137395338407557e-01   +3.829022068044786e-03   +5.011369303222273e-02; +3.341313916244337e-02   -6.204919106314170e-02   +6.539043525629576e-02   +8.654341154094439e-02   -5.485023272718721e-02   +7.107630406007753e-02   +1.045338158818159e-01   -1.309146840001988e-02   +6.535595109607682e-02   -2.661793856978882e-02   +2.274972408589682e-02   +9.330894472023468e-03   +4.743024692053413e-02   -6.638564176755818e-03   -3.166603831605689e-02   -9.940101352687743e-03; -1.309025492980515e-02   +1.687873660967456e-02   +2.637327259826913e-02   +4.505647376555420e-02   +7.805903846561263e-02   +8.245176579149893e-02   -6.873700205111881e-02   +8.470823271465977e-02   +1.203325029766034e-01   -2.648927074491072e-02   -4.789610699317361e-02   +7.154951649213113e-02   +9.270348844861369e-02   +7.554262917393144e-02   +1.178046566534236e-01   +3.241345514365927e-02; +1.340953292284595e-01   +7.226250391986905e-02   +2.732772238850045e-02   -9.983326410409545e-02   -2.397409177001205e-02   +1.300881946198643e-02   -3.816611729741659e-02   +5.862567153127800e-02   +5.717181831476004e-02   -3.474935364941459e-02   +9.739964325438408e-02   +3.624242616163510e-02   +7.256563617483183e-02   -3.002818463628314e-03   +8.495113309035598e-02   +3.893848708978339e-02; +1.024395493912570e-01   +8.721902534760573e-02   -4.296882761967080e-02   +1.157603800008640e-01   +1.207766522951617e-01   +6.095561893059208e-02   +3.852019845997782e-02   +9.265032109946313e-02   +1.072958375594987e-01   +2.229830639631702e-02   +7.614227191309489e-02   +1.103877466819935e-01   +1.029408011765876e-01   +5.695624131861314e-02   +6.709511490264439e-02   +7.878203433925191e-03];
L2E_L1E_iAMPA_netcon = [+1.269998925857281e-02   +1.179342169172895e-01   +1.481872787669652e-01   +1.500316181488492e-02   +6.658392713588530e-02   +6.661224245445060e-02   +5.473482177789978e-02   -7.369810267660440e-02; -3.465486972113827e-02   -1.088947424284871e-02   -1.292239596389069e-02   +1.307682596813005e-01   +7.921142326514770e-02   -5.129710258672365e-02   +1.336448454171553e-01   +1.028073492865211e-01; +2.588624048315157e-02   +1.483901167683926e-02   +1.203641117634896e-01   +2.545273471362638e-02   +2.972004700135204e-02   +1.239513079932267e-01   +6.022480447960692e-02   +6.522812005942000e-03; +2.127730415116792e-02   +3.245162469393964e-02   +1.255013163025524e-01   +4.420991169247698e-04   +1.626114852092772e-01   -1.874794726145798e-02   +1.402686603173506e-01   +3.412451832075141e-02; +1.745921521313420e-01   +6.661909926045941e-02   +6.374468229186928e-02   +1.227308480191776e-01   -8.741134865629580e-02   +1.449645066559153e-02   +7.153966723156668e-02   +1.465727515198786e-01; +1.150688997569920e-01   +1.282846770426329e-01   +6.137596919466096e-02   +3.684538541794125e-02   +1.582738365509008e-02   +2.908179506618806e-02   +1.615933396367742e-02   +2.386903481103184e-02; +7.749916757568684e-02   +9.924915517257299e-03   +3.337648264454129e-02   +8.671128295859960e-02   +2.533895158330988e-02   +1.914192258005123e-01   +2.133134268884690e-01   +4.267821181214688e-02; +7.827649119230001e-02   +2.810438234222751e-03   -3.333966630685552e-02   +1.113686890695874e-01   +4.024234414054013e-02   +6.043536718059508e-02   +4.492290644962931e-02   -3.469953150197193e-03; +1.676706409813260e-01   +1.179102021827315e-02   +1.540150205897915e-01   +7.032233302491434e-02   -7.558329899026946e-03   +3.620509851416702e-03   +3.763305648566850e-02   +1.338348052455577e-01; +2.635244722145207e-02   +1.854396562336971e-02   +6.130538566048567e-02   +6.467011033028118e-03   +1.674958067874899e-01   +5.342848325482010e-02   +5.137368511499492e-02   +2.644297714682948e-02; +7.057677742389792e-02   +1.519235847153937e-01   +1.740181787900231e-02   +5.763947501495309e-02   +2.141750054776070e-01   +5.207667187619482e-02   -1.117284824211201e-02   -5.581836475815526e-03; +1.195773118572162e-01   +6.979667037844182e-02   +5.554520449560499e-02   +1.222052350910383e-01   +1.037148132819444e-04   -2.178728435324883e-02   +1.427872808429835e-01   +5.527234107017948e-02; +1.156983397787093e-01   +7.644710609263883e-02   +3.343717123073044e-02   +2.607463152988228e-02   +1.307560267606367e-01   +1.647795887981477e-04   +1.439391176215781e-01   +1.366253340387429e-02; +1.437144639834876e-01   +1.095627119626282e-01   +7.510994085914519e-02   +1.829410835024935e-03   +2.280285209028644e-02   +1.438542779115157e-01   +1.061022695383087e-01   +1.238658357010910e-01; -6.991407361258069e-02   +1.631476186280765e-01   -1.268856263149376e-04   +6.812048214729047e-02   +1.447448606440678e-02   +1.788620194429706e-01   -3.383948078788015e-02   +9.794959790911351e-02; +1.170186067321721e-02   +7.594542866065027e-02   +1.282437316979726e-02   +8.148365827285171e-02   +7.222458572689663e-02   +2.269652540501259e-02   +6.749309247213552e-02   +3.227336048809281e-02];
L1E_L2E_iAMPA_netcon = [+8.741338601539722e-02   +6.217901958929524e-02   +8.810391413537781e-02   -4.459178163687250e-02   +1.047345912041449e-01   +9.556115203901494e-02   +1.045478177440807e-01   +2.227362921539366e-01   +4.121698799160940e-02   +7.755104394796120e-02   -8.134474923752438e-03   +2.513537926967228e-02   +8.856511191150415e-02   +5.298456535678187e-02   +1.161661772159664e-01   +3.356807223986092e-02; +1.087090802966046e-01   +1.672718494863548e-01   +7.722414981670143e-02   +1.494395084741241e-01   +1.385789545584192e-02   +6.313819421241562e-02   +1.222221001663998e-01   +2.068203132366388e-02   +2.829390662840487e-02   +1.795383365890221e-02   +7.256660765341202e-02   +1.315168461602473e-01   -4.590460798465654e-02   +2.390144802043243e-02   +8.730939982238049e-02   +7.294364438823533e-02; -2.876654711818627e-02   +1.431700411067035e-01   -3.991128793343381e-02   +5.903223857974860e-02   -2.901583085525010e-02   +6.831944722733423e-02   -8.016793181300363e-02   +1.724851215770659e-01   -4.907524566240254e-02   +1.054170654025191e-01   +7.483797152533600e-02   -5.249614169774834e-02   +5.719656933964912e-02   +8.376077782903714e-02   +1.100100990537402e-01   +1.415613487548006e-01; +7.171635061941582e-02   -1.330116542196354e-02   +4.359667522547380e-02   +6.566259878531162e-04   +7.852818592075264e-02   -2.447835068731924e-02   +3.490630262601850e-02   +1.514339005672991e-01   +2.449992066120860e-02   +9.429040956867341e-02   +6.304650284147247e-02   +6.528710322194545e-02   +1.528492126544155e-01   +5.920961497430434e-02   -1.205018350626178e-02   -1.765228006641394e-02; +1.544891456252848e-02   -1.929651788946436e-02   +6.963521485406424e-02   +1.286140359363793e-01   +1.204885032347505e-01   +1.766083583807310e-02   -1.213617934210372e-02   +1.335408126360410e-01   +8.281441783248905e-02   +3.405111574183891e-02   +2.517963166223242e-02   +1.547443551086170e-01   +1.353476132562652e-01   -1.629104023685193e-02   -4.134095639521121e-03   +1.282863932283306e-01; +4.099903431102483e-02   +9.260592595970038e-02   -8.648281174609168e-03   +1.786859339573085e-01   +3.479756220023310e-02   +1.563898927681980e-02   +1.124229525096303e-01   +3.259091683757798e-02   +1.205194061967162e-02   +9.407120655288860e-02   -9.299250255835527e-03   +4.412275267774486e-02   +1.074723505007406e-02   +7.365825767656685e-02   +6.005893874226773e-02   +2.106776772306838e-02; +1.557794779508924e-01   +4.182843192870916e-02   -7.588773328778524e-03   -1.166441768351099e-01   +1.069111508737474e-01   +1.805410683357441e-01   +2.324317978553411e-02   -4.678842629558996e-02   +2.121720506513091e-03   +5.008127309660505e-02   +1.374305100547074e-01   -1.844190085084024e-02   +2.227882464981930e-02   -3.102916913121809e-02   +5.915597035004447e-02   +4.846129376203553e-02; +1.484285444784520e-02   +4.527843752762247e-02   +6.287629167939168e-02   +3.166200005513772e-02   +3.795811975784115e-02   +1.291197053715200e-01   +5.888402430405743e-02   -7.358889633598061e-02   +8.019456663524634e-02   +8.738316435404903e-04   +1.011026892525491e-01   +6.862261980417113e-02   +1.124575944746165e-01   +1.173387438606762e-01   +5.984449691741346e-02   +1.342721307683553e-01];
L2I_L2E_iAMPA_netcon = [+1.271817472105789e-01   +4.939327405203479e-02   +7.399619793471149e-02   +3.493138255914490e-02   +1.672594002580982e-01   +1.715664319330411e-04   +5.128157867822988e-02   +2.942020105645280e-02; +1.494770448689912e-01   +7.997773372894521e-02   -1.170643124339489e-02   +9.921425636153919e-02   +6.483225811703902e-02   -3.692658527357295e-02   +7.660961951536105e-02   +4.104225673407849e-02; +1.224993690273745e-01   +1.971471696345371e-02   +3.430715835264993e-02   +1.636828204980202e-02   +6.475718744116876e-02   +1.444962814422500e-01   +1.347741738369034e-01   +9.418800077535654e-02; +6.520821933549990e-03   +1.157643253150866e-01   -7.097542058024157e-02   +6.835417125867776e-02   +8.829444392127897e-02   +9.225942209312270e-02   +3.771843311947391e-02   +4.240822594528278e-02; +9.917583739767682e-02   +3.182396063570445e-02   +7.787143153320632e-02   +2.122710577785938e-02   +4.813417641746574e-02   +8.125572471536924e-02   +3.645204774899749e-02   +8.811264714281535e-02; +1.087672369209689e-01   +9.280291348171604e-02   +3.586511360193538e-02   +1.187039298171354e-01   +1.237154935974142e-01   +1.623476139884533e-01   +7.715761817625121e-02   +4.488421316925895e-03; +9.524583339423376e-02   +4.156770862865444e-02   +1.459957572306653e-01   +1.026846333231490e-01   +4.418270044931020e-02   +4.143805142367765e-02   +1.220785170605941e-01   -8.286098694729668e-03; +1.592699419136755e-01   +1.432532933905406e-01   +6.213163372441818e-02   +3.300037925046643e-02   -3.509755952785705e-02   -5.751643597289261e-02   +9.988095853807076e-03   +1.441725315731877e-01];
L2E_L2I_iGABA_netcon = [+1.770597531803028e-01   +8.601474191135806e-03   +1.564179578288739e-01   +1.530960427104284e-01   -7.292460273832858e-02   +1.339230338834667e-01   +7.351019788385638e-02   +1.512838113899300e-02; +1.066998635111927e-01   +1.140096032054427e-01   +5.415364347970451e-02   +9.276072367908562e-02   +1.303549568379347e-01   +3.787518797289713e-02   -2.060249580183921e-02   -8.564173048491966e-02; +6.657941720170765e-02   +9.089225372915179e-02   +1.604265074987647e-02   +8.153057026733802e-02   +1.639163428601547e-01   -1.541672951323595e-02   +3.873182710730730e-02   +4.675608059293407e-02; -9.705825499908791e-02   +1.430412716765181e-01   +2.255803570469195e-02   +2.773819295896554e-02   +9.280796205566748e-02   +1.896186968140907e-02   +1.102468919758576e-01   +5.837595613271803e-02; +2.231655134127809e-02   +7.769164675314789e-02   +1.108337854629895e-01   +2.665457603661823e-02   +7.153581984437299e-02   +8.690721161189578e-02   +5.929293690484094e-02   +1.286137496837788e-01; -3.876742492220170e-03   +5.562054789311097e-02   +1.360423536511243e-01   +7.016802663032096e-02   +5.197397289435740e-02   +6.755271803715737e-02   +1.231006147162919e-01   +9.560104979076001e-02; +1.998521961212927e-01   -2.517206132614531e-02   +4.968659234065208e-02   +7.901720524108516e-02   +6.974087980673263e-02   -2.884061638521850e-02   +7.958339854460841e-02   +5.562809140613498e-02; -3.591773214619286e-02   -6.688552284973938e-02   +1.173686809071729e-01   +1.094991939965364e-01   +3.341960606782188e-02   +2.939501720189470e-02   -5.510220790126896e-02   +5.154663552898855e-03];
L3E_L2E_iAMPA_netcon = [+9.849591270536925e-02   +1.649003986893179e-01   +1.152641227087884e-01   +1.380969551795017e-02   +1.785288376836335e-01   +9.323136762657885e-02   +1.599959018788167e-01   +7.090257634852268e-02   +5.099882432238726e-02   -6.476293966956673e-02   +1.381371473592314e-03   +1.833109020244032e-02; +4.101070309863557e-02   +6.495029166400185e-03   -9.334331386841673e-03   +2.526984270955318e-02   +8.159321613650722e-02   -1.449718026165778e-02   +5.552611883895873e-02   -3.839916366314786e-02   +2.163692428883281e-03   +4.059137725479461e-02   +4.598113733626215e-02   +2.048217668855914e-02; +3.567152021271415e-02   +1.692763998528572e-02   +3.061863409136656e-02   -1.692090241691741e-02   +1.525098282508600e-02   +9.679518885818114e-02   +1.183445764068397e-01   +4.308735554856954e-02   -3.087295628537781e-03   +2.707172801404102e-02   +1.379098740854240e-01   +1.259100089636589e-02; +5.496738615846442e-02   +1.497115215879981e-01   +7.163127640296199e-02   +1.342967161777632e-01   +1.133088318601512e-01   +4.180750595645600e-02   +1.254057456845206e-02   +1.088663715182392e-01   +1.103067297838956e-01   +7.274340211053211e-02   +1.177876246179505e-01   +2.986696881823362e-02; +1.056863811715707e-01   +2.897376421365464e-02   +8.486481691688734e-02   +1.050981210003478e-01   -1.985129588824179e-03   +1.104522494222498e-01   +1.526285728169169e-02   -5.514359052878985e-02   +1.873096761261854e-02   +9.586806862006209e-02   +6.705459216125731e-02   +1.977217039878466e-02; -2.580482321306383e-03   +1.113506758897643e-01   +8.839059336733294e-03   +1.365179382004274e-01   +8.098280001784527e-02   -1.328054676151706e-02   +3.299906083940626e-02   +7.213232351859100e-02   +9.770280197412484e-02   +4.422615355233937e-02   +1.310963540649560e-01   -5.445284593104877e-02; +1.358851423662640e-01   +5.021403428364961e-02   +2.741417922508642e-02   -1.864749810808931e-02   +6.309036138115126e-02   -1.118091009096080e-02   -4.042663085525860e-02   +8.565839893646368e-02   +1.469405202696960e-01   +5.737263606726198e-02   +6.750951481490576e-02   +1.081760130496992e-01; +3.920279727313760e-02   +1.121300838650713e-01   +9.312362636083121e-02   +5.864113007276504e-02   +2.282390334642714e-02   +8.028723804145256e-02   +7.791067473948407e-02   +9.182321767113946e-02   +7.375374491203401e-02   +9.159806749661048e-02   +1.406637167429825e-02   +5.397127391572398e-02];
L3I_L2I_iGABA_netcon = [+4.631047843833105e-02   +8.938312637152336e-02   +3.596237256039484e-02   +7.556221368376269e-02   +1.167219086656197e-01   +5.446477431029949e-02   +9.860152486473374e-02   -3.545566645214217e-02   -1.530104664833590e-02   +1.211648452949127e-01   +5.666871448285174e-02   +6.491279308731143e-02; +1.144615897894779e-01   +1.100113995415169e-02   +8.722295079881498e-02   -1.252618133939162e-03   +4.731910370026240e-02   +9.367556501905386e-02   +4.180010693708915e-02   -3.748496574746370e-02   +2.914940515054088e-02   +5.732683022673762e-02   +1.161070974608061e-01   +5.745385714079006e-02; -1.510956528737153e-02   +8.301003068398269e-02   +9.214701271629124e-02   -2.620020857188255e-02   +1.321577972936695e-01   -9.063432740264754e-02   +7.246421310411109e-03   +1.080591059471467e-01   +2.126058902084423e-02   +4.876774042235554e-02   +9.492444864008207e-02   +1.213255126346678e-01; +6.669318673490804e-02   +2.692701493563256e-02   +7.992568465502248e-02   +3.344481639297719e-02   +1.112121114795135e-02   +1.103179676748189e-01   +4.637035310236922e-02   +3.018961684236522e-03   +5.703929557027125e-02   +7.866937273401792e-03   +1.083063056966985e-02   -3.223682049433869e-02; +5.741248653688271e-02   +4.509087315417236e-02   -4.359790977582684e-02   +1.093283065775332e-01   -2.124396328391532e-02   +4.744465988483014e-02   +1.159077585796650e-01   -1.502619295872243e-02   +1.881090102546975e-01   -1.335763977996627e-02   +2.549865383641985e-02   +8.943698058188333e-03; -7.981811508369374e-02   -3.776210529756786e-02   +1.075966786010764e-01   +1.375120245924489e-01   +3.086635387607470e-02   +5.368897072364815e-02   +5.920336548596130e-02   -1.674040759566782e-02   +1.352934093081773e-01   +1.150382228317462e-01   +8.637653470827862e-02   +5.020768532577137e-02; +1.425080975502606e-01   -8.071890056791539e-02   +4.901124680806291e-02   +9.749195513366193e-02   +9.395305285977079e-02   +1.544950698395861e-02   +7.295037577702482e-02   +1.020773458307171e-01   +3.176827211762551e-02   -2.333069819527939e-02   +1.560660852839165e-01   +8.248486673837221e-02; +1.204935437749659e-01   +6.688772362171672e-02   +6.024588218888137e-02   +4.717843229966528e-02   -2.775340348522864e-02   -8.068052214568716e-03   -2.539487635352661e-02   +4.232449631062480e-02   -1.089452362682447e-02   -1.179911670383656e-01   +1.791354863504754e-02   +6.287803791424974e-02];
L2E_L3E_iAMPA_netcon = [+5.035296254502857e-02   +4.150545292973103e-02   +5.906149928944641e-02   -6.788057079838203e-02   +6.309253535700907e-02   +1.180751182332686e-01   +6.019864995134504e-02   -6.149389923750787e-02; +2.054314124660443e-02   +1.061389910424959e-01   +7.092611147706193e-02   -2.656362645176215e-02   +1.486101964714618e-01   +3.837388780463266e-02   +3.099416084218735e-02   +5.220372405348391e-02; +1.394277062397550e-01   +1.217583616664978e-01   +6.368114427579491e-02   -3.230696513383996e-02   -4.412609313698251e-02   +5.680980859581219e-02   +4.944270280186576e-02   +7.804822572248096e-02; +5.931833161255656e-02   +8.629184015270613e-02   -1.107384131791747e-02   +5.900530237989353e-02   -7.321316136667828e-04   +3.613549331194445e-02   +1.270416219289543e-02   +1.642332184951756e-01; +5.530752033097098e-02   -2.144357961108876e-03   +2.331876762789595e-02   -4.279074557344406e-02   +8.508754255397710e-02   +1.202691846119925e-01   +1.042467974461910e-01   +1.354986416166002e-01; +9.208601337732350e-02   +6.580582493746964e-02   +1.042229572344792e-01   +5.716427343970157e-02   +2.468078314887591e-02   -1.804064988958860e-03   +1.033422300325542e-01   +3.459862630672571e-02; +3.847085285721983e-02   +3.875846517379261e-02   +6.316729606991511e-02   -1.229567413839497e-02   +8.761461590726390e-03   +7.017790274573943e-03   -2.836124180310789e-03   +6.709017346472224e-02; +1.006400363673025e-01   +3.063777534527893e-02   -1.495582480826962e-02   +4.893817219510452e-02   +4.892871258524138e-03   +1.487447138788754e-03   +1.206663786663208e-02   +9.934874495069496e-02; +1.817884038391533e-01   +4.002393902002711e-02   +2.160388897402522e-02   +5.284436636869820e-02   +9.004075001660346e-02   +7.006368750747163e-02   +1.711146335210637e-01   -4.417061036573221e-02; +4.398131396353985e-02   +9.623620435172689e-02   +4.169529338866391e-02   +2.703138500013218e-02   +1.222199225440543e-01   -2.721340835775930e-04   +5.606512618432272e-02   +8.871638898115317e-02; +2.590603429751434e-02   +1.954734966086542e-02   -2.659532461250330e-02   -4.354805394205328e-03   -9.445363055475969e-02   +1.335032903219273e-01   +1.476749512691096e-01   +1.681647954417080e-01; +8.826240593207174e-02   +7.491453222591624e-02   -2.175419270034044e-02   -2.666466052586507e-03   +5.248270052704729e-02   +1.136147912676325e-01   +1.503264176616594e-03   -6.756506528397110e-02];
L2I_L3I_iGABA_netcon = [-1.501277539572022e-02   +4.244760942980697e-02   +8.367287342634380e-02   +1.505149648063880e-01   +3.756901994282562e-02   -9.146648255114444e-03   -3.360824364882088e-03   +1.170649648491283e-02; +1.092798918408138e-01   +1.121572290850712e-01   +9.952146153492970e-03   +7.319523923737001e-02   +1.684785389712979e-01   +8.507849495690689e-02   -5.198821123333054e-02   +5.531285988200488e-02; +1.151004983053587e-01   +5.330748768918470e-02   -6.353162917761183e-02   -2.517982729962919e-02   +8.283257512841002e-02   +1.116576858036688e-01   +3.899063784339685e-02   +7.532879178723965e-02; -2.028183240112856e-02   +6.012272095846042e-02   +1.620149626873248e-01   +1.401801598696341e-01   -4.048663800398889e-02   +1.323872967050370e-01   +5.892467545344694e-02   +1.151387264616076e-01; -1.773121600828078e-02   +7.960835771692014e-02   -3.651266294090066e-02   -2.205254124203908e-02   +7.771447513397992e-02   +5.337766172793935e-02   -1.595963276479189e-02   +3.002957526114685e-02; +1.901161055255705e-02   +1.244319093606640e-01   +1.494485903616235e-01   -2.530848241050945e-02   -7.942541040192451e-03   +6.029508640305904e-02   -6.171541451047463e-02   +1.153571532009446e-01; -1.671342481911315e-02   +8.948281312366745e-02   +7.576199485004348e-02   +6.564134663762511e-02   +5.234838775211655e-02   +8.463158180838708e-02   +2.059942342189076e-02   +4.771848083571929e-02; +1.134212587872583e-01   +3.740080315265962e-02   +1.495818681601177e-02   +8.451758690746122e-02   +6.069856327571062e-02   +3.236834036371128e-02   -5.259876539719884e-03   +4.097618279167982e-02; +1.149890130676256e-01   -4.441051784002568e-02   +8.332054257774521e-02   +3.904216548129637e-02   +3.000978837780255e-02   +3.022010382917479e-02   -1.725802924709281e-02   +1.228711739009789e-01; +9.644703094290187e-02   +4.581660513807848e-02   +1.536577173271050e-01   +6.048574501289709e-02   +8.614010111688516e-02   +1.582095433007694e-01   +9.396157185474104e-02   +5.680886278626876e-02; +1.072142481313120e-01   -5.361145825101099e-02   +6.612420401904648e-02   +7.846563679424204e-02   +2.731155820958524e-02   -1.118790602401962e-02   -3.841673010698479e-02   +5.436203419235798e-02; +1.567173892082649e-01   +3.300303349045823e-02   -1.847747162162896e-02   +1.683609224929879e-02   +2.370971296616154e-02   +3.776984824201633e-02   +1.596852289577181e-01   +9.893623214807701e-02];
L3I_L3E_iAMPA_netcon = [+6.094771078551744e-02   +1.321708317821467e-01   +3.435797088176726e-02   -2.421252311980551e-02   +6.559598791020443e-02   +9.550161526280913e-02   +1.071567338684317e-01   +1.278270072591941e-01   +9.994177450392298e-02   +4.030314138716369e-02   -2.714956523913344e-02   -9.379538747592356e-03; +2.884400652877343e-02   -1.041458259364173e-02   +2.781029966129223e-02   +3.331657900446063e-02   +8.472097588765345e-02   +4.931614515354316e-03   +4.516730539461496e-02   +4.143147006373984e-02   +4.366637299872549e-02   -8.016456907914485e-04   +1.249372113831928e-01   +1.391326265184605e-02; +6.244204701253196e-02   +9.666711652885721e-02   -1.982356196094197e-02   +8.368088229555419e-02   -2.544953888545215e-02   +1.187687723815035e-01   +1.117940560548857e-01   +1.230787573968761e-01   +6.677375265649160e-02   -4.167577868568485e-02   +1.079580520258209e-01   -8.560112734986525e-03; +6.125780956132275e-02   +5.431686708850438e-02   +1.226885197992482e-01   -2.120593691657294e-02   +1.748583580940830e-02   +8.748832804501255e-02   +6.629220322733670e-02   +1.287980627327951e-01   +2.926274406387806e-02   +5.879228185887986e-02   +3.010821787412769e-02   +1.500582363125210e-02; +1.512254950292764e-02   +6.128859747697764e-02   -4.150642507744824e-02   +7.361466040546033e-02   +2.834367219830762e-02   +6.340372880443172e-02   +1.233569140927740e-01   +8.796169983920331e-02   +1.354040024315667e-01   +5.711613990959000e-02   +5.086022204785474e-03   +9.625573829586455e-02; +7.544202069377859e-02   +2.740479083374758e-02   +8.151816372256403e-02   +1.138291306550683e-01   +8.316245268938215e-02   -5.211976010034058e-02   +1.044234352332649e-02   +1.188760441134997e-02   +3.221622677191453e-02   +5.615034072021929e-02   +2.337215644320948e-02   +2.141806405162140e-02; +8.275622046483151e-02   +1.361625351394395e-02   -6.040823561381198e-02   +3.392581173801044e-02   +1.331909055407588e-01   +5.118073691855227e-02   +7.467890419818242e-02   +4.875475317809745e-02   +6.163579262082906e-02   +1.216208402768808e-03   +8.221719496707017e-02   +3.097966919266970e-02; -3.459029697517529e-02   -2.165209949633792e-02   +9.347039411624614e-02   +8.948109332450384e-02   +6.226372464997545e-02   +1.171460096035248e-01   -5.300644696965448e-02   -9.218083833508015e-02   +1.467985293428015e-01   +9.940544258008008e-02   +8.995502930241385e-03   +2.801121005966183e-02; +1.148160993144870e-01   +4.481691517828855e-02   -5.743334414860918e-02   +6.897525376308673e-03   +1.510369837187084e-01   +3.160525384750952e-02   +1.094227854484152e-01   +8.585155509468866e-02   -1.711390025231406e-02   +8.420986561106296e-02   -1.029491910054250e-01   +9.974937223383126e-02; +2.765687628204193e-02   -8.102206619945237e-02   -5.636615130611918e-02   -2.687866630728879e-02   +1.177900536391274e-03   +8.567316547839073e-02   +8.609127211711093e-02   +2.629743464255983e-02   -1.146744106042688e-02   +4.971792724869019e-02   +6.135095722544558e-02   -1.722976665843492e-02; +1.068792715276888e-01   +8.666696937176471e-02   -1.813334101071913e-02   +7.039163641225238e-02   +1.130395437700412e-02   +4.898888622592253e-02   -1.307151488070621e-02   +9.560996942081754e-02   +6.964537390285999e-02   -1.647453831179164e-02   -1.282006875873691e-02   +7.030049967869552e-02; -6.953437911960017e-02   -1.254632403983585e-02   -4.395007223587212e-02   +3.096687739109288e-02   +3.122794223102871e-02   +1.001831618870376e-01   +5.639059062938029e-02   +1.522550330426917e-02   +3.470616224490919e-02   +7.413371107587517e-02   +3.085273654588028e-02   +5.150669382252995e-02];
L3E_L3I_iGABA_netcon = [+7.755708691078650e-02   -3.765996714785275e-02   +8.321334033733532e-02   +3.958801793877337e-03   +4.145518436511349e-03   +1.137404675158629e-01   -3.599719170529534e-02   -1.932115139218541e-02   +1.177843297766202e-02   +1.022215450309343e-01   +2.936311578153372e-02   +6.152863355918167e-02; +7.105496548415965e-02   -5.733593606394843e-03   -1.940256962935134e-02   -2.750326421025059e-02   +3.066922283846457e-02   +1.444724129392851e-01   +8.475404480256138e-02   +1.162791119917748e-01   +1.307424463129662e-01   +8.347433303248472e-02   +6.860801872496500e-02   +9.456919036255357e-02; +8.811005972442690e-02   +8.758263996840319e-02   +1.658921892206565e-01   +7.559979805355278e-02   +5.430346170710681e-02   -4.610157582522430e-02   -2.816615734920293e-02   +1.257047481903840e-01   +1.176235393362748e-01   +9.173665831448324e-02   -6.738373805629688e-02   +3.333785463682917e-02; +4.447332998055089e-02   +1.728771330312771e-01   +1.302832265300486e-01   +6.673560815907197e-02   +1.351152528585495e-01   +7.948195616999351e-02   +1.352097099553961e-01   +1.495588680552396e-02   +4.494126792419759e-02   +1.655368259443330e-02   +1.005695610517242e-01   +1.865658854046898e-02; -2.538117939316597e-02   +1.102431975258963e-01   +4.219641322674399e-02   -5.012199205992274e-03   +8.653067828040373e-02   +1.448545772603163e-01   -4.640930203561464e-02   +5.906450673542687e-03   +7.246668483626037e-02   +5.795654192924911e-02   +1.733305220516615e-01   -3.910337337752752e-02; +7.461471530011246e-02   -2.333890399590809e-02   +8.008293600346481e-02   +1.058151241218080e-01   +7.208794835834231e-02   +5.057777373954872e-02   -2.121160536434954e-02   +1.558911714033522e-01   -4.518518237231452e-02   -3.940390037706766e-02   +6.629909429685167e-02   -4.358059403949101e-03; +1.722631152355350e-01   -4.237912114844408e-04   +9.113036611891444e-02   +3.345431384886553e-02   +4.272378827758730e-02   +3.934156570958725e-02   +1.143985486325523e-01   +2.170950836070544e-02   -2.012751003124929e-02   +9.646943794407203e-02   +2.944053490258301e-02   +1.372347040289564e-01; +1.151408182005274e-01   +5.295827906828666e-02   +2.053530615653926e-02   +1.744546780647664e-02   +4.921956015515441e-02   +1.237803602168450e-01   -1.246158670552361e-03   +1.847164038924989e-02   +4.184363089973556e-02   +1.081174355276338e-01   +1.529997694030756e-01   +1.139516571473984e-02; -3.144647006354664e-02   +1.266248163178464e-01   +1.042223880556520e-02   +1.151258901198787e-01   -2.081367746794409e-02   +8.706575136735896e-02   -7.515718119774557e-02   -5.810971137133156e-02   +4.127514107025966e-02   +1.522863852184055e-01   +1.317903512455698e-01   -1.724915819196038e-02; +1.073579928093784e-01   +7.144586948252477e-02   +1.118250569486562e-01   +1.828308380743935e-02   -2.794045357455412e-03   +2.050229866625639e-02   +6.826405623658063e-02   +1.191535634122291e-01   +1.031531220219004e-01   +1.300293310342215e-01   -5.646026273192679e-03   +1.670053722955534e-01; +4.319385526692249e-02   +6.533287982880004e-02   +5.419017716272626e-02   +7.713095870850943e-02   +7.779158521536209e-02   +4.480188889968216e-02   +1.381164594319456e-02   +2.814903338802973e-02   -5.391304156738232e-02   -4.730714868958303e-02   +1.232599923010074e-01   -3.583535614513762e-02; +3.033302494667061e-02   +8.886467726675523e-02   +5.560445071025405e-02   +1.355054411874459e-01   +5.021322161456272e-02   +4.660932583542884e-02   +4.634200724185648e-02   +1.005488062558550e-01   +3.446554904464482e-02   +1.552542201315796e-01   -1.980217274547290e-02   +4.659078580698675e-02];
L2E_Input1_iAMPA_netcon = [+1.625071015918073e-01   -1.296827179138332e-02   +1.644574159176133e-02   +6.936077697224696e-02   +3.705094592757457e-02   +9.466345050164358e-02   +4.465440856440919e-03   +6.149551067490679e-02];
L2I_Input2_iAMPA_netcon = [+7.014150632396071e-02   +5.685577329540383e-02   +1.064620101640502e-01   -1.090113514059594e-03   +1.170434896068838e-01   +7.838272499270099e-02   +5.542284824788102e-02   +1.350371800788295e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
