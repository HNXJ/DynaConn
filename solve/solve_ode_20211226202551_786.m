function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.097219904530688e-01   +6.339942068480509e-02   +1.114816415907223e-01   -8.508878093502584e-02   -1.231315655123916e-01   -3.010840523832107e-01   +2.784857003830710e-01   -6.306412818495459e-02   -1.207371928907562e-01   +2.482347229259998e-01   -9.378106554326976e-02   +8.995030987045881e-02   +2.863126075866482e-01   +1.690632920656583e-01   -1.313726687638346e-01   +3.018157738745130e-02; -5.342314978751643e-04   -1.033598106581423e-01   -3.737767664455029e-01   +1.905237354916139e-01   -9.029053046389337e-03   +4.313367133281953e-02   +2.825207183993056e-01   -1.388248094733026e-01   +1.556573709521593e-02   -6.990221219687356e-02   -1.661796539136656e-01   -6.723777553700411e-02   -1.722747046855145e-01   -1.679221249501087e-01   +1.728606539556204e-02   -8.157027164504696e-02; +6.139872165707724e-02   -9.077417628776216e-02   -3.963080913146950e-02   +2.830910171267888e-01   +1.099013479133126e-01   +1.320293585091926e-01   +2.124000166122018e-01   -7.080352595351926e-02   +1.239817596808766e-02   +2.783259754522652e-01   +2.537682916698129e-01   +1.971243204917233e-01   +9.383238756986764e-02   +1.365395824696534e-01   -1.739602429666937e-01   -8.835985892401602e-02; -2.314326628727550e-01   +4.245541134152377e-01   +2.312898552757166e-01   -2.149968798803256e-02   -5.468168964074079e-02   +2.792619597140418e-01   +4.686017386678651e-02   +1.981580802081299e-01   +1.306082418499561e-01   -7.347666817444609e-02   +1.280027209736458e-01   +2.151181008522259e-01   -1.937793084511099e-02   +1.853312312693618e-01   +1.995495445027913e-01   -3.507361776419683e-02; +1.092568117335143e-01   +1.662783500075909e-01   -2.944648964679147e-01   -2.005396117735721e-01   -8.510129314276327e-03   -7.148871501790302e-02   -4.694245316649730e-03   +2.459040247982178e-01   -6.385427424980469e-02   +8.289739270466351e-02   +1.509573569060260e-01   -1.172236511590127e-01   +1.273761774257992e-02   +1.451719455311280e-02   -6.501146196810430e-02   +2.715224503473498e-01; +1.975395677543469e-01   -4.328974778270929e-02   -2.149621157109370e-01   -9.075730132782457e-02   +8.377509080264581e-02   +1.131883438998796e-01   +1.030938765875945e-01   +1.877115107896919e-01   +4.211034412724719e-01   +2.747090023599148e-01   -3.051851103753656e-01   -1.281868480986763e-01   +1.348799649038053e-01   -7.797769358995929e-02   -1.786961205991310e-01   -7.999094922565136e-02; +3.874803138007822e-01   +7.475928755471123e-02   +6.787679517640635e-02   +1.667646105904761e-01   -1.336588883143429e-01   +1.846548973108435e-01   -8.002365929397603e-02   -1.232442091773608e-01   -1.395729133683108e-01   -1.861243654168309e-01   +7.742984113769594e-02   +6.137791261164205e-03   -9.483399668578525e-02   -4.249761479725961e-02   +7.367605713091763e-02   +2.508178063863918e-01; -2.575025150289076e-01   +3.454728492483394e-01   +9.308671143013729e-02   -5.440265153616984e-02   -3.436156572940265e-02   +1.001476451391602e-01   -1.964895105159349e-01   -3.352015101374211e-01   +1.210520115174420e-01   +2.163037131638424e-01   +1.693620265518674e-02   +9.368906682292430e-02   +1.242182166272603e-01   -3.711222827566959e-01   +2.551768946399128e-01   +1.049891169066698e-01; -2.264202014120483e-01   -4.376489861235062e-02   +7.056636957363289e-03   +1.994651311554903e-01   -5.858787017080648e-02   -1.783575557937677e-01   +1.935287305396545e-01   -7.819162622756864e-03   -3.445389667313653e-03   -3.808059395828878e-01   +1.953778637954406e-01   -1.141209548553653e-01   -2.193282594496410e-01   -3.563287507598563e-01   +1.589212586481141e-03   +1.761112030568783e-01; -2.365587691533108e-01   +1.772708722627506e-01   -6.002964461231976e-02   +1.324155412510192e-01   +1.830510265930625e-01   -4.022040885702882e-01   +3.775367722965034e-01   -1.257357370963594e-01   -9.969886285637464e-02   +2.388618226363023e-01   +1.749725392251683e-01   +5.245560057609642e-02   -2.804559183315871e-01   +7.247455543279364e-02   +9.624313450139620e-02   +3.873493603896809e-02; -2.652653889401516e-01   -1.179741298433780e-01   +1.330926643571422e-01   +1.569159211596326e-01   -2.878130447468945e-01   -1.505908793247807e-01   +2.757205694169765e-02   +7.345925824292870e-02   -1.047567981766428e-01   -1.505126344368709e-01   +7.007745873516341e-02   -1.179938829779624e-01   +3.396910715183632e-01   +5.462210525439351e-02   +8.396775185885266e-02   +5.343563464436860e-02; -1.182784557436573e-01   -1.950346952168554e-01   +9.886433425395362e-02   -2.441130966511487e-01   -5.982624788987977e-02   -8.656141606040822e-02   +1.326354508139168e-01   -4.511978245824428e-02   +2.484970891198217e-01   -2.023596244006384e-01   -2.008312199973371e-01   -2.678710970414599e-01   -7.157903736172193e-03   -3.859837867045512e-02   +3.674517806831872e-02   -1.236361089021820e-01; +1.477043679123655e-02   +1.209574983749118e-01   +2.868775374981820e-01   +1.220819578351827e-01   +4.107448046884878e-02   +7.372485293946665e-02   +1.161123491819070e-01   -8.211252938498249e-02   -1.023340648336338e-01   +7.976615097989427e-02   +2.831525560650222e-05   -7.636625809510033e-03   +3.368691821350487e-03   -6.682504187553685e-04   -4.524192442227213e-02   +1.286160118149585e-01; -8.601649330477858e-02   +2.152980387422886e-01   +1.230596190041872e-01   +1.373359371868297e-01   +1.103702635869085e-01   -3.290143020082724e-01   +5.504938033146730e-02   +4.278745552941892e-02   -3.332390538213537e-01   -1.209707799467420e-02   -2.990782498870991e-02   -2.363109358872824e-01   -4.444715113532918e-02   +1.970964829392402e-02   -7.454125992786824e-02   +1.438685931716212e-01; +1.436732760276691e-02   -2.752155435816641e-02   +7.824243212365353e-02   +1.926210738564757e-01   +1.166602940222762e-01   -2.288137849419793e-02   +6.116950888401061e-02   +5.610027106416220e-02   +1.063757157842867e-01   -9.934635990702473e-02   -1.838973545643146e-01   -1.771319668614616e-01   +6.792482015395748e-02   -6.362258095544582e-02   -2.807723764237020e-01   -1.903973893634842e-01; -3.135088056467357e-01   -1.163450633394970e-02   +1.074540278368489e-01   -1.123749285965747e-01   -5.014670954553224e-02   -4.478241365832387e-02   +1.668396891478172e-01   -4.798238907893696e-01   +2.512678253724126e-01   -2.907646626248191e-01   -4.513127893623569e-01   +5.715773816739473e-02   -1.539872265334147e-01   -1.701081637524978e-02   -1.337721536555459e-01   -2.591108229338578e-01];
L1E_L1I_iGABA_netcon = [+1.661852568918427e-01   +1.341077642535213e-01   +8.788353264550528e-03   -2.563084673535774e-01   -6.432990610050388e-03   -3.242111286426907e-01   +3.569176032513801e-01   +2.633309454452318e-01   +2.992718819916183e-01   +2.985202219296181e-02   -5.866371593105492e-02   +2.652833913743236e-01   -1.014763558437220e-01   -1.172116056187166e-01   +4.807429069787851e-02   -3.366660394922324e-01; -3.081602497143559e-01   +6.418672890658796e-02   -7.366195102185831e-02   -5.094243023328170e-02   +2.639166584377605e-01   +2.085803064273752e-01   +6.351205618910033e-03   -4.584623036606311e-03   +2.576431907277996e-01   +6.553113124285945e-02   +1.194938079508186e-01   -1.883948990580305e-01   +3.207223519121370e-02   -2.098883780012040e-01   -4.003938616734907e-01   +9.792119572078044e-02; +2.246991566375963e-01   -2.728435649311695e-01   +1.239758735858593e-03   +8.972101613998346e-02   +1.870291291050944e-01   -3.105368385229655e-01   -2.539736881585068e-01   +4.419250771332156e-02   +1.687908934251761e-02   +1.935666673253621e-01   -3.141692400567346e-01   +1.726119222458808e-01   -1.124844681178059e-01   +7.681100084749383e-02   -1.763865649954991e-01   +1.261106188457162e-01; +1.431543391084457e-02   -1.512721692761815e-01   -2.781825460916155e-01   +9.897841325968590e-03   +2.509731617152233e-01   -9.233412567225657e-02   +7.561533254564620e-02   +6.824692249966326e-02   -5.821820104391785e-02   -3.344090473844865e-01   +1.110845265878057e-01   -4.256412518465382e-02   +2.345240899643498e-01   -2.988342842711179e-02   -1.970598589982550e-02   +3.104887185113983e-01; +3.241628622530595e-02   -1.020936795576326e-01   -3.181235904027579e-02   +8.740662915808527e-02   +1.562593227748151e-01   +1.233752767487405e-01   -5.399008802226656e-02   +9.912803690776686e-02   +3.262695980177725e-02   -4.002752340167195e-04   -1.068479446193426e-02   +2.509641218389566e-01   +6.679345362957313e-02   -4.919030271097383e-01   -1.455436676448690e-01   -9.966821143581855e-03; -1.802675655549929e-01   +1.140774409691769e-01   +5.404826078875014e-02   -1.260671063419548e-01   -7.459501418521604e-02   -9.943939681295987e-02   -1.429223650548535e-01   -1.708916919696873e-01   -5.186300863771310e-02   -2.495740992997742e-01   +3.291275693335809e-01   +1.772193171179569e-01   -1.203802876066917e-01   +1.406392147860125e-01   +3.516402655483075e-01   -4.886084526944284e-02; +2.108939812022172e-01   -1.397111512942432e-01   -3.557597087804574e-01   +2.733416474002351e-01   +8.546364722558132e-03   +6.376746116130301e-03   +4.134509825664937e-02   +1.885227161640217e-01   -1.339647693412739e-01   -9.080691467275991e-02   +2.491122433648849e-01   +3.689008328290665e-02   +3.151532539601436e-01   -2.725658425135188e-02   -2.927215816648464e-01   +3.533455850740091e-02; -1.949999448888279e-02   +1.080475376627490e-01   +5.155768568942479e-02   +2.225287351732863e-01   +1.058736126951314e-02   +1.339487133407705e-01   +1.659592286977696e-01   +1.093910875265424e-01   -3.105948304627246e-01   +2.138669895881452e-01   +7.565653218316248e-02   +3.724274245606625e-01   +9.916205710163398e-03   -3.979729619365167e-02   -9.808464274004855e-02   +1.454154381912641e-01; -6.614080441771607e-02   +7.060245643754989e-02   +3.444578529462058e-02   -3.148580297050731e-02   +8.266677984124386e-02   +2.284114747103966e-01   -9.894670350587083e-02   -1.740447963399915e-01   -5.488728121447809e-02   -8.846033553901185e-02   -1.754505550143320e-01   -1.985611634195642e-01   -5.823438089782078e-02   +1.172487427286184e-01   +6.999941762246652e-02   +2.410749267032285e-02; -1.545521203832474e-01   +1.278743427629209e-01   +1.440628377053531e-01   -2.710513603900684e-02   +7.221281459275589e-02   +2.836933867839062e-01   -2.135702670310740e-01   +4.875189339379330e-02   -3.856109783022528e-01   +1.835312940013662e-01   -3.570494140831906e-01   +2.668535929310339e-01   -3.893630830229807e-01   -2.856740248902894e-01   +5.932130348417305e-02   -3.581896377001720e-01; +9.931124544786014e-02   -9.077041349574398e-04   -5.862547927529876e-02   -8.592905017536956e-02   +3.115296230288956e-01   -4.976577426880335e-02   +5.153575381919165e-02   -1.726736259297016e-01   +5.934307204334263e-02   +4.580897813702108e-02   -1.859254425532527e-01   +1.071292510614087e-01   -4.792595461100052e-03   +2.833499826568214e-02   +1.782289130162773e-01   +5.541307157962798e-04; +9.366373276604598e-02   +2.499284575076176e-01   +3.261111549367601e-02   -2.298846061418496e-01   +3.828029750113272e-02   +4.332511815525929e-02   -2.150503504018429e-01   +3.560441896120046e-02   -1.542102708560709e-01   +1.042882689196940e-01   +1.042582328546244e-01   +3.598106789058820e-01   +2.776849181535549e-02   -3.185457035936028e-02   -2.186354609885894e-01   +1.545495400179994e-03; -1.911219652982767e-02   +1.146551652455929e-01   +2.914550326127276e-03   -1.032069604790470e-01   -4.748297147447914e-02   +1.397373094659684e-01   -1.642293934234682e-01   -9.867958877340963e-02   -4.722638142663302e-01   +5.931168069192324e-02   +1.795352824156866e-01   +2.328607333458503e-01   +4.056661507531072e-02   +1.769091542721725e-01   +1.418794952817637e-01   +1.814909605222804e-01; +1.620329515452408e-01   -1.389485877331811e-01   -6.256930690740076e-02   +1.647425667605502e-01   -6.982006209644173e-02   -1.611448252956124e-01   -2.099895193258306e-01   +3.664800612776136e-01   -1.436043267910565e-01   +1.765592665715917e-01   +1.008414944917245e-01   -1.578715123772611e-01   -1.277037220494977e-01   +8.519902831796908e-02   -8.426504548125395e-02   -1.098960186542851e-01; -7.104653302570552e-02   +8.409424927127207e-02   +3.685853816684205e-01   -1.348723110655642e-01   +2.042338319401128e-02   +1.924617567822277e-01   +3.343672143357485e-02   -1.078556775545722e-01   -3.568581032830344e-01   -9.488831113404321e-02   +5.327346953843737e-02   -2.469674702020048e-01   -1.508666779931135e-01   -1.856667985626601e-01   +1.472907315073979e-01   -7.848700810597256e-02; +1.622478506995541e-01   -2.039130162111669e-01   -3.256215572878247e-01   +7.885950674459807e-02   -1.022539013049818e-01   -1.954372725480509e-01   +9.147415599924257e-02   -2.251046510940791e-01   -2.192994368387152e-01   -6.503276123474537e-02   -2.196153963095872e-01   +1.756477345536241e-01   -1.952124261182554e-03   +3.567367289853720e-02   +2.413515635135311e-01   -5.711854364390644e-02];
L2I_L1I_iGABA_netcon = [+5.229477376037496e-01   -2.232882649884747e-02   +2.308374071249253e-01   -1.213593177310076e-01   +2.366624381838248e-01   -1.690956415667801e-01   -7.889929711220374e-02   +8.160846571084543e-02; -2.018076165398177e-01   +9.679636033010078e-02   -1.253908008530620e-01   +1.353603685689198e-01   -7.127946183561568e-02   +8.887935446120337e-02   +1.733215432132045e-01   +2.406110038593265e-02; -9.347811163670772e-02   +2.532544221309049e-01   -1.170529328587171e-01   -9.635358894505947e-02   -1.669666407119111e-01   -1.644224845528842e-01   -2.089595287381937e-02   -1.853962701285645e-01; -3.611978958104652e-01   -4.392212095696967e-02   +9.930891865370392e-02   -2.425232473916644e-04   +3.299023736576446e-02   +7.008200820809168e-02   +1.729846146030059e-01   -1.563990209257859e-01; -1.101717517306792e-01   +3.237975262657042e-04   +2.654964604303642e-01   +5.361213008483250e-02   -2.024830982731891e-01   -4.932857012553570e-02   -9.330125303286946e-02   +4.337535254769436e-01; +1.812023054647273e-01   -1.665471228631791e-01   +2.238948600512697e-01   +7.313419398384761e-02   -4.827940212049585e-02   -2.326260365939429e-01   +4.866373651337945e-02   -7.994647754445114e-02; +2.082581616313834e-01   +5.911749361859851e-03   +1.150338650328366e-01   -3.814901637514893e-01   +1.770857059063646e-01   +7.572820663726904e-02   -1.359480625282312e-02   -8.875024291224987e-02; -4.149867682801849e-01   +1.485344469183762e-01   +2.130618821893153e-02   +2.386286941948804e-01   -2.211658071793748e-01   -5.292145940916960e-02   -6.602700211369339e-02   +2.451071255347971e-02; +9.340735426343658e-02   -2.276631499893014e-01   -1.362040271928211e-01   +2.916280255678298e-02   -4.107641099657032e-02   -2.388929482061171e-03   -1.485639677571505e-01   -8.204591001546543e-03; +1.906864957362396e-01   +1.159323561042766e-01   -2.556355009801948e-01   +8.843686859240008e-02   +1.220335753864491e-02   -2.874154543269178e-01   +7.883696337186365e-03   +4.723597859911749e-03; +2.027212305608429e-01   -3.532480789801145e-01   +4.231178636187514e-02   +3.831447139406642e-01   +4.952902412652410e-02   -3.363599642722854e-01   +1.029539916324843e-01   -3.092533796715611e-01; +1.944005558219414e-01   -6.320684103847463e-02   -6.017365439320166e-02   -8.572869519911291e-02   -1.332105175620538e-01   -2.469898943131678e-01   +9.856658755474484e-02   -2.718704168050797e-01; -1.383233513113758e-01   +8.571809091535576e-02   +3.389790800692370e-01   -1.745722105820819e-01   +1.762848261045164e-01   +4.348703330604439e-02   +1.906615452247606e-02   -1.151808976816297e-02; +1.153927795265361e-01   +1.536686386368652e-01   +7.138362727988851e-02   -2.141011422341439e-01   -9.704641754106953e-02   -1.421023289752726e-01   +1.896368648897969e-01   +1.687528931949699e-02; +4.021832349803429e-02   -2.226969718148478e-01   -3.361960993721471e-02   +2.401200361847504e-01   -1.030364014248837e-02   +5.330939619055736e-02   -3.030120466682063e-01   -7.512335364668252e-02; +7.423396790925395e-02   +1.696249589538977e-01   +9.694413011529127e-02   -4.903397537944310e-02   +3.901486607725269e-01   +1.094675830148152e-01   +1.625769261138432e-01   -2.037369812201697e-01];
L1I_L2I_iGABA_netcon = [-2.484237977564908e-01   -1.502055960487662e-01   -2.602300797684469e-01   +2.524837067940856e-01   -4.584563812413988e-02   -1.652051775404603e-01   -1.178575646769838e-01   -3.478115359180024e-01   -2.149447923032001e-01   -2.098469541752525e-01   +3.338357967726417e-01   -1.042453747020190e-01   +2.164865660318878e-01   -6.388188193493485e-02   +2.297030814633798e-02   +1.355183073484372e-01; +3.247615571567511e-02   -1.436937297276034e-01   -3.891970598879896e-02   -1.389393617348355e-01   +5.398186885889671e-02   +1.329458376340368e-02   +6.797711175680905e-03   +1.091689170736924e-03   +7.133274633693337e-02   +3.086904918828233e-02   +1.884198085053425e-01   -1.093516388368204e-01   +3.253944078614440e-02   -4.135224391607704e-03   +1.412508912538429e-01   -9.581560959260896e-02; -1.378550202866815e-01   +2.630517571894196e-02   +1.669112479547174e-01   +1.346789148626776e-01   -1.065980777141923e-02   +3.325590695500271e-01   -2.687272798357506e-01   -4.835490848728748e-02   +4.067276916784097e-02   -3.911913847327181e-01   +4.493326470773482e-02   -6.019807518434277e-02   +2.529254613403570e-02   +1.716835345116034e-01   -4.740987916427443e-03   -2.048531188932668e-02; +3.279469823450268e-02   +9.888311182512982e-02   +7.003151888545969e-02   -2.622568926164019e-01   +1.495141722864758e-01   -2.168630337897637e-02   -2.750931239939665e-01   +1.785630595375261e-01   +9.201525784721619e-02   +2.623255311414012e-01   -1.500866897804196e-01   +3.026911459131102e-01   -3.336059455309586e-01   -3.865027434393287e-01   +9.125104470474338e-02   +1.189340219709288e-01; +1.267116334486209e-01   -7.491526120034672e-02   +1.576754946888028e-01   -6.873112531881373e-02   -2.105307142354329e-01   +6.230050741774276e-02   +1.132977807683958e-01   +1.313306530476035e-01   -2.613863480212740e-02   -1.871721745503914e-02   -1.554628294776560e-01   -1.360283837204421e-03   +2.438733944631297e-01   -2.741378288407929e-01   -4.996573866627449e-02   +1.968436080728801e-02; -2.618135283376742e-01   +2.346862944139285e-02   -6.572409153130564e-02   +1.864521054522149e-02   -2.602076691815075e-01   +1.892879973601249e-01   +1.095936289972072e-01   +2.353460161805817e-01   +1.521413714633077e-01   -1.566781810152736e-01   -2.558376202699675e-01   -3.721991472479888e-01   +9.699015716940311e-02   -1.374161686757272e-02   +1.428381643824954e-01   +1.578629052387145e-01; +1.026756475097448e-01   +3.197099750506722e-01   -3.186298082673728e-01   -4.926316588663254e-01   -1.248606505508112e-01   +3.660639277206805e-02   +4.750161144077307e-02   -2.698880746369854e-01   +5.091975324504057e-02   +2.982295000204602e-02   -4.122430552007985e-01   -7.886505479406775e-02   -5.575380878767434e-02   +9.215253587684516e-02   +6.794589437003087e-02   -4.194035562866353e-02; -6.710066338917485e-03   -1.125078322299022e-01   -1.429017887721920e-01   -3.678997250362496e-01   -3.287397808740852e-01   -1.500451143224069e-01   -2.439811786074012e-02   +1.983004068620813e-02   -7.789792020244374e-02   +7.807399811306411e-02   -1.056261078327103e-01   +9.552402249287197e-02   -4.913584804165478e-02   +1.148536324105178e-01   +1.385975474271096e-01   -6.348180026278866e-02];
L2E_L1E_iAMPA_netcon = [-3.424310974252259e-01   -2.246956987590092e-01   +8.699144316463103e-02   +2.149055905178188e-01   +2.566187126807368e-01   +2.433711116490619e-01   -3.046031658860296e-02   +1.388820880280390e-01; -1.018896010620769e-01   -8.731800789040525e-03   +2.504029887984918e-01   -2.052556534290950e-01   +1.905895562952556e-02   +2.172417194420667e-01   -6.600090632585397e-02   +9.608609533577737e-02; -1.459186255039657e-03   -7.954339655501091e-02   -1.732618890709611e-01   -1.482307464191255e-01   +1.265936444701105e-01   -4.174203259558262e-03   -1.114264624394195e-01   -5.904065063250230e-02; -3.913452730365862e-01   -1.704054498552692e-01   -1.674180241693574e-01   -1.878215508181671e-01   +3.981309040231524e-02   -1.971469533172998e-01   +5.822970806970013e-02   +7.210281602140491e-02; +3.927217821690669e-02   -3.730962866671289e-02   -1.862335279868457e-01   -1.444843801924702e-01   -3.595441515650944e-01   -1.330541270591090e-01   +7.396674478037371e-02   +1.433074813995048e-02; +1.048906980793222e-01   -2.629964560940314e-01   -1.513187052236838e-01   -1.559571744208848e-01   +1.202058094091226e-01   -1.006166543657681e-01   -6.447570371963293e-02   +2.237143197337892e-01; +7.205368217285324e-02   -1.414687311054985e-01   -1.282337486051560e-01   +1.331210288197784e-01   +1.462797582820469e-01   -1.938347351722904e-01   +1.342194414744940e-02   +2.351190053901811e-01; -3.500558989380386e-02   +1.164198718791388e-01   -2.244516031017612e-01   -4.641897527832434e-02   -5.097757134266195e-02   -1.872145657914418e-01   -9.609449810145296e-02   +1.962386122681224e-01; +7.497832153976665e-02   +7.221154892959696e-02   +1.179527232782570e-01   -7.762288607824266e-02   -1.683042389588292e-01   +5.058662152681682e-02   +4.941852428137697e-02   -4.586788756815355e-03; +2.466948635589841e-03   -5.294902802614517e-03   +1.273762447568774e-01   +3.777507315453615e-02   +1.966490124335482e-01   +1.508681748506308e-01   +2.461037573897113e-01   -2.787404541540778e-01; -6.897272724891393e-02   +2.658046345618412e-01   -7.105466057559623e-02   -1.562679986005819e-01   +2.155799306171640e-01   -1.494897718159278e-01   -5.300415751237984e-02   -3.350942517844362e-01; -1.035437410216626e-01   -2.342979099719354e-01   -2.225035987385313e-01   -4.127479236957063e-01   -1.167164661383698e-01   +1.490158028163640e-01   +2.701097769632916e-02   -9.700620078063205e-02; -5.881892857660397e-02   -1.056897314383895e-01   -2.564673455743992e-01   +1.458867885957277e-01   +9.966439940145358e-02   -7.187064922947801e-02   +3.272161639819288e-02   +8.887323137368876e-02; +1.860773652685925e-02   +1.111985145971858e-01   +2.550691377914119e-01   -2.222337441412671e-01   +7.748253105261332e-02   +5.174410658004835e-04   -4.692769358922900e-02   -1.398320267583482e-01; +1.628670885818206e-02   -1.551802055957171e-01   +1.012150101392635e-01   -5.600978327130673e-02   -1.595795536821649e-01   -1.312632607711498e-01   -1.886207650105869e-01   +2.667012732418482e-01; +1.322086088754325e-01   +2.260909988727031e-01   +2.495353782222993e-02   +1.909646428984981e-01   +8.706321440402437e-02   +2.063109920975470e-01   +3.631759134390847e-01   +2.079086615872768e-01];
L1E_L2E_iAMPA_netcon = [+2.497902085538297e-02   +5.579776314866818e-02   -3.284653046064818e-01   +1.070055912385671e-01   -3.474646497623535e-01   -3.440049430725607e-01   +1.058845775848318e-01   +5.671411211213348e-02   +1.245161969455126e-01   +3.711010855933415e-02   -7.370079232465461e-02   +1.475223720219306e-02   +1.513637269006441e-01   +9.790197808484545e-02   -1.205990231452227e-01   -1.286930546370649e-01; -7.103015221766497e-02   +2.255326616332130e-01   -7.121884018639298e-02   +5.741896216965840e-02   +1.057562066446901e-01   -4.431888490579053e-02   +9.145846037354273e-02   +3.982318442148173e-02   +1.144254418265021e-01   +1.841045845349587e-01   -1.326044544719464e-01   +1.833085332101599e-01   -7.010789666730985e-02   -1.190685218719802e-02   +3.244227305405321e-01   -3.188211672037063e-01; -1.844917985238134e-01   +3.638018007619824e-01   +1.113053188868540e-01   +7.224111419514583e-02   -4.365681579923774e-01   +6.591668557556060e-02   -4.990128695122008e-02   -3.800622416249741e-02   +1.212382634161687e-01   +2.022282059800074e-01   -7.028745282323135e-03   +2.530265222353414e-01   -2.518018017160231e-01   -1.233601098534799e-01   +1.896160069231272e-01   -1.761038362667346e-01; +1.384742060927255e-01   +1.405934609606412e-01   +1.623073209096847e-01   -1.588886144380789e-01   -1.983691625930830e-01   +6.933146817001191e-02   +6.175076381023173e-03   -1.148628492627997e-01   +1.425972770436374e-01   +9.770000797972302e-02   -1.763010953283798e-01   +3.646921515198059e-01   -1.878222099233879e-01   -2.190111350251291e-01   +1.017036282174138e-02   -3.380799049370002e-01; +2.660747721162984e-02   +1.395441115692819e-01   +2.890176521410566e-01   +1.452825046651699e-01   -1.110585593714943e-01   -1.685200980385567e-01   -1.333948601640282e-01   +8.260660649231766e-02   -1.294714235212093e-01   +2.667185352182040e-01   -1.134244907577195e-01   -1.936307373773821e-01   +1.414131129929522e-01   +3.124250330883118e-01   +1.883486620905450e-01   -6.064257123736356e-02; -3.928068030334278e-01   +1.724722827025866e-01   +1.019124697786195e-01   +2.766539365603495e-02   +2.302323143450676e-01   -9.685059806408977e-02   -6.133670342384828e-02   -8.960115089030787e-02   +7.212790489162127e-02   +3.292101682262499e-01   -1.781034007544615e-01   -1.273800260723819e-01   +2.320231305464777e-02   +3.570414467828401e-01   +6.135779536273311e-02   +4.238785471492058e-02; +2.552144530980190e-01   +7.256943705309388e-02   -3.160036345871361e-01   -2.407723076855305e-02   -1.576618283882847e-01   +1.380495579778026e-01   +1.070694641821253e-01   +1.171209114709642e-01   -6.650960516651223e-02   +3.694887029886249e-01   -3.020243204418135e-01   +2.140210291435337e-02   +1.163105500538943e-01   -2.267041649153744e-01   +1.633303000666154e-01   +1.517152467655397e-01; -3.870597279780488e-02   -2.881921893994606e-01   -4.076095889895121e-03   +1.152245802243132e-01   -2.433661339606497e-01   -1.044527185586187e-01   +4.217739654462620e-02   +9.409183141756877e-02   -4.740828743269118e-02   +3.443283164236001e-02   -4.828398148955984e-03   -1.234272348959023e-01   -1.125925006210034e-01   -5.064119688163503e-01   +3.656552574784150e-02   -2.074499682987063e-01];
L2I_L2E_iAMPA_netcon = [+3.845002038502524e-03   -1.686994366235894e-01   +1.288153961324278e-02   +1.205067821669418e-01   +6.537651370723663e-02   +2.442095873761045e-02   +6.579933503118326e-02   -6.275207765156632e-03; +1.858128860435742e-01   +8.030517979195918e-02   -1.181922854033413e-01   +1.395626058252578e-01   +6.683337520825673e-02   -2.055138152469732e-01   -6.145684753860656e-02   -5.593771069809723e-03; +6.692228854426704e-02   +4.197464636431340e-02   -3.788507500358677e-01   -1.867110694569532e-01   -1.954010243312994e-01   +1.458351403659461e-02   +5.484973547264185e-02   -1.540629582101473e-01; +8.451667680610175e-02   +9.996731436215311e-02   -2.250147203271817e-01   -8.018845392640665e-02   -6.665208045885421e-02   -8.217002227203818e-02   +3.477827670988529e-02   +1.773100894205804e-01; -2.414103077274538e-02   -8.681984520264519e-02   -2.642106810155378e-01   +4.478974658264333e-02   +2.873230850050443e-01   -9.056738759921991e-02   +2.311928135392455e-01   -9.985469280257667e-02; +1.643220988476614e-01   -5.106557902035822e-03   -2.378970863199159e-01   +2.247185449195571e-01   -1.524062661624800e-01   +1.735813599077945e-01   +2.359557523938495e-01   +1.640058850593326e-01; +1.369624587771954e-01   +7.684165943445651e-02   +5.733527111894944e-02   +1.433018502993323e-01   -1.511373453762511e-01   -7.495832982851082e-02   +6.243687259374174e-02   +1.429732282513922e-01; +1.456940399038648e-01   -4.636327100714295e-02   -1.365086795726466e-01   +8.157587246095989e-02   +6.859958033868591e-02   +1.122375127481623e-01   +2.870014581656944e-01   -2.228142732481916e-01];
L2E_L2I_iGABA_netcon = [+1.597579296863663e-01   +7.747195458248581e-02   +6.171549543958957e-02   +9.076302388780016e-02   -4.481543028745016e-02   -1.234756811672366e-01   +1.173364417392897e-01   +5.033118665756523e-02; -9.702427066366701e-02   -3.352447477377163e-01   -9.616895534197641e-02   -1.419652728115192e-01   +3.170824548167593e-01   -1.416325219854367e-01   +1.624609443401063e-01   -7.205900729354148e-04; -1.198533431912553e-01   +6.757510068958415e-02   +7.996961279330739e-02   -1.831209204532692e-02   +1.455620976174085e-01   +3.429350267808953e-01   -7.131176374145475e-03   -2.270551413934551e-01; -4.507379799866944e-02   +2.632579446910071e-01   -2.949920747281838e-01   +9.211483158189462e-02   -7.636943066756352e-02   +1.325250129303444e-01   +1.371657083139017e-01   -7.801429305554083e-02; +2.169741097949250e-01   -1.004942268395272e-01   +3.870398707466111e-02   -4.455176158934257e-02   +1.819134059710072e-01   +1.747208736414377e-01   -8.617955874898392e-02   +1.166873390712393e-01; +4.100997374658902e-02   +1.034399565674489e-02   -1.357702844452087e-01   +9.756127405223081e-03   -2.910957219689415e-03   +1.800310216533019e-01   +2.822315000010250e-02   -8.767235781193023e-03; +7.639122969211808e-02   +8.023969314342107e-02   +1.794454898723392e-01   +1.934740144492674e-01   -1.336769334335171e-01   +4.669206901853361e-02   +6.780266129875961e-02   -8.500954392090067e-03; -1.547462275498409e-01   +4.657996231623322e-03   -1.714045948580010e-01   +8.989153868629526e-02   +5.606186375600310e-02   +4.178107184968740e-01   +2.911991770151994e-02   -8.052249052077431e-02];
L3E_L2E_iAMPA_netcon = [+7.866245430637807e-02   -3.916752190184873e-01   -5.217929049923370e-02   +4.227422485060749e-02   +2.534567763044367e-01   -1.629663872921109e-01   -2.477284570579306e-02   -1.936130654287869e-01   -3.201312971170773e-01   -1.971213549508817e-01   -2.498854168911870e-01   +7.283669787991540e-02; +2.997813557246687e-01   +6.609564184901548e-02   -2.814812461224612e-02   -2.662558263645475e-01   -7.693169942618003e-02   -9.479729029890048e-02   -8.961597437989190e-02   -5.699392326201713e-02   -2.401428885508091e-01   +8.525029974049755e-02   -1.851774348968555e-01   +3.234672838722991e-01; -2.398025983855492e-02   +1.709482071999746e-01   +2.499580935155157e-01   -8.339533080860745e-02   +4.312341896773002e-02   +9.899166102236515e-02   -4.587922356702002e-02   -1.104259948189608e-01   +1.062416980525327e-01   -3.544748048887431e-02   -2.433009111975108e-01   -1.423775790357754e-01; -3.758392018917906e-01   +1.586409735837784e-01   +2.219461413276921e-02   +8.659350035475433e-02   +5.319386363878396e-02   -1.074878434888905e-01   +3.171560549753107e-01   -1.743204609296696e-01   -6.016263874316082e-02   -2.008140087175400e-01   +1.001452650148221e-01   +1.087863904295865e-01; +8.196815550976165e-02   -1.474049146491750e-01   -1.405528874654398e-01   +1.062326333978902e-01   +1.209729124198176e-01   +1.119355118965639e-01   -3.324033181321902e-01   +2.427895100961459e-01   -1.266721866951440e-01   +1.780855911556642e-01   -1.061829424942023e-01   +8.078347020505011e-02; -4.800762000244103e-02   -4.945739983532536e-02   +5.423335074518495e-02   +3.035464425993032e-02   +1.960950759042263e-01   +1.925918476288070e-01   +4.917195233123287e-02   -1.272219456823004e-01   -1.598197421150865e-01   +1.733678115321779e-02   +2.413755457219132e-01   -1.884280967968554e-01; -7.087006655755412e-02   +1.866028588691714e-02   -7.800595617693036e-02   -3.292048397620538e-01   +1.896144526013140e-01   +1.863559165901301e-02   -1.080798495036830e-02   +1.743703986700749e-01   +1.937690788372937e-01   -6.564815016442732e-02   +2.135747838638287e-01   -1.638643666221138e-02; -4.781415980061486e-01   +1.785919623125928e-01   +1.274850602222434e-01   +4.256397400440835e-03   -1.309159420212094e-01   -1.402620798235233e-02   -1.942594465083787e-01   +4.573293996828383e-02   -8.977923138803989e-02   +1.382412950564357e-01   -2.778765336979153e-02   -4.417576899157459e-02];
L3I_L2I_iGABA_netcon = [-2.519414590219483e-02   +1.918415001488329e-01   -1.441126580671033e-01   +1.443818069470923e-01   +2.868826416672483e-01   -8.043038749401300e-02   +4.955340219587075e-03   +2.920869141795495e-01   +4.052613304517438e-02   -7.558956035839978e-02   +2.568835985988287e-01   +1.913031730057547e-01; +4.201344893337197e-01   -1.598115263313091e-02   +4.658727980802180e-02   +7.121071284604345e-02   -3.181465422523202e-01   +1.468387687743301e-01   +1.211873102584363e-01   +1.498041592393783e-01   -4.605443651803039e-01   +5.074920365687358e-02   +1.988664312886922e-01   +2.452131562860945e-02; -4.151254072018429e-02   +7.918524476477340e-05   -7.951421309127155e-02   -3.277111536749363e-01   +4.677304479362940e-02   +2.539210232580991e-02   +1.126442434303310e-01   +4.192221999021614e-02   +1.561500225479768e-01   +1.142548310446772e-01   +1.818758073167993e-01   -3.144061178600829e-01; -5.473438005331309e-02   -1.142116014714822e-01   +9.496566998408429e-02   +1.358360457340784e-01   +4.984547075856616e-02   -2.159186069360747e-03   -1.809686269316548e-02   +1.608254996552027e-01   -1.225468155579038e-02   -9.872252799518547e-02   +8.868525434813769e-02   +1.435798564787613e-01; -1.183695806531612e-01   -2.021370629467522e-01   +8.119737110011346e-02   +9.093191430507924e-02   -5.072885872399727e-02   +8.601737859812941e-02   -7.894921896738910e-02   +2.432689164127921e-03   +1.134841384082728e-01   +1.473948213573824e-01   +2.212401369624609e-02   +2.854623431242125e-01; +2.681784263868778e-01   -2.179922627939411e-02   -1.537823489590727e-01   -1.221953639681908e-01   -8.390761036622599e-02   -1.906576388083337e-01   +2.270931118285844e-02   -2.677725082566741e-01   +5.133994554095437e-02   -1.398747919763002e-01   -2.477603311725902e-02   +5.787072653945059e-02; +2.307014826442855e-01   -4.472406675083675e-03   +2.607743256946820e-01   -2.447237565460152e-01   -2.288393893895284e-01   -2.208467331724045e-01   +2.018886105102493e-01   +2.480050504864649e-01   +1.786458370977220e-01   +2.579952165518588e-01   -7.415050492869977e-03   -1.663406889102014e-01; +2.743318638188771e-01   -1.777463087274614e-01   +1.514008614563486e-01   +1.950742196608170e-02   +2.110722461640641e-01   -6.405019130186512e-02   +2.053908808312090e-01   -2.120313003753642e-01   -3.037534652199391e-01   +2.727003916526652e-01   +5.234839394078305e-02   -5.217486013562733e-02];
L2E_L3E_iAMPA_netcon = [-8.521133547761751e-02   -2.077128547098253e-01   +1.851971624527993e-02   -9.447036464696607e-02   -5.266873769083154e-02   -1.271085533482904e-01   -1.916589589795908e-01   +1.269199979617173e-01; +4.874634424332216e-02   +1.237904648480834e-01   +1.940809557218133e-02   -6.967872925193808e-02   -2.466581312742060e-01   +2.025774133132902e-01   +6.026030159411153e-02   -1.378736996511923e-01; +2.190730438715164e-01   +2.202451355647990e-01   +5.255691392551941e-02   +3.336258793746368e-01   +1.812225742806772e-02   +1.151388754467889e-01   +6.187217077734367e-02   +8.365968004548473e-02; +1.054889241517338e-01   -2.005389656011408e-01   -1.616990025392938e-01   +1.665635675620860e-01   -2.999556741424318e-01   -1.571830494205394e-02   -2.461524734857892e-01   +6.639486530791237e-02; +1.527249067235215e-01   +1.211142405809106e-01   +1.909568060107206e-01   +2.711343346034022e-01   +6.159090041680700e-03   -7.441475618916189e-02   -6.415844879684192e-03   -1.081962725681249e-01; +1.327671769593848e-01   -6.055065321011215e-02   -3.220677139701525e-01   -2.345608925458761e-01   -1.493767158845541e-01   +1.262021422891977e-01   +1.176314425694447e-01   -2.586320573704687e-01; +2.976214671010941e-01   -1.527705355877009e-01   -7.510802703206880e-02   -1.316979058079737e-02   +2.005525828068740e-01   -9.427279747573522e-02   +1.058132591175973e-01   +8.242807576879191e-02; -5.296105273485480e-02   +1.478218162526564e-01   -3.205801890257668e-01   -2.069018487003771e-01   +9.933023576964799e-02   -1.433384665209106e-01   -2.293823488851078e-01   -3.433103369211706e-02; +8.522884104593823e-02   -2.711480687099843e-01   -4.859160534523662e-01   +9.610257258309635e-02   +3.433572206843283e-01   -1.743245761727453e-01   -9.149328617490862e-02   -7.820739627656156e-02; -1.667699383452621e-01   +1.054973396057302e-01   -1.518415602036580e-01   -1.534182238036768e-01   +1.825466502739895e-01   +1.370938453687957e-01   -1.711108912267983e-01   -7.068407723749839e-02; +5.319466091093551e-02   -1.760842515208121e-01   +1.300775926864398e-01   -4.503151996203782e-02   +2.697637087651941e-01   -4.265848883595832e-01   +1.096781778920979e-02   +2.315868301095038e-01; -1.505273782834031e-02   +1.293963715179093e-01   +8.302745856100500e-02   +1.076842587065798e-01   +5.707514200323590e-02   -2.371927824739763e-01   -2.388795649541033e-01   +7.445537242909341e-03];
L2I_L3I_iGABA_netcon = [-2.237224927146504e-01   +2.071619346026538e-01   +4.360167626168938e-01   +2.350047514140320e-01   -2.521987610392521e-03   -1.865554712558948e-02   -3.805757008603076e-02   -1.680109348362862e-01; -2.803971500254829e-01   +9.907954972421310e-02   -1.325372437775827e-01   +3.249384248940142e-01   -2.824378394047504e-01   +3.611265408090499e-01   -1.182569655840288e-01   -1.540701281733957e-01; -1.447129071867289e-02   +2.630158540614517e-01   +1.696062679253092e-01   +1.308161971051253e-01   +4.130364654793943e-02   -1.715260427181164e-02   +1.999058567886983e-02   +5.860679267116952e-02; +2.976740357227925e-01   +6.399318962361447e-02   +2.210049513651328e-01   +1.894232791419620e-01   +7.579707089404927e-02   +2.242574333937206e-01   +3.032822266921212e-01   +2.159983604037777e-01; -3.150519365625424e-01   +2.622474196711438e-02   -4.018785833718966e-02   +1.702244962800153e-01   +7.070551952381845e-03   -1.730209744013034e-01   -1.370532995298115e-02   +1.044558714403639e-01; +1.281787151862381e-01   -8.972540930905229e-03   +6.975008347422287e-02   +1.126071853070240e-01   -1.323709375981337e-01   -3.424622234391482e-01   +2.855552805851537e-02   -4.600300472390792e-02; +7.277256709467839e-02   +1.488998025524470e-01   -1.412292487279364e-01   -4.158849950000947e-02   +2.622439073399616e-02   +1.739474840949771e-01   +8.930913412475130e-02   +9.351708181643062e-03; +1.533845040687360e-01   +3.873067303089383e-02   +1.036214961085389e-01   -2.895157373302302e-01   +1.952088462314904e-01   +4.358570471793395e-02   -8.754406232828013e-02   +1.201786860546378e-01; -1.149299262522472e-01   +1.096301780330427e-01   +1.132205667333053e-01   -1.610744340461637e-01   -5.270664287022019e-02   +1.524138137537461e-01   +1.592840761121593e-02   +3.274210575796593e-02; +2.510623062446008e-02   +3.722490394580065e-01   +7.304004306573612e-02   -1.614098890758238e-01   +8.825400516957552e-02   +1.012015160017493e-01   -1.950596350865201e-01   +1.650104956463515e-01; -1.832087434307774e-01   +2.318332061627555e-01   +2.146419713398304e-01   +1.865163425723804e-01   -7.965192578679732e-02   +1.095560647670298e-01   -1.138155004684841e-01   +1.085602118121660e-01; -5.102628787033971e-02   -1.590472321998453e-01   -5.414483640016859e-02   +1.433600063451662e-01   -1.422970835074626e-01   +4.707481784705665e-02   +1.405304544784549e-02   +1.542328514340450e-01];
L3I_L3E_iAMPA_netcon = [+9.006404263197149e-02   -3.097668103181873e-01   -1.569095874317461e-01   +3.226651691602848e-01   -5.106959696028748e-02   -5.201925828713719e-04   -1.837584126220424e-01   +1.902412342784645e-01   +9.548693465861210e-02   -2.181788960067087e-01   +7.549131474688785e-02   -2.698819095659465e-01; +2.366423861672680e-01   -3.176464177306119e-02   -1.633283512806865e-01   -2.203882762247415e-02   +5.413264530981202e-02   -7.201322263773752e-04   +2.055493410085731e-03   +3.181509001360645e-02   +1.240102148869909e-01   +2.030882345350576e-02   -1.641916539802554e-02   -7.959698556926377e-02; -4.350055749687935e-03   +1.492719513047862e-01   +2.070110913995667e-01   +2.810154413186602e-01   +2.678637096011572e-01   +2.689943873913528e-01   +2.037432790634122e-02   -5.063809140186600e-02   -2.774660157163041e-02   -5.162347253546934e-02   -8.564544992585056e-02   -3.870154805647634e-01; +3.024729422107228e-02   -1.024373863389805e-01   +5.870434516128203e-03   +1.294408866939459e-01   +3.357562026205060e-02   +6.229502281181343e-02   -1.090730023514295e-01   +2.357832605119866e-01   +1.575382945990005e-01   -2.393361304492834e-01   -1.524535787300319e-01   -1.967108879686450e-02; -1.170924934530200e-02   -3.230274614146288e-01   -1.200561770427277e-01   +1.048627660601959e-01   +1.217521423550603e-01   -1.890177994212107e-01   +2.137230346734401e-01   +1.505426891510429e-01   -1.583537915053117e-01   -2.017778061519689e-01   -1.330115294351435e-01   -8.723534411233119e-02; +7.823749585431665e-02   -6.613754805032134e-03   -8.248330792277409e-02   +1.546885591931378e-01   +1.283187029001956e-01   -2.285879337849456e-01   -3.133032100244072e-02   -4.684944024426967e-02   -8.609313043842309e-02   +1.891565818654146e-01   -1.761797471106515e-01   -1.032490913278817e-01; +2.386358346509861e-01   -6.495467027162692e-02   +9.658033380092999e-03   -1.097526790140964e-01   +1.274900772811812e-01   +8.421646711358356e-02   +1.771853326077687e-01   -1.251369590127933e-02   -5.734840339751614e-02   +5.776634576963365e-02   -4.633224997119960e-02   -1.506342755552045e-01; +1.579220415902149e-02   -2.838835612315727e-02   +4.100641135166759e-02   -1.675652629297550e-02   +2.355148655296961e-01   -1.704453373367392e-01   -9.005361883179288e-03   -7.924623311674880e-02   -9.736245268404713e-03   +1.177124619638758e-01   -7.196302982720680e-02   -1.497823975434356e-01; +1.809564308028833e-01   -1.002916835956622e-01   +2.270488531864360e-01   +4.336516633124335e-01   +6.406093330035852e-02   +6.004039734649786e-02   -1.611237561179623e-01   -1.619333725254835e-02   -2.286177773025274e-01   -1.641309044289075e-01   -1.517884266519273e-01   +3.517291285986803e-02; +1.821507986581856e-01   -1.729353428864447e-01   -2.125189599671815e-01   -1.746152426078527e-01   -2.316579783163494e-01   +8.641480809583593e-02   +2.197835498613243e-02   +1.034419214658244e-01   +1.079061933106541e-01   +5.214033527835514e-02   +2.692511331724446e-02   +4.511057841602454e-03; -9.029112402288687e-02   -3.555904470658899e-02   -2.963012026536868e-01   +2.380096842046138e-01   +7.211781737276214e-02   +7.293229020860870e-02   +1.184996681112565e-01   -2.436658788176097e-01   -1.827915557533845e-01   -1.344407514208306e-01   +2.825436155467565e-01   +3.157632287458376e-02; -1.646532759797394e-01   -2.030097978791728e-01   -1.633558685749484e-01   +3.591721593232410e-01   -3.054447087595296e-02   -1.182599912184036e-01   -2.649647665377439e-01   +1.533736025761443e-01   +3.769630317251515e-02   -1.415565031267429e-01   -3.933559818770027e-03   +4.167597762962012e-02];
L3E_L3I_iGABA_netcon = [+8.562269634033631e-02   +1.285016899982341e-01   +9.782923197699653e-02   +1.279982774616661e-01   +7.426414919293103e-02   -3.617851800889824e-01   -1.024486085953927e-01   +3.873648568287028e-01   +2.023210121831414e-03   +3.782672521401937e-01   +5.451188600917188e-02   -2.612256538966906e-02; +5.883057131934327e-03   +1.358565906900407e-01   +1.347243687999253e-01   +1.434152006424972e-01   -5.383319544176379e-02   -7.635350254182158e-02   +1.719421798738461e-01   +1.376716900323511e-01   +1.385544351880303e-02   -1.532344317432295e-01   -1.482264410948509e-01   -7.451317614685801e-03; -5.618103601439380e-02   -2.428807239471108e-02   +2.018947421700693e-01   +1.600606599213892e-01   -1.698397301639186e-01   +1.709434990817101e-02   -6.651810920303167e-02   +3.916746825006120e-01   +1.634302921108229e-01   +2.000117190466582e-02   -1.284699293876024e-01   +3.448093414477615e-02; +2.337642235062750e-01   +1.131529048143908e-01   +2.974520765430429e-02   -7.283998823890947e-02   +1.104447612148925e-01   +4.313607495090699e-01   -2.902265863651612e-01   -2.617561426614965e-01   +1.270724533645954e-02   +5.508215594966159e-02   +2.722346507207106e-01   +1.311391147181962e-01; +1.536969363271155e-01   -1.582972178263483e-01   +2.742174337314565e-03   +1.395535088700846e-02   -2.815227887399276e-01   +1.607914164709018e-01   +1.766077651247659e-01   -3.198548749707535e-01   -1.335237724001083e-01   -2.362214176780849e-02   +2.921797935010030e-01   -6.364069373933613e-02; -8.843790437203171e-02   +7.694460690465939e-02   -1.028229431333576e-01   +9.064176923964262e-02   +8.255040860014022e-02   -4.624365204560493e-02   +6.871573179575381e-02   +2.097784695986327e-01   -3.782880003451373e-01   -3.366403419077338e-02   -2.939339887918657e-02   +1.383581388584352e-01; +7.629279897098190e-02   -2.546516256979799e-01   +2.169312791101751e-01   +2.216024534310872e-01   +3.076602216200998e-01   -7.205538845825241e-02   +1.124329292116198e-01   +1.077465123020594e-01   -9.416517069954364e-02   +1.574021816848601e-01   -4.614759696782385e-02   -5.321464748687304e-02; +1.263547972704841e-01   -4.104828242527907e-02   -1.797215159829932e-01   -7.770177580022766e-02   -4.430471961755140e-01   +1.693078949619752e-01   +1.929493114900141e-01   +7.432767962291503e-02   -9.879943762201693e-03   +7.000851485722177e-02   -2.711969355302213e-01   -7.454244704207660e-02; +6.725172608480069e-02   +4.909132542643407e-02   +1.492599710198923e-01   -1.891520374134707e-02   +1.304864691862308e-01   -8.041038114473467e-02   -6.249598819411221e-02   +2.353668036545432e-01   -1.534940483088100e-01   -1.202789682976903e-01   -1.098107525756253e-01   +3.626224073817030e-01; -4.537875312961961e-02   +1.993722221681043e-01   +1.924298821762648e-01   +1.940870579226774e-02   +8.254909599177018e-02   -6.624785821248230e-02   +1.275684274506388e-01   +1.656804946184058e-01   -3.048781284456270e-01   +4.371560880737802e-02   +5.059413236845060e-02   +2.812048138103119e-01; -2.465296102524844e-01   -8.033891289111471e-02   -1.689996437720724e-01   -2.284757811085944e-01   -1.684727095225920e-01   +1.946196805542932e-01   -2.696067146192574e-01   -1.044931658740781e-01   -3.301004036913099e-01   -1.410512005385433e-01   -1.368824447730763e-01   +7.468102675514800e-02; -2.305466780386476e-01   +1.753484342181272e-01   -1.931792234874410e-01   +9.458405348354561e-02   +1.874647673403513e-01   -1.223578525482063e-01   -9.977667889662600e-03   -1.293975021436410e-01   +1.739428235622384e-01   -2.117562985591631e-01   +2.547206241947219e-01   -4.108651955562004e-02];
L2E_Input1_iAMPA_netcon = [+9.458329133265560e-02   -1.518327221882265e-01   +2.085602452284202e-01   +6.425095818157217e-02   -1.076412607353609e-01   -4.171101622745808e-02   -3.247159059591660e-01   -2.087752207749581e-01];
L2I_Input2_iAMPA_netcon = [-1.346716214002290e-01   -2.562665439578075e-01   -1.614125140925284e-01   +1.771220061843828e-01   -8.756215259185446e-02   -6.551048349322859e-03   -2.252835305841246e-01   +1.835274081705529e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
