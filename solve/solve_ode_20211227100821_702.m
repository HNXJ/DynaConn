function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.584951701928646e-02   -8.888957985538513e-02   +2.356250686259369e-01   -2.700847283214748e-01   +6.596015500817008e-02   -2.987466783679244e-01   +1.503172641388155e-01   -6.966620660270108e-03   +4.272995715275183e-02   -9.386813868434418e-02   +2.664334513256525e-02   +2.013682935178617e-01   +3.703673035494958e-02   +1.097787727425878e-01   +1.552380607795779e-01   -3.961667157864249e-01; +5.846710285801960e-02   -1.109311063891063e-01   +1.463208622972540e-01   +5.033190487555037e-02   -3.830545054671628e-01   -1.557848672408112e-01   -2.027757097369029e-01   -3.081876032270443e-01   +3.118533697583782e-03   +1.370800580733455e-01   -1.498125748262925e-01   -3.764330954476241e-03   -5.709645362502700e-02   +1.246850400095249e-01   -6.966542126227544e-02   -2.915605889545414e-01; -9.433251034602369e-02   +2.675199356630895e-01   -1.514546573621749e-01   -3.448163902053979e-02   +2.663450565827264e-01   +1.870267277757241e-02   -1.538266696561905e-01   +1.585551445613073e-02   -3.848802154619727e-01   -2.468806986579471e-02   -1.417940754595108e-01   -2.016444385086055e-01   +7.365594781531823e-02   -2.286398480040244e-01   +1.684092489434404e-01   -3.001025119406306e-02; -4.798107009961325e-01   +2.277442948035829e-01   -1.530724966825075e-01   +3.489458345034592e-02   +1.006330422233922e-01   +1.013221716931309e-01   +3.730323792882521e-02   +3.819660688003679e-02   +7.136294941562325e-02   +2.860603887725157e-01   -1.863656738869543e-01   -4.726194907332046e-02   +8.790256943320095e-02   -2.108554003507799e-02   -1.224884283982312e-01   -1.936557327180879e-01; -5.022073385016856e-02   +2.028125070133456e-01   -3.664757151292351e-02   -1.624640664641424e-01   +1.571102528830131e-01   -2.215027874969664e-02   -6.626211357845413e-02   +2.995858906141435e-01   +5.899825914920714e-02   +3.374752691590365e-01   -1.621184473119504e-02   +2.809427711217302e-01   +2.777967646576356e-02   -3.695248268408571e-02   +5.641187524393899e-02   +8.050995217462054e-04; +6.811897391427518e-02   +3.352715375366953e-01   -1.996992863964080e-01   +2.675390128109572e-01   -5.842286379315237e-02   +1.508117469477030e-01   +7.707526390807215e-02   -1.000308321514220e-01   +2.490243145788432e-01   -2.634159589758704e-01   +1.320899929110073e-01   +8.872221827319418e-02   +7.400975704736662e-02   -1.466446703094464e-01   -3.199117990529685e-02   -2.301941118693908e-01; -5.193800542027776e-02   +7.833688779229921e-02   +5.965477068858275e-02   +4.260343221331730e-04   +4.187530328175550e-01   +2.497731937285549e-01   +1.749819538011817e-01   -1.074490465703759e-01   -1.974692683218144e-01   +1.545321174227358e-02   -2.914141474787220e-01   -3.824446253000173e-02   +2.989791410805111e-01   -6.466186149849201e-03   +2.562138620303833e-02   +1.209517268272491e-01; -2.951684552903355e-01   -1.964935190376217e-01   +8.136626623035575e-02   -1.098573557369557e-01   -8.189106054812956e-02   +2.920547501515569e-02   +3.842266097031646e-02   +1.739975537987943e-01   -3.316095718436362e-01   +1.891133362028711e-01   -1.061284915816632e-01   +1.649346469170345e-01   +3.294660520537651e-01   +9.282602874209894e-02   -8.015696479515676e-02   -3.434967542126943e-01; -8.075126208386921e-02   +2.749485956123819e-02   -2.748227078843512e-02   +1.206132789616877e-01   -2.964163406845425e-01   -2.694844147811004e-01   -2.426578370961303e-02   -1.199994243725675e-01   -7.782486654993295e-02   +3.019061233425679e-02   +1.641040510414783e-01   -4.320520176774620e-01   -2.261990588851453e-01   -2.200370816955634e-01   +6.811107028805721e-02   -4.074829598155527e-01; +1.318216094293060e-01   -5.205403514766470e-02   +1.903426773097212e-01   -1.105186397110566e-01   -1.577011022923917e-01   +5.858580446043035e-02   +8.697026399083525e-02   +1.060745589007886e-01   -9.933570296607258e-02   +2.736748134295189e-02   +6.104543085217887e-02   -7.446356997119914e-02   +2.070217766973626e-01   +1.113826762328526e-01   +1.539798455488571e-01   -9.544391037396599e-02; -7.030603699485632e-04   +1.300090984199598e-01   +2.773786432033561e-02   -2.553137381140221e-01   -1.043476117223816e-01   +5.390138852110040e-02   +1.707011585381228e-01   -7.889367587050772e-02   -2.108302057069716e-01   -3.287857811112038e-01   -1.904756466702097e-01   +1.558981008203981e-02   -3.318229156714176e-01   -1.417680073648118e-01   -2.097425249474420e-01   -1.421494872065014e-01; +1.028203825692120e-01   +1.718413889105247e-01   +8.992351005274844e-02   +3.515786305086593e-02   +9.488350752402200e-02   +1.163514717387985e-01   -4.893475978686329e-02   -1.272737604204843e-02   -6.977895140808160e-02   +1.651108578701203e-01   -2.898498298608062e-01   -1.446061313482822e-02   -3.884793205487520e-02   -3.016789284820424e-01   -4.013082438589534e-03   +3.664208157323784e-01; +1.117441262986249e-01   -1.306819810750420e-01   +1.340998263389979e-01   +2.705121541351838e-02   +1.053487267843811e-01   +9.863088954116374e-02   -1.173760638255305e-02   +1.425122243349995e-01   -7.657076706932221e-02   -2.373906763061523e-01   -6.545899149967940e-02   +1.264584982171420e-01   +1.812175964684514e-02   +2.002004219663317e-01   -2.664524673099902e-01   +8.961034648291229e-02; -1.789350966995520e-02   +7.761481415751810e-02   -2.706259013838554e-01   +2.559230817769419e-01   +4.039287378924766e-01   -2.601239849549158e-01   +6.161682629489745e-02   +2.256038894900486e-01   -1.763805158178139e-01   -1.083510276385952e-01   +7.572187361112299e-02   +1.884296253957612e-03   -8.668501735791312e-02   +1.114568670880972e-01   -1.721294159603868e-01   -1.693125251471836e-01; -4.225558418692167e-01   -8.305979235628863e-02   -1.103805613193801e-01   -4.565471666712038e-02   +2.633355637754493e-01   -1.536604667694600e-01   +7.093046412506207e-02   +2.530816486960176e-01   +1.281316570565984e-01   -1.628175746424981e-01   +2.042981303808711e-01   +1.145848838710860e-01   +1.017590796313917e-01   +2.933509317193921e-02   -2.753783294731657e-01   -1.885854073974007e-01; +6.981875532914111e-02   +2.140622839969304e-03   -3.143166772992421e-01   -8.565789612043022e-02   +1.616807361202439e-01   -1.881014073551051e-01   +2.933339411404887e-02   -4.271407121319649e-02   +4.995129268559603e-02   -1.987246539131960e-01   +8.226289698385991e-02   +5.160347163833331e-02   -1.664244737620857e-01   -6.532764200353736e-02   -2.032861157291534e-01   -1.524489776829455e-01];
L1E_L1I_iGABA_netcon = [-3.055040734931821e-01   +1.727487373671401e-01   -2.967342047904462e-01   -3.230833890674333e-02   -4.264275267903271e-02   +7.897868590689441e-02   -1.359901250233075e-01   +4.018000422144518e-02   -4.671888197026081e-02   +1.740144919637964e-02   +4.808776439955131e-02   -3.511012014787644e-01   +1.802171742163997e-03   -1.950918087836668e-01   +4.171292304578034e-02   +2.282618056321855e-01; +5.580177252858950e-02   +4.428076560168927e-02   -2.748088834849330e-01   -1.530226134802269e-01   +2.809647229223679e-02   -2.339514612139904e-01   -5.209678308453059e-02   -2.276473254610537e-01   -8.787591537283924e-02   -3.235284770376607e-01   +1.144187192629856e-02   -2.037747063971973e-01   +3.870001181086700e-02   -5.403258931424652e-02   +2.611359698254215e-01   +9.699472153914493e-02; -1.451554219601589e-01   +8.248066704960144e-03   +1.259374814257627e-02   +1.737485832837228e-01   -1.632342442967280e-01   +2.619993170806644e-01   +2.217939793289568e-03   -1.482523444793176e-01   +9.758890681183299e-02   -4.781143559814012e-02   -2.435476336149345e-01   +4.475324355037141e-03   -7.396449694200620e-03   +1.858349029702791e-01   -3.140154861681442e-01   +9.077861457076425e-03; -1.305070715224511e-01   -1.753096844527361e-01   +6.414286706884256e-02   -2.775219107667338e-01   +1.698442274159530e-01   -3.778614033899135e-02   -5.708506267928568e-01   -1.691329754516764e-01   +4.590053728403823e-02   +4.897164597145179e-03   -2.113724208970161e-01   +1.970877916067536e-02   +1.165594984421209e-02   -2.504515325710431e-01   +3.753670163754001e-02   -2.378826282629629e-02; +1.781536979160391e-01   -1.286972649433560e-02   -2.624817131696037e-01   -3.281864864232903e-02   +2.337843058166203e-02   +8.783957722985897e-02   +2.878003606966303e-01   -2.344105379383100e-01   -1.490180534328083e-01   +2.235844121834774e-01   +1.856334895149088e-01   +1.221521973730289e-01   -6.070338460121083e-02   -6.122352675734716e-03   +1.978280790838348e-01   +5.468373584845990e-02; +6.809560627066336e-02   +1.589237841244483e-01   +4.564901360172221e-02   -4.263621723388688e-03   +1.480368873049751e-01   -6.896763188943311e-02   -1.696472447885479e-01   -2.505135055962395e-01   +2.726050456569849e-01   +1.840222914320593e-01   +1.184942001501698e-01   +5.086037706862548e-02   +3.126353450388525e-01   +2.205025066185009e-01   +4.556707864132922e-01   +1.010347076243308e-01; +1.402630187061922e-01   +2.147473644030750e-01   +5.595727500503370e-03   -3.861071652961839e-01   -1.977092167617605e-02   +2.532233326852905e-01   +5.826091012764235e-02   -3.492818450291903e-02   +2.918875347070227e-02   -5.951817352128715e-02   +2.636960424150409e-01   -1.026296934817261e-01   +3.223703649034165e-02   +1.389038954296318e-01   -1.958172447920831e-01   +3.092748353637058e-01; +2.193542981320719e-01   -6.638646839609233e-02   +1.886462657360839e-01   +1.414527416679416e-01   +1.612476443880178e-01   +4.010146534221010e-01   -2.454621961438634e-01   -3.761086838242326e-02   -1.893411910228571e-01   -2.227238251707272e-01   -1.635988307994880e-02   +5.051236257227597e-02   -2.812448398713034e-02   -1.529770680359973e-01   +6.420996542352560e-02   +3.057867167891530e-01; +2.689423446332954e-01   -5.109751887738043e-02   -4.986370550244999e-02   +9.943714604007130e-02   -4.689472601114758e-02   +6.314161636413265e-02   -7.928948147784623e-02   +7.336598669745331e-02   +2.910465050597020e-01   -1.147610191661411e-01   +8.773585283647081e-02   +1.559382013735303e-01   +1.280008957111498e-01   +5.339741351822039e-02   -1.275317960222999e-02   +8.370381739223927e-02; -2.532829428884496e-02   -7.656847419054949e-02   -1.994660915442523e-01   +1.670021551861645e-01   -2.351169776954919e-01   +1.282591581259088e-02   -3.190353161704200e-01   -1.450797700812372e-01   +1.157311473951233e-01   +1.633806307419716e-02   -2.093439891154617e-01   +1.828044210752609e-01   +6.775904201125711e-02   -1.324365768354303e-02   +2.947393501910487e-01   -1.994432835121017e-01; -4.820729880286040e-02   -7.467223017519059e-02   +2.834075660323745e-01   -2.361867755603586e-01   -1.403825303064084e-01   -1.766134244649742e-01   +3.873535565606414e-02   -1.390756407924751e-02   +8.487434483677858e-02   +1.480594444555099e-01   -2.814840569885800e-02   +4.913562396510560e-02   +1.424814728197224e-01   +4.414390134852365e-02   -7.795499242990271e-02   +3.037438982473653e-02; +1.632696624120623e-02   -7.875810981860196e-02   -3.330021857662455e-01   +1.453454151885214e-01   -3.955630937844860e-01   -6.338390539719582e-02   -5.410429496442842e-02   +1.692979604699793e-01   -1.695843035647707e-01   +1.191797834235384e-01   -5.945777711484326e-02   +2.131673836659731e-01   +8.679390114816253e-02   -1.242428051789023e-01   -2.060171035128688e-01   +1.454149712985718e-01; +1.761792385349526e-01   -2.937414561517526e-01   -9.364514957275119e-02   +2.374940585669816e-02   -8.396822247017530e-02   +1.727854108674742e-01   +2.471529899654194e-01   -9.978721207883959e-02   -1.009662515785840e-01   +8.383342688231646e-02   +5.491975195351847e-03   -2.729239178742172e-01   -2.439341687923229e-01   -1.508328802985319e-01   -1.104915223081793e-01   +1.463989184619480e-01; -1.207945889383082e-01   +1.353450816214217e-01   -1.394414025828307e-01   +1.637644797859512e-02   +2.289901593024234e-02   -1.789256251031538e-01   -3.061226629163969e-01   -3.737237053370817e-01   +3.535311845370551e-01   -2.439273346800458e-01   +1.833146744325652e-01   -1.053202497872708e-01   +9.108610124510132e-02   +1.795156968778652e-01   +1.088001337045317e-01   -5.221157822505804e-02; -9.498638102254955e-02   -2.249957298170811e-01   +4.077666918643474e-04   +5.104595203637566e-02   +8.332017501943731e-02   +2.670357712299131e-02   +7.291001611458847e-02   +1.169939702119676e-01   -6.428976747145665e-02   +2.177735111465411e-01   -2.480137271007766e-01   -5.144178296191625e-02   -2.666081130456323e-01   -7.659195790170135e-02   -8.843192077898665e-02   +1.439129277543520e-01; -1.360290499027852e-01   -6.323405384399992e-02   +1.068109414557371e-02   -1.501542431375295e-01   -1.766515199282502e-02   -3.225914836009267e-01   +8.542715159050804e-02   +6.051001411976046e-02   +1.357522118451814e-01   -3.667753918777396e-01   -6.837921111965506e-02   +1.609328325119746e-01   +3.205921918922500e-01   +1.474966590300302e-01   +3.253999354816647e-01   -2.630499038724956e-02];
L2I_L1I_iGABA_netcon = [-2.383097782094772e-01   -2.884620536814501e-01   +3.408499585625577e-01   +7.383532008371504e-02   -1.094092240402070e-01   +4.062089684708263e-01   -2.651436397918790e-01   -1.604276905372271e-02; +8.894393852396275e-02   +1.859441317867989e-01   +1.164542517099765e-01   -3.164507023807480e-01   -8.960283461959768e-03   -9.826885998711676e-02   +3.913502582940854e-02   -8.825352463948591e-02; +7.899870850712113e-03   -1.442610803830797e-01   -9.300785049080913e-02   -1.983445143680661e-02   +1.706873962896326e-01   -3.554333202539399e-02   +1.771050323259402e-01   -1.435927949563832e-01; -1.894389110864421e-02   -7.663495149152003e-02   +1.252790371897860e-01   +1.512693786519771e-01   +1.043220267008794e-01   -3.673133338366949e-02   -1.479794120611959e-01   +1.316649929189912e-01; +2.070972202265360e-01   -3.015327790769701e-01   +8.298395613015681e-02   -1.246836604307825e-01   +1.834935731014394e-01   -1.442531618260100e-01   -2.579021157421050e-02   +6.966815513923762e-02; -2.754722987427611e-01   +3.081805046391897e-01   -1.169200994701757e-01   -2.611185723028495e-01   +8.864106474524426e-02   +3.466868504390538e-02   -2.142170362958487e-01   +3.738415185363912e-02; -6.007657435073051e-02   +2.161380852952003e-02   +8.693773639522251e-02   -8.530005033436953e-02   -7.505921451233680e-02   +2.855117261239591e-01   -1.217967719508985e-01   -1.348129638830248e-01; -2.746499998953701e-01   +3.196969936656937e-01   -2.079219419105316e-01   +3.239674557041118e-02   +8.748250694717127e-02   +3.953935076940104e-01   -1.370152986721766e-02   +1.152646419894369e-01; -1.363384318416417e-01   -1.416945273054636e-01   +3.022601031658809e-02   -2.937838240219364e-01   -2.300859785031906e-03   -5.564091350770194e-02   +5.110758075113474e-03   +7.587932904344413e-02; -2.120928331797196e-01   +1.275522097886884e-01   +1.427006286512684e-01   +2.643754884115914e-01   +1.479779891181202e-02   -1.615993220701833e-01   -3.469801704903225e-01   -1.771911312830091e-01; -2.144107347745041e-02   -3.529259285015680e-01   -6.912880012395223e-02   +5.013576763317020e-01   +2.500937183609115e-01   +2.034124837056516e-01   -1.147552875101846e-02   +1.601084031504731e-01; -1.207265302669359e-01   -1.654220779957408e-01   +2.945344079931593e-02   +1.252116556007247e-01   +2.505352393067639e-01   -6.601932640333480e-02   -2.439946120488844e-02   -4.844003372580892e-02; +1.663399359131981e-01   +1.899805494509682e-01   -7.132275364060325e-02   +1.370557663735189e-01   +1.201113817469345e-01   +1.528956728396544e-01   -2.920129242499937e-01   -1.284735560410689e-01; -1.405005361903466e-01   -6.404442904654768e-03   +7.821503990829046e-02   -6.087287440461343e-02   +6.090855464183196e-02   +2.608393519852509e-01   +1.134448332835700e-01   +2.926706292256626e-01; +2.141001685591354e-01   +2.846051016536703e-02   +1.779708398216287e-01   -2.864892396389611e-01   -2.306166429413342e-02   -2.171874914101654e-01   +5.843195528250590e-03   +1.953514352792483e-02; +1.819640198481655e-01   +1.263690036360776e-01   +1.386621564147353e-01   -8.570560516381773e-02   -2.269987113308828e-01   +1.369067920733006e-01   -2.334423037747180e-01   -3.258402238296765e-03];
L1I_L2I_iGABA_netcon = [+2.535844026922343e-01   -5.561047306646827e-02   -2.869717351015933e-02   +1.026351325720763e-01   -1.881378962263879e-01   +4.322210198298681e-02   +2.626080058051643e-01   -8.122289203096750e-02   +2.402882631323074e-01   -1.047713840070368e-01   -1.176297899799016e-02   +1.054233422139671e-01   +1.569850481746634e-01   +7.094550627817063e-02   +9.450272483873416e-02   -3.426469309900724e-01; -2.623742369708752e-01   +1.451943680881196e-01   +1.117167118048324e-01   -1.682878209483235e-01   +1.717984761198431e-02   -1.785861762599707e-01   -3.173567871435440e-01   -1.163784689603233e-01   +1.887318227569782e-01   -1.458172034576537e-01   -3.509527374576352e-01   +3.068641892892925e-01   -1.788979865532043e-01   +2.863825872363162e-01   -4.383814683950189e-02   +1.412918727359888e-01; -1.914053565482675e-01   -1.639600188681251e-01   +2.358359968360258e-01   +6.751765105771690e-02   -2.806105796141291e-01   -6.874231872210290e-02   +3.600840745452335e-01   -1.304557928638815e-01   -1.387428187458397e-01   -6.800715659136053e-02   +1.643661945605870e-03   +1.520143990124112e-01   -1.228046765919979e-01   +1.817378202954332e-01   +1.284638313625261e-01   +3.658094371618740e-01; -1.865070793472473e-02   -1.727839468004630e-02   +9.693703067580793e-03   +1.127748998538693e-01   -1.471317517466392e-01   -3.943933361968263e-01   +5.944936466697178e-02   +1.206252172445637e-01   -1.307868863101358e-01   +1.925189951570618e-01   -1.679235525422621e-01   +1.871246024453350e-01   +6.278505721709388e-02   +2.520456771644991e-01   +1.393398525743141e-01   +3.127336315006125e-01; +2.761974199892728e-01   -1.489005527765023e-01   +5.467724007119773e-02   -2.633799761707534e-01   +2.062287097978923e-01   +2.222052411115607e-01   +1.165660881570525e-01   +1.538008836309231e-02   -2.202733872134483e-01   +2.162339006793750e-01   -1.887678384014307e-01   +5.121269907169761e-02   +1.770593423603863e-01   +2.179891282718531e-01   +3.463041928962569e-02   -3.289179532021784e-01; -1.517349481414953e-01   +2.536708206847035e-01   +1.838401470438102e-01   -1.053373695859111e-01   -6.722006233628489e-02   +1.135017560522701e-01   +2.106004273247764e-01   -1.031310783464272e-01   -1.891422471675442e-01   +8.111859644097040e-02   +4.725010882192324e-03   -2.073257019022934e-02   +1.722560855127401e-01   +1.881577159376663e-01   +1.418075769758053e-01   -1.413401731831727e-01; -2.287845383243536e-01   +2.850950880779011e-01   +1.584950775754012e-01   +1.712367941009115e-01   -2.332768016691756e-01   -1.078365336981535e-01   +1.492155418786358e-02   +1.761715573872272e-01   +9.888391960815308e-02   -3.011674197347833e-02   -7.534459136201338e-02   +7.353764383578346e-02   -2.603565320501198e-01   -2.986567450930642e-01   +2.288296843453997e-02   +2.964448787759585e-01; -3.164421334192178e-01   -2.055145644735675e-01   -7.863079391168629e-02   -2.512376898287778e-01   -1.575789169847649e-01   -2.102960179440491e-01   -1.993604825199138e-01   +2.208005930001680e-01   -6.762958228665401e-02   -1.268282271474155e-01   -2.236541574671539e-01   +3.251143594968981e-01   -1.949485994729184e-01   +3.754396206445210e-02   +7.050986000650496e-03   +5.492154079302953e-02];
L2E_L1E_iAMPA_netcon = [-7.334793469715525e-02   +3.812918464508805e-01   +8.028844225895973e-02   -1.507882168675840e-01   +1.752058081873687e-02   -6.435184334214417e-02   -7.033884404929283e-02   -2.591053900686473e-02; -1.007058343823841e-01   -5.458431818873858e-02   -3.170409303209020e-01   -6.932385476927673e-02   -1.503909015289509e-02   +5.352442410509353e-02   -8.776965137953185e-02   -1.061571152591347e-01; -3.339790412493516e-01   +1.455717333709080e-01   +4.114246088662232e-01   +2.294355032315307e-01   +2.146414761211044e-01   -3.347309287812733e-02   -8.511562520408482e-02   +1.671189506976696e-01; -2.015447420036493e-01   -1.658696599345147e-01   -1.342048916229365e-01   -2.182762153187406e-01   +3.040224045179081e-01   -2.445796980457718e-01   +8.725672696264965e-02   +2.397781660606754e-01; -1.253659360543017e-01   -9.644929391619121e-02   +5.791903895282023e-02   -6.148067341261018e-02   -1.632808545852811e-01   -1.017311776753251e-01   +4.648586972297265e-02   +7.342210750569218e-02; +4.828427171043713e-02   +4.139115626430891e-01   +7.912708641315332e-03   +1.742498657748008e-01   -7.287073010383277e-02   -2.713972839418373e-02   -1.447636356010343e-01   +8.256457050599901e-02; +1.834106423871630e-01   +1.254214414912497e-01   -1.563136890092946e-01   +3.222334436428310e-01   +7.108216554887224e-03   +8.873154813175596e-02   -7.198030335036920e-02   -1.350330548942588e-02; +2.747119258395920e-02   +5.874342477849269e-02   -4.325213285306212e-02   +2.103357185729922e-01   +3.378199787716971e-01   +7.416915217602994e-02   -2.877073533690280e-03   +1.113353744101102e-01; +1.463170314107696e-01   +1.130704971969416e-02   +2.037903517817950e-01   +4.081405099581806e-02   +1.547819900883119e-02   +2.136199984588104e-02   +1.658603527057610e-01   -4.759521695690340e-01; +1.482630969392248e-01   +9.005919161352192e-02   +7.610151397953572e-03   -1.577692237812415e-01   -7.593500937839856e-03   -2.790713516557377e-02   +3.154989776390824e-01   -1.503942096957193e-01; +1.636912403814844e-01   +3.006178373532978e-02   +4.744016966449703e-02   -4.556320833700910e-02   -9.911809653287043e-02   +3.431836882989275e-01   +1.100682619062751e-01   -1.134671569204651e-01; -7.492396565981112e-02   -2.113758842668579e-01   -1.830854314823456e-01   -2.157008334235940e-01   -3.408916969022755e-01   -1.628695272755331e-01   -1.801504615059814e-01   -1.587057722534710e-01; +2.051853542922084e-01   -2.953373784170724e-01   +7.080441486900918e-02   +1.577100592789004e-01   +2.033851064732377e-01   -1.140286244722322e-01   -2.894807700487436e-01   -5.844540730079744e-02; +2.576493797047897e-02   +1.124289347549401e-01   -2.905177208668890e-01   -1.638432325255720e-01   -2.842361458269034e-02   -2.453724703259079e-01   -1.950019179904147e-01   -6.997442296847327e-02; -1.103386096007238e-01   +1.053978498788402e-01   +1.712844676926868e-01   +3.713014389278589e-03   +2.150652935330115e-01   -9.659100097401034e-02   +2.247387631716163e-01   +1.656149552063764e-02; -6.651660652878885e-02   -1.040422166364995e-02   +3.191412915868636e-03   -2.171240367277504e-01   -1.786030207559251e-01   +2.997096565178747e-01   +1.830676285138740e-01   -1.603965381493191e-01];
L1E_L2E_iAMPA_netcon = [+4.222233571620505e-02   -1.112653384870636e-01   -4.442992016391913e-02   -1.770168926258152e-01   -2.020102446913305e-02   +4.133936925818344e-02   -1.401536744716492e-02   -2.239501622875825e-03   -2.394915215539999e-01   -4.005858203825065e-03   +1.171061672485889e-01   -4.840300272992672e-02   -1.563784699347343e-01   +9.307530483427329e-02   -1.820895450142808e-01   +2.633397369445726e-01; -9.662849132078040e-02   +1.176172107607703e-01   -1.626760149150456e-01   +1.957937384391822e-02   -1.161400152592548e-02   -8.859430462180304e-02   +1.634716327212591e-01   +2.178799178338426e-01   -3.129387923838124e-01   +5.999962566450798e-02   -1.590171948547328e-01   -1.835190859139496e-01   -3.687984381812043e-02   -3.055926924060770e-01   -1.117811068806066e-02   +5.100324500337611e-03; -3.306354620541545e-02   +2.483472781141505e-02   -5.991061449680473e-02   -1.624649583552102e-01   +1.629775130387206e-01   +1.852126313862602e-01   -1.769874323538812e-01   +1.204388384058440e-02   +3.085439025583424e-01   +2.449718870723754e-02   -8.561836352910190e-02   +2.028588064611844e-01   -2.108038572928223e-01   +2.152641005038211e-02   +5.215076325172409e-02   -8.350730760326562e-02; +5.740261722537239e-02   +1.867398773135525e-01   -2.330308777657891e-01   +3.747623496802535e-02   -1.195793241854025e-01   +6.332674070793273e-02   -2.005710532107126e-01   +1.805704466605900e-01   +9.165382446563540e-02   -2.171993395565716e-04   +6.942026666599384e-02   -1.560820771299793e-01   +3.203597907080365e-02   -1.049805556233740e-01   -2.346719444043284e-01   +1.849995341314217e-01; -2.107518234514742e-01   -2.077275110585582e-01   +5.590644079898595e-02   +2.899799218496172e-02   -1.856344180854028e-01   -6.350373575808616e-02   -1.790900307960023e-01   -3.637510291599348e-02   +8.160754934783680e-02   -3.189563387330828e-02   -2.268650922195999e-01   -2.737190087819796e-01   +2.368106818278301e-01   -1.380748661514563e-01   +2.485482641459191e-01   +2.076161132958857e-01; -2.321744257096303e-01   +7.648766504572402e-02   +2.174473455597450e-01   -2.644906541458028e-01   +1.339459558394837e-01   -2.415033892888566e-02   -4.119030418905267e-02   -6.888747494806451e-02   +5.293964965799303e-02   +6.389474391669991e-02   +5.441686199906470e-02   +3.963376386034952e-02   -6.033951520617387e-02   +1.560523334773682e-01   +3.671096713338186e-02   -4.807362058948272e-03; -1.049355159571866e-01   +2.700073396875142e-02   +1.064676901480698e-01   -2.589618818735754e-01   +5.519840552918073e-02   +2.869960811545008e-01   -3.015739973891297e-01   +3.327412552018361e-01   +4.449357712294835e-02   +1.623163317615551e-01   +1.606119268108390e-01   +8.916582641892978e-02   -5.880257970801002e-02   +1.491874968104363e-01   -4.235935001196484e-02   -3.624094426762269e-02; -1.625009969168076e-02   +6.660635513598584e-02   +1.148723227233079e-01   +1.317919588154601e-01   +1.963612162299910e-01   +1.777724698005002e-01   +7.681740462711553e-02   +1.738636736269338e-01   +1.055475914499824e-01   -2.584418589222932e-02   +1.370505980164888e-02   -7.854247216115484e-02   -1.920090253975595e-01   -1.563453255270872e-01   +9.904144745999401e-02   +1.107547037315119e-01];
L2I_L2E_iAMPA_netcon = [+1.944380850273505e-01   +2.200005194139078e-01   +1.318065933608936e-01   +3.036822877441343e-03   -2.016006615524408e-01   +2.074678805822062e-02   +1.154944852534913e-01   -1.621310510038820e-01; +1.534797044753151e-01   -1.163818181679733e-01   -2.803822743244030e-01   -4.772325998011674e-02   +2.691985942325091e-02   +1.959008518400055e-01   +2.098227298136179e-01   -6.137644708401832e-02; +2.754921095754913e-02   +1.596546269647292e-01   -1.164192533770759e-01   +2.366237207732633e-01   -2.711644586559133e-01   +3.848860097830301e-01   +3.415529360967505e-01   +1.090865507744458e-01; -1.269235925744980e-01   +1.989898891206190e-01   +2.593269388246860e-01   -2.422119967348453e-01   -1.683048395645050e-01   +1.643611979239767e-01   +2.860161562189935e-01   -2.050934203071978e-02; +8.502276664349430e-02   +1.141993251961529e-01   -2.849232623517935e-02   +1.526183465578311e-01   -1.671857657331089e-01   -2.900178050433598e-01   +5.224866682774260e-02   +6.182394143185250e-02; +2.261289542640266e-02   +2.359340111482466e-01   -7.784239806743606e-02   +7.026796683516030e-02   -1.482307782744096e-01   +6.055583663612839e-02   +1.943537538685673e-01   +1.043066102041668e-02; -1.134544937135843e-01   +2.563473218203082e-01   +1.683438738986876e-01   +2.681624586784061e-02   +2.251449265211709e-01   -4.885544400278424e-02   -1.711246086303707e-01   -1.012265177677532e-01; +9.818510772189280e-02   +2.143170806500943e-01   +1.621844800104430e-01   -4.533692405167875e-01   -3.555871013192287e-01   +2.625178438714362e-01   +9.720025620757265e-03   +8.179956359779000e-03];
L2E_L2I_iGABA_netcon = [+2.688088281025603e-01   -6.643793172342530e-02   -9.845535597238582e-02   +8.003215809598745e-02   +4.877927994496253e-02   +1.512672556841112e-01   -1.157537085256568e-01   -2.407245639384910e-01; -2.199278266642453e-01   +3.320705161910545e-01   -2.239345774567780e-01   +1.611901205106696e-01   +9.254232729162103e-03   +9.848909376782805e-02   -2.346106069779686e-01   +3.340701982761014e-01; +1.157462296235945e-01   +1.814231661950264e-01   -4.108272486067843e-02   -5.695328377329126e-03   +1.626314581274743e-01   -1.980257191303079e-01   +5.404494474993919e-02   +1.788252040592436e-01; +1.091762392828998e-01   -5.381526904874660e-03   +1.614108792925808e-01   -8.165035759914936e-02   -1.381534030361388e-01   +1.308133426179106e-01   +2.830074208553722e-01   +3.996271710368716e-02; -1.043960233263406e-01   +9.447427090474265e-03   +1.375862054954337e-01   +6.170709945555908e-03   -2.042268473703743e-01   -2.749793019501257e-02   +2.128087799979972e-01   +2.090916944200239e-01; -1.124478362311394e-01   -6.683713439825376e-02   +2.196970962463287e-01   -1.316813742398393e-01   -3.973934398413669e-02   +3.258781842660988e-01   +5.128249625524756e-02   -1.425292985713153e-01; -9.374498583634265e-02   +1.921711699198742e-01   -2.182121686478155e-01   +2.724821078409669e-01   -5.351478635729237e-02   +1.793749725461068e-01   -1.543220280759174e-01   +3.284903382059425e-01; +7.388904419764208e-02   +1.206138215593783e-01   -1.718677075644277e-03   -1.084968477042973e-01   +1.201336543199104e-01   -6.844018892880099e-02   -1.588406519196974e-01   +2.565828407368823e-01];
L3E_L2E_iAMPA_netcon = [-1.096764219388128e-01   -2.947913713010499e-01   -7.166508114037247e-03   -1.315404407846077e-01   +2.206846947541171e-01   -1.535321463180014e-01   +1.844283757507966e-02   -2.330729038429706e-01   -8.698162948458586e-02   +1.077832698423987e-01   -8.801304680483021e-02   -1.092512921072451e-01; +3.113872226895069e-02   -2.707593593463606e-01   -1.901362661628319e-01   +9.850376985811693e-02   -1.082039631799224e-02   +6.828348630147864e-02   +2.355187470741299e-02   +6.046991568006056e-02   -2.734539472682068e-03   +1.097297789745561e-01   -2.711072711632496e-02   -9.163424117393934e-02; +1.767600438474131e-01   +1.923129883138089e-01   -1.716899060987054e-01   +1.108978984455924e-01   -3.555105722157559e-01   -5.386702079292759e-02   -8.611007093996544e-03   -1.733538756767644e-01   -6.709624685669704e-02   -4.072807551741744e-01   -8.098505062716754e-03   -5.728641355023519e-03; +1.035537619963616e-01   +3.320019083383671e-01   +3.402710223865778e-02   -1.030791506434604e-01   +2.530615237598547e-01   -2.469868803328239e-01   +1.730732064261085e-01   +1.960706795243339e-02   -2.032896218741848e-01   -9.974932241914786e-02   +5.069402053748770e-02   +8.821672231260078e-02; +1.278259553354997e-02   +5.358559643913338e-02   -2.323897634875745e-01   +1.227552749582092e-01   +3.207897434490827e-01   +9.599701288822143e-02   +3.159037369387070e-01   +5.941033930150786e-02   -1.814876355590958e-02   +5.923296304748087e-02   -1.011529030897857e-01   +1.570340369047057e-01; -1.803382418953132e-01   +2.406734435488531e-01   -5.062785401628631e-02   +3.109351209503775e-01   -1.615457143799257e-01   +3.296689965154807e-02   +3.311986211548853e-01   +1.225238618923059e-01   +4.815259932191637e-02   +1.555458535579300e-01   -9.067371633349537e-02   +9.135216640575150e-02; +4.374850697790889e-02   +1.579108079196333e-01   +1.914136031808163e-02   -1.267321247780216e-01   +2.684359187131336e-02   -8.857247199412095e-02   -1.161699559279156e-01   -1.147533230156236e-01   -9.518965664413337e-02   +4.820130587232258e-02   -3.914508027562791e-01   -1.231583439645105e-01; -3.523153608341437e-01   +2.359232275937762e-04   -1.409046027463814e-01   -2.728023999959883e-01   -4.560876321564047e-02   +2.968493049379552e-02   +9.813541696501207e-02   +3.927974167664953e-02   -2.216895190532550e-01   -3.152745170196553e-01   +7.650809358501572e-02   -1.130669281329127e-02];
L3I_L2I_iGABA_netcon = [+9.611497070845024e-02   -1.808359229706018e-01   -5.174941444819949e-02   -2.006688820821913e-01   +2.351004713236992e-01   +9.494561900686357e-02   +2.039550215484645e-01   -2.271361613605720e-01   +6.548989499710396e-02   -1.290594822781908e-01   +2.546979472880480e-01   +2.755726677301689e-01; +1.623662988936366e-01   -9.103330026607788e-02   -1.564787530133271e-01   -3.986478805436707e-01   +1.353232381419978e-01   +3.881854767092537e-01   +3.446475149084896e-02   -8.389445790564962e-02   +3.611769093648603e-01   +2.067012939014482e-01   +2.272490954786217e-02   +2.491914211162850e-02; -2.513217401446870e-03   -3.589784511606718e-02   +3.209695309039907e-01   +9.231208314916360e-02   +3.419299461575310e-02   -9.357950704717649e-02   +2.267621478647930e-01   -1.841920628977949e-01   -1.116818923696004e-01   -2.226932836583645e-02   +4.073769278603338e-02   -8.692711538165737e-02; +2.941263325895368e-01   -1.083777427324335e-01   +1.403513517551224e-01   -1.731613213429103e-01   +1.311251432502757e-01   +1.373591270730848e-01   -3.661798982610331e-02   -9.609660976050562e-02   +6.215834684077649e-02   -1.832560061504050e-02   +1.908992894712798e-01   -3.960140810250263e-01; -1.934257296428672e-02   -3.066368735003864e-01   -5.966374737760760e-03   -2.850201368931285e-02   +2.258524669694682e-02   -4.762223188014056e-02   +1.637550768858910e-01   +2.017799790240846e-01   +2.217243980710012e-01   -8.033148055745842e-03   -1.790248156186030e-01   +1.511942793649010e-01; +9.105158647906092e-02   -1.284088687463244e-01   -9.687419306446605e-02   +5.302712690194748e-02   +1.160095729281780e-01   -1.428342858930587e-02   +1.857354383365673e-01   -1.159808789134411e-01   -2.833161341077671e-02   +1.416766974917619e-01   -1.385029790765850e-01   -2.979279701368100e-01; -3.876387411731203e-02   +8.505278354635538e-02   -5.931144546117037e-02   +1.848362556067079e-01   -2.689410126024860e-01   -2.187507847420266e-01   -4.276695751902652e-02   +2.772261560876630e-01   +2.658527964520178e-01   +8.096428892543082e-02   +3.882511659276611e-03   +1.115942834418915e-02; +3.281738812288450e-01   -6.873133824624308e-02   +1.711534519210241e-01   -2.191561085873786e-01   +1.487567503572927e-01   -1.861550226347621e-01   -1.909308934304980e-01   +1.768589706669802e-01   -5.107554107712882e-02   -2.622199554976209e-02   -2.029982625773229e-01   -2.116442237727760e-01];
L2E_L3E_iAMPA_netcon = [+1.183301519283372e-02   -1.710302901307570e-01   -2.382027098950212e-01   -2.058911510339400e-01   +1.510155927125947e-01   +2.943169554805712e-01   -2.734196343408011e-01   +2.204414048024682e-02; -1.087558600957965e-02   +1.280009982112861e-01   -3.758160832185799e-02   +2.362678295103169e-01   +1.593593349369758e-01   -1.020091653510432e-01   -9.370085384699595e-02   +2.071655743919141e-01; +1.895006567507000e-01   -1.751882532787081e-02   +1.435627816634152e-01   +1.139016284359783e-01   -1.161286323252082e-01   +1.897167587532148e-01   +3.983557150257119e-03   -2.656503183643792e-01; -1.842991624454658e-02   -1.777078333057253e-02   -1.524083861261199e-01   +5.262273130092139e-02   +4.931701168339701e-02   -1.715074552542021e-01   +1.682896786330539e-02   -6.851458802075432e-02; -8.814501298769845e-03   +3.092187726112952e-01   +9.049419494938674e-02   -3.620745461052022e-01   +2.855978263572496e-02   +2.954623777662756e-02   +3.177219503143768e-01   +6.476039383694778e-03; +2.410001460844605e-01   +4.606127573198418e-02   +2.260441587633655e-01   -1.828129859641947e-01   -8.551809965550716e-02   +2.746329634430915e-01   +2.538128547759249e-01   -2.387345324350790e-01; +6.082440422688078e-02   +1.662363041301022e-01   -2.301902878815004e-01   +1.322308797251136e-01   -3.260209612905358e-02   +1.526916296053898e-01   -1.724383693414097e-01   +1.744724363480145e-01; +5.864934845276137e-02   +7.692850981470775e-02   -2.422633838261708e-01   +1.008054322522710e-01   +1.937101335984470e-01   +1.266951691164404e-01   -3.601226465467690e-02   -6.981303849200958e-02; +7.119486314386492e-02   +3.340775063340535e-01   +2.861967146999831e-01   -2.110950684288934e-01   +2.290627076213185e-02   +3.373156025509907e-01   +5.142882059536981e-02   -1.116068777192052e-03; +2.395191826815482e-01   -1.511553042318052e-01   +1.597520815241002e-01   -2.288112765139705e-02   -5.502511894614723e-02   +1.361508826807701e-01   +1.873274351618669e-02   +1.100747430631008e-01; +1.811019353884749e-01   -7.312852265630224e-02   -7.532410926963273e-02   +1.146350036246924e-01   +8.287172408945567e-02   +1.012038899392209e-01   +2.093950131871457e-01   -9.613823221623810e-03; -8.627924950483412e-02   -1.018850757170795e-01   +2.775249456557419e-01   -2.684251696154917e-01   +3.149413015336018e-01   +1.115139872853978e-01   -1.826648258734654e-01   -2.139324316095347e-01];
L2I_L3I_iGABA_netcon = [-1.504202188881668e-01   -3.476907772247652e-02   -2.398900042321822e-01   +1.273576778198516e-01   -1.146103960369332e-01   +7.980987950459528e-02   +5.022894256256925e-02   +3.325968152742796e-03; -2.601114926535043e-01   +4.283647931519557e-02   -1.016581674353035e-01   -2.569924104846991e-01   +1.123791997738967e-01   -9.098992815363044e-02   -7.113711536061045e-02   -6.375446985360826e-02; +2.215682524904015e-01   -2.340791246553648e-01   +7.313344128883958e-03   +3.121564859496763e-01   -1.843800589898743e-01   -1.433619449350772e-02   -2.122946938271394e-01   -2.432029490788804e-03; -2.229074327574922e-02   +1.543858527206528e-01   -1.131399735394652e-01   -1.100543316440980e-01   +7.864790575076630e-02   -2.111119809205326e-01   +9.397326099358486e-02   -4.837744965766824e-02; +2.437808835292957e-01   +1.226997153622208e-01   -2.006284111412351e-01   +4.973660271351835e-02   +1.897581216739200e-01   +1.413734158495502e-01   +3.897356852590628e-01   -1.358130524376707e-01; -2.587507579229670e-01   +1.614721787941298e-02   +2.354936388442621e-01   -2.592520984698175e-02   +1.462461681907784e-01   +2.313141834714572e-01   -1.132795059528454e-02   +6.328262160556025e-02; +1.510497273369918e-01   +2.254107872239880e-02   -1.058949637659886e-01   -7.777756263166874e-02   -1.863272529939717e-01   -6.349934132861162e-02   +1.548264182882123e-01   -1.009297534245727e-02; -4.200657377595408e-02   -2.107990964853003e-01   +7.389079690582115e-02   -1.594981419576992e-01   +8.811177939180154e-02   +2.843507008839116e-01   +1.535818567115763e-01   +2.775923257056615e-03; -8.607144548234108e-03   +3.817627314771631e-01   +3.697156525562090e-01   +1.778369282149100e-01   -4.210358048095257e-02   +8.195663744197375e-02   +1.680400808229526e-01   -1.086946276778813e-01; -1.032848320484850e-01   +3.967437779355260e-02   -9.171112209702202e-02   +1.271601533331047e-01   -2.443177533684717e-01   -1.119117528336070e-01   +1.245388126531053e-01   +4.803766645435546e-02; -1.071089852822358e-02   +3.633982263391162e-01   -2.910716524635693e-02   -1.039668581250366e-02   +1.074572218941165e-01   -1.115243459859376e-01   +3.006926917089588e-01   -2.170114483074896e-02; -2.045670883252115e-02   +1.255723528234049e-01   +3.897025750055862e-02   -4.044628871158470e-02   -2.585029222575301e-01   +6.967623274635945e-02   -8.532428017110427e-02   +4.351384096956249e-02];
L3I_L3E_iAMPA_netcon = [-1.137697472850027e-01   +1.556713819678312e-01   +1.631075081752903e-01   -1.118451964694214e-01   +1.390868262507198e-01   -1.014128002652225e-01   +3.905407048245207e-02   -1.237595190157405e-02   -1.074398786489729e-01   +2.870730295861812e-01   -1.183245332473991e-01   -1.249452245225338e-01; +3.914209643224592e-02   -2.091350784985761e-01   +2.636434980302685e-02   -1.504496535081281e-01   -5.384764393620067e-02   -1.445221015057232e-01   -1.162813586671053e-01   +2.318927347390277e-01   +2.581085230319331e-02   -1.866697714574369e-01   -2.030985117049847e-01   +1.129656328123846e-01; -2.138169712373775e-01   +1.110592739229453e-01   -3.292871229135025e-01   +1.085031659005871e-01   +1.725793351327121e-01   -1.269913251661479e-01   -1.726874589122494e-02   -2.202897100257691e-01   -1.100765119714232e-01   +2.735272215489877e-02   -9.785773226378147e-02   -1.584145458372425e-04; -1.085443645387493e-01   -5.742762050911700e-03   +4.572086061105468e-02   +3.037261819017976e-01   +2.508916973173583e-02   -2.289334957518944e-01   -3.915900495428837e-03   -1.434651600251503e-02   -1.435652252189148e-02   +7.321743209440389e-02   -1.756555966189707e-01   -1.379009101329629e-01; -1.329403249589526e-01   -1.122170724812714e-01   -3.615760972058650e-01   +6.218923929747214e-02   -2.852401052464495e-01   -2.073385444764637e-01   -1.035919153528651e-01   -1.688838245812874e-01   +1.464759379732346e-01   -1.869828771140517e-01   -2.956190358098596e-01   +1.928151340113961e-01; +3.059453693815322e-01   +1.671635598585152e-01   -1.043691793046228e-02   -2.941375020194346e-02   +1.645325203577607e-01   -1.217107009053239e-01   -2.026941358817258e-02   +3.191449190260280e-01   -4.840228174271390e-02   +2.729328053650870e-02   -1.810023445933180e-03   +2.013794067906859e-01; -1.270621698521773e-01   -7.557583028933582e-02   -2.027882655873057e-01   +2.084308646073316e-01   +1.597539368315598e-01   +2.481715548442738e-03   -1.429584757523706e-01   -1.372229529660139e-01   +2.363523600924653e-01   -1.440046632090891e-01   +1.506675405451418e-01   -2.802165905332210e-02; -7.583558389564744e-02   +5.430742120369747e-02   -3.392055892797651e-01   -1.073760747878137e-01   -1.874309991377496e-01   -1.757075666294450e-03   -2.576218211674286e-01   -4.169140736400923e-02   -1.037394654821125e-01   +1.708675567730458e-01   -2.034034822757759e-01   -2.432881504666413e-01; -2.967368879465541e-01   -1.089526753211528e-02   -7.169155808262766e-02   -3.954600457500398e-01   +1.814591733557712e-01   +2.634988010332461e-01   +1.824745687615679e-01   +6.848733010565757e-02   -6.257129885022073e-03   +1.643901179062115e-01   -3.078848192671511e-02   -8.450588867767123e-02; -2.540079309381374e-01   +1.789363462704953e-01   -1.450425374242302e-01   -2.246807447819225e-01   +2.259274732490576e-01   +2.938631953862866e-01   +8.305060592951480e-02   +2.427072552786695e-01   -1.009551240478891e-01   +2.276408034646223e-01   +4.147228798261686e-02   +4.377969716750302e-02; +7.445352330611699e-02   -1.633446567956044e-01   +3.075799649935753e-02   -5.544957644198375e-03   -3.412049653194132e-01   -3.538353244949189e-02   -1.930110811062807e-01   -6.544350947503080e-02   +4.310007124250560e-02   +3.010230903659525e-01   -1.194038372673135e-01   -6.874371863988389e-02; -1.916336096103115e-01   +1.951581460197638e-01   -1.979453027502077e-01   -6.605587793020179e-02   +3.483970082009097e-01   -2.986934511629372e-01   +8.037239448601052e-02   +1.410249006113200e-01   +7.451974858909213e-03   +1.648998388637326e-01   -1.143631742445426e-02   +3.506095296428985e-01];
L3E_L3I_iGABA_netcon = [+3.152760735540871e-01   -1.297713738076591e-01   +9.604726165664074e-02   -1.290435861433771e-01   +2.704894498019299e-01   +1.272225601781906e-01   +4.222318749509379e-02   +4.985153471554465e-02   -4.027301098432044e-01   +3.748553198141722e-02   -3.163846896920451e-02   -1.017958025099172e-01; -1.420633081254271e-01   +3.067409303121319e-01   +8.782913168833685e-02   +9.702367445987820e-02   +7.452668399049994e-02   +9.642868242874619e-02   -8.052612284936675e-02   +1.770287856316518e-01   -3.375255170743850e-02   -3.058395969589854e-02   -4.194063515919020e-02   -2.729781479264545e-01; +2.767363110789376e-02   -2.019866794706462e-01   -2.324540424721635e-01   +1.246518024272376e-02   +2.524387194152878e-01   +1.619235509197023e-01   -5.753110037337998e-05   +9.176410503234697e-02   -1.422355371707991e-01   -8.624461074298605e-03   +1.718969723069029e-02   +3.551826818375346e-02; +2.198748512035926e-01   -6.246875498543016e-02   +2.645193228810488e-01   -1.926516641593727e-01   -1.910009887535181e-01   +1.691838576163569e-01   +1.728052762721466e-01   -1.226628073588046e-01   -1.833415234434405e-01   -1.413654022714859e-01   -1.097710987104185e-01   +1.081500433919116e-01; +1.376560225527386e-01   +8.621103485659914e-02   -9.021662000367309e-02   -1.552201343557602e-01   -2.931251074257629e-01   +2.527850246266323e-02   +1.720854210354928e-01   -1.698233637911393e-02   -6.688960210032430e-02   -1.682016596883017e-01   -3.894010803243076e-01   -3.131333266377235e-01; +9.818081850198450e-02   -1.159079829673278e-01   +7.867840571097379e-02   +9.403756087571697e-03   -7.752000837663975e-02   -9.097515031616786e-03   -4.105556894567966e-02   -1.813113545300379e-02   -2.174141620313449e-01   -3.532884639523173e-01   +1.190537077227585e-01   -6.057779790712600e-02; -1.204264393575227e-01   +1.126009559171093e-01   -2.107173234689184e-02   +2.674030491142637e-01   +7.215516333766535e-02   -1.340496991788355e-01   -2.479376556433507e-01   +1.902547717939655e-01   +3.880898791589645e-01   +1.073727102906573e-01   +3.493788431379198e-01   -1.158929550248760e-01; -1.474806343882644e-01   -1.330121942307346e-01   +2.609464195919538e-01   +8.484939548180372e-02   -3.367229960762655e-01   +1.921766626111954e-02   +5.133091101633456e-02   +3.918816183638998e-01   -2.391814187762118e-02   -1.515805486913753e-01   -2.791266095627082e-02   +4.286138207772357e-01; -4.794530301818235e-03   +1.793583637413266e-01   -2.039666348879018e-01   -1.205494615720619e-01   +2.479808935806615e-01   +2.221372927257624e-01   +2.520137857510262e-02   +2.467897343923580e-01   +4.700155947125166e-02   +2.018920359930001e-01   -7.376676753612060e-02   -4.454847194848988e-02; +6.962511924582024e-02   +9.444462141394620e-02   -3.723769363171382e-02   +6.783288348234201e-02   +8.372447413883156e-02   +1.364740447657005e-01   +2.008698464852493e-01   +1.278844554702210e-01   -1.488794752039917e-01   -2.058897519924761e-01   +1.809826536358413e-01   -1.683158406695936e-01; +4.321714279716674e-02   -1.386089331151575e-01   -9.731336829073692e-02   -1.935883100094170e-01   -2.552496623762559e-02   -5.040350283829059e-02   -1.016751204299085e-01   +2.267639463901605e-01   +1.494348491078228e-01   -4.425822912806070e-01   +1.378408311068845e-01   -5.952947617877502e-02; -6.902906824735294e-02   -3.074637797428798e-01   -1.589545724232574e-01   +1.699748233903998e-02   -1.156004781465424e-02   +1.375796877174263e-01   +1.916614025519197e-01   -5.942973991306082e-02   -2.386218420659558e-01   -2.113371584440459e-01   -1.508784100422219e-01   +1.571745757624352e-01];
L2E_Input1_iAMPA_netcon = [-2.449083636266625e-01   -1.355997256187125e-01   -9.603594682971263e-03   +8.387109421751174e-02   +5.709480025316853e-02   -5.524130546168586e-02   +1.254259910418596e-01   +6.454735964700573e-02];
L2I_Input2_iAMPA_netcon = [-9.989333307188568e-02   -1.224474977381321e-01   +3.260960974928556e-01   +5.172424183067445e-03   +1.169684291713994e-01   -8.555321323272327e-02   +1.044118640715440e-01   -1.416401153125499e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
