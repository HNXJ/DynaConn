function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.497928324790181e-01   -3.913742834918987e-01   +8.005586414142259e-01   -6.543527132878721e-01   +1.439601200433589e-02   -4.878975628649707e-01   -2.561051487292507e-01   -5.147155425470719e-01   -4.033234301918159e-01   -4.520761138852826e-01   +5.624904468759842e-01   +3.700743312823332e-01   -5.724705870258062e-01   -2.172904799124174e-01   +2.634006786064426e-01   -7.616698361062489e-01; +6.277780339253316e-01   -2.518868486273517e-01   -3.222488211702553e-01   +4.495431057300400e-01   +4.012911066016335e-01   -3.049304026898125e-01   -8.114541768672381e-02   +1.197541786256976e-01   +2.178312264781183e-03   +1.023115560908710e-01   -7.706769332982337e-02   -5.027067527414883e-01   -2.258297448900345e-02   +6.963531870829593e-01   -3.863124677983928e-01   +6.587118209366996e-01; +4.629805525612607e-01   +4.556436314206584e-04   +2.311074419100625e-01   +3.762748090238800e-01   +1.451785246052540e-01   +5.685835384570561e-01   -4.858544107608258e-01   +4.249187524533825e-01   -6.341787729559277e-02   +6.669988810541377e-02   +2.718938837681545e-01   -1.772897594350866e-01   +2.966279290924074e-01   -1.483415681874816e-01   +1.056107005570217e-01   -2.963275791781078e-01; -5.491877814332969e-01   -7.144777378379137e-02   +9.695843191764653e-01   +2.417646408633169e-01   +6.716088198554090e-01   +4.166114201195174e-02   -5.522708511991473e-01   -3.185536575425457e-02   +2.683865333345611e-01   +4.497584513186730e-01   -6.011315481426071e-01   -3.363418455370279e-01   +1.121562790740656e-01   -2.312036822202321e-01   -3.166905384342775e-01   +3.377018368442631e-01; +4.438413448696815e-01   +3.573749843363517e-01   -3.123462152678856e-01   +4.687483319012766e-01   -5.607482106672680e-01   -2.142295148589842e-01   -4.540663937446769e-01   +2.217633579703976e-01   -5.750532072452421e-01   -3.794125745462008e-01   -2.270440591908278e-02   +3.270889085612559e-01   +5.651430462199116e-01   +3.530984618658051e-01   -4.045112097230981e-01   -1.653550961656721e-01; -5.339044042005793e-01   -6.974189811150044e-02   -4.008719730000885e-01   -7.628666987922771e-01   -2.755699452574951e-01   -5.143549152858157e-02   +7.195470304596029e-01   -3.153038465472306e-01   +1.162697005038855e-01   -4.513423688174010e-01   -2.457223033060160e-01   -3.025463956562374e-01   -2.557033389099210e-01   -5.417439828417062e-01   +5.225960279828020e-01   +4.418995153475607e-01; +2.128623756756475e-01   +7.374727297948106e-01   +1.133147984436107e-01   +6.238499224271014e-01   -3.391183545517557e-01   +1.505738456062091e-01   -7.530721138063473e-02   -6.403547942849305e-01   +2.297747021166882e-01   +5.709540874473688e-01   -2.124516479366699e-01   -3.518989053772545e-01   -1.850709364633312e-01   -8.142824903777901e-01   -4.854376958503762e-01   -1.913920590796399e-01; -2.808196441950343e-01   +2.656000886408805e-01   -2.258366493449155e-01   -6.569774605736421e-01   +1.276066191772904e-01   +6.368623366678735e-01   +7.575917679938136e-01   -4.404483391130541e-01   -7.939981241722850e-01   -1.626688352897787e-01   +7.053212991524409e-01   +5.439369450502074e-02   -4.785449550522278e-01   +6.639953630154647e-01   -1.480485497439386e-01   -1.400010211483495e-01; +9.157355977616344e-01   -6.277072003394967e-01   +2.559115308340618e-01   +6.663608725394903e-01   -6.011230415432752e-01   -2.714256444199614e-01   -2.825540751499425e-01   +7.546560335415540e-01   +5.302005735069072e-01   +5.197047850020666e-01   +4.718228092788279e-01   -2.939971252106250e-01   -2.130216104761879e-01   -3.702719682013813e-01   -7.170134267325217e-01   -6.796420459043172e-02; +3.790095520093143e-01   +4.950454734485368e-01   +3.283816791917150e-01   +3.135207993253731e-01   -6.786548025212035e-01   -3.555156836540310e-02   -2.192304736048393e-01   +1.362342089866882e-01   -2.309951913735972e-01   -2.197780591190218e-02   +4.717309174110593e-01   -4.549420989854420e-01   +6.803162359840279e-01   -1.117767428934386e-01   -1.829286321103166e-01   -6.128226438429043e-01; +5.849121727725327e-01   -7.499117463997994e-02   -1.990097284525968e-01   -1.390847059049210e-01   +5.478406502919824e-02   +4.394336935013342e-01   -3.365444395996745e-01   -5.409301432382180e-01   -8.915802808656394e-02   +8.788811205303045e-01   +8.393451361790853e-01   -2.544752489798678e-01   +5.726680062926974e-01   +8.674607188845206e-02   +2.254893375564516e-01   +5.421405699075498e-01; +6.722674421860644e-01   +2.466536312353571e-01   +6.282116435101132e-01   +1.000000000000000e+00   +2.624140645987937e-01   -1.269910047872548e-01   +2.427241792733136e-01   -3.107725544888641e-01   +6.334226368938954e-02   -2.818338859078005e-01   -4.022866660753027e-01   +2.910422644844333e-01   +6.527316079250868e-01   +2.672714103045157e-01   -3.685637096850100e-01   +5.068446742451918e-01; -3.908883153454370e-01   +2.692414476805637e-01   +3.063381175992317e-01   +3.244674105950635e-01   +1.705599552830173e-01   +4.906091056132666e-01   -2.921238004591983e-01   +6.031611963985231e-01   +8.611474253083500e-01   +5.843491838676894e-01   +3.636330296981572e-01   -3.087504343825164e-01   +4.716243906569449e-01   +7.500216882002178e-01   +2.166858495469229e-01   -4.685950812671821e-01; +2.430706098887727e-01   -2.712775930939828e-01   -4.852036205284271e-01   +1.920173550650414e-01   +5.457566041197950e-01   +7.076633807824523e-02   +1.339639778115773e-01   -2.751995449973192e-01   +1.939178736735325e-01   +3.887898642008257e-01   -5.061894401400810e-01   -2.362018456580858e-01   +2.217938081334895e-01   -8.171538188642959e-01   -9.236314362728987e-02   +7.438752315246144e-02; -6.318788721694401e-01   +1.863050855848664e-01   +3.006188992955521e-01   +5.158020664172753e-01   +7.436395767737598e-02   +3.817145486173568e-01   -4.625199494701486e-01   +1.924818577398276e-01   -3.927196477943785e-01   -8.886981173015903e-01   -7.771586272840432e-02   +4.269518726213022e-01   +5.526592626100766e-03   +5.049450240858608e-01   -7.839750176526064e-02   -2.402716884183041e-01; +3.817396406774261e-01   -4.256254820600468e-01   -3.823732593669025e-01   -6.327745732191281e-01   +2.130815319336547e-01   +2.180961490376530e-01   -3.228573991362870e-01   -4.776076445240588e-01   -2.106243189119689e-01   +4.784684304448473e-01   +7.929682779243449e-01   +2.225290390322454e-01   +1.517283075517505e-01   -6.145922414613323e-01   +4.299823320390207e-01   -2.253793867106428e-01];
L1E_L1I_iGABA_netcon = [+3.903164418126566e-01   +4.693686001043008e-01   +3.357133456502444e-01   -6.949147502631278e-01   +4.234628978708310e-01   +3.409647742871018e-01   +9.050003682366974e-01   -6.907904348406116e-01   +2.335279746576841e-01   -4.881043005773911e-01   +2.644182054511116e-01   -3.514079913832784e-01   -2.284678480139684e-01   +6.521241289502574e-01   +2.091875432649035e-01   +4.494885352681988e-02; -1.104014127541362e-01   -2.540190427382704e-01   +1.469784802728314e-01   +6.538931925155476e-01   +4.360476762301300e-01   -3.589837574630260e-01   -7.688810736243526e-02   -3.551068049023249e-01   +4.592880144136874e-01   +8.887965818587688e-02   -1.622392199831224e-01   -4.732755701789660e-01   +5.554325140148492e-01   -7.260463443475214e-02   -5.133065114074085e-01   +1.285473207639726e-01; -4.926958244914839e-01   +1.374463434049253e-01   -3.380479563199199e-01   -1.940048295933861e-01   -4.993346145607973e-01   -2.239321195762894e-01   +2.532904188786616e-02   +2.100043311663359e-01   +4.683068208878076e-01   +1.050851782444659e-01   +8.023946582188005e-01   +2.471026219026214e-01   +5.593884247904749e-02   -1.998090678447759e-01   +2.819120896959373e-01   +9.168609413753995e-01; +1.251397433790995e-01   -8.371688880520683e-01   -1.967569160920664e-01   -3.909170110797631e-01   +1.007666534951410e-01   -1.174166699123222e-01   +3.587086428316397e-02   +6.392358638309185e-01   +2.324985541887014e-01   +1.449300259739344e-02   +7.967483343582757e-01   -8.613094635890105e-01   -6.293507081837595e-01   +5.834039104886839e-01   -5.254275564872164e-02   -3.144392081817730e-01; +7.546914779071155e-02   -7.081819584319642e-01   +1.538271720620026e-01   -1.797975933349466e-01   -4.350252130847617e-01   -1.288410428420109e-02   -4.288273523404385e-02   -1.679999674114764e-01   +6.520135712929794e-01   +4.209995395548539e-02   +2.115357088123184e-01   +3.981220616952685e-01   +2.271403154172344e-01   +7.060023319437734e-01   +2.349880179952477e-01   +1.081341732356900e-01; +5.112462246482037e-01   -7.669932906035596e-01   +1.660825884418543e-01   +5.443686317999953e-01   +3.146157890663204e-02   -4.984324070621425e-01   +6.353748077075282e-02   +7.250636181027487e-01   +3.016947345401753e-01   +9.312545868716655e-02   +1.035025614497084e-01   +2.485711887472475e-01   +1.924997656062889e-01   -3.352344312014763e-01   +1.000000000000000e+00   -1.146248353370082e-01; +5.459287030550185e-01   -6.274622190403885e-01   +4.558194288513774e-01   +1.381707892205174e-01   +1.525933831900051e-01   -2.616079902978676e-01   -4.663585750660437e-01   +5.746066013410124e-01   -6.319174373478051e-02   -4.280790580643518e-02   -1.141929633269441e-01   +2.940323334677477e-01   -3.137398500769742e-01   +5.383134277791089e-02   -4.314688533741960e-01   -8.893660343864114e-02; -1.602512313260609e-01   +7.734083663947694e-01   -3.995708302595352e-01   +3.086945382514557e-01   -3.371964991763498e-01   -4.968609683091232e-01   -2.999674873951703e-01   -1.106428236394353e-02   +2.366310883760236e-01   -7.686324472029435e-01   -4.367305190866772e-01   -1.427788485373336e-02   -6.243768366373355e-02   -2.827427620351026e-01   -6.492188594791831e-01   +3.244985745903474e-01; +5.188337214511684e-01   -5.834388805327215e-03   +5.660269146229903e-01   +4.432574425308166e-01   -3.212664328702936e-01   +3.979354507202176e-01   +3.565382244164045e-01   -3.028158825638868e-02   -1.061907724750270e-01   -3.164117088321495e-01   -2.403554737044057e-02   -5.340463922794858e-01   +5.925183326176976e-02   +4.086074506648191e-01   +3.702239202828235e-01   -6.118922135938495e-01; +8.594637796691773e-01   +6.670988862392035e-02   -3.554912588673450e-01   -5.221673752148382e-02   -7.276045936099117e-01   -6.326713036237385e-01   +1.303486387172736e-01   -6.264962989279241e-02   -2.115295737171529e-01   -7.407229744311791e-02   +1.821365078792863e-01   +8.586352532348505e-02   +1.956496438936567e-01   +3.192554850273058e-02   -3.504046004902601e-01   +2.566120124931858e-01; -7.697618526098594e-02   +2.964957656720792e-01   +4.719018674965662e-01   -5.159579050339302e-01   +3.586769812310586e-01   -4.876780385780251e-01   +2.688033439155279e-02   +1.665436609374664e-02   +6.652449444962780e-01   -2.685448637413294e-01   -3.371720971352068e-01   +7.025026564011603e-01   +4.923893402657084e-01   -1.597947807002287e-01   +5.293882545870183e-01   -6.344053164463520e-02; -5.519256794656383e-01   -8.262962345151342e-01   +4.238061276571313e-01   +9.169968705101605e-02   +1.173800465746199e-01   +1.324340015029657e-01   +3.578153293213819e-01   +2.680688571572358e-01   -7.099493957723667e-01   +2.165706902731675e-01   +8.864858610531276e-02   +5.906818020263931e-01   -4.528389957052772e-01   -4.684725959632555e-01   +7.179163757030447e-01   -4.420393481497324e-01; -3.609385957127166e-01   +3.423615201444767e-01   +1.107227452336637e-01   -3.144360520248157e-01   -4.967106123676358e-01   +5.677429550477597e-01   -1.796416352323525e-01   +1.565212480144710e-02   -3.821030497861069e-01   +3.814151344034774e-01   -2.635827116523728e-01   -6.187947668484290e-02   -5.986608519994906e-02   -3.732582645889339e-02   -1.332037558870883e-01   -5.620374518246856e-01; +2.711436492833495e-02   +3.835105296476096e-01   -6.126671107023350e-01   +4.621194153933429e-02   +6.805109640149911e-01   -6.358366547105421e-01   +1.152609867141334e-01   -1.110562076166626e-01   +5.883209845459604e-01   -5.601908834793157e-01   -6.582606322711478e-01   +2.690672703312983e-01   -2.817243163353208e-01   +7.779621691907762e-01   -3.374479830340846e-01   -1.696519511728551e-01; +5.633367978648690e-01   -2.836106699137080e-01   +8.361616816059531e-02   -6.911052410964807e-01   -3.132110489990249e-01   +2.814093836315542e-01   +4.179459823126932e-01   -3.609413247576058e-01   +1.304598276146548e-01   +3.058842689612479e-01   -3.342717908703038e-01   -3.482999159944963e-01   -5.100027389825051e-01   -1.712375591793212e-01   +6.554014368503077e-01   -2.459322435448837e-01; +7.352702142753793e-01   +4.532948849826870e-01   -2.053703982446274e-01   -2.341671827608589e-01   +5.371391479065482e-01   -6.019042531360117e-01   -3.883130076276571e-01   -2.189602210384140e-01   -7.852160251501449e-01   -4.603808717759955e-02   +1.728669967209403e-01   -3.013534529487196e-01   +4.012697149724867e-02   +1.678172020769162e-01   -5.544700904158922e-01   +7.161952763655666e-02];
L2I_L1I_iGABA_netcon = [-5.461653842893357e-02   -6.049415427051494e-01   +2.324389526061065e-01   -2.376869624524458e-01   -3.457836795259943e-01   -3.165483983711240e-01   +9.176381880444279e-02   +4.550086165216411e-01; +7.044241659856739e-01   -3.789732551191192e-01   +5.539652148253873e-01   +3.393496841412014e-01   -7.547811254711798e-01   -1.845277008634811e-01   +7.070628298087929e-01   +5.639298685581930e-01; +1.591799264416450e-01   -9.877240975491035e-02   -3.545068247692513e-01   +1.120675299134181e-01   +2.113247838752038e-01   +4.634794305221856e-01   +6.461119286299867e-01   +3.751661271177261e-01; +2.253692750325742e-01   +3.222117011450880e-01   +5.273576262535852e-01   -2.623834871383712e-01   -5.709147000217827e-01   -3.967306713116880e-01   +9.015663954907098e-01   +2.584846640551073e-01; +1.579229603534615e-01   -3.898731502898689e-01   +2.491347338163880e-01   +6.133029193447668e-01   -3.692556880210414e-01   +2.221287318546203e-01   -9.632609346854316e-02   +5.524945933444430e-01; +1.631610345121152e-02   +2.636298491365839e-01   +4.861068108268761e-01   +5.349352555379638e-01   +5.586777000684253e-01   -2.000965692316790e-01   +1.000000000000000e+00   +1.031076001944727e-01; -3.619340358669582e-01   +2.631961187141973e-01   +8.471570903589690e-01   -8.375750973064706e-01   -3.857579740534431e-01   -5.273667013085924e-01   -5.554801710380061e-01   +3.322413124559004e-01; +7.539929814466140e-01   -3.255976559598412e-01   +6.894543048644131e-01   -4.395395508786518e-01   +3.385803878874246e-01   -3.537648335361162e-01   +9.665739919793588e-01   +1.377058152770536e-01; -5.500813643757914e-01   -3.553933463887176e-01   +6.303810831396331e-01   +4.842950157754792e-01   +1.210885458757469e-01   -3.176590311465010e-01   -8.624935653398210e-01   -1.437509037627487e-01; -1.716321590758557e-01   -7.017864147814630e-01   -1.447559577261985e-01   +7.140450134094508e-01   -2.316738884846555e-01   +5.197061687117750e-01   -5.580216016817912e-01   -3.501892057327793e-01; -1.905520815014407e-01   +6.772164668127066e-01   -6.030059626119267e-01   -1.715658803238459e-02   +5.244115914216314e-01   +6.455286679179936e-01   +4.194562016147857e-01   +6.216469459634502e-01; -1.560363882906813e-01   +4.846493284701476e-01   -1.415253425607766e-02   +1.442395074799716e-01   +2.463987331299376e-02   -3.948668395954066e-02   -2.520129552518082e-01   +7.418381767747235e-01; +3.097976337798518e-01   +7.792651983907095e-01   -6.846357244792194e-01   -4.843144311312317e-01   +4.232146229841653e-01   -7.635533558596755e-01   +9.097885472101687e-01   +6.002716849869084e-01; -1.552493590466370e-01   +4.980261161682543e-01   -1.763709888820545e-01   -3.132688481923550e-01   +6.422035987978982e-01   +5.652511164489177e-02   +5.096178789606778e-01   +1.093176901714696e-01; -4.732728013047092e-01   -4.816802160148962e-01   +9.372897330546400e-01   -3.560263603599029e-01   -6.924383697739509e-01   +1.481724383751079e-01   +3.247731754572546e-01   +4.623838425014304e-01; +3.639365203578834e-01   -6.249496917183458e-01   -7.788990373886742e-01   -4.882631241602517e-01   +2.452406809376936e-01   +1.558937908513236e-01   -1.019504717304424e-01   +2.183427096454659e-01];
L1I_L2I_iGABA_netcon = [-7.275627301694876e-01   +1.131283717015776e-01   +5.200842620131629e-01   -1.744574511844959e-01   +6.090006083664392e-01   -6.822138758858673e-01   -5.807825983620754e-01   -8.165045362916487e-01   -2.308348954898179e-02   -5.158051574296164e-01   -2.591080439391006e-02   +4.350204472415463e-01   +4.278644970578073e-01   +1.151632599423665e-01   +5.465365459426179e-01   +2.706555488817031e-01; +4.518893769109805e-01   +4.525096463511656e-01   -2.847934827063771e-01   +7.287089967065087e-01   -1.828622440273042e-01   -3.196755810993374e-02   +8.372209933164654e-02   +2.425430014579388e-01   +1.087961029958536e-01   -2.216527181568886e-01   -1.252354955679389e-01   -8.312247757935696e-01   -6.200437194587653e-02   -4.096806851923990e-01   +3.867230036015152e-01   -7.981933815567084e-02; +5.306985256675928e-01   +5.003167202358925e-01   -5.640079456511482e-01   -8.149296440278058e-01   +1.406115711197150e-01   +2.965079168660665e-02   -6.385516228584559e-01   +1.355395187255818e-01   +3.769791291456404e-01   -3.865748367459221e-01   +3.692234866291977e-01   -5.665730684945977e-01   -3.465252731378567e-01   -2.007529600083232e-01   -4.152158359517651e-01   -1.646602707449974e-01; -5.040187460314897e-01   +4.282286853079900e-01   -3.558192107221056e-01   +1.917495839292529e-01   -3.598354207712902e-01   -5.217629123740699e-02   -1.045075408154964e-01   -2.444854619188563e-01   +9.122993029526158e-02   -4.594817327191600e-01   +2.174430441801770e-01   -4.663619989483115e-02   -5.706670881115619e-01   +3.221638054972059e-01   +2.841000710837821e-01   -1.033227852711165e-01; -4.236854719579819e-01   +1.131063357177584e-01   +1.874539219040422e-02   +5.305347656336358e-01   -1.854501057576639e-02   -2.017079699346359e-01   +5.550081555505404e-01   -2.961005743696066e-01   +6.176707537074971e-01   -3.631532906248759e-01   -5.919735855329797e-01   +1.148700357432009e-01   +6.892235021045332e-01   +1.896859389949078e-01   +3.640519406114954e-01   -4.440192762505989e-02; -8.423500011493293e-01   -2.512572589469728e-01   -8.213425015305334e-02   +2.515807541851072e-01   -1.637715855540178e-01   +1.758543165490375e-01   -3.489570282304884e-01   -1.864415960631344e-01   +1.360056761178055e-01   +1.018779448209980e-02   -2.809093122446287e-01   -3.120715269482769e-02   -2.640783654184378e-01   -1.000000000000000e+00   -7.259291104704942e-01   -6.756673900654264e-01; -1.160178221164686e-01   -6.360243604425039e-02   -2.260528635090537e-01   +2.930940609355146e-01   +9.490471112165827e-01   +4.323290577433553e-01   -2.659955350730357e-01   -7.182767444479692e-01   +5.520749813687731e-01   +5.608062987456949e-02   +4.943847531566243e-01   -3.839258052438225e-01   -2.357723069006841e-01   +5.287086121093959e-01   -2.601633793711803e-01   +2.020914285007643e-01; -6.801875037141515e-02   +5.930588294659777e-01   -7.252138248319554e-01   -9.572866173829274e-01   +5.293069762854448e-02   -3.853677054115124e-01   -6.749832242440101e-01   -4.440039210347526e-01   -3.311789219175503e-01   +2.128136267841845e-01   +3.654239358729208e-02   +6.378420098014707e-01   +3.020793502853269e-01   +1.149834371663653e-01   -1.607992557121680e-01   +5.655482562722182e-01];
L2E_L1E_iAMPA_netcon = [+3.963989958532183e-01   -7.963511974151734e-01   +3.984775174394755e-01   -3.094065062820827e-01   +9.310601269178769e-03   -1.479967914982467e-02   +4.875085141348039e-01   +2.395814633155324e-01; +8.378632892575544e-01   -1.134784159562130e-01   +2.840884252054006e-01   +3.057160591605999e-01   -4.266005418241394e-01   +2.496479060919638e-01   -4.832898067436861e-01   +8.668337164943133e-01; -2.032469117865041e-01   -8.286243875684846e-01   -7.216662730122783e-02   -3.852623076039969e-01   -4.400833520423282e-01   -1.145731249188034e-01   +3.785463533395509e-01   -3.994265405596124e-01; +8.085525739609097e-01   +3.336943944274487e-02   +6.050642746470134e-01   -1.399563619282353e-01   +3.722127798778284e-01   -5.073625851961158e-02   -6.782857266116786e-01   +1.797692172040179e-01; +4.039216168505144e-01   +3.409096365234355e-01   +1.828425148181348e-01   -3.189108711459416e-01   +2.545302231794820e-01   -5.224415808903148e-01   +8.512334701049746e-01   -2.688970274804490e-01; -2.216786585771660e-01   -1.176143520702143e-01   -6.073142633466930e-01   -6.034869406959233e-01   +9.980927495215512e-02   +4.811985088328850e-01   -3.349132484828589e-01   -3.669499825938355e-01; +1.465881153258300e-01   +6.300599822635571e-01   -5.552729156729665e-01   +1.150857883214971e-01   -8.523033703666108e-02   +2.130634292239412e-01   -3.810779767353455e-01   +4.421313671456523e-01; +5.203950049740137e-01   -1.221579270968180e-01   -5.839040656983782e-02   +3.134661502084398e-01   -1.525520404965728e-01   -3.207681767501422e-01   +5.008387732844057e-01   -3.474576734407486e-01; +4.143853804634942e-01   +6.903690607560301e-01   -5.209357227073927e-01   +4.204565816871453e-01   -5.265892971678005e-01   -7.153659105480242e-01   -5.027018857469220e-01   -6.306149863679211e-02; +7.111204039892952e-01   +1.405226178981904e-01   -7.135640072873826e-03   -2.755600676626638e-01   +5.479021259588736e-01   -6.507878198082175e-02   -1.077452911955014e-01   +6.851049876653080e-01; -5.240990384031216e-01   +1.484601735843265e-01   -8.375958453471052e-02   +4.229440868322264e-01   +1.489513263552518e-01   -5.194197109525802e-01   +4.430796416965930e-01   -2.840786457393603e-01; -4.165344213614516e-01   -3.670059327075030e-01   -6.976468717454497e-02   +5.502739567478671e-02   +5.297167537361170e-01   +3.865576057350157e-01   -1.600482186976049e-01   -1.786569981974498e-01; +2.134421757742095e-01   +7.166558750548746e-01   +6.323357088574667e-01   -5.832950417656179e-01   -7.714192230798120e-01   +9.576521457787647e-02   +8.437863319773581e-01   -5.337918630681209e-02; -4.359519260465450e-01   +5.504764867729760e-01   -3.111831691824944e-01   +2.388218269505751e-01   +1.123722198459089e-01   -7.706620256221594e-01   +1.537044009594034e-01   +5.249927090882814e-02; -3.487662979695727e-01   +8.459139866100950e-01   -1.172004389026740e-01   +1.877404248587284e-01   +4.912830623076538e-01   +3.829195672997064e-01   -1.602193559637476e-01   +4.939829213964335e-01; -6.533275268745126e-02   +1.000000000000000e+00   -4.072859580253098e-01   +5.821623293561169e-01   -1.321413298157512e-01   -2.714763597526534e-01   -1.264578394259818e-01   -1.127312719679710e-02];
L1E_L2E_iAMPA_netcon = [+1.505751309356956e-01   -2.411466322936308e-01   -5.101837633660871e-01   -1.578364495213733e-01   +2.560507218187203e-02   +3.559589940253640e-01   -6.180663920737415e-01   -6.745772711928927e-02   +3.562297751511770e-01   -1.055268931532891e-01   +4.998693907609030e-01   -2.048486410977974e-01   -8.852576251107538e-01   -1.010988443981625e-01   +7.542001873742522e-01   +4.313737120689952e-01; -4.458388980237288e-01   +2.626066106846243e-01   +3.468552196034747e-01   -1.982572849256079e-01   -5.054984827446648e-01   -6.284925234174973e-01   -2.225776443092490e-01   -2.790112534144162e-01   -1.708222501322905e-01   -1.372451544237430e-01   -5.083479951065856e-01   -2.330476206276290e-01   +9.764437141238819e-02   -3.785698734020426e-01   +3.885586078164985e-02   +2.134572496620034e-01; -5.532824456817615e-01   -6.596561368769713e-01   +4.994996204885463e-01   +4.199907015931293e-01   -3.913472576829907e-01   +3.708033694683645e-01   +1.000000000000000e+00   +5.237800407931195e-01   -6.083516097109940e-01   -2.230194247035586e-01   -5.338950676589509e-01   +2.026679861457587e-01   +2.054518205803754e-01   -3.099025728290491e-02   -2.766005231910457e-01   -4.238290529160407e-01; +4.191766019804092e-02   -6.388160606985326e-01   +2.796625099336145e-01   -1.468747348693502e-01   -2.161603836280736e-01   -4.789158208263275e-01   +5.474618862667077e-01   +2.544055852006261e-01   -8.934714091114176e-02   -2.702473236321663e-01   -6.865379811976199e-01   -1.968410895828212e-03   +3.541686961993830e-01   -2.296718105377337e-01   +7.008212866258277e-01   -4.409442031820379e-01; -5.393265817214797e-01   +5.515157603713752e-01   +1.311632875422308e-01   -1.525084855399608e-01   -6.837858630520958e-02   +7.360606041131110e-02   -9.476580938319923e-02   -4.228356209113798e-01   +8.362086483006138e-01   -5.826978230962739e-01   +2.930008961796438e-01   +3.026091057939729e-01   +3.963164514438435e-02   +1.988250702074267e-01   +1.765634069327349e-01   -2.998194797530206e-01; +4.727586151527071e-01   -5.671895327938874e-01   -1.160598287445626e-01   +2.501597473446718e-01   -6.529257813274473e-01   -6.471522669616436e-01   +2.041097830127868e-01   +3.131350109000109e-02   +6.322438580651009e-01   +5.323984173108872e-01   +7.612815801409126e-02   -3.167869682496320e-01   +7.267455930519108e-01   -6.831699740048419e-01   +3.134823801268723e-02   -8.695889658253605e-01; +6.240020570720020e-01   +9.458324091799111e-01   +2.160079376911836e-01   +7.182589591764845e-01   -6.636668719943845e-01   +3.140588344453439e-01   -5.187685427375567e-01   -5.267942773446290e-01   +7.572124255183389e-01   -3.505031199519685e-01   +9.693375486604079e-03   +4.926627760473553e-01   +6.101296340236133e-01   +4.570569535091759e-01   +2.581832967485174e-01   +6.006824383230722e-01; +4.253978363846309e-01   -3.594733037298796e-01   -5.723522010721083e-01   +6.716919377025627e-01   +7.081303618548949e-02   -6.155127365344680e-01   -5.235206981458098e-01   +9.810303233492326e-02   +3.887163682505758e-01   -1.848185660231248e-01   -3.278895031061422e-01   +2.905278641642367e-01   +2.732794678922275e-01   +6.647458263502741e-01   -7.265774020954097e-03   +8.818546220054420e-02];
L2I_L2E_iAMPA_netcon = [-1.059595822509082e-01   -5.186572408838144e-01   -4.857173786618856e-01   -1.885666390156540e-01   -7.655645160954985e-01   -1.756702576924252e-01   -6.525630598860511e-01   +9.787248331812896e-02; +2.174176335250549e-01   +1.394872423613218e-01   +1.335145798525488e-02   +2.097417302929533e-01   -1.562889879752275e-01   +4.504959455734098e-01   +4.331530072019350e-01   +2.029581116188224e-01; -1.212380949081276e-01   +5.544459807401528e-01   -1.401817224625004e-01   -1.021001318606792e-01   -3.832882032860501e-01   -4.000278132157332e-01   +6.534896461342418e-01   +5.595481986469674e-01; -1.651777595163295e-01   +1.695262425669671e-01   +3.072270723666828e-01   -1.617780476952058e-01   -8.327441751209196e-02   +3.067808341691277e-01   -1.496090107560254e-01   -1.465110548291793e-01; +6.020156089978264e-01   +4.729761698880259e-01   -5.775336021786222e-01   -6.135477773649102e-01   +1.789207392001997e-01   -5.451050162220246e-01   +6.120963686715625e-01   -5.843314137781447e-01; -4.677899066520087e-02   +6.788951004028012e-01   +9.275492456222799e-02   +3.988379017534764e-01   +4.132989688375348e-02   +3.897881771286630e-01   -1.094145793132712e-01   -1.664451701649147e-01; -1.454834715264095e-01   +4.846817294541668e-01   +5.528411610567483e-01   -3.207827992871331e-01   +5.296543359333421e-01   -3.412654191128421e-01   +3.747525336731118e-01   +4.308816831233336e-01; -1.985949824252429e-01   +8.497780493500620e-01   -1.184919060641747e-02   -1.000000000000000e+00   +2.592079158183328e-01   +5.196476580755038e-02   +6.835497304874919e-01   +3.533745572730018e-01];
L2E_L2I_iGABA_netcon = [-3.870363749512002e-01   +4.140517889071942e-01   -7.071817135417382e-01   -1.000000000000000e+00   -5.789103703397905e-01   +2.585797734903749e-01   +6.566077622030692e-01   -4.298529204453970e-01; +1.811758806212021e-01   -2.525339222578110e-02   +2.066462618273403e-01   +1.053234860063046e-01   -7.338523292166591e-01   +3.594187444793286e-01   +1.567137427697798e-01   -3.650452594001894e-01; +4.077773520948457e-02   -3.006652584354836e-01   +1.500633133961435e-01   -2.748589184695691e-02   +3.985572772023273e-01   +4.311162666394746e-02   +4.318067299280679e-01   -6.244525695792444e-01; -8.962098298711413e-02   +7.170769017987231e-01   -1.502887614084593e-01   -6.150531500558939e-01   +8.008147537012526e-02   -1.698095182567546e-01   +2.152103154929211e-01   +6.582102567517137e-02; +8.821851083457897e-01   +2.429830569974465e-01   -1.064032365225786e-01   -3.105686527278203e-01   -5.204052960069121e-01   -4.125850959670243e-01   +1.296259402342072e-01   +5.630106116124955e-01; -3.477945329483491e-02   +8.326543028693056e-01   +2.006491307348000e-01   +1.099691474407414e-01   -2.291742292451365e-01   -4.231015713209507e-01   +1.576931111759911e-01   +3.883207971148513e-01; -2.451125498736482e-01   +2.801805281612699e-01   -7.213514542467284e-01   +2.595271454489268e-01   +3.701263067827327e-01   -2.646678773663342e-01   -6.281599825972614e-01   +9.324788041184119e-02; -3.322123633633209e-01   +2.979817158045764e-01   -2.289018091990166e-01   +9.429353822916362e-01   -2.117730630600335e-01   -8.075357092723100e-03   -3.388191390344411e-01   -3.139266536827207e-01];
L3E_L2E_iAMPA_netcon = [+3.039071397650500e-01   +6.068581007891041e-02   +5.703657925909699e-01   -4.659948705361633e-01   +8.050495763700559e-01   +6.442494992976716e-01   +4.428529207495039e-01   -4.872164547148814e-01   -5.106169392618060e-01   -8.443986855994898e-02   -7.469679198990574e-02   +3.357354147459965e-01; +1.733430843835430e-01   +7.417499098133652e-01   +7.110675084245770e-01   +1.451677954542719e-02   -4.919908777177158e-01   +6.439979755707371e-01   -6.949273951452336e-01   -3.040474754962405e-01   -8.497797113037395e-02   -7.699541726949989e-01   -1.308238670167236e-01   +5.544791735045679e-01; +1.123307787913140e-01   -2.906183352033203e-01   -1.412215117344138e-01   +4.174848151616157e-01   +7.598037786975192e-01   -3.944331750359240e-01   -4.214589718773798e-01   +5.203622743296492e-01   -1.136781393629051e-01   -7.462044044187033e-01   +5.690158453156944e-01   -6.202096208986498e-01; +4.438421881495795e-01   +6.304247893700630e-02   -7.568361438495776e-01   +5.890156423563626e-01   -2.558591334437456e-01   +3.559255578872525e-01   -8.520253364683410e-03   +7.505344403791597e-01   -1.363178113898792e-01   -1.922812554054689e-01   -2.802359517344648e-01   -4.760543074756000e-01; +5.899102556701169e-01   +7.868837860466662e-01   -1.614537534231829e-01   -3.770707666223773e-01   +1.263599927783424e-01   -9.918790072677689e-01   -2.819560620130860e-01   -4.003379251637696e-01   -3.044773321070544e-01   -4.782020434642057e-01   +4.021543147622191e-01   +4.198846850847297e-01; +6.511279355447487e-01   -9.044382923247730e-02   -3.349950115822221e-01   -8.138816258125751e-01   +6.163076035991152e-01   +7.136956818673263e-01   +5.471359383706156e-03   -5.056553784360567e-01   -3.198503166332725e-01   -5.330908888433542e-01   -1.674279526484715e-01   -4.716280292403895e-01; +4.621393674254411e-02   +1.514975919394831e-01   +2.910172794566303e-01   -8.894892641703560e-01   -1.539358436314025e-01   -8.842334584536485e-02   -3.138609991003864e-01   -3.192037252741251e-01   -1.547321538834877e-01   +3.209438584786448e-01   +6.622892500951030e-01   -1.000000000000000e+00; +2.519452864748652e-02   +7.016257179860000e-01   -2.116996554058711e-01   -8.267103381948837e-02   -5.512230194588122e-01   +9.747709496312745e-02   -2.464882058835024e-01   +1.947141306242458e-01   +5.854101642747991e-01   +6.776937525251415e-01   +7.807776253702010e-01   -2.238046564587280e-02];
L3I_L2I_iGABA_netcon = [+6.501959955857738e-01   +5.457506399767430e-01   +4.918222036116003e-01   -5.254138052208834e-01   +1.072069644047707e-01   +2.663493919213251e-01   -2.597507258427349e-01   -1.032456423018728e-01   -1.490236306895809e-01   -8.329723518938387e-02   +6.380460100463681e-02   +1.196269256960950e-02; +4.774025468508403e-01   +4.213621793572182e-02   -6.136086524165215e-01   -2.096945077816693e-01   -3.175516887884989e-01   -6.550614878111134e-01   -8.252914305400944e-02   +5.454057506010339e-01   -7.311003746888152e-01   +2.597303537671145e-01   -1.883654879920550e-02   +3.499290723316067e-01; +2.197546652710517e-01   +5.174411810107062e-01   -1.925247206160466e-01   -1.446145036891023e-01   -2.335445558790399e-01   -1.707059091281422e-01   -3.338831719659089e-01   +1.162973402432802e-01   +3.155481867984801e-01   +7.133365088702034e-01   -9.018617052890077e-01   -6.013819483925272e-01; -6.030488942752704e-01   +9.565655291912241e-02   -3.134749218948478e-01   +4.919614128337322e-01   +1.238475174035919e-01   -3.850035937130478e-01   +6.855780272318707e-01   -1.010322267930803e-01   -5.620196134314448e-01   +3.554121764427834e-01   +4.477402164134425e-01   -2.992367899311282e-01; -4.073212156543077e-01   +4.781392994103019e-01   +9.238048808817614e-01   +3.945781340811398e-01   -7.648617215230541e-02   -1.591014003081484e-01   -6.976531294199934e-01   +2.094570436573620e-01   +2.077128744885660e-02   -4.960427475677698e-01   -4.346929163125459e-01   -2.890051368546074e-01; -7.078725727322873e-01   -6.230201641582690e-01   +5.454449372505831e-01   +3.231231191325442e-01   -5.319974061583456e-01   +2.321946335524012e-01   -6.089343264726949e-01   +6.981588422797432e-01   -1.589927577726814e-01   -2.816262786621465e-01   +2.858522886333290e-01   +6.685233976350962e-01; -1.993373399396973e-01   -4.943007744388489e-01   -3.966992671789175e-01   +3.934373229757160e-01   +3.916735971219478e-01   -6.731634053952379e-02   +1.108400162054360e-01   -1.416209023804834e-01   +1.000000000000000e+00   +1.239941550207146e-01   -2.310457810233987e-01   -1.594332766659947e-01; +6.072871164342059e-01   +7.174643178421911e-01   +7.625516120514874e-01   +2.011096318103163e-01   +4.501873568960574e-01   +6.045244994452948e-01   -4.912744123307654e-01   +6.208657683672018e-01   -3.674137689806416e-01   +6.211129526427108e-01   -2.448867056085859e-01   -5.620951189964360e-01];
L2E_L3E_iAMPA_netcon = [+5.759321145133542e-01   +4.358212042568604e-02   -4.187898119251868e-01   +8.571356014974700e-01   +2.632664047518417e-01   -2.023897568276733e-01   +5.363874778765583e-01   +4.112321399238388e-01; -3.596554971401195e-01   +6.631824372600519e-01   -1.907977623740121e-01   +4.401186456574260e-02   +5.241919552539460e-01   +4.816038693952909e-02   -3.805205671605287e-01   +1.864352774158879e-01; +6.790705426103785e-02   -2.505061842343840e-01   +8.053303362678214e-02   -2.762535964265674e-01   -3.413625763679895e-01   +3.355094556702812e-01   -1.000000000000000e+00   -5.547356893212928e-01; -1.398821611134193e-01   -7.341922291569276e-01   -4.932409016817109e-01   -5.515906352568928e-01   +2.878787687644230e-01   +4.325889950941307e-01   +6.887144928774320e-01   +4.070063483538219e-01; +2.627402451201499e-01   -5.065379590653579e-02   -3.234444964456841e-01   -2.860578942644082e-03   -3.387447548493370e-01   -2.499977929833422e-01   +6.029014519408187e-01   +6.816687564624776e-01; -8.924108331147371e-01   +6.091733875535794e-01   +5.561764028597367e-01   +2.947107549250531e-01   -4.246739309569800e-01   +2.309420302288850e-01   -3.605961355340961e-02   +2.029066360176285e-01; +2.208173852613262e-01   +2.909268859717268e-01   +6.126748302109503e-01   +4.314384098881682e-01   -3.165876942085883e-01   -6.101814675785613e-01   +4.106168790376140e-01   -3.210869317439798e-02; -5.110984500404370e-01   +5.568290681304970e-01   -1.031471283763071e-01   +2.019540276093760e-02   -2.152030429461093e-01   +2.467117274013639e-01   -3.893500122417948e-01   +5.997539990839049e-01; +2.079505013918425e-01   -2.187787609813558e-01   +2.371418044818055e-01   -4.214350482923057e-01   +1.052287911958261e-01   -7.384873951054517e-01   -6.362517492795187e-01   -1.843259815731847e-01; +6.751645207684930e-01   -5.870480786402972e-01   +3.719495473651857e-02   -5.117180904273789e-01   +6.336995340747215e-01   -1.812682413294512e-01   -6.013000371965658e-01   +5.118455148846058e-01; -3.470282067817748e-01   -1.644320877397596e-01   +3.419298707119755e-01   +6.054389328657175e-01   -2.878460845444321e-01   +4.318902076496068e-01   +3.175645774144895e-01   +8.040394259843657e-02; +4.599358930053890e-01   +2.257433692040529e-02   -5.024208552873731e-01   -3.117402917979237e-01   -1.393142695320701e-01   +7.894698608448121e-01   +4.180787044725930e-02   +2.505526472338845e-02];
L2I_L3I_iGABA_netcon = [-2.963165046781530e-01   -6.437153319421815e-02   +5.056944124799062e-01   -3.215185513757640e-01   -7.463791953400605e-01   -2.701497639067271e-01   -5.723808050394441e-01   +5.776432340302772e-01; -4.929156857943066e-01   -3.284260292075025e-01   -1.192679301207388e-01   +8.187233113056941e-01   -3.494402600457847e-01   -3.263042927986859e-01   +4.162836162535485e-01   +1.163250025708808e-01; +2.213513062181779e-01   -7.373865261656776e-02   -4.026520872957376e-01   -1.161740301321336e-01   -2.515881214905524e-01   -1.752865211095097e-01   -5.427878557675497e-01   -4.874654854667125e-01; +3.953231404832434e-01   -5.303144679477955e-02   +4.590696196894826e-01   +3.548626157722292e-01   +7.279259663587783e-01   +6.481053590872009e-01   -5.975259691373156e-01   +1.164297234271408e-01; +5.261680410367214e-01   +4.263443534117780e-01   +1.404611318048222e-02   +1.133511287109424e-01   -4.445998178432944e-01   +3.403124099821291e-01   -4.369703195489776e-01   +1.000000000000000e+00; -1.075893790489637e-01   -3.623394458585383e-01   -2.699001882766618e-02   +1.770384507772707e-01   -1.610253227623613e-01   -4.131554496416776e-01   +5.959425460912540e-01   +1.912385524340981e-01; -3.373525002160263e-01   -2.918952279802147e-01   +5.555149193572573e-01   -6.771820865938293e-01   +4.325119786303230e-01   -6.786426461015108e-02   +3.319996321142687e-01   -3.349453722644057e-01; +3.704334175677136e-01   +2.931127792439288e-01   +5.402487261779915e-01   -1.243939342078330e-01   -3.735213155012140e-01   -4.000540404531439e-01   -8.588662725339810e-01   +1.790297855154177e-01; +3.253094856649044e-01   +2.326412019890114e-01   -8.899679538566669e-01   -3.375594302612137e-01   -3.903747960607815e-01   -3.223561539560972e-01   +7.662092882467104e-02   -1.036732378063405e-01; -3.644739973167682e-01   +3.668490039111753e-02   +1.941900632368192e-01   -6.752366330084775e-01   +3.369745228074764e-01   -7.307102604157658e-01   +3.305871271178331e-01   -2.648719782356994e-01; -3.360607744949774e-01   +5.036610876016921e-01   -3.141161987352086e-01   +1.290469183988835e-01   -3.179016651117444e-01   -3.676100248453429e-01   +1.642353195278737e-01   -5.074360810122299e-01; +5.191667083000284e-01   -2.984746310681767e-01   -3.347718439612895e-01   -1.685136311705164e-01   +5.275639950579958e-01   -5.340800459581596e-01   -2.852207241473901e-01   -5.732204949891796e-01];
L3I_L3E_iAMPA_netcon = [+5.695469156624163e-01   +5.598555193166903e-01   +5.013420231135182e-01   +2.031131581049665e-01   -3.557456264487394e-01   -4.968269536534932e-01   +4.617163217994078e-01   +2.291618117667638e-01   -6.961135119428354e-01   -1.162567287237348e-01   +4.469149385902662e-01   +3.796793979499137e-01; +4.416657209713501e-01   -2.152929566140240e-01   +4.141523518457029e-01   -1.549906862037037e-01   +2.993640106643539e-01   -5.323585794612699e-01   -6.039056224472326e-01   +8.882984718673272e-02   +5.442987222530989e-01   +2.031135548791236e-01   -7.393791051634058e-02   -1.555752287070531e-02; -3.124068184529163e-01   +6.250758391279359e-01   +6.560242432745940e-01   +5.357027178885165e-01   +4.894713654305486e-01   +1.066633810831252e-01   +1.703521293317951e-01   +3.135627581796570e-01   +9.634932023195740e-02   -1.716998514630277e-01   +4.618755693381882e-01   -6.036757888415187e-01; -3.055224064302715e-01   -4.275835181851560e-01   +7.724091861535269e-01   +3.024270084138977e-01   -2.093045072935048e-01   -3.947666917394990e-01   -2.293534104568851e-01   +4.599414166485921e-01   -4.559650453028199e-01   -2.775291545016656e-01   -5.391430940914225e-01   +4.313117126850332e-01; +4.394426134193638e-02   +1.180508261198333e-01   -4.124141343194881e-01   +5.768844765947646e-01   +6.063154402518827e-01   +5.042816625477353e-01   +4.913206367357116e-01   +4.620947111499764e-01   +6.891590856756695e-01   -1.070560649205546e-01   -3.651656284005190e-01   -2.084040570037315e-01; -2.613910710924390e-01   -4.809485067675831e-01   -2.962413384481103e-01   +7.244850203720249e-01   +1.141590308404886e-01   +7.898025593526690e-02   -4.792955145409297e-02   -4.331443742626082e-01   -4.322253954028603e-01   +4.408382671014789e-01   -1.101564527594746e-01   -2.519443488821473e-01; +1.139767257866653e-01   -2.828936594761730e-01   +1.789012856538904e-01   -4.386377962498296e-02   +1.000000000000000e+00   +1.577393826546028e-01   +1.102909390696889e-02   +3.785026820290667e-01   +3.926282087058051e-01   -7.679358841424976e-01   -3.682896782292993e-01   -4.438562834331593e-01; +2.959474062031430e-01   -1.714150959153750e-01   +3.584360814347164e-02   -5.222692459615133e-02   -3.873977414776120e-03   -2.204679582682048e-01   +3.530600624132739e-01   +3.945820659871218e-01   +1.278811192264616e-02   +8.854611192309679e-02   +1.824910425358227e-01   +2.950485687779847e-01; -7.605119171698358e-01   -3.179575745338873e-01   +6.473710747175425e-01   +3.081047114202605e-01   +3.756629685933398e-01   +1.509656000620812e-01   -4.168656376884984e-01   -2.975140013459177e-02   +3.367100803207580e-01   +3.589568033813359e-01   +4.239907854688364e-01   +2.020685922044424e-01; +5.235509117559035e-01   +3.988071197704093e-01   -6.908809439130929e-02   +5.932510388118492e-01   -6.642841923809689e-01   -1.486208968520693e-01   +6.098241105346718e-01   +3.876300212758294e-01   +4.975227383173229e-01   -1.747635086251142e-01   -3.773181388812181e-01   -2.204790123530122e-02; +4.667349339642558e-01   +5.144215091811469e-01   -8.578072454539498e-01   -6.094986399139751e-01   -4.190322694135972e-01   +6.247047353134966e-01   +5.863638827730541e-01   +1.032486207311515e-01   -5.657562259526675e-01   +2.703443185039442e-01   -1.632647061107593e-02   -1.979096397612363e-01; +4.030570491396867e-01   +2.523415674458920e-01   +1.020408570917866e-01   +6.364706935590404e-01   -1.878752645655929e-01   +4.347609529074113e-01   +7.556702932968856e-02   -3.188459704512680e-01   +2.237870374315654e-01   +6.822461986609368e-02   -5.508310281843071e-01   -1.582214345286779e-01];
L3E_L3I_iGABA_netcon = [-2.890093601447811e-01   +3.449628668476261e-01   +5.244049998183373e-01   -1.341705655422739e-01   +4.776054805131612e-01   -4.801746478081053e-01   +6.313508860562473e-01   +3.433554349407708e-01   +5.302153353670395e-02   +2.494754569853051e-01   +2.927007502715130e-01   +4.613152701912110e-01; +3.332346182340556e-01   +3.929274004327627e-01   -2.419527428489901e-02   -3.345183465809973e-01   +3.501853587154464e-01   +5.091626653659830e-01   +3.586998664026594e-02   +1.263173705780188e-01   +2.909402211259070e-01   -1.868196239828276e-01   -2.101041670274827e-01   -2.307697258576771e-01; +2.452686510132010e-01   +3.873399948562971e-02   -4.008070863185258e-02   -2.836734974512280e-01   -1.034249077849874e-01   +1.000000000000000e+00   +1.361297801566496e-01   -3.595488497841426e-01   -1.983515714259610e-01   +1.453689046074367e-01   +4.482957497503420e-02   +1.954552257211625e-01; +1.897463304616033e-01   -4.553836417427227e-01   +5.519060799069792e-01   -6.647792416781620e-02   +1.226334251645348e-01   +1.187722877445686e-01   -5.620355396335452e-02   -2.127445615103933e-01   +4.800275529912603e-01   +4.561452575464783e-01   -3.701016622011583e-01   +9.446691785787616e-01; -2.110993019603778e-01   +5.369953062219539e-01   +6.294222232563162e-01   -6.826768577877128e-02   +1.954002982655949e-01   +5.089252891292771e-01   -9.855639218885243e-02   -2.817242373127359e-01   -2.269384813380682e-01   +4.936713669077020e-01   +7.528651299201304e-02   -1.401826264400990e-02; -9.211723772092503e-02   +4.465511525874370e-01   -1.954943914610230e-01   -5.135065870993863e-01   +5.363133765365762e-01   -9.781820426860663e-02   -5.618355050774446e-01   -2.746630716515945e-01   -1.239768565367820e-01   +4.103165526536476e-01   +2.660773978000194e-01   +7.164481307914539e-02; -3.077177378552354e-01   -4.062225541606211e-01   -2.161033856894222e-01   -1.688604119626713e-01   +5.835724479204505e-01   +6.427057673235030e-01   -6.338460076717655e-01   -2.114933240428293e-02   -3.885031268544207e-03   +3.014978795511663e-01   -3.757065593496594e-01   -2.793773476406957e-01; -6.505806460189058e-01   +2.873408326384321e-01   +2.640931538099061e-01   +3.781825016274663e-01   -4.399214208434024e-02   -1.681110519854209e-01   -6.915419674050792e-01   -6.037732765560871e-01   +3.956754755778642e-02   -1.029691531049991e-01   +2.057736113417629e-01   -4.205763397270829e-01; +1.577162729444141e-01   +4.706541696859148e-01   +5.597421362675959e-01   +2.297291003907175e-01   +1.427481968615781e-03   -8.504780481396985e-01   +4.769240897219399e-01   -6.177108652833185e-01   -4.208720767726440e-01   +3.825346166755481e-02   +3.693221077773631e-01   -4.507312020880464e-01; +4.474412372455593e-01   +4.292604580566126e-01   -7.805097197471629e-01   +5.971223998943365e-02   -4.812763071567438e-01   +3.576509125614059e-01   -4.917545203848863e-01   +3.990850890395079e-02   -1.386730183615927e-01   +5.272966398089052e-01   -6.018049461225422e-01   -3.162169206384619e-01; -2.177152875597047e-01   -2.085755791652644e-01   +3.948362820536196e-01   -1.659098997679241e-02   -4.776900045836364e-01   -1.263272876548965e-01   -3.852778480924019e-01   +6.331058129781109e-03   -7.051276916820202e-01   -8.354887934582916e-02   +8.254667631070681e-02   -3.246326727839371e-01; +2.565251861221124e-01   +2.523209557756153e-01   -9.776298563683757e-02   +5.871765732526321e-01   +9.181649912483059e-01   +4.159102549834972e-01   -2.288614238156719e-01   +6.479495225323723e-01   +4.304597327503967e-01   -3.329496842757182e-01   -5.025878946581221e-01   +4.635482387694198e-02];
L2E_Input1_iAMPA_netcon = [-1.816309059876243e-01   +2.763771298270291e-01   +2.454783900428956e-01   +7.901736935604889e-01   -6.689739975000184e-01   +8.945366711159860e-01   +1.000000000000000e+00   +1.042060193535568e-01];
L2I_Input2_iAMPA_netcon = [-4.261789603157003e-01   -5.074816428180905e-01   +3.071106701754768e-01   -2.706867387197626e-02   -9.689105385242536e-01   +6.826579178752694e-01   -5.507859923878464e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
