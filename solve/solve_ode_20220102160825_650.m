function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.539399888491776e-01   +1.661230258178596e-01   +5.370567809899954e-01   +5.400763726418392e-01   +8.209930847144308e-01   +2.396384445488438e-01   +1.869323583124531e-01   +1.240456631934057e-01   +1.966623039785850e-01   +7.752733012558741e-01   +1.166969240466361e-02   +2.825288885735355e-02   +5.281268514289152e-01   +9.166019886809972e-02   +1.132539267945485e-01   +3.631260005668391e-01; +8.436152714948603e-01   +3.285320539374673e-01   +5.986657186866554e-01   +5.061194956472489e-01   +6.703475850200574e-01   +6.206417458235342e-02   +8.284287506382769e-02   +2.532650941597743e-01   +4.206225574961127e-01   +1.953670298944486e-01   +6.290626720960095e-01   +6.222523686647530e-02   +5.042569176640594e-01   +7.917730226544692e-01   +2.174572761886628e-01   +5.109370016648819e-01; +7.279662930798179e-01   +8.788111391194902e-01   +3.318463990224997e-01   +1.393785198282070e-01   +7.882284902493368e-01   +1.999219209703498e-01   +6.546011201325681e-01   +2.322070607776973e-01   +4.257542240137495e-01   +1.267213620201134e-01   +7.079530168587224e-01   +3.988538536224797e-01   +5.500017241049731e-01   +6.808159596900942e-01   +2.314124256010596e-01   +7.372769606980374e-01; +2.145426992341984e-01   +2.197546784128715e-01   +5.454288916391544e-01   +7.506531351807891e-01   +1.566390977295227e-01   +8.087759852626611e-01   +8.496193665275900e-01   +3.927091181786204e-01   +5.825432269054444e-01   +1.171892069872499e-01   +5.901155103674652e-02   +3.813932952236900e-01   +3.463870899670562e-01   +7.645143241475126e-02   +1.574267924774073e-01   +6.115912490351899e-01; +2.897552010993428e-01   +2.023669380759338e-01   +8.374351327435623e-01   +4.888789517440102e-01   +3.401330343390812e-01   +6.445697818907168e-01   +7.378951291097930e-01   +3.383189613676269e-01   +8.734118779042278e-01   +6.808071242932445e-01   +3.306389089362254e-01   +1.914484299595504e-01   +3.386060058617443e-01   +2.259014480498687e-01   +5.827901646951394e-01   +5.101349679713095e-01; +1.218743309897748e-01   +5.231174664911994e-01   +5.681508914834584e-01   +2.162200856321674e-01   +5.478689314496925e-01   +6.804792863194259e-01   +2.148238699570802e-01   +2.575304918847650e-01   +8.665168380295096e-01   +5.993613359422312e-01   +1.888323655159621e-01   +8.210729650806338e-01   +2.804711813961898e-01   +7.545994583055134e-01   +6.112799241000180e-01   +8.574084081983587e-01; +6.016130970880087e-01   +8.070853668192933e-02   +7.224700513906742e-01   +5.673899755355334e-01   +5.802088070986330e-01   +3.797549210616001e-01   +6.048538766300092e-01   +7.683693385203926e-01   +7.467807234115329e-01   +8.348004011533886e-01   +7.862342955746887e-01   +5.603380314808977e-01   +4.084195887575108e-01   +1.835877597386112e-01   +9.340888061770170e-02   +4.167475719206676e-01; +3.208743250777627e-01   +3.509122810473247e-01   +1.826028341212172e-01   +7.896677669255435e-01   +3.200117401400309e-01   +2.757000128510996e-02   +5.031302995094261e-01   +8.135974987709444e-01   +7.544192629676444e-01   +1.534366241163446e-02   +1.457302199365421e-01   +4.348470815203109e-01   +2.534685204053175e-02   +8.655567141401829e-01   +4.086411886456263e-01   +6.255488263093193e-03; +8.911813118109579e-01   +3.499278910869514e-01   +3.960159711771787e-01   +2.272519890381694e-01   +5.638444574630428e-01   +7.622632676259330e-01   +1.970489795447115e-01   +5.384428966528597e-01   +1.517496056968704e-01   +7.638914811905712e-01   +9.507621055104550e-02   +5.843315573879267e-01   +1.500785576245138e-01   +6.463356661016723e-01   +2.632874935044395e-01   +1.124830485620883e-01; +6.552891564299733e-01   +6.575679318147226e-01   +4.534704774769369e-01   +5.681545720193389e-01   +2.925090485128174e-01   +4.747208877257989e-01   +3.073372818065506e-01   +2.416998505353796e-01   +8.878770763000517e-01   +2.127128261577187e-01   +3.607330366609487e-01   +1.878631561202884e-01   +1.462855623000000e-01   +1.685347930132388e-01   +3.214776412014860e-01   +6.824542018547223e-01; +1.176438923486232e-01   +7.839390107769906e-01   +7.628520955485929e-01   +6.816044261741158e-01   +3.004664797321718e-01   +5.493553021977290e-01   +2.430473594504426e-01   +2.114678809412812e-01   +5.682221586710721e-01   +5.438564281307353e-01   +2.893288950210658e-01   +3.487296722976432e-01   +7.464608887593085e-02   +3.213452159834554e-02   +7.315269582938461e-02   +8.698912673887624e-01; +1.020165319719009e-01   +8.880238044282731e-01   +8.718196724397000e-01   +8.976082642412090e-01   +8.897221174579849e-01   +8.776938123012219e-01   +7.706769089729903e-01   +4.448593414817570e-02   +4.792099912114202e-01   +7.882258977948547e-01   +1.229338740770259e-01   +2.820177825340155e-01   +7.311815014770645e-01   +4.545996269406558e-01   +7.830366804899515e-01   +2.929557579108655e-01; +3.881608211335494e-01   +1.370541146509329e-02   +3.228157857348395e-01   +2.789879132218985e-01   +6.602012525263733e-01   +3.103127718823263e-01   +8.804042451579644e-01   +3.545394567644355e-01   +6.205133004496471e-01   +8.480533333803766e-02   +2.780602807304917e-02   +1.950104629865808e-01   +8.199484130428238e-01   +1.807982458548866e-01   +7.449757216852039e-01   +4.396822415860070e-01; +4.605342944587151e-01   +3.301593252761703e-01   +8.830315104892042e-02   +1.237588076116190e-01   +4.367611017474898e-01   +5.729710465376364e-01   +6.963638312335771e-01   +1.367749880026156e-01   +6.644730575932913e-01   +4.584792570871580e-01   +2.674830637835604e-01   +3.427313483121603e-01   +6.772240771651790e-01   +1.352990177297039e-01   +2.358527994744660e-01   +1.820798608768265e-01; +2.400465033340340e-01   +7.851879728419745e-01   +4.827100023457416e-01   +5.123565555623759e-01   +2.309300056703545e-01   +4.449384284538618e-02   +1.849098513827587e-01   +8.518420552401794e-02   +2.764902462230023e-01   +6.720121348235254e-01   +6.398930493923751e-01   +7.027321005713191e-01   +6.882896119700715e-01   +6.442003279172784e-01   +5.082267256305028e-01   +5.582518765968575e-01; +1.723013075016161e-02   +8.179778004656079e-01   +2.155583920688453e-01   +7.215930782992478e-01   +6.939736709386062e-01   +4.329016153429391e-01   +8.776570189191112e-01   +6.795713155614663e-01   +5.566900910580036e-01   +1.384913481620982e-01   +6.756695257850492e-01   +5.975504436639605e-01   +6.823341462165278e-01   +8.973948031856267e-01   +2.954882488274629e-02   +2.436969097116808e-01];
L1E_L1I_iGABA_netcon = [+7.333543733603047e-01   +9.564253210226349e-02   +2.569115382208987e-01   +4.956663283076720e-01   +8.214592216475980e-01   +5.224110140472707e-01   +6.695491254142519e-01   +8.733779885147601e-01   +7.455793158358479e-01   +5.366071750105960e-01   +4.928843266545209e-01   +7.188893634576440e-02   +6.400283407590328e-01   +2.268424441478762e-01   +7.996837804267437e-01   +1.504282778150250e-01; +1.032929480426368e-01   +1.174700775469268e-01   +8.271164287587007e-01   +5.662509588738348e-01   +6.451157595050380e-01   +6.685434696586898e-01   +1.800838507990101e-01   +3.417146764563886e-01   +9.608864908746399e-02   +8.115178110778958e-01   +8.020813898064091e-01   +2.685939604563906e-01   +8.563489920886610e-01   +5.877826679032232e-01   +5.679669953069201e-01   +2.049956184297351e-01; +6.644368254315433e-01   +3.706174337050754e-01   +4.058852322760298e-01   +7.262531239646314e-01   +7.820236795647234e-01   +7.959312848465945e-01   +6.168225022752870e-01   +1.505035275031118e-01   +1.934411010534671e-01   +5.260181277299276e-01   +5.118590285112915e-01   +5.667146891804612e-01   +8.327674559856404e-01   +1.734363010798589e-01   +4.454925691823212e-01   +7.055660963915986e-01; +5.624337387813454e-01   +4.906491429444666e-01   +3.426651519246766e-01   +8.555797048282431e-01   +1.940234071175589e-01   +4.838831855483239e-01   +1.729763850198437e-01   +2.245067415662114e-01   +4.061933986021521e-01   +3.575104131028117e-01   +5.453954333081554e-02   +3.241370106148926e-01   +2.075689919839361e-01   +4.116766478404869e-01   +4.308392731611876e-02   +5.331922961150328e-01; +3.401483999622464e-01   +1.143399643949940e-01   +7.252575723706768e-01   +7.255094834607634e-01   +8.601692984938744e-01   +1.167990354427285e-01   +3.127283019344521e-02   +1.862487346854874e-01   +7.667229871108727e-01   +5.645443583787394e-02   +8.379698390280005e-01   +4.626963157965315e-01   +5.198099644292813e-01   +2.287702252565326e-01   +5.547738542745324e-01   +1.878236859412165e-01; +1.208318289846426e-01   +7.326144766151492e-03   +2.127731549666011e-01   +8.591282237537664e-01   +5.993578246526056e-01   +4.370629175259845e-01   +4.222105272730015e-01   +7.518253012487742e-01   +5.855531150772886e-01   +2.608866156263540e-01   +1.341772206106013e-01   +2.694892430348402e-01   +1.976551951198657e-02   +7.585063714259188e-01   +1.045805558912740e-01   +6.883220954721362e-01; +8.763915928241237e-02   +4.577956404990325e-01   +5.989359358629986e-01   +2.596283330678477e-01   +3.247939711822314e-01   +5.208766512641727e-01   +4.288399869684031e-01   +8.509434842837226e-01   +1.309328930145531e-01   +4.114051604404033e-03   +5.629067590185561e-01   +8.043407921637200e-01   +6.833059931397948e-01   +6.346201105449945e-01   +7.075255191385984e-01   +3.165521559599709e-02; +5.437058639497763e-01   +5.884029044946976e-01   +3.598200389038948e-01   +6.880246947947695e-01   +5.931267591120931e-01   +8.662097234931182e-02   +7.674468764224582e-01   +6.031360045173095e-01   +3.152456933322651e-01   +7.780347559736261e-01   +7.719220080933502e-01   +8.740681545638433e-01   +2.574271617063750e-01   +5.530265137928675e-01   +2.897145390423653e-01   +8.687401621220143e-01; +6.043739446263057e-01   +5.547786085429075e-01   +7.549153489625523e-01   +5.320398810519803e-01   +1.734443129547262e-02   +3.115923991273903e-01   +3.909581914763376e-01   +7.531420679288755e-01   +5.631030842389956e-01   +6.555218560565662e-01   +7.218319704092637e-01   +7.846627221125424e-01   +4.709296601529664e-01   +2.498287878519230e-01   +4.341389303779105e-01   +6.549464926600410e-02; +2.038273692423396e-02   +1.419101912916197e-01   +8.613562767826057e-01   +8.860800589727964e-01   +2.455520805280678e-01   +8.823557232740449e-01   +5.270469106430210e-01   +5.756551472035748e-01   +5.484125163921346e-01   +1.639825819744225e-01   +2.809037481772455e-02   +3.018779844285518e-01   +1.792292213811310e-01   +1.379654315804849e-01   +8.587753581485920e-01   +3.977225417871420e-02; +6.138107706820015e-01   +1.796433843188278e-01   +6.398662010350031e-01   +7.929172396522448e-01   +6.898781372606602e-01   +4.553128341135468e-01   +4.248509013421924e-01   +6.681568691399250e-01   +1.587732333466764e-01   +4.489874527692053e-01   +7.823174454515539e-01   +5.002331627285075e-01   +7.423138847903656e-01   +5.058718630383101e-01   +5.711157118043674e-01   +2.485310949306974e-01; +3.089456412541700e-01   +1.081431653462885e-01   +3.254927836189098e-01   +8.690446697234997e-01   +8.817807832833483e-01   +4.082527860270068e-01   +4.435905986688635e-01   +6.992253423708172e-01   +3.620156104156073e-01   +3.529436907119693e-01   +1.260125653730608e-01   +2.929908609069024e-01   +3.602174760833486e-01   +1.185947899570899e-01   +1.068234219607686e-01   +5.719493824020482e-01; +1.367740308988126e-01   +8.074874450956606e-01   +4.191056947927866e-01   +8.115046228854843e-01   +6.201909797584657e-01   +3.477453765953331e-01   +2.711087359145149e-01   +4.815506973256845e-01   +5.418221719724574e-01   +3.681308193973061e-01   +5.327300967842108e-01   +5.459291404343596e-01   +5.835305893091514e-01   +4.817642262558861e-01   +1.914860044387189e-01   +4.316498921006304e-01; +3.799101551939034e-01   +4.311491214809775e-01   +8.137537597179474e-02   +9.250864668351078e-02   +4.154820187108526e-01   +7.436098270994472e-02   +3.205133663121274e-01   +8.899317843008361e-01   +7.927722248252935e-01   +1.338081511981799e-01   +3.215826966558322e-01   +2.938496448059651e-01   +5.109385137493709e-01   +8.815767191221636e-01   +3.589329939011670e-01   +6.162479042811931e-01; +6.174524408338463e-01   +7.160839883291262e-01   +2.750568759864722e-01   +2.599853111279370e-01   +8.471773608844086e-01   +3.544926813157940e-01   +4.266436546623528e-01   +2.001082921805018e-02   +6.644346409128120e-01   +7.506781910046062e-01   +6.847239674313735e-01   +2.986227239092591e-01   +6.317659940515883e-01   +8.387488561831157e-01   +2.878420071361497e-01   +7.009583679215503e-01; +7.576075421320217e-01   +5.326140704544189e-01   +6.298525878421547e-01   +1.561691792022848e-02   +5.458282113277567e-01   +8.690996548877206e-01   +1.666558368458474e-01   +3.533040453321796e-01   +5.021409742021927e-01   +8.144856055542196e-01   +7.855616947497225e-01   +4.060645052903670e-01   +7.276698928143086e-01   +5.812453302516174e-01   +8.933656827291705e-01   +8.846192174543771e-01];
L2I_L1I_iGABA_netcon = [+1.206721336502465e-01   +2.379771222522573e-01   +8.645844525686656e-01   +2.280876426673745e-01   +3.132949291953506e-01   +6.814521336095993e-01   +8.350848780954109e-01   +7.052123674466578e-01; +3.155307233368211e-01   +1.250055897352928e-01   +7.705140976322041e-01   +4.488151872601723e-01   +4.055390955619741e-01   +8.993249924889637e-01   +2.606223726685066e-01   +2.299319671736070e-01; +4.071006153570403e-01   +6.873446844010125e-01   +8.515293057460880e-01   +4.887878906697918e-02   +2.426041662911768e-01   +9.786483832547001e-02   +7.940960687708918e-01   +3.623376079497264e-02; +3.077237907684834e-01   +5.062577984999662e-01   +2.928067919006640e-01   +2.044294045812638e-01   +2.610600284709204e-01   +1.405003991644547e-01   +2.267503484294532e-01   +3.845483441410532e-01; +6.608348081829448e-01   +8.508543567369069e-01   +4.201706218858818e-01   +1.491417453310392e-01   +2.622945163202836e-01   +7.703242726108414e-02   +7.314194330757534e-01   +5.638213731175012e-01; +8.243247954514723e-01   +4.541145818082407e-01   +6.950315726061006e-01   +3.778808976966511e-01   +3.797541644579609e-02   +6.045100749850473e-01   +5.051148713548145e-01   +6.277068448721006e-01; +6.307799064505806e-01   +8.705684645196133e-01   +8.532893086147136e-01   +5.943304473413855e-01   +2.898474548303924e-02   +8.884569360630471e-01   +3.532350946585667e-01   +5.288446266716923e-01; +6.946227236053213e-01   +5.357643423706688e-01   +8.491853724005161e-01   +8.972817614271020e-01   +7.017801961740436e-01   +1.082357800181692e-01   +2.996307828659720e-02   +8.304618897287863e-01; +8.556685907754671e-01   +4.659616410979556e-01   +4.845887080941974e-01   +4.210605152935311e-01   +7.087436439234329e-01   +8.652826320297036e-01   +1.033163764891560e-01   +1.900720375680762e-01; +2.745714193866737e-01   +4.009560543260960e-01   +1.132399505087114e-01   +2.177080303665255e-01   +2.178567836324019e-01   +8.116049650437273e-01   +6.575682523132416e-01   +2.552900079051388e-01; +5.659351180658867e-01   +2.057921737190979e-01   +8.981186531268672e-01   +1.834439561703129e-02   +4.058081242196944e-01   +6.913498420111374e-01   +3.113461146676061e-01   +4.354758530458621e-01; +4.765279361746217e-01   +2.860420201689705e-01   +6.391382832968662e-01   +3.297207040794810e-01   +4.560986791655676e-02   +6.033800136128208e-01   +3.629667660908888e-01   +7.768753432187954e-03; +3.180180246100088e-01   +8.360705399014162e-01   +5.419200588279406e-01   +1.033860601704937e-01   +5.184011762356073e-01   +2.912874340118138e-01   +6.395932029722001e-01   +1.681412883763827e-01; +8.523774681521336e-02   +4.714794075991976e-01   +7.257085172265783e-01   +3.159659859128703e-01   +6.865742448099222e-01   +1.834653759105228e-01   +1.770137977144426e-01   +4.435516363379527e-01; +5.892281669243489e-01   +4.552581315723065e-02   +4.959437859375999e-01   +8.815219993558564e-01   +4.136668692626868e-01   +5.949041167087180e-02   +1.882412143243237e-01   +4.310725674218385e-01; +7.075562879551577e-01   +3.996409185520428e-03   +7.661537486021591e-02   +8.029015280417964e-01   +3.321463465906693e-01   +6.610351608178530e-01   +1.086295543652032e-01   +2.421198910925055e-01];
L1I_L2I_iGABA_netcon = [+8.584422176147258e-01   +8.142600717316357e-01   +6.597143598360401e-01   +1.299825020232731e-01   +1.148810177259551e-01   +8.223043859353878e-01   +1.178039774770395e-01   +2.171031392514886e-01   +1.408223646907174e-01   +2.962543257935396e-01   +6.658501209468551e-01   +4.463326234117000e-01   +2.929593416436835e-01   +5.624559027017483e-01   +7.989520419458490e-01   +8.062365520503594e-01; +4.616313283012698e-01   +8.272138072781997e-01   +3.195588779639623e-01   +3.110183881991367e-01   +8.049701812181248e-01   +8.528104089289613e-01   +4.353930832533532e-01   +1.468056420048648e-01   +4.244852268346600e-01   +8.003411570400580e-01   +5.573094400118508e-01   +8.307484899124609e-01   +5.013548335061474e-01   +3.509878753180300e-01   +2.361851271443280e-01   +4.869340936022246e-01; +3.636398401063797e-01   +4.249529749722593e-01   +3.931740774235298e-01   +5.239561211262859e-01   +2.896687471433440e-01   +6.619245788059780e-01   +2.556129834770826e-02   +7.281617633816295e-01   +6.939227120221675e-01   +4.803760952150447e-01   +1.520951008045736e-01   +7.373046935260280e-01   +3.183823601119617e-01   +5.291103659910483e-01   +3.993821623884211e-01   +1.591636082096534e-01; +7.547505201924121e-01   +3.399910613612399e-01   +4.880296231680733e-02   +3.321194390371563e-01   +5.429251225067341e-01   +2.731261058659554e-01   +2.204216033563605e-01   +2.814364626753198e-01   +8.814693428057722e-01   +1.268616197525827e-02   +2.948081418536677e-01   +1.516374147298981e-01   +8.913146112481579e-01   +5.658113551062353e-01   +1.041616899804997e-01   +5.738124613475606e-01; +8.619847677785668e-01   +8.224330243568782e-01   +3.812844196553521e-01   +3.452379174003790e-01   +2.373399082987408e-01   +1.063946746797501e-02   +1.557150618256842e-01   +4.477662387091039e-01   +7.411321240633048e-01   +6.057791545849413e-02   +8.752628926380481e-01   +4.588545829678956e-01   +3.681544483906062e-01   +6.901151291375734e-01   +2.725782985062969e-01   +4.861963699125329e-01; +8.886384218066162e-01   +4.337632649651905e-01   +1.842867917213848e-01   +5.565930771773057e-01   +5.390977777245783e-01   +2.587724559169228e-01   +7.117250995358049e-01   +8.212821282556642e-01   +4.343525366985109e-01   +7.143039583373471e-01   +8.079005617421992e-01   +4.042797668090321e-01   +6.181108931738634e-02   +4.452304192261918e-01   +4.509968919817337e-01   +3.359335587319732e-01; +4.075754216774182e-01   +1.232395051254515e-01   +4.891542199592945e-01   +4.498496143632067e-01   +6.980552537195271e-02   +8.494683033369770e-01   +4.186551770276664e-01   +9.053163641667213e-02   +6.127264047633376e-02   +1.014013788009524e-01   +6.443966642578343e-01   +4.477698989396805e-01   +1.525912664920967e-01   +2.160391668905463e-01   +2.769672906951703e-01   +2.587442335505640e-01; +2.949566511726319e-01   +1.835404377074501e-02   +5.519649479609607e-01   +5.685572350008299e-01   +6.365205985083130e-01   +2.064144401687873e-01   +4.229346426379577e-01   +1.644864845251648e-01   +7.012423371931249e-01   +6.923223278060028e-01   +6.809352436040184e-01   +3.936508184621482e-01   +8.760648351536138e-02   +2.509027639231594e-01   +4.095295721822660e-01   +6.419367288486143e-01];
L2E_L1E_iAMPA_netcon = [+6.976591812276554e-01   +4.698575732379658e-01   +6.520442514754513e-01   +3.075893928513172e-02   +1.131663650095890e-01   +4.610128277580030e-01   +2.992392833309716e-01   +2.372109936948124e-01; +1.763074342815150e-02   +6.139245923233111e-01   +5.843939448778751e-01   +6.173553779445721e-01   +8.948927520228354e-01   +6.081349907195279e-01   +7.139072056427771e-01   +8.768669172874108e-01; +2.961388506210399e-01   +5.731865879591959e-01   +2.567788994538688e-01   +6.068422721513587e-01   +4.618074680311354e-01   +6.945146260004467e-02   +5.215207724122209e-01   +6.320286906155934e-01; +1.930703039632575e-01   +7.589267152123526e-01   +6.230171855875222e-01   +4.312213912958611e-01   +3.815138625954974e-01   +1.121631310306803e-01   +2.488347835039628e-02   +3.557824985761068e-02; +8.567318050479532e-01   +2.836093094118365e-01   +1.849389683693677e-02   +8.505249583986401e-01   +8.883370524237925e-01   +2.073952816968008e-01   +5.010012749482067e-02   +5.475680145662043e-01; +7.379633185024559e-01   +6.843888094121797e-01   +4.505948052767909e-02   +3.999432440178786e-01   +4.340395226451786e-01   +6.606871783425365e-01   +4.813745191948571e-01   +2.591323101722979e-01; +1.960843207349629e-01   +6.589153207312066e-01   +1.394393076504267e-01   +3.225376133424101e-01   +3.166488297280969e-01   +4.086211504015397e-01   +5.493878576832508e-01   +7.066876236806312e-01; +7.124360949866060e-01   +5.478120955706457e-02   +7.016660556505985e-01   +6.889832352444776e-01   +3.910483579080893e-01   +4.574545687820038e-01   +3.741952174133080e-01   +5.229477212137402e-01; +1.311503634411080e-01   +3.485533738032566e-01   +5.256367195192658e-01   +4.890810138914173e-01   +6.200906258321482e-01   +4.783126179313348e-01   +7.629765279356959e-01   +4.890871022003038e-01; +5.429278656579719e-01   +4.614690615197887e-01   +7.449911462074118e-01   +1.854761365231382e-01   +6.873617652324782e-01   +4.701882537468701e-01   +6.901413519864326e-01   +3.045868884194099e-01; +8.389426561047386e-02   +4.365143407807279e-01   +4.759416760492322e-01   +8.756363876175727e-01   +1.354924129843399e-01   +4.077312106449372e-01   +7.532816577472315e-01   +8.237670342309393e-01; +6.595106988544108e-01   +8.039287274038406e-01   +4.156285459616256e-01   +6.547920263456573e-01   +2.823894174414234e-01   +4.321553946347280e-02   +3.857411651128705e-01   +4.595097110868896e-01; +5.893132304810209e-02   +6.082419521242229e-01   +1.749982536728936e-01   +5.007289041871558e-01   +1.316475004952372e-01   +8.014132378241298e-02   +3.945001481406811e-01   +2.650572181247211e-01; +4.160201057092516e-01   +2.241805725301685e-01   +7.629129896850104e-01   +3.142133126910752e-01   +4.757077588597852e-02   +1.079529744766369e-01   +5.275374161575728e-01   +3.107582057674320e-01; +6.163207879784766e-01   +5.297993509079695e-01   +8.429426797903443e-01   +5.989086232100627e-01   +6.536419150853666e-01   +4.189127929536146e-01   +5.947546196651420e-02   +1.099429249350941e-01; +1.830591261196562e-01   +5.680847174588335e-01   +6.073947526257309e-01   +3.827355671979804e-01   +5.237011531595747e-01   +8.950058568453756e-01   +8.894785976770888e-01   +5.282141544477612e-01];
L1E_L2E_iAMPA_netcon = [+8.274215905083663e-01   +7.462351796132403e-01   +4.922872046032989e-01   +1.661696274209193e-01   +4.795780478704448e-01   +7.432356395458788e-01   +3.649142268201638e-01   +4.445606434767045e-01   +7.216948712701973e-01   +8.692573732421665e-01   +7.808725258369923e-01   +7.926623601244971e-02   +7.988631976771950e-01   +7.558416149581046e-02   +1.935259650065968e-01   +3.504348562074955e-01; +6.101632310670059e-01   +2.484758680273299e-01   +2.501873781021722e-01   +2.762482677840536e-01   +8.833616991986730e-01   +2.001669364997785e-01   +4.004869540163539e-01   +8.426536877852968e-01   +5.531562244597013e-01   +6.649392850985864e-01   +1.898674023072915e-01   +3.764033327958348e-01   +5.146882251608917e-01   +8.333832041164974e-01   +4.275380289268200e-01   +8.619285624805351e-03; +6.805411123121222e-01   +1.975939203755063e-01   +5.704525376280170e-02   +3.027059914944510e-01   +3.986101712764334e-01   +1.418186874891892e-01   +8.126631364358415e-01   +2.648642505554601e-01   +5.003786867450586e-01   +1.435885777253783e-01   +4.643229688990591e-02   +1.930342552190132e-01   +7.843003227841029e-01   +4.482695798407907e-01   +3.917937367632029e-01   +6.334719224763147e-01; +2.281036214462016e-01   +1.468035178442739e-01   +2.159904255145231e-02   +8.962581293536469e-01   +4.879794124815207e-01   +8.531056456740168e-01   +8.387564473642687e-01   +5.646803659189434e-01   +3.579572908138259e-01   +6.059955915240202e-02   +7.124330340863080e-01   +3.597716288921176e-01   +3.847821145630921e-02   +2.414618453287742e-01   +7.736962423155602e-01   +3.586522839922707e-01; +8.636700737310873e-01   +3.060953574484105e-01   +1.272747766863309e-01   +6.982908016046119e-01   +2.656162515983974e-02   +3.713488395030439e-01   +1.590315899238016e-01   +3.491635671115293e-01   +3.219058488343393e-01   +1.949445630735197e-01   +1.164390304860647e-01   +7.922682095443641e-01   +3.069906648719268e-02   +1.081714912592168e-01   +7.269226976860339e-01   +5.497593139210137e-01; +8.698114650200214e-01   +3.984315055724194e-01   +8.551681456529002e-01   +2.345216820818876e-01   +2.852364055831222e-01   +2.755952896280840e-01   +3.744704496288206e-02   +2.489762121838458e-01   +1.823419369781429e-01   +1.388489500749862e-01   +1.376327050280444e-01   +6.223000217439946e-01   +8.514056625005967e-01   +5.857216742404314e-01   +7.977374419286967e-02   +8.988814817927703e-01; +4.102629288474666e-01   +8.040112718140735e-02   +2.406391278540091e-01   +8.306016396788787e-01   +1.955643721399590e-01   +3.799716778544265e-01   +8.772641786019812e-01   +5.713271602325174e-01   +5.592904476795102e-01   +9.687231298003866e-02   +2.246118857894214e-02   +3.394379145478476e-01   +7.524725101670278e-02   +6.827723121817457e-01   +3.778702446956514e-01   +4.969722815421453e-01; +7.489768507069515e-01   +2.559846788076103e-01   +7.823872644817027e-01   +5.987744472982829e-01   +4.862533692203496e-01   +4.475910348151515e-01   +1.303531394593981e-01   +2.427645623053887e-01   +1.655504152728985e-01   +3.845832805677665e-01   +7.857869098192539e-01   +8.768532555346025e-01   +7.082642105886491e-01   +3.070347163231553e-01   +2.593769836869519e-02   +3.696574004119803e-01];
L2I_L2E_iAMPA_netcon = [+5.669012445181094e-01   +7.282969761808468e-01   +8.392635832885422e-01   +6.872761729485725e-02   +2.643862041400944e-01   +1.895306559405452e-01   +8.967541464193526e-01   +8.955039946984966e-01; +4.591726322332488e-01   +2.337035744221630e-01   +3.304876733552586e-01   +8.888686169605027e-02   +3.060626773238778e-01   +1.197694815925895e-01   +7.132100804374440e-01   +1.824907199944384e-01; +7.962421680866172e-01   +3.189320263906310e-01   +1.711834405527810e-01   +4.257686806470168e-02   +1.365771259490715e-01   +1.912914851450457e-01   +8.436614554850403e-01   +7.265523350045148e-01; +1.700198272009735e-01   +2.368219220900443e-02   +2.100018666514203e-01   +8.537378978870892e-01   +6.114355664534629e-02   +3.184458315247358e-01   +2.630444517476566e-01   +3.364032456979547e-01; +1.271855224845824e-01   +6.876754197242220e-01   +1.885560055572545e-01   +5.952463899571591e-01   +6.149713977440798e-01   +4.232040068380138e-01   +8.057168095205395e-01   +5.108323562214326e-01; +1.051412520094972e-01   +4.552088147091957e-01   +5.265814465643462e-01   +3.209907215030299e-01   +4.763490040314228e-01   +3.237188076766618e-01   +1.031297665413153e-02   +4.136106500359722e-01; +2.912339884444720e-01   +6.391927204448584e-01   +4.656252544628047e-01   +5.626733240667104e-01   +3.551332499414263e-01   +5.727366364071849e-01   +1.073269329899109e-01   +3.641962818353915e-01; +1.062067080707837e-01   +1.695387616081577e-01   +1.345761743188566e-01   +2.889220130916920e-01   +5.095918643572509e-01   +7.288848460071023e-01   +2.804485041482625e-01   +3.090251312687181e-01];
L2E_L2I_iGABA_netcon = [+5.995686292000735e-01   +1.726469087384626e-02   +1.600735599200197e-01   +5.999796962069144e-01   +1.094616382618697e-02   +3.976447052678469e-02   +5.006270093933517e-01   +3.069967093355302e-01; +8.439521398842820e-01   +1.318405611663294e-01   +2.426972635162451e-01   +3.487150412531365e-01   +6.942272817096057e-01   +6.456891329779686e-01   +3.895275553188176e-01   +8.904736648387944e-01; +5.041103883968931e-01   +9.470589857531075e-02   +3.500888289274606e-01   +7.295533649081946e-01   +4.853460846948910e-01   +5.302378701439352e-01   +7.775672364832610e-01   +4.350324424774485e-01; +2.885887393303981e-01   +4.564137816977002e-01   +5.893047676364513e-01   +2.222648581808578e-01   +1.230842533733297e-02   +6.251352681272158e-02   +5.008308970718032e-01   +7.846042287893338e-01; +6.314556567487429e-01   +6.391197440864060e-01   +3.793254704377994e-01   +6.672958260407174e-01   +4.548243038258255e-01   +6.336539733789348e-02   +7.621635630325082e-01   +3.473554005673072e-01; +8.454760100348071e-01   +9.056764267949942e-02   +6.808093218696710e-01   +2.014391481669332e-01   +7.864411651692885e-01   +4.723621450926390e-01   +6.997468657651998e-01   +4.903520042565132e-01; +2.296276120022201e-01   +2.107248739074816e-01   +6.907894081318988e-01   +7.214068956865664e-01   +3.117609888828121e-01   +2.972608691379813e-01   +1.846934833728581e-01   +6.489962430545746e-01; +2.260243890848532e-01   +1.408071327951172e-01   +2.455111597102387e-01   +2.443425610491226e-01   +6.398907906995750e-01   +3.209799506321446e-01   +8.649827835236428e-01   +5.811578388154233e-01];
L3E_L2E_iAMPA_netcon = [+5.341005603374483e-01   +4.949375847711948e-01   +5.957237476506834e-01   +5.221248450853576e-01   +4.174330289443494e-01   +7.989714681436448e-01   +8.786184165158225e-01   +1.552555442039901e-01   +1.717479818833792e-01   +8.923568542367563e-02   +5.205283160996083e-02   +2.931433110832454e-01; +6.117843245194146e-01   +7.499434066533681e-01   +5.605376269689044e-01   +5.669210501913176e-01   +4.218432067396670e-01   +1.772194139035941e-01   +8.360850942411417e-01   +4.236652327125308e-01   +3.652372941629394e-02   +7.852727020209055e-01   +6.742506052904387e-02   +2.242599986770258e-01; +4.624731346039949e-01   +5.331012445294835e-01   +4.652449794214900e-02   +5.824929796468917e-01   +3.993409010166634e-01   +3.104427109315153e-01   +6.946835336049570e-01   +1.329638278263755e-01   +4.559868353970033e-01   +1.557429516085716e-01   +3.144476276586580e-01   +6.459252960486025e-01; +6.591025748668553e-01   +8.554411874302206e-01   +3.568187079236890e-01   +3.084209605540596e-01   +7.826438723788625e-01   +3.796760981197359e-01   +4.947052885027504e-01   +5.725942941154011e-01   +1.931911797983057e-01   +1.522294482132965e-01   +6.441178031699761e-01   +5.125367106958683e-01; +6.342164431467063e-01   +2.341785749947514e-01   +5.140767075956630e-01   +7.263352287945102e-01   +3.675123958676930e-01   +2.155051457334033e-01   +8.963061723218735e-01   +2.472129206505783e-01   +9.206958512497312e-02   +3.680118934111344e-01   +8.241047054471211e-02   +7.255183800604479e-01; +5.320854895829813e-01   +5.147686429600412e-01   +6.338898580257789e-01   +8.911700187618590e-01   +6.816214180474538e-01   +7.594353767574575e-01   +2.614557241976932e-01   +7.133814908356825e-01   +5.137413133186309e-01   +5.427608353864222e-01   +7.524465843225433e-01   +5.837270198109741e-01; +1.605708303598475e-01   +8.363457423787249e-02   +4.529990143815260e-01   +1.483029518379168e-01   +3.380541889421306e-01   +3.026780485390168e-01   +7.301345426712590e-01   +3.331117805793014e-01   +3.075888421280814e-01   +8.674265893416291e-01   +4.306995382238269e-01   +6.111593240087980e-01; +1.324946891636131e-01   +3.795443172388236e-01   +6.896838248897460e-01   +4.758236719757205e-01   +8.012746074204559e-01   +4.946191735392430e-01   +7.263630358296708e-02   +2.721576774572323e-01   +3.292817185339059e-01   +7.101871534353833e-01   +8.269261691341853e-01   +3.222234733374442e-01];
L3I_L2I_iGABA_netcon = [+1.231583565967081e-01   +6.728053147374150e-01   +5.457496611772027e-01   +2.599212254160143e-01   +3.686140965074325e-01   +7.184495783964573e-01   +4.011769832194380e-01   +7.631665603525493e-01   +5.189027798297001e-01   +2.531946494219405e-01   +2.582111508216272e-01   +3.964709439617597e-01; +6.426506904236695e-02   +3.058337861572685e-01   +8.521326799987344e-01   +1.962462200723628e-01   +7.370949733973888e-01   +7.460123862661538e-01   +4.036824626184541e-01   +3.505752507225287e-01   +4.228037564128843e-01   +6.063769923652498e-01   +7.521997507480769e-01   +5.874634615769795e-01; +7.143339180422872e-01   +5.807807804179128e-01   +5.929241222213135e-01   +5.494551801450379e-01   +2.624660859472815e-01   +7.029223855738162e-02   +6.497616928812504e-01   +8.995082669484845e-01   +6.012256730176672e-01   +5.048086130351697e-01   +7.871490673196224e-01   +7.491815529082583e-01; +7.067462347413597e-02   +8.488041648588371e-01   +9.465446821064765e-03   +8.405844930593475e-01   +5.173916583738253e-02   +3.899120597050462e-01   +3.030035240802137e-01   +8.378527009975145e-01   +3.033245379973747e-01   +8.454624531154281e-02   +8.058593187235815e-01   +1.463620190668005e-01; +1.630139467687776e-01   +7.010899433411313e-01   +4.990678935978714e-01   +2.785356028140180e-01   +5.776861494848582e-01   +1.455480270515404e-01   +8.000593105079611e-01   +8.152585666747597e-01   +7.039537716374514e-01   +5.968631158963060e-01   +8.988282197276660e-01   +2.914266146786937e-01; +1.786513694309982e-01   +4.820902125999260e-01   +2.736775906587641e-01   +6.157382499127078e-01   +4.538266972056071e-01   +8.434405601863350e-01   +2.626300191230184e-01   +8.076944146405404e-02   +8.190452560431333e-01   +4.923202887008234e-01   +3.776237523953331e-01   +8.250524936534317e-01; +1.032798862614342e-01   +4.711352949354729e-02   +1.701273562981731e-01   +5.333475518871061e-01   +2.201894521992469e-01   +6.950623967810006e-01   +1.951664377373175e-01   +4.201987935384325e-01   +6.712244312576204e-01   +1.901231486017012e-01   +1.167567000255711e-01   +2.767572725838914e-01; +4.397995149297921e-01   +2.672265977150104e-01   +7.038310685073835e-01   +8.440137923022738e-01   +8.107270555572262e-01   +6.396224057310751e-01   +7.128589036174099e-01   +8.885676445100480e-01   +8.271413087440076e-01   +3.466752256292677e-01   +7.739698984792749e-01   +2.320907473136835e-01];
L2E_L3E_iAMPA_netcon = [+2.512475573342087e-01   +6.153721137742194e-01   +7.944836020474165e-01   +7.351125394876069e-01   +8.019772811300251e-02   +4.956328835790292e-01   +3.134500104366911e-01   +4.915849127930410e-01; +8.729902018029193e-01   +6.568820627149575e-01   +7.481214159145138e-01   +5.984148424270050e-01   +5.497603072948814e-03   +3.679446130385781e-01   +2.645618633542511e-01   +9.797216476419404e-02; +8.661559351776214e-01   +2.768837956140678e-01   +8.706941859870128e-02   +6.829269115186674e-01   +1.611226100423974e-01   +1.271275796545112e-01   +8.154843107579512e-01   +9.043871830329760e-02; +2.171667870709350e-01   +6.611412580552127e-01   +3.125135106405683e-01   +4.700414344561940e-01   +3.728609483270346e-01   +4.525477059782205e-01   +4.312798282980100e-01   +8.069387616585658e-01; +5.712602943979387e-01   +7.221910834583670e-01   +2.356557365649095e-01   +2.505465875143338e-01   +7.444259562110109e-01   +2.345540999726903e-01   +6.097486202932852e-01   +4.540395248144581e-01; +4.827837521302886e-01   +8.403849641417855e-01   +5.732507295009315e-01   +1.471625358704421e-01   +5.090885956189146e-01   +2.728392887652952e-01   +6.317515896700131e-01   +5.815988611723943e-01; +1.537804047479122e-01   +1.096892840007544e-01   +1.656284995496417e-01   +3.785271365953413e-01   +1.569797936452513e-01   +8.663736577238337e-01   +5.199927923403282e-01   +8.958628123992266e-01; +5.305482941809986e-01   +6.850778399811506e-01   +7.160940614405021e-01   +2.581198284149866e-01   +1.952430829866204e-01   +8.146503464923931e-01   +4.625243944469665e-01   +3.566457547400684e-01; +3.826263030612809e-01   +4.455587905108070e-01   +8.346708330302511e-01   +3.358747049927682e-01   +6.396759362636185e-01   +7.355407975491203e-01   +6.507408599894168e-01   +4.507521162422520e-01; +8.166659198874118e-01   +4.622175613938055e-01   +7.330285118769788e-01   +5.897143402308729e-01   +4.385522765679361e-01   +4.264167297260991e-01   +4.026525115892660e-01   +5.110480731015877e-01; +5.631937096701597e-01   +3.118553100713830e-01   +1.049110462626504e-01   +7.227001739006713e-01   +6.866599639289783e-01   +6.678714060022521e-01   +1.422835868673604e-01   +4.058640207159011e-01; +7.958597855976207e-01   +3.830961169187596e-01   +2.116585959328670e-01   +2.694498230201957e-01   +4.584783177306639e-01   +7.925102941109639e-01   +4.733960546442260e-02   +5.374984028632979e-01];
L2I_L3I_iGABA_netcon = [+1.698003917669008e-01   +3.195520492852342e-01   +5.379999708092859e-01   +3.841363061735302e-01   +6.513066998970330e-01   +6.210551689566062e-01   +1.658036352254730e-01   +7.755549173530414e-02; +1.798092655360935e-01   +3.652781077708111e-01   +7.284245064683825e-01   +8.077206567943840e-01   +3.655583102920792e-01   +5.599684486305407e-01   +2.551650381549597e-01   +8.235022332991687e-01; +6.170127381860516e-01   +7.385849116311093e-01   +4.885575729928985e-01   +5.696371121576315e-01   +5.147708168836728e-01   +6.974230158888923e-01   +5.179620807450661e-01   +2.651436393829801e-02; +6.935338346789003e-01   +1.870732880768171e-01   +6.221282127353918e-01   +7.485585781100229e-01   +3.802099085055878e-01   +1.327937862206645e-01   +8.920490397860353e-01   +5.305743656350556e-01; +4.921581650896489e-01   +1.127040419555829e-01   +6.328307259271838e-01   +4.100120494471596e-01   +2.962631171242616e-01   +5.644312537092202e-01   +3.795639134243334e-01   +2.740413363284402e-01; +5.759757411095103e-01   +7.988064830556423e-01   +4.434114437004704e-01   +1.237046872652257e-01   +8.019452030968658e-01   +3.006651635497836e-01   +8.217703049349735e-02   +8.474636733159272e-01; +8.999158902544152e-01   +1.515214038999010e-01   +3.429655878608112e-01   +3.742285169115361e-01   +3.434454341890363e-01   +5.311648427442422e-01   +4.789970858380102e-01   +8.980743700231743e-01; +4.836963604156657e-01   +1.446385953690242e-01   +1.476390018312813e-01   +6.788553831626412e-01   +2.641558525147764e-01   +4.538807144265180e-01   +2.477927373631113e-01   +2.766234207781251e-01; +7.655893662428567e-01   +1.375397096139814e-01   +4.931561220260555e-01   +1.306964722014248e-01   +5.444068237886776e-01   +6.914077532019096e-01   +5.352385640859730e-01   +4.529060384108575e-01; +8.259798688684324e-01   +7.557016349880300e-01   +3.524508575986637e-01   +5.484033198057467e-01   +2.307197642704818e-02   +5.738742146591741e-01   +3.058566370320037e-01   +3.871027482670312e-01; +4.564583759172367e-01   +5.260148730275286e-01   +4.932126548261671e-01   +6.196786032391410e-01   +3.872065689149304e-01   +2.507860553616183e-01   +6.855595232766130e-02   +1.344762699359178e-01; +2.751272735169218e-01   +5.752132232143684e-02   +4.100153327255349e-01   +4.100947283843529e-01   +5.792867482399252e-01   +6.724834460651240e-01   +7.676853902919933e-01   +4.036914021647304e-01];
L3I_L3E_iAMPA_netcon = [+7.310936726719673e-01   +3.155916714556425e-01   +6.426736487944028e-01   +1.407841520117599e-01   +8.668520064540784e-02   +6.778476834687884e-01   +4.147913662832301e-01   +1.990311203503201e-01   +3.193337231772013e-01   +2.129416271895880e-01   +8.872350003561348e-02   +5.653101587334547e-01; +7.472203939868178e-01   +6.141531341242504e-01   +7.943482688242051e-01   +1.163064706140479e-01   +5.385651820571271e-01   +2.619927554651702e-01   +4.205005187879594e-01   +2.124511574015292e-01   +5.715369518726586e-01   +8.471426266267082e-02   +3.786764039649241e-01   +7.485854230694986e-01; +2.925882684425780e-01   +2.585549374551495e-01   +2.303804071883295e-01   +7.205057628312453e-01   +6.817814901830926e-01   +7.866079333153506e-01   +3.317486838947995e-01   +7.875058261821709e-01   +8.860545359095419e-01   +1.664047549835346e-01   +5.668194996549035e-04   +5.765295599370140e-01; +2.005803432861379e-02   +5.466127952813531e-01   +1.511430754422579e-01   +7.892077660436133e-01   +7.719744038215323e-01   +1.266636643291633e-01   +7.605810411747026e-01   +2.999666453192081e-02   +5.638717615949330e-01   +2.687148395331301e-01   +5.013772690425220e-03   +6.941856046342024e-01; +1.404285248174495e-01   +5.754266165196604e-01   +4.487400396593824e-01   +8.098606010938418e-01   +7.451014584126275e-02   +2.125694813677373e-01   +1.840565673590845e-01   +1.408919810679142e-01   +2.909645016522774e-01   +2.806510203053252e-01   +5.118862461087763e-03   +3.328955869401864e-01; +6.990978878835599e-01   +2.293688502643190e-01   +1.371331355489511e-01   +4.229889804724997e-01   +3.015488128107955e-01   +5.024742016079851e-01   +3.056924737618414e-01   +5.564261753789852e-01   +1.186703510773692e-01   +6.776858368815079e-01   +1.154291692155597e-01   +1.389220533815965e-01; +7.380500363023107e-01   +8.752856684885698e-01   +5.536091047217355e-01   +6.448150776513047e-02   +4.338174283446587e-01   +7.683321540701399e-01   +4.500779261372932e-01   +6.912510813669802e-01   +3.186210943438960e-01   +5.072752238673324e-01   +3.428237634880112e-03   +4.271692454276243e-01; +3.383175140692926e-01   +4.760287416872774e-01   +4.969727198605912e-01   +2.101767449910081e-01   +7.058383536401471e-01   +7.337284560191268e-01   +7.189878311487132e-01   +7.746964502567693e-01   +5.948530860198595e-01   +2.850849714827208e-01   +7.985319731312465e-01   +4.120468477156077e-01; +1.111880632894100e-01   +1.433272315778107e-01   +8.705967555429659e-01   +5.931607219155961e-02   +5.984676834707439e-01   +3.329779799747074e-01   +7.737461202531115e-01   +4.787923993347852e-01   +7.534724096154886e-01   +7.167529066861409e-01   +3.868005700476217e-01   +6.428737402273649e-01; +7.985626239075189e-01   +1.940681682525775e-02   +1.229124713362227e-01   +9.328667366221405e-02   +2.228262658107334e-01   +8.756733372718550e-01   +8.263361285791562e-01   +3.194833113901712e-01   +7.237604644609628e-01   +5.655257182261285e-01   +2.790319245786241e-01   +4.652246824014228e-01; +1.247128296093716e-02   +7.846550785075498e-01   +7.633032199577242e-01   +6.637604455097998e-01   +8.548726768007784e-01   +5.164141445382983e-01   +6.452879527753451e-02   +7.547694183515304e-01   +6.393700434398931e-01   +2.973725425325683e-01   +6.633984061248593e-01   +7.665654091567050e-01; +3.461877742846590e-01   +3.628925754992747e-01   +2.327115921174510e-01   +5.032651514650183e-01   +2.801931789492680e-01   +5.328900034147287e-01   +3.111142141012213e-01   +2.654076439406213e-01   +3.122348604424183e-01   +7.721404662649122e-01   +5.293185184177380e-01   +3.660310620187770e-01];
L3E_L3I_iGABA_netcon = [+5.523421463322836e-01   +2.120173664925046e-01   +4.239657823692520e-01   +1.385650524196589e-01   +8.489530724311016e-01   +2.119671617034437e-01   +3.148788072476605e-01   +8.912202550278419e-01   +1.289331899466806e-01   +2.166066898629011e-01   +4.874603781636634e-01   +5.409013747243452e-01; +6.721268767457226e-01   +8.418231554859256e-01   +1.834235256711947e-01   +7.373949955836716e-02   +5.253486395451674e-01   +7.387661425588592e-02   +7.834773593238591e-02   +2.962698203477771e-01   +7.404485716401146e-02   +4.391456197939441e-03   +6.788687445475006e-01   +2.235512863654580e-01; +6.882313731549322e-01   +7.771385233539828e-01   +8.017109361873835e-01   +3.252193919316680e-01   +4.478280786259389e-01   +2.315508812423434e-01   +1.116851111613655e-01   +8.328099738011902e-01   +1.009546800825472e-01   +7.372676629408861e-01   +1.926204429895945e-01   +6.167091052951912e-01; +2.127314414658095e-02   +5.491016900293915e-01   +4.235755740040758e-01   +8.411148720447111e-01   +1.910040502918953e-01   +6.102940476946759e-01   +3.995189233579678e-02   +8.078016613376559e-01   +4.191462534255684e-01   +5.113797568527262e-02   +7.990565946605652e-01   +7.502010153054246e-01; +6.771449370494157e-01   +3.650718967571420e-01   +1.779326050950079e-01   +5.038279998466639e-01   +6.752026338441223e-01   +1.413245102462331e-01   +1.461931188995954e-01   +5.463860537511230e-01   +1.547899784779605e-01   +5.245085056195076e-01   +9.614563701988632e-02   +4.456262119294829e-01; +7.016944534242010e-01   +4.974523505992059e-01   +1.726172248287366e-01   +2.037248030699577e-01   +2.721172532729083e-01   +2.123978510572253e-01   +5.871934885876232e-01   +6.362185012171485e-01   +2.053971650494169e-01   +6.825589030808487e-01   +4.797906271587700e-01   +1.399005637147081e-01; +4.261476345654933e-01   +1.299320718127741e-01   +5.767679951221163e-01   +5.995770353542347e-01   +7.351080462500416e-01   +4.803586595898941e-01   +6.417586079649874e-01   +4.242210726600196e-01   +2.266167221331163e-01   +6.661001816794530e-01   +6.256960105175124e-01   +4.804517167397112e-01; +7.046727331888967e-01   +3.756187683382702e-01   +2.453705708938781e-02   +3.926701388070648e-01   +2.769956214943890e-01   +8.600834397929674e-01   +3.457552596702629e-01   +4.324849170550066e-01   +5.681292852034405e-01   +4.127300028054156e-01   +4.479211081519173e-01   +3.144564730035416e-01; +5.706023882028457e-01   +1.165525665878817e-01   +4.821982288273217e-01   +4.430284831772529e-01   +3.870980348971706e-01   +8.271170604726322e-01   +3.721596222012821e-02   +7.778024366252683e-01   +6.431685420123383e-01   +7.423558450062447e-01   +1.298853657741592e-01   +4.115946258639235e-01; +2.747130566524674e-01   +5.293166769542207e-01   +6.136215209910471e-01   +6.381945641321007e-02   +4.247065803438914e-01   +6.274324005510592e-01   +4.555526569378104e-01   +1.874844362857213e-01   +7.945601691261245e-01   +6.786592676804358e-02   +3.916666185034458e-01   +6.709906115945559e-01; +3.516643744574618e-01   +1.716334578521889e-01   +9.917422672311098e-02   +6.980310172407940e-02   +4.614560315307072e-01   +7.872647730287995e-02   +5.403457335074382e-01   +6.290616483890802e-01   +6.586085379286553e-01   +5.130245782075764e-01   +2.521129232514554e-01   +8.517803056254002e-01; +7.266517730682983e-01   +1.506494640538213e-01   +6.373167566276191e-01   +1.458247425485893e-01   +3.690345199555147e-01   +8.844129065775096e-01   +5.908696018960246e-01   +8.990538371990262e-01   +7.245384019004322e-01   +6.333753831245382e-01   +5.762245503773353e-02   +1.048558127766505e-03];
L2E_Input1_iAMPA_netcon = [+4.721162803593630e-01   +6.439874914363325e-01   +2.095719245465016e-01   +8.623466485730359e-01   +1.452341697413585e-01   +8.505112453243917e-01   +7.422141246223093e-01   +9.909073645350970e-02];
L2I_Input2_iAMPA_netcon = [+2.548798547902409e-01   +2.960442254852163e-01   +4.735359874867777e-01   +7.272380293685439e-01   +7.901136492401882e-01   +6.900129596854786e-01   +1.120149901232246e-01   +2.081802940071940e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
