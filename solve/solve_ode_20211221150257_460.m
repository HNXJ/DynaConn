function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.134240453551403e-01   +1.866698186250268e-01   -5.439944698896462e-01   -4.207933421466516e-01   +6.209857607032856e-02   -1.629938029779754e-01   +1.312881003529458e-01   +3.262547406099529e-01   +1.346377526307318e-01   +1.834667125866920e-01   +2.121839704357601e-01   +3.070653466173563e-01   +2.847973964693924e-01   +1.991026337859827e-01   -5.005814660349913e-01   +4.406462235845799e-01; -4.857680451498274e-01   -1.202259447925258e-01   -5.262679048901393e-02   +2.423454841659259e-01   +4.683597320416258e-02   -2.149176403942695e-02   -3.329055802896245e-01   -3.701688317565123e-01   +1.229044234720674e-01   +1.645066233626181e-01   -1.136453833548322e-01   +2.823879121908988e-01   -6.121348132244634e-01   -3.480596639121882e-01   -4.150201939867029e-01   -4.741085747092106e-01; +4.432208297108776e-01   -9.303380406654262e-02   -1.726332436626727e-01   -4.747547943072482e-01   -7.917616410234476e-01   -1.126996108411742e-01   +1.725726757591922e-01   -5.217897175079327e-02   +2.239455186967918e-02   +1.995694440424150e-01   -2.098482822363989e-01   -2.843542338752683e-03   +4.867627106122541e-02   -5.915307952477773e-02   -3.018716586199538e-01   -7.175556455210816e-01; +5.156685903323720e-01   -2.053906991187036e-01   -3.397544953340532e-01   -3.448498088380212e-01   +1.801887703018261e-01   -8.884064119018469e-02   -1.743910190606097e-01   -5.509547644535168e-01   +2.210819787730983e-01   +2.278153638709224e-01   -2.924014002125345e-01   +2.674186535351104e-02   -4.725804862640397e-01   +1.491837678391720e-01   +3.837712339462711e-02   -2.714508574867900e-01; -1.113922784641616e-01   -6.960988029321909e-02   -4.136285095339430e-01   +4.166565522179295e-01   -3.502393331534869e-01   +1.614202700014014e-01   +3.694432536167887e-02   +1.513589009981200e-01   +5.224624992151095e-03   -4.437962739687588e-01   -1.053124606576419e-01   -1.771509620107946e-02   +1.605979137954890e-01   -3.335487732594267e-01   +3.287985358509707e-01   +4.092221297577752e-02; -7.816245902551606e-01   +4.140888407893602e-02   -6.832549756522495e-01   -1.410417090315459e-02   +3.634192042967956e-01   +5.327519960705352e-02   -1.652117530998115e-01   +2.580411329459462e-01   -5.791046183805842e-01   +8.955304243343917e-02   +2.345146465951923e-01   -1.109275743382630e-02   -4.686022813231837e-01   -6.736720642955440e-02   -3.367232444861823e-01   +4.155303385554586e-01; -2.428739599339194e-01   -1.808921567388977e-01   +5.215592958872748e-02   +7.313943669102367e-03   +3.938289411883110e-03   +4.038650876963060e-02   -1.414844191866347e-01   +1.701965116514779e-01   -3.638920215721067e-02   +6.847207619081665e-02   +2.006995256979811e-01   +1.567321748085211e-01   -8.668896107065824e-02   -1.395383791746317e-01   -1.747085841982687e-01   +1.905407951620218e-01; +1.808950092162211e-01   -4.622773282467856e-02   +4.918092085393409e-02   +3.271664335802352e-01   -3.813933929808408e-01   +3.591907772960893e-01   +1.619809197406085e-01   -2.041116607617181e-01   -3.872387307881991e-01   -7.882772322416440e-02   -3.838220929047870e-01   -4.724071561820907e-01   +1.587059680928261e-01   -2.520315782498633e-01   -2.018534981376350e-01   +4.412753705171038e-02; +4.209250882157363e-01   -1.627213413299587e-01   +2.622182585023496e-01   +4.763478383256218e-01   -2.217420639736873e-01   -3.561215209179922e-01   +6.905065913075701e-01   -2.983443887034932e-01   -1.839667209158510e-01   +4.348985789808574e-01   +1.512141325619606e-01   +3.289307108868588e-01   -3.580202399958404e-01   +1.777065489632480e-01   -8.432380948008236e-02   +6.141867403448951e-01; -2.087995384885614e-01   +2.796070236022091e-01   +2.712014673243675e-01   +2.275102906453857e-01   +1.563509722165618e-01   +3.983257262292847e-01   -1.583719159012476e-01   -1.346095155662767e-01   +3.175179878937042e-01   -6.910618547435290e-02   +1.021354393832276e-01   -6.178794880000841e-02   -2.576060714963641e-02   -1.251662060513147e-01   +5.454186165592972e-02   +9.399229334958857e-02; -5.104942600104777e-01   -5.554527687454733e-01   +3.907889181780152e-01   -3.084919993223282e-02   -8.243505124640091e-02   -2.220708558746631e-01   -1.743236339897043e-01   +1.522377112054408e-01   -8.595768277507038e-02   +3.901598789333568e-01   -6.098135265881736e-02   -4.122113413134614e-01   +1.611993266535754e-01   -3.723209233139107e-02   -3.772952499866220e-01   +3.347413400359892e-02; -1.020347707261484e-01   -8.899281380954902e-02   +5.841308783503970e-01   +3.429729123286301e-01   +1.147769428214185e-01   +2.347952060559160e-01   -1.596135939129182e-01   -1.172551409092396e-01   -2.465370058587624e-01   +4.560700249397214e-01   -3.573464824357515e-02   -2.815191209845365e-01   +5.197272102067898e-01   -1.094148071470958e-01   -4.221754437086870e-01   -1.736563945570024e-01; -4.012693865461863e-01   -2.084944787065714e-01   +1.351748286830494e-01   -1.821377348933715e-01   +1.491158673429673e-01   -8.541111677983525e-02   +3.179160930884726e-01   +3.459689508940001e-01   +2.366832455980342e-02   +2.069323826123794e-01   +3.560066951293805e-01   +1.267182252785982e-01   +4.491141737767720e-02   +1.131632093190016e-01   -3.865268350322989e-01   +2.612903091574234e-01; -2.653662201548975e-01   -1.463876242172496e-01   -3.742802825501341e-01   -1.184075783662036e-01   +2.853270047555121e-01   -8.842133641586504e-01   +3.842446657366091e-01   -4.347872791783021e-01   -1.875377023378091e-01   -3.281189304286162e-01   +2.353526487711444e-01   -5.238238045020482e-01   +1.202698804743962e-01   +4.117834611945975e-01   -1.648163549858828e-01   -1.656680367088931e-01; +4.433073306831832e-02   -5.340299482031383e-01   +1.583172488164748e-01   -4.831130822663567e-01   +1.343564667024239e-01   -1.541085076464750e-01   -1.810109605405417e-01   +5.236967504506413e-01   +2.009006896932067e-01   -2.339826218727737e-01   +3.049482082352717e-01   -3.337738764360303e-01   -1.820414345507473e-01   -6.006672415646645e-02   -3.185512442951153e-01   -3.658742637680605e-01; -2.425578255160480e-01   -2.827549836394507e-01   -2.606709263231840e-01   +1.914827034912937e-01   -3.063467440365021e-01   +7.551006941296128e-02   -1.810391750660313e-01   -4.148519443871029e-01   -4.121382878253801e-01   +1.014001421695495e-01   -9.542973403954487e-02   -1.004648796961578e-01   +5.231335970651497e-01   -7.743227766244233e-03   -2.461826730923332e-02   -2.459604743149457e-02];
L1E_L1I_iGABA_netcon = [-6.021035931854105e-02   -5.939538178701777e-02   +1.480161348364231e-01   -8.342885622314311e-02   -4.646854022545354e-01   +2.530710116396558e-02   +5.297578526699283e-01   -4.056382010056660e-01   +3.127593475930684e-02   -1.484638846089679e-02   +1.092106284528659e-01   -1.001731889485797e-01   -8.082162951649349e-02   +1.579310944105510e-01   +2.103102370965611e-01   +1.119554588510236e-01; +5.947442550077977e-01   +2.730020124313698e-01   +8.565069118884945e-02   +3.849403849758440e-01   -5.221008806984614e-01   +1.756311343662599e-01   +4.496548929008458e-01   -6.288198256092763e-01   +2.289228955976642e-01   -2.457616502208920e-01   -2.093985226123765e-01   -3.541894851245558e-01   +5.576643139956462e-02   +1.828049056996801e-01   +1.195414676091054e-01   +2.966411040902755e-01; -2.926371327016849e-01   +4.197936579129852e-01   -1.074629811574442e-01   -2.684416666212474e-01   +6.205877178114265e-01   -2.477055670936636e-01   +4.791207628159307e-01   -6.930787602176776e-01   +1.412852344278778e-01   -1.649151688798481e-01   -2.480952294208956e-02   -2.313421115057465e-01   +7.376384389987208e-02   -5.501842112925742e-01   +3.216217045747060e-01   +1.116393190306711e-01; +8.904873012132992e-02   +4.499758161268122e-01   -2.459925818298445e-01   +1.330431503011961e-01   -5.083855414389564e-01   +7.911810747460080e-02   +2.411371393955984e-01   +2.623384116769587e-01   -4.115177843778267e-03   +1.436531486576995e-01   +2.681770700003310e-01   -1.537206762768148e-01   -3.583468113429258e-03   -4.623084508157955e-01   -1.057998212068023e-02   -3.070495492845436e-01; -3.922019491222756e-03   +1.300624011406640e-01   +1.720877994335019e-01   -1.960163865501237e-01   +3.453172251331128e-01   +1.205922970875407e-01   -1.356833128499447e-01   +2.153345280558930e-01   -6.328488010537055e-02   -1.441372190662663e-01   +2.016497151466643e-01   -1.737839628017484e-01   +6.256909282657394e-01   -1.042907730223520e-01   -1.628844594300986e-01   -5.112507522055617e-01; +1.857552862685222e-01   +1.885291554361863e-02   +4.441487540294051e-01   -3.350455799490439e-02   -8.512698471816334e-02   +1.134628929582684e-01   +4.963294003534333e-03   -1.004648413271424e-01   -5.686735955871718e-01   -2.758391974264766e-02   -8.808115593753074e-02   +8.446357451649556e-04   -3.393115395031977e-01   +2.800146793402956e-01   +2.064465174117543e-01   -2.822287586087238e-01; -2.369091569630462e-01   +1.250918860737689e-01   +1.737867782056151e-01   -1.181729224582128e-01   +2.856595443324230e-01   -2.326674643178638e-01   -3.726254717717744e-01   +3.270060897138288e-01   -8.214522062214404e-02   +4.203506628078479e-01   +7.273803664004000e-03   -5.487448796910409e-01   +4.041365675620270e-01   +3.623608766287238e-02   -5.974950211351510e-01   -9.606945025831967e-03; -3.876165885416560e-01   +7.998855901502878e-02   +2.416710085732189e-01   -2.199175549699907e-01   +5.885258116927099e-02   -2.416693322459612e-01   -3.517593739896174e-01   -4.754366611332087e-01   +2.490291495069806e-01   -3.817949351250126e-01   -2.157797050051858e-01   +2.048412146871523e-01   +3.941491240389121e-01   +2.310555027554520e-01   +3.834493191830051e-01   +9.671649835774307e-02; -2.370545353476750e-01   -2.790766011009368e-01   -2.061250749104217e-01   -1.394164097446464e-01   +3.902181291283570e-01   -6.204193573697721e-02   -3.412035675414727e-01   -3.664429753888991e-01   -1.103911403323019e-01   -7.188036062540340e-02   +4.101982956083791e-01   +2.578791957493075e-01   +2.544360773904198e-01   -1.891390953505181e-01   -3.461598894546186e-02   +3.317433126883648e-01; -5.937743331969146e-02   -1.308244747361741e-01   +3.106855165019953e-01   -2.064242743911043e-01   +4.259688443955349e-02   -2.280067606238885e-01   +7.524702329627239e-02   +2.316290611661851e-01   -7.877722492473468e-02   +1.624035783017706e-01   -6.892117568869623e-02   -1.129857157469833e-01   -1.143289319627515e-01   -1.837091313120259e-01   -6.214723214375937e-01   +1.122898432703419e-01; +5.184093227758433e-01   +1.417511345345199e-01   +6.518964869076581e-02   -4.034469281423607e-01   -5.949587480377324e-01   -2.566500934152010e-01   -5.304739539758366e-02   -4.427791127711208e-01   +6.663638026392535e-02   -7.893466778088934e-02   -2.026818572868287e-01   -1.954932344067210e-01   +4.156648103499773e-01   -9.121928709920332e-02   +2.143945433530344e-01   -1.439971251930587e-01; +1.054986013824415e-03   -5.957453012049635e-01   -2.975292588746507e-01   +2.141900435119779e-01   -1.561822547065427e-01   -5.226180442788083e-01   -6.608784079340807e-01   -1.074523774514514e-01   +3.576879999119245e-01   -1.262462046901293e-01   +2.150611104228506e-01   +2.765240009320699e-01   +2.323549855151130e-01   -4.385692666024030e-01   -1.519617115810745e-01   +4.111191333598680e-01; -3.629166026119097e-02   -1.114205931957077e-01   +5.543704201797330e-02   -4.430881904842975e-02   -1.480667400864354e-02   +1.136940756286089e-01   -7.563463424671488e-02   +5.239651644418688e-01   -3.239494403035654e-01   +2.018703969067256e-01   -4.546990126527927e-02   +5.610367235568199e-01   +4.494599136520572e-01   +1.961469973866852e-01   +1.690725663014279e-01   -4.816230036024317e-01; -1.312635285415001e-01   -1.630868707819144e-01   +1.494713041897048e-01   -4.819957557774733e-01   +6.571282897573262e-01   -6.063777086052964e-02   +1.814987708135765e-01   +2.161510443723165e-01   -2.458049706803869e-01   -2.687769245605973e-02   -9.621975629847115e-02   +3.808728564882208e-01   -2.762263027956188e-01   +6.626295283766152e-02   +2.449948574066648e-01   +6.653834134368865e-02; +4.437449744683744e-01   +4.321955002268325e-01   +1.788183169692858e-02   +1.351847460000491e-02   +1.047676125285125e-01   -2.899848437163691e-01   -7.342477176927530e-02   -9.564968335229829e-02   +6.009706205034704e-01   -3.541663443142986e-01   -9.478233500266972e-02   +2.544892913468245e-01   +4.555722648138562e-02   -2.101570307239244e-01   +8.760060492775949e-02   +3.067885587387810e-02; -4.330043857550150e-01   -2.130321046581391e-01   +2.961458041048015e-01   -1.055537623050036e-01   -1.506431718987437e-01   +4.012649547491256e-02   -2.744401755821177e-03   +5.433771026103412e-01   +1.607016985572847e-01   -6.178831449060279e-01   +2.218910211202161e-01   -5.852029072970360e-02   +7.533431830444849e-01   -4.913361549769572e-01   -3.615621599258802e-02   +1.834589241758559e-01];
L2I_L1I_iGABA_netcon = [-4.469531553170449e-02   +1.593391315632557e-01   -2.002497633867322e-01   -1.934484649542204e-01   +7.483791258223653e-01   -5.399828324814122e-02   +4.032404599019186e-01   +1.752925429769165e-02; -3.741794394028563e-01   +4.185320883292547e-02   +5.697073426190636e-02   +2.819100984757308e-01   +1.622766350661722e-01   +9.662447760600228e-02   -1.688529326747359e-01   +3.880817447660146e-01; +1.760591581159241e-01   +4.868887801229357e-01   -7.695527605654502e-01   -2.772866775352117e-01   +1.008006214334916e-01   -3.642902258053657e-01   +9.841694584276058e-02   +6.482808291173912e-02; +2.692360489693943e-02   +2.434943181538227e-02   +2.462412440562204e-01   +4.728901674538541e-01   -1.263955177442720e-01   +2.997803753430688e-01   +1.981790455281368e-01   +2.640228021054575e-01; -5.145269085928135e-01   +1.961451842075923e-01   +4.723898351035581e-01   +3.518774291914547e-01   +3.011407338379942e-01   -2.549883711356601e-03   +1.069920907903901e-02   +1.106223230718335e-01; -6.776118720796828e-02   +3.647702661923271e-01   -2.284307130280716e-01   +2.794775860379993e-01   +5.579559923924382e-02   +2.797905754586211e-01   +2.658047559884156e-01   +3.208976257109944e-02; -3.674361527927593e-01   -4.652102047660562e-01   -5.665966823955378e-01   -2.790577084542209e-01   -3.410551277926289e-01   -2.841470297299065e-02   -3.453541762009469e-01   +3.367203878760645e-01; -1.258021539318775e-01   -4.717704452957758e-01   -2.467046570343124e-01   +2.711674522482211e-01   +3.484094605508166e-01   -3.846200913451144e-01   +7.974997411049965e-02   +5.926098724982397e-02; -7.642105916728342e-02   +6.730578242859472e-02   +9.481396188560934e-02   +4.090591486166085e-01   +9.392335823220335e-02   -2.778519674563983e-01   +1.858886549740518e-02   -2.357088164612850e-01; -1.048244927160684e-01   +4.770609931257713e-01   +3.565225245539231e-01   -4.589165988250521e-01   +2.477929976653920e-01   -1.920334649567826e-02   +2.007450065750481e-01   +8.027600994269882e-02; -1.186914140236511e-01   +9.006218668818844e-02   +6.596466281250640e-02   +2.603134569847669e-01   -5.129941124948748e-02   +4.967170929824886e-01   +1.947588261076046e-02   -8.945464121385234e-02; -1.290649311600851e-01   +6.521085612869210e-02   -3.454803396193257e-01   +1.914199633961328e-01   -3.195171722297449e-01   +5.780251835650086e-02   +3.390025375845215e-02   +1.148669126950471e-01; +1.375565887634658e-01   +2.071860087668618e-02   +5.730045648277441e-01   -5.312455295205075e-01   +3.415799587180796e-01   -4.360911291641599e-01   +7.144634427307861e-01   +1.758893195077059e-01; +4.671565346016157e-01   -4.842268443192731e-01   +1.173319766040510e-01   +2.203670568376244e-01   -2.270022865775598e-01   +2.501416230205802e-01   -3.310174624584430e-01   +6.844404241667262e-02; +5.483948866540428e-01   -1.285352798918201e-01   +1.578400099070851e-01   -3.575504040643743e-01   +5.630250457233279e-01   +1.391584015459797e-01   +3.057574435719749e-01   -6.391015371349321e-01; -3.452197495602981e-01   +8.206525751286239e-01   -1.103344386223399e-01   +7.386383539394152e-01   -1.195102854746928e-01   +4.256052879593023e-01   -3.648750593266677e-01   +2.605482678800773e-01];
L1I_L2I_iGABA_netcon = [-5.817232983513152e-01   +1.679728537482055e-01   -4.111171324652079e-01   +7.417903728315949e-02   -1.592268510497991e-01   +3.454729750936500e-01   -4.152543159754006e-02   +3.421101387773865e-01   +1.219022688758595e-01   -4.451316607253248e-01   +5.538786117778004e-02   +5.664609678458378e-01   -5.306744400783570e-01   +1.332410557233254e-01   +4.838797529383414e-01   +4.546383865270088e-01; +3.895668789556272e-01   -5.014372401749309e-01   +7.327901937739689e-03   +1.370901265840947e-01   +7.803697267213474e-01   +8.480967581159032e-02   +4.106585590575119e-01   -5.230070372281007e-01   -1.857093931969472e-01   +1.555227905996203e-01   -3.158633501456173e-02   +4.620351059845189e-01   -7.068482509948872e-01   +2.633248817652598e-01   -3.857674761801041e-01   +3.077697320872154e-01; -1.521243891215885e-01   -4.767048965466197e-02   -5.770557521511617e-02   -4.440590202397020e-01   -2.234603978254358e-01   +2.914241271097064e-02   +1.414264936591929e-01   -1.813314498548454e-01   -2.181608496734067e-01   +1.447416080103740e-01   +1.507384169136942e-01   -7.480464294426777e-01   +2.977104343198507e-01   -3.260250012633520e-01   -1.280008610989448e-01   +5.418443377285129e-01; +3.206213396357155e-01   -3.624044385101028e-01   -1.965724323437457e-01   -2.189009437061167e-01   -5.277343505880731e-01   -6.470306919429667e-01   -2.205884243566404e-01   -2.240150560589601e-01   -6.347114756493524e-01   +1.231851117772609e-01   -2.811136291451581e-01   -3.426383813254913e-01   -5.407205229434058e-01   -3.981126279235511e-01   -4.000494847861549e-01   -5.416826005935501e-01; +3.157926497530595e-01   +2.519146365364109e-01   -2.990130660552023e-01   +5.663441629119762e-01   +3.151664176653355e-01   -1.341077266503312e-01   -2.987852055110960e-01   +9.599497985600572e-02   +1.607105542558419e-01   -4.079547281589712e-01   +5.323400459233318e-01   -2.053655302901465e-01   -1.406113561689514e-01   -2.611420319987940e-01   +3.209513547460405e-01   -1.802052831289550e-01; -6.967918942920907e-02   -1.990257634122113e-01   +7.128551912325859e-01   +4.961346813828874e-02   -1.988428180415530e-01   +3.726346373644434e-01   +4.474311275429498e-01   +2.476674259536663e-01   +1.920825186669857e-01   +7.082558378239652e-02   -2.607727661902957e-01   -3.539700233926993e-01   +3.131659422551267e-03   -1.596805156922224e-01   +2.407024277516850e-01   -4.999773865565035e-02; -1.946226666448656e-01   +1.462765739547841e-01   -1.482131276939285e-01   -1.287367947195953e-01   +2.530438935326156e-01   -4.085729266064697e-01   +1.922796319978412e-01   +4.085573972992907e-01   -8.554627400963055e-01   +3.694245689281495e-01   +3.613661734653529e-01   +1.239458419533301e-01   +7.640462191803171e-01   +2.511765581880567e-02   -1.465101403455327e-02   -2.518948605438396e-01; +3.063516660050435e-01   -3.647260293908093e-01   +1.735468922133407e-01   -3.561595563778485e-01   +4.473940233571007e-02   -8.896846041541681e-02   +1.106545607671654e-01   -3.849565783452569e-01   +3.788049555439462e-01   -3.854759087323716e-01   +3.822552072743548e-01   -1.992583313074150e-01   -1.620947825010218e-01   -3.939705354104476e-01   -2.199256582017507e-01   -6.306245699824853e-02];
L2E_L1E_iAMPA_netcon = [+2.258369042237949e-01   -2.821340948491498e-01   +1.206984977015306e-01   -9.026718205442916e-03   +1.218797568788266e-01   +1.893140520213780e-02   -1.779072899047836e-02   +1.882248682336201e-01; +2.430321616291297e-01   +2.146370598798787e-01   +3.238868828188485e-01   +3.019537410638991e-01   +5.443500136223126e-02   +2.529268673686391e-01   -6.084053279932796e-01   +1.503566318640165e-01; -3.919628513112615e-01   +2.702245785083595e-01   -6.367790012385031e-02   +8.322713985316135e-02   -1.184070355695001e-01   -4.962361604418706e-02   +3.780192422538209e-02   +2.038878509799197e-01; +3.171414990317669e-01   +6.088090137864646e-01   +3.112806721633519e-01   +5.779902354789056e-01   +1.755419692916945e-01   +4.944623651700105e-02   +2.482485442104181e-01   +1.614185453453842e-01; -1.523441262649397e-01   +2.231119087499687e-01   +7.178621762961290e-01   +2.206577038080973e-01   -1.530346514122875e-01   +3.519956621247841e-01   -8.133030169529815e-02   +1.471070642837198e-01; -5.090628936351873e-01   +3.200967239638919e-01   +1.836680509509668e-01   +9.079146385355157e-02   +2.149146125557120e-01   -1.860250619568165e-01   +1.290325746291198e-01   -1.022490552729087e-01; -2.627904790667427e-01   -1.284056165498881e-01   +4.265139495830950e-01   -1.423447316373319e-01   +8.133555565840418e-02   +4.467429941932541e-01   -3.562459438941779e-01   +6.180708182185851e-01; +4.290367618338212e-01   +2.450137674613501e-01   -2.144252453169500e-01   +7.261891900322049e-01   -4.861973652814613e-02   +3.568987700837845e-01   +2.721586562285567e-01   -4.161532826768728e-01; -5.145907883137409e-01   -1.897018451602547e-01   +3.437066523967491e-01   +7.054099962474221e-02   -2.244786869843980e-01   -1.529427467612824e-01   -5.807579117165133e-02   -2.169164807414773e-01; -4.830431147169014e-01   -4.544063911819881e-01   -2.994830965358083e-01   -2.439603150935690e-01   -1.509884879659238e-01   +6.868208741060415e-01   +3.149487351017059e-01   +2.894200533352305e-01; -8.581505862444037e-02   +6.426118183529853e-01   -3.269830484169384e-01   +1.936192714356201e-01   -3.546799231438438e-01   +1.422070429026944e-01   +5.932856783929747e-01   -7.938462947840144e-02; -1.143160052801818e-02   -4.434455635401601e-01   -2.725800942042967e-02   -1.086558788144972e-01   +3.065748302928873e-01   +1.652521404241192e-01   -3.756596256417705e-01   -3.722818666257166e-01; -5.254630782039711e-01   +1.544371311656709e-01   +1.455810298513209e-01   -3.922094364360654e-01   -2.858698878655394e-01   +5.385886255818769e-01   +8.115172400908645e-01   +4.922729420180856e-02; +3.078439070177053e-01   -2.465074755536708e-01   -6.826745618434292e-02   +1.951130503817377e-01   +4.609498471392864e-02   -4.253631046716356e-01   +3.869260851271485e-02   -4.869284696625456e-02; -5.302129033282968e-01   +1.590257089276302e-01   +1.405514895030393e-01   -3.955137089270526e-01   -3.471890956706219e-03   +1.291370119860785e-01   +5.355611931743469e-02   +1.787567646414220e-01; +4.987020212703858e-01   -1.421008390705410e-02   +6.903550699462254e-01   -2.959129999687088e-01   -4.669179830627232e-01   +4.139066702037593e-02   -9.110133755571384e-02   +3.523338879708987e-01];
L1E_L2E_iAMPA_netcon = [+4.122607630636804e-01   +8.498234571839723e-02   +6.435000883724229e-01   -6.679512975539615e-01   -3.959725761518181e-01   -9.382919617885818e-02   +2.671457042493415e-01   -1.540203473087299e-01   -2.579892452354046e-01   -1.245514528010515e-01   -6.847348827926131e-01   +2.091619895134244e-01   -2.239294318812170e-03   -6.510355686449791e-01   +1.999297353841340e-01   -3.192179070604777e-01; -2.512730466840626e-01   -1.596905101375762e-01   +4.392382791494590e-01   +8.318870513395206e-02   -9.457353947513707e-02   -1.287015419930135e-01   +4.573738168790749e-01   +2.988455694853699e-01   +2.667889208399162e-01   +2.129757730783133e-01   -1.298048178626842e-01   +3.382984432383835e-01   -3.666118529968712e-02   +2.736866152013103e-01   +1.301530538068595e-01   -1.429789572988663e-01; +3.000880148639108e-01   -9.364287644665492e-02   +1.562494141764998e-01   +2.087430842215073e-01   +3.787511805711822e-01   -4.333637476695326e-01   +5.655987261567257e-01   -4.730049214777609e-01   +4.956749093466857e-02   -5.084367271750592e-01   -3.257642404120881e-01   +6.242798178867456e-01   -8.142937145890862e-02   +5.525221179397471e-02   +5.196956898390599e-02   +4.460478335767952e-01; -3.080813287196001e-01   -9.824321158014096e-02   +4.020601111653337e-01   +4.197766248365786e-01   -4.000672672963215e-02   +4.734868493138664e-01   -1.239280690510664e-01   +1.444567402317881e-01   -1.908625030231053e-01   -2.962291896512011e-02   -1.604890658291500e-01   +4.348506344098347e-01   +5.524073010746504e-01   +1.299614935210807e-01   +6.706488755896466e-01   +5.114014284045829e-01; +1.741963745916810e-01   +2.349490109082157e-01   -3.225160399139073e-01   +3.134488895568032e-01   -1.509743182347501e-01   +3.208770682006102e-01   -3.252973109124289e-01   +7.240150079603591e-02   +3.207958565399803e-01   +5.428739983576993e-01   +5.568936517298919e-01   -3.693930850801042e-01   -1.091064311912183e-01   +1.370671454552935e-01   -2.214493297988984e-02   -1.712977082099158e-02; -4.885726354736514e-01   +2.032709012084863e-01   +9.726602807308030e-02   -1.232263196257279e-01   -4.325947819712753e-02   +3.119236493373287e-01   +3.855898849624779e-01   +6.031566211713570e-02   -3.508446409529394e-01   -2.646718455464933e-01   -4.233340478838544e-01   -3.241388679084789e-01   -8.548245152786849e-02   +1.276873947409870e-02   +5.545735398961843e-01   +3.021413314626196e-01; -1.994506647472922e-01   -2.735216139980769e-01   -5.549029374746516e-02   -1.913420043542940e-02   +1.231719749354387e-01   -9.478515191837897e-02   -2.962818931055957e-01   -3.487031230064573e-01   +1.106971955228594e-01   +1.198535859880094e-01   -4.651858820504644e-02   +4.025817448872799e-02   -2.966230503980891e-01   -4.840389275726804e-01   -3.325349991324310e-01   -2.542418954585612e-01; -3.935516846626672e-01   +7.655957372612875e-01   +2.959069625325773e-01   -5.278487677039129e-01   +4.398795606155414e-01   -9.957876005345218e-02   +7.582780808750434e-01   -1.180899584201530e-01   -4.550460027848457e-01   -7.435625392966681e-03   +4.319333245643586e-01   +1.742495781667373e-01   -2.428786337255805e-01   -3.187207504575287e-01   +2.044547626794304e-01   +1.923727693907780e-01];
L2I_L2E_iAMPA_netcon = [+1.748138308728039e-01   -2.251081042360020e-01   -6.672008472307496e-02   -1.824826644534519e-02   +2.491685503880596e-01   -3.062766753030184e-01   -2.539589809216751e-01   +4.482323509049380e-02; -1.468567267984251e-01   +5.087399735653172e-02   -1.138681622485331e-01   -2.809985704565811e-01   -3.014403361863514e-01   -4.137133621302860e-01   +1.727136958891117e-01   -1.033130404409504e-01; -3.241808376699050e-01   -2.528781450640984e-01   -3.504114636833652e-01   -2.766557279660214e-01   +2.128934263281414e-01   +1.819051385001895e-01   -7.955743717706354e-04   -2.843059239123751e-01; -2.199069226842956e-01   -2.858848128888637e-01   +6.282121580196061e-01   -2.003119805919349e-01   +3.437261332566786e-01   -2.434806314467499e-01   -2.127787562586187e-01   -9.973065836754562e-02; +7.015383559354338e-01   -9.530680839569215e-02   -5.051639554735639e-01   +4.981682281500186e-01   -3.310136321340454e-01   -2.070031051352347e-02   -1.530894069885408e-01   -4.541314361744945e-01; +6.109468138102867e-01   -1.435381076843833e-01   -2.260252289465687e-01   -2.484761734441615e-01   -1.803574683540327e-01   +3.069379656752463e-01   -2.166381625660928e-01   +1.327243764712276e-01; +4.009897131422789e-01   -4.454262164911901e-01   -6.228353248290782e-01   +8.567159913790999e-02   +1.750903742827569e-01   +2.243582329356185e-01   -1.745284041698328e-01   +1.116326554518681e-01; -1.525628630665225e-02   -2.643994370187218e-01   -3.974867755542066e-01   +4.211793185021300e-01   +5.345947646618548e-02   +2.458058538923925e-01   +1.863052961452284e-01   +6.549003235304360e-02];
L2E_L2I_iGABA_netcon = [-1.649355518827521e-01   +1.967612815637241e-01   +3.991955330831642e-01   -2.987895664133475e-01   +6.850532540487441e-01   +3.698726544814165e-01   +4.569700825147504e-01   -2.930034227419679e-01; +2.937305012041439e-01   +1.966076748024010e-01   +5.241361348934376e-02   +6.721288311811637e-01   -4.187563831052424e-01   +1.671694278017394e-01   -3.089301186554322e-01   +7.841832392893223e-02; -9.747793094120810e-02   -3.172501082467640e-01   +8.190766215045293e-02   -5.944771202023927e-01   +6.855980735170659e-01   +5.504165659762855e-01   -6.934161789050473e-01   -8.264915460873656e-02; +1.930823480682060e-01   +3.813278727919930e-02   +3.810182376836752e-03   -6.882520275400514e-01   +3.392106345701613e-02   -2.795176754266092e-01   -1.554489986877520e-01   -1.824116413800544e-01; -1.175226296991073e-01   -2.120849968277416e-01   +4.366362911941212e-01   +2.093270027486604e-01   -6.335766415428006e-01   +2.835061005658293e-01   -5.290765377282892e-01   -1.266172777425318e-01; +1.983424217634494e-01   +2.525809678981715e-01   +2.079319535955557e-01   -3.762531565080855e-01   +8.218171054229617e-02   -2.402931006107852e-02   -9.950228316806928e-02   -4.788863363538451e-01; -2.113784042884057e-01   -2.364488973835193e-01   +4.964165682473032e-01   -2.007751383832622e-01   -3.192703414319314e-01   +4.897714504298941e-01   +1.405913705490058e-01   +3.620668151410342e-02; +1.553584600514984e-01   +4.607822506054503e-01   -2.280856468738683e-01   -3.293779269647325e-01   +2.335638232757813e-01   -1.424405089669686e-01   -2.328310230900257e-01   -6.542606759947155e-01];
L3E_L2E_iAMPA_netcon = [+4.663872789823159e-01   +3.748127990613591e-01   -2.413388038248838e-01   +7.359773743180863e-01   +1.063750890965502e-01   +4.535236381131181e-01   -4.707001005171831e-01   -6.200923725952066e-02   -5.454510492417208e-01   +4.902517754814631e-01   -5.265542292428188e-01   +1.534972945790316e-01; -1.580749699431092e-01   -2.060647435857156e-01   -4.072846372072335e-01   +1.613251903979529e-01   -3.639802276925823e-01   +9.881817663012292e-03   +7.146599666267697e-03   -2.241580313283712e-01   +3.959073511042640e-01   -3.538164603363236e-01   +5.652117316320580e-01   -9.344642220100111e-02; -1.874722714691702e-01   +6.452064508541733e-02   -4.835432469853870e-01   -5.549667821387287e-01   +4.492203210281335e-01   -8.823762808280518e-03   +1.264263518313262e-01   +4.557989319551867e-01   -8.172045713638640e-02   -5.517890470520033e-01   +3.971303980948194e-01   -8.334071443153530e-02; +1.574818921556975e-03   +1.110040602055637e-02   +2.781761437487292e-01   +4.671969943929861e-01   +1.683904523386400e-01   +3.900652581486554e-02   -1.888894542836783e-01   -9.843860631980908e-03   +4.448159665274766e-02   +2.284054311220065e-01   -3.785690546697734e-01   +2.677111848441032e-01; -1.319740912733207e-01   -3.766865037572789e-01   -1.733143879434132e-02   +9.236759454530109e-02   +2.149596626906603e-01   +4.325061408242631e-01   +4.722228527349798e-01   +2.911029936983630e-01   +3.475126328186756e-02   -1.021534761321388e-01   +1.341560077061928e-01   -1.795729101099298e-01; +2.097487612958642e-01   +1.210830489612431e-01   +2.139719874436693e-01   -1.699349412544580e-01   -1.076542441063918e-01   -3.515707824270599e-01   +4.998994102442655e-01   +2.767824879408426e-01   -4.771762857028707e-01   +2.241766526543729e-01   -2.255437960812556e-02   -2.523104600673630e-01; +2.517070999934680e-01   +4.319579921055476e-01   +9.537152394271317e-03   -3.469726902233357e-02   +1.863030783139928e-01   +1.295589830047337e-01   -3.098016899007525e-01   +1.230165938038527e-01   -3.835738716302388e-01   +7.802225384210776e-01   +4.684078441199017e-02   -5.121624026285678e-01; +7.178498107402503e-02   +5.879422717580043e-02   +8.620692255291519e-02   +3.577036517796756e-03   +7.075051591813786e-02   +5.550355278320295e-01   +8.309080732316855e-02   -1.519271438074117e-01   +5.023063002391098e-01   +4.507281987561713e-01   -1.918182322940382e-01   -3.601324246263200e-01];
L3I_L2I_iGABA_netcon = [-2.638064445391395e-01   -4.529176480148583e-01   -3.374547997340352e-01   +1.251921123570953e-01   -4.176935019247444e-01   -1.889919267990146e-01   -7.425787006532523e-01   -4.791597942502199e-01   -2.186556877538700e-01   -2.528636913171432e-01   +1.102242871616149e-01   +5.022848084332169e-01; -3.752438862239565e-01   +1.484104554360776e-01   -4.124308034208837e-02   +4.544817230134718e-01   -4.505073454309662e-02   +2.550528575888641e-01   -1.027383078071403e-01   -2.949347792166945e-01   +5.666064308862796e-02   -5.247117247755049e-01   -4.999484670052479e-01   -3.165413582600898e-01; -5.167245700917003e-01   -6.062585022636925e-01   +6.937828932033324e-01   -1.494380219224149e-01   -1.674103638855007e-01   -2.599243285019157e-01   +2.425853546175955e-02   -1.695672353907278e-01   +2.177059355482360e-01   -3.409130913540974e-01   -1.269573031505812e-01   -3.676444062153851e-01; +1.486825205363062e-01   +4.850317285701886e-01   -7.880143639575469e-01   +7.272071742745577e-01   -2.097040177374238e-01   -1.779501569807050e-02   +6.271080487662301e-01   -3.292429439196906e-01   -9.013650741519701e-02   +3.370125748463877e-01   -1.764745311145899e-01   -7.297086108088449e-01; +1.366493457980975e-01   +2.534129959356576e-01   -2.365113093661723e-01   -1.285005106292440e-01   -7.018377925947185e-01   +4.833200701095561e-01   -4.943952557296672e-01   +9.917510696318126e-02   -1.974123438508132e-02   +8.282877667099678e-02   -3.171233635211924e-01   +2.985249331149464e-01; +2.533182957735633e-02   +1.314680971553345e-01   +5.950379850921501e-01   +3.338582547434408e-01   -2.260467185811843e-01   -1.857007844276189e-01   +7.350304415695295e-02   -4.873824824178247e-01   -3.729883321748467e-01   -1.503960707493771e-01   +1.698215518152974e-01   +8.289227235463750e-02; +2.002374616746969e-01   +7.256082872918119e-01   +1.951097297685287e-01   +6.038049999998354e-01   -4.958440739402039e-01   +4.012986260901254e-01   +1.887520541902256e-01   +1.928995718920423e-01   +5.606049762500964e-02   -1.928972947271056e-01   +2.494193067917313e-01   +6.179196300167857e-01; +2.627703293334413e-02   -1.121062420841324e-01   +2.293625403747543e-03   +6.443048905778170e-01   -1.063312799143739e-01   -2.433841798122278e-01   +7.857129501121954e-03   -2.811373969574496e-01   -3.090483475407988e-01   -3.456632971444474e-01   -1.490545091438985e-01   -6.107095750656074e-01];
L2E_L3E_iAMPA_netcon = [-5.858623136849980e-01   +1.833610099885298e-01   -1.128650677418968e-01   +5.250600195689158e-01   +5.930299752310617e-01   +8.338955726162370e-02   -4.510771312508293e-01   +5.172023002078208e-02; -5.879465815720271e-02   +5.691177070825630e-01   +1.090097845219094e-01   -2.661091778750532e-01   -1.810937233004855e-01   +3.606875702622684e-01   -2.442001646245482e-01   +6.750037309221061e-01; +2.422303674539716e-01   -8.439938825932997e-01   -4.023863896762717e-01   -2.303992210620232e-01   -1.504861145884970e-01   +2.431928184130823e-01   +3.529071260519128e-01   -2.006005599569636e-01; +1.991832175698551e-01   +4.003948122023047e-02   -4.542113403076271e-01   +4.682654487027747e-01   +1.286589883078126e-01   -7.788616395172093e-02   +5.376709405862604e-02   -1.686089100627186e-01; +6.748155564935128e-01   +3.222709205055933e-01   -2.533680445526650e-01   -4.622295164221911e-01   -2.558038466829453e-01   +2.146094931034056e-01   +4.871148931619985e-02   -6.125049849095835e-01; +1.837799145154547e-01   +4.122679528453951e-02   +3.212095314515734e-01   +3.470627467970778e-01   -6.743157905031097e-01   +4.378990534182448e-03   +1.143522618321420e-01   +1.462648978335099e-01; -1.006272565015449e-01   -3.916723450823956e-01   +9.260991086516358e-03   -4.356680568329805e-02   +4.445165392058145e-01   +3.014213211309601e-02   +4.602411028484945e-01   +1.882955800484439e-01; +4.088391843633954e-02   +5.680892136402206e-02   +9.866456982710792e-02   +3.812584907267320e-02   +2.869565888215247e-01   +3.478040986052554e-02   +3.742305655833706e-02   -4.113456797193792e-01; -2.427667646355852e-03   +5.463288910254789e-01   +7.416919723530379e-03   +4.573461014252172e-01   +2.281726076980904e-01   -2.633056340361228e-01   -1.171117299207820e-01   +5.697125234524494e-01; -2.684654762790802e-01   -1.192041680070385e-01   -9.997476796858026e-02   +5.785845590447021e-01   +6.451142569702423e-02   +1.269675490166252e-01   +4.601581928205752e-02   +2.082201200127319e-02; +4.599804679346826e-02   -1.438656749191151e-01   -2.879042426730215e-01   +3.819399472105118e-01   +3.973810352864700e-01   -1.683000771912381e-01   +2.885285743781663e-01   -1.289868408676304e-01; -1.334518161399842e-01   +2.975948260766281e-01   -4.862941080339893e-01   -1.089145637546470e-01   -5.215831172154322e-02   +2.827649108300496e-01   +3.794341595179452e-01   +2.817406996796606e-01];
L2I_L3I_iGABA_netcon = [-4.187477547603174e-01   -7.400328721803646e-02   -1.804628183854515e-01   -3.964286917479727e-01   -5.207868099841024e-01   +1.627087633457232e-01   -5.769323882694587e-01   +1.874914618574568e-01; +2.303173716624297e-01   +1.638411668057907e-03   +1.997596303609406e-01   +2.112516760964679e-01   +3.496251738538623e-01   +2.084271552544857e-02   -3.846798197181547e-01   +2.974230564517551e-02; +4.102922455840641e-01   +1.220948079031472e-01   -9.330086330364531e-02   -6.386098299005594e-02   +7.635276125792159e-02   +2.704011447793587e-01   +1.410569178348931e-01   -2.197051349634606e-01; -4.416871404020781e-01   -2.770147603442148e-01   +1.432214476770688e-01   -3.441513342013445e-01   +6.256836004198887e-02   -4.783913033209765e-01   +3.447543880155184e-01   +1.116145096658340e-01; -2.008585154925154e-01   -1.433976385634892e-01   -4.967691898598520e-01   +1.495755056487197e-01   +3.911146194051341e-01   +1.760005909810853e-01   +3.941098204680022e-01   -6.335935483667963e-01; +1.095042050825084e-01   -2.404968892381802e-01   +7.009434706043515e-01   +6.845394503953714e-02   +7.449236542263230e-02   -2.607806550672626e-02   +2.875221060942790e-02   +2.525565170932556e-02; +3.339026378581124e-02   +1.525641286392072e-01   -4.222208222570978e-01   -7.778603807454665e-01   +8.838964086237441e-02   -3.766391586135656e-01   -3.440763765362923e-01   +3.321386136011384e-01; -4.976634588469985e-01   +1.513132617756979e-01   -4.643724652951826e-01   -1.079127620535528e-01   -3.115887157956713e-01   +1.574264962053538e-01   +3.355953752418836e-01   +4.798363915758180e-01; -4.821779419617472e-01   +9.176685852645625e-02   +1.893151109492580e-01   -1.826296840549521e-01   -3.706891638887656e-02   +3.455946150097089e-01   +1.428199322411757e-01   -6.777849222916127e-01; -3.314022406843649e-01   -1.930249223186302e-01   -2.094175936211927e-01   -1.700213468457670e-01   -1.606851463613909e-01   +3.750130081091443e-01   +6.360979576389902e-01   +1.136996004429290e-01; +1.781761653089471e-01   -6.520260354377853e-01   +1.240728616289407e-01   +6.993295081606018e-01   -1.341834406890052e-01   +2.527674438692278e-02   +2.119182177802142e-01   -2.360820816306905e-01; -7.925382934631703e-01   -1.918435897868189e-01   +6.840947483780941e-01   -4.807757605224182e-02   +1.013699912882924e-01   -5.048702206540810e-01   +6.571768821777589e-02   -3.863276198292254e-01];
L3I_L3E_iAMPA_netcon = [-7.488878146612588e-03   -1.890185831767908e-01   +3.298457964713737e-01   -1.248710961563546e-01   -2.157670322005117e-01   -4.896655844152267e-02   -3.111864042158914e-01   +7.661670232827767e-01   +2.767525206953209e-01   +1.838974259807709e-02   -9.571585925117296e-02   +7.381637042543678e-01; -3.658679890772189e-01   +1.123835005455642e-01   -8.750130752776905e-03   +3.804397021604911e-01   +2.177682639271540e-01   +3.381212517963255e-01   +2.650592036478620e-01   +1.038905415013008e-01   -5.792002937076700e-01   -1.705348128935830e-01   -7.073461546205989e-01   -1.763164075871188e-01; +6.959552182031173e-01   -3.942981218100685e-01   +5.661966625891038e-01   -2.535004666864621e-01   -2.607532505498635e-01   +5.644031643677650e-02   +1.790947159563225e-01   +5.945520180736994e-01   +1.655014741994069e-01   -3.483878999557666e-01   -4.243912444465247e-01   +2.376160611642436e-01; -1.325496469050073e-01   -1.438023080612512e-01   +8.483316398229448e-02   +7.468036455547561e-02   +2.342343606831985e-01   +2.488738234679151e-01   +1.941952021767135e-01   -5.633077538399688e-01   +3.648450824076180e-02   -3.058180230022494e-01   -2.568063943163028e-02   +3.137636671545576e-01; +3.357133039361547e-01   +2.552306152577984e-02   -5.091874955178807e-01   +1.656416304639100e-01   -3.364888590575408e-01   -5.350703511841085e-01   -5.741081953335658e-01   +2.893165372117279e-01   +1.640320707566067e-01   -4.700819491079903e-01   -3.009410848311789e-02   +1.353543099187786e-01; -2.989428745564467e-01   -6.162940212845995e-01   -3.687753891301896e-01   -3.127874175639772e-01   -3.017676876498898e-05   +4.114770358313390e-01   +4.156640019291503e-01   +1.600654178129713e-01   -6.414253937625983e-01   +3.911527006016848e-01   -3.609234071192386e-01   -2.688707599685448e-02; +1.620703141923426e-01   -4.064570406229829e-01   +2.196219695218430e-01   +1.058631707663016e-01   +3.733333338648001e-01   +3.229409374231212e-02   -6.236185924540556e-01   +1.905110365183195e-01   -4.685302644361179e-01   +3.776046962596794e-02   +1.577088495766604e-01   -2.918893746914953e-01; -7.553772828672095e-02   +3.574850919520456e-02   -3.527167328608756e-02   -4.862050933367257e-01   -3.389663851021356e-01   -2.105600928559874e-02   -5.127507043749625e-01   -4.937495031162470e-01   -2.733705293617925e-01   -2.841951128427899e-01   +2.066768278311124e-01   -7.575634725633612e-01; -4.234091742915096e-02   -4.774567677921411e-01   +1.540890672961017e-01   -3.790089184875077e-01   +3.262306880456268e-01   -4.330650009442473e-01   +3.732538834636207e-01   -3.751950774543891e-01   +3.777299065564172e-01   -2.789303318951385e-02   +6.371733162148289e-02   +7.049530784656394e-01; +1.873323852652209e-01   -4.926048471695951e-01   +5.672360761647669e-01   +1.813872410585513e-01   +3.781758534688442e-01   -6.221397949340854e-02   -6.579942430306688e-01   +7.675515097673166e-02   -2.536430269929452e-01   -5.362688645491240e-01   -2.381384077198777e-01   -6.124850652744520e-02; +2.883812067907988e-01   -3.312079144688865e-01   +1.763115154918435e-02   +3.560177960537632e-01   -5.027483266199955e-01   +3.177910742258011e-01   -3.814360652459822e-01   +3.188734365742145e-01   +5.445516226804561e-01   +5.026587230842993e-01   +7.308305902818777e-03   +6.282171630958111e-02; -3.388886492685885e-01   -3.100455601075003e-01   +1.221705335115977e-01   +4.081669334109431e-01   +1.105196815398217e-01   -1.568413740197507e-01   +2.117127224162363e-01   +2.835323018364634e-01   -3.806795850807049e-02   +6.902800961097044e-01   +1.517299277465745e-01   +3.221024425007399e-01];
L3E_L3I_iGABA_netcon = [-4.649991639041267e-01   -1.439805858655261e-01   -2.311203411303743e-01   +1.791702265934091e-01   +3.747251882071317e-01   +4.063773676873632e-01   +2.374329567501523e-01   -2.143781693406928e-01   +2.370511960098260e-01   +1.612443567612103e-01   -2.290000602804657e-02   -2.595884648038068e-01; -6.453522694296619e-02   -8.375869156247625e-01   -1.496063595167651e-01   -5.400437024983631e-01   +1.830768046498744e-01   +6.088278687892203e-02   -5.396309648945925e-02   -5.041742242566664e-01   +1.843036671111573e-01   +2.142468751370830e-02   -2.888843432603215e-01   +4.679392137370203e-02; +3.224173009459685e-02   +3.145685304824827e-01   -1.696957724070968e-01   +1.621721085157860e-01   -7.515376361150214e-02   -1.000072868691665e-01   +3.428902564020635e-01   -6.874162019712333e-02   +2.088992901580904e-01   -4.363984152572981e-01   +1.960297292488620e-01   -6.053216148262004e-01; -3.554989530337861e-01   -6.611033136452943e-01   -1.955124322523890e-01   +2.241986563318551e-01   +3.858965881426840e-01   +3.846544247490832e-01   +2.656636355102769e-01   -8.697355407745352e-02   -1.174444009049649e-02   -3.685621509887228e-01   +1.948903695208432e-01   +4.922214786543276e-01; +6.153791706760051e-01   -6.830813758715735e-01   -3.756217319818388e-01   -3.252759422897190e-01   -1.760888870609121e-01   -2.495283452922459e-01   -2.087859867706061e-02   -3.839410653175230e-01   -1.942258916639826e-01   +1.977786147286807e-01   -4.287693865334473e-01   +3.736828746081337e-01; -3.228137123385306e-01   -2.495511605681255e-01   -8.373826560534955e-02   -2.005903326294353e-02   -1.546246058897988e-01   -6.426185388295209e-02   -3.603218613224249e-01   -3.911094449073760e-01   +6.482021301734482e-01   -2.502678589416171e-01   -1.134549457398802e-01   +1.334423522073092e-01; -5.961441771048676e-01   -4.009903591502061e-01   +3.804441025355259e-01   +4.249502760951829e-01   +3.603845001396585e-01   +3.428681877868333e-01   -4.308879485263042e-01   +1.780362971722477e-01   +3.008057897289373e-01   +2.120947174734656e-01   +5.220063866787833e-01   -5.924675327318203e-01; +7.424346573701379e-01   +1.670232292245247e-01   +2.234647444152899e-01   -7.382522983825847e-01   +2.134325657203591e-01   +3.436554208259130e-01   -2.001416312259467e-01   -4.983261763146792e-02   +3.904665553934254e-02   -6.765519700825254e-02   -4.070781498892948e-01   -6.336135399348165e-01; -1.081948393307113e-02   +8.698439411511625e-01   -1.885470898431896e-01   -1.063409510705893e-01   +1.266589411763768e-01   +3.180593251367629e-01   -1.647878531762638e-01   +5.831928811774473e-01   +2.520002964212850e-01   -4.038671809127559e-01   -3.280218503138030e-01   +8.753841540586552e-02; -4.238000360430458e-01   -4.675787147082056e-01   -1.505734578297811e-01   +3.466100839557633e-02   +2.560713515285805e-01   +1.607478612829929e-01   -3.570735458591789e-01   -3.427302344756957e-01   +4.056297544543797e-01   -8.984732369430265e-02   -7.407971351848002e-01   -3.731499197415871e-01; -9.146643459667683e-02   -1.872606316695362e-02   +2.383972262447240e-02   +6.178940448992831e-01   -6.794977703702978e-02   -8.723183145938015e-02   -4.861903792976244e-02   +3.410800788058436e-02   -5.808337638628861e-01   +6.157284917038396e-01   -2.422082549413965e-01   +2.983663352515480e-01; -6.378252478945260e-01   +2.687051469341687e-01   -8.654359731973094e-01   -4.137868065121367e-01   -1.221323175051703e-01   -2.918520944629990e-01   +8.664796023069263e-02   -6.914342029551571e-01   -1.993812627843997e-02   +3.869310265725591e-01   +1.668998428337514e-01   +5.918208049073689e-01];
L2E_Input1_iAMPA_netcon = [-1.491032060799768e-01   -9.189507070045928e-02   -1.495200695084873e-01   +7.237489065569842e-01   -2.900663934709727e-02   +1.074254208331197e-01   -9.164733740248232e-02   +5.352624618001913e-01];
L2I_Input2_iAMPA_netcon = [+1.889317354861215e-01   -4.364248966109563e-02   +4.555505763503934e-01   -9.316900487297729e-02   +1.154365215972099e-01   +8.629150781205053e-01   +4.817407618654337e-01   -5.118158794434942e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
