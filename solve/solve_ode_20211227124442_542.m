function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.921956084375322e-01   +1.783049474853916e-02   +1.509468832382837e-01   -5.631182080773579e-02   +2.983502046886190e-02   -1.824613819400353e-02   +1.680777817676462e-01   -5.132304079023665e-02   -1.146407554658077e-01   -2.077099788462197e-03   +1.607670167100040e-01   +5.918300607916732e-03   -6.480165415372113e-02   -3.960741879978316e-01   +1.516041133717037e-01   -3.500502117785826e-01; -3.588008388949782e-02   -2.709846559732415e-03   +9.487685180032318e-03   +2.125614669576728e-01   -9.651709172828807e-02   -3.254844220082400e-01   +2.425558285241686e-02   -7.903311961344540e-02   -4.795733958501996e-01   -3.419356355959703e-01   -2.010616819395687e-01   -6.940702324405830e-02   -1.210495552093155e-01   -6.954387799813630e-02   -9.077917918058970e-02   +2.883950707309573e-01; -4.914708424921575e-02   -2.176031195640971e-01   +8.057686141473061e-02   +1.553609870375122e-01   -3.741522557273466e-01   +5.808692491926276e-02   +1.313530236338472e-01   -1.445261524287173e-01   -5.591055396316333e-01   +1.859538607672262e-02   +3.713754857065089e-01   -1.844314976803201e-01   +1.068415817228491e-01   -2.191639994227090e-02   +1.819215637905141e-01   -3.314460431813681e-01; +3.065944341804931e-01   -2.829281258399124e-01   -1.882605967415802e-01   -2.769652799067798e-02   +2.365462842600197e-03   -5.618190344880999e-01   +1.472906495195876e-01   -4.884320165851931e-02   -1.250102691681159e-01   +1.784209897675422e-01   +5.100345025615998e-01   +1.931327331777744e-01   +4.582232393807075e-01   +1.306879718801293e-01   +7.328003470498404e-02   +5.613256835387355e-02; +6.114016941020742e-02   -2.791040614505323e-01   -2.386209957034968e-02   -2.069888502907021e-01   +1.664410219333173e-01   +9.472531884033814e-02   -6.849573843856910e-02   -1.331383237517171e-01   +1.937701659230395e-01   +3.508589553016894e-01   +2.368014793386283e-01   -1.696670748832072e-01   -2.547901261936722e-02   +1.617986806172042e-01   +4.062444094085584e-02   -2.195094034250283e-01; -1.474995510733644e-01   +3.338195284639308e-01   -2.246102189740645e-01   -7.948209810945861e-02   -1.711553664145761e-01   +1.006409911376915e-01   -5.619979503518466e-01   -2.177842321177742e-01   +2.936170021365407e-01   -1.990912213429890e-01   -3.247315172905615e-01   -2.747503435290139e-01   +1.157353859347028e-01   +2.630803644201350e-01   -5.382297820363473e-01   +4.473384125170602e-01; -1.836407285624860e-01   +3.418465869908661e-01   -2.009455548098949e-01   -6.477682042507088e-02   -2.330267133730450e-01   -5.511661291438679e-01   -1.146296058326777e-01   +6.666663806477297e-02   -3.046824238045391e-01   +2.617268146888611e-01   +7.137302626283500e-02   -1.389229012645034e-01   -2.917510553349846e-02   -1.869449508005869e-01   +6.404281567358780e-02   +6.723508978961522e-02; -2.691360992166847e-01   +1.853644943307400e-02   +3.028053054840575e-01   +1.354503549439911e-01   +1.331205314574211e-01   -2.728804637906848e-01   +6.159779258202831e-01   -1.938296407630256e-02   +3.555796471307661e-01   -1.190584237509436e-02   +3.629014003616778e-01   -1.207209632703464e-01   -9.012993499406746e-02   +2.808626194410203e-01   -3.119740911454194e-02   +4.735415088701511e-03; -4.510902333618958e-01   -3.336397006542887e-01   +3.829668964808436e-01   +6.425860817083062e-02   -2.240929396175342e-01   +1.579658580421328e-01   +5.330850026224490e-02   -1.407752597686966e-01   -1.941735868442768e-01   -1.273940359042814e-01   +2.243104374397667e-02   +1.849235832034521e-01   +1.270948033939402e-01   +2.084286542188028e-01   -1.167311178909080e-01   +3.760411304860357e-02; -1.461666706479177e-01   +2.072829765779498e-01   +2.478617836341017e-01   +2.868829725559928e-01   +2.402850812504467e-01   +9.355996491427968e-02   -3.252891655056441e-01   -2.211005201813691e-01   +1.564043036590855e-01   +2.330700814165940e-01   +2.002111226561860e-01   +9.340182707248917e-02   +1.548045415739383e-01   +4.044658519058035e-01   -3.550078091938039e-01   -2.327006887551372e-01; +1.077687422830724e-01   -2.675251001397466e-01   -1.111463918793060e-01   +2.366224869240558e-01   -1.260915183118864e-01   +3.930997326577811e-01   -9.546689762012661e-02   -2.259366155954625e-01   +1.765658703866370e-01   -2.454126382347548e-01   +1.483924648806657e-01   +6.688291382267054e-02   -3.100865000430604e-01   -8.646944129076956e-02   -1.512595278358307e-01   +3.790247744826789e-01; -3.507412593493439e-01   -1.815538003543181e-01   -3.340928234513575e-01   -1.173421348483068e-02   -9.018647410377399e-02   +2.635170636166667e-01   +4.197520588928136e-01   +3.427511421151074e-01   -1.783024328863069e-01   +1.186668878373154e-02   +9.691674597269279e-02   -2.326590621936772e-01   +1.364644625047412e-01   +3.085064678542965e-02   +4.523759970675381e-02   +2.452617879387917e-01; -3.412709422002532e-01   -1.049788882188069e-02   -1.761478480899352e-01   -2.444427958528794e-01   +1.418412998759596e-01   -3.350800436621240e-01   +2.485362367170169e-01   -3.365027553038198e-01   -1.285466321678788e-01   -2.580545981079277e-01   +5.860740042114035e-02   -1.808639414272141e-01   -6.061441253090859e-02   +1.067854476152444e-01   -1.160286985474864e-01   -4.473991349325043e-02; -1.713707987607650e-01   -2.624620501420432e-02   +1.402177745267617e-01   -2.903340294639159e-01   -2.844570518885658e-02   +1.560389696123694e-01   +2.280597923760883e-02   -1.549804528022284e-01   -1.048984162202160e-01   -2.415599360538376e-02   +1.127998998343639e-01   +1.006221491124653e-01   -1.879770674729698e-01   +2.781925478084684e-01   +1.642526043487249e-01   -7.907625242964716e-02; +1.698409380246595e-01   -2.319224414747744e-01   +1.846855327238257e-02   -2.224263691431098e-01   +2.362377146385004e-01   -3.646722520623569e-02   +1.396245541841659e-01   +1.021673300842875e-01   -8.568574577044535e-02   -2.894560413960344e-01   +1.220485827535201e-01   +2.030261833915238e-01   +1.749390070258156e-01   -1.068110231563555e-01   -4.804149752952604e-01   -4.176726128928340e-01; -1.176196926144482e-01   -5.715609168940927e-03   -1.120480666125571e-01   -3.666261496252740e-01   +4.324447415806230e-02   -1.546675461081122e-01   -1.229915398873957e-01   -9.435623476376431e-02   +7.840939341145145e-02   -3.351943112998704e-01   -2.285147829088329e-01   +1.395196685576781e-01   -5.598662446426744e-02   -2.598122842932153e-01   +2.915262547960680e-01   +1.679187381921180e-01];
L1E_L1I_iGABA_netcon = [-1.104873674089614e-01   +2.704126945566839e-01   -1.334019599068648e-03   +2.460820763950280e-01   +1.420667077702323e-01   -3.788588075665957e-01   -3.672047890066721e-01   -6.073332320378894e-02   -1.362017554975414e-02   -3.064720119750637e-01   -1.497854061071622e-01   -1.726975158513827e-01   -3.598350218971198e-01   -5.715610387825189e-02   -8.200571849891675e-02   -2.407573240275486e-01; -1.150753073554655e-01   -1.028008711658603e-01   +2.957525147888884e-01   +1.401823458411202e-01   +9.652960360375079e-02   -1.064595470963414e-02   -2.149019298756243e-01   +7.615303253428801e-02   -2.613661791996817e-01   +2.552610679355293e-01   +2.100285064960408e-02   +4.103982342602701e-01   +4.293188781349402e-01   +7.740420236425770e-02   -3.333264593239847e-01   -5.021470334841056e-02; -2.853487984889902e-02   +2.407110265598555e-01   -3.462613279687349e-01   +2.059032952027199e-01   -3.821831855448902e-01   +4.151421179409226e-03   +8.223175956067612e-02   +2.231324511060814e-01   +3.258381365904063e-02   +3.150462087846597e-01   +2.165283085963738e-01   -4.064019469612317e-01   +5.085355443529635e-02   -1.137703269511416e-01   -2.757572103039689e-01   -4.310376676201025e-02; -2.375662686864684e-01   -1.824660261769391e-01   -2.447127631687347e-01   +2.016785342176922e-01   -1.311296352575247e-02   +1.303892804492151e-01   +5.278720249825185e-02   +2.035701798177165e-01   -7.547460665094308e-02   -1.619838861102853e-01   -2.120108692443887e-02   +1.956327890062463e-01   -1.987638506696325e-01   -2.506940830414186e-01   -1.546926182734762e-01   -3.502964651376478e-01; -2.668967050512198e-01   +8.941723400264567e-02   -4.317714419251570e-02   -2.219036506631940e-01   -1.401853815358776e-01   -1.089963665143412e-01   +3.148284358785467e-01   +3.288826157938483e-01   +1.663470236050070e-01   +5.902848056140959e-01   -2.636558974972953e-01   -3.798615134900582e-01   +3.665983133751639e-01   +2.430959834156927e-01   +3.432264590858292e-01   +3.443699712368365e-01; -8.200398716399507e-02   -5.602978145858496e-02   +1.464710140293043e-01   +6.053779263113949e-02   -2.014953230064309e-01   +7.931851126160604e-02   -1.411699548896947e-01   +1.673592696550052e-01   +7.237708953078614e-02   -2.935804587150002e-01   -2.636124712102478e-01   -2.993900924779130e-02   -3.266451967278121e-01   -4.719411920641359e-01   -7.330557065122037e-02   +3.463558620424837e-01; -2.235222790675400e-01   +2.815717744831187e-01   -1.655210048781886e-01   +4.734786371548455e-01   -2.301463017086863e-01   +1.930009605300197e-02   -2.741779743076424e-01   +2.938875933255954e-01   -5.130632828806277e-03   +3.049623116032083e-01   +1.886122089834525e-01   +2.049551277153250e-01   -2.906041263877303e-01   +2.920502413263927e-01   -1.398294679352483e-01   +2.313214763643130e-01; +4.410777427622575e-01   +2.086148698281178e-01   -8.507210804015665e-02   +2.541983061747892e-01   +4.181246837180653e-02   -3.789772284116137e-01   +1.207869636523376e-01   +8.861317583011999e-02   -2.980458204735084e-02   -8.699820723191254e-02   +2.816002121962136e-02   +6.554370592962286e-02   -1.974731808627500e-01   +1.761412953598600e-01   +1.701926123694740e-02   -8.687523566318481e-02; +2.049387240606874e-01   -1.299643451634298e-01   -2.844060846716538e-01   -1.238932659100650e-02   +1.152247920007242e-01   +2.930057042057112e-01   +3.548432415063719e-01   +1.609581526083013e-01   -1.864640846062396e-01   -1.181712768715643e-01   -2.838108402236000e-03   +3.636367232122235e-01   -2.514721877119557e-01   -1.011076304762643e-01   -1.216818907980510e-02   +2.370390061264483e-01; +1.696612915482960e-02   -1.940148640094957e-01   -1.166477347481707e-01   +3.485773618431373e-01   +8.069075421525091e-03   +8.726474197566268e-02   +2.367186762268946e-01   +1.596585537136224e-01   -8.541098287779811e-02   -5.461767522453363e-03   -2.508675795524112e-01   -2.061735883955866e-01   -1.152549461110996e-01   +2.754715629096910e-01   -2.017091911653731e-01   +2.079892557491697e-01; -1.957397362867542e-01   -2.217994524976099e-01   +7.703282931582242e-02   -3.077486174407585e-01   -4.705972928687197e-01   -3.353588799232606e-01   -7.044347959473779e-02   -6.753906580048490e-02   +2.638481453986424e-01   -1.801385229125518e-02   +5.860876974523863e-02   -1.598703717254033e-02   -9.630492538580351e-03   -2.071587105836127e-01   -2.208956064615073e-02   +2.637029924259692e-01; +3.098918394335787e-01   -1.925948264920584e-01   +5.629807659989313e-02   +8.740346529405954e-02   -4.777970901849127e-02   +1.351217616336866e-01   -1.689725261794716e-01   -3.950370496435157e-01   +1.874402796793672e-01   -4.768730128054245e-02   -2.675170102254317e-01   -1.871976210611149e-01   +1.134904017274060e-02   +1.736410496392323e-01   +3.806577974672445e-02   -6.109158510918984e-02; -1.323612974877723e-01   +1.806206489683408e-01   -1.868347930727017e-02   +5.645872909946348e-02   +1.137615416332450e-01   +3.804500630715602e-01   -5.327798803239959e-03   -2.118405849043557e-02   -4.241054294138203e-01   -4.198308107371926e-01   +1.587210606241629e-01   -1.700071075083254e-01   +2.604485744745890e-01   -8.422638871452763e-02   -4.889813432024381e-04   +3.356615728186906e-01; +2.619697793586986e-01   -4.915846591197601e-02   +2.829467021003165e-02   -3.231803392360115e-03   -3.576431326874997e-01   -3.013127276774106e-01   +7.845391709472012e-02   +3.186462768066038e-02   +3.747510966336421e-01   +1.952402220701416e-02   +1.125295040193880e-01   -2.491753795949203e-02   -2.876306130630906e-01   +2.856244687568341e-02   +2.986627678840226e-02   -9.532046998486893e-02; +2.889026269988567e-01   -3.486604693043171e-02   +3.607227627696630e-01   -1.391667571282839e-02   +5.414132429522667e-02   -1.456984092232745e-01   +1.415801680986480e-01   -2.913905091541699e-01   +1.432445661416940e-01   -6.417647083117288e-02   -2.770366265311803e-01   +1.352996156497536e-01   +3.759227448631508e-01   -4.394578959978293e-01   -1.007106258599841e-01   +2.210091262259169e-01; +1.439890527124611e-01   +2.553117144956130e-01   +1.655884186446789e-01   -1.490844238918111e-01   -2.231958323759665e-01   -2.894523396793868e-01   +3.495425882861417e-02   -1.863169756100852e-01   -1.059782583589010e-01   -2.810751616075595e-01   +2.982421832472881e-03   -1.011414402561498e-01   +3.888886711583776e-01   -1.965917302159439e-02   -1.695490602527188e-01   -1.120496743720674e-02];
L2I_L1I_iGABA_netcon = [-2.039509514273988e-01   -1.003335282465622e-01   -3.490480414503707e-01   -1.775071523790039e-02   -3.532859156633998e-01   -4.360710238351015e-01   +3.253231871274303e-01   -2.179787460105269e-01; +6.574388524506776e-02   -1.450540804424301e-01   -1.890020720006913e-01   -4.239726654760385e-01   -1.472383909174723e-01   +1.534332006926345e-02   -1.940303559605734e-01   -2.345284119371521e-02; +6.391407715052291e-02   -2.004006469010475e-01   -2.288027543509538e-01   -2.165443177341673e-01   +2.198152923931977e-01   +5.810183650385128e-02   -2.988775672119446e-01   -1.167832118521631e-03; -4.079386856269511e-02   +9.432489636501820e-02   -3.581082647162940e-01   +1.408284197305820e-03   +2.990552224313168e-01   -1.060087825198566e-01   +2.859152247792943e-01   +6.275682677205438e-02; -1.907215758460488e-01   +1.606463089722717e-01   -2.926206615705204e-01   +1.254084121776215e-01   -2.813483475778394e-01   +2.426365003492757e-01   -2.225438512554872e-01   +3.559932966553851e-01; +1.054493023874483e-01   -1.214545573401938e-01   +2.801932562043004e-01   +4.311025290407136e-02   +2.094211023996263e-01   +2.948803744327192e-01   -9.280199567966131e-02   -2.246429294354299e-01; +2.391781516318170e-02   +3.431789435079124e-01   -1.615305251787127e-01   -1.501975752224472e-01   +1.990362975347990e-01   +8.980104399505758e-02   +2.933080711359748e-01   -2.590338197885817e-01; +1.758186788942773e-01   -2.615442102607921e-01   +2.088162362481699e-01   -2.688608202575413e-01   +8.613892455672228e-02   -3.351000883139650e-01   -3.396384404712958e-01   +7.679156593964066e-02; -2.505427349689158e-01   -5.208275610303835e-01   +2.253832320761772e-01   -2.008516567996779e-01   +6.776160577957088e-02   +2.037561903555175e-01   +3.047311992528843e-01   +1.504645142943155e-01; +7.935690047039282e-02   +1.752555067920240e-01   -2.559651272531570e-02   -5.183769000362978e-01   +1.993454372420485e-01   +3.723856185507647e-01   +9.966169222058069e-02   -2.760987730589366e-02; -2.052718406835490e-01   -1.182288845122187e-02   -1.743751968326454e-01   +5.098009425734540e-01   -2.618103218750004e-01   -1.680750435233507e-01   +2.335263069895988e-02   +2.191554237817525e-01; +3.912146449398389e-01   +1.488055141349912e-01   -1.861701140661152e-01   -2.965829595548756e-01   +1.348718506460346e-01   +4.057308454518313e-02   -1.298777569711655e-01   -3.946014687195405e-02; -2.624113382251107e-01   +2.873084639055013e-01   -1.140761142272671e-01   +1.294573677294553e-01   +1.066827725724085e-01   +2.505347420661441e-01   -2.981144445904343e-01   +8.577697183742998e-02; +1.432259974884902e-01   +1.300383189402709e-01   +1.414609804262950e-01   -2.048163938173418e-01   +6.291371484040373e-02   +4.747396679422918e-01   -2.083160126080498e-01   +4.029791643128709e-01; -4.559651512778135e-02   -1.748042575297791e-01   +2.515378678527609e-01   +2.447109623739188e-02   +1.023607255313552e-01   +2.559820318146637e-01   -2.339159065236153e-01   -5.157859313057384e-02; +1.970491141550144e-01   +1.642510670784883e-01   +2.580286321871043e-01   -1.273466888209289e-01   +1.872334765130804e-01   -3.373699096622339e-01   -2.267264029745263e-01   +9.851815768269861e-02];
L1I_L2I_iGABA_netcon = [-2.180791865965508e-02   -3.127239108540472e-01   +6.319888227369570e-03   -1.789344258570920e-01   -6.460571825875672e-02   -1.109558574189760e-01   +8.847334226525613e-02   +3.363953837421778e-01   +2.292787198832138e-01   +6.238373578812073e-03   +1.699113240612999e-01   +3.533059551936066e-01   -3.003191092634898e-01   +1.781403374675002e-01   -1.150250791592679e-01   -2.101959170783241e-01; +4.334178512391487e-02   -2.959602745542612e-01   -3.452060920420527e-01   +5.605119540586476e-02   -2.679579965695561e-02   -9.593147558970896e-02   +1.422254872086076e-01   +3.538099762745852e-01   -2.271273920236928e-01   -1.132684247992444e-01   -2.322033156158855e-01   +3.345480741893890e-02   +3.715279448734414e-02   -4.068148507177556e-01   -1.741717591327120e-02   +1.978533012859698e-01; +1.963966281534153e-01   -4.569694870906710e-01   +1.996737165321265e-01   +6.482374676252924e-02   +2.956069810975913e-01   +4.752757970794605e-01   +1.857627497848228e-01   -7.242352305203449e-02   +7.807077295479592e-02   +1.847102588600948e-01   -1.756412663159643e-01   -1.629167499610313e-01   +1.555022578342830e-01   +2.128383891121332e-01   -3.086404579462484e-02   -1.936499700310177e-01; -2.005118477386542e-01   -8.843356393496897e-02   +2.541065727756164e-01   -1.070303916069518e-01   +5.657015152780841e-02   -3.997511903560552e-01   -3.125783197416043e-01   +5.548256148292019e-03   +2.766823546665492e-01   -6.820777815943277e-02   +2.169471926842789e-01   +3.226769540978313e-01   -2.657075621779558e-01   -7.753201074655269e-03   +3.682298382582693e-01   -4.791064846201343e-01; +2.682493391502657e-01   -3.107871854037164e-01   +4.662841568440651e-01   -2.431011857073156e-01   +1.282152748550312e-01   -2.588945490925529e-01   +9.694464241898088e-02   +2.878335524725554e-01   -8.247325705008915e-02   +8.558694118630571e-02   -1.274608018335573e-01   +1.581898324100023e-01   +3.141439305771319e-01   -3.144291245998979e-02   -1.153886219137512e-01   -2.220816758648491e-01; -3.163389020161361e-01   +1.868610354407207e-01   +1.497445581204292e-01   +2.098515634823639e-01   +4.388435694760798e-02   -1.434575586373739e-01   +3.516953771880998e-02   +3.497927903781176e-01   +5.101098409975080e-02   +1.330794286465690e-02   -1.069609765965681e-01   -5.103864871181200e-02   +1.273542288940055e-01   -6.492585355301113e-02   -3.066188714703595e-01   -1.836142954644721e-01; +9.099740724235858e-02   +1.796401916771970e-01   +2.159265683867271e-01   +5.307287147109516e-01   +1.237780337287357e-01   +2.510765375650483e-01   +2.546051459574892e-01   +2.413117483688812e-01   +1.520981775622682e-01   -4.277846510831919e-01   -9.967738440679436e-02   +7.419889127737861e-03   +2.657688030752962e-01   +2.214506812280737e-02   +1.825576787559486e-01   +2.349836799007880e-01; +1.299486426592642e-01   -3.975190955305612e-01   +3.689752906925803e-03   +2.940811005666634e-01   -1.317823835447103e-01   +3.382545456251189e-01   +3.133620332125527e-01   -1.052903475466556e-01   -3.130476277638088e-01   +1.629842328613329e-01   +2.243110830840326e-01   -5.014607811724747e-03   +2.121989075790779e-01   -1.386576815978419e-01   +2.627858334210773e-01   +1.778646500042607e-01];
L2E_L1E_iAMPA_netcon = [+1.118494819831630e-01   -3.308912637822465e-01   +1.960042835677662e-01   +4.505817828318768e-01   +1.006543976207997e-01   -2.374961824743262e-01   +2.771144366360423e-02   -5.872818138749359e-02; +7.704218424634848e-02   -4.247469919767734e-02   -3.200988573183183e-02   +1.406194461909741e-01   +1.682445429387577e-01   -1.756775774694916e-01   +3.151390638674010e-01   +6.240266555124793e-02; +2.262422168013359e-01   +3.970891117697734e-02   -1.068210480581819e-01   +1.489952567948492e-01   -2.248670430454406e-03   +3.550067157540857e-02   +3.844300041083454e-01   +3.064047225966990e-02; -2.169281837251610e-03   +2.264930120052921e-01   -1.904520673732764e-01   -1.881917832327750e-01   -6.186387575050925e-02   -1.989947723714774e-01   -1.489015066413474e-01   -1.014387176318299e-01; -3.396622807257930e-02   +3.198988274654644e-01   -2.264518400947150e-01   +1.818930486385158e-01   +2.795984348161360e-01   -1.657019270659891e-01   +1.211240520679053e-01   +1.473859720664306e-01; -1.785427750689443e-01   -3.489361962511258e-01   +8.763944062971585e-02   -5.027356353639528e-01   -1.645600049627884e-01   +2.639411491691565e-01   -1.478628814375157e-01   +8.121634564575636e-02; +2.827057696328021e-01   -2.347713327223013e-01   -3.101519509944080e-01   -1.719090569122695e-01   -5.959000844482069e-02   +2.303669713525393e-01   -4.804894563791819e-01   +9.814729107598641e-02; -2.108806740132146e-02   +9.007791131460213e-02   -1.630169132210338e-01   -2.160865635730745e-01   -9.689469862919201e-02   -4.489764822913831e-01   +2.008988452050442e-01   +6.344143202893321e-02; -3.214076548999842e-01   -3.712963674502936e-01   -3.462190312102653e-04   -4.593861218842589e-01   +2.977810406833215e-01   +4.014614574476975e-01   -6.586557410028426e-02   -8.473570547368781e-02; +6.467582017321766e-02   -3.182493100184597e-01   -7.863038299973757e-03   +2.108713572276223e-02   +3.478787764250656e-01   +3.087864921754933e-01   +1.794966404653716e-01   -4.445534553004213e-02; +3.602638226522524e-01   +2.990869348451421e-01   -2.413127939561895e-01   +2.858761734623678e-01   +2.172436148307560e-01   +9.270304769358573e-02   +2.299860752083576e-01   +1.143051879761396e-01; +1.177452525753696e-01   -1.999276287590491e-01   +2.517093462971973e-01   -3.231651131619863e-01   -2.136923649947834e-01   +1.123942462489644e-01   -2.314390790093696e-01   -3.630216318112341e-01; +2.987541819216786e-01   +3.916706048895465e-02   -9.775917672911699e-02   -3.583979270300532e-02   -1.258319289394310e-01   +2.623894954452921e-01   -6.633832586235293e-02   +2.023633704091002e-02; -1.512531254369714e-01   -2.807576775932680e-01   +4.010873023151818e-02   -1.981606258676791e-01   +1.739190738789924e-01   -1.325568188489550e-01   +6.959274714657376e-02   -3.362266647422407e-02; +2.042757112241166e-01   -2.753972034986812e-03   -7.543352632374078e-02   -2.576393528265686e-02   +8.310151161253677e-02   +7.412527011284104e-02   -2.185626416414072e-01   +1.326892931911167e-01; -3.169181374471730e-02   +1.035277476026885e-01   -6.419811967956313e-02   +1.606200657472581e-01   +7.076962559279808e-02   +3.228416144438708e-01   +1.835285599565945e-01   -6.029424973220038e-02];
L1E_L2E_iAMPA_netcon = [+9.589145862867923e-02   +7.713426073703877e-02   +6.215403894716573e-02   -1.793961669637180e-01   +2.981894100810000e-01   +4.821120622150185e-02   -4.469260204609428e-01   +2.923477582103734e-03   +2.698951545799935e-01   -6.182491340134589e-02   +4.656329827571970e-03   -1.236656034844629e-01   -2.325126374656976e-01   +8.976379310671923e-02   +1.957774193542442e-01   -2.121830679880129e-01; -2.230200621015030e-01   +1.602380878773282e-01   -2.789234658741921e-01   -3.530545766738018e-01   +1.633016523357845e-01   -1.496901871512745e-01   +1.566826683370959e-01   -1.690351729663279e-01   +4.707327908555016e-02   -4.009127557451617e-01   -1.551957299998614e-01   -2.972247448671064e-01   +1.904731723354540e-01   +3.473348024473631e-01   -1.681608686440051e-01   -2.740854134236962e-01; -3.081053669324604e-02   -2.538911227788087e-01   -8.184844217379419e-02   +3.148713436876195e-01   +3.631727437986357e-02   +2.176171866246554e-01   -4.866276435721073e-03   -1.400239195331757e-01   +8.908810984529754e-02   -1.527941235747691e-01   +3.082751539145341e-01   -2.192665835176883e-01   -3.311262729925173e-01   +2.213957212451233e-01   -1.043657513744219e-01   +1.570976705422645e-01; +4.122685347748721e-02   +1.214374152272432e-01   -1.875408241432823e-01   -8.000437230510278e-02   +1.550500184819233e-01   -1.254926727304708e-01   +2.698061184957599e-01   -4.463555107935709e-01   -9.155538268073526e-03   -1.874691556577721e-01   -2.694727485570281e-02   +1.384456248003013e-01   +1.038370821136735e-01   -6.104832272947301e-02   +8.953578923271158e-03   +5.800513143350593e-02; +3.966962124332860e-01   +6.604604032501775e-02   +1.505814913611306e-02   +7.873629997547052e-02   -1.033546690715692e-01   +2.449859717416494e-01   +1.239273062080024e-01   +1.040704003818224e-01   +7.506746224263133e-02   -4.316034242768584e-01   +2.533553786694562e-01   +1.361838109166649e-02   -1.642504625099735e-01   +3.904116239419021e-01   +2.695867658801427e-01   +1.839732075227166e-01; +4.267478147500660e-01   +1.263075791410906e-02   +2.152626869186311e-01   +1.710160145732780e-01   -1.460293786542213e-01   -9.377972025375023e-02   +2.619691834158430e-01   +1.570887920180299e-02   -4.050166554106974e-01   -2.640080770105249e-01   -2.839543164229754e-01   +2.593945077982369e-01   -3.922384853071748e-01   -6.419089697018593e-02   -9.819386641183875e-02   +3.938110782059662e-01; -3.918571630415295e-01   +6.532936948498960e-02   +1.930416027919230e-01   -1.593147831040230e-02   -3.040424125663913e-02   +2.624332413816045e-01   +2.044492820261808e-01   -8.336254007445143e-02   -3.274193090261973e-02   -3.228481200770139e-01   +2.138843432737954e-01   +2.197762578191872e-01   -8.639697275967725e-02   +3.377097471195625e-01   -2.057530174125843e-01   -1.171134088269158e-01; +5.655003699991386e-02   -2.279380202563849e-01   +3.771942525915428e-01   -2.160466427443188e-01   +1.427900506077172e-01   -2.453097126983398e-01   +3.526669552371360e-02   +2.394284530369413e-02   +4.372589767702692e-02   -1.313859178543395e-01   +1.156768096986635e-01   +1.434344305550584e-01   +1.420082808056784e-01   -2.510601182430566e-01   +1.356194377424809e-01   +2.757973699526831e-01];
L2I_L2E_iAMPA_netcon = [+3.387941833392608e-01   -1.336364768289564e-02   +1.858274284543050e-01   -1.162690252511766e-01   +9.158619622779189e-02   -1.665217990243605e-01   +1.229183262518194e-01   +2.023840286432311e-01; -6.218145739803384e-02   +1.033203023571362e-01   -4.733361177415853e-01   +2.390621784969488e-01   -1.079083869937551e-01   -7.186140894536334e-02   -2.158672938103129e-01   +3.978864122788969e-02; -3.684428341857546e-01   +1.468066068366942e-01   +4.718514969983682e-02   +2.374927007615775e-01   -3.099037099241345e-01   +1.762076669871366e-01   +2.389336238255608e-01   -3.005066358191885e-01; +1.152679915195277e-01   -5.931462292030723e-02   +2.668577334394631e-02   -1.527427094183710e-01   +1.161247229013231e-02   +2.910008914994848e-01   +6.623373356507779e-02   -1.826386241007751e-01; +7.559936480445145e-02   +1.520472514608320e-01   -2.793922081628239e-01   +1.009596586786850e-01   +3.377767844967251e-02   +3.342578618808960e-01   +3.706049378340148e-01   +1.532388423105950e-01; -9.816690642374604e-02   +2.507670895635501e-01   +1.274094588591976e-01   +2.599991298150275e-01   +2.935171501401899e-01   -3.868948648647095e-01   -2.594171319896972e-01   +1.317915282407195e-01; -1.156224846197645e-02   -6.164542504201787e-02   +2.784437075633683e-02   +6.997857635175356e-02   +2.783550536900713e-01   +1.223335043384104e-02   -3.652043530791755e-02   +6.583755408063025e-02; -1.178196401675028e-01   +1.032083760483136e-01   +1.681747830084665e-01   -2.227229734954319e-01   +1.957163940008443e-01   +7.994183342219215e-02   -1.915927348571328e-02   +1.678131831567055e-01];
L2E_L2I_iGABA_netcon = [-1.577779681547940e-01   -3.567273538093291e-02   +2.628297147435391e-01   +8.870794139961460e-02   -1.608981188912532e-01   -6.291499746836944e-02   +1.820249235284261e-01   -2.272180091216010e-01; -1.100747477472261e-02   -3.138402607573145e-01   -2.102333333263855e-02   -1.383098006448029e-01   +1.612008431858127e-01   -1.465284545662234e-01   +3.753741742254150e-01   +5.498162069222223e-01; -3.367185782208243e-01   +1.827267501755472e-01   +3.202633723830897e-01   -7.876174662380686e-02   -2.504968770590296e-03   +7.151273900073357e-02   +6.074085981453448e-03   -2.442684477254080e-01; +3.020215715321209e-01   -6.285375888094144e-02   +4.501788727475080e-01   -3.060744895866371e-01   +3.449939762295644e-01   -2.059128163676185e-01   +3.496420796915849e-01   -1.619350719876226e-01; +9.602805635969477e-03   -1.648628633655321e-01   -2.260734127408688e-01   +2.450763046950482e-01   +4.013005237060139e-01   -2.340094196499876e-02   +4.422246583906237e-01   +1.903891404730265e-01; -1.049352243032921e-01   -2.480294057689195e-01   -6.819641737822746e-02   +1.317420927609163e-01   -2.782099563047791e-01   -1.246483915226288e-01   -2.349714936425957e-01   +2.875042432025022e-01; +1.541876895246773e-01   -1.853306068959063e-01   +1.030584390534644e-01   +2.120295943801513e-01   -1.312100420843416e-01   +3.471753608554329e-02   +1.693296406043845e-01   +1.026858430763603e-01; -3.600706471273772e-01   +3.736839670009878e-01   +2.503381882010247e-01   -6.534910189168389e-02   +1.750977975535034e-01   -3.995646594181115e-01   -4.767400199472328e-01   +1.020454350159247e-01];
L3E_L2E_iAMPA_netcon = [-3.103477499873206e-01   -1.158800900541966e-01   +2.395514420546020e-01   -2.969551712433378e-01   -7.521903326415325e-02   +3.662428927187398e-01   +9.950562397199714e-02   -1.299966164259412e-01   -4.313466030646753e-01   -1.290405989389570e-01   +8.706336807074308e-02   -2.756276276978868e-02; -3.542308751996444e-01   -9.833317564041721e-02   -1.003577370119440e-01   -3.608839675570708e-01   -6.760626125730490e-02   +3.232916027792722e-01   +2.212444628980519e-01   +3.348148173194646e-02   -5.662323748453232e-02   -2.778057320558910e-01   +2.907786785767154e-01   -6.723136918017007e-03; -2.006232146263953e-02   +2.826748155000949e-01   -6.714056303960321e-02   -1.689013452618948e-01   +1.698456145225474e-01   -2.325597932076293e-01   +7.609072879933966e-02   -2.259329761731789e-01   -2.451699916735554e-01   -2.435445403489361e-01   -3.960189361765002e-01   -4.310857854511695e-01; +2.111709316858885e-01   +4.070396574771194e-02   +4.226768187656530e-01   +2.191654523690650e-01   +1.363278341975256e-01   +5.146445068221492e-01   +8.049376337034415e-02   +1.659731756952288e-01   -1.537678043098628e-01   +1.065429173323785e-01   +1.068116268018621e-01   -2.049206777753524e-01; -1.826277305634825e-01   +3.451641506178075e-01   +4.204108463820580e-02   -8.859133251068960e-02   +2.859608121656072e-01   -1.268022950955484e-01   -5.032522736564434e-01   -3.565705897407468e-01   +2.559371855759655e-01   -1.353641990417196e-01   +1.668836246543335e-01   +5.841051560952418e-02; -2.373586881538178e-01   +2.589853242664713e-01   +1.065448757527303e-01   +2.622699665650137e-01   +1.579604583149546e-01   -9.707178689507719e-02   +2.827645980592048e-01   -3.977202220776133e-01   -3.001053160667255e-01   +9.024396097754081e-02   -1.222755138208495e-01   -4.519364658724420e-03; -4.275643402306444e-02   -2.233184911003953e-01   +2.873615912672672e-01   -5.491297359795935e-02   +2.386745103318009e-01   -8.167540889654280e-02   -3.370928930418347e-01   -3.828131783343008e-01   +1.254991918931001e-01   -1.447203889319465e-02   +8.673254112946642e-02   +1.517474398809341e-01; -3.707546452623984e-01   -3.260226322821695e-01   -1.686059528065143e-01   -1.069569109725502e-01   -1.699010344300458e-01   -8.977523789252854e-02   -5.884287455401285e-02   +4.067603766300099e-02   -1.928880136681116e-02   -2.923469600494267e-01   +4.141532542841281e-01   -4.673681924072238e-01];
L3I_L2I_iGABA_netcon = [+3.634795016985156e-01   -5.648584097092452e-02   -3.917416071401680e-02   -4.065691936151572e-02   -1.115038505127407e-01   -1.934272720247101e-01   +1.717254244409035e-01   +4.299623454769745e-02   -4.835180129091288e-02   +3.421027907448323e-01   +4.503571151269204e-01   +4.922464562557632e-01; +2.481883080732195e-01   -1.000907782355983e-01   -2.013727166432495e-01   +1.741882098094149e-01   -8.915059986480561e-02   -8.812427018728941e-02   -9.251609755725937e-02   +1.282291983948759e-01   -1.892668891241488e-01   +1.257576131294104e-01   -2.005004885188298e-03   +8.876346818335488e-02; +1.257060959395765e-01   -1.945459545569569e-01   +6.164182169038596e-02   +6.470210032316605e-02   -9.834165285261426e-02   -5.285970920837561e-02   -3.360380046819587e-02   -1.271390740322548e-01   -2.767691402479983e-01   -1.467207685309976e-01   -2.136220647430704e-01   +3.541700677958877e-01; -1.083585539629350e-01   +1.497337124830646e-01   -1.610151766024470e-03   -3.554224107196235e-02   -1.145912267920945e-01   -1.748513075633699e-02   +3.964135375282668e-01   +1.974087271163794e-01   +3.242141314693989e-02   -2.344922277661365e-02   -1.370121680795073e-01   +2.097973229268190e-01; +3.713115431034769e-01   +7.965683001544224e-02   +2.127355872049854e-02   +2.839939405703282e-01   -3.966192996669465e-02   +2.449621697716662e-01   -9.845040066388025e-02   +2.709619288873851e-01   -1.688024266679433e-02   +2.675519786813570e-01   +2.851182417302166e-01   +1.466324209734902e-01; +8.531632472185730e-02   +2.188351342917196e-01   -3.427184943321444e-01   +1.103997894165913e-01   -3.745960450696679e-01   -7.450436726783177e-02   -3.422212971049085e-02   -3.007625716885824e-01   -2.552637263242904e-01   +4.637378585899141e-03   -8.462473307239816e-02   +1.153771800466330e-01; +1.761489805232377e-02   +1.119994028950120e-01   +7.554494704009113e-02   -3.439214064382545e-02   +1.831448270936069e-01   +3.973869862450258e-01   -3.138017729893314e-01   -2.316880217544983e-01   +1.972172021028874e-01   -4.028479696664806e-02   +5.177331547888250e-02   -6.294352118025835e-02; -1.159609484628486e-01   +7.230379759022505e-02   +6.155939339809814e-02   +2.185859461687717e-01   +1.578255820107550e-01   +4.735105921975760e-01   -1.071132344837971e-01   +3.377571990146663e-01   +2.539751310625886e-01   -1.904526520699221e-01   +3.717853410656836e-01   -8.713032613330246e-02];
L2E_L3E_iAMPA_netcon = [-6.527397105833399e-02   +2.275099094678486e-01   -1.396111557892558e-01   +3.991683503693463e-01   -2.401756256249644e-01   -6.312483287442053e-02   -1.303513227584844e-01   -2.747231685412000e-01; +7.464293806024452e-04   -1.349199634472242e-01   -3.878454463646869e-01   -2.844616827866411e-01   -2.274727040994110e-01   -1.062563699608694e-01   -4.252241834953998e-01   +6.277922879251865e-02; -1.697506481438175e-01   +3.607944036673347e-01   -3.713836839183608e-01   -4.998818320389634e-02   +2.434288458526812e-01   -7.251425399007398e-02   -1.891267107599270e-02   -1.998556565462509e-02; +1.901346274778173e-01   +2.515359991765807e-01   +1.092535526681576e-01   -1.931086976035444e-01   -1.996416445488338e-01   +6.084943893243903e-02   -9.065645435865953e-02   +1.474696870234704e-01; -1.331996910415093e-01   +4.349216317192657e-02   -6.103572863027405e-02   +2.639053872426577e-01   -2.566887225591878e-02   +4.085014244837570e-01   -1.886423431323370e-01   +9.662464638074582e-03; +1.475532705163623e-01   +3.299041107688854e-02   +2.627170810590310e-01   +1.255425190725480e-01   -1.114902831842856e-01   -1.351368268525284e-02   -1.952052295730643e-01   -6.607494524340354e-02; +6.588569818654973e-02   -1.778683069662992e-02   +2.906971280244726e-01   +2.720594505175301e-01   -1.606955532303215e-01   +2.914409461924927e-01   -3.887961674714356e-01   -2.253693884936317e-01; -1.939247893269621e-01   -7.394113128893279e-02   -2.436741668829899e-02   +9.017727900026171e-02   -1.410447981471357e-01   -2.310486622536330e-01   -5.366629001142784e-02   -1.718139314137198e-01; -9.033046569831793e-02   -2.343478894787887e-01   -8.416684528849402e-02   +3.954112274460303e-01   +3.449408550008336e-01   +3.554351448572526e-01   +7.307254723572633e-02   -5.672610288645145e-02; -1.305082379347245e-01   -1.578231160858254e-02   +2.059106946875099e-01   -3.377995710397130e-01   -4.941327460280601e-02   -1.688412252038749e-01   +1.351631968942485e-01   +3.806822256000028e-02; +3.817393957780305e-02   -2.077351959345543e-01   -1.166360559188545e-01   -8.820765876270015e-02   -2.464536891597423e-01   +1.364960843934015e-01   -9.101549193332310e-02   -1.684081644088704e-01; -3.532744883267450e-02   +9.217994135445121e-03   -3.363776446175962e-02   +1.749926497896978e-01   -1.271986808863976e-01   +1.504897478777424e-02   +1.814691939574821e-01   -1.659578617584955e-01];
L2I_L3I_iGABA_netcon = [-1.787646398805729e-01   +1.749288215815575e-02   +2.790525346962790e-02   +8.399781260688020e-02   -4.375200820878992e-02   +5.743243927481088e-02   -2.486367150703949e-01   -7.532067350363092e-02; +3.014764392001108e-01   +2.795545674151438e-01   -2.615948114629804e-01   -7.714979120703475e-02   -2.018409130595047e-01   +1.500617292273528e-01   +1.879051923504143e-01   +3.334630181762793e-02; +1.140913518024349e-01   -1.305564547283969e-01   +1.188459603809296e-01   +1.294016243029487e-01   +1.293486336704150e-01   +4.912903356871226e-02   -1.948294449351836e-01   -1.419178481592867e-02; -1.118079073015372e-01   +1.777937578460563e-01   +1.860471730746280e-01   +6.800493205345286e-02   -4.597736843719599e-01   -3.402237698420941e-01   +4.377773233879180e-01   -2.420388206404815e-01; -3.616502818391860e-01   -3.689399136867292e-01   -3.197674923185693e-01   -2.091132192709035e-01   -7.589076838835121e-02   +9.733631856318704e-02   -1.121943082709315e-01   -1.987893556861863e-01; -9.578708887229503e-02   -1.845518688174164e-02   -1.432760085692514e-01   +3.445083230502670e-01   +5.872626374452647e-02   +1.207027668396265e-01   -8.261076042479015e-02   +6.244407337441797e-02; +2.344539660892324e-01   +1.132209636932320e-01   +1.881633300940769e-01   +2.383245664547947e-01   +5.579116772602318e-01   -6.342585541979520e-02   -1.109391748062933e-01   -1.181726418761061e-01; +1.329622983096943e-01   +3.318229296479475e-01   +2.061745552511034e-02   +4.242572771093330e-01   -2.278263030652220e-01   -7.070234246915076e-02   -3.294930651499478e-01   +1.064751353969270e-01; +1.042756850356252e-01   -8.107166759131178e-02   +6.366063110784420e-02   +2.980016636786338e-01   +3.852077944440221e-01   +1.102865381590079e-01   +1.344475335290637e-01   -3.000176293425048e-02; -7.907839193753950e-02   -7.025835354791218e-02   +5.591789389692898e-02   -5.789207676815915e-02   -1.968190424052866e-01   -2.219481042979239e-01   -1.307015434016481e-01   +3.237790432059365e-01; -1.065578408687272e-01   +6.707934563882842e-02   -2.631688003422432e-01   +1.058460820280333e-02   -2.738903525587630e-01   +1.464268128941798e-01   -4.724096949019786e-01   -4.765797824086419e-02; -1.560606211339298e-01   -6.405889845096135e-02   +1.957352321188407e-01   -3.338351519565020e-01   +4.865857139647917e-02   -1.852045857910124e-01   +1.410691393908690e-01   +7.954878333673365e-02];
L3I_L3E_iAMPA_netcon = [+2.300736258620490e-01   +2.533794456907307e-02   +3.416172961232395e-01   +3.468099857532005e-01   +2.359726764956773e-01   +1.362487052096285e-01   -1.355350454595031e-01   -2.941440470325690e-01   -1.399107468631750e-01   +5.094614793155157e-02   -4.993777617773357e-01   -1.231093645145958e-01; -2.355223281373910e-01   +1.798054124628398e-01   +3.758512896292213e-01   -1.050880748538999e-01   +8.067462594301622e-02   -4.454056596693887e-01   +5.287074398735733e-01   +1.838258549045851e-01   +4.594861456358593e-01   -1.486213567507427e-01   -1.520418829800970e-01   -2.520059164780239e-02; +2.956978611073584e-01   -3.591063078537868e-01   +1.255802532511925e-02   +1.281630804859029e-01   +3.530255922586140e-01   -3.485010566952677e-01   +6.986301618925179e-02   -2.980516492437746e-03   +1.244417569064145e-01   -3.104180611412771e-02   +1.771248436115407e-02   +3.669363780936720e-01; +3.638117629482758e-01   -7.197772074054216e-02   +2.918707404780848e-01   -1.676347765852931e-02   -2.237665282009348e-01   -1.093945511161243e-01   -1.779336493790126e-01   +1.893070044255379e-01   +1.559762498110551e-01   +1.145296600637289e-01   +1.084789437060398e-01   +2.007805287944339e-01; -2.109787347037241e-01   -1.203047926210476e-01   -2.850847787912006e-01   -3.367708985633586e-01   +9.903042394371742e-02   -2.669429034758934e-01   +1.959287386817070e-01   -6.738958916757676e-02   +3.315595813121922e-01   +1.311617787663319e-01   -1.666177864995798e-01   -1.725396185763500e-01; +3.297717005581178e-01   +2.488934801844540e-01   -9.846918207948765e-03   -1.755301671163298e-01   -1.659391159761586e-01   -1.778450621783345e-01   -1.492156496635149e-01   +2.971608755423721e-01   +2.686134834013610e-01   +4.770268385229971e-02   -1.136621911172212e-01   -1.159669557404073e-01; -9.268242979355669e-02   -3.612886780734372e-01   -7.682957544160754e-02   +8.873343342719528e-02   +5.557914492010468e-01   -3.163416734432509e-02   +3.455678770229643e-01   +1.964710064724682e-01   -2.424756006814761e-01   -1.832078333975165e-01   +1.613405396554137e-01   -1.649144270114927e-02; -1.349246128952084e-01   -1.195308938969286e-01   +3.386337703113196e-01   +2.653942348886315e-01   +2.373779736873635e-01   +1.595382864239901e-01   +1.025673853812852e-01   +8.454874566089894e-02   -1.585350167629525e-01   +2.878747753068493e-01   +3.892789010950559e-01   -1.223420094021058e-01; +1.977099549376075e-01   -5.713571866867478e-02   +6.845467896599497e-02   +1.994059076826157e-01   +1.879835108368638e-02   +4.516636846043433e-01   +3.008967461203986e-01   +3.123422775444197e-01   +3.122396346805195e-03   +1.305670123851786e-02   -1.062832847791366e-01   -2.653758322512206e-01; +1.599132594757355e-01   +1.973708416692154e-01   +1.453909320784659e-01   -5.598359637437594e-02   +6.344533249708453e-02   -5.645163779297725e-03   +1.857595234844256e-02   -2.987879486215149e-01   +4.679963772569740e-03   -1.411342513823383e-01   -9.849505786998364e-02   +4.698130394520716e-02; +2.718376522331213e-01   -6.926263551286388e-02   +1.369678585071047e-01   -1.065777988380610e-01   +2.594242511263460e-02   +1.182631210195993e-01   +4.074245439229955e-02   -9.068949102429918e-02   -1.559980154952499e-01   +2.107099816298948e-01   -1.127999725705401e-01   +2.003407236954707e-01; +5.519781274887758e-02   +2.022653126318477e-01   -4.037933706175380e-01   -5.619807659900422e-02   +3.736610157284254e-01   -3.841428519959451e-02   -2.993483400202097e-01   +3.938296505517083e-02   +5.524247357376008e-02   +1.963790142328611e-01   +1.786689420899542e-01   -6.550749323385788e-02];
L3E_L3I_iGABA_netcon = [-2.335136618219815e-01   +5.192694499036703e-01   -2.680279296417085e-01   -3.549376974676851e-01   +1.516731843318618e-01   -1.018611219266806e-01   -6.343935427744916e-02   -5.015082877909984e-02   +4.164819455073651e-01   +3.037946570637462e-02   +1.220009632910348e-01   -3.725893587067425e-01; -7.395185344896206e-02   -1.221517972370237e-01   -3.650302118801912e-01   -1.971165758535494e-01   +3.009336078709323e-01   -1.281898992480647e-01   -2.598074646431487e-01   +1.137533892525153e-02   +5.731425283408343e-02   -4.003153424791118e-01   +6.152293959891730e-01   +5.500225710599879e-02; +1.776134822165851e-01   -3.015959612222390e-01   +2.225793855717474e-01   +1.719154167692860e-01   -2.820255952286767e-01   +1.439254304525479e-01   +2.235872613566826e-01   -8.596875938172090e-02   -5.351592557055321e-02   -1.057122584007392e-01   +1.905557016980607e-01   -7.366789664004858e-02; +5.925779580927967e-02   -3.030592962658241e-01   +2.974435322175333e-01   -3.781962899132861e-01   -2.580009958421616e-01   +2.930778834218820e-01   -2.048698183522200e-01   -1.977327090035678e-01   +1.058365855567345e-01   +7.516517477761422e-02   +2.005467846919453e-01   +2.220306700599150e-02; -2.266305226677687e-01   -7.197296521771954e-02   -3.575456622472967e-03   -6.910262464029361e-02   -3.358857232899993e-01   -1.532656748835624e-01   -2.013675239423197e-01   -3.012459771723921e-01   -1.507891225061516e-01   +2.558738024526860e-01   -4.553377857810240e-01   +2.320704240960797e-01; -2.694922600921665e-01   -1.160489681990330e-01   +8.094119207269855e-02   -3.971516013952716e-01   -1.922899322870282e-01   -3.370259978045496e-02   +2.492586770784825e-01   -3.526940627387967e-02   -6.156113177143167e-02   +7.581528869492490e-02   +3.079286343326906e-01   +1.750730322127273e-01; -1.994511337297352e-01   -1.727048746017853e-01   -1.238184528641289e-01   +6.537227910925703e-02   -2.620712265198913e-02   -4.622845373611739e-01   +2.206992967341576e-01   -1.719101806614521e-01   -6.432126651929293e-02   +2.674760125645939e-01   +1.539567885447675e-01   -9.767924428993358e-02; +7.724924847192953e-02   +1.621933953578486e-02   +1.229581854225657e-01   -3.180986294853778e-02   +8.950696865629321e-02   +3.859164312652544e-01   -5.659025336493988e-02   +2.462589144321349e-01   -2.086618584429735e-01   +1.740786850066909e-01   +1.931810589595629e-01   -3.539076713931749e-01; -1.941023577142588e-01   -1.666851039401422e-02   +9.462736043195044e-02   -3.062058764179719e-01   -3.605743193226290e-01   -3.360026173836236e-01   -5.388538426411940e-01   -1.297225664903512e-02   -2.664183430670523e-01   +2.206632458350170e-01   -1.333096066541505e-01   -2.239534700007039e-01; +4.894598219829789e-02   -4.095072396385587e-02   -7.571223799511795e-02   -3.665676129500834e-01   -2.714943699034793e-01   +5.950163145632768e-02   -5.254299001265147e-01   -2.243345230166774e-01   +9.816259131592131e-02   +5.901500350078088e-02   -6.665456769711550e-02   +7.853302284514499e-02; +4.156951837216777e-01   +2.171665294204722e-01   -4.029478652240794e-01   -3.288545235409827e-02   +1.196204928633799e-01   +2.130271459023896e-01   +9.697448723957741e-02   +3.451985279078433e-01   -2.402087380282157e-01   +1.133072498763217e-01   -7.610645376147374e-02   -8.879069420198965e-02; +4.189828565752814e-01   -6.901986573368657e-03   +1.903711949767096e-01   +1.297848843839205e-01   +4.421143590278762e-01   -1.817496357250839e-01   -1.254051924553578e-01   -1.466711152405117e-01   -4.778948721888387e-03   +4.762209596992865e-02   +2.390855694708754e-01   +2.098675911888103e-01];
L2E_Input1_iAMPA_netcon = [+1.811392338245889e-01   +3.814339115504946e-01   +2.937899072248901e-01   +1.555481709801593e-01   +3.076669158652545e-01   +1.726315914385750e-01   -1.499247338315590e-01   +4.288895464243273e-02];
L2I_Input2_iAMPA_netcon = [-1.077097981611446e-01   -3.533858404963613e-01   +3.027725626212965e-02   -2.935575189506106e-01   +2.114884823698522e-01   -1.083289212148625e-01   +2.250890103672974e-01   -9.314141357614407e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
