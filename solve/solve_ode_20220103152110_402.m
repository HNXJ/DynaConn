function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.561677501175112e-01   +3.007728503532939e-01   +6.316816054098652e-01   +1.568677161066356e-01   +2.940398640403001e-01   +6.986208377518824e-01   +6.476806186224560e-01   -1.065840284887804e-01   -6.869828776667704e-02   +1.464275281249442e-01   +5.791856379203647e-01   +4.473238818864272e-01   +4.058483837633498e-01   +3.601489394078992e-01   +6.560165237873139e-01   +5.317493401452521e-01; +3.808653251152707e-01   +1.565257831500908e-01   +2.694670520609582e-01   +3.994281435413146e-01   +4.253177922845063e-01   +2.371425094081788e-01   +2.794785246839919e-01   +4.078268584176543e-01   -7.125108134284766e-02   +7.052609879406824e-01   +3.297520685503054e-01   +6.958803049480518e-01   +7.674818816736383e-01   +2.122023779464501e-01   +5.786372448263316e-01   +3.556312484952758e-01; +7.576268981355895e-02   +2.668651249932087e-01   +5.376410305227451e-01   +7.557475096501157e-01   +7.550357435145435e-01   +2.829779510172379e-01   +3.027596410696427e-01   +4.989638085928156e-01   -4.699207916051561e-03   -5.050177491364411e-03   +5.128723953660632e-01   +7.194505639570281e-01   -1.865633075924912e-01   +2.577479147887032e-01   +6.208181952099489e-01   +2.009760581912633e-01; +3.412449571870123e-01   +6.344006435655609e-01   +6.953177901297058e-01   +8.347304102404173e-01   +1.140564501977568e-01   +5.079465478090298e-01   +8.570682770656737e-01   +4.572504331616222e-01   +7.257495010112387e-01   +3.714268168073555e-01   -4.202125651134615e-02   +4.282355171831563e-01   +5.617116618639694e-01   +5.812854145736742e-01   -1.411867359457779e-01   +2.278103690858602e-01; +2.852543439430330e-01   +5.394353940696626e-01   +1.602939615154319e-01   +4.227680376042071e-01   +2.280868148250391e-01   +8.688993062123110e-02   +3.715438709189767e-01   +4.608953810794036e-01   +6.801520609649631e-01   +1.383435316179512e-01   +5.994677912905683e-01   +4.968683998105383e-01   +5.113348799151671e-02   +4.756137218145873e-01   +3.373647683536620e-01   +2.186160518218225e-01; +7.835362118544440e-01   +7.487643153521468e-01   +5.306439406123943e-01   +2.354796722526290e-01   +2.396643215467903e-01   +6.768977476143297e-01   +7.652477018615097e-01   +1.991229490688491e-01   +1.733971273840751e-01   +5.934543805310264e-01   +3.296544588041492e-01   +8.074123077375963e-01   +5.662885425627167e-01   +4.634848606040595e-01   +8.274107201842751e-01   -1.355775849850811e-02; +5.715133131385031e-01   +6.506669146852244e-01   +5.391649994581929e-01   +3.523792995468464e-01   +4.493147468326899e-01   +3.373871450391283e-01   +5.002131003891773e-01   +8.737574760777174e-02   +1.210519636165753e-01   +1.441249990058115e-01   +3.235765861308437e-01   +4.484008429196122e-01   +7.143760862661546e-01   +3.466682950140730e-01   +5.692702220458932e-01   +6.528893538550271e-02; +4.177413231092298e-01   +4.828261986685031e-01   +7.032316501862948e-02   +4.486520715628150e-02   +3.378706238166326e-01   +2.430669023990608e-01   +5.052736155562725e-01   +4.430688520608447e-01   +1.469478561674733e-01   +2.882948644606536e-01   +3.282904120255494e-01   +1.961951627278920e-01   -4.209083305033826e-02   +6.294695386900018e-01   +1.288751038108308e-01   +3.792985329367049e-02; +6.436740292841363e-01   +2.178131524778755e-01   +7.082702813373584e-01   +1.357176807353403e-01   +6.347370117824936e-01   +4.983206284512185e-01   +1.398996801492572e-01   +8.263557958548395e-02   +5.026042549914400e-01   +2.791884169069960e-01   +3.578831126241235e-01   +5.299143990020201e-01   +5.252358827321247e-01   +4.942231773752503e-01   +4.000690058602240e-01   +5.205034741326385e-01; +1.887835871231112e-01   +5.913235218744793e-01   +3.237594818818827e-01   +2.874064067783085e-01   +4.427928407499001e-01   +8.637708538503406e-01   +5.561308683830257e-01   +4.372737394203526e-01   +2.967926480931507e-01   +4.826712811533777e-02   +2.976192882868998e-01   +5.762610107169985e-01   +2.273004704110103e-01   -2.650313493482718e-02   +4.086859652766528e-01   +2.823700609193622e-01; +1.481530966868373e-01   +1.088839031859331e-01   +4.344484724394421e-01   +5.343532155824063e-01   +5.124436881294407e-01   +6.273701829174440e-01   +7.795709253513161e-01   +2.695427805517225e-01   +9.321282516513593e-01   +2.723239692877660e-01   +4.293683670976113e-01   +4.475739587517891e-01   +7.689003697819484e-02   +1.331708363636928e-01   +6.361068388651584e-01   +2.814367926477264e-01; +3.223898674974701e-01   -1.067916851326342e-01   +2.082194400587558e-01   +3.978789789565270e-01   +1.926652924427784e-01   +6.968701572569188e-01   +3.315617797675390e-01   +7.265211439895021e-01   +6.905639392345080e-01   +6.698787849161111e-01   +3.761772655532936e-01   +6.533376623224065e-01   +4.246893089531359e-01   +1.671836472880681e-01   +6.595458418970098e-01   +7.498705857246825e-01; -6.865345048079970e-02   +8.922352026649676e-02   +6.384257392520231e-01   +2.217859455860724e-01   +1.581556850596312e-03   +5.589679741867755e-01   +4.578867805073505e-01   +6.089840095123823e-01   +8.241096042032967e-01   +8.265135656817894e-01   +2.370637500211861e-01   +5.677433877422440e-01   +6.255672720783357e-01   +5.665672089212365e-01   +1.000000000000000e+00   +3.151282015098253e-01; +6.745850053857855e-02   +8.707598707517250e-01   +5.841626128878868e-01   +2.746923282259766e-01   +1.919294571045864e-01   +6.684518846778066e-01   +4.317370625577311e-01   +7.027601786177748e-01   +2.538115145896409e-01   +6.199240325254043e-01   +6.849804566384656e-01   +4.287730076892768e-01   +7.385635511199655e-01   +4.409674808985049e-01   +7.019908418738689e-02   +6.076670076494002e-01; -4.174216459506642e-02   +4.020420929650522e-01   +6.065704749265264e-01   -9.921138915562653e-03   +9.395550891168118e-02   +2.544104250422740e-01   +6.924141580804062e-01   +6.376829357826782e-01   +2.376916202437476e-02   +8.556081180326746e-01   +2.649020319082073e-01   +1.215320127882370e-01   +2.582850394912296e-01   +8.348883188816254e-02   +5.206032477979304e-01   +4.219627183615343e-01; +3.819167918927517e-01   +5.447190346120443e-01   +6.491573493231011e-01   +7.038994992370663e-01   +5.504434821654938e-01   +3.020879906846732e-01   +1.866021851560274e-01   +3.554284427674949e-01   +4.641488879646006e-01   +6.206227478230493e-01   +5.418203614201485e-02   +3.686553425812124e-01   +4.278713607611389e-01   +6.854909019548086e-01   +6.430130260738738e-01   +7.538810102170143e-01];
L1E_L1I_iGABA_netcon = [+4.034712361753169e-01   +2.008358075270135e-01   +2.350651247208728e-01   +4.421690622447532e-01   +2.898526148540351e-01   +4.177363428431263e-01   +6.160101949327842e-02   +4.878336794319589e-01   +4.995766736789612e-01   +2.556973260078730e-01   +6.079490691548021e-01   +5.115283110524887e-01   +1.065452805479228e-01   +5.447923254452379e-01   +6.615818128144770e-01   +3.157013797956373e-01; +2.925248383006998e-01   +1.518617672735107e-01   +6.718262001160912e-01   +5.423590533757848e-01   +3.285926701820606e-01   +1.078785846560748e-01   +4.835604116690990e-01   +2.956150087939143e-01   +2.261669784665504e-02   +3.114706475219637e-01   +2.295462302193111e-01   +4.050858538194567e-01   -8.734014020344437e-02   -9.112667575373976e-02   +6.160371625829669e-01   +2.359538014500837e-01; +5.013279419013945e-01   +1.220848755489937e-01   +3.793468248867132e-01   +6.106422864633606e-01   +4.187974901281849e-01   +4.371457623289704e-01   +4.156000526396403e-01   +5.370195679190315e-01   +2.655995662676605e-01   +3.075415798205137e-01   +3.611917652251446e-01   +3.741765517242179e-01   +8.474008810003352e-01   +5.833321570126302e-01   -1.522914465400345e-01   +6.210635541757877e-01; +1.174606025681772e-03   +6.853981979051540e-01   +6.492803199163232e-01   +1.793106555938032e-01   +6.555581635934076e-01   +6.854779668673869e-01   +3.382560981479146e-02   +4.850425275085208e-01   +1.718832454694693e-01   +1.165917533230892e-01   +7.168085130092063e-02   +2.854663231679045e-01   +4.864642391019464e-02   +4.193786018386119e-01   +1.783591762323103e-01   +5.592364856997526e-01; +1.667604175328246e-01   +4.921363567454171e-02   +1.372038191682540e-01   +4.313876073128353e-01   +4.427771595964228e-02   +5.602853962330351e-01   -4.264137341142506e-02   -4.422444390806803e-02   +1.878472966466553e-01   +1.643095811477072e-01   +1.526588701879530e-01   +8.310155593296694e-01   +2.791562756282892e-01   -6.732376932829863e-02   +6.158631141542306e-01   +9.791753997566167e-01; +5.890218681808304e-01   +1.176121061132892e-01   +1.001789803733583e-01   +3.230766390946976e-01   -2.211044015889996e-02   +4.288219321528159e-01   +1.701276286745649e-01   +7.188394882116252e-01   +4.206564637284207e-01   +7.836434031589645e-01   +6.625064010633175e-01   +7.593518552627126e-01   +6.276279143078921e-01   +3.582298447273695e-01   +1.111449934317912e-01   +3.213898068887633e-01; +4.921775689573250e-01   +2.311012462485413e-01   +1.022499457875634e-02   -2.338136938117188e-02   +6.750981949212538e-01   +6.020826463022962e-01   +6.295172172678928e-01   +1.700330333076858e-01   +3.808441734941499e-01   +7.797558113042306e-01   -1.318355959784014e-02   +5.693120201767978e-01   +3.183836878091272e-01   +4.229353391560275e-01   +1.654354516127781e-01   +1.456591510878532e-01; +4.788787618101645e-01   +1.570014629066682e-01   +7.245186550558826e-01   +1.000000000000000e+00   +1.647628299502787e-01   +4.444614813892808e-01   +2.193023774116390e-01   +7.339833409370282e-01   +1.773406549367997e-01   +2.196432437539238e-01   +3.316290750661084e-02   +6.969870564637767e-01   +5.282277313241129e-01   -1.195918616118467e-02   -1.555030789709858e-01   +5.925819329708050e-01; +2.558514363404552e-02   +7.561006258388616e-01   +4.290171166504194e-01   -3.092112911985115e-02   +6.642771734809243e-01   +3.315300701904168e-01   +3.879900585262944e-01   +2.406213916785424e-01   +2.364483167016660e-01   +7.744933233533539e-01   -1.452580638883275e-01   +6.867734337661359e-01   +1.702101342398659e-01   +3.341893475886196e-01   +1.083067256823050e-02   +2.783703373679861e-01; +3.085197927725488e-01   +3.504877338247097e-01   +3.383769997338289e-02   -4.476644923265213e-02   +6.810190587373958e-01   -2.153920532293068e-01   +3.589277844547202e-01   +9.026589805226396e-01   +3.573457372763919e-02   +5.820292906419371e-01   +1.452842387996753e-01   +6.597821391812300e-01   +2.394174202011542e-01   +3.111402578186704e-01   +4.129758108264219e-01   +7.209402818652331e-01; +8.723107293851198e-01   +5.326634608057808e-01   +5.856106557180966e-01   +7.484555454652418e-01   +5.254987079821115e-01   +4.147713643514951e-01   +3.511080225700358e-02   +1.671258993414987e-02   +5.843849577267344e-01   +1.580707487360578e-02   +4.143275792099652e-01   +4.771414875887188e-01   +3.821727747581743e-02   +9.125731665436678e-01   -2.191393964421648e-02   +3.013234661102672e-01; +6.409466205866644e-02   +4.557836809702049e-01   +2.721029493156781e-01   +8.448991560795354e-01   -6.072279105204503e-02   +2.774294782075432e-01   +2.932990046845127e-01   +2.574068353536569e-01   +8.989709026678302e-01   +4.343802684592384e-01   +5.815058734294929e-01   +7.741086058706658e-01   +2.394027953250694e-01   +6.474784782214826e-01   +4.688720248806462e-01   +3.466973968952058e-01; +8.437598980299325e-02   +6.147892746500110e-01   +6.514703908657603e-02   +6.554430006063257e-01   +9.942232669636680e-02   +5.297663666974751e-01   +4.571747695047129e-01   +4.691736040354576e-01   +3.853792107633948e-01   +6.953834367490366e-01   +2.668946319378233e-01   +6.078559530269356e-02   +2.994643586253352e-01   +2.675376069995542e-01   +2.597633923116506e-01   +6.882371203679041e-01; +8.058757094418959e-01   -3.519829083890137e-02   +4.382315156120234e-01   +4.916816142133220e-01   +4.712436409939091e-01   -3.585868715329123e-02   +3.885157287604039e-01   +8.039769564660446e-02   +6.544095186396064e-01   -1.146401834907931e-01   +4.838062248978059e-01   +7.224392867603496e-01   +4.039339249409505e-01   +6.243931943480497e-01   -8.540058144644176e-02   +4.403649815517328e-01; +8.733049626715153e-02   +3.765252863859467e-01   +4.836483970811497e-02   +2.040830342064580e-01   +5.722653833675674e-01   +3.233710857124943e-01   +5.867672347241579e-01   +6.068780158544913e-01   +7.967008287073162e-01   +5.565379133275357e-01   +6.778861363969253e-01   +4.049634048552972e-01   +2.427914156181040e-01   +5.596264404450676e-03   +2.910369443542652e-01   +2.824260199863717e-01; +4.174226150281755e-01   +2.053892021726494e-01   +5.859628934085225e-01   -1.902430838432800e-02   +4.068050357487266e-01   +6.564487266029948e-01   +4.189041564264063e-01   +2.269717629002534e-01   +5.748203065988816e-01   +7.589015040960680e-01   +6.459482882193122e-01   +4.126676268331402e-01   +5.296625844865439e-01   +4.401303055752490e-02   +3.822605920325430e-03   +3.355647373926754e-02];
L2I_L1I_iGABA_netcon = [+6.492859828003410e-02   +5.497413046644853e-01   +6.440098130579619e-01   +1.227092957068646e-01   +5.913538161726689e-01   +2.331485893918015e-01   +4.302809391907194e-01   +5.953616734762335e-01; +1.377714000386853e-01   +2.293869947490569e-01   +2.057004464858346e-01   +1.640178792642757e-01   +7.985536202680293e-01   +1.106554758239951e-01   +4.888215191608192e-01   +8.415523881023362e-01; +2.153416057701993e-01   +4.053702295788875e-01   +4.789364703198272e-01   +6.787876425130409e-01   +5.085937168152582e-01   +5.584031279795683e-01   +2.931688507631411e-01   +1.234715507817523e-01; +3.782046421823025e-01   +4.573634619859598e-01   +4.568003712877786e-01   +8.302175652430650e-01   +2.421376313825989e-01   -3.886743531842889e-02   +4.368118190861872e-01   +1.080307185501176e-01; +9.165977320359320e-01   +3.257536836560112e-01   +2.474552432939837e-01   -8.429693289060521e-02   +6.520405924902924e-01   +3.490321920635251e-02   +9.602390164301160e-01   +1.026548782204461e-01; +4.724194982971778e-01   +5.945812077513534e-01   +7.635395613076590e-01   +7.806086868508791e-01   +6.520079677914817e-01   +6.775473231384296e-01   +4.332325683363871e-01   +5.727475712608767e-01; +8.007404170391292e-01   +2.468450967302236e-01   +4.186320657698456e-01   +1.911015154363940e-01   +7.493250230198550e-01   +4.863362900765786e-01   -4.186638280240913e-02   +4.299970198387452e-01; +5.647214423554380e-01   +3.703251085990827e-01   +3.412126567672494e-02   +6.519363804234308e-01   +5.695825782803717e-01   +7.961157739400370e-01   +4.847473016506922e-01   +2.179496594367121e-01; -2.018080292157403e-01   +4.740694386744932e-01   +1.734700357586784e-01   +3.904459509208209e-01   +4.505868835566154e-01   +6.621175550502234e-01   +4.855894359179955e-01   +3.104245422589324e-01; +6.746458516168773e-01   +9.961648680997114e-01   +4.363143248793006e-01   +5.147431120213376e-01   +3.007822932990348e-01   +1.336700339262229e-01   +4.604127443732689e-01   +2.743492344868333e-01; +3.343804118184301e-01   +1.162162296156398e-01   +7.132508526443900e-01   +5.839858442020831e-01   -1.247330573753534e-01   +2.150832020441484e-01   +4.897157617420881e-01   +1.822711012134213e-01; +1.927622908642859e-01   +1.626349459051689e-01   +2.660356620114993e-01   +5.960062277284974e-01   +1.222070571750882e-01   +5.116772466415171e-01   +7.150485283250925e-02   -1.638267297603552e-04; +7.302146753583012e-01   +8.919116690375285e-01   +2.441509421384262e-01   +4.357171488770963e-01   +3.300444870630784e-01   +1.557305086283823e-01   +8.170131465268508e-02   +7.651210845978835e-01; +3.557268384530863e-01   +8.809931957378161e-01   +8.765947718668711e-02   +5.181922289718525e-02   +5.294745872737342e-01   +5.564124194934296e-01   +5.737171391047670e-01   +5.519395132269422e-01; +2.131157632147269e-01   +3.390556579269995e-01   +3.889945160661543e-01   +1.671389341757765e-01   +5.367126582891576e-01   +1.235103296004808e-01   -1.035694994770684e-01   +5.722687835543945e-01; -1.726018543465935e-01   +1.980702566364355e-01   +1.747183263539996e-01   +1.271907258285914e-01   +3.578454057818087e-01   +6.702345614983491e-01   +2.278579832467172e-01   +3.605200863082435e-01];
L1I_L2I_iGABA_netcon = [+1.199613782887225e-01   +7.005366216745339e-01   +3.204038864071275e-01   +1.330058314619799e-01   +7.473555771167077e-01   +8.366782342808362e-01   -1.471464575705514e-01   +1.016539763660633e-01   +9.457442156615607e-02   +5.493182327897266e-01   +4.744871969134802e-01   +3.671791018608761e-01   -1.101557533880731e-01   +4.446100033231331e-01   +1.400284731969089e-01   +6.655623620991787e-01; +6.640362904876582e-01   +5.103532423523681e-01   +3.729789898698198e-01   +1.455503991879974e-01   -7.265304593281860e-02   +2.346240064854828e-01   +4.763470764277065e-01   -5.781856470397931e-03   +1.607792075979332e-01   +1.263729664276552e-01   +3.316868637382233e-01   +2.552999443534236e-01   +6.468603885202064e-01   +5.487572527421419e-01   +9.994017181549377e-01   +7.356034835204339e-02; +3.866364852998345e-01   +3.710050079297842e-01   +8.410777046081263e-01   +2.272205954863083e-01   +2.104830614312690e-01   +5.040006909175700e-02   +6.624093008317986e-01   +4.002246721262414e-01   -8.750526751236277e-02   +8.016588496596626e-01   +2.276306837582966e-01   +3.246493154772048e-01   +6.231011851060672e-01   +5.120374434912790e-01   +1.697794846954728e-01   +1.400191638874730e-01; +6.039535625033055e-01   +4.996484222828482e-01   +3.770185813496455e-01   +3.334274354245956e-01   +6.109142851598175e-01   +3.700661976442026e-01   +4.401546883539965e-01   +1.469231882399440e-01   +4.109616522891205e-01   +1.885556819234726e-01   +2.656171204807615e-01   +2.776295408718643e-01   +2.713221962947915e-01   -1.351354460798799e-01   -7.779952183896277e-02   +4.393310636875000e-01; +6.345813007006672e-01   +5.852066033347229e-01   -1.253974025403610e-01   +7.245769341645028e-01   +4.729261563652231e-01   +3.291619869636848e-01   +4.003985310058085e-01   +1.319595958549484e-01   +8.139553495271521e-01   +4.912223963519367e-01   +7.252427863124452e-01   +7.051348833989672e-01   +5.763348493987721e-01   -6.660655163114214e-02   +5.562471839808412e-01   +7.176618298522968e-01; +3.897939617083677e-01   +2.496828663841481e-01   +7.533506878411457e-01   +1.534309175615616e-01   +9.823035166714902e-02   +4.648645100052727e-01   +4.894694044321825e-01   +6.210987970767111e-01   +5.800679324425316e-01   +4.795754440527825e-01   +7.499481358487297e-01   +5.842731131381043e-01   +5.755629629268022e-01   +1.330175706195973e-01   +3.329626258525661e-01   +7.210660929169944e-01; +2.762073950271147e-01   +1.592881842734107e-01   +2.918094027420797e-01   +5.726298644391264e-01   +5.057479056607329e-01   +5.340276064857180e-01   +1.188419238034652e-01   +1.994191197520927e-01   +1.569570880887932e-01   +1.515861195586544e-01   +3.118523203918619e-01   -3.775192043480689e-02   +3.824612871162262e-01   +3.838776141804356e-01   +6.573823677764328e-01   -3.663370770755167e-03; +4.156667414998271e-01   +7.697005631100787e-01   +4.110385616028451e-01   +2.088590250636087e-01   +5.853252325536367e-01   +2.578617439565953e-01   +8.320854645461709e-02   +4.847196262306021e-01   +5.406714262793131e-01   +2.932328049012283e-01   +1.575760525260849e-01   +7.403793435419393e-01   +5.039718917342529e-01   +5.994629483102172e-01   +3.000537966737372e-01   +4.893280893127143e-01];
L2E_L1E_iAMPA_netcon = [+3.264760720417859e-01   +5.320201828345736e-01   +5.448161853709756e-01   +3.036099199533518e-01   +4.094235959468138e-01   +7.259048611599419e-01   +5.217693439388490e-01   -7.102036878506084e-02; +3.339817383278967e-01   +2.732565688652808e-01   +3.087757293937186e-01   -1.233407314791453e-02   +2.672685640946307e-01   +2.742001574984137e-01   +6.226634559747937e-01   +2.268140892657812e-01; +6.471532564452646e-02   -2.013566785775300e-03   +7.723554854868611e-01   +5.013058981049793e-01   +3.455744054714216e-01   +4.865626264694649e-01   -2.950761517686012e-02   +5.293772464641079e-01; +3.320796381507787e-02   +3.034846948229126e-01   +9.668367960079881e-01   +2.194846967935743e-01   +3.305888115605614e-01   +5.876569415102098e-01   +1.380230595775090e-01   +1.743190221278485e-01; +6.542420787141484e-01   +2.578467342396957e-01   +4.753600939118078e-01   +6.685614032318918e-01   +7.436741216761077e-02   +5.654686051933068e-01   +6.704106533413466e-01   +7.294048481153379e-01; +8.395688932258519e-01   +1.917033873590352e-01   +5.235200746794858e-01   +5.639725977575175e-01   +3.354255703622253e-01   +8.216807733700479e-01   +5.734229433898972e-01   +8.192499744394122e-01; +6.603012939265345e-01   +7.155240911473697e-01   +8.213551047269241e-01   +1.543472216279446e-01   -6.098797779270345e-02   -2.179319689473184e-01   +5.883899308646019e-01   +7.589249148489947e-01; +5.075473063346404e-01   +8.114555091564026e-01   +6.022202471009018e-01   +4.413077436520270e-01   +4.144952594981969e-01   +7.246476215268157e-01   +7.098196497144743e-01   +5.748335518303920e-01; +1.316985657693266e-01   +3.705951060401086e-01   +5.078752922712688e-01   +4.047690240367375e-01   -1.202967509298286e-02   +4.288360544955172e-01   +5.559482883948633e-01   +7.634877960420657e-01; +1.740909711244907e-01   +7.928374134514260e-02   +4.007709833830789e-01   +3.237952137292045e-01   +5.239054632911827e-01   +4.093845749756970e-01   +4.049842924382661e-01   +5.952173133592719e-01; +4.069581408117359e-01   +9.082344196023278e-01   +3.262794032763753e-01   +3.179383652984668e-03   +4.220446916066470e-01   +6.278359388903443e-01   -1.608246299711659e-02   -1.885061871985345e-02; +7.768813771782811e-03   +4.314087911368477e-01   +7.813054500594314e-01   +1.039503944170559e-01   +2.471652316106786e-01   -1.654497939216588e-01   +4.572578224011228e-01   +3.435307558911457e-01; +1.332967016471085e-01   +4.593032088572420e-01   +1.000000000000000e+00   -1.342062283204525e-01   +4.891318256123726e-01   +1.550824398242951e-01   -1.712475798970922e-01   +6.401171250970348e-01; +1.371229723253807e-01   -8.395439228642668e-02   +2.871689246278182e-01   +5.193688959721591e-01   +5.730608252605659e-01   +8.290949760313271e-01   +8.807161516808494e-02   +7.924027172728715e-02; +5.139617856913410e-01   +6.080694348540132e-01   +2.704321320005814e-01   +4.727722177823035e-01   +4.774471771198364e-01   +2.274537122960782e-01   +4.427904913372765e-01   +5.440613978877376e-01; +4.394241573707759e-01   +5.235730533107271e-01   +2.029065253591450e-01   +4.560723622167598e-01   +8.659027022439574e-02   +5.037081373619287e-01   +2.040327448481978e-01   +4.174335575061433e-01];
L1E_L2E_iAMPA_netcon = [+5.091702027912528e-01   +4.051679625908374e-01   +8.184562605488510e-02   +6.106725676924127e-01   +8.111085759781586e-01   +1.740041903902058e-02   +3.679817637551293e-01   +6.029875399335796e-01   +1.069316155726959e-01   +3.500300743499478e-01   +4.892594258383752e-01   +9.333575173463856e-01   +1.130194518708580e-02   +1.594993461370162e-01   +8.588119800021409e-01   +2.815063650586488e-01; +5.948366416588453e-02   -6.147435629093715e-02   +5.900294977063700e-01   +3.542076942973320e-01   +2.912111784106247e-01   +1.787179084060363e-03   +3.387933563169653e-01   +1.337952565068283e-01   +4.998682034058775e-01   +8.511178786765762e-01   +5.399249501949964e-01   +1.995686729659908e-01   +8.682931086731399e-01   +8.994203846090151e-01   +3.320336910636532e-01   +5.482642389495016e-01; +2.623274218844691e-01   +7.809780922343813e-01   +3.151339081224481e-01   +1.185092824643592e-01   +5.825438443458377e-01   -5.216381611461023e-02   +8.158420446134202e-01   +6.978746780221561e-01   +6.380329212508302e-01   +3.930782268008776e-01   +6.029438354849439e-01   +2.137482629736246e-01   +5.106905893999886e-01   +4.144759165308377e-01   +6.032163917975389e-02   +4.330045520485366e-01; +7.984318076285524e-01   +2.473137446711238e-01   +3.024772670922796e-01   +1.437923114639665e-01   +2.284179875476381e-01   +4.322466727868300e-01   -8.382747992506578e-02   -2.053592787755187e-04   +8.259500263189470e-01   +4.240716618560598e-01   +4.036918380072633e-01   +1.667841994389918e-01   +4.504038512778814e-01   +7.141973098362631e-01   +5.538692299072099e-01   +4.326051143681984e-01; +4.921541721034134e-01   +2.040628720779754e-01   +2.666668852058831e-01   +3.827992445552513e-01   +3.532649746045717e-01   +6.482181199250419e-01   +1.950429137577339e-01   +3.765031262422909e-01   +4.046619969971240e-01   +3.809600219506888e-01   +2.232482271317021e-01   -5.628213313538803e-02   +1.037635217002751e-01   +6.336186933149547e-01   -2.835361643636884e-01   +7.515690614887436e-01; +9.747422581816344e-01   +2.171280447639260e-01   +2.704860900211494e-01   +6.804821213629967e-01   +1.514841494019614e-02   +1.031513417946342e-01   +4.742292612138509e-01   +1.724459473114257e-01   +4.295137268815201e-01   +1.711476897686865e-01   +3.443371970985901e-01   +8.197066877283575e-01   -2.182260151363893e-01   +2.366656949430818e-02   +3.518361121864106e-01   +5.430620597603191e-01; +2.316261281547495e-01   +3.818044807104348e-02   +3.654415870849649e-01   +3.378384702067739e-01   +8.060899055037982e-01   +4.734581800895808e-01   +3.994562193221422e-02   +6.634932384021495e-01   +3.641684737869295e-01   +9.065272896200715e-01   +5.169312810503356e-01   +1.918116055763300e-01   +1.148548990170077e-01   +1.922982928971511e-01   +5.849782798155800e-01   +1.915742550316058e-01; +3.622166255952672e-01   +2.872752468647153e-01   +8.016514653633025e-01   +5.368437568958712e-02   +7.515194469828984e-01   +2.259982908723545e-01   +2.126633746566442e-01   +4.320780701851714e-02   +1.525103421258971e-01   +7.560154561183111e-01   +3.915670317776382e-01   +2.407046443313833e-03   +8.101757278366988e-01   +6.484319430231585e-01   +3.664371549578471e-01   +3.370495738157961e-01];
L2I_L2E_iAMPA_netcon = [+4.840356989397167e-01   +8.918697543184061e-01   +2.888969616617330e-01   +5.856719285828311e-01   +8.351714652305032e-01   +7.939175897238354e-01   +7.206850947281743e-01   +2.182583106401634e-01; +9.954860071845620e-01   +1.989068247741078e-02   +3.760996450383469e-01   +7.996643333175227e-02   +7.376777560814355e-01   +3.152126823117752e-01   +2.465556892977334e-01   +7.028006630764034e-01; +9.465411543230084e-01   +2.226896210170801e-01   +7.327184086200781e-01   +5.062214832688883e-01   +2.500450206327071e-01   +6.061791709896608e-01   +1.124677497464605e-01   +8.723063158855564e-01; +4.338537280490506e-01   +7.247207646643601e-01   +3.359478762002482e-01   +9.563233571095393e-02   +3.963810283673325e-01   +1.051025768009176e-01   +8.120521974087724e-02   +4.131468897315947e-01; +4.909143748187155e-01   +4.203280373245314e-01   +6.277727688414695e-01   -1.295841745654548e-01   +6.854811773546291e-01   -2.795879935267481e-03   +1.358589116027825e-01   +4.674829306728503e-01; +1.871245172219753e-01   +1.924127954086839e-01   +6.350972705339816e-01   +4.884475354590464e-02   +4.360139093914959e-01   +6.047428680316855e-01   -5.546765051546992e-02   +2.569454042937159e-01; +3.530113805045775e-01   +1.116071121527703e-01   +4.932584539586318e-01   +6.280012344534681e-01   +6.788247306403909e-02   -6.981605006098791e-02   +2.967465174872896e-01   +5.023692271169371e-01; +4.120265462035366e-01   +4.901178280996368e-01   +5.127239071549439e-02   +7.601152414920986e-01   +5.448101241598423e-02   +8.973988780328467e-01   +2.633687279345631e-01   +6.340973084498550e-01];
L2E_L2I_iGABA_netcon = [+1.698371724688488e-01   +3.336941747297650e-01   -2.067580344819596e-01   +8.945557275399332e-01   +3.922981485630555e-01   +9.419452076898682e-01   +6.619197985640565e-01   +1.527279397709147e-01; +6.075768848173182e-01   +5.807402882937159e-01   +3.306253135569758e-01   +5.501106155292692e-01   +6.102585260032573e-01   +3.513603909969273e-01   +9.845745084762041e-02   +8.282151341766414e-01; +2.773976689780302e-01   +6.049100977259084e-02   +5.030117946208404e-01   +5.002658529328012e-01   +2.273135240834898e-01   +2.678503239633710e-01   +8.182735952735551e-02   +6.445833955658581e-01; -6.235746494856502e-02   +5.578719559226728e-01   +1.932248372542735e-02   +7.464184365134284e-01   +3.340796579314356e-01   +4.469286810710194e-01   +8.679127187047041e-01   +8.231726032447571e-01; +3.906749025435788e-01   +4.733635505856024e-01   +1.575249217010981e-01   +2.972102793368827e-01   +5.320451796504512e-02   +5.260154679673157e-01   +7.453860007396192e-02   +6.145800888274209e-03; +6.795396424935876e-01   +8.644007339876164e-01   +8.917925013017365e-01   +1.000000000000000e+00   +7.665751962571823e-01   +4.890322563121585e-01   +3.386928024328910e-01   +4.102603325995309e-01; +6.257320414080930e-02   +3.719786826656049e-01   +1.019846764097323e-01   -7.810538905538714e-02   +3.275379980272387e-01   -1.418717388190965e-01   +1.956838598912428e-01   +6.295336982476679e-01; -7.368822555983950e-03   +6.078699029876071e-01   +4.737479393155387e-01   +7.969789797542506e-02   +4.686509735714435e-01   +3.684565558134508e-01   +5.008694863656642e-01   +7.544855047627916e-01];
L3E_L2E_iAMPA_netcon = [+4.332777300764547e-01   +4.041234172645906e-01   +6.105780390368670e-01   -6.874365221821047e-02   -4.367498692456886e-02   +8.215194440284769e-01   +8.754262337818896e-01   +6.774593608463060e-01   +6.186578005474316e-01   +1.112682412736535e-04   +3.704167833703121e-01   +1.627035348790986e-01; -4.946852333581394e-03   +7.328696901739852e-01   -6.398210925805474e-02   +1.302961416621612e-01   +4.622947985656001e-01   -2.826865157249451e-01   +5.073909092853455e-01   +1.675818539473515e-01   +3.768528551777397e-01   +3.547240600272547e-01   -4.370557780249458e-02   +2.453370384500013e-01; +2.582029791043194e-01   +1.927125399120839e-01   +2.077419912915361e-01   +5.512294176308309e-01   +3.999529064242728e-01   +7.026657121007851e-01   +5.925437063157213e-01   +6.730011732621930e-01   -9.716038896230768e-02   +6.643556465211903e-01   +4.275875209266093e-01   +7.038961346283487e-01; +7.324908702565258e-01   +5.550638252745761e-01   +6.718890113790428e-01   +5.222153324614079e-01   +4.167405412644076e-01   +1.000000000000000e+00   +2.984644284001359e-01   +1.789666316971418e-01   +5.077851579825134e-01   -3.233794791481372e-01   +3.439342313287425e-01   +7.770448034607554e-01; +6.610320161861089e-01   +4.128089450301015e-01   +4.800327608303591e-01   +4.314457103564760e-01   +1.011959616952934e-01   +4.410301266184128e-01   +3.972711421712295e-01   +7.524270063575532e-01   +9.348485644799530e-01   +3.596984748454911e-01   +7.664523684060954e-01   +2.623224222335998e-01; +1.741555080248624e-01   +2.885068405937414e-01   +4.493328802363233e-01   -1.054448000517257e-01   +1.082369915608590e-01   +5.272135560797097e-01   +4.722428012678308e-01   +6.078993552971665e-01   +5.791776470076705e-01   +4.319280130495346e-01   +3.780146082618355e-01   -1.361847826411136e-01; -1.577670111905944e-02   +1.541165016260961e-01   +2.014404878284520e-01   +3.591900317209790e-01   +9.556748997915216e-01   +7.124506575344532e-01   +6.131556460246905e-01   +4.845931470062383e-01   +6.110036699235242e-01   +2.835913831135128e-01   +2.971200221728776e-01   +5.339317522611187e-01; +2.998899342875074e-01   -5.427548331261372e-02   +5.813216871250095e-01   +7.345314658377765e-01   +3.389303734141160e-01   +6.296235219515266e-01   +6.872608830640520e-01   +2.652540844327312e-01   +5.107513063895611e-01   +2.323497664286123e-01   -2.015206860061682e-02   +1.825622049135011e-01];
L3I_L2I_iGABA_netcon = [+6.583174690403021e-01   +2.246813499244747e-02   +3.736462803037336e-01   +6.231468113397229e-01   +1.995123248248607e-01   -6.399184189185561e-02   +2.772477058308915e-01   +3.257905620781729e-01   +2.608278627167919e-01   -8.206924348665248e-02   +1.442658256910568e-01   +8.949048672786113e-01; +7.380182160242124e-01   -1.167151131707478e-01   +6.385361918262082e-02   +5.171533397432087e-01   +8.239883176820879e-01   +3.328001430817490e-01   +3.619785873683966e-01   +5.556488359162612e-01   +2.111456508552909e-01   +4.921416415596956e-01   +3.786174987557937e-02   +4.215367452517357e-01; +6.477923354657499e-01   +1.147328079796296e-01   +7.366517854407792e-01   -8.474798540592052e-02   +6.041830948662329e-01   +2.667421585502508e-01   +5.713690669209440e-01   +1.715750550175910e-01   +3.034329105845504e-01   +5.565369584835370e-01   +2.449926680476673e-01   +1.000000000000000e+00; +3.956642059068154e-01   +2.806988934115515e-01   +6.988129394475323e-01   +9.267672472199684e-01   +4.410801983358966e-01   +8.506378447578651e-02   +6.652980468678613e-01   +2.235497404547881e-01   +8.024328201523190e-01   +3.998883543491232e-02   +6.678336264684827e-02   +5.703148216767887e-01; +3.075037677474179e-01   +2.733807514515397e-01   +4.781530718946194e-01   +2.044754515759792e-01   +5.303949896983994e-01   +6.159328622691655e-01   +3.913824019643389e-01   +2.186992803419654e-01   +1.019138550364407e-01   +1.672812262788527e-01   +9.275583310461524e-01   +5.598243584254220e-02; +7.242658548805448e-01   +1.064038791125147e-01   +5.682370733659005e-01   +8.295316584105824e-01   +5.914221656113248e-01   +8.913180846625822e-02   +2.929800528917632e-01   +2.213382732243948e-02   +3.484424163852193e-01   +1.184614925258683e-02   +1.865894004453306e-01   +2.302658417101007e-01; +4.332832165660310e-01   +6.412049288540135e-01   +8.161334595951183e-01   +2.486580861875630e-01   +3.076538604333113e-01   +6.230068741605841e-01   +4.824072141085458e-01   +5.891220739356263e-01   +7.733945024776656e-02   +8.090144641412039e-01   +2.917062342726348e-01   +7.045520918684473e-01; -1.148854560398313e-02   +2.239429271605693e-01   +4.869837958620714e-01   +4.626157026752699e-01   +7.121106799124785e-02   +1.341713797173237e-01   +1.457966471577397e-01   -1.830137223038532e-01   +5.650962219713138e-01   +3.810802468871553e-01   +3.942208465621257e-01   +1.586230110370391e-01];
L2E_L3E_iAMPA_netcon = [+2.245269676471510e-01   +9.489415346469336e-01   +4.101996168219316e-01   +7.794752187754551e-01   +2.716819458028403e-01   -5.097478628645410e-02   -2.221847687605983e-02   +3.249159495632324e-01; +3.038727083783188e-01   +5.480778430351680e-01   +4.502170212220820e-01   +3.290034660537925e-01   -6.068479823974951e-02   +1.462406195787360e-01   +5.478573848031005e-01   +4.940155324944633e-01; +3.986046433747729e-02   +1.499281609847027e-01   +9.871785756739527e-01   +9.027555932129142e-01   +5.321753836970131e-01   +2.696494118333008e-01   +4.632387367838494e-01   +5.741518352808092e-01; +2.641938688123003e-01   +3.544208200020250e-01   +9.770724437919710e-02   +6.355107981107269e-01   +3.108544533758493e-01   +7.523912731377440e-01   +5.073951258774508e-01   +1.900530974245787e-01; +3.230060554594300e-01   +6.937380695944213e-01   +5.757969363812513e-01   +9.887143147003770e-01   +6.267277054970644e-01   +6.136787511226413e-02   +2.277028444972059e-01   +9.754422415882663e-01; +9.306642439916324e-01   +6.057813162752423e-01   +2.058582853687870e-01   +1.612935296145743e-01   +3.887824125554376e-01   +6.207902483475625e-01   +5.041921055858118e-01   +7.537476322905522e-01; -3.072682346553010e-02   +4.642803678732609e-01   +1.526558423490159e-01   -1.582819039497700e-01   +1.028653632029435e-01   +4.362796194184748e-01   +2.013358303381151e-01   +4.554095407361741e-02; +6.160611533197514e-01   +9.810588472957021e-02   +9.190472776790894e-01   +1.929244059460943e-01   +1.207150811415188e-01   +2.531979284258805e-01   +2.918037737935934e-01   -2.544897248955305e-01; +3.848052343223431e-01   +6.545752749946014e-01   +5.317527387426843e-01   -8.263493296614062e-02   +5.172588854128242e-01   +6.743748590571184e-02   +4.667132928553435e-01   +7.119388273830839e-01; +3.827700404269626e-01   +5.042933152979464e-01   +2.430567672825146e-01   +4.348536936087039e-01   +5.498798698118430e-01   +4.682923952256691e-01   +7.446892075540401e-01   +3.191074449911675e-01; +6.175692990113105e-01   +3.389086501353655e-01   +6.791067250655950e-01   +1.986371865876599e-01   +1.608338876612704e-02   +1.866943712049045e-01   +7.188346880744959e-01   +4.694983334323141e-01; +6.331943023779741e-01   +5.398074289363377e-01   +5.652808607461574e-01   +7.536526411707503e-01   +3.041250045448985e-01   +5.605875117426259e-01   +4.023546380192928e-01   +4.690841317066034e-01];
L2I_L3I_iGABA_netcon = [+3.342836991574033e-01   +1.832569589508473e-01   +6.832578537436843e-01   +3.033459890982410e-01   +2.671649435929580e-01   +4.489194530787614e-01   -7.373883554439907e-02   +5.340032327349356e-01; +1.499007049829815e-01   -9.899030174501405e-02   +6.513700166085087e-01   +5.229495493705028e-01   +5.164517966955051e-01   +3.095453681668724e-01   +7.712056610699742e-01   +4.608667486415862e-01; +2.847758665485423e-01   +7.164798712069695e-01   +1.043069568660207e-01   +3.231478687619250e-01   -1.030563038062870e-01   +8.126020659749117e-01   +2.146923395269696e-01   +5.498862612604644e-01; +4.582184965140644e-01   +3.632847888426867e-01   +3.385466933576473e-03   +2.948158279075658e-01   +5.990000847943365e-01   +1.347497744009012e-01   +2.479398960009458e-01   +1.609987732769034e-01; +5.523386709939331e-01   +2.966100060750297e-01   +4.350921454943485e-01   +6.543332455410249e-01   +2.964136334163814e-01   +4.348583748491220e-01   -7.809421817955904e-02   +1.685820136686446e-01; -2.382052546165004e-01   +1.190322485394144e-01   +4.536266761025693e-01   +6.770914957244056e-01   +7.062541265859338e-01   +6.228929597586130e-01   +7.354369123028748e-01   -1.855437841233052e-02; +2.888715306963830e-01   +2.522663115422735e-01   +3.812968827730299e-01   +5.130127404004755e-01   +1.258571319855850e-01   +8.682166105756678e-01   +7.936510098558964e-01   +1.000000000000000e+00; +3.961809391672708e-01   +3.926400225801943e-01   +1.681077412383806e-01   +2.511704939923289e-01   -2.272415613883721e-01   +1.473482388063570e-01   +1.108277853368709e-01   +1.307057406716651e-01; +3.282148445253799e-01   +2.361118622778364e-01   +2.581082709306623e-02   -1.515040439284399e-01   +5.696353823540504e-01   +1.702119671345844e-01   +1.513137408297917e-01   +2.539198699446211e-01; +1.235764866069032e-01   -1.313781109940694e-01   +5.598525310414663e-01   +4.168489035903258e-01   +5.655308238872715e-01   +6.685246993964273e-01   +6.529706921706060e-01   +2.475989846900953e-01; +3.570130757217372e-01   +3.170029278439237e-01   +7.883017287144516e-01   +8.633732020826967e-02   +6.847325565010862e-01   +3.391543196713623e-01   +6.358944695326832e-01   +2.360864516240176e-01; +5.553631550293594e-01   +1.092112638843847e-01   +2.351889079916988e-01   +2.113680632587481e-02   +4.140971035126326e-01   +8.209203974445939e-01   +3.156902681536402e-01   +3.028878552112963e-02];
L3I_L3E_iAMPA_netcon = [+4.136996785650089e-01   -1.379889496297773e-02   +3.072434289720794e-01   +9.268240863189837e-01   +8.348733541693408e-01   +2.359972908343703e-01   +4.242178832771227e-01   +1.495699880637585e-01   -1.767874263552408e-01   +8.759787695878829e-02   +4.753368487613021e-01   -2.031894019912118e-01; +2.327972996964941e-01   +5.080167064070270e-01   +5.313448859096745e-01   +4.906895251148975e-01   +2.010564238899073e-01   +1.462015005196357e-01   +2.935326451200867e-01   +2.802399425874961e-02   +3.054260625573532e-01   +4.480748149913261e-01   +3.762855189659279e-01   +7.268669883111474e-01; +6.396418606708899e-02   +8.331440823813497e-01   +5.678047641224588e-01   +4.186704455004763e-01   +4.231048355306188e-01   +2.143151741542411e-01   +3.824322224343668e-01   +4.190087541011591e-01   +2.428118540077217e-01   -8.016982880999406e-02   +7.550747941280274e-01   +3.429735795102957e-01; +5.300390341322111e-01   +1.668689699997859e-03   +6.140379356747790e-01   +8.197852342479788e-02   +9.255160504893021e-01   +1.233605708131523e-01   +1.545997441403707e-01   +4.167576514024392e-01   +4.704935818012955e-01   +2.866849954354534e-01   +4.037452071712488e-01   +8.533501283291911e-02; -4.530983061229037e-02   +7.887075889108954e-01   +6.209066876592756e-02   +1.875013646450207e-01   +6.155732556527681e-01   +3.783966707917540e-01   +1.253312959109069e-01   +2.234285184408901e-01   +6.948264137863777e-01   +4.340232616082589e-02   +3.296366528516548e-01   -8.441990133959561e-02; +2.135178314628650e-01   +2.609219533881742e-01   +6.764655227856263e-01   +1.968584296865198e-01   +2.833795632525832e-01   +4.948555948794284e-01   +3.159542774403030e-01   +1.311791663213264e-01   +6.483844916490272e-01   -2.177320267309369e-01   +2.984078583562448e-01   +7.931533490687012e-01; -5.728923943797237e-02   +8.653302145390990e-01   -7.338917258751286e-02   +4.463456876010147e-01   +3.961760415569100e-01   +4.528833677536330e-01   +3.624711012259874e-01   +1.479240311045394e-01   +7.272564811754807e-01   +8.590258225219978e-01   +2.906289211953177e-01   +7.413483809509319e-01; +1.028113375383950e-01   +6.457184561677837e-01   +6.653751980837446e-01   +5.177220878879659e-01   +9.084808974399686e-01   -4.660754193211602e-02   +1.000000000000000e+00   +2.607117722671408e-01   +8.576787930420765e-01   +6.374905522925099e-01   +7.111597612732150e-01   +4.139995150362183e-01; +7.031439884203574e-01   -1.223841087152326e-01   +3.658112468209859e-02   +5.797337269244649e-01   +8.454326133357453e-01   -3.611686525324639e-02   +9.773183529550156e-02   +3.786725269031786e-01   +4.422953225902947e-01   +9.879829156779690e-01   +5.738908782161970e-01   +4.125918343082158e-01; +6.866836475535492e-01   +5.312955873204408e-01   +4.938139537310989e-01   +4.195070670021680e-01   +2.666024212339033e-01   +1.203931897863924e-01   +8.347995517203323e-01   +6.521274569290537e-01   +4.250553628072094e-01   +1.804096749992275e-01   +2.213452330244023e-01   +5.173021737762064e-01; +2.333895584150782e-01   +6.001518561808901e-01   +2.172027741743647e-01   +4.795738295465350e-01   +6.460731560843755e-01   +9.265924442948878e-02   +6.273256641803885e-01   +7.056816177231405e-01   +8.711357618497084e-02   +5.290785025329374e-01   +5.824296038110404e-02   +9.417260562042220e-01; +3.920672115856325e-01   -2.121193631680729e-01   +4.204014769308036e-01   +7.468352349191472e-01   +8.181912221604193e-01   +4.271646516141638e-01   +1.560741128569558e-01   +3.334254780241118e-01   +7.306497837633715e-01   +5.307122589840659e-01   +2.848658730781952e-01   +4.080914627044905e-01];
L3E_L3I_iGABA_netcon = [+2.741532792836064e-03   +5.167956262586745e-01   +3.321893953744208e-01   +5.166807916236602e-01   +6.887478722146416e-01   +5.249532039963924e-01   +6.598271474351391e-01   +7.886354414318338e-01   +8.126432371242670e-01   +2.913324673054768e-01   +1.741733987792699e-01   +4.581722837820426e-01; +6.195404284542400e-01   +6.865944330951543e-01   +6.110235634688279e-01   +7.399355524980792e-01   +3.536671075987960e-01   +1.730517465655830e-01   +6.835633570792488e-01   +6.988323155836973e-01   +7.142205052095941e-01   +6.179912120626134e-01   +1.882558589255733e-01   +4.984697025840894e-01; +3.734804015767134e-01   +9.988336911150495e-01   +1.264474684110629e-01   +7.520802737022978e-01   +2.135580851560234e-01   +3.805394686959160e-01   -1.083259864454393e-01   +3.713689374726238e-01   +1.323752014060087e-01   +6.373594888227781e-02   +9.588998809934082e-02   +1.297376492681499e-01; +1.963554136619974e-01   +1.278150309321413e-01   +7.863334050498252e-01   -8.742169618723503e-02   +1.167635530656145e-01   +1.237639055582045e-02   +7.317608097186546e-01   +3.610475341779968e-01   +5.281005947775747e-01   +3.434894242235267e-01   +1.233637064740640e-01   +2.078447464415845e-01; +7.907986611461731e-01   +6.873439745481685e-01   +7.972256582893230e-01   +3.338714745457065e-01   +4.869289038620044e-01   +6.141371594563677e-01   +6.261241192788894e-01   +1.000000000000000e+00   +1.377642138996372e-01   +7.972682118774592e-01   +5.272514362057915e-01   +3.140664572676969e-01; +8.377240440183571e-01   +6.855097535377536e-01   +3.581130720133870e-01   +5.739754791157093e-01   +3.531414299135900e-01   +7.732862280017661e-01   +4.017655496589710e-01   +7.997598081160951e-01   +3.050089491479897e-01   +4.847997812566606e-01   -2.997164044966637e-02   +1.443106855104727e-01; +6.491162084956759e-01   +6.738834881839723e-01   +2.222624760037481e-01   +9.967509261599684e-01   +4.028847211348018e-01   +2.964320375154122e-01   +4.643692901550726e-01   +2.241328255304979e-01   +2.076930100639517e-01   +2.354705070720856e-01   +9.391081478013676e-01   +4.852361591817390e-01; +6.861853868067500e-01   +2.647112218232626e-01   +4.348239743040795e-01   +5.164249559978993e-01   +7.656101697427261e-01   +3.391731030651080e-01   +2.387354482373117e-01   +4.593662936953077e-01   +4.351246571815586e-01   +8.454274277017281e-01   +8.302567115032580e-02   +3.839007948651145e-01; +3.102864929247178e-01   +3.074436040015937e-01   +5.278612583020599e-01   +5.255101619196344e-01   +1.188652792406975e-01   +5.080494861984816e-01   -4.459366912107882e-02   +5.669043510832876e-01   +2.583150262172604e-01   +1.048746263433672e-01   +9.089488650304001e-01   -1.538130900614972e-01; +2.738942479752583e-01   +6.213432495393914e-01   +3.039746396459630e-01   +2.975874109017834e-01   -5.032761550047448e-02   +5.105935904493492e-01   +1.122248327555782e-02   +6.499388792255125e-01   +2.022607162755101e-01   +3.572019891365024e-01   -1.664233580661820e-01   +1.383106006913901e-01; +7.200158097087161e-01   +1.511016173265990e-01   +8.387487383763700e-01   +2.213440718964490e-01   -3.024156880576321e-02   +2.393863710915763e-01   +5.922138272168527e-01   +1.965609851665042e-01   +1.080219100424896e-01   +1.062874335566954e-01   +4.398590869493890e-01   +4.711401587185932e-01; -5.287839289122676e-02   +3.077726149231160e-01   +7.693356496440373e-01   -1.401613645452019e-02   +1.929715866858457e-01   +4.472161520520140e-01   +7.509671190435192e-01   +6.791532558891015e-01   +1.680021974568603e-01   +1.571784789307901e-01   +1.365070926400246e-01   +3.837337323579078e-01];
L2E_Input1_iAMPA_netcon = [+9.331532364392467e-01   +6.471800521560687e-01   +6.681333628906218e-01   +8.485183080401445e-01   +8.836209104417537e-01   +9.085257101627634e-01   +8.499408605842800e-01   +7.112253722722848e-01];
L2I_Input2_iAMPA_netcon = [+8.478470705072493e-01   +8.466053265920814e-01   +8.418858131069390e-01   +6.992115232862729e-01   +7.989436059291006e-01   +6.615931074360815e-01   +8.042886562225797e-01   +9.601463469756707e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
