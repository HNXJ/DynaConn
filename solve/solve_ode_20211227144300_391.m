function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.629970326687596e-02   -4.158182715207071e-02   +3.594756346830476e-02   -2.050868209452636e-02   -4.762897202668805e-02   -1.385624971492727e-02   -3.728348906653979e-02   -4.786854257994877e-02   +3.055503787534123e-02   -7.507137784323782e-03   +4.581735459312808e-02   +3.497627351545898e-02   +4.772765721054800e-02   -5.634437200350999e-02   -1.181978095864162e-02   -2.197799932418828e-02; -2.784454852945377e-02   +3.404293670891764e-02   +2.126811276272517e-02   +4.473210892779039e-02   +4.122591936451243e-02   +3.399200789437980e-02   +2.658805490599080e-02   +6.123630824706062e-02   +4.147766436600834e-03   -1.023104500669637e-02   +5.599334387476999e-02   +8.254779770494686e-02   +1.876210703878620e-02   -2.539295773136259e-03   +3.865906033217540e-03   -3.298761845507424e-03; +1.913663814676656e-02   -1.527896276587965e-02   +2.641196126976938e-02   +1.490772410609822e-02   +1.633108027789350e-02   +2.693761201426853e-02   -4.270583985961016e-02   -3.060295088774578e-02   -3.786765386406971e-02   +7.140370443728132e-02   +1.117761154895567e-02   -6.611039362927891e-02   +1.017221429812130e-02   -3.660963733324189e-02   +3.405979182670185e-02   +2.358956733893403e-03; +1.299977045609412e-02   -2.358146710087949e-02   -1.585939781469395e-02   +2.553832134306448e-02   +2.852442429996238e-02   -5.958731427469331e-02   -1.060068994025382e-02   +4.093189793559372e-02   +8.251824133367596e-03   -6.653960921047024e-02   +2.126438545503155e-02   +6.565132534051496e-02   +2.458463453958706e-02   +4.178504749021560e-02   +4.292829717611647e-03   +4.379816565356676e-02; +2.540838919865619e-02   +2.109407429981548e-02   +1.124684054069429e-02   -2.435993084032465e-02   -4.665732277419889e-02   +2.495662823660860e-02   +1.266936411672351e-02   +5.970137631093383e-02   +5.252468448997813e-03   +5.086118779169599e-02   -5.639889607354358e-03   -1.680874139513284e-02   +1.491828460585971e-02   +5.375002389006915e-03   -1.711640123589059e-02   +1.225084231839814e-02; -4.884442067894160e-02   +2.820105953363166e-02   +6.792120253622730e-02   -4.528323016348705e-02   +5.222445385928992e-02   +4.280842159008484e-02   +3.577636775137069e-02   -3.274425790052889e-02   -3.671678324412000e-02   -2.109139902448373e-02   +3.526500085150570e-02   -1.216196203017947e-02   +3.283649067474313e-02   +4.419876382541462e-02   -7.266064002281145e-02   -3.641384080617994e-03; +7.118741905383807e-03   +4.328487620183975e-02   -7.072930042443786e-03   -2.353772650088784e-02   +7.860853429088634e-04   -3.693961913831299e-02   -8.872806889063771e-03   -5.679901757328160e-02   -6.810608728112101e-03   -4.280150721601631e-02   +2.560635960255437e-02   +2.286776340775725e-02   +6.492059295958538e-02   -3.097292283042730e-02   +1.885538302870872e-02   +5.015935871006781e-02; +3.931129964173267e-02   +3.944152664010271e-02   +1.706705778415277e-02   -3.875256253311390e-02   -5.599356940669137e-02   +1.211858995064542e-02   +3.382505481659871e-02   +5.806967701990046e-02   -8.303968101439246e-02   -3.078542736499482e-02   +8.695286775160994e-02   -1.637035941997906e-02   +6.240093504859022e-02   +1.896179646311972e-03   +1.767051381814987e-02   -2.900813767838447e-02; -6.712279031603391e-02   -1.514663628445267e-02   +5.339487419460512e-03   +3.334473413841585e-03   -1.440000636596856e-02   +5.139002466951777e-02   +1.582732317271719e-02   -1.241285583226411e-02   -1.007493437366155e-01   -1.660774132667252e-02   +4.514561289104727e-02   -2.037309524205019e-02   +1.058150149631293e-01   +3.299534783745590e-02   +9.311252969998924e-03   +5.659350752251272e-03; +4.851678933065734e-03   -6.007473405098915e-02   +1.262186249214132e-02   +6.103043501854604e-02   +1.009085514444924e-02   +3.268783089856571e-02   +4.133033530130567e-02   -5.780120918482437e-02   +5.242551373298285e-02   -1.611280061061253e-02   -4.743514746172574e-02   +1.079038222221860e-02   +9.533446673472615e-03   +4.958584035911302e-02   -8.348153966641225e-02   -3.379840741652151e-02; +1.715099238496772e-02   +3.278689099276252e-03   -8.339345123522437e-03   +2.254895828798716e-02   +4.934664373276906e-03   +9.496934272456935e-02   -5.788769127052472e-05   +3.687231553855193e-02   +1.579672204195579e-02   +3.403766656631664e-02   +3.738497390794168e-02   +5.447917441298519e-02   +1.389940241453490e-02   -2.666548599897860e-02   -4.080630487841976e-02   -5.644651967691954e-02; -3.691512458049116e-02   -4.136058987005686e-02   -4.824384222536855e-02   +5.765077790163793e-02   -2.869474209769845e-02   -4.195604046692772e-02   +5.780662208571567e-02   +3.948593054480115e-04   -2.731526675967439e-02   +2.313109819414527e-02   +2.975659636652749e-02   +2.773710403061392e-03   +1.022573083424558e-03   +2.143848313089100e-02   +6.748266873852664e-02   -2.398238291771308e-02; +3.054822323868819e-02   -8.414008469469067e-02   -2.901067805460239e-02   +5.405489426953692e-03   -4.827062004431051e-03   -5.918997047979178e-02   +3.666815420934333e-03   -9.621397752842880e-03   +8.307024038066729e-02   -5.967569017607494e-02   -1.351979597312924e-02   +2.295556141234749e-02   +2.487065861137353e-02   +6.267680831799929e-02   +5.172073115771288e-02   +2.863752471331788e-03; +4.108989475047552e-02   +1.114746805008603e-02   +1.308868999278899e-02   -4.035989744274581e-02   +3.281152478061897e-02   -6.545215586046313e-02   +1.750916504658466e-05   +5.148744425031587e-03   +1.172645791466267e-03   +4.483719910130335e-02   -3.331209160787724e-02   -3.986047204494856e-02   -4.116763060346854e-02   -2.422172068042418e-02   +1.653799497206022e-02   +6.448325453739245e-03; -1.265242824499239e-02   +6.199824907981023e-03   +2.173963098146401e-03   +5.736336929013050e-03   +5.878347047365684e-02   -7.465860515611892e-03   +1.448467967937583e-03   -1.978037255751276e-02   -1.418521817113091e-02   +3.230682792135931e-03   +5.551655656546133e-02   +4.647046892531298e-02   -4.532565434697755e-02   -4.146960433832082e-02   -6.901991788343770e-03   -4.097685339477966e-02; -3.963637799866609e-02   -7.546999868772195e-03   +1.493267901095788e-02   -7.826974085423342e-04   -5.307134762832510e-02   -3.308050418865453e-02   -2.699969909148809e-02   -4.995734338040536e-02   +3.091277110456843e-02   +2.999868185946243e-02   -3.744529554007886e-03   +2.396654334502073e-02   -7.419306567736290e-02   -3.201088952552708e-02   -1.058221472893410e-02   +1.487995578728921e-02];
L1E_L1I_iGABA_netcon = [-3.895824403540350e-02   -1.459591374024054e-02   -7.318337404553375e-02   +5.254106751276293e-02   -1.536933184154750e-02   -1.601282550370960e-03   -9.813749078402120e-02   +6.692435498485898e-02   +2.816768266884547e-02   -2.660468157021190e-02   +3.315976938524703e-02   -1.064582470985769e-03   -4.449152471728586e-02   -2.918744793593483e-03   -6.331883907522325e-02   -3.724251680098088e-02; +5.214062584092257e-02   -6.252657126314672e-03   -1.940471238090128e-02   +1.456803663551257e-02   +8.886144849892139e-02   -1.589807681891740e-02   -4.108323783810898e-02   -2.771791439458565e-02   +5.226093064163134e-02   -9.567595436887889e-03   -2.880098785203939e-02   +3.849923023359410e-02   +3.563267749514967e-02   +2.945608722478138e-02   +6.456375874539616e-03   +8.930421182512215e-04; -3.246798498858217e-03   -9.747084420799036e-03   +5.023817549224160e-03   -4.906118997456922e-03   +1.246440896211216e-02   -2.307658559202013e-03   -1.049493247058614e-01   -8.051601411138854e-04   -1.419794696860719e-02   -9.711418854768525e-02   +1.556088651121338e-02   -1.161550421863366e-02   +3.753732916431635e-02   -3.392505719019198e-02   +8.633560795623833e-02   +1.008447782128213e-02; -2.672418780823189e-02   +7.116750118380966e-03   +2.980591151305757e-03   -7.321178261706283e-03   +2.715398673842864e-02   +1.907189699080245e-02   -9.596432403408498e-03   +2.707659228229127e-02   -2.151284129495310e-02   +6.253410755743444e-02   +2.922188979697467e-02   +4.843333913588592e-02   -7.964833242079052e-02   -2.494617340264308e-02   +5.844071283802482e-02   -3.336268998134014e-02; -4.263316376031074e-02   -2.466856834417283e-02   +1.366674001715417e-02   +3.217154680336762e-02   -2.298909495130651e-02   -3.104414175250944e-02   +8.491044908923380e-02   +5.582594534543574e-02   +3.493290958084424e-02   +2.642646931338810e-02   +1.441504808612513e-02   -2.943848557556119e-02   +2.290215179233527e-02   +1.149155233862681e-02   -1.277633587408350e-02   +3.055839445631319e-02; -3.095267826720803e-03   +1.763455548746482e-02   +4.282261467299128e-02   -3.383144454084124e-02   -1.706801414376224e-02   -1.413822379680247e-03   +2.783881833829844e-02   +8.028997915282717e-03   -7.962566222218734e-03   +6.414766228821599e-03   -1.713012092127120e-02   -6.643987245364360e-03   +2.119478826907511e-02   +5.859897439641421e-02   -3.263765991037876e-02   -5.261067431390142e-02; -2.116927780895464e-02   -1.014073900053919e-02   -6.219724479608221e-02   -3.354929919533976e-02   -8.043464814903968e-02   +1.252161013522418e-01   -1.482422872892023e-02   +8.607748136269709e-02   -1.369245230051388e-02   +6.315159925698217e-02   +7.190480004123465e-02   -8.300615641706865e-03   +7.666576944297303e-03   -8.602960408697284e-02   -1.442598321241093e-02   +6.695384598641481e-02; -8.770551186270591e-03   +3.115149680547241e-03   -4.981866628748548e-02   +6.734037219071703e-03   -3.789556801275912e-04   -3.524566276376420e-02   -3.382834679445332e-02   +7.905994778134150e-02   -3.877334099716494e-02   +2.985950225477195e-02   +2.536558120042304e-02   -5.671807979481877e-03   -2.721102265134762e-02   -1.393035742271397e-02   +3.747031769164397e-03   +6.516114271676959e-02; -5.244391993014438e-02   -5.207103731386480e-02   +3.840651704200052e-02   +6.173525546196854e-02   +2.528653934640109e-02   -3.976260224926913e-02   +3.124353722142879e-02   -2.848525537205798e-02   -8.262652045058703e-02   -5.208338304583832e-02   -2.246077520664046e-02   -4.652835637674772e-03   +3.008977944227194e-03   +1.514340249717454e-02   +2.644476230908758e-02   +2.375171049585672e-02; -2.055428074678653e-02   -2.209202670303414e-02   -2.940539333918444e-02   +1.008523233562843e-01   -4.803868629194417e-02   +1.153567188543854e-01   -5.641035735815915e-02   +2.081666969122655e-02   -1.158098548135775e-02   -5.884825305301523e-02   -9.173457960225018e-02   -4.628812325056442e-02   +2.820603560608168e-02   +2.294231702144340e-02   +2.667246196353908e-02   -2.125144172852020e-03; +3.061359288615361e-02   -3.670488902219463e-02   +3.201025103040181e-02   -7.930792114122993e-02   -3.247954464792556e-02   -4.970908852370313e-02   +4.073097019122418e-03   -3.112271166145769e-02   +6.707072751179526e-03   +2.419277163367305e-02   +1.821990778935016e-02   -5.472638680833526e-02   -1.302404869091455e-02   +5.037662148215803e-03   -2.983207222620199e-02   -4.703819045505974e-03; -4.045353193627264e-02   +4.813951573535642e-02   -3.546301813595166e-02   -5.325091279031381e-02   +1.730218274359961e-02   -5.703302842950537e-02   +9.029692508655436e-04   -8.183975185424613e-03   +7.337329736247216e-03   +1.526311137215598e-02   -4.186081438235696e-02   -3.348434168273395e-02   +3.982942432507587e-02   -4.024455493751786e-02   -1.206001784944211e-02   -1.921073863624235e-02; +8.754747447934035e-02   +2.296603069077520e-02   +1.644647184267122e-02   +1.519995654700408e-02   +2.435384551958828e-02   +2.292412563459810e-02   +1.068936903366889e-02   -2.600655512267653e-02   -2.736924684167540e-02   +9.029157671145569e-03   -7.600532181656029e-04   +2.395735605049142e-02   -6.018958927435342e-03   -1.283488384813792e-02   -5.616002689526930e-02   +1.648828529477428e-02; -3.974891553439814e-03   -5.449835638743655e-02   +1.687324120851087e-02   +2.073988886002603e-02   -3.992349384343152e-02   +2.398555839048359e-02   +3.409404850444368e-02   -5.460113250271014e-02   +9.377840852206948e-02   +5.626859194686373e-02   -6.884686828530040e-02   +2.535278377685465e-02   +3.610725770088964e-02   +1.631042111551366e-02   +1.038308106949109e-02   +4.007835704223341e-02; -6.600659310103438e-02   -6.680186623726455e-03   -3.530818544188888e-02   +2.731825299790387e-02   -2.709214356065491e-03   +2.840278434208186e-02   -1.097887031965722e-02   -1.476959611597346e-03   +1.130221875797285e-01   +7.282526400631241e-02   +5.479730182382613e-02   -2.969759656507193e-03   +1.963210003732144e-02   -1.534653953561399e-02   +9.449706443464359e-03   -1.017036625095044e-01; +4.676288529113024e-02   +6.960526012734829e-02   +4.094831196779737e-02   +1.024197243266300e-02   +3.802921338437662e-02   -7.220950362492069e-02   -3.344593034186038e-02   +2.516270500243193e-02   -5.565355609130396e-02   +7.544564827333064e-03   -1.765502644829937e-02   -3.285285717884067e-02   +1.234748237299680e-02   +5.522015249311076e-02   +1.796821777072159e-02   -1.059375221070467e-02];
L2I_L1I_iGABA_netcon = [-4.973294368768877e-02   -5.134844100720511e-03   +3.297024758865640e-02   +3.848389455881731e-03   -8.441437250532592e-02   +2.477466460963390e-02   +2.552698712464808e-02   -2.057194054970171e-02; -5.719291874221009e-02   +1.569472588931662e-02   -4.906759406945687e-02   +4.620342720453981e-02   +1.595321229193102e-02   -2.534708221227161e-02   -1.837199947847674e-02   +4.168929111899395e-02; -1.197284633925360e-03   -3.023007827076492e-02   -1.019964914870622e-01   -2.287126390389954e-02   +3.722677403221783e-02   -2.498968629060462e-02   -2.065363726954297e-02   -8.299017939200412e-02; -3.967845575458773e-02   +7.799762463789983e-02   -9.145638547924578e-02   +8.066728953222359e-02   +6.813830786865460e-02   +1.204099262390635e-02   +1.418115340445811e-02   +3.299808608944662e-03; -2.253748882808239e-02   +3.640234849613419e-02   -1.445062515480167e-02   -2.684661847407510e-03   -4.336148670266070e-03   -6.326078810548678e-02   +1.644791358760540e-02   +1.869082563142145e-02; +1.713783743082575e-02   +1.035200470780068e-01   +2.327892529212873e-02   -1.136919533698083e-02   +1.287347154084357e-02   +1.637659912783801e-03   -5.860827811242422e-02   +3.703471656301216e-02; -1.073397980653581e-02   +5.060619723770517e-02   +1.765176700386806e-02   +1.073798723459527e-02   +2.887978628967047e-02   +5.910387566257261e-02   +3.329465246779771e-02   +1.651874777432397e-02; -4.316241620782671e-02   -4.360556066005631e-02   -1.615375506595213e-02   -2.207576533206645e-02   +3.297861685532174e-02   +1.952000884577235e-02   -2.749801456826803e-02   +1.263938857118149e-02; -2.547495431562620e-02   -4.181001975791956e-02   +2.243156702026736e-02   +1.683165337211500e-03   -3.724832335487407e-02   +2.061314842822655e-02   +8.153254698672047e-02   +1.213494925267219e-02; -3.351129893714978e-02   +1.598384146504941e-02   +1.122340628219676e-02   -1.958892240755150e-02   +1.312363308589323e-02   -3.318638451697729e-03   -5.262152736725671e-03   -5.189454714705629e-02; -1.982799649265754e-02   +2.225011913639222e-02   +3.356076723254878e-02   +4.544167613498830e-02   -3.010689977353325e-02   -5.659136150418947e-02   +4.625461636864164e-02   +2.349615931938571e-02; -5.101066209133190e-02   -1.364619580157143e-02   -2.873522190575487e-02   +3.555188941264200e-02   -4.970030173652485e-02   +9.299470394876386e-03   -2.110631237754653e-02   +2.740925209882905e-02; +1.117079870981907e-02   +9.095925598192942e-02   +2.313784877499625e-02   -4.503193830264995e-02   +4.164864221920014e-03   +6.516205573182475e-02   +2.708814262236853e-02   +1.866096876349948e-02; +3.697540207448843e-02   -3.119060418209463e-02   -2.187397073805236e-02   +3.890914643339076e-02   +2.083903948428546e-02   +1.280094830486278e-02   -1.693845846449781e-02   -6.365185561239830e-03; -2.757183438100858e-03   -7.438358485589741e-03   -1.025448684824522e-02   -1.742269408683409e-02   +2.679023750064793e-02   +1.344401243627347e-02   -7.205413026542717e-02   -5.882707080594584e-04; -3.833988901467372e-02   -3.077394205849245e-02   -3.429250580910667e-03   -2.783164974032682e-02   -2.116635023003280e-02   -2.302897151361021e-02   -5.983566318779528e-03   +5.724956950007775e-04];
L1I_L2I_iGABA_netcon = [-5.652211195510464e-02   +7.460565919785783e-03   +1.480406049116678e-02   -7.303483527090707e-03   -1.023512816348688e-01   +4.792345492839238e-02   +3.032458722995519e-02   -5.987488450655484e-03   +6.347710395412091e-02   +6.340334124446519e-03   +1.149670674217711e-03   +4.433037662653377e-02   -1.126476572405804e-02   -6.475128773989919e-03   -4.605305597529608e-02   -8.393088201561120e-03; -2.987432613844002e-02   +2.865149230981030e-02   +5.908634951032266e-02   +4.060557478457669e-02   -5.872895791940060e-02   -2.368344016613504e-02   -8.060013182741195e-02   +4.177231602750135e-02   +3.910264344880782e-03   +4.883169170029281e-02   -3.612335908002760e-02   -1.015690545028926e-01   +5.544400969397267e-02   -8.563222636574622e-03   -6.463824413401032e-03   +2.004417407042367e-02; -3.484695439848295e-02   -4.132413448944187e-02   -8.329415011471109e-02   -2.861627473423940e-02   +4.231022667103206e-02   +5.794636488671939e-02   -2.975351648338626e-02   -2.619104945283297e-02   +3.331116569331963e-02   -2.562130300428930e-02   -1.090787718591219e-02   +5.825877328496502e-02   -1.985777149576351e-02   +9.063891257342876e-02   -5.634722366528037e-02   +5.924399585822895e-03; +4.353416571585621e-03   +7.521228931286778e-03   +5.170819798726462e-02   +4.471952111465863e-02   -4.249896676859945e-02   -1.877108589589298e-02   -4.789111344920845e-02   -6.244479461197163e-03   -6.914458138048148e-02   -3.286353482698855e-03   -1.730837964372545e-02   +6.128922837311910e-02   -2.756888410047616e-02   -3.404073169847448e-02   +1.926787028270841e-02   -5.642260708185955e-02; -5.547661285213599e-03   -6.694740113036506e-02   +4.174625003531612e-02   -4.532093831088990e-02   +4.644698503939091e-02   +6.239156425935547e-02   +7.506443049817520e-02   -4.330019574706707e-02   +6.829731252691260e-02   -3.700996358288817e-03   -5.991641267346324e-03   -4.121943140230790e-02   -5.232091113153897e-02   +6.816507944896298e-02   -2.764016566250074e-02   +2.596171315473433e-02; +3.506538234200149e-03   +3.722172303440253e-02   -2.321452348044881e-02   +2.211430349113618e-02   -5.713842638649785e-02   +3.016287694656129e-02   -7.342464833513526e-03   +4.578273270914631e-02   +8.273669250820549e-03   -9.969516989020684e-04   -1.440421655767630e-02   +1.575529397051829e-02   +4.937861872925885e-02   +2.767290962598432e-02   -9.769331529159686e-03   -7.424403230745855e-02; -7.831389969111119e-03   -1.219726731300478e-02   +7.993381137185389e-02   -1.955416805056629e-02   +6.781350604549846e-02   +6.684970807487273e-02   +5.155772519729232e-02   +5.766040666959815e-02   +1.051075793244326e-02   -1.520806289637275e-01   -4.872913228347528e-04   +1.280273463204846e-02   +5.494131702830068e-02   -4.673015082171401e-03   -4.984230550540075e-03   +4.319038002189588e-02; +7.332326581183130e-02   -9.416403726229444e-02   +9.497852372580979e-03   +1.148001602124320e-02   -4.599459971852526e-02   -6.229491486750224e-02   -6.485494074415881e-03   +2.099431830236331e-02   +4.605004932125878e-02   +2.675774367347590e-03   -1.085607684527958e-02   -7.007365480238149e-03   -4.379514470467637e-02   +3.299651051266074e-02   -2.664317631754016e-02   -8.999582948537352e-02];
L2E_L1E_iAMPA_netcon = [-6.189573202921621e-02   +2.626996236180220e-02   +1.923352774563081e-02   -5.770923294816216e-03   -3.419616704170901e-02   -7.934021994987654e-02   +6.415954139794816e-03   +5.637377823883185e-03; +1.689016329893569e-02   -5.779847053684270e-04   +2.097653302225501e-02   -2.606734297063253e-02   +8.634153436659218e-03   +2.291796307760652e-03   +7.357420133038715e-03   -2.237090162829952e-02; +1.000690525563711e-02   -8.742309467187037e-02   -5.458259985965421e-02   -3.860331994865675e-02   +3.705598087387068e-02   +2.285071250374009e-02   +5.844909893497350e-02   +1.985312226643299e-02; -2.545772942597280e-03   +9.785741702090719e-05   +2.536493756746967e-02   +3.629196633588724e-02   +1.865403341337259e-02   +1.718064944378901e-02   +5.420889488962446e-02   +2.499981833297930e-02; +1.821935628673263e-02   +3.066226606142631e-02   -3.187555608803926e-02   +1.354249973068842e-02   -6.238016872179760e-02   -3.985458866144870e-02   -3.069276644352671e-02   +1.080407307407808e-02; +9.934257552122951e-02   -5.440229774616509e-02   -9.234994623093077e-03   +3.589607751573270e-02   -8.115230906384002e-02   +1.993197975889827e-02   -4.005414889554989e-02   +7.405413671565281e-02; -1.719923342062551e-02   -1.712340346294494e-02   -2.285407194170348e-02   +1.352246185159730e-02   -3.315981232822852e-02   +2.188695083429792e-02   +3.917667663168803e-03   +4.107957771528115e-02; +2.553839775821645e-02   -1.929524067381783e-03   -2.250325511910697e-02   +3.649415877534673e-02   -1.780721544246264e-02   -1.568570223219291e-02   -5.327488917297107e-02   +6.534549289076827e-02; +4.952464937503409e-03   -8.634985507095815e-03   +7.646663755408541e-03   +3.811032517403866e-02   -1.087452246655662e-02   -2.403615276073893e-02   +5.708129641750043e-02   -6.515735552566670e-02; +3.280167890672694e-02   -1.747786126214308e-02   +1.079962218855652e-02   -1.650281584235357e-02   -3.778309878964164e-02   -1.975855950253736e-02   -2.260618006009782e-02   -4.232312317946454e-02; -2.936327835169157e-02   +3.157988848959763e-02   +1.205481103498432e-02   -6.947269810433383e-02   +3.972031753875223e-02   +1.324167676196998e-02   +1.620313609215395e-02   +5.498110399962440e-03; +2.101856655458494e-02   -3.009826634356492e-02   -8.808442874698034e-03   -7.714646477138780e-02   -4.077870275820008e-02   -4.104631195501570e-02   -8.758893065031735e-02   -3.387542637812609e-02; +4.393756784159461e-03   +6.095725799714919e-03   +5.075253372535944e-02   -7.410294764991519e-03   -2.842975462019608e-04   -2.207208112973863e-02   -2.819011768396156e-02   -9.663830407634865e-03; -4.215813742262572e-02   +2.679222588869175e-02   +5.485803488427646e-03   -1.758003848291577e-02   -2.821541842252422e-02   +1.914848201524534e-02   +1.689527412537372e-02   -1.258047752832731e-02; +8.637468154423442e-03   +2.024722086881930e-02   +9.262290890526437e-02   +2.672815632973823e-02   +1.542617400567948e-03   -5.937299722997980e-02   +2.927654184789992e-02   +2.451336144350650e-02; -7.243272180289542e-02   +3.768597277115522e-02   -2.671730312942557e-02   -9.934654924775698e-04   +1.837295491985801e-02   -5.099078558115635e-03   -5.789628073761491e-03   -4.330298504986651e-02];
L1E_L2E_iAMPA_netcon = [-4.062980243345875e-04   +2.072577235519669e-02   +1.437982262256175e-02   -1.714712283545588e-02   -1.409618526825872e-02   +3.154596143927654e-02   +1.327138141417654e-02   +6.851594504377728e-02   -4.540096299306140e-02   -4.319162159541897e-03   +4.847395841965003e-02   -4.693710846044002e-02   -7.043393953693499e-03   -6.392830081414794e-02   +4.724778002866442e-02   +1.304758758281396e-02; +3.635476420248481e-02   -5.247213673757004e-02   -1.987462290320142e-02   +8.095471902223962e-02   +3.023862564105538e-02   -8.823899868445707e-03   +2.077415884530068e-02   +9.554762119299188e-03   +4.889165794235736e-02   -1.950051201169148e-02   -7.051580298713603e-03   -3.432325903954759e-02   +9.196658036578008e-03   +4.546795331408672e-03   -4.139288051773772e-02   -5.095165231844181e-02; -1.612900722237822e-02   +5.349708901337312e-02   +3.622694596971755e-02   -1.020038778616181e-02   +1.352184503231118e-02   +7.782337288802064e-03   +2.999553455368058e-03   -8.876293409264623e-03   -2.519715058689011e-02   -4.062865268040074e-02   +3.020866280050443e-02   -6.716442103403464e-02   -3.947450722935460e-02   +4.758695324947872e-02   +8.421226226451764e-03   +2.258805119636723e-04; -1.868559069397587e-02   -4.441843295457059e-03   -1.338019205273694e-02   +5.019187471487629e-02   -2.114330906086019e-02   -7.775082691666805e-03   -6.629410201957738e-02   +6.554782318004524e-03   +1.626803898931794e-02   -3.378432359902368e-02   +3.081473869985659e-02   +2.293930862319325e-02   -5.947849666001041e-03   +4.416083016207399e-02   -1.839021074561197e-02   +2.146088726298825e-02; +2.577445058618691e-02   -3.203125063875883e-02   +1.306489232477304e-02   -4.714555340273540e-02   +2.366829974557575e-02   +1.946668651158296e-02   -4.682338575177162e-03   -2.650500670756648e-02   +6.358562387050475e-03   -2.304368226230500e-02   +1.174707198451119e-02   -1.494999833442504e-02   -3.242878055618801e-02   +1.375424608372596e-02   +5.551970965783508e-02   +4.933832299042673e-02; +3.958984486227217e-02   -1.712655628289910e-03   -1.309019337773381e-02   +5.008585096889170e-02   -5.190792242911451e-03   +3.837286101434542e-02   +7.175541950610594e-03   +3.522214804594651e-02   -9.719586480495850e-02   +1.485624057511168e-02   -4.075160675679531e-03   +9.415288798946095e-02   +1.371643977706037e-02   +5.434129509687755e-02   +6.901332695105089e-02   +3.329064840627707e-02; -3.302915860783043e-02   +9.203582511834643e-02   +1.925293501007980e-02   -1.966803131538631e-02   -4.405947264806714e-02   -3.190354974091903e-02   -2.170007151263646e-02   +1.124062037133860e-02   +1.697016276188376e-02   -7.220712752972393e-04   +3.937463850736568e-02   +1.406962208176901e-02   +2.709573501671378e-02   +4.876440035822914e-02   +7.438514419366517e-03   -6.226773086243436e-02; -9.771053321440249e-03   +4.423266897610052e-02   +1.825144760077855e-02   +3.931115252359542e-02   +6.694939469956966e-02   +5.231415606811185e-02   +2.926485366894175e-02   -1.323244409557983e-02   -1.334324071034745e-02   +2.144422877418718e-02   +8.739230791158497e-03   -1.188171006612222e-02   +4.846175499986446e-02   -6.836615667843542e-03   -3.403831890744164e-02   +4.239966051893233e-02];
L2I_L2E_iAMPA_netcon = [+1.678222381424413e-02   -7.398903871546746e-02   +5.503954671012588e-03   -1.921974174605089e-02   +7.242747699592469e-02   +4.303549403027575e-03   -1.241272009622444e-02   -1.084120630950901e-02; -6.176859039068926e-02   -3.374124357536747e-02   -8.661996179622655e-02   +1.074636525068190e-01   +1.374320739588240e-03   -1.260800881050989e-02   -2.568260484684220e-02   +6.418658715039280e-02; -1.538350108673764e-02   +7.795420238583720e-03   -1.722091409201459e-02   +2.980106037830587e-02   -3.071868779113510e-02   +3.823596341119680e-02   +4.133364924443526e-02   -6.776613431641644e-02; +2.959053600274020e-02   -2.622673573754797e-02   +1.462641498615149e-02   +1.376638278655938e-02   -9.952565693481639e-02   +7.051494766225073e-02   -5.463333679609798e-02   +9.713630509759895e-03; +2.353465583068867e-02   +3.018380564715678e-02   -1.062311236569981e-02   +3.386534677740573e-02   -2.187743423162384e-03   +6.008669423763931e-02   +5.691356233855210e-02   +4.466179065726050e-02; -3.353577430134411e-02   -1.247815781530199e-02   -3.693453765476445e-02   +1.288313818450595e-02   +5.548084288297528e-03   -6.734037966337933e-02   -9.243759503615025e-02   +2.835635994369124e-02; +1.996177693693415e-02   -2.933311748773765e-02   +2.061795624707249e-02   +5.810568242969069e-03   -6.728457886990269e-02   +3.724514491306606e-03   -5.171253152476844e-03   -1.910688641080599e-02; -6.118646274318183e-02   -6.417989734508522e-03   +5.809468195607235e-02   -2.464491185020328e-02   +5.886301656406576e-02   +3.158634360910587e-02   -2.913087993689653e-02   +9.613108245620679e-03];
L2E_L2I_iGABA_netcon = [+3.102241350727560e-02   -1.400970793819840e-03   +1.812085377081657e-02   +1.189366128206269e-02   +4.684462390829251e-02   -5.806745033150310e-02   +3.548828362427239e-02   +4.990803911280114e-02; -7.640189472750449e-03   -7.467217850485406e-03   +5.844105135669792e-02   +2.591736766546831e-02   -2.861117499281361e-02   -2.543100474549885e-02   -3.162955077734657e-02   -2.038643101815603e-02; -5.773654814457024e-02   +6.383005165243803e-02   -4.237011461882308e-02   +6.936486643929592e-02   +1.385898277432249e-02   -3.879365024841099e-02   +1.172947328977466e-02   -3.672294264201334e-02; +2.470122281148251e-02   -1.538785973614261e-02   +5.270814992869841e-02   -5.143716609778189e-02   +3.158884630892588e-03   -1.413442216861113e-02   +9.036417650293992e-02   -8.413587657166453e-03; -3.227574890348114e-02   -1.165132270475049e-02   -2.515868616874242e-02   -2.480800637719795e-02   +1.155813495112648e-02   -3.339638369983054e-02   -6.707266734149463e-03   -3.102842229763435e-02; -5.675261141571119e-03   -5.453348757609087e-02   +3.127605333393207e-02   +3.390091188352116e-02   -3.562896111842824e-02   +4.665134243910959e-02   +2.549798648856027e-02   +5.309959236878744e-03; -1.255605569887989e-02   -1.359322687150364e-02   +2.422015771151799e-02   +6.049458568004595e-02   +4.109876801046156e-02   -1.208926278128382e-02   +3.194246304807614e-02   +3.049096450402055e-02; -4.634063919621469e-02   +4.519216012063342e-02   -4.133081297798223e-02   -3.101293385221325e-03   +2.249149493863803e-03   +5.089524700029591e-02   +9.736961645034459e-03   -7.315722515854984e-03];
L3E_L2E_iAMPA_netcon = [-3.628174890656700e-02   +1.850302216820012e-02   -3.411458422047404e-02   -4.766920481166784e-02   -6.234862878180704e-03   -4.164398233562891e-02   -6.216650878809447e-02   +1.603786906366825e-02   -1.751616520774122e-02   +1.371509627778950e-02   +4.175259290263559e-03   -6.994375858534645e-03; -6.353867242384656e-02   -1.548565023547586e-02   -1.669758858483176e-02   -5.334940581522175e-03   +6.268725547533217e-02   -5.003032463741578e-02   -3.260705231448918e-02   -3.417769753631079e-02   +5.322918495813597e-02   -1.754694937463191e-02   -2.005720906528546e-02   -7.131913759374467e-03; -2.539503234100946e-02   -5.217890644183534e-02   -8.389184930373528e-02   -2.240534093468757e-02   +1.437599443962838e-02   +4.922088180023276e-02   +3.092104051716364e-02   -5.985772106311309e-02   -8.152259162575660e-03   +8.919407839625047e-03   -2.819700695871945e-02   +3.963705920655902e-02; -2.354610202342155e-02   -2.640383229562146e-02   +2.312813443142364e-02   +1.630876219095290e-02   -1.717388895999648e-02   +9.278921245915700e-03   +1.528629671876819e-02   +5.770891377844522e-02   +5.792765984236994e-02   +3.820650134927989e-02   -2.744937938630142e-03   -9.908584729764540e-03; +5.300078807696622e-02   +4.332349974728879e-02   -3.871929825642700e-02   +1.443216140272495e-02   -3.776401523389561e-02   -2.870777502599570e-02   +3.311918911084946e-02   -3.898686815589022e-02   +1.784192268698796e-03   +2.002696392951667e-02   -1.860320681811320e-02   -3.810462551634324e-02; -3.559665291360407e-02   +4.341797342704672e-02   -6.600304017544956e-03   +2.645655138851863e-02   -1.424659394181458e-02   +4.614280148152465e-02   -2.595855531598790e-02   -4.024816146683857e-03   +2.334162059367332e-02   +6.844816189279415e-02   +2.435201634291990e-02   -1.433988327351846e-02; -2.796975556751752e-02   -3.190464250772669e-02   -6.052278136909533e-02   -1.153737013285181e-02   -1.401692578998817e-02   -1.863921867743950e-02   -3.674084752739355e-02   +1.319203953396061e-02   +8.384649905641840e-03   +5.437840530771589e-03   -3.039619758548307e-02   +4.204339684716107e-02; -3.593367613472616e-02   +1.291921329861498e-02   -2.589614868766115e-02   +5.344146826699817e-02   +1.720456241531034e-02   -2.761246305037926e-02   -1.620993709269981e-02   +7.685882341058711e-02   +2.025707759166951e-02   -3.682404550974567e-02   +6.971183329861110e-04   -5.299369014915212e-02];
L3I_L2I_iGABA_netcon = [+3.348557669654322e-03   +1.629414433060967e-03   +1.003666425442131e-01   +2.359159177545946e-02   -6.104986847386966e-02   +2.298474810906224e-02   +1.441876065304609e-02   -1.526825630934225e-02   -5.217148083869906e-02   -4.209545301788609e-02   -4.301685686094071e-02   -3.206386222622945e-02; -1.334005480851581e-03   +4.834298052242159e-02   +4.231346952622004e-02   -1.855268885136982e-02   -3.473824517201203e-02   +1.579824187207682e-02   -2.042748613123823e-02   -3.368937856793025e-02   +1.462545502449168e-02   -2.664314053785422e-03   +2.182406312115207e-02   -1.388310084742041e-02; -2.481642552232185e-03   -1.148365439231013e-01   +5.427347513779207e-02   +4.935273197594694e-02   -2.202662826301112e-02   +2.523200141695636e-02   +1.379266756419199e-02   -5.277662250944750e-03   +5.757401947378695e-03   -1.581480438852921e-02   +3.137870756725581e-03   -2.863808508682303e-02; -3.125506382423590e-02   -1.607012557551278e-02   -1.034355706858832e-02   -2.903521187564114e-02   +3.790617935657703e-02   -2.251517698878856e-02   -1.074917799641426e-02   +2.936010189559021e-02   -8.116637545690378e-03   -3.705229519975491e-02   +1.625676655935275e-02   -2.010266572148388e-02; +8.288664707278538e-02   +4.002714759124223e-02   +9.241636257709872e-03   -2.896416519799493e-03   -2.288477970868162e-02   +7.344496609375427e-02   -3.444770268938559e-03   -3.353596888597930e-02   -2.201461331013811e-02   -3.491708618930497e-02   +2.517660055556065e-02   +4.251862352739481e-02; +3.739965318628091e-03   -3.142850036608213e-02   -4.017868512318735e-02   +2.594628844360076e-02   +9.318047846184650e-03   -4.716657511685882e-02   +1.100376102008785e-02   +5.784074170585864e-02   -8.902925973762649e-02   -1.157699389089245e-03   -3.255282972090239e-02   +9.990422069447264e-03; -2.046879483812826e-02   +1.731676395647362e-02   -3.533957574958640e-03   +3.607814309203380e-02   -2.587737754875532e-02   -3.492351125393468e-03   -1.339439659592694e-02   -2.705366327511547e-02   -4.380732814562631e-03   -3.743042868379037e-02   +2.238466913091239e-02   -1.193598617493382e-02; -4.600530214300393e-02   -1.337981867468852e-03   -4.638972377386166e-03   -1.597172627073404e-02   +1.624176119227189e-02   +3.133760179168613e-02   +4.253342964777226e-02   -2.357061729136170e-02   -5.833152910079917e-02   -1.794532951071040e-02   +5.909861766382668e-02   -3.497929776291596e-02];
L2E_L3E_iAMPA_netcon = [+2.504044022201628e-02   -3.704523837478976e-02   -5.309580752864320e-02   -4.925836831635044e-02   -3.003797178772939e-02   +2.590175097041301e-02   -2.939645638306713e-02   -4.772400538929272e-03; +7.519099847391221e-02   -2.171115038793527e-02   +3.739307373758187e-02   +5.778263316948536e-03   +8.834032999472073e-03   -2.686199755758699e-02   -3.521991084443699e-02   +7.579802035645285e-02; -3.357846432818394e-02   +5.593705830402671e-02   +3.710410492898041e-02   +5.333983254750152e-03   +4.807587081866458e-02   -2.773754321972713e-02   -8.269628567051176e-03   +3.018364368532154e-02; +7.158046210616388e-02   +4.590758109072459e-02   -4.307658283985088e-03   +4.060616987843975e-02   +5.733165791067117e-02   -4.015840235786035e-02   -1.132335458535778e-02   -1.493563385557939e-02; -5.574977881012468e-02   +1.913836550509499e-03   -3.428738913056407e-02   -4.268235777889225e-02   +2.848723828213865e-03   +5.030131533926918e-03   -8.671518391453441e-02   +2.744547387050934e-02; +5.910209475749124e-02   -6.569703028870813e-02   +1.714174435593756e-02   +4.242994400913630e-02   +3.046573780627524e-03   -2.783435233830497e-02   -4.337018163491447e-02   +3.006362054236146e-02; +4.634132390215387e-02   -2.178730012934025e-02   +5.949466911559907e-02   +4.529031088918575e-02   -2.634944439021070e-03   +2.414980200906938e-02   -2.978107111959494e-02   +6.375435252222963e-03; -2.466058166030937e-02   -1.797179414532326e-02   +4.095900378417368e-02   -1.602107793661195e-02   +8.445168090974063e-02   -2.059229121154498e-02   -2.337469808717660e-02   +9.117624693486122e-03; +2.132605270561290e-03   -6.074628011231017e-02   -3.445795194726094e-02   -3.082379600948064e-03   +3.989391904370973e-02   +3.837188269756312e-02   +8.820151966001093e-03   -4.645827541783880e-03; -2.673916144363096e-03   -4.469277665331416e-02   -2.561016982574601e-03   +3.198802151089462e-02   -5.190282640868471e-02   -2.352810907817370e-02   -4.300841466894766e-02   +8.372614896906939e-02; -2.279687168613315e-02   +2.500089380980768e-02   -2.385500414661320e-02   +2.218601064871154e-02   +2.972328435016816e-02   +1.450463611298366e-02   -5.385982851981283e-02   -5.009388033068254e-02; -3.566493986636096e-02   +6.636374335945711e-02   -2.134878733075773e-02   +3.853270601645369e-02   -2.758110981445699e-02   -3.900575492561809e-02   +4.210934945985899e-02   -6.947687846598558e-02];
L2I_L3I_iGABA_netcon = [-4.397795474887686e-02   +1.545895557488738e-02   +1.717833638401336e-02   -1.429274821896819e-02   -2.357917432469234e-02   +2.185129027841881e-02   +4.050753849562686e-02   +4.304050282001952e-02; +4.880876282877490e-03   -1.514399309476241e-02   -6.334718011855327e-03   -2.001139185529154e-02   -4.053986027373065e-02   +2.080012506494457e-02   +2.987882849188547e-02   -1.721740489785850e-02; +5.106703186538761e-02   -5.900651244457995e-03   -6.871753851505720e-02   -2.779400051870584e-02   -2.609313508953820e-02   +2.852227086831636e-02   +6.263327017297527e-03   +4.128405547905879e-02; -4.905606868773910e-03   -2.283203113781011e-02   +1.410806995211599e-02   -1.963555504393549e-02   -2.034370025080713e-02   +2.344728472942846e-02   +4.491440821661599e-02   -6.734737824969568e-02; +3.479258399469135e-02   +5.253771548174882e-02   -5.692141313287565e-02   +2.882937448870748e-03   +1.234155685148954e-02   +5.049545857969505e-02   -2.760965606133476e-03   -9.395384975785129e-03; +1.320905711281274e-02   +2.375112758018884e-02   -2.196370617492156e-02   -1.634149234664400e-03   +6.768101561189406e-04   +6.566573474235164e-02   +1.003758474552069e-01   +4.941258072233846e-03; -5.304467047978798e-03   +2.333273659605066e-02   -9.427567265735688e-03   -8.310684641871565e-04   -9.224338198513336e-03   -3.012627106712662e-02   -4.285232962511955e-03   +8.013167395628403e-03; -1.734294185031147e-02   +1.021824438399135e-02   -5.004827622677493e-02   +2.084127457295227e-02   -2.108062935744583e-03   +5.622623980338512e-02   -1.025863129421659e-02   -6.361986135346813e-02; +1.701467565550530e-02   +5.199644537514926e-02   +2.296222116198710e-03   +5.363498547174906e-02   +2.245214513591995e-02   -4.210308029135513e-02   +6.168444085070761e-02   -2.926692358167926e-02; +1.825943716910033e-02   +4.257044288835211e-02   -5.072463975129803e-03   +2.804775202682678e-02   -9.828349306255053e-03   -4.999879286226971e-02   -4.930605857945369e-02   +1.645499327390479e-02; -7.522334634394716e-02   +7.616546200598705e-02   -2.745540765676479e-03   -4.973820460051525e-03   +8.190537034840284e-02   +9.014257029733970e-02   -5.445773845748002e-02   +4.391476092252009e-02; -9.562801500956540e-02   +5.025252350041379e-02   -2.034041938508283e-02   +9.952205951977211e-02   +6.436121834026817e-02   +1.862964659794727e-03   -3.373620468964098e-02   -2.282053938062846e-02];
L3I_L3E_iAMPA_netcon = [+4.134832835200086e-02   +1.516571889412858e-02   +1.578027022368876e-01   +1.747583480798988e-02   +5.377911352700629e-02   +5.030796756834220e-02   -7.358746954486742e-02   +3.419348532236443e-02   +1.121960371390765e-02   -6.968577191677615e-03   -4.166819401478958e-03   -4.660850155112925e-04; +1.324532394526992e-02   -3.875514222538071e-02   -1.146974574802518e-02   -9.902403532545265e-03   -1.646779892723917e-04   -8.553569576181588e-02   +3.655340443807302e-02   -1.455593136293207e-02   +9.001106759919501e-03   +4.425346918194580e-02   -3.486451085443186e-02   +3.531551905397911e-02; +5.494610083068029e-02   -8.623688852023970e-03   -6.325610237226505e-03   -9.116419984525375e-03   -4.131770549577356e-02   -2.480818115428004e-02   +5.009638445873316e-02   +3.467669176659956e-02   -8.937224278192719e-03   -4.574215764051899e-02   -1.297695156974499e-02   +3.480280739181144e-02; +4.038037539182427e-02   +1.395806527828199e-02   -5.881036907594149e-03   -3.770929680451122e-02   +1.718794784279048e-02   -9.286581879488364e-03   +5.213983808691186e-02   -4.230763681523841e-02   +5.409264698310254e-03   +3.487272770890346e-02   -6.351816102404359e-02   +2.080419933150230e-02; +2.156673095682697e-02   -9.883701956385346e-02   -6.160858479988844e-02   -3.469803863890130e-02   -1.306894009253091e-02   -3.596926327947346e-02   -6.168667411662368e-03   -5.536134415174561e-03   -1.131890808518740e-01   -6.887300643839910e-02   -5.666169886558264e-02   +3.506160939127593e-02; -2.732831076403961e-02   +2.428777548213197e-02   +5.614379648965314e-02   +1.286786093480729e-02   -4.314074284523370e-02   +7.677178642027151e-02   -1.592700374091839e-02   +4.105855363424466e-02   -4.634339989040057e-02   +4.128417853674160e-02   +5.006133959183258e-02   +1.567410501080679e-03; +7.875029742739051e-02   -3.935892426922454e-02   -2.947827868598510e-02   +2.591225063567076e-02   +1.044433781132810e-02   -3.598972111031549e-02   -4.462500541651364e-03   +3.978116060804002e-02   +9.094774157624341e-03   -4.763327526551907e-02   -2.168729548012202e-02   +3.101112933209155e-03; -4.784770115120424e-02   +2.181309445160499e-02   +5.687983205896998e-02   +7.889181172222043e-03   -1.000025403776931e-02   +3.272099532636297e-02   -8.768852350871034e-04   +6.491261788225727e-02   -2.747033587611023e-02   -5.445793305592002e-02   +2.420620464595643e-02   -2.098057020541978e-02; +1.378933649943328e-02   -4.547265972407653e-02   +6.319703829594438e-02   -4.206039633485167e-02   -3.093719833341950e-02   -2.904639151816156e-02   -3.124343186102426e-02   -5.440516964363047e-04   -5.167548545246307e-02   +5.209990401019408e-02   -5.277944493050427e-02   -3.355986968073240e-02; +2.870379089614390e-02   +7.540734855161918e-03   -5.089048116423633e-02   +3.708165822356257e-02   -6.866807727749845e-02   +2.833398124216790e-04   -3.177786671550428e-02   -1.453712940840355e-02   +1.419934346012014e-02   +6.258179320865008e-02   +2.572018006105365e-03   +4.503277640847663e-03; +4.451426980802074e-02   +5.185914319412205e-02   -4.205920593400654e-02   -1.133232061202317e-01   +4.772269223461083e-02   -3.117399577910585e-02   -4.768626664617085e-03   +1.922636504769848e-02   -1.071253100243714e-02   -5.772739434038660e-02   +3.119085888287484e-02   +5.875708341497235e-02; -2.398021221921687e-02   +9.776826892507670e-02   -4.412807633531684e-03   +5.902008508547474e-02   +7.295993332926885e-02   -3.643901960665030e-02   +1.106531786875420e-02   -3.868333528478531e-02   -6.160236710019119e-02   +9.548097535816859e-02   +2.329737535809845e-02   -3.020783921736155e-02];
L3E_L3I_iGABA_netcon = [+7.720721199683093e-03   +3.702284726399787e-02   -1.395465311914996e-02   +3.800107352554146e-03   +9.338966971460590e-03   -4.909120894203257e-02   +2.632377673829660e-03   -4.771858149867042e-02   +3.150056441327627e-02   +3.024627564438648e-03   -5.316309311865861e-03   -1.331309245745098e-02; +1.377265628125344e-02   +1.973662494153672e-02   +3.784180147776448e-02   +2.679411725241067e-02   +3.867049596454683e-02   -1.786193491957843e-02   -1.585158161401283e-02   +1.070709414157784e-02   -3.574191161043135e-02   +9.592162004847343e-03   +5.520076273894901e-02   -3.033715184804804e-02; -4.962227763617887e-02   -5.002529381150384e-03   +2.744387148793165e-02   -1.588797408727374e-03   -5.812504222878654e-03   -1.808592455215082e-02   +2.176169994881389e-02   -3.436901319892090e-02   -1.016413830084114e-02   -4.348719831230001e-02   +4.080958658693269e-02   -3.752211619524758e-02; +9.742599046247245e-03   -1.456868501830862e-03   -2.553988186436115e-02   +1.672953395881433e-02   +5.579444789172715e-02   +1.835239519970121e-02   +3.137820470228869e-02   +5.019578970349820e-02   +5.612469729142965e-02   +3.904018399199478e-02   -7.297106380803729e-02   -2.844481542011277e-02; +3.445193484824496e-02   -7.814655598724947e-02   +2.300232325892543e-02   +4.423447706847348e-02   +1.426303787125351e-02   +3.565227108967893e-03   +2.982260795341803e-02   -5.366261159749115e-02   +1.872470403043588e-02   +3.103713545915710e-02   +4.847383871413515e-02   +1.489931918487463e-02; +1.677189885439689e-02   +2.837073076802786e-02   +1.375018020260145e-02   -2.076076107800501e-02   +7.477287063416872e-02   -1.094560341289820e-02   -5.376723443859778e-02   +6.522866017089160e-03   -1.882071714826522e-02   +4.225641110654816e-02   -2.816650604784682e-02   -2.597349827337333e-02; -4.429041307667281e-02   +3.297602884599615e-02   +6.156069401133329e-02   -2.121769697384653e-02   +3.083707338386562e-02   -3.763923426692127e-02   +3.462019489612499e-02   -2.302894972339014e-02   +3.480728420646876e-02   +1.291502316773214e-01   -4.807008413599147e-02   -1.941709360261954e-02; -8.215612121479915e-02   +6.441843821552669e-02   -4.201619376383105e-02   -7.629228615792362e-02   -2.152511079563547e-02   -1.928353167990899e-02   -1.869510573755343e-02   +2.986362755067499e-03   +7.865501414459186e-03   +3.078609775397868e-02   -6.842971312402249e-02   -4.950090615433427e-03; -6.224127410593602e-03   +3.856847229857074e-02   +3.292673693173195e-02   +1.368293191323791e-04   -5.199347145796991e-02   -8.342392952870589e-02   -3.909583834175919e-02   -3.324207151278089e-02   +4.900030498939023e-02   +4.343892405025510e-02   +4.755944332194495e-02   -3.077934685005210e-02; +2.369075913829126e-02   -7.161890446889001e-02   -3.758320446893755e-03   -4.756575838165299e-02   +2.067007995652661e-02   -4.406386226959857e-02   +1.681074163114359e-02   -3.697418163427765e-02   +6.883645803417474e-03   +2.879553779118621e-02   -3.229227218276742e-02   -1.055207778935294e-02; +3.420905774566509e-02   +5.231173410197185e-02   -4.118513090304419e-02   +2.769014753330182e-02   +2.498207962910711e-02   +3.886271575032911e-02   +5.843981333632123e-02   -6.030559135992512e-03   +8.049764726031271e-03   -9.213695525983036e-03   -1.983185638751759e-02   +3.339059913636051e-02; -3.063274350749876e-02   -7.047017371581817e-03   +5.855135605318759e-02   +2.585282710296236e-02   +6.987189395249294e-02   -6.357852232623235e-02   -2.474902952246551e-02   +1.222730883230497e-02   -9.935686190880821e-03   +7.618682384258328e-02   -4.777005553101950e-02   -5.933911253892275e-02];
L2E_Input1_iAMPA_netcon = [-8.960125716869624e-03   +2.152979930325722e-03   -9.774577474316495e-03   -8.259506448927985e-02   -9.197984675035603e-04   -1.934588725743626e-02   +5.024029819923571e-03   +2.519950724530654e-02];
L2I_Input2_iAMPA_netcon = [-5.686808388696912e-02   +1.402399277778131e-02   -8.371612892598898e-03   -8.036715735112830e-02   +7.237653891074754e-02   +5.474363340212772e-02   +5.008187934582716e-03   -2.441354668501871e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
