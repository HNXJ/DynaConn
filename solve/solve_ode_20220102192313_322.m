function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.441834225269537e-01   +1.256391286132363e-01   +8.482611869064479e-01   +4.841660850155308e-01   +2.797181333613222e-01   +7.516758647810943e-01   -3.717637272520506e-01   +5.057388572422943e-01   +3.288258437050897e-01   +8.280539966305107e-01   +9.146638539424820e-02   -8.527188959323799e-02   +2.897140508827315e-01   +5.842378944890229e-01   -9.693080963759920e-02   -6.301988931077325e-02; +4.540083487004786e-01   +4.663418292174425e-01   +2.860799966470156e-01   +7.500806407577876e-01   +3.995474876726752e-01   +4.077146757253162e-01   +2.202466222412856e-01   +5.044572820082601e-01   +7.717794152335029e-01   +6.512926808912316e-01   +5.932942547659743e-01   +4.867038204510696e-01   +3.150793103852607e-01   +8.590484239936106e-01   +4.084899375754887e-01   -1.608583085941146e-02; +8.384294812694173e-01   +2.346645264029198e-01   -1.501273310897589e-02   +2.431320446058193e-01   +3.599214077008100e-01   +1.671566679945402e-02   +5.982779755071319e-01   +4.214919823290467e-01   +4.649012124571098e-01   +4.335720092382346e-01   +1.645032249895291e-01   +1.374116081343003e-01   +3.764236342284601e-01   -2.876157035654063e-01   +3.194601701802967e-01   +3.161032349701917e-01; +4.173792368761117e-01   -8.886337827526652e-02   +2.201021198399106e-01   +5.587871633417798e-01   +2.682935584018104e-01   +3.047284776181413e-01   +8.474200822415346e-01   +8.950990153042125e-01   +4.575133762420382e-01   +3.948846237438889e-01   +6.440991082842018e-01   +6.224845248698491e-01   +3.206144955154335e-01   +4.299256086435549e-01   +2.051805406308587e-01   +5.537695431307031e-01; +8.148010558541970e-01   +2.576737285663864e-02   +5.533513893461680e-01   +9.003314865585943e-01   +2.176483247364246e-02   +3.036027596105250e-01   +2.615701317279597e-01   +7.478820645500386e-01   +2.930779085699441e-01   +5.916624932655075e-01   +6.634164007747402e-01   +1.806444761163047e-02   +2.095952337685850e-01   +1.857277928968244e-01   +4.790656311954689e-01   +2.995295902944573e-01; +2.055682843819179e-01   +4.658616308957299e-01   +4.444568904297794e-01   +1.725502198927509e-01   +1.000000000000000e+00   +2.393297916833310e-01   +9.866118290670223e-01   +8.512631522832932e-02   +2.672026396563659e-01   +1.560747585036665e-01   +3.276002247897639e-01   +2.896669392517079e-01   +7.125527479669829e-01   +3.521662183132251e-03   +1.463882643989390e-01   -9.324889399658901e-03; +6.576773703267539e-01   +6.696036147530341e-01   +4.599298964694251e-01   +4.363516275549612e-01   +1.383179253233698e-01   +3.301795011402021e-01   +1.344582908036179e-01   -1.443541422265322e-01   +8.224680580169581e-01   +3.682168310508170e-01   +3.503550761242581e-01   +5.392764657010802e-01   +1.819084437261625e-01   +3.803460085853192e-01   +5.691073092300297e-01   +5.267298474510936e-01; +5.150779006611161e-01   +6.019445529359163e-01   +1.154841383979091e-01   +8.475263041537906e-01   -2.089977410870065e-01   -3.048818751316595e-01   +4.145451234080345e-01   +6.778671200184327e-01   +6.431064879508511e-01   +5.204242968077204e-01   +4.660518670599337e-01   +4.774237333986613e-01   +4.702222357465323e-01   +4.506358955905181e-01   +7.089829217139850e-01   +4.862521426096580e-01; -5.245916821590570e-02   +5.332311862732545e-01   +2.815797443537874e-02   +6.543695819197406e-01   +5.158098388331709e-01   +8.336810037529403e-01   +8.266880402067113e-01   +6.029684796589727e-02   +2.927671931089568e-01   +4.612581954710615e-01   +7.159855866632048e-01   -1.301779001806284e-01   +5.586653308073973e-01   +3.684059095455610e-01   -1.381954625385510e-02   -1.556576400072910e-01; +1.250290110225047e-01   +3.123863600322353e-01   +9.971700023168180e-01   +6.682351782504198e-01   +6.066455700559152e-01   +2.665416933898917e-01   +3.586283086819703e-01   +4.234695707823863e-01   +1.918323505571333e-01   +4.015298943634940e-01   +1.787943232770689e-01   +5.140541692281706e-01   +8.424860330666221e-01   +5.908016895881227e-02   +4.933188607682783e-01   +7.354511311574384e-01; +4.510822920073625e-02   +5.396521858650264e-01   +5.729091773315146e-01   +2.988327408563722e-01   +7.939453770381324e-01   +5.354609363849466e-01   +6.503177505494075e-01   +3.594433172023036e-01   +4.439019574417311e-01   +5.470784802700162e-01   +3.965702425055006e-01   +5.137622880610652e-01   -7.045221367240947e-02   +5.248583153944645e-01   +4.986040670225720e-01   +6.592735614224298e-01; +6.109861549460687e-01   +1.778546499841988e-01   +7.748552506461109e-02   +1.864035016426289e-01   +2.672863000500508e-01   +5.896842151278991e-01   +3.166452315200819e-01   +3.020083251932427e-01   +8.092087932335374e-01   -2.463017045693423e-01   +2.335933284295712e-01   +7.197041490855289e-01   +1.801570777560053e-01   +2.868979856771556e-01   -1.445084103162340e-02   +7.345592292654337e-01; -3.005836110035331e-01   +3.243438260801035e-01   +5.806721081592872e-01   +6.520292264919354e-01   +7.182059969150463e-01   +4.075250446098061e-01   +1.069976507010472e-01   +4.434211462575280e-01   +7.664010900883828e-01   +5.688534133375139e-01   +2.887423507292851e-02   +1.878323890232176e-01   -3.236526367534484e-02   +2.314001120584858e-01   +3.797736462903231e-01   +1.662638481559512e-01; +4.126280809237066e-01   +6.710646370752886e-01   +6.651756816211892e-01   +1.630419316505210e-02   +3.172869730542658e-01   +4.860088532581379e-01   +3.628379756480903e-01   +5.796041224190623e-01   -8.450596473907249e-02   +4.339491012142083e-01   +4.957447079030676e-01   +4.172435663124608e-01   +7.020562126447760e-01   +3.812311964683979e-01   +5.534916764656538e-01   +3.183676642525890e-01; +4.747245636643431e-01   -9.222659027770634e-02   +3.606408951020219e-01   +7.653224483010413e-01   +2.832776540790905e-01   +6.278778088859205e-01   +4.793885253092025e-01   -3.777806725315129e-04   +9.421846425881769e-02   +3.257060640034669e-01   +3.089719764891498e-01   +6.550332741263331e-01   +5.460288645671009e-01   +5.052209114697626e-01   +6.016268622141400e-01   +5.311814234035493e-02; -1.751471172403413e-01   +5.140239794864494e-01   +6.190845276746807e-01   +5.090373692582427e-01   +7.071207784521781e-01   +6.209063288554229e-01   +6.467801596023997e-04   +9.885735402152301e-01   +2.039686960018240e-03   +6.902683404770232e-01   +4.204128347419845e-01   +4.825888931897085e-01   +1.735615791735991e-01   +6.120454217158134e-01   +4.175862239566531e-01   +2.439345311139051e-01];
L1E_L1I_iGABA_netcon = [+8.492422900420462e-01   +5.545029707445940e-01   +4.359250087080096e-01   +3.310317943378149e-01   +4.153081385145644e-01   +1.618661045736615e-01   +5.110459733965904e-01   +2.920327535529494e-01   -8.470474832635067e-02   -1.015112299757832e-03   +3.900173537037787e-01   +2.332150399979802e-01   +5.966985463942834e-01   -2.691584168268043e-02   -3.160685865416680e-01   +9.696808883504536e-01; +9.813343527178522e-02   +2.246320543516476e-01   +6.708388948727910e-01   +3.497787284677176e-02   +4.376391572344094e-01   +6.816634579302057e-01   +4.564041082605629e-01   +6.303162311502385e-01   +3.895391539605745e-01   +1.626664998148849e-01   +3.925035838788430e-01   +1.034538710948579e-03   +8.705377782309047e-01   +4.794060785276015e-01   -1.899445487056598e-01   -2.979854616456953e-02; +1.164187710532588e-01   +3.787074700349791e-01   +5.349740244310616e-01   +2.384595920160875e-01   +5.265415036792231e-01   +3.466048170725928e-01   +3.772834819644744e-01   +1.069140382687310e-02   +1.028866133739376e-01   +8.935908755394697e-01   +4.923991873261455e-01   +3.221795688224500e-01   +2.610647670246659e-01   -1.505879718500769e-01   +9.780773994911110e-02   +7.115691108334053e-01; +8.055532204558872e-01   +7.352791625082622e-02   +1.558047582071513e-01   +3.218532899318879e-01   +9.738149631352599e-02   +6.463969704021351e-02   +2.228963118209522e-01   -4.302264942698318e-02   +1.979536747245259e-01   +2.000064417815848e-01   +1.833092832658703e-01   +9.153192930125703e-01   +2.803131791834076e-01   +4.917850999895040e-01   -1.253335536649914e-02   +1.866833920936409e-01; +4.628773739481118e-01   +2.395681950411876e-01   +2.640833262829905e-01   +1.534942154420192e-01   +5.285829340026749e-01   +1.943111061449430e-01   +3.604976040533452e-01   +2.275045999090356e-02   +4.246423349731148e-01   +8.918739003405697e-02   +2.322265315135107e-01   +4.279600114452158e-01   +3.030990823850889e-01   -1.072576994413691e-01   +1.632600921653434e-01   +5.359766064897875e-01; +2.231000442954914e-01   +4.185820186168859e-01   +7.025849056733318e-01   +2.407506777626527e-01   +7.259146330587702e-01   +3.250990131794824e-01   +1.901161225490824e-01   -5.318337782535808e-02   +4.131019546906067e-02   -3.036502933415639e-02   +3.439044030312737e-01   +7.016005505359231e-01   +2.038725638635334e-01   -3.087614013503331e-01   +5.842528584078628e-01   +4.494830532695194e-01; +3.650103024404714e-01   +2.434928676915638e-01   +2.914197431661292e-01   +1.466600088278214e-01   +4.308733546625584e-02   +3.556944415774335e-01   +2.649437669272823e-01   +1.112773830365641e-01   +1.625754770583185e-01   +6.675867995421225e-02   +4.326721771224679e-01   +4.546048492036878e-01   +7.371141052314909e-01   +7.370607883592015e-02   +2.993988166916188e-01   +2.615943697753351e-01; +5.532614892335905e-01   +5.779564391498930e-01   +3.393302247672948e-01   +5.608561231585022e-01   +3.194808571785862e-01   +9.878969618224356e-02   +2.244691817516236e-01   +8.928562541331557e-02   +8.531280931442182e-01   +5.246347180549479e-02   +5.105706452982546e-01   +1.129052844955964e-01   +2.020648690201850e-01   +2.886452682266501e-01   +2.082628642487490e-01   +3.999191361562141e-01; +4.185600554490548e-01   +2.625309590460292e-01   +3.475393624994108e-01   +1.372870529788708e-01   +3.640883296930542e-01   +8.221598714782054e-01   +4.325415333315583e-01   +3.430259793254110e-01   +5.046115139974167e-01   +4.655447182935901e-01   +4.157424499296063e-01   +4.693943216564236e-01   +1.311284492022861e-01   +1.464079401330108e-01   +4.764362361857418e-01   +3.820760159092772e-01; +1.279584843048275e-02   +7.676120558983174e-01   +5.599682162715507e-02   +5.471945785908662e-01   +6.031600068490105e-02   +4.864793894484619e-01   +3.105797551209442e-01   +3.587209625790264e-01   +5.260578537000942e-01   -1.407820550221354e-01   +3.053457282418889e-03   +4.568235424186763e-01   +5.957463303194852e-01   +6.714333343207667e-01   +3.346699079456964e-01   +5.850677881471902e-01; +3.571429730800247e-01   +1.683954844815580e-01   +2.952090430027223e-01   +2.667675662549028e-01   +3.190233883736414e-01   +2.480772373379785e-01   +4.901034354564994e-01   -6.903886788248337e-02   +7.470535101450829e-01   +2.258894216128516e-01   +2.005421613237377e-01   +2.557304460040160e-01   +3.076521082256635e-01   +3.033332746639916e-01   +3.799852828058903e-01   +1.632087250498336e-01; +5.259442048737673e-01   +3.646485171176971e-01   +1.064466833101353e-01   -2.205352840425463e-02   +1.746193579329635e-01   +5.937486381071608e-02   +2.110023218906645e-01   +6.027850760273324e-01   +9.357293994154378e-02   +4.574891019955951e-01   +5.618471229396115e-01   +7.042827986228012e-01   +1.159518754456517e-01   +5.930056696127777e-02   +4.126932219446122e-01   +5.143983237659704e-01; +6.340784927588201e-01   +2.701377984661705e-01   +1.337955525789635e-01   +6.245488316019482e-01   +2.498735667819160e-02   +1.889273584438248e-01   +2.385469214586674e-01   +1.993408961864009e-01   +1.076874200629739e-01   +4.260299641799960e-02   +5.277577377503642e-01   +1.301944145381706e-01   -8.782393012889554e-02   +1.983894514246245e-01   +5.551500657860321e-01   +3.489784799609545e-01; +4.251140433800065e-01   +5.531149980077363e-01   +3.217398958078193e-01   +5.888513853509580e-01   +2.971797326002232e-02   +3.812928031150070e-01   +4.196712343317342e-01   +1.782859206002018e-01   +7.905239244905374e-01   +2.421628207506541e-01   +4.541228358846709e-01   -1.842816452365307e-01   +4.650776726077952e-01   -1.138160413550951e-01   +7.505342641493593e-02   +7.438384952719439e-02; +5.542159554965201e-01   +2.076196415597907e-01   +2.212368892141331e-01   +9.907552969199500e-02   -6.542394089314908e-02   +1.357456520440896e-01   +2.619959560332389e-01   +6.165099400208424e-01   +4.658214609331123e-01   +3.420852060140556e-01   +6.198131103433486e-01   +2.106265474826433e-01   -1.069265102075755e-01   +4.152297224285021e-02   +2.810571852196277e-01   +5.145588733058158e-01; +3.831880349187273e-01   +2.739390768038917e-01   +7.668450518145479e-01   +1.892850470017326e-01   +6.197819183521082e-01   +3.225797653338451e-01   +6.263792318322789e-01   +3.619666776151811e-01   -2.000829148721897e-01   +2.624235404798025e-01   +2.791353078600300e-02   +3.924600268597736e-01   +3.605789159770554e-01   +2.678473254918503e-01   +5.320592001546423e-02   +4.069797054972700e-01];
L2I_L1I_iGABA_netcon = [+5.239620638951552e-01   +2.922203029981461e-01   +5.045936870533224e-01   +5.566122008961205e-01   +1.645546044667151e-01   +3.035369325636580e-01   +3.244134627835064e-02   +4.343372132634269e-01; +3.977261081660438e-01   +7.969284425598797e-01   +4.110833137833775e-01   +4.186446210368088e-01   +4.663335754325431e-01   +2.153363376519118e-01   +6.151610749581568e-01   -1.673725509893126e-01; +2.335201762222174e-01   +3.982237897045754e-01   +5.607194947947630e-01   +1.186899803586674e-01   +6.639764788767115e-01   -3.360883302260908e-02   +1.603262809212562e-01   -4.113892174947529e-02; +5.161385733301236e-01   +1.543399059584748e-01   -2.774030501936030e-02   -1.983437375718916e-02   +6.160617447445080e-01   +4.973134766345023e-01   +5.348087482932147e-01   +3.858199679160536e-01; +2.613964243846710e-01   +6.724663748523986e-01   +4.214237742982275e-01   +6.562758149828738e-01   +3.751737045166820e-01   +7.164472322094873e-02   +3.950277716321779e-01   +2.220700820764739e-01; +4.301114754719864e-01   +1.082176811960451e-01   +4.978679164448399e-01   +4.555515571178660e-01   +1.724143179958164e-01   +4.834216250920990e-01   +4.333799804269152e-01   +5.352464148502825e-01; +7.048187382879476e-01   +8.663809812834917e-01   +7.312237457874706e-01   -1.908992225177102e-01   +5.469645833730370e-01   +3.743883824987325e-01   +4.042520840513584e-01   +1.045786074049302e-01; +5.081853469195234e-01   +2.407129439388289e-01   +2.263851106807088e-01   +1.884881884363164e-01   +3.451566092814095e-01   +2.227691234933471e-01   +3.685138693496522e-01   +2.085707355179151e-01; +7.185977222702101e-01   +9.349090205564130e-01   +1.258241835163419e-02   +8.051134343258526e-01   -7.559218331859952e-02   +1.771858649493863e-01   +2.347183118823552e-01   +3.874130203480759e-01; -1.059598093241131e-01   +1.355568008042240e-01   +1.519132252012349e-01   +7.407128453974933e-01   +7.967646501546053e-01   +1.946172495925166e-01   +2.606594577153248e-01   +7.381986791936032e-01; +2.972100977044366e-01   +6.989349115166142e-01   +3.933435508067675e-01   +6.447877691605645e-01   +1.434521437561500e-01   +1.319736865738374e-01   +3.496361693893689e-01   +1.227300666570859e-01; +4.199364348954445e-01   +2.189516374040658e-01   +6.617777549144972e-01   +1.466899042426683e-01   -2.535271223517525e-02   +5.383130975607376e-01   +2.282137999417782e-01   +4.490240856115339e-01; +3.322270435922318e-01   +4.764529973101059e-01   +8.556608642349859e-01   -5.176471710644998e-02   +1.361740571269835e-01   -5.412825040865021e-02   -1.403245334685488e-01   -2.265630721385229e-01; +2.197711017338710e-01   +2.320457338125882e-01   +6.474477399065609e-02   -2.107448553921288e-01   +5.503836830921274e-01   +3.213079121333002e-01   +3.877826365539189e-01   +1.308481547182093e-01; +8.059011103689656e-01   +7.953639281208775e-01   +5.819300279348232e-01   +8.538914740252022e-01   +5.250564053753661e-01   +7.678767950741213e-01   +3.564783196750616e-01   +6.328744578985777e-01; -7.795075535291136e-03   +2.367221215369339e-01   +6.106468827011271e-01   +3.628377500513240e-01   +1.284031648106423e-02   +3.843568855870155e-01   +5.542969812924891e-01   +6.982057514587959e-01];
L1I_L2I_iGABA_netcon = [+5.808952136329329e-01   +6.033790496735817e-01   +1.548838765663958e-01   +5.850023193245579e-01   +4.961028772031669e-01   +2.247483713205525e-01   +5.900610351172765e-01   +2.223426864298704e-01   -1.720484530462501e-01   +5.892867440273278e-01   +2.427919319944770e-01   -3.171785223992143e-03   +6.910169080574977e-01   +3.479186414104927e-01   +2.850850884290819e-01   +3.550025015343945e-01; +4.036123487919558e-01   +6.497847793440501e-01   +8.730578680095116e-02   +1.089540438174514e-01   +6.955969790996999e-02   +4.740741786754626e-01   +9.328940923059311e-01   +2.055011112886180e-01   +7.809404532053507e-01   +6.057320480849812e-01   +2.843329480033054e-01   +1.381135894697410e-01   +2.048511892640855e-01   -1.181802621830019e-01   -1.623808843788502e-02   +4.647033138271325e-01; +9.813884576334413e-02   +1.702048111982723e-01   +4.362087066739068e-01   +4.698887469301263e-01   +3.887459048384047e-01   +6.992509023860933e-01   +2.551016870825764e-01   +6.259593702221383e-01   -3.501686892178207e-02   +3.329812425896586e-01   +8.139238746015307e-02   +4.618484583272038e-01   +4.106184383463212e-01   +6.902497689462629e-01   +3.146054205094148e-01   +1.906761436296099e-02; +2.469364746943880e-01   +2.800358703781549e-01   +1.593360538785003e-01   +1.072307864960427e-01   +6.376263827615294e-01   +1.928111569611134e-01   +6.948409102708210e-01   +7.051123672310282e-01   +6.966891415933811e-02   +2.994269274396242e-01   +1.559885998665708e-01   +2.245504542102675e-01   +3.818165417432756e-01   +2.665219908076939e-02   +3.801045116546046e-01   +5.007890907823279e-02; +3.910155214423062e-01   +7.379042876357811e-02   +6.072226151262742e-01   +6.301213273803157e-01   +1.678126988417992e-01   +1.000000000000000e+00   +7.545296482304436e-01   +1.122061089505844e-01   +3.644795379394500e-01   +2.415144145732802e-01   +1.718319206793471e-01   +2.816470721815327e-01   -1.250686806607857e-01   +3.983626159078218e-01   +5.404197304038124e-01   +5.029386555004662e-01; +1.309213243025842e-01   +2.973214579946429e-01   +1.330263585897360e-01   +7.037587498698307e-01   +2.024875492294361e-01   +5.163255793074650e-01   +4.520273274714764e-01   +1.706867298451352e-01   +1.046556954695707e-01   -1.873844543242496e-02   +4.615125787354407e-01   +2.199058454043343e-01   +6.336964885221346e-01   +6.870767576547548e-01   +7.368561973699791e-02   +3.224009668741983e-01; +4.876935256385800e-01   +6.314270824503446e-01   +2.207746813354391e-01   +6.289243605706145e-01   +7.247341746880800e-01   +1.576064308599749e-01   +6.520705630252138e-01   +3.660234531929698e-03   +1.600247512729741e-01   +7.765945536087995e-01   +3.594865586842191e-01   +4.530343297947872e-01   +2.482279154095562e-01   +2.331502890045226e-01   +2.417233948553752e-01   +6.026900706301349e-01; +5.899480149657519e-01   +1.852660491344612e-01   -7.155665165763325e-04   +3.639091368244889e-01   +7.924775547804312e-01   +5.021594401264563e-01   +3.319931148854052e-01   +1.561599994901234e-01   -1.106126923895283e-01   +1.816857083071621e-02   +8.786427837117154e-01   +3.804362254943761e-01   +5.742578655232684e-01   +1.730871920759537e-01   +7.085177942949249e-01   +1.571759571984396e-01];
L2E_L1E_iAMPA_netcon = [+5.793882376139274e-01   +5.798063932253396e-01   -1.484249202434004e-01   +3.061732095803372e-01   +6.909479570521807e-01   +2.464179495201114e-01   +1.884800554525530e-01   +3.933421479426301e-01; -4.435506167450025e-03   +4.484484477963998e-01   -1.717803089158981e-02   +6.568211376820503e-02   +2.159404362224976e-01   +6.032199086649326e-03   +3.391416890794239e-01   +4.917874853025337e-01; +3.108991117172532e-01   +6.327040243430569e-01   +3.793455481684709e-01   +1.235322554810808e-01   -1.650611550660933e-01   +5.575662261742266e-01   +3.341859066167491e-01   +4.822369559657333e-01; +4.556001590887647e-01   +4.680733799848893e-02   -8.273730804676395e-03   +7.170185806987346e-01   +1.011196915607181e-01   +1.163874840960190e-01   +3.537407276841205e-01   +8.793600138431416e-02; +1.084830231161689e-01   +3.745361270600615e-01   +1.841243513883274e-01   +2.090531903567364e-01   +5.587106168597558e-01   +5.914458642995286e-01   +1.000000000000000e+00   +7.446591595168760e-01; +5.638703794195524e-01   -2.810736244752416e-02   +5.995206414546893e-01   -5.199023877097664e-02   +3.808641088192729e-01   +4.097728186431261e-01   +5.891414511723925e-01   +1.999432120500738e-01; +2.646670712000798e-01   +4.721658696859287e-01   -5.073337265197526e-02   +2.029440633663701e-01   -4.626228769430422e-02   +1.987979391860532e-01   +6.021246382070242e-01   -9.488572043077959e-02; +2.026139497866463e-01   +4.633521398365002e-01   +7.481896804397455e-01   +2.252878842651641e-01   +2.674476240088062e-01   +2.570479691200794e-01   +3.693670014294530e-01   +5.100661706685588e-03; +5.481783174142102e-01   +2.543615064894608e-01   +3.762428929033997e-02   +5.602367501230157e-01   +1.160781148229377e-01   +4.059473864292772e-01   +1.925778457286265e-01   +3.103949208908487e-01; +4.127704288040694e-01   +5.088184704581927e-01   +3.493204369879341e-01   +3.404898756393274e-01   +3.051817345973729e-01   +7.420193005369165e-02   +5.121408614548917e-01   +6.723090920292552e-01; +5.113336724450400e-02   +4.325405293513259e-01   +2.832565770400635e-01   +3.364788612011315e-01   +3.432363906352922e-01   +2.981595854446678e-01   -1.291144127920980e-01   +4.922262303314421e-01; +4.225295094543778e-02   +3.052302718454674e-01   +4.885394148856433e-01   +7.801842811111585e-02   +3.775129679192981e-01   +2.724294125590950e-01   -2.818417161408520e-01   +2.936673644213426e-01; +9.360905825736106e-02   +3.710147982473754e-01   +8.196127951518422e-03   +3.972381909760248e-01   +4.913571757699886e-01   -8.541600434543890e-03   +4.341406623935598e-01   -1.396432336755246e-01; +1.621578683313522e-01   +3.151034133544031e-01   +2.637652220049453e-01   +7.021211480141756e-01   +2.036871145917723e-01   +3.568909879795495e-02   +5.262673859370556e-01   +3.566855313262495e-01; +2.954228153216947e-01   +1.896664649715373e-01   +8.239997242363385e-01   +3.839083109193814e-01   +5.386400586432854e-02   +6.121183854568676e-01   +2.502970526402185e-01   +2.915811311145343e-01; +3.726739697191408e-01   -3.951207572023593e-02   +1.755773245445562e-01   +1.587898006580052e-01   +4.950479091090529e-01   +1.769775493758101e-01   +2.605581153072640e-01   +6.581428480512919e-01];
L1E_L2E_iAMPA_netcon = [+3.253994558502404e-01   +2.316384232949139e-01   -5.954832793057941e-02   +5.637976041555277e-01   +3.914034507752729e-01   +3.784519697873112e-01   +5.414750909178092e-01   +2.396611550144959e-01   +6.294260273629615e-01   +5.973804630845929e-01   +6.292390112330829e-01   +6.850212397485707e-01   +6.514352939286695e-01   +2.546461435851504e-01   -1.006625393398671e-01   +1.957469217331370e-01; +5.410106246298235e-01   -7.568843213158702e-02   +1.586536188452914e-01   +3.232685846116597e-01   +2.535443311197736e-01   -7.535426287573650e-02   +3.223004919491175e-02   +3.084864149093411e-01   +1.622485057978033e-01   +1.527841888411400e-01   +3.322701037679823e-01   +5.184647268593653e-01   +2.522565922568375e-01   +2.409645034265686e-01   +1.440409955791895e-01   +2.399998642698291e-01; +8.296601295622548e-01   +4.365253888214234e-01   -1.094369746296517e-03   -3.944225630998151e-02   +5.650571508715621e-01   +4.519991197221755e-01   +1.866122474640101e-01   +6.905221562239727e-01   +4.115733426195058e-01   +3.992857520089709e-01   +3.133563829773444e-01   +2.860404165207925e-01   +1.531910322335154e-01   +3.961916596619177e-01   +3.598062458753055e-01   +5.033316263578344e-03; +2.384662006712237e-01   +3.160688125000743e-01   +5.845773473893189e-01   -6.952517675535007e-02   +2.272172284039795e-01   +2.251183249625682e-01   +8.137341373241341e-01   +5.812898929528736e-02   +3.810534571799473e-01   +2.932347162261222e-01   +7.434969904539922e-01   +2.706198232404119e-01   +7.655819306033776e-02   +3.437044651537179e-01   +4.220229081768069e-01   -8.257147163001469e-02; +3.029705295385376e-01   +1.889218924002024e-01   +9.033046268029611e-01   +4.904044541395678e-01   +2.060230134917060e-01   +7.002992322113311e-01   +3.806631688965090e-01   +2.522674021757366e-01   +8.405493480208693e-01   +3.113199695160292e-01   +3.016828453612116e-01   +3.365479245120211e-02   +3.704040357062115e-01   +6.125735739510156e-01   +8.889941919676353e-01   +2.041584836336385e-01; +1.663456694411221e-01   +5.996921069874699e-01   +2.219570182467696e-01   +2.398525849255123e-01   +2.203662745618037e-01   +8.852062590821070e-03   +6.267459776071173e-01   +3.153314802367724e-01   +6.467151947352248e-01   +4.524509627075001e-01   +6.225997370662212e-01   +7.285613111393915e-02   +2.526119199698196e-01   -2.476266821449029e-01   -1.628481796130470e-02   +1.884371552765161e-01; -4.219288868126544e-02   +2.824963603841509e-02   +5.618455952353688e-01   +8.852753752507844e-01   +1.970547874844911e-01   +1.379045914828501e-01   +7.247131720138539e-01   +5.479376771838667e-01   -2.273692626477613e-01   +1.342376104015232e-01   +1.596132834031976e-01   +2.761492701631174e-03   -1.095701920702775e-01   +2.046077549789669e-01   +1.872081269416949e-01   +1.528070218937976e-01; +3.937626955875215e-01   +2.281454276599381e-01   +5.401877001495161e-01   +5.590122800947220e-01   +7.891436299748009e-01   +9.826616531690291e-01   +7.481248399591245e-01   +2.106592635288820e-01   -1.611699333358327e-01   +3.689836844169683e-01   +6.205092673714585e-01   +3.345729566072634e-01   +3.393691577331051e-01   -5.112231100207883e-02   +3.956779853370924e-01   +4.048426830842058e-01];
L2I_L2E_iAMPA_netcon = [+6.471032847454347e-01   +7.557256885053695e-01   +4.266601345126639e-01   +3.322550974863735e-01   +1.115339531134464e-01   +1.000000000000000e+00   +4.960989648235785e-01   +4.764572187526226e-01; +6.934176023222585e-01   +1.746163216645855e-01   +8.426094541230554e-01   +8.091723153092042e-01   +7.245188616228819e-01   +1.960248926616062e-01   +5.442546950975864e-01   +3.485800067486079e-01; +7.587822338991668e-01   +2.500332555400913e-01   +3.836309231061527e-01   -5.104257149247497e-04   +2.216854070913373e-01   +5.870344926406303e-01   +5.275570807205383e-01   +2.742455059560193e-01; +4.417980905796068e-01   +5.561698575935751e-01   +4.167032701296425e-01   +9.960009343491130e-01   +2.857185075722978e-01   +3.038858965248990e-01   +3.385261545931952e-01   +4.496824083529368e-01; +8.844433489390278e-01   +4.199073597998469e-01   +3.520503080052199e-01   +8.029815601381396e-01   +7.907984101551168e-01   +8.541042583851484e-01   +9.499332763881916e-01   +2.462843978902318e-01; +3.544477188266860e-01   +4.850726679370687e-01   +2.114123026168758e-01   +8.592370116034996e-01   +2.835863264820145e-01   +3.199615719601059e-01   +4.758623184936254e-01   +5.823426415058934e-01; +6.846801633492823e-01   +2.902209812479415e-01   -5.293861756371704e-03   +7.316987951709084e-01   +7.254056262559245e-01   +2.644212431014488e-01   +9.232929976940596e-01   +4.483683305466398e-02; +8.871372868836013e-01   +1.714774159106920e-01   -2.893262493075120e-02   +4.870391561146213e-01   +2.206295400573948e-01   +6.747748966646268e-01   -4.401440571942756e-01   +8.191725581528363e-01];
L2E_L2I_iGABA_netcon = [+3.000452554641480e-01   +3.565194396468849e-01   +3.445935093877707e-01   +2.433648758901903e-01   +1.452191324682774e-01   +6.023808108440785e-01   +1.928820270495591e-01   +6.921509783014497e-01; +5.216099976108828e-01   +7.421107151783970e-01   +5.293538921858392e-01   +5.035792394192312e-01   +5.986208771040126e-01   +4.499386359525502e-01   -1.166019581065186e-01   +4.214352255614079e-01; +1.938029029410039e-01   +1.000000000000000e+00   -1.332073276586601e-01   +6.454060057600949e-03   +6.175470938829563e-01   +9.133502888651814e-01   +2.962063629633319e-01   +7.008533067854105e-01; +1.505069560901718e-01   +8.146824655780653e-01   +7.827660142084317e-01   +6.346171234128661e-01   +9.632638559535711e-01   +5.082059384488840e-01   +7.110764405614139e-03   +5.823906049672803e-02; +1.094778518625857e-01   -2.456626819428962e-01   +2.350570832244915e-01   +7.803961281293298e-01   +5.392856329050918e-01   +2.333952836799201e-01   +3.689491426503591e-01   -7.240035092300617e-02; +4.266179821579327e-02   +4.143276578521380e-01   +3.434799854278577e-01   +2.178893476480704e-01   +5.801260030812437e-01   -2.392962827163318e-02   +6.175140960271299e-01   +1.857852052566782e-01; +9.250599193307769e-01   +2.437720640959127e-01   -1.307715046457381e-01   +4.394275379070643e-01   +7.996640521130849e-02   +3.762104271754429e-02   +6.000153126453479e-01   +7.022621808206929e-01; +3.966708869552436e-01   +6.905216302494968e-01   +5.928744697965248e-01   -3.879923617624532e-01   +7.900106236856445e-01   +5.884206196247982e-01   +6.545796881131362e-01   +5.314421130406389e-01];
L3E_L2E_iAMPA_netcon = [+1.993879838074893e-01   -6.455063606451147e-02   +1.170512661327354e-01   +5.643398413532037e-01   +3.917215616981302e-01   +2.731529184305255e-01   +4.520397885129235e-01   +5.522084479774162e-01   +4.887746617269162e-01   +3.220737382876789e-01   +6.743467075033924e-02   +5.759303622111782e-01; +3.361344163557141e-01   +7.091018707384519e-01   +2.253641657782990e-01   +2.263927515085003e-01   +1.360047214376804e-01   -1.567486835492216e-01   +3.005745456107585e-01   -3.610440913511077e-02   +4.694090629551289e-01   +2.286242336229898e-02   +3.859565839983479e-01   +3.274673412371934e-01; +1.989357386937800e-01   +3.193946288612864e-01   +6.451361259758337e-01   +4.053099782927266e-01   +7.463854824617904e-01   +5.093751931956889e-01   +6.100713443673509e-01   +3.896606114264487e-01   +6.287608134940016e-01   +1.813859864150073e-01   +4.697417373166644e-02   +5.890973265927905e-01; +2.638040661325504e-01   +4.652370318525362e-01   +4.918846124899806e-01   +1.612210151011812e-01   +2.828965044573714e-01   +2.827129295671421e-01   +2.413663816447701e-01   +4.218205184294864e-01   +2.736700219514182e-01   +5.022939581899798e-01   +5.543401759861523e-02   +8.067969279633994e-02; +5.333192398203592e-01   +3.731721999737037e-01   +1.144244369592352e-01   +1.151049299848269e-01   +6.567486892005507e-01   +4.753615616360458e-01   -5.340856814112196e-02   +1.974095350686483e-01   +5.209096557431943e-01   +3.441949342201032e-01   +7.265020586717295e-01   +8.219527520618461e-01; +4.776686500431589e-01   +6.533915759496354e-01   +6.052570858616092e-01   -1.061188701398735e-02   +5.749880775723420e-01   +8.453413080598348e-01   +2.523572876725937e-01   +5.244287207752122e-02   -5.537588441727590e-02   +4.165434825193859e-01   -1.340280301376950e-03   +2.801752349227351e-01; +2.109452585145123e-01   +4.601106359836988e-01   +7.231951719926778e-01   +1.864110462902976e-01   +1.631564545308853e-01   +5.650634616657116e-01   +3.231345299045906e-01   +3.853948969265110e-01   +4.942396481505061e-01   +4.151025093582350e-01   -2.540653321903915e-02   -3.841194433105210e-02; -7.876156952002755e-02   +2.862410256739111e-01   +1.077523954715832e-01   -9.876094575098315e-02   +2.731048292855727e-01   -6.653115585005777e-02   +4.003280241803354e-01   +2.158112475124953e-01   +9.982568589350171e-01   +6.996088910702546e-01   -6.993271469404878e-02   +2.276110593950061e-01];
L3I_L2I_iGABA_netcon = [+7.523208010441861e-01   +3.212799334842453e-01   +3.869705092010732e-01   +6.521849663022410e-01   -7.890495419544490e-02   +3.493342547398620e-01   +7.034729368136396e-01   +4.562699828652136e-01   +7.073283864286295e-01   +5.780120025870333e-03   +3.932936616045347e-01   +6.059244017988574e-01; +5.030271222101640e-01   +1.913508602984395e-01   +1.911747224359269e-01   +2.750087988743464e-01   +7.607825973856245e-01   +1.803733661705001e-01   +4.588445312111127e-01   -2.419919229028943e-02   +4.416953284905238e-01   +1.952373521515539e-01   +4.298056113772675e-01   -2.344760808145814e-01; +3.565316121150800e-01   +4.716416584985572e-01   +6.524635043331063e-01   +4.044810700459003e-01   -7.311106030069289e-02   -4.620325640229003e-02   +4.199661569396228e-01   +6.983549853436635e-01   +1.103192300489573e-01   +1.461576467521602e-01   +2.686141397952154e-01   +5.621576012170514e-01; +2.643247327344813e-01   +8.385216394298394e-01   +3.983085697828877e-01   +6.736256495432311e-02   +1.630531563962002e-01   +6.412484187178398e-01   +6.157610496185596e-02   +1.081883013622116e-01   +4.432141392876114e-01   +1.424184206182864e-01   +4.527136721110841e-01   +5.527681668350414e-01; +1.006524099878163e-01   +2.335316324876344e-01   +4.384392724396393e-01   +4.205606303416319e-01   +6.091632227195781e-01   +7.343337097208230e-01   +5.534240806926967e-02   +8.970116465272066e-01   +6.456362550132873e-01   +3.113094192653938e-01   +1.896162653500374e-01   +8.134343635575725e-01; -1.504523726055433e-01   +6.908687538124210e-01   +1.458919905400443e-01   +6.155043299806756e-01   +9.097331057323186e-01   -1.883473559192113e-01   +1.694373263170918e-01   +6.714744379335589e-01   +3.323454551892737e-01   +2.250015402097447e-01   +3.322152058683502e-01   +7.000805322963457e-01; +6.702321139976015e-01   +4.153655632620674e-01   +6.883106634033352e-01   +2.139220995763834e-01   +1.606966628066100e-01   +4.233015366882759e-01   +9.435498756844058e-01   +2.477672039896896e-01   -1.507413863989893e-01   +4.945887113711220e-01   +5.274038974271918e-01   +2.937450394854654e-01; -2.540332384892706e-01   +3.732903536963961e-01   +8.176704264917902e-01   +6.825515380998782e-01   -1.608060562699271e-01   +7.651305311313877e-01   +4.455293477232242e-01   +4.553938766323416e-02   +5.634525720210218e-01   +2.634868898824498e-01   +3.250420250381602e-01   +5.314070777128779e-01];
L2E_L3E_iAMPA_netcon = [+3.321530979418040e-01   -4.712052671861952e-02   +4.660689879137066e-02   +2.663329194928536e-01   +1.642771553603046e-01   -4.670384839019575e-02   +2.046998069644422e-01   -3.517744761638853e-01; +2.544986705752080e-01   +6.930428602030311e-01   +4.282511123782440e-01   +1.944395613999821e-01   +5.931541210460050e-01   +3.199577082794104e-01   -2.326646578688187e-01   -1.459297902221514e-01; +3.804743641457403e-01   +6.094420949828178e-02   +3.425194156014745e-01   +7.394489367412945e-01   +4.650140209264265e-01   +3.543670736778174e-01   -1.670548624409006e-02   +4.168079286741244e-01; +5.760701901575004e-02   +5.314163731535634e-01   +5.391930692913887e-01   +7.563248733000865e-01   +6.493900157465651e-01   +4.557137088165904e-01   +1.285474241722594e-01   -2.666332052804424e-02; +9.196220054059442e-02   +5.617514181173545e-01   +3.959170876523388e-01   +9.462387532958754e-01   +8.710826882281794e-01   +3.260422213062198e-01   +1.632628068087194e-01   +4.938456914745677e-01; +4.470579917783585e-01   +7.836268005845782e-01   +1.000000000000000e+00   +8.067567856143011e-01   +3.882477909714174e-01   +5.062849561386635e-01   +8.682513641522643e-01   +4.873229128450584e-01; -7.101780110886646e-02   +4.075215787657830e-01   +8.597125124228634e-01   +8.072591729923067e-01   +3.737396833175934e-01   +2.582321235048455e-01   +3.405846554394283e-01   +3.737605849317380e-01; +5.140473781850411e-01   +3.415109929258837e-01   +1.923200085214573e-01   +1.537742075341240e-01   +4.925307548176900e-01   +4.482493341533680e-01   +6.520310516827801e-01   +7.304809298842739e-01; +6.257467559862302e-01   +1.229428017107897e-01   +3.992749293881519e-01   +1.449918742338127e-01   +1.175441966493918e-01   +1.290111845456894e-01   +6.397595390449087e-01   +3.351319920674650e-01; -6.366346069261675e-02   +4.645689293213059e-01   +2.364484056519565e-01   +6.764196216153707e-01   +1.830792131685974e-01   +3.991779630448323e-02   +8.990985796135995e-01   +4.384207603914259e-01; +5.848831220993296e-01   -3.376648670589602e-02   -1.376083029374756e-01   +6.708166551754805e-01   +7.506825870830232e-01   +7.082757375443460e-01   -1.416283783013689e-02   +5.036719371436440e-01; -3.077548063741818e-01   +7.320014715023299e-01   +7.169030784531422e-01   +4.283888521208286e-01   -2.781360460293792e-01   +4.145033673876781e-02   +2.938336604572147e-01   +4.333734277434708e-01];
L2I_L3I_iGABA_netcon = [+9.554435833921093e-02   +8.897207696480235e-02   +8.525932583918352e-01   +7.969612900560711e-01   -1.187677057296203e-01   +3.684835104858763e-01   +3.143571972276674e-01   -8.933605854788945e-02; +7.866497906497154e-02   +3.797834318251924e-01   +1.071666317760821e-01   -4.717578186624399e-02   +3.336308139712300e-01   +1.985788728859984e-01   +2.616755329611808e-01   +1.325738131826259e-01; +7.252484787464621e-01   +3.338659238261338e-01   +3.095972172112607e-01   +2.225046333005388e-01   +5.266128670367004e-01   +9.209176530881183e-01   +2.128067998826979e-01   +4.554158311936129e-01; +3.435933382657100e-01   +3.930186388858283e-01   +6.371191111518335e-01   -1.599547666660682e-01   +5.730313609530641e-01   +4.623513705936371e-01   +3.302078968238182e-01   +5.893681249717211e-01; +8.966363023266211e-01   +7.707220615014797e-01   +1.959840916992669e-01   +1.647055372681324e-01   +4.543361568688224e-01   +5.399125092621223e-01   +2.984786031374224e-01   -2.131848824345050e-01; +4.228698764784473e-01   +3.777664334141677e-01   +8.758965931991740e-01   -3.129092078513185e-01   +1.297709334826369e-01   +4.967963794945368e-01   +3.631853271682906e-01   -1.749690804652553e-01; +6.851326532852224e-01   +5.949096161502851e-01   +2.405977326951203e-01   +7.864247091926181e-01   +1.905932730453904e-01   +4.690035194362673e-01   +7.718243782995052e-01   +3.830747593473428e-01; +2.439139846775722e-02   +3.679402044400129e-01   -1.099470813782073e-02   +5.019750522731513e-02   +6.371957250178334e-01   -1.359372281686130e-01   +1.215451219999370e-01   +5.076690933329563e-01; -2.269348280940014e-01   +4.365741578609628e-01   +5.489259172397346e-01   +7.782519685708245e-03   +1.480046379596530e-01   +5.467667577297560e-01   +5.541739894709550e-01   +3.254324181335814e-01; +5.232538604856382e-01   -3.796690604429484e-01   +2.680934411197927e-01   +2.979196575481503e-01   +5.099008964807555e-01   +6.885514466630344e-01   +5.602093268691129e-02   +4.500918426577654e-01; +3.610123693879223e-01   +3.514947721828741e-01   +2.295105618845035e-01   -1.510255376405346e-01   +5.232719043684219e-01   +2.508959260632310e-02   +2.445024459786368e-01   +1.000000000000000e+00; +6.706800413550294e-02   +4.662881931466494e-01   -1.896729487451621e-01   +1.847112775317013e-01   +9.932159238538100e-01   +3.110476286646762e-01   +2.114549275798611e-01   +2.219942834541938e-01];
L3I_L3E_iAMPA_netcon = [+7.047154870391961e-01   +6.026596243242152e-01   -6.236267541588903e-02   +7.082608035814292e-01   +3.799590885790450e-02   +7.062784384715266e-02   +2.084665294803059e-01   +8.523849566462281e-02   +3.662671101973288e-01   +3.749598671221113e-01   +1.881146904115232e-01   +4.729692069372227e-01; +4.987888372837652e-01   +6.011314034284542e-01   +5.734330935520350e-01   +3.769043889717439e-01   +9.527256828390860e-01   +3.109924301831329e-01   +1.065141151728433e-01   +7.161058243438376e-01   +8.108839260037223e-01   +1.736190567641600e-01   +1.573653396580292e-01   +3.036973525054414e-01; +5.613940257512898e-01   +6.968091098254617e-01   +9.714022792857701e-01   +4.777337609352220e-01   +6.101473648424206e-01   +6.625146216654774e-01   +6.576969482056347e-01   +1.316043386040484e-01   +5.136638600476562e-01   +7.752373112794497e-01   +1.985299521963990e-01   +8.288324464220378e-01; +4.264096052942208e-01   +4.485602773631554e-01   +1.666972523901090e-01   +1.572304994382781e-01   +4.971176417367299e-01   +4.581809351568563e-01   -1.737335325567577e-01   +1.409846589155584e-01   +2.923067604249214e-01   +4.436757254751357e-01   +4.377877762630068e-01   +2.488073822753009e-01; +4.142283900436755e-01   +2.858997220031663e-01   +6.411284225577132e-01   -5.598316843660483e-02   +4.010995984402586e-01   +2.967763421808773e-01   +2.068846406910914e-02   +4.410441114630508e-01   +5.484337897225872e-01   +6.877583169597842e-01   +7.210742343703126e-01   +8.152715639468636e-02; +2.741665702256242e-01   +6.694661452854138e-01   +5.279588647811041e-01   -9.469636780858640e-02   +1.003565035978828e-01   +2.114704380549189e-01   +5.126483564693014e-01   +2.632769940126224e-02   +3.751052347961147e-01   +5.313703238251600e-02   +5.258801465050676e-01   +2.800104279985696e-01; -2.774003613775598e-02   +2.224472583641035e-01   +4.401813056349439e-02   +1.411769638946940e-01   +3.137282507176303e-01   -1.087091405888828e-01   +5.211887926877765e-01   +2.637531312526729e-01   -1.779232790632263e-01   -6.390705182415589e-02   +6.130609146972179e-01   +3.159338046338156e-01; +8.743209939949463e-01   +5.638224465371072e-01   +4.422113551737046e-01   +4.628829716297669e-01   -1.477044719069670e-01   +4.671635725871353e-01   +2.732737934700792e-01   +6.240337639338068e-01   +1.732349325119232e-01   -1.512973738161023e-01   +1.966817968346510e-01   +5.624805149266452e-01; +2.329227735806189e-01   +8.046975396928518e-01   +1.218885922256003e-02   +6.798477493782228e-01   +4.677788920759627e-01   +3.379038395202669e-01   -1.435465957736429e-01   +4.266363527076653e-01   +4.789279249016214e-01   +7.263221267099182e-01   +3.228678617058161e-01   +8.334233517135469e-01; +8.233389090698215e-01   -2.116985707708114e-02   +7.347444611661242e-01   -7.919728491195506e-02   +7.133088345951019e-01   +1.258002354213550e-01   +6.737471211822521e-01   +1.513795225279126e-01   +3.670305993466832e-01   +9.557629531963854e-02   +6.593014049365739e-01   +2.107984856388103e-03; +8.532027708693059e-02   +3.264612520857251e-01   +4.834043859308344e-01   +3.830583979484935e-01   +7.178825308307678e-01   +3.318545566206373e-01   +4.862036238038152e-01   +7.287861767122716e-01   +9.455806028345661e-01   +4.317458157523238e-01   +5.925388042703004e-01   +1.000000000000000e+00; +5.100475328209536e-01   +2.531426938224101e-01   +1.827121633634997e-01   +3.097475975173484e-01   +1.838733940137344e-01   +1.039014502072888e-01   +2.782151904023619e-01   +2.860629827876616e-01   +8.759206791970221e-01   -2.044559375232788e-02   +6.771041833274650e-01   +3.151411716170220e-01];
L3E_L3I_iGABA_netcon = [+3.356382103151378e-03   +8.387608680973044e-01   +3.978808232123839e-01   +2.491296429498267e-01   +3.254930357527078e-01   -8.450281551644567e-02   -2.498167163989932e-02   +4.619576747232471e-01   -1.082515358154889e-02   +5.204655635855733e-01   +1.965002262424650e-01   +8.230740846202173e-02; +7.455715110081940e-01   +3.993427720574014e-01   +8.142238486457833e-02   +1.739880501131469e-01   +4.195072189098947e-01   +1.823253033611970e-01   +4.219750652029088e-02   +4.292690182258988e-01   +1.012727245229312e-01   +1.193224635433227e-01   +1.047627641989169e-01   +2.062566480007212e-01; +6.733102541257471e-01   -9.778770748261535e-02   -2.802696618204497e-02   +4.517363906143818e-01   +5.995567447189886e-01   +3.980030012174048e-01   +5.163185419936726e-01   +2.822834716077701e-01   -1.092068401461321e-01   +4.290758427441583e-01   -1.434723605654778e-01   -1.229622665220132e-01; +4.089063209996061e-01   +6.770632878238879e-01   +2.174969267361671e-01   +4.936684849186774e-01   +6.946797767264239e-01   +4.927966384286697e-01   +2.571788496086188e-02   +4.349087161799779e-01   +4.978691895189573e-01   +5.778517439736570e-01   +3.548184757374892e-01   +5.062183335567795e-01; +5.713405362924471e-01   +2.222431225685235e-01   +3.529622147677488e-01   +8.368956674757118e-01   +2.595552276050455e-01   +5.009016741539573e-01   -1.341764823665311e-01   +5.806042004419520e-01   +5.513043433488175e-01   +5.390779016918416e-01   +3.800848114496665e-01   +2.828911695432456e-01; +1.981188277373273e-01   +4.227897760838529e-01   -5.188011055970973e-02   -1.041732269342275e-01   +5.329919436400792e-01   +7.551937281134216e-01   +2.134636101733747e-01   +3.191028372319635e-01   +6.895541652849722e-01   +4.873990983929424e-01   +4.183639690382268e-01   +2.356728598861017e-01; +2.047979538991777e-01   +6.734823909699322e-02   +3.687531917857054e-01   +9.029120891384926e-01   +5.680998373674713e-01   +1.027034191015988e-01   +8.410132957096345e-01   +6.381354781103629e-01   +1.896265139681561e-01   +5.691041841175031e-01   +6.783922382170161e-01   +2.219888297647703e-02; +2.941599169648482e-01   +2.636948571639778e-01   +5.649250968453874e-01   +5.444064794359317e-01   +7.119598469248605e-01   +2.395329223870920e-01   +3.778234095263714e-01   +1.422783546574934e-01   +4.672796280130446e-01   +4.390553851580430e-01   +3.302523356472040e-01   +2.534545761131365e-01; +3.912730425920530e-01   +7.152210609842600e-01   +4.040286367356957e-01   +2.198849954681974e-01   +5.175044866041372e-01   +3.405594227050677e-01   +1.848035589592137e-01   +2.105602734763000e-01   +6.015229156799137e-01   +6.550473467216884e-01   +6.619286456184770e-01   +5.319472656670060e-01; -6.167380641852986e-02   -3.840995859485524e-02   +6.173567484505713e-01   +2.012028360939136e-01   +2.554561149008193e-02   +3.895744749161024e-01   +4.371264426291915e-01   +5.942126047135329e-01   +2.340854221361991e-01   +3.255643569914196e-01   +5.089931611704575e-01   +9.662100911778942e-01; +5.614592371012620e-01   +7.293987539775702e-02   +3.238262513831985e-01   +1.255262145122886e-01   +3.619737205580810e-01   +9.670857570527668e-02   +2.008697212598762e-01   +4.911303350954445e-01   +1.166387506878913e-01   +6.076160555565724e-01   +1.721043618892311e-01   +2.131531402973712e-01; +3.412761246751064e-01   +5.141718683377468e-01   +1.304125986940648e-02   +7.774505284786557e-01   +7.954055198506134e-01   +5.056673689100735e-01   +5.227600840638987e-01   +7.374445438302726e-02   -3.699497925131501e-02   +2.052490359523838e-01   +3.835529244298640e-01   +6.387426589931658e-02];
L2E_Input1_iAMPA_netcon = [+6.877280269924561e-01   +6.498988148702711e-01   +8.962256831335895e-01   +8.367183252771003e-01   +8.826381864927999e-01   +9.631120268206561e-01   +8.383326808933236e-01   +7.507873125329296e-01];
L2I_Input2_iAMPA_netcon = [+8.416610685034548e-01   +5.757907787124726e-01   +1.000000000000000e+00   +5.936587010075747e-01   +4.936145746196113e-01   +9.451768122727464e-01   +7.889651751892238e-01   +7.456355441081010e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
