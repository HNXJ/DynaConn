function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.407058093372609e-02   +8.258788371103654e-02   +5.295409162274548e-02   -1.672874736552741e-02   +6.497751168652308e-02   +3.059154095089854e-02   +4.267690466352021e-02   +2.776899559464246e-02   -7.184199299818991e-03   +2.498098757569555e-02   +5.052567388245748e-02   +7.682605973116029e-02   +3.214203626345141e-03   +7.535675129616975e-05   +1.125859973876046e-01   +1.692404041830683e-02; +1.375720570539035e-02   -5.001136700344844e-02   +7.431202832935756e-03   +1.195339427098133e-01   +8.295341386791011e-02   +7.985580935446948e-02   -7.169081170760150e-03   +7.049954077028593e-03   +6.856196656460618e-02   +3.702962258990275e-02   +5.101350995941715e-02   +6.133805638377937e-02   +7.389620573143478e-02   +3.172972735224398e-02   +3.928020729161534e-04   +3.563918995701040e-02; +6.127589204026713e-02   +7.843421132309145e-02   +1.425628285903066e-02   -1.550909307956701e-02   -2.834819589245252e-05   +7.074678951675370e-02   -1.541892386248308e-02   -6.505231070080727e-03   +5.733742918008275e-02   +4.061201824335682e-02   -6.453892130470684e-02   +4.495237976657733e-02   -4.281685927070535e-02   +6.706153492182419e-02   +7.213220748238328e-02   +3.558472125834609e-02; +2.827563388467798e-02   +1.034176674842190e-01   +4.140612655030478e-02   +1.070857136071531e-01   +5.386559988977260e-02   +4.469112174397481e-02   +2.947026339224891e-02   +5.654914673500416e-02   +4.538500669023809e-02   +4.261413057266345e-02   -1.296501287668415e-02   -4.079042516086819e-02   +5.257537261220584e-02   -7.828966641159701e-02   +6.231820081352497e-02   +8.987396425430179e-02; +1.260439906720413e-02   +2.302409937294155e-02   +1.152271591790772e-01   +7.314019488498899e-02   +3.365944400560379e-02   +5.902973083022221e-02   +5.032371306191492e-02   +5.292875364738773e-02   -3.116267703496030e-02   +1.928346709379438e-02   -1.570824447068125e-02   -2.026949960584518e-02   +3.830123378211095e-02   +1.890767762464090e-02   +7.737329762611830e-02   +1.203698642836653e-01; +8.240329552265116e-02   +7.559557877568308e-02   -5.192807646145765e-02   +6.031147536443346e-02   +3.935507777079592e-02   -2.168162908773744e-03   +7.828155149829250e-02   +6.396548332137413e-03   +3.942922533473182e-02   +3.350450689882436e-02   +1.584447266576539e-01   +9.652729769866768e-02   -4.171210076963271e-02   -4.835528831411498e-03   +1.054628977566845e-02   -8.521996374299609e-03; -1.830110145322273e-02   -3.709477580121888e-02   +8.133149598591544e-02   +6.427903595447369e-02   +7.327688697563947e-02   -2.644348263634200e-02   +9.416848143782562e-02   -3.128667612849784e-02   +1.386286264433622e-01   +2.855404695828322e-02   +1.239280968717819e-02   +2.785194112410154e-02   +4.653428677644966e-02   +7.483648950227928e-02   +2.514555966874231e-02   +8.845298960537648e-02; +3.273786892793180e-02   +7.547451670801153e-02   +4.256269487344809e-02   +2.833561580795562e-02   +4.950633008294248e-03   +1.133370719443247e-01   +5.331442127513814e-02   -1.749627061089528e-02   -7.209210174670400e-02   -9.512008108122938e-03   +1.255634273518542e-01   +2.211902843141872e-02   +2.890634385292717e-02   -3.083998565236697e-02   +2.971641154861627e-02   -2.958695936746502e-02; +3.873288798632293e-02   +1.748675962647112e-02   +2.206315878616300e-02   +3.089685792921663e-02   +9.712277821576028e-02   -2.424216466973323e-02   -6.415442744678820e-03   +3.157456507708147e-02   -1.226647621218351e-02   -3.771138719927238e-02   +1.128839066443645e-01   +4.988640492865259e-02   +4.432403847777609e-02   +5.622014506467614e-02   -3.308501792914325e-04   +9.639640128872695e-02; +4.918483457506858e-02   +9.947996599603347e-02   +3.767386376505762e-02   +8.953574251477218e-02   +2.648340200009643e-02   +1.217868384500739e-01   -2.721186113145305e-02   +3.672402649914872e-02   -2.577312461624527e-02   +8.642274800788802e-02   +9.157896047670031e-02   +7.898071401069580e-02   +1.408997539207997e-01   +2.265866530956253e-02   +5.222640694890198e-02   +1.251561211200099e-02; +3.918733037648994e-02   -2.800278092078598e-03   +2.383276705510980e-02   +1.255444837577705e-02   +6.099941769077194e-02   +1.458787240507854e-01   +4.010188772082598e-02   +2.010410425259545e-02   +7.397504826519426e-02   +1.176680659519052e-02   -1.011591748941192e-02   +2.361143067147219e-02   +1.204901502683781e-01   -9.440541485029819e-03   +2.420657819436538e-02   +5.066807343626334e-02; -6.177365507660151e-03   +7.039263347507595e-02   -1.556722112554029e-04   +4.965095195490387e-02   -8.128689044509647e-03   -1.417935025443215e-02   +7.650975274585110e-02   +7.933379630037547e-02   +9.972251851900375e-02   -2.429555811691219e-02   +8.153520497408655e-02   +4.427117096126448e-05   +3.522370427021013e-02   +4.561245005747534e-02   +8.417808562830925e-02   +1.140043269559942e-01; +9.850806466703999e-02   +9.992272959631515e-02   +3.421837725141461e-02   +2.585790234794135e-02   +6.014272977444299e-02   +3.962949475361393e-02   +4.713482729368300e-02   -8.776486476845600e-04   +3.916243802361552e-02   +8.645611027596115e-02   +8.681148790932734e-02   +2.112381067196997e-03   +1.131562789092844e-02   -1.490264287688371e-02   +4.385088918186306e-02   -4.858194755239006e-02; +1.141770969000443e-01   -3.061773366836396e-02   +2.529617666351686e-02   +1.130846214379402e-01   +9.804847801685979e-02   +7.257461243380181e-02   +6.544368893486772e-02   -3.748450484636177e-02   +7.763289890676348e-02   +5.301821135082831e-02   +6.468344099301150e-02   +7.434478993699317e-02   +7.177816115633827e-02   +5.980467928148568e-02   +8.230826763277041e-02   +1.243025895841482e-01; +6.800059490402237e-02   +3.659496548687044e-02   +4.416450232247734e-02   +3.558886756346106e-02   +5.162773992441826e-02   -1.536741213440219e-02   +2.163341999441587e-02   +7.115447196017499e-02   +7.976713443639996e-02   +2.153192650983253e-02   +4.950116665847711e-02   -3.568924209077530e-02   +9.950446002123350e-02   +6.188355696527691e-02   +7.593623527321703e-03   +1.734331948161132e-02; +9.621134629018202e-02   +2.262685818165931e-02   +3.559613693792851e-02   +6.906451739872133e-03   +1.243147546629329e-01   +8.818299127338371e-02   +5.455026781982702e-02   +3.347704888202744e-02   +6.663018919045345e-02   +1.616438558375204e-02   +6.342048853409057e-02   +2.660715165884153e-02   +8.709170268565317e-02   +5.616279179019774e-02   +2.963566907997957e-02   +6.403916718082617e-02];
L1E_L1I_iGABA_netcon = [+3.795671275036449e-02   +1.392188053276734e-01   +3.529796126223044e-02   +8.338116690093293e-02   +1.348595955977309e-03   +2.085753481140431e-02   +5.516907212807597e-02   -7.004451922650569e-03   +8.826043018130771e-02   +1.962533981812755e-03   +1.083971710684464e-02   +8.303854556613519e-03   +4.822848408756308e-02   +6.015858859839911e-02   +3.082871354015330e-02   +7.248296322209033e-02; +5.345752576590686e-02   -3.278194494673594e-02   +9.435720623603433e-02   +1.980599237516948e-02   -6.528213623864412e-02   +4.036417382812244e-03   +1.033286301279955e-02   +5.307236247488521e-02   +7.321569489205594e-03   -5.964627027019470e-02   +5.777304791426316e-02   +2.921973166956904e-02   +5.208108972799177e-02   +2.932461325584437e-02   +4.323782504923669e-02   +7.700710171706969e-02; -3.350583556201898e-02   +9.868260758051998e-02   +4.586886790439105e-03   -9.611195075201555e-03   -5.621704500385134e-03   -2.168166174475801e-03   +9.174145728555547e-02   +6.545930619936634e-02   -1.398772050028389e-02   +9.986462136629643e-03   +6.496913429995796e-02   +6.966264081673568e-02   +6.829346524975223e-02   +5.955395119479071e-03   +5.774270492837414e-02   +3.407092408985157e-02; +8.367484839671288e-02   +5.275495419684972e-02   +7.403267339176364e-02   -5.987697691225845e-02   +6.667502434086234e-02   +9.795982997814318e-02   +3.076593706715271e-02   +4.723529000439933e-02   +3.900892195443031e-02   +7.575591854509323e-02   +8.376116317640381e-02   +7.569519260537039e-02   +8.385899985933006e-02   +4.065397404711346e-02   +6.894592770314158e-02   +2.357271095973260e-02; +4.331251848461182e-02   +5.357678779865494e-02   +1.016148726167619e-01   +7.371557845456995e-02   +3.920310501963129e-02   +7.261749107588522e-02   +6.916667050417602e-02   +3.495094169360266e-02   +9.634968871145248e-02   +3.682055514609803e-02   +7.497788981033637e-02   +1.771507243124098e-02   -1.293355601245478e-02   -2.220552904490276e-02   +5.934638115530473e-02   +4.917965337832599e-02; +9.378832865490555e-02   +1.403872302260619e-02   +3.514507136553748e-02   +6.576220266678381e-02   +6.493371234110790e-02   -2.231270506564628e-02   +4.572905674540953e-03   +4.065839698960586e-03   +1.432186764609193e-01   +7.622586850578075e-02   +5.614276385226112e-02   -5.424760099941410e-04   +9.461617938001733e-02   -6.674773493043677e-02   +3.855343176300936e-02   +4.602289072960022e-02; -1.245982164794963e-02   +3.987659932480286e-02   +9.115012170490648e-02   +6.469454760012695e-02   +4.593911571341593e-02   +4.363721858320623e-02   +5.704638635344357e-02   +5.687949289875833e-03   +1.024419404273053e-02   +2.324271388569224e-02   -7.829076147465202e-03   +8.766382403540834e-02   +2.498368019100483e-02   -2.746305404721519e-02   +1.394436120679429e-02   +5.999341342105155e-02; +1.010743792176960e-02   +7.888702046885143e-02   +2.956517894487040e-02   +2.578597913297689e-02   +2.534323878546748e-02   +7.921589168965000e-03   +2.248343314253439e-02   -4.907413967061820e-02   +5.162143247198663e-02   +2.875160314498841e-02   +2.884873618279019e-02   -1.496196990398633e-02   -1.800205787432903e-02   +4.884492659885198e-02   -4.919674641773369e-03   +1.434270669214708e-01; -1.427275994595572e-02   +7.519248035836000e-02   +5.579502199854908e-02   -4.129712551944568e-02   +3.680443368032491e-02   -1.664639530256785e-02   -4.926064314253675e-02   +2.182295943753708e-02   +5.468370140158822e-02   -1.952448516640435e-02   +3.937711891170537e-02   +5.095618928519636e-02   +4.651728630088215e-03   +9.215550569419544e-02   +3.967993720573269e-02   +9.520930840368147e-02; +4.903477234438815e-02   +7.720466408240048e-02   -1.659008055955889e-02   +4.042597807899568e-02   +1.900101806760324e-02   +5.598053036213811e-02   +1.298474621084323e-01   +4.049884334043069e-02   +8.680334212111879e-02   +2.630136518566005e-02   +6.736276829082824e-02   +7.499439444131636e-02   +2.147193081321134e-02   +1.099577417496110e-01   +1.088153877502633e-01   +1.832890382242974e-02; +2.861050220584240e-02   +2.344403690235205e-02   +1.698273162669234e-03   +7.990129104569342e-02   +4.488067312275284e-02   +1.178492905843951e-01   +1.421193969063178e-02   +4.507225248897749e-02   +6.740083290249099e-02   +6.362084368408094e-02   +5.264846914132709e-02   +9.667525856134214e-02   +3.708790153766067e-02   +6.386852000905997e-02   -3.156143971820216e-02   +9.381529552053419e-02; +2.601060215893842e-02   -7.191692464257035e-03   +3.009156772268513e-02   +6.705788374996534e-02   +4.804721716226303e-02   +2.158796615616111e-02   +5.517589816475491e-02   +8.649148894402198e-02   -4.115115192746185e-02   +5.575325415400356e-02   +2.445738298018148e-02   -6.127630058918884e-02   +3.819012888797091e-02   +5.704892793248439e-02   +4.770238521157720e-02   +8.233044026612144e-02; +2.326695239867725e-02   +3.640633953020836e-02   +8.609920483313131e-02   +3.089660366756430e-02   -2.885862580127227e-04   +1.174324299646132e-03   -6.166595868656300e-03   +5.733190742622045e-02   +7.619898497269970e-02   +3.818504650796344e-02   +6.740245923943501e-02   -1.183836000117696e-02   +6.690442555637398e-02   +7.479509335598759e-02   +6.916891394555608e-02   -2.043316967227499e-02; -6.204890780275776e-03   +6.551371934680134e-02   +2.474323937747522e-02   -6.853286096116985e-03   +3.347669074596289e-02   -5.097730668579259e-02   +4.225123117819474e-03   +4.313263983801007e-02   +1.117367240142841e-02   +9.553617306451186e-02   -4.569617095679940e-02   +5.595421610162919e-02   +4.211720513857093e-02   +7.726676943777672e-02   -6.149057602979882e-02   +9.149741891048628e-03; +3.908824917337979e-02   -7.339271625769185e-03   +1.349743295558483e-02   +6.339023949203332e-02   -2.164376521800385e-02   +5.780859617476176e-02   +5.920644072525678e-02   +2.347357716597652e-02   +1.035063328623874e-01   +4.898614717782961e-02   +1.855553658726819e-02   +8.059783510208482e-02   -5.640310401940994e-02   -3.456180285001384e-02   +5.088151674238649e-02   +9.511320184706092e-02; +9.797775102186847e-03   +2.304924046332106e-02   +4.426561098498025e-04   +2.627876825258172e-03   +1.203769390430109e-02   +1.362447111425619e-01   -2.122122619201326e-02   -4.183471882409345e-03   +1.115411931385041e-01   +6.280720208222554e-02   +1.032783390347768e-01   -6.840802917224852e-03   -2.392687824484634e-02   +1.064498865300309e-01   +3.941723017391292e-02   -2.806749423591468e-02];
L2I_L1I_iGABA_netcon = [+3.334612676902735e-02   +5.053230113544775e-02   -1.431004954658019e-02   +2.010820703509220e-02   +4.794318331027849e-02   -1.697690659044595e-02   +7.025814625843385e-02   +5.254767733689674e-02; +2.632509314932992e-02   +2.423670150490350e-02   +1.715164209961574e-02   +6.839853002491507e-02   -3.818788916961943e-02   +2.754527466911448e-02   +9.635240773324519e-02   +6.363733322982196e-02; -2.095117194347085e-02   +8.540716012409161e-03   +1.025241431938041e-01   +4.591062491325525e-02   +3.299181973936192e-02   +9.479836067858564e-03   +9.637150912745079e-02   +1.349286289577634e-02; +8.471069252642652e-02   +9.424002896162591e-02   +6.592496156182767e-02   -1.203809007038037e-03   +1.008365907978968e-01   +2.719857816276051e-03   +3.860558001645265e-02   +1.487790460718467e-01; +4.104438954040211e-02   +6.398855512588281e-02   -1.973637463227033e-03   -2.336960683512711e-03   +4.766996425957647e-02   +4.545041871915573e-02   -3.003379774351004e-02   +2.613392580284592e-02; +4.400344433188445e-02   +1.109726762115945e-01   +7.860393960226918e-02   -1.991578757436555e-03   +6.451968794321361e-02   +4.604348006644485e-02   +4.612893852983129e-02   +1.879184021388904e-03; +7.370237563273137e-02   +4.159735762682324e-02   -5.064197010821379e-02   +4.023891968305578e-02   +3.496804439912807e-02   -4.680640358360203e-02   -2.758998740091094e-02   +6.389854810763893e-02; -2.539463237799561e-02   +4.665403052043554e-02   -3.142598676031542e-02   +1.102701823644006e-01   +5.736346018557631e-02   -1.105467026085226e-02   +3.864120608980029e-02   +7.506264268925075e-03; -1.760138946341076e-03   +1.010116969736682e-01   +9.525660912380923e-03   +6.267520576457555e-02   +6.284629440081300e-02   +1.193519226230317e-02   +7.473376477956330e-02   +3.943978952770552e-02; +1.389601222043756e-03   +6.594937002500326e-02   -1.184367525411055e-02   +7.075650203904182e-02   +8.907779231168945e-02   -3.844827371315184e-02   +1.661660676051306e-02   -1.351000236834028e-02; +7.165547617634151e-02   +3.834028364891674e-02   +6.513389871056144e-02   +5.509565029352700e-02   +9.332569921989331e-03   -2.427702903890315e-02   +8.174542928641976e-02   +6.089960768910241e-02; +3.104195161295457e-02   +5.420788886159607e-02   -8.828719034298486e-04   +5.607556086974239e-02   +6.548662414309188e-02   +1.174836856664407e-01   +4.127441796140995e-02   +5.762254256611930e-02; -6.629459465800052e-03   -6.160453587516296e-02   -2.490026045993278e-02   +1.090955936221107e-01   +8.054275270769463e-02   +7.347199098567882e-02   -1.530675884397998e-02   -3.858200220866918e-02; -1.409871847510835e-02   -1.531095647031022e-02   +4.658445577149700e-02   -1.299751101804469e-02   +3.018134465090755e-02   +9.731750144033977e-03   +4.935892148098518e-02   +7.776486453898994e-02; +8.698585324833204e-03   +5.862181151472648e-03   +2.583132233359729e-02   +1.069948693590554e-01   +3.588037740663287e-02   +9.584348541266044e-02   +1.166926727186436e-01   +7.953343579395050e-02; +4.112334530636233e-02   +1.076050322746312e-01   +2.981142391392129e-03   +9.369333905792883e-02   +6.922722581000357e-02   +4.727146310163428e-02   +2.908532073892535e-02   +4.524539058453844e-03];
L1I_L2I_iGABA_netcon = [-3.400714637306036e-02   +3.821352567268146e-02   -1.101471432347374e-02   -5.349706949316634e-02   +1.001636975812876e-01   +5.788334468070958e-02   +5.927752023904467e-02   +1.093826171216136e-01   +4.536562299085303e-02   +1.009526179621908e-01   +7.028300880876143e-02   +5.275081856700570e-02   -1.916757253567189e-02   +2.090818020573419e-02   +3.005083401404186e-02   -2.955405197263539e-02; +9.849072355048054e-02   +3.351985087686844e-02   +1.953405325460546e-02   +2.360928595947548e-02   +4.089934071224914e-02   +5.432988815568376e-03   +7.315719483447186e-02   +7.870012910767067e-02   +9.425978045729022e-02   +7.189589911649008e-02   +5.156226558862639e-02   -3.000628840520432e-02   +1.090487117473609e-01   -1.353160264044230e-02   -2.081913510410197e-02   +5.563394189208029e-02; +5.137882004880803e-02   +5.501848615127638e-02   +9.969155704214569e-02   +6.127105991286762e-03   +8.384516901118959e-02   -2.396625587908866e-02   +5.602963146961590e-02   +3.019329868895035e-02   +1.384867791835676e-02   +1.070936666562712e-01   +7.620307586772133e-02   +7.330303692051053e-02   +8.689941845886923e-02   -3.915021781630455e-02   -9.367773832876160e-03   -2.381685440748543e-03; +5.762756861749301e-02   +4.930256354526576e-02   +4.744046743011440e-02   -8.555834825617094e-03   +6.741344674409951e-02   +6.830941519426996e-02   +2.566220783034606e-02   +7.007439685783354e-02   -1.728232808290706e-02   +8.597110114026948e-02   +1.004382011156357e-01   -4.560620720502530e-02   +7.342040191881363e-02   +4.298799295380590e-02   +1.684240732345504e-02   +9.687523657979032e-02; +3.224230431197513e-02   +3.322214999707379e-02   +8.083385835098655e-02   +5.691983890952192e-02   +1.252618164028014e-01   +1.029765342459988e-01   +1.483690818999707e-02   +3.061900140237536e-03   +8.007885947916103e-02   +2.796954352221703e-02   +1.487279324053196e-02   +3.472858977535120e-02   +4.674969090603784e-02   -6.015562485934583e-03   +6.836172072337522e-02   +6.232126278456138e-02; -8.927671918934239e-04   +4.303933814801990e-02   -5.321118798023146e-02   +7.514344622195598e-02   +1.045554053210839e-01   +6.330567813954271e-02   -4.710494120826096e-04   +1.652131782533766e-02   +2.921946873602692e-02   +1.419037851758445e-02   +6.024335785632507e-02   +1.374016928520710e-02   -6.139272799371943e-02   +6.345530873099570e-02   +2.175594181259846e-02   +1.517247336554796e-01; +3.984469463060079e-02   +3.522989409426189e-02   +7.124134865699763e-02   +6.481931019882589e-02   -8.138620589342182e-03   +9.025916672210170e-02   +3.305248939556371e-02   -7.948155792528232e-03   +4.241811676741675e-02   +6.239716121774001e-02   +5.138561710616640e-02   +4.778645282463791e-02   +3.624269149413632e-02   +9.025954501494068e-03   +6.518831777972717e-02   +5.395269649572316e-02; +4.746905667113047e-02   +2.923948988070986e-02   +5.649066613442267e-02   +2.294033285818358e-02   +2.231348807267170e-02   +9.007231231394898e-02   +6.875609262141036e-02   -3.123718264537272e-02   +1.024360043171921e-01   +6.711050107556085e-02   +9.493940586541462e-02   +3.685380023323757e-02   +2.963927879291004e-02   +7.794717176798509e-03   +4.247236136162330e-02   -6.215418377193353e-02];
L2E_L1E_iAMPA_netcon = [+2.181718693106798e-02   +9.602937992197480e-02   +6.455121268632366e-02   +8.630695771184083e-02   -1.278705688697715e-02   +9.381013147846262e-03   +8.494982359994321e-02   +2.915903376710502e-02; -3.897877075962643e-02   +2.377513498068327e-02   +4.792745668779594e-02   -2.949958596732225e-02   +3.295151192359982e-02   +1.085776880895724e-02   +2.072153908526483e-02   -5.049928816085903e-02; -4.119327507059037e-02   +1.220001795656785e-02   +9.736256483422989e-02   +9.554797688940968e-02   +6.855188449744727e-03   +4.264626837511562e-02   +9.118434508821530e-02   -4.294266751263406e-02; +7.275682815755137e-02   -1.691036009093504e-02   -3.634511560870213e-02   +5.383359536526735e-02   +8.285843765456347e-03   +5.669171200953197e-02   +3.957922653571411e-02   -5.578476662061922e-02; +1.203517582140931e-01   +1.181151080622571e-01   +3.908506222455366e-02   +2.906112834772501e-02   +8.073674634945618e-02   +9.450071635027714e-02   -4.717099450550068e-03   -5.834672924528845e-02; +1.004997407099482e-01   +5.693673055436532e-02   +1.158254606554816e-02   +3.508062675618197e-02   -1.785486835864321e-02   +7.344129955486473e-02   +9.560031642360399e-02   +2.664321753800765e-02; -1.086176788089892e-02   +7.785904455936021e-02   +1.369584103261013e-02   +5.840687477073907e-02   +1.413109500632315e-02   +9.599950718194961e-02   +7.414195695328549e-02   +1.089277530369844e-01; +6.654602495261802e-02   +1.483611472498931e-01   +1.016191414490665e-01   +3.764771185562824e-02   +9.177029588187614e-02   +2.946532344305793e-02   +4.436936996344001e-02   +8.938996955588314e-02; +9.757425903057698e-02   +6.789168723287033e-03   -2.958863410968021e-02   +3.866279083104255e-02   +1.322836611008316e-01   +3.419350457943646e-02   +6.584379775744284e-02   +9.496001988223546e-02; -5.830159090034547e-03   +5.577430812365977e-02   +5.369481046194916e-02   +4.517974300961402e-02   +8.904247333208200e-02   +3.936852633043283e-02   -5.517043214126691e-02   +2.842762810719671e-02; +6.212072781277155e-02   +6.984724092596749e-02   -2.107470607267588e-02   +4.165346792316262e-02   +1.896612070291250e-02   +5.940886938382976e-02   +6.924309807429757e-02   -3.462045864071969e-02; +5.540101584910384e-02   +2.811615265065019e-02   +3.305727070461362e-02   +5.422007842516810e-02   +5.889066126389299e-02   +9.991406555496933e-02   -7.563059212283202e-03   +7.806102252183983e-02; +5.762216426224007e-02   +9.274424748997673e-02   +9.476824124891618e-02   +2.577613709120940e-02   +8.579215578875482e-02   -1.551023303832124e-02   +1.248551002532267e-01   +7.502210964716673e-02; +5.638782415561271e-02   +1.662117242200448e-02   +7.126813924715183e-02   +7.210116500329922e-02   -3.991525434753451e-03   +6.638457800537248e-02   +3.466223500067145e-02   +5.841410421479144e-02; +3.573857674362470e-02   +7.830070089545713e-02   -6.488117331660159e-02   +6.662566077853623e-03   +8.946445076737128e-03   +3.260996057171894e-03   +3.848295099792089e-02   +5.271929880831205e-02; +3.562522898696874e-02   +5.863541231487625e-02   +3.597662760402347e-02   +1.384884992407687e-02   +1.554643654645467e-02   -5.326687282894627e-02   +7.442622975299454e-02   +3.058285274984102e-02];
L1E_L2E_iAMPA_netcon = [-3.614330969088431e-02   +6.205166683590761e-02   +7.767337002082808e-02   +7.145413703273190e-02   +5.891792922659447e-02   +7.958336813974770e-02   +1.131329842132356e-02   +9.104736498212851e-02   +1.191281273026400e-01   -3.881855668277335e-02   +7.862673768751485e-02   -4.426051703577463e-02   +4.376109582842240e-02   -3.071488303455258e-02   +5.075790777554421e-02   +1.012235548511700e-01; +5.255273832928607e-02   +3.020611051455959e-02   +2.212042257483789e-02   +3.009989328399226e-02   +5.482923326149458e-02   +1.780425897652298e-02   +4.742226696774785e-02   -4.301446357776323e-02   -2.142995785081728e-02   -7.258598338931783e-02   -6.340506849023370e-02   -2.570550882494330e-02   +6.486686284147414e-02   -3.686506936149770e-02   +1.208794405692687e-02   +2.402541796688575e-02; +2.842220345482095e-02   +2.523326591736269e-02   +1.055139606905681e-01   +4.397744518778615e-02   +6.805669814346854e-02   +3.008707377468522e-02   -1.997170245443252e-02   +6.148835130452544e-02   +5.838597968212744e-02   -1.956796243934376e-02   -1.056885549591804e-02   +5.178785008380554e-02   -2.532404821331245e-02   +3.152173634031716e-02   +3.785356893886105e-02   +7.847190414611578e-02; +2.334028770600164e-02   +2.939033435875718e-03   +1.100513544072959e-02   +1.430413924967233e-01   -5.190169100249831e-05   +1.828837792408194e-02   +1.461710429176012e-02   +1.843149955334593e-02   +9.828635590010243e-02   +1.257211442501346e-01   +2.970319615046379e-02   -2.044708855935382e-02   +4.494024906780669e-02   -9.699197253460475e-03   +6.673491946912941e-02   +1.202264773571741e-01; +5.221428495312671e-02   +4.829178355912182e-02   -2.621802652939587e-02   +2.206292978539357e-02   +1.073365801722900e-01   +1.447083029901469e-01   +1.076020451442042e-01   +6.162728832619467e-02   +1.944120985075522e-02   +2.270657203544503e-02   +1.446009477125628e-01   +1.839334747524837e-02   +5.065228763830618e-03   +6.648035459479912e-02   +4.051632928250331e-02   +8.709815221317828e-03; +6.657110151726613e-02   +1.613029470189577e-02   +6.576569021791855e-03   +1.849970068664021e-02   +1.749927522558503e-02   +4.058226776981645e-02   +1.063975280798877e-02   +5.203793320209567e-02   +1.078225661240759e-01   +4.067994043628991e-02   +2.619181952842987e-02   -1.855009297929439e-02   +8.127647905026873e-02   +2.585855973707458e-02   +6.746896749620980e-02   +3.577062587173792e-02; +1.746836148531610e-02   +2.617777274647468e-03   +1.822570901567501e-02   +5.462645255914102e-02   +7.448307862027727e-02   -2.696281745187387e-02   +2.838425625452504e-02   +2.328536749987423e-02   +3.336680718156303e-02   +5.236519559535614e-03   +7.031213717724496e-03   -1.216892779250405e-02   +4.064760484308873e-02   +2.915997969728288e-02   +1.186350079480131e-01   +7.842012544335245e-02; -2.523204172735518e-02   -5.282632124410190e-02   +1.001164447671807e-01   +4.601908100125290e-02   +4.999155083487596e-02   +8.486238146425508e-02   +7.076689400603113e-02   -2.050221706582969e-02   +4.594319222572343e-04   +8.466172021340164e-02   +1.184928107238838e-01   +1.721543215803097e-02   +6.688735381679309e-02   +1.425243867935964e-02   +7.060746649145896e-02   +4.389949382750109e-02];
L2I_L2E_iAMPA_netcon = [+1.438462109389404e-02   +3.624699301529233e-02   -8.304261356233389e-03   -1.004791524489732e-02   +8.960241673826580e-02   +7.179128191105985e-02   -1.869150835977105e-02   +7.219966559610232e-02; -3.210316806388674e-03   +9.138734949839900e-02   +6.739292656225275e-02   -2.454339730313513e-02   -1.997721731698534e-02   +8.891398410575681e-02   -1.108193735230622e-02   +1.535319230669624e-04; +5.346908717642276e-04   +4.650650501438997e-02   -2.033635772106641e-02   -7.432128317681806e-03   +7.312938199296642e-02   +9.775858243393480e-02   +5.695853757113498e-02   +2.701999436679242e-02; +1.210408141035752e-02   +6.459382779745163e-02   +3.495482511884090e-02   +8.314408545772208e-03   +7.578443736020050e-02   +5.547526852580229e-02   +6.418749572574964e-02   +6.442259955718255e-02; +2.925485794575930e-02   +9.209169686720804e-02   +6.095604735640983e-03   -6.377113344636856e-03   +3.495207874685774e-02   +4.501406451136376e-02   +6.405790086825289e-02   +1.281656584627834e-01; +1.080693385292850e-02   +2.028615653056980e-02   +6.060277400969234e-02   +1.372464736834803e-02   +9.012060007595815e-02   +4.732263003241524e-02   +4.106577862588719e-02   +7.786875262149403e-03; -3.246667257668118e-02   +2.806301034760455e-02   +5.330311225491180e-02   +6.582009720062422e-02   -6.134540948614571e-02   +7.827925662341020e-02   -1.935001960740996e-02   +7.652853216824004e-02; -1.734026914454638e-02   +3.190854897978247e-02   +9.435098754738816e-02   +6.178984997966479e-02   +5.320356487385543e-02   +4.241836084049964e-02   +2.944903426730728e-02   -6.757422368513396e-03];
L2E_L2I_iGABA_netcon = [+6.196296271323375e-02   +5.993272475320845e-02   +9.953067221377624e-03   -1.385534891886668e-02   +1.562012015391404e-02   +6.576176668296277e-02   +6.080415170964968e-02   -5.024616837158292e-02; +1.370213280372773e-01   +3.184003344315937e-02   +1.122073272126247e-02   +7.034329016555924e-02   +1.417312624460564e-02   -4.483694148762415e-03   +3.268211370610657e-02   +5.646790516165850e-02; +3.094101150002446e-02   +8.089731989106953e-02   +4.131244924377107e-02   +2.754633011528271e-02   +3.736435404720590e-02   +9.227546441135860e-02   +1.736027059717233e-02   +1.239715259260265e-02; +5.808463513777764e-02   +4.345691026306054e-02   +6.317483713711469e-02   +1.997746170128320e-02   +4.480735838585852e-02   +1.326493917745549e-01   +1.967296548520948e-02   +6.171539554578988e-02; +5.466253579350672e-02   +4.680053708563764e-02   +3.851106956639475e-02   +1.755098108609885e-02   +4.372090912099492e-02   +2.638306983847872e-02   +1.002851566689185e-01   +8.488241363880229e-03; +7.678041380933272e-02   +5.791365902299365e-02   +5.590159114306177e-02   +3.144269372931999e-03   +3.463620708777766e-02   +9.207334622405652e-02   +4.616448962720800e-02   -7.063689571189580e-02; +7.897939653522565e-02   +1.176047982861519e-02   +4.080645632197827e-02   +2.386797732779265e-02   +3.477884852515838e-02   +1.007012811289883e-02   +1.007855829468236e-02   -5.593147904076462e-02; +1.570462370480593e-02   -1.823730645573275e-02   -1.529923716274744e-02   +3.436836747546955e-02   +1.832155064430142e-02   +5.486678216339357e-02   +1.079107902062309e-02   +6.132531587920174e-02];
L3E_L2E_iAMPA_netcon = [-3.961859158372166e-02   +3.572760248158675e-02   -1.830028039971857e-03   +2.191607493147566e-02   +7.997216017237316e-02   +4.119572719356677e-02   +8.054300786267056e-02   +6.985812078746344e-03   -1.402020411201815e-02   +1.044770729407470e-01   +8.448448073409287e-02   +6.972809823629356e-03; -2.051142011977907e-02   +5.279833315966878e-02   +3.388204453252537e-02   +2.595366150877784e-02   +4.635436499167911e-02   +1.119019702962444e-01   +1.551394670189232e-02   +7.006953975035927e-03   +6.786529266588907e-02   -1.577300798809928e-02   +8.709201374665362e-02   +2.052486833807826e-02; +6.815549227834512e-02   +9.977312749522672e-02   +5.882068921517994e-02   +4.712742092297288e-02   -4.541382929723285e-03   +2.578399375699727e-02   +8.601023291272222e-02   +3.215622813161410e-02   +4.959550380198650e-03   +8.827535629569225e-02   +3.902934229994150e-02   +4.402497545246693e-02; +1.828866594277226e-02   +8.956674902928460e-02   +9.110850035532611e-02   +2.358406091781200e-02   +2.019182287874844e-02   +3.261988235787994e-02   +2.628792334794109e-02   +4.296284721240598e-02   -5.596496097716024e-02   +7.702424968870070e-02   +6.066713420637276e-02   -9.876469707952005e-03; -2.170480495632243e-02   +6.152034090269550e-02   +1.338767485237748e-01   +8.832566941497509e-02   +2.904532726196858e-02   +7.398619682292795e-02   +5.129741644464969e-02   +7.869256670024563e-02   +3.296386666872986e-02   +4.270326488348505e-02   +9.495080620877033e-02   +2.926327123764876e-03; +7.306768913048745e-02   +1.252263370149096e-02   -2.655614258961405e-04   +8.831420351839600e-02   +1.064631238288254e-01   +1.065531699333484e-02   +1.092804606402693e-01   +7.071534126686135e-02   +4.599435896857129e-02   +1.650796669961655e-02   +2.362142674020920e-02   -6.356982492788370e-02; +8.771295383376601e-02   +6.100786718907848e-02   +5.876383709622628e-02   +1.333507873171950e-02   -1.628205342990527e-02   +5.853425231679060e-02   +1.580682668971636e-02   -4.415345239689991e-03   +3.348006447634678e-02   +6.507390415532514e-02   +1.194046203986793e-01   +1.054365674828234e-01; -1.406956929461049e-02   +5.699488060850538e-02   +3.971284457831141e-02   +4.603441298458807e-02   +6.248858960871653e-02   +9.267689620348331e-03   -1.373385408079519e-03   -4.175633994963460e-02   +3.826348701976515e-02   -2.317338853515698e-03   -8.377860672163404e-03   +6.960633345393047e-03];
L3I_L2I_iGABA_netcon = [+1.141705452597154e-01   +7.965537671767897e-02   -5.378762687539419e-02   +5.925847318487652e-02   +2.468801160961271e-02   +1.238762827017608e-02   +3.169781223034462e-02   +5.446367271533756e-02   +5.054185073072177e-02   +3.279216572407041e-02   +9.479574543874868e-02   -3.522652355991366e-02; +3.880902025314355e-02   +1.617493590065926e-02   +2.055445319176798e-02   +2.592106597774885e-02   -5.612653695696152e-03   +6.720337238089648e-02   +6.979013948805803e-02   +4.585977917474307e-02   -2.097504262487482e-02   +8.560603199093719e-02   +4.722659022443965e-02   -8.440224624442560e-02; +3.582837360111786e-02   +1.321585394843287e-01   +4.930636441446890e-02   +5.887088060166114e-02   +9.568668243745290e-02   +2.957296308815763e-02   +7.981831773522743e-02   +2.550810536595117e-02   +1.297346903820276e-01   -2.209818871260780e-02   +4.920035210635632e-02   +8.998510542823485e-02; +4.849406418125838e-02   +6.180225375241768e-02   +1.196584607038814e-01   -3.350207984862451e-02   +1.142962517789937e-01   +4.904488038858459e-02   -4.578327168955867e-02   +5.540037088549986e-02   +1.146791598753478e-01   +3.341742187429241e-03   -2.500081327816333e-02   +1.171154094113494e-01; +2.449352466408263e-02   +3.473299891848747e-02   +1.102343358675982e-01   +6.718904922519860e-02   +1.184405500962986e-01   +1.608795078285809e-02   -1.309299565564494e-02   +1.095970562563358e-01   -6.910997881881023e-03   -1.193031364123174e-02   +5.016826656011469e-03   +9.148119112548771e-02; +6.174623532200430e-02   +8.926194773569347e-02   +3.954127444890874e-02   +4.680805394843339e-02   +6.577672056880418e-02   +7.330938634664486e-02   +9.294816655193446e-03   +2.838526484513026e-02   -2.686373313611931e-02   +4.832698624858214e-02   +4.514078967323493e-02   -1.998245895034905e-02; +1.537237497212512e-02   +6.677074551858328e-02   +4.552391782008121e-02   +8.981497675048580e-02   +1.403599326801834e-02   +6.531027700402513e-02   -4.033218912615851e-03   -8.806170090043496e-04   -1.876626246304372e-02   +6.001272291643694e-02   +6.842465926697205e-02   +7.961633364341525e-02; +5.667872350567267e-02   -9.515504524973611e-03   +5.372073854727011e-02   -3.021555115752865e-02   +8.013198350649756e-02   +9.565871505723729e-02   +6.927265679670488e-02   +6.321232074071087e-02   +3.000878199834956e-02   +1.003708064447008e-01   +3.675882483767783e-03   +2.500712207800674e-02];
L2E_L3E_iAMPA_netcon = [+1.046788299334055e-01   +3.341466713896948e-02   +7.463592344053668e-02   -7.818556899808794e-04   -5.629958259483876e-03   +6.159238680447072e-02   -1.545662841352694e-02   -1.284278023007203e-02; +6.370476805435954e-02   +9.130745262196742e-02   +9.474605038657877e-02   -3.972461383564348e-02   +1.355713773281209e-01   +6.069447369545347e-02   +3.132897729666781e-02   +5.671724421663081e-02; -9.924893294089861e-03   -1.667687214495679e-03   +1.035600720963342e-02   +6.339266774499369e-02   +1.087593096448166e-02   +7.552501734838014e-02   +8.309872935290261e-02   +2.503521850895592e-02; +9.871147212345025e-03   +2.095553420923673e-02   +4.090515805060774e-02   +1.355709457518246e-01   +7.167760854348802e-02   +1.102836055084255e-01   +5.128666095787369e-02   +5.030724466847253e-02; +7.538149788091954e-02   +1.067459703071374e-01   +8.531239194938997e-02   +1.367358161932225e-02   +7.229071194494419e-02   -3.266712913287229e-02   +6.056426756161216e-02   -7.012047973056029e-03; -1.353973293747980e-02   +9.976512757156403e-02   +3.217865882122213e-02   +1.990286668356795e-02   +1.009354095265781e-01   +3.747849818783115e-02   +6.733175181923204e-02   +7.070386396977460e-02; +2.427560851569986e-02   +2.094713458278632e-03   -9.075892949777037e-03   +1.808882758801688e-02   +4.556034462203980e-02   +2.576115470957161e-02   -2.857339879240358e-02   +3.980696341826856e-02; -1.168563992425317e-02   -3.782975446472511e-02   -2.020518110127242e-02   +1.517995038526701e-02   +5.942979625723284e-02   -1.956695297038778e-02   +2.725354037623860e-02   +4.815115196043573e-02; +5.529328516859701e-02   +4.130633926098001e-02   +1.958379338162457e-02   +6.913771606592257e-02   -9.089281547855089e-03   +1.314852277796912e-02   +6.294243238632447e-02   +9.173467571568630e-02; -2.599752614233741e-02   +8.753055520793715e-03   +1.208308462421045e-02   +1.595301652276206e-02   -1.601383930873843e-02   +3.549633768996700e-03   -1.394126996449453e-02   +4.847306234526609e-03; +5.587450567631556e-02   +6.547609267682046e-03   +4.566252631382457e-02   +7.284477855863154e-02   -2.545850328481601e-02   -5.118968713147981e-03   -1.490137683501084e-02   +5.287495783139437e-02; +2.794230785110319e-03   +1.182000442641707e-02   +1.005572536150953e-01   +6.541040648380450e-02   +5.641011027482962e-03   +2.663150514953105e-03   +3.753733471081563e-02   +8.051262766056838e-02];
L2I_L3I_iGABA_netcon = [+2.873390052313329e-02   +4.809102445491031e-03   +2.200759780741820e-02   +4.657374857288996e-02   +8.031696100082787e-02   -1.009325391552421e-03   -4.583580265135587e-02   +4.966161241181011e-02; +2.210326882254126e-02   +9.761259701690225e-02   -1.256525096918949e-02   +5.312301876793937e-02   -2.404029660467637e-02   +3.821665051063619e-02   +4.202060077340120e-02   +7.494028904196207e-03; +3.072878782418766e-02   +6.671074879950326e-02   +7.404809347398242e-02   +4.455074581200667e-02   -1.995847264567307e-02   -7.949912836655269e-03   +7.113384806274427e-02   +7.606795250380639e-02; +7.018437558435583e-02   +1.421867956469584e-02   +6.267930047882400e-02   +9.913128740788388e-02   +3.231517806740497e-02   -3.913305144506210e-03   +6.074504031609140e-02   +5.752742263796306e-02; +6.960697784898258e-02   +9.741245854055292e-02   +8.275023248685996e-02   +3.851845142540904e-02   +3.090936696707599e-02   +5.812540986925188e-02   +5.771090309195845e-02   +5.817593115297651e-02; +3.478616990995084e-02   +4.036204676187641e-02   +1.014177620077859e-02   +4.947224303437171e-02   +5.599692625531025e-02   -5.171818019296247e-03   +4.985825978079416e-02   +3.350362155057299e-02; +7.358655610516203e-02   +2.976964517330024e-02   +1.296692584389751e-02   +3.940236977827965e-02   +4.222359202833213e-02   -1.087136986417316e-02   -3.405035327668636e-02   +3.075541467776832e-02; -6.639616150987600e-03   -3.864848749269086e-02   +6.636225185988104e-02   +7.938686505019410e-02   +6.075370357382278e-02   -5.471488790838357e-03   +2.527806835717709e-02   +1.287161970505592e-02; +1.904748656784606e-02   -1.485029531272279e-02   +8.344161591612341e-02   +5.920168502367174e-02   +6.185406174573424e-02   +6.938331110590455e-02   +4.373476753155967e-02   +1.027971686947674e-01; -1.794014129543179e-02   +9.437451614796800e-03   -4.100851859203122e-02   +3.218289109099693e-02   +1.125911275246649e-01   -4.214986643382546e-02   +5.682570257460680e-02   +4.738006064394293e-02; -3.082154426485721e-02   +8.518209655391359e-02   +3.459311604951787e-03   +4.402012456858849e-02   -4.475175348094870e-03   +3.228523340800576e-02   +4.471655927623706e-02   -7.419802433095674e-03; -3.370472170476875e-02   +3.592746151952485e-02   -9.484999271146870e-03   -1.973395133453951e-02   +3.967525676218718e-02   +5.195225021229528e-02   +3.590846083708948e-02   -1.098706786071376e-02];
L3I_L3E_iAMPA_netcon = [+1.846205299621507e-02   +1.546332003323507e-02   +6.542162589115104e-02   +7.998232662536665e-02   -5.705030237958585e-02   +7.498191865227256e-02   +1.021133322782348e-01   -5.404997567742854e-02   -7.725976599543206e-03   -7.776497612150818e-03   +9.312738525849025e-02   -1.268871383332786e-02; +8.105298589997453e-02   -5.275036689212045e-02   -9.511931200053525e-03   +2.111677619054817e-02   +5.995201712236557e-02   +1.318974603951670e-02   +1.001023563352816e-01   +8.241176231765872e-02   +5.253780715850133e-02   -1.829081251322642e-02   +6.391122071595162e-02   +1.272228960661110e-01; -5.350535646978729e-02   +6.931376970037380e-02   -1.364036163977508e-02   -2.897383416280005e-02   +3.156686069124010e-02   +8.587164259662590e-02   +1.958430241441141e-02   +9.533638987698316e-04   +2.372175463303657e-03   +7.320738589734699e-02   +2.627884059917490e-02   +4.158982954631549e-02; +2.245623947052033e-02   +1.263310235473666e-02   -1.648229662743925e-02   +7.989757977174690e-02   -1.588637494350920e-02   +2.760766815687128e-02   +5.180566577160301e-02   +4.184237852458349e-02   +5.879691484195632e-02   +4.215427049873412e-02   +8.303304848963078e-04   +7.733826385590367e-02; -1.143620730882923e-02   +9.140058615050714e-02   +2.765338459176251e-02   -1.557307992933567e-02   +3.293618878154510e-02   -1.815821418286277e-02   -2.545255724870320e-02   +5.013866302404411e-02   +1.520207135304029e-02   +2.230196161665621e-02   +3.053971936508111e-02   +9.777137152509702e-02; +3.177843683197892e-02   +2.809495326386545e-03   +4.880959431732339e-02   +1.108421018971116e-01   +2.748064704641388e-02   +9.253136721750060e-02   -8.010936313912472e-03   +4.164702778167499e-02   +9.200536100555319e-02   +3.949959712170485e-02   +6.416840316826027e-02   +5.688653394811455e-02; -1.170713088908622e-03   +2.974659252002704e-02   +9.016029177665320e-02   -1.000325170099335e-02   +5.242067055663938e-02   +4.480052679329247e-02   +4.084601729609535e-02   +1.126041303106245e-01   +3.538371421546660e-02   +1.115835968037384e-02   -1.728057983741573e-02   +7.476287122757524e-04; +6.832993326172376e-02   +1.218517607959788e-01   -2.738377735623693e-02   +1.199728391031521e-01   +7.484847566496433e-02   +3.809327386185893e-03   -3.863229704172143e-02   +7.509305613361861e-02   -1.591388445679760e-02   +6.243669780594792e-02   -3.575409479557874e-03   -2.277077912435534e-02; -6.112571440017551e-02   -3.729395523467880e-03   -3.671915674346261e-02   +1.523656568774082e-02   +5.730194225710185e-02   +3.234610183614864e-02   +2.895516896068410e-02   +1.381176033556215e-02   -6.281294169278081e-03   +5.511397607882701e-02   +3.588163705897638e-02   +2.674077132720282e-02; +6.648988755189228e-02   +1.353348807332045e-02   +2.104338157117682e-02   +2.751829965918526e-03   +4.287672904689260e-02   +2.368590199805251e-02   +4.569321667009574e-03   +1.208832793343986e-01   +7.994523833507834e-02   +7.063056897751527e-03   -5.292318161863885e-02   +3.638885524499069e-02; +7.008927509305078e-02   +2.128130579092453e-02   +4.064991598081052e-02   -3.195959342143827e-02   -1.248724956332967e-02   -2.105164764317411e-03   +1.802257734063052e-02   +3.958099088429180e-02   +2.059445386846203e-02   -2.279110742309147e-02   -1.814962412174636e-02   +4.610888036254810e-02; +5.184034642065997e-02   +4.559404672012022e-03   +7.415011606506865e-02   +8.934440448850849e-02   -3.112565502542138e-02   +3.660914127273263e-02   +1.127718761022540e-01   +8.371106018630892e-03   -1.336998200859494e-02   +3.135977215997170e-02   +3.911674967650592e-02   +7.371875362063408e-02];
L3E_L3I_iGABA_netcon = [+6.017887789827016e-03   +2.318743294753562e-02   +2.290946500690211e-02   +1.232046027534499e-01   +4.058246285784650e-02   +7.212936515883084e-02   +1.457345845263842e-02   -1.229259874369181e-02   +2.645209595357194e-02   +9.747831336882332e-02   +7.756246521226114e-02   +4.425391090392664e-02; -3.061073828156117e-02   -2.201578151327280e-03   +8.564432793344458e-02   +3.022765576754624e-02   +8.849362871569528e-03   +3.386918610066530e-02   +6.900563872025423e-02   +8.230725340001016e-02   -3.596875324534991e-02   +1.120574889982461e-01   +3.216225973903058e-02   +7.976665075195205e-03; +5.802747948666216e-02   -4.303034876245247e-03   +7.312655198159089e-02   +8.627126298381277e-02   +2.579181231749908e-02   +4.754015972530579e-02   +6.186484837092719e-02   +7.702774853799586e-02   -5.010626465746555e-02   +1.189814088552947e-01   +3.443163381898746e-02   -4.932119449481917e-02; +3.934352656936490e-02   +3.901153242857886e-02   +2.856348070669902e-03   -3.020510962502162e-03   +1.841238932635301e-02   +8.386880006618667e-02   +4.591939161899720e-02   +1.271830735052835e-02   +1.019772598667127e-02   -2.514310606524883e-02   +8.411311661579512e-02   -5.521522326871108e-02; +6.632223710318283e-02   +5.333897507268556e-02   +7.510228108927008e-02   +6.288092726472586e-02   -1.969327598018683e-02   +3.086997562841913e-02   +9.405030973996458e-03   +7.123352008905720e-02   +1.221080470451502e-02   +1.260691648303702e-01   +1.041102965834191e-02   +7.604813963695843e-02; +2.702350599177384e-02   +1.099289917738894e-02   +4.981588812649013e-02   +3.490623675305021e-02   +6.983724766496627e-02   +5.047913084201643e-02   +2.129067876744889e-02   +5.449627100715843e-02   +4.609558519000335e-02   +1.062733842281750e-02   +4.239336348978662e-02   -8.716198417073818e-03; -2.058757754567491e-02   +4.830150806424273e-02   -2.795775360133257e-02   -5.292185676504974e-02   +2.437616461477157e-02   +5.822390615736808e-02   +3.329179967801107e-02   +5.285637961575301e-02   +1.824722495228949e-04   +4.025915100944543e-02   +1.898496647676210e-02   -8.649333844421500e-03; +7.528192197863592e-02   +2.901468492129553e-02   +1.460746321524579e-02   +1.114106680145350e-01   +4.440239329026296e-02   +1.560394859107560e-02   -1.635140300466291e-02   +5.292672978124617e-02   +2.566742087324729e-02   +1.820335006046862e-02   +3.740164904931997e-02   +3.140905525210404e-02; +2.997284992840166e-02   +6.531418839929176e-02   +5.414232600540921e-03   -5.187495556891280e-03   +1.080092973214314e-01   +7.832624196151869e-02   +4.068498065233286e-02   -2.407745751681593e-02   -1.727044919402095e-03   +5.227950838883178e-02   +8.277168720535810e-02   +1.908564973687085e-02; +1.049258448763947e-02   +4.947293791064050e-02   +5.967373740553772e-02   +7.243488014724752e-03   -2.728814218190103e-02   -3.114259102574949e-03   +5.426354966959058e-02   +8.510845164273037e-02   -1.139471809107246e-02   +6.136552865094448e-02   +6.179224480325030e-02   +1.197290690215281e-02; +3.545838942959112e-02   +5.166234686911597e-02   +3.469235056622112e-02   +4.161820233067745e-02   +7.041322723768983e-02   -4.932862041146047e-02   -2.546333378579364e-02   +4.151912893294729e-02   +1.556144841641673e-02   -2.852902869913117e-02   +1.233336957115829e-01   +6.999344214973557e-02; -1.046734484370439e-02   +6.668296865719787e-02   +2.076015872846093e-03   -3.530588656393118e-03   +4.554699986588131e-02   -8.936788991709410e-03   +1.132382797181880e-01   -5.149969981332169e-03   -1.116859630260303e-02   +3.442425346396964e-02   -1.751359094187106e-02   +3.243526746910950e-02];
L2E_Input1_iAMPA_netcon = [+1.640079787705118e-02   +4.819829368638523e-02   +2.811261947243077e-02   -3.498847241541255e-02   +3.030505780163815e-02   -9.014394199624038e-03   +3.871195168893156e-02   +7.725670495186018e-02];
L2I_Input2_iAMPA_netcon = [+5.182068841287320e-02   +2.673384708598305e-03   +3.335202573999323e-02   +2.031597000051866e-02   +2.444305929045378e-02   -1.855925969076264e-02   +9.299565608636226e-02   +1.315657368238186e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
