function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.437996844305080e-02   +2.935487732333292e-02   +9.002622951765922e-02   +5.456969728502668e-02   -2.622259638021667e-02   -1.503918035461817e-01   +2.633562167682433e-02   -9.798189737201943e-02   +8.617997532376158e-02   -9.685800314001800e-02   +1.048448035072020e-01   +1.675982798386878e-01   +8.309255365714241e-02   -4.492281129153249e-02   -1.086928635440756e-02   +6.027575398486124e-02; -6.180124087089336e-02   +6.914886878564631e-02   -4.738587735918212e-02   +1.019423322144189e-01   -4.608570025069247e-02   +6.197131082873231e-02   -1.285359231892744e-02   -3.887096252906128e-03   -1.338529219545246e-01   -2.851687216830464e-02   -6.576193856389001e-02   +6.945729013901011e-02   +4.313424414292786e-02   +2.166217715270556e-03   -6.441850636440594e-02   +8.430995886772696e-02; +3.004263522108694e-02   -1.306425832598651e-01   +9.483111244980245e-02   +1.097814822483269e-01   -3.415942906071136e-02   -7.800467079361062e-02   -1.596906927648614e-01   -1.737453374275413e-01   -1.707125999437785e-01   +1.878234301674382e-02   +1.326253892257800e-01   -4.296903410310920e-02   +1.573152338038912e-01   -1.457524778125194e-01   +2.211247881159125e-01   +7.240454742117473e-02; +2.834619515727515e-02   -3.638310839308245e-02   +1.632263227090482e-02   +1.849529510688572e-02   +1.168062679829115e-02   -9.058590239229163e-03   +4.842126679708236e-02   +3.155563550067039e-02   -1.703376662916521e-01   -1.297559406683562e-01   +2.386180205235369e-02   +8.680614099892113e-02   +1.296585723695928e-01   +4.585856950007415e-02   +1.061772424477129e-01   +1.657179536969815e-02; -5.389664333535047e-03   -3.064554231991291e-02   -1.653976540405041e-01   +1.777756276318322e-02   -1.674606890782177e-01   +2.088602300408380e-03   +1.083460855469260e-01   +1.139121630014632e-01   +1.346981286806012e-01   -1.469152077915020e-01   +2.076557216356355e-02   +1.155265686245723e-01   -3.033528757850808e-02   +9.602745152075245e-02   -5.203956614506934e-02   -2.039287869963782e-02; -1.438166796029463e-01   +1.638227123163959e-01   +1.300938661282008e-01   -1.282734572205766e-01   +9.029391098309969e-02   +1.272482040354313e-01   -2.803988388086280e-02   -7.595875444856738e-02   +2.371631039538421e-02   -5.606483291222591e-02   -1.633097011799938e-02   -8.688096511890654e-02   +1.495770334305710e-01   -1.088236408452069e-01   -1.501626703934117e-01   +1.041669411912586e-01; +2.943912993036650e-02   +1.304440316957891e-01   -1.869238036600217e-01   -1.428791754959240e-01   -1.324902547065274e-01   -5.931782504870071e-02   +6.457649027099620e-03   -3.802202308207542e-02   +9.510499745711318e-02   -1.050553730825328e-02   +7.549614126726363e-02   +8.716696788861461e-02   +9.344998475011151e-02   -7.013432850321660e-02   +1.337949440362925e-01   +9.514383067686066e-02; -4.361753006303197e-02   +1.484184365380390e-01   +1.480648192312517e-01   -1.269414281724795e-01   -8.549822221922380e-03   -5.506628181877114e-02   +1.127628455284394e-01   +1.147934341339864e-01   -7.052730415608949e-02   +3.344439815062217e-02   +8.622345254353719e-02   -8.281967821039984e-02   +9.637076371726888e-02   +7.080271619185595e-02   +4.049336273796002e-02   +8.213787263817425e-02; -1.116551309115157e-01   -9.555876798798385e-02   +1.814584010068493e-01   +7.896090238523787e-02   -6.032277608793564e-02   -4.414935521561126e-02   +1.584819766922312e-01   -6.530455073456856e-02   -1.316310733059830e-01   +7.521608156756943e-03   -2.832825959300320e-03   -3.665976677964052e-02   +2.013933119199837e-01   +1.432684928255480e-01   -7.901936763670911e-03   +4.829496006848547e-02; +3.834913700231277e-02   -7.428814066490508e-02   -6.076166391002327e-02   +1.846338182650916e-01   +1.926014537041124e-01   -7.971809053580620e-02   -5.361977581900598e-02   -8.698492755113568e-02   +2.657549318317540e-02   -3.371560756674645e-02   -7.179212348355427e-02   +3.825840721430115e-02   +1.556462272167932e-01   +1.736490882147486e-01   -1.001131352527530e-01   -2.133076768737938e-01; +1.705093608690594e-01   +1.801071170662913e-02   -8.904213079496057e-04   +7.187535189121184e-02   +2.317431796486136e-02   +2.287347003555649e-01   -6.354772717721699e-02   -1.199694813702948e-01   +1.540476308153766e-01   -1.050756608801192e-01   +3.936851541010485e-02   -4.805730385002829e-02   -1.166582319002535e-01   -1.313576716587007e-01   -2.139031277325002e-01   +5.738101394577537e-02; +2.611107404802261e-02   -1.867465037737185e-01   -2.365684373501165e-02   -5.430517722174576e-02   -1.083108131044259e-01   -3.482382524998781e-02   +8.578073890318222e-02   +1.230651037659627e-01   -1.095130704456614e-01   +8.142907700368121e-02   +4.996733226518028e-02   +6.180953792373543e-02   -1.170915726581298e-01   -3.599859063181442e-02   +8.713599966840174e-02   +3.351223137374354e-02; +2.163913299770465e-02   -3.764591530017881e-02   +9.017681443501249e-03   +4.537422158004986e-04   -4.420265471436222e-02   -1.223451768474854e-01   +1.353518050842815e-01   -1.223681461892904e-01   +5.854890012162790e-02   -2.143473861650991e-01   +5.435500712579036e-02   +1.448063748024901e-02   +8.719795822509527e-02   +1.204547987529005e-01   -3.376146006841389e-02   -5.040169874165200e-02; -3.328850863533270e-02   -1.281403424909051e-02   +5.175427337049118e-03   +2.565548538325687e-02   +1.227585269512252e-01   -1.244237721179911e-01   +1.014059230850729e-01   +7.507392112929995e-02   +1.149417084002007e-01   -3.776661067517418e-02   -6.068214141601189e-02   -8.964454467257726e-02   -3.308562170684821e-02   -1.458012956770179e-01   +1.912463360807598e-01   -3.528620908118886e-02; +8.070694454350295e-02   -4.677993825851481e-02   +2.517803703931688e-02   +1.149290098333975e-02   +1.613710638437441e-01   -1.401746486583368e-01   +1.299131650655362e-01   +7.809057100472143e-02   -2.181297789996029e-03   +6.369327073017494e-02   +1.978906004926957e-02   +1.019035640322023e-02   +7.791307883898198e-02   -1.742369066482064e-01   -2.357126152158758e-01   -2.566076925462130e-01; -8.123435837807486e-02   +5.852836545310420e-02   +5.056790614005498e-03   -1.253041229674749e-01   -1.176622156089504e-01   -5.834440608730698e-02   -8.536378231664488e-02   -1.845339610449877e-01   -6.727106872911055e-02   -2.933872880095897e-02   -1.665156428174062e-01   +1.187523121120069e-01   -4.971639816768637e-02   -5.651082889094448e-02   -9.702997408841434e-02   +7.144320935062212e-02];
L1E_L1I_iGABA_netcon = [-5.318478947054757e-02   +9.789353260018677e-03   -9.150396720627597e-02   +2.209774771667503e-01   -6.528861011076277e-02   -1.309030768287728e-01   -1.660094756891325e-01   -3.236963769082032e-02   +9.629098008745948e-02   -1.036064446724117e-01   -4.222589599294296e-02   -1.315831901503701e-01   +3.273894516550591e-02   -9.982498397322927e-02   -1.421147298687432e-02   -1.262996112085513e-01; -2.849402909177414e-02   -1.482980908008278e-03   -3.311195130450800e-02   +4.093582019208886e-02   +2.472648860583984e-01   -1.365318664780612e-01   -9.043757708814014e-02   -5.191253531776043e-02   +4.606247573561734e-02   -5.478829954233977e-02   -1.262360149062716e-01   +5.081940682968249e-02   +3.514321751547529e-02   +2.287961234319673e-02   -5.236844020597227e-02   -2.753866456645908e-02; +2.714908393247474e-02   +2.195769007342968e-01   -3.276917972337125e-02   +6.573869751742190e-02   -6.003627209244702e-02   +1.133441594082608e-01   -6.382993518552114e-02   +1.620582154581620e-01   -1.547926262353735e-01   -8.049344976058558e-02   +9.941780302270016e-02   -2.599716367427275e-01   +5.527809331186730e-02   -8.862933084396715e-03   +7.389435869654526e-02   +2.926489600626855e-02; +3.789254269797184e-02   -2.498517271304617e-02   -9.770399676581415e-03   -4.106159748328512e-02   +5.405514163222318e-03   -4.660268750286155e-02   +1.024397666998358e-02   +1.042249601180903e-01   -9.470970031356384e-02   -6.412890678259568e-02   +2.103615011011983e-01   -1.088229891278826e-02   -2.059307062238116e-01   -2.709294644401705e-02   +8.262206077860622e-03   -1.002142396084302e-01; -2.398262349058668e-01   -8.124997188604328e-03   -1.768139538443993e-01   -9.985958970505754e-02   +4.276205075579428e-02   +3.896814932271660e-02   +1.502049963321983e-01   +2.319138662510077e-01   +1.748076824688145e-01   +6.532290336483421e-02   -1.275494759755311e-01   +3.910206225764089e-03   +1.123145146909528e-01   +7.145058826833327e-02   -2.645247034097601e-02   +2.628724220352679e-02; +1.801994664216074e-01   +8.531236845796761e-02   +9.603806488012817e-02   +5.442323742718473e-02   +1.613199782445231e-03   -5.228895032800635e-03   +4.203998364983218e-02   -6.394382660779879e-02   -5.662954078914938e-02   -1.930896583972239e-01   +1.491381859386499e-02   -6.842611628411953e-02   -3.483847121894468e-03   +4.078088695581328e-02   +1.259897134542938e-01   +2.573885577378086e-02; +1.388350541077232e-02   +2.433531742133113e-02   -1.468977293119806e-01   +1.351522314286083e-01   -1.286385020707301e-01   +2.455157778864352e-01   -4.652172870540892e-02   +5.922091243294364e-02   -1.065832116179531e-01   +1.126060749024868e-01   -4.277346795531678e-02   +6.748587070790867e-02   -6.650227508612667e-02   -1.073688105368662e-01   -6.722302057038593e-02   +7.481559424884543e-02; +6.101477867700615e-02   -8.478646566419085e-02   -8.581645975668357e-02   -9.808737676327461e-02   -1.300624058964969e-01   -9.696893837002704e-02   +1.215784331018102e-01   +2.193223721506101e-02   -1.327082110970685e-02   +2.779518264021489e-03   -2.211156823657021e-02   -5.005949827833671e-03   -4.103842931693327e-02   +8.816528351850553e-02   +5.763063351657644e-02   +1.862616209329676e-01; -1.163004795838374e-01   -4.399876147474253e-02   +1.229410073303490e-01   +8.874600228929315e-02   +1.132149526143944e-01   -8.462806577244759e-02   +8.993268984865339e-02   +1.031359493903272e-01   -1.443430250418428e-01   -1.329465895696828e-01   -7.094672019551972e-02   +1.097046189982667e-02   +7.078048642595185e-02   +1.340533398145932e-01   +2.052054850426405e-01   +9.977214487023187e-03; -4.226318800619418e-02   -8.262888511467036e-02   -9.114909112872219e-02   +2.593002777846425e-01   -1.108005970515332e-01   +2.138745526109438e-01   -5.115746145880777e-02   +7.483812936939914e-03   -1.177804095815453e-01   -4.984045179045010e-02   -1.136343406300668e-01   -3.678720294828448e-02   +2.192268669963296e-02   +1.178691923074855e-01   -2.932348991725803e-02   -1.220784155632721e-01; -2.035272103360011e-01   -1.899468855556201e-01   -1.814722546123938e-02   -1.394711387260546e-01   -1.135337663146760e-01   -2.369448298168587e-01   -1.138310641098961e-02   -1.037159399736338e-01   -1.298279078021826e-02   -9.710391536585179e-02   -1.889630761184615e-02   -1.124248647392154e-01   -4.345327094229849e-02   +5.453335410779105e-02   -2.717894804120095e-02   +5.006349823375625e-03; -9.798131088661376e-02   +1.849795714158140e-01   -9.613950588299829e-02   -5.417780440104997e-02   +8.450181399487364e-02   -3.809503720996935e-02   -9.281566960780897e-02   -9.743853229098272e-02   +1.290433349013655e-01   -2.834121547067112e-03   -1.487311144340816e-01   -1.454595833795471e-01   +6.112381965526847e-02   -7.531730925717862e-02   -2.104422909794336e-02   +1.225248650231333e-01; -7.772587311890197e-02   -3.025959885393174e-02   +3.866798885375866e-03   +1.089132097348291e-01   +8.663612005037913e-02   +1.283831917586283e-01   -1.717091023651916e-01   -4.352810657191242e-02   -1.244261025815346e-01   -2.534916576588308e-02   +7.501962990883924e-02   -1.167522469593216e-02   -1.871227675088286e-01   -1.313484998416897e-01   -1.317948457795365e-01   -8.061318517600526e-02; -2.544233480151146e-02   -1.028233778295141e-01   +3.915168371167235e-02   +5.733735657084535e-02   -1.504996284298705e-01   -1.377039815645279e-01   -2.803279524238039e-02   -1.116062081498847e-01   +1.288885771775751e-01   -8.472641069924622e-02   -1.441621904494898e-01   +7.522775211820878e-02   +8.985452885324502e-02   -2.086616581656193e-02   +2.396143410158971e-03   +1.062356178251616e-01; -6.142428286546249e-02   -1.471762388405173e-01   +6.352857752531689e-02   +8.057508793292008e-02   +3.866130311445359e-02   +6.234725816077785e-02   +1.067594307361839e-01   -5.818488308396019e-02   +1.384696594945121e-01   +1.288417175360017e-02   -4.808689722317789e-02   +2.691532818313931e-02   +1.226725458768523e-01   -1.652772464988800e-01   -5.464159319326026e-02   -1.943511858786893e-01; +5.852676000777927e-02   +1.602980165497603e-01   +2.188011298218738e-01   -1.546880202234914e-01   +6.852625486019255e-02   -1.547912807221426e-01   -8.199471046876185e-03   -6.052554610846637e-02   -5.463019619284219e-02   -5.753240619811462e-02   -1.768471901996883e-02   -9.486409142276835e-02   -2.503175507094337e-02   -3.331985252294388e-02   -1.209069842869448e-02   -2.087271458622988e-02];
L2I_L1I_iGABA_netcon = [-4.734768896964081e-02   -6.664424244770940e-02   -1.117980689498040e-01   -1.343716334428227e-01   -9.452610073587733e-02   -3.575493572599843e-02   +1.010043351466270e-01   -1.338713513432996e-01; -7.963413764219135e-02   -3.391646167379679e-02   -7.019655440248612e-02   -2.437827438068226e-02   +2.037750470210536e-02   -2.041755686245153e-02   +4.425326053578939e-02   -7.264361701388299e-02; -1.532798800523208e-01   +6.542199799751701e-02   -7.493690329193699e-02   -1.056675375595976e-01   +2.472397746432612e-01   -6.181352187503186e-02   -9.103840140506286e-02   -1.697765537698861e-01; -2.085672175761237e-01   +6.806445835172767e-02   -2.895564343849170e-01   +1.291621148739493e-03   -2.078375959685298e-02   -1.881626623136636e-02   -4.838605255045066e-02   -1.127475424998504e-01; -7.672098143500189e-02   -4.562683722635655e-02   -1.035956330115755e-01   +1.458417534656735e-01   +4.632301642392227e-02   +9.331172146737644e-02   -8.400466047399131e-02   +1.387444658685967e-01; +1.502211205713114e-01   +1.924886330824696e-02   +4.354019136965717e-02   -2.406775880032688e-02   +1.898940014876496e-01   +1.067702210332876e-01   -1.465077000136266e-01   -1.174264729322209e-02; -1.018805450445953e-01   +1.066266413770580e-01   -1.911410052552764e-01   +2.123900351101377e-02   -5.333028947862584e-02   +1.635991008009448e-02   +9.061100971932659e-02   +4.106515448890829e-02; +4.363817284322180e-02   -8.253161809607827e-02   -1.841807788463969e-01   +2.437761018176156e-02   +5.191164798930670e-02   +7.610352770084419e-02   -1.233779160337925e-01   +1.077883563427381e-01; -1.779209137448414e-01   -1.135896355152051e-01   +1.115983285590124e-01   +1.413816042143686e-01   +1.006753036112713e-02   -1.951877134733821e-02   +1.296610707820861e-01   +1.763760960221883e-01; -6.654450608669023e-02   -2.922461688644964e-02   +2.825724259603158e-02   -3.907605316981491e-02   -1.149858439215832e-01   +1.992928205273291e-01   +7.882136667954784e-02   -1.398697253714284e-01; -1.329068929227780e-01   +9.010300149606434e-02   +3.514715732159771e-02   +2.369068970607806e-01   -1.764235982081674e-01   -1.475650764118300e-01   +1.127312619034058e-02   +1.503617665951465e-01; +1.141361383769260e-01   +1.089410456069644e-01   -5.455822240698655e-02   -3.483486175917612e-02   -1.167794512363677e-01   +1.750337352819015e-01   -2.950544033321348e-02   +6.269258676753359e-02; -5.457488453636174e-02   +2.367696436132907e-02   -7.026434960214475e-02   +2.661509009622589e-02   -1.119579344072021e-02   +2.026850183904531e-01   -1.400468469437861e-02   -9.782597025014773e-02; +1.737845443664672e-01   -1.129552615953110e-01   +6.118074221035188e-02   +1.249477381527167e-01   -1.758385486295758e-01   +9.676673250864963e-02   -1.110806138547566e-01   +1.071294479167802e-01; -2.006003973599654e-02   -1.343266195812473e-01   +6.598547243407289e-02   -1.043813830414237e-01   +1.711252518632705e-02   +1.841817531356354e-01   -7.126104734848680e-02   +1.731931806055902e-02; -1.878350632666230e-01   -9.629904714323515e-03   -4.323779530762462e-02   -7.255644502326444e-02   -2.827113650347175e-02   +1.095188813284075e-02   +4.579127373478117e-02   -1.279999267090640e-02];
L1I_L2I_iGABA_netcon = [-5.650067417416298e-02   -8.663748717997301e-02   +8.210974431198459e-02   -3.625864215828541e-02   -1.565785874182526e-01   -1.554446123862847e-02   -4.340854525069972e-02   +2.432890785842811e-01   +1.100477999181517e-01   +5.511771205955140e-03   +4.900395398067314e-02   +6.400207726478102e-02   -6.599354202882009e-02   +4.796403811390824e-02   -1.138472635915022e-01   +1.182186223539215e-02; -1.895127947224615e-01   +4.424365657916284e-02   -1.079895939677145e-01   -2.265867582733648e-02   -1.176464384515497e-01   -1.682287550566314e-01   -8.083678252161064e-02   +2.149867915039878e-01   -9.138020972954966e-02   +5.492665506640244e-02   -1.386211391960941e-01   -2.246016491552845e-01   +4.305026083461839e-02   +3.467965246660486e-02   -2.987743108035785e-02   +1.017733855815645e-01; -5.132567852805713e-03   +1.041730280314462e-01   +1.007572897558139e-02   -1.084686519985435e-01   +1.561232994185812e-01   +5.500989766615300e-02   -1.481705125035791e-02   +1.281151591638366e-02   +3.842087506946627e-02   -1.006233388413336e-01   -1.602308148506793e-02   +8.045917426349899e-02   -7.479438127259135e-03   +1.702595034410350e-01   -7.939618789192970e-02   -6.452252855065521e-03; -5.048781905735093e-02   -1.243661671732808e-01   +1.234910338731584e-02   +6.932790161546611e-02   -2.102993481929013e-01   +5.924049052207420e-02   -8.771684987657687e-02   +6.335979697055495e-03   +5.257700868137621e-02   -1.399867664010321e-01   -6.080180487521092e-02   +8.362478117549045e-02   -7.293534550921399e-02   +8.619953066503067e-03   +9.110828534508772e-02   -2.538610025409958e-01; +1.097178489653855e-01   -3.903674151771801e-02   +8.869260509004422e-02   -4.780689933221051e-02   +4.903627355144342e-02   +1.225842222538255e-01   -9.354305372973172e-03   -1.215314427556717e-01   -1.251630910179543e-01   +5.120885640313721e-02   -2.538715235445725e-02   -5.961210629643404e-02   +5.717111874003021e-02   +4.031453909240234e-02   -1.092998781282165e-02   -1.787728802413265e-02; -2.226222034070015e-01   -7.340289715713605e-02   -1.236192862616986e-02   +6.420440595587568e-02   -6.123436162666353e-02   +1.251353957690526e-01   +2.067888625301407e-02   +1.283701343457942e-01   -9.130246361012209e-02   +4.214015947155964e-02   +3.976949903529638e-02   -4.192182483269389e-02   +5.763415751202445e-02   +1.052107754737837e-01   -1.003738997069734e-01   -2.143299036598073e-01; -1.229822409421854e-01   +4.338735619755592e-02   -3.508052962941305e-02   -8.389648542809257e-02   +2.218199501907480e-01   +1.338756166236646e-01   +4.496248542778850e-02   +2.215787890430297e-01   -1.159130714102164e-01   -1.677191876362454e-01   -1.148077496495409e-01   +1.162950217543928e-01   +7.432398771876127e-02   -2.415255985824916e-02   +1.593578400510890e-01   +2.859823025789504e-02; +5.052287766721261e-02   -1.547048008148083e-01   +3.410909957757943e-02   +2.336185758594206e-02   -9.770749359427372e-02   -1.767409497196702e-02   +8.636006200630963e-02   -8.789931378714315e-02   +3.011335831155100e-02   +1.343695911490514e-01   -4.539215692781537e-02   +9.175517540725845e-03   -7.336478159270592e-02   -4.785368502211861e-02   +3.152785275428979e-02   -1.194538599035043e-01];
L2E_L1E_iAMPA_netcon = [-1.872895489370186e-01   +8.313193283338158e-02   -3.847213658095423e-02   +1.343088758235154e-01   +2.805780490736193e-02   -1.843090833849008e-01   +6.833140481162857e-02   +7.048771376918248e-02; -4.333405948092808e-03   -7.954159533855283e-02   -5.451377193961704e-02   +3.600414142295648e-02   -4.171171254168972e-02   -9.451329527179651e-02   +9.333652263775238e-02   +2.032894662456711e-02; +1.829001125125411e-01   -1.511921262748230e-01   -1.280063990661301e-01   +4.234004387579979e-02   -1.100070916412110e-01   -1.063635241773521e-01   +1.258235589883592e-01   +4.055501512734833e-02; +1.141165910817589e-01   +1.478289613034713e-01   +8.011654221698118e-02   +1.966882062887060e-03   -8.984720437317834e-02   +1.331045399320483e-01   -9.999558543166599e-03   +3.603676482221588e-02; +8.265048078649470e-02   +9.072753408495780e-02   -5.825362802940505e-03   -3.642767824943777e-02   -1.452110812257933e-01   -3.691536341970732e-02   +1.739309590363418e-01   -3.772721691633299e-02; +1.284554739619891e-01   -1.376977875217118e-01   +9.906217866141976e-03   -1.320438503341224e-01   -1.047366916398632e-01   -4.176629846159048e-02   -3.708271400918901e-02   +1.777817707766045e-01; +3.897867830978497e-03   -4.434177154820305e-02   -8.817166080234258e-02   -3.884420595982948e-02   +2.024152177340699e-02   -8.264943310909817e-02   -1.817800915486523e-02   +1.843878379935850e-01; +1.576618532097196e-01   +4.485242427697754e-02   +6.451767742420758e-02   +2.943374762694926e-02   +1.448798146753961e-01   -6.206796277222786e-02   +1.165780779346415e-01   +5.238057737595406e-02; -5.445921330524140e-03   -3.190139700623814e-01   -8.848231700921040e-02   +1.415619474184279e-02   +1.456778381285657e-01   +1.358504382452953e-02   +9.091016903238090e-02   -2.281772494625277e-01; +1.069760743791856e-01   -1.688857897682517e-01   -7.503273196395613e-02   -4.893286164081223e-03   +5.186166063414054e-02   -4.552045949580175e-02   +1.784137161117980e-02   -7.195434183047782e-02; +1.568028275345214e-01   -7.909247871080050e-03   -2.198113030387497e-02   -6.361091513971548e-02   +2.180483140516484e-01   -1.331711770147314e-01   -3.709918585958027e-03   +6.189044809522899e-02; -3.402988987509861e-02   -9.354414416985497e-03   -2.283423372254600e-02   -1.121680665094004e-01   -2.005980318491727e-01   +4.523926934987484e-02   -1.651116037574763e-02   -1.589854233321795e-01; +7.228033132344377e-02   +3.590374123951891e-02   -1.693287250197086e-02   -1.730363180906292e-01   -3.582170506408665e-02   -4.324238333625659e-02   -3.579661057046130e-02   +1.597823829291983e-01; -1.163971853572562e-01   +8.323389908402916e-02   -1.188313852297571e-01   -9.092540884594560e-02   +5.375165381977076e-02   -7.886547645828913e-02   +5.220521721693520e-03   -1.078915595651919e-01; +2.859684362930602e-02   +6.603149290411507e-02   +5.945492576205270e-02   +1.145276811208908e-01   +2.271516161184074e-02   -9.720273655043320e-02   -1.989868353809264e-02   +6.612489479146361e-03; -1.560105448702169e-01   +1.478384766924697e-03   -3.413631531768978e-02   +5.660115459137709e-02   -2.428329105573835e-02   +2.251527566373025e-01   +9.176686275978105e-02   -1.480892447332637e-01];
L1E_L2E_iAMPA_netcon = [-8.133580773308630e-02   +9.913875957605110e-02   -1.366517820605520e-01   -2.510525831456929e-02   +4.984674410271525e-02   +1.346491724992988e-01   -5.417603782491331e-02   -7.317105539891380e-02   -1.101770672771151e-01   +3.348633261908801e-02   +2.203331871078110e-01   -7.045451647174250e-02   -1.667005974785653e-02   -6.256368889398509e-02   +8.247286246586263e-02   -1.378942826869100e-01; -3.853672648732130e-02   -1.697418311775148e-02   -6.166340389229324e-02   +1.062432085037116e-01   +1.736191839628315e-01   -1.211727705562521e-03   +6.469406990357971e-03   +1.286350227668846e-01   +1.235378005750708e-01   -9.611339427553930e-02   +1.540534961697936e-02   +3.552912310720395e-02   +2.086662046065390e-02   -8.201148563597818e-02   -1.277256667770314e-01   -1.784659016095491e-01; -5.543780667444093e-02   +2.442358136265698e-02   +9.029942467805040e-02   +1.680480416995687e-02   -6.970969044581729e-02   +3.921281114430769e-02   -1.030686079998177e-02   +3.737153006141362e-04   -1.933126998381023e-01   -7.803118125636457e-02   +1.055131095187359e-01   -5.697437122425929e-02   +1.074487001107412e-02   +2.393492312477005e-01   -1.616311294774932e-02   -1.599666202872319e-01; +1.175429635446043e-01   -5.475899683112507e-02   -4.962744362079663e-02   +1.438417841747600e-01   -5.390944088446617e-02   -2.666486821311973e-02   +1.666150243936272e-03   -2.044916537961660e-01   -2.080644768996862e-02   -1.387659236709251e-01   -6.942445997093234e-02   +7.212549687475635e-02   +1.699426296526597e-02   +3.533314334585899e-02   -1.329493599139768e-01   +3.225005619847941e-02; +2.584011912428700e-01   -1.146413057212290e-01   -3.329135762244307e-03   -2.062751980785550e-02   +2.289650182356923e-02   +1.965180594074122e-02   -1.108161798580742e-01   +5.891611992596978e-03   +4.090619541562462e-03   +1.947098796561024e-02   +1.457006552100636e-01   -1.405761459709743e-01   -4.729255267528847e-02   +3.095355451426725e-02   +1.399316241949932e-01   -1.245181133506559e-01; +1.125138287662451e-01   -4.726866399870272e-02   +8.516875039248922e-02   +1.062249360205597e-01   -2.760955063218238e-02   +1.695643509763219e-01   +2.940140736620239e-02   -8.635759953612290e-02   -2.246541839155740e-01   -4.830997599825719e-02   -1.703143492594662e-01   +5.937264536712712e-02   +1.178062755220598e-01   +6.389627795205560e-04   +1.625580336023438e-01   -2.093743160122703e-02; -9.925312079339067e-02   +4.747114699593300e-02   +1.194110086801109e-01   -2.363179655148592e-03   -8.553403737776145e-02   +8.038132755981833e-02   -1.231835228276708e-01   -9.346020260219555e-02   -3.845287791140455e-02   -1.423000739471721e-01   +1.179617521574272e-01   -2.944419774946487e-02   +3.313485180508907e-02   +8.028524925691168e-02   -4.842976003567213e-02   -9.392107543410135e-03; -1.134709919729872e-01   -1.230072783904388e-01   +5.571532025907912e-02   -3.501734288482185e-02   -3.772218170577530e-02   -8.428347201502295e-02   +1.754169698400017e-02   +2.849802951215188e-02   -8.321298431909231e-02   +3.654746108865308e-02   +1.545335698484955e-01   +1.230956027350972e-01   +1.039038147647419e-01   -1.404668088086642e-01   -8.273225947621744e-03   +1.414608459976829e-01];
L2I_L2E_iAMPA_netcon = [+2.325021672467919e-01   -1.144192195754794e-01   -1.588159303719398e-02   -7.805816694159007e-02   +5.364414499566278e-02   +4.692692719360418e-02   +2.210673011022515e-02   -1.088300668094218e-01; +2.898545319613866e-03   +1.539488747139752e-02   -1.037061825490611e-01   +1.132873496388147e-01   -1.396287637542732e-01   -1.826857797282583e-02   +2.348524013066063e-02   +1.017961978834943e-02; -3.307141340308466e-02   +6.461468370052842e-02   -9.599938786390089e-02   -1.712186736810241e-02   -1.869652866859383e-01   +1.014575874158956e-01   +3.232471658169941e-02   -3.542299687309209e-02; +1.148190090718065e-01   -9.789963271664698e-02   -1.549500044657834e-02   +8.386962571247981e-02   -6.744671873946526e-02   +1.156806308058168e-01   +2.471563880867577e-02   -9.693035450818903e-02; -7.401324232596661e-02   +1.100887444557873e-01   +2.929863145932571e-02   +1.771503740987293e-03   +2.078866887329601e-02   +9.952749692735710e-02   +2.357872990353442e-01   +1.808659194374580e-01; +4.572024381839535e-02   -1.278128887109713e-01   -6.515969548500578e-02   +1.675259996496131e-01   +7.358966548034419e-02   -1.391093530784468e-01   -1.033264840384335e-01   -3.746653434233644e-02; -1.318440823453777e-01   +4.098324034106954e-02   +7.759066109100228e-02   -2.063046500646666e-02   -1.158649894761500e-01   +1.039024494299325e-01   -3.062422903629481e-02   +3.000954361431461e-02; -1.444399793827353e-01   -8.245628267519528e-02   +1.095645652847786e-01   -4.587007542569362e-03   +1.072798228743216e-01   -5.319088021589398e-02   -9.819453200388692e-02   -4.894590735456716e-02];
L2E_L2I_iGABA_netcon = [-8.295726340521538e-03   -9.411768074574479e-02   +1.405838138370451e-02   +1.599882683715806e-01   -4.439444055426554e-02   -6.127998664178577e-02   +5.823881077214883e-02   -2.543912475996617e-02; +1.807216623154996e-01   -1.828366513667391e-01   +1.666099859091645e-01   -2.496431485579810e-02   +7.844480713468353e-02   -5.124676647974629e-02   -5.888608867663445e-03   +1.434139033610333e-01; -1.947421971670887e-01   +2.465715616561023e-01   -2.937322589913641e-02   +9.865664378581601e-02   +1.217895184436870e-01   -1.228742955069461e-01   +1.236985405272914e-01   -3.647150796841548e-02; +8.912704980504300e-02   +2.250690403897537e-02   +1.083439961837652e-01   -1.385972045165100e-01   +2.883715620800707e-02   -1.360487996309446e-01   +6.641685035058331e-02   -3.144158101972237e-02; -1.366644540771169e-01   -1.281292274878457e-01   -9.294366482902827e-02   +3.335730091936136e-02   -3.112298644787855e-03   -1.967342661738893e-02   -2.935495699767832e-02   +7.117267756501351e-02; -3.670625381434559e-02   -1.702424867265554e-01   +7.483340466776606e-02   +3.481667931841768e-02   -2.209029902858843e-02   +5.334070590252923e-02   -4.743447905526634e-02   -4.106460573418664e-03; +5.472326334618783e-02   -1.873922248644799e-02   +1.298667680908606e-01   +1.600620995277906e-01   +4.439472691436168e-02   +1.209598900367383e-01   +1.143333246109030e-01   +7.184713427347547e-02; -6.346316088634064e-02   +2.137342746198886e-01   +1.438703983637991e-02   +4.814294118929100e-02   -1.400600510315882e-01   -4.561213095808357e-02   -7.375445905827721e-02   +5.464840276980685e-03];
L3E_L2E_iAMPA_netcon = [-8.749314829844751e-02   +2.310468059593471e-02   +5.128354882788916e-02   -7.781896006659315e-02   +1.474420327178868e-01   +3.513257842285099e-02   -4.033298358067515e-02   -5.358529894044015e-02   -1.539126486957380e-01   -6.861827579067889e-02   +1.159908084886945e-01   +9.576633308344154e-02; +4.376286167389749e-02   -5.262343758252267e-02   +1.255708457749129e-01   -5.284591872727255e-02   +1.148469267682590e-01   -1.460593666069070e-01   +1.685850269901217e-02   -4.302898331579928e-02   +1.330062095960376e-01   +3.386095964716400e-02   -1.229597592604974e-01   -1.420223682352655e-01; +1.009944768665756e-01   +3.218607795875593e-02   -1.068502871494961e-01   -2.099618267330738e-02   +1.482856464397545e-01   +1.401067588645128e-03   -3.755589337491382e-02   -7.705059984350938e-02   -1.685721182399196e-01   -8.420738289771333e-02   -1.526417218692499e-01   -7.966361862022023e-02; +6.487197967991394e-02   -4.796924572091692e-02   +8.168589884269917e-02   -9.025597592426195e-02   +1.637061257745850e-02   +1.582957159497516e-01   +6.665200110580993e-03   +1.609945997800708e-01   -1.670419043476199e-02   +9.920224307224398e-02   -3.331623813124802e-02   +1.442490103250429e-02; +1.617875567191394e-01   +4.334533061398152e-02   -1.316005602820034e-01   -1.216869600510603e-01   +4.651278296268865e-03   +3.499445439764468e-02   -2.355497606014615e-02   -1.421344816941432e-01   +1.138261840902993e-01   +1.697142134440604e-02   +6.196724994088290e-02   +3.280993635029029e-02; -1.987507092282855e-01   +1.275028680777906e-01   -3.694757635252256e-02   +6.223581219454215e-02   +7.518754879544107e-02   +1.301239407912002e-01   -2.426801790139650e-02   -2.246323659990231e-02   +5.289744423492500e-02   +3.339188983653251e-02   +1.274929356796350e-01   -1.016221738678751e-01; -6.896132203646305e-02   -1.069230706297046e-01   +5.873226659279471e-02   -1.471891334051103e-01   +1.958825987603355e-01   -1.040626383675582e-01   +1.042141749061399e-01   -2.972570670163122e-02   -6.151552858420958e-02   +9.084828314250010e-02   -1.216786117190279e-02   +4.658290819840866e-02; -2.217377858456846e-01   -1.264266673321780e-01   +3.554632923999070e-02   +1.150114113466136e-02   +1.475981469512004e-02   -2.499524198711246e-02   +1.172160280541766e-01   +1.641250074963788e-01   -6.024121820490946e-03   +1.625391478031030e-02   -7.706721133753867e-03   -1.875053330548555e-01];
L3I_L2I_iGABA_netcon = [+9.737000946078012e-02   -9.206053276225780e-02   -2.373915735586682e-02   -1.436607694629391e-02   -7.395626134197003e-02   +7.308247651125080e-02   +8.104100057380312e-02   -2.793183475145687e-02   +3.689357329051657e-02   -1.034367641408268e-01   +1.055679982386348e-01   +1.407997367258879e-03; +1.570824048720136e-01   +1.255378744528670e-01   +4.485387850256602e-02   -7.910656941665878e-02   -2.517124887004715e-02   -6.448970833150885e-02   +6.336667170431586e-02   +1.165102545258049e-01   +6.393922761429660e-02   +2.987169649236530e-02   +1.261608120240348e-01   -7.905280115557418e-03; -1.729906512313736e-01   -1.703206414043930e-01   +6.123142951720535e-02   +1.548755996715626e-01   +9.697166732528464e-02   -2.292044469025438e-02   +1.317143282040835e-01   -7.348595072491947e-02   +4.547873727470096e-02   -1.564325523800459e-01   +1.130700300749473e-01   +8.515222829687372e-02; -8.902318094173108e-02   +1.432062720129375e-01   +2.972031764539102e-02   -3.338025258807296e-02   +7.646143753420405e-02   -8.740808287961077e-02   +1.708868525052019e-01   +1.051038250629066e-01   +7.093668310757720e-02   -1.557006799928465e-01   +5.342537734073278e-02   +3.275564162905450e-02; +5.587773703344820e-02   +2.682058381799298e-02   +1.830365792881772e-01   -4.411551943106551e-02   -3.826130049841690e-02   +1.776229980198486e-01   -9.226622686256816e-02   -7.852184320127072e-03   -1.359985436108706e-01   +9.593368570061403e-02   +1.095500407226390e-02   +4.918443390491843e-02; +8.544138449599162e-02   -1.337135380153271e-01   -1.881168571385729e-01   +6.131764205403595e-02   -1.452972608676447e-01   -1.480504425610183e-01   -2.801772204587061e-02   +6.820312645613513e-02   -1.608364739453066e-01   -1.227636426198815e-01   -6.242862433090024e-03   +1.575715569982269e-01; +2.960068563833569e-02   +1.170507492166104e-01   -9.158371245365508e-02   -4.384133925715131e-02   -1.348663553725211e-01   +2.766021144937237e-02   -1.381393432611123e-01   -9.501122760217771e-02   -4.281705838490539e-02   -9.497070441065124e-02   -1.848936087028563e-01   +7.216271233145648e-02; -3.588558792615597e-02   +1.131574076480307e-01   -3.389232737447764e-02   -9.379806293988457e-02   -3.803217318355277e-02   +5.845951277718266e-02   +2.828498751531553e-02   +1.398185923019480e-01   -1.429646151986559e-01   -1.225929584140631e-01   +1.724034821626714e-01   -2.753614340659348e-02];
L2E_L3E_iAMPA_netcon = [+1.108974955592996e-01   -2.469587595853278e-02   -1.838477260225524e-01   +5.257217556254321e-02   +3.002621021517344e-02   -6.008505044605612e-02   -2.045463929406605e-01   +3.953342683061350e-02; +3.678357870813972e-02   -1.341462729617589e-01   -8.450516390232303e-02   -1.678260299953834e-01   -1.423796788512493e-02   -1.718056320105906e-02   -8.146964281886469e-02   +2.351709122528910e-01; -1.269471984877300e-01   +1.798619091076832e-01   -1.635551785678471e-02   -6.386591012949228e-02   +6.622113168423642e-02   -2.892191495428679e-02   +8.670558585195912e-02   +6.323011536559998e-02; +2.211576550179238e-01   +2.369762636275866e-01   -2.610911586587929e-02   -5.510392963051957e-02   +6.089870910692503e-02   -3.722481676070025e-02   +5.811101888990415e-02   +7.983126596448301e-02; -5.334230035254030e-02   +1.193392646831463e-01   -3.466143624125599e-02   +9.035428117841136e-02   +2.176473990108714e-02   -5.992341870136439e-02   -1.408532686795338e-01   +2.698371231126713e-02; -1.291428301291099e-02   -9.286076646729843e-02   +1.293856116756112e-01   +1.024227413509968e-01   +1.026775067185134e-01   +5.276373571603329e-02   -5.867174437757326e-02   +1.137551011837224e-01; -4.684225900613882e-02   -1.356596996357620e-01   +1.483209772517944e-01   +6.890883798771388e-02   +1.013806779275359e-02   -3.028580224699843e-02   -1.056640239584531e-01   +9.294482785161851e-02; -7.864978334503449e-02   +9.158837304102233e-02   -8.329242262019679e-02   +1.192636324027347e-02   +2.590761373169603e-05   -7.803657872908870e-02   +1.339820855077702e-02   +1.296595993561526e-01; +2.670414600965564e-02   -1.126118299627838e-01   +1.342346918991962e-01   +1.015065995429000e-01   +9.441687340147314e-02   +1.516771367790767e-02   +8.711113519180680e-02   -1.205203358954201e-02; -1.836253315447658e-01   -1.088945369717766e-01   -1.537256489740590e-02   -4.846793945892006e-02   -4.040543319448496e-03   -7.343651010653640e-02   -8.537455219313900e-04   +5.495733523411023e-02; +2.790572571653705e-02   +3.092188698791783e-02   -1.488381101667060e-01   +4.968077825623359e-03   -1.343553221496837e-02   +8.306333466065845e-02   -4.432710867364546e-02   -2.883651996156860e-02; -1.111460055499831e-01   -3.421649809606746e-02   +3.021201910251892e-03   +6.937489610659338e-02   -5.008656355733587e-02   -1.286988760517402e-01   -7.493328695628902e-02   -1.413701740466306e-01];
L2I_L3I_iGABA_netcon = [-6.490800646893789e-02   +6.110778242754679e-02   +1.504615457052762e-01   -1.104323188120314e-01   -1.838926832258808e-02   -1.930038931455605e-02   +7.860086248885977e-02   -2.383837650088603e-02; -5.629110748044568e-02   +3.257389201322814e-02   -3.967127701852102e-02   +3.105326450576232e-02   -6.562967713812534e-02   +1.272945278380894e-02   +2.486993507406472e-01   +2.429006067358802e-02; +1.286728494440387e-01   +5.140687833649838e-03   -1.078737122562541e-02   -1.328829927115124e-01   +5.314201261426399e-03   +5.615417895385568e-03   +2.228004948092022e-02   +9.362457086126680e-02; +3.594398187807236e-02   +1.362016132794482e-01   +5.669038640221555e-02   -3.772995166818024e-02   +6.226377545307872e-02   -1.219220541552851e-01   +1.387323701683491e-01   -1.437261611165457e-01; -7.618812757670408e-02   -5.939757938789782e-02   -1.331283205019057e-01   -4.972557895367105e-02   +5.403064998078192e-02   +7.927860669298321e-02   -3.060199205834208e-02   +3.079226193244432e-02; +3.336762023530934e-02   -2.797558825235666e-02   -3.488412660032332e-02   +3.507260686692046e-02   +6.596824484750301e-02   +1.149374841783342e-01   +1.274015894499981e-01   +6.747439265332278e-02; +8.036500874941832e-02   +8.169792814917290e-03   +6.659435755077893e-02   -9.088562053544647e-02   +1.820979189930077e-02   -3.846783272598141e-04   +7.239285178738109e-03   -6.261886983833231e-04; -1.646123262876961e-02   +1.856901470690783e-01   +4.539048675104746e-02   +7.364897195364793e-03   -7.359336441953181e-02   +1.827742446840202e-02   -1.431729544154359e-01   -8.846493798712304e-02; +1.828624701901411e-01   +9.134411944916537e-02   +3.754191470779456e-03   +1.078361963694274e-01   +4.972719480299842e-02   -3.445520440106022e-02   +1.742190783183992e-01   -1.227572109183489e-01; -1.692201434258711e-02   -3.839085312462462e-02   -3.682975845135261e-02   +9.317547645221717e-02   -8.208744174681165e-02   -1.890762394716013e-01   -7.358878311623015e-04   +4.864631160245189e-03; -7.941363056788733e-02   -2.958616865373782e-02   -1.616634023462086e-02   +2.012621340112803e-02   +1.234169218807536e-01   +8.468229767211154e-02   -6.245353264701915e-02   -4.225242923108639e-03; -8.344778726693587e-02   +1.695102118802685e-01   -4.095712940773909e-03   +1.326436529163251e-01   -3.922520500461373e-02   +2.400181351415120e-03   +2.369899104291284e-02   -4.580278236608997e-02];
L3I_L3E_iAMPA_netcon = [+9.261904163916479e-02   +2.701233706648352e-03   +2.214657428468972e-01   +3.268442311206064e-02   +5.581793021251015e-03   +1.072935529340033e-01   -1.700533604959661e-01   -1.238564658805277e-01   -5.908366759809371e-02   +3.300778394362118e-02   -7.835692728720391e-02   +2.456332933680816e-02; -4.373161922293646e-02   -4.765608304922340e-02   +2.229757272029855e-01   +3.441388066922883e-02   +5.068590191482480e-03   -2.837523313154496e-01   +3.293857503090040e-02   +2.272636936389979e-01   +1.883481843454536e-01   -8.614265209330629e-02   -9.197372493159907e-02   +3.950581745287632e-02; -2.709963656348050e-03   -1.586333219727240e-01   -1.743254181265024e-01   +3.546737234299438e-02   +1.257613373035732e-01   +1.622661680970630e-02   +4.677106183884164e-02   +1.037399637263139e-01   +2.168793468327647e-02   -3.812515470374383e-02   -5.780420789161041e-02   +1.498966441737009e-01; +4.170988140423355e-02   -7.496504886330985e-03   +2.255211209015105e-01   -5.002155165015367e-03   -1.129703684839422e-01   +8.858201275487093e-02   -1.599131814900824e-01   +7.776238660755179e-02   +6.853588242281829e-02   -5.196565247289307e-02   -4.325343373403204e-02   +1.828842427302803e-01; -6.638613429253447e-02   -2.583942415273149e-01   -1.255660811222749e-01   -1.536974744595836e-01   -2.388146372548786e-02   -1.382424044108943e-01   +1.310512953878470e-01   +1.086636345812665e-02   -1.055222921310115e-01   -1.915318937382713e-01   -9.666329906827330e-02   -1.021820624167106e-01; +1.318284101994718e-01   +9.187027033242019e-02   +3.668574503565284e-02   -1.782963337630485e-01   -1.764347703109185e-01   +5.721082523174227e-02   -2.296652145096196e-02   -4.688973242873371e-02   -3.133617167179009e-02   +1.366209643401489e-01   +6.561853790248807e-02   -5.063155206471088e-02; +1.246925151121795e-03   -1.250911607077156e-01   -8.751477299241425e-02   +1.137998416570997e-01   +1.130537063156135e-01   -8.576761981451339e-02   +1.039373087900698e-01   +6.074913765269380e-02   +7.151686555966253e-03   -4.648480874321924e-03   +1.139973437422739e-01   +1.082068535730695e-01; +5.262729503690096e-02   -4.407226590912628e-02   +9.366366826403288e-02   +4.734636856781134e-02   +2.135765598194951e-01   +1.147378108341348e-01   +8.289960757875904e-02   -1.740957624509910e-03   +5.377921236488643e-02   -3.256062002348702e-02   +2.777444126264885e-02   +1.015250883726455e-01; +2.077524722564250e-01   -1.188238120138401e-01   +9.718297129140975e-02   -1.316650612589456e-01   +4.049726596470182e-02   +1.752599094596783e-01   +1.633534043354661e-01   +8.039100181231097e-02   -1.020222612904905e-01   +4.098511765015431e-02   +4.420548356418588e-02   -2.410556169863886e-01; +7.397421537275983e-02   -5.125189859787399e-02   -8.912955795913008e-02   -2.416268667144151e-02   +1.196262724280153e-04   -1.571298642336687e-02   -1.062426552445437e-01   -4.067380258706895e-02   -1.301256019041608e-02   +4.118487425886633e-02   +1.009218951402431e-01   -1.588713431462337e-02; +1.102956936852127e-01   +2.972969105967460e-02   -1.684376146839558e-01   -1.359774733721685e-01   +1.303362364930395e-01   -1.947349559393995e-01   -6.815176898897855e-03   +1.324669035910510e-01   +7.468987077034216e-02   -3.455556715574818e-02   +1.307947822384055e-01   +3.650364873498625e-02; -1.168135897363959e-01   +1.879666327987337e-01   +7.191092667407939e-03   -1.997194160417375e-02   +1.131972668900495e-01   -1.389298877201002e-01   +3.263188036030318e-02   -1.557570250922035e-01   -8.142669515145920e-02   +2.074205391087914e-01   +1.750945543012996e-01   +1.296861798158506e-01];
L3E_L3I_iGABA_netcon = [-4.247657638042426e-02   +1.429670722804270e-02   +1.263172746465686e-01   -8.570552597940950e-02   -1.213302537087662e-01   -1.359933573281680e-01   +7.763908475081002e-02   -7.533069555860916e-02   -9.790077523260356e-02   +1.951305235152943e-02   -4.656602873131401e-02   +7.318774004512058e-02; -5.998492060648363e-02   -5.600007198434995e-02   -8.967286532714747e-02   -1.047273271854285e-01   +2.393891946322948e-01   -3.184058592803553e-02   -1.967870098032733e-02   +4.519948630763625e-02   -6.000166993943720e-02   -1.343093056605289e-01   +2.406953463396785e-01   +3.705188481628918e-02; -1.044422030927525e-01   -2.020794987062955e-03   +6.849225910211020e-02   +1.269317100941537e-02   +8.138974055487261e-02   +4.038455357825115e-02   +7.045506767846224e-03   +2.846286924756812e-02   -6.510814356993905e-02   -1.043440383758532e-01   -8.706795730717952e-02   -5.563494026960592e-03; -6.963438889161776e-02   -5.646360991803363e-02   -9.315308579893278e-02   -2.139715177582444e-02   -5.379220546463483e-02   +1.709920188732346e-01   +3.485473347356279e-03   -1.933551697319517e-02   +4.665581752038384e-02   -2.647913867217380e-03   -1.512761962615400e-01   +5.967774340260796e-03; +4.676126169020289e-02   +3.632852625046807e-03   +1.032135862342365e-02   +8.901063102729093e-02   +6.822910696389987e-02   -2.185578159139319e-03   -2.985966942018771e-02   -1.851106365224593e-01   -1.702893728943278e-02   +5.291748374212981e-02   -1.866857872573419e-01   +2.238382523259106e-01; -5.279230762834647e-02   -6.074339903558161e-02   +9.800154273732217e-02   +7.050460742399133e-03   -2.134381227527639e-02   +4.145133578094740e-02   +2.892267083292801e-02   -1.022868993809978e-01   -1.399443447636663e-01   -2.933731505815588e-02   -1.004592023859315e-01   -4.383843119199132e-02; -1.324626332930341e-01   -5.190561432058061e-04   +6.684722015644662e-02   -1.567476745174121e-01   -1.565881510204795e-01   -1.173781037122566e-01   -7.168967536571288e-02   +4.382401755862783e-03   +4.166013322248365e-03   +2.101974679968886e-01   +3.010491439254748e-02   -4.098905385702437e-02; +7.049163089352833e-02   +3.509187449249097e-02   -1.050355556890885e-01   -1.479379176682430e-01   -2.888893776371129e-02   +3.012339644721913e-02   +1.700183556088300e-02   +4.327892896237352e-02   +1.736017342725131e-02   +6.986452216950836e-02   -8.930004008623846e-02   -8.718956138809054e-02; -7.169477890153877e-02   +2.007543057402220e-01   +8.837766241962286e-02   -1.358524752762279e-01   -2.339781945310608e-01   -2.027087136443075e-01   -1.579878097845338e-01   +1.268286959936551e-01   +1.117939737651467e-01   +1.320538178049824e-01   +1.119503531568843e-02   +7.258904868729359e-02; -9.071790783929175e-02   -2.375562652537220e-02   -3.312981486606090e-02   +1.601328171027112e-03   +1.220761627550248e-01   -8.088005840311735e-02   -4.598411181220705e-02   -2.997808423441235e-02   -2.241034539598371e-03   -7.642328006284005e-02   -2.640205730124224e-02   -9.547881605724196e-02; +1.362546048463122e-01   +1.273365133085929e-02   -1.106938537516518e-02   +1.720327478008242e-02   -2.305435518133081e-02   +1.419465455329627e-01   +4.724001291971821e-02   -3.445083115941652e-02   +7.629400294243331e-02   +6.046553320200619e-02   -1.030575813589312e-01   -2.841588563777083e-02; -3.237443552178075e-02   +1.173051493874965e-01   +1.209190554734616e-01   +2.683669435213889e-02   +1.747708987550189e-01   -4.998639126750290e-03   -2.428261997102249e-03   +6.336663687288999e-02   +2.955266348092188e-02   +1.635196028485059e-01   +1.311550541263389e-01   -4.357945745046024e-02];
L2E_Input1_iAMPA_netcon = [-3.672536683947517e-02   -1.131305034950448e-01   +1.932646567560843e-01   -1.852038739635613e-02   +4.564850949620224e-02   -1.633496829500638e-02   +2.114649346936427e-02   +1.065013802158375e-01];
L2I_Input2_iAMPA_netcon = [-1.081169179837197e-01   +1.897484157092469e-02   -9.398564848094407e-02   -2.093718305521179e-01   +1.251809480981766e-01   -8.254514844963969e-02   +1.842246446062956e-01   -1.299290158707601e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
