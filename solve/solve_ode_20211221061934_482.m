function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.950536785694723e-01   +3.556865291961633e-01   -1.664980556719725e-01   +7.353458726053150e-02   +5.241802703436481e-01   +3.304001414688645e-01   +5.614867923685253e-01   -1.813351158020618e-01   -8.389648616840123e-02   -6.077790660606232e-01   -1.215411138290541e-02   +7.532520096555188e-02   +2.397090401900535e-01   -3.225191514166281e-02   +3.760555749489911e-01   -8.385820158024451e-01; +1.704339334744782e-01   +3.984185834782035e-01   -4.115382215579418e-01   +2.494732400578176e-02   +6.132800470316127e-01   +4.079461228266869e-01   +8.041733101804933e-01   +8.380364822763758e-01   -9.254581322781784e-02   -7.769704818671701e-01   +2.536936414843083e-01   +9.459850672492237e-02   -3.774533037899596e-01   +1.465733312521490e-01   -8.872133392892081e-02   +2.444156960012676e-02; +3.107847452498185e-01   -9.211064602385804e-02   +3.441779747161332e-01   -3.274242588869686e-01   -5.608477803791466e-01   +2.011318378613884e-01   -2.327381692397092e-01   -4.283328309643665e-01   -5.361716137033431e-01   +7.115885189012350e-02   -5.703014146862230e-02   -3.376255959207870e-02   +8.603685272950359e-01   +4.566590729112450e-01   +2.795562812955589e-02   -3.387008782462077e-01; -3.119725121055977e-01   -4.843074554308541e-01   +2.409396268063154e-01   +3.163285574993865e-01   +9.505836094722314e-01   +6.258994897802174e-02   +1.716942337903160e-01   -6.494101776681262e-02   -1.041009722047516e-03   -1.505162937356391e-01   -1.144881682930229e-01   -7.441926659681390e-02   -2.088909785629120e-01   -4.651474891339209e-01   +1.408668603481331e-01   +2.200673966314175e-01; -1.656488727261004e-01   +2.791718592969559e-01   -9.546800702291064e-05   -1.143175485952009e-01   +6.397248960653420e-01   -2.255190498386159e-02   +8.543615576016421e-02   +5.728559086033417e-02   +1.977323672290973e-01   -1.306563255031530e-01   -4.027567555678609e-01   +6.479111159818385e-01   +3.180270632521570e-01   +2.989679022265416e-01   +1.834798389842424e-01   +5.651117837903922e-01; +2.764707501634839e-01   +5.682538288684781e-01   -1.414916319579486e-01   +3.655433801744527e-01   -1.858033295105608e-01   -6.252578799678948e-02   -2.449320257137234e-01   -5.313164859592698e-01   +8.310513748838723e-02   +3.128959747043189e-01   -2.289543730470393e-01   +8.596189526620635e-02   +3.863441081172601e-02   +3.127302261090136e-01   +5.262135950068382e-01   -4.390724619573784e-01; +1.199306111731195e-01   +3.781776324892950e-01   +6.934847585569985e-01   -5.587711759045042e-01   +4.399510488452608e-01   -1.842349118447771e-02   -3.210983619082245e-02   -5.971828181849878e-01   +5.424700826224534e-01   +9.016957981168082e-02   -6.751731341475171e-01   -2.119164570327493e-02   -1.869046352492339e-01   +5.458701150519312e-01   -4.086006455648440e-02   -1.989169311190288e-01; -1.114872061318319e-01   +3.414407324011712e-01   -1.717909569079067e-01   -3.363881418229411e-01   -1.335579233149694e-01   -1.250625585911238e-01   +3.613078159370504e-01   -4.175310253381683e-01   -4.867015410703178e-01   -2.121706782203787e-01   +1.265206394743738e-01   -6.189946113848678e-01   -5.045059455088378e-02   -4.102342215104503e-01   -2.641736926253926e-01   +4.761944459978935e-01; -1.678684171064107e-01   +3.896209802506233e-01   -2.255394633027776e-02   -5.066221249548634e-01   +3.803142612720432e-01   -2.218027011840702e-01   -2.868095628752536e-01   +5.415862425388915e-01   -2.694787877699993e-01   +2.098691602467364e-01   +3.795104271543275e-01   -1.319879355228243e-01   -3.461952432631352e-01   -2.842526813860704e-01   +5.884190599819636e-01   +9.209335415233864e-01; -1.184272175803409e-01   -8.280510917926263e-02   -2.499920038450987e-01   -1.809007876748848e-01   +5.978075700232325e-01   -1.497051145533197e-01   -3.624695595588329e-01   -6.285498586551120e-01   +1.943273797193528e-02   +1.443586883164243e-01   -4.955546581830335e-01   -9.552671355242082e-02   +2.625023058575922e-01   -2.427846159772672e-01   +5.715419462149849e-01   +5.798988352307922e-01; +1.795023557198411e-01   +2.650681239176179e-02   -6.232895680304622e-01   +2.332196051271982e-01   +4.921395663480698e-01   +1.413040292835810e-01   +8.810401847287479e-02   +3.019839791414394e-01   +2.186546339156923e-01   -8.464220513456068e-02   +1.756171391088546e-01   -3.399081128813311e-01   -2.852612695831717e-01   -3.472832375018766e-01   -9.678722052118974e-02   -5.042808271205916e-01; +5.049305895583797e-01   +8.167221616466785e-01   -2.432389451102690e-02   -3.554251434387918e-01   -4.158270817060708e-01   +1.920271253590023e-01   +3.959219963759892e-01   -3.812853867591117e-01   +3.695366242049186e-01   -3.981262381897404e-01   -5.409463493532639e-01   -1.609140358277595e-01   -4.492333267783197e-01   -1.481165802743508e-01   +1.158632787128779e-01   -4.126318802939515e-01; -3.384543657063030e-01   -6.041411024674473e-01   -4.294108356272594e-01   -2.872530395590032e-01   -1.785254666410905e-01   +9.305956240004725e-03   +8.003976471234945e-01   -2.089951782211832e-01   +3.885924994865186e-01   +4.809274205488585e-01   -3.815307109731409e-01   -4.751572085013616e-01   +1.592477032177738e-01   -2.452767767988431e-01   +2.338285351821322e-01   -1.322820624884406e-01; -3.712153147839702e-01   +1.000558694957939e-01   +2.254930890543120e-01   +7.836014292072775e-02   +1.216660774243405e-02   +1.920465481971271e-01   -1.313346729242937e-01   +7.536244248030742e-02   -4.593135639418580e-02   -3.085123459298821e-01   -5.118210346643719e-01   +2.209739986697407e-01   -6.108336518813625e-01   -3.315639011922475e-01   +4.070185420596377e-02   +1.791296268314123e-01; -2.170816904831589e-01   -5.590534942451812e-02   -3.267513156354490e-01   +8.355226148513070e-02   +3.247474411697239e-01   +5.267623062083969e-01   -1.000000000000000e+00   +7.631436793998272e-01   +1.500010908028988e-01   +1.497598768003856e-01   -1.904394698752228e-01   +4.051498722527309e-01   -4.211367870315298e-01   +1.036438016665663e-01   +1.126219165822388e-01   +2.881958772771480e-01; -7.471377192279864e-02   -5.839439625871582e-01   +3.747498568999941e-01   +3.023478104040916e-01   -1.287468563060777e-01   +3.374881576522786e-02   -1.438116403196572e-01   +1.666134770146849e-01   +7.421489309119086e-02   -2.528274349155462e-01   -2.127912359462326e-01   -1.989245056945119e-01   +2.413020039314957e-01   -4.132175943840479e-01   -2.220003221173732e-02   -4.919090991329878e-01];
L1E_L1I_iGABA_netcon = [+5.347319590495041e-02   +2.039577913286471e-01   -3.819929763986872e-01   +3.054136023062491e-01   -1.579951065779046e-01   -5.542879209323142e-01   -7.643894394223952e-02   +4.696830955923404e-01   -3.222960841735484e-01   -2.650183299285681e-01   -4.656647379234781e-03   -8.260477816280185e-01   +2.354610163219821e-01   -4.355111894323591e-01   -3.226936308327710e-01   -8.864223102340704e-02; +6.925076251425236e-02   -5.028192249324579e-01   -6.718904739636353e-02   -2.151808255976147e-01   +1.170391986322334e-01   -5.675132757907900e-01   +1.196689578901549e-01   -2.234954671855801e-01   -2.424738777666238e-02   +3.796658136124749e-01   +2.036138852519539e-02   -3.424052849862929e-01   -3.818076791811221e-01   +7.089339673158953e-01   -1.494543739790689e-02   +2.392684662238325e-01; +4.561494695961128e-02   +4.900922899495836e-01   +4.301271533085841e-01   +4.484861643962231e-01   +6.311175655540489e-02   -1.665006594676925e-01   +8.586955229988166e-01   +4.775076992685421e-01   -5.699481094897757e-01   +5.503572952313912e-01   -1.882573811156465e-01   -5.909617230600891e-01   -3.642160006080538e-01   +1.094558930822595e-01   +1.213359260741342e-01   -3.800680499987404e-02; +2.734127232111033e-01   -3.974863378261805e-01   -1.904970957116998e-01   -1.464513352221539e-01   -1.705991692862660e-01   +2.015357436681252e-01   -5.916395905840625e-01   -1.115472978767996e-01   +1.580110862214862e-01   +3.294461157083131e-01   +3.300680637147442e-01   +4.106506148234356e-01   +2.100967347660319e-01   -5.763294918287850e-01   +6.437901688904663e-01   +1.910664344102593e-02; +2.800083219943086e-01   -2.988910457449404e-01   -3.034294301543021e-01   -3.420543166166311e-02   -3.848020627598476e-01   -8.020848759558243e-02   -1.424229484394429e-01   +8.283474968336813e-02   +3.004327620146024e-01   -1.894452724134505e-02   -4.794414600334623e-01   +9.503301343525987e-02   -2.541124719803527e-01   +2.657597955411813e-01   +5.927539903310889e-02   -6.758121347230900e-02; +3.021877932329559e-01   +2.759909296249085e-01   +2.215350690606293e-01   -1.554265907280146e-01   +1.091029384729563e-02   +1.809079909042256e-01   -5.117631794109039e-01   -1.828699713366108e-01   +2.400010366580258e-01   +9.184303837779537e-02   +1.000000000000000e+00   +7.501343773447000e-01   +5.054763618723217e-01   +2.514314837544324e-01   +1.824659348827088e-01   -8.237724943601248e-02; +1.974661425943993e-01   -8.835644594988888e-01   +1.835116709492057e-01   -3.871178657571542e-02   -6.122039631745212e-02   +2.388025337388988e-01   +7.411563521162706e-02   -7.102213358058192e-02   +7.837277624154652e-01   +8.821519368481640e-02   +4.905309210099766e-02   -2.408450310791268e-01   -8.769842432691190e-02   +7.863862436340516e-01   -1.717572351108282e-01   -6.378272582869214e-01; +9.021152690419840e-02   -3.401076161767085e-01   -7.436488563041872e-01   -2.713141905476716e-01   -2.445006158774016e-01   -7.121687429279903e-01   +5.524001148499197e-01   +1.840379561157818e-01   -4.012888494380694e-01   +4.121566609515038e-01   -5.324232156227321e-01   -2.004533596550555e-01   -4.200382378084271e-01   -1.502709841904867e-01   -4.377640159413315e-01   -2.520966341808095e-02; +6.653899582918611e-01   +6.247856485399279e-01   +4.034732559129672e-01   +8.236833740008850e-01   +5.046948869759291e-01   -6.458620339338927e-01   +2.785693016545393e-03   +1.229861790178593e-01   -1.842126083837305e-01   -1.534728054895152e-02   +9.619373159724420e-02   +1.997033891398980e-01   +8.516055660228808e-01   +6.607200361259165e-01   -8.464369786575013e-03   +1.162374043266572e-01; -3.322884845396618e-02   -1.316486111709963e-01   -4.544825111452797e-01   +2.471129197026514e-01   +2.348104050011027e-01   -2.925876163110405e-01   +3.942959074037387e-02   +3.661199989841830e-01   -9.750404492750267e-02   -6.218145208733121e-01   -7.449219675481801e-02   +2.385366032634573e-01   -8.528320814076880e-02   +4.256002061941555e-01   -1.722767734212500e-01   -1.157534232832085e-01; +3.513140398699062e-01   -1.924113138466724e-02   +2.773287369167196e-01   -4.470954613415771e-01   +5.401179249782666e-01   -4.133762308406148e-02   -2.794703181085565e-01   +1.049066213000646e-01   -1.784434541298101e-01   -3.475854197618681e-01   +4.337619725162822e-02   +4.647178012854465e-01   -4.748146035962954e-01   +4.672012368597236e-01   -5.487688197950798e-02   -9.827269449670731e-02; -3.352047685752246e-01   -3.681530717973527e-01   -3.942328055754378e-01   +3.417119492623910e-01   +2.794279112007427e-01   +2.997150661716103e-01   +2.262231690896203e-01   -6.140740969047720e-01   +1.701455191596507e-01   -1.412382547147423e-01   +3.405321953884668e-01   +2.471120750375504e-01   -2.338914661608366e-01   +8.839396052516836e-02   -4.844513976710427e-01   -4.820535413785308e-01; +3.380381463532438e-01   +1.293396052340092e-01   +3.228227455218236e-01   +1.726762486640716e-01   +3.705390514511123e-01   +2.055527641797168e-01   -1.576231680242815e-01   +1.663885364958595e-01   +3.708645540016058e-01   +2.626123855684496e-01   +7.331714614174378e-01   -8.642797710261375e-01   +5.691037040506778e-01   -3.010523951846754e-01   -2.722093578005449e-01   -1.958055118985598e-01; +3.157935862807442e-01   -1.018508158776648e-01   +6.819465892388056e-01   -4.347532820428269e-01   -4.991338293952343e-01   -3.782876516882071e-01   +3.650670912810042e-01   +7.140221923443630e-01   +2.094416626925704e-01   -7.113076631858295e-02   +3.994886565840240e-01   -5.839333336010806e-01   -2.424553397382115e-01   +7.645223342228094e-01   +3.657674735566299e-02   +3.046803944430868e-03; -1.048056166622818e-01   +2.638100399264456e-01   +2.309295026992752e-01   -1.929275695511299e-01   +1.288281831781831e-01   -3.805425807692562e-01   -1.007846336186768e-01   +2.814968266568089e-02   +2.116670433547242e-01   -5.258982355992764e-01   -4.171188026805376e-01   +3.430206446752585e-01   +1.865190098572133e-01   +8.289971416621819e-02   +3.212806102524491e-01   +5.921999195419022e-01; +2.302185051256694e-01   +2.434338537353703e-01   +1.945144785274811e-01   +3.434069848889981e-01   +2.396793821647866e-01   -1.569959487004326e-01   -4.538807820032600e-01   +4.779070921493776e-01   +1.097308558100336e-01   +5.124966003508867e-01   -9.795823830693801e-01   +1.072544828281322e-01   +1.073775736191234e-01   -5.074652710692572e-01   -7.628199433414982e-02   -5.829713392544210e-01];
L2I_L1I_iGABA_netcon = [+7.580693035607552e-01   +1.033648014902758e-01   +5.707228852657429e-01   -3.076680311429956e-01   -1.661887013755217e-01   -5.799965102908610e-01   -3.981511266442356e-01   +3.604790685686636e-01; -6.989013369549304e-01   -1.173078384831822e-01   -1.013956376118418e-01   -3.916966285731825e-01   -9.052223487879302e-02   +1.751362584464320e-01   -2.390082704665292e-01   -6.706884576716691e-01; -4.227020333253779e-01   +9.770715763606086e-02   -4.409448321427086e-01   -3.429391492609083e-01   -4.568937589843169e-01   -2.929372310976794e-01   -1.829178295386516e-02   +5.622644061207591e-01; -3.035047104816184e-01   +3.262985762719548e-01   -7.061092230335952e-01   -7.378153553846006e-02   +4.096428437049660e-03   +3.402393525160892e-01   -3.697233574216680e-01   -6.780973560393423e-01; +2.089624245839499e-01   -8.046896661536256e-01   -2.957842863727862e-01   +1.773706259900223e-01   -3.507458740957943e-01   +4.915776343541039e-01   -8.223889011653351e-02   -3.907083140163398e-02; -2.372581995762041e-01   -5.295584450053163e-01   -6.346935370827589e-01   -5.364475989308762e-02   -8.358257556672035e-01   -1.219551063443620e-01   -3.138182881133067e-01   +1.497608098484331e-01; +4.809060357527782e-01   +2.486338807782049e-03   -3.246218817704881e-01   -4.108419170279925e-01   -4.256828098291507e-01   +8.463362617953888e-01   -5.704116402235462e-01   +5.738803056606226e-01; +1.341651963001973e-01   -6.179752856952120e-01   +2.215189614987902e-01   -4.204441265001238e-01   -5.530755045905869e-01   -3.265583917762296e-01   -1.105229077734722e-01   -6.924295336831858e-01; -1.620560999791881e-02   +5.252773661632515e-02   +7.295778217125026e-02   +2.463530778292049e-01   +2.892436056681169e-01   -9.999272592513719e-02   +1.243145721915501e-02   +4.315130852793663e-01; -3.059441862748367e-01   +2.638289721582125e-01   -1.919797434852180e-01   +1.050668579093801e-01   -6.781521035492066e-01   +5.557308934249285e-01   +8.494570205294416e-01   +2.395227028550025e-01; -2.435463536544622e-01   -4.254934997060161e-01   +9.103730874959446e-01   +5.993871837331325e-01   +1.609783337026739e-01   +6.320679237990905e-01   +3.381188583656547e-01   -4.888664152905241e-01; -7.354221826951024e-01   -3.782910680191209e-04   -3.371157757399842e-01   -2.314072563869149e-02   +7.516630709960580e-01   +8.128714890405053e-02   -8.487267383034578e-01   -4.076704551242783e-01; +3.234717269364840e-01   +7.990869935350497e-02   -7.391525538946704e-01   -5.858329592289364e-01   +3.120774370801380e-02   -9.969534422549436e-02   -1.839332736566324e-01   +2.456702002248011e-01; -4.874278349964352e-01   +8.554419753763929e-01   -4.135763832896444e-01   -1.693913796900840e-01   +3.037226955962580e-01   +1.386722568790946e-01   +6.989123131446978e-03   -1.762900798559026e-01; +1.877389703361090e-01   -1.620936196656022e-01   -2.032735975372961e-01   -1.354343777004716e-01   -2.746961316697120e-01   +4.674182658699774e-01   +7.844899384353656e-01   +5.519115331123372e-01; -4.550903319604689e-01   -6.306865531969852e-03   -8.155079423124478e-02   +7.896536382711663e-01   +5.714488811676157e-01   +1.050386015446649e-01   +5.555364469761601e-01   +3.875559195791706e-01];
L1I_L2I_iGABA_netcon = [-4.897483468483099e-01   +6.973235332184311e-01   -9.840536039352715e-01   +4.317053481669817e-02   -4.007386124951914e-01   +1.315361978098314e-01   -2.103601063427449e-01   -2.510196876541401e-01   -1.366260039121425e-01   +2.666023537644953e-01   +3.094910231782110e-02   -3.434037009784787e-01   +4.439694869635977e-01   -1.995547885362351e-01   -6.490033213978916e-02   -6.537636070735087e-01; +3.638336265923307e-01   +4.003052421123585e-02   +1.885694996818980e-01   -4.061144498837762e-01   +8.394199338182993e-01   +4.235142895514688e-01   -1.340864774723077e-01   -8.729925274831847e-02   +4.569552437179636e-01   -2.702904322901861e-01   +1.688939100715121e-01   -3.329093157634568e-01   -1.497207652375116e-01   -3.791536955145191e-01   +7.117226330017054e-02   +3.674028034332218e-01; -5.466207075115501e-01   +1.762265488078388e-01   -6.779543222793366e-02   -5.223375403672659e-01   -3.031273554496017e-01   -5.241495269347431e-02   -3.560228035687872e-01   -8.040133689562291e-01   +5.484301311113300e-01   +1.109856562558909e-01   +2.035438724830172e-01   +1.760890292131607e-01   -5.615232621085884e-01   -2.106209382398124e-01   -5.198070741458897e-03   -6.104243730439221e-01; +3.189290650706243e-01   +6.727495527154164e-01   +2.076698471750726e-01   -1.607528788477091e-01   +5.428679182235375e-01   -1.015627112208180e-01   +7.141210236353089e-02   +2.383289256819451e-01   -1.100610862214976e-01   +4.534945770652320e-01   +6.152524486628989e-02   -4.270574273893811e-02   -9.153010486736350e-02   +6.056574966138569e-01   +3.776970727351908e-02   +1.735653355131359e-01; +1.357978359598666e-02   +7.122967364500262e-03   -7.675188602201218e-02   +2.388509719033229e-01   +1.985525305401894e-03   +4.978866265067132e-01   -3.670733690149760e-01   -8.239017380595849e-02   +4.638309539173121e-01   +7.743185752618366e-01   -4.653767525880645e-01   +1.175574284063167e-01   +6.216590356214091e-01   -4.761871317772615e-01   -2.999980212190880e-01   -2.467161653577172e-01; -7.393957094789881e-02   -4.421157973793154e-01   -6.448947021131254e-02   -3.118015200318517e-01   -3.623678048366847e-02   -2.342886490242636e-01   -4.207580180117129e-01   +2.472891401848329e-01   -4.745360730962294e-01   -9.613103112624249e-02   +5.974933640957504e-02   -5.747023454979983e-01   -8.303574095310737e-02   +8.996386532383210e-02   -3.643623406440623e-01   +6.942425285019072e-01; -4.176090416943609e-01   -1.323735617740814e-01   +2.956841688293156e-01   +2.555494695978715e-03   +7.335217731565776e-01   +1.723189380889948e-01   -1.437103832422147e-01   -5.575682716300809e-01   +9.054105958737953e-02   -7.441570588923930e-01   -1.000000000000000e+00   +3.031535658881111e-01   +8.284145017143149e-02   +4.498336734200332e-01   -3.662969778817727e-01   -3.992034611029748e-01; +4.383758082975111e-01   -5.583479625349087e-01   +1.493007627728050e-01   -1.103120124556071e-01   -2.035426146864404e-01   +1.052501871509972e-01   -2.436236027153052e-01   -4.353162854642690e-01   +1.366719841347686e-01   +2.883481922602709e-01   +3.105233258984903e-01   +2.115240040153983e-01   -7.170305515291794e-02   -3.270204895842459e-01   +6.423590687193857e-02   -5.427394396757719e-01];
L2E_L1E_iAMPA_netcon = [+2.507265843187839e-01   +5.029048824570987e-01   +1.203495602583753e-02   +5.102899542427257e-01   -1.542356075492700e-01   -4.732638416334224e-01   -1.801736470683326e-01   +1.748313088341130e-01; -5.224643750251731e-01   +2.624356416959710e-01   -6.035301279310324e-01   +2.803091800664781e-01   -3.506005351493699e-02   -9.570662546061671e-02   +6.439940661177847e-02   +5.994923952141652e-01; +4.264891417700439e-01   +3.330946952855308e-01   +5.399227559191817e-01   +5.268741508215274e-01   -4.745512110490056e-01   -9.049451310434623e-01   +1.900249418818639e-01   -7.918516861187996e-01; -2.177769480348442e-01   -1.220571416161209e-02   -4.714984514197252e-01   +3.924150456486140e-01   -1.057345175975977e-01   -1.092130070677090e-01   +1.738807267879850e-01   +1.571893826610189e-01; +5.075967511107641e-02   +1.089503749378057e-01   -5.497706864784837e-01   +3.858924581841559e-01   -1.495349627761365e-01   -4.581064766216173e-03   -4.632911194734048e-01   -9.466134500480887e-01; +3.472450769554360e-01   +6.546887508228780e-02   +6.370261442598686e-02   +3.793854407900530e-01   -3.567209321447061e-01   -5.168914786409763e-01   -4.367859846590857e-01   -8.250970346099609e-02; +2.055669229441278e-02   +7.008844825265856e-01   +2.048656216390864e-01   -1.000000000000000e+00   +1.927949372481683e-01   +3.226199275036500e-01   -6.835705693578734e-01   +2.357220317338016e-01; -1.994674766027651e-01   +9.311573016800122e-03   -4.211298305411494e-01   -2.422584588204048e-01   -1.156077475374676e-02   +3.082263103758332e-01   +9.617889259450882e-02   +2.744434638054321e-01; -1.941859870263177e-01   +2.888884351429529e-01   +4.112097486434572e-01   -1.328730951164679e-01   +7.677371124741660e-01   -7.203844740732963e-01   +1.874936928721689e-01   +3.019317662047223e-01; -2.547344767387739e-01   +1.349739133062551e-01   -4.995573930216538e-02   +5.992571911410219e-02   -1.189088854851300e-01   +2.235727673780551e-01   +2.541500913176817e-01   -3.638650257466990e-01; +1.614417641275852e-01   -5.219987523312846e-01   +2.516905882847406e-01   -2.188734159195563e-01   +1.400776214192250e-01   -4.006403177485106e-01   +1.016851643975770e-01   -1.925078033244525e-01; -6.488714410417525e-01   -2.523129910550028e-01   -2.622793550510422e-01   -2.492223251680668e-01   -1.722823335611000e-01   +7.034174439750763e-01   +6.623887563094411e-02   -1.419759828910605e-01; +6.736515022700917e-02   +3.260648243546203e-02   -3.598763270386420e-01   -2.931611198576597e-01   +6.519087483377928e-01   -4.349105891691976e-01   -1.388773879640263e-01   -8.315461469969705e-01; -2.072811410527154e-01   +1.542934040910164e-02   -1.729819315645041e-01   +2.877218723619803e-01   +5.529485445713251e-01   +4.631884741714012e-01   -1.992015385738155e-01   -1.955041736756403e-01; +1.478124080483234e-01   +3.982815937620841e-01   -7.052719751677758e-01   +1.411576370953158e-01   +4.008722511084780e-02   +4.752168414237352e-02   -2.312086162494182e-01   -5.170703743668144e-01; +3.473601670376831e-01   +6.691770164367123e-01   -5.282631970296831e-01   +1.220725383901218e-01   +1.206814020179968e-01   -4.022477449979315e-02   -3.505218231882751e-01   +7.736233510624410e-01];
L1E_L2E_iAMPA_netcon = [-1.073047506799262e-02   +4.745883493070921e-01   +3.100930724335969e-01   -1.934343403189079e-01   +2.223286847240446e-01   +6.336943023767603e-03   -1.264610131195527e-01   +1.002384076694951e-01   -2.449725748321567e-01   +6.412029247929103e-01   -4.707149707112723e-01   -1.526739739617360e-01   +9.499568526120453e-02   +6.491870870001806e-01   +3.042350383818572e-01   +2.008013113359256e-01; +1.600406470343718e-01   +2.693138185051703e-01   -3.430451204324673e-01   +4.475258521030064e-01   -9.406771002701761e-02   -3.084634568735742e-01   -2.137013073286569e-01   +7.064986952271654e-01   +3.110759363570717e-01   +4.714356246112569e-01   -4.025364396205677e-01   -6.927937358696055e-01   +1.213985805034572e-01   -4.419769336252922e-01   -7.088516420499304e-02   +3.563641439977292e-01; -8.820513589651959e-01   +3.131690471295479e-01   -3.754690736089126e-01   +3.060912104489250e-01   -2.085846541227416e-01   -9.584920524203808e-02   -8.690726730829797e-02   +1.222985995304202e-01   -7.839782713429145e-01   -3.093716600398442e-01   -3.543565820650690e-02   +3.739838792908293e-01   +2.831434141732471e-01   +3.622676760277469e-01   +3.456866934964383e-01   +3.479909933032692e-01; +1.599705331551041e-01   -8.962247756636716e-03   -6.013540332112104e-01   -4.898249980952422e-01   -5.299843789142046e-01   -4.315215367549473e-03   -9.212582295493989e-02   +3.736536257869712e-01   -4.202838864982211e-01   -1.246017179131623e-01   +6.675438395654824e-01   +1.808869902243989e-01   +2.371587471635420e-01   -2.921552434866547e-01   -1.000000000000000e+00   -1.940789352708147e-01; +4.663084408234501e-01   +9.043715354256694e-02   -1.554958715680835e-01   +9.451514059051003e-02   +4.263436841707370e-01   -5.903201501941230e-01   -1.197762202347446e-01   -4.450937518506274e-01   +6.103258380089587e-01   +4.241358537562115e-01   -2.421138351381680e-01   -2.322310827790727e-01   -1.709843245723811e-01   +3.036837601584418e-01   -4.109769557225511e-01   -1.254951469548072e-02; -4.515204173457697e-02   -2.133664490336610e-01   -4.401966299434347e-01   +1.763389472770679e-02   +5.416937897026726e-01   -1.953822290017291e-01   +2.344496936470126e-01   -3.924132091252602e-01   -1.615406587059076e-01   -5.209530171062854e-01   +1.649195330797284e-01   -6.577210746173549e-01   -5.736007180041139e-01   -1.208147022730857e-01   +5.525670219071542e-01   +1.995448031607744e-01; -2.925747795936355e-01   +3.205280992270890e-01   +2.762321036508886e-01   +1.603992923630827e-01   -2.468103743176019e-01   +2.839861579978455e-01   +7.242464220394497e-01   -5.285102196227895e-01   -5.039787859840337e-01   -9.446414869396351e-02   +5.638216660531297e-02   -4.996702524528894e-01   -8.542827247836042e-02   -2.206934047794848e-01   +8.701111740423558e-01   -1.005112047560876e-02; -3.862681282730888e-02   +1.669653072286745e-01   -3.470046098888732e-01   -4.922567160557653e-01   +5.691854851599323e-01   -5.436534915239807e-01   +4.995554086214146e-01   -1.306864200974127e-01   -7.962019140617734e-01   +2.979956408955266e-01   -2.388252863391492e-01   -4.946368328309866e-01   -5.675318631352713e-01   -2.235507655734405e-03   +1.005967860965609e-01   -4.680162104422801e-01];
L2I_L2E_iAMPA_netcon = [-4.744394668140472e-01   +3.337343102655905e-01   +2.297300611353458e-01   +4.633724936982607e-01   -1.901671674156249e-01   -6.535854714222828e-01   +1.543972618519114e-01   +1.347469272631768e-01; -2.396333381577009e-01   +3.553189862048050e-01   -3.432911624095042e-01   +3.544141747272628e-01   +5.864874683530443e-01   +5.680817189780298e-01   -5.900594803242557e-01   -2.983397980734840e-01; +2.918549598568821e-01   +6.886590351162750e-01   +4.541302108578608e-02   -4.957399329651976e-01   +1.862912259670828e-01   +1.010724413962009e-01   +3.239556214262607e-01   +5.370713765823959e-01; -1.488368981892393e-02   +4.382345971941836e-01   -1.876537111884247e-01   -3.447934639581933e-01   +7.446964992823867e-01   +5.258880123049332e-01   +7.264700112978888e-02   +4.573734631628580e-02; +2.962605852863305e-01   -2.997688461672312e-01   -4.487203851240202e-01   -6.835293028834725e-01   -7.084669102236352e-01   -1.400159583304821e-01   +7.522745780524012e-01   +2.440781152198032e-01; -1.886558169800638e-02   +4.462269137054735e-03   -3.980055358033324e-03   +2.487557664678330e-01   +1.886139015868928e-01   +2.060428684898519e-01   +3.768358287159364e-01   +7.970365254911141e-02; +3.392765317686789e-01   -5.041328190587919e-01   -1.469722398854966e-01   -2.130110953116033e-01   -1.463684770857966e-01   -2.272263673816403e-01   -2.521385632378884e-01   +2.616114564824112e-01; +5.592529044470638e-01   +2.485192059270230e-01   +3.020025433618949e-01   +3.224025739889869e-01   +1.000000000000000e+00   +3.746225828623603e-02   +9.787590381731368e-02   -1.246069200842686e-01];
L2E_L2I_iGABA_netcon = [-4.065085269275849e-01   -7.962497054455806e-01   -8.813932939143045e-02   -5.370341023821827e-02   +2.319706293778311e-02   +2.041534801628787e-01   -4.721052358159522e-01   -1.900241227627487e-01; -4.715444466247378e-01   -1.216705419349529e-01   -3.096073682483860e-01   -1.237197683061099e-01   -3.711612297271039e-02   +2.671329275057327e-01   -1.698985963143909e-01   -1.000000000000000e+00; -2.256511600152142e-01   -4.793109766678739e-01   -1.764942441615754e-01   +6.535747661989444e-01   -5.068256981636146e-01   -7.666198764300411e-01   +3.560384628525652e-01   -7.567609795472385e-01; -2.986984772159449e-01   +1.258452963912248e-02   -5.859487224202093e-01   +3.473943910777262e-01   -6.185434115999517e-01   +2.102278299839616e-02   +2.622402167456160e-02   +3.956251212226090e-01; +8.413306925700477e-01   -1.633438948270131e-01   +1.384091976301071e-02   -6.813240415921288e-01   +3.367296043565066e-01   -2.908187136329145e-01   -3.784379588379982e-01   +6.595273177739686e-02; +2.510493539970734e-01   +1.417974585963136e-01   +6.221587608247568e-02   +5.631306331070283e-02   +1.465842649641923e-01   -1.431779942799365e-01   +2.051980925585068e-01   +2.273826964361112e-01; -6.982322526946891e-01   -6.249269806852124e-02   +2.654621270537310e-01   +4.848619325911996e-01   +2.204807031144128e-01   +6.122522803800717e-02   +3.253269174296756e-03   -1.752840198203589e-01; +7.136747171121174e-01   -6.789158077863368e-01   +6.002155956202813e-02   -1.283397133477188e-01   +2.866646985282311e-01   -2.271339162432616e-01   +4.683483268712779e-01   -1.169960878030789e-01];
L3E_L2E_iAMPA_netcon = [+7.454129911001628e-02   +8.670586843909864e-01   +4.359607309661231e-01   +6.628389062287415e-01   -3.953638275488375e-01   +3.151448710907395e-02   -2.680867810489329e-01   -3.324160434537916e-01   +1.583309919722681e-02   -1.424171075870678e-01   +2.057942818729053e-02   +3.401440567677658e-01; -6.610389062369849e-01   +4.618993312165670e-01   +5.008670916729331e-01   -9.813548502775666e-01   +5.932891823083578e-01   +2.507335948190748e-03   -3.644699950122451e-01   -1.560060030328090e-01   +1.084973693304408e-01   +2.441865460875925e-01   +4.947603867253747e-01   -2.281975431028416e-01; +1.947147523679368e-01   -1.607224925508343e-01   +2.495675355587078e-01   -3.468048562580511e-02   +1.660789676041310e-01   -3.038449569341347e-01   +1.081326118007534e-01   +9.125708930941792e-02   +1.566488711845672e-01   -6.119314124606975e-01   +3.088784828387109e-01   -5.462318556541099e-01; -4.003271493149910e-01   -2.716448328823757e-01   -3.904695204629621e-01   +4.441778534639875e-01   +5.290736045835578e-01   +2.875941130154575e-01   -2.063118703438319e-01   +7.292698120138068e-01   +2.869599649005186e-01   +4.038470951436704e-02   +1.057383088597258e-01   +3.599215533357767e-01; -1.311534264422241e-01   -9.423081039615588e-01   -6.978815915787653e-03   -2.230772660341372e-01   +2.958054626867089e-01   +1.720382653242084e-01   +5.002602500048590e-01   -5.221015276328846e-01   -3.910338125989175e-01   -3.965182442727725e-01   -2.474838356248906e-01   +9.105902625647143e-02; +4.890237322386876e-02   +9.250647052385820e-02   -4.241326723750414e-01   -6.465118098984717e-01   -1.008736681642917e-01   +1.047967465210139e-01   -5.814919572125682e-01   +2.875892795964337e-01   +1.876938729128604e-01   +5.522186156323080e-01   -4.101941744494140e-01   +7.236844871727244e-01; +1.096472341280903e-01   +4.771827931367881e-01   +9.985613134174159e-02   -3.550618049889265e-03   -3.943735640119318e-01   -1.703025947458320e-01   +5.084336750791729e-03   +5.435342765940410e-01   -8.569524585434768e-02   +2.982231641403080e-01   -1.896202079032694e-01   -2.730566438483625e-01; -1.518932317199165e-01   +3.182435215285752e-01   +5.397617726565012e-01   +2.420303842263111e-01   +6.012727375105442e-01   +1.308799864047153e-01   -6.430318298961846e-02   -7.992283293772884e-03   -3.536244255770595e-01   +9.928489619793017e-01   +2.632650984347069e-01   -8.051475494383437e-01];
L3I_L2I_iGABA_netcon = [-1.635017828569491e-01   +4.678925783849282e-01   -4.641661716473075e-02   +1.230189910047715e-03   -2.448014824916118e-01   -2.976569841386024e-01   +4.658880378751971e-02   -2.444877228260450e-01   -8.896441530319364e-01   -3.577205999714794e-02   -5.760076284947748e-01   +6.168243723679212e-01; +6.609846302897204e-01   +1.573861508814774e-02   +2.778798665716067e-01   -4.960543538520460e-01   -1.173789479262984e-01   +2.828844448998385e-01   +1.784403088062513e-01   +6.005023580390402e-01   -6.837427601042055e-01   +9.623549757680241e-01   -7.525298718595821e-01   -8.972713670861308e-02; +7.700782413734668e-02   -5.905288067320932e-02   +3.433588474126007e-01   -7.790623262516087e-02   -4.372084879742454e-01   +1.534255760197445e-01   +3.079509642721656e-02   -3.329431295065325e-01   +4.454923918045957e-01   +3.437364377787917e-01   +2.664205508495135e-01   -4.711898142757623e-01; +8.813094236387551e-01   -3.035749164090830e-01   -4.563606058245891e-01   -7.747156625329524e-01   -6.493072296174293e-01   +4.275290736476524e-01   -4.988442714732708e-01   +7.310699847263581e-02   +8.978225827046077e-02   +4.490233423066666e-01   +2.655477651114581e-01   +3.481506725870499e-01; -2.712857755202900e-01   -4.401644715433380e-01   -2.803121627200864e-01   -3.553780470170983e-01   +2.028873825739949e-01   +6.361923856730213e-01   +5.355500720920140e-01   +1.165698083109289e-01   -1.436317460873019e-01   +2.472066064492125e-01   +2.488493224326427e-01   -3.339955185662480e-01; +7.968331771177338e-01   -1.000000000000000e+00   -1.295781662633857e-01   -1.104348327388123e-01   -1.195785569664166e-02   -1.455112153339305e-01   -2.135055494994998e-01   -4.322283259589311e-01   -2.720546592664957e-01   +2.644279677929273e-01   -6.317856619389135e-01   +3.754632794576785e-02; -4.637804798107610e-01   +9.582744450576141e-01   +1.985575443030130e-01   +2.074514946267401e-02   -6.679474305454868e-01   +1.398448837010536e-01   -4.334678636182728e-01   +4.775325009625869e-01   +2.883794840611764e-01   +2.302066197270687e-01   -3.947838381940373e-02   -3.407897318695460e-01; +1.833732607063036e-01   -2.867789036168703e-01   -4.066950664887185e-02   -6.201507488615264e-01   -5.131913590122328e-01   +5.354283260395254e-02   -6.444897154428736e-01   -5.988689773287417e-01   +3.221392547996431e-01   +1.287308876757908e-02   -1.463459980047407e-01   -3.717959588086838e-01];
L2E_L3E_iAMPA_netcon = [+6.496376313225285e-01   +2.298540294344512e-01   +6.394202361817352e-01   +3.005374802280353e-02   -1.314297773689674e-01   +1.471788912500965e-03   +5.515895356064258e-01   -2.664978607448215e-01; -6.774326058736915e-01   -4.037323110644644e-01   +7.615067542125162e-01   +5.135479768075932e-01   +4.403620558530691e-03   -1.673743951273121e-02   -9.877931463045462e-01   +1.290838659008295e-01; -3.013085065722196e-01   -2.430699447241074e-01   -1.195037617946389e-01   -6.967447395178696e-01   -3.594372960696448e-01   -2.594337127160590e-02   -4.413718470920898e-02   -8.341429468500010e-02; -1.488954555098120e-01   -1.290740570913515e-01   -1.354606907513679e-01   +4.993637236111561e-01   -3.129226253933046e-01   -7.230506186532981e-03   -2.123644285847086e-01   +5.294169799281507e-01; +3.857289761114719e-01   +6.176270859213778e-01   +4.274867039924800e-01   -8.878225967334752e-02   -5.899442048142038e-01   -1.550619593278389e-01   +2.239806576468570e-01   +5.084564929520573e-01; +1.609985674198206e-01   -9.809667711096319e-02   -4.629077884909790e-01   +2.110200969910073e-01   -3.045136029994744e-02   +1.975457359150647e-01   +3.389729255933506e-01   -1.154458736001642e-01; -2.598796976542508e-01   -1.875932140736168e-01   -3.962191550044944e-01   +8.953824376463429e-04   -5.855262653262086e-01   -7.540942113917870e-01   +3.832130605407230e-02   +1.501601063747493e-01; +3.960594434078285e-02   -7.172838348353337e-02   -1.713900672668102e-01   -1.308064524882462e-01   +5.915934415743711e-01   -7.836916818990523e-01   -9.109813245123191e-01   -5.750673218637656e-01; +3.350260195978226e-01   +7.160999709845279e-01   +5.287295116362993e-01   -4.007349311813861e-01   +9.763778391940099e-02   +2.067341719169675e-01   -8.072806179561550e-01   -6.939387163902633e-03; +6.728822090750326e-01   -3.097716051445982e-01   -3.305852965925166e-01   -1.429956766428963e-01   +4.517135685318683e-01   -2.497800196728536e-01   +1.831117576603780e-01   +3.578164392152389e-02; +9.537297741047515e-01   -7.231384283771376e-01   -3.939972168951232e-01   +7.547546493480634e-02   -3.271828452374139e-01   +8.520925721867465e-01   +5.955678715833856e-01   -7.922798480816375e-01; +5.962597166571496e-01   -8.571043232358963e-02   +5.153341868379022e-01   +7.568965614848434e-01   +5.375533904039076e-01   +6.870555339896645e-01   +3.822397136070514e-01   +5.218672150390798e-01];
L2I_L3I_iGABA_netcon = [-5.433324474611284e-02   -4.905093312678530e-01   +6.495394848760365e-01   -3.788665448669303e-01   -2.861819428767194e-01   -2.419200344552591e-01   -6.644808385939439e-01   -3.125237666367764e-02; +4.351561773195690e-02   -2.630491373312324e-01   +4.887042091094385e-02   +1.070557533046387e-02   +5.662997683781243e-01   -8.711888825339674e-02   -1.721066138550758e-01   -4.573114579749181e-01; +4.167253636084813e-01   -3.357031171379391e-02   +2.592409113006597e-01   +2.454020103856202e-01   +1.081497247195136e-01   +3.766129307132043e-01   -1.878252439270667e-01   +4.782861257909891e-01; +2.352967350241373e-01   -2.896673852758375e-01   +1.049524630698596e-01   -5.102844466112945e-02   -1.596837124665922e-01   -1.278583406681431e-01   +5.154129893178945e-01   +1.000000000000000e+00; -5.570371246440036e-01   -4.185864449959831e-01   +3.356424317382403e-01   +3.455878420147845e-01   +9.004840625669754e-01   +2.571760217593875e-02   +1.530897687293801e-01   +4.554307301972896e-01; -2.931798359114152e-01   -1.918223859171040e-01   +5.357462002855957e-01   -2.004341663731341e-01   +4.907857317766842e-01   -1.771448235802137e-01   +2.025061256800083e-01   -2.768775112793329e-01; +3.415494365873636e-01   -1.204492553705359e-01   +2.876143371655309e-01   -8.173405956708114e-03   +4.384824430046883e-01   -2.534949605095004e-01   +3.092842335434819e-01   -3.184648965506365e-01; +1.712580208634482e-01   +2.882550848240246e-01   +2.830979586196427e-01   -8.392700610839753e-03   +3.703865723017525e-03   -6.297257116985776e-02   +8.715604460516156e-02   -4.946309541600901e-01; +1.807420904077922e-01   -6.016535743707917e-01   +6.821589354340267e-03   +4.576717017668825e-01   -3.746642188175912e-01   +5.747834822787272e-01   -7.031210597233399e-02   +2.304357123228158e-01; +7.841998418788282e-02   -2.350197489624163e-01   -1.327902760940028e-01   +3.735499202973921e-01   +4.726350335644655e-01   -1.585586173586476e-01   -3.952019905113776e-01   -3.958595893074823e-01; +2.258911775465728e-01   +3.172427909256194e-01   -5.045276661709019e-02   +2.665734471912464e-01   -5.466928499612412e-01   -1.270305931305931e-01   -4.545181291749900e-01   -1.738429057980865e-01; +2.025717251768407e-01   -8.461225059493765e-02   -2.176535543935453e-01   -1.543739010061591e-01   +7.924012364101658e-01   +6.313981481490374e-01   -1.990632821715032e-01   -1.412547338538666e-01];
L3I_L3E_iAMPA_netcon = [-2.868670268138686e-01   +1.422044813866579e-02   -1.552169368385272e-01   +7.667421517574091e-01   -2.314510525814136e-01   -7.463550749127410e-01   -1.763308780168515e-01   -1.011412823920862e-01   +6.775579888750183e-02   -4.012819376953169e-01   -1.488583564273894e-01   -4.441057766869694e-01; -5.092586057870336e-01   -2.912863964744635e-01   +1.909190610435688e-01   +9.451590493367845e-02   +3.850500829919108e-01   +3.375622864327634e-01   +4.753329398572312e-01   +3.417756431207354e-01   -4.935069212552310e-01   -3.220092566319192e-01   +4.523104872697243e-01   +7.911106330696386e-01; +7.467728943270949e-02   +8.648140532628659e-02   +7.757311286806211e-01   -1.439733781516447e-01   +4.790971186775492e-01   +3.597069336500208e-01   -1.848876298912550e-01   +6.348132076067179e-01   +3.969865010578710e-01   +2.192653110243049e-01   -1.449229738242301e-01   -1.942865774416992e-01; +4.980335690113289e-01   -7.863956440927912e-02   +2.182475819630493e-02   +7.934326268779440e-01   +5.619026387893016e-02   -3.873021079803209e-01   -1.739016708607007e-02   -5.382554235426746e-01   +2.479452551039309e-01   -5.990901743576740e-01   -3.821494332917091e-02   -2.526039952422173e-01; +1.923453377993852e-01   -4.349896880118312e-01   +5.715404295665416e-01   +2.695032659859345e-01   -6.103887380267710e-01   -6.247014301876326e-01   -6.893399240515362e-01   +9.430889558375984e-02   +1.354367750718623e-01   -4.067809530793991e-01   -1.783793478829071e-01   -4.183285389394274e-04; -5.113598459896344e-01   -2.155626648076180e-01   +1.472935853799693e-01   -3.659126430914996e-01   +3.830499340414426e-01   -5.740435117765023e-01   +9.516758989138907e-02   +6.877001971244799e-01   -1.000000000000000e+00   -7.352232798487126e-01   +1.897993096051585e-01   -1.121468551563783e-01; -4.858514929256563e-01   -1.041800230198766e-01   -3.767555115416035e-01   -3.368437896688106e-03   -2.601679320562635e-01   +4.535796486786619e-01   +1.161633112143393e-01   -2.865259246976397e-01   +8.014413863962329e-02   -6.986071358390216e-01   +2.952617307053514e-01   -2.184815994609443e-01; -5.199687978629296e-01   -4.644712192069843e-01   +3.421608727734218e-01   +1.699554148572813e-01   -2.091832108193738e-01   -1.441361132402755e-01   -4.337133492036124e-01   +2.551174522574926e-01   +4.261179943247910e-02   -6.935850587923589e-02   -2.651543740556945e-01   +1.331652024299994e-01; +3.108169240450809e-01   +3.571273316416029e-01   -6.070453638261142e-01   +5.093532883203104e-02   +4.741438171342922e-01   +4.677247596074245e-01   -3.104053102252862e-01   +5.009678026670029e-01   +4.487099583885653e-01   +2.171057667343428e-01   -1.969790430723762e-01   +5.225265474219671e-01; +2.283147145148171e-01   -5.971268284026933e-01   -2.222330819661825e-01   -1.498320524444039e-01   -1.026093346030530e-02   +7.758600621429914e-01   +4.532983296829748e-01   -5.707785174442171e-01   +3.121296898472022e-01   +9.428338845386831e-02   +9.294638352001292e-01   +3.891650305719205e-01; +2.615868607273729e-01   -2.433857922723820e-01   +4.839963217431056e-01   -1.560033238994974e-02   -8.967088390422145e-02   +6.176199579064522e-01   -3.633760276422049e-01   +2.398782198993361e-01   +2.170486622473402e-01   -1.146582473648738e-01   +4.477516046161122e-02   -3.209796021412330e-01; +1.507949245972449e-02   +1.552693382305503e-01   -4.426511159010937e-02   -9.663834130931560e-02   -5.881193771726161e-01   +3.604029755383263e-01   -1.942062897340908e-01   +6.320014806799703e-01   -6.018407266904744e-01   +3.036517907047072e-01   -4.167870554962935e-01   +6.042339847963590e-01];
L3E_L3I_iGABA_netcon = [+2.556097244852440e-01   +4.027477994327160e-01   +1.239509675189033e-01   -5.706189941294366e-01   -3.793054794639856e-01   -7.564101687313619e-02   +2.908558408658864e-01   +1.851859374100169e-01   +1.314042228484877e-02   +1.882917322591258e-01   +1.742772892417980e-01   -6.184446560477010e-01; +2.175558711193386e-01   +2.012685691162134e-01   +1.296976482463491e-01   -2.353700077232929e-01   -4.795585371462346e-02   -3.092761098511995e-01   -1.445424904067295e-01   -3.970115119357079e-01   +3.825375576609024e-01   -5.320702914759515e-01   +7.748524142369465e-01   +2.185534430004010e-01; +5.387300598181877e-02   +4.915219410949215e-01   +3.457606882631458e-01   -1.014327609789034e-01   +1.311060724927761e-01   +2.767163033669701e-02   +6.407211699412080e-01   -9.608219686678222e-02   -3.882892292819430e-01   -1.199613366115772e-02   -2.694431546636527e-01   +9.250260467079871e-02; +6.874817104757451e-02   +2.872996553589847e-01   +3.653135231679508e-01   +4.945435428244210e-02   -3.912741991821011e-01   +1.032307434079597e-03   -1.934739731841687e-01   +7.666490705165513e-01   -6.056550571443099e-02   +9.205525369523668e-01   -3.209509001365869e-01   +5.833641855441440e-01; -3.590399653536197e-01   +3.267020557100491e-01   +4.261047327575314e-01   +4.182092693044566e-01   -2.645389943343038e-01   -1.687725105083291e-01   -4.468946916594340e-01   -7.087423242605516e-01   -4.729892216186555e-02   -4.554419895386084e-01   -5.047331960679461e-01   -1.376669194323981e-01; +2.064851697099118e-01   -5.374119824120869e-02   +5.706939726396900e-01   +1.623103937150032e-01   -1.986724269513852e-02   -3.478176411432385e-01   -5.968460221562101e-01   -2.531339886661644e-01   -2.024183136361950e-01   +6.397956623163384e-01   -1.936445935716699e-01   -3.461280309021620e-01; +7.348986075129379e-01   -1.438851346753800e-01   +3.983718881259329e-01   -6.894002261148240e-02   -3.677107946526200e-01   -1.763105278170390e-02   +2.669172887568478e-01   -6.279850427747774e-01   +1.292009843682737e-01   +1.644982078270325e-01   -1.806569963952794e-03   +2.519014868942810e-01; -3.125579078296656e-01   +4.408401190922029e-01   +8.708890987891997e-02   -1.109917976413422e-01   +2.661290717008489e-01   -9.927891370468588e-02   -2.813619426121508e-01   +1.000000000000000e+00   +2.874867587783942e-01   +7.695334160881269e-02   +7.331345342985146e-01   -1.356667645573675e-01; -3.581353073561884e-01   +3.327456347141640e-01   -7.919092216372594e-01   -7.441364030135330e-01   -2.922463851026287e-01   +8.919152302962736e-02   +9.014376442753487e-02   +3.692170988532085e-01   -3.112560648223078e-01   +4.912963538939376e-01   -4.932362820116987e-01   +2.325363435111540e-01; +2.365348077653029e-01   +3.263099143891509e-01   +4.150759703598373e-01   +1.981298432355363e-01   -5.052578819857750e-01   -2.514956994214954e-01   +1.119186085617413e-01   +1.745975963288936e-01   +4.126516235030648e-01   +2.483136577312000e-01   +7.386231155098381e-02   +8.483441211761278e-02; +2.173135256928921e-01   -3.215526284803750e-01   -4.921637064245750e-01   -4.666991653207410e-01   -2.802018702587167e-01   -5.837462016647680e-01   +1.117948485691031e-01   +6.987180100137311e-02   +2.592402047522835e-03   -4.421311859741141e-01   -3.613876669907014e-02   -7.177593227492432e-02; -8.008805407178200e-03   -3.357910706504440e-02   -6.439627055539579e-02   +3.317833148929354e-01   -1.215261379902197e-01   -1.422999880728319e-01   +6.465872159887397e-01   -2.570432636480487e-01   +4.916333711149243e-01   -8.674149975993552e-03   +3.948682396617715e-01   +4.429406176449784e-01];
L2E_Input1_iAMPA_netcon = [-7.765114260519086e-02   -3.279616657937531e-01   +2.630043090170211e-01   +1.000000000000000e+00   -2.320550438835166e-01   -3.411304857096733e-01   +3.583089758271545e-01   +2.064838337933383e-01];
L2I_Input2_iAMPA_netcon = [-2.570452472936323e-01   +1.203018518382056e-01   +3.505035015046565e-01   -2.357183084914280e-01   +8.422338227160656e-02   -4.564543136271665e-02   -3.627046037920235e-01   +3.834663853910837e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
