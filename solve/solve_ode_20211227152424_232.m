function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.240878542491065e-01   +2.071715621747500e-01   +1.027549338452101e-01   +1.182700624177418e-01   +4.036709467790882e-01   +3.581098016420967e-02   +1.562485307551058e-01   +2.053781367026237e-01   +7.171501057191321e-02   +2.447056239468522e-01   +4.124337097424657e-01   +3.697674580094201e-01   +1.106708618599126e-01   +2.587968792801131e-01   +3.582253427713356e-01   -1.085454343839939e-02; +9.507979453670001e-02   +1.158747948562115e-01   +1.330102739140171e-01   +2.899039849635480e-01   +1.443714354005284e-01   +2.873556404852078e-01   +1.262536979468655e-01   +1.034367757554515e-01   +1.381501939897774e-01   +1.563869884621464e-01   +7.795751686946449e-02   -2.144085948117310e-02   +3.449711648002332e-01   +1.803410979749439e-01   +1.960833122032721e-01   +2.556479472847009e-01; +2.536627125618601e-01   +1.609684506881472e-01   +1.724939297339780e-01   +8.980681069793696e-02   +1.178654775524006e-01   +8.463384292375882e-02   +2.552538587437487e-01   +1.046464890024068e-01   +8.007354384714216e-02   +4.022091858521664e-01   +3.869515077823970e-02   +3.420495482338275e-01   +2.568506418604437e-02   +2.946608374355856e-01   +1.283848909450954e-01   +3.288540521924168e-01; +3.269035755998692e-01   +3.158605652441071e-01   +3.419387666295710e-01   +3.789926638600399e-01   +3.156396688556838e-01   +1.978951060097518e-01   +1.894287820100841e-01   +3.333797780324683e-01   +7.109516116236761e-02   +2.890774538659712e-01   +8.323800274065615e-02   -3.186368698493506e-02   +2.153877068410580e-01   +7.958085501390016e-02   +2.849363089823469e-01   -6.617185372779281e-03; +1.609361006942240e-01   +2.835028704329633e-01   +3.481512326553604e-01   +2.160050158642140e-01   +2.678684296249912e-02   +8.972343707707298e-02   +3.480984513135346e-01   +2.390156150566823e-01   +1.030917835226645e-01   +5.116215434822623e-02   +6.581913930864541e-02   +1.779334718835009e-01   +3.004769380120879e-01   +2.290798760075838e-01   +3.210725774265909e-01   +3.978544336204672e-01; +2.023390910178333e-01   +1.910506267737036e-01   +1.826405926803653e-01   +3.695538777845154e-01   +9.796785443719283e-02   +4.775773191738623e-02   +1.927197274535524e-01   +2.765186095873391e-01   +3.043112641847168e-01   +2.109687870968620e-01   +3.709960084925625e-01   +3.419104106137237e-01   +1.674205062683245e-01   +1.861884436818097e-01   +1.366204811060031e-01   +1.347318802796250e-01; +3.206868808918951e-02   +1.052024770135268e-01   +2.123377155549351e-01   +3.223026722788311e-01   +1.183890993803045e-01   +7.987482258860928e-02   +1.980510098184056e-01   +1.781456337846241e-02   +3.400960655716297e-01   +8.097923710857628e-02   +4.598054769128248e-02   +1.964796867842353e-01   +1.779124266391757e-01   +1.492370130484456e-01   +2.809641205077357e-01   +2.375055079412021e-01; +3.164960397704619e-01   +5.324732039825442e-02   +6.665687928767136e-02   +9.400614592165109e-02   +7.840876128073833e-02   +4.151102592425963e-01   +1.394895631426208e-01   +1.687304885294770e-01   -1.265307621168225e-02   +6.969109717976386e-02   +1.497375498554175e-01   +1.891118219386782e-01   +1.865870853272758e-01   +3.144515174908336e-01   +6.552697497280162e-02   +4.759787765473569e-02; +2.869127221712304e-01   +1.012809878516515e-01   +7.302500371917353e-02   +2.415928559675285e-01   +2.880461249467982e-01   +1.156992265284436e-01   +1.501706946986404e-01   +2.282324562515264e-02   +2.032302203133650e-01   +3.782425311842149e-02   +2.315178253432073e-01   +4.551503360536994e-02   +1.287499685117250e-01   +2.152009389323934e-01   +2.773605205526992e-01   +1.453614945279228e-01; +2.580932901252347e-01   +1.666631584681842e-01   +2.472432696877443e-01   +2.042866775211549e-01   +3.322648531653677e-01   +3.880736643871324e-01   +1.139763660334947e-01   -3.044844055180684e-02   +1.557751539593040e-01   +3.486814924845659e-01   +2.663837743432327e-01   +1.023919718870445e-01   +3.509724654066211e-01   +2.419318759441539e-01   +2.642758759913727e-01   +2.995711740316917e-02; +9.698491548304743e-02   -1.217589741622218e-02   +2.917354254563518e-01   +1.055261041734940e-01   +7.452622128675887e-02   +4.210629333936690e-01   +2.733027917978266e-01   +7.239573294906983e-02   +1.389200020549340e-01   +1.095645569906429e-01   -2.214762092549783e-03   +2.356418602382358e-01   +7.890991170681379e-02   +9.907902698311116e-02   +2.814165244776856e-01   +1.319107018280513e-01; +5.084290172725141e-02   +1.223684277595226e-01   +4.652905482075084e-03   +2.493050943614719e-01   +1.449524458747893e-01   +2.541467417850595e-02   +3.833932663968137e-01   +3.640560479727159e-01   +1.717586672263817e-01   +1.954534593801690e-01   +1.782810707063119e-01   +2.778694839775760e-01   +3.027592401825874e-01   +2.917589271263119e-01   +3.715867742557877e-01   +3.621893462931389e-01; +3.672301841120016e-01   +3.563772427518115e-01   +1.059703936100394e-01   +4.211778536432733e-02   +2.781141752253499e-01   +1.646534228901445e-01   +3.099869036202042e-01   +4.556562376212699e-02   +3.634828913945534e-01   +3.697608429872075e-01   +2.310990610162319e-01   +1.828065543112200e-03   +1.649257161314485e-01   +1.813558846843221e-01   +2.193926193029700e-01   +1.172128578691184e-01; +3.449721754660847e-01   +1.100853280904439e-01   +2.464969869260752e-01   +3.096240434186822e-01   +3.073177300880662e-01   +7.012878134069742e-02   +2.032913743700548e-01   +1.485884419976401e-01   +2.476387232806279e-01   +2.490399120923069e-01   +2.640742863845685e-01   +4.173245503378178e-01   +2.214863193353488e-01   +2.587819544727319e-01   +4.132745181114644e-01   +1.997889655150352e-01; +3.100679301543025e-01   +1.365885183354373e-01   +2.937552654301095e-01   +3.079995644853550e-01   +1.872754082779266e-01   +3.257710295289654e-02   +3.061049844921971e-01   +1.630056122065231e-01   +2.063962634543435e-01   +2.408572370076638e-01   +5.097794285648904e-02   +8.408944491646432e-02   +3.974457452210097e-01   +5.905362461971884e-02   +1.830413701086367e-01   +3.837492092635957e-01; +3.517081401536871e-01   +1.684389639040648e-01   +2.810385144778288e-01   +1.161644034325885e-01   +2.812932980881788e-01   +2.316809506783089e-01   +2.447924053227648e-01   +2.416160767237329e-01   +2.035669847247232e-01   +1.389447539589042e-01   +8.068907202151737e-02   +8.401964171229759e-02   +1.124775376065505e-01   +4.487944940622582e-02   +2.680443629141858e-01   +2.595162422011594e-01];
L1E_L1I_iGABA_netcon = [+8.098933520369395e-02   +3.736730248460954e-01   +4.133319732299608e-01   +2.926663999715411e-01   +2.870561846608326e-01   +2.712989202325771e-01   +3.927257927572396e-01   +6.893605473888584e-02   +3.438139258614176e-01   -5.372837783823890e-02   +3.203107121792234e-01   +1.504217751328352e-01   +7.957878480703980e-02   +3.948203541056706e-01   +1.533508819744048e-01   +3.003489063427540e-01; +2.898260795377561e-01   +2.252322888057849e-01   +2.620829219126438e-01   +1.181209164679323e-01   -7.978280471525849e-03   +2.667913532260973e-01   +2.303550331526195e-01   +2.436584832046497e-01   +1.620665797524275e-02   +4.011221777224148e-02   +3.919420201219536e-01   +1.010909501996787e-01   +2.099914787411738e-01   +2.328005565272441e-01   +7.260657457433740e-02   +2.185332119597217e-01; +7.328179513083500e-03   +2.188296765187462e-01   +1.827487273887509e-01   +1.440125824690952e-01   +1.107986661727945e-01   +7.685725173096582e-02   +1.830372603873789e-01   +2.085908610841289e-01   +9.032991488881464e-02   +1.186624998170991e-01   +2.885265214835462e-01   +2.583116704974889e-01   +2.274637425053022e-01   -2.611025339354795e-03   +1.914781957108275e-01   +2.125726541562116e-01; +1.624206692353013e-01   +2.378606973005707e-01   +3.187183337769824e-01   +2.024846266606760e-01   +1.892934947447151e-01   +3.882687132398753e-01   +3.244034691472517e-01   -1.527765448413903e-02   +2.934189218010919e-01   +3.543733920163696e-01   +2.409922079056251e-01   +3.138769455735374e-01   +1.056624902776072e-01   +2.932170183856752e-01   +5.936574671941060e-02   +5.617228356391546e-02; +1.781999088114098e-01   +3.667408246839109e-01   +3.661776430085756e-01   +3.562894280438793e-01   +1.196195992530839e-01   +1.095792446609292e-01   +2.614952486926326e-01   +2.356658062602242e-01   +2.962912034305351e-01   +2.551073894408355e-01   +2.999446529695829e-01   +2.723408995464319e-01   +1.032517046850672e-01   +5.103018981925463e-03   +1.379702495148515e-01   +3.475167823402402e-01; +2.988022585158642e-01   +2.509424170836996e-01   +2.556208867025151e-01   +3.018531484124853e-01   +2.286723671170141e-01   +8.930082212654930e-02   +5.670084012221943e-02   +1.176997378441344e-01   +3.126710041135363e-01   +1.807018667241888e-01   +2.546141767866318e-01   -2.695023682223447e-02   +1.659909639476822e-01   -3.703289378658488e-03   +5.100160281421803e-02   +2.101358952002582e-01; +1.016693164156010e-01   +2.923810788934253e-01   +3.431386458473039e-01   +1.143339630953894e-01   +2.129003595610590e-01   +4.966702033821447e-02   +3.173234487333532e-01   +3.185481903493718e-01   -4.995484146632716e-02   +3.013989989581002e-01   +2.512872236754489e-02   +2.388338148579032e-01   +2.609495905792680e-01   +3.016428059210916e-01   +1.238096930563300e-01   +5.876496925075107e-02; +2.166432478208635e-02   +1.851703556841826e-01   +1.149607344072970e-01   +7.798459540837657e-02   +2.243899737137935e-01   +5.295457736306996e-02   +6.617275744995431e-02   +1.133318139233534e-01   +3.145975852810498e-01   +2.002733112748739e-01   +1.091922123943339e-01   +1.623915533599404e-01   +1.566500076015810e-01   +8.262522545192988e-02   -1.470053698335302e-02   +3.601916513010693e-01; +1.972404733816994e-01   +3.024444771640546e-01   +3.228377698208431e-01   +2.264668965506298e-01   +1.167659444920749e-01   -1.472351950759503e-02   +5.667298532634533e-02   +5.667466068856384e-02   +2.611586854065119e-01   -2.659240528772952e-03   +1.023820201778320e-01   +2.957556310450770e-01   +2.413501648635311e-01   +1.781766478782743e-01   +3.348338612515278e-01   +3.425349058182858e-01; +1.283458850871438e-01   +3.389995596259921e-01   +8.939722364130712e-02   +5.383944809894074e-02   +2.090375530238313e-02   +2.087924362447234e-01   +1.161055149736304e-01   +3.833457848045072e-02   +3.280206019228846e-01   +9.713914018348896e-02   +2.077251091733369e-01   +1.290374266397477e-01   +3.101330626234313e-01   +3.258786621129772e-01   +2.968533057341938e-01   +1.798650109039388e-01; +2.370920497488657e-01   +1.808838501058229e-01   +1.966536475797211e-01   +1.206876276669514e-01   +2.995576592680412e-01   +3.438474540132075e-01   +2.731986381940675e-01   +3.698682535190057e-01   +2.254305031864928e-01   +1.557168228123030e-01   +6.170705715647531e-02   +3.233191440117111e-01   +1.162995379235179e-01   +1.008907002192778e-01   +1.650714503936843e-01   +1.851583538214822e-01; +3.035271748768893e-01   +7.327505170854802e-02   +8.188385108094715e-02   +2.259018921965804e-01   +3.210820366820382e-01   +2.538196413466683e-02   +2.399234366435317e-01   +2.037779684974619e-01   +3.303088881283087e-02   +1.598091155594568e-01   +2.072914375278578e-01   +1.160257704663117e-01   +7.896559307384594e-02   +2.569378836364001e-01   +3.075381386429448e-01   +3.026783555227978e-01; +1.504549819947716e-01   +1.788421464342055e-01   +2.045796409522325e-01   +3.009716186691084e-01   +1.625859921472602e-01   +1.455830548800563e-01   +2.937947984144925e-01   +2.401365663093705e-01   +2.775494685885536e-01   +3.619424244590899e-01   +6.557998518202786e-02   +1.259640712769288e-01   +1.186865465306720e-01   +2.108236225059356e-01   +1.632472969671765e-01   +2.715910016006172e-01; +1.123894067192758e-01   +1.468340379078483e-01   +1.881837066151374e-01   +1.415105975849678e-01   +2.915550035231714e-01   +5.418756177818412e-02   +1.912163843165836e-01   +1.135513687248047e-01   +1.764875519727631e-01   +1.996797112289393e-01   +2.066964913907542e-01   +1.447634649051458e-01   +3.059677786839431e-01   +3.755697885911607e-01   +1.264672674335284e-01   +2.571983691142645e-02; +1.107266100924380e-01   +1.052880168373958e-01   +1.080359781220085e-01   +2.373127324956703e-01   +1.943462076037791e-01   +1.610480357086783e-01   +1.674301937237691e-01   +1.674137673692142e-01   +2.407152805442911e-01   +2.251719981482033e-01   +1.624920485442144e-01   +1.687039758788701e-01   +3.807880029539638e-02   +2.013256586307880e-01   +2.976395392322935e-01   +2.869669736199919e-01; +1.512404613219032e-01   +1.866984936696455e-01   +1.716995112065396e-01   +8.089493863275844e-02   +1.677519384117397e-01   +4.044958075622769e-01   +5.678158741654026e-02   +2.926472756658785e-01   +1.161950623362850e-01   +2.914671047959728e-01   +1.744245491896339e-01   +2.770984746229894e-01   +1.904656952335345e-01   +3.828458969891527e-01   +5.359122944409012e-02   +2.906958809630763e-01];
L2I_L1I_iGABA_netcon = [+3.025525598119485e-01   +3.040196732980280e-01   +2.737990442864623e-01   +1.987606655523154e-01   +6.422669539521794e-02   +2.918998938102390e-01   +1.464577396996543e-01   +3.614184915199100e-01; +1.953519152323070e-02   +1.826251467072496e-01   +7.911933281371972e-02   +2.596443439869808e-01   +2.246431266965415e-01   +3.156433180327179e-01   +2.632892420451732e-01   +6.630996014384145e-02; +9.972301892631541e-02   +1.452705777974075e-01   +2.719844432694582e-01   +2.074003410264508e-01   +2.948820655929845e-01   -1.470444203983434e-02   +2.739283165952835e-01   +3.589625440007638e-01; +7.953733681460384e-02   +3.195011722782863e-01   +1.444948766379897e-01   +1.942880972793817e-01   +1.111883060678342e-01   +3.518348113283293e-01   +1.679410684838128e-01   +3.656395152294559e-01; +3.376977097174620e-01   +1.928919985716167e-01   +1.663684231119072e-01   +1.388108875370043e-01   +3.612350366488064e-01   +3.657704553075459e-01   +1.362461074357631e-01   +2.259557335462191e-01; +2.440254321875411e-01   +2.586460575117057e-01   +4.012090709977083e-01   +2.268324886031822e-01   +2.712437914458025e-01   +1.740870351727897e-01   +1.837800380366004e-01   +2.828218611272068e-01; +3.747652153478217e-01   +1.117223186243571e-02   -1.516583694510748e-02   +3.229741468700854e-01   +7.344065725299619e-02   +1.415774637634822e-01   +2.003207910597932e-01   +1.688711707834339e-01; +2.235430171360176e-01   +1.381580721828680e-01   +1.067111674517300e-01   +3.667637365695058e-01   +1.323607830270770e-01   +2.286525785699657e-01   +1.394022567429445e-01   +9.710169372740843e-02; +2.585006287389757e-01   +1.689383698685208e-01   +3.825494776492424e-02   +1.487294222654102e-01   +2.036204597789594e-01   +2.915626131038442e-01   +3.841766473400577e-01   +9.141130514330184e-02; +2.054206096739688e-01   +3.093787100891264e-01   +1.857265105828086e-01   +2.965555097849970e-01   +3.221956762620478e-01   +9.344549279120179e-02   +1.010875450256812e-01   +4.330061708687942e-02; +3.102237266679647e-01   +2.727959806535251e-02   +2.399588793319211e-01   +2.179147974684027e-01   +2.059042953229538e-01   +4.908417695510171e-02   +2.639261787186146e-01   -4.032779406158151e-02; +2.008256614209347e-01   +3.715005922237034e-01   +1.831268673670202e-01   +2.574162192084041e-01   +3.701013617080628e-01   +1.325067299243494e-01   +1.560928846213487e-01   +1.087301678090330e-01; +1.830935320956971e-01   +5.428350082770106e-02   +6.812952862555759e-02   +3.675620235594776e-01   +1.606181680588834e-01   +3.615621788190187e-01   +2.015099233028943e-01   +1.921904693156123e-01; +2.754215532677362e-02   +3.257928091971667e-01   +4.936554642312966e-02   +5.214772706323556e-02   +1.479369016824515e-01   +1.694211619575928e-01   +4.121265762265132e-01   +1.302459166313788e-01; +1.363096758949378e-02   -6.250053766309073e-02   +2.663799699908736e-01   +2.049018513256518e-01   +1.707751700247126e-01   +2.243311076581386e-01   +2.979427103087322e-01   +1.082918780129997e-01; +1.113528263453665e-01   +2.973491635995519e-01   +5.914636256750705e-02   +3.377491186263482e-01   +5.798598039343623e-02   +1.752549728373962e-01   +1.528299137295536e-01   +1.179735718046832e-01];
L1I_L2I_iGABA_netcon = [+4.582628432997721e-02   +1.444384125073135e-01   +7.329609085936425e-02   +2.903262877612980e-02   +3.383103159966720e-01   +1.873112971708044e-01   +6.448418628008129e-02   +2.187357494605875e-01   +1.949780544562403e-01   +5.669947556188359e-02   +1.113143462335649e-01   +2.870053731458412e-01   +8.550198472678854e-02   +3.950489738840430e-01   +6.634200487928389e-02   +1.260125047574621e-01; +2.938470387209370e-01   +5.676036687702327e-02   +1.350721344701255e-01   +3.200270300170205e-01   +1.200596669232797e-01   +2.627724798947516e-01   +2.818887250309948e-01   +2.098383439745587e-01   +3.314652248265325e-01   +3.698840516648352e-01   +3.691271420444661e-02   +7.866253618397658e-02   +2.021162729986839e-01   +1.689791554565912e-01   +5.579485308327412e-02   +1.723031699203473e-01; +2.144295719930320e-01   +2.478725535020160e-01   +2.182076880963785e-01   +4.511670666512321e-02   +2.347652010892539e-01   +6.602795671197757e-02   +1.387000600859512e-01   +8.283694009759643e-02   +2.039602781042587e-01   +3.437603702607354e-01   +3.123854010554242e-01   +1.646003442549213e-01   +2.277349170447044e-01   +1.342717610707586e-01   +1.047735073357084e-01   +1.381643883475210e-01; +2.346420587238122e-01   +1.863536493532547e-01   +2.995080643866639e-01   -3.126508995510760e-02   +1.889139110606020e-01   +3.661158238855361e-02   +1.855502018647754e-01   +2.029495396380674e-01   +2.097139857218260e-01   +3.128558267294889e-01   +3.470903460965867e-01   +1.862724540638125e-01   +3.000798395032127e-01   +5.375808335198345e-02   +1.075250198162219e-02   +3.440771758427534e-01; +2.112731159913526e-01   +2.882381840220041e-01   +2.436071308436091e-01   +1.317335505990447e-01   +2.232196394282684e-01   +3.533033598907827e-01   +1.321741726564860e-01   +1.680223744560738e-01   +1.864696066141056e-01   +2.681248788399538e-01   +2.276456053299351e-01   +2.774759028061193e-01   +2.705467567871296e-01   +5.452197490306925e-02   +2.465777957969139e-01   +4.084277191740429e-01; +1.355382932116327e-01   +1.708542626751112e-01   +1.738069058431391e-01   +2.783271430045892e-01   +4.334806883679990e-01   +2.524074058901749e-02   -7.376133045002625e-04   +2.552186418448640e-01   +3.042982814820006e-01   +3.156962127619481e-01   +2.380456853966830e-01   +1.704093191070023e-01   +1.974420037656523e-01   +2.097397467088702e-01   +3.137252596494114e-01   +3.420326305057854e-01; +3.192828454123127e-01   +1.534014281077037e-01   +3.554166994386402e-01   +3.495444872957487e-01   -3.660184684553076e-02   +3.019389513404708e-01   +2.069812727632327e-01   +2.372094986877551e-02   +5.997265894742027e-02   +3.412274929870823e-01   +3.616039437231491e-01   +3.579935090809037e-01   +1.764633089879944e-01   +5.853388673704000e-03   +2.445273932559121e-01   +1.435653118035459e-01; +1.240838090445077e-01   +4.001940148555290e-02   +2.257829980554895e-01   +2.036309278607464e-01   +6.873539266870057e-02   +3.480176267939124e-01   +2.170304055731421e-01   +8.655619990755165e-02   +3.475307863884822e-01   +1.867490902848853e-01   +3.206637877069985e-01   +2.816564404116081e-01   +2.686619757631302e-01   +1.949136221469610e-01   +2.335157428240288e-01   +5.086927381830741e-02];
L2E_L1E_iAMPA_netcon = [+1.705122923632735e-01   +2.653895098366548e-01   +3.754808070246373e-01   +1.019964942775672e-01   +3.282578389129336e-02   +2.010596474557284e-01   +9.129824858032556e-02   +1.955160809239693e-01; +1.427551761767817e-01   +6.546548569774671e-02   +2.491463026764646e-01   +1.977338408767867e-01   +1.570247200015424e-01   +6.136171566090585e-02   +3.005511309495113e-01   +8.669661788787890e-03; +2.120484417863972e-01   +4.511346829791300e-02   +1.664480636856778e-01   +3.286859640038376e-01   +2.850928658996949e-01   +3.861244472741242e-01   +3.537367268947665e-01   -2.259512443807318e-02; +2.994306333053344e-01   +1.195789756862603e-01   -3.472207755151061e-03   +5.686826235813579e-02   +2.798314660254734e-03   +3.389908783923103e-01   +1.957584187261607e-01   +3.965928561075946e-02; +1.886711563451458e-01   +3.009903456265244e-01   +3.136281595221140e-01   +2.168387166326180e-01   +1.566538405009761e-01   +2.405485352542421e-01   +3.339268584571600e-02   -1.980761257437742e-02; +3.439079654792008e-01   +4.316318330214678e-01   -2.407047777736622e-02   +3.465560009647147e-01   -6.334538521038069e-03   +3.225757593889074e-01   +1.804657312211504e-01   +2.723908734505817e-01; +3.267333931491121e-03   +3.343356191627612e-01   +1.796886897031251e-01   +5.901580809910214e-03   +2.928506849983838e-02   +3.662297090105304e-01   +2.343518935703670e-01   +3.700857836694280e-01; +1.977015305975242e-01   +3.642414920819036e-01   +2.071633067092076e-01   +2.867076370288452e-01   +2.948803231044976e-01   +2.358085436946659e-01   +3.087008267153588e-01   +1.825500068862515e-01; +1.225070437210381e-01   +7.431270716455181e-02   +1.515676937770868e-01   +1.434323782084985e-01   +3.943834750978491e-01   +3.132882374368584e-01   +9.137845060997329e-02   +2.222513482643170e-01; +1.232960303843532e-01   +3.475703747405798e-01   +3.296550203090057e-01   +3.850146533370600e-01   +4.217167033936347e-01   +1.519771185405616e-01   +2.417344720572333e-01   +9.119449114676886e-02; +2.317691134377984e-01   +2.465765244908514e-01   +4.221295018065846e-02   +6.942125188998142e-03   +1.712588499631434e-01   +3.487707836241952e-01   +2.753610040303753e-01   +3.051787046893601e-02; +3.678065338437876e-01   +1.808161313268884e-01   +1.040246105051232e-01   +2.315367674743325e-01   +3.236963491620714e-01   +4.529659684745355e-01   +2.115192597898780e-01   +3.350366338135612e-01; +1.813197293663964e-01   +3.445445239208754e-01   +3.656296253381959e-01   +1.214639321673059e-01   +3.709731380201625e-01   -7.768559848324316e-03   +2.429550982396866e-01   +3.351947885800452e-01; +2.573995479168854e-01   +1.258186499102742e-01   +2.113192885885339e-01   +9.892588224003405e-02   +2.129011837371705e-02   +2.911434769431581e-01   +3.465409535556623e-01   +1.217845999690184e-01; +2.572682430254925e-01   +3.053583933234764e-01   +6.348565990702269e-02   +8.742473016642982e-02   +1.950117899186810e-01   +3.157330052413085e-01   +2.101378614623352e-01   +1.013498801352105e-01; +2.577065382372721e-01   +2.317239988948600e-01   +2.203576585792811e-01   +8.613806170083151e-02   +1.941254596892041e-01   +1.095162237128140e-01   +3.257207527214663e-01   +2.174740285518887e-02];
L1E_L2E_iAMPA_netcon = [+1.122015696750297e-01   +1.743504948310190e-01   +3.950406777188136e-01   +2.259184490526578e-01   +2.398077012004378e-01   +2.002592668411499e-02   +2.164883306133470e-01   +3.173257831139434e-01   +1.902450354737069e-01   +1.698427452671480e-01   +3.295267330815574e-01   +1.160454520535952e-02   +1.597360597934848e-01   +2.036034392905118e-01   +2.861564713371917e-01   +3.533554420534577e-01; +3.354578862020536e-01   +3.169133076747804e-01   +3.013598193643249e-01   +1.403128045059749e-01   +1.778987787666955e-01   +2.482771218375511e-01   +3.341887078310181e-01   +4.464158555049880e-02   +8.148998053581351e-02   +2.328142860642780e-02   +4.173894531941809e-02   +1.066694001289617e-01   +2.039501425635569e-02   +5.418124910132068e-02   +7.197066988042741e-02   +1.409579425068498e-01; +1.291896501872227e-01   +3.138746148838281e-01   +3.992350700855533e-01   +3.333228766941560e-01   +1.213710921804378e-01   +3.347142375678244e-01   -6.374829569943999e-03   +2.906769190556711e-01   +2.400061799533743e-01   +1.302128095966334e-01   +4.238703346194311e-02   +3.342915725028820e-01   +4.127118689869489e-02   +3.869152090502973e-03   +1.685698473250813e-01   +2.278245085483141e-01; +1.853640826349091e-01   +1.775235378790669e-01   +2.282190203518103e-01   +3.967799405112777e-01   +8.163708402073025e-03   -2.563467814718195e-02   +7.042556220607318e-02   +2.779328865343373e-01   +3.538273762827285e-01   +3.083130664702901e-01   +2.003548660318973e-01   -1.220922202914801e-02   +1.883214140915515e-01   +8.601874431332635e-02   +9.583948103357129e-02   +1.986989174011877e-01; +2.972055707025730e-01   +1.539488295061150e-01   +3.646205308006909e-02   +6.151531797203171e-02   +3.818446461821616e-01   +3.529191513482252e-01   +3.486767973450374e-01   +1.752884297137706e-01   +1.106138190896207e-01   +1.172450995543820e-01   +2.961650859024814e-01   +4.525991886709232e-03   +2.551377418551951e-01   +2.855633334818589e-01   +1.226926886793495e-01   +5.886621851274915e-02; +3.794830069951837e-02   +2.317298092953318e-01   +3.344843421346239e-02   -1.258414265064515e-03   +2.626289781160415e-01   +1.865682316990364e-01   +2.243611781808679e-01   +3.218536739875551e-01   +3.611832655609299e-01   +2.792096628015537e-01   +6.304590578145279e-02   +2.725581736652166e-01   +2.965660614900884e-01   +2.316501096817694e-01   +3.851553241343272e-02   +1.374517333512121e-01; +1.099232710639770e-01   +1.578489640245882e-01   +9.585856801335875e-02   +1.356269381501531e-01   +1.473782844916054e-01   +5.350738690814035e-02   +1.704088326870491e-02   -4.412711140486759e-03   +1.393996271838091e-01   +1.861496565429622e-01   +9.183281488336080e-02   +5.670006706776123e-02   +3.888493444005416e-01   +2.775060550712320e-01   +3.301456504293561e-01   +1.669476619985338e-01; +4.507536314465860e-02   +1.192078418155240e-01   +3.683188101070667e-01   +2.955507326917930e-01   +3.672333446729636e-01   +2.054472789373019e-01   +3.453304510623019e-01   +1.042856913793071e-01   +1.459404577819352e-01   +3.602407659254101e-01   +3.798799528430458e-01   +6.158224081748258e-02   +1.919338143289214e-01   +1.571740171406062e-01   +3.306271116708968e-01   +1.795206574180158e-01];
L2I_L2E_iAMPA_netcon = [+1.767753330881902e-01   +6.596845455213456e-02   +2.188351712381603e-02   +1.802646893000772e-01   +3.314450456493738e-01   +2.381119902116673e-01   +3.707401130758353e-02   +2.160808576242489e-01; +4.980517182380326e-02   +8.384325669161714e-02   +3.572981490597691e-01   -2.579391911170201e-02   +2.378775854130403e-01   +1.491914168700159e-01   +8.437051939788857e-02   +2.061538706259164e-01; -2.568973637173069e-02   +3.488093865529077e-01   +9.280604085641810e-02   +1.966266089579479e-01   +3.575769339803433e-01   +3.491221658617432e-01   +2.598992718470341e-01   +1.095091455370719e-01; +3.019694688947507e-01   +3.317673891155520e-01   +3.561952261617886e-01   +2.884629648070271e-01   +3.090995068679880e-01   +2.496192289860269e-01   +3.789576218733345e-02   +2.150235446179939e-01; +3.183741957689866e-01   +3.482779913994279e-01   +1.223829093782928e-01   -2.606650411066680e-02   +1.527774221519961e-01   +3.750512705836388e-01   +9.505063965719197e-02   +3.904667202215950e-01; +2.274794614105527e-01   +1.610731355915532e-01   +3.184921136029068e-01   +2.055033293668913e-01   +4.742101100380255e-02   +1.077083036394741e-01   +2.396132107730386e-02   +2.546744322296995e-01; +1.097615095882774e-01   +1.842281318597329e-01   +2.879722135736214e-01   -5.814650658406920e-05   -4.316225957381407e-02   +9.273392914039762e-02   +1.628932224656748e-01   +4.012806140942628e-01; +3.162407953507181e-02   +1.603783756749235e-01   +1.841055475071312e-01   +4.294543974072222e-01   +3.435594239011006e-01   +3.032631334146749e-01   +3.713479764720911e-01   +1.576621929888522e-01];
L2E_L2I_iGABA_netcon = [+3.514838837750500e-01   +1.812469641007310e-01   +2.076973786692872e-01   +1.248354954435831e-01   +1.853633895581847e-02   +3.931103227257927e-01   +3.638300594651539e-01   +2.703194254637106e-01; +3.958193209256181e-01   +8.904347054496727e-02   +1.233196765628497e-01   +3.437778476193268e-01   +3.075569697104379e-01   +1.902943339788206e-02   -1.817878226569374e-02   +2.942676217286933e-01; +1.481971360526767e-01   +2.452749490803686e-01   +3.038460146304315e-01   +1.459233268488752e-01   +9.976515081801658e-02   +3.559705013895817e-01   -2.646771415809520e-02   +1.869335433444169e-01; +4.156877107612874e-01   +4.302343565783090e-02   +1.390175397466906e-01   +6.711825862356341e-02   +3.268612359376846e-01   +3.635664121022686e-01   +2.825935903911694e-01   +1.502557660557586e-01; +2.086799355409330e-01   +2.189583785307026e-01   +4.107257546876373e-01   +1.090786832854660e-01   +6.429328628033551e-02   +2.753684566925067e-02   +3.181071802632837e-01   +1.547122730163149e-01; +2.757732732239567e-01   +9.949051267086535e-02   +1.276975038010613e-01   +1.957218164971380e-01   +8.788465525509928e-02   +3.137045658548743e-01   +1.778402961502398e-01   +4.439459382496649e-03; +3.153789957417266e-01   +2.730348818385845e-01   +2.563134902873098e-01   +1.866930113451375e-02   +7.612070645295346e-02   +2.539239750588189e-03   +2.520357147961012e-01   +5.621015244905339e-02; +5.332669215812811e-02   +1.322576210628805e-01   +2.128378911845684e-01   +1.980728813723159e-01   +3.414168160659042e-01   +2.434044934948017e-01   +1.398417298179464e-01   +1.001821979978236e-01];
L3E_L2E_iAMPA_netcon = [+2.033118426167449e-01   +2.626850248763841e-01   +1.351406692481235e-01   -3.031256718505687e-02   +2.196373200303040e-01   +5.078798970127087e-02   +3.607992727220081e-01   +2.337272802500310e-01   +2.853921381575414e-01   +2.394233237270353e-01   +9.130859748952291e-02   +2.389374425908362e-01; +1.080522601618306e-01   +2.562512056637558e-01   +2.656133229846748e-01   +2.418450655341686e-02   +3.290638942717191e-01   +3.113585249300761e-01   +2.787929096405806e-01   +1.104402524380356e-01   +3.122162925889050e-01   +1.105525290434316e-01   +2.471091064305860e-01   +3.282374705204464e-01; +3.140434107394156e-01   +2.374141600801105e-01   +3.121218449112695e-01   +3.686670092218384e-01   -2.129474556028413e-03   +1.041137521460297e-01   +2.142256617916819e-01   +9.693044655929356e-03   +2.380957679219975e-01   +2.917625472064200e-01   +2.081247494772554e-01   -1.280768836088328e-02; +3.282892839735869e-01   +1.977261651327943e-01   +2.493375292749177e-02   +9.644005563236064e-03   +2.945877741995029e-01   +1.328386238433042e-01   +3.917388984297116e-02   +2.147368430807460e-01   +8.169294312776633e-02   +1.272994686948736e-01   +2.159020253602402e-01   +1.779560785650701e-02; +2.824057062529020e-01   +4.174458495096026e-01   +3.412516510138507e-01   +3.860758602796219e-01   +2.829708927222928e-01   +3.523791903974108e-01   +2.523676462252762e-01   +7.738581891453360e-02   +1.082000529153650e-02   +1.204753068081370e-01   +2.817865719673550e-01   +2.556231286436557e-01; +1.030128840223014e-01   +1.296436089080436e-01   +7.261304687459250e-02   +1.511020634110812e-01   +2.777183674695745e-01   +2.717016444475367e-01   +3.595018007209022e-01   +3.323775026741096e-01   +3.733086909765859e-01   +1.323920672155547e-01   +3.594540884918465e-01   +3.905869009217667e-02; +3.015826922676198e-01   +5.925129767628982e-02   +7.460871754837983e-02   +7.272458569610477e-02   +4.123749586521777e-02   +1.688036983489205e-01   +2.388726472403516e-01   +1.541034603376310e-01   +1.170032511152251e-01   +1.426716917015241e-01   +3.744438958646402e-01   +3.691995686362621e-01; +3.178477857927768e-01   +3.111956428037244e-01   +2.037093238816455e-01   +3.233197461038962e-01   +3.134400629818541e-01   +9.665583135639837e-02   +6.616360932973768e-03   +1.432969241293808e-01   +7.195954297539905e-02   +4.109380810292031e-02   +1.580532028107053e-01   +1.116023159020120e-01];
L3I_L2I_iGABA_netcon = [+2.131095689306008e-01   +3.709247044811514e-01   +8.760841503749119e-02   +2.457302684400112e-01   +1.711489165793157e-01   +3.020905582287807e-01   +2.925527346926169e-01   +1.637887057640902e-02   +2.463259716954203e-02   +4.471105775591042e-02   +3.112539971494667e-01   +8.614359111895510e-02; +2.026450970322521e-01   +2.688154774241635e-01   +2.035363571638094e-01   +2.702880043490630e-01   +3.039513607883337e-01   +1.429481269513934e-01   +3.644024385945184e-01   +9.459437518732741e-02   +1.063721985288738e-01   +1.528644789698187e-01   +2.150109015975690e-01   +1.127636405909200e-02; +1.859778072492428e-01   +2.333941026091273e-01   +2.401221076826583e-01   +2.026332823191414e-01   +2.401260814431373e-01   +1.914000848265754e-01   +1.601584459202574e-01   +2.848468416282402e-01   +2.664802925697531e-01   +4.247280583557905e-02   +2.802653421267673e-01   +2.635978490016952e-01; +2.917924761751526e-01   +3.322444623147308e-01   +3.273433016061925e-01   +9.041316504675240e-02   +1.939927587004397e-01   +3.939531346203119e-01   +2.950622398583796e-02   +4.429719358005267e-02   +2.847532982258131e-01   +3.424052742790386e-01   +8.012622673289463e-02   +2.950991395375688e-01; +1.645916615343008e-01   +3.024020467395049e-01   +3.611698057950603e-01   +3.409953707254927e-01   +3.348833034769549e-01   +1.486329013660759e-01   +1.673597607430473e-01   +2.768327306129555e-01   +1.611920685098885e-01   +4.187589971143331e-02   +1.212787566529723e-01   +1.378410650766584e-01; +2.008127722210657e-01   +6.541461202576584e-02   +2.726753221731343e-01   +1.465215840882903e-01   +2.596130162642605e-01   +2.540977909898084e-01   +1.885267219179008e-01   +2.299346152589353e-01   +9.735232603594585e-02   +1.144812133939703e-01   +2.278014215687771e-01   +2.006457111037851e-01; +1.696966830058089e-01   +5.747050148320174e-02   +3.199011639315748e-01   +2.784030359814291e-01   +1.234092822846122e-01   +3.453105312148040e-01   +1.212112332058957e-01   +5.496111704834741e-02   -2.236047283542300e-02   +2.886534919122361e-01   +3.671895648885594e-01   +1.029884468577381e-01; +1.820889468882469e-01   +5.384884965667924e-02   +3.445659321672239e-01   +5.991983756661158e-02   +2.852375767570962e-01   +3.084132535435584e-01   +2.676381030558072e-01   +2.268947441650466e-01   +1.553963221036642e-01   +2.839116405008947e-01   +5.816985160311750e-02   +3.322608463605388e-01];
L2E_L3E_iAMPA_netcon = [+2.398540216493418e-01   +1.160419379995101e-01   +2.933498778559545e-01   +2.663043194853834e-01   +1.759769934765018e-01   +1.450495852071322e-01   +2.000633161951145e-01   +9.280761836972685e-02; +2.377635864390275e-01   +1.765089527936556e-01   +2.238695742482810e-01   +1.762945986276198e-01   +3.421301080606836e-01   +1.323399045419992e-01   +2.101573531397342e-01   +3.272417569073123e-01; +8.448710562516659e-02   +8.037965392328242e-02   +2.280013727999748e-01   +2.936638126479946e-01   +2.586324726546388e-01   +3.004781232054389e-01   +2.223318671620851e-01   +2.165178401145873e-02; +7.249628023357570e-02   +7.981839417204975e-02   +2.001863578877002e-01   +3.464808591279923e-01   +1.154469413168899e-01   +3.151500977195210e-01   +2.164800018062648e-01   +1.136829150180798e-01; +7.302285435576718e-02   +2.830791686480270e-01   +3.915744625579929e-01   +4.126821614691692e-02   +2.845331236505353e-01   +2.627897463783416e-01   +2.574796558033280e-01   +2.711008275841794e-02; +6.564719054154060e-02   +3.606050518302275e-01   +2.720885324860305e-01   +3.450049450451716e-02   +3.777427928419871e-01   +1.290323669843347e-01   +1.120031107038843e-01   +3.160291781808231e-01; +1.646595360684662e-01   +1.080699310587362e-01   +1.908606514040434e-01   +7.478400259788341e-02   +1.058105522856302e-01   +2.618711132617886e-01   +2.894275529539920e-01   +2.309754300544889e-01; +2.572845470281061e-01   +3.999786960116211e-02   +2.030113787464898e-02   -2.590162558827613e-02   +3.142063597009718e-01   +2.074981897388622e-01   +1.083578685467767e-01   +3.343946643448134e-01; +3.949652727562561e-01   +2.790617393699822e-01   +1.217555892319212e-01   +3.381645291001368e-01   -6.138014295985296e-03   +1.113501656330106e-01   +2.529191351751555e-01   +1.149764363113773e-01; +1.669093821807602e-02   +8.515221149577135e-02   +3.413550253943481e-01   +5.307283887225949e-02   +9.549757759816206e-02   +1.154797157732833e-01   +3.891301605938930e-01   +3.483275752855045e-01; +2.901238735458575e-01   +2.636494317721492e-01   +1.759720983043073e-01   +2.477945979474120e-01   +1.531382083731048e-01   -2.574462872169118e-02   +1.836727380519303e-02   +2.731679875129966e-01; +3.135034743813858e-01   +2.425074991965646e-02   +3.775216096740944e-01   +3.002873376568956e-01   +2.712595908031020e-01   +2.302841534862880e-02   +1.452141871650457e-01   +1.240252840760117e-03];
L2I_L3I_iGABA_netcon = [+1.121743929219323e-01   +1.781851782768928e-01   +1.074950130970142e-01   +2.153865507847024e-01   +1.595174721999033e-01   +1.910282578009753e-01   +2.072128682735093e-01   +2.136332140884241e-01; +1.558489891773613e-01   +3.093620992398879e-01   +1.079517786204977e-01   +3.508725654198324e-01   -1.820732929445671e-02   +2.499895460109397e-01   +1.515136475738224e-01   +1.699807480237114e-01; +1.102814887417221e-01   +2.420605844187679e-01   +3.117837376076005e-01   +2.550302513548192e-01   +1.856016175819800e-01   +2.173437291904387e-01   +2.597612959387576e-01   +3.699686045022605e-01; +2.776018392503151e-01   +4.088177744293234e-02   +3.460381095026909e-01   +9.747762873736995e-02   +2.312743820713039e-01   +2.548594837046807e-01   +3.315487388090711e-01   +7.667634773923707e-02; +1.910600453917747e-01   +4.229396409277734e-01   +2.771660716842607e-01   +2.332856270383125e-01   +2.095999598718372e-01   +3.557752816295749e-01   +3.694402880082404e-01   +2.340743627456795e-02; +3.252294282620493e-01   +2.125391775773754e-01   +9.751129950087022e-02   +3.826068677440435e-01   +1.281248243078539e-01   +1.178057313701884e-01   +1.412085582420135e-01   +3.056618490940587e-01; +6.562843726028117e-02   +3.358818195291238e-01   +1.307436752416369e-01   +3.304681971369502e-01   +1.140673875338939e-01   -3.519486142861520e-02   +1.845282404545465e-01   +2.981178490186516e-01; +5.912691712378918e-02   +1.025154684690283e-01   +2.125100491300493e-01   +9.374555997949492e-02   +2.389071870646218e-01   +2.485139149337169e-01   +3.405338574512518e-02   +7.555877449257851e-02; +2.065701555173046e-01   -2.442387925872835e-02   +3.367018096561381e-01   +3.869407677198096e-01   +2.386088143077679e-01   +5.507890962753494e-02   +1.293136306620018e-01   +3.289234448338156e-01; +1.447029229500369e-01   +9.624486729967502e-02   +6.782972024016111e-02   +2.128164681836831e-01   +3.254891387823950e-01   +1.834826602253412e-01   +3.205275623106373e-01   +1.874313067315397e-01; +8.274631043289389e-03   +2.095636075773870e-01   +6.839080384309183e-02   +2.146672053339511e-01   -1.073858945762611e-02   +2.343058816648535e-01   +2.438081169182098e-02   +1.104669917809863e-01; +4.233612269238834e-02   +1.634577958445354e-01   +1.402531371614999e-03   +8.928620490122036e-02   +2.103854947748536e-01   +3.353710267694163e-01   +1.672676136140919e-01   +1.594184316390357e-01];
L3I_L3E_iAMPA_netcon = [+1.908111175043955e-01   +1.909405865065135e-01   +2.320919544501842e-01   +3.210355818633652e-01   +6.945663702700128e-02   +2.944428596780146e-01   +1.151684349685785e-01   +8.641046551481517e-02   -8.842032492138788e-03   +1.550531145782872e-02   +2.539474863898519e-01   +2.208619125538742e-01; +3.217018787997798e-01   +1.431632827753994e-01   +1.574817991614396e-01   +3.961691408231054e-01   +2.703998576153500e-01   +2.067703833566181e-01   +3.271684450376353e-01   +4.123035166517456e-01   +1.832072818122557e-01   +1.139105866895323e-01   +2.364460929233599e-01   +3.533793689175374e-01; +1.185618142667887e-01   +3.211387625557445e-01   +1.288330387430607e-01   +1.405571449991404e-01   +2.992565451787355e-01   +2.975716075585417e-01   +2.824102212134968e-01   +2.868216740690114e-01   +6.167533489989938e-02   +3.057282745731321e-01   +1.349892022814472e-01   +3.560328852212025e-01; +3.568814306401596e-01   +2.113484127747470e-01   +2.322741460291612e-01   +2.997914951140347e-01   +1.340487296652091e-01   +1.101574340633738e-01   +1.674973342677936e-01   +3.329554982885481e-01   +2.669252701424751e-01   +3.550909914306613e-01   +1.145122705684056e-01   +2.912485417488705e-01; +1.181160952345784e-02   +3.127869065184378e-01   +1.482565564028677e-01   +4.423802235756810e-02   +5.164427043790860e-02   +4.065067545623240e-02   +9.246182965998639e-02   +1.052672249667412e-01   +2.006373300972407e-01   +8.744176762625214e-02   +3.667059534768482e-01   +2.840809376021660e-01; +1.289137448871254e-01   +3.009542663159747e-01   +1.705278696967312e-01   +3.482947626312371e-01   +4.860111235277344e-02   +9.466510590872304e-02   +8.243027620706997e-02   +3.595532017688387e-02   +9.748627910095813e-02   +4.210516501635898e-01   +3.069231746855003e-01   +9.183978201246176e-02; +2.761577153456004e-01   +2.831620420860179e-01   +3.032073842973059e-01   +3.051173837020185e-01   +2.208099428072361e-01   +1.804734045540262e-01   +1.263871429117643e-01   +3.430132610826059e-01   +2.679864042727752e-01   +2.612268020436003e-02   -5.290687162295147e-03   -1.713829933548974e-02; +4.065063328820172e-01   +3.548738282954410e-01   +1.944706694745540e-01   +2.517212103083183e-01   +3.385120760446904e-02   +1.201513253815548e-01   +2.124588398004781e-01   +3.328427308504021e-01   +2.765432078332882e-01   +3.492295155527734e-01   +6.470797454459758e-03   +2.526308864689929e-03; +4.533308694484394e-02   +1.373657797121518e-01   +1.425394210457151e-01   +1.329966390520039e-01   +1.529717833748370e-01   +1.357976569240421e-01   +3.351450601691049e-01   +1.015385901953692e-01   +2.434965304916667e-01   +2.852950676055150e-01   +2.197533973639613e-01   +3.716370429413132e-01; +2.618393554673816e-01   +1.112840894158175e-01   +2.242724258819530e-01   +1.632299401390935e-01   +6.010923874441877e-02   +2.289224638467016e-01   +1.810636769640764e-01   +4.228393141661812e-01   +3.087142126856733e-01   +1.558130300238445e-01   +1.285796857475478e-01   +4.828589049381357e-02; +2.552870178321567e-01   +2.748146115342606e-01   -1.335066502026662e-02   +4.346452681449345e-02   +8.927232058724699e-02   +3.008055326358742e-01   +1.245100176135903e-01   +2.662581306722673e-01   +6.784356764769278e-02   +7.374721970030185e-02   +2.228071292644507e-01   +2.470830421474378e-01; +1.636701054408774e-01   +8.494450503212431e-02   +1.964906234867440e-01   +4.177639730185127e-01   +2.512955609457719e-02   +2.269789710510724e-02   +2.643714299830032e-01   +2.705650219124778e-01   +6.494514101063666e-02   +6.310995012487738e-02   +1.404198586824265e-01   +3.351239392990413e-01];
L3E_L3I_iGABA_netcon = [+4.076425316521604e-03   +2.823546217228022e-01   +1.586070687469814e-01   +3.216831744560163e-01   +3.012392504072489e-01   +2.598170636655666e-01   +3.912816729516026e-02   +1.366110508394423e-01   +2.128034705099102e-01   +3.849772332263107e-01   +3.789909274168433e-01   +1.368882300437888e-01; +5.894978696506806e-02   +8.262850200384871e-02   +3.414516073918719e-01   +1.771823406506390e-01   +1.428583499202612e-01   +2.502409593091822e-01   +2.836371521140728e-01   +2.023197603432205e-01   -6.639018942702092e-03   +3.409547009570763e-01   +2.391308467365373e-01   +3.095331229656408e-01; +2.503768966255802e-01   +2.634364494622628e-01   +3.355634265256261e-01   +2.782663421717609e-01   +9.777067720266520e-02   +3.261067166668202e-01   +1.174454542147457e-01   +1.180934106511702e-01   +2.242519867355620e-01   +2.490568400710871e-01   +1.460687360525205e-02   -5.025072424496345e-03; +2.717766907108611e-01   +2.993453630518912e-01   +6.844711505240773e-02   +4.158446446089344e-02   +1.032446452837491e-01   +3.657037459249199e-01   +1.431190377096919e-01   +2.356313997334546e-01   +1.491992737436348e-02   -7.394996276128091e-03   +3.118801709490357e-01   +2.635661570194316e-02; +2.757310800968936e-01   +3.206355198343833e-01   +4.160756764331345e-01   +1.710434252485153e-01   +2.998601472357406e-01   +1.410219771457360e-02   +2.780403362074695e-01   +1.061717721757115e-01   -5.754328750028701e-03   +3.236061254689978e-01   +1.721399534078007e-01   +1.815302715859388e-01; +1.261698948868965e-01   -2.288669069609105e-02   +3.011306229211225e-02   -1.229010043363945e-02   +1.785471744047962e-02   +3.601976762701538e-01   +1.010225831076622e-01   +2.585624343376090e-01   +3.585380066873572e-01   +3.312672306993592e-01   +3.131585868302459e-01   +1.543713994580713e-02; +3.820705791211132e-01   +3.425427929437387e-01   +1.821535205741180e-01   +5.838282517287094e-02   +2.796137750877234e-01   +3.172388685054722e-01   +3.545633177370229e-01   +3.016451276171644e-01   +2.751872581626136e-01   +3.346133891895339e-01   +2.752966025198307e-01   +9.178398895458185e-02; +1.865827643927901e-01   +1.750995488607779e-01   +2.309208170654310e-01   +3.350022135656914e-01   +2.503453609838164e-01   +6.964384854799109e-02   +1.424975101707413e-01   +2.048273331150676e-01   +1.782845773443399e-01   +1.480311346389202e-01   +1.965885647736242e-01   +2.734602438859879e-01; +3.604756777106920e-01   +1.310609561846624e-01   +3.449666003876726e-01   +2.103056710029544e-01   +3.369313385643893e-01   +1.598586324072797e-01   +2.283624645424910e-01   +1.926493640279907e-01   +1.945214105921815e-01   +3.814559257916308e-01   +3.214052133172755e-01   +3.314553020423716e-01; +2.413199850976122e-01   +1.950862414920518e-01   +2.526032457728904e-01   +5.600683491744936e-02   +2.426332876668166e-02   +2.465507264383307e-01   +1.324041807157584e-01   +9.679488937217090e-02   +1.766203885144789e-01   +1.699537283136424e-01   +1.604649566334911e-01   +8.739915548778636e-02; +1.861008532131792e-01   +3.016005566207199e-01   +1.805869941503854e-01   +3.047723702273216e-01   +9.582720994682298e-02   -5.174186414269814e-04   +7.024801847760434e-02   +6.752938917443720e-02   +1.344368604640498e-02   -3.256377533681593e-02   +3.704549897677219e-01   +2.376145200631795e-01; +1.000735733188967e-01   +1.770197380784469e-01   +1.191576422006607e-01   +1.487127534536176e-01   +2.524043099554810e-01   +9.159750620646964e-02   +2.273794199456741e-01   +1.958575064354192e-01   +1.192141859412246e-01   +8.882363810656176e-02   +2.381149361950712e-02   +8.615799908656782e-02];
L2E_Input1_iAMPA_netcon = [+1.428977891393916e-01   +8.409106530552182e-02   +2.264136006723220e-01   +1.495036523634863e-01   +2.422135574965490e-01   +2.227526813027522e-01   +1.888408973205241e-02   +2.189301458815604e-01];
L2I_Input2_iAMPA_netcon = [+1.880250813622896e-01   +1.031194425118696e-01   +3.614208043238926e-01   +3.633947019530431e-01   +2.034555311945802e-01   +2.137007861818825e-01   +2.141693774479316e-01   +3.234701773628084e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
