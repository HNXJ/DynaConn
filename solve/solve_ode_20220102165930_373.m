function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.318583428951402e-03   +3.273295701195720e-02   +5.152047668253484e-02   +4.106960839648821e-02   +4.177144708723192e-02   +6.948720316117586e-02   +2.622806737703913e-02   +9.795757921063630e-03   +1.679257895260877e-02   +3.218788467125203e-02   +4.360398055382825e-02   +2.033781449504870e-02   +2.923406550733829e-02   +4.723204404358804e-02   +3.139442628107975e-02   +4.829077735058352e-04; +2.630925551347732e-02   +2.545250280126951e-03   +3.266909072428287e-02   +3.834883262992165e-02   +1.670863575303540e-02   +2.207060670137343e-02   +6.339810162631714e-02   +6.475270021656752e-02   +4.776963849180674e-02   +1.742809174996719e-02   +6.157328280211364e-02   +1.394111619623117e-02   +1.329876748015524e-02   -7.649530723328095e-03   +3.435246171157753e-02   -2.954256037964640e-04; +4.135209560294333e-02   +4.114998640063139e-02   +5.603853713915068e-02   +3.670895427555206e-02   +5.115243129594011e-03   +5.901995066262963e-02   +5.158797571210218e-02   +2.980546194618225e-02   +2.812773031511911e-02   +2.253275707071084e-02   +3.037899994104486e-02   +1.336631993702928e-02   +3.152642213031468e-03   +8.742690928959867e-03   +5.336214148634626e-02   +4.000376613865663e-02; -3.062536116155939e-04   +3.607006842087532e-03   +2.658830053911309e-02   +4.416720470614756e-02   +1.556893666395601e-02   +4.432746308851269e-02   +2.974160408545311e-02   +6.414253972229765e-02   +2.772490488005367e-02   +1.636596273981526e-02   +5.492355426381439e-02   +5.845841861280834e-02   +1.428264878472341e-02   +5.603198238512493e-02   +1.834149578812565e-02   +2.228467527237667e-02; +3.742951496469128e-02   +3.900987913282096e-02   +4.236969027789240e-02   +4.307201704655495e-02   +2.855363918278047e-02   +5.941222122978755e-02   +3.404938346250394e-02   +1.833063525207981e-02   +3.611599129158260e-02   +5.670938468774465e-02   +2.255352539616413e-02   +4.673587431369627e-02   +1.040462855527188e-02   +1.873364881652543e-02   +6.278990422568032e-02   +1.052582101514280e-02; +3.187017822771134e-02   +6.007969875245925e-03   +5.328185066458442e-02   +1.255295386784090e-02   +3.971471923644093e-02   +2.239580725179519e-02   +2.371347610487876e-02   +1.445459633803944e-02   +2.821677253620099e-02   +3.324052647747745e-02   +4.722891757352686e-02   +1.316192360408765e-02   +3.413915739917419e-02   +3.341806673873804e-02   +3.170504853054127e-02   +4.930004892754983e-02; +1.895706540532698e-02   +4.380349905569460e-02   +6.273226019385640e-02   +3.664807945239243e-02   +2.871712863210033e-02   +3.747447383763727e-02   +2.214544633586979e-02   +5.978226020010326e-02   +6.121190940062301e-02   +2.263651216352031e-02   +6.277042819755793e-03   +1.373114287448736e-02   +2.657009414655670e-02   +5.888305002345293e-02   +2.757248665851357e-03   +1.347222253814550e-02; +4.047028248151561e-02   +2.093424596332687e-02   +4.702478265439878e-02   +4.410868650949723e-02   +4.204418326487194e-02   +7.492623059897129e-03   -5.377877718382119e-04   +3.473335242370679e-02   +5.246034104879211e-02   +4.323708227136772e-02   +1.437438992876267e-02   +4.846787022519997e-02   +1.492247531069201e-02   +7.022890353814870e-03   +4.025169117355571e-02   +3.941083704826436e-02; +2.145569574001754e-03   +4.508383239635731e-02   +3.979027105700145e-02   +4.099501021420016e-02   +5.354622765339943e-03   +5.614435066119259e-02   +2.366494998304856e-02   +3.007550670294656e-02   +3.456111128782033e-02   +3.116231990386197e-02   +1.083717905762464e-02   +5.791722246872293e-02   -3.251553467831644e-03   +4.925470732198228e-02   +2.365016944653270e-02   +2.538408388153980e-02; +3.727234684373212e-02   +1.201239419119540e-02   +5.864105518260256e-02   +4.746998574556961e-02   +3.981023577646051e-02   +1.393288305224040e-02   +8.082186008641338e-03   +4.938378648538315e-03   +4.929735715027291e-02   +2.632389008451368e-02   +6.540460656313212e-03   +4.274657780744207e-02   +6.093300624843392e-02   +1.552775666308696e-02   +5.755788983203527e-02   +4.038909849915405e-02; +2.997047479406737e-02   +3.169982404186600e-02   +2.966715226187736e-02   +5.207277670003978e-02   +5.225312387693352e-02   +1.117497941304068e-02   +4.348977612630344e-02   +3.858085495422737e-02   +1.584519924856997e-02   +1.594423935142684e-02   +4.334640583677002e-02   +6.154259751937678e-02   +7.124078102379991e-03   +3.966449706678624e-02   +5.018113564648331e-02   +1.162850966575531e-02; +3.490052990523687e-02   +1.812508356344347e-02   +2.923378503310476e-03   -2.067158108099541e-03   +5.486237506267532e-02   +6.060795065913586e-02   +7.154349664865958e-03   +4.251048795435856e-02   +4.376256077903581e-02   +2.162402983919989e-02   +7.797305305145309e-03   +1.137796092831745e-03   +5.978756958378217e-02   +5.427263176756678e-03   +3.574152139093739e-02   +2.939008371997134e-02; +3.948291486236200e-02   +4.796604562349975e-02   +5.696417841797163e-02   +1.311401966418064e-02   +4.357927428283512e-02   +4.296044843771121e-02   +4.737060491035527e-02   +4.738364869347572e-02   +5.064514758776010e-02   +2.846970641720136e-02   +2.824810702997178e-02   +6.544948091879571e-02   +5.218804556098760e-02   +4.426504150736471e-02   +2.937898490350018e-02   +5.867301592497198e-02; +5.316837970867211e-02   +4.488954059296996e-02   +1.756145013044392e-02   +3.808710349377806e-02   +4.739331145959987e-03   +1.555334603418143e-02   +1.020781767285186e-02   +1.360712481498817e-02   +1.987484893196028e-02   +4.919099253759916e-02   +1.182956257086648e-02   +5.568958056011044e-02   +3.988498763763860e-02   +4.131159242565937e-02   +2.455617480227206e-02   +2.182463891084106e-02; +4.647120336620163e-03   +3.462784331659084e-02   +5.508588479658805e-02   +3.581248434580910e-02   +2.059537175328676e-02   +9.798736708293631e-03   +1.583572312245340e-02   +3.017899275822249e-02   +1.755707136124201e-02   +6.229703638171082e-02   +2.168469681953170e-02   +5.601012934899124e-03   +4.316539192466422e-03   +5.237803501746965e-02   +2.916320613329775e-03   +4.379503097326427e-02; +5.304550812619293e-02   +1.605983971143663e-02   +1.226699634869960e-02   +6.363382988992042e-02   +7.484596257534152e-03   +7.458961421694941e-03   +5.418772810381856e-02   +6.553418937144817e-03   +3.381524837372068e-02   +5.374152807599485e-02   +4.511899207633087e-02   +7.224455574111145e-03   +5.068346808806488e-02   +4.913548956507822e-02   +6.712120006121866e-02   +6.074642818783179e-02];
L1E_L1I_iGABA_netcon = [+3.043421834994510e-02   +3.891211319661855e-02   +9.739839009279461e-04   +1.881583023927582e-02   +5.040565630692035e-02   +2.705109189723139e-02   +2.323887007907332e-02   +1.362388045108305e-02   +1.099956559354883e-02   +1.942668052488256e-02   +2.393170402907191e-02   +3.451538182619408e-02   +1.672663781854065e-02   +5.810915444607585e-02   +1.207215382688693e-02   +2.983051484751496e-02; +6.824443574471838e-03   +5.481544772784559e-02   +3.123816715852683e-02   +5.513085476164220e-02   +2.966717886383462e-02   +3.326124737458003e-02   +1.499620684119275e-02   +3.415392023650771e-02   +3.259478506623027e-02   +1.187909004653106e-02   +1.418981661282505e-02   +4.396909649044255e-02   +2.661409464456329e-02   +4.466164923616500e-02   +3.566256702223569e-02   +5.030574626804010e-02; +4.199614871756970e-02   +6.432978380383293e-02   +5.943531706560851e-02   +4.513321607639797e-02   +7.982938746290715e-03   +2.923924287923199e-02   +4.326465398007125e-02   +5.833189643456656e-02   +5.582048053117980e-02   +6.780317315884429e-02   +4.367365602533710e-02   +3.495228126006528e-02   +6.395992975947899e-02   +5.118117244366488e-02   +2.911273168217333e-02   +3.864945670219556e-02; -3.255871987515634e-03   +8.901161328750917e-03   +5.947577541889000e-02   +6.065463236840846e-03   +5.795910754360895e-03   +4.597783574545887e-02   +5.317594207405484e-02   +3.238054755124261e-02   +2.927614533006615e-02   +6.048710625094567e-02   +3.936708533879726e-02   +5.765405478908813e-03   +2.504887376717745e-02   +1.766415820583020e-02   +2.398207292399165e-03   +6.468849204449398e-02; +1.456929996076084e-03   +5.813166224495514e-02   +2.727690020302754e-02   +9.045904671197747e-03   +3.242912876777870e-02   +5.304821584686983e-02   +4.310057911535940e-02   +2.648100699417931e-02   +2.149709645185135e-03   +7.037061105575071e-03   +4.402717534982716e-02   +9.872796455553216e-03   +5.089898684722896e-02   +2.889126579865429e-02   +3.906528015905377e-02   +3.354330475998991e-02; +5.439063484636828e-02   +5.436647535002467e-02   +2.731903913350371e-03   +4.659300457379580e-02   +2.355797833353846e-02   -6.446265813465217e-03   +4.262360677635366e-02   +1.858615751024803e-02   +5.639998845841480e-02   +1.402881493652872e-02   +5.520059759061197e-02   +3.692030025701232e-03   +2.669931768859557e-02   +2.394570576623921e-03   +4.173842419692771e-02   +1.363076023479928e-02; +3.162355355664394e-02   +1.432748296571341e-02   +1.277750818974653e-02   +1.454297824375184e-02   +1.112153139314229e-02   +2.494468736797304e-02   +1.649931898793723e-02   +3.563145469570571e-02   +6.014193785967593e-02   +1.323414440772283e-02   +5.182334151133527e-02   +6.562765251074805e-02   +6.596345335247239e-02   +3.565776175671126e-02   +3.290186947277746e-02   +1.460052353567660e-02; +1.922268295139194e-02   +1.128732471707002e-02   +5.380925571759737e-03   +1.099842982776197e-02   +4.561868575301693e-02   +3.737030310161568e-02   +3.140506977879670e-02   +3.754703184091040e-02   +1.804442160997835e-02   +2.617046535899475e-02   +5.208563832385772e-02   +6.980242818240416e-02   +3.254225704814163e-02   +3.085298163869943e-02   +7.568582981013759e-03   +4.272924250253335e-02; +1.968273426018281e-02   +3.792829670481597e-02   +2.107846343481800e-02   -3.719952328654606e-03   +1.344984048742608e-02   +4.531065456797641e-02   +5.201829607303456e-02   +6.071606442442489e-02   +2.286719557436738e-02   +9.551415356936623e-03   +4.704084758363787e-02   +2.663485325103807e-02   +6.235884027948147e-02   +6.188928920304713e-02   +3.384901138327822e-02   +8.156728543817188e-03; +3.499970910800811e-03   +2.438480099543358e-02   +1.644577237163065e-02   +3.410648617089305e-02   +2.167624768095877e-02   +4.971287815671940e-02   +1.759625957536895e-02   +1.847800487539508e-02   +6.150791882216381e-02   +5.554227098917514e-02   +1.487717076682498e-02   +3.218837573678673e-02   +4.902602458229637e-02   +1.659244379977265e-02   +4.503151752532684e-02   +1.675735340039384e-02; +5.715400297184039e-02   +7.660241408366497e-03   +1.884411078367542e-02   +3.160895776250275e-02   +3.896526963225470e-02   +4.331694421702405e-02   +3.121247017764189e-02   +6.571037285389843e-02   +1.917429690224796e-02   +2.410956497636502e-02   +3.618538871059491e-02   +3.304927882620047e-02   +1.601498492551388e-02   +6.275020213082498e-02   +5.489507375055527e-02   +2.625094617014970e-02; +1.441702186976107e-02   +6.421398226044669e-02   +3.833605703927044e-02   +5.848329292106955e-02   +6.439384760170692e-02   +4.664013857743265e-02   +2.847540143140845e-02   +7.678503779617873e-03   +4.670508564464063e-02   +3.223401518228960e-02   +1.675033663333616e-02   +4.736116711830483e-02   +4.822918085345936e-02   +3.422507626803233e-02   +4.913611678636477e-02   +1.099057221579107e-02; +4.495817848168550e-02   +5.000802912245547e-03   +3.866022115660901e-02   +6.779709284050476e-03   +3.629233947402908e-02   +3.541564130057223e-02   +3.969612418588675e-02   +1.417413976900988e-02   +5.140572766978336e-02   +5.272717529751449e-02   +1.715397475588602e-02   +5.641779692034368e-02   +6.384997299122583e-02   +4.179278829873975e-02   +2.383868248397183e-02   +9.900417713391538e-03; +2.086080275621658e-02   +1.842844156541491e-02   +1.278732467123491e-02   +7.686660508978541e-03   +1.330535780987419e-02   +5.939625777917204e-02   +5.973775176978213e-02   +5.019052479735939e-02   +3.239769862970434e-02   +3.795202030197281e-02   +5.949290454726318e-02   +4.751432103912917e-02   +4.356200519272006e-02   +5.197503285119590e-02   +4.034826834633163e-02   +4.877735480450910e-02; +2.972132427829534e-02   +1.393583819642619e-02   +3.036265858936160e-02   +5.068791162163730e-02   +3.578566496601095e-02   +3.613395606619253e-02   +6.055230081093357e-03   +2.179340727057787e-02   +9.027629756924815e-03   +3.483297943512313e-02   +1.524012228796198e-02   +2.754996644065488e-02   +1.891079009071546e-02   +1.392625075158087e-02   +1.149736387815966e-02   +1.768369358739451e-02; +2.778631492201404e-02   +4.172412718875443e-03   +1.075585622659220e-02   +6.105824282649609e-02   +6.196088450439000e-02   +3.237008544562415e-03   +1.317735184583385e-02   +5.563956798806812e-02   +5.484678535649887e-02   +6.965275007804716e-03   +4.539818420362047e-03   +3.756602790902946e-02   +4.499258984116668e-02   +3.709969582119167e-02   +2.782697282066120e-02   +3.056696749378105e-02];
L2I_L1I_iGABA_netcon = [+6.661744070863476e-02   +2.511128954205351e-02   +2.145979554243426e-02   +5.299471439785239e-02   +6.417751184457592e-02   +5.960713251340585e-02   +2.743382362450232e-02   +4.937571879821420e-02; +5.454955903623971e-02   +5.685046720957564e-02   +4.084699188500343e-02   +2.182186221111218e-02   +2.408708074911620e-02   +4.541038618394552e-02   +5.716196797380631e-02   +1.734184743685069e-02; +1.568217511521473e-02   +1.740433303851640e-02   +1.564756518683786e-02   +4.675043183990195e-03   +5.300685694008958e-02   +5.907916808503490e-02   +4.176937816846283e-03   +3.912615272747445e-02; +1.982632685658676e-02   +5.156693975204522e-02   +4.349861606470481e-02   +3.766600454934924e-02   +3.967262993628955e-02   +3.508027174467517e-02   +2.978576097481700e-02   +5.372898501820880e-02; +2.074778981364862e-02   +9.481241153545967e-03   +4.075155491093919e-02   +3.937795398548390e-02   +2.293382797977811e-02   +5.003242236741009e-02   +3.079611858357659e-02   +3.489423659793010e-02; +4.655157180340343e-02   +4.253021761584746e-02   +5.871898635926959e-02   +3.134022867064507e-02   +1.764662653344651e-02   +4.618820742839864e-02   +6.369763901582464e-03   +4.847497290405316e-02; +4.756796737280211e-03   +2.814671736491905e-02   +2.822727746328616e-02   +1.735388215665604e-02   +5.080506316691520e-02   +1.824388764068886e-02   +1.383714343749616e-02   +4.196768232816952e-02; +3.871639275369707e-02   +2.306735695306487e-02   +4.903299170948058e-02   +2.920162415941458e-02   +1.830676824526706e-02   +4.394837567353639e-02   +2.788828267239304e-02   +1.578377153437152e-02; +3.061705412268005e-02   +4.281743361511548e-02   +1.367890360763197e-02   +1.011524954861267e-02   +1.655836415404932e-02   +7.249180786290018e-03   +2.731598254610643e-02   +6.432143487243953e-02; +3.354207904563491e-02   +4.368854638349679e-02   +8.523854522147815e-03   +2.954812710912286e-02   +6.383751640416744e-03   +4.678822343629379e-02   +5.851023397900877e-02   +4.849891247142200e-02; +2.830051730144018e-02   +5.220291979693197e-02   +5.301662071807595e-02   +2.298041214226975e-02   +4.607610557726261e-02   +5.707467918551336e-02   +7.355578176539647e-03   +2.030132288772946e-02; +5.603462405577692e-02   +3.577474416961185e-02   +4.286971230241563e-02   +2.960617105902873e-02   +6.056971122069044e-02   +1.120076807770218e-02   +3.927789278814389e-02   +2.059050240897430e-02; +2.651335429916732e-02   +6.233002762300150e-02   +5.505131826788207e-02   +4.364756101620940e-03   +3.511182045609033e-02   +2.473172723510801e-02   +2.012931257432056e-02   +3.810490574522531e-02; +4.842147798900436e-02   +1.435991763459634e-02   +6.342171272225654e-02   +3.317450144413597e-02   +5.547055649542144e-02   +1.242593504004475e-02   +5.691684171407298e-02   +1.502982944205914e-02; +6.291335817138856e-02   +1.298472333454743e-02   +1.711863943601082e-02   +6.199660315673023e-02   +4.331017235140468e-02   +7.195437015417186e-03   +2.566926482593064e-02   +4.624185605142894e-02; +1.320340336733380e-02   +4.410505033384608e-02   +3.996623192379494e-02   +4.087671564466097e-02   +5.753212813692080e-02   +6.317852744051019e-03   +6.041323528905485e-02   +1.754162626021848e-02];
L1I_L2I_iGABA_netcon = [+3.968304403716038e-02   +4.371850177348549e-02   +9.923410333539757e-03   +2.176929812189177e-03   +3.376557358979852e-02   +1.892413665004588e-02   +6.804064679846297e-02   +4.290288202190019e-02   +2.804337134316985e-02   +4.989332428006455e-02   +8.738865249679546e-03   +1.656562358152790e-02   +9.168159641017571e-03   -2.109123030627371e-03   +1.361870453117701e-02   +5.564392087146047e-02; +4.959807590309059e-02   +4.115211357844822e-02   +2.634141636141691e-02   +2.973369404260481e-02   +6.092044960031970e-02   +3.166629562637495e-02   +3.533827782457841e-02   +6.099465046400881e-02   +3.130256121909396e-02   +6.132809099098858e-02   +4.488397726397173e-02   +2.345918668186420e-02   +3.665263444964947e-02   +4.703259114392601e-03   +4.437521024641775e-03   +5.713379496154723e-02; +5.681493017407528e-02   +4.092158127030812e-02   +1.103978887027675e-02   +5.546767583658237e-02   +2.094766616437439e-02   +5.669722293164138e-02   +4.218558834219344e-02   +4.245658796258464e-02   +2.358593101415807e-02   +2.990248858926222e-02   +3.511080426284262e-02   +2.871843868741253e-02   +2.672769912147283e-02   +7.837414204069571e-03   +4.004046585415428e-02   +1.260687895616479e-02; +2.479493832507682e-02   +4.616275102877549e-03   +3.846469296859460e-02   +4.741706903068370e-02   +1.150261628446980e-02   +2.524799351987878e-03   +2.409443832601164e-02   +1.764491275201014e-02   +4.367307304851163e-03   +4.059051577553429e-02   +3.175953256473329e-02   +2.915129968298028e-02   +1.726507438005334e-02   +5.187397979380048e-03   +4.894774303076357e-02   +2.860724634225218e-02; +3.581557656378531e-03   +5.636221656102366e-02   +4.594286752634242e-02   +4.529307610687555e-02   +4.293246578543871e-02   +3.713979617931668e-02   +3.948837207069302e-02   +5.799080499952199e-02   +4.080365865245882e-02   +6.054108653854058e-03   +1.482313518315279e-02   -2.535569488340167e-03   +1.763734263371370e-02   +5.690268696138803e-02   +7.462151525518494e-03   +3.610307222366615e-02; +3.896455733685457e-02   +4.242178009761943e-02   +6.964782803859840e-03   +5.853209805777387e-02   +3.921191171974699e-02   +6.177334998417332e-02   +4.427208477008551e-02   +4.885898775138158e-02   +3.744818721231290e-02   +3.580320648622426e-02   +6.057293844987682e-02   +5.178306155868494e-02   +6.878541090363112e-03   +6.607664590958787e-02   +4.454228547586772e-02   +5.976338849384345e-02; +5.288936320932515e-02   +6.509971101012323e-03   +5.174981074548730e-02   +6.683905172399808e-02   +2.297470366410618e-02   +6.890593223368537e-02   +3.493882591995632e-02   +2.541631395552164e-02   -3.264640079776589e-03   +3.352455369230414e-02   +2.223958031783172e-02   +2.129809598355893e-02   +5.084909103761059e-02   +2.492443165845395e-02   +5.774698554755387e-02   +4.046562301248079e-02; +4.457490522419087e-02   +2.529637997558943e-03   +5.422330972452224e-02   +4.248684109901653e-02   +3.092666257757196e-03   +4.642218375904618e-02   +4.212982895001895e-02   +4.994506479064093e-02   +2.856876195914427e-02   +5.634525954594607e-02   +1.128128100753288e-02   +3.122074099870639e-02   +3.032251538548212e-02   +7.679545086889314e-04   +5.601001056396616e-02   -1.195492791705496e-04];
L2E_L1E_iAMPA_netcon = [+5.346541082586789e-02   +2.142764163628743e-02   +7.483215233838791e-03   +6.859928140274535e-02   -2.478827280007896e-04   +2.683726905064273e-02   +4.384263476948785e-02   +7.412297662650435e-03; +5.778727585994115e-02   +5.883859687868145e-02   +3.819862499228711e-02   +2.431125569480459e-02   +3.364113762780270e-02   +1.365525499351132e-02   +6.311498378285196e-02   +3.051418886842423e-02; +5.018616203808256e-03   +1.029891576956840e-02   +1.566862974637677e-02   +1.215580520620613e-02   +3.819838425407068e-02   +5.418581637083975e-02   +2.348961120445684e-02   +1.964912237423997e-02; +2.058296436368936e-02   +4.807794541566658e-02   +1.490802214649102e-02   +4.645186553876177e-02   +5.625233102227126e-02   +1.936685329828442e-02   +6.213406317191905e-02   +5.983721078589136e-02; +1.289679246949545e-02   +6.958383191827858e-02   +6.295824051562239e-03   +1.627908699667404e-04   +6.158511978616300e-02   +6.143388557288267e-02   +4.173686680146087e-02   +2.238122919092428e-02; +4.955919997249930e-02   +3.502187556218866e-02   +5.764116150256557e-02   +5.021451887851550e-02   +3.677527473033854e-02   +9.048287995039598e-03   +4.620092938544275e-02   +3.888827139136656e-02; +7.856962504391551e-03   +1.694619824771189e-02   +1.458615299071067e-02   +2.635562212026766e-02   +5.323114916074193e-02   +2.707446349064073e-02   +1.219234989672582e-02   +1.735085962930309e-02; +8.128056150454066e-03   +1.104595066007201e-02   +3.385289574156523e-02   +3.887616810284673e-02   +2.448864450363136e-02   +5.566581768523327e-02   +5.678650782484494e-02   +5.829008394862946e-02; +2.646694676982048e-02   +5.564630674154448e-02   -4.101759666592106e-04   +1.853401115635608e-02   +1.158809536521159e-02   +6.405163892609152e-02   +3.560306527570833e-02   +6.067247000918780e-03; +1.769971964874808e-02   +1.480001163031496e-02   +5.646131287597740e-02   +2.325768827455566e-02   +5.778209747020179e-02   +6.740372264742873e-03   +7.775906624288435e-03   +5.933505378908227e-02; +3.280297191431540e-02   +2.757848404259063e-02   +7.813248360917256e-03   +4.149592654639669e-02   +2.730922793050623e-02   +2.236627876670095e-02   +4.199218451698733e-02   +5.284425732380890e-02; +1.791982239091162e-02   +2.882073055252548e-02   +5.072459717470058e-02   +4.571919440507442e-02   +4.284794655106387e-02   +1.208831359548121e-02   +6.489151382088040e-02   +1.280787264819750e-02; +3.844287751333111e-02   +5.346140475011492e-02   +1.207577459256539e-02   +5.339654834243596e-03   +6.265143276017637e-02   +4.743906451512314e-02   +2.664456484174475e-02   +5.665631118198116e-02; +2.568660540696569e-02   +1.585560579031379e-03   +7.277159862797979e-03   +5.204736296929467e-02   +3.129278706871760e-03   +1.631440422567063e-02   +4.410345016709139e-03   +4.781850408770508e-02; +2.290008076315763e-02   +9.221624611792113e-03   +3.666960810697599e-03   +5.282769265043907e-02   +8.285536951180675e-03   +4.117252099157123e-03   +2.690386123855881e-02   +9.379727514427722e-03; +9.151710875249396e-03   +3.123788376028097e-02   +7.134634826836439e-03   +3.476686485344302e-02   +1.112157876378200e-02   +4.011018889463727e-02   +3.591391292770630e-03   +5.412655505615393e-02];
L1E_L2E_iAMPA_netcon = [+1.742121013221254e-02   +1.028359537128311e-02   +6.233680371088662e-02   +6.055959495180513e-02   +1.962174661143022e-02   +5.824194699599739e-02   +3.091096155078383e-02   +6.125646150415386e-02   +1.449641799900172e-02   +4.231860154671132e-02   +3.937322558403506e-02   +4.823773838384725e-02   +2.661458168381237e-02   +4.313618679600146e-02   +3.787766141106629e-02   +2.719042073467667e-02; +2.667006991567789e-02   +4.283487977865189e-02   +8.015389912106935e-03   +9.178665870900297e-03   +6.526148472263306e-03   +4.457939334856522e-02   +7.107775002227390e-03   +1.995866468928573e-02   +2.133022312228904e-02   +1.848196552660422e-02   +1.497885634027337e-02   +6.195867517707701e-02   +1.047988364396981e-02   +1.065302221427450e-02   +3.737131452929897e-02   +2.162888307342369e-02; +2.482163125438624e-02   +3.627313970327422e-02   +5.770713288981479e-02   +5.654233409265735e-02   +5.991184282594412e-02   +5.086841065564550e-03   +1.820512296937535e-02   -3.568541664241744e-03   +2.677886732502550e-02   +4.401032741227651e-02   +1.851003679168890e-02   +9.702403310639504e-04   +4.535187040234188e-02   +4.083735793993977e-02   +5.864467172767546e-02   +8.023146349289439e-03; +4.864578060079649e-02   +1.848473565096670e-03   +1.207964340521744e-02   +1.022646425367773e-02   +4.717594582134774e-02   +1.867169388889618e-02   +6.592476749390415e-02   +6.082438927320626e-02   +5.071267950563706e-02   +5.150015440595407e-02   +2.530786230077301e-02   +3.263059800935332e-02   +6.344628038256903e-02   +2.339648378547590e-02   +5.668919960595607e-02   +6.108514168056368e-02; +1.182924564663831e-02   +6.495545248893432e-02   +5.220131917201923e-02   +5.052892240590126e-04   +1.428380579947500e-02   +5.252046912738723e-02   +5.987452283351548e-02   +1.249159170726576e-02   +3.083617395200522e-02   +2.604615790365422e-02   +3.219327639685755e-02   +4.800658808146865e-02   +2.233682255733988e-02   +3.898446184110484e-02   +6.136667410800425e-02   +3.834243041968717e-03; +3.104098516082280e-03   +5.918861375156705e-02   +2.220047065261278e-02   +5.938360097653861e-02   +6.249469769790378e-02   +5.359099360686456e-02   +2.887562045969917e-02   +5.335225483280113e-02   +2.038998716744157e-02   +2.977680120701421e-02   +5.515802692173326e-02   +6.161074061092695e-02   +5.432629922105457e-02   +3.664957678712559e-02   +1.130899891998382e-02   +3.530616157104213e-02; +2.144051247700075e-02   +9.901148984925235e-03   +4.208889639321642e-02   +4.892134458618571e-03   +2.285241236906554e-02   +3.038399641242274e-02   +4.994485923940951e-02   +3.734060038950499e-02   +3.275858122555411e-02   +5.426974976251388e-02   +4.693397860516117e-02   +5.390381304054804e-03   +2.865383407647442e-02   +4.086476798948318e-02   +1.506546365388718e-02   +1.988329385429117e-02; +3.474513534593531e-03   +3.470028879555697e-02   +3.131332823248458e-02   +2.336962843633601e-02   +4.334498566147581e-02   +6.498702051723579e-02   +6.202714722611657e-02   +3.651669106525445e-02   +5.438857088243346e-02   +2.647762342170979e-02   +2.408105375584390e-02   +6.817266927420687e-02   +4.474218413426289e-02   +5.108124087142946e-02   +1.730862639411484e-02   +1.119348663751855e-02];
L2I_L2E_iAMPA_netcon = [+4.738761449239157e-02   +2.221268750782446e-02   +5.624340812620734e-02   +3.011185680657243e-02   +5.296776619437821e-02   +4.821820861597997e-03   -1.371620619388458e-03   +5.799585971502343e-02; +6.738641745759060e-03   +9.497383083364295e-03   +1.291630089518980e-02   +4.925489423476606e-02   +4.861016813746245e-02   +2.294195203661292e-02   +4.516014236825695e-02   +3.067648611689664e-02; +5.496763688440170e-02   +5.326544444772312e-02   +5.631381754541399e-02   +4.071606429937336e-02   +3.069266906135045e-02   +3.733668781896054e-02   +2.923434959587296e-02   +4.332920703699086e-02; +2.636495332752803e-02   +1.483648246005413e-02   +5.934741374147814e-02   +2.832306800331375e-02   +6.334346784283409e-02   +8.520198132740816e-03   +2.652662489681938e-02   +5.417624230869142e-02; +3.648428100244235e-02   +5.959286242049777e-02   +3.464315264938176e-02   +3.691945962536079e-02   +6.153652289460421e-02   +4.733023112091436e-02   +2.760143131651938e-02   +4.926916179026329e-02; +4.049937361146776e-02   +1.775843939298805e-03   +5.755812469217987e-02   +4.746482331534992e-02   +3.692877405372613e-02   +1.413521352235302e-02   +9.293402567509464e-03   +4.761824300653841e-02; +6.570236013596328e-02   +3.486415567661650e-02   +5.547705226217902e-03   -3.440982004508879e-03   +1.127998532835724e-02   +1.465601782980182e-02   +1.254850930905820e-02   +1.534633941013907e-02; +5.774754640523977e-02   +1.491046074784837e-02   +3.352027343756801e-02   +3.663074537087848e-02   +5.700838558494871e-02   +1.773366704197308e-02   +9.064114191150316e-03   +6.692492072151845e-03];
L2E_L2I_iGABA_netcon = [+6.036582424732276e-02   +9.773942648143352e-03   +1.414148591954942e-02   +9.872443791435422e-03   +4.546381845199805e-02   +2.657012814201973e-02   +4.962070581540442e-02   +6.177982543462836e-02; +1.648982418236277e-02   +2.804192868428932e-02   +1.287652758159164e-02   -1.409139958891132e-03   +6.359848970310050e-02   +4.846584341704294e-02   +4.766789202016410e-02   +2.248588807849325e-04; +4.218425130829450e-02   +2.391896819514698e-02   +3.367365240363160e-02   +8.961248979530670e-03   +1.859634554725006e-02   +3.727479689098644e-03   +6.438911904501429e-02   +5.391003215350577e-02; +4.862025293490986e-02   +3.908274049475926e-03   +1.377785235326169e-02   +4.967732767644600e-02   +5.835735008449312e-02   +4.750053474107978e-02   +3.159676741589978e-02   +3.861497929785462e-02; +8.241335349828679e-03   +5.685302681394540e-02   +2.656549265037407e-03   +5.129110962676183e-02   +2.319234126450243e-02   +1.969598122073608e-02   -7.465884416011075e-05   +1.360346164926237e-02; +4.904469136939688e-02   -4.346115768297310e-03   +3.064890405002369e-02   +5.174012092694216e-02   +5.934454201982093e-02   +2.115856257801076e-02   +5.902824282241754e-02   +4.969077555442541e-02; +9.634494404951463e-03   +6.652879594840920e-02   +1.709565888398283e-02   +6.685117474610023e-04   +5.168602292165501e-02   +3.089833846654886e-02   +3.624633232065583e-02   +3.557354346446757e-02; +5.255315824316109e-02   +2.230642332072603e-02   +3.399947972567278e-02   +1.514225386146599e-02   +2.538296356767848e-02   +5.061948093375657e-02   +5.985687672899821e-02   +4.327964860454717e-02];
L3E_L2E_iAMPA_netcon = [+2.448398732376501e-02   +4.268172749864439e-02   +7.057474344400079e-03   +3.382220233202673e-03   -3.462877319660150e-03   +6.143095153716135e-02   +2.213238439013139e-02   +5.707922897446548e-02   +9.346705898288555e-03   +1.575335689929361e-02   +2.116434449462211e-02   +2.359756174014030e-03; +1.827527243214057e-02   +5.848870123089074e-02   +1.838179171706588e-02   +2.581433860647834e-02   +3.072082050002119e-02   +3.891589860919396e-02   +5.401718302014923e-02   +6.352429633261839e-02   +3.956804663896975e-02   +5.952854307078627e-02   +2.133411891112354e-02   +1.762334398113483e-02; +7.418963463875156e-03   +5.391606937635825e-02   +1.161061201390332e-02   +4.828271444510177e-02   +3.444659771025797e-04   -1.492646558659327e-03   +3.558150177851695e-02   +6.318723969283485e-02   +4.027616071091904e-02   +3.038341456526202e-02   +1.911720222792463e-02   +4.202354899446607e-02; +6.001757231254330e-03   +2.022592278623806e-02   +5.732294342700966e-02   +2.143856665142368e-02   +1.715898176219977e-02   +5.657723395523320e-04   +2.185195317031324e-02   +2.136711641321329e-03   +1.054051319622270e-02   +2.407132731015007e-02   +1.473735074924268e-02   +1.977634813262317e-02; +5.526482802231637e-02   +2.374351014637257e-02   +2.227151280936616e-02   +6.007620337943495e-02   +5.012845244688085e-02   +2.139549523478796e-02   +6.245428970854686e-02   +8.889016374550711e-03   +5.205684720272389e-02   +2.742392479763265e-02   +4.570871274292119e-02   +2.441872749684741e-02; +5.435601344804479e-02   +4.054820865454980e-02   +4.871340423165442e-03   +2.954947658842901e-02   +4.041654709612058e-02   +6.618209730175444e-02   +5.994339053956479e-02   +2.172479446054002e-02   +3.277143841278806e-02   -5.748605347785230e-03   +3.640466079591474e-02   +1.487663224622095e-02; +4.139093005502532e-02   +2.516554572005211e-02   +3.910961671773723e-02   +1.440193167123907e-02   +1.278534072665105e-03   +2.560448796277046e-02   +2.611368768844955e-03   +2.581865938351874e-02   +1.618317293247512e-02   +5.646573864061811e-03   +4.062852755020158e-03   +2.579647310940346e-02; +5.429852051099220e-02   +1.056241609010493e-02   +3.447701430715071e-03   +1.920372705623499e-02   +3.416044008935391e-02   +7.276171157914181e-03   +1.706326097045143e-03   +2.843185152671059e-02   +3.017791771303146e-02   +5.700155687829291e-02   +8.896249024394376e-03   +3.930032377191046e-02];
L3I_L2I_iGABA_netcon = [+6.516241779485453e-02   +4.068691233793759e-02   +4.145061659332681e-02   +2.629348506545857e-02   +6.158895593354188e-02   +2.461056937420073e-02   +5.499028230039200e-03   +3.124627691704402e-03   +5.839585219498396e-02   +3.313708601915844e-02   +6.830057405124179e-03   +5.126303627431850e-02; +5.618641679536306e-02   +6.345526356276096e-02   +4.888522057831222e-02   +1.311851628091867e-02   +2.850544927222197e-02   +5.232832160798269e-02   +1.431438461154967e-03   +9.842239837171897e-03   +3.507650513068568e-02   +4.551273857227697e-02   +5.748915041069551e-03   +4.074548876737256e-02; +7.371748696565462e-03   +5.370188508505026e-02   +6.213711654689629e-02   -1.577626643038183e-03   +4.332385695862918e-02   -8.493090698534604e-04   +4.392833874048906e-02   +6.206494156762794e-02   +4.731531305789002e-02   +3.859041885407583e-03   +4.413044289189105e-02   +6.547647060615005e-03; +6.794852799368617e-02   -1.450595881855792e-03   +2.001973114508326e-03   +4.419499037342357e-02   +5.698179340810024e-02   +3.603808118751411e-02   -4.159475054788116e-03   +1.448389094371588e-03   +5.894394741477995e-02   +5.482250096538879e-02   +5.967801669334966e-02   +3.668875007453450e-02; +1.710831897596617e-02   +6.636079672582337e-02   +2.187291792655872e-02   +3.021375588401221e-02   +3.599892312318670e-02   +6.156819826179202e-02   +2.319625902558305e-02   +9.088364613551838e-03   +5.881816992900499e-02   +3.426242229376766e-02   +1.439978676065651e-02   +1.029668409623117e-02; -6.348554445000894e-04   +4.300540087659185e-02   +1.447360624089523e-02   +9.021451047861388e-04   +9.382575817298230e-03   +4.069604361497174e-02   +4.690437030601040e-02   +1.060010766772789e-02   +9.064102413731793e-04   +5.385697960821653e-02   +5.100020825427936e-02   +3.137958104270763e-03; +3.961924544848457e-02   +6.062061965625185e-02   +3.182662025235592e-02   +3.929952500896038e-02   +3.216022258380755e-02   +1.594826336045017e-02   +4.168702525013745e-02   +7.794060715266161e-04   +5.906687019690914e-02   +1.812999308791225e-02   +2.645872160609102e-02   +4.605061932961954e-02; +3.292401639114727e-02   +7.217449675866626e-03   +1.930439528566492e-02   +3.806420476881660e-02   +2.476888437240089e-02   +9.465503381099529e-03   +1.180660418430529e-02   +1.895055417316885e-02   +3.877684386294580e-02   +6.327940062063846e-02   +1.691028067542559e-02   +1.769361943388900e-02];
L2E_L3E_iAMPA_netcon = [+3.839068972302231e-02   +3.914097460555035e-02   +1.628647604101317e-02   +4.778815441198849e-02   +6.996398091126670e-03   +3.493602486314681e-02   +4.645773004815527e-02   +6.371931984794331e-02; +3.034875544093461e-02   +4.808300866063932e-02   +4.544318822716247e-02   +4.698597213719190e-02   +4.208111035009228e-03   +3.727153485006127e-02   +5.589226039171383e-02   +4.018823461580153e-02; +4.872567208627586e-02   +5.712467528819413e-02   +5.437446499581790e-02   +6.498595944062674e-02   +4.236106868463347e-02   +4.443226794100135e-02   +5.141564870130232e-02   +3.729110017503653e-02; +2.737312011833676e-02   +6.096532947721560e-02   +5.374503615581316e-02   +3.953184154175623e-02   +3.316841794472807e-02   +3.380567185516600e-02   +1.861949634177177e-02   +7.800092184646926e-03; +4.058339340433585e-03   +3.521939381978512e-02   +2.230549968391092e-02   +5.051155657982173e-03   +8.452538783252486e-03   +3.826550038555473e-02   +5.653028209583891e-02   +4.924956900636853e-02; +3.635045109226565e-02   +6.874099021258304e-02   +5.890906771006967e-02   +3.527801258481528e-02   +3.423102181364957e-02   +6.351726328229128e-02   +4.497156007241947e-02   +6.575457923705734e-02; +2.814105202775401e-02   +4.166311078266855e-03   +3.474722506510617e-02   +9.250491602968723e-04   +2.316402986113454e-02   +5.704463815111431e-02   +2.073822394493925e-02   +5.065786925070025e-02; +5.687981732575050e-02   +4.569350545395177e-02   +3.189424124214916e-02   +5.252787392947577e-02   +2.266094204657754e-02   +4.672610033643106e-02   +3.393048632298194e-02   +2.161702111267523e-02; +2.686628763677573e-02   +3.201862154408695e-02   +6.207302637981661e-02   +3.868839023544932e-02   +3.803682165384938e-02   +1.724929340809903e-02   +3.361767051383532e-02   +4.076627414669972e-02; +1.686217594142468e-02   +9.763089268436644e-03   +4.976396857018184e-02   +5.770933460483665e-02   +6.176490741595252e-02   +2.316043452472829e-04   +5.233147041196944e-03   +4.378530873684862e-02; +4.342627506274673e-02   +1.412625200183231e-02   +4.655544584214014e-02   +4.688889544749237e-02   +5.389573285480651e-02   +6.600346975426895e-02   +1.520472903583113e-02   +2.510409729254665e-02; +9.773472463554079e-03   +3.643898822465961e-02   +2.503732186684614e-02   +5.258870586107222e-02   +2.970658310454628e-02   +1.391047099409993e-02   +4.036800573597368e-02   +5.695393185337318e-02];
L2I_L3I_iGABA_netcon = [+6.242205557923566e-02   +2.553590185118542e-02   +1.607540934735220e-02   +3.905935264951860e-02   +5.196847526799020e-02   +5.467134949017245e-02   -4.627569091527396e-04   +3.199525609678249e-02; +3.128467237930011e-02   +2.543144904888166e-02   +4.653516946850346e-02   +9.553226518710640e-03   +5.377695562544445e-02   +5.621512596884487e-02   +3.444002407864286e-02   +2.170085775071023e-02; +4.678304041284234e-02   +4.875657639793055e-02   +5.822229080318737e-02   +4.043708349146982e-02   +2.458327864706073e-02   +4.309235794756289e-02   +3.304430925723562e-02   +7.415868584531913e-03; +1.414838933467328e-02   +5.072792321928010e-02   +1.603407886234172e-02   +2.968233408920711e-02   +8.312345664706897e-04   +2.243229409319798e-02   +2.543867698739908e-02   +6.688940773347063e-02; +2.296722838187196e-02   +2.265700880678739e-02   +3.517170446041768e-02   +2.862535207459463e-02   +2.387633657260870e-02   +4.057884602318955e-02   +6.138175124917888e-03   +8.810602645382916e-03; -1.705759684442408e-03   +1.947801075663641e-02   +2.449828953033740e-02   +7.330991551120208e-03   +2.385033758131949e-02   +3.223302693847709e-02   +3.601484679667296e-02   +4.966479981047524e-02; +2.718905469290496e-02   +3.432434647716451e-02   +5.998339469762843e-02   +4.296216297612959e-02   +5.146457861087815e-02   +2.386392081206059e-02   +2.480203862276928e-02   +2.459513728545253e-02; -2.102620918373647e-04   +6.153752298726165e-02   +1.911202391927408e-02   +5.286260130987617e-02   +1.837771864891460e-03   +4.903602481983951e-02   +3.386257569170532e-02   +5.011327980062018e-02; +5.270480801806074e-02   +2.529121244684169e-02   +5.729373163107088e-02   +3.793719259233836e-03   +3.098861658290995e-02   +1.716058990959563e-02   +2.138738996870701e-02   +3.303373530289118e-02; +4.705137822495408e-02   +3.385710668733780e-02   +8.643736032186112e-03   +3.181737854082516e-02   +3.659043123030977e-02   +1.935315128295309e-02   +1.175796088167921e-02   +2.231591042721131e-02; +4.824344146607348e-02   +6.035189371871161e-02   +3.593335763139770e-02   +4.245446181030968e-02   +1.994435709875042e-02   +2.683203195692426e-02   +5.812653599303801e-02   +9.472900290432965e-03; +4.440094366015992e-02   -3.864161852438803e-03   +2.102779998287644e-02   +1.048206692233727e-02   +7.147421845407389e-03   +6.020181311465311e-02   +3.369245935378574e-02   +3.895661274427675e-02];
L3I_L3E_iAMPA_netcon = [+2.810497343019353e-02   +5.987104443915282e-02   +1.373490268437590e-02   +3.986606564112503e-02   +5.117489694831394e-02   +2.514381006841235e-02   +2.429247994173628e-02   +1.254558390941947e-02   +2.352193303031932e-02   +1.915990828682649e-02   +1.614155150901118e-02   +5.549185645701156e-03; +2.377403859394725e-02   +4.661275335022298e-02   +1.994863268217890e-02   +6.406266888483978e-03   -1.251442765359866e-04   +3.707533644647641e-02   +3.890923834959770e-02   +3.146017479881710e-02   +1.815222027231616e-02   +3.280660459091483e-02   +4.409238916637243e-02   +3.166866397476045e-02; +7.462530704841371e-04   +3.445232616298647e-02   +3.259928435322553e-02   +3.964105859508803e-02   +3.051286405258845e-02   +2.751837639027971e-02   +3.093589480301437e-02   +2.826660944466276e-02   +3.108723173018879e-02   +3.333090392543584e-02   +2.350914751732360e-02   +3.626495779397700e-02; +2.666402295210345e-02   +4.861154419630125e-02   +3.922553427120389e-02   +2.981127605193385e-02   +2.926677984280346e-02   +6.120183509021386e-02   +5.227746946032351e-02   +1.307958198728579e-02   +5.540466636238460e-02   +5.969807069560860e-02   +1.194070721216208e-02   +4.320528289508212e-02; +9.442013240053679e-03   +2.902957047599737e-02   +9.817816848521208e-03   +5.548111132081589e-02   +5.237556659938884e-02   +3.781063502996289e-02   +6.321413169178949e-02   +4.892881353768809e-03   +6.415147379595523e-02   +3.312344919935965e-02   +2.102810647558877e-02   +9.531355910413675e-03; +2.142711468660496e-02   +3.196197150363415e-02   +4.871932372314580e-02   +3.444749298472791e-02   +6.718357853490525e-02   +5.713607398692154e-03   +5.287630577268282e-02   +2.050213662604281e-02   +4.590400438913365e-02   +6.626415862179475e-03   +2.272923165498750e-02   +1.176469670111860e-02; +4.756613427860958e-02   +2.261919941760938e-02   +2.666058752053547e-02   +1.472892377959557e-02   +3.837633926777862e-02   +9.269902344575944e-03   +3.237105315786883e-02   +6.367639422412939e-02   +5.570555019354169e-02   +6.257718078909900e-02   +3.453821096170120e-02   +4.536389803805920e-02; +4.414314773440222e-02   +1.091224626928927e-02   +4.628449186124715e-02   +4.116088882668562e-02   +6.357746689311768e-02   +3.877235253457361e-02   +5.421690475880296e-03   +3.403167871642442e-02   +3.050936012665232e-02   +1.908529848980746e-02   +1.673797259969102e-02   +6.094811484941237e-02; +1.132492110008602e-02   +5.573760302459145e-02   +4.128486136855047e-02   +4.662385326241785e-02   +2.531783288019766e-02   +5.159434561604731e-02   +8.116192281873137e-03   +4.987289204718078e-02   +5.083233906548116e-02   +2.951594204632154e-02   +1.619092868225218e-02   +1.269710541841222e-02; +5.829064075979872e-02   +5.803682232603651e-02   +2.306027611096704e-02   +1.426562097153519e-02   +3.057260981640476e-02   +5.594212505946540e-02   +3.660761864770803e-02   +5.831542853877717e-02   +4.893129184938701e-02   +2.453502573541184e-02   +5.422642708558476e-02   +1.278374135845631e-02; +3.336040771969880e-02   +2.482456781941118e-02   +6.232195270607493e-02   +5.610141070845287e-02   +5.728949005437524e-03   +3.505216620433569e-02   +4.550166113559316e-03   +1.789081765443172e-02   +2.976687754939712e-03   +6.068439153506652e-02   +4.908921128649168e-02   +2.664201696591599e-02; +1.987130253020307e-03   +1.250701707550517e-02   +5.657444998273182e-03   +3.466025124519399e-02   +3.076958182337252e-02   +1.787561393848301e-02   +5.434337392156438e-02   +8.837195629194033e-03   +2.306564164266067e-02   +1.477079308745691e-02   +4.820177015976073e-02   +2.139598696104735e-02];
L3E_L3I_iGABA_netcon = [+6.696790917391433e-03   +2.545283979682970e-02   +1.410063079024251e-02   +5.871710754683423e-02   +4.766312521555281e-02   +4.093657662698377e-02   +2.393359519922834e-02   +4.716768482094556e-02   +3.806833182808179e-02   +4.757348301669299e-02   +3.457926181984035e-02   +1.481901703498585e-02; +4.781859920787912e-02   +4.265652251955253e-02   +2.421570953448850e-02   +4.541863333918637e-04   +2.253945314983415e-02   +4.743422907623954e-02   +3.623052076300995e-02   +6.309426926073612e-02   +5.244836169126013e-02   +2.614847661268816e-02   +1.358740969897888e-02   -2.193896644700430e-03; +3.795923943815611e-02   +6.722633181700832e-02   +6.125653522234628e-02   +5.912057101640892e-02   -2.452122565042615e-03   +4.607693058196715e-02   +3.967141568400709e-02   +4.169543212893074e-02   +2.772324051997056e-02   +2.502241343315946e-02   +1.812370277216515e-02   +7.932421916136453e-03; +2.413467397780483e-02   -2.918901834347948e-03   +1.122778932836860e-02   +5.283491008938793e-02   +5.253085905128592e-02   +2.141209787692398e-02   +2.903625513739292e-02   +2.605620459647644e-02   +6.584356547050413e-02   +2.539421282478316e-02   +6.005556446848918e-03   +4.689586277606693e-02; +2.827062638758383e-02   +2.754154359195326e-02   +6.865075286011295e-02   +1.492502581634360e-02   +2.765570772726543e-02   +4.909128700041236e-02   +6.781710976865798e-02   +6.099218682029049e-02   +1.646336206642402e-02   +4.060932049093664e-02   +5.487194473380499e-02   +2.923066395484435e-03; +4.526654805466140e-02   +2.645534606217639e-02   +5.619532641490884e-02   -6.749820384509882e-05   +6.913039268641521e-03   +6.797836862476435e-02   +1.706801282837267e-03   +8.493893617613094e-04   +5.247714667871504e-02   +4.209836931965034e-02   +1.527277651244969e-02   +1.319397345514059e-02; +3.661690973703075e-02   +2.133107279531495e-02   +3.952067185697289e-02   +4.102538781575151e-02   +4.023814108634194e-02   +2.977098236501704e-02   +2.228996330560295e-02   +1.436847231974605e-03   +3.102461508714360e-02   +6.288056509674262e-03   +2.013909705165975e-02   +4.125205384295690e-02; +1.379432649916461e-02   +7.166125719753084e-03   +9.113110330792210e-03   +6.264492853989018e-02   +2.891480087804466e-02   +4.969746066330172e-02   +3.425605664567946e-02   +4.843178461274034e-02   +4.951627913948933e-02   +5.992732374841830e-02   +1.355543809293407e-02   +4.166219978643233e-02; +1.698939498070613e-02   +1.242328695456348e-02   +5.315396222724013e-02   +3.620917118797261e-03   +6.303081653754933e-02   +5.793493977077478e-02   +1.215809437925674e-02   +5.325453157197235e-02   +1.540071706722389e-02   +2.361450443676085e-02   +3.043741444430880e-02   +4.014868352919227e-02; +5.088665523334008e-02   +2.011950023935073e-02   +5.629986628781113e-02   +1.705420192917547e-02   +2.443626677870615e-02   +6.482279296799549e-02   +4.653930934710088e-02   +3.683070518210485e-02   +5.877100833001318e-02   +6.409527501424873e-02   +1.385410369964899e-02   -2.100302529522895e-04; +2.949033060083370e-02   +7.945279563000191e-03   +1.959439877870830e-02   +1.590809982940519e-02   +4.365700638853898e-02   +3.163069905806234e-02   +6.604744217017842e-02   +4.380642789961069e-02   +3.495252089883885e-02   +1.477060975210214e-02   +7.094047002136741e-03   +5.371726404025140e-02; +4.395428408355730e-02   +3.787864024924992e-02   +6.289528959504041e-02   +4.402035056659823e-02   +2.224822968427205e-03   +2.909299380100362e-02   +6.333783927028702e-02   +2.323822963823826e-03   +4.707565175659111e-02   +2.826624725465667e-02   +3.071656491253268e-02   +2.609519018325959e-02];
L2E_Input1_iAMPA_netcon = [+6.098182981478294e-02   +6.438376444904083e-02   +5.942181253817246e-02   +6.370123173716404e-02   +6.722877725831193e-02   +7.353767263227187e-02   +6.528692368892274e-02   +6.177875583921651e-02];
L2I_Input2_iAMPA_netcon = [+6.082937574958473e-02   +6.526355637168478e-02   +6.411196978617496e-02   +6.302282260897141e-02   +5.955936872537860e-02   +6.813130900678856e-02   +6.690077088753375e-02   +5.882426899703464e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
