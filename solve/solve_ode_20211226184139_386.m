function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.877463295433372e-01   -4.116098398428667e-01   +3.282578706538318e-01   +8.658240438930336e-02   -6.582603019280678e-02   +2.418704443262216e-01   +8.052547818186012e-01   +5.169221931486249e-01   +2.327833650776963e-01   +5.574856827274983e-01   +1.788802202977934e-01   +2.626784505643705e-01   -7.008356411302795e-02   -2.312482007376208e-01   -8.722598547878521e-01   +4.589047105299404e-01; +4.172163891408012e-01   +3.601449187734039e-01   -5.035291304752629e-01   +4.957610161078702e-01   +8.958425487707229e-02   +3.195785919933705e-01   +2.895436541618120e-01   +6.288298936860945e-01   +2.851584531460736e-02   +3.513125011153086e-01   +6.258403536187697e-01   -2.530068666843109e-01   -2.499403410763464e-01   +3.018930008178311e-01   +8.904746529307167e-01   +6.248837292223630e-01; +7.386052394780669e-01   +8.879313202082110e-01   +2.454075795751788e-01   -5.095906377192667e-01   -4.540800177152036e-01   +1.714171886219145e-01   -3.810564403160617e-01   -3.053714186471646e-01   -1.667332224537381e-01   +5.459811776216681e-01   -4.347739303051379e-01   -4.586368434901585e-01   +7.681236870917799e-01   +4.163675174908360e-01   -6.076141201508466e-01   +5.675590335667808e-01; -3.972955755594049e-01   +5.699705571684852e-01   +4.093529423803490e-01   -6.727681356635460e-01   +2.285475467348745e-01   +7.305366191224542e-02   -5.160163244630445e-01   -4.735961874720611e-01   +2.535883756075734e-01   -8.695584026679128e-02   +4.420682148744006e-01   +3.722384500321684e-01   +6.099239918746843e-01   +2.557070426080363e-01   +7.646161578601092e-01   +3.802012773225834e-01; +7.060885977329143e-01   +5.067331366501233e-01   -6.864366096404624e-02   +3.171380851057359e-01   -2.062777510091171e-01   +1.100019297021659e-02   -2.682034865748046e-01   +5.890717423748866e-01   -3.563467658356105e-01   +5.063429653725915e-01   +3.928656284654148e-01   +3.660039730731819e-01   -3.101479611303077e-01   -1.206711334877708e-01   +8.591623852345677e-01   +1.814532532462813e-01; +4.287178509124111e-01   -1.728059460688553e-01   -1.935922055087742e-02   +5.150162026976925e-01   -2.227552057920638e-01   +6.217842624775701e-01   +3.040152348130370e-01   +2.542315163404977e-01   -2.992378243366174e-01   +3.720298678217250e-01   -4.781276832882216e-02   +5.985322859391710e-01   -3.383889914728505e-01   -7.370155550008504e-01   +4.818300131175780e-01   +5.933796671243334e-01; -3.431661441911119e-01   -4.781000136167195e-01   +6.561450433077567e-01   -6.064545243426278e-01   -2.423636711704234e-01   -6.110619225139098e-01   -3.979247237719700e-01   +5.348252711485371e-01   +2.197373867665847e-01   +5.730919832383367e-01   +5.862278858611905e-01   +1.933966104857446e-01   -4.764468476321428e-01   -5.130330314800027e-02   +1.330586407418577e-01   -8.680232177935501e-01; -5.680400337397873e-01   -1.591922321264434e-01   +5.293240284119046e-01   +4.459752940792648e-01   +1.037440189959418e-01   +2.731262095067973e-02   +2.926857328176098e-01   +3.163108546375725e-01   +4.760212101900848e-01   -6.986442099124247e-01   +9.859451256419881e-01   +2.099072368092738e-01   +4.451384646215827e-01   -6.881469118041004e-01   -3.155740795444599e-01   +5.730121969561739e-02; +5.062716197798637e-01   -6.282435243386632e-01   -5.616843064969884e-01   +3.453784772445571e-01   +8.091155013193155e-01   -7.112115559495933e-01   -2.649935950965318e-01   -5.414166692045154e-01   -5.807455112271462e-01   +1.000000000000000e+00   -1.291856687205008e-01   -4.163598986093772e-01   +2.573677920400335e-01   +5.273430016713121e-01   -5.902686669929944e-01   +3.622416181463448e-02; -9.180066091793543e-02   +7.353446225332588e-01   +2.148028025748207e-01   -3.108916121972088e-01   -2.688522526466209e-01   -1.684882265498657e-02   -4.266684021877012e-01   -4.548779991171314e-01   +2.014744428370185e-01   -8.327614527314254e-01   +4.577019170199023e-02   -1.318277102118481e-01   -4.270315199274388e-01   -2.312864321551788e-01   -1.451992251666059e-01   -7.778245459398675e-01; -4.202145960314235e-02   +9.577769857481931e-01   -7.667946524710452e-01   -5.370395450495328e-01   -2.190591605219257e-01   -5.407597073314743e-01   -7.699492341032652e-01   -6.811494082570396e-01   +4.754245887650944e-01   -7.812085656164900e-01   +7.017241991224560e-02   +4.643740106441025e-01   +2.102869307828862e-01   -4.619112885333526e-01   +7.646772036538134e-01   -2.930168847486553e-01; +4.205846280018290e-02   +6.015006362295748e-01   -6.109415245356349e-01   -4.258933558354855e-01   +4.304494410143542e-01   +8.885746499900177e-01   +2.358395117593279e-02   -8.947829480098062e-01   +5.862662968937916e-01   -7.255978015503065e-01   +2.943613735289407e-02   +2.105015951324659e-02   -2.950963821333936e-01   +9.212556348795058e-01   -1.937914519260624e-03   +1.749294559797731e-01; +2.523332549190467e-01   -7.372073260408696e-01   +7.612619176998706e-02   +1.065366400918161e-01   +2.143345818579926e-01   -8.127132813030301e-01   +4.048742940520860e-01   +1.019287625986964e-01   +3.090773639494042e-01   +3.506962667803991e-01   -1.768442350211415e-01   -2.567470128368523e-01   -7.953895964936069e-01   +8.991083913866658e-02   +4.318312544288738e-01   +5.790210549999470e-01; -6.599529010961803e-01   +8.238276491816365e-01   +6.786127092068175e-02   -6.609663639626996e-01   +8.983565613830257e-01   -7.584974854823076e-01   -3.063722819188475e-01   +6.907556403200962e-01   -4.035896077498116e-01   -4.278933939186094e-02   +1.555817329292174e-01   -4.697643305307221e-01   +9.061180805191206e-01   -7.114886654972051e-01   -6.246781651956953e-01   +1.409837442969752e-01; +3.601236383545921e-02   -8.182944043524826e-02   -6.415026237895447e-01   -2.343823307364597e-01   +5.576244673270444e-01   +6.275124675863025e-01   -2.222844857094025e-01   -3.419290784492089e-01   +6.959283151141304e-01   +8.746958089745800e-01   +5.255858432279286e-01   +1.115350883546936e-01   -4.344852706395857e-01   +7.157693867963969e-01   -5.474273567595100e-01   +7.028919262139233e-01; +8.351976714105244e-01   +5.542326429572082e-01   +9.540880619169283e-01   +6.904325281096643e-02   +3.128556941040760e-01   -5.020515845091092e-01   -3.021336630883887e-01   +8.348685682637641e-02   +5.645796589426113e-01   +4.605142185859910e-01   -5.609425919010179e-01   -6.226038615302466e-01   +8.072441615119123e-01   +2.735286988923826e-01   +1.580329814652853e-01   -3.234154783806342e-01];
L1E_L1I_iGABA_netcon = [-4.774239898146877e-01   +5.960414514608601e-01   +8.654077053439738e-02   +4.888757532385396e-01   +3.742738752508130e-01   +4.907295074033173e-01   -3.004937378873930e-01   -6.800604672950723e-01   +3.546772163508113e-01   -8.020962764845068e-01   +2.470375577554451e-01   +2.736300834725472e-01   +6.568219953010987e-01   -5.685466880274690e-01   -3.700738475542707e-01   +6.167355037875500e-01; -4.790885892383370e-01   -4.086570589958959e-01   +2.240227261936764e-01   -5.229030705806761e-01   -6.698495524551499e-01   +9.241976451666753e-02   +1.495451309266149e-01   -5.103992585291151e-01   -2.989617005195476e-01   +1.395977786609989e-01   -1.363241921146035e-01   -6.667314786207544e-01   -3.445188321440355e-02   +5.345273940049921e-01   -5.865504186765353e-02   -3.242252912419482e-01; -2.710513103726109e-02   -3.850683919996940e-01   -6.229496774097292e-01   +5.919053553382000e-01   -3.911647548084308e-01   -5.389213819930619e-01   -8.457752853723582e-01   -4.140792586787189e-01   -6.320712794229090e-02   -4.376974881708139e-01   -3.001187921665423e-01   -5.210650992071815e-01   -8.493323965607580e-01   +8.390631219794334e-02   +1.140964968135550e-01   +9.564985007119112e-01; -7.549110806745462e-01   +6.383448211909717e-01   -1.362193619232491e-01   -2.752591871999331e-01   +1.628771494473069e-01   -2.864496287193207e-01   -2.008102821173962e-02   -5.574467522564385e-01   -4.694637066092076e-01   -7.627892117941523e-01   +5.357605001482030e-02   -4.806340315516747e-01   -5.060637010365748e-01   +5.430326426643923e-01   -1.469302491751320e-02   +4.530761478755855e-01; +4.645673043076917e-02   -9.613924022175117e-02   -2.963698181370541e-01   -4.659042816674420e-01   +6.634225031911083e-01   -5.634788964345103e-01   -1.359940249027192e-01   -3.955819184780978e-01   -4.466386357222814e-01   -2.868631355778012e-01   +5.558373006569792e-01   -3.659640395464598e-01   +1.828147311213317e-01   +2.875706342219552e-01   +5.876820459683089e-02   -4.736006556776532e-01; -2.870041782987386e-01   -5.178244606849552e-01   +4.941669969646210e-01   +1.933704863853208e-01   +3.811904698381632e-01   -1.417716575349003e-01   +4.599152476559167e-01   +3.041632135529891e-01   +6.738132577128985e-01   -1.561683948236125e-01   -6.139716932870841e-01   -4.343837593627033e-01   +1.212234749622980e-03   +6.042360465162300e-01   +3.341227347558959e-01   +1.371858430288043e-02; -7.257206063829723e-01   +6.984089605069561e-01   +3.597991237755762e-01   -4.022874509954027e-01   +6.208201766680087e-01   +1.470166642428423e-01   +1.473729355118180e-01   +5.791448798108386e-01   +6.304792009889183e-01   +6.804759730837181e-01   -3.018348936422384e-02   -4.180761506609399e-01   +3.370102317952550e-01   -1.472374092040296e-01   +1.720272463979065e-03   +5.020142513845341e-01; +6.385281015470271e-01   +6.882732910713861e-01   +6.262312228210383e-01   -5.408572318601838e-01   +5.333905616580532e-01   +3.932650529423506e-02   +1.026492533946098e-01   -2.533335032253416e-01   -7.823413117679015e-02   +6.307284024443275e-01   -4.915923115696959e-01   -5.575231183717055e-02   +2.906559319729558e-01   -1.569741418590145e-01   -5.434036455644740e-02   +8.808023587410897e-01; +6.226438458127679e-01   -3.038316998625768e-01   -6.253751449361810e-01   -9.506929976171892e-02   +3.406451206313636e-01   -3.235501150831367e-01   -3.628163562759530e-01   +1.828720419276127e-01   -3.625957555233474e-01   +2.415086821074425e-01   +6.526229825305458e-01   -2.920546950687949e-01   +4.012620876441923e-02   +8.667277049548199e-01   +3.278888543747244e-01   +4.931324880184792e-01; -4.214205427307576e-01   +1.979495903310059e-03   +4.446774483652400e-01   -7.682041369597478e-01   +1.067842154204661e-01   +5.018696637798981e-01   +4.108601501491409e-01   +4.576195513733270e-02   -4.355061880971180e-01   +5.300128427610636e-01   +5.468808650961230e-01   -3.711750520117583e-01   -5.089194947833864e-01   +1.295243976154609e-01   -1.106730016951349e-01   -1.197430406062363e-01; +9.110395234387515e-01   +6.986314007716871e-01   -5.120654164590981e-01   -2.220464892772554e-01   -1.899941915843720e-01   -2.570720792182908e-01   +6.024493607153002e-01   -5.774243606331058e-01   +1.846297443259398e-01   -3.558073610941094e-01   +1.428692744195119e-01   -6.791271479332353e-01   -5.038452683638714e-01   +5.632056388152554e-01   +2.756297829261805e-01   +4.923569363281042e-02; +5.912500940685741e-01   +1.291284817266501e-01   -4.171575748798037e-02   +2.989694455851015e-01   +7.769630277022762e-01   +3.625658437736394e-01   +1.393712036204079e-01   +1.361368561998086e-02   -4.707837179424679e-01   +4.059335790030867e-01   -7.019654362518455e-01   +4.444736845753666e-01   +6.654215561162852e-01   -2.227076460875070e-01   -7.464704517656537e-03   +4.121983610145175e-01; +6.997943578105244e-02   +6.391006372869085e-01   -4.963994680751780e-01   -3.154148461438797e-01   +4.059721790731852e-01   +9.261238429123054e-01   +6.629149350510055e-01   +5.887003858149689e-01   +7.234980751503386e-01   +4.020964694220960e-01   -6.400060884828569e-01   +4.861952574272586e-01   +5.951656440205511e-01   -3.090338664461420e-01   -1.420148649075821e-02   -7.197782208778880e-01; -8.110712640415327e-01   -6.121380074931706e-01   +5.656271022634278e-01   -5.650179606271362e-01   -3.954648824365615e-01   +5.389958110166119e-01   +6.836675540992276e-01   -2.631598965493201e-01   -6.874656634105799e-01   -6.522861703981357e-01   -1.975084793218748e-01   -8.881335328561997e-01   +7.203002317057210e-01   -6.163618562902805e-01   +5.324776097715932e-01   +2.831592258202164e-01; +1.602197614471197e-01   -9.778526644838964e-03   -2.953523652349574e-01   -3.341062559071421e-02   +2.502890185054388e-01   -7.384981280291307e-01   -4.088429744063004e-01   +4.811228697786312e-01   +5.184987297236152e-01   -4.980397038569364e-01   -1.106114227086507e-01   -1.174820654654674e-01   -2.114731146334960e-01   +7.320011500031368e-02   -4.773480184633110e-01   -7.743342088491254e-01; +3.801810750825688e-01   +4.950642847591022e-01   -4.538928090916083e-01   +2.222041410275543e-01   +1.050416269222713e-01   -1.000000000000000e+00   -2.415611050907167e-01   -1.649785575637648e-01   +6.044487744912211e-01   -7.501896558826976e-01   -7.596183092503923e-01   +1.432310302271800e-01   +1.160768772592350e-01   -4.613120669064748e-02   -5.125720014234150e-02   +3.747445263684528e-01];
L2I_L1I_iGABA_netcon = [-3.655813965981336e-02   +7.059077621433426e-01   +6.353123937785035e-01   +6.127963345712480e-01   +1.607024930439319e-01   -6.192893676183837e-01   +1.623860907176600e-02   +8.268305919068586e-01; +5.545037801495214e-01   +2.846259932964932e-01   +4.956096621710331e-01   +2.331445738799217e-01   +7.084856724166324e-01   +3.583868302107973e-01   -3.585479769433259e-02   -1.984427149074724e-01; -1.302360104234663e-02   +1.047109721570607e-01   +2.221293661416671e-01   +5.443951537309781e-02   +3.279482334511041e-01   -2.590796850950682e-01   +5.536542860801167e-01   +1.178251618925651e-02; +3.335415715843733e-01   +1.917745048795037e-01   -5.652891383563975e-01   +5.544167540256052e-01   -1.193609508000395e-01   +1.816155343374782e-01   -6.971550693472187e-01   -2.990157131191860e-01; +7.659116177983269e-02   -1.797804505722914e-01   -3.717670013116164e-01   +1.022543084116472e-01   -1.000000000000000e+00   -3.130892169442220e-01   -1.965909280148434e-01   -2.533218094449315e-01; +2.454485887339039e-01   -4.566208504008373e-01   +3.835453859143258e-01   -1.795366693326719e-01   -9.550630720885465e-03   -5.581800817286341e-02   +3.513797040252675e-01   +2.203200047041121e-01; +7.807059324986872e-02   -1.361204653868821e-01   -2.810180182134933e-01   -5.775414179523077e-01   -1.053850085461015e-01   +3.547686800070156e-01   +1.334765062956617e-01   -3.522874921037600e-01; -5.430866148991798e-01   +4.033652293589100e-01   +1.473910593186540e-01   -4.859871706587293e-01   -2.961990132605309e-01   +1.937044917832298e-01   -5.934417762744965e-01   -2.659133512101453e-01; -1.030524525003520e-01   -5.822108590806172e-01   +1.170959091977193e-01   +6.975952897087565e-01   -6.813249784266973e-01   -3.430390308474189e-01   +1.357926954350837e-01   +2.129335318754336e-01; -7.277063440258735e-01   +1.243044003290688e-01   -4.319286885593387e-01   -3.284084569736681e-01   +2.432750544062316e-01   +2.318380400324282e-01   +2.404694891715443e-01   +6.266189725487979e-01; +2.713604419055463e-01   -4.831479111575745e-01   -4.207825444872935e-01   +2.987603348924524e-01   +7.195066127941290e-01   -3.745199688865987e-01   -4.152168914917436e-01   +5.658359156357767e-01; -2.785884077666695e-01   -8.166660814997106e-01   -5.617205979260337e-01   +2.465066627307063e-01   +6.957836663370021e-01   -2.636283216797036e-01   +7.856448549648516e-02   -1.883677807705910e-01; -8.201118477072115e-02   -5.650362913642488e-01   -5.503836439623775e-01   -5.042920649094307e-01   -7.448287704961984e-02   +1.708890679704598e-01   -7.992351346325189e-01   +5.638666576118408e-01; -3.489778438114611e-01   -1.895580850131861e-01   +6.763731570387143e-01   -1.563478726219685e-01   +1.650057750714382e-01   -7.194487294539701e-01   +1.786706011366848e-01   +2.575481051707073e-01; -3.799439355878927e-02   -1.990850983083921e-01   +5.921034149834175e-01   +4.896374577422010e-01   -3.835852648337107e-01   +2.675043106928766e-02   +5.080047939536212e-01   +3.951974125412701e-01; -3.043091398819130e-02   -2.867798291665202e-01   -4.131033097690854e-01   -5.190417586637280e-02   -3.925879643926671e-01   +5.625983837361106e-01   +1.182584192897015e-01   -4.565369107703358e-02];
L1I_L2I_iGABA_netcon = [+5.999783212397406e-01   +2.417146481485868e-01   -6.682503137625889e-02   +3.508267110399336e-01   -1.488787108576936e-01   +4.670167724956127e-01   -1.525570727759993e-01   +3.047752472746527e-01   -3.216636063314095e-02   -5.320478860054560e-01   -8.668437773523018e-01   -4.669362704389353e-01   -7.629952046864416e-01   +2.827702978354922e-01   +4.093838053868237e-01   -3.628471890628575e-01; -8.162698254125352e-01   +4.672715580112942e-01   -6.373239238298761e-01   -3.588046270443827e-01   +5.792120919745664e-01   +5.169023354042737e-01   +4.208260626535089e-01   +2.916524701784075e-01   -1.799780286095045e-01   -4.548517412860851e-01   +7.512835582953276e-02   +5.213628526147419e-01   -1.305259046981176e-01   +3.036418867794437e-01   +8.391816558543915e-01   +4.686890113561095e-01; -1.777202532960895e-01   +2.791049577978119e-01   -3.582895613509496e-01   +7.041849566398151e-01   +3.102140903840139e-01   -3.610984293568839e-01   -7.566887101746445e-01   +4.969020829483301e-01   -4.226978170736252e-01   -4.979057998046476e-01   -7.421434595740584e-01   -5.808407264026144e-01   -5.365012847528240e-01   -2.987203671864234e-01   -4.723711503040221e-01   -6.716933047113045e-02; -7.864078018135838e-02   +7.655505655099991e-01   -2.003388774387446e-01   -2.375904621816047e-01   +1.880264626182386e-02   -7.583015228501830e-01   -6.127819238650819e-01   +6.453651347028856e-01   -1.552459972412163e-01   -3.494199018811625e-01   +5.175222896286793e-01   +7.211134755389866e-02   +2.398405959843455e-01   -6.515836362567576e-01   -4.988824907987213e-01   +7.308256662967801e-01; -6.585501613888093e-01   +6.766418287042706e-01   +6.208662895284430e-01   +4.499551198645805e-01   +3.183389609932231e-01   -2.994395568078516e-01   -4.115457841452005e-01   -3.274894798156351e-01   +8.001190012521556e-01   -5.853259249214378e-01   -4.753468868977382e-01   +7.774266071694214e-02   +5.665213109982074e-01   -5.200202789315113e-01   -2.290140018932091e-01   +8.495320567761305e-02; +5.674171280684518e-01   +4.309085911062994e-01   +8.798483900850648e-01   +2.777248433983875e-01   -2.499510525641896e-01   -6.576231291800290e-01   +2.092255194800646e-01   +1.545548013337923e-01   -4.906646208871715e-01   -3.147493934228479e-01   -6.475138368364183e-02   +6.125042405782072e-01   +4.556368859283987e-01   -7.990538208460105e-01   -2.613928260198132e-02   -5.037354365323559e-01; +5.392275542186898e-01   -2.328933743778414e-02   +7.076208785448909e-01   -1.642989824384885e-01   -1.915540060747238e-01   +7.605768652345038e-03   +3.536137113472527e-01   +7.591140218107916e-01   +4.437217469998935e-01   +6.054060380187495e-01   +1.921197834907272e-01   -4.490725449264273e-01   +1.647236684667833e-01   -1.813299545243275e-01   -7.640709115627139e-01   -3.932912931779456e-01; -5.163459386355340e-01   +3.958743412016927e-01   -1.000000000000000e+00   -3.190809659182593e-01   -4.203239371840747e-01   -5.800661536521352e-01   -2.200510688687662e-01   -9.071707736829648e-01   -5.641869848664619e-01   -5.241380401412172e-01   -2.546571801390279e-01   -1.348813393246119e-01   +5.508860200795461e-01   +3.661217274532581e-01   +8.499680950051408e-02   -6.131535438814458e-01];
L2E_L1E_iAMPA_netcon = [+2.212345047094004e-01   -5.374350091135576e-01   -5.196855957934484e-01   +3.327262869827126e-01   +1.865859064875495e-01   +4.648093145995513e-01   +4.434997279493669e-01   +3.300781617040918e-01; +3.274116731821829e-01   +6.303261966835947e-01   -4.838727848834036e-01   -1.085083908417250e-01   +4.788685463192719e-01   +1.995652670178538e-01   +4.536766029220994e-01   -7.806146790097350e-01; +4.178749787978335e-02   -4.615032314012091e-01   -6.764958345243223e-02   -4.848697717220435e-01   +4.850451444280637e-01   -1.000000000000000e+00   +2.960532373809150e-01   -6.253292868899988e-01; -4.888783896948398e-01   +8.562245641755839e-01   +9.205559060271050e-02   +7.775033745004837e-01   +2.886257307827657e-01   -6.608073957439096e-01   +5.122061825548264e-02   -1.528678982751489e-01; -5.955082410008847e-02   -2.743701472805610e-01   +4.329380434470619e-01   -8.387504959182976e-01   -2.306751334770389e-01   -8.395772448107346e-03   -2.825944007177034e-01   -8.483794491361351e-01; +6.711286398149846e-02   -3.509093789604231e-01   -6.054721124273235e-01   -4.099613584695964e-01   -7.966936817167296e-02   +1.520167381611038e-02   -5.753362920391185e-01   +2.418321958389357e-01; -3.950437788793260e-01   +1.002950661201584e-01   +3.805313696259569e-02   -7.507521899437190e-01   +5.656416876318797e-02   +5.103188005980778e-01   +9.029110415178626e-01   -8.686332820491885e-02; -5.272947766382650e-02   -2.534423588673174e-01   -8.930604829604746e-01   -5.588376186692567e-01   -2.498916162011120e-02   +5.397481893053363e-01   +2.527352982210396e-01   -2.061062488843372e-01; -6.871519749058460e-01   +7.648184748503952e-01   -4.177160344495927e-01   -1.210635476002831e-01   +5.461944814954074e-01   -3.558814620987913e-01   -5.115221788059320e-01   +1.071958410460865e-01; -4.509420532302817e-02   +1.801405653858397e-01   +2.635441060092648e-01   -1.947226062106642e-02   +3.532930304936058e-01   +2.841918314588445e-01   -1.326599920046420e-01   -2.082854958488649e-01; +7.320212270213217e-03   +3.910555976504421e-01   -8.666124132071017e-01   +5.856143578010530e-01   +1.455314784747448e-01   -2.012120115813499e-01   -4.126518751294728e-01   -7.782667707981058e-01; +7.426635583273601e-01   +3.244420120427592e-01   +1.683207436717389e-01   -3.053392119638777e-01   -1.955838117622277e-01   +7.026312265192703e-01   +2.795450110769143e-01   +3.598216397722270e-01; -4.328888320463676e-01   +1.943471280457805e-01   -6.732019018020758e-01   -4.992907880550525e-01   -4.854143507040448e-01   +4.867231395148099e-01   +3.983822922224302e-01   +8.919001284470545e-01; +4.489590497000295e-01   -1.413727704953314e-02   +4.161089072249365e-01   +4.939068965779406e-01   +2.688373271300166e-02   +2.241862037132553e-01   +5.423713815296292e-01   +3.793396270439824e-01; +1.254612646758437e-01   +2.502195527533800e-01   -6.413741929734931e-01   -1.011423509956565e-01   -3.587077569912416e-03   +4.412924163866375e-01   -1.844549700113655e-01   -9.880099321238561e-02; -5.646050747778152e-01   +3.218592053259808e-01   +8.975739610956185e-02   -9.936402741462698e-02   -5.062301123955813e-02   -9.580271802234025e-01   -2.661788364642583e-01   +4.320098084815769e-01];
L1E_L2E_iAMPA_netcon = [+3.359922640287399e-01   -1.000000000000000e+00   -6.482356240872987e-01   -4.819522015290556e-01   +3.339692471477180e-01   -7.527082699345342e-02   +1.017371181299039e-01   -4.232048184147683e-01   +3.117620897689026e-01   -2.691640217953405e-01   +6.573860597377382e-02   +7.241804566857887e-01   -5.169259123403805e-01   -7.758159026527171e-02   +2.305793626167584e-01   +2.521328006382319e-01; +4.140736177237013e-01   +8.400184645035552e-02   -2.615127408563544e-01   +5.272160354011137e-01   -4.986898544757896e-01   -3.129811894754463e-01   +9.264214964745340e-01   -6.665662100131990e-03   -9.413261040268388e-01   -4.830593348481862e-01   +2.419104794456376e-01   -2.111101064719674e-01   -6.029189837534780e-01   +1.472716458608143e-01   +7.539528565228752e-01   +5.445809357058579e-02; +2.050186536452081e-01   -1.617335754151013e-01   +7.360706169498391e-01   +1.493786691461040e-01   -5.191294119590701e-01   +3.529316687295124e-01   +5.018396800263161e-01   -9.307104769105250e-02   +3.583345060853121e-02   -9.690635804312412e-01   -8.959423330589681e-01   -9.661426083541140e-01   -7.861010420662099e-01   -7.367972396911707e-02   +5.942672328485641e-01   -4.799657091942772e-01; +5.904411425238622e-01   -8.145195134570167e-01   +3.966435537810274e-01   -1.925156924787553e-01   -4.669532476671315e-01   -4.185406145809599e-01   +7.011022481137422e-01   -2.683985636096517e-01   -4.515567024579515e-01   +8.339616301669645e-03   +7.352364449697048e-02   -3.295954634310229e-01   -2.545399394210148e-01   -7.844120483248227e-01   -4.059294459380876e-01   -2.984177811243317e-01; +4.282374878127812e-01   +9.555510414375721e-03   -4.908559917945268e-02   -9.088950345747275e-02   +2.514395272351761e-01   +7.292397977527298e-01   -8.998939791958125e-01   +2.264418287381464e-01   +6.319175417378941e-01   -9.736483175684117e-02   +1.609952435561421e-01   -4.272408841913565e-01   +9.197516839757750e-01   -5.999468479074321e-01   +3.329209320539029e-01   +3.922833649902714e-01; +2.970158467406994e-01   -5.595698787987714e-01   -5.241826654831510e-01   -5.596335244073278e-01   -2.416304248201631e-01   +3.713699710383460e-01   +3.459366170417584e-01   -7.110705255327858e-01   -6.010193434380992e-01   -7.385324669486334e-01   +1.845444907910331e-01   -5.288324108820581e-01   +3.165247972832551e-01   -2.251740557384740e-01   +1.614383366900290e-01   +7.426817593464377e-02; -2.342401930117163e-01   +9.544319241714135e-01   -6.741778140786781e-01   -8.056382376380182e-01   -6.890984402479122e-02   -9.040405002373660e-01   +1.216882165718924e-01   +5.729838548456928e-01   -5.282310695497940e-01   +3.926447581590348e-01   -7.577434182315693e-01   -3.090402397239916e-01   +9.556829947952887e-01   +1.572477933723019e-01   +1.346650817899647e-01   -4.139204368817537e-01; -8.541196962588404e-01   -7.157699845839229e-01   -8.423285286950914e-01   -3.568749380013447e-01   -9.084649389760285e-02   +4.364018218714911e-01   -1.581224806600347e-03   -5.180062729381132e-01   +8.603161088787297e-01   -2.176932072399810e-02   +8.324499240295452e-01   -5.034876258768101e-01   -2.753933123301739e-01   -4.581445856523223e-01   +1.615904099556705e-01   -3.732366805438314e-01];
L2I_L2E_iAMPA_netcon = [-4.050524243959953e-01   -1.219391980154733e-01   -3.374045504261610e-01   -4.640725682466569e-01   +7.986794524168986e-02   +2.517054491606673e-01   -5.284076578252925e-02   -3.087507008726115e-01; -4.441837692206856e-01   -4.684804178885127e-01   +1.483962932977553e-01   -1.722950586659220e-02   +2.667263845899577e-01   +1.840184641936637e-01   -3.173925904550897e-01   -8.472681306717915e-01; -3.458106610081208e-01   -8.295393801598643e-01   -4.007809128178272e-01   -1.965862698257029e-01   +2.700537798667612e-01   -1.311464864125068e-01   +1.224278405555662e-01   +1.921850751997638e-01; -4.367778956476812e-02   -2.392458427303744e-01   +3.577410082243214e-01   -2.921498493539933e-01   +7.756438127293064e-01   +2.316833157887600e-01   +3.191871515853708e-01   +9.189803940203326e-01; -4.810127840633555e-02   +5.159604031870705e-01   +3.197339419628925e-01   -1.874894352239666e-01   +8.611148366159399e-01   +1.438424665047977e-01   -1.395443875115149e-01   -2.531934904109243e-01; -2.760959776243679e-01   +6.503542454907902e-01   -8.395027048871528e-01   +5.000697848204981e-01   +8.867602393136090e-03   -3.131118815205251e-01   +6.538353651594093e-01   -5.586148798638099e-01; -7.279086410188157e-01   -5.164796048508143e-01   -3.096136496231607e-01   +5.973752313712075e-01   +1.000000000000000e+00   -1.831827986824286e-01   -5.095082855654014e-01   +2.162776159360011e-01; -2.702942660775146e-01   +7.275426356567068e-03   +7.272823779170913e-01   +1.871799629412466e-01   -3.836687634985079e-01   +6.267450925661405e-01   -5.378959360225840e-01   +3.345544235041620e-02];
L2E_L2I_iGABA_netcon = [+4.956037394284931e-01   -7.031158932294408e-01   +2.801811132669044e-02   +4.410444711490417e-01   +7.228202720604270e-01   -3.270818297602823e-01   +6.313337231882060e-01   +6.654718662712336e-01; +1.355357021040265e-01   -5.651716956274847e-01   +2.367218865855948e-01   +3.792898806182606e-02   -6.521178576489459e-02   +8.129499802436063e-02   -3.406515112306790e-01   +5.796260599065343e-02; +8.740450897915869e-01   +6.447232265832525e-01   -7.849165956000813e-01   +4.866348156268909e-01   +8.265089042028425e-01   -5.963499048842257e-01   +7.980302178724838e-01   -3.670129999160113e-01; -9.182945497608808e-02   +4.685653541138369e-01   +1.000000000000000e+00   +3.228908916742465e-01   -4.095453438316309e-01   +3.659733554156165e-01   +6.002847584208720e-01   +2.077851609944081e-01; +1.730406158344230e-01   -2.426985374401782e-02   +5.723703861819154e-01   -2.699514655653245e-01   -1.363667772956341e-01   -5.081736667557382e-01   +9.176645217844508e-01   -4.561849878412796e-01; -4.924880322557864e-01   -8.159910113511721e-01   +7.281193570291469e-01   -2.261124918055447e-02   -6.544958693330255e-01   -2.898460785814275e-02   +1.148557778458457e-02   +2.150969374953027e-01; -5.803528237127538e-01   +2.501102656731403e-01   -8.776029254903611e-01   +5.826267357599345e-01   +6.957150821346971e-01   -5.661853118669120e-02   +4.670615259570873e-01   +7.008124916479939e-01; +1.776791884739036e-01   +4.179514275763116e-01   +5.697434189941128e-01   +3.107476410243998e-01   +4.811556095157314e-01   +4.522911016174400e-01   -5.872899095554958e-01   -2.629245241135265e-01];
L3E_L2E_iAMPA_netcon = [-4.237793177735636e-02   +3.399472435253496e-01   +4.612271725613208e-01   +5.166484234816713e-01   +8.815915554576096e-01   -2.070719803794154e-01   -3.699211870069417e-01   -1.345036484022054e-01   +2.099757107773444e-02   +4.336514272253661e-01   -2.815318100002620e-01   -7.052855618075426e-01; +6.477997114813679e-01   -2.687678176301532e-01   -1.253362243182018e-01   -3.205224345464501e-01   +3.237584522708497e-01   +2.377764071708304e-01   +5.194966648729564e-02   -3.257124808185498e-01   -8.092020589406672e-02   -3.774903455541279e-01   -2.855088421075396e-01   -3.257135745921892e-01; -5.582722467411663e-01   -6.080691733862046e-01   +3.796742691173428e-01   +7.003239792668694e-01   -7.148914185794442e-02   +7.647898155146722e-01   -4.757327729066169e-01   +8.236557918669232e-01   +4.506173436662521e-01   +7.055305135321502e-02   -7.998300853838386e-01   -2.170212087242877e-02; +1.195510673208835e-01   -3.327797305737761e-01   -3.225810540290303e-01   +6.853665534776634e-01   -3.067262531120166e-01   -8.442682844118586e-02   -3.124028784650655e-01   -3.216821701665616e-01   +7.356022409138736e-02   -1.647852853999444e-02   +6.229090794500969e-02   -8.894456044165984e-01; -5.184538499395427e-01   +6.342569645990062e-01   +6.005346348886668e-01   -6.618116942672415e-01   -4.872924434861381e-01   -5.850180627952474e-01   -5.270367033265001e-01   -6.132069983860901e-01   -2.852980827417706e-01   -1.360875506580916e-01   +4.526688670710825e-01   -5.247892284499911e-01; -5.227845823610838e-01   -6.031078230067581e-01   -4.610928405963513e-01   +8.449314321286103e-01   -8.657563075692211e-01   +5.668387859874618e-02   -4.182919383593591e-01   -4.033516319395093e-02   -8.576464934600609e-01   +4.495348862095008e-01   -4.883652768453793e-01   -3.496389247326231e-01; +5.416043832866383e-01   -4.611532552906007e-01   +3.699643436851818e-01   -9.240591389971189e-01   -2.800129115297109e-01   +2.829417424843779e-01   +3.636344335973246e-01   -6.116863427618821e-01   +2.549974758552881e-01   -8.577479023930141e-01   +6.462222122623802e-01   -4.288691702589817e-01; +1.137034118213994e-01   -1.181881127562122e-01   -7.672171509284146e-01   -4.455935785508854e-01   -4.212653631863390e-02   +4.547086057527184e-01   +5.122046326168835e-01   +5.691838570409274e-01   -2.753560309158981e-01   +1.000000000000000e+00   +4.050736564206546e-01   -4.251018147181304e-01];
L3I_L2I_iGABA_netcon = [+6.139756905069860e-01   +6.929654901919208e-01   -2.342262726379511e-01   +9.198051001997569e-01   -9.970766841547384e-02   +5.140804112251545e-01   +8.501516351860585e-01   +4.759000734882673e-01   -2.387398512545060e-01   +4.709891534313096e-02   -8.040274025660288e-02   -1.013565831810087e-01; -2.163662875862263e-01   -8.475675121800432e-01   +7.987620712824579e-01   +9.375886344418990e-01   -4.844929903722797e-01   +7.510498878024252e-01   -5.579204125111320e-01   +2.252616501145414e-01   -3.382946752444193e-01   +3.095651133397475e-01   -3.632389680951647e-02   +2.791480048389108e-01; -8.168080663908248e-01   -9.742211756414308e-02   -8.176169982609022e-02   +7.892247128796643e-01   +7.113044993818120e-02   -1.532345199042236e-01   +5.082792571270731e-01   +3.457087493004951e-01   -1.000000000000000e+00   +7.937969395552528e-01   +3.537928605063732e-01   +6.799482762904693e-01; -9.720970426425258e-01   +7.361444172151688e-01   +4.220658830703522e-01   +6.797653512019176e-01   +1.302048509317037e-01   +9.125620511025809e-01   +4.522725275627045e-01   -6.007509008085329e-02   +3.362596843183922e-01   -7.756956250855783e-01   -1.668495904723522e-01   -6.950073371265034e-01; +5.701077141678654e-01   +3.818803519375276e-01   +6.042854234783882e-01   +4.076214132853729e-01   +7.769574044854163e-01   +5.392923152543987e-01   -5.766951597850005e-01   -6.070121875744112e-01   -7.554291399829495e-01   +6.075350021420786e-01   +2.819390356500931e-01   +1.417369128305349e-01; +7.430761166903160e-01   -5.660051466357663e-01   -2.122561144186307e-01   -6.273070868138052e-01   +6.784278692752210e-01   +9.717492482757606e-02   +5.982917695882836e-01   -4.562248650317732e-01   -6.820772090640730e-01   -5.001492283923387e-01   -4.658531296968270e-01   -8.668388893141149e-02; -5.341593426183232e-01   -5.251669104559065e-01   +3.825439881241089e-01   -6.357265419018013e-01   -6.891448133711543e-01   +8.329082416242223e-01   -6.339549955986951e-01   -8.753676335696842e-01   -3.279605761582045e-01   -7.793779867192001e-01   +4.203300073715391e-01   +8.782400160541236e-01; -3.639188522198590e-01   +2.391957809286044e-01   -5.474626165355541e-01   +7.057203900176904e-01   -2.293042638981963e-01   -6.669451681468636e-01   -7.559945401613222e-01   +3.645368006794560e-01   +3.342685125133489e-01   -3.576129636188015e-01   +9.001644826954692e-01   -8.752134393524122e-01];
L2E_L3E_iAMPA_netcon = [-6.964305078542904e-01   -2.428017097788179e-01   -4.797247850933469e-01   -7.501446041324770e-01   -7.137796593334281e-01   +6.134579805057088e-01   -8.245996543530389e-01   +3.754258110056061e-02; +2.666580630030839e-01   +1.154484419405407e-01   +3.628426224169952e-01   -4.117149263975077e-01   +3.835032279278865e-01   -3.162101891759837e-01   -2.098190108877962e-01   +9.519246438970737e-01; -4.988830711008161e-01   +2.289303517403364e-01   +1.637373461748035e-01   +3.959858251295265e-01   +1.800509999027023e-01   +6.306809026585170e-01   +7.652380642100279e-02   -2.592299175614688e-01; +2.284042666869947e-01   +2.035438475626574e-01   +7.964778589012081e-01   -6.677205903116744e-01   -1.466247258097181e-01   +7.225645818369364e-01   +5.629003622002817e-01   -1.955919073302465e-01; +4.571144065613483e-01   +9.756640123904547e-02   +4.932805555013943e-01   -2.025632777399031e-01   -3.733943982802827e-01   -8.464534750508170e-01   +1.000000000000000e+00   +5.175010449918683e-01; -6.586016874846488e-01   +2.915983194183005e-01   +1.932952859921006e-01   -4.380097667816785e-01   +7.624569810222971e-01   -2.936622995631291e-01   -2.767758449538577e-01   +5.852776992181256e-01; +4.776872603813213e-02   +6.386024312956774e-01   +8.379818598978940e-02   -7.670417827537362e-01   -5.890635611469320e-01   +2.620102650460734e-01   -1.836930649372540e-02   +9.378376596453120e-01; +6.221409419231384e-01   -3.915373389441001e-01   +3.697370845540577e-01   +8.847080839262603e-01   -3.610660060620799e-01   -4.985084552801686e-01   +6.743785249038783e-01   -2.995960886934526e-01; -1.135001376685933e-01   -4.916429680509516e-01   +2.055986033554509e-01   -3.943288252659484e-01   -5.907925090239984e-01   +4.583582145394516e-01   -9.150708143347771e-01   +2.240102001026363e-01; -7.522787653154284e-01   -6.373852049729491e-01   -8.466416175309116e-01   +4.094167126281659e-01   -2.194030586717771e-01   +5.238103147504724e-01   -6.982990634624236e-03   -9.621346840602601e-02; +1.655272232714237e-01   -3.707341726415886e-01   -7.144424113127991e-01   -6.273576658315766e-01   +5.382688469924382e-01   -7.825556701765222e-01   -1.515504610936288e-01   -2.989338586490227e-01; +3.585854616945715e-01   -2.686986500925176e-02   -8.017334450125666e-01   -3.650794143735609e-02   -2.898616059761330e-01   +5.709760194275179e-01   +1.216407578458060e-01   -4.827353211352006e-01];
L2I_L3I_iGABA_netcon = [+2.235818168612448e-01   +1.089941995789645e-02   -4.322527907797069e-01   -6.207644459921603e-01   +8.466115908373523e-01   -7.255937329398174e-01   +6.416453021379129e-01   -6.294883709785083e-01; -2.212359767391299e-01   -1.898855793924625e-02   -5.176958355631550e-01   -6.995310765282200e-01   -5.082884378567805e-01   +1.915630503419699e-02   -1.265829182047292e-01   +1.854493453066705e-02; -3.600664950767427e-01   -7.078377420869221e-01   +1.355765240067744e-01   -4.415037151050727e-01   +4.637995927926280e-01   -1.140668734334270e-01   +3.401566607949740e-01   -6.281519602188089e-01; -3.914295256333970e-02   -6.567100725435625e-01   -1.123665120468678e-01   -5.813238527951757e-01   -4.939035685315033e-01   -5.552013793109020e-01   +2.880555185892783e-02   +8.024653843152824e-01; +8.186579585959363e-01   +2.967575202077840e-01   -2.876476339828156e-01   +1.536417822163084e-01   -2.357810080965822e-01   +4.382352735898397e-01   -1.559803550664983e-01   +7.466034404362613e-01; -6.552362265183471e-01   -5.921110189549726e-01   +4.677268789955709e-01   -1.015782137397445e-01   +4.905661589566281e-01   -5.683979006749851e-02   -4.270737651514741e-01   +6.080086991976067e-01; +1.508513223262175e-01   -6.163414059102431e-01   -3.679369249177744e-01   -6.221733788887635e-01   -4.860053276682291e-01   +3.112665335382518e-01   +8.508564022538205e-02   +8.146994167592424e-01; -2.599402389164419e-01   -5.972110904672305e-01   -4.128872448623324e-02   -5.838919835519452e-01   -4.242190511447440e-02   -3.944717326780565e-02   +4.522442820537533e-01   +4.345962786789488e-01; -4.470272014625970e-01   -6.932960485376529e-01   -5.311680207103678e-01   +4.309902568176389e-01   -1.521005483440615e-02   -4.513286621494400e-02   +5.741145042752118e-01   -7.497729905298973e-01; +7.532457620641148e-01   +4.666923822251288e-01   +9.786011635220825e-02   +4.969923195854205e-01   +7.334648875029294e-01   +4.175534689697451e-01   -4.743110492270202e-01   +6.086570606050598e-01; -2.601731388032929e-03   -6.199365628838664e-03   +5.974996597216462e-01   +4.500825262344919e-01   +2.456312600989793e-01   +3.390552909544851e-01   -5.904274785622531e-01   +9.643914160848120e-02; -6.804910541340798e-01   -6.389119161608381e-01   +4.217130268666734e-01   -1.000000000000000e+00   +5.658033264041465e-01   -5.864554942496760e-01   -8.611767394566029e-01   +4.539042973760047e-01];
L3I_L3E_iAMPA_netcon = [-2.855681718129886e-01   -4.279372423211725e-01   +2.040330802306168e-01   +5.511896971631316e-01   +1.365413016743900e-01   -1.829533637024756e-01   -2.895223648486131e-01   -2.215003956068523e-01   +3.826247938623759e-01   -6.301178557856921e-01   +4.935226951805834e-01   -4.781449958372649e-01; +3.617899290994228e-01   -3.271509657636605e-01   +5.913923009923449e-01   -7.474955670957792e-01   -5.460057165605938e-01   -1.604602735010936e-01   -2.817701703977266e-01   +2.055126143051821e-01   -2.902359920650019e-01   -3.913917348773926e-01   -9.094582149566075e-01   -3.349111755109649e-01; +1.046511310629108e-01   +9.551023489482210e-01   -9.171103622080444e-01   +2.863916247352123e-01   -6.152538587956278e-01   +7.243439349927836e-01   -6.631189024122431e-01   +3.498631232720879e-01   -7.554828249344557e-01   +3.369210909981047e-01   -4.655828964329544e-01   +3.991155412634889e-01; -5.512149404796467e-01   -8.458215052328024e-01   -6.531716770438791e-01   -1.597254701808322e-01   +2.276776595976383e-01   -6.192782105071836e-01   -2.015197852565133e-01   -1.761874266149466e-01   -4.708411573104083e-01   +2.373248810604974e-02   -2.880749528796179e-01   -7.130597320731052e-01; -4.837577111633874e-01   +5.263650722197326e-01   -2.887844383103269e-01   -8.324814962239790e-01   -1.644340842737356e-01   -6.391532803483152e-01   +3.373372788826036e-01   +1.070644603482090e-01   -2.972244456711937e-01   +3.651800538997212e-01   +4.144664469157128e-01   +9.694010168456103e-01; +8.333144821664437e-01   -1.436387164379534e-01   +4.251120771876262e-01   -7.460078374695164e-01   -6.441362035676725e-01   +1.490650918802891e-01   -5.407423486441774e-01   -1.208869319848704e-01   +5.958783219852440e-01   +2.181436023296220e-01   -5.947090652982463e-01   +2.806948903210183e-01; -5.807616450755753e-01   -1.945672490959299e-01   -5.055719289199951e-01   +3.844467069223840e-02   -2.302366980446803e-01   -6.870863760095147e-01   -1.226147299556003e-01   +4.434841940055270e-01   +5.557010201183626e-01   +9.674161753474663e-01   +5.591317694739640e-01   +3.766270760329151e-01; +1.153044269367233e-01   -3.165989405028823e-01   +3.156821572471500e-01   +5.830872547649431e-01   +7.279286718983086e-01   +7.508261543184188e-01   -5.267053220224955e-01   +2.940012258782528e-01   +3.524636456974762e-01   -2.511794472160307e-01   -3.162563849868970e-01   -3.140095434621241e-03; +3.543141458322381e-01   +1.232283704734787e-02   -3.673876442759140e-01   +2.567428530981847e-03   +1.967478973764013e-01   +2.767612323521241e-01   +3.215822992835908e-01   +7.159771414494395e-01   +4.744365920750465e-01   +2.484686434377332e-01   -7.275959952081815e-01   -1.212603187535461e-01; -2.968943223450050e-01   +4.586252356776477e-01   -6.306422111473023e-01   -2.046256263114062e-01   +5.980577793755303e-01   +6.761791700947271e-02   -4.463725700170987e-02   -5.370899114953875e-01   -1.000000000000000e+00   -4.557921430176810e-01   -2.903252782611345e-01   +9.817331280224898e-01; +6.738800594423962e-01   +3.890393865572834e-01   +1.433066547438028e-01   -3.377365132751644e-01   +5.936245333589204e-01   -6.192433689654037e-01   -2.122300059627237e-02   -5.981858723185591e-01   +6.824678866474467e-01   -2.144397713622384e-01   -5.741896369431237e-01   -4.442576600303867e-01; -3.369368982630035e-01   +2.753351572353784e-02   +8.190417519742363e-01   -8.372213289543767e-02   -6.736454925382382e-01   -4.089387700909335e-01   +3.046010060326230e-01   -4.998491458778896e-01   -4.634575709820526e-01   -2.167836961730508e-01   -1.281338191553106e-01   -5.318920310207604e-01];
L3E_L3I_iGABA_netcon = [+5.327970181807157e-01   +3.632641127786506e-01   -5.509739351363717e-01   -7.449498940920437e-01   -7.326449324566483e-01   +7.812089436905896e-01   -1.078961058858547e-01   +1.642519554415155e-01   +3.331279082939724e-01   -1.463363915891077e-01   +1.137716669560295e-01   +4.161267228011092e-01; -6.343137003836468e-01   +7.160625361397399e-03   -7.324114501650528e-01   -6.565870609138225e-01   -4.498587190058856e-01   -9.209050510366916e-05   -3.987904252077069e-01   -9.215326136706419e-01   +8.727976025297882e-02   +4.736097537841071e-01   -3.483849618742562e-01   +9.467980233553929e-01; -5.681937341365995e-02   +3.091534164711550e-01   +4.992020933557731e-01   -8.020287748308967e-01   -6.215122754124072e-01   -1.620108344328360e-01   -5.367242978128314e-01   -9.229403612133870e-01   +5.990944045059536e-01   +3.452079728810994e-02   -9.799352994946041e-02   +5.508430993035476e-02; +7.601598567237847e-01   +6.686759819915037e-01   -4.364578927106885e-01   +6.521429357005042e-02   +6.669622734883587e-01   +2.546918009798976e-01   -1.145993929299587e-02   +9.649099306156477e-01   +8.164336922495341e-01   +2.270209897166151e-01   -6.745897367347986e-01   +9.865931435175149e-01; -2.664694856284364e-02   +9.274464095328139e-02   +1.050592685148471e-01   -1.321761816266032e-01   +1.349694145204148e-01   +4.380251104092552e-01   +1.360034169107328e-01   -2.104718326092143e-01   +7.971575425494580e-01   -3.793090047045806e-01   +4.871778158299980e-01   +8.531762517591425e-01; +1.319650297067947e-01   -2.644984495217773e-01   +4.292335573460305e-01   -6.813873303291422e-01   +3.892775472101473e-01   +2.334900782100647e-01   +3.548416940025309e-01   +8.087304753711260e-01   +6.611725362178730e-01   -5.953966660865112e-02   -2.410941257950341e-01   -1.737458652474891e-01; -7.967711346686837e-01   -4.412813272481286e-01   +8.784996352747725e-01   +5.705803090814699e-01   +2.612090081883948e-01   +3.419893257773873e-01   +1.000000000000000e+00   -4.914060413677113e-01   -1.730198282379798e-01   +3.625074604837896e-01   +7.620301613121832e-01   +8.880016515320588e-01; -2.550315359772019e-01   -3.931295881596959e-01   -8.709970149109113e-01   +2.239107674194816e-01   +4.742387742269568e-01   -3.082695625918119e-01   +3.324759588985161e-01   -4.899670658286019e-01   -3.739175650277295e-01   -3.919236797207317e-01   +5.336270714285760e-01   +5.424564848101507e-01; +5.168797115013932e-01   +6.161118085256558e-01   -5.233931062821056e-01   -5.920158886333590e-01   +2.324197875871288e-01   +7.182729059224657e-02   +6.124941028086193e-03   +1.967835003926623e-02   +7.824901624080147e-01   -7.916819885481654e-01   +7.478075076282340e-01   +4.643164367834822e-01; +5.846150649786909e-01   +3.226773381720690e-01   +7.158224439348576e-01   -4.536617527533899e-01   +1.267366709895893e-01   +8.177988672195966e-01   +4.574427777515598e-01   -5.606907980353639e-01   +6.457912575690020e-01   +1.608930847718803e-01   -9.086150640346966e-02   -4.888100620709645e-01; -7.834177703010506e-01   -2.230313512892064e-01   -2.396561852960818e-01   +7.383489844480156e-01   -3.938406919320805e-01   +2.550959768947091e-01   +3.448976882283266e-01   -5.246806944820582e-01   +4.007993215570308e-01   -8.429853123697785e-02   +8.930562504453785e-01   +5.719645763958319e-01; +1.021872870987820e-01   -6.197752041894422e-01   -7.785656649472095e-01   -5.280761097990679e-02   -6.143971010880185e-02   +7.268238455670334e-01   +1.551110973689081e-01   +3.105379344501195e-01   -7.104675263002200e-01   -7.143696773095530e-01   +5.093423059314962e-01   -4.096354734878402e-01];
L2E_Input1_iAMPA_netcon = [+5.520087081669826e-02   -7.392423342494149e-01   +2.726889324497513e-01   +1.000000000000000e+00   -4.498770627521438e-01   +8.236365121280071e-01   +6.322102386136162e-02   -9.880993116026056e-02];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -5.207251839068853e-01   -7.011892122411052e-01   -6.897997526943306e-01   +7.825244227810043e-01   -8.336176539884181e-02   +9.933095351620298e-01   -2.616519767830312e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
