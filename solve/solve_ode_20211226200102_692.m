function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.657826877205713e-01   -1.165312686153469e-01   -2.757203599793798e-02   +6.502785755673632e-03   +2.581383033802973e-01   +2.367263040586595e-01   -3.001578982559618e-01   -1.343396657403268e-01   -3.249359182500731e-02   -1.501337667792138e-01   -9.523316129451043e-02   -2.633706186681903e-03   +2.733462423303821e-01   -1.798806231581208e-01   -1.395930106289675e-01   +4.083961138424255e-01; +2.968628733960627e-01   +2.271259501459837e-01   +4.052320427000711e-01   +1.113258253490680e-01   -1.593040519817358e-02   -1.502400645040264e-01   +5.316938603861242e-02   +2.912879587402015e-01   -3.501388001983365e-02   +1.177798180129880e-01   +1.112142491338717e-02   -1.289466617240479e-01   -2.986357572334054e-01   +5.894791372282715e-02   +2.060302511033484e-02   +1.740601413840079e-01; +8.023703352694397e-02   -9.650667348243512e-03   +1.142224782598889e-01   -1.834258258659729e-01   +5.201226644237814e-01   +2.152094739830021e-01   +1.844507744516917e-01   +3.662855581434898e-01   +1.893779873410430e-01   +1.532028601272889e-01   -8.804816423991618e-02   +3.873767696515508e-02   -8.249843786906734e-02   +2.789222826321143e-01   +1.141066686510846e-02   +1.159467246941346e-01; +3.726205143401479e-01   +1.572474302020577e-02   -1.583453223113160e-01   +1.986000870318298e-02   +9.848905207343900e-02   -1.047049907784111e-01   +2.103117057189763e-01   -1.363922925672027e-01   +2.816306778434455e-01   +5.072942008646306e-01   +7.526296251916242e-02   +2.165422574205343e-01   -1.159419657149017e-02   -5.832445383130949e-02   +5.080053815188602e-01   +2.617754172044005e-01; -4.618986454487353e-02   +1.799246787509055e-02   -1.229596946961106e-01   -1.356632010777885e-01   -2.094227549239566e-01   +2.524892967194488e-01   -2.288330983055303e-01   +3.232509779766115e-01   +1.916624358373927e-01   +1.059719120665182e-01   +1.798598975629045e-02   +2.204981137795097e-02   +2.994149367910900e-01   +2.930022076281665e-01   +3.911407863500927e-02   -1.309188125982451e-01; +1.893070712406916e-01   -2.956670066152848e-01   +1.350452144507632e-01   +8.985994217196708e-02   -1.202762837819430e-01   +8.964330310650462e-02   +5.673516243469248e-03   +2.741892920249587e-01   -2.777609936213924e-01   -1.803907879204522e-01   -1.930657181424601e-01   -6.843557040267087e-02   -2.042946260546611e-01   -7.166497963171266e-02   +2.594361234272440e-01   -2.036848840366056e-01; -8.405651346033388e-02   +3.916810981709108e-02   +2.329052538106899e-01   -1.948435043406934e-01   -3.182840402268541e-01   -1.440979279861407e-02   +1.114852940396112e-01   -4.979135833523930e-02   -1.746140133280512e-01   +2.796896871674193e-01   +6.742390500918538e-02   +3.320101563582332e-01   -1.443061980638642e-03   +1.746691272064804e-02   +2.839832752348189e-01   -3.945140537302005e-02; -1.161580651112209e-01   -3.027057968152779e-01   +1.781833778582573e-01   -8.142281488673402e-02   -5.427519007540067e-02   -2.347595112362988e-02   +9.729761787732416e-02   +2.577504101934713e-01   -3.262699357180109e-02   +3.053171511566654e-01   -1.894662187600896e-01   -7.638077035612340e-03   -7.362948164223443e-02   +3.131582860307486e-03   +1.033412562949756e-01   +1.337688750881530e-01; +3.766716734769543e-01   +2.544913349412438e-01   +3.785621080171166e-02   +2.236863213589748e-01   -1.556687323982505e-01   +3.953786436856419e-02   +3.792968264691658e-01   +3.927360887495884e-03   -1.273710815251793e-01   +1.870650993585458e-01   +1.614668234364450e-01   +1.134209321213847e-02   -1.234257932730679e-02   +2.749111672651588e-01   -1.093808723328327e-02   -1.626291318137329e-01; +3.678300192200184e-01   +6.330333345055728e-02   -3.126191159709812e-02   +5.719849996946421e-02   -4.218543861135010e-02   -2.464833130269833e-02   +8.846272189379292e-02   +1.818047072111380e-01   -4.378771698210575e-01   -8.689808516684931e-02   +3.653741106212024e-01   +2.938759558232513e-01   +9.532969449847253e-02   +1.282704588686708e-01   +2.393314706687762e-02   +2.089334815786570e-01; -2.938223211849623e-01   +1.228368849385393e-02   -2.885780293677238e-01   -3.772501627043553e-01   +1.728815686202561e-01   +1.515332899207798e-01   +1.322569081898464e-01   +8.901932376836948e-02   +2.267001756249611e-01   +2.356915022186108e-02   +1.525478588269424e-01   -1.591520278261042e-01   +2.683100091900183e-01   +3.590424663874829e-01   +1.103229802778833e-01   -2.832818515553837e-01; -2.393303300323643e-01   +3.667334116669130e-02   -1.054717111889793e-01   -1.337889003097459e-01   +2.377085792752395e-02   +2.715358323927982e-01   +4.390796216148363e-01   +1.052574834387700e-01   -3.085513823834738e-01   -1.185577956305280e-01   -1.936221202493582e-01   -3.851997918031203e-03   +1.220475034358529e-01   -2.981531385911779e-01   +3.080875635693044e-01   +1.659580046437312e-01; +1.981880577710143e-01   +3.770837665860050e-01   +1.205820126869460e-01   +7.176640703498340e-02   -1.716043581449306e-01   -2.186081570223304e-01   +4.172621277835635e-01   -8.513261513946763e-02   +6.123204791468851e-02   +2.664410870978914e-01   -4.743588415521623e-01   -8.688765596990392e-02   +1.357602964987542e-01   +1.540179588158766e-01   -1.885965829609824e-01   -1.050856281665565e-01; +3.960508632359054e-01   +1.281455974083202e-01   -1.226361599521367e-01   +2.549818661550357e-01   +1.875033045255745e-01   +2.322600932689197e-02   +2.352374415980983e-01   +1.442118414705146e-02   +1.514146447609021e-01   -2.350920843239703e-01   -2.075048307299945e-01   +3.057702712835904e-01   +2.112383898461846e-01   -2.460786436818837e-02   +1.687996674959386e-01   -3.131079652422747e-01; -2.297826326158606e-01   +5.400937857419130e-03   -4.110351616134826e-02   -1.814842957440567e-01   +1.147551301945502e-01   +1.228372323059784e-01   -1.731519490596376e-02   +3.042530278248995e-01   -1.267258660599856e-01   +1.412943104358440e-01   -2.782848267057307e-01   +3.423640690203020e-01   +3.788881674373864e-01   +1.533554958569076e-02   +2.918422890382452e-04   +8.715200589545041e-02; +8.536447070074318e-02   -2.558609286134992e-01   -1.661215525716048e-01   +6.386864128069220e-02   -2.739402085705540e-01   +1.555024737586504e-01   +3.916473633563181e-01   -2.187902453774327e-01   +2.619482500539328e-01   +5.092630975362520e-02   +3.236982147513692e-01   -1.487304119627179e-02   -2.264380858781126e-01   +1.058342358600374e-01   +4.311744288286772e-02   -1.430225735157188e-01];
L1E_L1I_iGABA_netcon = [+2.173824517783230e-01   -5.691728409446108e-02   +1.988751189843238e-01   +3.267803196856615e-01   -9.664421079098320e-02   -2.082550246034743e-01   -3.181618817408579e-01   +2.494620020817056e-01   +4.182801078813159e-01   +3.511801234124529e-02   -9.565715285841069e-02   -9.689607486183538e-02   -9.184600022178781e-03   +2.490901584286939e-01   -1.153761080228818e-01   +2.695513966758051e-01; -8.857032204225976e-02   +1.513668186805116e-01   +8.380806768057948e-02   -1.500979769481503e-01   +7.909301784888487e-02   +1.116723607480063e-01   -4.712967705769094e-03   +1.416550126141788e-01   -1.062533085198027e-01   +1.692296652090425e-01   +3.056044496797592e-01   +3.576396925903437e-01   -1.464367506062252e-01   +2.818415010474722e-01   +2.056455210307595e-01   +2.088994834780413e-01; -6.594430035565649e-02   +6.441805251110833e-02   +3.234742842134459e-01   -1.199800266895598e-01   +6.845384273850377e-02   +2.924991975741839e-01   +4.689040605456810e-02   -5.607784503546430e-02   -1.364155435228336e-02   +2.994865604105112e-04   +6.822020096493284e-03   +6.431302008246544e-02   -1.657261402264231e-01   +1.406446008380836e-03   +8.262380219743501e-02   +5.185489803180092e-01; +9.222739845389841e-02   +1.719866498123747e-01   -1.729112584988295e-01   +2.129447861148661e-01   +2.943271577363098e-01   +3.005684284365027e-01   -2.155854712613280e-01   +3.940962014593118e-01   -3.348689655770125e-01   -3.580656621753842e-01   -3.422139352862357e-01   +1.589114377832978e-01   +2.948387116195422e-01   -2.671134493091189e-01   +3.631109729006117e-01   -1.869024345138801e-01; +4.911737424292862e-01   -3.620592872906188e-01   -9.596766948607265e-02   +9.057322006092597e-02   +4.137129999658953e-01   +1.274993443193013e-01   -2.776209353780498e-01   +4.048047453032575e-01   +1.022323973384631e-01   +1.388546088576766e-01   -3.247589364703399e-01   +1.596990619558682e-01   +2.465669333743649e-01   -8.425624925418090e-02   +3.716784074205858e-01   +2.363915468659519e-01; +2.627880433653248e-01   +2.008681641798727e-01   +3.326633956928998e-01   +2.085578103232327e-01   +2.931860001126617e-01   +3.082516856029749e-01   +3.492536273297024e-01   -1.869956167857027e-01   +1.516716723978910e-01   +2.421030844958454e-01   +2.987580980490856e-01   +1.831595477942969e-01   -2.306396959695741e-01   +3.026494415940610e-01   -1.953257196455376e-02   -3.128594007028425e-01; +1.706161086708961e-01   -2.694455546876314e-01   +3.511937204426415e-01   +1.834548143319679e-01   -3.628473403487169e-02   +1.476966735932567e-01   +2.198112944287239e-01   +1.718322298789002e-01   +3.686510504916042e-02   -8.013684924558899e-02   -2.469954997647671e-02   -1.249679094175907e-01   +1.666726550638926e-01   -1.471420538971550e-01   -2.313784733556888e-01   -6.447387497261992e-02; +3.623621083429374e-01   +1.064730903554805e-01   +4.751258553511878e-01   -9.098908040932499e-02   -6.132566293185885e-02   -4.606236553136414e-02   -5.536502013699034e-02   -3.822070393856443e-01   -1.875141808352336e-01   +1.087389372134195e-01   -2.204130593669188e-01   -2.057320045343732e-01   +1.720836861601939e-01   +2.424654862259854e-01   +1.865778298981159e-01   -3.348113323726093e-02; +1.700891883193012e-01   +3.077211994969216e-01   +1.005536264427896e-01   -2.702532612524038e-01   +1.435549195892977e-01   -1.521119875684922e-01   +1.075920002576476e-01   -1.852113677650485e-01   -7.066178527839738e-02   +2.942064842952626e-01   -3.202960401144787e-02   +5.195118980753185e-01   +2.960946854830208e-01   +3.885245624736050e-01   +3.279489507996215e-01   +2.074624982945848e-01; +1.648885920910406e-01   +6.850114132393581e-02   -5.860176675928763e-03   +1.071408330797800e-01   +1.514001043885514e-01   +2.491205802462267e-01   +4.059502587969975e-01   +4.100662278645490e-01   -1.177673635972541e-01   -2.564693333208486e-02   -9.013705254943241e-02   +2.001788937776047e-01   -3.656775283095324e-01   +5.798187502892119e-02   +2.401074467739871e-01   +1.787826088275238e-01; +2.704935969268681e-03   +2.287249394661957e-01   -2.809929754817799e-01   -2.684214412549816e-01   +2.804637928798152e-01   -1.815486495479121e-01   +1.566328937293799e-01   -2.507458904050203e-01   +3.588418844552043e-02   +1.108010635979936e-01   -4.873721601596040e-02   +1.127771007055918e-01   -1.973660474010086e-02   +4.726964483775994e-02   +1.930879962835109e-01   +9.638735359493056e-02; -1.245766505973726e-01   +1.058419097963679e-02   +3.987612937092625e-01   +2.058474373479423e-01   +1.372739677821098e-01   +1.728098107434667e-01   -1.253058107586290e-01   +2.809067334056652e-01   +3.544234578675481e-03   +4.405376868500469e-01   +2.050741268342504e-01   -3.644160759225019e-02   -1.724244461374328e-01   +7.738864943156962e-02   +3.170822116338605e-01   -7.937557378570281e-02; +2.017929636771871e-01   +1.486787241544912e-01   +3.318907442423045e-01   -2.168164539163332e-01   +2.818312995582324e-01   -6.954686740117723e-02   -5.308485697141111e-02   -1.691618817969186e-01   -2.116476819771461e-01   -6.833025931484271e-02   +2.876647255185238e-01   -1.467851040071164e-02   -1.082781882661071e-01   +1.614299427009488e-01   -9.068792471370522e-02   -2.320337359265701e-01; +9.820308850193610e-03   -1.084387350359915e-01   -8.867472763541898e-02   +3.282156651491512e-01   +4.843192687395814e-02   +3.193608385790158e-01   +4.586252225211313e-02   +2.312190085316849e-01   +2.921949869124784e-01   +1.975562689429720e-01   +2.711260718242374e-02   +6.850155366065580e-02   +1.364906485553067e-01   +1.667261519278124e-01   -3.440952609629265e-01   +2.238319024914740e-01; +1.768720428637960e-01   +3.309898427754492e-01   -8.511930437711565e-02   +6.609267186623309e-03   -1.199118506576204e-01   +1.740297292706570e-01   +1.303637838545067e-01   +3.704509706445335e-02   -4.041510499268891e-02   -7.561009337961276e-03   -7.736330377541739e-02   -7.412425225637405e-02   -1.103394743741112e-01   -1.948459753612499e-01   +1.293412917555443e-01   +1.184298140245350e-01; +1.928060886191154e-01   +1.197410418612382e-01   -1.145735074021690e-01   +2.101059281240905e-01   -1.575207680378967e-01   +1.887116087223839e-01   +2.581621791613813e-02   +2.411263158483053e-01   +1.888220661859116e-01   +3.360652929561095e-01   +1.194581757720085e-01   +1.389138453234831e-01   -8.577287634061931e-03   -3.739663496805731e-02   -8.071936392302560e-02   +1.811667459846576e-01];
L2I_L1I_iGABA_netcon = [+2.417059592628166e-01   +1.463351667014144e-01   +5.743354275027693e-02   +9.569661844070493e-02   +2.445797451555370e-01   +3.750745815259990e-01   -4.215907382686894e-02   +1.432378581341456e-01; -2.481742298232718e-04   +4.596822217858852e-01   +8.738894447333567e-02   +2.967303270893623e-02   +1.014189506960771e-01   +1.892852729979552e-01   +1.551846426917677e-01   +2.125635972329698e-01; +1.941791130630745e-01   +8.211349640529253e-02   +3.268575320481020e-01   -2.380095496891568e-01   +2.177405044783780e-01   +2.774745158263674e-01   -3.242772143598154e-01   -1.237399762095201e-01; +1.106676984100522e-01   +1.574680907866950e-01   -2.509831901464491e-02   -7.135887904563090e-02   +1.013304635431885e-01   +2.135355378092153e-01   +2.535411661114600e-01   +2.398410255218793e-02; +2.340683788128392e-01   -1.408306646338605e-01   -1.829215093988512e-01   +3.199572384096173e-02   +1.089993051739792e-01   -9.881732235303298e-02   +3.721858377155660e-02   +1.757391534395302e-01; -1.047708476738730e-01   -3.383520068024983e-01   -1.171111528299351e-01   +2.223643734393383e-01   -7.869236359637892e-02   +2.109200691036703e-02   +1.509468868249789e-02   +2.290253981662860e-01; +2.087016729900751e-01   +3.207329631621806e-01   -1.579666118606698e-01   +1.957044477222413e-01   +8.161922823890251e-02   -3.179582501638076e-02   +5.078417467692185e-02   -5.234022910306576e-02; -1.941630968637024e-01   +1.817951658726164e-01   +1.853632040303242e-02   +3.686796949655587e-02   -7.544170950819283e-02   +2.456502160461956e-01   -2.353601073535489e-01   +2.844567884400855e-02; -4.649137088427654e-02   +2.060910673477245e-02   -1.463469303966985e-01   +5.726436621732603e-02   +3.386068776039678e-01   -1.016058551162968e-01   -1.492683844439132e-01   +1.599267105180281e-01; -4.058853871618413e-02   -6.095939749528671e-02   +4.477079372218681e-04   -2.099661646335524e-01   +7.541589994580708e-02   -1.112985083747405e-01   -1.573852821034396e-01   -1.727807864164350e-02; +1.663902632536260e-01   -3.176708712922560e-01   +1.159843861934739e-01   -3.824821262056340e-02   -4.123442350030164e-02   +2.027561055377189e-01   +3.522878430383948e-01   +3.666059507315177e-01; +6.648868122453321e-03   -2.434814368919725e-01   -6.208531944976671e-02   +3.143865274026611e-01   +1.933987984500347e-01   +1.827151464172542e-01   -6.611918288806369e-02   +2.664815291471532e-01; +5.973222935775192e-02   +1.964320793274956e-01   -1.085930152533390e-02   +2.619866382551867e-02   +3.318422628434647e-01   +3.134750580597755e-01   +2.354431105632049e-01   -1.031309070623020e-02; -2.214307818233424e-01   +3.512735805594018e-01   +1.183009583313446e-02   -2.695808633453127e-01   +4.032810823993821e-02   +1.384134658589901e-01   -2.468467947774682e-01   -2.039636999051729e-01; +8.208842422070836e-02   -1.066669638274946e-01   +1.395181048166643e-01   +1.496789396654859e-01   +1.118059383406582e-01   +1.059219188686956e-01   +1.399674263933861e-01   -3.584497473190818e-01; -7.018404511240806e-02   -1.919600834882946e-01   +4.236323316371479e-02   +9.989062921532588e-02   -2.481552184970925e-01   +2.746149103002413e-02   +2.561478447625558e-01   -1.366227646216074e-01];
L1I_L2I_iGABA_netcon = [-6.331925375223982e-02   -3.336980336764527e-01   +4.759581167229340e-02   -1.009092628117783e-01   +3.249173460817045e-02   -1.617323061500328e-01   +2.478967465521078e-01   -2.582712326473646e-01   -9.405718574255499e-02   +1.154194289296408e-01   -9.212170289483779e-02   +2.148452716925982e-01   +1.895917562395694e-01   +2.857937444629143e-01   -1.181100058262104e-01   -3.073138113120934e-01; +2.097920569770823e-01   -1.200366674013690e-01   -4.185142895213753e-02   -1.903110121985961e-01   -4.071203278490748e-03   -8.983535785677788e-03   -2.016323620873082e-03   +1.719015243857827e-01   +1.502955275226927e-01   +3.165623104810525e-01   +1.046508740548993e-01   +7.864762979423033e-02   -7.525805425330945e-02   -1.887629946033513e-02   +2.353007670152099e-01   -6.808913835663175e-02; -1.732744484364376e-01   +1.034350090195935e-01   -4.567463548493776e-02   -1.462879943802953e-01   +2.759146080210019e-01   -1.743739370243478e-01   -2.037483165169180e-01   +1.845941171327850e-01   +2.380194193722547e-03   +1.420591489536211e-02   -1.509352381630701e-01   +9.111851290704001e-02   +4.482153841827935e-02   -2.566188696560544e-02   +6.281749238740617e-02   +2.331563969329874e-01; +9.583428863434708e-02   +3.104159836096732e-01   +1.549465210638824e-01   -8.903585340287273e-02   +1.816165775984654e-01   -1.323338291938141e-01   -1.084450795828741e-01   -1.248455545683834e-01   -1.043027197639348e-01   +2.126828259190542e-01   -5.960859955366622e-02   -2.306331417741369e-01   +2.424311224838357e-01   +3.450999450563714e-01   +2.653124741281986e-01   +3.447745308427420e-01; +5.678963217726898e-02   -4.040346096683950e-02   +6.150089966964421e-02   -2.248933740893984e-01   -4.380647612982477e-02   -8.757942525711088e-02   -9.884114318562180e-03   +3.067996625467954e-02   +8.978144534574467e-02   -1.410078086244178e-01   +5.006688359622762e-01   -1.554265093992416e-01   -3.392557393745961e-01   +1.240812217241238e-01   +1.439499928633675e-01   -7.035395371032982e-02; -3.464392963739313e-01   -1.739839499477716e-01   -1.983965645165545e-01   -1.033298488351353e-01   +2.547383315604149e-01   -1.578917697646749e-01   -1.033234492230065e-01   +1.040661121672850e-01   -1.341945010691835e-01   -4.085409300118884e-01   +3.081228972590099e-01   +4.042190204194507e-01   +5.669596951664820e-01   +1.003395008220770e-01   -1.874190508892443e-01   -9.805346629846920e-02; -5.460638632428795e-02   +2.607354054487325e-01   -9.284879324806210e-02   +9.674518715365026e-02   +1.778923647795609e-01   +1.740958121853285e-01   +6.904468971392383e-02   +2.368685944125799e-01   +2.762008243711531e-01   +3.333863849564433e-01   -2.424917482528396e-01   -1.691807089910093e-02   +3.805855008486934e-01   +1.989642650865133e-01   +2.505905553457258e-01   +8.835997416575615e-02; -2.463513081714436e-01   +1.119988318779989e-01   +2.532294575173273e-02   +8.247947276143511e-02   +1.286108528002667e-01   +3.170146121761756e-02   -2.045112852677934e-01   -1.649639417184226e-01   -8.698580578884363e-02   +2.023401778316632e-01   +1.358992625620181e-01   +4.298438842918874e-02   -3.030831348096654e-01   +2.172894813656255e-02   +3.031533633334050e-01   -2.081542086300669e-01];
L2E_L1E_iAMPA_netcon = [+1.969786786975894e-01   +1.126000203395955e-01   -1.913349100641953e-02   -3.513972586860499e-01   +4.048090787532312e-01   +1.465914644713836e-01   -2.584126593765784e-01   -4.970455968872768e-02; +8.026939229955621e-02   -9.738039118913183e-02   +6.923447618422068e-02   -2.722250688906332e-01   +3.130765406593256e-01   -1.166774785575497e-01   -8.041579966315940e-02   -6.179164475672398e-02; +2.683367394528743e-01   +3.900521567432556e-01   +1.976849158551864e-01   +1.220875905835306e-01   +2.374923227385791e-01   +2.467321771709262e-02   +2.834252682815851e-01   +1.209884584693370e-01; +4.502265309980038e-01   +5.612215590625067e-02   -3.408722300002103e-01   +2.343413422324791e-01   +2.344095037409439e-02   +4.629480459966809e-01   -1.717594262738687e-01   -1.137755503236465e-01; +3.059524004174583e-01   +3.856628938385668e-01   +5.788810446632002e-02   +2.598793419020826e-01   +1.007945125323167e-01   -2.439916465652177e-01   -4.454979125422025e-02   +2.404876914072123e-01; -1.686130373306685e-01   +1.577582716357404e-01   +3.755780334615100e-03   +1.513713381342443e-01   +2.825987057072194e-02   -9.297464056478834e-02   +5.539074961652100e-02   -1.331419238708060e-02; +2.240706712315014e-01   +2.369981022347813e-01   +3.507096482019111e-01   +3.054025417565556e-01   -3.015511759335782e-01   -2.097729425047131e-02   -2.008773734695576e-02   +3.311510176568837e-01; +2.363610034080649e-02   +3.923569899996968e-01   +1.151621249564113e-01   -3.207007578789139e-01   +7.771919925634017e-02   -2.113187699470139e-01   -1.515328014152201e-01   +8.052504734394579e-02; +3.026143614648902e-01   +9.947232834201243e-02   +2.300029292692674e-01   -2.498126158290416e-02   +7.421470106082524e-04   -1.361196655157275e-01   -1.872892812422640e-01   +1.069508928930887e-01; -1.016334898431630e-01   +2.637125535377813e-01   -2.285794743632582e-01   +1.546804644761949e-02   +4.073049532949786e-02   +2.118215251519275e-02   +2.772515066368647e-01   +2.111974324350425e-01; -2.298406001612946e-01   -1.745309194900944e-02   +1.786516016391855e-02   -4.041358856626668e-01   -8.276823125267797e-02   -1.180140607256848e-01   -3.629704826648859e-02   -1.079653856632590e-02; -1.605342772031317e-01   -8.203865801643166e-02   +3.191408112551985e-01   +5.415334745221818e-02   -5.398395828165609e-02   +7.670514216993947e-02   +2.656274065489678e-01   -2.850407018757176e-04; -1.385421987324579e-01   +3.161975741281818e-02   +7.970213782606908e-03   +1.573447271881104e-01   +2.224492244658626e-01   +1.898799145305048e-01   -6.499806519863879e-02   -3.217625517680576e-02; -1.015122331385566e-01   +1.801526237350396e-01   -3.573618648074950e-01   +2.643362394780920e-01   -5.086776799432505e-01   +9.965033702374627e-02   -6.937619183746738e-02   -1.186990257834386e-01; -1.112104186026883e-01   -3.530099449944303e-02   -2.047233715145047e-01   +3.023243734886714e-01   +2.400215719540274e-01   +5.440378005086299e-02   +2.700238915476718e-01   +1.158040562980852e-01; -1.427631327681501e-01   -3.305607602700068e-02   -5.791435781584067e-02   +3.183928041463783e-01   +1.729623494868568e-01   +1.671207970251264e-01   -5.030970075769228e-02   -8.136345064159051e-02];
L1E_L2E_iAMPA_netcon = [+2.858762044906777e-01   -7.045388713803974e-02   +2.873047842617382e-03   -8.873521458062179e-02   -1.711371453283598e-01   +2.962124150911215e-01   +1.068510975864949e-01   -1.956791838261755e-03   -1.348930679943598e-02   +2.159012010703532e-01   -1.908835635933633e-02   +1.184003741055197e-01   +3.273439260623453e-01   -2.584261521758479e-01   -7.013995672482831e-02   -3.806641267777233e-01; -1.201382257283923e-01   -5.659281880011706e-02   +3.242203081167472e-01   -1.176906083858683e-01   -5.775664979684443e-02   +2.435137441384113e-01   +2.883545892803897e-01   -2.235603095243814e-01   +4.994018280925683e-02   +1.755486755985571e-01   -2.093531361743133e-01   -1.090579788475655e-01   +3.606186409631690e-01   -3.615907282460622e-02   +2.457437997221586e-01   -2.565537645726307e-01; -1.705336037743176e-01   -2.802951852250743e-01   -2.649967789209112e-01   +1.544739697180318e-01   +8.099059116771967e-02   +1.936107136683930e-01   +3.722646506048763e-01   +4.228425090889518e-02   +3.551807331274609e-02   -9.393082195375292e-02   -8.149498701155351e-02   -3.288944042599407e-01   -2.463251218942804e-02   -1.395848709851490e-01   +6.108094234366000e-02   +2.769642897163772e-01; +6.709744796034388e-02   -2.732669721875682e-01   +2.610135113031045e-01   -9.188426270316025e-02   -1.835474692126351e-01   +3.247378747598589e-01   -2.333674151358361e-02   -2.099662359820959e-02   -8.212937410928826e-02   -8.064604942755489e-02   +3.180407602197655e-01   -2.639160140047572e-02   +7.236964914468973e-02   -6.803088390488260e-02   +2.237792962213139e-01   -1.930713529771366e-01; +1.675157296058769e-01   -1.200093378410878e-02   +1.450614873019167e-01   -1.538271720052276e-02   +2.061462734734796e-01   +2.902290344428535e-01   +2.307993269552319e-01   -2.262241443884525e-01   -7.358802914695046e-02   -1.828399250921443e-01   -2.833142054298702e-01   -1.446279828184079e-01   -2.531172863492381e-01   +2.421008449024512e-01   +1.520551648747695e-01   +2.708922405078746e-01; +1.275289581567939e-01   -1.439715364386195e-01   +5.330236445022667e-03   +2.165097742263283e-02   +1.470011672137837e-01   -7.588183992064348e-02   -2.131649140639062e-01   +3.670228481817641e-02   +5.770403739857217e-02   -1.367477495729846e-02   +1.099484191743005e-01   -1.244362200282412e-01   +4.967425742861410e-01   +1.131627332675657e-01   +1.622165043520693e-01   +2.108535920714686e-01; +9.713445219378861e-02   +3.540748745726605e-01   +1.391714505006601e-01   -1.579285752263955e-01   -1.789197766561968e-01   +2.658167549764379e-01   -3.365841696913276e-02   -1.073788262017702e-01   +2.467979140217201e-01   -3.874469382011339e-01   -4.976980029741118e-02   +3.377659595480277e-01   +1.643278723430920e-01   +1.849647200480142e-01   -4.617373642041440e-02   +8.107459362508593e-02; +1.183962897546468e-01   -1.265102528507100e-01   +1.409684142800809e-01   -3.881702612343262e-01   +1.041301183963045e-01   -4.069782241095546e-02   +4.402568406099635e-02   +1.635019206862746e-01   -1.967191218325438e-01   -2.078772544888863e-01   -3.016190199904261e-02   +9.517665386373231e-02   +5.086487756186725e-02   +2.647808482383556e-01   -1.869381531656776e-01   +1.685471436572254e-02];
L2I_L2E_iAMPA_netcon = [+3.825223196324787e-01   +1.057705890573571e-01   +3.526230090344969e-01   +2.977830077276548e-01   +4.078102139211841e-02   +2.274205595191532e-01   -1.321214346709551e-01   +2.395196984655883e-01; +1.258349120423948e-01   +4.059055153744265e-01   +9.369130770664805e-02   +2.027868562374522e-01   -9.633249585169021e-02   +2.838097294205213e-01   -3.076665210506375e-02   +2.249581261783655e-01; -3.218438313861723e-02   +1.552962496083801e-01   -4.510286286070700e-02   +2.993137023163304e-01   -6.822311122708016e-02   +2.004116397294095e-01   +2.037999260527768e-01   -9.194745553438058e-03; -3.025698332554784e-01   -5.714121384696031e-03   +3.695748897492545e-01   +3.419917046791243e-01   +1.218176748623754e-02   +5.477952422163396e-02   +1.173987808289172e-01   -3.372506177020569e-01; +7.529636334373482e-02   +4.799107524172682e-01   -2.284943580470638e-01   +2.397306002790390e-02   -4.168287604353604e-02   +2.013600335629122e-01   +1.814005171405788e-01   -6.519512628925626e-02; +1.905833836410993e-01   +1.947816491929421e-01   -6.373232962577977e-02   -6.208946034156324e-03   +2.539595883108726e-01   -7.334283994968503e-02   +5.840265562448692e-01   +2.620416954953020e-01; +6.652430014524874e-02   -1.933436817273667e-01   +2.361903708147442e-02   +2.834690815991636e-01   +1.460628205008091e-01   -1.291912229722329e-01   -1.186970930950710e-01   +5.376858432260228e-02; +2.187195718031431e-01   +2.933817545964169e-01   -1.802533209418886e-01   +2.520703665520664e-01   +9.978815797566992e-02   +1.175697069553164e-01   -5.801481397996452e-02   +1.829212331588587e-03];
L2E_L2I_iGABA_netcon = [+1.816748471704597e-01   -3.697925980144602e-03   +1.696909751313140e-01   +1.200785370618079e-01   +3.882988484846089e-02   +2.859403542621571e-01   +1.952069027068313e-01   -1.072111212509631e-01; +1.026540536237832e-01   -4.422959935609809e-02   +1.800543686957372e-01   -2.287322315643141e-01   +3.286599855865049e-01   -1.444721189217612e-01   +4.501523582284617e-01   +1.281808137457678e-01; -2.816780114302081e-02   +1.377664342591001e-02   +5.001360083010498e-02   +2.520932480492116e-01   -1.834809319953593e-01   +4.082485936495468e-01   +2.015849158606906e-04   -1.972506040083759e-01; +7.583014566875870e-02   -7.456453102892159e-02   +1.312069775288250e-01   +1.981507888390980e-01   +2.089564886086226e-01   -6.015959243243073e-02   -2.980560523307516e-01   +9.415548831225168e-02; +1.632367785294525e-01   +3.835146821689013e-02   +6.871847259727569e-02   +1.208880056518934e-01   -7.886896527778570e-02   +1.079938990794495e-02   +2.496083628468188e-01   +2.051266461943374e-01; +1.913718919434899e-01   -1.418370156141611e-01   -2.139728288767632e-01   +1.375648538637612e-01   +3.117510186240523e-01   -1.850400929738720e-01   +8.478630466030776e-02   +2.329041108308582e-01; +4.646802087048381e-02   +1.096079580898221e-01   +4.624911130664539e-01   -1.238073547127050e-01   +1.191061938936537e-01   +5.072560798882654e-01   +6.640483334247420e-02   -1.282578322385541e-01; +4.036302994437818e-01   +8.552687597740889e-02   -1.252291770707719e-01   +9.184477888750089e-02   -4.423078952884025e-02   -1.400943050665948e-01   +1.573435516057276e-01   +3.016595316893881e-01];
L3E_L2E_iAMPA_netcon = [+8.659450193283601e-02   -5.763768552905260e-02   +1.319368525211671e-01   -2.956103965262113e-01   +2.877247488852487e-02   +2.595901959926185e-01   +1.527711437294255e-01   +3.159350108313266e-01   +2.596196391603046e-01   +2.339000597743602e-01   +1.148075206634046e-01   +4.209196914156687e-01; -2.584373310044458e-01   -5.492834760766155e-02   +3.261028898432832e-01   +3.821261042923733e-04   -1.882530600375528e-01   -5.255718155461531e-02   +1.846461137343179e-01   +1.935109222977160e-01   -7.138837178694937e-02   +7.961142632636260e-02   -7.595212147525671e-02   -1.262076285337920e-01; -2.634240063492730e-02   +3.133865188736563e-02   +3.991209537266420e-01   -1.262995113294808e-01   -8.031228196597597e-02   +3.420133830541861e-02   +4.526289308543068e-01   +1.028780141567074e-01   -1.035263941942647e-01   -9.795404827118506e-02   +2.996670040140738e-01   -1.755303507851524e-01; +2.638991849336330e-01   -1.154480676531482e-01   +4.136008539439089e-01   +5.349763845389382e-02   -6.513477093930445e-02   +5.994557234151299e-02   -1.268110815983660e-01   -1.272430689578707e-01   +1.387193697355964e-01   -1.606048317011709e-01   +1.343728833400826e-01   -9.683443510880856e-02; +4.014692431300601e-01   +4.324570243094124e-01   +2.679342718755093e-01   -1.084137469869171e-01   +1.557389209213786e-01   +2.073983838654351e-01   -1.860838679778900e-02   +2.225957590813283e-01   -2.795341865710663e-01   +2.149250076760202e-01   +2.089995643245329e-01   +3.151333816751798e-01; +1.104417989501171e-01   -3.350754771862027e-04   +2.425003497522992e-01   +1.370024568997414e-01   +1.084433718685829e-01   +4.304514818940618e-01   +2.738357638770145e-02   -5.138494790432023e-02   -3.558265892520057e-01   -2.687721274814342e-02   +3.248648486727116e-02   -1.277036053402948e-01; +1.548402674351655e-01   +1.450371249837782e-01   +3.022211138421044e-02   -8.838752148598056e-02   +4.321067020255231e-01   +1.967863461385859e-01   +3.937080297385733e-01   +2.964483526053934e-02   -2.026563223089226e-03   -1.957436635462885e-02   +1.982322835232521e-01   -1.417860858078802e-01; -4.685737690011811e-01   +2.612230243497370e-01   +3.347980083517431e-02   -9.026731874963433e-02   +9.653364022078932e-02   -4.448813638976409e-02   -6.353206881853449e-02   -2.245021581987235e-02   -2.721361768918770e-01   +4.026633484263327e-01   +7.358383962912637e-02   +3.523099240196852e-01];
L3I_L2I_iGABA_netcon = [-6.540105805330973e-02   +6.270026548041980e-01   -6.259369009044824e-02   -3.735657952845785e-02   +5.618618498025451e-02   +2.238974811191760e-01   -2.341912803912566e-01   +8.565022548049067e-02   +1.644929715445298e-02   +1.718370753837415e-01   -6.157677732522579e-02   +3.450349054558018e-01; +2.588999014063512e-02   +1.818602980485633e-01   +9.064119922706342e-02   +3.403122793238979e-02   +8.629405417100824e-02   -2.562261596344528e-02   -3.522915307256997e-01   +6.342448951480739e-02   +9.130712087339882e-02   +3.939342478151284e-02   +3.694006171180079e-01   -3.258682548015308e-02; +3.685616904026091e-01   -8.575615357463758e-02   +1.223766033850130e-01   -6.867530548485853e-02   -3.131458763986440e-01   -6.035566265453689e-02   +1.193138190043637e-02   +9.911935301044755e-02   +7.641266723462806e-02   -2.020765340633562e-01   +3.095603185346396e-01   -3.556020360170488e-02; +3.869403881898902e-01   +7.364110394018009e-02   +5.522663080626130e-02   +7.343275543782342e-03   -1.047417910030031e-01   +3.213879334783518e-01   +3.844603682714282e-02   +2.137264767239550e-01   +2.144075417144821e-01   +2.960425863347653e-02   +1.578928308687184e-01   +2.198409475941349e-01; +8.616537978508054e-02   +3.450892235998972e-01   +4.950513347062809e-01   +2.286433260251672e-01   -1.176607755503074e-01   +2.593546576088405e-02   +9.669635591551412e-02   +1.306344945701159e-01   +8.847869515586057e-02   +2.818670572858306e-01   +3.352355945035277e-02   +1.122682421443481e-01; -1.655727950600349e-02   -5.426152399469330e-02   +9.675518309039885e-02   +1.516940372634494e-01   +5.452665198008866e-01   -2.864279177944602e-02   -1.336585511042798e-01   -1.619117242275414e-01   +1.849828788655213e-01   -3.511218895447672e-02   +1.773072234513897e-01   +7.129697384855999e-02; +1.269660747011793e-02   +1.926311445788893e-02   +3.959618041971169e-01   -2.282643780315328e-02   +3.366537626404467e-01   +1.880812768764123e-01   +3.885305745814500e-01   +5.301685678427298e-01   +3.580663191433527e-01   -1.160123017613177e-01   +3.593382947496061e-02   +9.881462790969917e-02; +3.188818298339117e-01   +6.132253748377115e-02   -1.347695253323941e-01   +6.073165328808729e-02   -2.307062910377708e-01   +9.327216405214611e-02   -1.959095063227545e-02   -5.987260271440527e-02   -1.955066724248893e-01   -2.045947173986326e-01   -3.834621979054474e-02   -7.525974709009606e-03];
L2E_L3E_iAMPA_netcon = [+1.423154233756206e-01   +1.773710757517347e-01   +3.324466958666557e-01   +2.849470598277277e-01   +2.882939868846580e-01   +1.009217761182175e-01   -4.293833634203826e-01   -1.958859538263558e-01; +1.020211458321399e-01   +1.154258155705721e-01   +2.821802879355074e-01   +2.059831109239524e-01   +2.395816539979378e-01   -1.211250511789131e-02   +1.804726895399596e-01   -2.244781915410988e-01; +6.332781259522080e-02   +1.391925634783578e-01   +1.922250451693619e-02   -1.225373216600089e-01   -5.376768969719978e-02   -7.936444501696231e-02   -1.923972924215071e-01   -1.007891311922460e-01; +1.172056344034352e-01   +4.242751517017987e-01   +6.571305209955380e-02   -1.565143504683906e-02   +3.797401447857341e-01   +5.338657956668106e-01   +1.404889033891822e-01   +2.571558920000113e-01; -8.611524643261970e-02   +2.077596892142413e-01   -6.720371632170571e-02   -2.026959314431914e-01   -2.322930056739683e-01   +2.201958086367200e-01   -2.773206775680631e-03   -2.619283058220515e-01; +1.362796086050592e-01   -1.432027515423527e-02   +2.374456389613480e-01   +3.649258274947683e-02   +3.855193801905477e-01   -9.290822193034931e-02   -9.166091546359149e-02   -1.646683203483338e-01; -7.539692073899021e-02   +1.622298807792606e-01   -3.853130381477032e-01   +1.870144733704217e-01   -4.307313482131627e-02   +1.283368281144431e-01   -1.266882826175992e-01   +1.434632747913342e-01; -6.942182641523678e-02   +2.874137786529691e-01   -3.329270283153079e-01   +4.100789370941844e-01   +1.994223066144753e-01   +2.595658421164471e-01   +1.750923343596232e-01   +2.774685436311029e-01; -1.504620179801709e-01   -7.885684705961700e-02   -4.755221747733965e-02   +2.854049500151501e-01   +1.077486252451607e-02   -3.606275691206617e-01   -3.670134398964521e-02   -7.490296281406153e-02; +2.151548316900316e-01   +2.350970791651165e-01   +7.353966357108156e-03   +4.170442454561253e-02   -6.141547650254975e-02   +6.478149889111187e-02   -1.091042909445663e-01   +4.773802117824219e-01; -8.119422258377314e-03   +1.018320369039796e-01   +7.839538196353694e-02   -3.539564342029626e-02   +2.288810662284167e-01   -2.099545153412519e-02   +1.210757154603467e-01   +3.283632133205787e-01; +1.490495647788441e-01   -6.890754795316600e-02   -8.079346882254808e-02   +1.799942819201662e-01   +2.680335922610033e-01   -2.212457816098563e-01   +3.047560196325289e-01   -2.991576038914744e-01];
L2I_L3I_iGABA_netcon = [-7.275464970766851e-02   +7.441252454486111e-02   +1.899494609651339e-01   +2.904216916582945e-02   +5.669669588948605e-01   +5.048452391966259e-01   -7.578971946629791e-02   -1.522201449245661e-01; +9.354612995230939e-02   +2.555325018308438e-01   -3.226039227180101e-01   -1.752873914389151e-01   +5.322777820470477e-02   +2.109213716487839e-01   +1.533316105619425e-01   +1.837842770663161e-02; +3.274404551910314e-01   +8.744470297741111e-02   -1.151196716429901e-01   +3.522983430687596e-01   -6.802931360156379e-03   -1.567323372974077e-01   +5.317421487574109e-02   -3.733876264423151e-02; +1.219836835604451e-01   -1.465698408381026e-01   +9.283968985296842e-02   +1.220708926284360e-01   -1.112753687510781e-01   +3.689309379814396e-01   +4.947774509519951e-02   +1.664531590528380e-01; -1.215488409800841e-01   -2.205195732920823e-02   -2.408978221279338e-01   +1.297842641742934e-01   +1.396489517367977e-01   -2.861254731490611e-01   -2.338220748912289e-02   -1.896401213909126e-01; +1.632116326384668e-01   -6.898718988639428e-02   -2.506750512943221e-01   +7.604380117618012e-02   -1.389837259529684e-02   +7.656879419596649e-02   +2.519718832854878e-01   +1.127996500856864e-01; -6.233451432482912e-02   +2.576248249833506e-01   -5.316596359526243e-02   -1.460831164635914e-01   -1.918239370689420e-01   +1.954423671686825e-01   -1.312572089803477e-01   -5.012159740788499e-02; -8.780805164740597e-02   -8.355205821924488e-02   -9.071307304512877e-02   +1.576704816169109e-01   +1.476224789895402e-02   +3.318213124627691e-03   -8.994775291023083e-02   +2.406355762373830e-01; -2.392815653573630e-01   +1.144301057864032e-01   -1.752888341859069e-01   -2.424221651662566e-01   +2.682940813871714e-01   +2.953695568820150e-01   -3.328895527755865e-02   -6.264561194080427e-02; +2.430969336223781e-01   +2.794331193212951e-01   -1.569143025273636e-01   +1.687672473857874e-01   -2.184276326620776e-01   +4.263175788324202e-01   -1.510154679241157e-01   +4.024623044329766e-01; -2.232952876255885e-01   +1.597889229126028e-01   +1.529636119474811e-02   -7.789902732326764e-02   -1.557709973547566e-01   -3.380253790800929e-01   +1.345127624125100e-01   -9.475473079803337e-02; +7.684015686149501e-02   +8.851540493495083e-02   +9.407085697806578e-02   +2.546309398515114e-01   -2.599989240027566e-01   -6.790451168735953e-02   -5.920633494368897e-02   +2.134220215253862e-02];
L3I_L3E_iAMPA_netcon = [+1.511468390502420e-01   -3.737578534871452e-01   -1.298157103817336e-01   +2.869823908357633e-01   -7.663517768772982e-02   +7.138597037196942e-02   +1.653946764542048e-01   +2.491137216996800e-01   -7.376773980780713e-03   +2.554326042604542e-01   -4.518020120376434e-02   -8.737983525400167e-02; +2.081865353312417e-01   -1.092209372173205e-01   +2.125640233030587e-01   -1.526929871730009e-01   +1.203837699080927e-01   -1.709840314387534e-01   +1.888043421860482e-01   +3.225304331221165e-01   +2.272345966195965e-01   +1.198437131413262e-02   -2.456483936775428e-01   +1.143116544818474e-01; +3.143323088994509e-01   -1.880166480328829e-01   -4.127668753888408e-01   -9.476627868204514e-02   +8.817104890483121e-02   +1.321541352018802e-02   +3.380465193737815e-01   +7.910219627103984e-02   +1.197927219802909e-01   +2.634781156565213e-02   -7.036274346415861e-02   +2.172040236068967e-01; -1.920299634037416e-01   +3.987833183657793e-01   -1.871693569825960e-01   +2.285549380877672e-01   +1.723357286428050e-01   -1.460982703955035e-01   +1.587755478819969e-01   +7.438302269419428e-02   +1.061117665308206e-01   -3.818396892031881e-02   +3.753344007567559e-02   +1.054144532210048e-01; +3.315486924822549e-01   +1.927307948345874e-01   +4.542955457592266e-01   -1.122099263059119e-01   +3.607617242204957e-01   -1.680599073587028e-01   +2.575040529950975e-01   +2.923407554143199e-02   +2.584748348938803e-01   +8.103998932216780e-02   -1.574052129249388e-01   -1.538432914603143e-01; +2.391980924563176e-01   +1.803950147782387e-01   +3.250550648197569e-01   +1.249838337152638e-01   -2.548429550332164e-01   -2.665487213138469e-01   -3.330656505017491e-02   -1.282110897111859e-01   +2.665156023450208e-01   +3.741125085289703e-01   +9.435339371055183e-02   +4.595352730592406e-01; +2.603453340331405e-01   -8.093721548235722e-02   +3.604508837052099e-01   +2.057355142184444e-01   +2.681178080278426e-02   +2.493052141120441e-01   +3.196866927641464e-01   -1.867238900049630e-01   -5.305045929849779e-02   -6.049483262275303e-02   +1.515113737719924e-01   -2.191423589491117e-02; -2.063612747933077e-01   -1.667584563856840e-01   +4.107784043773783e-02   +2.046893938182283e-01   +1.933632580159147e-01   -3.009992184806494e-02   +1.483251464985846e-01   +3.350024949733506e-01   +5.661420157392925e-02   -1.946561523723661e-01   -1.915658454027395e-01   +2.519141048721556e-01; +5.562925698104011e-02   +4.032293715648701e-02   +1.551481715406686e-01   +3.229689556237374e-01   +2.926708018921572e-01   -2.603957198906643e-02   +3.416809336879557e-02   +4.380617346701185e-03   -2.642682971677578e-01   -1.205687283582186e-01   +3.987060586581508e-02   +1.917573569030805e-01; +3.013551540478618e-01   +4.029365368040675e-02   -1.686853085536494e-01   -1.378092747153087e-01   +9.963355999212298e-02   +4.248815944250013e-01   -1.126651411712767e-01   -2.697170653385867e-02   -6.245062630787027e-03   -2.180784945011530e-01   +1.621846195291904e-01   +2.210379408335811e-01; +2.033205380254693e-01   +2.189723586541940e-01   +2.247470031122823e-01   +4.206167563280529e-02   -3.284145037264496e-02   +2.799736488681566e-01   +2.365124168079918e-01   +8.286678564161545e-02   +1.673066264014706e-01   -2.382022822829448e-01   -2.592737747104782e-01   +1.144287315180417e-01; +3.544341602428197e-01   -1.135408462948311e-01   +3.977879124149942e-01   +2.785161877839090e-02   +2.066017249534267e-01   -3.672686179474385e-01   -1.310126182322099e-01   -1.966010277610276e-01   -1.594245353984380e-01   -1.726171676975054e-01   -4.555968202798357e-02   +3.646174864301806e-02];
L3E_L3I_iGABA_netcon = [-2.873446746867998e-01   +2.263893100984115e-01   +1.283074506414230e-01   +1.117257719876363e-03   +8.604380562890958e-02   +9.324913374176419e-02   +4.601138478264113e-03   +4.331347248535020e-01   +8.844641517970227e-02   +2.212097585692405e-01   -4.782705637509509e-02   +2.724451014109067e-01; +2.316355497067370e-01   -2.006235750625086e-02   +3.700584547455709e-03   -1.054313318849741e-01   -2.358666050982490e-01   -3.062730757783038e-01   +1.909167030393499e-02   +1.934401854482143e-01   +2.155031839550627e-01   +1.672054935464500e-01   +6.234709814896754e-02   +7.075054786986477e-02; +1.361507488219179e-02   +1.151050526522557e-02   -1.389133236437948e-01   +3.064663771301981e-01   +2.531835677969367e-01   +6.363260029052754e-01   -7.508226573267490e-02   +1.180453207474655e-01   -4.033986971353727e-02   +2.729465651423944e-02   +5.705764603463929e-03   -2.693599148500696e-03; +1.991766687372521e-01   +7.930456369847770e-02   +8.610533718275218e-02   -3.165889291080718e-01   -2.101559190694931e-01   -1.245571063711090e-01   -3.462475618488893e-02   +3.634972232704513e-01   +9.449461491163658e-02   +7.877438231539552e-02   -1.411815503750520e-01   -1.041208544617662e-01; +1.674394637649485e-01   -2.208353729474373e-01   +2.222806096599052e-01   -2.920324838347162e-01   +1.271015018483957e-01   -1.388632133053432e-01   +1.260967466369697e-01   +3.396789105368004e-01   +6.971579512865264e-02   +6.265320739753014e-02   -2.531686867861049e-01   +6.397708921722696e-02; +9.522252794721067e-02   +2.622656210092379e-01   +4.316131273152733e-01   +9.090660636594561e-02   -3.265623650763362e-02   +3.744290253420770e-02   -9.985780430976840e-02   -1.064795792222217e-01   -8.329985339010337e-02   -1.799172890358857e-01   -8.069791289568296e-03   +9.997596110342652e-02; -7.313748593026037e-02   +2.112415058730657e-02   +1.461198998973709e-01   -1.340261982226164e-01   +3.278486987061143e-01   +2.053991826802069e-01   -1.427270128067780e-02   +7.178814098870467e-02   +3.680836927970873e-01   -1.785567465893202e-01   +2.730883272299958e-01   -1.579451559108864e-01; +3.770472335158648e-03   +1.849776571291202e-01   +1.497226085823750e-01   -7.964618865782705e-02   +2.979876701841574e-01   +1.157746110812478e-01   -1.161880082645189e-01   +2.168664983850945e-01   -5.563364779131429e-02   -1.627319019106489e-01   -1.357399635220482e-01   +1.430913491638427e-01; -2.253158255229196e-01   -8.820363381214257e-02   -2.469865547577531e-01   +1.715303922099518e-01   +1.020985551009082e-01   +2.208092130241818e-02   +2.952535065179133e-01   -2.309119376515531e-01   +1.606824887855357e-01   -9.237203987474388e-02   +3.570489417363294e-01   +4.271301777045292e-01; +1.289142095158471e-01   -1.351636305066163e-01   +5.221469034440878e-01   +6.381891225901845e-02   -2.676655115271060e-01   +3.574580651965668e-01   -1.822590192632810e-01   -2.648155253945351e-01   -1.958951247051087e-01   +4.033549251241306e-01   +1.687841640376994e-01   +1.087874679351880e-01; +4.288289328676005e-01   -3.351335530973127e-01   +4.967404489349858e-02   -4.948150043558031e-02   +5.046019066091791e-02   +2.406721137976940e-01   +2.272680442518659e-01   -9.253971553335769e-02   +1.273609416479088e-01   -2.872837663469122e-02   -1.229637224317429e-02   +4.539273681298038e-02; -1.194474462546790e-01   +2.332157216455883e-01   -9.747484052954138e-02   -5.010655606730433e-02   +2.764023177169481e-01   +3.002407807875973e-01   -1.859742867904500e-01   -1.201619939983571e-01   +1.510948345685688e-01   +2.211825454454619e-02   -2.168595948002100e-02   -9.985946606675754e-02];
L2E_Input1_iAMPA_netcon = [-1.266076717563477e-01   -2.474289479616883e-01   -1.933989465161846e-02   +2.398380583952695e-01   -1.399423030178442e-02   -8.628990173998531e-02   +4.600343240393057e-01   +1.702643095003104e-01];
L2I_Input2_iAMPA_netcon = [+3.122516529668501e-03   -1.385338920420004e-01   -1.143016933030257e-02   -7.063519189521289e-02   +2.509289228774749e-01   +4.760880649430371e-02   -2.754936892776308e-01   +4.516372563723586e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
