function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.351528269872660e-01   +9.091440495274238e-02   +1.808166926326630e-01   +1.208943640792189e-01   +7.939174787413615e-01   -1.122613396404178e-01   -8.727248662454126e-03   -1.972274221735583e-01   -4.825566054154902e-01   +2.524186400832518e-03   -2.154278519775253e-01   -4.389400185322910e-01   +1.270504368920370e-01   -1.012771369136635e-01   -1.656269846351325e-01   -5.724209225076605e-01; +4.976140555483145e-02   +2.212084873116755e-01   -3.376987004524679e-01   +2.244909373868456e-01   +1.377008067483754e-01   +2.514575034432376e-01   +2.384267268785918e-01   +1.525592798123335e-02   +3.421189315930927e-01   -3.591761049018815e-01   +3.411912055877910e-01   +7.948578758760755e-01   +4.290272037547960e-02   +2.744404409138751e-01   +3.305290077206607e-01   -1.720930409040645e-01; -7.180194413687314e-02   +2.002758338197025e-02   +3.783107178495092e-01   +2.803808172883611e-01   -2.214127076914237e-01   -4.518819675199005e-02   -2.630920958702216e-01   -5.263670501325621e-02   +3.814838659770443e-01   +5.588858306226860e-01   +8.068780091303422e-01   -6.245024233951852e-01   -2.204048361917601e-01   +9.432881646793818e-02   +5.582918479079813e-02   -1.860425793921745e-01; +5.954402777171866e-03   -2.743946683663154e-01   -4.012056560782503e-01   -4.756678697576100e-01   -4.912708610942564e-01   -1.870003869206293e-01   -2.636950368331801e-01   -1.558035790856456e-01   +4.471135396013570e-01   +1.166089034722795e-01   +1.687616602921455e-01   +3.757651255222817e-01   +4.556800820492736e-02   -3.795051456758672e-01   +5.065349062856689e-03   +5.481724507353134e-01; +4.748767071236041e-01   +5.026020595406249e-02   -7.302270423689267e-02   +3.897194532772907e-02   -1.097862389582179e-01   +2.833692936500442e-01   +4.745098461697677e-01   +2.378622792434509e-01   +5.717194661923929e-01   -6.841331906348608e-01   -2.646307217177610e-01   -2.977038455645935e-01   +1.697411794596883e-01   -6.228828368109479e-02   +4.025797965461136e-01   +2.010037099250636e-01; +2.509904754036266e-01   -2.045293632525899e-01   +2.548365508086362e-01   -5.119347761444727e-01   +3.180031352796793e-01   -1.034970254629304e-01   +2.022208730954110e-01   -6.946152866095869e-01   -3.505973394463282e-01   -1.716449366740405e-01   -6.581949167385082e-02   +5.633572113299841e-01   +1.381561581641730e-01   +6.379060004960760e-02   +3.157650515989258e-01   +3.249569128968996e-01; +1.033621598467851e-01   -2.763456887462122e-01   -1.518363469286081e-02   +4.228229182287515e-01   -1.253712053028416e-01   +3.924056832656679e-01   +1.563459100112094e-01   +5.612321597535046e-01   +3.459593826151035e-01   +2.278251850056269e-01   +3.531516988028384e-01   -3.200551129713630e-01   -2.632920431128626e-01   -6.950827092195871e-01   -3.100944286700764e-01   -2.548714371753915e-01; +3.004001735608436e-01   -1.132561486347792e-01   -4.119999351189263e-01   -3.782188944289175e-02   -2.200856452351754e-01   -8.772078584650249e-01   -1.023459520275796e-01   -1.658132640968255e-01   +1.734120789254918e-01   -4.721532492224261e-01   -8.324530003832875e-02   +6.099589455216269e-02   +6.639658171090415e-01   +4.178739545124706e-01   -3.824784829544351e-01   -3.457489918918076e-02; +2.025104880154303e-01   -6.933431200385934e-02   +5.120854609363519e-01   +5.288551403452721e-02   +2.035813872263075e-01   +1.491818333200021e-01   -6.595066084261682e-01   -2.084989675633153e-01   +3.408619136356209e-02   +1.531921432451027e-02   -7.776538509229166e-01   -3.362147023658532e-01   -1.611143009884532e-01   +1.218318112563288e-04   +3.998497736994904e-01   -1.229434957601183e-01; -1.764709709138976e-01   +8.657619815481436e-02   +2.051618727801349e-01   -1.966709402608649e-01   +1.490719123504211e-01   -3.664843025835530e-01   +2.608762558067103e-01   -2.408997119512230e-03   +2.914229258724214e-01   -1.207242247920897e-01   +4.888080455582932e-01   -1.662293283837852e-01   -2.334239277952097e-01   -2.701850707182286e-01   -6.995405249967429e-02   +4.249412240821576e-02; +6.402845758624705e-01   +8.810686112251069e-02   +3.931321694123374e-01   +3.589841989098410e-01   +1.425885053186779e-01   +4.788801175657947e-01   -1.886057787266691e-01   +5.771705333672544e-01   +7.602462592569784e-02   +4.636256869399358e-01   +1.333676583803276e-01   +6.251851378045413e-01   +2.128844762186012e-01   -6.928042101725567e-01   -5.883076059399024e-01   +2.169930940742471e-04; -2.636221461861711e-01   +8.321212821075279e-01   -6.371512021268672e-01   +6.539391855587881e-02   +2.874343845897322e-01   -4.830363554738479e-01   -1.820967445024126e-01   -6.547354682654577e-02   -3.041074614104758e-02   -1.287804251196908e-01   +2.820456683528520e-01   +4.797342411074627e-01   -5.056373287920177e-01   +9.112087096179639e-03   +4.881849067035784e-02   +1.206699456613563e-01; +1.760517467640645e-01   +5.065019220004240e-01   -1.955063475776972e-01   -6.791830572911423e-01   +3.336723934481775e-01   +4.029906585458289e-01   -2.544748685846807e-01   +7.945512836860188e-02   -5.689408981968982e-02   -3.076828996190529e-01   -3.904454941604016e-01   +7.262956712193730e-02   +6.835293292987499e-01   -3.089884273111999e-01   +4.319591462084366e-01   +1.943866071498398e-01; -2.096408126552090e-01   -5.466530711185282e-01   +3.093920914381619e-01   -2.544509036437633e-01   -2.924190317907592e-01   +5.046474683104588e-01   -3.255621811913869e-01   +1.652804788563393e-01   +1.240511918388668e-01   +2.463608349376405e-01   +5.084817449881495e-01   +3.447518712428029e-01   -3.214970821954923e-01   +2.972778388509968e-01   -7.688445804472639e-01   -5.402571030126375e-02; -3.246525551801956e-01   +1.774955697973625e-01   -1.935503219761689e-01   +2.772072616415803e-01   -2.722620708811172e-01   -1.406030980564663e-01   +2.079553118234193e-01   +3.119653996907612e-02   -2.064296271174235e-01   -6.837474706832349e-02   +2.970571391097057e-02   -6.116838382499752e-02   +2.515987664884826e-01   -4.044810563803073e-01   +2.590010658233117e-01   +6.677360784181928e-01; +1.139581981637240e-01   -1.620188929802252e-02   -2.455010404597586e-01   +3.573591299629021e-01   -4.322381174347129e-01   -5.364191366714119e-01   -1.199036190493245e-01   -4.510710567036481e-01   -4.607072304483442e-01   +2.517495112151676e-01   -1.134949384892510e-01   -6.352822551914106e-03   +5.208136516148123e-01   -2.699960094953101e-01   -4.553071249350002e-02   -8.029032174978568e-02];
L1E_L1I_iGABA_netcon = [-1.135179678664612e-01   -1.402709632487756e-01   -2.257353494116533e-01   -6.276591343379961e-02   +4.895660789395927e-01   -1.152431869068470e-01   +4.558816326991227e-02   -1.138732382083141e-01   +4.558228297469150e-02   +4.482418301223367e-01   -1.250067473450628e-01   -9.521997687345184e-02   +3.552152000198324e-01   -3.875247399106205e-02   +2.661296370143106e-01   +3.791558995037055e-01; +1.884887918681593e-01   -2.760950147670031e-02   +9.861183082502314e-02   -1.008232132399593e-01   -7.910739009408663e-01   -4.208995298763000e-01   +5.801348461970293e-02   -3.406445265230831e-01   -1.230968661989605e-01   +1.426987328890052e-01   -6.553890246335624e-01   +4.724672471178766e-01   +2.246076403496672e-01   -3.224141968371459e-01   +5.172414103412340e-02   +6.852363911838771e-02; -3.792692504540823e-01   +3.326719085575834e-01   -2.779149917027459e-02   -3.694257108026493e-01   +2.414970187389698e-01   -2.357743272727231e-01   -8.440438099506550e-03   +2.529208894607869e-01   +6.377155863023370e-04   -2.353477385664406e-02   -4.306465752142964e-02   -4.160854238125150e-01   +3.667155858013010e-01   +2.835081762148497e-01   -6.786762005209104e-01   +2.078469161970121e-01; +3.099430957218023e-01   -6.451862554572452e-01   +3.088987572392300e-01   +6.924494634798227e-02   +2.351362654006459e-01   -7.408329076274519e-01   +1.928915671576848e-01   +1.209232430757824e-01   -8.675771836079860e-02   -3.865223575462450e-01   +2.071128418899671e-01   -1.491616633390435e-01   -4.035871892282362e-01   -6.417256782757887e-01   -6.056677346253217e-02   -1.507124586289450e-01; +1.526565774160789e-01   -1.352426553784288e-01   -1.061842474099651e-01   +2.259616951636025e-01   -2.343215217914937e-02   -1.907978929016336e-01   +5.783851294591473e-01   +6.621713686839995e-02   +1.404488114476211e-02   -4.250104281284324e-01   -1.335629485698745e-01   +2.402758500889405e-01   -1.097158731696328e-01   -1.342254790233826e-01   +3.057424235646827e-01   +1.489767773468995e-01; +1.470117219596605e-01   -3.078823820037009e-02   +6.891413223937659e-01   -1.978074914993781e-01   -1.732726700714693e-01   -4.565580729742635e-02   +1.985642298140435e-01   +1.187306550553927e-02   +3.769131012418939e-01   +2.084044082735282e-01   +4.189735296954876e-01   +2.138938709148477e-01   -4.974127126731506e-01   -1.031137074716046e-01   +5.156966837739779e-01   -5.652430224332178e-01; +2.105675356208084e-01   +6.803835489941057e-02   +6.487108200881901e-01   -2.418466811620854e-01   -3.691293104098753e-01   -4.141767735908201e-01   -2.318782182418742e-02   +3.868043867092282e-01   -1.554275822560244e-01   +3.386152106206305e-01   -1.965695861499468e-01   +2.465054070001159e-01   +4.105956676516893e-01   -1.549848799881606e-01   +3.853505959225028e-01   +3.941584428928226e-01; -3.918292397289520e-01   +9.898701677023844e-02   -3.196042816184957e-01   +1.590452750234412e-01   -4.669047660414071e-01   +2.860015994735087e-01   +7.061383190155598e-01   -6.692106756901954e-01   +8.899495115665339e-02   -1.722858946914778e-01   +5.436958120769346e-01   +2.498548315052467e-01   +7.401857503434585e-02   -3.186240130472487e-01   -2.672200397723297e-01   +2.304993486198082e-01; -3.209756289135529e-03   +6.483643193087592e-03   -3.623195849487347e-01   -2.252593280852674e-02   -3.579801564570271e-01   +4.257783062345620e-01   -5.511967473082010e-01   +1.940762891563325e-01   +2.263541329374678e-01   +3.282677130661495e-01   -4.948018262478410e-01   -2.574283859873931e-01   +2.155583976896560e-01   -4.048576411898353e-01   -3.868860839966200e-01   +2.055493154330572e-01; -3.602844557543670e-02   -2.044418498427272e-01   -2.468239931639334e-02   +2.277991661819926e-01   +1.942878554557216e-01   +2.998034839415332e-01   +2.047124204725120e-01   -1.874653670859070e-01   -2.747730137591113e-01   -1.363279005937899e-01   +2.886104382974423e-01   -3.126541449487191e-01   -2.277066546324123e-01   -2.358059346638172e-01   -1.558368152555922e-01   -9.284137943867608e-02; -7.749724585596127e-01   +4.243202606000391e-01   -8.419775643215879e-02   +6.562204946593381e-01   -1.730170937996194e-01   +1.725199625922807e-01   -1.328222679201901e-01   -5.576586986709801e-01   +1.604563742178931e-01   -4.119078137568165e-01   +3.502704247412008e-01   +7.140038796934337e-01   -2.578644190131625e-01   +1.838357644383511e-01   -2.147782426113429e-01   -7.594578674294882e-01; +1.267261728563658e-01   +2.018597970526796e-01   -1.303796153743049e-01   +1.915242695349990e-01   -2.504190150629363e-01   -4.800474610785815e-01   +2.157709773621838e-02   +9.520614713973702e-02   -5.282972403985267e-01   -5.643115693420971e-01   -3.874500908566043e-01   -5.066644591698033e-01   +4.133508365519825e-01   +2.445692388173847e-01   -6.598506962525418e-02   -2.293129268066179e-01; -3.474713369593954e-02   +1.919856606691551e-01   -2.416661511196669e-01   -4.522416305058137e-01   -1.000417219767257e-01   -2.462114662715988e-02   +9.230645959078659e-04   +3.272194939519826e-01   +6.709097957236590e-02   +3.958423855817703e-01   -2.968575205216799e-01   -5.516460725551542e-01   +3.490518974541668e-01   +5.512631792452483e-02   -2.825649339149200e-01   -2.036510645202331e-01; +2.237610243689689e-01   -1.547329393691545e-01   +8.199314702693550e-02   +5.395129349825736e-01   +2.462367424370502e-01   -2.771835961758162e-01   -4.303071982971026e-01   +3.330865335443783e-01   +5.864330989801152e-01   -1.582806558015702e-01   +6.131130144487554e-02   -4.711182616132961e-02   -2.699408547564581e-01   -1.701172755319924e-01   +3.262631835669428e-01   -5.070514149108589e-01; +2.832522607173509e-01   +3.605865120903152e-01   +1.358949199331905e-01   -1.758367840884328e-01   +2.830407722328294e-01   +6.520703066369150e-02   +2.390452159937878e-01   +1.956581341569880e-01   +2.028968265239516e-01   -6.818051430990237e-02   -1.897637907263435e-01   +1.682255930737381e-01   -3.343546472777202e-01   -6.765392870701091e-01   +7.245941971148187e-01   +3.249617674867196e-01; +3.830430092394851e-01   +3.608763373352709e-01   +7.268285538426958e-01   +3.024217960934534e-01   +3.637222158000398e-01   +1.868576110138281e-01   +3.498002027078810e-01   -6.516847548654363e-01   +1.302806720599251e-02   +5.686115842841605e-01   -6.901228824970579e-02   -1.266025827368482e-01   +4.413803081099371e-03   -1.429408377517077e-01   -1.251914074584853e-01   +4.231894176573013e-03];
L2I_L1I_iGABA_netcon = [-4.853536852974910e-01   +3.923159638876587e-01   +3.654424596310032e-01   +1.974143984612624e-01   +5.461251213736463e-01   +2.806125675231718e-01   -3.034870706654994e-01   -6.468424993365810e-01; -2.446320968991220e-02   -1.785755410925734e-01   -1.996640113748625e-01   -1.732545117919342e-01   -6.866802054365001e-01   +1.728551773888684e-02   +2.008675338294753e-01   +2.492728341342378e-01; +3.949651721711960e-01   -1.554306959235211e-01   -1.764389829261093e-01   +5.373904451984457e-01   -1.143230583997995e-01   +2.681660469899072e-02   +5.843784437224507e-01   -9.807614479631993e-02; +3.573175171120735e-01   -3.571548073159528e-01   -1.767808292314231e-01   +1.250245956587362e-01   -2.270793654108915e-01   +3.085410498032741e-01   +3.459243185968602e-01   -4.398042333172628e-01; -1.661059546111569e-02   +3.668524952903556e-01   -1.631400245636664e-01   +3.412668382835216e-01   +2.601372075659873e-01   -2.180779594590594e-01   +3.044110491378175e-01   +1.864299650512607e-01; +2.134375934801800e-01   -3.487005367896567e-01   -2.270307338346172e-01   +5.527796593295835e-01   +6.140382650562520e-01   -4.535746960947217e-01   -2.864988745961718e-01   -7.892202484417562e-01; -9.396281156984887e-02   -3.216829677078948e-01   -1.546489084769980e-01   -4.195705227510873e-01   +3.557681315940659e-01   -6.484027284478218e-01   -2.171675457761723e-02   -4.578358149072537e-01; -5.205280400746765e-01   +5.048826974094633e-01   +3.469505890515152e-01   -4.026841230091816e-02   -1.131118012441743e-01   -2.693336620111199e-01   +2.952173174525909e-01   -1.125419984200506e-01; -2.116113013391463e-01   +3.517102487659626e-01   -5.026169816764581e-02   -1.049939067824721e-02   +1.418858228787669e-01   -1.800454760919228e-02   +4.942202106616729e-01   +1.878532447841988e-01; -3.363288627507209e-02   -7.079080072561297e-02   +4.298743171890162e-01   +9.834852489028317e-02   -2.735310838599092e-01   -1.835818569281145e-02   +3.694190467208859e-01   +2.693158985071007e-01; -8.539944910216030e-02   +1.241016480975260e-02   +1.063757904059319e-02   +3.179449619853565e-01   +9.852744791684187e-02   -1.529707120590336e-01   -3.308563063505465e-03   -3.003280436514304e-01; -6.772426823767295e-01   +5.514791892690700e-02   -2.706266416708014e-03   -2.859959040144225e-01   +1.126836439906591e-01   -1.207583984879831e-01   +4.424455289166683e-01   +5.829120078533394e-02; -3.421860197734886e-01   +4.465452586085555e-02   -7.741740828581157e-01   -2.317899999572378e-01   +7.677169077019416e-02   +3.054159072543086e-02   -6.046773852452283e-01   -5.984164830347835e-01; +2.419327799144726e-01   -4.798915362503603e-02   +2.647693977178612e-01   +4.800577868980100e-01   +2.438024478436191e-01   -5.100054685997835e-01   +1.231263260504586e-01   +1.586633176370681e-01; +1.896120485265995e-01   -5.478897904205571e-02   -2.440909709384582e-01   +1.063433849007468e-01   +3.615896723110618e-02   +4.971631155964419e-01   -5.101907851883403e-01   -1.727821505146234e-01; -3.497103077076895e-01   -5.032310181828054e-01   +2.350222381305132e-01   -1.407826386158021e-01   +9.572904425447480e-02   +9.632600843333237e-02   +2.213427380766596e-01   -2.302076915846513e-01];
L1I_L2I_iGABA_netcon = [-2.712116911753718e-01   -2.753544413159997e-01   +3.100520336340404e-01   -3.806593044879412e-01   -2.326482113865884e-01   -8.583435865659546e-02   +2.509186584428901e-01   +9.661332098876321e-01   +2.258374200082366e-01   +5.893066408080087e-01   +5.364683501391003e-01   -3.208799401767681e-02   +7.124104996843830e-02   +1.194751035307092e-01   +3.346670425494681e-01   -3.069357612445485e-01; +1.423812452378327e-02   -2.431572962753000e-01   +2.364265354909668e-01   -3.896668351125278e-01   -1.478878014029787e-01   +1.775853856584968e-01   +2.736130321478766e-02   +2.616550319550049e-01   -1.141919059965970e-01   +3.472853983809688e-01   +6.379948441410741e-01   -2.284705039795892e-01   +1.201289610885650e-01   -8.663071595590033e-02   +2.542933874941823e-01   -2.287204347590407e-01; +2.361694118684915e-01   +4.809240942455179e-01   -3.322187385030455e-01   +2.087740834075548e-01   -7.973492891692557e-02   +1.719406785372143e-02   -3.854580505755716e-01   +1.139848212650368e-03   +5.864554966887256e-02   -4.021805027218508e-01   +4.802056607986878e-01   +4.623394046837161e-01   -1.489983668751912e-01   -1.741208929831442e-01   -6.090879040519195e-01   +3.230597129693629e-01; -1.446744966618652e-01   +2.340413628870896e-01   -3.291780168814155e-01   +2.458257504438874e-01   +4.723283603496544e-01   +4.591647825447154e-01   +1.323932150967550e-01   -1.218637037061469e-01   +2.448003305966226e-01   -3.635367369044550e-01   +4.108051479289307e-02   +4.125903698040282e-01   +5.726583654237344e-01   -4.104259532987501e-01   +6.808048593023139e-01   +3.304408169432407e-01; -1.430623494362764e-01   +4.873841685333455e-01   -5.042808710374455e-01   +8.590882807841221e-02   -5.645267879710038e-02   -1.911285452375455e-02   -5.970508842798793e-01   -1.803578699378235e-01   -3.919009998754270e-01   -7.319102421839659e-02   +5.643213158047214e-01   -1.354962978269996e-01   -1.810134909044472e-01   +2.850519867890373e-01   -1.594644581791881e-01   -1.644149363087186e-01; +2.109736197069519e-01   +4.641172514798791e-02   -2.775842377685112e-01   +1.991159958258154e-02   +6.449692371633732e-02   -1.803719791248787e-01   +3.951188983878017e-01   +3.273486306706642e-02   -9.757446590499547e-02   +9.674297937083687e-02   -9.206023239373667e-03   -4.217022379293832e-01   +2.387667719705562e-01   +2.457800182449277e-01   +3.015949833683231e-01   -3.512865315681490e-02; +6.651878594834608e-02   +6.487182796609037e-01   +2.883609697400907e-01   +5.521780253791789e-02   +1.434306175778563e-01   +9.840726917194556e-02   +1.382946113511412e-01   +2.576807041319982e-01   -5.668753810348794e-01   +4.299265337603502e-01   +3.526016561493112e-01   +5.222121979149082e-01   -1.970854530355311e-01   -7.523138346444684e-02   -3.279902037391658e-01   +4.813423466890294e-01; -4.400674037839180e-02   -4.689717533822773e-01   -8.546784539230663e-02   -9.914817727328146e-02   -6.875013905910067e-02   +4.857071011783446e-01   +1.650584244854430e-01   -1.371396905856598e-01   +2.315991954525015e-01   -3.511298461564518e-01   +6.557554193717052e-02   -1.177250336554948e-01   +2.838921784161967e-01   -2.987870192201381e-02   +2.879491429009432e-01   -1.508303229291711e-01];
L2E_L1E_iAMPA_netcon = [-3.558250529977072e-01   +9.333548031993463e-02   -3.234370447791940e-01   +1.777054868499187e-01   -1.422234104329194e-01   -1.319738020173394e-01   +8.636740579008595e-01   +3.353444948869132e-01; -5.259743746507644e-01   +1.311702200413717e-01   +1.674320704489583e-01   -3.038992095963238e-01   -1.789386403218393e-01   +4.098341685740211e-02   +4.212288447943174e-01   +2.172089999047329e-01; -2.752611523085431e-01   -3.802342658266697e-01   -9.153164398966977e-02   +1.493970257957275e-01   -1.780530384030437e-01   +2.367792958783033e-02   +3.683810284213016e-01   -7.959780901683809e-02; +3.585837085647621e-01   -2.808320865784387e-01   -8.050009895737655e-02   +6.602977053637761e-01   -2.413757733887736e-01   -2.778952412875305e-01   +2.686637504751865e-01   -4.680629112919270e-01; +3.704803679119039e-01   +1.930228114514007e-01   +4.004311046034222e-01   -3.384584507134547e-01   -6.606101263046930e-02   -2.593703649173967e-01   -4.452655535431856e-02   -1.714323304436558e-01; +4.949038140648416e-02   +2.727876282158757e-01   +2.586105841736935e-03   -4.278704362112117e-01   -8.661740726183992e-01   -1.253434904849004e-01   -6.798943700708238e-02   -2.904185463614206e-03; -4.556401053624920e-01   -1.582242585751931e-02   +4.428304097013925e-01   +4.787041544902306e-01   +4.593630453954513e-01   -4.458574241059482e-01   +3.627969522603499e-01   -2.802534361003284e-01; +9.862856047347521e-02   -7.658250710034441e-02   -1.142079127330693e-01   -5.871549431423480e-02   +2.172639857452204e-01   -3.342570859759203e-01   -6.149116420386875e-01   +3.495572277531420e-01; -7.361648744502597e-03   +1.570157415694565e-01   +6.328393004011363e-01   +2.709236992521164e-01   -5.700205921328830e-02   +3.230482626494375e-01   +5.277796948172787e-02   -2.498007735888810e-01; -2.807205706030436e-01   -2.611870338907475e-01   -1.458362169368645e-01   -2.521512560047336e-01   -1.475910345488721e-01   +6.482282234932559e-01   -1.176852136508476e-01   +2.301800500543193e-01; -3.695397865786878e-01   +4.392970878321899e-02   -6.492285743611546e-01   -4.958804588775928e-01   +9.982833308865241e-02   +2.111319723011595e-01   +5.379107467958842e-01   +1.217747465290765e-01; +1.624191753563584e-01   +7.040449941323199e-02   -2.803767741154006e-01   -3.020308404598714e-01   +8.871280019045910e-02   -2.755065354136840e-01   -1.360887669636415e-02   -2.908261818124185e-01; +7.198296045033739e-02   -1.864143320184693e-01   +3.855335419692862e-01   -5.449301806186237e-01   -4.559247507143623e-01   +9.417056043194483e-03   -3.247818931771724e-01   +1.481215208525122e-01; -2.039496143884208e-01   +7.043593332781123e-01   -9.672592854165335e-02   +9.602757673234677e-02   +1.789654248268058e-01   +4.683341620819527e-02   +4.122030354989830e-01   +2.405943421231277e-01; -1.279747774987342e-01   +2.701096847134816e-01   -8.334972108103383e-02   -1.064058407769931e-01   +4.218790950312339e-01   -1.920715452732740e-01   +5.840304855512903e-01   -1.972779324032000e-01; +2.216150453459481e-01   +2.101576954369770e-01   +2.730146166143150e-01   +7.875004326669922e-03   +3.259671127530085e-01   -4.077368001273076e-01   +5.495237102100148e-01   +2.973845926450781e-01];
L1E_L2E_iAMPA_netcon = [+3.495901047856748e-01   -3.978847437210037e-02   +1.742267988930822e-01   +1.610633618580681e-01   -1.355025832713165e-01   +3.247740188051319e-02   -3.666322339577976e-03   +1.988722085652913e-01   +4.475668701896304e-01   -3.278728985915715e-01   +1.897613166685203e-01   -6.807854778720618e-01   +1.089467475673119e-01   +1.407285106311286e-01   -2.459417342769816e-01   +4.057923177477263e-01; +2.242149399898397e-01   +1.338738721819758e-01   +4.833319336313157e-01   +4.142600269900006e-01   -3.059492949714741e-01   +5.733379090100732e-02   +2.140021264696370e-01   -9.284409197179294e-03   -1.007069362884965e-01   +4.227682000465633e-01   +1.727173584104232e-01   -4.444106618043935e-01   -3.194622432749853e-01   -4.327944923855573e-01   +3.722819117060886e-02   -7.146081116276495e-01; +2.539559429627489e-01   -2.249570518597595e-01   +1.582538885985174e-02   +3.957685699550363e-01   +6.373026924239894e-01   -6.610041252593046e-02   +6.886698754423175e-01   -2.500471973974189e-01   +2.082818541132154e-02   -2.466567614407542e-01   -1.878599067789697e-01   +1.634522685506800e-01   -1.440778695911371e-01   -8.821809165915320e-02   -2.797097317477831e-01   -3.466474768901943e-01; +2.713047725715166e-01   +5.054674358591195e-01   +7.082395106686473e-01   +1.878759617691802e-01   +3.849046259474832e-02   +1.150847379904736e-01   -8.246441407821932e-01   -6.471885300930305e-01   +1.278018137724620e-01   -1.886028372640810e-01   -1.416716752198719e-01   -6.881130632353385e-01   -2.647081761385947e-01   +4.862305155605176e-01   +6.306067310106153e-02   -7.164233254060559e-02; +4.714163876395074e-02   +7.337901873104943e-02   -5.318004447195591e-01   -5.401845051708566e-01   -2.838490617007823e-01   -6.245409448338639e-01   -5.671899810388783e-01   +2.733994507869216e-01   +2.439872157583481e-01   -2.155482025856814e-01   -1.035341248390826e-01   +2.150535502565777e-01   +2.877183724357367e-02   -6.103420887875650e-01   +5.081292943569948e-01   -5.811138431010707e-01; -4.653757127523155e-01   +2.094401229636909e-01   -1.097833328371406e-01   +3.847554525850135e-02   +3.151811996310065e-01   +2.968156494865459e-01   -4.646569205503213e-01   +2.156092991133974e-01   -4.498039071136273e-01   -5.167857779405146e-01   +5.779491082299879e-01   +1.956705917504710e-01   +4.922244391215925e-01   +1.576406938485753e-01   +2.774759521631690e-01   +1.111906543429242e-03; +5.172162629129522e-02   +4.019513095347127e-02   +5.059823686623511e-01   -3.663925830403425e-03   -4.826592751058707e-01   +1.998707007704852e-01   -9.698053804978204e-02   -5.911309568821944e-01   -1.519242998291968e-02   +1.596293248777143e-01   +9.595483979016277e-02   -2.020779537324734e-01   +1.135320668109440e-01   +1.586076215804401e-01   -9.269355272645288e-02   +3.079822554956176e-01; +1.474915602435453e-01   +1.215518393098681e-01   +3.641621953867289e-01   -5.727434921851775e-01   +6.001057700404588e-01   +5.785823757579354e-01   -3.633369760185244e-01   +1.401622900516614e-01   -6.110672467123893e-02   +7.247017065403593e-01   -2.055181162541562e-01   +2.004459118236704e-01   -4.898344127822097e-01   -3.103214707075756e-02   +3.030430880548416e-01   +6.763357666825462e-01];
L2I_L2E_iAMPA_netcon = [+1.145508808171127e-01   -7.456552554547491e-02   +2.057285858820067e-01   -1.886064964692684e-01   -2.096334716734349e-01   -2.454611369141967e-01   +2.264660952042503e-01   -2.918391002568912e-02; +3.343619885802355e-01   -2.753269880979816e-01   -3.315793488875031e-01   -3.529571519246101e-01   -5.808448372387407e-01   +4.713812215532362e-01   +2.073844848027699e-02   +3.891911065852235e-01; +7.167877992177837e-02   -6.618061449351160e-01   +5.351350057085966e-03   +5.399163553087707e-01   -2.264777264477853e-01   +3.410945897479325e-01   -2.695543984223359e-02   -2.321323446124996e-01; -4.415910600455105e-01   +5.098337654030998e-01   -2.932555106046691e-01   -1.864372970559300e-01   +1.463585138239197e-01   -3.123898136572871e-01   +7.228469728559156e-02   +4.268718120419945e-01; -3.995002567016258e-02   +3.709288200621996e-03   -3.425898816588597e-01   -1.470755761302346e-01   -1.350857443576428e-01   -1.833756932474219e-02   -6.963390858820629e-01   -6.606865660886940e-02; -4.180160455205504e-01   +7.953896308760755e-01   +1.633843929998668e-01   -2.467147088891792e-01   -1.439895590387489e-01   -5.595231674673360e-01   +6.497172603297136e-01   +1.347475560391340e-02; -2.502407914142130e-02   -4.737958527891195e-01   -3.739042052082426e-01   +5.433359324335746e-01   +8.180019146151144e-01   +7.665728432692940e-01   -5.438898316895436e-01   -1.504844776189451e-02; -5.925479133726043e-01   +4.268396125970568e-01   -1.108500789269198e-01   -9.668261339194201e-02   -4.281499783460991e-01   +1.409809916597559e-01   +3.634730418911327e-01   -8.483541851801943e-02];
L2E_L2I_iGABA_netcon = [+8.131817720257672e-02   -3.289660855299580e-01   +1.439984285372337e-01   +2.812452819780199e-01   -3.850233732988861e-01   +5.255913195405291e-01   -8.152223285941553e-01   -4.472078430805365e-02; +9.413872681687511e-01   +1.142735118902400e-01   -2.134319842022861e-01   +2.696867260898286e-01   +4.075896192482343e-01   -3.527997605940573e-01   +5.316977987478417e-01   -7.591499434790197e-02; -1.488525569125876e-01   +4.875550428044799e-02   -1.328613705193293e-01   +6.394524067483796e-01   +2.360884101836746e-01   -1.838864155575502e-01   +6.123847008328627e-01   +3.195796033862056e-01; +1.649788884785159e-01   +5.419750752113381e-02   -2.246934276134490e-01   -2.005620760944174e-01   -4.217552125098971e-01   +4.768939658936330e-01   -2.823070995472172e-01   -3.660734430947642e-01; +6.513930681739714e-03   +8.282660007699364e-01   +1.486841809334971e-01   +3.535299336074617e-01   +6.616927730061886e-01   -2.062915079983844e-01   -1.946005171607309e-01   +2.233332744025918e-01; +3.500637214547753e-01   -4.299051580247641e-01   +4.443363831858720e-01   -4.299817766453353e-01   -2.259215120602365e-01   +3.710134395403017e-01   -1.262895402201572e-01   -2.384718790069880e-01; -2.630888694839847e-01   -7.065306000884318e-02   -1.610394016430986e-01   +4.652844343997214e-01   +4.332837089500813e-01   -1.746855067121430e-01   -5.005187415100047e-01   -5.917465768274162e-01; +1.530037120901578e-01   +5.264406747309057e-01   +4.511783474649625e-02   +2.560386218802377e-01   -4.739710118144729e-01   +8.891758984221407e-01   +7.079663000807758e-02   +4.740652788002590e-02];
L3E_L2E_iAMPA_netcon = [+4.732612539980015e-01   -3.790938328640104e-01   -1.225494049056734e-01   -1.599490865038048e-01   +3.927231437455533e-01   +3.021322917957315e-01   +3.067168293570303e-01   +4.216649744262705e-01   +6.326872968757685e-02   -9.162902102653095e-02   -4.092188154704738e-01   +4.605604319171927e-01; -3.238616697730587e-01   -5.863198333560393e-01   +1.288513911884863e-01   -4.232570826800233e-02   -1.157102609257553e-01   +1.376703479980504e-01   +5.293175684363591e-01   -1.958453073652175e-01   -3.679247163007436e-01   +6.219781694088949e-01   +1.687921318847945e-01   +1.586724050501255e-01; +2.227652598209469e-01   -2.421520589029189e-01   +2.947858704817763e-02   +5.572555439898824e-01   +3.208931216421356e-01   +5.228351432479259e-01   -1.785927298013796e-01   -7.053272462411018e-01   +5.811863460359166e-01   -1.299965204058218e-01   +2.615851862065894e-01   -4.234259872669569e-02; +3.858648993180069e-04   -5.070114404005893e-01   +2.455446954830177e-01   -3.593489576190320e-01   +9.771060842958780e-02   +2.171715547832350e-01   -4.717435492657602e-01   +5.488004967166400e-02   -4.796619921256738e-02   +7.382386443643253e-01   -6.303897636989821e-02   -3.037218778056974e-02; +2.800526145617437e-02   -1.194845553355639e-02   +2.950176294348290e-01   -6.921071578684528e-02   -1.408173997239983e-01   +2.676008611165146e-01   +2.145951847338720e-01   -1.019708899725201e-01   -2.610308756685502e-01   +1.498119027053522e-01   +3.459742142628672e-01   -1.186744678139174e-01; +2.618054468976531e-01   +4.387873045989520e-02   +3.891959781907929e-01   -2.529702441729231e-01   -3.374728075424483e-01   +5.078006908075421e-01   -3.291067992927496e-01   -6.104959849060496e-01   -1.136907740674715e-01   -1.195497049738978e-01   -4.815029155742195e-01   -4.756244536856584e-01; +9.779039302166284e-02   -2.460138253504054e-01   -5.677534761119665e-02   +6.129226036545166e-02   +2.671940466103199e-01   +1.780657274277976e-01   -7.542600506559022e-01   -3.370302961585200e-01   -4.353207420265033e-01   +1.858791832682307e-01   +1.250732969506934e-01   +7.534888415667187e-01; +4.981187563557210e-02   +3.012877324155276e-01   +1.882354357288141e-01   -4.663412516345528e-02   +7.470155032064980e-01   -5.548207245057674e-01   +4.269767904579248e-01   -6.370700617740492e-01   +4.798032961588217e-01   +2.687188058230002e-01   +2.570428431071130e-01   +2.821481838773751e-02];
L3I_L2I_iGABA_netcon = [-1.760203726126575e-01   -2.567673833367594e-01   +1.660864037462076e-01   -1.448755535929012e-02   -7.301901536515293e-02   -4.874013368813598e-01   -3.096742067187929e-01   +9.432889530480558e-02   -1.985641972387220e-01   -4.764866150131139e-02   -2.103532186605050e-01   +3.307519020883773e-01; -1.116430496027136e-01   +1.706574352915692e-01   +1.845028487904951e-01   +4.559016519396762e-01   +1.394035837580138e-02   -7.400683513105991e-01   +1.858322032159172e-01   -1.849373698980967e-01   -4.667214973742954e-02   +3.939700766597531e-02   +4.145333707534766e-01   -2.162738204178114e-01; +4.967227081525898e-01   -3.951825407191218e-01   +6.198420255931872e-01   +4.984902846787470e-01   +3.220441617450643e-01   -2.433169895852580e-02   +5.089453233247754e-01   +2.742389656819439e-01   -2.886585345549555e-01   +3.342337437526438e-01   +6.298240296415847e-01   -3.356683234502303e-02; -4.266082324226882e-02   -1.588015281699556e-01   -2.550669365921387e-01   +2.433650848225421e-01   -2.813974368138542e-01   -7.006528754938726e-01   +2.383622112660498e-01   +4.434047227375933e-01   +6.384993194828668e-01   -8.414876104728487e-01   +8.296450148970147e-02   -5.965039229324740e-01; +2.524390786330944e-01   -4.074897631920245e-01   -1.254574064034920e-01   +7.834184028209945e-02   -3.769607274588599e-01   -4.099500312948298e-01   -3.084741258470357e-01   +1.931849208288539e-01   -5.464601822641050e-01   +1.295795611853119e-01   +8.173917282571101e-02   +1.560569819903568e-01; +2.084255851115063e-01   -3.063197052410863e-01   +1.817195499712278e-01   -3.828656293600228e-01   +2.279419195880151e-01   -8.935622047555212e-01   +4.294254912743350e-01   +8.871274889552844e-02   +5.299578810733521e-02   +1.605542465814209e-01   -3.652459014634238e-01   +1.814256874614481e-01; -1.748694828234816e-01   -6.325543072285310e-01   -1.835896812490275e-02   -4.804001500169570e-01   +1.526826925252795e-01   +8.037432162967034e-02   -3.821315004613336e-01   -3.065786943808062e-01   +5.220019337543430e-03   +4.724113458101075e-01   -4.768766840876243e-01   +4.226409189253667e-01; +8.913692972431925e-02   +1.843527176731046e-01   +2.515711861587613e-01   -1.651338132336104e-01   -4.210656969170458e-01   -6.015260294664456e-01   +9.709820929185653e-03   +3.898233744526719e-02   +2.267817872591022e-01   -1.543962904722795e-02   +2.254318384731924e-01   -1.169943878130214e-03];
L2E_L3E_iAMPA_netcon = [+2.094648420772880e-01   -3.485490164748220e-01   -3.131067278934825e-01   +3.076596160310093e-01   -6.282647919011564e-01   -2.032144413427766e-01   +3.329884560348578e-03   +1.659633512132153e-01; +2.373915568841733e-02   +3.534748883036200e-01   -1.146851824035939e-01   +1.327346370583502e-01   +1.599462692875849e-01   -3.251786547239494e-01   +3.737561726058987e-01   -1.853257215284331e-01; +5.965173805409166e-01   -1.799549046919642e-01   +1.867741367627007e-01   -1.532825568831926e-01   +3.686091557191019e-01   -7.078935709743784e-01   -1.467920372478033e-01   +2.427105049967548e-01; +6.243755784810119e-02   +5.026367145788299e-01   +1.424244128188466e-01   -3.979779498107123e-01   -4.126120530664314e-01   +1.099943620440786e-01   -5.239555185600485e-01   -3.311674924493387e-01; +7.098182095225808e-01   +4.109256797613796e-01   +6.180414165136541e-01   -7.042050895001795e-01   -1.160831978405345e-01   -1.667995624654875e-03   -9.305480795797756e-01   +6.586321544643925e-01; +4.989185276040529e-01   +1.957407526951868e-01   +4.191531126612577e-01   -8.245432237511529e-01   -5.266733167396137e-01   +3.521854374087859e-01   +2.083312248941061e-01   +4.063944893451423e-01; -6.432199331080035e-01   -1.952560449453758e-01   -1.147723599119263e-01   +9.459964015669350e-02   +1.490560604038619e-01   -3.977500149658277e-01   +4.183800973253090e-01   -2.183094962450635e-01; +1.570680466100659e-01   +2.674900785259717e-01   -2.579880371354468e-02   +2.142755668878504e-01   +4.926617488543359e-01   -3.996958724240727e-01   -8.541714443220678e-02   -4.116047154612772e-01; +2.912910442207152e-01   +5.714989382320970e-01   +8.843436905667286e-01   -1.774922944780874e-01   -4.018076813824250e-01   +1.036439046017874e-02   -6.872537181623672e-01   +3.850229421582209e-01; -4.665894973958734e-01   +5.638023156144589e-01   +2.993037411240327e-01   -6.763908740041638e-01   +3.503294160863015e-01   +4.050450135478290e-02   +5.981068691907884e-01   +6.360839446463210e-02; -5.775198021342717e-01   +1.726677787712254e-01   +2.391352494547675e-01   -6.781600901375096e-01   -1.420036834364047e-01   +5.569092915087993e-01   +1.575576228796912e-01   -1.209023133625033e-01; -3.638952310509869e-01   +2.964404255554609e-01   +4.415745371015923e-01   -3.468956492649167e-01   -1.752641445536993e-01   +1.422082400123811e-01   +3.673518227325602e-01   +1.568963739690307e-01];
L2I_L3I_iGABA_netcon = [+7.990907511207383e-02   +1.162291094987244e-01   -1.640578503263455e-01   +3.284654764352964e-01   +3.812759270131653e-01   -6.049998947427323e-04   -1.510329593073520e-01   +3.275823936702947e-02; -2.396173125158233e-01   -2.150995267635168e-01   -3.439860562979973e-01   +3.690200621505913e-01   -5.726764102911576e-02   +2.440386521931164e-02   -1.882269141243938e-01   -2.489628441046290e-01; +3.232151646802116e-01   +4.584280534255286e-01   +3.606073561762072e-01   +3.660506815290492e-01   +1.087228837434499e-01   -6.831040936791016e-01   +2.036149257253859e-01   -7.141782048929323e-01; -1.100233299196689e-01   -1.381237616894443e-01   +2.723018607139764e-01   -3.262558829410332e-01   +2.688692304062171e-01   -2.781155365470185e-01   -1.595669064552124e-02   +4.068260679580359e-01; -2.480437053091722e-01   -2.685309812433411e-01   +1.050042524016653e-01   +8.661917701137156e-02   -2.641252902366807e-01   +8.076408433132863e-02   -2.157336967463830e-01   -4.111909217421303e-01; -3.111913072670136e-01   -8.784276390514664e-02   -3.766515320733057e-01   +3.225027643062701e-02   -1.960760464858051e-01   -7.736161340002753e-01   -2.295802917810834e-01   -8.752066695237787e-02; +6.511668929005927e-01   +6.846869557906956e-01   +6.057649973769066e-02   +3.353698043506570e-01   -5.156553450749919e-02   +8.179863587537003e-01   -6.383494051701966e-03   -1.952652879748218e-02; +5.449091858905624e-01   -2.579932127316496e-02   +7.463255732334889e-02   -1.568504199825387e-01   +4.800494874601210e-01   +2.852754507803686e-01   -4.469172463027354e-02   +4.545460255308956e-03; -1.270020402596591e-01   +2.805767486913399e-03   -7.601399175533963e-01   -3.054723510217891e-01   -2.595013165110323e-01   -2.499585887858018e-01   -4.229890470818109e-01   +5.035772851732045e-01; -5.798172245979193e-01   +5.728377678800019e-02   -4.220825762521088e-01   -2.026622389441983e-01   -1.817945747015052e-01   -1.788810758783241e-01   +3.195587457414433e-01   +2.193459720533278e-01; +6.624145231591011e-02   -1.859768279222249e-01   +2.809067337732124e-01   -2.738869372333713e-01   +7.293839927768574e-01   +1.836746005736579e-01   +1.535791805574404e-01   -3.403968110737186e-01; -1.290448394135557e-01   -2.193084675036125e-01   +7.896409102911470e-02   +1.363937877956446e-01   +5.417885548287896e-01   +2.144163767432641e-01   +4.640626136300373e-01   -5.917939665347980e-02];
L3I_L3E_iAMPA_netcon = [+3.642875805478456e-02   -3.103988733339298e-01   -6.346244991207401e-01   +2.956358677517487e-02   -5.727682068150621e-01   -5.762785515274765e-01   +1.689053752183667e-01   -4.366888325096730e-01   -4.617548779401566e-01   -2.234734771793394e-01   +5.198616066629912e-02   +1.815734934272451e-01; -2.235974745302016e-01   +5.989471554930279e-01   +2.381191386739982e-02   +1.238743960464485e-02   -3.195908626824979e-01   -5.783243254040111e-01   +3.639809097693858e-01   -2.638874103283300e-01   +4.448448375234194e-02   -5.584758686542286e-01   -1.736822157916097e-01   +6.749533972672622e-01; +2.374655617369119e-02   -1.934042288202313e-01   -7.269379648385631e-01   +2.517101485901835e-02   -2.418918442458695e-02   -1.298399139359116e-01   +3.363713506071018e-01   +3.070018605942967e-01   +4.512603951826996e-03   -8.937934935713215e-02   -2.817805513053523e-01   +6.512355641486540e-01; +3.448515569973126e-01   -4.151366155927535e-01   +6.176235671505026e-01   -1.794696295284061e-01   +3.141722832411447e-01   +5.311993875556248e-01   -4.192234957506782e-01   -3.949656768729383e-01   +1.596458277963690e-01   +4.186028479610610e-01   -6.007504778915304e-03   -1.811188877199432e-02; +3.615705878568649e-02   +8.021303127103589e-02   -1.069606133563100e-01   +4.283934748881685e-02   -2.564407314679258e-01   +1.356642767821221e-01   +5.142802240716207e-01   +3.114072825200469e-01   -2.271556558822616e-01   -1.908527525010416e-01   -2.618671984302038e-01   -1.377374571159923e-01; +3.790546943747117e-02   +2.802340381740510e-01   +4.919814866181823e-01   -6.356899336616590e-01   +2.945158513661844e-01   +7.582150936886961e-02   +1.741689721102311e-01   -6.325439168262548e-02   +8.706750194851702e-02   +4.376523126633536e-01   +7.879210406769006e-02   -9.263026171162857e-02; -8.340793290330324e-02   -1.253927686768769e-02   +6.903793715275137e-01   -3.259764120359617e-01   +5.143650699817031e-01   -7.429146195144171e-02   +6.344068071814651e-01   -8.474429373175302e-03   +2.877416314584965e-01   -9.423476350208371e-02   +2.860621688567028e-01   -5.801847788315285e-01; -5.223163051919651e-01   +2.201415147580571e-03   +9.211931024631378e-02   +4.708094323998882e-02   +2.988722071537730e-02   +2.088224944491500e-01   -3.731772424443784e-01   -2.714932732234009e-01   -2.541735845423020e-01   +3.102993322830541e-01   -1.766464447943969e-01   +3.905585883435111e-02; +1.478770744428391e-01   +3.416835672048599e-01   +7.023958375341803e-01   -3.304636712183089e-01   +4.425990865204940e-01   -8.787880977362297e-02   -2.976274225981126e-01   -3.829557120092406e-01   -9.689122898330785e-01   +1.204282414159480e-01   +7.005475081565087e-01   +3.378203947492235e-01; +1.187717558958118e-01   +1.056331159642213e-01   -3.586775529109352e-02   +3.416860922437022e-02   +1.673281626437331e-02   -2.697556501327505e-02   -4.928843384097724e-01   +8.881333035663885e-02   -2.651479248649662e-01   -1.161958298033666e-01   -5.752375329471056e-01   -2.221643760803193e-01; +2.905207785872675e-01   +5.325607344730802e-02   -1.034140462546792e-01   -5.924538492221298e-04   -4.464667596967802e-01   -7.390865028021075e-01   +3.176826403175813e-01   -1.409264342337836e-01   +4.268087539534026e-01   +1.820384853150596e-01   -9.183879954875381e-02   +4.094008966662464e-02; +4.023360081162355e-01   +5.925610541224688e-01   -2.068474187072047e-01   -4.154043194002485e-01   +5.749518026395444e-01   +3.902456201103386e-01   +2.145368996793963e-01   +3.307213333293240e-01   -5.329968746297725e-02   +6.518641656383913e-02   +4.140895348619436e-01   -3.547514903670304e-01];
L3E_L3I_iGABA_netcon = [+5.775551427380793e-01   +7.953836828740454e-02   +4.777506624077841e-01   +1.666956549703787e-01   +3.202908725519561e-02   +1.941413176992624e-02   -4.040483468214532e-01   -1.461304713110629e-01   -3.593696776769194e-01   +1.523475182177647e-01   -6.951139519033803e-01   -3.212087820077538e-01; -5.234579917261495e-02   -1.220132061069536e-01   -2.121233817494430e-01   +6.185050636603583e-01   -7.026752271895365e-01   +3.754671517734995e-01   -9.538424897379730e-02   +4.425674409275644e-01   -5.745434329596008e-01   -1.462387158561794e-01   -1.168405292873589e-01   -3.814919838119323e-01; -5.429019108194182e-01   +1.332851332853895e-01   +6.061434318856208e-01   +4.376354261951700e-01   -3.473014209252440e-01   +1.858091319477163e-01   +1.739121804208673e-01   -2.694824242366737e-01   -4.843022143582990e-01   +1.498076648723645e-01   -9.567593144109515e-03   +2.499706406333781e-01; -2.366100499522638e-01   +2.537993330032740e-02   -1.270757567433040e-01   -4.915748698023656e-02   +4.928148621634689e-01   +8.091229556303269e-01   +2.132102398901001e-01   -6.835643621287557e-01   -2.462384084174140e-01   -3.095192311175469e-01   +5.237551506196487e-01   +3.814518240449878e-01; -8.462177012146552e-01   +8.189213465160515e-01   -4.476220344850200e-01   -1.338358519770501e-01   -4.872132716362371e-01   -7.398775892418231e-01   +4.001074712391449e-01   -1.744285648460780e-01   -1.873402923549124e-01   -7.382911193028244e-02   -7.982926319174351e-02   -3.155667114035807e-01; +2.726901507388434e-03   +5.069528788017937e-01   -6.768913185781281e-02   -3.348350545264149e-01   -3.515638131997663e-01   +7.553293747068385e-02   -2.707861641957275e-01   -1.084672319729998e-01   -3.740439472575394e-02   -2.256316352455734e-01   +3.994239221792221e-01   +1.412007699846800e-01; -3.183301597048714e-02   -4.643953859188872e-01   -2.074709572575664e-01   -2.407661614052503e-01   -2.712097497755781e-01   -3.163096361485918e-01   -3.265740277721959e-01   -7.320630715964257e-01   -2.191762085927264e-01   +2.579376510577213e-01   -2.808510260542742e-01   +2.658019928251482e-01; +2.343105673833946e-01   +3.129416693946881e-01   +1.757751027589656e-01   -3.681313983162079e-01   -4.768526928404045e-02   -9.857756591945385e-02   +7.367169775553398e-01   -4.047925408944034e-01   +2.694380244904794e-01   -3.762602613059123e-01   -4.884643378573372e-01   +7.109767833207615e-01; +1.092640884525943e-01   -7.796997376333092e-02   -2.666834820086659e-01   -3.006659395853732e-01   +1.029604134282732e-01   +3.507666319011964e-01   +4.274276997986196e-01   -4.719201887986173e-01   -1.482542185590230e-01   +1.432071640605170e-01   -2.518908973648614e-01   +4.029207703075006e-01; -5.278577777214033e-02   +3.209874473402458e-01   -4.467236679527897e-02   +4.622941139136217e-01   -2.632157181497460e-01   -4.099985680008321e-01   -1.597570872945570e-02   -1.244209822051098e-02   +5.585622364300833e-01   -4.914653907115759e-01   -3.783535938801681e-01   -3.254347324127898e-01; +8.008534460046751e-01   -4.075993704812386e-02   +5.971118174461982e-01   -2.223391992582582e-01   -8.731023494111542e-02   +3.282169268914982e-03   +1.847634864011083e-01   +1.538671437768105e-01   +5.456944800937790e-01   +1.436261549191763e-01   -3.082705767449440e-01   +3.327511184785603e-01; -3.872567086248074e-01   -5.182091359311601e-01   +4.648732230542613e-01   +2.832594998721520e-01   +3.509426180932428e-02   -1.056495456275340e-01   +8.168742767770882e-01   -2.474190259060438e-01   -2.978624214731795e-01   -1.079901235886909e-01   +3.118559283151250e-01   +3.148727876248783e-02];
L2E_Input1_iAMPA_netcon = [+4.159254809057696e-01   -3.575030837767330e-01   +2.825001953072678e-01   +2.416375967083669e-01   +1.671315575904493e-01   +6.588206770948543e-01   -4.601111519446222e-01   +2.833432698570052e-01];
L2I_Input2_iAMPA_netcon = [-5.782486144193943e-01   +1.974681466539804e-01   +6.199404011925137e-02   -3.525449329779795e-01   -4.445852783007410e-01   -9.480775005997364e-01   +1.456538595127440e-01   +5.854491652311357e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
