function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.110104852119593e-01   -9.793286962136621e-02   -3.153250843352978e-01   -1.653333069310288e-01   -2.110186479342360e-01   +2.865977709021673e-01   +6.054580033756379e-01   +2.570779478829697e-01   +3.822267918636265e-01   +3.562951800926241e-01   +1.957908063855762e-01   +1.549839738033587e-01   +2.133366163673287e-01   -4.645357281448895e-01   -1.552789653179044e-01   -9.169110335891761e-01; -1.311831043975374e-01   +7.467622047042685e-01   -1.307075047810886e-01   +4.056618206360404e-02   +3.955455898501856e-01   -6.947741233349840e-01   -4.075869277096021e-01   -3.950968320762513e-01   -4.529729078800195e-01   +1.396884501618795e-01   +2.449582072546848e-01   -7.374261112822442e-01   +6.828166048644433e-01   -1.228554466647477e-01   +4.853696726340763e-01   -1.157113426258148e-01; -4.787340915397501e-01   +5.045443472659149e-01   -6.617555066894083e-01   -5.240044505571648e-02   +4.255185405760806e-01   +3.905289436807149e-01   -6.869918039621866e-01   +4.018189848098759e-01   +5.215413317584036e-01   -4.061678828336586e-01   +1.542093839598653e-01   +9.227905254515395e-01   -1.816578928259595e-01   +8.076438655086973e-01   +3.439885427786986e-01   +5.816222594247712e-02; +5.058203920297777e-01   +2.993918260990386e-01   +6.229594755606097e-01   -1.152026848789701e-01   -3.610199991183224e-02   -2.024159497909967e-01   +3.903366612265400e-01   -9.565977111850360e-02   -9.740317030216337e-02   +5.306749202933183e-01   +5.803015697568642e-01   +5.067217581217648e-01   -1.694185571084526e-01   -2.551583248455375e-01   +1.110683222747512e-01   -1.847178977736752e-01; -4.596071339627499e-01   +2.657308397738483e-01   +4.673436068596158e-01   +3.112757332054059e-01   +7.158366170441864e-01   +8.480089038647892e-01   +5.738716550685964e-01   -6.919751940738736e-01   -3.172422401998600e-01   +7.086838567181616e-01   +1.595479241669931e-01   +1.857627519173559e-01   +6.828983769053085e-01   -1.872867022759777e-01   +3.953028671205878e-01   -1.000000000000000e+00; -6.096292315901413e-01   -7.218337063002470e-01   +5.074687688308808e-01   -5.852143587625226e-01   -5.752861840028178e-01   +4.687939041396594e-01   +8.389040194305274e-02   +2.993523766864613e-01   +1.644276812668432e-01   -4.297573948234790e-02   +5.358956075749987e-02   -6.270943662508582e-01   +5.110461271776557e-03   -5.970630679955136e-01   -1.373201466088395e-01   -8.034231111386532e-02; +3.149825090352747e-01   -1.741473385516469e-01   +9.638541874677888e-02   -4.947828355266930e-01   -2.734460384435570e-01   -4.600615698231564e-01   +3.731063002949859e-01   +8.722757773760200e-01   +2.762822814187089e-01   +3.776331074969941e-01   -8.075128501967381e-01   -1.360150377497322e-02   +2.861377904430653e-01   -7.527529838454642e-01   +3.612747673715781e-02   -1.878612688989379e-01; -2.546325580969409e-02   -9.886820969836867e-02   +7.811013667088453e-01   +1.727011328386838e-01   +4.263518236895311e-01   -4.623466311852522e-01   -3.834180729007517e-01   +4.687240167303482e-01   -1.175895561189216e-01   +3.640431847406745e-01   +8.483040534345315e-01   -2.480207966855230e-01   -8.809325255723442e-01   +5.880987861549598e-01   -7.200777934565242e-01   +3.246451797617705e-01; -2.724929709529321e-01   +2.250450872647235e-03   -2.058686641592394e-01   -2.207775462734002e-01   +1.356801109127595e-01   +5.740942411126559e-02   +5.170767918469417e-01   -2.549152253524151e-02   +6.095493600347838e-01   -3.684278607655347e-01   -7.995881333562512e-01   -1.263747532253891e-01   +5.474155593112160e-01   -3.588381096869259e-01   +7.429425335021302e-01   -6.261528919462557e-01; -2.326480789411616e-01   -2.029362468151489e-01   +2.792650251880150e-01   +1.508285399106372e-01   -8.837177939556304e-01   -6.631317556066858e-01   -6.581128968760722e-01   -8.231788569978937e-02   +4.538832623689618e-01   +3.845848375951326e-01   +1.434844112207514e-01   -3.364711236867995e-02   +1.372127014751913e-01   -3.259306797607277e-02   -5.477380207049221e-01   +6.094281001238485e-01; -2.672967373673221e-01   -6.208476751682014e-02   -2.012701530391529e-01   +1.705266681917141e-01   -6.618864795628187e-01   -5.211434685959115e-01   +5.733092163283372e-01   +2.208974103336160e-01   -7.166675453574728e-01   -5.172427224045810e-01   -4.133396321234885e-01   +5.725831174880753e-01   +3.889559464769599e-01   +3.350808426638934e-01   +7.091182383982888e-01   -8.138070334381259e-01; +4.694649164503313e-01   -2.474197809641472e-01   +2.624255776246832e-01   -4.131073653384357e-01   +9.254294297728539e-01   -8.407317056183417e-01   -4.417905553527667e-01   -3.682490873555461e-01   +9.297062187940440e-02   -4.257686315960522e-01   +1.733077903952720e-02   +3.755865659704622e-01   -1.097001694560597e-01   -8.876122196136482e-01   -6.167660777027822e-01   +5.826188879219211e-01; +7.093068930446091e-01   +4.045301490740075e-01   -2.144726414329583e-01   -4.719842382163650e-01   -4.847916839982246e-01   +9.116223733357341e-02   +2.735931502007162e-01   -6.883875254343069e-01   +4.039336911525777e-01   -4.685053014373390e-01   +1.294368485698536e-01   -6.872838480666284e-02   +6.789480757902869e-03   -3.161153825035468e-01   +6.360670563693606e-01   +1.896329228426633e-01; +3.762565931908124e-01   +6.402040008986470e-02   +7.864702576580318e-01   -5.067634732633016e-01   +2.283695960930965e-01   -7.042765335642416e-01   +4.313106286269644e-01   +2.656231192118895e-01   -5.278390088334506e-01   -2.893123951190446e-01   -7.269749738628682e-01   -3.758538862424010e-01   +3.862242416718014e-01   -3.275969416177841e-02   +3.293652833104118e-01   +7.791597107219643e-01; -3.623629596787905e-01   +1.234341784482312e-01   -2.046487909360918e-01   +9.041357555290416e-01   +1.861056302181346e-01   +1.903048785157949e-01   +8.642333290242428e-02   +2.198204980482518e-01   -6.478749602000771e-01   +1.421780168966831e-01   -8.448380467456199e-01   +3.484343742946291e-01   -7.671111115968549e-01   +4.356847939459370e-01   -7.710676054317726e-01   -3.797080917160088e-01; +6.812609163881534e-01   +6.097503422832578e-01   +1.799136357582261e-01   -2.104631439932876e-01   +1.370339059935105e-01   -6.993126267431844e-01   +1.660032676995636e-01   -8.669050897059278e-01   +4.805823236974726e-01   -2.323642443376294e-01   -1.917891130436892e-01   +6.467034436943966e-01   -2.920086272688287e-01   -7.192993350577610e-01   -1.194455957339430e-01   +2.585858498559752e-01];
L1E_L1I_iGABA_netcon = [+1.265398559076163e-01   +5.076584772115842e-01   +3.695596512803127e-01   -8.086174372065353e-01   +4.092057794533260e-01   -7.025186052442786e-01   -5.759955394538502e-01   +7.103681452882584e-01   +3.811382594952041e-01   +1.676828550228311e-01   -7.570812398886657e-01   +2.522165087056970e-01   +7.827972948914694e-01   -1.242669992777814e-01   +7.967928130134197e-02   +1.646820636932955e-02; -1.034094383287197e-01   +8.211350976811578e-01   +3.121526005772005e-01   +9.060878745244232e-01   -6.929280013380548e-01   -1.473705816385863e-01   -5.519963757531821e-01   -5.219653919375953e-01   +9.243327170086096e-01   +2.420759197692308e-01   +2.739570553600293e-01   +4.830595998305002e-01   +7.273060267576551e-01   -5.770878588981623e-01   -3.651991166274554e-01   -5.598047210490322e-01; -7.627658687344153e-01   -6.238449995240510e-01   +4.580775363741752e-01   -1.697306513372298e-02   -3.005005267517489e-01   +3.442948491186296e-02   +6.141171916637991e-01   +6.361984637430503e-01   -8.576358590194860e-01   +4.620932233594836e-02   -1.549262582599623e-01   -4.858538036751740e-01   +6.388696105237989e-01   +8.429294418071570e-01   -4.728447445130860e-01   +8.599742530888934e-01; -9.713232402395591e-03   -5.669849034380867e-01   +3.416119873239579e-01   +4.327312465659249e-02   +4.200886019895553e-01   +5.596861591949739e-01   -1.831510192227167e-01   -7.527217013318649e-02   -2.655536056299018e-02   +3.904785274936057e-01   -4.046723228017617e-01   -3.517850720469516e-02   +2.484053580054018e-01   +1.092400879988174e-01   -6.406530840981935e-01   +1.061435138339242e-01; -1.768589223493770e-01   +7.214451179320120e-01   +5.111508804190561e-01   +3.568070229580376e-01   +1.120081796612008e-01   +4.115702956945836e-01   -2.711014383922051e-01   +7.829675765639429e-02   -6.525441070924732e-01   +4.160523645847947e-01   -3.891234656235812e-01   +5.513322231028780e-01   -1.459168868600133e-01   +5.200199842176284e-01   +1.225925258357832e-01   +2.340227954498060e-01; -2.225428137778458e-01   -6.222109047022913e-01   -1.369713464559810e-01   +6.339744734078155e-01   +4.788071414565693e-01   +6.768528339152177e-01   +1.995018037652640e-01   -3.867635395367924e-01   +3.738607686548109e-01   +4.090389725274319e-01   -5.543216082571607e-02   -2.445148254547729e-01   +6.782302361076263e-01   +3.444914858279456e-01   +6.742483435650258e-01   +3.432568095096682e-01; -4.392032670774845e-01   +3.000924808357610e-01   -3.606737118391969e-01   +4.910531428173842e-01   +6.167425415347505e-01   -3.127584704715400e-01   +2.270495045258925e-01   -9.131647243251230e-02   -6.959605978225142e-01   +3.687665397497442e-01   +6.980579635414020e-01   -1.652076189180857e-01   -1.754729812295197e-01   -1.938456781221154e-01   -6.048420450998504e-01   -3.107907387921013e-01; -2.933566212972347e-01   -5.348982191302168e-01   -7.314579346265840e-02   +7.415767365213128e-01   +1.005263215492940e-01   +1.262641261913615e-01   -2.956062740288163e-01   +4.061155799517463e-01   +6.148986237230593e-01   +4.310917389685658e-01   -3.665805635252353e-01   -1.832833462511207e-01   -1.781905084187702e-01   +7.396670780559977e-01   +7.430053169779794e-01   -8.164690944165064e-01; +2.370241744254375e-01   -7.577835328104870e-02   -9.282524723698590e-02   -2.114482764427225e-01   -6.127347790989275e-01   -1.249073873610692e-01   -7.057492067919606e-01   -2.532474084947087e-01   +3.233396335503462e-01   +4.175646447708283e-01   -2.544553912716955e-01   -2.023297194227622e-01   -7.056718336900902e-02   +7.236436773170093e-01   -1.067726138666694e-01   -1.837074379293501e-01; +6.088798751244630e-01   +7.704626271194837e-02   -7.482861141947125e-01   -3.823963653119987e-01   +7.657444650013736e-01   -5.730565672943241e-02   -3.893124893771698e-02   +3.526086175403126e-01   +7.986952531925813e-01   +2.855094964664770e-01   +4.408895972452396e-01   -2.413124679450499e-01   -3.455949461663987e-01   +4.111304030302639e-01   -3.970334832443485e-01   +9.947396730665744e-01; -8.978755110516734e-02   -2.335843144526854e-01   -5.011468693347088e-02   +2.955593456968295e-01   +1.951346494617898e-01   -1.477396626652832e-01   -3.089512693489929e-01   +3.797969246980025e-01   -5.126612040410561e-01   +7.908475599624321e-01   -1.989933564407034e-01   +2.755522213228068e-01   +2.215472374290736e-01   +8.365706818999552e-02   -9.754308339996146e-02   -6.203766928603666e-01; -4.446141100309982e-01   -8.674333872998979e-02   +6.049831307936219e-01   +3.593187110524121e-01   +7.131884815525051e-01   +8.600625200889760e-01   -1.779361456183259e-01   +3.669888121981520e-01   -2.702280778156109e-02   +6.976689568045917e-01   +6.548160852973026e-01   -5.986396684899344e-02   -4.232382773093688e-01   +4.608400060569932e-02   -4.846376901900980e-01   -1.000000000000000e+00; +3.539388711397844e-01   -3.388645376414045e-01   +6.819418896515851e-01   -3.552913242278370e-01   -3.597446717627151e-01   -2.279929378802628e-01   +6.507210953992035e-02   -3.456791501695081e-01   +5.508665315542616e-01   +2.464935589670679e-01   -7.459061162418096e-02   -1.769254742183866e-01   +6.504378624931989e-01   +4.111565998863237e-01   -2.843590727783731e-01   -3.228319359101958e-02; -5.434363266547304e-01   -2.108063238125460e-01   +1.262427350138725e-01   -4.579829609736454e-01   -4.252856542547780e-01   +3.543229649730072e-01   +2.942793477750502e-01   -6.333271206228698e-01   -1.647974211379912e-01   -3.201292713768177e-01   -1.271519016324304e-01   -4.561993936117113e-02   -6.604687155947989e-01   +2.491563991557156e-01   -1.767796964649262e-01   -3.148488921619711e-01; -3.103634065404021e-01   -4.513330567973037e-01   +2.244496555082530e-01   +3.341593325093948e-01   +4.921060649519252e-01   +4.961442380582418e-01   +4.551300267290717e-02   +7.049381673878691e-01   +1.639374983256242e-02   -2.910312371784132e-01   +2.629595565522128e-02   +2.033181465595366e-01   +1.687726866388663e-01   -7.550267479338626e-01   +2.326655918576795e-01   +2.531192625843789e-01; +6.457502172533414e-01   +7.283763579425673e-02   -4.199445662761853e-01   -3.097690466014056e-02   -6.595185097780756e-02   +4.703910946612564e-01   -1.109567006422215e-01   +5.113944108436954e-01   +2.195395840376768e-01   -7.019823975520885e-02   -4.135726865560904e-02   +3.382784745058077e-01   -2.778601615586215e-02   +3.162740913282500e-01   +2.290572507804268e-01   +3.512190782727860e-01];
L2I_L1I_iGABA_netcon = [+6.743247523337379e-01   +2.377119824685258e-01   -3.860039659006776e-01   +5.496758228186278e-01   +7.930635177521901e-01   -4.961455592792754e-01   +6.679798337867988e-01   -7.093992851851494e-02; -5.561519110386870e-01   +2.322811251072129e-01   -7.655568783298590e-01   +4.397065862050916e-01   -2.619492269427098e-01   +3.698898866975934e-01   -4.172178537201853e-01   +4.573967007761379e-01; +1.279363172705656e-01   +5.282827393578583e-01   +3.242453780546156e-01   +1.388116295604651e-02   +1.610987022095743e-01   -8.674411712826176e-01   -3.483970979668770e-02   +2.418569837842036e-03; -6.095886358393871e-02   +4.694666404791369e-01   -1.251117331194183e-01   -5.690572804814343e-01   -2.553579383196893e-01   -1.242653435332891e-02   +3.892157242181272e-01   -2.517570768526280e-01; -4.100662167746456e-01   -7.851515540961239e-01   +1.308835878392464e-01   +5.694000285695066e-01   -1.779115194011227e-01   +5.503717083441402e-01   +6.012642119267445e-01   -8.944116588194932e-01; -3.130782548432426e-01   +7.512315601200973e-01   -1.475782196542814e-01   +2.290327897975647e-01   -2.933257680370568e-01   +6.937167138619281e-01   +6.242821323252592e-01   +2.727825261343959e-01; -1.587428566171222e-01   -5.276414517879723e-02   +1.794021005556697e-01   -7.272686966479798e-01   +6.161959286303427e-01   -8.275115249270990e-01   +2.049495646011552e-01   -2.966685857468091e-01; -1.554758740983138e-01   -6.190896458949566e-01   -1.872891849056897e-01   +2.678984099176596e-01   -2.516005786099162e-01   -3.788600594320233e-01   +2.290302330262997e-01   -3.370454488892754e-01; +9.355022149569867e-01   +5.817765940896797e-02   -2.861054344857588e-01   +2.252188019367211e-01   -8.538806415308141e-01   +7.584960164647266e-01   +3.354967370536595e-01   +4.036733911652070e-01; +3.929883752894380e-01   -2.065792043147698e-01   -9.292786368633580e-01   +6.860075928497676e-01   -3.416069203793772e-01   +4.699434440303359e-01   +5.255783836320711e-01   +1.035168107957172e-01; -5.357867734262822e-01   +8.619991185313929e-02   -3.502650774715015e-01   -1.292777737563611e-01   -1.458460643109968e-01   -8.018929712257682e-01   +6.178071379438015e-01   -3.130573899379989e-01; +2.842708353975181e-01   +2.850312123785256e-01   +2.388387208473934e-01   +7.041881361824657e-01   -2.125223412109672e-01   +2.817139978208653e-01   -3.688921729562388e-01   +8.949272985393973e-01; -1.604415425295538e-02   +4.815583766207296e-01   +5.751979427063714e-02   -1.776121486507530e-01   +9.665565059307021e-02   -1.498587506932565e-01   +1.303636449461520e-01   +5.196904945710848e-01; +3.431296505273707e-01   -4.409442332893786e-01   +2.817780309051204e-01   +1.000000000000000e+00   +2.113149221297828e-01   +7.019565890159316e-01   -8.694034939869173e-01   +1.725709615984579e-01; +4.762045151343997e-01   -2.252750557585209e-01   +4.443882213372175e-01   -5.221376007481898e-01   +2.491317300886538e-02   -4.013239372295506e-01   -5.879702226364182e-01   -5.287743190159913e-01; +3.886803450153389e-02   -4.918482718711992e-01   -1.354986738754434e-02   -1.913150263327916e-01   -7.378099417425078e-01   +3.478781004253790e-01   +1.212396926529094e-01   -3.967740599167994e-01];
L1I_L2I_iGABA_netcon = [+8.740679024929557e-01   +1.921445274422039e-01   +2.136230180639622e-02   +8.392360484920541e-01   -4.514612216776070e-01   -5.922511669954633e-01   +2.041196146626835e-01   -2.591236844314060e-02   +1.494974962523454e-02   -4.500025588769332e-01   -1.301904903365815e-01   -1.680395407840061e-01   +5.225790706813341e-03   +2.342085724198636e-01   +1.000000000000000e+00   +9.075882443491831e-01; -2.796418054540040e-01   -5.790866434341843e-01   +1.642368636342362e-01   -4.653918057719407e-01   -1.260813966707931e-02   +7.843520246603076e-01   -4.604793171895313e-01   -7.334046623738285e-03   -6.781069217862290e-01   -9.691328570682433e-03   +2.161176108104305e-01   -5.879893516288774e-01   -3.161411338969138e-01   -6.619542107238741e-01   +1.483093555197539e-01   -1.715196918943745e-01; +3.034768761474040e-01   +5.826227760535037e-01   +7.378146178163473e-03   -6.196443049502135e-01   +4.542778772355022e-01   -5.518818216200733e-01   -1.332743390233626e-01   -2.345618538152644e-02   -2.987117394003899e-01   +4.262683710983907e-01   +3.068385782969983e-01   +7.038141450978521e-01   -3.632134033080581e-01   -5.728727889321741e-02   +3.414809926604045e-01   -5.935900749704184e-01; +2.082623743253257e-02   +1.622616910485792e-01   +5.792753780478485e-01   -2.573962518338124e-01   +4.097634549244115e-01   -2.172774307308019e-01   +5.796425384237875e-01   -1.377120982304458e-01   -3.397012103118786e-01   -2.234364839141858e-01   +2.100807086169950e-03   -2.157741692057711e-01   -1.353685294355272e-01   +7.683370238676657e-01   +2.020047605698130e-01   +1.660769473546218e-01; +2.145392062332295e-01   -1.150773883444864e-02   +1.016387657474096e-01   -4.343083361258989e-01   +3.425435876698494e-01   -3.037058129303476e-01   -1.830474966436027e-01   -1.921614237045575e-01   -4.519021861721481e-01   -6.210329649273251e-01   +4.352494852939605e-01   +4.021374802404484e-01   +2.451789444019443e-01   +3.951450576652206e-01   -2.533775734400667e-01   +5.100958604012832e-01; +4.874189388161185e-01   +3.615541350881020e-01   +1.761303757708228e-01   +4.157167669914382e-01   -5.993803768285344e-02   -6.135671474966814e-01   -2.343151785687121e-01   +3.449051557147024e-01   +4.638258949114752e-01   +3.226061581395274e-01   -1.609911064467605e-01   +9.369875118407683e-02   -2.655009981302111e-02   +3.043084570749560e-01   +3.348506699361881e-01   +1.868606232153234e-01; -8.337098452996407e-02   -2.950220116602311e-01   +5.486797479374127e-01   +3.983529971333921e-01   -3.360969993804861e-01   +1.900663293998909e-02   +5.518293915978665e-01   -1.449444967289957e-02   +4.870928531669325e-01   +3.475364108376201e-01   +8.679943252873913e-01   -4.781204885249009e-01   +3.823831243666915e-01   +3.420181167043148e-01   +6.448344652398948e-02   -3.663124002158369e-01; -3.114020015159697e-01   -2.088703552340092e-02   +1.598438359963182e-01   +2.870652330093414e-01   +1.191940427236831e-01   +2.178619682263727e-01   -8.765407975274159e-01   +3.009796410880756e-02   -2.290840439793008e-01   +4.805941535158993e-02   +2.365535854467517e-01   -5.602554208363456e-01   +3.570357865010592e-01   +5.495046469185412e-01   -1.574524262283578e-01   +1.633325344617051e-01];
L2E_L1E_iAMPA_netcon = [-5.575852727497324e-01   +1.395574999737949e-01   -4.562047231760991e-01   -3.679572981255450e-01   -5.401617520517743e-01   +1.109996584857107e-01   +3.787888765543199e-02   +6.579119899222065e-01; +5.871522870481121e-01   +6.158854143844071e-01   -5.439502688475832e-01   -7.448558324792338e-01   +3.291610923670331e-01   -3.822824080132244e-02   -3.230081864028627e-01   -5.160619966365889e-01; +1.699046434086449e-01   +9.574888732265986e-01   -7.624236907723442e-02   -2.065403609639283e-01   -1.667087932584537e-01   +7.575632569995588e-01   +2.556509835062236e-01   +1.358000615356879e-02; +3.799954660973007e-01   -5.105117639674908e-01   +5.289710862507745e-02   +1.322458293239546e-01   +6.478224564254863e-02   +5.289140919333216e-01   +7.903377418089938e-02   +8.382008619533975e-01; -5.718508576475033e-01   +2.382844221050334e-01   +4.146411357094089e-01   +9.316065396859294e-01   +1.264192293262596e-01   -1.402217329959058e-01   -7.604841468585219e-02   -2.631940026875062e-01; +4.001758771007541e-01   -4.146408026696655e-01   +6.495259097190993e-02   +4.111761658113622e-01   +5.290416877495848e-01   +1.271526803424926e-01   +3.139734162317631e-01   +2.692260071013829e-02; +4.266139743712564e-01   -8.423575911445307e-01   +1.671986401713495e-01   -1.287156185245899e-01   +3.149017690914862e-01   -8.048258300673893e-01   -1.242839162520455e-02   +4.898958166892567e-01; -1.551105801952308e-01   -7.463672023439863e-01   +9.468151130030725e-02   -3.338375281228243e-01   -8.196488389996301e-01   +1.882302522685330e-01   +1.741551096491968e-01   -3.753377049744621e-01; -4.484232092620963e-02   -4.063889096442085e-01   -3.349976646006141e-01   -5.961807205405972e-02   -1.638068760534574e-01   -2.232974290774816e-01   -3.307554511195265e-01   +4.004397378048364e-01; -3.725116385874479e-01   -5.708952294452442e-02   +6.590945597599623e-01   -3.397928861879226e-01   +8.954308949159159e-02   +1.971910419562810e-01   -1.185473626567817e-01   +7.062265548637623e-01; +2.438343995659297e-01   +7.960688355416924e-01   -4.621354858162709e-01   -6.300242552417049e-01   -8.660628138741929e-01   +3.740632247645477e-01   -1.292234820743738e-01   -3.084004149918408e-01; -2.059329167544818e-01   +4.982315122850424e-01   -2.536806361790617e-01   +9.487408331260709e-02   +8.652831789057994e-01   +8.567015311234198e-01   -1.456518106445934e-01   +2.548897601059681e-01; -7.922939648192955e-01   +1.175173383772532e-01   +8.479880600484697e-03   -1.123246301919582e-01   -4.524133759540240e-02   +1.481253141610086e-01   +4.688744442320606e-01   -5.084495667670523e-01; -2.635541001381849e-02   +1.165979725339780e-01   +2.313871922313158e-01   +2.637700099307208e-01   +4.619939551266798e-02   +1.992178600611594e-01   -3.984183522015313e-01   -8.016260741167971e-01; -2.601908799690767e-01   -4.940724442414527e-01   -4.745300268321964e-01   -4.881315017950470e-01   +4.182330735627461e-01   +2.521834440745582e-01   -6.581069454791573e-01   -3.225048413684018e-01; +6.883736477840543e-01   -4.672772134275351e-02   -3.746852509477112e-01   +2.544656260278013e-01   -9.989744461841211e-03   +4.052922279057660e-01   -1.375402041099246e-01   +1.000000000000000e+00];
L1E_L2E_iAMPA_netcon = [-7.408712865768041e-01   -2.402236808269978e-01   +5.642285317694450e-01   +7.278147218664839e-01   +6.549138042418988e-01   -4.811972941826033e-01   +8.362671498094384e-01   -7.755109867512818e-01   -6.117633299333731e-01   -6.096613856833123e-02   +6.360824040123788e-01   +2.525988984076839e-01   +2.635687840268681e-01   +7.541052749855018e-01   -4.353201706036517e-01   -3.706103071700161e-01; +5.284953175501043e-01   -3.363473908798728e-01   -1.695369311244705e-01   +1.709948656031638e-01   +4.324544888500637e-01   +3.677616261801788e-01   -2.135667470391812e-01   +2.801187217339289e-01   +9.568957512468326e-02   -1.223900130577036e-01   +2.814270502768015e-01   -5.349994674333608e-01   -3.381696042630337e-01   +1.211213594311524e-01   -1.026530167890899e-01   -1.583866163023930e-01; +1.389844064876156e-01   -6.593245763241125e-01   -2.634200102149846e-01   -1.020945578764176e-01   +5.658001819415361e-01   -6.517277727582067e-02   +4.237661707874690e-01   +8.347339492959218e-01   -1.000000000000000e+00   -1.119880408720990e-01   -4.244075269166275e-01   -4.644488388324760e-01   +5.275569544274187e-01   -2.544470833933322e-01   -6.510452740497850e-01   +2.425037060947953e-01; -4.441165339547528e-01   +8.692840108762810e-01   -2.035233789860340e-01   +6.459348680550869e-02   +1.659787367447754e-01   +1.607787553095396e-01   -3.912493521940985e-01   -5.941251637591890e-01   -5.592318776765182e-01   -4.221835160830523e-01   +3.978237380771908e-01   -2.132914834215392e-01   -6.962456610377394e-01   -3.712854261004523e-01   -1.677522622200290e-01   +4.272989302700029e-01; +3.121188520933223e-01   +7.859353879607789e-01   +8.748990154771036e-01   +4.962102087888177e-01   +7.049876417802683e-02   +2.439098953943921e-01   +5.400340475617719e-01   +5.960559480743820e-01   -4.149358948990376e-01   -8.955835967588516e-02   -3.110470944850944e-01   -4.066982501878810e-01   -4.234876463433862e-01   +1.873144495157485e-01   +6.752473524489090e-01   -4.104093785138224e-01; -1.045519296155790e-01   -3.939862747288022e-01   -3.139043378333187e-01   +1.963008384404263e-01   -5.167874128887733e-02   +2.686827514685712e-01   -1.695798322180299e-01   +6.246541396287699e-01   +1.784294710072158e-01   -4.324079883314633e-01   +1.461584759999654e-01   +1.195405741388251e-01   +3.592655530461968e-01   +1.969338998632781e-01   -6.546334822727453e-01   +1.804044806533251e-02; -3.106984021328756e-01   -1.560572956772144e-01   +6.438297262567470e-02   +8.024018177769680e-01   -3.158435035908489e-01   +5.491192380551086e-01   -5.372218877029858e-01   -5.381704112439778e-01   -1.291500359726454e-01   -6.392862666462263e-01   -2.641258515161450e-01   -5.750923374159577e-01   +3.483551680235439e-01   +8.536044558269703e-01   +6.794876841832471e-02   +5.555652653458493e-01; -3.202538512615074e-02   -4.575635251662966e-01   -4.176859352254859e-02   -6.913444508454843e-01   +1.455109037063755e-02   -3.100187121171534e-01   +8.440932827464455e-01   +6.825418161475602e-02   +1.498248904442453e-01   +3.199909427556639e-01   +5.329443448646390e-01   +8.696416455854100e-01   -3.627365853149601e-01   +2.698658161921434e-01   -5.699736354878508e-01   -1.617793321498726e-01];
L2I_L2E_iAMPA_netcon = [+1.058571476687041e-01   -4.070965382997574e-01   +6.452907332535540e-02   -3.425472706323394e-02   +5.071897912354663e-01   +3.925571226785319e-01   +7.423725539616727e-01   +3.767860818526074e-01; -6.189102773833453e-02   -4.396807476774044e-01   +1.277106616820098e-01   +3.524878479569534e-01   +5.601288246860945e-01   -6.767951724048169e-01   +1.684737490574469e-01   +5.993387780732808e-01; -1.555089359605281e-01   +5.700018721032055e-01   -8.911197742548278e-02   +5.996098099348397e-01   -2.746305776728781e-01   -3.174279273546790e-01   +8.238729638219285e-01   -1.922558019559984e-01; +6.575717942262508e-01   -4.481045516685898e-01   -7.219629712350503e-02   +4.265973913411137e-02   +2.179236248876785e-02   -5.626013452635847e-01   +2.994746105347604e-01   +9.286022699055881e-01; -4.111067231957281e-01   +5.664587205768173e-01   +2.501281110007325e-01   -2.073881437254865e-01   +4.810729650923625e-01   +2.436672185107980e-01   -2.953548013169090e-02   -1.000000000000000e+00; -5.364027451971771e-01   -7.140477678773104e-01   -5.642046326677721e-01   +5.619125170097591e-01   +3.794804292649730e-02   -1.934500715012763e-01   -5.803594465059005e-02   -4.152290120288940e-01; +6.932951829459221e-01   -9.424310914515903e-01   -1.940318988601032e-01   -1.137497290086732e-01   -1.020009078689149e-01   -3.916179405321248e-01   -8.818049658753371e-01   -6.432087890316726e-01; -2.339787356279656e-01   -6.073141465094328e-01   -8.079068632287928e-01   +1.226880151986027e-02   +3.736549969294494e-01   -4.027260938055358e-01   -8.057751602761141e-02   -5.506603212330374e-01];
L2E_L2I_iGABA_netcon = [+2.125088656885336e-01   +7.581224652734058e-01   -5.899783471254805e-02   +7.937642658206708e-01   -6.004689870454848e-01   +4.210239268019365e-01   +8.439525317031578e-01   -4.477331074737088e-01; +3.701611538025823e-01   +2.369856449684886e-01   +8.777825702267582e-02   +1.204479891373676e-01   -8.221062442540549e-01   -1.726219379856294e-01   +6.689459667326675e-01   +1.027396987892537e-01; +6.668121698887414e-01   +5.495208810664882e-01   +1.000000000000000e+00   +7.733422230543854e-01   +4.324559306142560e-01   +3.204526443426532e-01   +6.081866160214890e-01   -6.010605146119078e-01; +9.170063055316787e-01   -6.391796153447297e-01   +1.475897635934655e-01   +3.601115786345038e-01   -5.528838904646000e-01   +3.270226808853442e-01   -5.708379722842126e-01   -1.779793744104388e-01; +8.176347857686943e-01   +4.120064741325402e-01   +9.476103128684638e-01   +3.810063506350376e-01   +3.278770432219842e-01   +3.867371653512294e-01   -7.376106012534034e-01   -3.345123806044168e-01; +9.427360691062261e-01   -5.636080310984262e-01   +3.823933691176417e-01   +1.759677883602404e-01   -8.491658121431400e-01   -7.575095802514378e-01   +8.196026034629075e-01   +4.283237285711881e-01; -6.530781730824557e-01   -3.816449935889265e-01   +7.175856422904597e-01   -3.250187766789872e-01   -6.252456820639334e-01   +2.938755302971053e-01   -1.586705091029277e-01   -5.045567305868818e-01; +3.977002677316573e-01   -5.467411980742336e-02   +3.163872094150760e-01   +4.789221980731291e-01   -6.143975213252740e-01   -1.354228826732531e-01   +3.225650410662866e-01   +6.774147482114672e-01];
L3E_L2E_iAMPA_netcon = [-4.764532761563909e-01   -4.229254343067007e-01   -6.113351970752263e-01   +9.586913263971277e-01   +1.003761557439767e-01   +6.470329436941799e-01   +3.864873709138176e-01   -7.909308540040173e-01   +1.294144791908198e-01   +5.915515677248109e-01   +8.877028789882428e-01   -1.776605088501995e-01; +1.286921229556165e-01   -3.171365181057110e-01   +4.832620645381058e-01   -8.555787398677817e-01   -6.649510503127775e-01   -8.982871215708859e-01   -4.404957752450833e-01   +8.675119137906314e-01   +4.052775510855886e-01   -6.828070931014348e-01   -3.047902860903197e-01   -1.862665279825608e-01; +5.195908798482839e-01   -1.394177892696567e-01   +3.392388791084402e-01   +4.402660326439781e-01   +8.629570628530800e-01   +4.853997981756138e-01   -2.407321980425081e-01   -7.036987033991927e-01   +4.801789985701055e-02   -7.447819427328749e-01   -1.843718157796821e-02   +8.755398023642592e-01; +3.171474068745856e-01   -1.299849741674060e-01   +2.989425665879369e-01   +3.580762898580981e-03   +6.906690458183770e-01   -8.688523395589675e-01   -1.110204773355227e-01   +5.098419299420821e-02   -5.714203325345784e-01   -1.134546220898687e-01   +5.238178942600256e-01   +3.363034593693110e-01; +4.282670492953624e-01   -6.871194603313809e-01   -2.237414197716018e-01   -5.645682690537978e-01   +6.781019752870554e-01   -7.226067029225511e-01   -9.213457247182574e-01   +7.590010768386888e-01   -3.196807972894826e-01   -7.749661532647558e-01   -3.991075413824239e-01   -8.872678296139587e-01; +9.308146964127089e-01   +1.499861649347415e-01   -2.792142230536216e-01   -5.838712164439163e-01   +4.239838510221214e-01   +6.610855492110241e-01   +6.293400599077322e-01   +5.669190295985800e-01   +5.098247511693221e-01   +3.089534113384281e-01   +2.318993493222521e-01   -8.814863368921049e-01; -4.458553600570278e-01   -2.787900262538639e-02   +7.846851820531568e-01   -5.289995234941730e-01   +1.683273655260540e-01   +2.765691135915959e-01   -5.771424165012982e-01   -5.132333571203990e-01   -1.982941189267279e-01   -1.796218270748145e-01   -5.509253919423714e-01   -1.990693362126150e-02; +5.464306873949136e-01   +7.431269488916714e-02   +5.726862316535288e-01   +2.135568957639712e-01   -1.823257070801698e-01   +1.000000000000000e+00   -3.479288175841526e-01   -1.027230059515390e-01   -6.327845439102706e-01   -7.459159402807702e-01   -2.909604802846826e-01   -2.956259380095395e-01];
L3I_L2I_iGABA_netcon = [+1.519100557525470e-01   -1.920689639490907e-01   -5.724690151569616e-01   +2.177305185091886e-01   +6.567691646067323e-01   -7.461690761869330e-01   -9.423024177016123e-02   -5.464283345474198e-01   +7.314704479539562e-01   +5.003458709677101e-01   -2.191078182163341e-01   -3.709367945195387e-01; +5.513756298648268e-01   -3.970667098554448e-01   +2.797429322147054e-01   +7.820663325196245e-01   -4.212952077740844e-01   -5.624489984480098e-01   -3.145663226303612e-01   -3.167439984587958e-01   +3.577384347559811e-02   -3.390749420344447e-01   +3.208506311754192e-01   -6.710879066703077e-02; -7.440209832810651e-01   -7.025840733027127e-01   -4.265219319252956e-01   +1.473138893369337e-01   +4.305076859430863e-02   +2.745437152949891e-01   -6.075607484791701e-01   -4.711911752843838e-01   -4.647867108132167e-01   +5.902091341709285e-01   -1.413908286035558e-01   -1.286265550991101e-02; +7.333525542204390e-02   +5.662120667057137e-01   -1.340587860842512e-01   +2.342191532876159e-01   +6.111155104671174e-01   +3.349106019054391e-01   +6.713921729596551e-01   -1.398946649381295e-01   +9.683675550021003e-01   -5.447577705113325e-01   +5.675167276748690e-01   +2.430734904937110e-01; -2.461365931121146e-02   +4.160418542818538e-01   -4.979900390677963e-02   +5.551483778679514e-03   +6.275016228447210e-01   -2.644563322155733e-01   -2.882833393963224e-02   -7.515185111003426e-01   -7.280486027983090e-01   -2.594736587082105e-01   +1.483531753767022e-01   +2.394288749791555e-01; -8.620273398092836e-01   -4.444706344352004e-01   -3.995834343227710e-02   +2.278979160085754e-01   -1.085542812675172e-01   -3.317595357346664e-01   -5.282011759989719e-01   -3.857197218544794e-01   -5.739953438512432e-01   +6.059369200811129e-01   +5.610048945110147e-01   -4.503102136333080e-01; -7.374931138525836e-01   -6.479337118462408e-01   -3.861923185467143e-01   -4.013148992828464e-01   +4.192398123840954e-01   +2.902261652357215e-01   +4.263470861513415e-01   +1.488056939538729e-02   -9.888955317724027e-02   -5.240108976056107e-01   +9.278366542899393e-01   +1.000000000000000e+00; +2.642327381966545e-01   -4.721040139762880e-01   +1.578744863114800e-01   -2.109300423657220e-01   +4.381350699773864e-01   +7.232328597415081e-01   +8.834021778711488e-01   -5.962650566378073e-01   -3.818292053189203e-01   -2.103933824088260e-01   +6.101808044088861e-01   -3.684358045439030e-01];
L2E_L3E_iAMPA_netcon = [-4.901748551324306e-01   +7.160161175084527e-01   +2.307686458539956e-01   -2.661670003896842e-01   -5.901970875963752e-01   +5.394542699061036e-01   -1.586093174234152e-01   +9.434248558958287e-02; -6.301595139236702e-01   -9.641197922098987e-01   +3.500784668390844e-01   -2.881199311064692e-01   -2.475713365234157e-01   -4.921319537852168e-02   -5.280845411607793e-01   -5.210194415251361e-01; +1.014634567509978e-01   -2.433935879367419e-01   -3.560279526550399e-01   -1.735101424159651e-01   +4.471493971671865e-02   -2.052771014384332e-01   +1.413655503690959e-01   +5.435063373030142e-01; +1.408213633477693e-01   -8.601042930304631e-01   +5.275877957468494e-01   +7.026411965207497e-01   -1.334064339558472e-02   -1.064898932557299e-01   +2.315751564837879e-01   +1.041907816644921e-01; +1.908918620022696e-01   +2.940926290068901e-02   -5.037203698805184e-01   +2.287177813041346e-01   -5.722061780591343e-02   -4.148370253412352e-01   +5.239162513059651e-01   +4.761657862580344e-01; +5.442032026119499e-01   -6.724558490801248e-01   +3.053333666824040e-01   -6.545550433694040e-01   +1.616073411495136e-01   -4.780071447702172e-01   -8.414433265959496e-02   -3.772074353983518e-01; -4.942307881011313e-01   +4.838675217749595e-02   -5.398412486625297e-01   +7.385620230900041e-01   +6.525765600157180e-01   +3.386273530247276e-01   -5.609967896542817e-01   +2.814241714649741e-01; -6.736558997285760e-01   +7.117361329308042e-01   -7.731703393833442e-02   +1.130076612104714e-01   -2.828439044139184e-01   -5.837100507223196e-01   +6.140736616513406e-01   -3.629677644300281e-01; -7.903319763543541e-02   +5.366676303592059e-01   +2.531901522997627e-01   -3.469894778663143e-01   -2.558833245517006e-02   -1.811741413464785e-02   -1.623870843409388e-01   -2.817242019102653e-01; -1.412332885563296e-01   +1.495396683592420e-01   +3.615040019852222e-02   -9.532984134805414e-02   +6.157033327583991e-02   -2.279701068915918e-01   -6.084980662328861e-02   +4.084825845215280e-01; +6.966326152895986e-01   +1.000000000000000e+00   -2.642304033797886e-01   -4.360621616241747e-01   -7.336494857808853e-01   +3.113795659514309e-01   -1.038124299417600e-01   -3.367443112141443e-01; -6.236277231565427e-01   -3.415715514875108e-02   +5.916289786833963e-01   -7.914888642412630e-01   -3.783649051801337e-01   -6.979893491294082e-01   -5.012863787431775e-01   +7.645429026052974e-01];
L2I_L3I_iGABA_netcon = [-1.254186993393996e-01   -7.203939834522769e-01   -1.021568249229964e-01   -7.953594540191315e-02   -1.413359246605544e-02   +1.952168951481519e-01   -5.492470741042647e-01   +3.723588887679789e-01; -3.324483111686056e-01   +1.583054613786936e-02   -4.000088180104297e-01   -5.584737787638157e-01   -3.583894149964400e-01   +3.266675276154934e-01   -2.061095353721513e-02   -2.130483003863242e-01; -5.393921967951447e-01   -1.375072063198025e-01   -2.962868424270562e-01   +5.891844749285238e-01   -4.545054582293388e-01   +1.482430726121816e-01   +1.300083066521184e-02   +4.939325207459655e-01; -2.758955143988620e-01   -2.833595255179470e-01   +2.097474090916518e-01   -5.094100508623267e-01   +5.920254583771051e-01   +1.284853530036481e-01   -2.433972907757706e-01   -1.618637445511754e-01; +1.941397024264313e-01   +1.541703014403868e-01   +6.075011460668817e-01   +5.259063232211091e-01   +4.974350900012530e-01   +1.247293984797041e-01   +4.645318433086341e-01   +3.584512394023627e-02; +2.343036835606793e-01   -5.927573450693558e-01   -4.143028425670590e-02   +3.211730568913594e-01   +2.483745142217473e-01   -2.110863836835339e-01   +6.738863450360802e-01   +3.763745882903559e-01; +3.321103869693082e-01   +2.450478737188617e-01   -2.970270734092202e-01   -3.400028845156982e-01   -2.336683328430761e-01   -5.493140760682608e-01   +1.154511612959016e-01   +1.592682819072375e-01; -6.023668191047959e-01   -1.916036375892033e-01   -2.468927965017674e-01   +6.265310701062666e-01   -2.679928950454131e-01   -7.821760990666635e-01   +3.982691647255961e-02   -4.341859718845550e-01; +6.100838899319702e-01   -1.140425142344907e-01   -3.172968647222203e-02   -1.000000000000000e+00   +1.369503582486024e-01   +5.367936240663225e-01   -2.689816487582363e-01   +2.147695546314356e-02; -1.822794615918431e-01   +5.203941575437443e-01   -4.519538620286988e-02   +4.583522809856288e-01   -3.848831389855168e-01   +2.246946767285894e-01   +1.544552232213886e-01   +5.111441899290269e-02; +5.644653511392871e-01   -2.573820290200421e-02   +5.011895574857334e-01   +4.028507894801126e-01   -1.745244341308617e-01   -5.112538806632120e-01   -5.888961814859028e-01   -7.582001162775422e-01; +2.526162138288582e-01   -2.987221647269805e-01   -4.400206214420800e-01   +3.310664971108668e-01   +1.040346374070153e-01   +1.867074239912846e-01   +2.957831065876432e-01   +1.404880594668942e-01];
L3I_L3E_iAMPA_netcon = [-6.357583111978061e-01   -6.538501122439101e-01   -5.710569890606603e-01   -6.468767262683423e-01   -4.501004584894209e-01   +4.596359245208234e-01   +2.001898178590831e-01   -9.055022380027920e-02   -3.637315556778161e-01   -6.685187742057538e-01   +5.204589621298147e-01   +7.334277154121076e-01; -5.036233223226572e-01   -6.693913091771789e-01   -5.933008492782967e-02   +3.731827474482428e-01   +1.656062358747183e-01   -6.149010948073610e-01   -6.590015844301231e-01   +1.734468403672776e-01   +9.313870179610056e-02   +5.388987672458654e-01   +2.566471125170655e-01   -5.351302674182820e-01; +9.105955675651353e-02   +2.553292009233570e-01   +4.806694788959592e-01   +3.346740138124288e-01   +8.538603892649910e-01   +2.427524627183057e-01   -1.704446855964825e-02   -1.179680341432627e-01   -4.236624252037642e-02   +3.211387274851326e-01   -1.000000000000000e+00   +2.020232477145451e-01; +8.059409614193782e-01   +5.184909979265950e-01   +2.777895479978390e-01   +1.270399010363482e-01   -9.383847403712469e-01   +1.961407495468661e-01   -1.403141175498049e-01   +8.468538041981523e-02   +6.731416076086409e-02   -3.604062565377817e-01   +2.859351960904744e-01   +2.619969380034637e-01; +4.390409557067073e-01   +2.259854180527092e-01   +9.106219758662129e-02   +7.342912945316377e-01   -1.876037402925992e-01   +5.178307694564108e-02   +8.838658158016008e-02   -7.403234516321472e-02   -6.749847879759585e-02   +5.129336150146219e-01   -5.715012740290195e-02   -5.176867606653784e-01; -1.157113230431875e-01   +5.960846333259046e-01   -2.473667130354403e-01   -4.043963471544404e-03   +5.172359992185280e-01   +2.794866487965628e-02   -1.728400324195218e-02   +3.500905716041456e-01   -2.097425034373390e-01   +2.114315271429399e-01   +4.079222451909235e-01   +1.000560095836663e-01; -9.554310414446839e-01   +7.624151634073335e-01   -2.803767921552303e-01   -3.044480507534843e-01   -6.208648795377946e-01   -1.779430060996224e-01   +1.422090519904629e-01   +1.640548523103338e-02   +5.551536408426904e-01   +1.534035766547034e-01   -5.032072837948323e-01   +3.058756353863049e-01; -2.864416440393474e-02   +1.829901512863153e-01   -1.352829842642403e-01   +1.460274958673247e-02   -8.518477972638450e-02   +1.576010023780383e-01   +3.352728736840143e-02   +2.921944236141469e-01   -7.201668733819891e-01   +8.395600634135945e-01   -2.813307677616817e-02   +7.793221879509507e-01; +1.912383475207271e-01   +4.019328263811850e-01   -2.631580825034603e-01   -4.727353314743450e-01   -3.546525060055667e-01   -2.237687846522394e-01   -6.091669753722040e-01   -4.809276895502155e-01   +1.556478556210856e-02   -2.118280823313476e-02   -1.625489860624088e-01   +4.836012776721564e-01; -1.012538716447239e-01   +6.669670462886754e-02   +8.542727208587083e-01   -1.454021066879458e-02   -6.952626593570450e-01   +3.467721500264607e-01   -5.470336267118592e-01   -7.636279828098992e-01   +5.181023743080052e-01   -4.976785432038332e-01   -6.715963994575718e-01   -3.158235160415422e-01; -8.662449250541984e-01   +1.943036215202857e-02   -1.362751017452193e-01   +3.683720685994046e-01   -2.014504841486414e-01   +4.428258994506601e-01   +2.388734111621543e-01   +5.164327750134919e-01   -5.919159327922452e-01   +4.569171600839268e-01   +2.902681900809718e-01   +1.550642783680930e-01; +2.042098569831886e-01   +4.437396262653758e-01   +1.622960410646865e-01   -3.509495788410509e-01   -2.068751953380548e-01   +3.252485583718825e-01   -6.685391504108174e-01   -4.096374885881099e-01   -3.891939506797045e-02   +5.822773819765021e-01   -6.082588699077867e-01   -2.197001887663273e-01];
L3E_L3I_iGABA_netcon = [-2.058292763238471e-02   -2.169396458514660e-01   -3.275696828355970e-01   -7.344899680776226e-01   -9.176802275616591e-02   -8.395542022517938e-01   -6.542232771942607e-01   -3.645072920434286e-01   +9.280822238980254e-01   -5.060386338710555e-01   +4.484382686522274e-01   +6.615931372095673e-01; -1.747825053868233e-01   -4.960734676353038e-01   -2.151458428731441e-01   +2.570213776334602e-01   +3.110336301958990e-01   -7.549196427545634e-01   -5.034887054979705e-01   -7.888529041350509e-01   +6.881902903615681e-01   -7.740595143911969e-01   +6.072581834425702e-01   -2.458810098591203e-01; -1.333533236420547e-01   +6.410719625361421e-01   +5.152236337075703e-02   -7.396702448636872e-01   +3.251497630197630e-01   -3.037591880105059e-01   -3.288657298010235e-01   -1.000000000000000e+00   +7.343090856722865e-01   -1.889189786070611e-01   +3.715703342917328e-01   -2.831528571674386e-01; +5.380095732044040e-01   -5.513471201238659e-01   -9.133542904500630e-02   -8.221521280467449e-01   -8.998841129219046e-01   +7.263693754927829e-01   +4.546431355706319e-01   +4.073320289219630e-01   -3.067546567191617e-01   -3.699950774126684e-01   -9.314815818194675e-01   -4.987853046490808e-01; -4.519487911578036e-01   +9.129179754200325e-01   -2.664114734571972e-01   -1.711870107099314e-01   -7.826605823051605e-02   +8.269113410121449e-02   -2.353740875516204e-01   -4.325775761968324e-02   -2.803029221990914e-01   -1.033123554061079e-01   -3.812846311877949e-01   +3.233889321815541e-01; +6.974384374404891e-01   +1.808318001167277e-01   -3.710514223295152e-01   +1.290637412914768e-01   -5.484861870327066e-01   +4.439332540906657e-01   -2.599657021955221e-01   +4.394377498500765e-01   +4.672930278569288e-01   -6.422676587904330e-01   +4.659531576296342e-01   -2.331910144264790e-01; -2.108616057997167e-01   -3.773258067606650e-01   -2.781378576697208e-01   +6.234225141924329e-01   -8.011033986544658e-02   +3.072415107624981e-01   +6.115100145148906e-02   -8.808962968021435e-02   -1.535076609867904e-01   +6.075888254789681e-04   -1.601716764527510e-02   -1.403997058135443e-01; +3.936597064500029e-01   -1.418031755214632e-01   +5.246264872061389e-01   +9.576713321215540e-01   +1.401411728064833e-01   +1.858967424411770e-02   -2.661299696726397e-01   -1.917814456906931e-01   +1.648111961409122e-01   -4.157373056079273e-01   -8.169016179078606e-02   +2.054287373963544e-01; -1.562239311124183e-01   -3.303642502710002e-01   +5.235845809287082e-01   +8.268229117307958e-01   -1.330615730656441e-01   -1.995242765412916e-01   +2.046041553166762e-01   +2.606864594177606e-01   -1.482086523698290e-01   +5.237279717941434e-01   -1.313367879449232e-01   -2.061774373307328e-01; -6.066512247177515e-01   +3.879578466561721e-01   +9.865036681175835e-01   +5.204259012015496e-01   +1.101670944807969e-01   +4.338178768539848e-01   -2.782544284155638e-03   +5.694430622344605e-01   +9.880217678114355e-01   -1.416119643902304e-02   -3.410744307078195e-01   -8.102532831122090e-02; +2.336503151403070e-01   -7.827214374080668e-02   +5.084448240513519e-02   -4.948240321131428e-01   +8.466938675599344e-01   -2.686277637280616e-01   +7.563192621309084e-01   -5.114449459615664e-01   +2.849288500792736e-01   +5.767417525015679e-01   -5.150720376367788e-01   -2.755714312989894e-01; +5.500160646283343e-01   +6.851176373988831e-01   +1.019665015327077e-01   +2.524193168326183e-01   +4.584529833399937e-01   -5.809827221565365e-01   -1.294215374386342e-03   +5.576234059783137e-01   -5.516034705493925e-02   +1.282408950824168e-01   +8.025772658915629e-01   +1.663133496446541e-01];
L2E_Input1_iAMPA_netcon = [-5.115908847063895e-01   +1.696305633409359e-02   -1.000000000000000e+00   +1.981899040554536e-02   -2.607447782613118e-01   +9.880736148936919e-01   +1.945794051466879e-01   +3.766173499728406e-01];
L2I_Input2_iAMPA_netcon = [-7.821324970175666e-01   -2.383037130354660e-01   -6.296221319534334e-01   +1.000000000000000e+00   -4.522806770001100e-01   -3.819525031121723e-01   +7.334111081815567e-02   -2.856978182088073e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
