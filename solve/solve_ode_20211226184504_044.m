function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.244817387623697e-01   +1.805554248254135e-01   -7.568634616448916e-01   -1.017327077705917e-01   -1.512820258884823e-01   -6.515379881353870e-01   +2.769961614199122e-01   -3.264808105139467e-01   +4.203011476303232e-01   +1.233555854477349e-01   -6.801645636220599e-02   -8.435049018460715e-02   -3.104125723836451e-02   +1.626784680829339e-01   -3.348871501085306e-02   +7.040077386479988e-01; +7.432248839517280e-02   +2.426691373458876e-01   -5.211380500642412e-02   +1.651976714553828e-01   -2.348805220003794e-01   +1.141618534064819e-01   -6.830425857368148e-01   -5.274548928676144e-01   -2.857783584145780e-01   +2.813166757937458e-01   +4.108628879134556e-01   +7.021789703461192e-01   -9.758252594517419e-02   +5.050979970466877e-01   -2.956190634249584e-01   +3.275042918798268e-01; +4.685863302519600e-01   -4.095684444912340e-01   -2.243358964789956e-01   -1.251932840459775e-01   -2.594641265348106e-02   +5.950462856066827e-01   +1.591620790323252e-01   +3.709145505299851e-01   +5.030385787803632e-01   +2.272866811305991e-01   -5.839316438953452e-01   -1.495278654985410e-01   +2.280656486356037e-01   +1.874606696656997e-01   -1.928800612470782e-01   -6.968217079920007e-02; -1.519269625793219e-02   +4.532085373936420e-01   -6.165981573661732e-01   +2.663922526813565e-01   +1.935682547441624e-01   -4.883620428306962e-01   -3.437200857299002e-01   -2.571188267930821e-01   -6.036088118993219e-02   -1.626137674629119e-01   -3.221678135407800e-01   -1.704982626589580e-01   +3.552702836291505e-01   +6.572214651866513e-01   +2.839093417351823e-01   +2.883606091707488e-01; +7.681022959461314e-01   -2.865873283147896e-01   +1.334899342293685e-01   -3.630392386554347e-01   -5.367984818473581e-01   -5.960083575283307e-01   +5.991643990005918e-01   -4.165828339606956e-01   -9.534179712337524e-03   +7.466544157889724e-01   +1.916027370039023e-01   +6.618263617452635e-01   -2.530769083712900e-01   +3.118615387546749e-01   -2.418603506838667e-02   +6.061924439264283e-01; -3.926888315743902e-01   +1.640625334546063e-01   -6.491219837971242e-01   -5.582202675005311e-01   -1.891475563669512e-01   +1.039102727523551e-01   -2.978079516439585e-02   +2.050294153737643e-01   +3.111057213723123e-01   -1.470150720573523e-01   +3.601367754907470e-01   +1.863809521547128e-01   -4.892746087246432e-02   -3.251282204326970e-01   +1.536684042533350e-01   +4.464330797534332e-01; -5.339839658246062e-01   +1.697870981929581e-01   -5.990125059396538e-01   +3.479617611114113e-01   +2.099058038958967e-01   -5.197706970319962e-01   -8.489319289460779e-03   -3.479987175482288e-02   +1.776149629750068e-01   -2.716012036690945e-01   +6.804920898401952e-01   -1.000000000000000e+00   +1.433151022243419e-01   -7.498730724494850e-01   +3.472568969812656e-02   +3.016299253882165e-01; +2.299710143608833e-01   +3.576625304520157e-01   +2.930433870352984e-01   +8.712779537750583e-01   -3.896992865497928e-01   -1.572828400938883e-02   -2.897889956167325e-01   -3.516448172975888e-01   -4.052676458165773e-01   +6.877259479654634e-01   +1.013560374144844e-03   -4.674876937246529e-01   +2.160411872649331e-02   +4.831766182330941e-01   +3.274846411869152e-01   -3.324558243855064e-01; +4.810839619822772e-01   -3.718365101177019e-01   -5.544474667158756e-01   +7.185213051349626e-01   -1.129104290263825e-01   -2.683188443242122e-01   +4.887027606144751e-01   +1.218002486393358e-02   -6.533533205133717e-01   -6.182118868325760e-02   -4.287932911164386e-01   +3.086627926188881e-01   +6.642858832366629e-01   +4.165627521349964e-01   -3.074501738658129e-01   +1.728179815973185e-01; +4.982894507709801e-01   -1.113464881442560e-01   +3.044620925278392e-03   +3.762577250176716e-01   +8.878546610595027e-02   +3.465440924211862e-01   +5.019476943376454e-01   +2.405322928534191e-01   -2.094452196060330e-01   +2.436648220386867e-01   -1.606600832471540e-01   -3.194995772348684e-01   -4.326236261530575e-01   -6.019581144989200e-01   +4.529922411674373e-01   -4.170647232905547e-01; +1.601891665210221e-01   +1.324481430210529e-01   -2.334662905260708e-01   -3.668237125580836e-01   -5.494267927142139e-01   +2.053386313487851e-01   -4.262587006511070e-02   -1.513267727362432e-01   +1.785597191154970e-01   +2.568499674990904e-01   -2.694237051303793e-01   +6.287688516915713e-01   +3.863152280132671e-01   -1.545684980936876e-01   -1.375467933650752e-01   -2.676179456157851e-01; -2.514255650444121e-02   -1.392481702182379e-01   +5.454580476186516e-01   +2.147068302893031e-02   +6.346896553852458e-03   +3.789035461446792e-01   +1.631624896907853e-01   +5.751495899295702e-01   -8.707868671131926e-01   -6.031098397325957e-01   -1.954423550687172e-01   +1.644159704127175e-02   -2.459030956359505e-02   +2.074830230334212e-01   +3.295152347412878e-01   -5.429137610712735e-02; +5.749882441761765e-02   -6.768064946910989e-01   -5.129362262072592e-02   -2.646280545167578e-02   +8.380579832223585e-01   -5.013007656791082e-01   +1.074100516171290e-01   -2.073608775276958e-01   +7.860698671408560e-01   -2.035256600722701e-01   +3.142973567449743e-01   +2.828368014710584e-01   -6.642409588714072e-01   -6.104621565696516e-01   +1.197607604358724e-01   -5.814297447758499e-01; +2.328866053334920e-01   -2.911538785652392e-01   -5.959978569424266e-01   +1.264368852241447e-01   -7.149490094315206e-01   -6.725510069938797e-01   +3.207057225851747e-01   -5.784417487739794e-01   +5.206481319300610e-01   +5.565965117406917e-02   +2.230988420801756e-01   -3.900590298783572e-02   -5.671816411937178e-01   -2.515371528762871e-01   -1.753070396386811e-01   +9.653596984335056e-02; -8.409741731106972e-02   -5.554667987432486e-01   -4.277433817493684e-02   -1.805500611714956e-01   -2.729448535080402e-01   -2.580628544797918e-01   +2.947978026457761e-01   +1.269800572075843e-01   -6.460901803863430e-01   +2.582978745097749e-01   +5.516268999620359e-02   -2.100425253385206e-01   +3.718251788554666e-01   +1.119041746577884e-01   +1.098103971865875e-01   +4.668894774444048e-01; +7.234857660750757e-02   -4.779531587205601e-01   +5.842358588447308e-02   -5.002526057592275e-01   -1.805199166749359e-01   -3.601201212245251e-01   -3.110586322146621e-01   -3.648447300456559e-01   +3.829898942713280e-01   -3.573897634765372e-01   +4.186715596580191e-01   +2.781965541945083e-01   +1.482179905773360e-01   -2.515385935849849e-01   -1.957935028814042e-01   +4.729275013949580e-01];
L1E_L1I_iGABA_netcon = [+5.847067918369373e-01   +2.714836822544769e-01   -3.706007754278877e-01   -9.320691403411994e-02   -3.667527561615677e-02   +1.028743082545320e-01   +7.689724665161064e-01   +1.787556179590607e-01   +1.441346196471057e-02   -7.249658797296217e-02   -1.765295918318084e-01   +2.883938792063090e-01   -6.564543182475117e-02   -2.487163082635252e-01   -2.432146108388273e-01   +7.796879073972790e-01; -1.468684080951358e-01   -1.171714015174011e-01   -3.550361728745906e-01   +1.884464860162733e-01   +6.557378662214925e-01   +1.373883924013209e-01   +4.227993630552806e-01   -7.076502871837084e-02   -2.557249998917742e-01   +2.874466734357720e-01   +6.824524107718180e-01   -1.666632509303105e-01   -8.115432690431836e-01   +4.500716989039644e-03   +8.995348190106801e-02   -7.485043703873655e-02; +2.939941765674786e-01   -3.070931098398606e-01   +5.697115629890720e-01   -2.199093882401905e-01   -6.618108247010643e-01   +1.033973053323921e-01   +1.798065493725303e-01   -2.033332220707796e-01   +2.325505340854249e-02   -1.649503307391643e-02   +3.899032481858117e-01   +3.192110169445476e-01   -1.656008142737368e-01   -5.942060157319653e-03   -5.128987989258864e-01   -2.933839709580703e-01; +7.749711345579927e-01   +8.669176073621669e-01   -6.700228414271981e-01   +1.999589502071392e-02   +5.087133213840354e-01   -1.043924173943335e-02   -3.078623009281857e-01   +4.856009394677944e-01   -1.597604556749699e-01   +1.966828493009161e-01   -2.898817220426232e-01   +8.963049636422733e-01   +3.856613684220153e-01   +1.965074049923518e-01   -8.727168065975324e-02   -3.263443175470289e-01; -3.903026535584146e-02   +6.087951385921226e-01   -2.213270551015325e-01   +5.116950257353192e-01   -3.770723643388346e-01   +4.416985409110021e-01   -9.506959654532172e-02   -6.218724856938553e-01   -5.886972057127582e-01   +6.518535314746277e-01   -5.538360656981299e-01   -6.905743421414250e-02   +8.025421624409581e-01   -5.929873301412738e-01   +2.050250783158704e-01   +2.868772294965301e-02; -4.993311343603463e-01   +3.390646543950577e-01   -1.734191501840013e-01   +7.549345441041243e-01   -6.894033622701964e-01   -4.664085538598117e-01   -3.293687235413996e-03   +9.319232422859007e-02   +3.825802359113797e-01   +8.281460235517556e-01   +1.529197076268909e-01   +5.914384881276518e-01   -5.662873188059633e-01   +4.188377096933332e-01   +1.293209033050870e-01   +6.143742079501152e-01; +3.013251448826506e-01   +2.889546221896871e-01   +7.360641686049801e-01   +2.878898407288410e-01   +6.374241004923623e-01   +6.946184308155667e-01   +6.095827122520709e-01   -1.704881353085167e-01   -7.339161182551260e-02   -1.224097733243805e-01   +8.912935289904097e-01   +4.206901527450662e-01   -6.799706832418719e-01   +9.610568732930469e-02   -1.942265735006304e-01   +2.987468255627340e-01; -3.648710116601022e-01   +1.574037304472747e-01   +7.744528042013663e-01   -3.184903482351293e-01   -2.638726218644385e-01   +2.634972118426113e-01   -5.806572420264472e-01   +3.815112835508562e-01   +9.719423536608299e-02   +3.430858543184446e-01   +6.821490582122058e-01   +2.571360874641929e-01   +1.702273882111040e-01   +2.049119808105507e-01   -6.499684702301248e-02   -5.909303903827872e-01; -7.043187284043810e-01   +7.470774687096658e-02   -2.686017141292886e-02   -5.948214900322580e-01   +1.691353598907293e-01   -5.580646292947302e-01   -6.107077861747874e-01   +2.631585963298684e-01   -3.294054741222814e-01   +3.163331959299766e-01   +1.696350505354645e-01   +2.056647798646543e-01   +4.894327445502452e-01   -4.719172375098659e-01   +6.683157769589522e-01   +2.940523615977793e-01; -7.740139569108632e-01   +5.175809179575837e-01   +6.733406588486920e-02   +1.555104474551901e-01   -1.320010473531226e-01   +5.162200688106587e-01   -3.777866635837092e-01   -6.947905571214725e-01   -7.054449713475827e-01   -3.527949823983577e-01   +4.310109688021441e-01   +1.367481399418551e-01   -8.430963029447971e-02   -1.734852167638968e-02   +3.178509793017034e-01   +1.735267606397037e-01; -6.428707271962668e-01   -5.155715667318646e-02   -8.048656387046234e-02   +6.733003869259264e-01   -5.251936415270342e-01   -4.725576197162043e-01   +4.144219681079747e-01   +2.964984867959068e-01   +2.536245434585861e-01   +3.919823732918531e-01   -1.197676574468715e-01   +3.949945663115882e-01   -2.496157799909081e-01   -1.036050590524072e-01   +3.632423475719222e-01   +2.030861497341506e-02; +2.260883024695889e-01   -1.452796712800431e-01   -7.463846805801810e-01   +6.801631965820447e-01   -4.648235989878939e-01   -1.365377762947701e-01   -3.601893839619109e-01   +3.402707665462738e-01   -2.107265558471660e-01   +2.482597430256569e-01   +1.833381049144087e-01   -4.945536382487487e-02   -1.277558094940677e-01   -6.192350853713098e-01   -6.713836323026298e-02   -6.424245132326671e-01; -1.981129794370146e-01   +8.757164489959079e-01   -2.108857010441194e-02   +5.135944690531338e-01   +1.092315330412662e-01   +2.271629106129325e-01   -2.773860733473769e-01   +5.456909751733794e-01   +1.894923459257497e-01   -1.960068331275822e-01   -5.109974123811071e-01   +9.216181326050897e-02   +2.659329551622212e-01   -2.096238828486715e-01   -1.444237522637090e-01   -3.028024771333567e-01; +2.726407740735174e-01   +1.824573618413164e-03   +3.683375535535436e-01   -4.872620952590846e-02   -2.349102472468028e-01   +3.102876586639717e-01   +3.548596622012022e-01   +2.126352081635326e-01   -2.608135981213153e-01   -6.106762955116458e-02   -7.543273054210906e-02   +3.206284487571552e-01   +4.518339313326513e-01   -4.679521596329403e-01   +2.401665915185480e-01   -3.236110484693821e-02; +1.553273505746210e-01   +2.493795358339115e-01   +2.328252950854364e-02   -2.376037020896191e-01   -5.547618505474381e-01   -2.658355058810457e-02   +1.033102472226963e-01   -6.164947270658626e-01   -1.477481300015391e-01   -3.202059642198634e-01   +3.493520839184119e-01   +1.367526061701383e-01   -3.814278213714419e-01   -5.838426129441324e-01   +5.132104855476970e-01   -3.678512087709289e-01; +3.470842549151233e-01   +7.937987902651039e-02   -5.450055784799832e-01   +2.634505425739849e-01   -2.416578495600243e-01   -7.002527631796300e-01   -4.743620751572035e-01   +3.691681906503160e-01   -2.916273347716554e-01   -1.000000000000000e+00   +5.541296728799947e-01   +1.591394394056288e-01   -9.598270136632248e-01   -1.676205069810686e-01   -2.458476102225094e-01   -3.792832514774855e-01];
L2I_L1I_iGABA_netcon = [+3.327887459571540e-01   -5.713020621769361e-01   -9.355362980644694e-01   +1.000000000000000e+00   +7.652164109864276e-01   -3.548428882305048e-01   -4.516880183893336e-01   +8.202454314311436e-02; +3.845658640602785e-01   -2.853289038861047e-01   +5.049370614492987e-01   -2.975520585982077e-01   -4.706937147225491e-01   -3.289835735526834e-01   +1.896583475440501e-01   -7.390516845979802e-01; +3.854523462099282e-01   +2.433324248407291e-01   +4.452199081050752e-01   +5.267494910613386e-01   -8.569664041908205e-02   -2.275349290156790e-01   -4.735827289349701e-01   +1.747427193439665e-01; -5.444556709999755e-01   -4.345984618762506e-01   +9.249417108683600e-02   +2.536605466203660e-01   -3.317997032896932e-01   -7.250852276056475e-01   +2.555016302887315e-02   +3.187527109405160e-01; -7.638912858250603e-02   -5.910731982622850e-02   +3.478528738290663e-02   +3.840803794588563e-01   -7.377300118155526e-01   +4.620005420589194e-01   +4.025063871002421e-01   +7.199210846836389e-01; +5.283628105966859e-02   +5.457643805139292e-01   +4.005717760613420e-01   +5.002514919894403e-01   +2.431405003018271e-01   +4.078657709670571e-01   -6.410483849687415e-01   -8.557572311036584e-01; +7.528282796432708e-01   +3.902997934528389e-01   -8.890963271951430e-03   +2.666056956969318e-01   -2.614619970349399e-01   +7.742820586725269e-01   -5.011646552531578e-01   -6.105769097936173e-01; +8.477442610044927e-01   -2.796916338864598e-01   +2.530342445558472e-03   -5.572725086747066e-01   +4.375215767720458e-01   +2.020491253965576e-02   +2.507939662040473e-01   +5.473090838970730e-01; -1.137884518511608e-02   +2.673465495004806e-01   -2.027256261780736e-01   +2.038213482862595e-01   +3.492656913810152e-01   -2.101305068305266e-01   +3.000106830649816e-01   -1.650230421851391e-01; +2.634307812614697e-01   -1.810555098094702e-01   +7.238848860655185e-01   +7.005780962164054e-02   -3.976396089367091e-01   +4.356204245173301e-01   -1.996124279526282e-01   +3.288108450349886e-01; +5.839395321474258e-01   -2.212206816784838e-02   +4.656364806129221e-02   +4.691492956715271e-01   -2.051394627459437e-01   -4.357639795764051e-01   -3.275111115469593e-01   -1.801872271579286e-01; +4.211382544086085e-01   +2.219637899452997e-03   -3.561030117812038e-01   +5.130936724099391e-01   -3.476427706436517e-01   +9.221313614217752e-02   +1.671612373168551e-01   +6.152994000855585e-01; -6.445053719770695e-01   +5.531077797527680e-01   -3.420045205954692e-01   -3.843267177735081e-01   +1.497276418524550e-02   -7.625639086697614e-02   +7.134041573653610e-01   +1.934489547928498e-01; +4.222472173302713e-01   -1.589525247321030e-01   -1.367639715001330e-01   +2.690821847753833e-01   +5.786939553212588e-01   -3.791841328343826e-01   +1.847247524165179e-01   -2.279297336423409e-01; +2.168132050970066e-01   +5.806342507590015e-01   -2.549297495248874e-01   -2.062039390781788e-01   -2.099782621564488e-01   -6.184620221729938e-01   -3.143092639989226e-02   +7.398747440376351e-01; +5.777518108377585e-01   -7.439271629382607e-02   -2.029835187770194e-01   -7.934767693595758e-01   +1.523893172473622e-01   -6.050677260350699e-02   -8.321856365022110e-03   +8.597558694018179e-01];
L1I_L2I_iGABA_netcon = [+3.696605116276631e-01   +5.290058918652075e-01   +2.584212668581032e-01   -1.989208245864000e-01   +4.782012115113285e-02   +5.524694481322017e-01   -6.995459161680205e-01   +4.639398797663818e-01   -4.211032268850411e-01   -3.732725532272870e-02   -1.629501280346198e-02   +2.261123845082234e-01   -7.119167540465873e-01   -4.811503053134517e-02   +9.452281224455271e-01   -3.715473434126515e-01; -2.237260026154329e-01   -6.200952577128425e-01   +5.201672320326044e-02   +4.884694780493316e-01   -8.337525074894608e-01   +4.080223888165506e-01   -5.474741182812572e-01   +6.421418628034031e-03   +7.754909977934746e-01   -2.992057249777978e-01   -6.248171447714295e-01   +6.963570646277129e-02   -5.196732961845894e-01   +4.061899710808138e-02   -2.880620881904363e-01   +7.530562347122377e-01; -8.592936434906547e-01   -3.708633410128540e-01   -2.880907499945597e-01   -2.239291564492063e-02   -2.363112527634645e-01   -5.427755846180441e-01   +4.958715829515349e-01   +2.107341823917028e-01   +1.995864269208640e-01   -9.572350160978178e-02   +4.936157677381970e-01   -2.144419970223335e-01   -7.971633312628575e-03   -8.739244288819298e-01   +2.419236337704420e-01   -8.330052313248666e-02; -1.118749407699620e-02   -1.672147574468297e-01   -1.732845010123334e-01   +3.841156086515250e-02   +1.413137326184336e-01   +4.506218639403392e-01   +3.687477552987113e-01   +3.693385525190613e-02   -1.095294835815298e-01   -1.521651586879001e-01   -3.038095374579176e-01   -3.367336054903945e-01   +3.854455510829636e-01   -1.487448459451227e-01   +4.547961825228379e-01   +2.627977429078886e-01; +2.086479964709831e-01   -3.778136945826848e-01   -5.411889169242851e-01   +8.512619132978927e-01   -1.201338957014910e-01   +2.874287662725484e-01   -5.159270794906967e-01   +6.659252698491025e-01   +3.278156218147505e-01   +8.726997399449594e-02   -4.179619932651373e-01   +1.000000000000000e+00   +3.315848150669426e-01   +9.396615503022085e-01   +3.838606079995890e-01   +4.259576235494896e-01; +5.100495224806724e-01   -3.244250350844011e-01   -6.509620008365699e-01   -7.799511111063460e-01   -4.620283520481427e-02   +7.545434326773125e-02   -1.834011352390517e-01   -8.525926255581381e-01   -2.211573278381860e-01   -2.222685677623082e-01   +6.465389505376418e-01   +3.248747066189817e-01   -8.058686116896490e-01   -7.813477035479658e-01   -4.469412921343787e-01   +7.758276184147721e-01; +1.703672677514019e-01   +8.881026867525359e-01   +1.586689486681573e-01   -6.180961344658031e-01   +6.239449895869573e-01   -4.607569458276685e-01   +4.693626890920750e-02   +1.016096833693041e-01   +3.410761097793953e-02   +6.844556087437912e-01   +2.563679804060657e-01   +4.188937118532503e-01   -5.279221771658344e-01   -3.845141939124669e-01   +1.026643798817179e-01   +1.117114873695694e-01; -5.973237032891299e-01   +8.995129197406494e-02   -3.827807642539834e-01   +3.799041295033818e-01   -2.371388675975467e-01   +3.936922520927097e-01   -1.248391767191998e-02   -1.847530624919084e-01   -9.147306401622112e-01   -4.104850223017527e-02   -4.259041919484934e-01   +4.550960057079776e-01   +5.171074727044498e-01   +5.785280354512103e-01   -3.097401000133607e-01   -4.814584519669385e-01];
L2E_L1E_iAMPA_netcon = [+5.061190741208856e-01   +1.847477526612185e-01   +6.646622435080204e-01   -5.802185247020796e-01   -4.847203633543551e-01   +2.679605482675058e-01   +3.918014882682606e-02   +4.624870420777907e-02; +4.720870819745772e-01   +4.440021905402898e-01   -6.487095655644476e-02   -1.792826319113820e-01   +1.406996995059999e-02   -1.804495484128797e-01   -8.663060780511202e-02   -2.007533424541701e-01; -4.291911223705521e-01   -9.335209787511910e-01   +1.472969015924923e-01   +8.225525838334053e-01   +5.643381571579014e-01   -7.213273024888017e-01   +2.714584791408238e-01   -2.310392123182983e-01; -6.250699212865247e-01   -2.028172519506793e-01   -2.990386003287508e-01   +2.072339234840841e-01   +2.101282967377632e-01   -4.731484457166079e-01   +6.226769460758724e-01   -2.296682895023570e-01; +2.271970762185110e-01   -6.063558921274317e-01   -7.819410582407604e-01   -4.802838041305758e-01   -7.026078107236537e-01   -1.182570359677302e-01   -7.450297136298116e-02   -4.214280100199432e-01; +3.372990037412965e-01   -3.520151011834553e-02   +1.893780762297844e-01   +6.396576746275862e-01   +1.138212633244738e-01   -6.122786552796839e-01   -3.130444511534552e-01   +2.129901853884033e-01; +1.350086022690991e-01   +6.342850878001886e-01   +6.448362457916638e-01   +7.086742037544085e-01   -2.027728949260053e-01   -1.902776716759268e-01   -3.999112855610665e-01   -1.138102865839110e-01; -6.654737305565761e-01   +3.688484909248462e-01   -3.522898552883017e-01   +3.273532195694728e-01   +4.107654178615110e-01   +8.148005304055909e-01   -2.232374694375688e-01   -2.531296718531763e-01; -2.324993169403064e-02   -6.987874911553258e-01   +7.249439227857075e-01   +6.404915722898555e-01   -8.752410645171167e-01   -2.051391914269547e-01   -5.734903882141712e-01   -8.933957173147754e-01; +3.954900620771069e-01   +3.171883489989319e-01   +1.773407075803379e-01   +4.518168187927981e-02   -5.600999410543538e-01   +4.578622042024343e-01   -1.701624441744154e-01   -8.069022215784598e-01; +5.735755507047148e-01   -5.514959771487230e-01   +1.923189907556819e-01   +3.450785871944070e-01   -3.185369028740154e-01   +6.281906563703684e-01   -1.244002564494283e-01   -1.544728701082181e-01; +6.991957990337834e-01   -3.126460313871156e-01   +8.307881203821700e-02   +5.990075418787491e-01   +8.243312569216029e-01   -1.011157943810107e-01   +1.923120428911874e-01   +1.759684950513732e-01; +5.498232973176971e-01   +1.394884551894972e-02   +7.221937143545142e-01   +8.218100860264991e-01   +2.982798631152860e-01   +3.354224400094655e-01   +2.414948761774443e-01   -1.544318146848059e-01; -2.977114302617487e-01   -3.079634897742048e-01   -1.535759416787966e-01   -1.371281037820838e-01   -6.442748218341454e-02   -3.024587416010351e-01   +7.527162591208162e-01   +5.520882214272738e-01; -5.286596242512424e-01   -3.544848401511835e-01   -6.015549397058368e-01   -6.357254743819467e-01   -2.922332856958888e-01   -3.877986920543084e-01   -3.922634689906798e-02   -2.042259962067927e-01; +3.733721464599251e-01   +3.076544983132083e-01   -3.332428940237016e-01   -1.337300756101856e-01   +1.000000000000000e+00   +5.853327825516376e-02   -1.842769796083932e-01   +1.739669660767251e-01];
L1E_L2E_iAMPA_netcon = [+5.648424623738135e-02   -2.263333181534516e-01   +1.651814609646447e-01   -2.176079183941677e-01   +3.769764263829722e-01   -1.651285084915459e-01   +2.958178224855753e-01   +5.420847832019808e-01   -2.465096133868716e-01   -6.108308627676243e-02   +3.249050594609879e-03   +2.448471203494300e-02   -3.507204629040748e-01   +5.235250520549879e-02   +5.867732019690901e-02   -6.882118882227020e-01; -3.784738441913971e-02   +1.062970252911201e-01   -4.901297347921280e-01   -3.868017486281168e-01   +7.079343166274641e-01   -2.180940763886667e-01   -8.445817009103395e-03   +2.259053353750126e-01   -2.989320197824145e-01   -3.053897453933603e-01   -4.463217069477767e-01   +7.200399962656889e-02   -3.425601766744060e-01   -3.064538741261314e-02   -1.565247153790848e-02   -4.625598335851825e-01; +7.489364877420823e-02   +7.805255324062013e-01   -3.773810619840307e-02   -1.426074261363310e-01   +2.020875268566573e-01   +8.953590879474403e-01   +5.782580096830676e-01   -5.838300151587967e-02   -5.174312727903343e-01   -3.619522288141925e-01   +4.084179390897466e-01   +4.335145980531448e-01   -2.026959459902652e-01   +6.533954646159458e-01   -5.256506776697673e-01   +2.213713119982343e-02; -1.745819712043090e-01   -3.773874872280264e-01   -3.479528733895326e-01   +9.490340250851054e-01   +1.496482684252431e-02   -1.685598752953568e-02   -8.383790404999990e-01   +1.227090670556633e-01   -5.563085454753597e-01   -1.148981827040452e-01   +1.084361508801942e-01   -8.545997720896749e-01   -3.589643555054056e-01   +5.461072697029891e-02   +3.944999458696890e-01   +2.841443654077950e-01; +7.651969265019452e-01   -1.059005579476936e-03   -4.954018170932659e-01   -7.411279015433336e-01   -3.646277757826791e-02   +2.642749969844819e-01   +8.429466462024566e-01   -3.911790191590124e-01   -2.903089458023435e-01   +3.153268775825138e-01   +2.080498870888603e-02   -8.927032621457249e-01   -9.896674161893183e-01   +7.810151454490754e-01   -8.298191881967764e-01   +1.986721665478262e-01; +1.145079546200980e-03   -5.947782463097776e-01   -5.965021170672943e-01   -1.098100143535289e-01   +9.681400661024578e-02   -1.444428732077344e-01   -4.601419432493509e-01   +8.644538311305412e-02   -3.925859001238753e-02   -1.860022954663357e-02   +3.365818726190126e-01   +3.534804524460511e-01   +1.378946983856113e-01   +4.760052212607436e-01   +3.804461129541190e-01   -5.315969550601807e-01; +2.398283196647872e-02   +3.115988837784318e-01   -5.163313370430251e-01   -7.166599305288274e-02   -1.276069497475481e-01   -3.560194845609634e-01   -2.372090300019604e-01   -1.408679045784910e-01   -9.338599612631641e-01   +4.411278194574870e-01   -3.161774017039109e-01   -2.631508997329060e-01   -4.604052236116342e-02   -5.524929256807809e-01   +5.687472266047736e-01   -5.998388695559651e-01; -1.155723328199544e-01   -8.612163146581605e-01   -7.192807743492427e-02   -7.309430941318951e-01   +1.618942572543812e-01   -1.001855294411406e-01   -4.207573285488543e-01   -4.343762698884971e-01   +4.614256045330164e-01   -9.238327989679187e-01   +3.924696600083231e-01   +4.621305044611915e-02   +1.678672830328474e-01   +3.635339589719047e-01   -1.000000000000000e+00   -2.939785744130693e-03];
L2I_L2E_iAMPA_netcon = [+2.762551734844259e-02   -4.537628158487065e-01   +4.067109507931820e-01   +3.383140258820255e-02   -1.055211752337980e-01   +1.646293061783105e-01   -4.745192894533414e-01   -4.256207673366481e-01; -7.612573308439825e-01   -3.327909883449520e-01   -1.528365857064702e-01   +6.184624126455411e-01   -6.125164090580932e-02   -9.262774460947323e-01   +3.178931231250485e-01   -6.651903712290006e-01; -4.136857474175512e-01   +6.061159480483408e-01   +5.377625724646126e-01   +1.000000000000000e+00   +1.303559660524340e-01   -8.186307640902821e-01   +4.215967901775965e-01   +8.714658265097812e-01; +6.806316491941585e-01   -1.423563194330424e-01   +3.964157584996185e-01   +1.201757741168898e-01   +6.576578364926290e-01   -1.715007972933249e-01   +4.424134449415187e-01   +7.129659791942669e-01; +5.577653907403674e-01   +8.032370167934435e-01   -1.797885433294281e-01   -7.298579288834340e-01   -8.794056431133077e-02   -2.844728103355714e-01   -6.247731172529841e-03   -9.677789097319272e-01; +4.386535688901490e-01   +1.017405970262237e-01   -2.230867727780501e-01   +5.896053905308341e-02   +7.526120463190858e-01   +3.980087042906869e-01   -3.562338123206248e-01   +2.007419486698977e-01; +1.306114173255431e-02   -7.978129043278680e-01   +6.410014174848851e-01   -4.607796908785114e-01   -8.468622139373899e-01   -9.036946781047800e-01   +7.385111454301699e-01   -5.245865319028546e-01; -8.887847219704553e-01   +9.243731447201406e-01   +7.679887350008503e-01   +1.859539287933850e-01   -5.970935036202699e-01   -8.994835273230319e-01   +3.557247854839604e-01   -1.289833933837092e-01];
L2E_L2I_iGABA_netcon = [+3.476008416121530e-01   +5.168332727826531e-01   +1.000000000000000e+00   +3.992074937441604e-01   -6.328751999461903e-01   +8.732299534561011e-01   -5.178607749291396e-03   +2.293215952975924e-01; -1.864148458422400e-01   +2.698152723932551e-05   +1.596692777160174e-01   -8.186608264188436e-02   +6.829639488737513e-01   +7.166880819919758e-01   -5.489653840428157e-01   +2.665199064704781e-02; -4.588399685630678e-01   -3.656581578735658e-01   +4.030461591257152e-01   -2.909734036968832e-01   -2.649999344250634e-01   -2.183756579438354e-01   +7.475025591754315e-01   +1.210572715007474e-02; -3.036363652339512e-02   -4.377693995851985e-02   +3.509971057044552e-02   -1.130318611331003e-02   -1.832431378167325e-01   +2.090821601284223e-01   -7.112540739578939e-01   +6.497420601491798e-02; -3.208010803055389e-01   -2.226628173602727e-01   +4.717176560121046e-01   -8.007321220215921e-02   -9.331802006861824e-02   -8.650633920737227e-02   -2.754366851540055e-01   +2.557079580174420e-01; +6.280673776235933e-01   -2.859616054338327e-02   -9.000787811872137e-01   -2.250150306540452e-01   +1.641805577922166e-01   +4.814838832826578e-01   +3.513013531944711e-01   +3.030157871280709e-01; +2.710811496442165e-01   -8.447467765531416e-03   +3.379731578796385e-01   -2.950717870088709e-01   -5.967744442987899e-02   -4.604311238201839e-01   -5.902411230156779e-01   +1.874498856945662e-02; +2.844881986120255e-01   +3.830381183384572e-01   +4.297833197938549e-01   -6.664071885901357e-01   +4.485996824364145e-02   +7.480418940788178e-01   +4.263393721237761e-01   -2.877112630113250e-01];
L3E_L2E_iAMPA_netcon = [-2.633249973614192e-01   +3.293053479682054e-02   +1.897628390871059e-01   -2.398479357645713e-01   +8.666205980866155e-02   -3.201030089229179e-01   +3.120229137989131e-01   -3.035099329366295e-01   +9.348616671421086e-01   -1.221085058295753e-01   +1.411371006244568e-01   -3.613640483627637e-02; +1.915645936714574e-02   -4.694946088767416e-01   -4.785009105489115e-01   -2.675174320581200e-01   -7.578704967036908e-01   -3.521511859582579e-01   -1.020265520292493e-01   +2.897247183940331e-01   +1.434287911163764e-01   +1.295073054836297e-01   -7.580920538882736e-02   -4.445746529539654e-01; +3.533536325670159e-01   +5.753175532456147e-01   -5.180379582340369e-02   +5.571239746890826e-01   -8.002916669150140e-01   +1.866266321943806e-01   -2.326818283354645e-01   +3.233672943742444e-01   -4.667897502046454e-01   +3.400903059113549e-01   +1.904089246800614e-01   +2.625247349814048e-01; -1.536075824674637e-01   +8.158600392911098e-01   -6.401612614754270e-01   +3.228151681441199e-01   +4.721112147953010e-01   +1.639077813976391e-01   +1.182591689500472e-02   +3.460699222031790e-02   -3.819105012102717e-01   +1.716657656815683e-01   +8.177953812576733e-01   -3.446395153780631e-01; +8.430014413952065e-02   +3.445171170730528e-01   -1.346773350953147e-01   +5.783913342551553e-02   +1.729436963618912e-01   -1.070569180033604e-01   +5.667377733650931e-02   +3.134734141700171e-01   -3.176953915074868e-01   +6.967875084160703e-02   +1.000000000000000e+00   +4.775283004487779e-01; -1.207444082100494e-01   +1.313744870916787e-01   +4.562350346665795e-01   +6.411603275700696e-01   -3.457965981561445e-01   -3.624310460760233e-01   -3.194189140140583e-01   -2.058206893149637e-01   +2.950051475649946e-01   -2.949028802595504e-01   +2.339150538569239e-01   -1.033354990614388e-01; +3.263494994421421e-01   -2.784751495406569e-01   -5.033275586453992e-01   +6.331781869251554e-02   -2.896501021566452e-01   -2.371143782289651e-01   -1.991274360005287e-01   +4.639641076970919e-01   -1.892293520469200e-01   -6.774928713782973e-01   +8.181718591075173e-01   -1.363895346271735e-01; -5.182664115740652e-02   -3.675066353208735e-01   +7.478778147001730e-01   -2.859506181968112e-01   -6.154960356445343e-01   -9.065635632680121e-01   -3.197630072875677e-01   -3.797300357075059e-01   +7.258295262556621e-01   +3.753027529103429e-01   +7.167073723601103e-01   +7.358806529607222e-01];
L3I_L2I_iGABA_netcon = [-3.769714570814014e-01   +4.655608618891057e-01   -5.733670889281699e-01   +5.658630291782306e-02   +2.890787567628541e-01   -5.604016244631713e-01   +9.152478204229585e-01   -1.017516765570986e-01   +7.755428995929038e-01   +8.346924516864561e-01   -4.295779551490690e-01   +2.865979485189018e-02; -2.595734439433744e-01   +1.721478596797577e-01   -4.027543316040648e-01   -7.997360440977287e-01   -5.121719249089046e-01   +3.448979140212636e-01   -5.215397635329286e-02   +1.726554792957755e-01   +5.992507950234752e-02   +6.644238327016263e-01   +1.049207767425759e-01   -7.576563129406640e-02; -1.512006135354681e-02   +3.061623600096982e-01   -6.639226270840067e-02   +5.794576036265600e-01   -5.226571918538503e-01   -2.215664981872018e-01   -6.264215084544476e-03   -1.433539117631358e-01   +3.648809020252300e-01   +3.355261333568781e-01   -7.820482733286484e-03   +1.173589969033495e-01; -9.082270157771336e-02   -7.735061164034810e-01   -1.533054942695811e-01   +8.243829242616540e-02   +5.462224956618709e-01   +1.975276297374304e-01   +8.751117991559602e-01   +1.535962314825541e-01   -2.808838809729113e-01   -9.879630572971018e-02   +8.970097654650100e-01   -3.780095091769452e-01; -4.489828376167161e-01   -8.847712024659120e-01   +2.133882208056118e-01   -1.583551848925206e-01   -7.599457916381624e-01   -2.070521681038855e-02   -8.733192526192536e-02   -4.084489711088180e-01   -4.952906632425022e-02   +5.560228387593339e-01   +1.830988834265467e-01   +3.262818528835211e-01; -1.111706654377667e-01   -6.832426375398899e-01   -5.437002933584135e-01   -6.703937778924173e-01   +6.698727612988246e-01   -1.483910897638625e-01   +5.381496287037939e-01   -5.805850444093223e-01   -6.463992819354577e-03   +4.671336961610874e-03   -6.962779067267211e-01   +5.521452542762892e-01; -3.266855660011794e-01   +7.265107752826196e-02   -1.810713570215841e-01   +6.259257704762264e-01   -1.159006054208637e-01   -2.685667229535681e-01   -7.653330418697277e-02   -1.824652070707167e-01   +2.991597947436079e-01   +9.309178454405759e-02   +9.468530152607105e-01   +3.345179268656489e-01; +9.961941256369986e-02   -4.246445610562403e-01   -4.103090809945300e-01   +3.281588403804060e-02   -3.535125929389659e-01   +9.304440259083526e-01   -2.322674572740993e-01   +3.816363705183767e-01   -4.350225300561431e-01   -1.000000000000000e+00   +5.089666360612292e-01   -3.873804834646534e-01];
L2E_L3E_iAMPA_netcon = [-1.631065374853182e-01   +3.856810843868411e-02   -1.947634011487032e-01   -3.058987762395551e-01   +6.618749833689025e-01   +2.846559015208921e-01   +3.131684751526894e-01   -5.278310623970520e-01; +1.894673729956181e-01   -5.101034017528665e-01   -3.865507660788902e-01   -1.690108296857244e-01   -2.807080840825343e-01   +3.758276658541240e-01   +8.006619349976630e-01   +4.840459414410956e-01; -4.395231805402175e-02   -4.057100059483065e-01   -6.907298552140864e-01   +6.620913418883002e-02   -2.383692988471343e-01   -2.874236670902787e-01   -9.830737846566243e-01   +6.731809050580411e-01; -5.632482166438766e-01   -5.664237774356103e-01   -6.822779627122193e-02   +7.670231023221952e-01   -5.667379617163594e-01   +7.071911098460663e-01   -3.895841989475732e-01   +2.380748499868272e-01; +4.898521537560304e-02   +1.399904753265050e-01   -4.896163263368339e-01   +4.217804825177396e-01   -3.170029423685593e-01   -3.345448206848586e-01   +1.571853737022139e-01   +6.240363946287689e-02; +3.154870592995643e-01   +4.299491591166120e-01   +4.743493858163261e-01   +3.350841695592170e-01   -4.399238196822366e-01   -3.681404246318250e-01   -7.912704024946925e-01   -3.575342967065100e-01; -4.159604983623075e-02   -3.175380638196888e-02   +9.071699604604918e-01   -8.627987769750473e-01   +1.643549730671481e-01   -2.914743360662990e-03   +2.237204549834991e-01   -2.420228475163870e-01; -1.263223320131056e-01   +1.635596556859601e-01   +7.232962514822745e-01   +2.546575979286188e-01   -5.920550993401118e-01   +2.000638210527214e-03   +1.827389595911385e-01   +2.940089255153370e-03; -6.876431249156784e-01   +6.020335090741432e-01   -9.154497364360092e-01   +6.419917205646325e-01   +7.816303833353047e-02   -2.386676707112136e-01   +1.478403346839542e-01   -6.895453602151558e-01; -3.575915336613361e-02   +6.621779558007295e-01   -8.800636720678578e-01   +5.537966603434016e-01   +1.166149186481098e-01   -3.918734799631704e-01   -2.179666738058256e-01   +1.894792369569579e-01; +4.960942113698302e-01   -7.289380447529475e-01   +6.482599289162071e-02   -2.491560738826604e-01   -1.605768791573020e-01   -3.082323227704832e-01   +6.839245261941536e-01   -2.174962349474886e-02; +7.160604656472787e-01   -8.199570661772103e-02   +3.669725465790901e-01   -5.616317227232535e-01   +1.000000000000000e+00   +4.453498628667014e-01   +6.048964058223586e-01   -4.111205567515260e-01];
L2I_L3I_iGABA_netcon = [-1.579444792693506e-01   +4.088975346170201e-01   +2.331188026713467e-01   +2.805456655071444e-01   +3.912963345062619e-01   +4.559630555628156e-01   +9.701812057952276e-02   -2.239710581581835e-01; -1.893795315800147e-01   +8.692312680790822e-01   +1.759753045190869e-01   +1.093277107638125e-01   +4.877746427231560e-01   -4.418556076718782e-03   -5.072811136866491e-01   -1.544913152615903e-01; +1.496316560811678e-01   +1.407307437245070e-02   +7.650148598374726e-01   -5.771524338999020e-01   -8.017930040523058e-02   +5.735841414247794e-02   +4.411270266434122e-01   -9.508665282555420e-02; +6.958018882022386e-01   +4.097443372924209e-01   +6.349511599047363e-01   -9.736936479599612e-02   +3.438826863255156e-01   +1.478194656669576e-01   +5.419154441088514e-01   +3.050161826058920e-01; -3.248854308467269e-01   +2.596134673430631e-01   +2.060691923751199e-01   +2.300857030937271e-01   -4.455078711552435e-01   -1.911711889824183e-01   -6.429540369240987e-02   +1.430681347211399e-01; +1.572440501394705e-01   +6.449724380521092e-02   +2.774305593549525e-01   +3.152465228977364e-02   +2.386335480707120e-01   -1.957628809620220e-01   -2.857493061349303e-01   -6.763360054957845e-01; +5.914237130973522e-01   -2.162710711443712e-01   +1.888449525336990e-01   -4.480693551038861e-01   +8.899567986068104e-01   -5.836253536163380e-01   -3.203288738916956e-01   -6.474739948160293e-01; +2.844480507646833e-01   +1.429436030557989e-01   -2.736558453997646e-01   +3.275401856400372e-01   -2.993263162068313e-01   +5.302896105516076e-02   +9.485337669876596e-01   +5.194441837464372e-01; -3.013286324949215e-02   -5.478488003499806e-01   +3.793539083136700e-01   -1.737109479497206e-01   +3.803814153832150e-01   -7.893341986207834e-01   +1.797698095553306e-02   -3.869844416669725e-01; -9.573594278979205e-01   +1.537314408505566e-01   +5.771757990044291e-03   -1.309275477327941e-01   +6.962076309845322e-01   +7.050124729754937e-01   -1.031592995864409e-01   -1.000000000000000e+00; -7.178941808407049e-02   -9.024065872375106e-02   -6.500961986845579e-01   +3.400251067509729e-01   +1.652324922480811e-01   -4.642269268787538e-01   -2.734604844163981e-01   +2.629358960968914e-01; +3.756423130181737e-01   -1.539522997531484e-02   -4.568325553127092e-01   -1.302411132875378e-01   +3.784631896967193e-01   +2.216860797131610e-01   +2.629167164959027e-02   +9.125129855879398e-02];
L3I_L3E_iAMPA_netcon = [-4.251044253252214e-01   +3.268731513261102e-01   +3.774442525375257e-01   +5.089481083963048e-01   +6.227146904571303e-02   +2.688893040250000e-01   +2.834016487882507e-01   +5.303533381432331e-02   +6.739619285048982e-01   -7.646059455217075e-01   -1.799525442790021e-01   +3.537926534438421e-01; -2.220555214940224e-01   +5.218515892795837e-01   -6.476031308954917e-01   -8.360896443003062e-02   +1.940733488406572e-01   -4.210491219677513e-01   -5.271857582274917e-01   +2.480567402236653e-01   -3.583213832870966e-01   +4.467988419069981e-01   -3.713906931179450e-01   -6.767599304527777e-02; -7.497066163497387e-01   -1.511287484431292e-01   +2.148871067892591e-01   -6.652513539733240e-01   +1.332184969736248e-01   -1.539387507868227e-01   +5.850865511486316e-01   -6.826885945144486e-01   -2.719920342213349e-01   +1.397499823790297e-01   +3.599849671537018e-01   -9.518080241925429e-02; -1.973166569563475e-01   -3.214718351522800e-01   +2.888131740516410e-01   +3.287989504953597e-01   -3.214759096651303e-01   -7.841953469451290e-01   -1.781055940514461e-02   -2.500190027197047e-02   -4.521856304695550e-01   -6.535961133245094e-02   -9.760168515514361e-01   +1.730649132436517e-01; +9.397750976935547e-01   +1.000000000000000e+00   -2.835965438883138e-01   +5.999281431639745e-01   +1.594241773162021e-01   -3.773190332249990e-01   -4.512842860403792e-01   -9.572860148578788e-02   +2.713765230360125e-01   -5.869201270926188e-01   +2.977303351546991e-01   -3.654743981752231e-01; -1.502800957643843e-01   -3.417205583284041e-01   -3.041753204512494e-01   -2.102295752163790e-01   +5.952414803724281e-01   +1.877929152563756e-01   +4.342274811409715e-01   -2.511487586089570e-01   +2.190114989390647e-01   -3.271262081105779e-02   -2.342722960898655e-01   -1.143742442750227e-01; +2.245889888393739e-01   -2.059856468468024e-01   -3.641842518470329e-01   +3.757741586645099e-01   +4.704402227925294e-01   -5.537085026534221e-02   -1.302543628638738e-01   -2.882758024452702e-01   +2.699204760817123e-01   -3.942367577715694e-01   +4.347929002122738e-01   +2.114676687119658e-01; +1.061720997211014e-01   +1.662768912235357e-01   +4.085090297547949e-01   -1.528528151237366e-01   +9.195014804615691e-01   -1.112134678613910e-01   +3.391521590630039e-01   -5.466413613087345e-01   -4.474605082044464e-01   -2.702852561250189e-01   +5.002915293748207e-02   -7.283641480567976e-01; -3.027007755623214e-01   +7.508109221794651e-03   +4.513362201589697e-01   +5.128715015890648e-01   -3.114013294247905e-01   +4.758191952074973e-01   +6.232044966895426e-01   -1.666687809544491e-01   +5.845762149513901e-01   +6.840883450176810e-01   +9.080914087939351e-02   +8.215766015683658e-01; -2.168507371731387e-01   +1.857639739687829e-01   -6.443022391960667e-01   +1.592130391377779e-01   -5.655127639351590e-01   +1.350731323737879e-01   +7.438365485831494e-01   -1.057429464036080e-01   -5.320185482010571e-02   +3.474647311070133e-02   -9.947413469076681e-02   +3.346408369516871e-01; +1.970712108403322e-01   +2.335854099514723e-01   -3.501697863177011e-01   +6.997994049008815e-01   +3.634491865151874e-01   -4.796573269782368e-01   +7.943637056910123e-02   -2.374383834994120e-01   +3.659141252420117e-01   -5.929625136735729e-01   -1.605515556873323e-01   +8.050783310222488e-01; +2.413722134560036e-01   +2.184172675590432e-02   -2.754689948288354e-01   +5.248481363102662e-01   -5.756515554403338e-01   -6.393960770501154e-01   -6.125784300286997e-01   +7.815530704000656e-01   -5.254645723570639e-01   -4.500823181590151e-01   +3.797282157313853e-01   +2.405516838523349e-01];
L3E_L3I_iGABA_netcon = [-7.215576563365796e-01   -5.283389785331322e-02   +1.711279640571647e-01   -1.126280682517399e-01   -8.724530388077615e-01   +4.036034914106517e-03   -1.866132448075524e-01   +7.034680183222772e-01   +6.959347215294762e-01   +2.193272161503452e-01   -4.065619747595715e-01   -4.675093731650964e-01; +5.736736538108030e-01   +6.295762021846630e-01   -2.776413463374938e-01   -2.908335641854995e-01   -6.272509620609908e-02   -1.865184273449867e-01   +1.807592345889864e-01   -4.432448407541743e-01   -2.635259056280237e-02   -1.334802509799022e-01   +6.377404014306589e-01   +3.286740687224623e-02; +2.820123453859296e-01   +2.529114533999045e-01   -1.660533079052406e-01   +3.902909784290950e-01   +3.071555245689602e-01   -2.215286031208070e-01   -1.320907577556398e-01   -7.735217514061345e-02   -2.931021150487562e-01   -5.860459870690958e-01   -4.751415452318656e-01   -1.763443373032456e-01; +8.870721005799951e-01   +1.305416603718026e-01   +6.471840864360005e-02   -5.535788413526105e-01   -4.035543921271628e-01   +3.995858036378685e-02   -1.061806524110927e-01   +3.798429166651103e-01   +8.087155413114613e-01   -3.271153793192645e-02   +9.775128781568514e-02   -3.014947643742421e-01; -6.254145737539405e-01   +9.875196363056915e-02   -9.196455710940130e-01   -1.632886937019345e-01   -4.521427656576776e-01   -5.464207783448352e-01   +1.529558337568265e-01   -6.161842546625959e-01   -6.273632255531200e-01   -3.520802566909303e-01   -1.888343756533845e-01   -2.081428555806917e-02; +2.113520614207412e-01   +4.586002263134992e-01   +1.642935981947345e-01   +3.892812616685247e-01   +3.321001328044537e-01   -4.285559991417244e-01   +2.447783455506884e-01   +9.326945195588555e-01   +1.910271819600359e-01   -3.123318295880243e-02   -9.330954043711951e-01   -8.556788875603399e-02; -8.085880090437404e-03   +2.890222199045057e-01   +4.779316429145357e-01   +6.599709000256676e-02   -4.027461754004531e-01   -8.604673281241482e-01   +1.435794453584493e-01   -2.313697321109371e-01   -1.991484265010256e-01   -5.130908885328969e-01   +2.180551860442805e-01   -3.355737208657310e-01; +2.574284878703919e-01   -1.000000000000000e+00   +8.393418453015986e-01   +7.114247557715757e-01   +8.282885665921332e-01   +2.619559451482092e-01   -7.478720040497474e-01   +3.815169277692645e-01   -9.873254610068480e-02   -5.498035720730540e-02   +1.459579333213065e-01   -5.283630216187346e-01; -7.995319591509757e-02   +3.290277728552435e-01   -8.970782740051059e-01   +4.399747108628800e-01   +7.640674184774809e-02   -6.441220421703444e-01   -2.742720046300746e-01   +3.697682003405316e-01   -5.210066900411898e-01   -7.045607689876912e-01   -1.979066239444475e-02   -1.353325481232977e-01; +2.100491370932192e-01   +1.032923069516099e-01   +4.185259354059000e-02   -3.496938007009665e-01   +7.461823900486756e-01   -9.373167463487113e-02   +4.445734599727252e-01   +2.946412008166926e-01   +6.919402653426860e-01   -6.716964335413449e-02   +3.570162787760342e-01   +4.529426483261072e-01; +1.434937002585111e-01   -1.193436898775834e-01   -2.162301286226044e-02   +3.799199554060935e-01   +8.471305519684134e-02   -6.635413238950459e-01   +7.414205301167756e-01   -3.708586870667384e-01   +1.363674242961429e-01   +2.783094101326825e-01   +1.205693580335774e-01   +1.271817786279902e-02; +4.405092855729559e-01   +2.378839240660982e-01   -4.891648824922752e-01   +3.516983510822377e-01   +5.909378988739090e-01   -6.470711089355718e-01   -1.670097654496449e-02   +2.271298506937830e-01   +4.345759976019665e-01   -5.086732541870662e-01   -5.431433673233013e-01   +3.463443982816435e-01];
L2E_Input1_iAMPA_netcon = [+6.587275897522976e-01   -1.042903856968626e-01   -4.484797462313094e-01   +3.627638556337668e-01   +5.830068478382389e-01   +8.536064355518447e-01   +7.361595222931960e-01   -9.997735831900335e-01];
L2I_Input2_iAMPA_netcon = [-1.548544217242933e-01   -1.000000000000000e+00   +1.555580558739958e-01   -7.502353542766216e-04   -5.500319046311588e-01   +6.297399523251154e-01   +1.467205818236427e-01   -6.370212027680022e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
