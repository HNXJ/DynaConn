function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.103747082897968e-01   +1.551802089023910e-01   +1.160157278081725e-01   +8.388877892757829e-02   +3.193541965482489e-01   +1.027393577805407e-01   +3.181463009006407e-01   +1.522112296450792e-01   +4.788318797071923e-01   +3.194484064087306e-01   +3.814945041795764e-01   +1.606698239776042e-01   -1.367010802008987e-02   +1.273567565729802e-01   +6.787198385480502e-02   +2.285745497735446e-01; +1.673468417008409e-02   +1.749635103173664e-01   +4.035971474453731e-01   +2.001494349294101e-01   -1.530807377086688e-01   +1.920236486033099e-01   +2.611439265061585e-01   +2.881156218065832e-01   +3.153117351854048e-01   +8.566598332564676e-02   +3.868202692317423e-01   +1.680150590090154e-01   +2.094859573585360e-01   +4.184006090654677e-02   +1.706819538907801e-02   +3.508113175337617e-01; +4.273433046088321e-02   +1.297185835882680e-01   +2.636704747810883e-01   +1.764315544209744e-01   +7.628080215447815e-02   +2.144398323125926e-01   -6.479811400226788e-03   +1.327113714674623e-01   +2.682289093467135e-01   +3.656447319767678e-01   -5.086546523241826e-02   +3.307253938764363e-01   +5.517341873605892e-02   -2.437943144933455e-02   -1.486186483165713e-01   +2.420616383764815e-02; +3.879864060837104e-02   +3.065277793216645e-01   +2.675871241159321e-01   +2.441908452475221e-01   +2.179859640394689e-01   +3.704564939337127e-02   +1.609595967257197e-01   +2.928654126281610e-01   +3.336787071628944e-01   +2.745855582188338e-01   +1.397208286128543e-01   +3.082337369728891e-01   +3.082382107097872e-01   +3.965653537259228e-01   +2.200427614104238e-01   +2.120954629586576e-01; +2.485182728753309e-02   +2.090633637000210e-01   -5.876770909108021e-03   +2.119140810922428e-01   +1.750673912413790e-01   +2.769338242452161e-01   +3.184419410362218e-01   +3.322289244769587e-02   +2.835402715582969e-01   +2.633814733667528e-01   -2.495305862996457e-02   +1.702656807163410e-01   +1.251584637512330e-01   +2.623737305610930e-01   -2.541177881672256e-02   +1.164762734869616e-01; +4.249047266546516e-01   +2.336375655145347e-01   +1.228971622374590e-01   +4.037428196249019e-01   +3.355814438094325e-01   +3.165737868263289e-01   +1.374808901754373e-02   +5.114693409857013e-02   +2.820539488904761e-01   +2.391813438919225e-01   +2.696713977851123e-01   +8.658104971535974e-02   +4.387516766572221e-01   +4.055846966800784e-01   +3.650741652832896e-01   +1.556923903096361e-01; -1.499939615597945e-02   +1.502622887776366e-01   +2.747816656241699e-01   +2.857659959460567e-01   +2.558086242792399e-01   +5.640643840410237e-01   +2.601392336225249e-01   +5.937189663078911e-02   +2.294648583378232e-01   +7.702470527316983e-02   +2.597514513849421e-02   +1.402155314139993e-01   +4.531473106267141e-01   +3.264676513007344e-01   +2.056657558268599e-01   +4.271344094753310e-01; +2.729411063631710e-02   +4.167420789371863e-01   +5.774648813784032e-02   +4.755414769316010e-01   +8.042042901112005e-02   +3.307825178881791e-01   +2.289265701370181e-01   -1.238990569315961e-01   +3.393617390166758e-01   +2.996378015049216e-01   +1.976988459971191e-01   +8.287551101592086e-02   +1.090864342259359e-01   -1.614356148893453e-02   -2.663318137579594e-02   +3.573507174594898e-01; +4.806545189867770e-02   +6.724106315345139e-02   +2.672831690057722e-01   +5.419308856167965e-02   +1.584875337720358e-01   +8.723448019914168e-02   +2.822776082537433e-01   +1.509041152885638e-01   +5.540211477045786e-02   +4.843557754045423e-01   +2.840600657069161e-01   +2.305272809518222e-01   +7.655839436360644e-02   +4.886785922995814e-01   -7.358195881261359e-02   +2.296922582028984e-01; +6.465272227036301e-02   -1.318267022352238e-01   +1.829733722692547e-01   -2.815171451464770e-03   +1.369614523006672e-01   +2.238870999691787e-01   +2.293222128702943e-01   +7.525107415406997e-02   +2.420610963107598e-01   +1.538490687449984e-01   -4.681043221127643e-02   +3.784940499574980e-01   +4.080831897634458e-01   +5.916882615033400e-02   +3.587739588215323e-01   +2.108001127370531e-01; +1.122991222027550e-01   +1.531831626894186e-01   +1.708267874104087e-01   +9.484356818581591e-02   +5.623226547062149e-02   +1.547933560843400e-01   +1.179100451071571e-01   +2.833067701985209e-01   +3.021179600718572e-01   +2.210044057285949e-01   +1.515535919718124e-01   +3.029662473142904e-01   -1.334540615838472e-01   -8.555187523515818e-02   +1.443866494625951e-01   +1.391627854339734e-01; +2.412501595253311e-01   +3.414549106326124e-01   -6.601177579949666e-02   +1.360684981461692e-01   +4.833623945328269e-01   +1.282147990710266e-01   +3.379776266166662e-01   +1.946981836922617e-01   +3.013500989674726e-01   +7.240369375993196e-02   +1.270092929897083e-02   -6.060466039046827e-02   +2.803361289679243e-01   +2.473090787997301e-01   +3.849898473650003e-01   +2.072870840301015e-01; +1.607902619938174e-01   +2.868972732439062e-01   +4.253478218474831e-02   +9.799900978886822e-02   +5.506376439113124e-01   +2.530595642431101e-01   +6.942473387392833e-02   +2.584272104550223e-01   +5.820017739104311e-01   +5.062038378062680e-01   +3.549383908297553e-01   +1.871895184902716e-01   +5.163280103747470e-01   +3.311074053467397e-01   +1.193410535071219e-01   +3.518469311379014e-01; +2.769770131553443e-01   +6.738444035656221e-02   +4.058907999370165e-01   +2.906799847020993e-01   +1.861788588455594e-01   -6.473353349824337e-03   +3.651549648029460e-02   +3.148000025681509e-01   +4.068308598496935e-01   -3.695788009393268e-02   +7.727416822231045e-02   +3.338818902505513e-01   +1.727633596096444e-01   +3.711520416730574e-01   +1.811508416868375e-01   +4.156426022284104e-01; +1.410621007967660e-01   +3.145286293479236e-01   +3.674117721899308e-01   +2.248023725441942e-01   +5.049922523266847e-01   +1.683068590050235e-01   +2.473339663443137e-01   +3.022737023320776e-01   +2.016051941730545e-01   +5.224251081129769e-01   +1.142487736698550e-01   +2.978971359110940e-01   -5.727281941724435e-02   +1.699944279452990e-01   +4.612879668274582e-01   +5.217993048613985e-01; +3.773062725078860e-02   +2.944938133574185e-01   +3.868812555611430e-01   +7.912309404141633e-02   +1.198300043436740e-02   +5.051533641568512e-02   +3.750538786532999e-01   +3.794961642385496e-01   +5.033999401905229e-01   +5.184371131939453e-02   +8.113111198380148e-02   -8.967424754248363e-02   -2.163759862106325e-03   +1.360560071593203e-01   +3.935449130553778e-01   +2.985685205657780e-01];
L1E_L1I_iGABA_netcon = [+3.368879542288413e-01   +6.874517779447098e-02   +3.885689366862241e-01   +9.666615335567494e-02   +2.690960926552536e-01   +4.568832209526742e-02   +2.517150984530664e-01   +2.596889837450398e-01   +2.308203967996868e-01   +3.212883012176411e-01   +2.766723797428646e-01   +4.052729984736436e-01   +4.293365767836816e-01   +1.854255799631347e-01   +1.086790418915090e-01   +2.608177508464223e-01; +2.313451001199765e-01   -1.965697778359149e-02   +1.628072771583981e-01   +2.070908396122498e-01   +1.586575949365805e-01   +2.625125226525773e-01   +6.133236901511270e-02   +3.837187133170609e-01   +3.348071415513489e-01   +2.884544850868151e-01   +1.230941757638745e-01   +1.844033075303662e-01   -5.790377220973775e-02   +3.659184942790174e-01   +1.887791855244297e-01   +2.573813180318833e-01; +2.230027787829675e-01   +8.190316662667026e-02   -2.036677710457924e-02   +1.778744700936543e-01   +1.504622801190589e-01   +1.181270792423798e-01   +6.443811503878763e-02   +2.066266536333289e-01   +1.367576459321766e-02   +1.694760292482856e-01   -8.285478260546061e-02   +1.788843910887994e-01   +1.067368451475657e-01   +1.231264650498930e-01   -1.464791166625859e-01   -2.885559490617096e-02; +1.837701736430245e-01   +2.710776738652714e-02   +3.929212478347867e-01   +6.537397982921375e-02   +4.919568481007233e-02   +2.742736799091616e-01   +2.148225408011257e-01   +1.926706728758373e-01   -2.250570475088101e-03   +9.771450012498831e-03   +4.512277074212789e-01   +4.037777734401943e-01   +4.062170107120417e-01   -4.471187829426205e-02   -2.271742158208127e-02   +3.027837208796535e-01; +4.233401541280835e-01   +4.345886725010887e-01   +4.710782067785202e-01   +1.388929532158645e-01   +3.018195907176061e-01   +2.272400527757847e-01   -1.173919710349445e-01   +3.570744088226581e-01   +1.892957805011986e-01   +1.935712704700737e-01   -6.889815946332235e-02   +1.257850052298152e-01   +3.632261204987379e-01   +1.936763932750032e-01   +1.520497947247043e-01   +8.810467258506922e-02; +2.659859906001716e-01   +2.850719279166173e-01   +1.299999431954504e-01   +4.545205737184037e-01   +3.248377983244132e-01   +3.582043422753598e-01   +3.151471878239919e-01   -9.755900239784927e-02   +3.741720475118269e-01   +4.027682577847110e-01   -1.513371060854567e-01   +3.841165412582259e-01   +1.880914163318075e-01   +2.869154498889503e-01   +6.844161254559564e-02   +3.981968061905466e-01; +3.523067521703283e-01   +3.139535157169435e-01   +2.793889822864388e-01   +9.676835411807229e-02   +2.255734762342738e-01   +1.899292736718040e-01   +2.430834404987130e-01   +1.662159345913823e-01   +1.636161990891588e-03   +8.016423031831023e-02   +2.317192820053069e-01   +1.465437975865125e-01   -1.017642470785399e-02   +2.336922412866833e-01   +2.024285649964634e-01   +2.023804900882722e-01; +4.139371159960769e-01   +2.351503172052134e-01   +4.427863152660287e-01   +1.735486025181966e-01   +4.329789407484525e-02   +1.233511506215776e-01   +2.931312841924760e-01   +1.454747002291682e-02   +2.696339818238281e-01   +1.048287025075583e-01   +3.256962349685479e-01   +3.062684981106337e-01   +2.791764444066805e-01   +1.339139239631350e-02   +4.043733883718375e-01   +3.527455567767031e-01; +5.998821654847272e-02   +5.202548137157726e-01   +2.891997390743571e-01   +6.485880155088425e-02   +2.843810938475222e-01   +2.233552315164554e-01   +1.368450338229162e-01   +8.785416287165089e-02   +2.035145421618514e-01   +1.373412866662765e-01   +1.960478830552851e-01   +1.279932384761822e-01   +5.656535037743812e-02   +2.634029060262653e-01   +9.848212951508856e-02   +1.963648347750500e-01; +1.391374783105770e-01   +4.199635839317181e-01   +3.448827169473097e-01   +2.458259843762569e-01   +3.484090102486714e-01   +4.675244247972755e-01   +4.828416817788945e-03   +1.509407117897598e-01   +1.901666347103295e-01   -2.898419346522031e-02   +1.859038740186834e-01   +2.395213892314108e-01   +7.538120326249582e-02   +2.569283823963531e-03   +7.911969460042402e-02   +2.906913817165158e-01; +1.582885029601800e-01   +1.352252866386321e-01   +9.679989884174268e-02   +2.266255379223925e-01   +2.748387168240162e-01   -1.173681907558240e-01   +3.316372938776238e-01   +2.130568016174334e-01   +1.625070440199429e-01   +1.337850848063552e-01   +1.759166209761696e-01   +1.502521424708739e-01   +2.440628946314765e-01   +2.052149903454219e-01   +2.256526414012739e-01   +2.876752711121636e-01; +5.614423860137138e-02   +1.581216942677958e-01   +1.433685560344568e-01   +9.020086840263945e-03   +1.825089459743475e-01   +2.485977295295319e-01   +6.698265439884825e-02   +3.157986470906287e-01   +4.549901126127553e-01   +2.185879128530873e-01   +5.263995387636902e-01   -5.278880814330499e-02   +1.730108724228498e-01   +1.486041683576180e-01   +3.067533751417937e-01   +3.552197451196445e-01; -1.169536274265990e-01   +4.658643590282264e-01   +4.217399775910518e-02   -1.062907056287450e-01   +3.699062951026734e-01   +7.520059900984082e-02   +2.702492042052420e-01   +3.939996444558032e-01   +1.475126374719475e-02   +2.234750490082482e-01   +1.601546514276171e-01   -4.884820563391928e-02   +3.958947905444691e-01   +3.987705892003902e-01   +5.114175269997110e-01   -8.142935725024375e-02; +1.095441229468848e-01   +2.298849600049024e-01   +4.490338305427595e-01   +3.883979095054653e-01   +5.655236858633399e-02   +2.025887927495623e-01   +2.834689269972192e-02   +2.763188536602879e-01   +2.941391491388969e-01   +2.126226653686018e-01   -4.092251051849023e-02   +1.305351991279177e-02   +1.431809462386976e-02   +3.569655145849421e-01   +3.843529895740285e-01   +1.551420610322866e-01; +1.626607520886447e-01   +2.975296759472437e-01   +1.573799862143685e-01   +5.947045633181628e-02   +3.702538410448424e-02   +3.894798611701514e-01   +3.836755724019082e-01   +2.252965415430337e-01   +2.779785847919066e-01   -1.772480551079034e-01   +2.044407503325302e-01   +3.656224082008888e-02   +1.623819002849002e-01   +9.139281589842410e-02   +2.171669270187753e-01   +3.210556831813198e-01; -7.483051527937030e-02   +4.345977757123944e-01   +1.663643363623910e-01   +2.274828102371784e-02   +4.563685288633783e-02   +5.678530175701023e-02   +4.488953735221869e-01   +4.377083382704271e-02   -1.146814622425920e-01   +2.162714652340693e-02   -1.358589274663185e-02   +3.085009966491640e-01   +7.900418008974047e-02   +7.050202969006644e-02   +2.241698814165084e-01   +3.186300331116825e-01];
L2I_L1I_iGABA_netcon = [+1.568202331638423e-01   +2.809356599401419e-01   -3.346360018181305e-02   +9.849255053539557e-02   +1.882337403175798e-01   +1.429323980399497e-01   +2.800709453977606e-02   -6.695320252943875e-03; +1.698630961834179e-01   +1.643173738756896e-01   +3.317843050223211e-01   +3.654005082285764e-01   +2.912341940484139e-01   +2.285933073785876e-01   +4.628316354682551e-01   +3.187106571857662e-01; +2.849120303953656e-01   +4.477029382049953e-01   +3.868931022025964e-01   +7.032919067752169e-02   +3.089496928223233e-01   +2.420571727155292e-01   -1.065652664695542e-01   +4.425880735764667e-01; +5.117353003577929e-02   -6.025543150458888e-02   +1.376401909889560e-01   +3.588864312298787e-01   +9.507356091835495e-02   +1.160005036763731e-01   +3.795715517650013e-01   +2.963074763066300e-02; +1.439238433290163e-01   +3.260528513613205e-02   +2.654506311124294e-01   +4.186269447997828e-01   +3.725308920409614e-01   +4.520217294537376e-01   -4.007383416009715e-02   +2.654795808403903e-01; +2.345706546774907e-01   +2.113666326081882e-01   +5.370106977242091e-01   +4.802252162113762e-01   +5.089695464080815e-01   +3.509163698363238e-01   +2.251772704739669e-01   +6.479697053958555e-02; +1.264764329419964e-02   +9.217351965753376e-02   +1.464490738241960e-01   +3.130258821484760e-01   +2.128938706096434e-01   +4.020787023498539e-01   +3.398754305834103e-01   +1.478148694532805e-01; +1.216385304947091e-01   +1.048699021290150e-01   +4.747337344564247e-02   +3.318790121488103e-01   +4.234751789243270e-01   +4.508008381521415e-01   +2.690738186339452e-01   +1.697529299476617e-01; +3.097218298154276e-01   +1.549258377763620e-01   +2.012203179760717e-01   +3.596088761763275e-02   +1.369865493292211e-01   +1.364370422158958e-01   -1.226205034499966e-03   +3.039114750503127e-01; +8.687130735420193e-02   +3.800452552160571e-01   +2.300004526340370e-01   +3.115457854392209e-01   +4.109970551631562e-02   +3.837799509146390e-01   +1.784705425944313e-01   +1.177979952202327e-01; +4.697270583086288e-02   +3.280627489523153e-01   +1.888126969674786e-01   +4.378091313233159e-01   +3.969000572756333e-02   +1.724416781443210e-01   +5.461119737626736e-02   +3.233492789470782e-01; +3.940400437571302e-01   -1.901475765652765e-01   +2.410971290666033e-01   -8.119697497417151e-02   +3.588662301927286e-01   -6.085463664846930e-03   -3.171136589730622e-02   +1.457549469318558e-01; +1.622709590658721e-01   +1.323595147150853e-01   +6.408442948602404e-02   +3.665196198933043e-02   +4.141506265477010e-01   +3.957720055992218e-01   +9.031245834904573e-02   +5.538330562516909e-03; -1.376387340861780e-02   +2.387561779142284e-01   +1.105019427163826e-01   -1.284488530564545e-02   +1.583909569331318e-01   +7.787556202198825e-02   +4.671963780764421e-02   +3.096167555048568e-01; +4.239004260137023e-02   -4.777680626495297e-02   +4.531887651709370e-01   +3.340725764119676e-01   +9.109233591929479e-02   +8.519660126693911e-02   +2.130254722294844e-01   +1.519302239952199e-02; +7.812164240678980e-03   +2.468950547549555e-01   +3.329828238520950e-01   -4.236140343827464e-02   +1.794046852210018e-01   +2.893618369332807e-01   +2.945561747624437e-01   +1.348788736640019e-01];
L1I_L2I_iGABA_netcon = [+2.083877959712570e-01   +3.004710177433930e-01   +4.563487618666430e-01   -4.342546191979532e-03   +2.097522869088292e-01   +4.516763872370871e-01   +2.669678723169169e-01   +1.500043192683338e-01   +3.007133392013991e-01   +8.219867316447808e-02   +3.151290350827980e-01   +3.096735883176808e-01   +2.640205455190869e-01   +3.778961365617773e-01   +5.045415822436372e-01   +3.202145834577298e-01; +4.367840081497185e-02   +2.700602387533429e-01   -9.703024321522889e-03   +4.980785169679548e-01   +2.405471505201183e-01   +8.257433513612100e-02   +3.077634881629886e-01   +5.419419785787856e-01   +3.987916016304311e-01   +8.986815422508150e-02   +4.173005461440211e-01   +2.354288824722407e-01   +1.842120605970709e-02   +2.028826867278921e-01   +5.195049088308259e-02   +3.479687008558490e-01; +3.097621468972283e-01   +1.118994783292795e-01   +2.954345041939462e-02   +1.631497648229021e-01   +2.755675879686544e-02   +1.827863087627462e-01   -5.218399366960599e-02   +2.423700023578756e-01   +6.587927828870081e-02   +1.887594945731742e-01   +4.902871361662811e-01   -1.840236358731169e-02   +4.503392996152677e-02   +7.944504566660410e-02   +2.912444983497158e-01   +1.937909889483282e-01; +2.410857574623252e-01   +2.200791196192636e-01   -1.621490729121355e-02   -9.036718407590075e-02   +4.487227788597455e-01   +1.683053037014322e-01   +2.507185187245592e-01   +3.327693773689318e-01   +3.096479881353463e-01   +5.137345587997970e-02   +2.263884847034880e-03   -2.455871811872388e-02   +4.573200093062394e-01   +3.578085852953891e-01   +2.207943763457638e-01   +2.159261907566563e-01; +2.442585196110210e-02   +3.998847754573480e-01   +3.127823791622804e-01   +3.780179192255217e-01   +3.357460982628198e-01   +1.376322170040067e-01   +2.212857189601535e-01   +3.187607852824106e-01   +6.064161465205919e-02   +4.776937461084925e-01   +4.092742307611416e-01   +3.921557864673299e-01   +2.867823105590607e-01   +1.168412706568006e-01   +3.032811826414182e-01   +2.848756905065933e-01; +2.717522541799082e-01   +2.910471664017963e-01   +3.209105454766289e-01   +5.155352038729490e-01   +3.852503010777145e-01   +2.483927346469900e-01   +3.939691815275716e-02   +2.937826303703864e-01   +3.760675504262591e-01   +8.401232918756159e-02   +5.413743461559799e-02   -2.411409375064071e-02   +1.961929612978539e-01   +1.367443575134364e-01   +2.187454842950309e-01   +2.982191685856229e-02; +1.606571304864488e-01   +3.680451293220913e-01   +3.187104218932464e-01   +4.909867076653912e-02   +3.623772752502024e-01   +2.549429053335429e-01   -3.882850804676761e-02   +1.662737469276896e-01   +2.068943572929037e-01   +2.022054233223728e-02   +2.227239944872999e-01   +1.217033882711377e-01   +3.557555630830834e-01   -8.059404692284945e-02   +5.057500391050888e-02   +3.158252695291142e-01; -7.834013375661798e-03   +2.658218851807069e-02   +4.866072336255610e-01   +1.770204336580931e-01   +1.629406047986185e-01   +1.652936633722456e-01   +3.430111210291036e-01   +9.531136086806857e-02   +1.729339281164275e-01   +3.027124950695910e-01   +1.476302299093156e-01   +2.239596761979436e-01   +2.871551765772128e-01   +1.576405008333967e-01   +2.521589968091208e-02   +4.100117627878535e-01];
L2E_L1E_iAMPA_netcon = [+3.249314344008975e-01   +3.984578658533891e-02   +1.444284158763853e-01   +3.443094012035690e-01   +2.156900987293019e-01   +1.853070206372167e-01   +4.571748557819759e-01   +7.693880823543736e-02; +1.454757670673952e-01   +2.249021565989934e-01   -9.236677086440435e-02   +1.306154152216628e-01   +2.308422045150019e-02   +1.166430795105066e-01   +2.140313085445868e-01   +5.744427201847719e-02; +5.821366450136057e-01   +2.362339016269731e-01   +2.960594337228993e-01   +1.654359043797962e-01   +4.441894771019548e-01   +1.973261467056859e-01   +2.211258567019273e-01   +2.655913629900813e-01; +2.280083533236878e-01   +1.011599915366958e-02   +3.793316825817095e-02   +9.646719282896579e-02   +3.310660533936878e-01   +3.814941514575034e-01   +1.185947466833901e-01   +1.676182809891861e-01; +4.815978200013690e-01   -9.333702126060284e-02   +2.306595215668146e-01   +2.872215136904142e-01   +3.848042485058493e-01   -5.371918342295527e-02   +4.668050675340372e-02   +1.263004493227277e-01; -2.729167194082959e-03   +1.991688642376516e-01   +7.341226839111908e-02   +2.189831607985312e-01   +3.955913320833037e-01   +2.446094004621159e-01   +4.805033801713130e-01   +2.838270964370536e-01; +6.173429376316166e-02   +2.904689495093236e-01   +2.566120369458393e-01   +1.460151193175286e-02   +2.335189233280330e-02   -4.144387247509358e-02   +1.651034511474389e-01   +1.724028484900247e-01; +3.482416346197130e-01   +1.647320389370640e-01   +3.368294432408660e-01   +5.353529928276971e-01   +1.644491137380944e-01   +2.205156480232309e-01   +1.707091846008478e-01   +2.008123967336318e-01; +2.706010520770736e-01   +1.423835642689858e-01   +1.491337341259830e-01   +3.320047648157872e-01   +2.751483745719693e-01   +2.437044066699509e-01   -9.133417505668366e-02   +2.870709242660728e-01; +1.784389437509314e-01   +2.173208989399717e-01   +2.791671115385804e-02   +1.248896965391949e-01   +1.713267525688514e-01   -3.552913444779328e-02   +1.289558958635018e-01   +4.310003500669356e-02; +1.234837179994717e-01   +4.835299622969901e-01   +9.429875292605057e-02   +3.360208429689852e-01   +3.308690482261328e-01   +2.021780707207833e-01   +2.198986649447436e-01   +4.434486625116754e-01; -4.114927066044913e-02   +2.848058686752718e-01   +2.864610421202643e-01   +9.390821317219883e-05   +4.340364903103180e-01   +2.076304847489759e-01   +2.289622930220196e-01   -5.815617103268268e-02; +3.314680372200188e-01   +2.387453333016821e-01   +2.941615679890038e-02   +6.493051308789749e-02   +1.936953935091691e-01   +2.987106017016302e-01   +5.319894249215460e-01   +1.124322692368318e-01; +2.664999898953739e-01   -4.171397200700555e-02   +3.071025115011720e-01   +5.603130042139386e-02   +4.622478269731991e-01   +2.778265089554963e-01   +3.863905516855884e-01   +1.055252605527904e-01; +3.460093788344986e-01   +3.102718772004285e-01   +1.348810675624481e-01   +1.549339749090976e-01   +2.320494203845956e-02   +2.923636489526525e-01   +1.493967858669131e-02   +9.917995066824840e-02; +2.308354124857676e-01   +2.672105702561628e-01   +3.741463682580972e-01   +2.345774919761736e-01   +4.845597891940918e-02   +6.372322327690592e-02   +2.653872846479806e-01   +2.979906394492466e-01];
L1E_L2E_iAMPA_netcon = [+2.370441879249869e-01   +3.988997835201016e-01   +2.938646494635613e-01   +3.902358314086418e-01   +3.148554288466247e-01   +8.896770943020257e-02   +1.812790643727921e-01   +4.168616539047421e-02   +2.399502289420472e-01   +1.874401312513544e-02   +4.741632350178892e-01   +2.677956676977108e-01   +2.967664987078778e-01   +7.919780270803281e-02   +3.087803526326591e-01   +5.645891860703721e-02; +2.269142058644832e-01   +2.957600110245486e-01   +1.903448233972330e-02   -1.654024666284380e-01   +3.740815543675217e-01   +2.292087613535022e-01   -1.506440272423908e-01   +7.334124891332812e-02   +8.466194161985732e-02   +3.131526376400789e-02   +5.313628713562921e-01   +1.881327349098317e-01   +3.501660239901581e-01   +5.989859589053319e-02   +7.953155470310708e-02   +2.573600925887054e-01; +3.395107237826941e-01   -1.155816699110465e-01   +3.588885522973009e-02   +2.205784087213677e-02   +1.285012160442628e-01   +2.291853695422893e-02   +1.373283542431949e-01   +4.875220080950300e-02   +2.192607191927562e-01   +2.439278401227328e-01   +4.709731749478414e-01   +3.105604918551332e-01   +4.464132323986487e-01   +4.608246034666889e-01   +2.247731095937171e-01   +2.180174465490528e-01; +4.869483793451078e-02   +3.750806149065062e-01   +2.832427369865969e-01   +6.521792361600372e-02   +3.508387931252016e-01   +2.839318264721133e-01   -1.777439245867833e-02   +1.836251908268303e-01   +3.061186740402367e-01   +2.673840636081467e-01   +2.299601133622916e-01   +4.443353272072176e-01   +1.327321227071571e-01   +2.409873434665394e-01   +3.956931564302276e-01   +1.547108681691712e-01; +2.083478700634339e-01   +8.218552346255674e-02   +3.425040795469406e-01   +1.862210273429064e-02   -1.880122365653067e-02   +4.702768406426117e-02   +2.052866753465575e-01   +5.532588810065735e-03   +1.518716001691770e-01   +1.487533848150159e-01   +2.055472306094367e-01   +4.301230540930139e-01   +1.068478182759590e-01   +2.895880519575966e-01   +1.651158109513050e-01   +1.063192050799076e-01; +3.390604612206827e-01   +1.100098308156566e-01   +3.128246042470141e-01   +8.780157598908980e-02   +2.457515793751903e-01   +1.049623962778456e-01   +3.311712871581596e-01   +1.968892586463259e-01   +4.712755212142957e-01   +4.631548359108720e-01   +2.703575808301442e-01   +6.972033174308988e-02   +4.363424059057321e-01   +3.008089871671804e-01   +2.226751441408621e-01   +1.752547724960662e-01; -3.933501516937148e-03   +3.374592237239031e-01   -2.935347406692120e-02   +1.921753570088087e-01   +2.327462233118575e-01   +5.635904212918529e-01   +3.791399548726490e-01   +2.622653034069277e-01   +1.878207202338676e-01   +4.975336013411039e-01   +1.111795911820457e-01   +7.563456261057636e-02   +8.087593106861711e-02   +3.257448174277554e-01   +2.837801845433192e-01   +4.104459494354206e-01; +1.645957941342726e-01   +3.944465315204999e-01   +3.256315462161822e-01   +2.571770950355592e-01   +1.939885061585851e-01   +1.639557045332046e-01   +6.456182557205270e-02   +4.443231969830051e-01   +1.924657351096731e-01   -3.777283398565182e-02   +2.393884741120444e-02   +1.151648791979717e-01   +5.779440825722522e-02   +4.042944054686215e-01   +1.882758832025436e-01   +3.130995076970609e-01];
L2I_L2E_iAMPA_netcon = [+3.757707000589568e-01   +1.536934956413406e-01   +2.624518695772825e-01   +1.457791994233360e-01   +3.632928379740370e-01   -5.050910934558765e-02   +2.457365828194276e-01   +4.088436546176814e-01; +1.539047118619525e-01   -2.043027010625666e-02   +2.611286990994042e-01   +4.540173496963261e-01   +1.555976243750801e-01   +2.941618240659845e-01   +1.539647491933643e-01   +1.158846872297100e-01; +1.534938803966248e-01   -1.754845923463618e-03   +2.475723071998496e-01   -3.447357216079233e-02   +2.378366476063539e-01   +2.454919892785296e-01   -6.944831057920098e-02   +4.624052136267318e-01; +2.334219334997575e-01   +7.185349004935598e-02   +4.301979537661321e-02   +3.247994270376013e-01   +1.810973831691152e-01   +2.758216038182789e-01   +1.912345522561448e-01   +3.252188234591937e-01; +1.211477106747263e-01   +3.587086705372785e-01   +3.724949702793682e-01   +1.878077319569994e-01   +4.214558770379256e-01   +3.547193544580900e-01   +2.594256436817876e-01   +1.405560159156297e-01; +4.656218969428949e-01   +3.970997821962569e-01   +1.044277248600203e-01   +8.925394171385499e-02   +3.631229156003135e-01   +4.249958392417163e-01   +2.632399344785796e-01   +2.763365864653453e-01; +3.604385136024872e-01   -1.061454959604855e-02   +2.417254181976443e-01   +1.184243251564077e-01   +4.178556541691869e-01   +1.842590783232812e-01   +2.303472580337546e-01   +3.011020926236587e-02; +1.349032175897094e-01   +4.271650664022670e-01   +4.309547520894806e-01   +1.562670879050408e-01   +2.872803400739941e-01   +2.705738112537568e-01   +2.447845521811108e-01   +1.981657529815645e-01];
L2E_L2I_iGABA_netcon = [+1.368219151958128e-01   +2.101134755407381e-01   +3.948105134325306e-01   +4.534315975178099e-02   +1.624058900660736e-01   +4.717944851322185e-02   +1.633661451768804e-01   +2.264773616846785e-01; +1.748321712142039e-01   +5.903654744765201e-02   +2.234293499459873e-01   +2.279867620004303e-01   +1.844630531440685e-01   +1.621661013993557e-01   +2.838342547508332e-01   +2.683351584108626e-01; +3.779535240440701e-01   +3.378381347053676e-02   +1.950043222140322e-01   +3.016693181903757e-01   -1.137537995681188e-02   +4.049326601139024e-01   +1.925232021809947e-02   +3.092663976649910e-01; +2.988464030979913e-01   +4.270972676315750e-01   +1.160921672683277e-01   +3.494879208233366e-01   +7.528413042924782e-02   +5.364793354951987e-01   +1.754668061981048e-01   -1.422403753743543e-02; +4.596896525930141e-02   +2.182905168835575e-01   +2.006697509849676e-01   +5.062415114724499e-02   +3.466727125048357e-01   +2.708785436026782e-01   -6.118119793758268e-02   +3.636116836397622e-01; +3.073050517748113e-01   +1.377943294928497e-01   +1.565758912596006e-01   +3.046285182530402e-01   +2.723412809933471e-01   +9.155681155063790e-02   -1.379364459495370e-01   +7.069385244082682e-02; +2.906765642867418e-01   +3.975070313770867e-01   +7.217148608122485e-02   +3.313202869498381e-01   +2.406444527963202e-01   +1.806112356700542e-01   +1.409046925348542e-01   +1.957409636328708e-01; +2.687848639699756e-01   +1.491814975038680e-01   +2.742424505831974e-01   +3.512393318925240e-01   +3.832132270218197e-01   +3.724378974197568e-01   +3.709726242035101e-01   +3.252502749918401e-01];
L3E_L2E_iAMPA_netcon = [+1.087339734624782e-01   +1.074624125266592e-01   +2.101666740352584e-01   +1.146948432524327e-01   +2.269587592589787e-01   +4.507685844260992e-01   +6.680198130846768e-02   +4.445598734605742e-01   +1.625532785566917e-01   +2.431289319136570e-01   -2.114849261697879e-02   +4.962366025884705e-01; +3.809237323198826e-01   +3.178622413138593e-01   -9.747211432156645e-02   +4.548600119360666e-02   +2.404395502683611e-01   +5.519879206681511e-03   +4.088127929338798e-01   +1.131041936600791e-01   +2.074401261634075e-01   +2.140485403255613e-01   +1.042935351067040e-01   +3.733629272066292e-01; +8.974766757177904e-02   +1.539113905981102e-01   +4.764232600428746e-01   +3.385242576430238e-01   +3.809098030525263e-01   +5.591960698695492e-01   +3.668259405191330e-01   +3.467558310068408e-01   +9.722711620501660e-02   +1.289801837574905e-01   +1.470354180565547e-01   +1.584450241463748e-01; +2.610344191838404e-01   +2.829745131261768e-01   +4.154994099761139e-01   +4.245495593621172e-01   +7.587511112708066e-02   +3.367060552882988e-01   +2.994718345978853e-01   +1.858202241603560e-01   +1.651077860688802e-01   +1.946562637139936e-01   +2.592353894292868e-01   +2.111849303739600e-01; +1.512575122886262e-01   +3.232503001866945e-01   +3.653031426160603e-01   -3.120201553970379e-02   +2.018268090132112e-01   +3.431097053835244e-01   +1.103680974715449e-01   +3.490522114588817e-01   +1.079366796012235e-01   +1.638633813176852e-02   +2.586262863514837e-01   +1.821811201193826e-01; +2.774697809296369e-01   +1.242401985773466e-01   +5.776900256581863e-02   +9.458492298700358e-02   +3.616065489467150e-01   +2.620226201014634e-01   +2.731884720615702e-01   +2.744732796904160e-01   +1.965110369916654e-01   +1.432768362134547e-01   -8.091780203111754e-02   +1.061853435376267e-01; +5.501655044053729e-01   +1.717763422091848e-01   +4.674681610986968e-02   +1.037797686957449e-02   +2.413318121903161e-03   -3.553227964831631e-03   +2.412914093050500e-01   +2.710503694949143e-01   +3.197499013688853e-01   -2.010627438881653e-02   +1.081371821993317e-01   +1.340211246912561e-01; +3.085549780905533e-01   +1.906522437224491e-01   +1.283392704879576e-01   +1.856487535225675e-01   +3.446761662733840e-01   +5.543126949041090e-02   -2.828491858479307e-03   +1.081464121305304e-01   +4.142217214416740e-01   +1.158853378532378e-01   +3.381172562621750e-03   +2.358963875091770e-01];
L3I_L2I_iGABA_netcon = [+2.767012256003131e-01   -3.692603325403991e-02   +2.372397527417019e-01   +3.497018008440266e-01   +2.361354854528580e-01   +9.481560166226133e-02   +1.523145307861355e-01   -5.115137821952276e-02   +1.598782012471342e-02   +2.484022464018974e-01   -2.120023721908850e-01   +4.230480599323042e-02; +2.226999106390713e-01   +2.761572963508574e-01   +3.912119273741205e-01   +2.917735265851651e-01   +2.580878740972634e-01   +1.960910950864008e-01   +9.176872888380286e-02   +4.781954983654005e-02   +2.765832752333621e-01   +3.159897385285502e-01   +3.727285837175939e-01   +2.628751340105840e-01; +5.815798272912164e-02   +2.804023522207541e-01   +2.887661430932446e-02   +1.422401843853593e-01   +1.594432232984032e-01   +8.381398120927962e-02   +3.950477689899560e-01   +2.663841752064887e-01   +4.633551209113111e-02   +4.703978699252154e-01   +4.830356293709250e-01   +1.855134440332453e-01; +1.730793548451528e-01   +3.158410688691445e-01   +5.096368616975343e-01   +5.421169892483001e-02   +4.355280904444601e-01   +1.750674046637558e-01   +7.431174553370121e-02   +2.155746895046805e-01   +1.319512380008201e-01   -5.222546801886151e-02   +1.778491592472448e-01   +2.571257295456861e-01; +3.683147764935274e-01   +7.734396687191090e-02   +3.153440405081490e-01   +2.775665264040909e-01   +2.852538241883107e-01   +1.664071300464016e-01   +2.929842081533238e-01   +2.461210754982920e-01   +1.461077696074127e-01   +9.281118184682273e-02   -1.604267537209577e-02   -7.109718844436948e-02; +2.821814149136617e-01   +2.171412038506975e-01   +2.404376880872115e-01   +1.333786039642614e-01   +4.432706647374569e-01   +1.244626975753229e-01   +1.204341392470502e-01   +3.043695781058560e-01   +4.878957581850202e-01   +3.233816951362510e-01   +2.725662901274460e-01   +1.698114288970441e-01; -7.445136462243991e-04   +2.596700060089074e-01   +3.053766240795778e-01   -1.357287205176169e-02   +2.826949284753608e-01   +2.796784853714091e-01   +1.752070059845088e-01   +2.594415962031530e-01   +1.036970091931481e-01   +1.170668974566761e-01   +1.744635957362005e-01   +4.241970044087060e-01; +2.238151403426208e-01   +1.481989081834597e-01   +1.302677989105845e-01   +3.070693254445633e-01   +2.117641585316160e-01   +1.031594377754998e-01   +3.252504263644340e-01   +1.284089728748540e-01   -5.122444974651892e-02   +1.224958059437855e-01   +6.066126999886978e-02   +1.615084072959490e-01];
L2E_L3E_iAMPA_netcon = [+1.004408101995640e-01   +2.917462034252359e-01   +3.236761272142035e-01   +1.791255670994708e-01   +3.570592522203471e-01   +3.142319298358233e-01   +3.501801015655657e-01   +1.523163663845320e-01; +2.180078703042417e-01   +3.660871710089492e-01   +2.582877387523330e-01   -1.678087767943092e-02   +2.923857607021352e-01   +2.132230206907570e-01   +2.320313120755276e-01   +2.337570070172693e-01; +6.006308131403407e-03   +1.415175035002335e-01   +2.400546977688242e-01   +5.693646890399414e-01   +1.979918677255439e-01   +4.925272521529052e-01   +1.855726381207393e-02   -2.042119313811330e-02; +6.298624605587985e-03   +1.890857701641732e-01   +1.914232953602677e-01   +2.056158234227672e-01   +2.873369844899945e-01   +4.606000735549726e-01   +3.019693201393043e-01   +1.754665209548423e-01; +2.741941483973659e-02   -1.655464566074106e-02   +1.049086244636450e-01   -6.662492726041358e-02   +1.691517198991923e-01   +4.080773991634210e-01   +1.252310714696020e-01   -3.473293514369260e-02; +9.885959542102808e-02   +1.204054807897134e-03   +1.666334727148382e-01   +3.868769202438101e-01   +2.298620963973022e-01   -6.198440657186968e-02   +2.697803348451198e-01   -7.874465770817474e-02; +4.226585828707501e-02   -6.557009371218046e-02   +2.083420924662084e-01   +1.244646608927262e-01   +1.741967782201476e-01   +3.103652317593371e-01   +2.314328125082973e-02   +3.350460526715455e-01; +2.758605319064814e-01   +4.736768773807786e-01   +4.003670424564831e-01   +1.268227334717310e-01   +2.365132497032971e-01   -1.851397524911210e-02   +3.186363820935234e-01   +2.862223982040598e-01; -8.145832592315971e-02   +1.798175736523350e-01   +1.378115501493095e-01   +3.805008051202843e-01   +1.798158391810173e-01   +2.583295598078084e-01   +1.608942973948239e-01   +2.991524520597967e-01; +2.517732433147694e-01   +1.187831356736047e-01   +1.223929803128679e-01   +3.248306816065621e-01   +4.478657800815963e-01   +5.324731315536446e-02   +3.856011941861751e-01   +1.924453366263034e-02; +4.476757945793939e-01   +3.856244878702565e-01   +2.496007495457218e-01   +1.722562594581475e-01   +4.486908558196735e-02   +3.288108580200214e-01   +4.094080013203766e-01   +8.150180787615466e-02; +5.146556541308258e-01   +3.850707490261384e-01   +9.135240808168837e-02   +4.772197185552693e-01   +1.660696628184363e-01   +3.753934837729251e-01   +3.201992655006920e-01   +1.861460016865701e-01];
L2I_L3I_iGABA_netcon = [+4.864175240959715e-01   -9.235071781189855e-02   +3.527332938989188e-01   +1.182908006203389e-01   +2.956066369447736e-01   +1.690317861701628e-01   +1.993285633839023e-01   +3.986477400257313e-01; +4.932830520659597e-01   +3.249514585547700e-01   +2.180215886654035e-02   +2.928220628852449e-01   +2.005856623068045e-01   +5.265731023932176e-02   +2.711109736314300e-01   +3.381963224124880e-01; +2.779526321742019e-01   +3.259721213286071e-01   +2.691436413112260e-01   +3.486605920758191e-01   +3.515410185283676e-01   -1.745007910905943e-02   +3.291220109241082e-01   +1.548515699456564e-01; +1.092618354730286e-01   +2.710748323657450e-01   +2.632218974505683e-01   +2.404418033235442e-01   +1.304134230705958e-01   +3.759748691260574e-01   +1.316052982405720e-01   -3.762584666609753e-02; +4.674300436891546e-01   +3.512384576546416e-01   -5.634071348714740e-02   +4.789070714146839e-01   +2.448316113198271e-02   +1.953799198183737e-01   +1.401271748308616e-01   +1.657838842389637e-01; +4.821734110241224e-01   +4.779860475048658e-01   +4.537997342703516e-01   +1.057984333816726e-01   +5.308552165972243e-01   +6.997886058817798e-02   +6.163615005018413e-02   +3.793563561878860e-01; +1.692368652292529e-01   +2.745614846744203e-01   +3.294523067386838e-01   +5.615884036945979e-01   +2.214478785243228e-01   +3.885120939634737e-01   +5.570078053454033e-02   +1.180277856328499e-01; +1.361089885300520e-01   +3.102311660097899e-01   +2.869065123544742e-01   +6.244197473956439e-02   +2.405736203248689e-01   +1.374246386180646e-01   +1.074291063696989e-01   +1.643383854799502e-02; +2.202690905506324e-01   +1.565745591712058e-01   +1.923889364296824e-01   +2.970301384558720e-01   +3.670255944043482e-01   +1.417557057916062e-01   +2.760911504054163e-01   +2.099703316749361e-02; +3.525524877927728e-01   +1.825344896631628e-01   +1.778477579337502e-02   +2.384341751951895e-01   +1.758076342446674e-02   +1.624259499754878e-01   +2.565137891468821e-01   -1.761879002369134e-03; +3.416732162788480e-02   +1.001948171832518e-01   +1.599068897718365e-01   +1.633259307797290e-01   +1.969323194248792e-01   +7.835705369398710e-02   +5.566170015075502e-03   +5.905353166824130e-02; +3.013493017960545e-01   +2.917575378370671e-01   +1.481669599374553e-01   +3.045426609910856e-01   +1.654882284950027e-01   +3.739065411143871e-02   +1.623999427124129e-01   -1.814693410303181e-02];
L3I_L3E_iAMPA_netcon = [+1.257380221699726e-01   +3.954133394840789e-01   +2.002948243297748e-01   +3.232319257858516e-01   +1.477572994846715e-01   +3.353852213154404e-01   -5.877047605828949e-04   +1.780621122062799e-01   -1.004719686462704e-02   +2.998925539800184e-01   +3.827156090977995e-01   +3.193373142103812e-01; +2.693520683646885e-01   +1.971712556038286e-01   +3.076996231763928e-01   +3.979107466437478e-02   +2.539867442801268e-01   +1.981141238353700e-01   -1.213657163698578e-02   +1.518498473249759e-01   +4.985142301965748e-01   +3.918548452305113e-02   -7.282133805824224e-02   +4.264782867767306e-01; +1.327591343961061e-01   +1.604780097331155e-01   +1.154486152516259e-01   +1.637346345513392e-01   +3.914409155752791e-02   +4.560449229673503e-01   +8.477019763748690e-02   +2.295245226203023e-01   +1.492045429279034e-01   +1.741839610591397e-01   +1.071549322259912e-01   +2.613005862457735e-01; -6.321263301807239e-02   +8.210076439049280e-02   +3.395386358313806e-01   +2.671067171508865e-01   +1.676175327842747e-01   +2.155440020620794e-01   +1.194339442821493e-01   +2.049634740617140e-01   +1.945726157943316e-03   -1.344547032691334e-02   +7.503015941497183e-02   +1.894954407929777e-01; +1.691103086716032e-01   +1.817963234873883e-01   +3.377655948078218e-02   +1.998527928545157e-01   +7.841676568442418e-02   +2.686379535507954e-01   +1.426100507825605e-01   +1.712512753106981e-01   +2.321201401339720e-01   +1.589860246487442e-01   +4.430263596491681e-02   +2.601373631696938e-01; +4.866210854360910e-01   +2.366607078602279e-01   +1.082135587602067e-01   +1.593966748158561e-01   +2.486055307922995e-01   +5.313623643981961e-02   +3.429600384577781e-01   +4.827551568335481e-01   +3.407776667754870e-01   +2.381481328895587e-01   +3.913272126308868e-01   +4.294636822242206e-01; +1.408686504495857e-01   +3.271018462868538e-01   +9.431968207844799e-03   +1.135385075321348e-01   +1.937401377483911e-01   +6.743381594535626e-02   +4.388014123896324e-03   +1.364220496928615e-01   +2.094513269602009e-01   +1.316447926660740e-01   -7.466190292745284e-02   +5.224733300331925e-01; +1.467949750449669e-01   +2.033265419653424e-01   +3.003466464301028e-01   +6.928218788860324e-02   +1.734673426111147e-01   +1.449043402144811e-01   +1.866855120798737e-01   +4.010385572843059e-02   +1.876923176631886e-01   +1.920591139802697e-01   +3.053351911166971e-01   +1.677366864468386e-01; +2.339050851715868e-01   -1.303312086576122e-01   +1.622142234700291e-01   +3.622633985818730e-01   +2.221988260231830e-01   +1.488725106967763e-01   +2.184327219535394e-01   +3.653713515813140e-01   -1.841453630964469e-02   +1.584733063494408e-01   +2.364982943128418e-01   +6.162934891591632e-02; +2.558821775496577e-01   -7.696036513067298e-02   +1.601696628224560e-01   +3.423477788412344e-01   +6.453597393279226e-02   +2.558275139242713e-01   +3.898410432085818e-01   +2.680302162840337e-01   +3.318187424941872e-01   +1.957180668839335e-01   +4.529081458660219e-01   +2.457257630497603e-01; +1.585851307963589e-01   +2.143457448121488e-01   +2.927346208934156e-01   +2.406387845051884e-01   +3.092135992197506e-01   +1.767029053305652e-01   +2.433583017651622e-01   +2.433152995437488e-01   +1.496596733166438e-01   +4.502108195956035e-02   +9.677613957986859e-02   +2.867171577597658e-01; +8.328243183892434e-02   +2.461092164204214e-01   +3.518512721268880e-01   +1.827233640881278e-01   +2.323674043233095e-01   +9.703043708327802e-02   +3.249344037137499e-01   +3.228956695974212e-01   +2.121728393938880e-01   +1.939979954890226e-01   -1.207492804221430e-03   +2.171800509203513e-01];
L3E_L3I_iGABA_netcon = [+3.926923016350682e-01   +3.207559691881274e-01   +1.819753713270215e-01   +4.611235815223571e-01   +1.437326012250513e-01   +1.570037068018847e-01   +2.295205006612044e-01   +7.696031038018031e-02   -1.193531489189438e-02   +2.976661242535222e-01   +5.935759845455091e-01   +3.539731804559967e-01; -7.810983919639783e-02   +2.180652238631263e-01   +4.697570748322984e-01   +2.621435701023340e-01   +2.439305337251362e-01   +3.222882399652703e-01   +3.966699272600717e-01   +2.078728516539559e-01   +3.824204728247051e-01   +2.051510855746787e-02   +1.259170282243336e-01   +2.041227771473424e-01; +2.077301432030796e-01   +3.441304989785775e-01   +6.540291321676975e-02   +7.309046547833500e-04   -7.534627854894796e-03   +2.325133704480263e-01   +2.069831792495432e-01   +1.273041232426497e-02   +2.965609232923651e-01   +2.103566786642806e-01   +1.424755252305634e-01   +1.528384505770545e-01; +2.031670808985795e-01   -5.064000605390058e-02   +1.104375158503682e-01   +2.946165524258908e-01   +1.097771561516784e-01   +2.917838241248752e-01   +2.426202118602751e-01   +4.683328205210944e-01   -2.948785297460182e-02   +8.913224930894120e-02   +9.842249180253182e-02   +2.810169167436602e-01; +3.125568877679397e-01   +3.932559925704850e-02   +3.405473565740827e-01   -2.741046276810342e-02   +4.033716812481002e-01   -1.888945530015196e-01   +5.041291749959921e-01   +2.103509136120648e-01   +4.272181116013764e-02   +4.899366036183309e-03   +1.939054006978180e-01   +1.175403461462656e-01; +4.956861168578659e-02   +3.424849139947757e-01   +9.306427805372866e-02   +2.025154347330959e-01   +1.067014097902872e-01   +1.041353922504368e-01   +3.224922939964961e-01   +2.474109867607330e-01   +6.062384159081175e-02   +1.033151434227824e-01   +2.072315712107758e-01   +3.087140174775124e-01; +3.582761132270031e-01   +2.368885218028571e-01   +4.509804555436499e-01   +3.172469524790113e-02   +7.307034427969691e-02   +2.338403247151971e-01   +1.486663603185435e-01   -2.944752277011072e-02   +6.094129376678055e-02   +1.785038349288725e-01   +2.991575991472241e-01   +1.089563193353377e-01; +2.730659738914594e-01   +2.147195525606677e-01   +2.735958942573731e-01   +1.474785994660846e-01   +5.721075276983954e-02   +1.788549190559427e-01   +2.169963480585128e-01   +1.106793168221253e-01   +3.890966509450077e-01   +3.136765593973655e-01   +9.813436314641347e-02   -6.719741371264501e-02; +3.020045194258150e-01   +2.555545897004424e-01   +2.743369655997169e-01   +7.707281559902297e-02   +2.614447056441356e-01   +3.689417700651156e-02   +1.974987428713519e-01   +3.446581421272314e-01   +2.958899655911553e-01   +9.086786338659994e-02   +6.606754274643396e-02   +5.581956127909606e-03; +3.471338173053438e-01   +2.686805180075839e-01   -1.177123454848604e-01   +3.353736318824231e-01   +1.958341558775482e-01   +3.335453315368593e-01   +3.730771163137568e-02   +1.707441430680999e-01   +1.183796876799864e-01   +4.933060481669697e-01   +2.368768369563473e-01   +3.182302314441832e-02; +1.257835324705545e-02   +1.838318662046720e-01   +2.803289735148181e-01   +4.780873224888416e-02   +2.999644073656003e-01   +3.789911836941879e-01   +2.955916602066265e-01   +2.836347648966918e-01   +3.257405937409980e-01   +7.109815855733616e-02   +2.210138459607752e-01   -3.932752768867233e-02; +1.697056786807166e-01   +1.419163842197726e-01   +9.028394024186397e-02   +2.838972311682252e-01   +2.205314011240700e-01   +3.439264369567416e-01   -8.211156241308740e-02   +2.193175953117891e-01   -4.375041474595701e-02   +3.555528225353627e-01   +2.554578815047952e-01   +2.509333691886067e-01];
L2E_Input1_iAMPA_netcon = [+1.663020673315758e-03   +1.923419035030694e-01   +1.477483504915798e-01   +1.398361797402685e-01   +2.949328179213428e-01   +4.950929680240063e-01   +1.865346174408788e-01   +2.842154238080428e-01];
L2I_Input2_iAMPA_netcon = [+1.885604175649713e-01   +3.966767762794807e-02   +4.324344967389446e-01   +2.543771655524902e-01   +1.179349901966907e-02   +1.737966630071490e-02   +1.212133467237073e-01   +4.290227645097100e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
