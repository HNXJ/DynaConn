function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.891116298784225e-01   +2.365968660170498e-01   -1.276296561614867e-01   +1.785309638070053e-01   -2.863223909628088e-01   +7.352818068539172e-01   +6.880396964854366e-02   -3.888648738561715e-01   +3.522596255507935e-01   -1.000585924797344e-01   -2.394414036895383e-01   -1.749532071816372e-01   -8.709793208071541e-02   +3.536314367801308e-01   +3.864150560214965e-01   -8.144292717666659e-01; +6.878710322306684e-03   +2.238632308560027e-01   +3.305550305081046e-01   +6.850803922526228e-01   +6.518208741422422e-03   +2.086657360387291e-01   +1.285477542392782e-01   +4.144848691198578e-01   -7.366869575758055e-01   -1.153001496080665e-01   +1.572143893196484e-02   -2.502716188040413e-01   -6.408809365909782e-01   +3.026735741064177e-01   +2.396194299869302e-01   +2.599888400044154e-01; +3.548044434268541e-02   -4.702273490637500e-01   +4.321563155264409e-03   +1.079582275182112e-02   +4.665172270318955e-01   -1.903195631241551e-01   -5.782404000944873e-02   +1.000000000000000e+00   -4.106259961179552e-02   +6.048863578852689e-01   -8.204622586818909e-02   -4.288004494475390e-01   +3.368060656659935e-01   +7.366841882125619e-02   +1.792364627694389e-01   +1.965788657735752e-01; -1.543073309835397e-01   -1.560028292621193e-01   -1.347492501414896e-01   -1.303416767379040e-01   +4.389166262024395e-01   -3.729540433650604e-01   +1.912216988194538e-03   +2.196900219589304e-01   -3.791753128632168e-01   -5.196980394126242e-02   -1.578337239441285e-01   +2.426954143983463e-01   -2.194534975793823e-01   -4.873510089509279e-01   -3.433442360569310e-01   +3.291686373095812e-01; -2.686076556024373e-02   +3.347239858607439e-01   +8.006069738641620e-01   -7.591876064890483e-02   +3.530120306336944e-01   -1.004315640593110e-01   +3.605716614473979e-01   -3.302263969742196e-02   +2.079284484487476e-01   -3.258615576718305e-01   +6.165840145109582e-02   -9.105611018353992e-02   +1.548757511340045e-01   -5.224653073186515e-02   +4.947578283355836e-01   +3.213853362166876e-01; +2.778235283597309e-01   +2.533710470756429e-01   -2.955325186013365e-02   +3.923010922660868e-01   +8.482919012938638e-02   +3.347013255534194e-01   -3.666970450910026e-01   +3.169116470911689e-01   -2.624976169084985e-01   -4.379378555342234e-01   +3.439077256200773e-01   -3.491941484979635e-01   +2.683119371378960e-03   +4.142342674788773e-01   +2.631396449188247e-01   -1.595609917152332e-01; +4.155699514588310e-01   -2.839745310853670e-01   +1.833072615580678e-01   -1.181443521149271e-01   -1.353498119113355e-01   -3.598774632018035e-01   +2.487841536199706e-01   +3.925836394671743e-02   -2.556313308628568e-01   +7.944150998035737e-02   -2.362812831861316e-01   -2.147622210852405e-01   +3.438144374602590e-01   +1.166796297163806e-01   -2.469253793761366e-01   -4.813600984215785e-01; +4.836225174636746e-01   +2.228653922578199e-01   +6.727156289795680e-01   -3.113007680325464e-01   +2.811155671255621e-01   -6.874977698591115e-01   -4.262014449469687e-01   -6.555161094344154e-01   -3.289490682344712e-01   +2.263410421446388e-01   +4.269558197527469e-01   -1.493222778244485e-01   -3.800965893856134e-01   -2.353162363974203e-01   -3.173208194485085e-01   +4.952530943195528e-02; -5.183721726902384e-01   -5.314125662358263e-01   +2.580172815313643e-01   +5.717684250978904e-02   -4.578974911175859e-01   -7.730638067425330e-02   -3.420316898679531e-01   +1.665075222028548e-01   +2.513738954234013e-01   -3.085178648650593e-01   +4.970891034988336e-01   +1.516988455127096e-01   +2.153021011196554e-01   -4.664136208908453e-01   +5.634769113604783e-02   -1.373780645794299e-01; -1.079538464060558e-01   +2.252162852211622e-01   +5.018422299976717e-02   -5.351720803676462e-02   +9.251399387992723e-01   +2.648271350731947e-01   +1.537812863883110e-01   -4.255986586627192e-02   +5.666914720109262e-01   -2.348563914741965e-01   +2.928961246678660e-01   -4.949142778781151e-01   +5.027418392274443e-01   +2.894707207752005e-01   -1.046685468856515e-01   +6.012898793227913e-01; -1.583888759208717e-01   -8.570546774622674e-02   -5.119978093826999e-01   +6.382259273314435e-01   +6.837254993184658e-02   +2.715779220910879e-01   +2.716077319998634e-01   +2.561668621175642e-01   -1.147852639003448e-01   -4.951645256568319e-01   +1.796208893532729e-01   -6.728116060986012e-01   +1.396595304164201e-01   +1.948545793059947e-01   +4.010203818674288e-01   -3.853695927351096e-01; +2.636045603916177e-01   -4.690560375784126e-01   -2.713176569561757e-01   +6.187840095063567e-02   -1.061909642081038e-01   +3.373353982618779e-01   -3.250566879082909e-01   +9.810104693233754e-02   +4.250263893639030e-01   +3.365755044484999e-01   +2.795574666673636e-01   +4.605708583936821e-01   +1.696540979427827e-02   +3.926505208951908e-01   +4.390696890627618e-01   +6.751483098721663e-01; +4.297015387776023e-01   +4.707073110069218e-01   -3.886592299449402e-01   -2.497378095198781e-01   +7.121186527116699e-01   +6.971284697796695e-02   +6.768884890965945e-02   -2.672170866580590e-01   -1.274534221674496e-01   +2.994893394991312e-01   -6.389261009381193e-01   +1.639266207406631e-01   -4.322763157744383e-01   -4.077522792846063e-01   -5.078521699682584e-01   -2.800099243229979e-01; -4.993122363713849e-01   +4.598726272982441e-01   -1.375784109438151e-01   -2.606704732018145e-01   +7.708696510296492e-01   +5.973075914205517e-01   +5.298126970580190e-01   -1.667549937936275e-02   -2.037194605703316e-02   +8.951284528182644e-01   +1.192840839545198e-01   -6.100078224400178e-01   -1.824756151213149e-01   +5.167889595832401e-01   -5.089334376065133e-01   +3.381814733611009e-01; +5.248840355344105e-02   +1.697271078103421e-01   +1.117998019663436e-01   +2.805025306791599e-01   +1.788549411677311e-01   -3.662633532978761e-01   -7.094702402438322e-01   +4.571747379420703e-01   +4.641386343232545e-01   -2.050166182622708e-01   +2.036112398635729e-01   +1.241672988172347e-01   -6.936251241598153e-01   +1.098997321902691e-01   +2.062428456223220e-02   +2.221731028338376e-01; -1.216186709316432e-03   -5.031208246184080e-01   +2.528621622193177e-01   +5.650311898145707e-02   -6.871111370354754e-01   +2.711752247406021e-01   +1.480644213938868e-01   +4.866192614106079e-01   +1.815133580959989e-01   -3.082789449981589e-01   -5.970905073539293e-01   -5.352132959452751e-01   -7.880238559962585e-02   -6.561473704248021e-01   -3.956639155131546e-01   +2.190855248621653e-01];
L1E_L1I_iGABA_netcon = [+3.458635288192887e-01   +2.189233760713853e-01   +3.402768619586762e-01   -2.377457417931458e-01   -9.116372625345701e-02   -1.856674699481690e-01   -4.104268576376665e-01   +5.647071684789189e-01   +3.983975675377269e-01   -6.932217321760252e-01   +8.489425322389872e-03   +1.889045651330767e-02   +3.646751473426131e-01   -2.682190679338642e-01   +2.393652748930198e-01   +1.105790958463377e-01; -5.117653080525558e-01   +1.040761395072564e-01   +1.452293280685233e-01   +1.068982189855427e-01   -2.878407239408105e-01   -8.474061468618223e-01   -2.169918841827740e-01   -4.271038145625061e-01   -4.408115541514726e-01   +1.761422084476121e-01   +3.752488089010853e-02   -5.634309865909067e-01   -4.473435770315999e-01   +2.419876094436182e-01   -3.442599263731844e-01   -3.475347922952570e-01; +2.198076154407461e-01   -3.889271518780928e-01   +1.069461091144936e-01   -8.327137228449455e-01   -6.074181606180632e-02   -5.919159088375948e-01   +7.459115024175046e-01   -2.960924958635621e-01   -3.527833577127919e-01   -4.071521598672878e-01   -6.820350355504576e-02   -4.038295418125367e-01   +5.341226215350140e-01   -3.891983139876830e-01   -3.130777481259940e-01   -4.208094648685580e-01; -1.895167305409987e-01   +1.913087758533425e-01   +3.765503736197510e-01   -6.225999390404837e-02   +5.878797145137342e-01   -4.250601098283846e-01   -5.355019523650785e-01   -4.420483815020582e-01   +3.851844195499901e-01   +1.440444185634307e-01   -3.745597611327333e-01   -2.779769905049609e-01   +4.802653603460638e-01   -2.923565471634999e-01   +2.938664034533843e-01   +1.464778045947891e-01; +3.389141130312427e-01   +1.288749018313888e-01   +7.772323532994103e-02   -5.629394128381637e-01   -2.788418131231518e-01   +5.859611805877456e-01   +2.588927703701561e-01   +8.240051196076086e-02   +3.014836881675012e-02   +4.790708100596085e-01   +3.918147724046107e-01   +2.146431135790437e-01   -5.975244903975397e-01   -4.217849316616635e-01   +3.408170107227908e-01   +4.255270853689950e-01; -2.496552235445371e-01   -3.761836227682744e-01   +2.532501076973283e-01   +8.170140695946159e-01   -6.036768248670977e-01   +6.275544222259106e-01   -1.173069744529686e-01   +4.786954810856749e-01   -4.848334750403589e-03   -6.290015830746759e-01   +6.281996036080320e-01   -3.393926460625147e-02   +1.896812722314743e-03   +3.122725658037162e-01   -4.226401203546560e-01   +5.068152567605159e-01; -3.055905414613257e-01   -6.588507440522248e-01   -5.570053369726687e-01   +1.261408350170895e-01   -8.756455188989615e-02   +3.963494822044425e-01   +4.588660273710781e-01   +3.283795486913497e-01   +4.606960630531167e-01   -1.503492197277986e-02   -3.145802641492193e-01   -4.965198625150656e-01   +1.468028070160305e-01   +1.422645755725399e-01   +6.067324503780629e-02   +6.133342655368860e-02; +1.085891972856281e-01   +7.146914871320476e-02   -3.959657917838297e-01   -8.015459726890663e-02   -6.795824642136428e-01   -2.827579424225635e-01   -1.021863780845158e-02   +2.285993379289998e-01   -2.358226702745080e-01   +8.006467583423676e-02   +1.293259879124833e-02   -2.301386725507648e-01   +6.863797048884986e-02   -4.584310324928333e-01   -1.973446799560338e-02   +1.525378446999365e-02; -1.626665330093783e-01   +1.718516437805834e-02   +4.293305651753785e-01   +6.061604571798128e-01   +3.666405428954841e-01   +7.421880094551984e-01   -4.834375583889457e-01   +3.997748437123136e-01   -8.287568490602396e-02   -1.656399875873898e-01   -4.258086065920307e-01   +4.823089671714036e-02   +3.650963873599697e-04   -3.277676324095382e-01   +2.832585168593992e-01   +5.494774776109227e-01; -2.185844778452834e-02   -5.042542995992592e-01   -6.042718738730569e-01   +1.894773187239987e-01   +4.284018867927748e-01   -2.527118578851272e-01   +3.080218916790239e-01   -1.723691776140761e-01   +4.705346186896061e-01   -7.509320892669507e-01   +2.394954575430243e-01   +5.763808292632020e-01   -2.612420987513683e-02   -3.827096777770423e-01   +3.052670915753419e-01   +2.340416759187377e-01; +2.514199768324887e-01   +2.172889623893958e-01   +7.897837745129483e-01   +2.351012890300386e-01   +7.699368784882511e-02   -1.352385244508653e-01   -2.110763370446498e-02   -7.658152213275484e-01   +2.017300122089017e-01   +5.511574050906967e-02   +4.492751576224367e-01   -2.091373135685827e-01   -2.610014683350135e-01   +6.113666274464270e-01   +3.465631784405433e-01   +4.387501503002743e-01; -8.881836272221515e-01   +6.789151031251870e-01   +6.139715046177796e-01   -1.925273604301471e-01   +6.704340252874590e-01   +3.843522442060284e-01   +3.663831604820735e-01   +1.838385247844301e-01   +5.753829788044034e-01   +1.964142124766178e-02   -4.328645565906076e-01   +9.577460725790025e-02   -6.511478078099698e-01   +2.805945328001527e-02   -5.625312456357423e-01   -8.669890817406224e-01; -5.589328861233208e-01   -5.694038429267828e-01   +3.984980195935385e-01   +2.792393027841343e-01   -8.884468444766551e-02   -6.381980039521611e-01   +4.832311464909266e-01   -7.595415537778303e-01   -2.522104479779891e-01   +1.829432341843660e-01   -4.585796961802479e-01   -8.555872019622165e-01   +2.484709158938995e-01   +2.337069528993387e-01   +5.445694309473077e-02   -3.959655942376032e-01; -5.991492682230347e-01   -3.656812116623340e-02   -5.936383471314763e-01   -4.835139606673338e-01   -5.262125587749640e-01   -5.586966682947827e-01   +3.607851169720100e-01   +3.464785460137585e-01   -1.302063499508589e-01   -5.685710250235418e-01   -3.339242760304086e-01   +1.227939647963295e-01   +4.307531003812657e-01   -3.164980167200590e-01   +6.902668739833251e-02   +8.180612008533069e-01; +2.022460079966233e-01   +6.808385053344195e-01   -3.331304238442557e-01   +3.155146336854922e-01   -3.198690886080485e-01   -4.337484874763640e-02   -2.542273686108363e-01   +3.806294654324240e-01   +3.480280125208334e-01   -1.327207340170211e-01   -4.510316321733098e-01   +6.233417693201597e-01   +5.817636934016921e-01   +4.179437723880060e-01   +8.448619828561502e-02   +4.062780997999425e-01; +2.085722266820302e-02   +7.283432418428062e-01   +4.842839757226203e-03   -6.893354635150996e-01   -2.828707923440184e-01   -1.657298005335127e-02   +4.904630618227483e-01   -5.662643933154612e-01   -3.031232737798881e-01   -1.779102763917903e-01   -4.472493379775560e-02   +3.829068966290881e-01   -1.762605305151869e-01   +1.000000000000000e+00   +2.977049544275610e-01   -2.086171868119092e-01];
L2I_L1I_iGABA_netcon = [+3.634563365175757e-02   -6.938712639612200e-02   -4.258272617010990e-01   +1.514739679909913e-01   +4.151663386349565e-01   -2.542356112835840e-01   -7.462165496918158e-02   -1.146135552121818e-01; -3.620896634768950e-02   -7.033884140890636e-01   +2.326075358028543e-02   -1.641517174829546e-01   +5.165081356659857e-01   +2.492857858586713e-01   -3.413232278921465e-01   -3.408451142496008e-01; +9.943800225367672e-02   +5.698448206668695e-02   -2.237950535565795e-01   -1.582762379044028e-01   +1.994519292452250e-01   +1.000000000000000e+00   +8.016128378544421e-02   -5.832040634657065e-01; +8.206157710538526e-01   +1.493640143246982e-01   +5.937699562574990e-02   +5.054487264402765e-01   +5.445520956834723e-01   +1.024424691891083e-01   -3.860687298536596e-01   -3.542927359958206e-01; +1.243629334625106e-01   -3.030888286578308e-01   +8.210379921187170e-01   -3.534789876109931e-01   -2.844685649104504e-02   -4.423213574306904e-01   -1.933370642026116e-01   -5.415531627436678e-01; -2.674337578941443e-01   -2.018659102036044e-01   -1.530476300351044e-01   +5.119631634612276e-01   -6.055379960997264e-02   -3.118848638473995e-01   +3.321735935767633e-01   +4.546253593813467e-02; -4.445957967557840e-01   +6.752810748970732e-01   -1.463095541739714e-01   +6.628476797433035e-02   +5.529250868651997e-01   +6.434837647838501e-01   -6.608475698588907e-02   -5.107206486619470e-02; -1.918315979555934e-01   +6.577752512188338e-02   -5.259968489700645e-01   +4.124853929686190e-01   +4.696034319260946e-03   -5.111800227750175e-01   +1.935465054216672e-01   +9.787424278770222e-02; -3.465601951770828e-01   +2.691314992865329e-02   +2.244335545853399e-01   -3.677176058278629e-01   -2.574025562249325e-01   +7.925763636822550e-01   -3.961502176428111e-01   -4.418741652889452e-01; -1.604310319861705e-01   -6.157901469893943e-01   -4.628465566245075e-01   +9.196689550503215e-02   +2.222761398904957e-01   -6.266405950262421e-02   -1.027933793288919e-01   +2.881743230608283e-01; +2.451676415487125e-01   -2.363854852228522e-02   +5.182105375694029e-03   +1.622381404729792e-01   -2.927178777981747e-01   +3.964826905015322e-01   -6.249148014497262e-01   -4.807079639603470e-01; +1.370364243399706e-02   -9.913963783794492e-02   +1.570646552110574e-01   -2.119614065303710e-01   -5.394279691659590e-01   -3.362931842056723e-02   -8.777448029952319e-01   +6.316406742614428e-01; +2.532928288604384e-03   -1.955594689912748e-01   +1.910934574603757e-01   -8.366868339745383e-02   -3.065718325836016e-02   +4.467125950337555e-01   -3.203167116015316e-01   +2.275999431794817e-01; -4.104919184463097e-01   +8.671276458654427e-02   -6.879691745196673e-01   +8.362403991931352e-01   -9.511343736214302e-02   -4.974164756728802e-01   +1.795026251579221e-01   +3.807138945551775e-01; +3.602841399192102e-01   +1.833716448514739e-01   -5.140364192150620e-02   -3.934448612807734e-01   +1.852152829344716e-01   +1.384710598627048e-01   +2.127582321359023e-01   +4.741450387982053e-01; -8.574858001766233e-01   -4.666129357127605e-01   -1.878482927661592e-01   -4.484393996430788e-01   -8.188679239876523e-02   -3.484456346527559e-01   +5.447390616540172e-02   +2.520772160151041e-01];
L1I_L2I_iGABA_netcon = [-1.926183445427017e-01   +5.681191466468102e-01   +1.028712148725363e-01   -6.894902031573225e-01   -2.834298449030646e-01   -1.230308196220188e-01   -8.788818650194806e-03   -4.879015326132211e-01   -5.209440638013159e-01   +3.968654828149573e-01   +4.119709738067014e-01   +3.459663256897137e-01   -4.609256735293821e-01   -1.949874967920757e-01   -2.915947711436778e-01   -5.019915178351382e-01; +4.841967549245750e-01   +3.650515898985814e-01   -6.165766208890266e-01   +2.247937953204214e-01   -2.701448943916384e-01   +1.360621348241956e-01   -2.126031543530237e-01   -1.078490086163169e-01   -5.794618163469852e-02   -6.611435201043905e-01   -9.815787321078046e-02   +4.853295623165603e-01   -3.644324893565782e-01   -6.355203179674707e-01   -1.239210642085700e-01   +5.047005806918409e-01; +6.314486621600417e-01   -2.199675028265249e-01   +6.046860842951817e-01   +1.240687924015143e-01   +1.148403933561942e-01   -5.317080810547785e-01   -5.135671666249076e-01   -7.527327663287154e-01   +3.041618438627232e-01   +3.304577602772196e-01   -1.091923262815703e-01   -2.126869322705045e-01   +7.497885683482287e-02   -7.981118628045200e-02   +8.230071739884415e-02   +4.600495727534074e-02; -5.421887595941204e-02   -4.172298609893254e-01   -7.799334135289619e-02   -3.505472196749556e-01   +5.142344579366030e-02   -2.334978418743480e-02   -6.017448109057081e-01   +2.226366644558752e-01   -8.268049621682463e-02   +1.478842600578744e-01   +4.298852832746843e-01   +8.668687767237226e-01   +8.711076652159115e-02   +1.900118667353832e-01   -5.049415172937219e-01   +4.362870443918028e-01; +3.328232273431883e-01   -5.419088290036416e-01   +9.882715200982793e-01   -1.569026950595334e-01   +1.000000000000000e+00   +6.314595494294445e-02   +1.390421712102095e-01   +7.237793986254832e-01   +4.626740398131594e-01   -2.120906189676159e-01   -1.882456309573166e-01   +3.272868451447395e-01   -4.080002770940495e-01   +1.156458278196266e-01   +6.709128204176997e-01   +9.362079532610690e-01; +1.091802925568139e-01   -4.524306953992441e-01   -5.666333380306222e-02   +4.191222182818288e-01   -1.672705669871880e-01   +8.729066762975434e-01   -8.084124726547882e-03   -2.316454488939201e-01   -2.607138257922388e-01   -5.263154604026785e-01   -1.914732529283204e-01   -6.885764347430299e-01   +1.942409514089213e-01   +6.444240040340274e-02   +6.472348321391806e-01   +9.058479603362186e-02; +5.159166442921368e-01   +5.536377208018315e-02   +6.433122901511083e-02   -3.002618187341648e-02   -3.960443761317706e-02   +3.880441318942608e-01   -1.861737638755795e-01   -4.974687724325764e-01   +4.050253604918405e-01   -5.701216431302958e-01   -3.947837297976399e-01   -1.420658013911817e-01   +4.843719305565726e-01   -3.980041069663331e-01   +2.985736664873540e-02   +3.239734748250962e-02; +4.279402559350080e-02   -3.418451056970624e-01   +4.813815400695516e-01   -4.929958057694560e-02   -2.520444820658145e-01   -8.752043198517756e-02   +4.688666835084003e-01   +6.375412897015541e-01   -4.526008718451784e-01   +1.736809645251745e-01   -3.012285056538507e-01   -1.525216081599255e-01   -5.930703962941543e-01   +4.275457252920896e-01   -3.100796686052285e-02   -2.857228458326785e-01];
L2E_L1E_iAMPA_netcon = [-3.888991076826394e-01   +5.820948430050857e-01   -2.022965729814977e-01   -3.933453832790674e-01   +5.581910193640578e-02   +7.496493181110055e-01   -2.160618829556543e-01   +4.117760925599322e-01; +1.952019164299880e-01   -9.043935979621899e-03   -6.433869652652926e-01   +4.314810014623069e-01   -5.724739199572518e-01   +2.016211828668704e-01   +3.518812402561833e-01   +1.218440941492201e-01; +1.190560717474027e-03   +3.079784730948676e-01   +2.442708650914956e-01   +7.560854700063059e-01   +5.229303260918311e-01   -1.274207627277126e-01   -5.803122601673356e-01   -5.495620636570939e-01; -6.437109626793316e-01   -4.123540500116566e-01   -8.648318027795639e-02   +8.728097988938023e-01   +4.457194857346826e-01   -4.564943331261487e-01   -6.873528804762702e-01   +1.729937940319866e-01; -2.591425439046156e-01   -8.907031772993812e-01   -1.396633386843203e-01   -3.939859289587810e-02   -4.170470141767714e-01   -1.698563089296447e-01   -4.085125909908288e-01   -7.051647150749049e-01; +5.664371181702137e-01   -5.576633957445682e-01   +2.973474209577545e-01   +1.710367871146658e-01   -2.855764256068141e-01   +1.656339551347811e-01   -6.384623688668052e-02   +4.424303891310785e-01; +4.902284438930378e-01   +4.792927074007206e-01   -6.097005383677648e-01   -3.068736895190773e-01   +2.724342335484983e-01   +2.797994460222549e-01   +2.154018150281708e-01   -9.593604400847598e-04; -1.594910229006877e-01   -3.723311192577968e-01   -6.312759765633821e-01   +2.587394582505435e-01   +2.907203455495612e-01   +4.987925592326691e-01   -5.649080387545715e-02   +4.350422372399432e-01; -2.981611827625958e-01   +7.281753340087398e-02   +3.813436346198643e-01   -2.816851547204105e-01   +6.996493469645465e-01   -1.000000000000000e+00   +1.266533249383516e-01   +7.655228634303818e-02; +5.736226611630670e-01   -3.667581547709521e-01   -4.181985950871898e-01   -2.681652141912650e-02   -3.330003060621147e-01   -2.908583046452151e-01   +2.972003138001602e-02   +5.774700176591107e-01; -7.726041979318755e-02   -2.955000476928959e-01   -7.668339987477125e-02   -3.424991918403930e-01   +5.945679994892767e-01   +2.629443217687000e-01   -3.386439202828618e-01   +8.213225409175163e-01; -5.197430792180532e-01   +4.393936373905840e-01   +6.552707823898158e-01   -5.924952640873661e-01   -6.451871961400650e-01   +6.374697726665189e-01   +4.641743110829694e-01   +4.819125732507786e-01; +3.716088549614913e-02   +5.587619572943784e-01   -1.159980794942950e-01   -2.522894479021969e-01   +9.710067465269599e-02   +2.338676372122972e-01   -8.175507232858470e-01   -3.357345091678559e-01; -3.726639774465189e-01   -2.287160176360850e-01   +4.333168348850880e-01   +5.610637107370519e-01   -1.383720855287992e-01   -7.083148270782680e-02   -7.158105739150146e-02   +2.965050786362682e-01; -2.238945452106887e-01   -7.272775969227600e-01   -7.725895702383844e-01   -3.363221352922478e-01   +1.425827911533390e-01   -3.564373118531926e-01   -2.857524588318053e-01   +3.376211785655712e-01; +7.339334554136111e-01   -3.963121759905543e-01   +2.272341274833238e-01   -2.993861774280753e-01   +2.826927537209014e-01   -1.593469522270357e-01   +5.571822039576074e-01   -5.012460354997527e-01];
L1E_L2E_iAMPA_netcon = [+7.874817314410699e-01   +6.870813329114827e-01   -2.839755297350742e-01   -1.355239502362515e-02   +2.232906626362386e-01   +3.836888373421889e-03   -3.992981896997265e-01   -6.866161944315994e-01   +4.051973687946374e-01   -4.818427375187600e-02   +2.969626113180473e-01   -2.866488341380186e-01   -9.974973448676150e-02   -2.151859853425513e-01   +1.593564905404467e-01   -4.446826064904381e-01; +8.835177550514134e-02   -1.480810654315584e-01   -6.020023973693186e-01   +4.845774045931962e-02   -2.521606262121691e-01   -6.448498823572111e-01   +5.335031911975961e-01   -8.174159202065021e-01   +4.500947611049883e-01   +2.337892070873357e-02   -5.452072909400295e-01   +5.856922862292658e-01   -3.370814916233400e-01   -1.648986762903038e-01   -6.559223540382270e-01   -4.753970833800547e-01; -5.258634608842154e-01   -8.572582444524974e-01   -3.776125494156757e-01   +7.791996799773827e-01   -1.180235542325251e-01   -3.392769168670762e-01   +2.698333429308457e-01   +4.200766839222616e-01   -2.137057223627656e-01   +6.692790196050599e-02   -7.198842665080656e-01   -9.031147164565632e-01   -1.000000000000000e+00   -1.451348983327077e-01   +1.285870770355719e-01   -1.249608517912901e-01; +6.740406803543485e-01   +5.426225859702481e-02   -3.629806865161231e-01   -5.835581056828958e-01   -6.567814159536619e-01   -6.630648534220196e-01   +2.223342093935836e-01   +4.046673502123772e-01   +8.172386755103664e-01   +2.013129577153014e-01   +9.206938139849048e-02   -1.280446219723194e-01   +6.079216072287942e-01   -2.344861382713897e-01   -8.325735702702121e-01   -2.211403094308244e-01; +5.092249452309776e-01   -4.625194467756142e-01   +8.651088433366065e-01   -4.706500403343447e-01   -2.789717838427873e-01   -2.547949751039337e-01   -8.249708820562853e-01   -7.417129547635698e-02   +4.153977123613763e-01   +4.479054911649011e-01   -5.088644064395574e-01   -1.690889543242895e-01   +8.262057610986812e-02   +2.056842489984340e-03   -2.775762186317764e-01   -8.284611338267360e-01; -1.407296291056740e-01   +9.510507084516396e-01   -6.172661045167743e-01   +2.928078287449975e-02   +4.634423920466296e-01   -3.693568024725844e-01   -4.780759081725416e-01   +7.438961640687229e-01   +2.188848375376063e-01   -1.982530859065941e-01   +9.061736173779057e-01   +1.755713395781668e-01   +4.711425836073571e-01   -3.090477525449414e-01   -2.887110475587117e-01   -3.137288554036881e-01; +2.312452861692619e-01   -8.978106712658787e-02   -1.543280059925868e-01   +9.159830178136150e-01   -3.603637005729452e-03   -2.074935400512362e-01   -8.779335080192119e-01   +5.657183814974119e-01   -7.427105769468263e-01   +4.393097998990170e-02   +1.198436393069836e-01   +3.281041344701691e-01   -1.823487889314380e-01   +5.709577923113104e-01   -4.777740695189616e-01   +2.201312633331421e-01; -1.012462736136366e-01   +7.341616746890951e-01   +5.305957888828057e-01   +1.110050248647951e-01   -8.579350950670364e-01   +2.134779317203989e-01   +2.911288074142395e-02   -7.465486012405786e-01   -4.208799696049890e-01   -1.190467715437556e-01   -6.686407975599817e-02   +8.374365823305455e-02   -3.517109065410141e-02   -2.200023622395092e-01   -2.662029542479641e-02   -4.545604031985982e-01];
L2I_L2E_iAMPA_netcon = [+2.325142009750372e-01   +1.829047202743138e-01   +2.124854625131736e-01   -3.084546061218769e-01   -3.193267634741214e-01   -2.852656602128068e-02   -1.402200456067971e-01   +4.776474397016139e-01; +9.559006600080633e-02   -9.114095297873114e-02   +5.071126230821926e-01   -3.441911746991562e-01   -4.014241519220074e-01   -2.365683422940035e-01   +5.677176743660289e-01   -9.048959878379256e-02; -1.150927890835795e-01   -6.144156083254821e-01   -7.003573106937061e-02   -4.348623906160010e-01   -1.201445073868218e-01   +4.115267521099688e-01   -5.621553347904598e-01   +7.267703664862947e-01; +3.834311874559656e-01   +6.279262002291248e-01   -2.457488367869798e-01   -2.791905656401445e-01   +1.989018071792344e-01   +1.957374177922475e-01   +4.465804507773479e-01   -4.499651484681704e-01; +2.754376465363215e-01   -2.065529033561637e-01   -1.262312426865129e-01   -8.253818028355467e-01   -5.814718267382196e-01   -7.262194481020848e-01   +3.979515180216963e-01   +8.232774699811827e-01; +4.386748797267008e-01   -1.982708100373012e-01   -1.523854174156020e-01   -7.526001349663154e-01   -1.322204614304024e-03   +4.186284734722455e-01   -3.018243276556827e-02   +3.365578106756731e-01; +2.376496114060954e-01   -7.348191718504324e-01   +2.828661785830012e-02   +5.115212358221347e-01   +2.771239327356874e-01   +4.763223088619480e-01   -5.928967482746677e-01   +9.018013219289965e-03; +1.392257655604197e-01   -1.838342310925776e-01   -2.795444140459900e-01   +3.647595089080642e-02   +2.915799556690302e-01   +1.041694059492524e-01   -1.000000000000000e+00   +4.977991356625104e-01];
L2E_L2I_iGABA_netcon = [+7.449934896842600e-01   -2.111189300267744e-01   -6.407667727667893e-01   -8.625448950218221e-01   +1.128817592600296e-01   +2.698157441586491e-02   -6.622628514858616e-01   +3.001055892508028e-01; +4.155261069064269e-01   -8.139242516460492e-01   +1.999107537750274e-01   -3.901899203123201e-01   -1.421058001833866e-01   +9.696138497283240e-02   +1.000000000000000e+00   +2.429884918772134e-01; -3.398708669365552e-02   -9.615006988865299e-02   +6.812634979021946e-01   +1.901313684023373e-01   -6.003510734466250e-01   -8.608080912410874e-01   +2.694472568673503e-01   -4.188488050545273e-01; -3.897153647602295e-01   -6.630271071093113e-01   +1.097551682678860e-01   +1.372665706881137e-02   -4.067219633540118e-01   +6.891702635548819e-02   -2.657070423126485e-01   -3.546842156787176e-01; +3.840773372800147e-01   +1.859045428761800e-01   +5.005271019142858e-01   +6.581355844314513e-01   +4.918123662243369e-01   -7.068907379761467e-01   +6.634852042599201e-01   -2.274307593775814e-01; -3.215171476883076e-01   +4.637202020935662e-01   +4.698318749400771e-01   +2.504147024909649e-01   -6.752220518881938e-02   +5.785229260043897e-01   +2.460350148492927e-02   +2.247747183521069e-01; -5.451229948928678e-01   -3.015323383141630e-01   -9.146433848008286e-01   -5.657626123935037e-01   -5.664373389851449e-01   +7.212603482169420e-01   +8.485630074898238e-01   -5.513067187451892e-01; +6.907478506176721e-01   +4.435180674079880e-01   +6.115827941075156e-01   +2.294693104728631e-01   +6.955998754921533e-01   -8.878102497146994e-01   +2.903099052878457e-01   -2.125103912809511e-01];
L3E_L2E_iAMPA_netcon = [+7.833452828936759e-01   -7.660657905292232e-01   -1.032062456435198e-01   +5.145172600939204e-02   -1.236797823228748e-01   +8.948498962858335e-02   +3.900941466245514e-01   +2.720714494334316e-01   +3.780984781574604e-01   +2.181860031962892e-01   -7.258216301728824e-03   +5.646850574958698e-01; +8.140191595828741e-02   -3.691741654043547e-01   -4.838344627790941e-01   -7.738378724457790e-02   +2.278670351330641e-01   -6.582341397826846e-01   +5.179117289030148e-01   +3.911762887165244e-02   -5.389164265559450e-01   +1.000000000000000e+00   -3.157107783527859e-01   -1.753188775601014e-01; +1.696141741119746e-01   +9.765494092551140e-02   -1.556443344782580e-01   -5.083390960078047e-01   -6.773967694943528e-01   +8.629893346554414e-02   +7.060569781789601e-01   -3.882612902502037e-01   -4.608788884929243e-01   +2.490054358817061e-02   -1.158999641403263e-01   +3.574288849993650e-01; -4.909792403979056e-01   -8.089786394129104e-01   -9.544948845648557e-01   -4.355861828313503e-01   +2.498152722902746e-01   +1.680367053094185e-01   +3.246505058190138e-01   +6.041351592228109e-01   +9.220744591558124e-01   -5.474464871261504e-01   +9.079421928248508e-01   -4.436268313268675e-01; +5.251386664940754e-01   -3.651689782943133e-01   -7.641083446588376e-01   -5.944499803058786e-01   +2.764267635768314e-01   +4.555762154705204e-01   +3.862585762431057e-03   +5.635399893458515e-01   +1.095934801205883e-01   +2.220870208978720e-01   -4.086778149013641e-01   +1.211764431648295e-01; -4.726852567048722e-02   -6.459782449728028e-01   +4.934958995523867e-02   -1.547847954074585e-01   +4.603738898784909e-01   +7.519630783343560e-01   +4.820517836326322e-01   +7.731168525656531e-01   +5.557326226458503e-01   +6.815578523245777e-02   +1.681797028313225e-01   -4.532575909942590e-01; -5.027504989207416e-01   -2.028356553721642e-02   -1.897354076497544e-01   -2.945461355938493e-01   -2.088557385671418e-01   +6.536317168940742e-01   -3.747794030455788e-01   -4.224963349972611e-01   -3.696797747538759e-01   -3.027285062773634e-02   +8.626585337223391e-01   -2.456820671705897e-01; -3.223694633169995e-01   -6.587014315709883e-02   +5.642024811723941e-01   -3.306708179988358e-01   -5.390107278785577e-02   +2.348396349193521e-02   +6.851136553072895e-01   +3.651757107686266e-01   +5.836743044020141e-01   +2.170979252520918e-01   +5.884082598069657e-01   +7.777879136779287e-01];
L3I_L2I_iGABA_netcon = [+4.860445184510809e-02   +1.000000000000000e+00   +2.615313959094254e-02   +4.411939331133730e-01   -3.156262734819514e-01   -5.836249268448257e-02   +4.059092221976460e-02   +4.843217684278889e-01   +1.793968084020911e-01   -3.772525859815881e-02   +5.304559057148871e-01   +2.130635201428360e-01; +3.139920401342636e-01   -4.689094535954401e-01   +3.239518239758313e-02   +9.293968941474624e-02   +7.094210566492153e-01   -1.713262548348513e-01   -3.335661304005528e-01   -4.358956039838057e-01   -3.256201858035106e-01   +1.818674121505937e-01   -4.459920082920029e-01   -1.320178072630382e-02; +1.746264394918828e-01   +3.001516404112526e-01   -5.608476455435843e-01   +3.432936986620452e-03   +3.061833679065160e-01   -1.510389784333682e-01   +1.235753231263621e-01   -2.870244194410256e-01   -8.125930631591919e-01   -5.639395978934005e-01   +8.849433788418531e-01   +3.275181012239885e-01; +8.477815135811301e-01   -4.267105688623649e-01   +1.358615999873319e-02   +5.334522103889484e-01   +4.522507049635032e-01   +8.173661350367115e-01   +4.295513635190189e-01   +2.121927321158729e-01   +5.869222196071560e-01   -3.309402375528589e-01   -7.179215225126981e-02   +8.724129317723210e-02; -3.410427349813946e-01   +5.401160761949464e-02   -7.337489049623552e-01   -1.429678718148795e-01   -4.321107333256612e-01   +2.058428934200212e-02   +1.183312851382020e-01   +1.750493763652133e-01   -1.580223362284655e-01   -1.513188298773983e-01   +3.821133174961377e-01   +8.080077999894339e-02; +5.046641404452405e-01   +3.322192080022200e-01   -5.198267949840349e-01   +4.865289000215202e-01   -6.710207431464430e-01   +4.329343654401988e-01   -5.287243612705711e-02   +3.869154645295243e-01   +6.550837045493405e-02   -1.977806258321679e-01   +3.234851752292950e-01   +2.110860191552464e-01; +5.336541804370643e-01   +6.698732351652197e-02   -3.195998085149885e-01   +2.164834814408654e-01   +5.772078882605081e-02   -3.085477907527197e-01   -4.506546266217060e-01   -3.228609315057954e-01   +5.762468876066947e-01   +8.350909152671080e-01   +9.026940497948863e-01   -6.765442936736091e-01; -1.230311678797586e-01   +3.887668286368696e-01   +3.355949448917869e-02   -1.964015055227643e-01   -2.427113164055200e-01   +6.606614774396276e-01   -4.160610286389555e-01   -3.583537503142208e-01   +2.353681539354404e-01   +3.627111059758772e-01   +3.833784250388351e-01   +5.587227342461380e-02];
L2E_L3E_iAMPA_netcon = [-2.299070266378596e-02   -1.650205630357150e-02   -5.001320157639912e-01   +2.741691010200052e-01   -6.172417553604927e-02   +7.730735679740462e-01   -6.161430589529021e-01   -5.507360370842133e-01; +8.970054741130149e-01   +2.092581459610026e-01   -4.827578972001073e-01   +2.928946999440790e-01   +4.318190014618516e-01   +3.444302324371571e-01   -2.266643108204260e-01   +2.662944674327262e-01; -5.752556775687936e-01   -5.167508949666237e-01   +4.064095761961765e-01   -8.957665730304550e-02   +2.659054102589933e-01   +1.577676157284211e-01   +2.838845746088677e-01   +2.381935451827604e-01; +1.955906722689688e-01   +4.699515713091174e-01   +3.125151566515296e-02   -8.768799981890786e-02   +7.211214479789310e-04   -2.755626524722653e-02   +2.722033226472449e-02   -1.142047056245325e-01; +1.801746714959107e-02   +2.883033122078468e-01   -7.978669533409335e-01   +1.965802321816908e-01   -6.052381898039629e-02   -7.391700836371309e-01   +3.860527107740598e-02   +1.129854065365491e-01; +8.129819807225570e-01   -8.097654641869767e-02   -3.674901600683056e-01   +3.622826041367908e-01   -5.256004077788332e-01   +3.925414152654600e-01   -1.237813108077344e-01   +2.072445916213707e-02; +5.552243814987676e-01   +6.900867344013743e-02   +4.097194986591690e-01   +2.098658777929757e-01   -2.498995510879736e-03   +1.191429797988637e-01   -2.024874295043786e-01   -6.716113934947423e-01; -3.086973434633595e-01   -4.652037127170429e-01   +7.573568244636852e-01   -3.008692864502191e-01   -1.105540573490447e-01   -3.045170351911408e-01   -3.413080474387425e-01   -2.457687875584291e-01; -2.014598034755405e-01   +2.904433609631693e-01   +3.227765276721746e-01   +2.959218313592099e-01   +2.260121462749573e-01   +4.242481771066897e-01   +1.948262524139244e-01   -4.008569139101135e-01; +2.549832099660174e-02   -1.658144273209401e-02   -1.014954788663293e-01   +3.543051579796269e-01   +1.000000000000000e+00   +5.003467375177119e-01   -1.211582204426802e-01   -2.326739975511041e-02; -9.045221825057450e-03   +3.726710663548709e-01   +8.005536652418431e-02   -6.490395237129937e-02   -3.050979301744985e-02   +6.272767898026108e-01   +3.567605922440331e-01   +1.527752684822359e-01; -3.424047202343536e-01   +5.723545569821652e-01   +6.902282049600463e-01   +4.205104170260329e-01   +3.109236952568421e-01   -3.218461529147571e-01   -2.321998215287602e-01   +6.710397800190284e-01];
L2I_L3I_iGABA_netcon = [-7.382918599411187e-02   +1.349621659386886e-01   +1.760582272643780e-01   -3.466640855056817e-01   -7.450232594618632e-01   -3.122287679645422e-02   -6.017367718321835e-01   +6.101372567062622e-01; +4.975744167139842e-01   -3.363267072545492e-01   +3.877149190384740e-01   +5.274018843656317e-01   -5.414686595551177e-01   -2.296053655826706e-01   -2.530626012745888e-01   -4.039848154725551e-01; +2.397826902354440e-01   +3.740723713772728e-01   -1.000000000000000e+00   +3.677032117874488e-01   -3.705607600918093e-02   +1.335228729629847e-01   -4.205415641786499e-01   -2.951938635165546e-02; +9.431048518525922e-01   +7.525420444699581e-01   -2.057228726767886e-01   -4.334052900358406e-01   +1.645130631680996e-02   -4.246284048458911e-01   -6.428082315496150e-02   -2.147652534015363e-02; -7.575477032929753e-01   -3.503464102692312e-01   +9.487762817966297e-02   +1.253589940237276e-01   +4.231905040609190e-01   -5.902145945741402e-02   -2.400478813289884e-01   +6.502628443926074e-01; -5.189034854436476e-01   -7.512244959024404e-02   +6.601405505240532e-01   -2.068370018154650e-01   +5.706691660321930e-01   +1.066587882217611e-01   +1.951921644890051e-01   +6.838506977999412e-03; -4.280407542306208e-01   +6.636295681822538e-01   +1.068658956107743e-01   +1.501528169321674e-01   -1.551642332643150e-01   +3.858287609397960e-01   -2.428852501038840e-01   -7.782362951519040e-01; +2.561766105140388e-02   -8.979365033930038e-01   +7.216940619595971e-02   -2.623958656789541e-01   +1.287045208407464e-01   +9.082555051082884e-02   +4.466157496714858e-01   -2.028460145718333e-01; -3.789343160323492e-01   -5.427589607768594e-01   +3.413820861417557e-01   -5.429263536402406e-01   +6.076985754803673e-01   -5.914475344790491e-01   +4.888848478854748e-01   -3.826030113656564e-01; -6.045917118566304e-01   -4.387924461733723e-01   -3.599359765008580e-02   +5.425251503770755e-01   -6.354985389954652e-01   +7.769252664557498e-01   -5.263375086115976e-01   -4.473455938624477e-01; -4.298285040109399e-02   +4.775137514745440e-01   +6.953286189004793e-02   +1.353032415417399e-01   -7.650902202621115e-01   +1.558346329184429e-01   -9.442682324187203e-02   +4.263363101817286e-01; -1.154228694250396e-01   -1.100045565809539e-01   +7.538132171019117e-02   -5.008274232951787e-01   -4.955415190632745e-01   +5.332912707702142e-01   +1.280996384215364e-01   -9.162779192930487e-01];
L3I_L3E_iAMPA_netcon = [-3.928904892666070e-01   +2.679145100707541e-01   -9.974109054181884e-02   -5.319243991908160e-01   +1.095511245473385e-01   -5.166207911118294e-02   +3.848384144616185e-01   -5.883869542829577e-01   -2.694488429462980e-01   -3.355866085518575e-01   -1.264655187595750e-01   -8.957841342979873e-02; +6.231185000072076e-01   +2.954925865232034e-02   -4.358799838722284e-01   -3.354033971789074e-01   +2.267651486938262e-01   -7.029774018048374e-02   -4.469176648155273e-01   -9.754948778817558e-02   -7.627345492480417e-03   -7.498104024744013e-01   +4.448844605277861e-01   +1.253669127480001e-01; -1.489438530078602e-01   +3.931962787164618e-01   +6.244504676721614e-02   +9.282014895352184e-02   -4.667957029032590e-02   +4.374687026005940e-02   -2.249958064943212e-01   -2.632756613424560e-01   -6.914751558591868e-02   +4.111765658744308e-01   -4.908709793918233e-01   -5.952576883421391e-02; -1.428695784295426e-01   +3.468119571361669e-01   -5.229951346088153e-02   -5.727728278618831e-02   +4.639817180374116e-01   +2.647499001796750e-01   +2.926325977092989e-01   -3.787227801483622e-02   +9.006333033383734e-02   +7.799525233733200e-01   -8.836761311189113e-02   +3.039126471143916e-01; +4.180691511068644e-01   +6.316510710410091e-01   -2.365857659402171e-02   -4.289635905207227e-01   -3.774123956965934e-01   -5.174912682107828e-01   -3.668963308425585e-01   +5.521662392795593e-02   +1.000000000000000e+00   -5.586097491299570e-01   -1.371224765248632e-01   +1.487303179221204e-01; -4.219888088532022e-01   -2.242450919104598e-01   +7.290493787341620e-01   +1.815560221183369e-02   +5.991711614834353e-01   -8.463348387891648e-01   -1.286400794370637e-01   +5.753523260700227e-01   -5.629108304471977e-01   -4.405412254483078e-01   -2.562870670956480e-01   -5.273875505069837e-01; -4.131441207944967e-01   -4.765137119924044e-01   +4.028238334834582e-02   +2.679526548063059e-01   -3.649148066577437e-01   +2.015920035899981e-01   +4.152817813281872e-01   +9.812095610319221e-02   -1.356629954743068e-01   -4.430734686298514e-01   -8.752373893408386e-02   -1.161478179712334e-01; -4.690816572768879e-02   +6.513033992556609e-01   -1.732167400364487e-02   +5.599325158467982e-02   +9.349354490079619e-02   +2.279495766724035e-02   -9.575238385261121e-02   -9.022889479855063e-02   -2.665319575813900e-01   -3.256958488990479e-01   +2.602077323804128e-01   -1.329084215929422e-01; +1.017265606603904e-02   -1.269710581188915e-01   +3.020501842630689e-01   -9.468619627221192e-02   +1.843186867281673e-01   +5.518550738922928e-01   -2.220845779201186e-01   +1.302788656237402e-01   +3.115367188588479e-01   +4.132351570108258e-01   +2.854426192072366e-01   -7.917236530920856e-02; -1.664067778773640e-01   +3.528387480267023e-01   +4.497471154498018e-01   +1.878175645353535e-01   -3.464268644087078e-01   -5.782963302915297e-02   -2.263037417161837e-01   -2.825590522314885e-01   -2.666699808087722e-01   +3.464031839105833e-01   +5.889813235583972e-01   +1.555139335055694e-01; +2.452209559673771e-01   +1.505521922266807e-01   +1.277664476445970e-01   -9.480290752825266e-02   -1.515817590106634e-01   +1.856273591184402e-03   +2.271103380803985e-01   +2.890665315803786e-02   +5.216575414130712e-02   -6.151618376863335e-01   +3.702837852401015e-01   -5.445500860542747e-01; -2.781589247520906e-01   +8.065251066306309e-01   +1.343199136229808e-01   +6.802096506070172e-02   -3.026375292649942e-02   -2.495515723815056e-01   +8.836850704644915e-02   -6.164458763058071e-01   +4.473142195727023e-01   +5.355531228709498e-01   -3.509054996744364e-02   +2.286039399293300e-01];
L3E_L3I_iGABA_netcon = [+1.503720745731463e-01   +9.241061264701186e-02   +5.385959298138682e-02   +6.277185361261921e-02   -3.763385182768927e-01   +4.378709729403255e-01   -4.775105764493132e-02   -9.767023152204879e-01   +3.113411089689263e-01   +2.423951772765580e-01   -5.999173740496144e-01   +1.805773895618519e-01; +5.787105654968527e-01   +4.234111090138971e-01   +2.604490939922656e-01   -3.227070855874739e-01   -1.020649398877520e-01   +1.180889402556859e-01   -7.272945433560416e-01   +4.438004640902684e-01   -5.454983542761771e-01   +1.862796210484133e-01   -5.216891830548626e-01   +3.742170380434953e-01; +4.377064403766939e-02   -1.315229140013929e-02   -2.900076355496874e-01   +6.575039768003859e-01   +6.263392092588309e-02   +3.244128094802164e-01   -3.464201603593605e-01   +2.346122712381891e-01   -5.739223999203803e-01   +7.800888371383092e-01   +2.478497145042308e-02   +6.055946385794558e-02; -3.159144182347638e-01   -1.633670548550266e-02   +4.369308482925739e-01   -1.907233549852813e-01   -7.766481335706539e-01   -3.345838018720161e-01   +9.549407527392341e-02   -1.462565641428693e-01   -5.390376458667487e-01   +1.345422359620474e-01   +6.221026839111909e-03   +5.317615436624158e-01; +6.359730953330458e-01   +6.514139190766741e-01   -3.304874076014996e-01   +2.503662712947763e-01   -2.052428414666916e-01   +5.496088031520056e-01   +5.190573510589487e-01   -5.505341447383922e-01   -1.835006842366116e-01   -6.485895862884680e-01   +1.544593974000531e-01   +1.575525342829454e-01; +4.889565888018135e-01   +1.353367608938316e-02   +2.322839764534058e-01   +8.335401404532912e-01   +1.182569332800099e-01   -3.461828128329892e-01   -3.239568027980103e-01   -1.076980696495099e-01   +3.114227178300797e-01   -2.627376650266943e-01   -1.052363963674364e-01   +8.639384924481552e-02; -1.031982781487333e-02   -3.662919851644633e-01   +2.359426950211975e-01   +4.880815583281245e-01   -4.532481127674709e-02   -9.860710967203418e-02   +2.474340681427722e-02   -3.680960272830497e-01   +5.367645368589086e-01   -4.054511728424691e-01   -1.765139157209020e-01   +2.644702807925634e-01; +6.367489544355525e-01   +3.569177538779855e-02   +8.615932358761054e-02   -6.845104608219785e-01   -4.112510080233664e-01   -6.169676176928324e-02   +5.378546413824414e-02   -3.074809563120294e-01   +6.062957194630031e-02   -5.278586982321032e-01   -2.955624462352920e-01   -3.866213374766108e-01; -8.253782308290891e-02   -1.535071589380013e-01   +2.247861756449093e-02   +1.924990207779161e-01   -3.185420755842346e-01   +7.954838014422959e-01   +9.555908371971464e-01   +3.353579091978469e-01   -8.324333866988203e-01   +2.769685267011118e-01   +4.441189155362539e-01   +1.122093084039821e-03; -9.168716817993339e-02   -2.821490331039850e-02   +5.291551327291413e-01   +8.166669395536730e-03   +7.636194619920271e-01   -1.697539944560671e-01   -6.641437823495753e-01   -3.343244187980549e-01   -4.193985981123263e-01   -8.171591978168883e-01   +3.137126354903670e-01   -1.686520717721305e-01; +2.346976094415088e-01   -1.753431453768198e-01   +4.328417856892537e-01   +5.426989848791390e-01   -4.224666907227470e-01   -4.855266754813994e-01   +1.473290900800039e-01   +2.450164617855949e-01   -5.222347996375887e-02   +3.492042494892175e-01   -6.356054572395193e-01   +2.950550333834974e-01; -6.683228790493634e-02   -2.041182007104887e-01   -6.781625204327263e-01   -2.667224616933969e-01   +3.452304229828179e-01   -2.474130089149275e-01   -1.922300854317712e-01   +2.018114743851517e-01   -4.872773915546348e-01   +7.517546919909246e-02   +6.229808622608553e-01   +1.448802187372057e-01];
L2E_Input1_iAMPA_netcon = [+6.136834953178120e-01   -1.000000000000000e+00   -3.982610381436813e-01   +5.552876675239544e-01   +2.106908916926605e-01   -3.911539256553101e-01   +2.844038378680375e-01   -5.144258797957686e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +8.992653858276570e-01   -4.983343892374249e-01   -3.774315652447250e-01   -1.358599633372834e-03   -5.767201991745203e-01   +2.673226033219617e-01   +3.788673599145282e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
