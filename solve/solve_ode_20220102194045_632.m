function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.149023185055439e-01   -7.865291980872868e-02   +6.324723895867530e-01   +2.221069902366171e-01   +1.373349274180263e-01   +5.669145678185911e-01   -2.739119242192932e-01   +4.404547388948578e-01   +2.718658651778109e-01   +8.772393899797183e-01   +3.799988811540141e-01   +2.805627786483763e-01   +9.949794819216698e-02   +2.428780539462315e-01   -1.411339407810156e-01   +8.754183187152122e-02; -5.914513052316506e-02   +5.257702657337185e-02   -2.274964365282968e-02   +7.996321064844725e-01   +1.799666987356418e-01   +3.009093967988539e-01   +5.420439698045369e-02   +5.527828606842342e-01   +5.146408253371189e-01   +2.103994049016890e-01   +6.833956386320379e-01   +6.526655621163585e-01   +3.232937113740260e-01   +3.539536214264592e-01   +2.521691962188198e-01   +1.497926987622349e-01; +7.744291815023029e-01   +2.199228437503666e-01   +4.094015789505516e-02   +2.852226270568632e-02   +2.225993475545218e-01   +2.224670235911793e-01   +6.468382596284625e-01   +2.599126793185081e-01   +2.607226075669136e-01   +3.998790593006090e-01   +3.766384187623674e-01   +7.662538860492418e-02   +2.301401952734806e-01   -2.045822989912637e-01   +1.080164990978673e-01   +2.607125497251396e-01; +3.488406510261631e-01   -1.960922440697427e-01   -2.522076098522011e-02   +3.181376003046278e-01   -6.377682002732808e-02   +1.307498051308031e-01   +8.242048386560049e-01   +7.046506652923554e-01   +3.159364232383352e-01   -1.125295734818686e-01   +4.295673859343385e-01   +5.170252635855882e-01   +2.222105934572893e-01   +4.410945457682666e-01   +1.664142170988490e-01   +5.105807341853043e-01; +6.686223760319114e-01   +7.114065689660745e-02   +7.455508977017268e-01   +6.926124745006543e-01   +4.899106047480285e-02   +5.244890730678379e-01   -9.694075549890345e-02   +4.971745723281368e-01   +2.027308314691156e-01   +3.530166066661102e-01   +4.280027010991738e-01   -1.086192218060659e-01   +2.221302506520954e-01   +4.246486140016127e-01   +5.300654630460626e-01   +2.382795088676091e-01; -9.365649663104102e-02   +7.111597390993639e-01   +4.826525233666128e-01   +1.746587407871702e-01   +6.793967339794438e-01   +3.842265175544268e-01   +1.000000000000000e+00   +3.318355833300058e-01   +3.718567432474890e-01   +3.490803282793990e-01   +4.610683641198436e-01   +1.420804823197161e-02   +6.688062078205836e-01   +4.517354047311949e-01   +1.888612156296311e-01   +1.306096993290742e-01; +5.902252649210697e-01   +5.640738434358114e-01   +3.366647659750052e-01   -3.155794207123087e-02   +2.317631277427730e-01   +2.085502799259819e-01   +2.725845010063890e-01   +1.670764457627171e-01   +5.351900473826455e-01   +4.486941070792317e-01   +1.016400426183522e-01   +2.396784004107280e-01   +3.192999565962074e-01   +3.265621237917227e-01   +5.041693896514862e-01   +2.417129130801588e-01; +5.106249908533642e-01   +5.483027049272954e-01   +1.033537385059539e-01   +9.580807436932799e-01   +2.010651622561429e-03   +1.465446056026590e-02   +4.522530779977822e-01   +7.165537200158059e-01   +7.450694788816751e-01   +5.212897643692612e-01   +4.199496219760566e-01   +6.278076429633539e-01   +1.706763384271442e-01   +2.372855149842708e-01   +3.594530215231250e-01   +4.444304162457388e-01; -1.978655216171671e-01   +7.169157340805381e-01   -1.567950404703659e-01   +4.059548597019307e-01   +1.504757924088962e-01   +5.612579946737078e-01   +2.170288313349024e-01   -2.043081592833817e-01   +2.153435644281083e-01   +5.184316727282632e-01   +9.038655629845800e-01   -4.421185454642058e-01   +4.820388444986664e-01   +4.262000960152031e-01   -7.244899042557858e-02   -4.624119668950815e-03; +2.466481635153850e-01   +3.160866630119888e-01   +5.736834596618979e-01   +4.919426050532477e-01   +7.741288336974020e-01   +3.662563859856481e-01   +5.844371360318793e-01   +3.195206810367465e-01   +1.377350572059383e-01   +5.425612375522639e-02   +9.645504306527710e-03   +1.330120951618173e-01   +8.435359995736812e-01   +2.100391752962157e-01   +5.187933456333303e-02   +4.828852786506285e-01; +1.100174157041587e-02   +7.808326334316691e-01   +3.943163844275107e-01   +3.689565522956723e-01   +7.615259671585407e-01   +8.872620372509271e-01   +6.759667726679732e-01   +1.327837465412922e-01   +2.149202323461004e-01   +6.074366176941299e-01   +1.637397365299531e-01   +4.092609772083527e-01   +2.844629692623276e-02   +5.499859509611391e-01   +7.498670806517403e-01   +4.956682240330486e-01; +5.596192670862514e-01   +1.067226878452133e-01   +1.827922325504169e-01   +1.697844437456315e-01   +2.486109029117987e-01   +5.254569808934049e-01   -6.394340028745824e-02   +3.698362162756710e-01   +8.049730419457599e-01   -3.432761914911295e-01   +9.033300590515880e-02   +5.934899820496503e-01   +2.491516907086126e-01   +4.360673148758806e-01   +5.122555851958736e-02   +2.640168036106476e-01; -2.934410897377640e-01   +5.130149619634001e-01   +6.969391179546787e-01   +6.265364332267179e-01   +8.171920218700401e-01   +6.113474614592072e-01   +8.055652802975222e-02   +5.166484581176217e-01   +9.573287817458406e-01   +5.788249529012898e-01   +3.156092048963869e-01   +9.183893372223858e-03   -2.784135224562056e-01   +5.516040199663302e-02   +1.404436308986959e-01   +1.217473328964132e-01; +1.636342806231080e-01   +5.429973003782375e-01   +3.936699471012915e-01   -2.074428603526682e-01   +2.707919911375384e-01   +7.390194004630346e-01   +1.343795138931526e-01   +4.269400177380088e-01   -8.053754236865908e-02   +2.264916189242659e-04   +7.923183433705806e-01   +6.842336157973246e-01   +8.368937553815774e-01   +3.257181513989963e-01   +4.877839357832972e-01   +3.070364079288273e-01; +5.279946457028536e-01   -9.477523024791853e-02   +6.276247704116141e-01   +6.973856292212171e-01   -1.520596421653553e-01   +6.109837281657728e-02   +5.329338029579550e-01   +5.860482640399126e-02   -8.325229985655277e-02   +1.978135292049988e-01   +3.447282127942307e-01   +3.487051612586049e-01   +3.538672473276029e-01   +2.535021930735687e-01   +2.806097627561370e-01   -7.125229195772741e-02; -1.459236864019290e-01   +3.767923867214978e-01   +3.015413538413145e-01   +5.459305299807193e-01   +8.332238119690819e-01   +6.887150558946147e-01   -1.657382694273430e-01   +6.715432629615818e-01   -7.725013028744258e-02   +6.517937906581914e-01   +5.649453692854571e-01   +3.633068270089775e-01   +3.393916153087926e-02   +8.165458820755410e-01   +7.097281361876889e-01   +1.211485284062694e-01];
L1E_L1I_iGABA_netcon = [+2.915828720174291e-01   +4.084667075007730e-01   +1.713946678318393e-01   +1.272819794417900e-01   +3.579164992966112e-01   -1.467579092362911e-01   +2.585539961760286e-01   +2.111769200159573e-01   +1.531270261494510e-01   -8.284674829418491e-02   +2.137227662168207e-01   +9.037229121383854e-02   +4.842929331968087e-01   -2.432472768553453e-01   -4.180938743934872e-01   +9.597473032277549e-01; -1.683879815585758e-01   -1.890634668778990e-01   +2.518442764351623e-01   +2.713625233982319e-02   +2.559402166298439e-02   +2.188749913168007e-01   +5.410678323195799e-01   +3.172136018467754e-01   +5.883667483763327e-01   +1.197501774584908e-01   +5.395349772366349e-01   +1.459583043270911e-01   +6.878503345920255e-01   +1.368392975901484e-01   -2.577230919003044e-02   -7.327547582657369e-02; +3.880401551226492e-02   +2.312027357473729e-01   +1.780351389955980e-01   +4.314825890244303e-01   +3.167604628787621e-01   -2.615846552401287e-02   +1.111193911100112e-01   +2.235438849549076e-02   +1.884659944794200e-01   +7.856172045886676e-01   +3.250288749232350e-01   +1.023865258104410e-01   +1.548663782362022e-01   -2.735530190737296e-01   +2.954843749760219e-01   +5.502305173490656e-01; +6.053277957958842e-01   +4.260427955305645e-02   +5.595424209416202e-02   +2.782797583139851e-01   -1.004704804204630e-01   -1.327130818604016e-01   +2.318746739621496e-01   -2.234966533242782e-01   +6.612305711825012e-02   +5.050711774010501e-02   -1.053378109058865e-01   +3.451994288366844e-01   -2.112312435532538e-02   +5.253753920333707e-01   +3.507019516846085e-01   +1.083088013533470e-01; +1.668495156238416e-01   +3.421628769318607e-01   +1.595205921165548e-01   +6.478212327366101e-02   +6.834691858204637e-01   -3.021027535958511e-01   +2.006499742472326e-01   -1.391643694640952e-01   +2.895383386497103e-01   +5.527367907385425e-02   -6.456686587235086e-02   +3.841610974169482e-01   +3.462425724253169e-01   -2.211580342886441e-01   -1.060915599325775e-01   +3.433006324185393e-01; +7.747978822582570e-02   +2.129751216583769e-01   +4.037480158140918e-01   +1.788177494587693e-01   +1.940197605071644e-01   +3.682178612520874e-01   +1.647301965085989e-01   -8.910229733387301e-03   +4.051495620341072e-02   +1.955136767018943e-01   +3.202444904249923e-02   +4.213315311147370e-01   -3.366700490250207e-03   -2.384584100196491e-01   +5.069078116735234e-01   +5.902989022629721e-01; +8.630439953424421e-02   +1.047428034031996e-01   -1.258415796498615e-01   +1.446812184080244e-01   +2.843660274112293e-02   +2.619758897890472e-01   -1.338181364786561e-01   -2.958595899947816e-03   +5.116698197875221e-02   -5.274676814653363e-03   +2.536628233532175e-01   +1.109310259393505e-01   +4.385020895823649e-01   -3.406310282607868e-01   +3.819985420150278e-01   +7.527894991685591e-02; +2.666856907155152e-01   +5.234500169531631e-01   -5.370703428222934e-02   +3.062768577768486e-01   +5.927685399494822e-02   -8.568481823134830e-02   +3.633510901324323e-01   -9.136337637646905e-02   +5.555721472913356e-01   -9.427493774463555e-02   +1.873496523607858e-01   -2.505568462487697e-01   +3.654654503743619e-01   +1.814117581117279e-01   +6.589852298384845e-03   +1.908068770613316e-01; +5.248457970570899e-01   +3.871389322732154e-01   +3.817598636637762e-01   +1.083081989813845e-01   +5.633502787529587e-02   +5.557073692190581e-01   +2.107081731288095e-01   +1.324151499761871e-01   +3.495009991706531e-01   +4.119071736833562e-01   +1.095628563021771e-01   +3.937730821657909e-01   -5.161235982257514e-02   -9.565043411507394e-02   +5.721208386421363e-01   +2.837052305582933e-01; +2.053276841264920e-01   +4.602073542934096e-01   -2.320817147222360e-01   +3.130863994701791e-01   +2.172104303988414e-01   +4.355843534529355e-01   +1.326992777059700e-01   +1.251277693394226e-01   +4.929345791199987e-01   +2.028920509495799e-02   -1.067793878219678e-01   +3.954565523307866e-01   +3.257441300644308e-01   +4.817133899465201e-01   +1.222265679940284e-01   +6.229032568084343e-01; +1.741152475135409e-01   +9.945566912553042e-02   +3.599890094659085e-01   +1.336752474617938e-01   +1.844752655198733e-01   +3.177066335252522e-01   +3.423579705464693e-01   -1.126344774140577e-01   +3.100206408037728e-01   +2.673441844141056e-01   +9.861274190079421e-02   +4.026594688819523e-01   +3.657672929753428e-01   +1.726842349192438e-01   +1.821052231965408e-02   +1.762195926627140e-01; +4.535990824585284e-01   +2.554547874412764e-01   +3.447736328702271e-02   -2.671927310243508e-01   +1.213404497980165e-01   +2.176019107816240e-01   +1.470615934832972e-01   +3.232572768055695e-01   -1.234979660186409e-01   +1.907431106652491e-01   +4.145728647886463e-01   +5.212255962578289e-01   -2.074949906246447e-01   +1.734879686519654e-01   +1.233278414431313e-01   +2.187848110454816e-01; +2.755502822256692e-01   +3.666511853289311e-01   -8.337852223940644e-02   +6.301389496951300e-01   +7.317446584489698e-02   +1.461962096604976e-01   +1.114661411430053e-01   +3.002544330296827e-01   +1.781028069026080e-01   -1.379009911946951e-01   +3.968746084735109e-01   +2.484536398926985e-01   +7.144763312835864e-02   +2.143776946515297e-01   +4.653351219133641e-01   +3.471967037188106e-02; +3.377460202667329e-01   +1.199683626253240e-01   +3.257195083643959e-01   +4.548848400073064e-01   +2.572516744670116e-01   +1.817200943106027e-01   +3.237079187005899e-01   +3.206452117891453e-01   +2.792722591884471e-01   -2.052928225890803e-02   +3.153111414411769e-01   -1.225410664368948e-01   +6.765079141322472e-02   -5.137137638008483e-02   +1.333585767752183e-01   +5.798605636031312e-02; +3.679609330803992e-01   -1.627084082792257e-01   +1.744000156548093e-01   +1.147312191937641e-01   -1.487117768866051e-01   +1.982111145069795e-01   +2.123904387209109e-01   +1.503713297611454e-01   +2.686323401951290e-01   +1.226863634271808e-01   +4.622321819645156e-01   +3.780370180613670e-01   +6.377761855655492e-02   -1.818334383067887e-01   +3.589443899691813e-01   +1.596183721048599e-01; +3.058649955716077e-01   +9.881632955525615e-02   +3.300301662253313e-01   -3.610659452644996e-02   +4.784218008703581e-01   +2.197755139093578e-01   +2.080081063501859e-01   +3.556314724304082e-01   -1.750951327852119e-01   +3.726645919638787e-01   +2.890235601719055e-01   +4.727971334157292e-01   +1.992843433149299e-01   +1.503502509025542e-01   +1.460020963963090e-02   +4.249456590947439e-01];
L2I_L1I_iGABA_netcon = [+3.043474771407352e-01   +7.505479614394565e-02   +1.676599973784001e-01   +4.433176618411182e-01   +7.210319241445219e-02   -1.792079734552272e-01   +1.524648830002260e-01   +2.299052177895583e-01; +4.451922831615575e-01   +8.197210861494926e-01   +3.141232251469425e-01   +3.702511887921163e-01   +4.181917688402346e-01   +3.816258237124062e-01   +3.584554945038548e-01   -4.850747320888396e-02; +3.365681078150379e-01   +1.468695664403326e-01   +7.616767108957140e-01   +3.332327483016004e-02   +6.086108427375808e-01   +1.618436704168614e-01   +4.516168728409348e-02   -3.416534637040903e-01; +6.312365139594387e-01   +2.772590340431682e-01   +3.502944624595875e-01   -2.405207755306209e-02   +7.881837606212682e-01   +4.235823042705493e-01   +6.528819998232631e-01   +5.871650893695962e-01; -2.380111943104196e-03   +6.096389596445636e-01   +3.927440769557965e-01   +3.762456143111952e-01   +4.651047208699040e-01   -5.715205740141677e-02   +5.233294970387122e-01   +2.457426134104657e-01; +3.230066553461885e-01   -8.508845978181077e-02   +4.936029851234042e-01   +4.150891895009262e-01   +2.727954259844501e-01   +6.069575315215705e-01   +3.139167862943452e-01   +5.195550111969985e-01; +7.437536479996766e-01   +6.525569167158761e-01   +5.940465145270264e-01   +5.958454121816323e-02   +5.413189314371772e-01   +2.436730651070738e-01   +5.691876035812817e-01   +7.961814259581239e-02; +2.957754322846574e-01   +2.924300746648889e-01   +3.901443766308501e-01   +1.125176259522844e-02   +2.490731247837293e-01   +5.081725308583775e-02   +2.157636185044141e-01   +3.671619461986415e-01; +7.553724417395442e-01   +9.974395574724765e-01   -3.493914459685392e-02   +7.804349744859364e-01   -8.097197075232580e-02   +3.641592368031663e-01   +1.571694875169403e-01   +3.160272891057277e-01; -2.365145453859600e-02   +3.814218117014529e-02   +1.384621885948078e-01   +6.534532428475389e-01   +7.298504773825699e-01   -3.669270913603806e-02   +6.750937930824569e-02   +8.417226108096169e-01; +3.410945478754268e-01   +2.074243336127708e-01   +5.241216725955911e-01   +6.013989244940084e-01   +1.310738870489267e-01   +5.376134016682325e-02   +4.121199428011683e-01   +2.870826230701340e-01; +5.696513147998405e-02   +4.902924244598304e-01   +4.838835501480898e-01   +5.521619809766233e-01   -1.261407718521820e-01   +3.689999029306719e-01   +1.748363247877973e-01   +3.324533151590843e-01; +1.479933824234727e-01   +7.051260820275278e-01   +8.605479434059096e-01   -3.270723491344471e-01   -1.385757917640361e-01   +7.710046731638534e-02   -1.726546597247825e-01   -1.098405251353903e-01; +2.028722164239835e-01   +5.700884110476358e-02   +1.695778658630275e-01   -2.801548603754437e-01   +4.575637466237110e-01   +3.356026042301410e-01   +2.637959958320345e-01   +1.115997621219248e-01; +6.798389273063267e-01   +6.782140770433202e-01   +6.540622717614906e-01   +7.491966377421644e-01   +3.458813747616801e-01   +8.989025952090138e-01   +4.721177416617677e-01   +7.291361783669404e-01; -1.406121029853556e-01   +1.630934715466666e-02   +6.589760790496939e-01   +1.896656144561921e-02   +1.398927558958450e-01   +1.386479887229540e-01   +2.996758286557011e-01   +6.262869489721623e-01];
L1I_L2I_iGABA_netcon = [+2.078749528610068e-01   +4.523306337301544e-01   -9.134755732860980e-02   +5.215143678603631e-01   +2.521576523596078e-01   +2.905873863950796e-01   +4.330302115412168e-01   +5.224954986848047e-01   -2.696856451566842e-01   +6.841456660980385e-01   +5.665816819374057e-02   +2.826164681748570e-02   +5.204589077171835e-01   +2.580071959847909e-01   +2.441658983122402e-01   +4.148390909632884e-01; +1.218026759112120e-01   +3.143815016050299e-01   +1.468781192242978e-01   +3.158322695428237e-01   -3.879421917302227e-01   +2.650443608008721e-01   +7.285727668383698e-01   +2.210915761837528e-02   +4.551628234512217e-01   +4.873081661841999e-01   +2.791297580809550e-01   -1.280532938621082e-01   +1.917154440910921e-01   -3.654984565156326e-01   +1.393616077761863e-01   +4.570179684949441e-01; +2.333994394395008e-01   +2.502632921917181e-01   +4.592104985038143e-01   +3.290307337637690e-01   +3.250081880326450e-01   +3.361592438142423e-01   +4.101703240628743e-01   +4.770067023554144e-01   -4.913362325584705e-02   +4.658484444171853e-01   +9.568024816029613e-02   +4.154222905011375e-01   +3.253539789142687e-01   +5.513428718205020e-01   +5.160992286022889e-01   +1.048100415760870e-01; +4.287141674081454e-01   +2.727495035199876e-01   +2.263076854970206e-01   +1.960140727784464e-01   +7.007877651692136e-01   +3.698651589737729e-01   +5.655550813371741e-01   +6.483248541465513e-01   +9.905681106802003e-02   +6.442390533152679e-01   +2.886318563295548e-01   +3.915820564547762e-01   +3.720583130962369e-01   +2.722170928701243e-02   +5.097341088825266e-01   +1.005795592789596e-01; +1.394990516953409e-01   +2.497860638826177e-01   +2.696802456568392e-01   +3.232188987934759e-01   +2.184248795606383e-01   +1.000000000000000e+00   +4.660988879079326e-01   +4.491562611279848e-02   +5.498681735603206e-01   +7.500595439516508e-02   +1.336078343082481e-02   -2.861568085470450e-02   -1.971350174120375e-01   +3.565462757903904e-01   +2.534703545177648e-01   +6.233828811969491e-01; +1.943228960359386e-01   +4.187967985234359e-01   +3.657913857414195e-02   +9.722504200620720e-01   +2.017324397548022e-01   +5.828461216555192e-01   +4.438994999152323e-01   +1.763269910766916e-01   -4.400762957372200e-02   -2.697077831349977e-01   +4.265180645581983e-01   +2.510738416035348e-02   +4.732127362546532e-01   +6.481782192555278e-01   +3.743577571418878e-01   +3.404931293450012e-01; +6.818761850718653e-01   +7.910160700765771e-01   +1.725605143776834e-01   +4.495956922233976e-01   +2.422174311099989e-01   +1.486043782588595e-02   +5.980999475735265e-01   +8.979342503153395e-02   +1.599860544171500e-01   +4.993210289877514e-01   +3.937441369649859e-01   +1.449918756856101e-01   -1.179225547675454e-01   +2.770459143110853e-01   +2.248114146612477e-01   +5.033804139479706e-01; +6.144132537274167e-01   +1.232272588187972e-01   +2.835476219419080e-01   +3.182240885713418e-01   +2.222818355030524e-01   +5.909246574759137e-01   +3.019596906612023e-01   +2.113327815646478e-01   -5.453159577232027e-02   +1.229847396918397e-01   +7.594039168460052e-01   +3.828070059739371e-01   +5.289857594284867e-01   +9.660969174947871e-02   +3.815575925690880e-01   +2.490187556526133e-01];
L2E_L1E_iAMPA_netcon = [+4.444452129169651e-01   +2.063842526791659e-01   -5.112453788845647e-02   +4.660068427862756e-01   +7.459045125322291e-01   +3.725281749260990e-01   +2.990047221255769e-01   +1.455616062698498e-01; -2.638597706624918e-02   +5.623936322216301e-01   -3.565843451671101e-02   +1.896670078899046e-01   +2.650135090554384e-01   -2.147990290407883e-01   +3.742723232124974e-01   +6.657410239396802e-01; +1.293465602446703e-01   +7.836191674294648e-01   +4.517853461918137e-01   +2.879836693929242e-01   +1.244019069463999e-01   +3.936419921517137e-01   +4.807171452838905e-01   +3.385362622953350e-01; +5.972919580946662e-01   +1.649378781714147e-01   -1.687336044298011e-01   +6.061388593020728e-01   +2.926064009063181e-01   +5.236016305641063e-02   +1.933036298769447e-01   +1.264806794008276e-01; -3.685265758199448e-03   +5.721391351370725e-01   +3.726322072755697e-01   +1.748427901892254e-01   +5.424026510550078e-01   +1.536208783287281e-01   +5.973334702256483e-01   +7.544248038032779e-01; +3.541613172502822e-01   -2.298155208860713e-01   +7.171171343009061e-01   -1.005250733118845e-01   +6.354522082368950e-01   +6.785318743776593e-01   +5.332784976801311e-01   +4.111915684414909e-01; +3.206213763452754e-01   +3.968966008752081e-01   -1.118544592959680e-01   +3.541089474183294e-01   -1.730152545647421e-01   +2.687159435905217e-01   +9.878088412383336e-01   +4.694130924631188e-02; +1.066530406474230e-01   +4.236266839078713e-01   +7.060915106963073e-01   +1.323591521276728e-01   +5.882730607685231e-01   +3.865583192042264e-01   +4.281322898949905e-01   +6.794580189164381e-02; +6.087134425591776e-01   +9.266625440902071e-02   +3.153079442936755e-01   +9.531199769675659e-01   +2.382402021662468e-01   +6.843390374361339e-01   +1.708523804793529e-01   +4.838910541477857e-01; +4.735763515412625e-01   +7.033782962258724e-01   +3.463661533618945e-01   +5.201101676400709e-01   +9.580877422378510e-02   -3.259564209064922e-02   +3.836560326558763e-01   +3.827187244465013e-01; -5.215808480593306e-02   +3.402226614741634e-01   +2.556469136729649e-01   +2.678936841144582e-01   +1.547963995785543e-01   +2.598507690706670e-01   -2.449056898452177e-01   +2.716355371082415e-01; +1.466401320567994e-01   +1.278854424792972e-01   +7.654150476994803e-01   -7.605252790972176e-02   +2.707611435252818e-01   +3.784691568033184e-01   -3.214335875069172e-01   +2.826337999401725e-01; +1.558638698295710e-01   +3.456343978094360e-01   +6.531240525583454e-02   +3.742947757241774e-01   +2.569775276343738e-01   -1.022254301341988e-01   +5.380598336675652e-01   -6.332510908816127e-02; +2.211016626374832e-01   +2.654002214570661e-01   +5.290490380219695e-02   +6.211665892764303e-01   +8.495784228894272e-02   -3.818454607022805e-02   +4.407069778340671e-01   +2.096835522496864e-01; +6.718136504721060e-02   -1.812609588344393e-01   +3.643916486747357e-01   +3.073432651469997e-01   +4.089977829387383e-02   +4.128729119368402e-01   +3.697984039528091e-02   +1.619039242357633e-01; +3.271329530411864e-01   -5.755728932435521e-02   +8.151532449784081e-05   +5.044094164822378e-02   +4.430493676614933e-01   +4.824619373744693e-01   +2.102085383912560e-01   +7.774063696825472e-01];
L1E_L2E_iAMPA_netcon = [+2.281409136216893e-01   +2.367424125459693e-01   +2.508899081637229e-02   +3.164826713280893e-01   +1.180582187881113e-01   +3.920721374321071e-01   +4.003465449149620e-01   +1.949705632271848e-01   +2.539025508125455e-01   +2.693572452775295e-01   +4.027159865521545e-01   +5.820168652147408e-01   +5.736401637913999e-01   +1.741706736961095e-01   -9.678488403483192e-02   +5.151086033747806e-02; +2.020291692802017e-01   -1.917718153084131e-01   +2.444190787205569e-01   +4.142511204511239e-01   +1.750607935658728e-01   +2.133551257834337e-01   +1.715966496869119e-01   +2.765849816399957e-01   +5.943585706477808e-03   +4.187842983080204e-01   +1.502297165743273e-01   +6.262535851284438e-01   +4.035010280944337e-01   +3.863237820311406e-01   +4.019125692470633e-01   +2.306292692542813e-03; +7.401372417997478e-01   +2.772717582142459e-01   +2.267245124428500e-01   -3.412928336337538e-02   +1.131491740021834e-01   +2.973088218428502e-01   +3.284240139778361e-01   +5.429102908653357e-01   +4.886092415570280e-01   +1.852303879492351e-01   +4.056525485665452e-01   +3.128675155382875e-01   +1.743918544579530e-01   +4.256598267848577e-01   +1.300395502030113e-01   -1.497182787546402e-01; +3.310951676390237e-01   +6.150493286583285e-02   +6.536943293002953e-01   +3.860583823216666e-02   -9.919302121264587e-03   +3.333082545391340e-01   +9.883058978183130e-01   -9.930630201861139e-02   +3.580672171897616e-01   +3.315949806383200e-01   +6.090284519888892e-01   +2.720964983384627e-02   +3.148168520691444e-02   +5.169727205194196e-01   +3.816991867146058e-01   -1.899785565127028e-01; +1.720829767594624e-01   +7.946793567450999e-02   +7.748732957653073e-01   +2.799341635594240e-01   +3.348215041623304e-01   +4.968385361153151e-01   +6.094934071267339e-01   +2.510329417778584e-01   +4.217579119828230e-01   +3.163402413642310e-01   +3.588065331338758e-02   -3.139301195995213e-01   +4.843794397675930e-01   +1.698372430623920e-01   +8.466713622548476e-01   +7.934201676794818e-02; +2.693533402875519e-01   +5.998444192299127e-01   +3.926043077420107e-01   +6.268836597183672e-01   +1.820254081977223e-01   -8.944232404248635e-02   +4.923087479647139e-01   +3.374747722080714e-01   +3.224036060174101e-01   +2.584034267024609e-01   +4.346996551804420e-01   +5.687811899974151e-02   +9.941577740276729e-02   -1.461277034654099e-01   -7.047950294568345e-02   +3.968256154365680e-01; -2.585620016526496e-03   +2.036734920697646e-01   +2.187770044707742e-01   +5.675049058628135e-01   +9.965548909904891e-02   +9.466178292110533e-02   +7.151773983736887e-01   +9.194735173705074e-02   -1.811221266337635e-01   +2.448751765576766e-01   -5.326167437495984e-02   -1.813551711628890e-01   -1.539280774096157e-01   +1.980536217333945e-01   +2.263873067795461e-01   +1.213693546171674e-01; +3.763296494531594e-01   +2.341371633953879e-01   +3.959107986650638e-01   +6.105073819606159e-01   +4.730601495779679e-01   +7.516544619328654e-01   +6.731368520955333e-01   +3.750287496637546e-02   -1.623680059439001e-01   +5.599286595282703e-01   +4.529757546613375e-01   +2.859167662753129e-01   -9.069623602690861e-03   +5.892594285273312e-02   +3.279231828589747e-01   +1.705032588125272e-01];
L2I_L2E_iAMPA_netcon = [+5.186693349535656e-01   +5.124887040052208e-01   +4.301465230767272e-01   +2.339288061567502e-01   -8.528979228514899e-02   +5.669902487542904e-01   +3.512633453139824e-01   +3.762648380679626e-01; +6.476080062251197e-01   +1.538092659741503e-01   +5.610579332343151e-01   +4.640167563801286e-01   +4.083068710000762e-01   +2.568037153644980e-01   +2.704146240110199e-01   +3.243628258815099e-01; +3.101130865326319e-01   +5.581531898514189e-01   +2.189030936345881e-01   -2.565805011351738e-01   +1.254318907336560e-01   +1.318838677295273e-01   +2.547599647035754e-01   +8.023783453448061e-02; +2.110972257483993e-01   +3.636454640074574e-01   +1.387389452798775e-01   +5.976232949606277e-01   +1.839014090863746e-01   -1.025854318719604e-01   +1.577272630126303e-01   +1.254652849511745e-01; +5.298637746389274e-01   +2.979337036771872e-01   +2.107086987912331e-01   +4.072173585906708e-01   +4.512585117833956e-01   +1.777654995666767e-01   +6.688148452423305e-01   +5.490216371337281e-02; +2.617514444074835e-01   +3.214738985250498e-01   +1.606647487086351e-01   +4.381513313064426e-01   +4.470251201966886e-03   +4.037721701829703e-01   +2.970317456031169e-01   +1.856453308278026e-01; +2.885517123499857e-01   +1.096225830529387e-01   +2.401339149513919e-02   +5.505599128203568e-01   +3.232739042016151e-01   +1.592624667852649e-01   +9.699212397826232e-01   +1.319860972885140e-01; +5.432430255928037e-01   +2.567191353369174e-01   -2.008718108153332e-01   +3.888135674922965e-01   +1.915435302520229e-01   +4.284740884639795e-01   -5.261699164156328e-02   +3.680057328438942e-01];
L2E_L2I_iGABA_netcon = [-7.918915827850308e-02   +6.318481408897531e-01   +5.541349979046051e-01   -1.269291225475195e-03   -1.800734760527100e-01   +4.289576005517016e-01   +9.581876983214961e-02   +5.280258076780507e-01; +2.507367323551255e-01   +5.549213235178813e-01   +4.892012604626266e-01   +6.382354231124963e-01   +5.046927668608759e-01   +5.452752242766410e-01   -2.879809439129254e-01   +4.604943333758635e-01; +1.988461078868856e-01   +6.703595991225596e-01   -1.985928453045428e-01   +9.936013563623729e-02   +5.664290478426732e-01   +6.126410551571912e-01   +1.001700880494269e-01   +9.929646402343361e-01; -7.918479979859080e-02   +4.517424014094523e-01   +3.273464991571586e-01   +4.355612485497181e-01   +7.370301417429793e-01   +1.272327882496689e-01   -9.741237798202107e-02   +8.401272330457048e-02; +4.365142313569533e-01   -3.336813607958309e-01   +8.965248927720768e-02   +6.616033817582589e-01   +6.232816500367664e-01   +3.139747146172755e-01   +1.312206763476029e-01   +8.451298614967885e-03; +1.538428715048770e-01   +7.758823265716165e-02   +6.298019075651634e-02   +4.429036424089978e-01   +3.124009089563552e-01   -1.642077825979587e-01   +3.477111876085474e-01   +5.469369837242279e-02; +4.978784552208388e-01   +2.717067156258410e-01   -1.685248164724728e-01   +1.562544413763876e-01   +2.836059314803220e-02   -1.350419725203749e-01   +1.860693173399869e-01   +9.094925531212397e-01; +2.967008695961913e-01   +6.382281357145421e-01   +6.601209588069437e-01   -3.676019163870383e-01   +3.775782470581882e-01   +1.509931861898804e-01   +6.936083649257704e-01   +3.941128274785329e-01];
L3E_L2E_iAMPA_netcon = [+5.967668345175603e-01   -2.444711922723199e-01   +7.748064618266555e-03   +3.438261488743695e-01   +5.935598160804839e-01   +4.326846373252906e-01   +3.580450105717951e-01   +5.734225300098569e-01   +2.279424073290305e-01   +4.504368691626174e-02   -1.355182469327984e-01   +4.388880054976081e-01; +2.474804477390872e-01   +8.656709455161468e-01   +3.881765535462078e-01   +1.720327970093066e-01   +2.054115238515585e-01   -3.772845917489999e-01   +2.558240886519985e-02   +1.909793215120657e-01   +1.096709389752611e-01   -1.272446100352263e-01   +2.166259871895484e-01   +2.641832018136276e-01; -3.707607861085551e-02   -1.638658182233692e-01   +3.802547514419323e-01   +1.636267135474862e-01   +8.079336064556510e-01   +4.872413733057515e-01   +3.636963785804928e-01   +4.684856619002500e-01   +4.132719119299955e-01   -2.844887245749394e-01   +1.441437486246422e-01   +5.663127792603764e-01; +2.923524848954472e-01   +8.552020623630971e-02   +3.292683517353332e-01   -2.647658788081814e-03   +4.879287653598546e-01   +3.085167118958980e-01   +3.841857030709658e-01   +2.412924480419120e-01   +5.931676816946082e-01   +7.609076008111307e-01   +1.645375136120447e-01   +1.640067778116933e-01; +5.354069745416838e-01   +1.856846079123524e-01   +3.157413357650942e-01   -1.328253478744005e-01   +7.838209078902167e-01   +2.697466730711779e-01   -1.512523856818910e-02   -2.928834414940536e-02   +3.670557135758369e-01   +3.545170211622565e-01   +5.281397942821952e-01   +4.222896006204166e-01; +4.898335729694616e-01   +7.564765633038328e-01   +6.121003577766485e-01   -1.790127854650674e-01   +4.344341759315929e-01   +8.647583894306766e-01   +4.792455917860159e-01   -1.553737336677521e-01   +1.288775194719636e-01   +5.076417583999839e-01   -3.139561954002087e-02   +4.191453397345522e-01; +4.719527608730114e-01   +1.137927864209529e-01   +5.805233913772170e-01   +6.589512252120035e-02   +1.472030120542362e-01   +4.855789268841865e-01   +2.442547354062816e-01   +3.783955084525092e-01   +4.441528270383800e-01   +5.550237357549458e-01   -1.689931033065288e-02   +2.005653608157465e-01; -1.658307568316475e-01   +6.610219747597187e-01   +4.399698789362233e-01   -3.001604408940191e-01   +6.095454524967486e-01   +9.620018870663986e-03   +1.169529334930948e-01   +1.266821000371395e-01   +5.714239814558266e-01   +5.404712479224582e-01   +6.160820261681792e-03   +1.094792467746105e-01];
L3I_L2I_iGABA_netcon = [+6.005234773417606e-01   +5.482685653045466e-01   +2.266623915755486e-01   +4.044051290596663e-01   -2.687404466803664e-02   +3.126767326313571e-01   +7.096216123792530e-01   +3.176184018416540e-01   +7.294167575001170e-01   +1.420215693550983e-01   +1.034245984760513e-01   +6.410942098946505e-01; +2.560631622557420e-01   +3.416231342016034e-01   -9.483053757436229e-02   +2.380594224971549e-01   +6.667392166504460e-01   +2.611695259612116e-01   +3.372061627368129e-01   -7.719340744463724e-02   +3.866097165615775e-01   +2.526561603451623e-01   +3.622253305227791e-01   -4.487104802471298e-01; +1.893519964687031e-01   +5.473036594082041e-01   +5.848773558002291e-01   -4.783374405237734e-02   -6.108836980702491e-02   +4.226475821491024e-02   +4.103226549929825e-01   +7.076905733746435e-01   +1.635792424042600e-01   +1.448840493929672e-01   -3.387215805402512e-02   +6.648249527130080e-01; +4.871200510174146e-01   +4.905569836802377e-01   +2.311133885678987e-01   -7.798073401722760e-02   +1.756875431829895e-01   +4.577096736685626e-01   +1.279001248502576e-01   +1.507542932237452e-01   +2.395474732942465e-01   +2.238815087994095e-01   +4.420686935954869e-01   +2.272392214473747e-01; +2.114781245263916e-01   +3.134752133019976e-01   +2.191280505467047e-01   +5.315788912094191e-01   +5.622893901823174e-01   +5.575466944738630e-01   +6.338933512503818e-02   +9.158425191341295e-01   +5.987297747470169e-01   +6.658982752049056e-04   +4.947803135435027e-02   +7.052532599361127e-01; -1.325179581634649e-01   +5.178408929566342e-01   +1.860551805062148e-01   +3.458719128068493e-01   +6.992182604949357e-01   +8.003323419938378e-02   +2.632658719260423e-01   +2.927717034996206e-01   +3.241626912857133e-01   +8.307973952239037e-02   +5.055451102156326e-01   +4.518072727775569e-01; +5.281904512504363e-01   +1.621647438301971e-01   +7.636768717451818e-01   +3.378380725575451e-03   -6.688501524490179e-02   +6.014512410782489e-01   +4.546418506960604e-01   +6.213307519405314e-02   -1.981093639921071e-01   +4.077876494376297e-01   +4.955942571375191e-01   +3.636964190332171e-01; -7.399977042230838e-02   +3.299847581074720e-01   +6.904918546449667e-01   +6.487296319196599e-01   -1.552800456851083e-01   +4.770659694185073e-01   +5.761565183111228e-01   +1.339497150551003e-01   +7.803071350681835e-01   +1.844647559848366e-01   +4.740515872173240e-01   +2.898555807979952e-01];
L2E_L3E_iAMPA_netcon = [+5.986417460102826e-01   -1.367176745875529e-02   -4.680078566957060e-03   +1.479361240204566e-01   +1.350110171351496e-01   -2.721262662978685e-02   +1.095717281137061e-01   -1.843864615973881e-01; +2.074805021749950e-01   +1.429787975062666e-01   +2.806556207417687e-01   +2.336651453787523e-01   +3.718106274696584e-01   +5.608032802975304e-02   -4.340981872252188e-01   -4.918441997172524e-01; +8.009128651890852e-01   +2.236027870725875e-02   +5.463525895703785e-01   +7.287019009903598e-01   -3.430717664982293e-02   +2.119219597063679e-01   +1.718716423709430e-01   +5.188179961378624e-01; +1.827208011707701e-01   +2.644779636767444e-01   +4.354826549715273e-01   +8.529325684933069e-01   +8.129906843123159e-01   +5.284966866124569e-01   -1.489020440821120e-03   +7.034320130596450e-02; +2.206008828010828e-01   +4.929666446593108e-01   +4.180164097667155e-01   +7.389831445659012e-01   +8.598384667143071e-01   +1.794193753097122e-01   -1.095519418574537e-01   +3.029296696303064e-01; +3.840557284076990e-01   +6.199349459334650e-01   +8.684061899564590e-01   +7.016927579669373e-01   +6.531543327899121e-01   +4.778561154288128e-01   +5.466716956625184e-01   +1.464782356530111e-01; -1.327773433988304e-02   +3.594719954159170e-01   +1.000000000000000e+00   +3.671325138544952e-01   +1.298076614098766e-01   +9.667098521132601e-02   -6.133422086762635e-02   +4.075786312704594e-01; +3.320108568458635e-01   +5.317083209468614e-01   +4.572072372115784e-01   +1.509560475101298e-01   +3.275074084989196e-01   +1.829612319189335e-01   +5.461882578751203e-01   +9.918795533846358e-01; +7.604776185866036e-01   +3.112392338990909e-01   +3.329808511800896e-01   +1.223573053733907e-01   +4.266188092070931e-01   +1.439495404596558e-03   +7.875879932576081e-01   -2.734993723635729e-02; -5.604409595210796e-02   +5.622767750041668e-01   +3.637565589000532e-01   +4.388775773658049e-01   +4.505028805607725e-02   -1.169184427707984e-01   +7.040078712488470e-01   +8.832002478644327e-02; +3.260755317218091e-01   +3.042907192397485e-02   -2.122269328237832e-01   +6.758252455404780e-01   +4.693251801864147e-01   +5.067057093678559e-01   +3.746148801977633e-01   +5.624261103086579e-01; +1.763030015045805e-02   +8.408898214819406e-01   +6.554718442678313e-01   +4.742613004061416e-01   +7.638220801271213e-02   +7.694022769971831e-02   +6.223217637372280e-02   +6.508788677257881e-01];
L2I_L3I_iGABA_netcon = [-2.407821689755693e-01   +1.055389739542736e-01   +5.857781899458130e-01   +4.215238057679717e-01   -1.598844049006723e-03   +7.111238477989789e-01   +2.920268213583878e-01   -2.993142618725224e-01; -2.237223751176690e-02   +5.028303286153051e-01   +4.406827031485176e-02   +1.205161292731411e-01   +3.023576306466491e-01   +1.325504725151543e-01   +1.543531386740360e-01   +6.830900173024772e-02; +6.057018824658259e-01   +4.475597982977899e-01   +1.626704371547794e-01   +5.591980926281976e-01   +1.820244637651252e-01   +1.000000000000000e+00   +2.074890766098844e-01   +8.285131864166705e-02; +1.229264537673999e-01   +4.248481261567334e-01   +5.933871648242082e-01   -1.993538768661023e-01   +2.273333546967975e-01   +2.895313273599686e-01   +5.911504439392358e-02   +4.199698477053729e-01; +6.349783928873253e-01   +5.027980911847827e-01   +1.544053247712984e-01   +3.680447192990658e-01   +2.513124654992077e-01   +2.732202062388568e-01   +1.099376157145187e-01   -8.754683444471242e-02; +6.885786679026858e-02   +3.106986471689885e-01   +6.588720941780102e-01   -3.616115325451206e-01   +1.203491587469100e-01   +5.893467836166389e-01   +4.686946403458846e-02   -4.599141430320114e-02; +7.144659897925688e-01   +1.888528233826285e-01   +3.035851124348152e-01   +3.852791388587611e-01   +1.851950490671728e-01   +4.381980480677863e-01   +6.107374520916521e-01   +2.858871203241543e-01; -2.583691550607931e-01   +7.252683719711783e-01   -1.294199641299914e-01   +4.599525188124309e-02   +1.808070171019728e-01   +1.319947540201691e-01   -2.024151803218097e-02   +5.626098071193417e-01; -4.000857973907107e-01   +4.883910550958455e-01   +5.027889725515142e-01   +1.218374028522231e-01   +2.074918845877557e-01   +5.573210875132864e-01   +2.787200598250179e-01   +4.712443513175432e-01; +5.518728748136256e-01   -1.291718581376562e-01   +4.795324007991373e-01   -1.016914367727092e-01   +4.277372292694979e-01   +5.448925482426833e-01   -3.695037555394643e-03   +4.766361666323983e-01; +6.542347914139510e-01   +1.844826786004791e-01   +2.860068434641188e-02   -2.455398131208619e-02   +6.022895702373794e-01   -1.629470844610078e-01   +4.689292054605913e-01   +8.165943556173706e-01; -2.129233154124815e-01   +3.982042513473427e-01   -2.156200485523904e-01   +5.288998914119982e-01   +7.430608588899824e-01   +1.655250932832153e-01   +1.859109748902905e-01   +5.503009673933056e-01];
L3I_L3E_iAMPA_netcon = [+5.804575285253103e-01   +4.713390204853796e-01   +7.270855192808745e-02   +3.446385808423797e-01   +3.426310753655613e-01   -1.160394366637525e-01   +3.309059660183234e-01   +1.978547158807081e-01   -7.257106244294440e-02   +5.389356995110519e-01   -1.043884381190533e-01   +5.344218314591371e-01; +2.813437539735784e-01   +2.767184834280184e-01   +4.324241820762528e-01   +6.564042444191833e-01   +7.942234913150089e-01   +1.636479555681674e-01   +1.580284351380966e-01   +4.623158951699435e-01   +6.585855986887841e-01   +3.099920957106465e-01   +7.759739496270286e-02   +1.459260271921018e-01; +5.650339140790260e-01   +6.602155644072846e-01   +8.815395007346734e-01   +3.927053174263715e-01   +6.498031870867054e-01   +2.589572844544610e-01   +5.168106149577079e-01   -2.219128812702359e-01   +5.411199685101549e-01   +7.408955882794354e-01   +1.041663373840543e-01   +4.896373768102211e-01; +3.193965184708000e-01   +5.956449243434696e-01   +4.218826793672995e-01   +1.529218733242032e-02   +2.718061253079227e-01   +6.592241955480957e-01   -2.860111391556732e-01   +3.911855819147536e-01   +2.258222038482759e-01   +2.431670473982371e-01   +1.984584710296675e-01   +4.185012252740747e-01; +2.883409671586198e-01   +1.426154615707285e-01   +8.295957536703867e-01   -2.112102774530487e-02   +2.983921349078574e-01   +1.882539296072523e-01   -1.024582564252023e-01   +2.993143904004394e-01   +6.041276870326839e-01   +4.919761786372003e-01   +5.484961007661810e-01   +2.223025879434495e-01; +7.825080504749690e-02   +1.763068294462589e-01   +4.295059693856367e-01   +9.239558845169320e-02   +1.199927323682350e-01   +6.302302241548310e-02   +3.756319749036692e-01   +1.929861345140250e-01   +2.743325281920639e-01   -1.259432352347356e-01   +3.720801268157969e-01   +2.711233972695158e-01; -2.171085075136870e-02   +2.163622984948275e-01   -2.555628220890909e-01   +1.398507628816950e-01   +4.695925046309778e-01   -8.603271720233299e-03   +5.119513530170809e-01   +4.710666712428956e-01   -1.449818453135961e-01   +3.023692042923882e-01   +5.240090364270275e-01   +2.253438569143113e-01; +2.255611754025175e-01   +2.870707909137543e-01   +4.203620753374221e-01   +2.293140141359128e-01   -1.732255599875350e-01   +3.248464507522729e-01   +1.237684494619254e-01   +4.268344389289824e-01   +2.442056398966330e-01   -2.097977642041595e-01   +1.602704186814469e-01   +4.369847244072971e-01; +1.232796404178921e-01   +6.837551926479417e-01   -7.190996184512473e-02   +3.673843616735154e-01   +2.454590921392724e-01   +7.724572324648955e-01   +2.153516289620184e-01   +6.218453476820848e-01   +5.025976267853962e-01   +4.178636748636373e-01   +6.847520507484048e-01   +7.379413737222532e-01; +7.275194152315896e-01   -3.142622004417187e-01   +7.689867690992391e-01   +3.295468734862483e-01   +4.589744980747761e-01   -3.142660736398228e-01   +3.816628387812063e-01   +2.556665372177062e-01   +2.977299681237077e-01   -1.299255341745900e-01   +8.190973736762535e-01   +8.743634807617601e-02; -1.034628408131384e-01   +2.722607350210793e-01   +6.309465076808304e-01   +4.203050424413124e-01   +5.936920191571877e-01   +1.812598933841197e-01   +3.524491339886549e-01   +3.371463830250275e-01   +7.956702251107330e-01   +1.307483094414641e-01   +3.390939209039163e-01   +4.537025345868448e-01; +1.613564137475654e-01   +1.630960492054741e-03   +3.992948934335173e-01   +2.966227553034101e-01   -6.376792757367955e-02   -1.162250629745008e-01   -2.263842448621309e-03   +1.997676968862483e-01   +9.100623969231935e-01   +4.379514469049017e-02   +2.702651909409380e-01   +1.317937715898269e-01];
L3E_L3I_iGABA_netcon = [+1.094047393804796e-01   +5.310592249416448e-01   +9.208172124781097e-02   +3.978464914558509e-01   +3.813164351755769e-01   -7.985983139017726e-02   -9.201954124832556e-02   +7.501760872327010e-02   +7.789053436701768e-02   +4.053631425471267e-01   +3.728701771870875e-01   +5.081732620589775e-02; +3.111170517923899e-01   +2.824239066159412e-01   +5.589968366024800e-02   -1.132918704353869e-01   +3.095049449950965e-01   +1.738455450514007e-01   +9.846976630183661e-02   +2.796582683117053e-01   -1.293057670757941e-01   +6.613887633735899e-02   +6.840151430810529e-02   -7.461062583331761e-03; +3.680637448508191e-01   +1.137775986599134e-01   -5.329646724587691e-02   +1.382870514013880e-01   +3.545198114512448e-01   +4.257683742745675e-01   +2.023815495051515e-01   +3.394253858039572e-01   -2.541340111508601e-01   +3.342650834302123e-01   -1.441567567727274e-01   -1.337344758861280e-01; +1.423799613137282e-01   +2.806259241089128e-01   -5.002670939162078e-02   +6.013269772939331e-02   +5.651298621010683e-01   +7.614661230550621e-02   -3.080974827950365e-01   +9.613194767978703e-02   +6.448495552411245e-01   +4.718125230376757e-01   +3.321574859321506e-01   +2.713264271612380e-01; +3.456612966928554e-01   +1.364169985480199e-01   +1.970637893180296e-01   +5.897892977997007e-01   +1.688666060862708e-01   +2.730600625244204e-01   -3.200309598548705e-01   +4.333612201025058e-01   +2.750556721333512e-01   +5.862828639668415e-01   +3.072933641492533e-01   +3.803261740258922e-01; +3.299474930049205e-01   +8.958444989798359e-02   -1.107328941502769e-01   -1.002821475166577e-01   +4.369558283364215e-01   +4.222677683891495e-01   +1.262895074369601e-01   +3.042300221782462e-01   +3.576983612189648e-01   +4.453876448100990e-01   +3.417009509960026e-01   +3.228960527248534e-02; +3.069623180353704e-02   +3.207531011270093e-01   +5.610203620606499e-01   +9.905264448158544e-01   +2.276550600478447e-01   +2.113809861930411e-01   +5.456887552816854e-01   +5.807581947208262e-01   +2.158879291136831e-01   +4.208808946479903e-01   +5.664371248286961e-01   +9.741888517732694e-03; +2.216141136731770e-01   +1.512987706020561e-01   +3.237786540890845e-01   +2.816285207498369e-01   +2.448502477855800e-01   +1.836392029618709e-01   +3.613798191676650e-01   +2.724367992245088e-01   +2.032889318961435e-01   +3.066140234927225e-01   +4.178046904279238e-01   +1.946163239796260e-01; +1.012679467085698e-01   +3.172249685862415e-01   +8.042607060356609e-03   -6.061567751824782e-02   +1.488251946462997e-01   +1.117365714614123e-01   -1.735546041161252e-01   +2.616647358105975e-01   +6.411173161207202e-01   +5.928869307610964e-01   +4.927305254051274e-01   +3.109114566349091e-01; -1.286638465779431e-01   +1.278102446610815e-01   +4.199050534747282e-01   +7.347267135089090e-02   -1.356845395684793e-01   +9.058104237798456e-02   +2.909384484327629e-01   +5.545165953771582e-02   +3.008633369582139e-01   -7.558064825699279e-02   +3.271135124799659e-01   +3.052466664837957e-01; -6.789157316794051e-02   +2.297471886508719e-01   +2.164681681704274e-01   -2.207293006992543e-01   +3.631748401743566e-01   +2.526131132936593e-03   +3.625614132211661e-01   +2.188762850680471e-01   +1.116708127869689e-01   +3.037196196089271e-01   +1.944740347217876e-01   +1.226005078019168e-01; +3.109731617734776e-01   +3.209375420706011e-01   -1.613267160211253e-01   +3.644220881951867e-01   +8.065857717848608e-01   +6.511342514094495e-01   +5.931715545771253e-01   +2.880413987290246e-01   +8.099938421759782e-02   -4.019581538177260e-02   +9.439614649092835e-02   -1.184067467339138e-01];
L2E_Input1_iAMPA_netcon = [+4.752797921904245e-01   +6.222780392094893e-01   +9.376245266009814e-01   +8.802082940741274e-01   +6.735011253200386e-01   +7.483373528442576e-01   +5.302141098024119e-01   +9.651444855877955e-01];
L2I_Input2_iAMPA_netcon = [+6.313305588879838e-01   +5.672102964150549e-01   +7.141073320255991e-01   +6.399835593752271e-01   +1.429985330205079e-01   +9.885620138946731e-01   +3.987169730224427e-01   +2.783122786620368e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
