function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.183195153174135e-01   +1.892882054480299e-01   +2.761000610815769e-01   +5.234679631311950e-01   +1.556609811032191e-01   +1.113568249875479e-01   +4.728377094356186e-01   +1.028948142137523e-01   +2.474178969255238e-01   +2.278746421690740e-01   +5.010393713974072e-02   +9.026649362176463e-02   +2.580420520856328e-01   +4.685780925223351e-01   +4.845889252458430e-01   +5.902950958164543e-01; +5.040174172491516e-01   +5.381903193555988e-01   +3.961990016530051e-01   +7.436289217330631e-02   +1.011759508009813e-01   +1.992937423241452e-01   +1.397282882716000e-01   +2.344059085953524e-01   +4.895749974504001e-01   +4.405837124996035e-01   +6.134401170673818e-01   +4.167473263314358e-01   +6.080276624714099e-01   +2.477862559258867e-01   +4.314037843664963e-01   +1.877258877302344e-02; +6.466860071454544e-01   +4.857891302223019e-01   +6.063345114779622e-01   +5.749895555723608e-01   +6.222082133887959e-01   +5.538424102268632e-01   +3.368383323459065e-03   +7.713022844466189e-02   +2.880337398608088e-02   +6.516634957118499e-01   +3.370773097999984e-01   +1.956855248923867e-01   +5.079215954508477e-02   +3.044378853447681e-01   +2.215483050983910e-01   +4.554005059140449e-01; +4.744877851451609e-02   +6.560454087194540e-01   +2.425895625084076e-01   +6.537912950365965e-02   +8.715949157791673e-02   +1.143371118595675e-01   +2.503798104505501e-01   +2.964851893453031e-01   +4.778498946241939e-02   +4.240945291234482e-01   +1.728711529944866e-01   +3.366606334465022e-01   +3.331466215846971e-01   +5.417862569006677e-01   +6.176900846719786e-01   +2.356823229177176e-02; +6.102998871911498e-01   +1.705149697387011e-01   +5.129525028639643e-01   +6.127370780768114e-01   +2.485334675640425e-01   +1.006354762989298e-01   +5.618412339204397e-01   +3.752964596629657e-01   +5.219837786335656e-02   +1.092452229472064e-01   +6.567758854510547e-01   +4.564863386916339e-01   +5.563806585455618e-01   +4.865998650110381e-01   +2.384645856508578e-01   +5.448810414989125e-01; +3.509656917396870e-01   +3.653180266272803e-01   +3.821154395611958e-01   +9.597282650796839e-02   +3.481995627016759e-01   +3.032473743850644e-01   +1.752791583057536e-01   +2.357440104888816e-01   +3.646937940335751e-01   +3.732276720833102e-01   +3.722943532621377e-01   +7.196678979712454e-02   +2.071022523563522e-01   +6.086260506168557e-01   +3.451121196492666e-01   +5.977374454794855e-01; +5.518517038522206e-01   +3.816901583434191e-01   +5.606699363028755e-01   +3.322274248918910e-01   +5.994102620477435e-01   +2.874589340579061e-01   +2.244807476045435e-01   +2.221295407740743e-01   +4.523775310649809e-01   +4.177265984042549e-01   +3.988383972583847e-01   +6.999611512019080e-02   +6.234770136836831e-02   +6.222813818621529e-01   +3.859542595050734e-01   +5.037642217749568e-01; +9.221817897299950e-03   +6.246585756932754e-01   +2.557015666028147e-01   +5.499899163949535e-01   +2.679447194895169e-01   +4.556834804385011e-02   +3.199942760170770e-02   +1.241499096751361e-02   +5.942882802176581e-02   +3.831650667922702e-01   +6.075147315289311e-01   +5.128899185206617e-01   +1.957243663526582e-01   +1.628994853410633e-01   +4.620346710416143e-01   +1.965069544080212e-01; +3.939166799617713e-01   +1.162685518677165e-02   +5.621168616490491e-02   +1.608648783655999e-01   +1.137377108161648e-01   +4.060201458184264e-01   +4.482659921810338e-01   +2.381860874907835e-01   +3.879037068680211e-01   +3.767061111006881e-01   +2.070388657996229e-01   +4.745295378391275e-01   +1.768129394003611e-01   +1.607712447603014e-01   +5.997863849380924e-01   +2.707859999801726e-01; +5.594299976005699e-01   +1.465351249799976e-01   +5.722578311119502e-01   +1.331742638904595e-01   +1.059778559598516e-01   +1.259922584892340e-01   +1.872949747823567e-01   +3.924609765688616e-02   +1.917354596859921e-02   +1.360466178334078e-01   +5.386309504607900e-01   +6.427385553608285e-01   +8.188519599948402e-02   +2.286591429654535e-01   +5.700503608079809e-01   +6.485446677926191e-01; +2.220419551527137e-01   +6.382560587117060e-01   +4.061516694061899e-01   +4.482023062449532e-01   +9.713736780112303e-02   +3.115797679046570e-01   +5.236478838103306e-01   +2.816214090308244e-01   +3.186431559751280e-01   +2.122755423951563e-01   +1.269910385663555e-01   +3.490421898324962e-02   +6.135321015808488e-01   +1.758859485224221e-01   +5.841739607127014e-01   +4.391911209069585e-01; +5.853708756529306e-01   +1.779761046894617e-01   +6.215886760124167e-01   +5.078380132338812e-01   +1.752089469577133e-01   +1.795520851504625e-02   +4.127642863241773e-01   +3.122162446464364e-01   +6.067044310361259e-01   +4.878579722018147e-01   +3.554523858748886e-02   +1.044716210118447e-01   +5.258483189774860e-01   +3.404562585480327e-01   +5.562666770170178e-01   +1.924784183901906e-01; +1.195977195452765e-02   +5.169156979823455e-01   +4.518084585560204e-01   +7.361887532253134e-02   +2.108448198962396e-01   +4.021967057043591e-01   +1.106861289241740e-01   +4.812494645952011e-01   +4.063546844979230e-01   +2.419263513572755e-01   +1.754779642356855e-01   +5.320477304151544e-01   +6.281853449971206e-01   +6.161733868642029e-01   +1.050859008436110e-01   +2.527014361270601e-01; +7.471970375386099e-02   +5.512919821071913e-01   +6.150985264017990e-01   +6.166441385952658e-01   +1.688257345818890e-01   +1.687054316994049e-02   +2.362895817643951e-01   +1.933983176865101e-01   +4.766689002646624e-01   +5.636846464023035e-01   +3.290636072146884e-01   +5.676142807399313e-01   +5.745560696163411e-01   +8.928741655214979e-02   +4.791992933874750e-01   +4.414427727480718e-01; +2.486215423905347e-01   +2.463304531974659e-01   +5.445682115323937e-01   +1.025474731886069e-01   +3.983990689907763e-01   +3.249202245106327e-01   +2.072586944642215e-01   +2.980397019827585e-01   +6.379551955769544e-02   +8.647003336394019e-03   +1.298806575952805e-01   +6.477458198567078e-01   +5.412868340762397e-01   +4.126119060094553e-01   +5.162730635168962e-01   +4.794081070395997e-01; +2.291512019813389e-01   +6.277153448479608e-01   +3.186345989028551e-01   +4.837576444798867e-01   +6.515094553373612e-01   +4.814448816333977e-02   +3.147588607822867e-01   +3.029213167150526e-01   +4.417044630365670e-01   +6.468138945855380e-01   +5.718996338319444e-01   +2.395304584460989e-01   +5.110430118644084e-01   +1.099947976275702e-01   +1.639628960541346e-01   +6.207359417037820e-01];
L1E_L1I_iGABA_netcon = [+3.767693278568739e-01   +4.024974917921129e-01   +2.124229945197989e-01   +5.479995556961740e-01   +2.108394180348562e-01   +5.909975058027038e-01   +3.831682715273687e-03   +1.098756892114915e-01   +2.481372904263800e-01   +6.219313392550785e-01   +2.383854176983392e-01   +3.858722468428736e-02   +9.613530040545534e-02   +4.254007086294341e-01   +5.169285855940492e-01   +3.067334394789134e-01; +2.136815150095869e-01   +1.026724183539274e-02   +4.344880804071002e-01   +6.002764998412329e-01   +6.432595878482495e-01   +3.690622243099261e-01   +9.003967971746789e-02   +6.505630068134652e-01   +3.738326936120852e-01   +5.600189588759902e-01   +1.305669208059756e-01   +5.990633053407932e-01   +1.346794685256435e-01   +6.291067479370389e-01   +3.906271482304171e-01   +5.236501534930190e-01; +6.077884436535771e-01   +5.069032648983582e-01   +1.312874290220680e-01   +6.194086718686495e-01   +6.462449650833325e-01   +3.399332140559417e-01   +6.197371528968200e-01   +3.341879228728558e-01   +2.254020750311882e-01   +1.065351655267490e-01   +8.680778899944158e-02   +2.786855718176148e-01   +1.507041918921588e-01   +5.785071844170603e-01   +2.094571908592981e-01   +2.069636564833181e-01; +1.848196732223849e-01   +1.910251205802204e-01   +6.440319363869671e-01   +2.607021611095105e-01   +4.168438209520678e-01   +5.367054962959301e-01   +8.045563267232279e-02   +5.097822364373463e-01   +6.266424765966216e-01   +4.809340416764146e-01   +6.077668581968236e-01   +2.264048955942848e-02   +2.708643688340415e-01   +4.513235147696195e-01   +4.420073136020897e-01   +4.858307560048643e-01; +5.673997126054695e-01   +7.713238830645014e-02   +2.954683435348329e-02   +1.039707616522320e-01   +6.481027006647355e-02   +1.528755562259697e-01   +3.559680874879370e-01   +3.909649718693662e-01   +2.137769012106988e-01   +2.334656911629517e-01   +3.386308205431113e-01   +1.097951540501645e-01   +2.668435881607161e-01   +2.873682146182064e-01   +2.713467349162944e-01   +2.652672075801171e-02; +5.836857223105660e-01   +1.365749453745108e-02   +9.329174818642912e-02   +3.331533560515825e-01   +5.040212797698876e-02   +2.002860577364609e-01   +4.588332162566429e-01   +6.301133269761217e-01   +3.162637037769420e-01   +3.494296944095545e-01   +4.559177307673994e-01   +4.290574173590327e-02   +2.256418024643969e-01   +2.713890047074324e-01   +9.225593568081229e-02   +1.008018941294737e-01; +6.475307981902723e-01   +2.644965704834585e-01   +5.831780183523303e-01   +2.868633369751326e-01   +5.620063388813030e-01   +1.133792084748307e-01   +5.625530345288254e-01   +2.768591282269668e-01   +3.064019010486979e-01   +3.498555943038056e-01   +2.260007070682573e-01   +5.753298050946105e-01   +7.714643610939220e-02   +4.040014210622736e-01   +5.322090053013401e-01   +8.857938353820139e-03; +6.211161497343787e-01   +1.092212263783962e-01   +1.015145870314118e-01   +3.846984251233365e-01   +5.611650324761925e-01   +1.022624614969556e-01   +1.191141029602657e-01   +9.852569523498711e-02   +8.236559031871604e-02   +1.909075423870283e-01   +1.336605076474991e-01   +2.107508357319542e-01   +5.236977021635186e-01   +7.845803117111270e-02   +3.059629037291375e-01   +1.279587497160300e-01; +5.040797123455707e-01   +3.564813373114308e-01   +5.511402050447084e-01   +1.193580332352431e-01   +4.859527993173937e-01   +5.003774409551756e-01   +6.551329815873167e-01   +8.460283797590511e-02   +5.909011759134666e-01   +2.249134072771374e-01   +4.349596075314020e-01   +3.981916402113286e-01   +5.444552159653712e-02   +2.279570679839575e-01   +5.391909799996899e-01   +1.966725555164262e-01; +4.095837326561690e-01   +5.915767128203384e-01   +2.778742592539166e-01   +3.300640730558552e-02   +6.308406605643375e-01   +2.349209387138866e-01   +3.463145460817668e-01   +3.758562789164584e-01   +4.802423481082948e-02   +5.319790054908916e-01   +1.358024992621182e-01   +2.053174953031227e-01   +2.896592437857336e-01   +3.923713534425992e-01   +6.715221799234324e-02   +4.353161131034736e-01; +5.548882398216423e-01   +5.046580207811695e-01   +3.126684937151858e-01   +3.702076482229720e-01   +2.311221069008212e-01   +1.707008998038790e-01   +3.040205693130067e-01   +6.042641716464197e-03   +2.009703549298632e-01   +2.926501081549762e-01   +2.592627580642907e-01   +4.825897302412904e-01   +4.360756683155244e-01   +1.323978451899117e-01   +2.945646050804431e-01   +6.081107938671169e-01; +2.449528779028141e-01   +2.809568725206110e-01   +3.943050495027154e-01   +4.936737826083878e-01   +4.279393890306644e-01   +1.905606896479611e-01   +1.660345669686908e-01   +4.594760778701428e-01   +3.317331448488187e-01   +4.965292810956927e-01   +5.300971957931622e-01   +2.077765798639834e-03   +5.242823547227561e-02   +3.105389614196128e-01   +5.407505008941025e-01   +2.892317086642526e-01; +4.866499300101978e-01   +1.385067533943175e-01   +3.963719564430673e-01   +5.618137066793247e-01   +4.731027519345926e-01   +3.637868631185151e-01   +2.640753094015056e-01   +3.453360404527375e-01   +2.600243332283630e-01   +2.453400278223399e-01   +1.700702136450155e-01   +1.810764444903867e-01   +5.375752312455087e-01   +6.517588730222370e-01   +2.463795188431414e-01   +3.399491825843932e-01; +2.689816685078388e-01   +1.085319414913758e-01   +3.161053834725759e-01   +2.420034900097083e-01   +2.527343744140879e-01   +4.568232028276074e-01   +5.463537898230218e-02   +6.147959287005955e-01   +6.338476308815960e-01   +5.130921081647797e-01   +6.776154953450257e-03   +2.859352944570423e-01   +8.953907530833261e-02   +1.628420576373520e-01   +1.336898140171548e-01   +5.801495920700377e-01; +4.121188760657958e-01   -1.777831908647155e-03   +2.634182157881406e-01   +7.680269009991186e-02   +1.291324696910803e-01   +5.323815916804866e-02   +5.713218969527020e-01   +3.209633819394298e-01   +6.208418360123086e-01   +4.278805750881708e-01   +2.718048772997841e-01   +5.737314353558998e-01   +2.510851396475616e-01   +6.292091192067958e-01   +6.174235213402453e-01   +4.927288956902205e-01; +2.200355936765150e-01   +1.057499396382665e-01   +1.062644267734894e-01   +3.430565718934379e-01   +4.450567759902455e-01   +6.175051372213965e-01   +2.588466701443432e-01   +5.140759693352842e-02   +6.484721390712934e-01   +1.819657523661137e-01   +3.841812042281224e-01   +4.152006498903909e-01   +7.284726053933130e-02   +6.040991060384249e-02   +8.367676117185978e-02   +1.670218519819636e-01];
L2I_L1I_iGABA_netcon = [+3.026481013183404e-01   +6.353942826921692e-01   +3.993825037247542e-02   +3.972403843327577e-01   +6.123131352464988e-01   +2.101890936966636e-01   +2.518342474171965e-01   +4.622343366500236e-02; +1.240430656129198e-01   +1.381195893698650e-02   +4.236465212679126e-01   +5.192519571225369e-01   +2.018399494987014e-01   +3.838922500046611e-01   +2.480196442011360e-01   +1.796878647500441e-01; +4.849464050851807e-01   +1.512995897208540e-01   +1.549168141068462e-01   +4.579042951347048e-01   +1.516982955569744e-01   +4.124568948529622e-01   +3.785596109230671e-01   +4.580183368569400e-01; +2.920298974865623e-01   +4.725297851864433e-01   +4.320688295097862e-01   +2.152164016726816e-01   +5.782370031821575e-01   +4.025230444644673e-01   +7.968557788953384e-02   +4.893823604273765e-01; +3.153915094225568e-01   +1.423171812120205e-01   +2.904502730184660e-02   +1.545463539262749e-01   +9.427045444760401e-02   +5.490489501939135e-01   +4.931346450945145e-01   +1.531729898596953e-01; +6.249543045187677e-01   +2.185529348632775e-01   +4.246438073175205e-01   +2.173868235846807e-01   +5.143157359678534e-01   +5.059716364130740e-01   +7.961378552163678e-02   +1.190305680988595e-01; +2.579115269837196e-01   +5.664270102419082e-01   +4.698488937689793e-01   +5.618230767527387e-01   +4.247847664337357e-01   +2.039910445414257e-02   +6.388590802649677e-01   +1.086750770547770e-01; +6.460233109068146e-01   +2.719073841864662e-01   +3.061937162071413e-02   +3.564926808288248e-01   +3.466385129538286e-01   +1.690100596835919e-01   +5.363760006300873e-01   +9.527478841209518e-02; +3.754520916200524e-01   +1.631810925993482e-01   +1.884381883834159e-02   +7.105656157589316e-02   +1.367266288746703e-01   +3.770385217097344e-02   +5.175075631250231e-01   +1.605324292189606e-01; +1.846196803959839e-01   +2.836174240079653e-01   +2.745176222724866e-01   +8.599834163961126e-02   +5.527186830274865e-01   +4.461893434621084e-01   +9.256667447503462e-02   +1.813941616034279e-01; +1.916346428994797e-01   +5.048664146886913e-01   +9.143144036134299e-02   +4.519565297077164e-02   +2.875679559447355e-01   +1.850373434449562e-01   +1.472510858995993e-02   +6.565324186766945e-01; +6.311437274491708e-01   +2.379240584437458e-01   +2.073885214100475e-01   +6.296463290231171e-01   +5.356746766819603e-01   +1.372019192582153e-01   +2.237162487389613e-01   +9.877180719538169e-02; +6.546435306574876e-02   +3.340145989029510e-01   +5.147997466028762e-01   +4.065364879677619e-01   +4.329250666825124e-01   +4.375272322073957e-02   +1.911663346568145e-01   +6.479945988091166e-01; +2.195648349934340e-01   +2.244283121577570e-01   +8.546291943759107e-02   +1.430613727280519e-01   +6.342929961340543e-01   +7.773788607809222e-02   +3.276927668508926e-02   +3.639680568239387e-01; +5.096635417555420e-01   +4.835550940899703e-01   +6.206260579582097e-01   +5.027828919558079e-01   +7.751032845083107e-02   +8.081451582134168e-02   +1.265608271996270e-01   +1.345180382245990e-01; +4.717402205367300e-01   +5.994656122824435e-01   +4.682606645351822e-02   +1.230703703415826e-02   +1.413780960839955e-01   +5.212972768724964e-01   +2.225700083642776e-02   +4.192582131143068e-01];
L1I_L2I_iGABA_netcon = [+2.292217708536112e-01   +4.155987838066132e-01   +5.768498341437630e-01   +1.368251857270038e-01   +2.261615106514697e-01   +4.805283305321044e-01   +6.177785109483988e-02   +9.259225096874571e-02   +9.672139548541980e-02   +4.809102972344441e-01   +2.453401654754953e-01   +3.482545221813820e-01   +5.106060761777627e-01   +5.362119661866545e-01   +5.130895596733773e-02   +3.026498826869989e-01; +2.142083188085393e-01   +2.273558900683542e-01   +1.521540001314239e-01   +2.594545847290579e-01   +5.650782826264955e-01   +1.180385852166162e-01   +3.895978200011692e-01   +1.435449430134731e-01   +3.249575113196722e-01   +1.071314571305574e-01   +6.172233197000213e-01   +4.409682686388741e-01   +6.499562766955577e-02   +1.432310260326046e-01   +4.339840459809338e-01   +4.010149687306743e-01; +3.441767352046275e-01   +2.016760008876664e-02   +1.135928746806855e-01   +6.280782023148107e-02   +2.378919353016293e-02   +1.196337623338663e-01   +5.233407237953879e-01   +2.067002746943734e-01   +4.029265644275601e-01   +3.391732996497344e-01   +4.470672049350981e-01   +2.685134023365542e-01   +4.562034732872294e-01   +3.974803970143658e-01   +2.913055906157614e-01   +3.348031625253667e-01; +3.751313474658860e-01   +6.541421956660581e-02   +2.686989308634546e-01   +6.417929765647484e-02   +3.764743954522910e-01   +4.720992210472808e-01   +4.194345668569942e-01   +2.306238902007881e-01   +3.932943294147580e-02   +5.016618738187683e-01   +7.071475502633558e-02   +5.164242091461129e-01   +3.229078118248428e-01   +4.105730178899957e-01   +1.061544641365641e-01   +6.306381757014419e-01; +7.237516357356369e-02   +5.639832342651463e-01   +6.304924989168936e-02   +3.991138880662300e-01   +2.255018886747938e-01   +2.937005581613396e-01   +3.521944472150759e-01   +4.292045352382605e-01   +3.499421333665332e-01   +4.609189058244275e-01   +2.945990020393756e-01   +4.123136463514966e-01   +1.654963346262639e-01   +5.142822011372977e-01   +6.117677749551780e-01   +1.839378362728182e-01; +9.783767614418258e-02   +3.567611649348607e-01   +6.027556456528005e-01   +5.258984891188925e-01   +4.628154792776817e-01   +5.827962646365350e-02   +2.818058077939443e-01   +8.407504883801416e-02   +1.283200178885147e-01   +2.301938515214802e-01   +1.434463446176923e-01   +3.044077836269312e-02   +5.977153177887543e-01   +3.495872069280128e-01   +5.575696931795712e-01   +2.443001554653461e-01; +3.944151505846264e-01   +2.261768605440045e-01   +9.446906333779193e-02   +5.038370198693900e-01   +8.468705344773800e-02   +4.262580021337619e-01   +2.067315405868293e-01   +4.433155726835606e-01   +3.045316844098568e-01   +5.830814089379199e-01   +5.297737238226579e-01   +2.398240267014257e-01   +4.118681434585641e-01   +3.874369655096120e-01   +4.197234050492578e-01   +1.757976382333982e-01; +3.212998181514314e-01   +6.196583454991899e-01   +1.460971824968595e-01   +6.045757173991253e-02   +4.226922217601237e-01   +4.690356508979680e-02   +3.899931958578378e-01   +1.694332285494995e-01   +3.807640328687154e-01   +1.579870589420400e-01   +5.788052946349666e-02   +3.379776429942872e-01   +5.283425087029396e-01   +1.910843231997008e-01   +5.068927954026112e-01   +2.489910515487937e-01];
L2E_L1E_iAMPA_netcon = [+5.934671167747233e-01   +5.575733659474768e-01   +5.041732502960062e-01   +6.301801893929955e-01   +5.370845470261830e-01   +4.753238995512864e-01   +4.031113881754936e-02   +6.471397124277728e-01; +3.217083786582360e-01   +8.587078005812802e-02   +1.631348306433696e-01   +1.369982584634069e-01   +2.510364601395512e-01   +2.590837608798073e-01   +9.512221468085534e-02   +2.007200465541543e-01; +1.015444010040065e-01   +4.102323756738506e-02   +3.581928776404903e-01   +3.290571602306683e-02   +4.646718400649147e-01   +3.900219894299612e-01   +5.264436714747418e-01   +6.520133953312636e-01; +4.744487365568661e-01   +3.418688632625505e-01   +6.493332687376137e-01   +6.255810120715676e-01   +5.742064835633749e-01   +3.755272093853766e-01   +2.499847443097039e-01   +7.843654909772440e-03; +5.237099393315315e-01   +3.775203796149273e-01   +3.404029430244429e-01   +4.354664592155180e-01   +3.040993583661453e-01   +5.994659760416173e-01   +5.480034092409198e-01   +2.315074554147087e-01; +3.829704696023034e-01   +6.521965516093327e-01   +5.415161142088788e-01   +1.619926824577675e-01   +2.595927832792060e-01   +2.862314564124984e-01   +1.960408323324622e-01   +5.621714323681299e-01; +1.789610938721890e-01   +4.799222011226668e-01   +5.579499988438699e-01   +1.721340009085792e-01   +5.730157030267663e-01   +3.268686654226631e-01   +1.632625222496655e-01   +1.794837297402067e-01; +4.017778547228488e-01   +5.796713364759621e-01   +5.244832639901648e-01   +6.485872743797718e-01   +3.313814897985334e-01   +2.629692046098246e-01   +6.079312092846950e-01   +1.930896774582209e-01; +3.459154193580464e-01   +3.491025788825011e-02   +2.157585498010566e-01   +2.619904196417731e-01   +2.854334255105159e-01   +2.683630076861702e-01   +5.136088517621840e-01   +1.019214262543145e-01; +6.025085132624847e-01   +4.277285444022083e-02   +3.127517441114559e-02   +5.409550103763342e-01   +5.294855550187157e-01   +5.164912338794908e-01   +4.007206479779682e-01   +2.041922743218458e-01; +4.835624749492370e-01   +5.741936568059659e-01   +1.356017828607500e-01   +3.591937981241009e-01   +2.464383873659707e-01   +2.757132605137211e-01   +3.855822039316861e-01   +5.003240467586954e-02; +3.747449532497258e-01   +5.081334436280546e-01   +6.470744834136315e-01   +4.605646026859130e-01   +3.424856592188454e-01   +5.069548054915340e-01   +2.825497359728814e-01   +5.434193471126928e-01; +7.620651542835194e-02   +6.309047395252472e-01   +1.204470353138934e-01   +4.115619837579117e-02   +3.770472120865364e-01   +5.882753540596246e-01   +1.853312620402840e-01   +4.296975890473339e-01; +6.428392978028226e-01   +4.909230316481354e-01   +3.794086026500688e-01   +2.654785494620537e-01   +5.833372247089059e-01   +4.995551218557869e-01   +3.257963583414880e-01   +3.817237681289232e-01; +2.306032617854251e-01   +4.635793925778973e-01   +3.843490453310743e-01   +4.908978506124921e-01   +2.986727926513215e-01   +4.661733757127450e-01   +4.389112056608728e-02   +1.709835112644668e-01; +3.428750113405195e-01   +2.434996713345361e-01   +1.808350440625471e-01   +2.718505363142121e-01   +4.169100287536239e-02   +4.388152883023310e-01   +3.050088727177515e-01   +1.066187722601964e-01];
L1E_L2E_iAMPA_netcon = [+2.576605850688767e-01   +4.090332203049211e-01   +4.968054721359224e-01   +5.936183092250450e-01   +5.358716135541299e-01   +6.176145391664273e-01   +4.102722965175875e-01   +5.216542253322395e-01   +3.315413014755903e-01   +3.259683475210019e-02   +1.971079850918997e-01   +4.712432973862218e-01   +3.126589200318177e-01   +1.057545128688045e-01   +9.982549872902180e-02   +1.999459265925871e-01; +3.523057920695667e-01   +3.074382589225872e-01   +3.988809323246694e-01   +2.656519730763948e-01   +6.442775791185363e-01   +1.721787226283197e-01   +2.797353066952264e-01   +3.563514133787269e-01   +3.981188522753950e-01   +5.279875361496353e-01   +6.397711940816022e-01   +1.746975693572725e-01   +1.246149174845971e-01   +1.184369147507979e-01   +4.779867275608659e-01   +1.150481188983920e-01; +3.895184835794243e-01   +5.974220550452769e-01   +2.119524875798724e-01   +5.686550391855777e-01   +9.949434517323134e-02   +3.529029913101420e-01   +3.299784707161593e-01   +3.496155667970237e-01   +6.342342632389978e-01   +4.762757590854826e-01   +3.957488650656927e-01   +5.764473086848519e-01   +3.468696677479108e-01   +4.355806195374310e-01   +3.647193562014771e-01   +5.611505000085768e-01; +1.703774025390277e-01   +3.865542623539361e-01   +4.117615668435449e-01   +9.340791942128632e-02   +2.857328139505614e-01   +6.939615272140436e-02   +4.753755835687599e-02   +8.085720154688392e-02   +3.813286433448591e-01   +4.162227323019221e-01   +3.375026298360859e-01   +3.019896828957089e-01   +2.401728729784638e-01   +7.033876312683221e-02   +6.260798672445057e-01   +4.466385233528624e-01; +1.827700625602940e-01   +3.400902703694424e-01   +4.559112529454448e-01   +5.135088109213636e-01   +6.265875992667810e-02   +1.544714289458880e-01   +2.380981306204677e-02   +1.071644879133477e-01   +5.522929615248636e-01   +3.419711455896926e-02   +2.477849969532367e-02   +1.325564195448204e-01   +2.921480411412071e-01   +6.351983752686167e-01   +3.581076919627840e-01   +6.461529634559956e-01; +1.445276885444863e-01   +2.675537964317467e-01   +3.877176993048074e-01   +4.527090565839462e-01   +2.066429327231701e-01   +1.986205965373911e-01   +1.657255616956492e-01   +6.495270674874332e-01   +5.063996118186465e-01   +3.276039512147987e-01   +6.133634746147961e-01   +4.628940971402127e-01   +2.654184035351526e-01   +2.122337649367169e-01   +1.887304833589990e-01   +1.694874137662333e-01; +5.658424872758204e-01   +1.749561186939018e-02   +5.799179177479268e-01   +3.084070229559281e-01   +4.193975173219767e-02   +6.082322311369834e-01   +2.696195199210976e-01   +3.107438979325761e-02   +5.599725823162212e-01   +3.395138665182698e-01   +3.393468852118251e-01   +1.205701824834256e-01   +4.799855497610622e-01   +4.199273466591519e-01   +1.807620730818842e-01   +6.398201352932938e-01; +5.769443077106421e-01   +2.669127787081232e-01   +5.474207304460753e-01   +2.472903775437727e-01   +1.658768070612378e-01   +2.892669931091487e-01   +5.246491849707472e-01   +4.719827569109956e-01   +3.411674375779098e-01   +2.235705870135962e-01   +1.593547007181833e-01   +3.416063355784303e-01   +3.519157382291813e-01   +2.206583932183391e-02   +2.266894521399473e-01   +1.123709309494410e-01];
L2I_L2E_iAMPA_netcon = [+4.801438307756256e-02   +7.837890632826132e-02   +4.366663281210817e-02   +1.155082442608497e-02   +3.794171190323683e-01   +5.900341628639023e-01   +5.993070268249865e-01   +6.481609353007057e-01; +5.227432154812071e-01   +2.851634109617531e-01   +2.756985503593867e-01   +3.963359507955997e-01   +3.910382764576765e-01   +3.689036132631758e-01   +2.810615565892641e-01   +3.424974028697751e-01; +7.594200338061113e-02   +3.686065183679855e-01   +8.060305299925011e-02   +4.249084688267922e-01   +1.731994982344159e-01   +4.177611099694837e-01   +4.735615317440152e-01   +7.591750275868960e-02; +2.427705048970525e-02   +4.103094615206119e-01   +5.864396031300924e-01   +5.673971590544791e-01   +3.387334845817196e-01   +4.560727837734752e-01   +3.601261584314577e-01   +2.406696575890046e-01; +5.467956825104940e-01   +3.998257289688980e-01   +3.213136731203050e-01   +5.066911810814830e-01   +5.592015693577186e-01   +5.021408154999772e-01   +3.061547569448855e-01   +4.373757409885397e-01; +4.563704726591295e-01   +1.596512136412921e-01   +4.110796565610274e-01   +7.402102841449014e-02   +1.848330256162949e-01   +4.879867650102626e-01   +5.854543507710952e-01   +1.981598664888576e-01; +5.224567387274499e-01   +5.510896007072694e-01   +3.947103487555478e-01   +5.973110680462121e-01   +3.373221580035305e-02   +6.705278617048871e-02   +6.218273418401101e-01   +6.232784419311868e-01; +3.269252143705668e-02   +1.850593107992067e-01   +5.763319397795071e-01   +4.090154288956298e-01   +2.511868759041654e-01   +3.452357803107870e-01   +1.910464819310064e-01   +1.150458424675444e-01];
L2E_L2I_iGABA_netcon = [+4.721805066829843e-01   +4.152405128988504e-01   +5.212224556020861e-01   +1.436821000408629e-01   +1.779707623114326e-01   +2.954063744822509e-02   +4.170284232457233e-01   +1.066106376295395e-01; +4.421153727019232e-01   +3.187757610860610e-01   +3.606225369577426e-01   +3.029775987552588e-01   +4.513575733602634e-01   +6.887737152365765e-02   +5.969531301232388e-02   +1.702844581104065e-02; +1.980623411546305e-01   +2.298256388644387e-01   +1.015272742332525e-01   +2.764731270317382e-01   +6.385305636356734e-01   +5.120249733315011e-02   +5.879488122158083e-01   +2.864741595911612e-01; +6.556190862854174e-01   +8.560608621398939e-02   +3.961450850430612e-01   +5.215795315537324e-02   +5.714051664560655e-01   +2.175785985063183e-01   +5.641500517844115e-01   +3.105245668014615e-01; +5.518279765091936e-01   +2.876805939498524e-02   +2.037573367364281e-02   +1.137629478114993e-01   +2.150465310144499e-01   +4.755195273103659e-01   +4.492649321324984e-01   +3.758833506520306e-01; +2.051344399273922e-01   +1.170334657832454e-01   +2.496000638071194e-01   +1.052109831469598e-01   +5.060643530163562e-02   +8.930728953392362e-03   +5.043084574293655e-03   +1.623149784096516e-01; +1.719585524487195e-01   +5.623121691920452e-01   +5.448394914423496e-01   +2.596810346594378e-01   +5.724899630485992e-01   +3.055857075051164e-01   +2.784429994478176e-01   +3.455014341536430e-01; +8.376137908505869e-02   +4.670929767363273e-01   +3.385180871819972e-01   +4.156245691238736e-01   +1.351190727384179e-01   +1.494129546850221e-01   +8.967619229052175e-02   +2.020457220996665e-01];
L3E_L2E_iAMPA_netcon = [+3.108437601975840e-01   +3.528773230001354e-01   +5.495824962516429e-01   +3.094563048151141e-01   +2.994141803641453e-01   +4.164652211464558e-01   +1.071868011840547e-02   +3.087857006747367e-01   +4.155023038839075e-01   +6.032549077288868e-01   +2.815300588966920e-01   +5.809435298470338e-01; +4.808037936748820e-01   +3.900174366748846e-01   +1.620424880855751e-01   +2.315804883226749e-01   +2.937188847832207e-02   +7.832528143660139e-02   +1.414099090992624e-01   +7.877316728729607e-02   +1.700300498905462e-01   +5.781378809225635e-01   +5.274505286945461e-02   +1.166432412609719e-02; +5.081152251102462e-01   +5.340446376513561e-01   +6.420148731653421e-01   +5.781779015529457e-01   +2.063576444284106e-01   +1.164015914943033e-01   +4.181656881431677e-02   +2.322258863730988e-01   +3.031239325536552e-01   +9.451916304993470e-02   +3.723075262657378e-01   +3.248028924743955e-01; +2.422512942465308e-01   +4.602275779434711e-01   +2.780157944098144e-01   +4.519855471477687e-01   +3.578988995706778e-01   +3.255748113029298e-01   +3.339827970616259e-01   +2.785234193309321e-01   +1.341129452751869e-01   +3.871263639101206e-01   +2.080201453431172e-01   +4.392715427975409e-01; +2.152858095800813e-01   +1.640023907634188e-01   +4.257431499651140e-01   +6.152216499017051e-01   +4.138699790852967e-01   +2.696256790710441e-01   +1.132129619936290e-01   +4.888206870820948e-01   +4.917841595976127e-01   +2.592989729918020e-01   +1.283435813451418e-01   +6.317153107211246e-01; +1.789456446996395e-01   +2.685001069554179e-01   +3.710035738364980e-02   +3.227679733355745e-01   +2.522275728407163e-01   +4.227285509298843e-01   +2.828200957229037e-01   +5.447349641719007e-01   +1.115286832850616e-01   +6.378550685600369e-01   +5.250400325474815e-01   +1.562165683695008e-01; +5.164895081880776e-01   +5.801451489367079e-01   +3.143778672848629e-01   +6.531987281262397e-01   +5.625594539458392e-01   +6.038317444624024e-01   +4.247635047946595e-01   +3.000299076842677e-01   +5.995582483062983e-03   +8.164887959957695e-02   +1.031399109322705e-01   +2.307981562784375e-01; +1.869519250723949e-01   +2.201448921992938e-01   +3.431522787848248e-01   +4.440774353535551e-01   +5.189339198813502e-01   +5.350491211618240e-02   +2.664290421022987e-02   +6.009100341351661e-01   +3.142878465858994e-01   +5.076042753382159e-01   +2.184287249644723e-01   +2.359936361340339e-01];
L3I_L2I_iGABA_netcon = [+5.282283217589410e-01   +4.455337609821258e-01   +4.015597959496779e-01   +5.939158550074199e-02   +3.668689701698409e-01   +1.717072048816321e-01   +3.395431488044250e-02   +5.884287579120419e-01   +1.496753120427368e-01   +2.912493212569793e-02   +4.808125024657076e-02   +4.055079243119157e-01; +4.170220424116215e-02   +5.504858090817123e-02   +2.146118960582264e-01   +3.840831804305906e-01   +5.278848858817605e-01   +3.610904555076945e-01   +2.312923750087520e-01   +5.890913274860309e-01   +5.093944764009001e-01   +3.490048794940914e-01   +6.521008170545816e-01   +1.916281519446036e-01; +3.244258001871596e-01   +1.671855718704036e-01   +4.156073793464429e-02   +2.914652036183315e-01   +4.978176598479616e-01   +3.169516726999345e-01   +3.484830852969534e-01   +2.334196826166279e-02   +4.295709661796146e-01   +8.933791979406745e-02   +2.215005294316175e-01   +3.489573541888394e-01; +1.166356656696108e-01   +1.606200020850821e-01   +5.455633090328109e-01   +3.226332983230623e-01   +4.569931164676720e-01   +4.446259131005513e-01   +1.933846350182782e-01   +1.379668054884792e-01   +2.084809604919665e-01   +3.279477845696212e-01   +2.669476981430503e-01   +3.086883874080435e-01; +2.989890456756921e-01   +1.954723850683445e-01   +5.890880746033381e-01   +5.831991499544084e-01   +7.366902330606798e-02   +1.620270378097818e-01   +4.797938578642215e-01   +4.492196223106506e-01   +1.521850928598186e-01   +3.762126632333236e-01   +2.063218847085485e-01   +1.574979033813442e-01; +9.096163551507606e-02   +6.454037651761675e-01   +1.295966504398520e-01   +5.143238228840489e-01   +2.175865361217548e-01   +5.338805167715557e-01   +4.584651067105117e-01   +6.344626048244567e-01   +4.241687956811087e-01   +5.806433038860512e-01   +6.405159226259607e-01   +7.281042979826911e-02; +5.178337256846135e-01   +2.261898406649870e-01   +3.046327169913193e-01   +2.070970720950926e-01   +9.846956073582866e-02   +2.499726090221256e-01   +5.023258232261796e-01   +4.949821066795357e-01   +3.708400801742491e-01   +8.902560630310076e-02   +2.225764371315409e-01   +1.753358875724925e-01; +1.747774179857540e-01   +5.079257046266147e-01   +4.143697591735355e-01   +6.390564492980090e-01   +5.788272625544190e-01   +5.297768183937709e-01   +1.172222048123861e-01   +3.050540225123531e-01   +1.125275827064244e-01   +3.039309146903926e-01   +6.264740995364202e-01   +4.819440186357600e-02];
L2E_L3E_iAMPA_netcon = [+4.525867553279490e-01   +9.776840452870922e-03   +1.066964528518810e-01   +4.020596446823047e-01   +3.302816153995987e-01   +3.904693233809091e-01   +4.647734236851183e-01   +2.747210158205678e-01; +6.345670374397828e-01   +5.408653105532534e-01   +6.173368726741343e-01   +4.123097328115180e-01   +3.778650598150828e-02   +4.659459414737427e-01   +2.785479253430172e-01   +5.949971366335627e-01; +3.489710753390553e-02   +4.569597517025215e-01   +2.815068862797663e-01   +3.742206629028976e-01   +4.827458705472105e-01   +1.151842610727884e-01   +9.742420188201772e-02   +2.960527339665208e-01; +3.290530078008499e-01   +3.834716635172425e-01   +1.785485963611419e-01   +2.035331092533689e-01   +6.281344180813959e-01   +3.141874309586045e-01   +5.629628089499485e-01   +3.920268244258310e-01; +2.411037237882242e-01   +6.103911164810958e-01   +4.564180597063234e-01   +4.011213781089442e-01   +1.659626742649762e-01   +5.592381818524376e-01   +1.496558479328923e-01   +3.413672440210000e-01; +6.056200006371537e-01   +5.668704966870511e-01   +2.183774496482551e-01   +1.622728242084246e-01   +7.304954361654760e-02   +5.981607876998799e-01   +3.291138250452384e-01   +9.959605388839031e-02; +2.695407819832216e-01   +4.445395680166130e-01   +3.351836247423411e-01   +3.870583608855402e-01   +4.472508455629436e-01   +6.280017474188991e-01   +2.090745967922599e-01   +6.477924918713265e-02; +3.402409045839881e-01   +2.171388920159785e-01   +2.925701617766470e-01   +2.466501944371762e-01   +4.781214751902987e-01   +2.942201555264822e-01   +5.179424303280959e-01   +3.619596907550114e-01; +4.567969718514719e-01   +3.977749900659944e-01   +3.991551384674937e-01   +1.560542171336675e-01   +5.146930572121918e-01   +5.571595710243813e-01   +2.613127747727288e-01   +2.558817050226347e-01; +4.013647145688327e-02   +2.698134223829506e-01   +5.475067604385263e-01   +7.691585631437334e-03   +1.011455792231772e-01   +6.308137153931883e-01   +3.810521669379765e-01   +5.772998359957506e-01; +6.438977355368415e-01   +5.519947773938344e-02   +4.847589253770961e-01   +1.154474382948724e-02   +4.405912153024925e-01   +3.782852906293065e-01   +5.220411633847551e-01   +5.658880840432363e-01; +5.314217551850572e-01   +5.439634706888728e-02   +3.014621161229813e-01   +1.561529976479120e-02   +5.882714459285294e-01   +5.807447989587201e-01   +2.502877451595893e-01   +1.471257150293870e-01];
L2I_L3I_iGABA_netcon = [+1.280289476357416e-01   +5.647556265441966e-01   +3.227848979497340e-01   +3.816195920495328e-01   +4.256340402783367e-01   +3.331878873025378e-01   +4.088483702029226e-01   +6.159125345032610e-01; +1.043425441318140e-02   +5.044641704404800e-01   +6.625089374037085e-02   +7.706592616710854e-03   +6.394574227541894e-01   +5.887115868971108e-01   +1.445362867742964e-01   +2.154442811174398e-01; +5.938687133117139e-01   +1.464538939327323e-01   +3.745631895305953e-01   +4.945445438761816e-01   +1.869230133409865e-02   +3.020274966951346e-01   +1.149584416311879e-02   +6.553335329961097e-01; +2.385642053611294e-01   +1.198948171865518e-01   +5.924249171879717e-01   +5.950489331444326e-01   +6.556513664716315e-01   +6.323662048151141e-02   +4.541859785070067e-01   +5.023866093100950e-01; +2.510466733229482e-01   +1.564585416078675e-01   +8.506319543778526e-02   +2.274040068579084e-01   +3.359589119189980e-01   +1.419543056370884e-01   +5.829540342685596e-02   +5.253085053738742e-01; +3.132414122779602e-01   +4.601722947932287e-01   +5.226938336762292e-01   +9.034635199470625e-02   +4.123037348809228e-02   +4.600424919907253e-01   +6.034799440940610e-01   +5.178728549666433e-01; +2.522256319677024e-01   +5.527637941193202e-01   +6.162843152978907e-01   +4.908679743675690e-01   +1.784569122237512e-01   +5.180219067263931e-01   +5.147135513057831e-01   +1.080210049353252e-01; +1.021331795943641e-01   +1.699260679335388e-01   +2.225116742831499e-01   +5.168467551565046e-02   +3.117154498993192e-01   +4.313395718723181e-01   +3.576267146665658e-01   +4.697731127598488e-01; +2.187943562309869e-02   +1.330156888800649e-02   +9.281896711706984e-02   +3.975888725378600e-01   +2.428343241540950e-02   +4.301460054426647e-01   +7.602767153426462e-02   +4.965374392535429e-01; +3.823535666731047e-01   +9.135822283596111e-02   +6.837226222577303e-02   +2.276094516215284e-01   +1.132240998202079e-01   +3.917772556549204e-01   +7.803562646743985e-02   +3.425922777126330e-01; -1.333318558082761e-03   +6.373450542724932e-01   +2.209226219367644e-01   +2.150512692566558e-03   +7.266312563442279e-02   +1.808081804663033e-01   +6.103844623981590e-01   +1.476148653792985e-01; +2.288847351398208e-01   +9.726664316298739e-02   +6.290921493313427e-01   +2.957069856170461e-01   +4.046106733880306e-01   +6.834839119036107e-02   +2.460554070008625e-01   +1.841697383036159e-01];
L3I_L3E_iAMPA_netcon = [+6.530973552005948e-01   +3.536963768152286e-01   +2.307382004498747e-01   +6.176872481541065e-01   +3.810669983024233e-02   +1.678923352997228e-01   +3.153005205596573e-01   +6.130649461165366e-01   +4.739156339753288e-01   +8.540896254109936e-02   +2.209660118929673e-01   +4.106650479663873e-01; +3.541379816183099e-01   +2.005439110767472e-01   +4.972395480540343e-01   +3.388026941664898e-01   +4.406768849047742e-01   +5.088868908929199e-01   +6.057312718154377e-01   +6.990070418725840e-04   +4.543730066368321e-01   +3.111348713384184e-02   +1.990693082683246e-01   +2.388422225373052e-01; +4.389293611483973e-02   +5.864645892436021e-01   +3.084831174205019e-01   +2.471554894660409e-01   +3.663707555159358e-01   +7.025940202311443e-02   +2.942165862705963e-01   +8.952798737339272e-02   +1.744165552346141e-01   +5.472738839439606e-01   +1.613210294658379e-02   +5.339824556686278e-01; +6.010067297413556e-01   +1.517352335828058e-02   +1.341242713320464e-02   +3.215749820426542e-01   +2.890210527581543e-01   +4.509693068648967e-01   +1.861804308879595e-01   +2.123405445120720e-01   +3.860381975607591e-01   +9.547046402772226e-02   +5.417767741976202e-01   +2.320033909284391e-01; +4.873822341515849e-01   +1.983537263834135e-01   +2.131668947890538e-01   +1.800910322064913e-01   +4.440486692446045e-01   +3.770661219123805e-01   +6.450734140391426e-01   +2.352911338132841e-01   +1.314825223258428e-02   +2.370399704530952e-01   +5.309855002134583e-01   +3.362877552455771e-01; +3.714788398019986e-01   +1.546595032092477e-01   +4.826463861964494e-01   +6.508895661283692e-01   +3.658814342089606e-01   +3.582442034663312e-01   +6.104266700795439e-01   +4.107597374848773e-01   +3.530682212305497e-01   +4.624041913812665e-01   +8.555923963268125e-02   +6.107802957043986e-01; +2.112903215942882e-01   +2.634680246054957e-01   +5.611353768358597e-01   +5.710766795308581e-01   +3.118509517826102e-01   +3.746119819597910e-01   +5.635615764619190e-01   +4.981825436384622e-01   +1.102977756203410e-01   +4.693120459179178e-01   +4.197142879816770e-01   +4.876785433379225e-01; +4.966054353868964e-01   +6.115023261226608e-01   +3.829740682591703e-01   +1.188768121899832e-01   +4.098561746904588e-01   +9.185135607411753e-02   +1.472134455135786e-01   +2.786617978476526e-01   +2.685709222613099e-02   +4.694197250215619e-01   +5.868061574263743e-01   +2.452900320090121e-01; +3.630540299557817e-01   +5.025669892770914e-01   +2.205778464979506e-01   +4.886927860704987e-01   +4.772004418100831e-01   +2.520150646462995e-01   +2.124692700630981e-01   +6.275631403439346e-01   +3.721302084432836e-01   +6.022175185794300e-01   +3.190917777941876e-01   +1.541908591853905e-01; +3.443293900623384e-01   +2.985209546609815e-01   +1.026884927867838e-01   +4.090655094751848e-01   +1.255797196816619e-01   +4.350968614382345e-01   +1.781633754972073e-01   +2.768805165441830e-01   +5.610068623367250e-01   +2.456033093387598e-01   +5.354735837855874e-01   +3.217874696666138e-01; +4.355910664921865e-01   +6.253227575426372e-01   +2.439971203752251e-01   +1.319129222886904e-01   +1.322324895814138e-01   +1.320455461921436e-01   +1.938317194410153e-02   +9.200687106547090e-03   +4.667585290085073e-02   +4.374434206052670e-01   +5.361006865726584e-01   +3.739166423102990e-01; +5.727151641254034e-01   +1.380411072931651e-01   +1.595223676641943e-01   +4.699890289123523e-01   +5.799079666672385e-01   +1.912487283955474e-01   +3.165883614091753e-01   +4.377091582555606e-01   +2.907065097601081e-01   +3.218918136846038e-01   +3.031961525453761e-01   +5.648840098978404e-01];
L3E_L3I_iGABA_netcon = [+2.252995017045580e-01   +3.288265720986590e-02   +1.427053806246165e-01   +1.031332422197090e-01   +4.992253754576917e-01   +1.178857624353522e-01   +1.331139998767398e-02   +5.899989474511828e-01   +2.500900932205472e-01   +2.779291325267591e-02   +1.276008602467473e-01   +4.435541058342097e-01; +2.192448203601840e-01   +3.967053254951938e-01   +6.432669868124128e-01   +2.354168014577685e-01   +6.409877106224385e-02   +3.440257383135091e-01   +1.386158780790651e-01   +3.628188318893835e-01   +2.430093690838704e-01   +6.355460144663836e-01   +2.325222469252595e-01   +2.391380175348843e-01; +1.784097664017842e-01   +6.159844193767620e-01   +1.813897429322467e-01   +3.126144749047639e-01   +2.986836962660594e-01   +4.692906092420159e-01   +5.957413412148274e-01   +4.557841228513831e-02   +1.140608241723447e-01   +1.806364770306666e-01   +4.277742744496889e-01   +5.479882732489780e-01; +1.487740375825652e-01   +5.868339930491725e-01   +2.995553841413012e-01   +5.143990252024606e-01   +1.823236806703039e-01   +6.139941061929802e-01   +6.420328555691336e-01   +4.028381388688259e-01   +3.803216550525463e-01   +2.475260036941396e-01   +4.366890330210854e-01   +3.664322328345464e-01; +5.060989203762890e-01   +3.463692253245390e-01   +7.269391515014505e-04   +6.197510299570583e-01   +8.890018758370677e-02   +3.147390629417378e-01   +5.668686003091666e-01   +3.429523094245485e-01   +2.782183560503014e-01   +6.306022822860753e-01   +3.011508329889883e-01   +3.191446488926741e-01; +6.172718945414033e-01   +4.364671584400773e-01   +3.057239888308383e-01   +2.270678005547022e-01   +4.847510648381392e-01   +1.572612535808542e-01   +3.112309677075305e-01   +5.322459726339799e-01   +1.833278051423208e-01   +1.592956814063852e-01   +7.826769278884660e-02   +4.625179404514821e-01; +4.848960668333140e-01   +1.119103554046065e-01   +6.227646538515179e-01   +2.551893562539103e-01   +2.201629388604946e-01   +4.364573150482352e-01   +4.146162536319272e-01   +5.004959523537821e-01   +3.322321139784817e-02   +6.004940923817437e-02   +1.350548546185847e-01   +1.832312065066719e-01; +1.776162061251728e-01   +2.081112331274565e-01   +3.676265882652763e-01   +3.213898821675395e-01   +5.867062259692347e-01   +4.478857210640956e-01   +3.581498612343909e-01   +1.420384364780795e-01   +5.400782951901960e-01   +3.863344813355890e-01   +6.916891498553124e-02   +3.196531199353518e-01; +2.016277409505791e-01   +3.407327456672641e-01   +2.913252816243163e-01   +1.963949084146259e-01   +5.335239586782919e-01   +3.335812471558934e-01   +1.002064307116793e-01   +4.682006160055089e-01   +6.195666913491503e-01   +1.402233977381808e-01   +1.505499425731418e-01   +5.480257854876508e-01; +1.010774763762796e-01   +1.078740385991821e-01   +2.885115859880356e-01   +6.439055081793149e-01   +3.780436716078593e-01   +7.124080065462697e-02   +5.471610909923734e-01   +1.944411509494856e-01   +4.012266516380258e-01   +4.648341054497968e-01   +9.051782498761213e-02   +4.288405485369219e-01; +5.663295841043579e-01   +1.865587872437433e-01   +2.015369045092676e-01   +3.063213854000691e-01   +2.082111060480319e-01   +2.163719012258956e-01   +6.505110741520249e-01   +6.769186128590726e-03   +1.301119003500643e-01   +1.337022622384740e-01   +4.843132110015616e-02   +2.904960873486133e-01; +1.757103485391108e-01   +3.612440926806700e-01   +8.723853769075675e-02   +3.058162168964323e-02   +6.355388653276005e-01   +4.344125603489092e-01   +2.849227398411711e-01   +1.968573351522916e-01   +6.992644703659895e-02   +2.640412626821658e-01   +5.760085227638754e-01   +1.193884183950113e-01];
L2E_Input1_iAMPA_netcon = [+1.623751249357605e-01   +3.890251406878398e-01   +1.472702296448995e-01   +8.806688005570892e-02   +4.062820497802987e-01   +1.362158951363410e-01   +4.741109861704717e-01   +2.818483710886259e-01];
L2I_Input2_iAMPA_netcon = [+6.466234296633780e-01   +3.275635554557545e-01   +3.292478561922625e-01   +1.619987514058398e-01   +9.808735659191546e-02   +8.722279013837171e-02   +4.809116190141299e-01   +3.771824800371963e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
