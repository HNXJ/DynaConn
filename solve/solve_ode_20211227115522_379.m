function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.019371982876450e-02   +1.465563818547927e-03   +2.690263724443633e-01   -1.060435851541239e-01   +3.787665827926769e-01   -2.070606990035614e-01   -2.303423133128571e-01   +1.224486938335706e-01   -4.529861422426527e-02   +2.002898619445314e-01   +1.048919594250942e-01   +2.471384485079341e-01   +1.962015630910022e-01   -5.129838728325115e-02   +6.155900098545088e-02   -8.635708168547110e-02; -1.699741196275706e-01   +1.348772805302740e-01   +7.484032803323495e-02   +1.478070791761748e-01   -2.185144552791469e-01   -3.316385382549780e-02   -1.053699140881594e-01   +2.665094829829529e-01   -9.541308210936034e-02   -2.011987435132138e-03   +1.275937357718873e-01   -1.611094572390917e-01   -2.016805851242396e-01   +2.667313315464263e-01   -7.233253527811380e-02   +1.098276364044612e-01; +3.771847853335650e-02   +6.861604750664838e-02   -9.221597651720349e-03   +3.573312002297925e-01   -1.187355825479862e-01   +1.002203355036361e-01   -2.810014726336151e-01   -2.735663296508647e-01   +2.225974153707306e-01   -2.535299417274496e-01   -1.167925788973764e-01   -3.012632246738003e-01   +1.389386972618458e-01   +1.352394902624822e-02   +6.951650409438648e-02   -7.777462874825239e-03; +9.466375079811526e-02   +1.124899923406125e-01   -5.949448270454320e-03   -5.433860180589642e-02   -1.180598469137141e-01   -2.186791457458097e-01   -2.573190120483932e-01   -1.852169000141153e-02   -2.170497820722657e-01   +8.420413898066376e-02   +3.788414353582586e-01   -7.620310539429366e-02   -1.760058686333857e-01   +7.812351918565606e-02   -2.781853282203792e-01   -3.331587467953169e-02; +9.332290981377472e-02   -3.576970077302881e-01   -2.642398131559607e-01   +2.920833941956521e-02   +1.456112057001416e-01   +2.476062061982328e-03   +2.597763656316282e-01   +3.043127269067624e-01   +1.342501710277530e-01   -2.859157963242963e-02   +4.188105341665739e-02   +2.092306414991409e-02   -1.067422123336540e-01   +3.536275429383123e-01   +5.262536117765330e-02   -2.205455031278671e-01; +1.829603199459000e-02   +2.335908289412703e-02   -1.145519494739581e-01   -1.636773391572187e-01   +8.113848330378974e-02   -7.319422764284017e-02   -2.090053251821295e-01   -6.790260887074318e-02   -1.463334849291723e-01   -1.207943069145877e-01   +1.294582362647278e-01   +4.310219064802146e-02   +2.353527385631917e-02   -5.173408051313835e-02   -1.620775468512617e-01   -1.336519319557129e-01; -1.783461414553777e-01   +3.337796381794036e-02   -8.024845742168604e-02   -3.386203313814336e-02   -1.168861290950971e-01   -3.600832931870959e-01   -1.166113061050772e-01   +1.370929035995134e-01   -2.335436727363971e-01   -9.697004931164658e-03   -4.051291480136249e-02   +8.701649667105324e-02   -1.495015497428908e-02   -1.211870808554245e-01   +2.367793132754947e-01   +5.464297660482559e-02; +1.336720242944585e-02   -1.337216818606749e-01   -1.460080458067520e-02   +1.613352963867382e-02   +1.016780691880921e-01   -1.485136637103720e-01   +2.307118588935811e-01   +1.419927977172112e-01   -1.594695832459927e-01   -1.921864542016670e-01   +1.692705210487136e-01   +5.751505354195602e-02   -1.831492875417184e-02   -1.178445924861407e-01   -1.493144080438440e-01   -1.021246144721066e-01; +5.127769197225338e-04   +3.849188720824781e-02   +3.491049962209366e-01   -2.072131104107464e-01   -1.102295210953315e-01   -3.027307130044342e-01   +6.896019863492583e-02   +2.154494468634605e-01   +8.567417784859821e-02   +4.440890217828636e-03   +6.970823304611498e-02   -2.125758119075047e-01   +1.385725143551326e-01   +2.007490544255185e-03   -7.908155741157450e-03   -3.082148625517115e-01; -8.954351579682851e-02   +3.134627569239791e-02   +1.590330818533839e-01   +1.661552294709979e-01   +3.193371604671572e-02   +1.703855612775343e-01   -3.641410908126903e-02   -2.319476796831871e-01   +2.042784398509030e-01   +1.011366617369782e-01   +1.278513694843934e-01   -2.137039969399021e-01   -1.837949964543534e-01   -1.787719761631105e-01   -3.601405868031362e-01   +8.887944791335534e-02; -2.349599302747740e-01   +2.580583197353649e-01   -3.570351502274656e-01   -1.859831096738233e-02   +1.628337590008570e-01   +3.728941298667178e-01   -7.075029181533748e-02   +1.841149697276317e-01   -4.317121417668669e-02   -1.702874284625073e-01   +2.623569226186432e-01   +9.478760651713364e-02   +7.762174294911457e-03   -1.298269203059937e-01   -2.226660927808211e-01   +1.219465339663395e-01; -4.217832272526950e-02   -1.780851706630847e-01   +3.561723133339602e-01   +3.597577038490296e-01   -2.002560214340958e-01   +2.709605428375159e-01   -1.421028866464995e-01   +1.818668484098772e-01   -2.246933464511396e-01   +2.775757770661857e-01   -2.275817182499610e-01   -4.831721856987807e-02   +2.097361955218479e-02   -5.230355149593428e-02   +1.768338895674984e-01   +2.523485173147427e-01; +1.520526758447361e-01   +4.686265825611714e-02   +4.875432935798639e-03   +7.316096315756708e-02   -1.261278460054411e-01   +5.328886364478072e-03   -2.874429640629349e-03   -1.843270305790852e-01   -7.861400818582970e-02   +1.644567869371514e-01   +1.327789320051653e-01   +1.158496633289223e-01   -2.830970722543539e-01   -7.661069503388121e-02   +5.357718033994509e-03   -2.423207024640818e-01; -2.649293739836735e-02   +8.226358603640748e-03   +4.754097147952210e-02   +2.230908679651242e-01   -3.285784082737129e-02   -1.989344142494646e-02   -1.845383445975766e-01   +1.595653370943351e-01   -6.449782375822900e-02   +3.725790087544506e-03   -2.259055913350878e-01   +9.765118797368712e-02   -7.155409944489721e-02   -3.882640926878184e-02   +6.553897491178623e-02   +7.835764271973518e-02; -1.308361045690659e-01   -1.425735456866309e-02   -1.677368089103443e-01   +1.131195424033187e-01   -1.940967188515779e-01   +1.662564933530397e-01   +2.166580985511208e-01   +5.628624123326741e-02   +5.286289487229259e-02   -1.382513279735345e-01   -2.632980797191453e-01   -2.192586570949254e-01   -1.455697947203459e-02   -1.362607731967128e-01   -3.958216662145159e-02   -1.194825630933498e-01; +1.071224565999221e-01   +7.213366323926890e-02   +2.780911535465922e-01   +5.696806591361347e-02   +1.619616476408088e-01   +2.940030948903248e-01   -1.188995744596758e-01   +4.809165024874469e-02   -4.274577888647180e-02   -1.224633656729888e-01   +1.181533822855944e-01   -4.121227261233955e-02   -1.897149327001710e-01   -2.583560717060248e-01   +1.034754467819525e-01   -1.378549162036219e-01];
L1E_L1I_iGABA_netcon = [+6.752882646889669e-02   +5.325522601197011e-02   +9.594180085832751e-02   +3.192866589399899e-02   +8.827264891951694e-02   +4.620199697102731e-01   -2.275422211585122e-01   -1.514940527778005e-01   -2.193758755820707e-01   +2.521307086170710e-01   -1.937254915755187e-01   +1.406630303381577e-01   +1.048380837337780e-01   -1.857361051468358e-01   -1.788061280047556e-01   -4.025925665046886e-01; -2.190163155370338e-01   +6.890376472378243e-02   +3.599630591392755e-02   +9.417635355950783e-02   -1.224739729653354e-01   -7.301326441344881e-03   -1.559841039247715e-01   +2.636381167214805e-01   -2.381225461136065e-01   -3.399218972092813e-01   +2.624485704949526e-01   +3.783173008719264e-02   -7.107360554120948e-02   +3.001083540725884e-01   -7.825622588617789e-02   +3.022425620863885e-02; +7.818677834749607e-02   +2.223981652899905e-01   +1.229617195345750e-01   -1.656743960866247e-01   +2.665263434132064e-01   +8.915770703297231e-02   -8.756106474761909e-02   +1.450274424424408e-01   +9.404193576503569e-02   +1.329938870045429e-01   -4.070171652333443e-02   -1.061327948693476e-01   +2.005140397540509e-01   -2.399651992272860e-01   +1.632944276798447e-01   +1.833330249857737e-01; -1.011542449260187e-01   -5.268784144922201e-02   -1.779990570878911e-01   -6.634883553063176e-02   -1.689213675503195e-01   +5.795180561496636e-02   +2.822572644759577e-01   +1.873254800151163e-01   +6.321072516698060e-03   -3.669212317896622e-01   +6.369530282482831e-03   -1.526543783272707e-01   +2.603305839057928e-01   +1.959469161448412e-01   +3.806641876394169e-02   +3.023308455213602e-02; -3.270942466324960e-01   -1.761824791684856e-01   -6.646298856995722e-02   -1.639811819397015e-01   -1.444978870325518e-01   -3.703879462344496e-01   +3.447645966587571e-02   +2.390545434368886e-02   +4.307649083666014e-02   +5.854886449882820e-02   +1.920705530453733e-01   -2.808302848979901e-01   -1.959171378535320e-01   -1.287385003527258e-01   +1.357013199615907e-01   +1.461145767956815e-01; -1.244282451980429e-01   -2.751056636115560e-01   -2.225188727722738e-01   -1.331487198498281e-01   +5.517821412487179e-03   +4.022748212098710e-01   -1.668872048409628e-01   +9.984060527116476e-02   -1.790001908124221e-01   -2.918578524604832e-01   +1.612856856519695e-01   +7.222592982346072e-02   -3.057221214110307e-01   -1.739902643003141e-01   -9.157742684147892e-02   -1.167222108654730e-01; -4.738325448413727e-02   -4.033950276844397e-02   +8.015896872088089e-02   +3.937905670327620e-02   +3.464925319557234e-02   +1.837881401704151e-01   +1.003573641933510e-01   -3.514856816551384e-01   +2.833069250334747e-01   +7.359714032203279e-02   +2.742023967901154e-02   +2.660748688162163e-01   -2.099859114629301e-01   -6.657029766055500e-02   +2.222202179865669e-01   -1.969184186971038e-01; +1.177212315024124e-01   +3.832779726394990e-02   +3.113336235615572e-01   -1.139921140565363e-01   -3.334879847224751e-01   +1.505710369273688e-01   +2.133773825583425e-01   -5.761742902703784e-02   -2.276568885100236e-01   -1.664473814847870e-01   -1.393731269898293e-01   +2.922648944622470e-01   +6.904169658874183e-02   +1.150005124242259e-01   +2.218344619822455e-01   -7.636370980824482e-02; -3.600991836466825e-01   +7.789932340753206e-02   -3.199267637727325e-01   -9.102052216389131e-02   -1.186855517797568e-01   +3.137087981044467e-01   -9.965276681923624e-02   +4.566683392422610e-02   -1.330733295964371e-01   +3.343929577059480e-01   -2.073610807250989e-01   -3.321416252981503e-01   +1.279294798232091e-02   +3.843218835443436e-01   -3.066203765433840e-01   +1.209143832092015e-01; -1.628340109449726e-01   +8.538851306166967e-03   -2.250551143710218e-01   +1.490448020069499e-01   -6.619700457440203e-03   +2.492314021527052e-01   -4.106250828851160e-02   -9.223996444510725e-03   -1.435600691862591e-01   +8.352094925600126e-02   -1.377810266049698e-01   +1.271550659621582e-01   -1.332986478767864e-01   +2.912006788141221e-02   -1.262558036829235e-01   -8.367965770558994e-02; -1.441409008768854e-02   -1.358488000664415e-01   +7.367088756402848e-02   +2.059956305461975e-01   -4.841873676289742e-02   +4.970867075658614e-02   +2.481846532576440e-01   +1.580941243150965e-01   -2.075207042980788e-01   +9.542130907765994e-02   +1.348018861992174e-01   -4.156334555439774e-02   +2.167454003403454e-01   +1.819199541880965e-01   +1.939383898051466e-01   +1.935592415665672e-01; +9.426263946743724e-02   -1.322417873771970e-02   -8.165808161741607e-02   +2.881807168568536e-01   -7.930886204646248e-02   +3.472101428734913e-01   -2.583996018023406e-01   -2.191925041737734e-01   -1.451926422728436e-01   -8.247847217400393e-02   +2.620508954220022e-01   +1.661548659658481e-01   -1.306515799856001e-02   -1.145106128360122e-01   -2.441551705354724e-02   -3.180670549352480e-01; +5.549065251488597e-02   -8.101861106879191e-02   +2.133198222585340e-01   +2.084615283908209e-01   +1.391978262259116e-01   +9.344474456602014e-02   -1.000296330166441e-01   +1.528902569835085e-01   -5.312912781519327e-02   -6.524819142809213e-02   +1.354608909020790e-02   +1.670262190052321e-01   -2.998273739309675e-02   -1.487109039682049e-01   -2.969970939244398e-01   +1.707227043138050e-01; +1.794451009887493e-01   +2.340753920973837e-01   -2.538384181883817e-01   -2.870475208016199e-01   -6.862719263181509e-02   -8.324633740987798e-02   -9.931880014008347e-03   -3.661319503335717e-01   +3.392514515285325e-02   -3.225756168954174e-02   +1.308111336145701e-01   +8.393959621990882e-02   -9.247876109241544e-02   +1.114271257215416e-01   +1.663407269470098e-01   -1.539608260488906e-01; -4.893548979492197e-02   -1.143863882467066e-01   -4.627898480407636e-02   +2.167166734821661e-01   -2.506093214010039e-01   +1.302568866088833e-01   +8.327364000834112e-02   -2.209119815222682e-01   +3.210834985494780e-02   +1.571014204223376e-01   +6.818788219103103e-02   -5.607004748021976e-02   -3.595271539887408e-02   -2.557324274944159e-01   +5.362729983044132e-02   -4.628225759173510e-01; -3.349319048403676e-02   -1.005390547011583e-01   -1.406085526964697e-01   +1.592078432822618e-01   -8.657939334733104e-02   +3.064838587915381e-02   -1.433014478097663e-02   +1.895130816128043e-01   -1.132003626371401e-01   +8.399187554152113e-02   -1.586011448756494e-01   +3.207418193100076e-01   +6.029712221484965e-03   -6.729000638021475e-03   +1.513551592156563e-01   -2.116646320451697e-01];
L2I_L1I_iGABA_netcon = [+5.434852254509362e-02   -1.279787630001714e-01   -2.086406766886452e-02   -1.228919135621670e-01   +2.054245080397905e-01   +1.781614898641247e-01   +2.163851256451803e-02   -1.065436084135832e-01; +3.969743457791197e-02   -1.768080449449440e-01   -1.079041635297974e-01   +2.428962228458784e-01   -1.552609361371166e-01   +2.489603255255602e-01   +2.810112887520588e-01   +5.856591847805930e-02; +7.235740665912743e-02   -3.443236764890866e-01   +2.270126607475637e-03   -2.463123206666203e-01   +3.370943282364421e-01   -2.800152334389353e-01   +8.039834476498799e-02   +1.119918813661352e-01; -2.184761840239631e-01   +1.532633862250687e-01   -2.136753201950643e-01   +4.005097532703797e-02   +4.702288327088484e-02   -1.157587840388792e-02   +2.891229391840906e-02   -1.273543691961868e-01; -3.084590406654000e-01   -1.391355659413588e-01   +2.421869934055917e-01   +3.010957784060662e-02   +3.455872839501125e-01   -2.508965785551332e-02   -2.205402654284657e-01   -6.519655393950347e-02; +2.562417197669438e-02   -2.498101407227561e-01   +1.907660816065404e-01   -2.081985508610532e-01   +1.688625613998603e-01   -9.913482149259201e-02   -1.761349339587075e-01   +9.837322300034124e-02; -1.794488502953354e-01   -2.947161673391285e-01   +7.878571036913032e-02   +2.656757122716948e-01   -2.399860572379414e-01   +1.520743501106429e-01   +7.443014487610866e-02   +1.972369266954050e-02; +3.507694886588296e-01   +1.326743039516220e-01   -7.730390831949813e-02   +1.650985409780795e-01   -8.941729717139736e-02   +1.868470951768925e-01   +1.338965387687712e-01   -1.342442875009127e-02; +6.427299669277782e-02   +8.444900073817169e-02   +5.258981623501827e-02   -6.318954540092524e-02   -2.663664888484999e-02   +7.309077672346989e-02   +2.445012390391136e-01   -5.394135975989547e-03; +6.679842171505858e-02   +2.508998148357203e-01   -2.851947488924342e-01   -2.250203902652700e-01   +1.708665907708374e-01   +2.402806342105380e-01   -2.389848051502980e-01   -2.511460388300837e-01; +1.763358016101374e-01   -1.159089594158159e-01   -1.074830857130416e-01   +3.634939702584043e-02   +1.942029738345224e-01   -3.003397017722291e-01   +9.264189142040975e-02   +1.024483230091165e-03; -3.972905311259080e-01   -2.559367901817237e-01   +1.624605970879425e-02   -4.233935820216727e-02   +1.210217793437163e-01   +2.459970941431824e-01   +2.380067613077973e-01   -5.304774981178247e-02; +7.421776572347902e-02   -9.728865970204426e-02   +1.241047821850791e-01   -6.667314244057099e-02   +4.992517740398383e-02   -1.774801461286712e-01   +1.646968783711484e-01   +7.601074278332830e-02; +1.779875315876507e-01   -1.522578012787313e-01   +4.930976387955990e-02   -1.237277378660578e-01   +2.204629412860366e-01   +8.373886569304205e-03   +1.309331724568492e-01   +1.227883028847505e-01; -1.026492672510631e-01   +3.308326407711836e-02   +1.024911616499100e-01   -8.415969489989991e-02   +4.263499407402588e-01   +4.213978250200617e-02   -1.256788629453224e-01   +5.740625891379372e-02; -1.861694090856809e-01   +2.219533331192045e-01   +7.486530625610931e-02   +3.258414016673757e-02   -3.281134908674942e-02   +1.093264450159039e-01   +6.170785620649642e-02   +1.801230720807752e-01];
L1I_L2I_iGABA_netcon = [+2.009075970070094e-01   -1.778794856887919e-01   -7.466693685554318e-02   +2.161808342837640e-01   +3.637729324418852e-03   -2.916494958809338e-02   -1.685987311313404e-01   +3.454394695095590e-02   -3.564677126440498e-02   -6.592469033683629e-02   -1.456758537855452e-01   -2.238517949978195e-01   -8.310669353533257e-02   +1.241724781320020e-01   +2.127614024262042e-01   -1.961767131622041e-01; -2.486018419135296e-01   -1.678185313546811e-01   +1.113299004542559e-01   -2.871075016451342e-01   +6.316506905498048e-02   +1.625538886928757e-02   -1.124247866640495e-02   +6.886535035066009e-02   -5.948610823953919e-03   -2.579372631737061e-02   +4.155007052600742e-01   +1.797676190701843e-01   +2.108832773506543e-01   -8.773502810718378e-02   +2.759332890345978e-02   +3.746070415779117e-03; -4.735555887818216e-02   -7.079232144857045e-02   -1.109409536553708e-01   -2.071382285685376e-02   -8.080898356054753e-02   +2.409439890136481e-01   +2.330845057041026e-01   +1.119007383554968e-01   +1.540920108255587e-01   +1.168128025667551e-01   -1.432823583192713e-01   +6.378234640535857e-02   -2.858086544023225e-01   +4.808634608522921e-02   -3.071477725985416e-02   +3.204871396786793e-01; -3.050812289914763e-02   +3.853144880219849e-02   +1.813896985617800e-02   -6.943115956980266e-02   +1.700043782199630e-02   -2.078336855515555e-01   +1.021429252249314e-01   +1.822556995773615e-01   -1.656139297271653e-01   -2.480688539539600e-01   -5.689753692376372e-02   -1.496203958658176e-01   -7.445876829875550e-02   -7.516073466626016e-02   +4.788004005517910e-02   -1.581527752346971e-02; +2.137444720822920e-01   +3.537316982794290e-01   +4.471506082233619e-02   -9.294425565407784e-02   +3.775809898364893e-02   -1.483564934719340e-01   -1.810761514296595e-01   -4.449746609375868e-02   +2.752797187428728e-01   -1.021722455409633e-01   +3.231163331370628e-01   +1.076226241764370e-01   -1.416865033557610e-01   +2.280056852000008e-01   -1.008117656528505e-01   -3.782310906634646e-01; -2.484153005172197e-01   +4.655303901529675e-02   +3.653117942840794e-02   -1.716633845866739e-01   +8.872076565893632e-02   +1.721141814159982e-01   +3.184937030850032e-01   +1.147983312700646e-01   +1.773408864065943e-02   -2.774099090648897e-01   +6.444348644007278e-02   -3.891703952674601e-02   +1.561352029072882e-01   -1.041130809774825e-01   +2.642956159356659e-02   -2.533366227745225e-01; +1.531359638446334e-01   +1.446480375745465e-01   -1.280656326906855e-01   +1.850628425257498e-01   -8.357870500585129e-02   +8.173129849432585e-02   +2.135843234439054e-01   -7.152446248778907e-02   +3.395386190267534e-01   +1.332870310568331e-01   -1.886355385555916e-01   -5.024329555418774e-02   -3.076514416884603e-01   +5.338570809408091e-02   +2.121659984181379e-01   +2.723868114985261e-01; +1.014127046861864e-01   +6.820289561170463e-02   -4.025892604825291e-01   -1.969238934727299e-01   +6.804922140321085e-02   +6.253541655528155e-02   -2.531330200482342e-01   -1.664019508418814e-01   +2.014824411073695e-01   -1.133761971867078e-01   +9.844209309166829e-02   -7.458622925438696e-03   -4.381373185848209e-01   -1.383077259446410e-01   +3.333052449990560e-01   -1.004491951218442e-01];
L2E_L1E_iAMPA_netcon = [+1.448699048314178e-01   -2.404203822963639e-01   +1.787809140892176e-01   -5.069381836550949e-02   -1.271281599008314e-01   +1.749125137501422e-01   -1.321534703544743e-01   +3.859439683505822e-03; -6.752959892113267e-02   +1.587250965616998e-01   -1.402763983520314e-02   +2.933945437329382e-01   +2.916280169267720e-01   -6.665534497598785e-02   -1.287137564018567e-02   -1.566548353588229e-02; -6.958951162698505e-02   -1.934470843114981e-02   -6.185614747585026e-02   +2.103758258833834e-01   +2.908951497037007e-01   +8.510003682090532e-02   -4.000582852446995e-02   +8.361405929031003e-02; +3.052938051030527e-01   +1.934641431432857e-01   +1.169990490390428e-01   -3.328445466304618e-01   -1.216568761130512e-01   -1.477564296970923e-01   +1.855554988681529e-01   -2.271882903798123e-01; +4.720428372833928e-02   +8.941652542008693e-02   +1.044750777616633e-01   -2.614260631855975e-01   +1.130259172398706e-01   -1.938054949268415e-01   -2.090541591561640e-01   +7.358130108293734e-02; -9.152198971950343e-02   +1.716663565445423e-01   +1.162640357002090e-01   -9.986240064366432e-02   +1.818878020148635e-01   +3.885839473150835e-02   -1.940804473567267e-01   -2.561125231065571e-01; -1.806338855301296e-01   +9.223921846597520e-02   +1.499563735528454e-01   +8.194509658937939e-02   +1.513451405506436e-02   -8.484992190208589e-02   -1.315598555449312e-01   -3.299721892924814e-02; -1.404794085451321e-03   +2.253573565003131e-01   +2.619660013470180e-01   -2.139600595677702e-01   +3.078102530637279e-01   -9.863358550385307e-02   -2.273721694894081e-01   +3.100915390854397e-01; -1.799592405144827e-02   +1.101473062718391e-01   -1.960816500706528e-01   +1.379641198790000e-01   +2.379221587315804e-02   +3.184617693625380e-01   -1.976322540416864e-01   -9.790481850928379e-02; +2.532528281747989e-02   -3.167164308069104e-01   -2.058679589151524e-01   -2.628758884427975e-02   -2.777865008241110e-02   -5.454464048542532e-02   -8.462114759387768e-02   +1.245405374768416e-01; +3.960677795384953e-01   +4.673322510195616e-01   -2.541958982292740e-02   +2.194900106284886e-01   +9.647069657262522e-02   -6.527539625069322e-02   -4.557175633370365e-02   -1.563911350694802e-01; -1.924007733869151e-01   +6.356458405423568e-02   +6.357851048678720e-02   +1.874046219602296e-01   -4.224155072923021e-02   +1.743585853905221e-02   -4.365726665422350e-02   -2.647853840541317e-01; +4.773759101323419e-02   +5.666371180447305e-02   -2.862186468705916e-01   -3.742551862380769e-02   +3.477246157145281e-02   +1.286229939701783e-01   +1.462963107365865e-01   +7.212930937988178e-02; +1.880577618902998e-01   -1.989446220445613e-01   +1.903748127822431e-01   -1.848175185834202e-01   +7.952732119108328e-03   -2.197966019480659e-02   -3.581429072063125e-02   +1.190866067579583e-01; +4.758288244102712e-02   +8.143470899373828e-02   -8.038493508364319e-02   -1.512367823805120e-01   -4.473883454473870e-02   -2.958195752209649e-01   -4.067304473077873e-02   +9.736023716993947e-02; +2.861696215970380e-01   -6.168221721146792e-02   +1.572219198574236e-01   -6.571608013800576e-02   +1.700455319325892e-01   -6.698528418522762e-02   -1.182766204305852e-01   -1.318073711290640e-01];
L1E_L2E_iAMPA_netcon = [+1.250585379303159e-01   -2.938687515684567e-02   +1.201867350796711e-01   -1.129157882832033e-01   +3.647864680493710e-01   +4.969342146493791e-04   +6.544509204944887e-02   -1.223433235736038e-01   +9.000386585293153e-02   -1.431559643323557e-01   +7.391999510155174e-02   -8.785923646839347e-02   +2.914759115730977e-01   +6.713748250842866e-02   -8.192655835664919e-02   -4.046217182077701e-02; +1.239527322149359e-01   +1.551180605652316e-02   +2.320196586834064e-01   -4.023950959777998e-01   +1.775356838445312e-01   -6.030707836896858e-02   -2.146877508326927e-01   -1.663764862242056e-01   +1.111716529493662e-01   -1.690156787456901e-01   -3.831745808811748e-01   -2.900031756531544e-02   +5.778665446590883e-02   +6.401113068214901e-03   +1.684127592808304e-01   -3.929600598655165e-02; -2.118011799461000e-02   +1.223530962958209e-01   -1.051336776613767e-01   +1.965015346940599e-01   +6.776549609747884e-02   -2.913124141433805e-02   +1.485863806854069e-01   +7.072987353616948e-02   -1.839828325905744e-01   +2.071748153931971e-01   +3.438294330816889e-01   -1.838369924691885e-02   +4.475589780001628e-02   +2.077666414626704e-02   -2.808820362519656e-01   -1.712031655301342e-01; -1.877112542198545e-01   +3.776749168389282e-01   +1.129605264190223e-01   -1.812377431650342e-02   +7.536887202056325e-02   -8.319673132164135e-02   -1.109695563920629e-01   +1.995193093109041e-01   +2.155916154352671e-02   -2.558428864702141e-01   +1.432640328003740e-01   +1.472157836430312e-02   -1.150345028847350e-01   -1.111227372162793e-01   -1.399223645074566e-01   +9.907450835278338e-02; +1.098845862613477e-01   +9.959386836559830e-02   +5.457358611189154e-03   -9.858899678623884e-02   +1.174611363359298e-02   +2.241722143050763e-01   -2.965029088010969e-01   -1.385250188773153e-01   +8.566585861247702e-02   -3.800803275110962e-02   -2.453820088249017e-01   -2.387904877515533e-02   +8.481998556589668e-02   -7.136866577928397e-02   -1.125806045964697e-01   -4.384081732193447e-02; +1.389109867417790e-01   -1.222555410722844e-01   +2.112009092056044e-01   +5.938857123095165e-03   -2.657715315969375e-01   -1.557682458594903e-01   -1.649013351664434e-01   +1.585360957858448e-01   -1.068486057999522e-01   -2.188078747903809e-01   +1.234723731867840e-01   -7.541102539263782e-02   -1.795609100120475e-01   -9.742253319881002e-02   +1.471807549908308e-01   +2.205563738066506e-02; +1.480750656460310e-01   +2.584467000951046e-01   +7.004669110328690e-02   -1.566299381086917e-01   +1.129341077114637e-02   +3.064464863780996e-01   +6.266676079333205e-02   -2.602282946897809e-01   -7.642209909304316e-03   -1.634129570097571e-01   -3.512461461639644e-01   -1.903538207651994e-02   -4.008558259828889e-02   +1.116528118650943e-01   -1.300934294486201e-01   -1.265585585798288e-01; -4.875917957031251e-02   -1.637238417817081e-01   +4.749205276977896e-02   +2.763045786142829e-01   -1.269785185203700e-01   +1.018315571858918e-01   +5.007313434691296e-02   +2.980788544023170e-01   +3.323440272405495e-01   +1.973984331503766e-01   -1.765862061244750e-01   -3.766611270433751e-01   +8.045757456893098e-02   -2.169435793241989e-01   -2.040275396851739e-01   -1.516690022024933e-01];
L2I_L2E_iAMPA_netcon = [+7.509041400274004e-02   -3.637274498220708e-01   +8.056486736430357e-02   +7.858498052378742e-03   +7.929936343659258e-02   +3.850620370735532e-01   +1.532861913172675e-01   +3.860563140286866e-03; -2.506255545377684e-02   -1.192495127330104e-01   +2.451194947031804e-01   -1.228590931661758e-01   -5.700345348271295e-02   +2.542030923488414e-01   +4.264026942897622e-02   +4.078100637953811e-02; -9.087981007317282e-03   +3.536190340762998e-01   +1.924354648097161e-01   +1.784749610973875e-04   +1.606418885896344e-02   +2.848854578933587e-01   -1.166759140496230e-01   -3.056064961327183e-01; +2.035650616844421e-01   -7.200605257644557e-02   -1.229344750400916e-01   -1.003872753159848e-01   -9.152246642668582e-02   +7.265478302629566e-02   +9.185207706611477e-02   +1.404659701328687e-01; -3.171818593580211e-02   -2.842730017466379e-01   +3.457479876966445e-03   +1.380946641779709e-01   -1.876332756281914e-01   +6.972045723294534e-02   +8.133869581514597e-02   -2.004074804260287e-01; -2.399791437372741e-02   +2.488933629943922e-01   +4.604982033372906e-02   +4.091037433651971e-02   +9.462361214553294e-02   -2.103749486030252e-01   +2.152642355579753e-01   +2.310180596078010e-02; +4.362057326479453e-02   +1.512161106673848e-01   +6.870011475004342e-02   +5.337949559114645e-02   -1.517823109590280e-01   -1.773454134231119e-01   -7.607938427901241e-02   -8.184866495518112e-02; -1.233370324996649e-01   -2.840983930445679e-01   -1.032928652919253e-01   -2.760134402057969e-02   -5.834673753181411e-02   -1.791341138510975e-01   -2.609245140501715e-01   +2.225470230874047e-01];
L2E_L2I_iGABA_netcon = [-1.489437018707841e-01   +1.393965708688725e-02   +1.240037469049113e-01   +3.295435709018144e-01   -2.279107704002116e-01   -3.254266628580054e-01   -1.946896423325411e-01   -2.471450032285669e-01; -3.373873611716213e-02   -3.320370428243348e-01   +9.346160571763182e-02   -3.480048359859169e-01   +4.410119327086214e-02   +1.644789553231945e-01   +8.951291971305621e-02   -1.036126908838580e-02; +5.822143195139753e-02   +2.542335593713457e-04   -1.882632364676206e-01   -2.037572944671360e-01   -5.674627037144261e-02   -1.237305496386733e-01   -2.916050498844218e-01   +4.291215110870868e-02; -5.416369054922501e-02   +1.934067971114519e-01   +2.333664770756438e-01   +3.827297717641299e-01   -1.285292076345994e-03   +2.238288892591454e-01   +1.577183163819482e-02   +8.772699695810753e-02; +1.267114251860507e-01   +8.489424283680838e-02   +1.590737681199322e-02   +2.236802767686595e-01   -5.258154325001092e-02   +1.564655670377537e-01   -1.871579851644971e-01   -2.216331175835307e-01; -2.495372768121413e-01   +1.205280970971196e-01   +2.520091819803424e-01   -1.249948099749017e-01   +3.498242070830025e-02   +3.757038724709390e-03   -4.840059406565810e-03   -2.708826100064382e-01; +1.534668264783061e-02   +4.363157189088442e-02   -1.438449635455282e-01   -1.226130040730687e-01   -1.502982558576917e-01   +4.114912626048061e-02   +1.724956367723434e-01   +2.363333998841392e-01; -1.984743018000064e-01   -5.601541913989108e-02   +6.775176717048444e-02   -9.114902408999709e-02   +2.502304049934604e-01   -2.615934528128855e-01   +1.457110038676569e-01   +1.845905638473876e-02];
L3E_L2E_iAMPA_netcon = [-1.263431058353980e-01   +1.956985716189963e-01   -1.466094833433353e-02   +6.885796054744353e-02   +3.452718221112638e-02   -2.499897137751653e-02   +1.335846432726829e-01   -2.313212550401788e-02   +4.813985504263687e-02   -2.489244481942227e-01   -2.933839416730719e-01   -5.256936228919589e-02; +1.835575769675743e-01   +1.679769580495984e-01   +2.482725718580084e-01   +2.894355995480526e-01   -1.302249760393066e-01   +1.336811002139865e-01   -1.544608741371667e-01   +3.381610864778318e-01   -1.332684178427005e-01   +2.344453843684480e-01   +9.835798825728222e-03   +1.794308352579612e-02; -1.178030271640950e-01   +1.550087651285055e-01   -1.414274719177305e-01   +1.377548431842280e-01   -8.368595421880159e-02   -9.506594705761338e-02   -1.480870799604340e-01   +1.955952449888468e-01   +2.459736063206004e-01   -1.197761935335186e-01   +2.575507437674173e-02   +7.188870038637293e-02; +1.727008024818618e-01   -2.478016435171903e-01   +2.205660206619531e-02   -1.312363464718319e-01   +1.726311325101961e-01   +1.942285291127264e-01   +1.095120895952108e-01   -7.325105603861463e-02   -1.585337043729595e-01   -1.209585591232529e-01   +1.680003771845644e-01   +2.042985177116238e-01; -1.108744903939226e-01   -2.035836106934359e-01   -8.195920679800617e-03   +7.685215870316438e-02   -4.662623805878888e-02   +4.181818379154864e-02   -1.947477248509583e-01   -2.095949924661851e-01   +2.753272777207264e-02   +2.858003231479900e-01   -1.114536872355739e-02   +3.344774053242932e-01; -4.208477941174293e-03   +7.608228478776364e-03   -5.159919139903902e-02   -4.710723951076737e-02   +9.086529622506202e-02   +2.065692581242886e-01   +3.325903614237859e-02   -1.955898954167284e-01   -8.190199261346601e-03   +1.462073806977770e-01   -1.302129145363120e-01   -1.076386480679789e-01; -5.186586799769617e-02   -8.074009938884780e-02   +1.253917035417029e-01   +1.421712517837032e-01   +7.533906029549702e-02   +1.851476697313513e-01   +3.097888904884679e-01   +3.260523534450783e-01   +1.110830091875823e-01   -2.149556093259996e-01   -1.537032659212562e-01   -1.895354022129407e-02; -2.340194851976487e-01   -1.247554750163463e-01   +5.569782938926079e-02   -1.084112441545774e-01   +1.841392801558328e-01   +2.703338838235402e-01   +1.905571658871900e-03   -1.040666179314534e-01   +7.188735853358910e-02   -2.361922346356083e-01   -2.801618175148346e-04   +5.392383738401267e-02];
L3I_L2I_iGABA_netcon = [+3.375579477561635e-01   +1.085815878230849e-01   +2.483373860334308e-01   +1.355938438843265e-01   +1.054205234147761e-01   -1.644623630267190e-01   -1.844729631662206e-01   +1.604904133504949e-01   -1.243419144355594e-01   +7.364510365587316e-02   +4.459475061954983e-02   -4.274617583234834e-02; +1.488949879894363e-01   -1.633899984692760e-01   +8.693735344190252e-02   -1.130149312120283e-01   +2.288881548262099e-01   +1.836293726337069e-01   +4.368055604209973e-01   +2.455798903430466e-01   +1.762270729775833e-01   +2.004196514241038e-01   -8.484187657486250e-02   -2.252453239325817e-01; +1.005557183894538e-01   -3.057214988959626e-01   -8.896703148211285e-02   -4.171859859078316e-02   +6.819858515049758e-02   -1.969711869687814e-01   +2.036605345437207e-01   -1.471425537140800e-01   +9.968109111532469e-02   -2.516220363807161e-01   -1.323303633119300e-01   +3.865834013748298e-01; -9.859794487790974e-02   +8.600904412457852e-02   +1.729205892543858e-01   +2.792638506594432e-01   +1.338306537918484e-01   -9.539354403421563e-02   +6.357763695223696e-02   +9.245311582293002e-02   +2.949974588596119e-02   +2.339754834876481e-01   +1.341307909931868e-01   +1.137379941699775e-01; -4.281196068195623e-01   -2.753923513328781e-02   +2.542355438775143e-01   -2.286291475886464e-01   +1.628429256782646e-01   +3.506167218401562e-01   -5.583233984794024e-02   -3.860362653588597e-01   -6.876563379323627e-02   -2.019727689355855e-01   +1.344295616411882e-01   +1.144839872104982e-01; -2.747356216711771e-01   +1.590444758323100e-01   +2.381254550891024e-01   -1.167020696542595e-02   -1.802643756563301e-01   +7.132434009780748e-02   +7.892703067759577e-02   +1.614843028090426e-01   -1.505308956848186e-01   -1.837438014849952e-01   -4.935213852788310e-03   +3.336336425102181e-03; -1.909888292090397e-01   -2.956391062948625e-01   +1.288162109453744e-01   +8.621021360190129e-02   -3.941681585516425e-02   +1.434700157308145e-01   +1.500819047154024e-01   -2.786868447614310e-01   +1.843361271175143e-01   -3.026471624928084e-01   -2.794985902130642e-01   -2.413895604663019e-01; -5.907215386180086e-02   +8.949986413832364e-02   -1.261364734408441e-01   -6.490947069201838e-02   +1.737366918458746e-01   +1.641577262620326e-01   +1.620780161238801e-01   +8.100190415541059e-02   -2.922077231984715e-01   +1.840147168155993e-01   +2.111414779183620e-01   +6.601091044246699e-02];
L2E_L3E_iAMPA_netcon = [+8.574350145539093e-03   -6.701642656255995e-02   -1.499459968074741e-02   +2.571157536289929e-02   +1.497523215208155e-01   -1.508503994136642e-01   +1.498920758789229e-01   -1.052776319275487e-01; +1.293969037046032e-01   -1.902659517364688e-01   -1.265810157288275e-01   -6.678431126231690e-04   -3.073442607813722e-01   +1.099112399895530e-01   -1.629341657766370e-01   +2.908192290485852e-01; +1.431481864144650e-01   -2.269086079931393e-01   +5.009485581463017e-02   -1.453424181349357e-01   +1.493275083845637e-01   +2.086375752881155e-01   +3.412415526358485e-01   -7.064066941312638e-02; +5.783739629508867e-02   +4.693437661374338e-01   -2.743168118206592e-02   +1.099570112491526e-02   +6.787317038786531e-02   -2.886986386711974e-01   -2.189336352482741e-02   -3.797826126633987e-02; +3.198484536019279e-04   +5.085063125753227e-04   +1.989438891333567e-01   -4.833135030833405e-02   -1.369881618315834e-01   -2.215919798075003e-01   +5.236459019766111e-02   +4.563039304942938e-02; -5.300902993561239e-02   -2.522476359040859e-02   +1.799875953956835e-01   -3.069561361591076e-01   -6.317364831945282e-02   -2.303056634103869e-02   -1.127375607039659e-01   -9.089185574355250e-02; -1.006189243430503e-01   -3.810779165199978e-02   -1.522043885484708e-01   +5.996912972053811e-02   +7.496941456485381e-02   +1.293821742036188e-01   +2.682725769215326e-02   -3.656933039023071e-02; -3.961461396111626e-02   +3.651119429280033e-01   -6.786928480165770e-02   +7.330113846669897e-02   +8.412471180673188e-02   -6.195829653459675e-02   -2.599153898393398e-01   +6.117945367062291e-02; -1.831433672288847e-01   +2.716577512288292e-03   -7.676842815591860e-02   +1.035430129831486e-01   -1.805538335510194e-02   +2.120106941520375e-01   -1.360769942253325e-02   +6.224440893121298e-02; -1.964024293994381e-01   +2.042989647093791e-01   -1.854083097153684e-02   -4.454698879520980e-02   +2.401326180985930e-02   +3.629468106293263e-01   -8.097653889011314e-02   +7.822741323268270e-02; +1.633320855253432e-01   +5.039574624833781e-02   -1.800328063000199e-01   +9.495396728861194e-02   +4.596179957753189e-02   -1.489391389538454e-01   -8.128502662399739e-02   +1.480063909316399e-01; +1.593294291887390e-01   +3.264649993689668e-02   +3.204613542522624e-02   -4.515982621090987e-02   +2.445681212809946e-02   +9.184131664391501e-02   -9.584340685268719e-02   +1.672465620319364e-01];
L2I_L3I_iGABA_netcon = [+1.915026158159393e-01   +1.021277922641582e-01   -2.388930111054698e-02   +8.795537300644274e-02   -1.948065489743692e-01   -1.919675229807849e-01   +9.571419587019123e-02   +1.830711146725858e-01; +3.842364567244119e-02   -6.167319380595304e-02   +1.133024690118416e-01   -8.806953229763763e-03   +1.409882249983621e-01   +1.019223692538032e-01   -4.163488012175643e-01   +9.634559348127382e-03; -2.822347182199538e-02   +8.239786489576523e-02   -2.849676654252512e-02   +1.199035994218401e-01   +1.869256532133462e-01   -2.922202387469907e-02   -1.522382856227978e-01   -1.858780126222669e-01; -1.385824940359418e-01   +1.311956830541363e-01   -1.191395988825270e-01   +3.863477012574967e-01   +1.191160057939222e-01   +2.284366953289300e-01   +1.686633631795689e-01   +5.452868753393063e-02; +3.918540060776115e-02   +7.689017273273839e-02   +4.586301955294261e-02   -2.616357173046011e-02   +2.219056824309036e-01   -1.835985273470330e-02   -1.957271624247555e-01   +1.977016813029022e-01; -1.614709670944925e-01   +3.395619391815368e-01   +9.850249282031615e-02   +5.925957206871327e-02   +3.635370670597494e-01   -1.142482729133472e-01   +2.959812247102990e-01   -2.553205568508582e-03; -1.455470970165307e-01   -3.233743682122033e-02   -2.082554803542125e-01   -1.550419606231248e-01   -2.024797801479837e-01   -1.402520817970468e-01   -2.420540648310845e-01   +6.869221568150387e-02; -8.964111685882892e-03   +1.319636464042614e-01   +1.313130094140884e-01   +1.687461843539914e-01   -4.583750885797098e-02   +5.640971051072800e-02   +2.803374923729967e-01   -1.326742012409213e-01; -1.003768777868661e-01   +8.101984389343969e-02   +1.801366937375517e-01   +2.582584564396961e-01   -1.688342942030844e-02   +2.392498580349934e-02   +1.791318427103507e-01   +8.254447416094296e-02; +1.248531928899796e-01   +4.215530970679587e-02   +3.103156534559526e-01   -1.300065255410176e-01   -3.751470564849425e-02   +2.043084451833402e-01   +3.719641218616659e-02   +2.744154693616808e-01; +1.446470356391107e-01   -2.240459455214548e-02   -8.154894487703049e-02   -9.936040704461611e-03   -6.177217260530137e-02   +4.869312225042181e-02   -1.089657930934123e-02   -1.145515614852766e-03; -1.233519644405175e-01   -2.869873859351897e-01   -2.493749087261226e-02   -1.884015668449248e-01   +2.112264120266380e-01   -2.572958091689863e-01   +9.402251057346531e-02   -1.700440687483428e-01];
L3I_L3E_iAMPA_netcon = [-1.427905570679653e-01   -1.131048347780480e-01   +9.509225907757073e-02   -1.490434555379122e-01   +7.089673157887434e-02   -1.771583076142792e-01   +1.473103330465919e-01   -6.235764211226750e-02   -2.698509649954914e-01   +2.941499417415962e-03   -1.700339978074294e-01   -1.636757583803785e-01; +6.010674400431635e-03   -2.634863540696429e-02   -6.536501871254867e-02   +1.828396760973665e-01   +5.065361219675419e-02   -1.626487873782924e-01   -6.359738421873132e-02   +1.070486358286765e-02   -5.939480835779678e-02   +7.851646320149087e-02   +1.141288186419510e-01   +1.140366195954797e-01; -1.358204812385977e-01   -5.370906917069938e-02   -1.264433550054921e-01   +1.261234571833577e-01   +1.337856959859528e-01   -3.265645107460709e-02   -7.735773467155679e-02   -1.239354710653890e-01   +1.606729666574638e-01   +1.655436287344347e-02   +2.757887329502847e-01   -1.411554362801400e-01; +8.669897428507314e-02   +1.968143901580843e-01   -5.630575978621696e-02   -5.673122818988756e-02   +5.521882117167732e-02   +1.133684307625520e-01   +5.416033110840791e-02   +9.760436258878380e-02   -1.290486331279038e-01   +1.125407943909047e-01   -1.199258976342752e-01   +9.038040494100702e-02; -6.059487247592740e-02   -2.401002694193909e-01   +2.979235126818521e-01   +2.382819791224091e-01   -9.420459159958927e-03   +1.380785538109350e-01   +1.799509357351000e-01   -5.276754689403527e-02   -1.660749865872133e-01   +6.849837766145182e-02   -2.232882280990003e-01   -3.222535507856915e-01; -4.856895371756767e-02   +1.422969365114862e-01   -7.763003556095895e-02   +1.111971512428455e-02   +2.586301518677654e-01   -8.013297653328746e-02   +1.038318897407731e-01   +1.078993750894847e-01   +8.238333595297483e-02   -1.945087480537302e-01   -8.401971519485046e-02   -2.454471961517312e-01; +1.123442172569569e-01   +7.158080138344562e-02   +3.194796836038775e-01   -7.859988566728118e-03   +3.302110271628571e-01   -1.449816710263125e-01   -1.187837090320623e-01   +1.443090791576729e-01   -1.428164696579929e-02   +1.796016803164741e-01   -6.939816433935612e-02   +2.754917853195085e-02; +9.993246860737237e-02   -1.018635041844852e-01   +3.006765059028955e-01   +2.943158298756156e-01   -2.023740721605109e-03   +3.963691120093522e-02   +8.601409445512442e-02   -8.581098199701230e-02   +5.654636962255029e-02   +1.633762160189704e-01   +9.664919112174188e-02   +2.204325390433746e-01; -2.333002023274415e-01   +3.289073245860160e-01   +1.509566449276420e-01   -1.206496849914692e-01   +1.359865401849731e-01   -5.727773783865953e-02   -1.273925423629804e-01   -2.130377804819058e-01   +1.836969167958299e-01   +2.246424901057003e-01   -2.266862991582892e-01   -1.533477665619302e-01; -1.803744101943852e-01   +7.161873697245361e-02   +2.871794663895842e-01   +2.142621227219585e-01   -1.447647086421302e-01   -1.416262615304869e-01   +1.733122267388021e-01   -2.773428569035109e-02   +6.690795222673762e-02   -2.876864580928576e-01   +2.321770763121641e-01   -3.878341411462093e-01; +1.006155002396992e-01   -8.509325824096101e-02   -2.492815084377343e-01   +2.025943069859270e-01   -2.074419000599241e-01   -1.412500837717697e-02   -1.821931340582409e-01   -7.561462029719176e-02   -2.038717403473902e-01   +2.242245827691714e-01   -6.291102711037774e-02   +1.586500045962436e-01; -1.559022555867936e-01   -1.502856926855268e-01   +1.561156673109111e-01   +1.414398850986620e-01   +9.879369696498333e-02   +1.874373411547270e-01   +1.296117403236053e-01   -1.013113265636149e-01   +4.739737763617106e-02   +3.382849504901748e-02   -1.731881221862664e-01   -7.548596211254263e-02];
L3E_L3I_iGABA_netcon = [+2.147597832096416e-01   +1.059054554307152e-01   -1.337079153936115e-02   -2.245589442453015e-01   +6.797679589752176e-02   -5.955528345706861e-02   -2.079089746612583e-01   -9.012125337590032e-02   -8.729600821234354e-02   +5.923951117192738e-02   +5.766827767129218e-02   -6.441509721909744e-02; +8.136872184465754e-02   +1.272292267072934e-01   +2.332125471939953e-01   +2.983685481970498e-01   -2.531064190260316e-01   -6.322568245927687e-02   +1.066875728400817e-01   -1.114414899015704e-01   +4.268887771375293e-01   -1.150265313684034e-01   +5.519989705164686e-02   -1.849920811354996e-01; -2.239423593155392e-02   +2.211892552677967e-01   -1.221787477541234e-01   -1.031917071218538e-01   +2.326508851422680e-02   -1.374367715759215e-01   -2.506759513712717e-02   +2.635345788818891e-01   +3.939123292750327e-02   +1.212163229958342e-01   +1.946612843015475e-01   +6.554686737477376e-02; -9.324066547778861e-02   +1.091084342675842e-01   -2.426787590097921e-01   +7.041702519317473e-02   +9.000842573124439e-02   +1.567980110609777e-01   -2.885703868800575e-01   +2.024178330279324e-01   -7.582771440147408e-02   +5.525721110564944e-02   -9.991364599800390e-02   -8.923930256203115e-02; +6.365298951760544e-02   +1.315635218031476e-02   +1.094227996858239e-01   +1.453260232980658e-01   -1.193266842143190e-01   +6.143333061869864e-02   -2.475384190888774e-01   -2.859453233012445e-02   +3.727815487001311e-01   -3.611679284812603e-01   -6.522095372100363e-02   +1.121725641084088e-01; -3.237232374968741e-01   -9.466548867426032e-02   -2.975009298414321e-01   +1.148141792637338e-01   -2.643540988596246e-01   +2.203529102795323e-01   -3.380629552970407e-02   +4.559622495525515e-02   +2.454930982614004e-01   +9.341057346088588e-03   +1.938516235801713e-01   +1.609213932617055e-01; -2.555747510564761e-01   +1.872905536507100e-01   -9.231030228736618e-02   +1.707678125468014e-01   -3.467733396010225e-04   +5.520437526910053e-02   -1.456975266519849e-01   +1.863905421241186e-01   -1.913152981876527e-01   -6.926534276344276e-02   +3.890979553409468e-02   -6.981324623375619e-03; -1.345149581198196e-01   -1.641472707431212e-01   -7.930915273922666e-02   -7.907501591707304e-02   -1.257042705764767e-01   +4.418231374392195e-01   +7.083698642472036e-02   +2.669092052124268e-01   -1.268710354576741e-02   -5.507160775832029e-02   -2.644664025830158e-01   -1.719280534263017e-01; +2.924465682988293e-01   +3.072469023624362e-01   -2.748804771095782e-02   +1.036967233215912e-01   -1.229694430821517e-01   +8.654860436693310e-02   +3.140861776271117e-01   -1.023546369392328e-01   +1.306634971973153e-02   -1.809513854973132e-01   -1.168675790510532e-01   +2.864013120743888e-01; -2.590759670514252e-02   +1.775318334526107e-01   +1.330318885216973e-01   +3.140955172315697e-01   -9.543815046666794e-02   -2.959626723364051e-01   +3.708614132820157e-02   -7.147935433554790e-03   -2.131663055888712e-01   -1.380320694668116e-01   -2.357065718882942e-01   +5.043607211500407e-02; -3.617546539783251e-01   +4.540522251684240e-02   +3.141461743040310e-01   +4.939733899064543e-02   -6.040602400042401e-02   -1.215390831770876e-01   -1.260573810409174e-01   -2.544030367384624e-01   +8.755108467655205e-02   -7.183090806475094e-02   -2.084831683609575e-01   -1.693565749020220e-01; +5.172504323533939e-01   +3.725548952727718e-02   +3.671210652356051e-02   -2.961610108189427e-02   +2.389082420011974e-01   -3.079718620114000e-02   -6.192417675844643e-04   +1.640029313643706e-01   -1.064313393812141e-01   +5.078067276515809e-02   +3.590148451564747e-01   +1.248869920559631e-01];
L2E_Input1_iAMPA_netcon = [-1.118819684088711e-01   +1.642197344117004e-01   -2.132231746237952e-01   -6.065261742567476e-02   +2.516816579903947e-01   -1.537634932700081e-01   +8.289771797262932e-02   +3.035821518919361e-01];
L2I_Input2_iAMPA_netcon = [+2.091994677340704e-01   -2.479329426178815e-01   -2.847117455068365e-02   +5.689385348953267e-02   -2.733836804103600e-02   -4.619082526826124e-02   +8.702178998953325e-02   +9.392654206069023e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
