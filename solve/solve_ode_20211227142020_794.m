function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.958388307791544e-02   +3.581840749353758e-02   +6.372348768710133e-02   +2.283138780860630e-02   -3.581990445908399e-02   -1.460362005073911e-01   +2.869424290995673e-02   -9.567482584575460e-02   +7.558905890809510e-02   -5.080876431652780e-02   +5.273940276252519e-02   +1.430686600925732e-01   +7.248302211319738e-02   -4.916613381683238e-02   +2.566245181218794e-02   +2.695372566847097e-02; -6.888784310762119e-02   +8.656325497537196e-02   -4.931692640101652e-02   +6.542836416138914e-02   -7.680784279136016e-02   +6.878349833519060e-02   +2.585836030496830e-02   +5.956620054293450e-03   -1.173414458131602e-01   -9.358215172706207e-03   -7.003568901619359e-02   +7.415962276689025e-02   +7.574283256887726e-02   -3.068143187583759e-02   -7.653088417471851e-02   +8.334988889801122e-02; +4.961768799525174e-02   -1.322563716790303e-01   +5.985646111579423e-02   +1.031833130307133e-01   -4.711149016182514e-02   -5.524527368878340e-02   -1.592116968902776e-01   -1.261369568284390e-01   -1.242995295335359e-01   +5.282027817409567e-02   +7.683323183022664e-02   -1.286065897781412e-02   +1.469767401626601e-01   -9.024500439861297e-02   +1.548971409813452e-01   +7.143389972444066e-02; -2.267286769071626e-03   -4.806275115144362e-02   +1.165739843137693e-02   +3.242892801302079e-02   +7.830453919996464e-03   -4.434951219923782e-03   +7.640868816422175e-02   +3.338877488184790e-02   -1.510353249422698e-01   -1.033720894573390e-01   +2.482595972862442e-02   +4.772020847082708e-02   +8.779075200389089e-02   +8.617490604000681e-03   +5.885720244327981e-02   +9.653133701604500e-03; +1.640747750582066e-02   -3.372279219089716e-02   -1.006025596137895e-01   -1.377416387418444e-03   -1.360147911751722e-01   +3.027597110568282e-02   +1.052548446928732e-01   +1.118725051802561e-01   +1.320646900595974e-01   -1.431733144104861e-01   +4.933802660621722e-02   +8.228135154703529e-02   -3.310103419372917e-02   +6.634269574582324e-02   -3.490163376090243e-02   -3.985406356346373e-02; -1.426826733792434e-01   +1.370270223641913e-01   +1.247048979542042e-01   -1.107882487156002e-01   +4.212894316790542e-02   +6.407217118586941e-02   -1.716593335332351e-02   -3.279576613106697e-02   +2.476039971349772e-02   -1.303767124322880e-02   -3.720082624598955e-02   -4.698553012466677e-02   +1.190716541008321e-01   -7.321999234792750e-02   -1.502517197812913e-01   +7.137496048144543e-02; +2.100686554957033e-03   +1.380555295299151e-01   -1.786408818533152e-01   -1.506122022918261e-01   -8.993096973535571e-02   -4.399696444762118e-02   +1.948422885232712e-02   -3.845371055700682e-02   +5.894952327579646e-02   -3.939795292759644e-02   +5.111833485222544e-02   +5.013236676902444e-02   +9.218624439254171e-02   -5.507016144021470e-02   +1.164408862171711e-01   +1.141682162307902e-01; -3.953599055799643e-02   +1.539190495913725e-01   +1.455583261882056e-01   -1.064568275860462e-01   -2.184863826118494e-02   -5.147327739098159e-02   +9.568394127546884e-02   +6.332490380482374e-02   -4.803878317248264e-02   -1.149820136975111e-03   +9.053238046042025e-02   -8.542430445862362e-02   +7.668878269691387e-02   +3.574985283583435e-02   +7.783262876392073e-02   +4.147299167811311e-02; -7.082073043436812e-02   -6.534976138900508e-02   +1.233333857517737e-01   +2.242663630167295e-02   -2.923003992125408e-02   -4.951299557780762e-03   +1.168867720879095e-01   -5.721227155837774e-02   -8.581946652304821e-02   +6.685493468666192e-04   -1.620334401942953e-02   -3.900562013266674e-02   +1.332684681853164e-01   +1.147588024095694e-01   -1.967319622605450e-02   +6.317493413904710e-02; +2.652252176008274e-02   -4.530277803820682e-02   -7.133258904344759e-02   +1.631080076251497e-01   +1.967862762693733e-01   -3.208721665116612e-02   -4.980155351491622e-02   -5.141197184915830e-02   +2.855597407243242e-02   +3.799311277631889e-03   -8.956156743457210e-02   +4.001669360736114e-02   +1.209658835910294e-01   +1.048565972862545e-01   -6.261650131726390e-02   -1.502217162546581e-01; +1.220145935146916e-01   -1.646822147454410e-02   -2.137413521580009e-02   +1.935666320322174e-02   +1.983169855900015e-02   +1.769901138681902e-01   -2.172276741618151e-02   -6.273651385155810e-02   +1.466077856163395e-01   -1.124659355340248e-01   +5.055403216637384e-02   -1.597551317247870e-02   -1.233077171172367e-01   -8.851781361987675e-02   -1.505159460042763e-01   +1.463548582997242e-02; +2.557271174859130e-02   -1.569184169497733e-01   -5.273701923451160e-03   -1.956863612770038e-02   -5.708431388525094e-02   -3.202041035532043e-02   +3.914111146960270e-02   +1.102073960436976e-01   -8.881338580721052e-02   +6.647628722991822e-02   +8.125171441294884e-02   +6.697743613370119e-02   -7.953933991073585e-02   -1.862163837764001e-02   +6.415745389393469e-02   +3.152455552948358e-02; +7.611956691932542e-03   -5.284082871140895e-02   +2.669916844944838e-02   -1.252328215776106e-02   -1.072666665641881e-02   -6.534214586798531e-02   +1.105569769441618e-01   -1.399740511553915e-01   +3.341157304489683e-02   -1.444622786825330e-01   +2.171775771317011e-02   +4.845408364472345e-02   +4.955841493716640e-02   +1.162696349282766e-01   -6.252842882132982e-02   -2.857523572549368e-02; +1.531905487688108e-02   -6.053537893303968e-03   -2.176926910191547e-02   -5.968112048218316e-03   +9.954906014463270e-02   -1.289681877428691e-01   +1.068166253841809e-01   +8.771688591798726e-02   +8.098448000990516e-02   -1.423751592974766e-02   -4.528819543269337e-02   -9.322713514522746e-02   -5.162489362448777e-02   -1.130093668906665e-01   +1.147022369631912e-01   -1.652483187146844e-02; +2.547552391356003e-02   -6.875585670545611e-02   +1.599255417473153e-02   +3.160877475535390e-02   +1.148532154521718e-01   -1.080135454312604e-01   +9.240372070208808e-02   +8.436285989795303e-02   -4.025681419622038e-02   +5.223258539044649e-02   +3.122233308299106e-02   -1.331705991662196e-02   +4.400997235583840e-02   -1.237256501910677e-01   -1.600170812444824e-01   -2.417068648051438e-01; -8.429151257634163e-02   +6.069869080172076e-02   +3.404611224139268e-02   -1.026154930972953e-01   -1.390404947492607e-01   -3.647064609337441e-02   -9.911126738420994e-02   -1.544625160760529e-01   -3.550311824083205e-02   -2.301360960721854e-02   -1.064925293084874e-01   +6.319110953898070e-02   -6.225760163492698e-02   -2.861365246344353e-02   -1.038054881280076e-01   +7.910602324323383e-02];
L1E_L1I_iGABA_netcon = [-5.699301493497253e-02   +2.861297491883609e-02   -5.161385516856921e-02   +1.933815873502296e-01   -3.514539051319521e-02   -1.318053255455361e-01   -1.555942623107039e-01   -5.005736100647959e-02   +1.103640071726057e-01   -8.206052461745504e-02   -4.747932981899893e-02   -1.416408752325087e-01   +5.657550302936729e-02   -9.192354963318168e-02   -4.305288608113519e-03   -1.192278731049104e-01; +5.866468781948027e-03   -1.047638851571674e-02   -2.380608108698824e-02   +1.355913181808015e-02   +2.100214320555934e-01   -8.862063267899532e-02   -9.552153600466044e-02   -6.931319855497652e-02   +3.457741103054938e-02   -7.630341450268617e-02   -7.169582098942147e-02   +2.854496174385029e-02   +9.271842710036865e-03   +2.626557676289103e-02   -6.068905924630792e-02   -4.987589500251649e-02; -4.239746896218359e-04   +1.699584600419689e-01   -1.003680520692398e-02   +6.147396608689305e-02   -6.539115719238511e-02   +1.096417620966005e-01   -7.010335120520501e-02   +1.011236667043616e-01   -1.119829028826566e-01   -8.101704491255150e-02   +1.095099806526999e-01   -2.038951315938700e-01   +4.032477802076778e-02   +3.799554190386584e-02   +7.028241076882621e-02   +6.231785716015575e-02; +5.562431484092260e-02   -7.364018806450892e-03   +2.246325028525780e-02   -5.318861663010633e-02   -3.160505028278777e-02   -1.355330827657333e-02   -2.486230042781015e-02   +4.334304684536011e-02   -9.560636478947718e-02   -1.983482753519383e-02   +1.959879091303571e-01   +2.586283703725917e-02   -1.509477857414633e-01   -1.758694706921841e-02   -1.496758885570307e-02   -8.871731619136616e-02; -1.672912344571125e-01   -4.424842770713967e-02   -1.137496837305422e-01   -8.150954029950405e-02   +5.033031449060515e-02   +6.167140447730471e-02   +1.307286679703107e-01   +1.829564997981611e-01   +1.763655237516787e-01   +1.884937312719505e-02   -9.364753778759301e-02   -4.182321793801341e-03   +1.265567886354886e-01   +8.605201801790127e-02   -5.101068942019933e-02   +4.409128760805195e-02; +1.541607609459828e-01   +4.107643870614258e-02   +7.397364116777626e-02   +2.622380059423315e-02   +1.205451811244351e-02   -1.359169453713709e-02   +2.108592411329501e-02   -8.004599484588035e-02   -5.042403683063141e-02   -1.913541167259312e-01   +1.748508830898838e-02   -4.823648729672163e-02   +2.936051076848572e-02   +2.153163014853071e-02   +1.324223721058165e-01   +8.532584886207268e-03; +2.040375981908750e-02   +4.156785205519592e-03   -1.487407268530859e-01   +8.680267669578411e-02   -9.464375920650725e-02   +2.389300927156507e-01   -2.717785570512538e-02   +8.715023498227939e-02   -7.767764106024332e-02   +1.009859160700778e-01   -9.296573208043533e-03   +5.361820963160730e-02   -2.239241112068681e-02   -8.755060052456787e-02   -5.627237595677650e-02   +7.845489314691720e-02; +7.273536258701542e-02   -6.883381520209228e-02   -5.949548094388232e-02   -6.658023944283134e-02   -1.148282145637926e-01   -8.832007400184806e-02   +7.948747877666000e-02   +4.577971547710702e-02   -2.659463640557670e-02   +2.016356601733137e-02   +4.407767099905303e-03   +2.210066492478596e-02   -4.328343830762647e-02   +6.587766718630950e-02   +5.721697774736741e-02   +1.247067124684313e-01; -5.089949049109170e-02   -1.387363869489083e-02   +1.233708498278827e-01   +8.351185627019167e-02   +1.166068547953287e-01   -5.077701313147607e-02   +4.804936879058345e-02   +6.840929489607811e-02   -1.101647993601407e-01   -1.333249998169965e-01   -3.681121742532364e-02   -2.027660528645276e-02   +8.756434957928852e-02   +1.027386512389542e-01   +1.326048711456845e-01   +1.727456576577474e-02; -5.664246563440147e-02   -7.236182213819886e-02   -1.052226554106842e-01   +1.780302496815685e-01   -1.120702606041811e-01   +1.731160633622830e-01   -4.922264229339367e-02   +2.409152374298864e-02   -1.145363225309533e-01   -4.604884606853140e-02   -1.132546807503629e-01   -3.727367093970971e-02   +4.432733418644910e-02   +7.675804570280825e-02   -1.101041750369369e-02   -1.098595842604500e-01; -1.641040393779128e-01   -1.758304552957604e-01   -5.032008198977254e-02   -1.428419494802633e-01   -8.942340384292970e-02   -1.619047474785588e-01   -3.796175852616011e-02   -1.115288573801557e-01   +2.487156130463222e-02   -9.558525281803641e-02   +6.657197137113031e-03   -6.203311062446738e-02   -8.822899564746432e-03   +5.370635142196661e-02   +7.279674508204607e-03   +1.330002180756052e-02; -8.031951653505967e-02   +1.815747005636153e-01   -4.953209165797927e-02   -6.794255045544231e-02   +6.340970073477356e-02   -1.607084270005773e-02   -9.476893634896495e-02   -5.435232291310508e-02   +1.316213912052197e-01   -2.128807499107565e-02   -1.299627163568125e-01   -1.347036385310917e-01   +2.666379485137113e-02   -2.000153001575564e-02   -1.820149764650558e-02   +1.130915771933396e-01; -2.033912281003625e-02   -3.162694305606644e-02   -4.741298377698038e-03   +7.727660373642205e-02   +5.830884332263155e-02   +8.993261199277300e-02   -1.464374525571528e-01   +7.893990380458040e-03   -1.168510109118471e-01   -3.004109092143133e-02   +7.257461100853774e-02   -1.912813050828405e-02   -1.572218866488667e-01   -6.865027640910164e-02   -1.365584599610626e-01   -3.273359355659789e-02; +2.941759770264504e-03   -7.131594081697896e-02   +6.202413492350624e-02   +5.174520101281377e-02   -1.498775383548052e-01   -8.340605983050642e-02   -4.968856623567187e-02   -7.785057861444616e-02   +1.236485098783633e-01   -6.222602757943885e-02   -1.375989336647191e-01   +8.201363554456254e-02   +6.029891242798888e-02   -2.818926266832546e-02   -1.317926383032416e-02   +1.019046735304886e-01; -6.623407917371124e-02   -1.531382979078348e-01   +4.855211123405496e-02   +8.915924002403762e-02   +2.953980541118173e-02   +3.611499265713493e-02   +1.143775853748331e-01   -7.033513023387006e-02   +9.324921785717939e-02   +1.978637201488326e-02   -2.552562048303808e-02   +1.879324551220005e-02   +1.086111652216523e-01   -1.333325136997451e-01   -2.205982956670491e-02   -1.690082011930522e-01; +4.830056467167210e-02   +1.351912740594161e-01   +1.829485297430623e-01   -1.183982519838268e-01   +6.899420653680378e-02   -1.519291915284639e-01   -5.643159386188386e-03   -1.155197972470660e-02   -7.104836598137909e-02   -2.937320149291251e-02   +1.224103963625862e-02   -7.033951337903582e-02   -5.066417830714309e-02   -1.281881099781088e-02   -4.776058865316769e-02   +3.796329711072563e-03];
L2I_L1I_iGABA_netcon = [-5.491235573329276e-02   -6.260927313098015e-02   -5.520921576995802e-02   -1.266954066927176e-01   -5.015600385774902e-02   +5.991291392521542e-03   +6.766306717895099e-02   -1.423917209382007e-01; -7.680477862339878e-02   -4.726558775961612e-02   -4.079906317728167e-02   -3.192764458804791e-02   +2.496930265856282e-02   -4.017675121871163e-02   +1.107137570792540e-02   -2.609742746562520e-02; -1.279224720334489e-01   +5.334187005776733e-02   -6.072090413747928e-02   -6.852933364957632e-02   +2.233683312439858e-01   -5.522007674241729e-02   -5.972696309020106e-02   -1.400415160064211e-01; -1.337309033485294e-01   +8.170459151026752e-02   -2.259545494193503e-01   -1.282269261092832e-03   +3.808122862646989e-03   +1.713532720634241e-02   -4.066330783443504e-02   -9.917254552402351e-02; -6.897512480814763e-02   -1.132717359411355e-02   -7.917378474116096e-02   +8.635690256570509e-02   +3.775779021849689e-02   +9.091697121464035e-02   -8.716931258869844e-02   +1.271996597575088e-01; +1.185958104901370e-01   +4.848786866989267e-02   +5.073400009646694e-02   -2.881461469035385e-02   +1.442119560064437e-01   +7.625972380927552e-02   -1.228576813308246e-01   +1.412500364270750e-02; -1.131387856000197e-01   +9.571805424000647e-02   -1.924502485504661e-01   -1.680444306250733e-02   -1.998540373145209e-02   +4.443782509600044e-02   +9.374200262061513e-02   +4.032616678562027e-02; +5.371381196009221e-03   -6.753334507788586e-02   -1.801938539722847e-01   +4.886728255686772e-02   +4.531533510520641e-02   +3.886664372115805e-02   -9.125026163447114e-02   +1.231116565051853e-01; -1.717525886477759e-01   -1.041672674215839e-01   +9.534716347116330e-02   +9.628190812204614e-02   -2.252791916787645e-02   +1.852081943937590e-02   +1.260157203207325e-01   +1.622814279535196e-01; -9.775000892062909e-03   -2.821190217720402e-02   +5.122268746467128e-02   -6.485874416844181e-02   -7.292167989697847e-02   +1.453557458602230e-01   +3.450394517953444e-02   -1.203178181213607e-01; -1.188683685259774e-01   +1.049098882898781e-01   +1.737872254486864e-02   +1.994035262937445e-01   -1.350151832668987e-01   -1.382401017899193e-01   +3.734905930511657e-02   +1.061877945501851e-01; +8.404348442162939e-02   +8.228563627306767e-02   -5.222553163793223e-02   -1.726020479474126e-02   -9.756699567750540e-02   +9.928272922990153e-02   -5.576339507977528e-02   +5.664038110893333e-02; -8.755022273399538e-02   +1.637523289467882e-02   -5.550119927047888e-02   +2.278817485566908e-02   -1.412453060745392e-03   +1.555894838926283e-01   -3.600952704159380e-02   -7.861968564433337e-02; +1.262489571824628e-01   -7.929400994247510e-02   +4.513693506993518e-02   +1.376171293864003e-01   -1.446186931908118e-01   +7.564874928806321e-02   -1.048788629975583e-01   +7.895116369998766e-02; -1.899821737152883e-02   -1.001450358364572e-01   +7.661456239751804e-02   -6.022524730769618e-02   +4.929004600517401e-03   +1.287618610220127e-01   -4.762464869103231e-02   -2.043307548394804e-02; -1.690120551393873e-01   +8.750789276085367e-03   -7.286889044467781e-02   -5.903485261708430e-02   +3.428663705835083e-03   +3.355317720183185e-02   +9.581704509901045e-03   -3.027953957075754e-03];
L1I_L2I_iGABA_netcon = [-3.715880401896694e-03   -5.492874468257930e-02   +5.514706750999025e-02   -1.096467287229863e-02   -1.689614127336960e-01   +2.756907234065352e-02   -2.450968517106846e-02   +1.619672689231751e-01   +1.040570102669610e-01   +2.395042254578518e-04   +4.428741177020272e-02   +4.143246138613038e-02   -2.724521093988381e-02   +2.970388487253262e-02   -1.252473749796026e-01   +1.390520589377240e-02; -1.580260522091330e-01   +6.342179140815302e-02   -4.480812262168778e-02   +7.427956344069887e-03   -8.856004059746325e-02   -1.494456912725694e-01   -9.228358986989861e-02   +1.783803786913547e-01   -5.634955749453958e-02   +1.511751496967659e-02   -1.110076705933225e-01   -2.167156914842092e-01   +1.692249782397676e-02   +1.477634620712179e-02   -5.111987078591323e-02   +9.353299367426694e-02; +3.606027187494137e-02   +5.235116784747754e-02   -9.950708586441620e-03   -7.590543072901221e-02   +9.041904435465123e-02   +4.066501282733830e-02   -3.061331591182158e-02   -2.907168877710635e-03   +4.110355831238752e-02   -9.118594256494275e-02   +5.488467562882574e-03   +9.825934052386506e-02   -4.070885571747694e-02   +1.128721398420205e-01   -8.125493971864120e-02   -1.390228689723330e-02; -2.678654676428619e-02   -1.149791916819984e-01   +4.795665797815474e-03   +6.552918085650228e-02   -1.460583014063470e-01   +6.305575254043654e-02   -9.671418339098817e-02   +9.966022747242087e-03   +1.308434486688504e-02   -1.426608175949743e-01   -7.632119220678045e-02   +6.784917737875235e-02   -8.251720192609059e-02   -3.340526960482682e-02   +4.402158683956391e-02   -1.760461046788015e-01; +1.034275212353831e-01   -3.146443230938076e-02   +4.879490329487778e-02   -5.459905808965895e-02   +6.324993796478245e-02   +8.047215564868894e-02   -2.021989364134876e-02   -7.001499908444363e-02   -8.753193754489969e-02   +6.524953757242502e-02   -3.764729134106903e-02   -5.464613080246065e-02   +4.977004093233273e-02   +5.900324779691808e-02   +2.491446181252879e-02   +4.637187991586193e-03; -1.894608873537191e-01   -3.033304210620232e-02   +6.685260735927174e-03   +7.418810542627213e-02   -6.308911779695175e-02   +1.261717189367405e-01   -1.990333301226983e-02   +1.152874755779857e-01   -1.034827836712826e-01   +5.757079064640515e-02   +3.802994551515815e-02   -1.047445577287878e-02   +4.144623074152768e-02   +9.832041438730027e-02   -1.028857051799875e-01   -1.499122821031905e-01; -9.657430852412739e-02   +6.972341462667609e-03   -5.532018705552059e-02   -9.834281718136681e-02   +2.070626628566080e-01   +1.234187634983561e-01   +3.459440386365760e-03   +2.208570967435167e-01   -8.211829299046761e-02   -1.308049507240913e-01   -5.581736540889252e-02   +1.296239819485919e-01   +8.151558215139024e-02   -2.344293802374147e-02   +1.092057758855366e-01   +4.484772739000434e-02; +8.055874232328789e-02   -1.651011143919058e-01   +9.531760424139087e-03   -9.476046718126704e-03   -5.760993154384879e-02   -3.630808077737881e-02   +8.118319388745321e-02   -3.694579691373715e-02   +1.665144132589942e-02   +1.189427741797290e-01   -7.041746108166574e-02   +1.538978525795867e-02   -5.901692592035863e-02   -3.604623536286717e-02   -1.049161922628913e-02   -1.307283650180483e-01];
L2E_L1E_iAMPA_netcon = [-1.745813492740314e-01   +7.493841517725862e-02   -4.187782224006208e-02   +8.736327135666044e-02   +1.992953592749809e-02   -1.835753100481938e-01   +4.192751841597026e-02   +8.390646269369867e-02; -4.148269016018026e-02   -3.690001000208550e-02   -8.438656953629470e-02   +5.099841626552473e-02   -3.251765322577693e-02   -8.611580922215398e-02   +6.879929301127741e-02   +2.269118529228361e-02; +1.470282252762903e-01   -1.309867688043071e-01   -1.254756770609617e-01   +4.830945538265650e-03   -5.162089549858912e-02   -8.744199122008139e-02   +1.026616710874703e-01   +4.930266676069479e-02; +7.344722783804999e-02   +1.163813994353588e-01   +4.028750333546853e-02   -1.747606127026499e-03   -7.701894877829690e-02   +1.289254710581459e-01   -4.016924185657022e-02   +1.873129985451536e-02; +4.283346156061594e-02   +1.049292594402540e-01   -7.999839917146982e-03   -4.825264193821234e-02   -9.088664968926727e-02   -4.083679333177304e-02   +1.167027647812790e-01   -3.094287303597507e-02; +1.102037126106878e-01   -1.099342937286452e-01   +1.859526779445445e-02   -8.802240630020967e-02   -6.179967559729629e-02   -5.178624650773173e-02   -1.108661937022519e-02   +1.394901272165857e-01; +3.893262208949479e-02   -3.535715640110022e-02   -8.824098270935131e-02   -3.748779094048039e-02   +5.598212870963068e-02   -5.224154965154779e-02   -2.256464661965574e-02   +1.533095444785592e-01; +1.215755968462657e-01   +3.223548905172287e-02   +3.538399241936230e-02   +5.812532891536293e-02   +9.016715016223002e-02   -6.030343167488481e-02   +1.267801442129055e-01   +6.742188714560007e-02; +2.361883980613467e-02   -2.651094841149640e-01   -4.774698694503345e-02   -7.766242532608696e-03   +8.811878397556068e-02   -7.103590090071984e-04   +4.744438019645270e-02   -1.486656352477423e-01; +1.017529254888555e-01   -1.278118264389042e-01   -6.851634025582186e-02   -4.609454482763518e-02   +3.978089875581051e-02   -1.225355038277944e-02   -1.030897948878090e-02   -4.027997866927502e-02; +1.057557634830505e-01   -4.870119232739283e-02   -7.307766767884679e-03   -7.978848130109220e-02   +1.881142105080954e-01   -9.575458399247841e-02   +2.201237449688016e-03   +2.064130926493455e-02; -3.299772237543002e-02   -7.456944622685426e-03   -5.866967471147448e-03   -9.922717933434504e-02   -1.832419767511162e-01   +6.435815795919481e-02   -2.151151097590179e-02   -1.513560276881546e-01; +6.821813414342567e-02   +1.081846554675056e-02   +2.184286592889361e-02   -1.738631831576399e-01   -4.757962346110224e-02   -1.993925924229951e-02   -1.200244616414774e-02   +1.127723357748107e-01; -1.151597831166684e-01   +8.074420184830122e-02   -9.725543931796364e-02   -8.696859828933065e-02   +4.229034957934982e-02   -6.804138355800492e-02   -2.140135223369867e-02   -1.146255331020096e-01; +9.306505902748806e-03   +5.541958071969372e-02   +4.284618128171606e-02   +4.969410152536242e-02   +4.473705698535242e-02   -7.144038513596558e-02   -7.683754748128019e-03   +1.663759450975200e-02; -1.376631303890035e-01   -2.338577217965236e-02   -2.014114811178254e-02   +5.241236626697342e-02   -1.250470210037957e-02   +1.742619258836148e-01   +3.561783925346122e-02   -1.030628777404485e-01];
L1E_L2E_iAMPA_netcon = [-4.376844631144851e-02   +1.163080644224218e-01   -1.372216184420372e-01   -2.063820354310109e-02   +3.188937169989013e-02   +1.041172301368942e-01   -3.018649550391962e-02   -1.688184147665884e-02   -1.128117213139553e-01   +4.612007739257230e-02   +1.826268371437284e-01   -4.140976797076396e-02   -1.298071532945445e-02   -3.616567881269959e-02   +4.686631334676662e-02   -1.191537660486140e-01; -3.207059241281627e-02   -7.799340062027228e-03   -5.776393970345602e-02   +9.675590196932525e-02   +1.686323549860658e-01   -2.328571369221270e-02   -2.497270333318686e-02   +9.246706044256894e-02   +7.303501177518583e-02   -5.321314439096470e-02   +5.858401124071555e-03   +4.905260470222937e-02   +3.438221243884539e-02   -7.075198136098736e-02   -1.228901744918712e-01   -1.410326127127391e-01; -2.757661829816464e-02   +3.152339393868295e-02   +1.018484587341955e-01   +3.522794087015850e-02   -3.985837132019175e-02   +9.744079748005726e-03   +2.251665743209629e-02   -2.885885084930119e-02   -1.315400702489475e-01   -4.967728533991911e-02   +7.093923913987540e-02   -6.636701490027540e-02   +1.591931975301021e-02   +2.294351302182381e-01   +1.847311199160678e-03   -1.392305650142446e-01; +1.183175557138628e-01   -6.199750681397559e-02   -7.226001023615157e-02   +9.385898014494208e-02   -6.257508487082084e-02   -9.936685975312070e-03   +7.758052519253249e-03   -1.460294324441492e-01   -2.308704626623181e-02   -1.093375171589058e-01   -5.358140654431395e-02   +6.764997324787482e-02   +1.675920861616701e-02   +9.252996910542136e-03   -8.807556010215321e-02   +4.456271237189806e-02; +2.337955969884424e-01   -1.050404069676167e-01   +6.234337219814408e-03   +1.461393795432274e-03   -1.718255494116911e-02   +2.757212711582349e-02   -1.306698907476718e-01   -2.951183931203568e-02   +3.369425461671496e-02   -1.923854799849360e-02   +1.472589322133221e-01   -8.021954342097055e-02   -6.061429601454148e-02   -3.281116006421197e-03   +9.459264203841072e-02   -9.785285675303415e-02; +8.902518264139414e-02   -5.642589913760383e-02   +6.949731352708574e-02   +1.132868982815514e-01   -2.901523281676010e-02   +1.469714582090300e-01   +4.606525519965575e-02   -5.923130965909307e-02   -1.424289727180807e-01   -6.789651834510987e-02   -1.415693989074341e-01   +7.838329745829864e-02   +9.951329038816498e-02   -3.309313284911859e-03   +1.155691670602580e-01   -2.623942469505744e-02; -4.597481434633219e-02   +7.331663930886027e-02   +8.299763342483522e-02   +1.317122939576938e-02   -1.061874621197668e-01   +3.202064142986867e-02   -9.348407619729363e-02   -9.916876957481942e-02   -1.554119771103908e-02   -1.377907855018067e-01   +1.010874897346399e-01   -4.756538472196267e-02   +4.476714218825482e-02   +7.520720438653189e-02   -1.279183406060751e-02   -2.040616421893746e-02; -1.222410378137744e-01   -7.173348869628705e-02   +3.551167064170142e-02   -3.796198987264184e-02   -4.372389659888370e-02   -7.256661201882607e-02   +3.732624313860469e-02   +2.665529637202090e-02   -4.861802106886998e-02   +6.302901161313941e-02   +1.227488705238371e-01   +6.413886156703291e-02   +5.764300240760909e-02   -1.053285754705530e-01   -1.543189391995517e-02   +1.509595612328543e-01];
L2I_L2E_iAMPA_netcon = [+2.044593190799998e-01   -8.649800634262006e-02   +2.810974337982377e-02   -8.211193096331575e-02   +4.051418859849337e-02   +6.662215066481482e-02   +1.898399555009553e-02   -6.427243580385227e-02; -1.845785499721532e-02   -1.056554313431183e-02   -1.053560003274148e-01   +1.173901796345628e-01   -1.204376390877189e-01   -4.535758920884749e-02   +1.931554273613227e-02   +2.139090153745166e-02; -3.415407272202674e-02   +3.130775726197815e-02   -8.566813004018316e-02   -2.933921456134277e-02   -1.339344478828856e-01   +8.787895720172971e-02   +1.457267790372112e-02   -1.316655751418788e-02; +6.923172084254077e-02   -1.015815904355514e-01   -9.198378854098148e-03   +9.365720475176120e-02   -8.688576314168960e-02   +8.130920743748191e-02   +2.020764376592698e-02   -5.214665487366785e-02; -3.776704904034855e-02   +1.164959453996177e-01   +2.874681300961717e-02   -1.756261579088690e-03   +1.150677501545815e-02   +1.173225745048630e-01   +1.585163952485065e-01   +1.166557367676827e-01; +5.353884219418630e-02   -1.193172162333142e-01   -7.150623533984961e-02   +1.701322514117362e-01   +8.976359545357250e-02   -7.640476157936807e-02   -1.148573295090647e-01   -6.291585708217816e-02; -1.151918978416807e-01   +6.860365334754992e-02   +4.601589850534676e-02   -3.811279643165457e-03   -1.117537616373597e-01   +8.012172697031272e-02   -4.274860314719474e-02   +2.186605521178635e-02; -8.835508398130558e-02   -7.031945854153647e-02   +6.151468398840744e-02   -2.143704627361664e-02   +1.007295994168556e-01   -7.019696539020542e-02   -9.391970847787640e-02   -1.842038293111470e-03];
L2E_L2I_iGABA_netcon = [-4.557965757910308e-02   -8.460556465626416e-02   -1.126205898957266e-02   +1.561053887537271e-01   -1.766336774315364e-02   -1.587569102912946e-02   +5.030723707297706e-02   -2.507237325367722e-02; +1.112066314936032e-01   -1.224912650890010e-01   +1.714327840047616e-01   -2.722867426401113e-02   +8.508389803890992e-02   -3.983850152149586e-02   +1.859605285978331e-02   +1.134344496898422e-01; -1.808596229885961e-01   +2.036883403558996e-01   -2.299652933780073e-02   +1.065528353839391e-01   +7.942182152652655e-02   -6.825665852648756e-02   +1.038592430648492e-01   -4.750663404791015e-02; +1.019259840747283e-01   -1.972535787070330e-03   +8.498520143280779e-02   -8.662923776585055e-02   +6.502069751641745e-02   -1.415354579181489e-01   +1.395230133091218e-02   -5.893168739936339e-02; -1.004349447696928e-01   -6.743687092533360e-02   -6.883706646899325e-02   -7.960173821116152e-03   -3.917789700447390e-02   -2.744060618937242e-02   +2.666822155908223e-03   +4.923897872578623e-02; +1.294865079254481e-02   -1.485441313812781e-01   +9.233484826570823e-02   +3.431162340964960e-02   +1.403503760016394e-03   +1.946277837669060e-02   -3.025945258749708e-02   -1.955810881823016e-02; +3.718999089105435e-02   -4.837061034198013e-02   +1.062003371963685e-01   +1.679397660966296e-01   +8.787436270375565e-03   +1.073158135531897e-01   +9.656343099195172e-02   +5.095099021256533e-02; -8.206410274514683e-02   +1.708158541535072e-01   +3.242847505231471e-02   +2.507162827827219e-02   -8.195749535570537e-02   -5.132985730059464e-02   -6.547010738726412e-02   -1.479423244835840e-04];
L3E_L2E_iAMPA_netcon = [-5.321943285041141e-02   +2.630961515632662e-02   +1.491799351642259e-02   -2.033930745638093e-02   +1.293332472929614e-01   +4.537902066044496e-02   -6.108442968973406e-02   -2.244606080294223e-02   -1.302600239456262e-01   -2.721551596917997e-02   +8.951449253729500e-02   +8.628851974658339e-02; +2.781140885217051e-02   -1.980224896234128e-02   +1.016443322417842e-01   -4.446205636468575e-02   +7.650539954488968e-02   -1.207683339104576e-01   -1.419763823179295e-02   -1.975622939190697e-03   +1.232836947293167e-01   +3.923435975589415e-02   -7.071816146662599e-02   -1.277085229278059e-01; +1.017987435843329e-01   -8.328875365043016e-03   -7.970264748076288e-02   -2.820381429524890e-03   +9.203549356110324e-02   +6.895564761060931e-03   -1.436421206176865e-02   -4.189597165312510e-02   -1.001469446113076e-01   -5.577891638449420e-02   -1.387115501795484e-01   -4.854336517202435e-02; +2.051206031430979e-02   -1.407341004220128e-02   +9.009284825743402e-02   -3.399491076413932e-02   +8.121428675951829e-03   +1.041046035966265e-01   +7.204890443930055e-03   +1.422549576157729e-01   -3.806918934025809e-02   +1.036131578746598e-01   -1.082305117735679e-02   +4.873984668276522e-02; +1.136204795589996e-01   +2.407648546031342e-02   -8.488961827517302e-02   -6.825363703681368e-02   +1.466992347162309e-02   -3.037362418030844e-03   -6.229544817145114e-03   -1.466754070525105e-01   +1.004850601562742e-01   +3.098212768443256e-02   +7.613381398869504e-02   +7.587014064351295e-03; -1.717710391295864e-01   +1.025900599373574e-01   -1.333561727360645e-02   +9.050908816329661e-02   +4.961935585173453e-02   +1.035187586416529e-01   -2.208126169915037e-02   -4.498271881449296e-02   +1.162472624331862e-02   +5.026780613634093e-02   +1.293111197197318e-01   -8.619653635198504e-02; -3.005822685603532e-02   -8.497924671303601e-02   +1.475125790913240e-02   -1.110929608894084e-01   +1.270882560516013e-01   -1.041732547443717e-01   +9.562253630115629e-02   +6.317822346631370e-03   -7.022213967848345e-02   +8.807174354714498e-02   +2.990510225194045e-02   +6.508893361027793e-02; -1.521638929399255e-01   -1.358111360826587e-01   +8.871666329955695e-03   +3.417873980195614e-02   +2.314679900066633e-02   +1.266986435446101e-02   +1.124215413988459e-01   +9.780708682274804e-02   +2.433582878104078e-02   -3.365124292655465e-04   -1.026194879561984e-02   -1.094990133406344e-01];
L3I_L2I_iGABA_netcon = [+8.383507916832897e-02   -8.412127844536248e-02   -1.964084390511385e-02   +1.387245697796220e-02   -6.413422936112191e-02   +2.049528076164353e-02   +6.509036351117015e-02   -3.268632144052570e-02   -1.594901230582559e-03   -1.040577074459396e-01   +1.044795882641919e-01   -9.394648507669103e-03; +1.192939006846854e-01   +8.412941182589177e-02   +6.378266906448417e-02   -6.742115875008481e-02   -4.296039137497416e-02   -5.754200761340738e-02   +7.259850605758947e-02   +1.051402602245308e-01   +5.962578527300097e-02   +1.802309193804662e-03   +8.781456296232119e-02   +1.846721066185685e-02; -1.162902818050965e-01   -1.575258865295450e-01   +7.418932238230586e-02   +1.326064393306677e-01   +1.156509151779473e-01   +3.760812176433613e-03   +7.680739782383544e-02   -8.676666642131692e-02   +7.857924453641060e-02   -1.121853607335196e-01   +8.110232561580728e-02   +5.402998734694044e-02; -8.242683068758130e-02   +1.399096865606899e-01   +4.729078984937914e-02   -8.282836821105206e-03   +7.241160591474899e-02   -9.001688235150003e-02   +1.189330621974266e-01   +5.517227933766540e-02   +2.255112447113632e-02   -8.490214188560170e-02   +6.756627108802787e-02   -7.920436092088347e-03; +7.999860601734678e-02   +3.912547953404975e-02   +1.230174523121134e-01   -1.806407924506761e-02   -3.869417531560891e-02   +1.417637324875938e-01   -4.829305296868595e-02   +2.055174953504402e-03   -8.420845385647707e-02   +5.326657874238366e-02   -3.779595455629833e-03   +6.951886425753782e-02; +7.125292789451890e-02   -1.256588631449554e-01   -1.655039223673531e-01   +1.943067212781466e-02   -1.265524650374938e-01   -1.304048613481006e-01   -1.249009085894806e-02   +8.267664572978239e-02   -1.355952880126182e-01   -8.523712828231625e-02   -2.848698869410214e-02   +1.094958382254518e-01; +1.469730960091599e-02   +1.135950307455134e-01   -1.075340214432651e-01   -5.722272303924204e-02   -1.517589503375962e-01   -2.552156706141610e-04   -9.883455623977527e-02   -4.916764477109661e-02   -5.727215946505892e-02   -8.030601929011846e-02   -1.261462772127627e-01   +6.243943328384342e-02; -4.314181183111518e-02   +7.228131391070386e-02   -4.284648518701921e-02   -9.011818231952254e-02   -2.187289075916746e-02   +3.153480459759846e-02   +5.730646730041601e-02   +1.354444970790984e-01   -1.431506846127018e-01   -9.082360450344357e-02   +1.152220296684843e-01   -5.191687922967151e-02];
L2E_L3E_iAMPA_netcon = [+1.120785146622587e-01   +2.527719132061981e-02   -1.691570866391952e-01   +2.505516022551604e-02   +2.119045638246308e-02   -8.776838121096425e-02   -1.629408335897652e-01   +6.179343436530164e-02; +5.172110130402521e-02   -8.480069430990796e-02   -4.167148477305790e-02   -1.418254928681782e-01   -1.490782359344720e-02   -5.182917680472004e-03   -3.004464104078312e-02   +1.807436749344693e-01; -1.322917405397607e-01   +1.603804575457466e-01   -2.501394054359744e-02   -3.932495898090342e-02   +4.214606165513549e-02   -3.818726169077008e-02   +4.278146535114780e-02   +9.259413917646805e-02; +1.603362222421435e-01   +1.921543983435435e-01   +7.608362537155113e-03   -2.601025974825539e-02   +4.137068415947122e-02   -7.012681020822320e-02   +3.116499362702695e-02   +1.024866287394524e-01; -5.855194507800357e-02   +9.252442004517999e-02   -2.505525811337669e-02   +8.557880349534315e-02   +2.481080910111726e-03   -9.315398890718228e-02   -1.375421328496070e-01   +7.722365995566336e-03; -1.543940406773931e-02   -9.191484070957505e-02   +8.261687753133444e-02   +1.127306350549718e-01   +8.886762223523292e-02   +2.206691181863202e-02   -6.072301509145342e-02   +1.184902967146339e-01; -5.008024474388382e-02   -9.881607251977931e-02   +1.278267056725469e-01   +6.889144559019475e-02   +1.602758996139134e-02   -4.654696758218092e-03   -6.460464657916495e-02   +6.746252523748024e-02; -5.813407709243915e-02   +7.030731248439245e-02   -2.854725997860544e-02   +2.956425183440927e-02   +2.230730204790479e-02   -7.289778414308933e-02   +3.706390289383278e-02   +1.282790277293020e-01; +3.740553751701492e-02   -1.101460091452708e-01   +9.796794905036096e-02   +9.216104451902575e-02   +1.015458141437798e-01   +2.344451331139265e-02   +5.306819026898583e-02   -9.433079094691314e-03; -1.652303187852188e-01   -1.244233599062791e-01   -5.365181984656798e-02   -4.998211404558874e-02   -1.874959468553061e-02   -6.269196008665302e-02   +3.681585234733929e-02   +6.871725431125195e-02; +1.942995099892532e-02   +5.191174689519153e-03   -9.173784335324027e-02   +5.845008034757741e-03   +2.883387825920790e-02   +4.713101326427129e-02   -2.553595759760008e-02   -2.846487381344177e-02; -1.177436196266126e-01   -5.796683210075534e-03   +9.822005015180992e-03   +5.266059433668410e-02   -2.607604516290640e-02   -7.539695339686553e-02   -2.146713750949786e-02   -1.244263915495219e-01];
L2I_L3I_iGABA_netcon = [-6.760909047340555e-02   +4.475663522050564e-02   +1.209607966461850e-01   -1.167824127898609e-01   -8.603358611790339e-03   -8.095802534855914e-03   +7.108121192833146e-02   -5.527717528990712e-02; -7.031379117660017e-02   +6.091244760493886e-02   -4.102731340868231e-02   +2.712711317582677e-02   -6.314103056848409e-02   +3.167590747525630e-02   +2.085212308903815e-01   -1.613885556668730e-02; +1.081858635728623e-01   +2.330372145119885e-03   -4.029426722233997e-02   -1.406776308481556e-01   +4.710051127681048e-02   -2.967084157750381e-02   +1.645790999200336e-02   +8.736298550138738e-02; +2.050863615166633e-03   +1.193571827208433e-01   +3.681920039679953e-02   -7.429837433912839e-02   +5.723563278158014e-02   -5.290251739077968e-02   +1.091421606570343e-01   -1.441734500012127e-01; -9.248426565375761e-02   -6.368160683280302e-02   -1.071617354312173e-01   -5.951494141424457e-02   +7.493812962377286e-02   +3.561166720910068e-02   -3.031711618964577e-02   +1.610097566359403e-02; +5.179762022152188e-02   -1.562973299915596e-02   -5.032369174463937e-02   +7.953171451727270e-03   +8.698083858082052e-02   +1.185128967312668e-01   +1.116452427690590e-01   +4.178803624019786e-02; +3.638782823398792e-02   +2.201791020766039e-03   +7.490754427924738e-02   -9.082678590437161e-02   +2.796784783829138e-02   -2.296769714761544e-02   +2.185351875811096e-02   +3.376378104772369e-02; -3.476762755990997e-02   +1.952027019441145e-01   +3.016605424838793e-02   -3.702562501093210e-03   -6.442730752039126e-02   +1.401100853598477e-02   -1.020533932135419e-01   -9.763889293158504e-02; +1.516254602218607e-01   +8.211381461425385e-02   +1.777343506726931e-02   +9.197439817340419e-02   +3.694952593604110e-02   -2.752480190218053e-02   +1.815166539627870e-01   -1.033531990233066e-01; +1.070664836889890e-03   +2.009463595131065e-03   -3.864780024245457e-02   +4.662819073615675e-02   -7.838956739742613e-02   -1.481688811260145e-01   -2.018729186793219e-02   +3.302886882546390e-03; -5.184633274851638e-02   -4.388099393641200e-02   -1.995307259573761e-02   +3.341444142665410e-02   +7.410891846127104e-02   +9.836971003218317e-02   -3.651864898058070e-02   +1.974721006932901e-03; -9.180967501445869e-02   +1.364618289626343e-01   +1.987313629432132e-02   +1.408058543215277e-01   -5.398219724494819e-02   -2.909253898519905e-02   -8.401361630542880e-03   -3.603583119212393e-02];
L3I_L3E_iAMPA_netcon = [+1.085925939448604e-01   -3.463680248602975e-04   +2.102497394873731e-01   +4.960840131542512e-02   +6.155481996414309e-03   +1.222591994000776e-01   -1.503978910120486e-01   -6.085576466868659e-02   -3.893359750967523e-02   +2.226338390198821e-02   -5.590857216188668e-02   -2.489128388954848e-04; -5.305410290801007e-02   -7.112018029443015e-02   +1.755692394554508e-01   -1.067708881405803e-02   -2.097460057032643e-03   -2.640493816031895e-01   +3.749375194903876e-02   +1.682693548881059e-01   +1.941354971566869e-01   -5.443802493743919e-02   -8.200334134780181e-02   +4.547197866067481e-02; -3.560753888388504e-02   -1.214231056494147e-01   -1.682347486158227e-01   +2.655264957675936e-03   +1.300127302912775e-01   +5.446284581092087e-04   +3.673651729544156e-02   +5.870043742114867e-02   +8.731838851932624e-03   -4.947374821866474e-02   -6.759963616287806e-02   +1.336420195072041e-01; +2.495824075796007e-02   -1.672597067041050e-02   +1.536975876605290e-01   -2.608564129416513e-02   -7.002568896676453e-02   +1.063766112461901e-01   -1.097380013738778e-01   +4.337311827891033e-02   +5.782404373860059e-02   -3.436226328506265e-02   -5.162162263277295e-02   +1.459855322147104e-01; -7.138454320015317e-02   -2.038323552955252e-01   -1.184339470556779e-01   -1.516599713363188e-01   -4.023214399234014e-02   -9.509693282837881e-02   +1.103725538890761e-01   -1.397388350295073e-02   -5.811054855613180e-02   -1.749648930883669e-01   -6.094252017806349e-02   -9.163208903471000e-02; +7.192102180992975e-02   +1.161564523583974e-01   -1.038756521920640e-02   -1.156595036296704e-01   -1.427049496292809e-01   +6.192703303963706e-02   -4.969802151289261e-04   -3.351222472261450e-02   -2.958233366775374e-02   +1.330138593010573e-01   +8.213190159742971e-02   -5.066035192855742e-03; -5.561635037189608e-04   -9.641089152732393e-02   -6.198561284251025e-02   +7.212014055512177e-02   +6.734039891388049e-02   -3.898653407966991e-02   +7.851074217049843e-02   +2.221853329770353e-02   +3.029931812844922e-02   -2.338012443938776e-03   +5.425613328161305e-02   +1.015078622388225e-01; +2.599313617921247e-02   -2.283445402528430e-02   +9.312741052930441e-02   +5.847905591453502e-02   +1.576913546545771e-01   +9.697492828852107e-02   +2.590365167065075e-02   +1.895205525160744e-02   +4.870642465497420e-02   -2.283625865522946e-03   +2.719844509406430e-02   +8.609401073107281e-02; +1.977960228722978e-01   -9.200999891292576e-02   +1.047212823734605e-01   -1.456022154465227e-01   +2.731352054459441e-02   +1.316164085816079e-01   +1.559660458906405e-01   +4.160924819884008e-02   -7.893576034709424e-02   +2.982396598470907e-02   +5.807951053367451e-02   -2.079413998271547e-01; +4.083973329782556e-02   -4.930090663438136e-02   -1.098019585622533e-01   +1.769823517827008e-02   -1.807281399685475e-02   -2.445195887732026e-02   -5.686712008144022e-02   -7.623605770144781e-02   -8.212557496839698e-03   +5.568621950000130e-02   +1.131969568317466e-01   +1.276104780856874e-02; +8.042500535864924e-02   +4.957303101544315e-02   -1.346030673042113e-01   -7.891836418923549e-02   +1.139491915211713e-01   -1.354658625863849e-01   +3.488429221792355e-03   +8.048886278193516e-02   +9.020901496917728e-02   -3.909677000994063e-02   +1.222835840509010e-01   +3.877727829985100e-02; -1.114887436357095e-01   +1.269827768875914e-01   -1.485806449718519e-02   +2.961874792766425e-03   +6.440216549653266e-02   -1.408515219923506e-01   +4.785823735718786e-02   -1.211066954540082e-01   -5.895778869845633e-02   +1.510618535032916e-01   +1.291814946318132e-01   +7.467997440527148e-02];
L3E_L3I_iGABA_netcon = [-3.078792872169701e-02   +2.690434470901153e-02   +1.260308321421583e-01   -6.168370330296284e-02   -1.303397628167435e-01   -1.186271138171065e-01   +4.273195385240336e-02   -6.383386302441174e-02   -6.332674076519537e-02   +3.025789564756185e-02   +2.837370262537036e-03   +7.210184525260292e-02; -8.072198913482603e-02   -1.182576516115298e-02   -6.884507796328400e-02   -7.425369937514754e-02   +1.791633527955005e-01   -1.762872985651641e-02   +6.713745070245199e-03   +5.581482072154369e-02   -8.128136484970511e-02   -1.192719107460998e-01   +1.924905109270097e-01   +2.738060417571136e-02; -9.018759827781578e-02   -3.363850039795666e-02   +8.323570938284068e-02   +4.060164658674802e-02   +8.801331875898341e-02   +6.749213652224778e-03   +2.939540690906559e-02   +9.696679669591243e-04   -5.259725761159648e-02   -9.618235545201390e-02   -8.646025719378701e-02   -2.770967501769967e-02; -9.026749838812760e-02   -7.415183275151900e-02   -1.017747573670042e-01   -2.313545130497702e-02   -9.937940888836948e-03   +1.528610110002597e-01   +1.713930136683409e-02   -1.552771586294596e-02   +6.234543810907640e-02   +2.080280955284741e-02   -9.848201630510278e-02   +3.644483278701502e-02; +4.278096868447936e-02   -1.891936098019331e-02   -1.095298512364219e-02   +4.820071085508739e-02   +3.616390338911599e-02   -2.754571238369192e-03   +3.911107215074313e-03   -1.157053717090400e-01   +8.781196727518968e-04   +2.050859541153154e-02   -1.268282450488079e-01   +2.079978917892973e-01; -3.218356068166600e-02   -3.398244906030233e-02   +1.120759329657700e-01   +4.608887783044277e-02   -4.197172791617815e-02   +2.095414991620723e-03   +2.591127881710316e-02   -1.243929618468920e-01   -8.720521923780633e-02   -2.212736491550608e-02   -6.083665916589447e-02   -9.701751855555860e-03; -1.298613645266993e-01   +2.758150283970031e-02   +5.924014320134714e-02   -1.408924794410520e-01   -1.389881472437075e-01   -9.923863144363367e-02   -6.679920481389584e-02   +1.617679186295247e-02   +3.060424986959344e-02   +1.731881636394411e-01   +1.865592367166894e-02   -3.595230433341225e-02; +4.922044226989976e-02   +2.772121349707201e-02   -1.177360288335267e-01   -9.037207739181621e-02   -4.093615375909279e-02   +1.180172313380908e-02   +3.225500645702847e-02   +1.952467293260115e-02   -4.992420123552145e-04   +9.281014169174145e-02   -8.516325014668434e-02   -4.759093246150538e-02; -6.808207083386723e-02   +2.005222643297150e-01   +6.307016337230478e-02   -8.507308412503786e-02   -1.535361635624424e-01   -1.815495991748282e-01   -1.541925007185216e-01   +8.077258462306385e-02   +9.376021890755319e-02   +6.784118307765358e-02   +4.505039581907556e-02   +5.439012506199536e-02; -6.737694809413991e-02   -5.371934704234849e-02   +7.009483493627077e-03   -4.236215582198233e-02   +1.253480160346665e-01   -9.765548380429080e-02   -6.470799896041030e-02   +1.715746898790038e-02   +2.331188463322413e-02   -6.288298064388959e-02   -4.809939901043243e-02   -6.664036821940646e-02; +8.419415113300399e-02   +5.268764053728093e-03   +6.451820382650953e-03   +2.507319763992070e-02   +8.224590729517605e-03   +1.522983741799594e-01   +5.203632599086479e-02   -6.393482329891784e-02   +3.197867615978349e-02   +7.291276804303973e-02   -6.852730592199306e-02   -3.490416377366103e-02; -6.561860262553142e-03   +7.935491733464486e-02   +1.136413892693220e-01   +7.401983395681010e-03   +1.565173667141038e-01   -1.948279933625105e-02   +3.423097606376065e-03   +6.723381862052688e-02   +3.275024861615619e-02   +1.453237902354538e-01   +8.776730744807412e-02   -5.880545349625235e-02];
L2E_Input1_iAMPA_netcon = [+2.509753595496031e-03   -7.317345077089550e-02   +1.324538822286780e-01   -5.499851159241702e-02   +6.330579742256860e-02   -3.107484395301378e-02   +4.344780904298488e-02   +9.234825191122363e-02];
L2I_Input2_iAMPA_netcon = [-9.383426597335254e-02   -9.658058319459442e-03   -1.010427723509482e-01   -1.932119283342171e-01   +8.621185678901300e-02   -8.262321037738321e-02   +1.834815510602176e-01   -1.146303094704006e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
