function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.428544569518859e-01   +6.555593569765318e-02   +1.162657095033437e-01   -2.099093369749960e-01   +3.227129968136635e-01   -9.827598760649912e-02   -1.865948509308520e-01   -1.533094514108153e-02   +2.354749752628553e-01   +1.424724620101525e-01   -2.030656945264200e-01   +1.897585222535356e-01   -2.459579816632918e-01   -6.308604824449598e-02   -3.006600733836270e-01   +1.389815891579219e-01; -1.516669783330580e-01   +3.887627599231502e-03   -2.140571434772316e-01   -3.605097494139684e-01   -1.527296122398545e-01   +3.452957564712895e-01   -1.476848186246411e-01   +7.650784408372721e-02   +4.896079732797143e-02   -3.568773046934777e-01   -2.115110019873444e-01   +4.430615893765874e-02   +4.877231948715299e-02   -3.143646309552592e-03   +9.228641709127565e-02   -1.604340648544099e-01; -3.573839091162122e-01   +2.258201220894116e-01   +1.120177850610301e-01   +2.481035385493150e-01   +7.880329464788337e-02   +2.727755123379777e-03   +8.201227036217000e-02   -3.282791553833420e-01   -1.935599827133588e-01   +1.213357360217974e-01   +1.507247230860599e-01   +7.558875368326547e-02   -2.853250836816246e-01   -3.988072819882139e-02   +1.144172452198211e-01   -2.354364579308465e-01; -1.047534899177454e-01   +4.580253676707804e-01   +2.294041234242110e-01   -1.273124681235280e-02   +8.301164487706596e-02   +4.215715585251661e-02   -7.955361537653574e-02   +3.811338224301629e-01   -2.563693031966404e-01   +1.004514445516790e-01   -1.976927225411173e-01   +3.357876757029111e-02   -3.443043587827045e-01   -6.440545507064591e-02   -5.137164677091752e-01   -1.716735280692731e-01; +1.842993664226948e-01   +2.336296614012001e-01   +4.734829699221565e-02   -7.296574610056730e-02   -4.024862440663501e-01   +4.022110365540306e-01   -3.882960392794240e-01   +1.404025883303251e-01   +3.382506440205629e-03   +3.171652060658978e-01   +1.734203768991593e-03   +1.473100441865967e-01   +1.675003762089373e-01   -1.430852710322686e-01   -1.645731582647228e-01   -6.071709671373798e-03; +3.414502919983552e-01   +1.908220479356580e-01   -1.677848222030796e-01   +2.923454558867371e-01   +3.738230613670572e-01   +3.881113196942615e-02   -8.977683069348491e-02   +2.820986626447202e-01   -2.051200252217524e-01   +4.199994659319578e-02   -4.273844137596914e-01   +1.824475297657399e-02   +1.060143534857189e-01   +3.882151818523489e-01   -3.604799739074270e-01   +1.825171881707659e-01; -1.592147860954502e-01   +2.401965463514713e-01   +6.218839641633901e-02   -4.130412515368150e-02   +6.075635171467900e-02   -1.278069780723805e-01   -7.877863259288688e-02   +3.904344452162969e-01   +1.965901517683870e-01   +2.492408259987273e-01   +7.305901394926004e-02   +1.979079154832358e-01   +3.234167707185862e-01   +2.337305141441777e-01   +3.665754705849911e-01   -6.381268701557820e-02; +9.122927988962007e-02   +1.293893349155975e-01   -6.454068354804236e-02   +5.203142987152151e-02   +1.848711468345466e-01   +1.385479402239381e-01   -2.970224959229421e-01   +7.309569870361243e-03   +2.000708986565249e-01   +9.555171369475837e-02   +2.181111952813988e-02   +3.075411454084469e-02   -1.764423461407176e-01   +3.641650172106146e-01   -1.224169534117815e-01   +7.776143096890764e-02; -6.499485625622353e-02   +2.844141368652726e-01   -1.689242914868573e-01   +1.058865171532110e-01   -4.947496084384715e-01   -1.630531115239629e-02   -2.518403878211863e-01   +1.101033997448678e-01   -3.862184058916059e-02   -3.463127702820781e-01   -2.193772137326719e-02   -4.601284764995208e-01   -5.229729459205568e-01   +1.972250791607165e-02   -9.326330252985368e-02   +1.662392005552862e-01; +1.459498104123287e-01   -1.219105090202977e-02   +1.588002890655157e-01   +6.828709636597317e-02   -1.632684991966972e-01   -1.835584786498769e-01   +1.459945372520033e-04   -4.631588875180070e-01   +8.960889792901536e-02   -6.343254822703680e-02   -1.850637169793357e-01   +4.657917002983260e-02   +6.571507024558484e-02   -1.965864777125357e-01   -1.533598839635507e-01   +2.083046991681751e-01; -8.924637556117650e-02   -8.127235033419526e-02   -1.227155016322373e-01   +3.137933466349591e-01   -4.515153111357464e-01   +1.213459753123984e-01   -1.315714193969109e-01   -4.452287983105666e-02   -4.154449175306641e-01   -2.167654158436409e-01   +3.240157630163090e-01   -5.570925135073188e-02   +1.493837462676283e-01   -2.080383697844238e-01   -2.506578461489389e-01   +2.166465196726356e-01; -7.489801979886526e-02   +5.313559777610806e-02   -2.340347183924368e-01   +2.492836142044039e-01   -9.717384409030010e-02   -1.370892727180628e-01   -2.064438627477684e-01   +1.054127940665502e-01   +1.407315542740025e-01   +2.950114569777674e-01   -7.134852288036654e-02   -2.714509465315762e-01   -3.988464260250525e-01   -4.326789954527768e-02   -3.438852865034040e-01   -3.516688534876585e-01; -1.113705805161720e-01   -2.413604976150236e-02   -7.997043751172880e-02   +1.351899762291594e-01   -6.664802829208813e-02   -1.217560485576481e-01   -1.782313546532025e-01   -1.105512895512575e-01   +6.928428985351899e-02   +1.056915665572636e-02   +2.491984200410430e-01   +6.854466791869121e-02   -1.245998555435844e-01   -5.388523527652067e-03   -1.586321224620833e-01   +2.993460154453946e-01; +1.888838918343302e-01   +3.766007405310693e-01   -1.363059603331570e-01   +1.285800449310474e-01   +1.824349217609727e-01   -2.188262366400112e-01   -3.038261511711351e-01   -3.559018311008155e-02   +3.005062342404262e-02   +2.182744008069659e-01   +2.047097757318283e-02   -6.885583097248986e-02   +3.553303312064812e-02   -3.103203994171388e-01   -1.467782457857074e-01   -1.421116087173807e-01; +1.651278370464594e-01   +1.564385088282813e-02   -2.436605511185771e-01   -2.640641522448010e-01   -4.108168840313445e-01   -2.108547972490949e-01   -3.768395706911339e-01   -6.384170746527187e-02   -2.383576520637043e-01   +2.410455104969205e-01   +7.914702261071157e-03   -3.465549845331777e-01   -3.265059159979335e-01   +3.134990724849130e-01   -6.171624985742852e-02   +9.283981664652455e-02; +5.988138138997691e-02   -7.490827788041420e-02   +4.677887243489847e-02   -2.336639261637594e-01   +3.006549107717096e-01   -1.309099847443675e-01   -4.400505119932924e-02   +2.337915263693400e-01   -3.796874018532972e-02   -3.269717677258357e-01   +3.328770512060121e-02   -1.579847547497559e-01   +2.672008877858904e-02   -2.850209956538123e-02   -4.729347814602420e-01   +5.776897493271939e-02];
L1E_L1I_iGABA_netcon = [+2.141361768872734e-01   +1.910202367537100e-01   -4.614535984288155e-01   -4.687646487045020e-02   +2.106524808587435e-01   +1.006765634034598e-01   +1.503584712580784e-01   -2.798095009168453e-01   -4.178061183976416e-02   -2.269844387493410e-01   +2.333089580680623e-01   -1.148647345470714e-01   +1.268761815369505e-01   -5.240139545364164e-01   -2.452195429110097e-01   +2.474177938489184e-01; +1.015367493260922e-02   +3.817169126753729e-02   +2.887516922261549e-01   -9.849821569237691e-02   -1.892939449880896e-02   +9.586115139288892e-03   -1.420854616180439e-02   +1.424826760457436e-01   +9.052888313800547e-02   -3.128125196754532e-01   -2.052634628534689e-01   -1.249852197895461e-01   +4.055624642277784e-01   +1.159173867303885e-01   -2.034589415221294e-01   -1.515015609694905e-01; -3.345686401702808e-01   +2.118909508971565e-01   -1.053009735089582e-01   -3.414707029398862e-01   -3.176348514616535e-01   +5.468925375395055e-02   +4.334763169893978e-01   -1.822528703784558e-01   -1.151810882058049e-01   +1.443445038209175e-01   +3.264551857866334e-02   -1.372614146420634e-02   -6.660186049570732e-02   -6.740948757731487e-02   -3.591446613726719e-01   +1.747658561208805e-01; -2.982146477286349e-01   +5.314474620478590e-02   +7.730581566053427e-02   -5.551551670547304e-02   +3.479610581645506e-02   +1.991564973177766e-01   +2.301093482016944e-01   -2.886455361231929e-01   -2.175617134231070e-01   -6.739013334013164e-02   +1.209649892065968e-01   +1.795248623213535e-01   -4.684513469280645e-02   +2.420309240422239e-01   -2.987228395396727e-01   +1.930491915453461e-01; -3.673516533258750e-02   -1.265205524087711e-01   -3.288015154999246e-02   -2.070315095935895e-01   -1.883991157077791e-02   +1.304305975691717e-01   -3.929065293901379e-02   +2.043432616837618e-01   -1.798652770772896e-01   +3.785224589630066e-01   +1.471694415258203e-01   +2.415494989920890e-02   +2.568568790785354e-01   +2.739995481615312e-01   -1.561104339228520e-01   -1.661318308903073e-01; -2.065669026784270e-02   -1.347879492977311e-01   -2.188068876847320e-01   -7.158585348510077e-02   -1.293002056979145e-01   -1.427392295574051e-01   -1.126535665303040e-01   -1.327676406636682e-01   -8.232815606296720e-02   +1.532152962253216e-01   +1.773724568232194e-01   +1.927213841205579e-01   +5.867180976066443e-02   -2.196338696341772e-01   -3.378335899191855e-01   -1.803676497257293e-01; +1.609737798935172e-01   -3.765264286006647e-01   -1.070713314184835e-01   -4.084809451430432e-01   +5.964113459633975e-02   +1.249731524374816e-01   +3.175040145424633e-01   +1.621893800191935e-01   +1.281459847164574e-01   -2.136629708427223e-02   +1.767914364962327e-01   -4.054170084068439e-01   -9.486176651834079e-02   -2.875245564114274e-01   +2.426564337520226e-01   -2.726148585665891e-02; -1.863415448689847e-01   +1.079794525239423e-01   -1.269117679245906e-01   +4.126546975551109e-01   +1.829419075164640e-01   +1.351282416912233e-01   +7.287548054421511e-02   +2.552158086117011e-01   -1.561539748873360e-01   +2.225057551366733e-01   -2.034703701043153e-01   -1.323727512642515e-02   -2.355182972169399e-01   -5.479281130451491e-02   -9.785914806926685e-02   -2.055635898455600e-01; +1.990576148168566e-01   -5.040970280499563e-02   -1.454952171726556e-01   +4.678195896806226e-02   +1.931527767315264e-02   -4.033534302337169e-02   +9.186993164663360e-02   -1.750363156073149e-02   -1.671425768056847e-01   +2.873427140310417e-02   +1.279944313100709e-01   -7.335869444984566e-02   +1.633149608281129e-02   -1.105622225088698e-01   +1.631711169730374e-01   -8.952625563774395e-02; -4.916314691104060e-02   -2.273850158785748e-01   -1.701063420489634e-01   -9.547190953393728e-02   +1.212497457205478e-02   +3.725141537410497e-01   +3.546777329271232e-01   -5.148570014056944e-02   -1.395586122354937e-01   +1.243206926595104e-01   -9.494239508230037e-02   +3.968131786811834e-01   +1.576973239356542e-01   -1.764001809194571e-01   +6.718965473328226e-02   -9.694839532335620e-02; +3.742806254512962e-01   -3.010005333502421e-01   +8.800110250608001e-02   +2.641336920347778e-01   -2.706748668105150e-01   -1.104964434155459e-01   -3.515494898260266e-01   +7.733542540852426e-02   -1.635567578013704e-01   -1.701866666164392e-01   -1.072318235307704e-01   -3.083070348137215e-01   +2.214047205608144e-01   -3.544276888348040e-01   -1.023000160165869e-01   -1.811978465443060e-01; +1.250378541485400e-01   -3.520787078277354e-01   -1.825659805177994e-01   -1.446286352886903e-01   -2.362350652363957e-01   +3.249952908149417e-02   -6.877238628680490e-03   +1.187150385985536e-01   +1.785753322923254e-01   +1.826079140190655e-02   +1.863708767899061e-01   -4.406030870536605e-02   +7.281516556050034e-02   -3.490665317953780e-02   +2.820803299162370e-01   -2.907383741507355e-02; +2.620964807815717e-01   -2.827362622335932e-01   -5.544976335478128e-02   +1.640938898426904e-01   -2.023201210386183e-01   -3.268399611259325e-01   -2.262171803157437e-01   +2.165423513426621e-01   -3.983944086641099e-01   +3.062262586392411e-01   -2.332812592386820e-01   -2.934484099135273e-01   +8.677149110411300e-02   +2.818020360109685e-02   -9.816449433526547e-02   -1.712244075820024e-01; -7.138910499386986e-02   -1.744253643653344e-01   -3.134235684834563e-03   +8.703885090081769e-02   -4.432154527670020e-01   -1.614022262834359e-01   +1.597209022276413e-01   -3.274829837628668e-02   +1.098939920896090e-01   +4.955908665506198e-02   +1.989025484005854e-01   +9.330855309653553e-02   +1.435198940619984e-01   +6.689498969204993e-02   +8.364797759449659e-02   -9.848061826784343e-02; +1.839300388200033e-01   +1.398917420295542e-01   -2.843415182529262e-01   -9.698285444405275e-02   -1.747425448405588e-01   +2.850171283091286e-01   +2.206179497060857e-01   -1.824513146589111e-01   -1.801116982537689e-01   +1.422588458117811e-02   -2.647419193993410e-01   +3.820959570361997e-02   -1.570166002358896e-01   +3.820678025132804e-01   +2.425109786600418e-01   +1.198458657546194e-01; -3.424490956087903e-02   -3.359878783222262e-01   -3.897451385850703e-01   +3.797240662903872e-01   -5.446455494944179e-02   +1.628066373432160e-01   +2.002071671500682e-01   -4.542446584035131e-02   +1.640924319743291e-01   +1.032174372603688e-01   +3.668489570968855e-01   +1.668618902038855e-01   -1.199675254409033e-01   +1.470000410325890e-01   -1.572347816111063e-01   -2.575631057386321e-01];
L2I_L1I_iGABA_netcon = [-3.929691185626004e-02   +1.568983567004737e-01   +1.490551230874683e-01   +3.949080501726196e-03   -3.199929042708327e-01   -2.910160486027922e-01   +1.211447634749756e-01   -5.855550164205960e-02; -2.838400689703392e-01   +1.516893206893663e-01   +1.691731889189826e-01   +1.176806208407668e-01   -3.857523251184650e-01   -2.975170249167546e-02   -1.772078274681587e-01   +1.093975419578891e-01; -2.863451887311564e-01   -1.033997731022860e-01   -1.450631163228894e-01   -9.559735845374874e-02   +4.283686451983847e-02   -3.708660218601449e-02   -2.955888895955368e-01   +2.403514698312322e-01; -1.106039685282724e-01   -1.728138653146032e-01   -1.986129462609228e-01   -1.445546068422740e-02   +6.384008904618571e-03   +1.518593217053989e-01   -3.283196861367375e-02   -5.494859952182662e-02; -7.202799122042128e-02   -3.962251427002487e-01   -1.035485324463932e-02   +9.491093068745970e-02   -3.201964627086107e-03   -3.521611762913873e-01   -7.490522069601950e-02   -3.416723481755592e-01; -7.009269668237778e-02   -4.307865366853936e-02   -3.827031937941571e-02   -1.803059166011319e-01   -3.364079890749182e-01   -4.129234612106503e-02   +2.805603854632013e-02   -1.366546694921995e-01; +3.905021420913934e-02   +1.907337144766379e-01   +3.606820440498545e-02   -3.927771349718052e-01   +2.301260554648188e-03   +1.710186142586188e-01   -1.491793007452127e-03   +3.411638979569623e-02; +2.353382024326782e-02   -1.099199936073965e-02   -1.738388160402866e-01   -2.239071388230649e-01   -1.035260210405878e-01   -7.509967341664028e-02   +2.295876546879502e-01   -4.113762262076082e-01; -1.525810340141831e-01   -3.235082464155532e-01   -1.528678407564617e-01   -6.938123726724778e-02   -2.348869562559501e-01   -7.183870717272239e-02   +3.925793919948583e-01   +3.199079966845025e-02; +6.256083146018532e-02   +1.846867527541532e-02   +2.111288845712251e-01   +2.759031999672568e-01   +2.016699273932972e-01   +2.696464130947111e-02   +2.613218535965164e-02   -1.111750382334172e-01; -7.734324559156312e-02   -2.424916874029816e-02   +3.326013077872113e-01   +2.173535974113396e-01   -2.846685835324268e-02   -2.035814074141339e-01   +1.033917475599848e-01   +2.557539396221141e-02; +2.682512555413012e-01   +1.988082027888544e-01   -1.851749143270455e-01   -1.503769974612878e-01   +4.263084393255974e-01   +1.997821567550001e-01   +1.796646644860621e-02   +2.553778497476774e-01; +1.316889240306666e-01   +1.004990896106621e-01   +9.300504779443045e-02   +1.960635623802602e-01   +2.724273299435337e-01   -1.432084386460892e-01   -2.457184471874754e-01   -1.884831601427027e-01; -1.593712848662273e-01   +1.058515284561470e-01   +3.221105129810866e-01   +4.834279612901979e-01   -2.119054791052232e-01   +1.821285108544535e-02   -4.701389841719754e-02   -1.340842235779014e-01; -3.722196985917459e-02   -2.664024302723318e-01   -4.025320406344275e-01   -2.407817156775948e-01   -1.200838210286265e-01   +1.690484842223826e-01   -3.138519630886427e-01   +3.154835022999578e-01; +1.119577325429582e-01   -2.266464582995574e-01   -2.254951566456538e-01   +2.080523926065625e-01   -8.289761106343807e-02   +1.398527555685184e-01   +2.068147344796796e-01   -2.979242762634512e-01];
L1I_L2I_iGABA_netcon = [+2.481535887374108e-01   +2.850178757803058e-01   -1.377103300272279e-01   -5.556674874179807e-02   +3.752202733219220e-01   -1.785450495333408e-02   +1.771390704410007e-02   -1.475546939433239e-01   -1.593955912767613e-01   +3.493439889209320e-02   -6.727727292997898e-02   -1.195082571361190e-01   +9.454980947893604e-02   +7.078692136076059e-02   -9.851290292544149e-02   -4.435662196520390e-01; +1.988631514680612e-01   -1.933009857810569e-01   -2.422588105153013e-02   +4.980540330543489e-01   +2.709825251588700e-01   +2.950240783451707e-01   -1.443079680053491e-01   -1.898988753634869e-01   -1.795168262268528e-01   +3.485625221961952e-01   +1.820242944255813e-01   +2.689779135320827e-01   +1.528447086374598e-01   +1.549826493307344e-01   +2.780399932265926e-02   -2.325480793256093e-01; +9.056948816304153e-02   +4.669507941195888e-02   +6.114922953837892e-02   +3.060763460181835e-01   +5.903533726223623e-02   +1.745081286862635e-01   +8.500346861815748e-02   -3.070915137408894e-01   +1.482828765938970e-01   -6.525024722808859e-02   -3.879912053114056e-01   +2.104227186806050e-01   +1.498987862200665e-01   +1.986616231510181e-01   +2.024573211385776e-01   -3.512097740188303e-01; +1.440147679970616e-02   -5.466558437146000e-02   +3.095279687500985e-01   +7.730502224478561e-02   +1.380222499427659e-01   -1.558954819208709e-01   -5.588777540823643e-02   -1.186537870124973e-02   +1.075034344364722e-01   -4.828688809433609e-02   -2.481983601509965e-01   -1.058726462237617e-02   +1.648359900233065e-01   -2.400868434977853e-01   -1.081045624520736e-01   +9.824893004817870e-03; +1.086952274866235e-01   +1.116936834830923e-01   -9.853060283222859e-02   -4.190962222788788e-01   +1.185089746246175e-01   +1.982130639783687e-01   +5.019035970446384e-02   +5.565422588282896e-01   +1.703253682448295e-01   +1.490794808046135e-01   +2.955352415566421e-01   -2.221627341384725e-01   +1.224322113887766e-02   -3.400814301563150e-01   +2.674397044171853e-01   +2.193524602301508e-01; -1.063450199134511e-01   +1.594620776292165e-01   +3.862489812194221e-01   +1.987847095378820e-01   -1.874980187261177e-01   +8.652419686437209e-02   -2.761010879908660e-01   +2.236579753972008e-01   -2.072939003361521e-01   -2.813953882673348e-01   -3.486479197462520e-01   +4.812617761893719e-02   +1.381551319124409e-01   +1.895362041861734e-01   +3.194158660680703e-01   +1.136186649838609e-02; +1.326404517361253e-01   -2.687234497085635e-02   +3.346798310984436e-02   +1.523373502210653e-01   -1.814651616416972e-01   -3.147416559788800e-01   +2.545108845001853e-01   -3.032672471690604e-01   -6.186042542830473e-02   -6.456043965670664e-02   -1.884598326565188e-01   -3.622178999944931e-02   -6.018292934158813e-02   +1.109376041575535e-01   +2.567070883407277e-02   -1.302952536266102e-01; +3.385579100765316e-01   +2.036175698628648e-01   +1.609344707916295e-01   -4.089450918552498e-02   -2.043623912374875e-01   -3.752451958608244e-01   -9.864984783800265e-02   -8.265756095681225e-02   +3.184631855066587e-01   -3.941889892375585e-01   -1.938376295564026e-01   +1.535447571085521e-01   +2.354249419054663e-01   -1.881063996467952e-02   -7.961055121802953e-02   +2.050835047647306e-01];
L2E_L1E_iAMPA_netcon = [-1.316918870100470e-01   -2.937462970774381e-01   -7.930503890800722e-02   +8.830398633401437e-02   -2.236994254266394e-01   +2.502478409161182e-01   +2.222750578753844e-01   -2.358934359513983e-01; +9.410235604613210e-03   +1.554027862589719e-01   -3.963319807729877e-01   -3.843028102107169e-01   +2.204221555493374e-01   -6.477548310239038e-02   +1.789105256471570e-01   -2.439579559361787e-01; -3.075572372409083e-01   -1.450321788929517e-01   +1.019748150852038e-01   -1.053979614806788e-01   +1.236494981486613e-01   -9.646688307179449e-02   -2.167488019696359e-01   +2.269195647779678e-01; -3.303352902032532e-02   +1.475267220465816e-01   -1.357756411221656e-01   -2.138306569023364e-01   -3.270475974656023e-02   +2.535312779486099e-01   -1.975004262847007e-01   +5.803336735544703e-02; +1.245252742400439e-02   +6.984652676545175e-02   +1.464841329807496e-01   +1.270270934845850e-01   -4.074100025704301e-01   +3.110330020999863e-01   -4.580581673035590e-02   +1.305562870190355e-01; +1.068815371399465e-01   -1.898113632893078e-01   -4.057600311027478e-02   +8.522569176017646e-02   +3.738803832565544e-01   +2.279117598478782e-01   -1.341430343575412e-01   +1.397363201168472e-01; +9.075960720705847e-02   -1.238343914718470e-01   +4.409709542321440e-02   +3.350015990684306e-01   -5.500977681973443e-02   +3.619093274974214e-01   -6.926422985628577e-02   -1.596931097957412e-01; +7.924380219154142e-02   -3.176428977067037e-01   -3.546644813234830e-02   -1.139933075583038e-01   +8.267487657907548e-02   -1.622273520880921e-02   +2.575336650462482e-01   +1.626738007410444e-01; -1.667833100692419e-01   -6.091943345132728e-02   -1.861927220288198e-01   -2.072935996444724e-01   +3.369093080485308e-01   +1.414352667984895e-01   -5.801459814225404e-03   +3.052719219526982e-01; -2.122965719695889e-01   -1.609632833315518e-01   +2.016068134715744e-01   +2.130279689366427e-01   +3.685998509459038e-01   -3.634603525134666e-01   +1.669996411088752e-01   -2.641078443190567e-01; -9.386931772509891e-02   +1.805599794163999e-01   -1.046754796247459e-01   -4.207012985000315e-01   +5.127696825878587e-01   +1.106658506737732e-01   -6.131936251663025e-02   +9.556228568997979e-02; +3.564734980829729e-02   -2.318832742401635e-01   -6.066847616858893e-02   +5.255202885808088e-02   -2.499114168479645e-01   +2.404669461233241e-01   +1.802009539533581e-02   -1.539828281069213e-01; +1.025887148176222e-01   -1.923326980869366e-01   -1.034722885179146e-01   -4.241953091137458e-02   -1.097945118107478e-01   +3.599942862985479e-02   +3.421796515371816e-01   +2.667022677203781e-01; +1.185630066143637e-01   -6.085354824592476e-02   -2.142154938651307e-01   +3.521616243563726e-01   +8.690157698978611e-02   +9.071599536058642e-03   +3.197273729405917e-01   -4.241203571599948e-02; +4.513759155873786e-01   +1.731176265956721e-01   +7.413969585345996e-02   +2.208939178970522e-01   +3.220560610883071e-02   +2.890176219730606e-01   -2.761027776307062e-01   -2.266762772521931e-02; -3.523637488923023e-02   -7.219364839984313e-02   -2.132952014331424e-01   +7.203973612498075e-02   -1.644184155525029e-01   +3.478151907220430e-03   +1.663562625220562e-01   +2.324777502270961e-02];
L1E_L2E_iAMPA_netcon = [-2.340854482012632e-01   -3.312343851540996e-01   -1.939640031353397e-01   -4.141449634965914e-01   -2.309908544905518e-01   -1.592575363978431e-01   +3.228131257350116e-01   +1.123060844440900e-01   -3.969626165503982e-01   +1.107547420694428e-01   -2.412800768604536e-02   -1.709489859246528e-02   -5.963021610414138e-02   -5.644027331679481e-02   +2.233922352601939e-01   +1.936452686659590e-01; -1.609748427666781e-01   +2.274327588870556e-01   -1.716817158612749e-01   +4.462199119574536e-02   +3.082438839520478e-01   -2.353657807830031e-01   -1.922234336861056e-02   +3.816878760347085e-01   -1.157079805730697e-01   +4.932375839552963e-01   -7.009196667535894e-02   -1.846826988011143e-01   -5.157090378304732e-01   -7.161887203184387e-02   +1.379429649288660e-01   -3.022113310410721e-01; +3.402712265004145e-01   -1.783605775712874e-02   -2.229918087972254e-02   +1.384706293941154e-01   -2.726163072564045e-01   +5.560920213477191e-02   +7.494136809529953e-02   -1.076866870383828e-01   +1.316140704136614e-01   -1.827175208546641e-01   -7.909789375080911e-03   +3.573309308590074e-01   -1.858463774224535e-01   -5.659193722736355e-02   -2.277689107514213e-01   +9.454038582172178e-02; -2.665395667152828e-02   -3.626668518389036e-01   +7.464290505514540e-02   +3.168417515625954e-01   -4.342352311889172e-01   +1.646308932400167e-01   +5.698113995453880e-02   -4.093956587867184e-02   -2.112673305800885e-01   -2.150573427233138e-02   +1.225317070662108e-01   +2.124544373052938e-01   +8.279239727113297e-02   +8.937267438876723e-02   +3.794142623010138e-02   +1.401754769852222e-02; +2.603567911160943e-01   -1.397084878037652e-01   -3.175522659630495e-01   -1.412852240569378e-01   +1.322283628689623e-01   +9.479448274692073e-02   -7.095618069339144e-02   +4.333584645819944e-02   -1.109528762384472e-01   -5.226186127137197e-02   +5.167479963942385e-02   +3.563247665056142e-01   +1.937854410985006e-01   +3.384265162744043e-01   -3.321201541959802e-02   -2.201289037840864e-01; -1.696374377573054e-01   +1.424234554495003e-01   +2.871052131792621e-01   +2.220449185245778e-01   +8.674210863094460e-02   +1.170739591690183e-01   +9.100082591720557e-02   -4.377022004834562e-02   +1.193776995171513e-01   -1.566950933222215e-02   -5.830941168758551e-02   +2.803275859684772e-01   -1.471407217568262e-01   -1.396686094471153e-01   +1.197506309796388e-01   +1.281107952426137e-01; -2.053357500190199e-01   +1.237032359973960e-01   +1.224755535382307e-01   -1.728784588833157e-02   -1.083556250575743e-01   -3.193307371921005e-01   -2.129002145625689e-01   +5.092436374721088e-02   +1.407895230499839e-01   +1.165471350364662e-01   +2.406612205723955e-01   +1.596213549552035e-01   +3.405866799706530e-01   +5.947539829899924e-02   -4.168003524178722e-01   -1.840860764239041e-01; +2.027141858349070e-01   +2.047309722962066e-01   +1.983090346687538e-01   -3.935933359606806e-01   -5.520714032318637e-02   -3.051261633951327e-01   +1.722318443935511e-01   -2.088775258060982e-01   +5.993767247234391e-02   +1.406112038399542e-02   +4.395024513020306e-01   -7.057652086210164e-02   +3.146269069167923e-02   +1.268455820577073e-01   +1.278432755491306e-01   +1.702461152757932e-01];
L2I_L2E_iAMPA_netcon = [+2.266473650309752e-01   +3.659667895075688e-01   +7.344305906334467e-02   -1.564330283604892e-01   -2.955046837743096e-02   +4.001017888417722e-02   +4.537392922576176e-02   +3.165473025750339e-01; +9.740019917154960e-02   +1.305575635983009e-01   -1.368453845140689e-01   -2.254784147584369e-01   +1.246251211319991e-01   -1.183509595433064e-01   -1.261042268365238e-01   -3.580424763281380e-01; -1.556039141858522e-01   -5.867274695232153e-02   -2.367858364916164e-01   -1.616160155924851e-01   -1.882682464229591e-02   +6.776117952981768e-02   +4.078492300447584e-01   +1.164503118150952e-01; +2.162730575604682e-02   -7.575138491944181e-02   +1.070690583748485e-01   -1.513543135534212e-01   +1.086237834722008e-01   +2.100192563874405e-01   -8.673581938370094e-02   +2.291123387643309e-01; -2.054155194021367e-01   -3.026122431377491e-01   +4.987942772549325e-02   -3.002616084632728e-01   -1.398619532044975e-01   +4.734449738729770e-02   +6.288172158770569e-02   -5.509489828565998e-02; -6.289082325480934e-02   -1.515509452127678e-01   -3.860315441100532e-02   +4.401360992848408e-02   -1.385449443521000e-01   +1.944612015117323e-01   -1.444233189255248e-01   +2.785274594520386e-01; +4.905520266075641e-01   -1.655330902074975e-01   -4.022631833532894e-02   -2.224195319466298e-01   +1.139560850881709e-01   +1.852902899502047e-01   -2.364487163221665e-01   -5.825626426009378e-02; -2.611181439348886e-01   +1.415871590711513e-01   +1.226806515938649e-02   -1.097899089576017e-01   -2.017079755118127e-01   +2.986660913461120e-01   +2.094586611664293e-02   -1.899307747770366e-01];
L2E_L2I_iGABA_netcon = [+3.428013200379639e-01   +1.316035720971794e-01   +1.942190187334289e-01   +2.250303500863329e-02   +3.802230640988360e-01   -2.135178205804879e-02   -4.625895215494142e-01   -4.862043950681605e-02; +9.764935232172385e-02   +2.268884862043199e-01   +2.015264434176141e-01   +2.556457010389162e-01   +1.112092659526949e-01   -1.824637456509475e-01   -2.514655148201191e-01   -2.220840267858498e-01; +3.685517471449384e-01   +2.614410182696980e-01   -2.332258592392416e-01   +3.021602843510750e-01   -3.685959182235799e-01   +4.305421113990510e-01   -4.019214653489240e-01   +7.448171858079229e-03; -1.112631641484152e-01   +3.409710224831070e-02   +1.729541750329765e-01   -1.501003162356445e-01   -2.125682413347088e-01   -3.999128727704076e-01   -7.056757621192132e-02   +1.091510830615928e-02; +2.829741854616616e-02   -1.929087698494988e-01   +4.098286154584984e-01   -1.888009039268896e-01   -8.290526901515938e-02   +2.357640008313171e-01   +6.431212842652005e-02   +9.553386922965415e-02; -1.441353891131521e-01   -2.216643010169905e-01   -6.187396822446867e-02   +3.637646586148779e-02   +8.782402515564108e-02   +1.041650267895800e-01   -2.900352726067325e-02   +1.907252430011583e-02; -1.249030491198338e-01   -9.934806706964094e-02   +7.525411565107432e-02   -1.106202359301700e-01   -1.510475522678729e-01   -2.453428311773696e-01   -5.663585194965697e-01   +2.303765548455563e-01; +9.403612230355109e-02   -3.238269057535451e-01   +1.710133059228926e-01   -9.924342996975424e-02   -1.639106565279757e-01   -1.248851157643591e-01   +1.821803841785356e-01   -1.347547665339131e-01];
L3E_L2E_iAMPA_netcon = [+7.909767076457955e-02   +2.039929504428225e-01   +1.728926638000833e-01   -7.850680901228112e-02   -2.198589348535512e-01   -4.080223808213389e-02   +2.626735018190669e-02   +1.234931865826988e-01   +6.689327012625126e-02   -2.691369897164370e-03   +2.118260156074462e-01   +3.539618349128293e-01; +5.422438602122090e-03   -1.721877724484692e-01   -5.151646475553106e-02   -8.610809796074562e-02   -8.282897110242447e-02   +1.203869918962973e-01   -1.304832563482184e-01   +3.138585358583045e-01   -1.766765272718594e-01   +5.580366819377881e-02   +6.129044079762396e-02   +1.293276785379716e-01; -1.232456945986196e-01   -2.288778681665991e-01   -3.459331879789421e-01   -3.412560806476568e-01   +8.070488866175465e-02   -3.139741415885789e-01   +2.194597486909733e-01   +1.719919381834131e-01   -3.151670708506210e-01   -2.407728674220785e-01   -3.271432152418737e-01   -2.203392865961631e-01; +2.727246128412560e-01   -2.053642340379524e-01   -2.036225573254900e-01   -1.724499187197022e-01   -1.553005885664852e-01   +2.147873265280910e-01   +5.231311958261382e-03   +1.363150256154885e-02   -3.895472693310584e-02   -1.877041291878196e-01   +2.522173510128746e-01   +4.282638527600432e-01; -5.636405402407352e-02   +4.010978002198844e-02   -4.006888505685618e-01   -8.747684027253909e-02   +2.623128141324609e-01   +3.202474364681430e-01   -1.440102322510059e-01   -2.565310824673160e-01   +2.110320959732310e-02   -2.248740010018380e-01   +3.456715818539763e-01   +3.580682828276701e-01; -3.022587968777635e-03   +1.246743002817898e-01   +2.943623840424137e-01   -2.165391328719823e-01   -4.170827993806286e-02   -2.440783616493556e-01   +4.500443070299115e-02   -2.926620870375150e-01   -1.190945657192057e-01   -2.820915868906488e-01   +5.163748015124328e-02   +1.747108787227516e-01; +2.292428479152217e-01   +3.293878818980445e-02   +1.650808509671946e-01   +4.388677624139488e-02   +2.482374659034222e-01   +1.391864217924297e-01   +1.726260301117584e-01   +2.598886994242979e-01   -1.278662864485377e-01   -1.130221268610164e-01   +2.846118174203194e-01   -2.137722831568012e-01; +7.355145538619920e-02   -9.274155343723828e-02   -4.185263524485949e-02   +1.008511408730971e-01   -4.638610009271664e-01   -7.862866616121578e-02   +2.229168036449916e-03   -1.240458602779241e-01   +7.160100292450740e-02   -1.358614968669526e-01   -2.186408996519570e-01   -1.157016353474160e-01];
L3I_L2I_iGABA_netcon = [-8.794731041880333e-03   -2.684652711550217e-02   -3.972490713129027e-02   -1.162047700785495e-01   -2.263462698524582e-02   +2.057802703598008e-01   +6.273757269972555e-02   -2.554048881745707e-03   +2.731542232288550e-01   +4.280409756623083e-01   -1.782138747136985e-01   +2.208747713231062e-01; +3.347327406900998e-01   -1.805070495766473e-01   -6.101386883440960e-02   +3.546183745493645e-01   -2.198875844612307e-01   -1.869939668996029e-02   -1.746224966971383e-01   +3.172507113904088e-01   +1.255516146663321e-01   +2.625663698378675e-02   -4.516055683028186e-02   +4.590303554111756e-01; -2.525906568219251e-02   -1.457153215271946e-01   +9.734290356408698e-02   -6.498870902340664e-03   +4.823718082556539e-01   -2.569526136286369e-01   +3.806070284903228e-01   -4.147344830058989e-01   +1.939066654751015e-02   +1.664938552895274e-01   +9.830503883260010e-02   -1.965829612218108e-01; +1.814179345495934e-02   +5.219959715558684e-02   +1.440967732427122e-01   +5.044688300733791e-01   -2.047284842992832e-01   +4.980197371363017e-02   -8.747101676435284e-02   -1.641799431436792e-01   +3.636135615491601e-02   +2.512527548705684e-01   -3.447592472670608e-02   +2.102567770903078e-01; +1.382726380012471e-01   +1.299025395602461e-01   +2.354250823397344e-02   +4.271540461097555e-01   -5.002841899333867e-02   -1.860561075364420e-01   +2.471377263007286e-02   +3.720112962304094e-01   +1.445519811279964e-01   +2.145505568093271e-01   -1.031092398945374e-01   +1.632256423844994e-01; -3.522296678258488e-02   -2.587947639467441e-01   +8.432019279595880e-03   +1.204007755684893e-01   +1.864160431412320e-01   -2.393197437111701e-02   +9.913450892058057e-02   +2.766142067255360e-01   +3.646517957008893e-02   -8.941463974522915e-02   -8.000625082031362e-02   +8.678456684839564e-02; +8.361661068987032e-02   +3.519689702635788e-01   +2.550708398631758e-02   -1.562037456595253e-01   +8.785738763897027e-02   -1.422479867421692e-01   +8.063112921887230e-02   -1.113234510077183e-01   -2.837897350870090e-01   -6.204614550911172e-02   +2.287607784279833e-01   +3.260926010203664e-01; -1.701923253883666e-01   -2.843113897882081e-01   -5.218416610740570e-02   -2.003584037852149e-01   -2.348511709929108e-01   -2.244932916816533e-01   +3.140094360126363e-01   -1.564387232862961e-01   -1.557971558454665e-01   +1.285010724518751e-01   -1.982274903024457e-01   -2.430173477689200e-01];
L2E_L3E_iAMPA_netcon = [-8.599863488376315e-02   -1.293534970925554e-01   +1.815346861107298e-01   +3.948501099769945e-01   -3.594562534672279e-01   -4.039299451561265e-02   -7.153603250568905e-02   -3.083499054830635e-01; +1.497761528886833e-01   -5.673274648007656e-02   +3.843559786755829e-02   -2.062417762898399e-01   +2.838673424786776e-01   -3.367093271423751e-01   +1.713804033653425e-02   +2.775643359173526e-01; -2.514536181537667e-01   +7.052000591930035e-02   -4.389520896276047e-02   +1.597969240254384e-01   +8.442725671132395e-02   -1.587746477514394e-01   +4.698329403947712e-01   -2.029141971670197e-01; +1.055757963881145e-02   +5.703207019910965e-02   -1.306231786421201e-01   +1.926350226787138e-01   -1.186446933256000e-01   +2.338386736391355e-01   +2.005684118021909e-01   +3.585646074543755e-01; -3.795948228623781e-01   +3.566844864049510e-01   -1.149732500549104e-01   +9.828162408879224e-02   +2.248982407525980e-01   +1.642299918865213e-01   -1.708840054875667e-01   -2.982161482827452e-01; +1.917992993261901e-01   +1.494368593265328e-01   +2.541489322209795e-01   -9.978566487354491e-02   -2.840783893315780e-01   +1.975949827632821e-01   -3.157727876674792e-01   -5.425545535220131e-02; +2.453329036644744e-01   +1.731820560362575e-01   -1.110897193883191e-01   -1.441445863448227e-01   +1.776739154551453e-01   +2.225974920999479e-01   +1.624726325613894e-02   -3.286997745436528e-01; -4.484647065383564e-02   +1.485973210788599e-01   -1.429175920934373e-01   -1.368291191287233e-01   +4.418958991082786e-02   +1.347059276294269e-01   -6.341608410110702e-02   +2.441814224185117e-01; +4.383685497236519e-01   -2.911398095458210e-01   -1.920002870666145e-01   +2.564909612367543e-01   +3.198582347671007e-01   +2.012608222408373e-01   -4.072543471833573e-01   +1.571877393194760e-01; +1.531289291660131e-01   +3.212373035515316e-01   +1.272870314131337e-01   -3.283839589302850e-01   -2.517982345886483e-01   +1.257923143009452e-01   +1.365825998219986e-01   +1.696948452183177e-01; +4.712748108615690e-01   -1.235789870606381e-01   +1.546776651816613e-01   +3.329171495697322e-02   -2.958917556923885e-01   -1.773511832094652e-01   -1.334887954637075e-02   +1.397280284853809e-01; +2.470040808099335e-01   +7.113993750184192e-03   -3.416057703814204e-01   -2.176451600834152e-01   -3.675797111910786e-01   -6.846973752135549e-02   +3.993404736763614e-02   -1.593585001333077e-01];
L2I_L3I_iGABA_netcon = [+1.930870855168850e-03   -1.197934052348069e-01   -2.179355079035762e-02   +3.616847257701619e-01   -9.794548644757005e-02   -4.770719416064764e-02   -2.251762225157207e-02   -7.347541001519306e-02; +3.636707901371365e-01   +3.796015392028389e-01   +1.135396380504647e-01   +2.273659598437119e-01   -6.836123167573063e-02   +3.054668185142074e-01   +4.622012765890864e-01   -1.294672840300604e-01; -1.610352358224091e-01   -2.343847159639735e-01   +1.252584227437145e-01   +3.264791177466780e-01   +1.746411693109564e-01   +1.369118935695285e-01   +3.999545194712240e-01   +1.432745331984578e-01; +2.756941979846133e-01   -2.164327589821503e-01   -4.590091605697708e-01   +2.214015874334176e-01   -2.472195496262602e-01   -3.100197841780393e-01   +1.136707717877213e-01   -2.323784451242915e-01; -1.735329324513630e-01   +5.246914380800832e-02   +7.162304709252726e-02   -9.559268590299279e-02   -2.236934756257804e-02   +3.716500852173344e-01   -1.224457562411012e-01   +1.352045364789475e-02; +4.804181311230679e-02   -3.974562758170916e-01   -9.381946805129765e-03   -4.824224291267684e-01   +1.947140361245272e-01   -1.674823568727321e-01   +4.867807838534841e-02   +1.033957048881384e-02; -3.514413968875532e-01   -9.690658185514914e-02   -2.161406602920690e-01   -1.588471042694295e-01   +1.304576777477982e-01   +3.000113320537682e-01   -4.270747000844399e-02   +1.212329185552826e-01; -1.833154547136323e-01   -1.670765236593801e-01   +1.770792817426172e-01   -3.498139370678170e-01   +3.597203735521955e-02   +2.570663043961257e-01   -1.418279494766847e-03   +8.103886312135027e-02; +9.576667899571592e-02   -1.773927192162029e-01   -3.349842410124022e-01   +8.464000219360734e-02   -2.681691906744922e-01   -1.077768147919803e-01   +6.891907182744976e-02   +4.678678142810449e-01; +2.390449275622314e-01   +4.813345884318486e-02   -1.965155766792475e-01   +2.217527320061593e-01   -3.869114410565335e-01   +4.212992922931211e-01   +2.441631579484307e-01   -1.023565548972466e-01; +4.642568173975625e-03   +9.012720472714399e-02   -7.997546359700732e-02   -1.278284614340460e-02   -4.969756658143235e-02   -1.384263200966473e-01   +4.185466607403642e-01   -1.084034599590930e-01; -2.908451511805699e-01   +3.489763832871301e-02   -1.117003420526072e-01   +5.643187651092918e-02   -1.403711994628202e-01   -9.911037362984354e-02   +1.701311863177847e-01   -5.355853404950206e-03];
L3I_L3E_iAMPA_netcon = [-4.471638767612898e-01   +1.147493897295108e-01   +2.486843739565449e-01   +2.235912335157751e-02   +1.031433706527260e-01   -2.323013021924918e-01   -2.864996011443945e-02   +4.070610647241137e-02   -8.464958454204971e-02   -9.178134589349171e-02   -1.540631988470411e-01   -6.782283430901800e-02; -2.079023938028300e-01   +1.374816622392841e-01   -3.775856143872027e-01   -2.903613948157170e-01   +2.512493385916745e-02   -2.102830135255536e-01   -1.529095448123532e-01   -9.118217043460559e-02   -1.289897062988183e-01   +3.987194704813674e-01   -1.382321727387725e-01   +6.544008531305459e-02; -1.058502513774033e-01   -2.324349582827532e-01   -3.907391880329383e-01   +3.614841718996741e-01   +2.054261425950694e-01   -3.660484489065489e-01   +8.983826925018401e-02   +2.443688674497893e-01   -4.556545249614129e-02   -2.535746747100687e-01   +2.894810496633086e-01   -1.582294557557022e-01; +2.760210980330028e-01   -3.023543161308978e-01   -5.928241601137803e-02   +1.215866456763780e-02   +2.581437708137140e-01   -2.006437819747250e-01   -2.891766690678689e-01   -1.615108146481470e-01   -7.677089164104081e-02   -4.058326305363657e-01   +1.104739754455272e-01   +1.757192102093107e-01; +6.661234227025972e-02   -4.072538027392137e-02   -2.154408647876648e-01   -1.174308758282520e-02   -3.356151993689456e-01   -8.718492418780019e-03   -3.120871227602470e-01   +1.506529399082447e-01   -9.436453602030176e-02   -1.665973635229576e-01   -6.417467885107576e-02   -2.602202112559814e-01; -3.502564914308797e-01   -3.230401771234809e-01   -2.403208483855210e-03   +2.190949037715395e-01   +1.752505004894603e-02   -1.210180770829644e-01   -3.276485704776486e-02   +3.739168281298132e-01   -2.983269903714369e-01   -2.397747947653676e-01   +7.468037709976480e-02   -3.798614972709558e-03; -1.805820161633169e-01   -9.509755389657812e-02   -1.925302132923983e-01   +2.092318927034143e-01   -2.436979899636513e-02   +3.025980886022848e-01   -2.482491484859136e-01   -5.056276786403227e-02   +3.231430661461386e-01   -1.276424685068841e-01   +1.280773540863979e-01   +2.496447247749978e-01; +6.067751552157011e-02   +1.639459285033857e-01   -1.419344146448403e-01   +2.976686631701428e-01   -3.284589380294146e-01   -3.241151289176261e-01   -6.761724332883824e-02   -7.740792768623023e-03   +2.964848911038490e-01   -3.692987356460667e-01   +1.791412527517706e-01   +3.389724639790009e-03; +2.588319971066683e-01   -8.235502094490529e-02   -2.048712519232773e-01   -1.040062425171425e-01   -7.623767034447421e-03   +2.399458773612790e-01   -2.487941252730066e-01   -2.138274317884861e-01   +2.478740395299127e-01   -2.547568094548653e-01   -2.589147962101738e-01   -1.451502157999121e-01; -1.349008934580148e-01   +2.200438924370812e-01   +9.280485485248961e-02   +2.522770199539483e-01   +3.982013789363396e-01   +2.482331734493985e-01   -6.306509512154287e-02   -1.120989311110963e-01   -5.626329055503676e-02   +1.817507752477967e-02   +3.779609375024184e-01   +1.022909220843021e-01; +4.873696384695891e-02   -1.198476083829460e-01   -9.625227549041260e-02   -6.785046763662755e-02   +1.341658139944366e-01   -2.780887537112138e-02   -1.739246952206176e-01   -3.031842096068657e-01   +1.280837786847271e-01   +2.983715149653784e-01   +4.884450679502293e-02   +3.287197511773012e-01; -5.725106539019795e-02   +3.384504917954326e-02   +2.658853808074018e-01   -1.978948733800603e-01   -1.076851427653226e-02   +1.680144599172249e-01   -2.602143394980853e-01   +1.914695179613035e-01   +1.380295257239195e-01   +6.774519653848052e-02   -2.768517733747747e-01   +9.339668367229681e-02];
L3E_L3I_iGABA_netcon = [+3.279953517255146e-01   -1.494909588797859e-01   -3.988703947936933e-02   -3.162053326165509e-03   -1.774908815555881e-02   +3.265110803715504e-01   -8.826004270672129e-02   +2.027824575873713e-01   +6.823860096155676e-03   -1.109064318690322e-01   -7.697310628550530e-03   +3.880412953432478e-01; -1.800888993852610e-01   -2.984682316299033e-01   -3.844392289171925e-01   +1.409287018102398e-01   +2.689385111548281e-01   -6.468604685437418e-02   -1.044083748530593e-01   +1.061923157275713e-01   +1.922313409995573e-01   +2.800550780105924e-01   +3.804887977907362e-01   -8.206665232608103e-02; -2.581101697938497e-01   +1.382860430047218e-01   -2.350642293096970e-01   +8.944045573989645e-03   -2.216691622328769e-01   +4.769857974719276e-02   -1.553814537041849e-01   +2.715454556106713e-01   +7.949658979076042e-02   +3.620520234255850e-01   +1.883436567562509e-01   +3.586636111444511e-01; -1.455527269704621e-01   +3.623728622787786e-03   +3.091005798302419e-01   +1.789980062427364e-01   -1.750597715519143e-01   +3.172232156628547e-02   -1.885874892397675e-01   +1.651409012643493e-02   -2.170096351970449e-01   -1.141450638699473e-01   +7.440588332981722e-02   -3.377094311484159e-01; +1.688788294662193e-01   +2.989298419989335e-02   +2.334739041191804e-01   -1.334316937747900e-01   +4.263702752438198e-01   -1.064273363372075e-01   +9.168406800818207e-02   -3.522338014166622e-01   +1.053491761324620e-01   -1.496082285884071e-02   -2.314024002273269e-01   +3.913623306642922e-02; +2.167406667705044e-01   -6.757876215730425e-02   -1.531309397675287e-01   +3.545261126230188e-01   -1.761971625601568e-01   +2.589910293190374e-01   +9.399195284844632e-02   -3.260760298488498e-01   +2.513179306512425e-02   -9.265488252239554e-02   -2.613450892756541e-01   +9.429913182665599e-02; +2.718487042236546e-01   -2.385045020050629e-01   +2.081932923646983e-01   -3.712825228403724e-02   -3.382663460788979e-01   +2.382596977659640e-01   +2.052283632136334e-01   +7.556368779888156e-02   -1.215053605707789e-01   +2.116632645248301e-02   +1.898603620281939e-01   -1.068972538611529e-01; -3.920389057766865e-02   -1.297491906572330e-01   +1.413881961788510e-01   +2.668117804253144e-01   +3.242727609631282e-01   +7.340435701172437e-02   -2.610606610820581e-01   +3.331326777737830e-01   -2.104125356406888e-01   +8.235331504765023e-02   -1.581188810981788e-01   -4.485252752791381e-02; +1.059757170905745e-01   -5.064681092353186e-02   +3.057122346854804e-03   -1.361002484525080e-01   -5.806909090514741e-03   +9.387267649802705e-02   -5.337061803786465e-03   +2.943590301351267e-01   +3.550475049858169e-01   -8.433373538251247e-02   +1.905937786474566e-01   +7.276690382057385e-02; +6.497445171238617e-02   -2.870575783056051e-01   +2.352601835280786e-01   +8.994910786973451e-02   +1.661424073776481e-01   +4.253523867001383e-01   -1.003576470651436e-01   -1.219821884552479e-01   -2.246344340236132e-01   -7.653942495407456e-02   +4.476723017754735e-01   +1.662573343110514e-01; -4.368693115121487e-01   -2.239174089711364e-01   -1.606196616835651e-01   +1.401630648922144e-02   +3.676353962742689e-01   +2.514577499459922e-01   +1.454589513774788e-01   +3.248930353220462e-02   +7.017306751042372e-02   -3.432285395245041e-02   +1.262743315454593e-01   +9.773499855525500e-02; +4.167938186295685e-03   +4.244441623754884e-02   +1.660275798756700e-02   -3.153872830785300e-01   +7.777461576811308e-02   +8.186828524699947e-03   -2.905734849698302e-01   -2.982876329488657e-01   +2.888181871200409e-01   -1.799234614602538e-01   -2.274585281106843e-01   -2.153810674682689e-02];
L2E_Input1_iAMPA_netcon = [-1.679858911608675e-01   +5.671321932667957e-02   +9.266492264372581e-02   -3.275690725695776e-01   +2.021340977123640e-01   -7.942084145260318e-02   -2.464193774497337e-01   +2.887736493004673e-01];
L2I_Input2_iAMPA_netcon = [+8.309754514756143e-02   -1.656523594207667e-01   +2.924521588053017e-01   -9.395711397883287e-02   -2.130749841000966e-01   +1.199711562215180e-01   -2.349828510819105e-01   +3.800680704470051e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
