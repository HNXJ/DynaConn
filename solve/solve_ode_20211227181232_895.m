function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.029331526680547e-02   -1.000883555772650e-02   +6.986254381004281e-02   +8.353760979941835e-02   +3.493157603001075e-01   -1.603222165534972e-01   +1.615510022681566e-01   +1.406814271647570e-01   +3.659692461759647e-01   +3.170087622066638e-02   +2.643333876827622e-01   +1.904733507042140e-01   -7.836488739838671e-02   +1.302821171664085e-01   -4.432816574821039e-02   +8.762016594996515e-02; +8.523336134555565e-02   +1.999587282185762e-02   +2.321082165736018e-01   +7.209756616150477e-02   +3.215127147988318e-02   +1.274216684170045e-01   +8.415611378579084e-02   +1.477667334603139e-01   +2.971481524471238e-01   -4.694128358423152e-02   +6.348274053177108e-02   +9.881829858535797e-02   +6.916038258048676e-02   +1.578282328738541e-01   +3.943434563112169e-02   +1.590472961411925e-01; -9.481410972934654e-02   +8.885068107350934e-02   +9.209295214178423e-02   +1.375128049708220e-01   -1.498097138080516e-02   +1.036281101515662e-01   +2.378216904971574e-02   -4.320350126993483e-02   +2.692817907222770e-01   +1.021396758233745e-01   -7.049378545640536e-02   +1.575077036617081e-01   +6.221081302851834e-03   -9.523113729274533e-03   -3.304812463405545e-02   -5.499840085862550e-02; +1.301709623320671e-01   +1.340433367383852e-01   -1.157374766334181e-02   +1.224076035165122e-01   +6.920967649619636e-02   +1.431840400302898e-01   -9.582922896273424e-03   +2.392004796887383e-01   +1.689034222335731e-01   +1.046860546786867e-02   +1.779113794279940e-01   +5.156028877313996e-02   +8.078619606883805e-02   +1.169993748407387e-01   +1.025905717605681e-01   +2.213351167190363e-01; -8.149142747555202e-02   +1.054861772740912e-01   +8.414454996249887e-02   +4.036023504517949e-02   +1.636830387097717e-02   +8.219708191138170e-02   +1.178444817756979e-01   +2.260911107350871e-02   +1.378397774261324e-01   +7.998605574755477e-02   +7.777395690799571e-02   +4.655537653257653e-02   +3.810082407796263e-02   +6.930901533545636e-02   +5.284203635932858e-02   +1.499780147891430e-01; +3.695889902839594e-01   +1.407392811586335e-01   +6.701065146616633e-02   +2.828140164235418e-01   +9.493665945826546e-02   +2.189362738466813e-01   -6.476974137570929e-02   +1.267621488245445e-01   +2.425741081838828e-01   +1.944323169664484e-01   +2.236450081839976e-01   +1.155274017058529e-01   +7.618154289963368e-02   +1.890096431638069e-01   +1.597396520287351e-01   +1.562212949801203e-01; +1.016550952659265e-01   +5.166660873268258e-02   -4.574774261754178e-02   +1.171418517176879e-01   +2.413890672970238e-01   +3.067918116552972e-01   +1.124734905761501e-01   +1.203621656363905e-02   +5.033704265404082e-02   +9.630626288908636e-02   +1.876347528863601e-02   +2.220434435702157e-01   +3.250750846018116e-01   +2.503831522729465e-01   +1.116538085943564e-01   +2.284376295809852e-01; +2.735257070959994e-02   +1.484679877202439e-01   -5.740589996314466e-02   +1.402675864697524e-01   -5.072160299003849e-02   +1.243235837856120e-01   +5.085184972167311e-02   -6.922311307947591e-02   +1.928615653485811e-01   +2.168195754631991e-01   +1.721328644182591e-01   +7.096372179131366e-02   +4.868969759259680e-02   -4.030722723451553e-02   -5.445680612422969e-02   +1.523933365951212e-01; -2.288692895481504e-02   +1.251225424641253e-02   +2.343059130926213e-01   -3.700467311557455e-02   +7.146816371299559e-02   -6.231969770205823e-03   +2.108269750715209e-01   +4.169034107444466e-02   +4.055397506780137e-02   +1.807713756795267e-01   +1.264265277440459e-01   +2.090380696333656e-01   +5.211175488923060e-02   +2.182429187088802e-01   -7.462208814818365e-02   +1.733274674587380e-01; +1.123937770061073e-01   -8.986666441577121e-02   +2.115654581244301e-01   +1.348511181409438e-02   +1.380815469058031e-01   +1.552257736709394e-01   +1.384403357997797e-01   +1.638513990693216e-01   +3.895542846057035e-03   +9.713286875734663e-02   +1.391203505590836e-01   +2.617879699881114e-01   +3.025321132507792e-01   +5.887964817132645e-02   +1.613391931437639e-01   +1.116688806457269e-01; +3.610188661180350e-02   +3.913861282513101e-02   +6.989835757969592e-02   +7.661191770019884e-02   -1.100192095251083e-02   +6.416965750644350e-02   +4.034498621499012e-02   +2.301073956872925e-01   +1.758018749522712e-01   +8.052516404195069e-02   +1.782062579586824e-01   +1.924491744569996e-01   -4.237400956190963e-02   -8.568865755613787e-02   +1.016169413526802e-01   +5.687374422649398e-02; +1.793688762254462e-01   +6.956966420591669e-02   -4.173298872788238e-02   +1.335240561617601e-01   +2.983270214570624e-01   +2.105052284472104e-01   +1.896211837452193e-01   +6.552217484752830e-02   +1.658404032014629e-01   +9.149270900048642e-02   +1.423123823647829e-01   +3.709615124887004e-02   +1.228769348483768e-01   +1.936322404799151e-01   +1.942174328377033e-01   +2.124946764094421e-01; +4.287097332493731e-03   +2.173294679273218e-01   -6.094781230238010e-03   +2.131582423633878e-01   +3.007896165283868e-01   +2.478893339644896e-02   +1.138195808887314e-01   +1.882662789026115e-01   +2.867830000695283e-01   +3.870071592249472e-01   +1.193370023384892e-01   +2.546478745806205e-02   +2.548485969557940e-01   +2.588648354783991e-01   +3.139300709209085e-03   +1.370663150389301e-01; +1.669258037436756e-01   +3.553532497585550e-02   +2.289507154946765e-01   +1.627119242800934e-01   -3.995222753574480e-02   +4.787310146502813e-03   -4.689152481216906e-02   +1.324545105990171e-01   +1.780677343903476e-01   +1.165766259961631e-01   -5.343262000271619e-02   +2.087667011475607e-01   +1.675304925734949e-01   +2.406553523075425e-01   +5.499629352107646e-02   +1.335931338505270e-01; +6.118504160382427e-02   +2.271023919711143e-01   +2.417882166834654e-01   +1.781345099525067e-01   +3.244664849486936e-01   +1.734627351736934e-01   +1.416845024318025e-01   +1.202277417151571e-01   +1.550398678993652e-01   +8.206084573167927e-02   +5.136629173167821e-03   +2.579925213621111e-01   -1.911334428312669e-02   +1.320143886131478e-02   +4.335817330617243e-02   +2.574006473907824e-01; -1.780164975553452e-02   -3.429858937637112e-02   +2.572801206916837e-01   -3.863575866120321e-02   +8.311864364887142e-02   +1.022427146796303e-01   +2.575946019536490e-01   +1.300206415354252e-01   +4.449404445111191e-01   -8.727680048900456e-02   +1.677288826734910e-02   +8.113623576676041e-03   -9.586905388608447e-02   +6.785419942066404e-02   +1.411269915985881e-01   +1.660649478178723e-01];
L1E_L1I_iGABA_netcon = [+1.456466177056250e-01   +1.499524947668754e-01   +1.265572313737020e-01   +7.899457560885560e-02   +1.758108068303643e-01   +2.871908831761136e-02   +1.883934594956665e-01   +2.264434956130548e-01   +1.396256030815149e-01   +6.394770614721937e-02   +2.417335467742314e-02   +1.869972687194616e-01   +3.280762947261185e-01   +4.862140687122170e-02   +1.424394950922859e-01   +1.528107315038059e-01; +2.680648831116314e-01   +4.095494639823663e-02   -4.567797839793811e-02   +7.288598796347168e-02   +2.306872346566624e-01   +1.767768572059432e-01   -4.242047640515066e-02   +1.637695338245025e-01   +2.318888789477841e-01   +2.034196483882567e-01   -3.345689424790348e-02   +2.059034114582607e-01   +8.615250058302115e-02   +1.515877127523224e-01   +1.270263365599298e-01   +7.878271636990389e-02; +2.113797321950890e-01   +3.316295605471770e-02   -1.008155056235711e-01   -3.416055731323825e-02   +1.287386071149951e-01   -3.564575384567559e-02   -8.211020368725601e-02   +1.580878935774206e-01   +1.367394995349448e-02   +6.092952675519037e-02   -6.267465233960907e-02   +9.010741381970826e-02   +1.275507804077546e-01   +2.502022453737002e-01   +9.556551702978935e-05   +6.434636356083751e-02; +1.348824209309432e-01   +1.529063861106062e-01   +1.708544674858849e-01   +1.665558184631837e-02   -1.848559865591762e-02   +1.103205496291633e-01   +7.854749294358310e-02   +1.126278335905930e-01   -4.812865700037209e-02   -1.685576142819434e-02   +1.616116745283699e-01   +8.083509561863783e-02   +8.286066733570521e-02   +1.902953221191790e-02   -1.640002461211868e-01   +3.015516295299770e-01; +3.613638437564226e-01   +7.378582846286608e-02   +2.597835291000090e-01   -3.810133775446240e-02   +1.177211342994230e-01   +1.703189752333785e-01   -2.574473149112904e-02   +1.369378159206650e-01   +1.326489122764071e-01   +2.418730133566165e-01   +1.823148545908464e-02   +8.919088392920213e-02   +4.450704824369284e-02   +1.094948495509037e-01   +1.253321391937092e-02   +3.275262957313504e-02; +1.676615771538712e-01   +2.349934900085714e-01   +1.051314479121571e-01   +1.314891823148140e-01   +1.731406362536498e-01   +3.299272353809083e-01   +1.604212206553678e-01   -9.558770213929330e-02   +2.702974462017134e-01   +1.972099058608297e-01   +4.680113330476423e-02   +2.018561254615045e-01   +1.106959821981282e-01   +7.102024264503409e-02   -1.192373177299279e-02   +9.748012365533057e-02; +1.626309474246546e-01   +1.282381833355709e-01   +1.753821182915923e-01   +1.949893086108144e-01   +2.965534006794851e-01   +9.045588891256844e-02   +1.291297981794490e-01   +4.312287385309548e-02   +4.932771812299317e-02   +6.434854166976178e-02   +1.556021934847916e-01   +2.200897624700437e-01   +6.728214388607953e-02   +1.242577317378495e-01   +9.970536730797208e-02   +1.861222795398712e-01; +2.510017281942012e-01   +3.549356604005548e-02   +3.515816006131439e-01   +7.608396324251843e-02   -4.880263014276742e-02   -4.953747266883178e-02   +1.497019723391263e-01   +4.205512150915559e-02   +1.224373391452409e-01   +1.341956428895349e-01   +2.527816515405846e-02   +1.595748362739044e-01   +9.382544191729514e-02   +1.569749700439601e-02   +1.334951722999341e-01   +1.356933900443480e-01; -1.022259132342469e-02   +3.950441827563250e-01   +1.921040775266095e-01   +1.226426583167299e-01   +1.651632086652852e-01   +1.271356638123524e-01   +3.903911583103863e-03   +6.806520624537213e-02   +1.940501755057051e-01   +1.327704142076199e-01   +1.336364377039156e-01   +1.657279020735065e-01   +4.856883373009130e-02   +2.111166605372972e-01   -1.050193934684389e-01   +1.323756649440217e-01; +5.182659698055411e-02   +2.554602477294394e-01   +8.569777247990112e-02   +1.930016182152595e-02   +1.460993231954480e-01   +2.217616707974946e-01   +9.419531861757149e-02   +3.929238316326833e-02   +1.171783660411966e-01   -1.149357154830213e-01   +1.313925230675347e-01   +1.279214078177507e-01   -3.060090457261441e-02   -4.716042944985546e-02   -1.301678536252739e-01   +4.252461762933182e-02; +2.112075442467474e-01   +8.508908087776604e-02   -7.694659311350750e-02   +1.830698031098151e-01   +1.205948609760604e-01   -2.205567524858647e-01   +3.338849685748133e-01   +2.108406302971808e-01   +7.613681792991724e-02   -3.938448220173374e-02   +1.214656394050531e-01   -1.772928713363894e-02   +1.136157975568832e-01   +8.526604704528282e-02   +1.888753355190469e-01   +7.091123171236333e-02; +6.671065165255038e-02   +1.488315067342806e-01   +1.881881904137941e-01   +8.469858810166805e-02   +1.939913093151823e-01   +2.929012117219464e-02   +1.629566787573866e-01   +1.462545630165418e-01   +2.084656922865516e-01   +1.090146227103321e-01   +3.044693554363255e-01   -1.197307364746352e-01   +1.218017088990966e-01   -4.035044806132350e-03   +1.274930054309943e-01   +1.559992457351528e-01; -1.054068496336905e-01   +1.935645274956897e-01   +9.166463339819386e-02   +1.806134131433310e-02   +2.342916105934631e-01   -6.139620469147835e-02   -1.562091064414896e-02   +1.396408009219764e-01   -1.140782726556369e-01   +1.570600994335048e-01   +1.460044953439889e-01   -3.526518069496443e-02   +1.666360266359032e-01   +6.842499578226667e-02   +2.932772557102219e-01   -1.053177279703805e-02; +2.055564061205451e-03   +2.108992760483682e-01   +1.479462118784910e-01   +2.818463328970655e-01   -4.647254559498162e-02   +1.214721589383701e-01   -1.057112536176918e-01   +2.087920978129184e-01   +2.328655827013701e-01   +1.075182632178619e-01   +4.591163756971760e-02   +3.182484449264428e-02   -7.980292944034237e-02   +2.798538009752623e-01   +2.601752488404886e-01   -6.029341884834202e-02; +2.217095716636220e-01   +8.524363038121942e-02   +2.891666325428617e-02   -1.367931356282344e-01   +5.952482118882657e-02   +1.654631089394521e-01   +1.465703551435351e-01   -2.367155845706725e-02   +1.413241828474343e-01   -2.063082129092267e-01   +1.253011680644620e-01   -1.304099730870384e-01   +1.877169195116388e-01   -4.342867406124171e-02   +1.282720522740749e-01   +1.377583378257491e-01; +6.677372731261375e-02   +4.081429142849123e-01   +1.383313968523866e-01   +9.548869504370966e-02   +1.230572763384472e-01   +1.752763276223311e-01   +1.612279553250182e-01   +5.236753283386439e-02   -2.571300260979868e-02   +4.048572567093042e-02   -6.974659705277729e-03   +1.075440856853551e-01   -1.143347048896037e-02   +1.453236946610291e-01   +6.737972485655162e-02   +2.837055171296998e-01];
L2I_L1I_iGABA_netcon = [+1.307367148579963e-01   +1.498498854685194e-01   -2.944326770815665e-03   +5.460803567626630e-02   +1.378494632572783e-01   +1.079244125383172e-01   -7.819072628388743e-02   +2.141966956373604e-02; +7.947817591868833e-02   +6.912979719602814e-03   +1.566699651146127e-01   +7.928064609482938e-02   +8.553499803942134e-02   -2.345195654059187e-03   +2.730784062970549e-01   +1.592215969193869e-01; +9.748796205900734e-02   +2.306569633622147e-01   +2.752404624461592e-01   +7.361241127046161e-02   +1.167663169154452e-01   +1.525956605171886e-01   -1.937818882158645e-01   +3.253001683409082e-01; +7.455860786449672e-02   -7.229188678454429e-02   -2.718897806109627e-02   +3.392844320795950e-01   +8.321050495031977e-02   +1.741959423093936e-02   +2.452686957890007e-01   +6.913247739627072e-02; +7.709065830569871e-02   -2.714997964700954e-02   +1.799989460731082e-01   +2.573546551427638e-01   +1.149617238753105e-01   +1.876690329932534e-01   +8.731795983162028e-03   -8.284098187236133e-03; -6.434536625852753e-02   +1.429781840737653e-02   +2.300985318120799e-01   +3.446331292219505e-01   +2.006613112684172e-01   +2.420257404679395e-01   +1.431320238982471e-01   +1.181591741674078e-01; -5.493157962429125e-02   +8.240799227381090e-02   -6.098169476824733e-04   +2.654389762952055e-01   +1.299089330863159e-01   +2.180211447857985e-01   +1.137443692387499e-01   +6.556213400799556e-02; +5.527338777042924e-02   +1.022217587874613e-01   +2.045293963690079e-02   +1.264033745615820e-01   +2.362141136685379e-01   +2.578430873921767e-01   +1.019075356884125e-01   -1.249073808747244e-02; +1.482649915691589e-01   +5.357133717880476e-02   +1.217849427932752e-01   -1.629347147154337e-01   -5.521336716914446e-02   +1.771286496583366e-01   -5.435686826853310e-02   +2.000398499608977e-01; +1.767272064284769e-01   +2.545881583947287e-01   +2.081285674539600e-01   +7.641432687527301e-02   +1.341253672050581e-01   +2.833076694125195e-01   +1.333437362093700e-01   +1.212383647542412e-01; +1.149842333210838e-01   +2.052013149105093e-01   +8.485131039176999e-02   +2.258474866255857e-01   +4.908990040880620e-02   -1.363567452550153e-03   +1.393485183591202e-01   +1.422385941721791e-01; +1.976244748829635e-01   -2.360392396464787e-01   +2.182326714405886e-01   +9.341622091518842e-02   +1.617630568187944e-01   -7.095109208073012e-02   +2.431289448666177e-03   -1.066088567128468e-01; +3.098749852034997e-02   -3.247145306657109e-02   -1.706797751290290e-02   +2.417909427335310e-02   +1.869082588071716e-01   +2.055369443396628e-01   +1.451540300163964e-01   -3.668068208675883e-02; -5.108720756447072e-02   +2.136958299983823e-01   +1.536306714969317e-01   -9.905914745977037e-02   +2.864124536297039e-03   -1.034725857544095e-01   +5.710583411329124e-02   +2.271786847498231e-01; -1.183776762296486e-02   -5.081220207718685e-02   +1.768913574320334e-01   +1.263107080662189e-01   +5.979238807490915e-02   -1.360052307258989e-01   +1.479140835647687e-01   +7.861012770868053e-02; -1.036797699278253e-01   +7.479708177627925e-02   +1.813393846735755e-01   +5.157469598403192e-02   +1.656956834969245e-01   +1.895460500396229e-01   +2.412450980253261e-01   +1.265715175565092e-01];
L1I_L2I_iGABA_netcon = [+2.593213788720363e-01   +6.533830677376193e-02   +2.407938121921427e-01   +8.311010556409701e-02   +2.623249441711467e-02   +1.660532809650562e-01   +5.053651502080378e-02   +6.896507252525147e-02   +1.412958257656031e-01   +7.401954075822506e-02   +2.302525902125572e-01   +1.424114366226878e-01   +6.899885793963982e-02   +3.534801217448350e-01   +3.695464631337859e-01   +1.729548066857746e-01; +1.139921893131066e-01   +1.864848907885127e-01   +4.079737120989968e-02   +2.241970495368928e-01   +1.442802381156839e-02   -5.367596107852881e-02   +5.259720698838204e-02   +2.620867246979011e-01   +1.457210429839578e-01   +1.016754924081414e-01   +2.138020316357340e-01   +1.658372452233335e-01   +7.824294569972462e-02   -8.099530274016435e-03   +1.381418111899434e-01   +1.047727531749603e-01; +1.043160189878878e-01   +7.533722136060705e-02   +6.385535980372841e-03   +6.343402663715120e-02   +4.330089597729167e-02   +1.067916660114353e-01   -7.722305187211440e-03   +1.890065877106625e-01   +1.911910951241462e-01   -2.211262168207081e-02   +2.912076371653640e-01   -8.592155863697265e-02   +1.180450234957336e-01   +1.074616865127156e-01   +1.587998709492917e-01   +5.222841406191952e-02; +2.197209832837703e-01   +9.129256477513308e-02   -4.829268415206109e-02   -9.583490616836128e-02   +2.087106359904370e-01   -1.616681627862271e-02   +3.879588081624676e-02   +1.854529266625803e-01   +1.755528559038451e-01   -2.293140456228705e-02   +7.555113583756125e-03   -9.876065884438373e-04   +2.376031000880057e-01   +1.635039449852881e-01   +1.139268747607936e-01   +8.091109865107277e-02; +8.113749674555559e-02   +9.949712431345314e-02   +1.320187866453035e-01   +1.562024056098391e-01   +3.018604969248416e-01   +9.490778229990875e-02   +1.078840899489589e-02   +2.810976185094896e-01   +1.611292388358320e-01   +2.392868103678303e-01   +2.432240854283273e-01   +1.638177814857950e-01   +7.307860420306626e-02   +6.353631326099782e-02   +2.605297718990272e-01   +1.679266336952787e-01; +7.134977149214142e-02   +2.463475485972833e-01   +1.810558377065643e-01   +4.485618556646928e-01   +1.432153282065760e-01   +2.080697027462065e-01   +1.504924553786426e-01   +1.464180731731816e-01   +8.927693192390102e-02   +1.223462722556305e-01   +1.058089821265239e-01   -2.932364531309571e-03   +4.376243508241412e-02   +2.739769879053925e-02   +1.043279677703870e-01   +2.878920058056763e-02; -1.970729537019355e-02   +1.929514283553795e-01   +1.803258103198261e-01   +9.207878442624370e-02   +1.191565495821503e-01   +2.427216853309621e-01   +2.403458470060578e-02   -7.834201091837245e-02   -1.196706162391580e-02   +4.291656604760243e-02   +1.471538511563044e-01   +2.325239764732739e-02   +1.911607960775397e-01   -6.618609554287581e-02   +7.352443665843783e-03   +2.192323172338975e-01; +3.702773753412384e-03   +1.377155493737946e-01   +2.548063777971082e-01   +1.519562943577060e-01   +1.561419074147065e-01   +1.281670551163407e-01   +1.896795249753872e-01   +1.604722465664278e-01   +1.296981090323854e-01   +1.283272162121484e-01   +1.004230335767528e-01   +1.524371849122270e-01   +2.813929373262282e-01   +1.005345687938456e-01   -2.597273812718146e-02   +1.800353524504463e-01];
L2E_L1E_iAMPA_netcon = [+2.055500811995396e-01   -9.852207573893229e-02   -5.061410225523769e-03   +2.283958867841120e-01   +1.766988755663688e-01   +1.411380883722294e-01   +3.183344657837542e-01   +1.953346246506109e-01; -3.845844833109957e-03   +1.549035073233732e-01   -9.205690546783966e-02   -3.273236582586120e-02   -9.508886964130252e-02   -6.541017163865419e-02   +1.772799164448265e-01   +4.791213139268496e-02; +2.737779641155491e-01   +1.842064615879863e-02   +1.038845196175174e-01   +1.174072923051771e-01   +1.040247669037863e-01   +2.279761414705693e-01   +8.564690058067950e-02   +1.018174635727598e-01; +1.719057508056224e-01   +7.243429479153859e-02   +2.061253678139937e-01   +5.509916020259230e-02   +7.542241076613092e-02   +1.473868085095787e-01   -7.744638691345691e-02   +1.424050189454619e-02; +3.257260118357778e-01   -7.806233344561067e-02   +7.745837479824577e-02   +2.507120829370542e-01   +2.580442326700806e-01   -7.160685976748282e-02   +6.563479959798905e-02   +6.702031123249651e-02; -1.148417002078774e-01   +1.537686517557783e-01   +1.319503946697864e-01   +1.141723116956459e-01   +1.790977726673908e-01   +1.971371378802119e-01   +2.554887479828484e-01   +2.438731411992004e-01; -8.599829841378659e-02   +1.677359748696848e-01   +2.305390734973161e-01   +6.972583610709591e-03   +1.029283897423957e-01   -1.147636121305828e-02   +2.989873329702099e-02   +1.801918619742801e-01; +1.294017022365430e-01   +8.936303921677893e-02   +1.808602063145382e-01   +3.569895786363034e-01   +7.512525350933771e-02   +1.121853195442953e-01   +1.343467225678876e-01   +8.657185475487982e-02; +1.893868566375031e-01   +2.508269791131840e-01   +1.764334130095126e-01   +7.250649867292015e-02   +1.191852410125235e-01   +2.610749649905883e-02   +8.004631721877095e-02   +2.109249638752166e-01; +6.273539175791637e-02   +1.325768629554137e-01   -1.850818355751207e-02   -2.007728934886802e-02   +9.443467676834237e-02   -3.032271290280046e-02   -9.281794384827671e-02   -3.095560629893542e-02; +2.239290461821749e-01   +2.723385902636671e-01   +2.441477247757954e-02   +1.805674460401914e-01   +1.534916388167794e-01   +1.507549331841573e-01   +1.137807147886292e-01   +2.402762755744041e-01; +1.636911182739607e-02   +7.525630185177651e-02   +2.233573201774780e-01   +1.038097223890139e-01   +2.412805993056323e-01   +1.570822103540349e-01   +5.343906079686717e-02   +1.179497759389801e-03; +1.393049321867434e-01   +9.266773897034321e-02   +9.382898553094582e-02   -8.655463644055733e-02   +1.220711267778338e-01   +2.768762690717023e-01   +2.017305606305975e-01   +7.697389470425904e-02; +5.317939788982830e-02   -8.281479125382715e-02   +1.868444723147878e-01   +6.146758115371537e-03   +2.545844735789525e-01   +1.684007703957044e-01   +2.500354417193105e-01   +1.138252830604853e-01; +2.098974815807324e-01   +2.281668194018960e-01   +1.386838907829276e-01   +3.983436075157303e-02   -2.429523347181918e-02   +1.901122838427186e-01   +1.384007564465961e-01   +8.847433024204429e-02; +2.274184063424721e-01   +6.378848165652887e-02   +1.625176939578986e-01   +6.952888496269702e-02   +1.355387101161261e-01   +1.507410591721938e-01   +1.414091401907179e-01   +1.229711328580286e-01];
L1E_L2E_iAMPA_netcon = [+5.924414119365756e-02   +2.095995770262596e-01   +1.093281856092231e-01   +2.294637367937253e-01   +2.480682396517268e-01   +1.765325177035436e-01   +1.089622911103099e-01   +4.715269182335110e-02   +2.166065600174082e-01   +1.461552741463963e-02   +2.720744798197052e-01   +2.529128848803665e-01   +2.684817660023237e-01   +9.302059198531834e-02   +2.699266248395168e-01   +4.374127649464303e-02; -1.674398842216125e-02   +1.833100585441534e-01   +1.421772298494902e-01   -1.122259639585857e-01   +2.136555100310216e-01   +4.470965192368735e-02   -7.289661811614545e-02   +3.538990307279841e-02   +2.338275939702517e-02   -6.589326645439535e-02   +3.256776559277234e-01   +4.277430173256157e-02   +9.460590005619933e-02   +1.464515674868529e-01   +6.983893633221526e-02   +1.566867609219905e-01; +2.471231506639780e-01   -1.168363174721228e-01   +1.088629604659732e-01   -8.173723083298969e-02   +1.960822232469871e-01   +1.527386189192043e-01   +1.532929772543416e-01   +2.476010419297965e-02   +1.423793782631904e-01   +8.371564318925917e-03   +2.490567625468136e-01   +1.433880479664129e-01   +2.741823593618135e-01   +1.571713769200057e-01   -3.386294250369488e-02   +1.733332340429116e-01; -1.563140345113183e-01   +2.515860729432042e-01   +2.648502230083587e-01   +3.438044383171850e-02   +1.020289085909483e-01   +1.104262152332222e-01   -1.190801975181865e-01   +8.646022587010423e-02   +1.695161188960996e-01   +1.825139605853012e-01   +1.408594498057984e-01   +2.377918607749585e-01   +1.930170462276015e-01   +2.133805979109810e-01   +1.952510570540194e-01   +1.541477523444423e-01; +1.626150777013388e-01   -3.044873069903348e-02   +1.752509820570400e-01   -1.060993370156184e-01   -4.705021487090435e-02   +2.623663388074243e-02   +1.907696649669134e-01   -6.399061037068024e-02   -2.833485549198322e-02   +5.842074456288673e-02   +1.572568514308061e-01   +1.234825425242500e-01   +1.503109328664947e-01   +1.221904207154035e-01   +1.887536819996077e-01   +2.032094839790913e-02; +2.528309739912257e-01   -5.790976532555088e-02   +2.201560413428309e-01   +5.034712669585072e-02   +6.509659268866889e-02   +8.562234419753444e-02   +1.297859672755969e-01   +8.926002582894976e-02   +1.769928496230665e-01   +1.240272492353441e-01   +1.478228837283622e-01   +1.602291152116661e-02   +2.683348467286342e-01   +1.131701905946268e-01   -2.522052619881017e-02   +1.423819790314822e-01; -1.354575341329090e-01   +1.542613024824996e-01   +8.181279597228705e-02   +1.252469487889657e-01   +2.944290932647781e-02   +2.859257996628427e-01   +1.505266662292435e-01   +2.101113585688638e-01   +5.052740987400973e-02   +3.460038570082678e-01   -1.867343413140835e-02   +9.650231985257171e-02   +1.081982923681021e-01   +5.050135030118129e-02   +6.963242884548854e-02   +2.080314646114191e-01; +3.965916216969387e-03   +2.000247589371203e-01   +1.056268390736906e-01   +2.642312122570346e-01   +4.625664493705592e-02   +1.183532180829972e-01   +7.964231309658006e-02   +2.988842853759749e-01   +2.283875298829369e-01   -9.071518283723411e-02   +1.311391158798174e-01   +3.420809627836761e-02   -7.338277821406114e-02   +3.812192516032338e-01   +6.596936899227049e-02   +1.169866344283776e-01];
L2I_L2E_iAMPA_netcon = [+3.307336012030498e-01   +2.594883915459414e-02   +1.879098334924663e-01   -5.081728347719790e-02   +3.138284640048962e-01   -4.246848811591479e-02   +8.432130919211431e-02   +1.195473360387474e-01; +1.138281000646603e-02   +5.027817801787045e-02   +1.675057648222633e-01   +2.694288918715120e-01   +7.153884703648589e-02   +2.288090524152048e-01   +1.958984015885751e-02   +2.226193975797721e-01; +2.627434958331684e-02   -5.569869851735801e-02   +8.985575312583682e-02   -2.207838386915217e-02   +2.906660825495816e-02   +1.236750478678906e-01   -8.693944141911775e-02   +2.479611680029691e-01; +1.683702156858604e-01   +4.133618912997885e-02   -2.424453096010353e-02   +3.469704470352930e-02   +1.743595827238206e-02   +2.207196486736992e-01   +7.141105820828444e-02   +1.671010820666665e-01; +2.843877789825948e-02   +3.183158997797721e-01   +2.693811152507040e-01   +2.055978568074710e-01   +3.892027723457864e-02   +2.187425434313653e-01   +6.728950738075432e-02   -3.788375567502617e-02; +1.648716273803158e-01   +1.169455907041365e-01   -6.231992616738150e-02   +1.519834186889870e-01   +1.881850770174581e-01   +2.285570038219153e-01   +2.599183043768433e-02   +3.120692567059973e-01; +2.394758864753877e-01   -7.207630824361631e-02   +1.531961341465442e-01   +1.815264414879768e-01   +3.523641812043433e-01   +7.891217656562097e-02   +6.652259782754304e-02   +1.343542430780924e-01; +1.469435234289328e-01   +2.659815056867060e-01   +2.746216120628633e-01   +1.148405629378296e-01   +1.323244408173621e-01   +6.533347855892564e-02   +3.194432761255979e-02   +9.771413305334241e-02];
L2E_L2I_iGABA_netcon = [+2.269127480729024e-02   +9.362837856680413e-02   +1.911974398872053e-01   +5.781819760337836e-02   +7.503929728902227e-02   +1.902953881356614e-02   +5.501000729257798e-02   +1.648300037981413e-01; +1.835378073023411e-01   -1.223590154238321e-01   +2.716401649152857e-02   +1.261855850634959e-01   -9.207065166478784e-02   +1.573513515263691e-01   -2.038333996658312e-02   +1.005252499994669e-01; +1.727097538026727e-01   +4.214370641977717e-02   +2.271237796059806e-01   +1.736571084987877e-01   -8.693595850756020e-02   +2.224006463931971e-01   +1.356358770354956e-01   +2.543441844824851e-01; +1.049424048135986e-01   +3.417100815251169e-01   -7.000060430223223e-02   +3.293537783425013e-02   +8.794064898698202e-02   +1.654596229400563e-01   -3.960184590221712e-02   +3.571154808210502e-02; +9.708520641920107e-02   +1.532237276455969e-01   +2.045246830563270e-01   +7.061970663661975e-02   +1.848828400508457e-01   +8.804113702584393e-02   -1.948601619511048e-01   +3.552867135521825e-01; +5.835252080300674e-02   +1.692410231168436e-01   -4.831780275786769e-02   +1.431942481273529e-01   +1.067105617593719e-01   +1.687792578856244e-01   -4.207362730625375e-02   +8.772297188827027e-02; +1.387455598557923e-01   +1.769788324822076e-01   -2.740720092357854e-02   +2.572476513954282e-01   +1.193196401201453e-01   -2.104256249808145e-03   +5.523937467887530e-02   +1.061668228520702e-01; +3.246697592952381e-01   +1.104269151906940e-01   +4.263018154698778e-02   +1.281763627866750e-01   +1.636803390389888e-01   +2.321244983478409e-01   +1.096117107125934e-01   +1.097886477102442e-01];
L3E_L2E_iAMPA_netcon = [+4.898786212733018e-02   +2.476725163482111e-01   +8.674960069802558e-02   +1.502325087093844e-01   +9.251420070230383e-02   +2.094358935137539e-01   +1.641408035129578e-01   +1.159266683356937e-01   -2.159572351564763e-02   +1.505802255962892e-01   -1.409599617749519e-01   +1.849394005973341e-01; +1.953720174007402e-01   +1.905634873701659e-01   -7.755458872136800e-02   +1.234090739251165e-01   +6.430415715712676e-02   +9.044064038411241e-02   +2.059366911563811e-01   -8.810092433387791e-03   +2.481699193735502e-01   +2.001989153982139e-01   +3.854163372226629e-02   +1.265226857342999e-01; +7.164180398586299e-02   +2.163181046625302e-01   +2.584219787109964e-01   +1.994089287241379e-01   +1.431635942599424e-01   +3.779191558477369e-01   +2.629902709347613e-01   +9.581853317064432e-02   +6.742399399058839e-02   +1.413253119680902e-02   +7.418684370615004e-02   +1.002717585944393e-01; +6.982321694547919e-02   +9.844841067798854e-02   +1.772533799091741e-01   +1.924350144491886e-01   +1.039692782449163e-03   +1.293548711963237e-01   +5.283639483444261e-02   +8.545836111900437e-02   +2.689899843569652e-02   +8.227909352748759e-02   +2.998998279413908e-01   +2.014429165248579e-01; +1.442673406262694e-01   +2.988577858852579e-01   +1.193182168704029e-01   -1.311757273240435e-01   +1.862419706900336e-01   +1.748903901231642e-01   +1.519182624313434e-01   +2.576009692912262e-01   +8.391824889081623e-02   -1.416679857076876e-01   +2.724491713364429e-01   +2.302206456648278e-02; +1.190583598851330e-01   +1.628165125337669e-02   -5.372349417728085e-02   +9.882911888591304e-02   +1.711689742997280e-01   +2.336776438055153e-01   +1.020816918945978e-01   +2.053838772911913e-01   +2.442997021218397e-04   +6.812813661408398e-02   -6.994976556859077e-02   +3.229764332394486e-02; +3.476641572492044e-01   -3.082754138446412e-02   +1.241398510708583e-02   -5.435544129823006e-02   +1.755112930670874e-02   -1.789416322369070e-02   +1.164059726282191e-01   +1.469360015869536e-01   +1.567879583276943e-01   -9.096327815929213e-02   +1.279468656427672e-01   +1.323489940440670e-01; +8.774279072584819e-02   +1.296564677001842e-01   +9.512983833776870e-02   +2.726855667722311e-02   +1.630898892143249e-01   +8.481203105556054e-02   +8.371439992718041e-03   +1.345297437325974e-01   +2.322180076981280e-01   +6.468962505162139e-02   -2.290641322044222e-02   +2.205307593276712e-01];
L3I_L2I_iGABA_netcon = [+2.047828154976813e-01   +4.412434530392859e-02   +1.393698922793973e-01   +3.024359197188208e-01   +1.655441721250893e-01   -4.108772158628855e-02   +3.716858921716566e-02   -4.567240448047750e-02   +6.966151027161639e-02   +2.179211001825712e-01   -1.470857085314039e-01   +6.655817654110482e-02; +3.353877502458547e-02   +1.109290151933215e-01   +1.262058089458233e-01   +1.823185991073299e-01   +1.848365786338661e-01   +1.331022703548173e-01   +3.888520289013056e-02   -5.360406116674957e-02   +2.617595626151370e-01   +1.876410917564402e-01   +2.280887037010459e-01   +1.957145739119349e-01; +9.980502095630124e-02   +2.161693280015904e-01   +4.656145902473161e-02   +1.846385573150383e-01   +2.506929803285061e-01   +1.180991201136140e-01   +1.380047729061697e-01   +1.769684558953880e-01   +9.841425687889740e-02   +3.147269520392202e-01   +2.415082822280004e-01   +1.441925678661176e-02; +1.437270674048591e-01   +3.185130050669789e-01   +1.579187775476392e-01   +3.031908323489954e-02   +2.935673846532081e-01   +6.066161218171238e-03   -1.371800723307290e-02   +1.266358027790364e-01   +8.777614388826743e-02   +2.182557080401519e-02   +4.670261162770001e-02   +8.646879153113937e-02; +1.818566887068959e-01   -1.240464381292856e-01   +2.173398080746755e-01   +9.237828328503689e-02   +8.919612420033002e-02   +1.565394312083881e-03   +2.221982454112421e-01   +2.596070359111040e-02   +1.598549999229762e-01   +1.058233664551913e-01   -4.245316484385603e-02   -4.346372292267676e-02; +1.006169069728173e-01   +2.534383586096676e-01   +2.375745201354837e-01   +1.193040830301555e-01   +2.267765233685947e-01   +2.067084574067689e-01   +4.414310457880477e-02   +1.168016367142967e-01   +2.448623835385972e-01   +1.351357245857642e-01   +1.062684074936985e-01   +1.282935794816704e-01; -2.293220625274457e-02   +1.776704028601770e-01   +2.667072467689328e-01   -9.060552674252077e-03   +7.153685040058277e-02   +1.777365048249801e-01   +2.078057483445330e-01   +2.528287131201949e-01   +1.587842549568161e-01   -1.018296573447659e-02   +1.525519027055959e-01   +7.386172567923757e-02; +5.041597696856311e-02   +5.694683230168836e-02   +8.452466916890930e-02   +2.835516002168251e-01   +1.787791866393658e-01   +5.609637944772021e-02   +1.167280300603852e-01   +1.735066704756390e-01   +3.552994972548759e-02   +7.348605283756472e-02   +7.148511956375903e-02   +1.534550278184103e-01];
L2E_L3E_iAMPA_netcon = [+5.398964385568451e-02   +2.155055595563331e-01   +2.249849913550240e-01   +4.528082730787050e-02   +2.059509109362451e-01   +1.466009348403254e-01   +2.387856427634804e-01   +7.990452228206549e-02; +6.200878055607291e-02   +1.714238052229044e-01   +1.802610712236734e-01   -4.525090428131562e-02   +2.160739290543793e-01   +1.095840924650577e-01   +1.733762655960123e-01   +6.264861032696258e-02; +7.131746039288092e-02   +1.080977858265688e-01   +9.353733704103449e-02   +2.894088548636984e-01   +1.600202297486809e-01   +3.269940016163714e-01   -5.042235434123631e-02   +2.716372508271517e-03; +2.534624627814187e-02   +1.396450099414658e-02   +1.041682492779960e-02   +7.559900356047519e-03   +2.205153577802352e-01   +1.656924175227251e-01   +2.466105496182768e-02   +5.084281410036429e-02; -3.293688380803816e-02   -2.112927029000841e-02   +1.947636966181555e-01   -1.139321875245118e-02   -2.944344427562796e-02   +1.078836429159193e-01   +2.265366587594421e-01   -2.329318774497549e-02; +8.172148297391825e-02   +1.080522203486542e-02   +3.855000392772737e-02   +1.008862139333244e-01   +4.315593052346280e-02   +1.158223462490857e-02   +3.400927839362980e-03   -1.163045190427409e-01; +7.795961984545779e-02   +1.539792746833034e-01   +1.680434944030005e-01   +1.567078959515963e-01   +6.235082071237372e-02   +1.721869649791588e-01   -6.579433283882358e-02   +1.753213235156307e-01; +1.615205329395680e-01   +1.105989896143496e-01   +2.643114863264918e-02   +1.261994208019455e-01   +1.124693177563311e-01   +5.757142547129556e-02   -7.764808423484371e-04   +2.703408272961385e-02; +1.440573072405292e-01   +1.835171604653836e-01   +1.112580341128804e-01   +1.263682708889716e-01   +1.484392536061082e-01   +8.494958397622059e-02   +6.141468668231305e-02   +1.096713422640594e-01; +1.298189162313562e-01   +2.956990281592085e-02   +6.441612426179512e-02   +2.684926267984206e-01   +1.329124804230612e-01   +2.794810230361121e-02   +2.556272869020464e-01   -2.479203211536195e-02; +1.606856570451526e-01   +2.254929844213808e-01   +1.877041742224964e-01   +1.692843113166047e-01   -4.725288952175110e-02   +4.346789008898625e-02   +1.369404849712374e-01   +1.197353327994528e-01; +2.272660223814033e-01   +2.099902055061640e-01   +1.309942633693343e-01   +1.697837746836340e-01   +1.207021104377780e-01   +2.840003548195780e-01   +8.828617448202558e-02   +2.141816883540904e-02];
L2I_L3I_iGABA_netcon = [+3.211495360039019e-01   -1.022042969376145e-01   +1.346323138325702e-01   +8.423284500289384e-02   +1.970471141535800e-01   +1.248553949954760e-01   +2.513248873585601e-01   +3.552542145368259e-01; +2.069805456989150e-01   +6.456294612483503e-02   -4.711303084578264e-02   +1.741582757867495e-01   +1.636025045889188e-02   +5.078894405665828e-03   +1.371130536567199e-01   +3.972242031534551e-02; +1.687078762134676e-01   +5.847806164845390e-02   +1.560845466047156e-01   +1.922900296418853e-01   +1.108886050188819e-01   +1.188482391093172e-01   -1.355685300089470e-02   +1.690647416297488e-01; +2.746100867507259e-02   +2.294448232755638e-01   +2.638783049501042e-01   +1.722805928879337e-01   +9.327200042355624e-02   +2.299459612501584e-01   -1.873561643900732e-02   -9.445811749168653e-02; +3.938352780113001e-01   +2.759688843660414e-01   +9.816174192964754e-02   +1.393046290740316e-01   +6.570975883508046e-02   +8.993995581997663e-02   +2.131096921918699e-02   +1.912564203449895e-01; +2.980033209586476e-01   +1.709395825383031e-01   +2.184057656843644e-01   +1.598116967013499e-01   +3.397632430209143e-01   -1.088954275355023e-01   -5.848753633989946e-02   +2.446149683245523e-01; +6.310236349143361e-02   +1.520894737388582e-01   +1.854721753061103e-01   +2.566518246823820e-01   +9.672827484258152e-02   +1.150605922466901e-01   +7.296044989740710e-02   +7.108530573664626e-02; +3.453612863944604e-02   +7.928220200908097e-02   +1.318435751538797e-01   -1.896154634047813e-02   +7.908992836066500e-02   +8.635219330812169e-02   +3.072639697566269e-02   -1.216771994151991e-01; +1.361803925523905e-01   +1.844149775752933e-01   +5.986518845091985e-02   +8.296419708889935e-02   +2.044110711656496e-01   -2.480450568114617e-02   +1.388301982548977e-01   +3.468042987435009e-02; +8.867782823240107e-02   +7.611138469879651e-02   -8.919908723373486e-02   +1.744966194770951e-01   +2.420180075291951e-02   +1.200324040084303e-01   +1.800989122558982e-01   +9.886644240216437e-02; -3.906241339094270e-02   +2.392877513468778e-01   +3.396042397006104e-02   +1.799067914308474e-01   +1.419398616994413e-01   -7.205051783390623e-02   +2.444078952943685e-02   +7.625660806411064e-02; +1.231038192048633e-01   +1.926047011797520e-01   +1.084710495012257e-01   +2.433365980444704e-01   +1.453776964756238e-01   -1.383110433167512e-02   +2.262409524124906e-02   +1.629817278576334e-02];
L3I_L3E_iAMPA_netcon = [+2.473019270035547e-02   +2.614071697639907e-01   +9.441218656523408e-02   +1.777831676135954e-01   -4.431598537110303e-03   +1.004821690836238e-01   +5.278387006889892e-02   +1.360940136374126e-02   -3.439376277605465e-02   +1.931063910346858e-01   +2.018443979613793e-01   +1.325588833712812e-01; +2.456537825366279e-01   +1.856381862227733e-01   +2.436387291573577e-01   +1.329915405277181e-01   +2.495303455026702e-01   -2.582364759635885e-02   +7.308716468616973e-02   -2.956537350624135e-03   +1.780761286515115e-01   +1.246680750355423e-01   -2.292054344794344e-02   +1.464210647975882e-01; +5.506964808476853e-02   +1.385335734109350e-02   -5.574677145546532e-02   +4.230202273418243e-03   +1.269965231595756e-01   +2.607488296786656e-01   +2.175278940887979e-02   +1.862188181878782e-01   +4.651695661096242e-02   -1.187089912620796e-01   +1.255891923063047e-01   +3.177903724078801e-01; -5.668459365182828e-02   +9.414293598703750e-02   +1.877960952242302e-01   +1.207085480736319e-01   +2.231357475613736e-01   +4.044915550599882e-02   +4.664751833154859e-02   +1.005430049492386e-01   +1.140794945202425e-01   +7.198516142791184e-02   -2.831565776251546e-02   +1.904652374946633e-01; +1.258396539501119e-01   +1.167240172386001e-01   +3.118495798315953e-02   +6.383319736365081e-02   -3.600906097324445e-03   +1.605514538920100e-01   +1.363843520885108e-01   +5.790078736303418e-02   +1.562642635564251e-01   -2.621224176102747e-02   -1.324878377135063e-01   +3.283871154309746e-01; +1.832231805218485e-01   +1.133946545384126e-01   +1.711858317491521e-01   +7.322324014137228e-02   +1.667984348360275e-01   +1.162825685966735e-02   +1.788774367519502e-01   +1.039938651257017e-01   +1.977640633846334e-01   +6.379823255204115e-02   +3.022893374393820e-01   +2.786864300219244e-01; +1.617529723701253e-01   +2.426339766858263e-01   +3.430679305680509e-02   +1.582421086899707e-01   +2.335143605894689e-01   +8.861172512767610e-03   +7.327532098131663e-02   +1.551462653657804e-02   +2.810653591333846e-02   -1.066933269931465e-03   +4.265823771842711e-02   +2.881249435325021e-01; -3.639327952061353e-02   +9.463754337865529e-02   +5.702166678052967e-02   -2.197687742144471e-02   +2.361038838608844e-01   +1.229375372284659e-01   +9.835257112483725e-02   +4.018641869054639e-02   +6.374000149842550e-02   +1.998285120365530e-01   +2.873234204740404e-01   +1.541038888282206e-01; +5.827756868826642e-04   -1.298093186465304e-01   +6.223498749823083e-02   +2.340275197746810e-01   +1.581742776548020e-01   +2.076592604672233e-02   +8.167523032177035e-02   +8.038025348652972e-02   -7.953749666253401e-02   -6.470743858804812e-02   +1.229865294718503e-03   +8.356569570948089e-03; +1.868015976041315e-01   -1.535715354713987e-01   +8.950491251239068e-02   +2.103096259179112e-01   -8.918899017714926e-02   +1.942346903943982e-01   +1.545421925056770e-01   +1.771991569786149e-01   +2.156973031011962e-01   +1.113644321419746e-01   +2.518322842374114e-01   -4.397413341639458e-02; +4.691295255377878e-02   +1.651677234202306e-01   +1.827568106935048e-01   +5.106840754405930e-02   +2.990660890167301e-02   +3.599672625065899e-02   +2.969085800482927e-01   +1.134311589639176e-01   -6.698769406254620e-03   +1.084135263928810e-01   +6.843801633839278e-02   +6.365528726792045e-02; +2.949517113943948e-02   +1.829008226924265e-01   +2.535304480512061e-01   +1.990419625556260e-01   +2.414278937082636e-01   -1.536933819258776e-01   +1.263039179960992e-01   +2.098539389734130e-01   +2.136023652292320e-01   +6.005843368113344e-02   +1.600380880686877e-01   +3.244763305829793e-02];
L3E_L3I_iGABA_netcon = [+2.736467482030041e-01   +1.820791376680079e-01   -7.226290751303596e-02   +3.196679152284944e-01   +8.429644685682462e-02   +8.159199723708634e-02   +1.092728815177487e-01   +8.866225222603957e-02   -1.301097363174516e-01   +2.406550684098870e-01   +2.438996908515949e-01   +2.165685270186868e-01; -9.246732338658470e-02   +8.044214175059211e-02   +1.857381835206149e-01   +1.591269538862383e-01   +1.773519830713568e-01   +1.195789850329503e-01   +2.913957991612973e-01   +2.137386016085389e-01   +1.721349476218571e-01   +1.262772073966647e-01   -7.997449839404307e-04   +2.499922510739037e-01; +1.298068799437440e-01   +2.105823691142497e-01   +1.587018227279609e-01   -2.900634457883956e-02   +3.694609454401943e-02   +6.085461393694530e-02   +9.147113663864873e-02   +1.890543148799499e-01   +2.776450065713388e-01   +3.507920864252478e-02   -1.832053685105469e-02   +4.506352844877488e-02; +3.610897732519502e-02   -2.104959901380282e-02   +8.644557251536460e-02   +7.765612277768341e-02   -1.238354310405595e-02   +1.480493353762221e-01   +6.510189585292253e-02   +3.571304225051531e-01   -4.714466502629365e-02   +2.961494009993539e-02   +2.163073611204729e-01   +1.232694043139000e-01; +7.118038244193457e-02   -1.374822773377329e-01   +3.268574718748555e-01   -9.905706706985215e-02   +2.115457566815157e-01   -1.454959937497731e-01   +2.490561576851802e-01   -1.685371035654785e-02   -4.643581925801055e-02   +1.602350486768203e-01   +3.220101267401813e-02   +3.178389211549697e-02; +9.942370796721405e-02   +1.285412794325586e-01   -7.103381606040404e-02   +1.601320403411288e-01   +1.495404564652317e-01   -5.558354428818758e-02   +1.034055311349381e-01   +2.176324913065472e-01   +1.569006259342543e-02   +4.148848237736188e-02   +6.780003344218404e-02   +1.441452109577591e-01; +1.313068928770118e-02   +1.748937172459502e-01   +3.084779555401508e-01   +5.611274563091656e-03   -8.365140672535690e-03   +1.160093309046464e-02   +7.187244122122839e-02   +1.661582512327017e-02   -5.944559521564147e-02   +1.436565134101014e-01   +1.349122030626065e-01   +1.698872623784212e-01; +1.239100613807086e-01   -4.558804304826945e-03   +1.627410640898001e-01   +7.803688788230681e-02   +3.715547982297420e-02   +1.772922863029406e-01   +1.156071686740326e-01   -8.063123289510951e-02   +1.663635837228022e-01   +1.730115606241981e-01   +3.187002933621174e-02   +3.268245257710179e-03; +3.461888122289768e-02   +1.246857405714695e-01   -2.345104308534192e-02   +1.081932155414890e-01   +1.735141215354986e-01   +1.235538671202541e-01   +1.025865717453553e-01   +1.849655154015816e-01   +1.194998173342957e-01   +1.295906839590558e-01   -2.485205016044782e-02   -6.661087807934807e-02; +9.882189973180290e-02   +2.600818882758182e-02   -1.385079067404655e-01   +1.324988392285907e-01   +2.445118100458415e-01   +1.612251667176614e-01   -1.023837053944191e-02   +2.521669139633617e-02   -1.488477291834853e-02   +2.218547413408219e-01   +4.240731241923746e-02   +4.307149059959772e-02; +1.059685367052717e-01   +1.108748491393026e-01   +5.835174143127317e-02   +2.077893643247583e-02   +1.461187119344870e-01   +1.984319902502626e-01   +1.610079258529625e-01   +2.089644652885438e-01   +7.577721514119908e-02   +1.436771891485757e-01   +8.928187532515458e-02   +5.445813713365982e-02; +7.063205283649840e-02   -1.309035006502003e-02   +8.824151819821732e-02   +1.956602477817123e-01   +7.339301143821908e-02   +5.767240499205833e-02   -1.583230422643349e-02   +1.282832939641597e-01   -1.761442884551458e-02   +1.291884257923318e-01   +1.676209921366013e-01   +1.637092513670433e-01];
L2E_Input1_iAMPA_netcon = [+5.298246766642857e-02   -1.645399070077630e-02   +2.984781015052507e-02   +8.302204045580822e-02   +2.464752808826143e-01   +2.187810858025423e-01   +1.346000002948894e-01   +1.656434458906566e-01];
L2I_Input2_iAMPA_netcon = [+2.494495910226967e-01   +5.219212227411968e-02   +2.350412894951930e-01   +2.237223316578769e-01   -1.254886743195260e-01   -8.870783810755632e-02   -2.817231098405769e-02   -1.002978611454901e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
