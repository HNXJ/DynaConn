function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.244228175399770e-01   -1.595037195224818e-01   +1.439003173502245e-01   +2.940717262976029e-02   +3.347929197359103e-01   -8.884944826766000e-02   -3.402116174538041e-01   -2.985458692192663e-02   -6.598716856326894e-02   -2.110670024171526e-01   -2.167848668587630e-03   -4.500436048788797e-02   +4.398948461219085e-01   -3.135547428441071e-01   +1.889966488962653e-01   +4.481225545936102e-01; +2.188958039645340e-01   +2.452060432864979e-01   +3.248338824876279e-01   -1.814022032062823e-01   +1.856406742982032e-01   -1.711199744641864e-01   -1.035350784956719e-02   +4.522480112649102e-01   -4.524585857536201e-02   +6.116634243451721e-01   +3.899314093261588e-01   +2.914583713171626e-01   -4.896683810357569e-02   -3.948596995896852e-01   -4.189005801332241e-01   +3.049272183450203e-01; +5.092019529354304e-01   -2.296171313555825e-02   +6.598884442121947e-01   +5.203810455413193e-02   +7.523278103721185e-01   +1.225239021124964e-01   +1.245973445568861e-01   +2.981202334724517e-01   +1.803096021964437e-01   +2.215814394963995e-01   +3.136110302319606e-01   +2.612156915511080e-01   +8.501692583288589e-02   +4.412829056249736e-01   +5.954576580300243e-01   -2.519181578794578e-01; +4.802315668951761e-01   +1.850883148311172e-01   -3.276372896522996e-02   +3.831003026635786e-01   +3.471693879658376e-01   -9.921396997551551e-02   +3.744225608920269e-01   +1.155490391865823e-01   +5.308388281447740e-01   +5.757894275936418e-01   -7.624752629541974e-02   +1.519997766016684e-01   +2.798956069618388e-01   -5.064963485537081e-03   +5.118552134371197e-01   +2.615839395577784e-01; +1.327269021969302e-01   +2.716510422967838e-01   +3.958733286629946e-01   +1.154285707695969e-01   +2.375001348649566e-01   +3.185413888698325e-01   +8.683959150847767e-02   +3.091003347792206e-01   +6.072435897109648e-01   +3.329730394312646e-01   +3.997315046317440e-02   -2.598193128681200e-02   +1.957172682445051e-01   +4.902660862474316e-01   -2.757552474249180e-01   +1.293412511151096e-02; -1.083139442262906e-02   -3.011849810218700e-02   +3.880233823847646e-01   +5.795408663344659e-01   +8.639531346504878e-02   +2.449823314262730e-01   +5.514351436115905e-01   +3.615802217539114e-01   -2.516412248109214e-01   -2.756869885189530e-01   +6.132168485442521e-02   +2.953597376913102e-01   +2.068038552197445e-01   +1.017448512528473e-01   +3.521067473218329e-01   +6.121073975610087e-02; +1.828143511499305e-01   +2.210013386270253e-01   +3.205148410529636e-01   -1.715848380307235e-01   -1.713928027601842e-01   +3.166087544094236e-01   +1.106584747844028e-02   -1.161269523866211e-01   -1.686275286898005e-01   +2.464001112556127e-01   +1.467425617638805e-01   +1.222552072830813e-02   +3.681104389232984e-01   -1.398015960897583e-01   +1.492559347667807e-01   -9.683599650684993e-03; +1.050742140744085e-01   -3.184583103932869e-01   +4.626731663390511e-01   +2.246619651481941e-01   +8.133383221242035e-02   -9.559120430568632e-02   -2.517493182671256e-01   +5.414476088532137e-01   +2.389321369719386e-01   +3.472375262259669e-01   -2.183341755596425e-01   +3.158547564499448e-01   -1.078897495710085e-02   +1.931701358712630e-01   +1.405049871999933e-01   -3.051157830508054e-01; +2.795596557904281e-01   -7.898219643493552e-02   +1.393717679661846e-01   +2.829818097060879e-01   -3.081133162573587e-01   +9.096412892441705e-02   +3.590289392707496e-01   +1.915263645961262e-01   -2.222693764923805e-01   +4.202547407404951e-01   +4.444417922622780e-01   +1.543219956119752e-01   +1.039768097109297e-01   +4.725653622667411e-01   +1.396253858463846e-02   -1.501313447871706e-01; +6.582844976472391e-01   -9.349136986605036e-02   +8.662709405308737e-02   +1.494791628074516e-01   +2.659465415320160e-01   -1.125366808130190e-01   +1.256345048473731e-02   -8.857976847334229e-02   -2.151766136271310e-01   +2.578160093671717e-02   +2.690286200832781e-01   +3.688194853585744e-01   -8.191896213739976e-02   +5.607253341571931e-02   +2.062219320578030e-01   +1.661831600104913e-01; -3.070098014328758e-01   +3.323820173807219e-01   -3.350008107812880e-01   -2.181407397468297e-01   +3.834842572101258e-01   +1.380960673415377e-01   +3.256426875227169e-01   +6.211363949215751e-02   +5.198044424631040e-01   -3.688948062810475e-02   +3.634351409611997e-01   +1.795152255063404e-01   +3.654645071761833e-01   +1.576680402734168e-01   +1.858696351567332e-02   -2.051631879439464e-01; +8.255089037670134e-02   +3.376184787481104e-01   +1.721960524697030e-01   +3.602105081748603e-01   +2.460004506207492e-02   +4.047965888456086e-01   +4.695451875157647e-01   +7.622215559987985e-02   +1.543903947259759e-01   +6.011980225220534e-02   -7.975405792557540e-02   +1.233147410336585e-01   +3.669951033287269e-01   -2.392351760050492e-01   +3.115726799847447e-01   +2.696435853794080e-01; +3.610550308261696e-01   +5.748644966146427e-01   +1.963797762485096e-01   +2.496596103369308e-01   -3.664033657197580e-01   -2.373667656927870e-01   +1.751249854651345e-01   -5.768590375734306e-02   +3.036725944381193e-01   -1.361856297551776e-02   -4.285517871480455e-01   +3.756162055180965e-01   +4.483766930869062e-01   +2.440173695781347e-01   +8.327630184813298e-02   +1.145756126588851e-01; +4.533903125878485e-01   -1.367403474481239e-01   +5.378657361680532e-01   +2.070364488118233e-01   +1.907755924608741e-01   +6.231941785207719e-02   -1.811902970930142e-01   -8.928185575604893e-02   -2.601249125246333e-02   +1.237765130268998e-01   -2.312168354036712e-01   +5.707978981808510e-01   +2.685116730009132e-01   +3.981420791128550e-01   +9.347914382749276e-02   -2.165093163215236e-01; -6.448528231184195e-02   +2.702077140199516e-02   +1.982100987051159e-01   +4.394076603404110e-02   +2.826513770592274e-01   +5.262670534604518e-01   +1.553137530520605e-01   +1.659141881437818e-01   +1.947325444506640e-01   +8.270402873818472e-03   +6.747629506852376e-02   +1.207952876991748e-01   +7.189170166304961e-01   +3.055757873242609e-01   -1.448413165333863e-01   -2.493227111502541e-01; +2.706654848447954e-01   -7.363333824966069e-02   -1.516796653539140e-01   -3.184568914665342e-01   -6.606386102491324e-02   +6.675139143086424e-02   +3.834373320543032e-01   -2.374115783864704e-01   +6.254083186664129e-01   +5.837754487165600e-02   +2.207876366354831e-01   +1.126585582625196e-01   +1.642771647722627e-01   +4.079730430520196e-01   +1.484554683817660e-01   +5.210083653410259e-01];
L1E_L1I_iGABA_netcon = [+2.152949910424883e-01   +3.276660450904862e-01   +1.183240855025651e-01   +2.662621434546344e-01   -1.006789141317533e-01   -8.014085023466179e-02   -2.172196336821249e-01   +2.922476719567427e-01   +2.659651062597371e-01   -1.803132459461615e-01   +3.138082496471207e-01   -7.173118550939546e-02   +3.342384435578635e-01   +2.735597752564054e-01   +2.247985819599658e-01   +1.234354433533832e-02; +3.289786511849730e-01   +1.564722809963760e-01   +1.609307708038997e-01   -6.344842818013771e-02   -1.012330711831623e-01   +8.449471160977519e-02   +1.614156564524253e-01   -2.637589010442673e-02   +2.533203457738488e-01   +3.500703142932239e-01   +3.899900752871618e-01   +8.032688999219353e-02   -1.379527643319334e-02   +4.146162290966918e-01   +5.166933554635298e-01   +1.002029985011095e-01; -7.370527125919261e-02   +3.322159881961829e-01   +2.256820772984099e-01   +1.847021005571501e-01   +4.629388529210826e-01   -4.391284739789302e-02   +7.780676181184318e-02   +2.803951688485093e-01   -2.150112870598326e-01   +2.463867180214865e-01   +7.263250449933006e-03   +2.034597444937741e-01   -2.960718456162831e-01   -4.008724759504891e-02   +1.192880871341810e-01   +3.143086902260566e-01; +4.809639835236390e-01   +3.138986108285066e-01   +2.138223813909512e-01   -2.012217605362955e-02   +1.248044655580494e-01   +4.288668128756604e-01   +9.431400940140784e-02   +3.736196626243533e-01   -5.047951835552046e-01   +3.283143615906875e-02   -6.831725382923806e-02   +1.108276331686913e-01   +5.482085206237119e-01   -2.396380734378460e-01   +6.344146045084211e-01   -2.250744964643346e-01; +3.686830255462558e-01   -1.588111449838303e-01   -3.672116297235195e-02   +4.242372542631289e-01   +6.046277917860399e-01   +2.033741037979445e-01   +8.800694262712627e-02   +4.736746928758666e-01   -6.216775033957173e-02   +2.638969457378200e-01   -7.999176583338984e-02   +2.378153977956120e-01   -1.726154094025207e-01   +8.268141229805771e-02   +3.233592320594801e-01   +3.424457904294739e-01; +1.425673324934230e-01   +6.241113252664721e-02   +3.218046912919631e-01   +2.122149244126920e-01   +6.408138381326595e-01   +1.529534459230246e-01   +3.398018874625062e-01   +9.440700003610582e-02   +2.933008818278509e-01   +1.601027120960528e-02   +3.877923123073732e-01   +3.524407862256461e-01   -4.253015480735488e-01   +3.690508498438719e-01   +3.578720785180280e-01   +1.278626324223829e-02; +2.982689323066128e-01   +1.412958233800108e-01   +6.285718208094424e-01   +3.452942022182680e-01   +1.314922181074414e-01   +1.585813513561236e-01   +7.446782057880651e-01   +2.734900676814084e-01   +2.412257475357616e-01   -1.897663883948233e-01   +5.796119317353948e-02   +2.309935063587287e-01   +2.378044528632707e-01   +2.698749823257651e-01   -5.314449991852409e-02   +3.845546295817664e-01; +4.695191515387122e-01   +1.781853554121003e-01   +5.016182001063038e-01   +3.193078520134827e-01   -1.407551086452445e-01   +3.004179252222897e-01   -2.508813023393536e-01   -1.363640730218515e-01   -1.422936504779645e-01   +2.468773125706655e-01   -6.304317705052409e-02   +2.768254088333977e-01   +8.484763236467002e-02   +7.226831363125100e-01   +1.421308778983247e-01   +2.069250868066647e-01; +3.081621634512736e-01   +5.084301954320360e-01   -2.735733236491800e-01   -2.450977317135239e-02   +1.431034093537225e-01   -2.560275696900115e-01   -7.077727241662501e-02   -1.460674692298762e-01   -1.398713676635995e-01   +4.102107335806964e-01   +3.908310829871143e-01   +3.695458297136989e-01   +4.524587712951625e-01   +2.497069233124727e-01   +1.755224414246870e-01   +1.810218026078938e-01; -2.200372575429699e-01   -2.250908015613034e-01   +3.098801522710432e-01   -1.960494011194912e-01   -1.766893234102626e-01   +4.214132029672987e-01   +6.115839073695496e-01   +2.956754469279400e-01   +6.785368350488624e-02   -1.178833441879917e-01   +3.528278730061433e-01   -6.450312794989244e-02   -1.347884807307576e-01   +2.266240149277487e-01   +4.620993363836395e-01   +7.975285179644298e-03; +4.740339603144207e-01   +1.217780892071303e-01   -6.497668983699874e-02   +2.026038352908712e-01   +1.436797536711726e-01   +8.500889732609701e-02   +2.103523474041207e-01   -2.017871519139405e-01   +1.955469767728108e-01   +7.612452712941026e-02   +2.875457080867477e-01   +1.806649580740282e-01   -8.573915919426527e-02   +2.561560015233976e-01   +1.389259814294925e-01   -2.741742274505272e-01; +2.177513959731912e-01   -2.916811671531756e-01   +4.474158044474998e-01   +1.316696024437367e-01   +2.337551758374148e-02   +4.711719445387256e-01   +3.849655346470281e-02   +4.484722556903412e-01   -4.783772508953520e-02   +6.878508303438522e-01   +2.881120738192186e-01   +6.332623588067889e-01   -1.922123598500708e-01   +1.536182127250608e-01   +4.316225808205847e-01   +3.310315451120790e-01; +2.059252990328956e-01   -1.698037216177984e-01   +7.792576707153775e-02   -1.502067299396698e-03   +3.912645205324676e-01   +2.756560946452237e-01   +1.984259015970079e-01   +1.209677136587008e-01   +3.271334599670970e-01   +4.402241722284144e-02   +2.197617435502288e-01   -2.421556729760302e-01   -6.606464846088393e-02   +1.635047057857970e-02   +4.011332629348936e-01   +8.988990649324841e-02; +7.177035938446999e-02   -3.336119675418041e-01   +1.839701679058834e-01   +2.805030753876745e-01   +3.610071488153916e-01   +1.938992724780582e-01   -1.160563907378616e-01   +7.119987442298036e-02   +5.989423945781798e-01   +2.431870078188005e-01   -1.224786387734879e-01   +2.357820691345513e-01   +5.836181311792221e-02   +1.898617537396697e-01   -1.229622855689012e-02   +2.491990014948428e-01; +3.189559214330753e-02   +4.845400913145185e-01   +8.910831661036790e-02   +1.237116029667363e-01   -4.015644062463400e-02   -2.305556580721839e-01   +4.379531707813417e-01   -3.436015151879813e-01   -3.799581615461530e-01   +9.493341581164663e-02   +2.427564558247256e-01   +2.346523196031704e-01   +1.462701388206820e-01   -2.937562781022582e-01   +4.485733475981602e-01   +1.859638911463954e-01; +8.599970968917973e-02   +1.033755338440084e-01   +1.348743511534324e-01   +6.087114528577935e-01   -3.404886945700396e-01   -1.866819987088195e-02   +3.202854586543324e-01   +7.467729540139936e-02   +6.221893448125911e-02   +5.760208678534422e-01   +1.819606354219873e-01   +1.499402764992035e-02   +1.199087380463669e-01   +4.133145561725226e-01   -2.708299967057702e-01   +2.743256482738456e-01];
L2I_L1I_iGABA_netcon = [+5.541711855065222e-01   +4.084238850316474e-02   +4.749511860589651e-01   +1.912554797652344e-01   +4.296192148020841e-01   +5.030212854062404e-01   +2.168153215882486e-01   +1.974384365822190e-01; +4.558039580424766e-02   +3.972293119681289e-01   -6.188319567910276e-02   +1.004114130770661e-01   -1.778575577342245e-01   +3.956155469618617e-01   -2.688871587426173e-03   +1.616715042072955e-01; +2.332644852354321e-01   +5.252149579505161e-01   +2.133050144875906e-01   +8.245591056450791e-02   +4.314925475507950e-02   +1.842457389388387e-01   -1.968966078965814e-01   +4.093567833796830e-01; +2.801369953430694e-03   +3.129447223091107e-01   -2.593028334835770e-01   +3.033087486653742e-01   -1.060282317851584e-01   +2.213335294421237e-01   +4.474058130867250e-01   +9.562617895018874e-02; +2.133114638668727e-01   +3.402697876626307e-01   -2.790203285857021e-01   +2.624761193235162e-01   +3.978590841101420e-01   -1.723204413767175e-01   -3.470680098301931e-02   +4.010647080934762e-01; +1.411652358276446e-01   -1.530939782983983e-01   +4.537032801587045e-01   +2.506700311303980e-01   +1.603979651572509e-01   -3.482219161281656e-01   +1.271335629352945e-01   +1.069483375469716e-01; +2.252365998190772e-01   +6.016136907900598e-01   -1.549696735050332e-01   +8.855525518974294e-02   +3.430287780730024e-01   +2.710385818597281e-01   +1.253292234904190e-01   -2.800639753543194e-03; +2.992624001780103e-04   +2.000199386117358e-01   +1.874331032304716e-02   -1.743885401805875e-01   +3.014245391912576e-02   +3.330746231225885e-01   -1.134117118832949e-01   +8.100160395055331e-03; -1.349133333698702e-01   -1.934720790768674e-02   -1.269864591408887e-01   +8.405543561342235e-02   +1.157298930364295e-01   +3.347415775682802e-01   -2.985517287637525e-02   +5.622876857247442e-01; -7.812137801027172e-03   -4.236806707050531e-01   +1.009460305676931e-01   +2.117359880455132e-01   +2.913180217898284e-01   +3.053689986783888e-01   +2.341560740071060e-01   +1.344798109610587e-01; +6.153257905873528e-01   -1.274493860770736e-01   +2.067291256911713e-01   -1.792108832907068e-01   +8.589393433373091e-02   +4.196914902719063e-01   +1.893320425607548e-01   +2.822747156645146e-01; +1.319753721402100e-01   -7.979293475092611e-02   +2.371652348250665e-01   +5.619250997739627e-01   +2.586117804225456e-01   +4.084582175295751e-01   +1.871007812647906e-01   +2.426674913152362e-01; +1.438667754993188e-01   +4.791478097521926e-02   -2.625823273404730e-01   -3.325543230417666e-02   +1.788030340876354e-01   +4.317017702046326e-01   +3.542596248829628e-01   +1.251865552698905e-03; -3.176681714023929e-01   +4.449917405867580e-01   -3.533589773849937e-02   -1.391595801353445e-01   +6.521214976452377e-02   +1.718532498983435e-01   -3.492975280370807e-01   -1.963903679890850e-01; +3.928029113502710e-01   +3.029649042349336e-01   -1.699388268530533e-01   +4.091338272669362e-01   -2.372023634817289e-01   +1.559305186306573e-01   +1.072386094968594e-01   +2.211335686585962e-02; +1.040132751382163e-01   +8.242575642231470e-02   +1.177054931032223e-01   +4.928070055085925e-01   -2.962028929146351e-01   -2.522976679075044e-01   +3.324166644725956e-02   -2.063110424673291e-01];
L1I_L2I_iGABA_netcon = [+1.681773546202099e-01   -2.269053264286877e-01   +1.958207543563035e-02   +4.235756377220933e-01   -2.368680722462458e-01   -2.679171363353907e-01   +5.198451216214638e-02   -3.494536431643206e-01   +1.217102293588347e-01   -4.941945012209935e-02   -4.956713124036145e-02   +1.545738176304352e-02   +5.805037524571041e-01   +3.713232700115469e-01   +4.818721853746604e-02   -1.741089093987198e-01; +2.670684166695019e-01   +2.301977645322740e-01   -1.491401131484575e-01   -9.382249042380356e-02   -2.561332453059864e-01   -4.764741482585638e-02   -1.928008644820871e-01   +3.065396060633908e-01   +3.146432607004324e-01   -2.342085721171849e-02   +5.440009166281243e-02   +2.928996970806214e-01   +1.444864854127729e-01   +1.305218331979200e-01   +1.425347293200700e-01   +3.419709098873677e-02; +5.518401204530967e-01   +3.773607151650847e-01   +2.790930327641700e-02   -1.400964366242609e-01   +2.544719586995656e-01   +2.431080400502992e-01   -3.856120026275513e-02   -3.180992336884195e-02   +1.454712053769208e-01   +1.482662901444506e-01   -2.438001624445548e-01   +2.597332132512219e-01   +1.740958930672833e-01   -1.524346114051925e-01   +1.680071871561409e-01   +2.798743684083477e-01; -1.326887567176939e-01   +7.216206224790410e-01   +2.530364406287270e-01   +3.954808504280748e-02   +3.812873675010419e-01   +8.559335784194647e-02   -2.866614624879085e-01   +1.846765074135953e-01   +8.638205653837641e-02   +6.050558005282245e-01   +1.995770452842130e-01   -1.961574294858923e-01   +1.851823065316568e-01   +5.781035606279312e-01   +1.527432482664762e-01   +1.762397403924622e-01; +7.627511066185286e-02   +1.147246791289605e-01   +4.823443643472275e-01   -8.464886365213686e-02   +2.515403569541641e-01   +2.483299529354068e-01   -4.725700527312710e-02   -2.141069012583588e-01   -4.171876811235360e-02   -2.136863156399046e-02   +5.538465743163679e-01   -2.258027935348525e-01   -1.305221762512307e-01   +3.778454143323303e-01   +2.164784818256889e-01   +2.078137159441729e-01; -4.317352553250917e-01   -3.219966944297450e-01   +3.010026614657783e-01   -2.795845109933043e-02   +3.294864961360532e-01   +1.573973947640669e-01   +1.962339305714589e-01   -7.980607802974606e-02   +2.201412513532438e-01   -2.849868674416942e-01   +2.767939623544264e-01   +3.828452181788439e-01   +6.865725907458091e-01   +8.947335959738514e-02   +2.032755808636981e-01   -2.359357370497965e-01; -3.243337131395623e-01   +3.983514758971900e-01   -1.579455767808364e-01   +9.052266163426696e-02   +5.208032423802961e-01   +5.649530311531739e-01   -1.178301003853161e-01   -7.305919152327638e-02   +1.372783510055788e-01   -9.037585097958607e-02   -1.847758127905413e-01   +3.312314131088809e-02   +2.199163324073064e-01   -5.515115231130099e-02   +3.920526356526869e-01   -1.852227438601208e-01; -1.268713732778625e-01   +4.373579533742278e-01   +2.145081860476444e-01   +6.636431284820690e-01   +6.252504616433642e-01   -5.245167324623577e-02   +1.356087862064108e-01   +4.131214300111444e-01   +2.124357160805032e-01   +2.687454217967121e-01   +4.506266999074111e-01   +1.848494077562002e-01   -3.566364065343679e-01   -1.031640470862351e-01   +8.400625612338395e-01   +6.178592861529669e-02];
L2E_L1E_iAMPA_netcon = [+4.071055610255438e-01   +6.862806436122683e-02   +5.688873885327671e-01   -1.630554229399626e-01   +2.458065967895451e-01   +3.800847138196490e-01   +2.961581394606022e-02   +9.912071993112126e-02; +2.655110100150546e-02   +2.091283792441205e-01   +2.051682339179182e-01   -2.893021926223727e-01   +3.066836222995966e-01   -1.509076013792471e-02   -1.033234478141262e-01   +2.952482188841352e-02; +3.238602909776827e-01   +7.287134740538668e-01   +4.309431413871989e-01   +3.910735755385624e-01   +3.428497193289279e-01   +4.127932599938618e-01   +4.359123543435153e-01   +2.863219318447941e-01; +7.555576860526708e-01   +2.380569628101873e-01   -1.575932091081439e-02   +3.115472977751138e-01   -1.603132347767818e-01   +5.793560844594856e-01   -1.296949219982116e-01   -3.851258124986452e-01; +4.371482841488513e-01   +4.565323958822338e-01   +1.994489782044764e-01   +2.748551290545441e-01   -7.531827434062631e-02   -1.524891940544314e-01   -5.303787657911357e-02   +5.337594688084228e-01; +7.354687492638144e-03   +1.231306256448384e-01   +1.575065034073336e-01   -1.247168882631995e-01   +6.774073225734945e-02   -3.943435718238583e-02   +3.951217628563168e-01   -3.500989302387600e-01; +3.394657769543811e-01   +3.547420135602177e-01   +6.826332307558671e-01   +3.159093251653563e-01   -2.257801316823607e-01   +2.764002302110242e-02   +2.651111336155370e-01   +3.014399393379278e-01; +3.795775736272287e-01   +7.445642241012913e-01   +1.780041741512234e-01   -1.703836867481751e-01   +1.822449057513737e-01   -1.740233318063912e-01   -1.344371792601460e-01   +7.091234048439758e-02; +4.349698249405759e-01   +1.131656317919981e-01   +1.229241813511272e-01   +2.430187977491562e-01   +1.628533302006336e-01   +1.193162828853347e-01   -6.168387252758532e-02   +3.661389107001213e-01; -6.534627873007973e-02   +2.633013294496851e-01   +2.699483783419939e-01   -1.322597854551611e-01   +4.668052801568900e-01   +2.614715325246189e-01   +6.415623252825484e-01   +2.405224968781894e-02; -1.831917759424518e-02   -3.727494707337523e-02   +2.638975402107692e-02   -1.616651262925202e-01   -2.885831242253306e-01   +2.117269080536351e-01   +4.355603749629136e-01   +2.335167615239267e-01; +2.665178736321611e-01   +7.272188321541806e-04   +4.206909885367482e-01   +1.257480981730261e-02   +2.387314659526239e-01   +7.339680143824542e-02   +1.391479611334303e-01   +2.915164505006163e-01; -7.889922639786065e-02   +2.505187431589191e-01   +2.250056229711430e-01   +4.304481036976281e-01   +8.567516277227055e-02   +3.417662398332962e-01   +1.283634890896780e-01   -1.366168464949837e-01; +2.264898249613166e-01   +3.389433594637644e-01   -3.115509196897093e-01   +2.488216976340859e-01   -3.693781151126656e-01   +3.995149147273206e-01   +6.026073826207989e-02   -6.940672374278112e-02; +9.409560052129284e-03   -1.168864285301842e-01   -1.659646302635609e-02   +6.175303619390443e-02   -1.388617196822722e-02   +2.412626953776070e-01   +7.452529408394648e-01   +2.807335331142122e-01; +1.459155568518376e-01   +8.540406807484197e-02   +6.956097384107868e-02   +4.766683618827881e-01   +2.411183047091952e-01   +3.901266737778677e-01   +4.891450250295640e-02   +5.583192777809269e-02];
L1E_L2E_iAMPA_netcon = [+5.834014187126053e-01   +1.624119167534112e-01   +5.318539873876460e-01   +4.624496642235433e-02   -5.245638450519682e-02   +3.192941552678075e-02   +5.103980868932556e-01   +2.276994491477132e-01   +1.597790472410129e-02   +3.848477976562531e-01   +1.617613824127728e-02   +2.730543642790642e-01   +6.439648271690122e-01   +4.474404691463404e-02   +9.653729412584575e-02   -1.607394703714326e-01; +1.478377358841696e-01   +2.825476083139036e-01   +2.712855869170380e-01   +5.372663476008575e-01   -2.780905260236743e-01   +1.656382975335297e-03   +3.387525848091572e-01   -4.227620540070909e-01   -8.125030600114284e-02   +6.448484212239310e-01   -1.174500084687383e-01   +3.644534356877266e-01   +4.290587612157660e-01   +1.035505035742637e-01   +1.321368435804249e-01   -2.902723642350944e-01; -3.190716163968877e-01   -3.421513785052087e-01   +1.116539595336707e-02   +2.592145522036656e-01   +3.056064686349301e-01   +2.206024221217613e-01   +6.676706055801013e-02   +1.764376960192869e-01   +5.240588471800856e-02   +3.297805772625687e-03   -5.601772730825584e-02   -2.723485730149737e-01   +2.578501145419297e-01   -2.355974619103933e-01   +5.651777717242048e-01   +2.262461743133585e-01; +3.005680642909281e-01   -1.380111837346643e-01   +8.118757953451816e-02   -8.038015037378267e-02   -2.964226321734711e-01   +3.918863490151768e-01   -3.108596610920289e-01   +1.323032562042425e-01   +3.920452627983788e-01   +1.401746217119161e-01   +3.999358717761553e-01   +3.017391753356489e-01   -2.169921186377991e-01   +8.452518165785933e-02   +4.170410820048065e-01   +6.979980148462153e-02; +3.937671108275286e-01   +7.061877265618822e-01   +1.484315957777468e-01   -8.113762941107884e-02   +2.689648980583649e-01   +7.194866439040049e-04   +2.667930430491752e-01   -1.272626496450424e-01   +1.377413994684208e-01   +1.294761438762347e-01   +4.510521369926505e-02   +1.491836075487821e-01   -2.337586000795678e-01   +3.000613762843674e-01   +2.765553699943895e-01   +6.067762929525612e-01; +2.567602595517646e-01   -1.151919856549964e-01   +3.182690009429794e-02   +1.589468620567736e-01   +9.713552872397853e-02   +1.273572011897515e-01   -3.276976943465555e-02   +2.991678199052017e-01   +2.666870603329086e-01   +3.685933482035439e-01   +2.172683664326895e-01   -3.206543323471326e-02   +5.315884972254903e-01   +1.289168925779196e-01   -1.207606027737890e-01   +1.077384999299006e-01; +1.886984793830143e-01   +2.753746933619462e-01   +3.130175216343991e-01   +1.291801279220686e-01   -2.728517651446095e-01   +4.904185106297541e-02   +9.951539197151214e-03   +1.429267372664023e-01   +8.670736808231755e-02   -2.019539248206344e-01   -4.169313874487194e-01   +2.947783981666339e-01   +5.460706463420637e-01   -3.504696659494985e-02   +3.054031793482259e-01   +2.680511839766740e-01; +3.043437310502962e-02   +1.476660662739620e-01   +4.217655156106447e-01   -2.739075434173914e-01   +1.488744958776026e-01   +1.154711207091013e-01   -1.435962953438806e-01   +3.896910542377736e-01   -2.197403695739547e-01   +1.256778371898209e-01   +3.286746410153776e-01   +2.905628012149526e-02   -2.327253517175566e-01   +2.129967458212828e-01   -5.343404743652133e-01   +2.398401145143134e-01];
L2I_L2E_iAMPA_netcon = [+5.805776808329073e-01   +2.774651094001709e-01   +1.794943529536064e-01   +3.713391022070924e-01   +2.344097618521528e-01   +7.131840414981804e-01   -2.353695096327790e-01   +5.999067853994871e-01; -5.466600565872075e-02   +4.884043499648059e-01   +2.217531181356617e-01   +2.096470666244041e-02   +1.980030784357470e-01   +3.934022203175314e-01   -2.548356391561329e-01   +5.539450704718230e-01; +4.822052092599608e-01   +1.166958320336908e-01   -2.936185341141744e-02   -1.742391759602072e-01   -2.060030153950013e-01   +2.854427723693760e-01   +2.137719707307409e-01   -1.114080610616082e-01; -6.221896477459946e-02   -9.072699017853568e-02   +5.641040965342294e-01   +4.164378490356944e-01   -5.206145720051102e-02   +3.410946637062665e-01   +6.029604461440152e-02   -2.745753177744055e-01; +5.009398313508848e-02   +5.534049608904081e-01   +3.720094249232681e-01   -1.968721514558468e-01   +3.013163027886839e-02   +4.496908530327625e-01   +2.997419332563756e-01   +4.072214041600863e-02; -2.649100845388742e-02   +2.005998751977782e-01   +2.082692430363761e-01   +1.308567070289582e-02   -5.895887855867588e-03   +3.639434939090866e-01   +5.873544549550230e-01   +1.452047819765767e-01; -1.073709924133710e-01   -5.424747458330512e-02   +2.089642387363611e-01   +2.538237892331773e-01   +1.696152872976421e-01   +3.985092106413843e-01   -6.617027785752716e-02   -4.024700846542745e-03; +1.850122783872458e-01   +2.119402991937911e-01   +3.007773174118115e-01   +3.563199802982244e-01   +4.535948907781152e-01   +4.074240552067951e-01   -1.571025774449445e-01   +1.246330440454474e-01];
L2E_L2I_iGABA_netcon = [+5.067788494926579e-01   +3.336423030919478e-01   +3.328971975822629e-01   +5.230005151497455e-02   +3.798957720961251e-01   +2.608898896607745e-01   +4.551180789547184e-01   +4.098888796728702e-01; +1.471288627921927e-01   -1.053799450914591e-01   +5.709661944714851e-01   -3.657697773931339e-01   +6.339635211281495e-01   -1.993041260114876e-01   +3.023494884220694e-01   +4.591868475901904e-01; -8.322399769021868e-02   -7.625569302275963e-02   +3.039103657967483e-01   +3.752057660279182e-01   -2.660473620260455e-01   +6.654841026874881e-01   +2.232735556105588e-01   -2.652696285947064e-01; +2.783882750951282e-01   -8.310523834070810e-02   +2.838427804599136e-01   +6.196229757657480e-01   +4.390079516629171e-01   +6.766459790118615e-02   -1.799844870527827e-01   +2.579359776886082e-01; +3.600847736986098e-01   -4.554199743812594e-01   +5.660801486786967e-01   +5.234100720897943e-01   +2.065364929241870e-01   +4.870730911863941e-01   +1.648444928025648e-01   +2.717447613408121e-01; +3.323006914897709e-01   -3.964250040018935e-01   -4.051168827819548e-02   +5.026569197368925e-01   +1.009753066788665e-01   +1.038995981840283e-01   -4.249481953506478e-02   +3.977945952667732e-01; +7.920677967961005e-02   +1.736013770153690e-01   +2.943430725189512e-01   +2.552437684492195e-02   +1.016155902442425e-01   +4.450229429804997e-01   +8.637022554509205e-02   -6.911581356362212e-02; +5.354866295805152e-01   +7.533886773892218e-02   +1.814015246763637e-01   +5.099123217715752e-01   +2.291370828562970e-01   -1.581663226438013e-02   -1.897944870349513e-01   +5.258222864445308e-01];
L3E_L2E_iAMPA_netcon = [+9.723370643685253e-03   +1.332805674571256e-01   +1.864255516156416e-01   -9.317735628404204e-02   +5.439437377824212e-01   +4.269839256536853e-01   +1.483541349479728e-01   +8.735316650421476e-01   +2.433405852157661e-01   +1.986270214793822e-01   +5.723249036586575e-01   +5.007506807834046e-01; +2.533034560170647e-01   +3.938256710207174e-01   +4.344765245891996e-01   +4.788971303663950e-01   +8.150725372959214e-02   +5.136495925288345e-02   -1.085297297337414e-01   +2.585159677728152e-01   -2.627114492139262e-01   +4.814803932387504e-01   +1.673780542598829e-01   -6.335835981419666e-02; -4.640688850697888e-02   +2.500865353514595e-01   +3.264389011139924e-01   -5.719271637158019e-01   -3.805080917265662e-01   -1.755070397551000e-01   +5.623723070024005e-01   +1.790794994912137e-01   +9.393575687614680e-02   -1.157391160885917e-01   +3.430106239154108e-01   +1.387962184320146e-01; +4.450027125835568e-01   -2.423497091024358e-01   +3.422078059688072e-01   -5.429845061314484e-02   -3.219574502545413e-01   +2.373352404860351e-01   -3.003664417775532e-01   +8.831289672466575e-03   +2.849527910817272e-01   +3.048215989293697e-01   +1.557022518987680e-01   -1.923661599676094e-02; +3.281970316478591e-01   +6.149792045347310e-01   +3.807741275772430e-01   +3.292633141016183e-02   +1.211638897838341e-02   +2.160633405956786e-01   +2.389655967395293e-01   +2.705379225312205e-01   -1.839002864763365e-01   +2.951871270041540e-01   -1.343618566456174e-02   +5.704470106918508e-01; +4.513031477896027e-01   +1.621883022614800e-01   +6.907245588746471e-01   +1.968210909758574e-01   +3.099996722830078e-01   +4.085614850521077e-01   +2.527625722039712e-01   -1.058799170453011e-02   -4.468690378373992e-02   -1.904040804945303e-02   +1.520891213253527e-01   +8.761299204477521e-02; +7.408833742426204e-01   +3.546360540342153e-02   -2.845074905260623e-01   +3.645153843619534e-01   +2.915967677617040e-01   +3.460613748258665e-02   +3.094217540219314e-01   +4.604695332706602e-01   +2.309024686026294e-01   +2.992031164956991e-01   +2.488395108392635e-01   +7.877872396331795e-02; -3.475656750004231e-01   +4.517747047743549e-01   +3.325210822038134e-02   +7.193129141232182e-02   -4.129682160623870e-02   +8.764121420905854e-02   -1.650842235874497e-02   +2.358346330761873e-02   -2.187693162504304e-01   +4.673785865659861e-01   +2.113906364332651e-01   +6.811644859382081e-01];
L3I_L2I_iGABA_netcon = [+3.258825104402748e-01   +7.747399322667077e-01   -1.338182201150886e-01   -5.315135135233100e-02   -1.294930415254086e-01   +2.992200785298136e-01   -2.383831691271802e-01   +1.791366207576116e-01   +4.929069312370410e-01   +2.006508207416067e-02   +4.857205088581742e-03   +3.505910180540009e-01; -1.854698617764622e-01   +2.608823450281069e-01   -1.477918990707101e-01   +4.622494662775412e-02   -1.962842546421563e-01   +7.490651037534959e-02   -1.536633489139616e-01   +2.281124080572375e-01   +1.415675132014330e-01   +2.738097165810942e-01   +2.556166217819982e-02   +6.889472963287907e-01; +4.894017788846553e-01   -1.684495028203607e-01   +4.961690180718130e-01   -7.705321198412335e-02   +1.280080181771809e-01   +1.797948152131954e-01   +1.515059938978874e-01   +4.858057861093282e-01   +3.716821575394975e-01   +2.111556221626952e-01   +8.971394546623385e-02   +6.574679885085391e-02; +3.541198538467474e-01   +3.271752745983402e-01   +4.598163278883348e-01   -1.287061608968378e-02   +2.080103960593626e-01   +7.266967235736992e-01   +2.825055719500011e-01   +1.243200660484547e-01   +5.505355554310226e-03   +6.509166348739980e-01   +5.290742220591755e-01   +2.190296855553572e-02; +3.471371904008798e-01   +4.990756621465247e-01   +5.369304560270641e-01   +7.857503670478663e-02   +9.388392125916284e-02   +1.191382884242674e-01   +7.310037480014248e-02   -3.476990810436084e-01   +1.253807683988761e-01   +3.417183599512291e-01   -2.773356668315317e-01   -6.048170580984447e-03; +4.337490719510535e-02   +5.021096119924776e-01   +2.165643582675134e-01   -4.858563252607359e-02   +4.943795854854484e-01   +3.072120136647984e-01   -8.275691860928321e-02   -2.556611925557598e-01   +1.815616006556140e-01   +7.020864868994758e-02   +7.002210215611608e-02   +3.799884299505305e-01; +2.845974289278898e-01   +2.457057322083378e-01   +4.298121602269950e-01   -3.294617194815875e-01   +2.998344741729226e-01   +3.378639383426231e-01   +2.968948412083856e-01   +3.656472360401130e-01   +2.273515577884006e-01   +2.844958809396297e-01   -4.351704441287559e-02   +1.655543191358175e-01; +2.603253576393969e-01   +8.244733282295798e-02   +8.159936683722224e-03   +2.050798298235667e-01   -7.087585292349735e-03   +3.365347432860366e-01   -4.606781695801611e-02   -1.981329141951850e-01   +1.588289988486960e-02   -1.319116234481610e-01   +2.512827531620989e-01   +1.119460547288035e-01];
L2E_L3E_iAMPA_netcon = [+1.932130900071563e-01   +2.084355935839592e-01   +6.383583654234234e-01   +8.763034437847658e-02   +4.540565052347891e-01   +3.018649320831195e-01   -2.875047308686927e-01   +5.456647735513666e-02; +2.532220468851983e-01   +3.117242886931449e-01   +4.644343637868458e-01   -5.438945239598020e-02   +1.999833588959832e-03   -6.737882628483144e-02   +7.147144122084545e-02   +8.970167205929019e-02; -5.796653895331352e-02   -3.176975821108446e-02   +2.563222798508286e-01   +2.735692303406958e-01   +9.693938738246483e-02   -2.383030582609550e-01   -9.474282821442816e-02   +9.658363026012054e-02; +3.206245965205867e-01   +4.245729639796014e-01   -1.051130415700628e-01   +3.264771805741475e-01   +2.582005969863295e-01   +5.544718715941380e-01   +9.696214939432383e-02   +1.848463393653529e-01; +3.182565789683545e-01   +2.299135612080264e-01   +3.971140863092238e-01   -4.464514682290903e-01   -3.115738072213851e-01   +3.235589048094549e-01   -2.378141254724657e-01   -3.862379257553160e-01; +3.686323756798836e-01   +2.159795634015989e-01   +1.587154034989022e-01   +2.641807427373102e-01   +2.730164789379243e-01   -7.195966573797102e-02   +8.744138156707576e-03   +1.921559483664451e-01; +1.637877746808307e-01   +1.517777406183634e-01   -2.930043396162429e-01   +3.214525878873587e-02   +3.218867417122717e-01   +1.724425046542600e-02   -2.804193375115005e-02   +5.499031369324184e-02; +2.221798067936765e-01   +4.385006904168778e-03   -2.334081144389198e-01   +3.084024278144380e-01   -2.058798034672889e-01   +7.994443255201338e-02   +7.773577340773843e-03   +5.751589369475846e-01; +5.999552509930393e-02   -1.464757230037002e-01   +1.165857671570061e-01   +3.331647142348241e-01   -1.900201171846229e-01   -1.502062719233954e-01   +2.677554309305703e-01   +1.577670498196182e-01; +5.226383719360154e-01   +2.892835914429436e-01   +3.710594355505391e-01   +1.695222636113473e-01   +2.386545565583462e-01   -4.685904647399995e-02   -2.472887971023266e-02   +4.754210666258083e-01; -3.652174796689594e-01   +4.363973408034187e-01   +8.826369404978190e-03   +4.847919530734335e-01   +3.656504529444474e-01   -1.502207804054959e-01   -3.148776030917443e-03   +3.985730235825384e-01; +3.160548205022669e-01   -1.485457067202134e-01   -1.397769281621851e-01   +6.191104246123833e-01   +2.145048046940672e-01   +2.987858525690173e-01   +2.090493551353673e-01   -1.837215206260446e-01];
L2I_L3I_iGABA_netcon = [-8.129118755235606e-02   -8.982185045861106e-02   +2.533334930209847e-01   +1.786847072957826e-01   +5.803176455773911e-01   +4.385553121968930e-01   +1.556219766788636e-01   -2.485036677823929e-01; +7.713783910169937e-02   +3.341925737180503e-01   -3.662395279821415e-01   -3.489484130036076e-01   -1.335540041602900e-01   +1.358001231462670e-01   +2.995142048428155e-01   -2.565604035266600e-02; +4.279549090556662e-01   -1.621101628032454e-01   -2.804546796583964e-01   +3.219104838037694e-01   +3.716594437345057e-01   -3.200176724077198e-01   +5.112311788748378e-02   +3.643885479954106e-01; +2.237814936054648e-01   +3.642016086684488e-01   +1.797520923988966e-01   +1.711659947015272e-01   +2.394345625643501e-01   +2.609172893737600e-01   +3.281935287819820e-01   +4.670259737435135e-02; +1.262813300870269e-01   +3.303889263662441e-01   -2.499996711148244e-01   +1.539729254106600e-01   -8.626924381910062e-02   -3.503251761653867e-01   +4.989699275867711e-03   -1.820047907028878e-01; -1.500685371773287e-01   +2.095797943435759e-01   -1.514051142274278e-01   +4.196720760296122e-01   +1.882721445224942e-01   +1.821734950630167e-01   +2.255377826390530e-01   +1.375695267205819e-02; -1.776276901390050e-01   +3.698999365973485e-01   +6.650745361258564e-03   +3.690649074656572e-01   -3.033458859835556e-01   +2.132263777739961e-01   +2.285444522352036e-01   -9.090286778540754e-02; -3.411259910448119e-02   +4.490764749464306e-02   -3.284930072877981e-02   -8.828671500671925e-02   +2.178222184840964e-01   +5.405291250420196e-01   +1.804409012652390e-01   +3.974874999564551e-01; -2.572653066198331e-01   +4.022461182898300e-02   -2.152189403814335e-02   -3.270082548955134e-01   +4.342564860223279e-01   +3.210314684084648e-01   +1.709701691095669e-01   -4.171746036897886e-02; -5.878330017273306e-02   +3.046935179050939e-01   -1.381521040065760e-01   +1.832977779836716e-01   +1.298858723791741e-01   +3.400991568368119e-01   +9.175080936869273e-02   +5.454372295878126e-01; -1.284416272973310e-01   +4.634856590073075e-01   +2.219380468721391e-02   +2.483423200931026e-01   -4.558599886662881e-01   -4.335998128129715e-01   +2.119544976613984e-01   -8.972151190974501e-02; +3.395092798284726e-01   -3.743162867481819e-02   +4.401863347271107e-02   +3.458485891422011e-01   -1.013697029427977e-01   +4.412870811494796e-01   +5.722879200774287e-03   -1.633561642027993e-01];
L3I_L3E_iAMPA_netcon = [+6.117480002682886e-02   -1.943192120315007e-01   +1.316269011528465e-01   +2.864459157191289e-01   -6.412033774130187e-02   +5.555696554866030e-01   +3.852582435397335e-01   -9.667070140710027e-02   -2.994244294883444e-02   +1.635016860139054e-01   +1.086227080294822e-01   -8.944745502366401e-02; -9.241803420723869e-02   -2.660722657085436e-01   +3.065733535196622e-01   +2.889600185515650e-01   +4.079390366402543e-01   -2.110814824989038e-01   +1.526140601940948e-01   +2.918036723658676e-01   +5.098218652646345e-01   +3.594825816071352e-01   -2.770187720640679e-01   +5.015378835784108e-01; +4.392044222634483e-01   +1.618675340811339e-01   -2.742882401036612e-01   -2.061208597411098e-01   -1.649722371271942e-01   +1.394542922310384e-01   +2.681475089728754e-01   +4.727855028808167e-01   +2.629978270583895e-01   -5.847473327259017e-03   +4.415800885294756e-01   +2.970730211852480e-01; -2.764011189519748e-01   +5.557535890116349e-01   +7.452875248755358e-02   -5.529035222790951e-02   -2.069223902162935e-01   -1.356317059959433e-01   -8.196643849351665e-02   +7.132254948014660e-02   +2.897930604305825e-01   -3.084533112802770e-02   +5.763282486078058e-01   +1.073777886752106e-01; +3.089167343089401e-01   +3.520094999969174e-01   +5.913303793566009e-01   -3.471028658180291e-01   +8.507560139676416e-01   -1.971272230384761e-01   +7.081201148895538e-01   -1.512071002136218e-01   +4.189529822003730e-01   -2.229417683803673e-01   +3.007969451324669e-01   -2.423508727425592e-01; +3.726615433119922e-01   +2.473112598407364e-01   +4.394190085760188e-01   -2.330518312392339e-01   +1.187493671934700e-01   -2.826775456615399e-01   +3.278931116466352e-01   +9.288903748356572e-02   +5.627557323269912e-01   +2.996758314052332e-01   -4.973729359796786e-03   +5.794757743639551e-01; -1.440165223226061e-01   +1.247705435691527e-01   +4.794779910302434e-01   +2.689454746338501e-02   +8.291547177076967e-02   +1.609532574905149e-01   +4.831777877240878e-01   -1.621700824443754e-01   +5.554005436732737e-01   +2.144536337641267e-01   +4.001023719788066e-02   +2.346957320748904e-01; -1.853320935148508e-01   +2.909022417534528e-01   +1.369842934685966e-01   +2.356388885237863e-01   +9.487299816273179e-03   -7.605361415363580e-02   +6.095369720885815e-01   +4.778673530171632e-01   +3.793475293624508e-01   +3.918791700471130e-01   -1.440735266153652e-01   +6.212160730989126e-01; -1.119667602128642e-01   +1.135256986635690e-01   -1.980212784810043e-02   +3.748242698065463e-01   -1.546265724553804e-02   +2.072475472636965e-01   +4.965985389413560e-01   +3.474474263776013e-01   +1.915241057046290e-01   +3.914984860482222e-01   +1.999926944802525e-01   +5.124637922140175e-01; +4.482490748015713e-01   +2.457548500486216e-01   +3.776006160245071e-02   -4.880779491436613e-02   +3.223995310000558e-01   +7.184003747969583e-01   +1.417412286860877e-01   +2.383093206309786e-01   +2.781428263490103e-01   -5.901041603603838e-02   +2.033006319972581e-01   +1.094860835341905e-01; +7.189277548979855e-04   +4.621887143506861e-02   +3.472306272206748e-01   +2.581839082152403e-01   +2.058211774436206e-02   +2.791555745133941e-01   +8.141984147527416e-02   +3.811837820708915e-01   -1.072597935289493e-01   +1.561669709034227e-01   -4.152038785692205e-02   -1.281569637177565e-01; +1.596585347945779e-01   +1.362635374101503e-01   +5.462611638388908e-01   +6.251922311484900e-02   +2.749276220423871e-01   -9.065165425289806e-02   +1.898180396465254e-01   +5.156017162865523e-02   +9.010005264943727e-02   -2.749328714072517e-01   -1.380580654270993e-01   -1.691047780390833e-01];
L3E_L3I_iGABA_netcon = [+1.586793261069556e-02   +2.834455387710491e-01   +5.240559831434528e-01   +5.271476951606724e-01   -1.354249815454935e-01   +4.979849439704693e-01   +2.372573500313759e-01   +4.006922961645489e-01   +3.849935657690550e-01   +2.930340419524177e-01   +1.345999149008407e-01   +6.570517934780542e-01; +1.537415634083923e-01   +3.975192956597489e-02   -1.055528378997872e-01   +1.660081863545376e-01   +2.067378419047616e-01   -5.164913256966404e-02   +1.247538119342223e-02   +1.346396805765838e-01   +5.210800621081653e-01   +5.074854887027387e-01   +2.622023280971654e-01   +5.174884279758771e-01; +1.771260364040393e-01   +3.891152790833363e-01   +1.087424315750299e-01   +4.068535282620900e-01   -1.764042441438988e-01   +7.873442934738486e-01   -8.436572807177593e-02   -1.263947803519798e-01   +2.612516138761750e-01   +4.284592453795870e-02   +2.604028159376660e-01   +1.904009214932858e-01; -6.732882070499865e-02   +1.797198575456366e-02   +6.022682571682707e-01   -1.004571313029935e-01   -1.402077150822849e-01   +3.430713408325887e-01   +1.920665069785015e-01   +4.964913772241467e-01   +3.990824988316518e-01   -3.332014185908086e-01   +1.565606855352966e-01   +1.995426809394135e-01; +1.962574147473215e-01   -3.030128593500089e-01   +2.021233991430648e-01   -3.305353227791564e-01   -2.008592981093358e-01   -2.308690042001985e-01   +9.444052458686930e-03   +5.219171903567020e-01   -7.384741175496026e-02   +3.095090186064243e-01   -1.803144818151543e-01   +4.332084340046206e-01; -3.432961543598455e-02   +4.317949090752259e-01   +5.870833865827859e-01   -2.915648209656663e-02   -1.395412776764383e-01   +1.667778518382160e-01   -2.981632578188020e-01   -7.007349115502803e-02   -1.924752163531344e-02   -1.588100317191411e-01   +2.661216227238467e-01   +3.033326809604799e-02; +5.749845167615255e-02   +1.923758424567918e-01   +1.956246788749162e-01   +4.854514657018189e-02   +5.818165340318330e-01   +1.424004165655439e-01   +2.548244711629943e-01   +2.923020324534353e-01   +5.046515548143551e-01   +6.162194128969910e-02   +4.686546571632882e-01   -8.400354541744774e-02; -8.671340379110541e-02   +1.202139713384491e-01   +5.881230650177929e-01   +4.930017007046344e-01   +3.170526096270793e-01   -2.312763738326840e-01   +2.961477791683176e-01   -8.968399135316097e-03   +3.508875578926349e-01   +3.295817740037055e-02   +1.857401222688342e-01   +6.559653596337758e-01; -3.692466166789048e-01   +2.048105184629995e-01   -3.236235941297346e-01   +1.259076450116376e-01   +7.842614155585888e-02   +3.304304137733015e-02   +1.151400670231988e-01   -2.617700652264190e-02   +3.433063592981467e-01   -6.403460853238802e-02   +3.348806594544664e-01   +6.958906825442711e-01; +4.308492756977836e-01   -7.022519961460143e-02   +5.720052310619570e-01   +3.479692291578524e-01   -2.178183758815899e-03   +1.498293854020611e-01   +5.469019401486525e-02   -3.221931864403003e-01   -2.117539800834813e-01   +5.771623454885371e-01   -1.640409203610411e-01   +3.359220952453023e-01; +5.373850842738623e-01   -9.079288340759600e-02   +3.799314006689424e-01   +1.558074161726447e-01   -5.071300882865562e-02   +4.998358369848245e-01   +4.149043393692651e-01   -1.133027699242113e-01   +8.498687023177295e-02   +3.040566544823501e-01   -3.418648314905390e-01   -5.725481343327719e-02; -1.595151213338065e-01   +1.408269649720325e-01   -2.419361309367438e-01   +2.486326604808256e-01   +2.101999236076172e-01   +2.840303401844887e-01   -1.209033869320689e-01   +2.380884222224570e-01   +5.402951226808091e-01   +5.749258342905127e-01   +2.371823178883440e-01   +3.790070688072514e-01];
L2E_Input1_iAMPA_netcon = [-3.416370706004408e-01   -4.506382974979144e-02   +1.767260573292948e-01   -5.289853429439199e-02   +1.192087274157679e-01   +2.604033005641064e-01   +5.294943772520251e-01   +3.386999415538242e-01];
L2I_Input2_iAMPA_netcon = [+1.250766999513622e-01   +9.617086004574280e-02   +1.812771352420618e-01   -1.366228523607785e-01   +9.311477180728980e-02   -5.521016314979635e-02   +1.880296227832096e-01   +7.635819559361099e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
