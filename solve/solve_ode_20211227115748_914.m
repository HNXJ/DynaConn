function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.553648898577618e-01   +4.993562876506322e-02   +1.398180675398747e-01   -2.808910669512847e-02   +2.785998648532955e-01   -3.674558185595880e-01   +1.205498639698270e-01   -1.961631870090412e-01   -3.207972241902902e-01   +3.089717644051218e-01   +2.509859399367745e-01   +3.175258774983281e-02   +3.395805828355087e-01   -3.108548961301366e-01   +2.452790536102366e-01   +1.867206244493571e-01; -3.974804183182848e-01   +3.212158991626349e-01   +6.280439039497678e-02   +3.010157184141009e-02   -4.096043623864724e-01   -2.033685967985462e-01   -1.170315800955263e-01   +3.173664058337656e-01   +1.327281389442735e-01   +1.524185014037311e-01   +1.234802828475739e-01   +4.902639539856235e-02   -6.980868978035085e-02   +2.460879266733318e-02   +3.201950784068927e-02   -4.827225296838895e-02; -1.061906569880691e-01   +1.428848493330835e-01   -8.418432424370786e-02   +2.929951301921816e-01   +2.035882696474896e-01   +2.603360567782835e-01   -2.575505588415012e-01   -4.727630695059006e-01   +4.380504503978403e-01   -4.194566804864095e-01   +1.463511517873159e-02   -3.196597254954601e-01   -6.405610406067747e-02   -1.483492482993371e-01   -1.960965022642275e-01   -1.460064719718725e-01; +2.053600332153871e-01   +1.733350564651969e-01   -3.089621400932115e-01   +2.079165848462230e-01   +2.141013426486973e-01   -2.148433842002412e-01   -6.647345318357079e-02   -7.063050537641597e-03   +6.826961951243110e-02   +2.919731489782067e-01   +4.880300434012177e-01   -2.615472841622644e-01   -7.119759176524575e-02   -2.413145262432085e-01   -2.082684605880783e-02   -2.414711596475071e-01; -7.838305653292474e-02   -5.777518879894581e-01   -5.240116652114640e-02   -5.620799627223001e-02   -1.844682524911513e-01   -3.054520697529563e-01   +3.871590201892365e-01   +1.078034627396917e-01   -3.696139767830775e-02   -1.626249517742435e-01   +2.388143464737745e-02   +8.502182341824659e-02   -3.522361335822010e-01   +3.808585598450502e-01   -1.212006928599500e-01   +1.938238009890791e-02; +2.819650804926907e-01   +2.960788383777431e-01   -4.066684053892493e-02   +1.110636033551952e-01   +3.249794016490047e-01   +1.602428688999548e-01   -8.723984027437606e-02   +1.405292989527456e-01   +1.621732934289268e-01   -1.866131410828777e-01   +3.622320828248197e-01   -1.234994768552660e-01   +6.060206648678570e-02   +1.880829617040647e-01   -2.348151001874514e-01   +7.556013677340807e-02; -1.277870101480293e-01   +1.231537485760637e-01   -1.934440228686975e-01   +9.532117274791178e-02   +1.524361546736441e-01   -4.701251792250121e-01   -1.581817156536509e-01   +1.172052352399663e-01   +2.092891991365384e-02   -3.145895173895938e-01   -1.123685701164547e-02   +2.714873889692845e-01   +2.860281258245790e-01   -3.034105337911550e-01   +4.151881895353982e-01   +1.374957934306304e-01; -1.289461038177525e-01   +2.908837927516275e-02   -1.700775622387717e-02   -1.413609672627781e-01   +2.069825044203137e-01   -5.028140990403744e-02   +3.813948461179716e-01   -6.507238130621519e-02   -1.102006007793951e-01   -2.685915184276135e-01   +4.424941374099513e-01   +2.285827944666656e-01   -1.507805776489337e-01   -1.887162875587431e-01   +8.585447323669468e-02   -7.321800125435959e-02; -2.353193458475376e-01   +2.912997564920745e-01   +4.413710384480117e-01   -2.123962989756017e-01   -2.580075103895862e-01   -3.335821027037569e-01   -1.927328087757178e-01   -9.324784473182920e-02   +2.096112973933363e-01   +5.451055102615992e-02   -2.458730011710840e-02   -5.052615647398903e-02   -7.897083482198293e-02   +2.410124980006034e-01   +6.935162210372078e-02   -1.214205872510604e-02; -1.534473371592899e-02   -6.515104551715802e-02   +4.147889058506533e-01   +3.605173588223788e-01   +2.095410123408498e-01   -9.177511901421956e-02   -8.234664543822022e-02   -4.887228869620843e-01   +1.904678717000213e-02   +1.902783565850782e-01   +5.086153183213084e-02   -2.926944607559080e-01   +1.461149778692612e-01   -1.580922675863223e-01   -1.506447729899919e-01   +5.536857348208407e-02; -2.785855591573824e-01   +1.200255179322165e-01   -2.639184486725548e-01   +2.422371848459501e-01   +1.307258035987674e-01   +2.858478467879094e-01   -5.029485145211340e-02   +5.711894037996183e-02   -8.007343265149368e-03   -3.509025984145666e-01   +2.132380295650175e-01   +1.012496251705332e-01   -2.883080641189578e-01   -3.025363248005015e-01   +1.556535275981000e-02   +9.904697973806789e-03; -1.946229243607112e-01   -5.592054043297971e-02   +5.414838686140627e-02   +5.839736174044565e-01   -2.549556899361394e-01   +4.524207005042510e-01   -1.315567268210718e-02   -9.179272922364690e-02   +1.185534913799700e-01   +4.424438973249617e-01   +4.168937613805013e-02   -5.225570880068556e-02   -4.583382612001460e-02   +2.663256815766554e-01   -2.685641149379037e-02   +2.771733889874507e-01; +2.337615097388835e-01   -6.711234455860969e-02   -8.342366603664678e-02   -1.177760686782244e-01   -3.602335413821409e-01   +1.710372864273314e-02   +4.530023389356987e-02   -3.354077067281667e-02   -2.846678704355669e-03   +2.473521945156150e-01   +2.539006570430564e-01   -4.023235307123796e-02   -5.126706270424332e-01   -8.142367760014028e-03   +1.007055149487044e-01   +7.272300544470173e-03; -1.152589796144764e-01   +1.255216933639217e-01   -2.661136894636448e-01   +2.125556744708641e-01   +2.152243938384485e-01   +1.815751377043631e-01   -4.400441695377747e-01   +3.844951427024871e-01   +1.567929765773890e-01   -2.348799727060679e-01   -1.584620861540773e-02   +2.716541898035151e-01   +2.389054134935658e-01   +1.060475706260585e-01   -2.027453945287800e-01   -1.977390493963703e-01; -1.585560673097144e-01   -2.503881466968361e-01   -3.244249107209164e-01   +1.106895193042289e-01   +1.201151730536956e-01   +2.599123353009667e-01   +2.369101163959075e-01   +3.343626211377480e-01   -2.287916770072327e-01   +1.265425241404682e-01   -5.747355964514311e-02   -2.729589780490238e-01   +1.038087316650696e-01   -3.304107025811297e-01   -1.000764236078511e-02   -3.394467285055899e-01; -4.989235820371023e-02   +1.490229580684872e-01   -9.221588386939206e-03   +8.345041035583114e-02   +1.863945640606757e-01   +3.412971551236749e-02   +2.011249205871576e-01   +1.466119971909379e-01   +3.896793652664744e-02   -3.303807535338018e-01   -1.036426632888112e-01   +2.408929240920364e-01   +4.118945723847689e-03   -4.673702161295712e-01   +1.122444641759352e-01   +9.916159706316990e-02];
L1E_L1I_iGABA_netcon = [+2.047754542105781e-01   -2.185838992003487e-01   +2.143855831026080e-01   -1.284470750064108e-01   +1.076621947595477e-01   +4.234609398573684e-01   -4.611438496669010e-01   +5.683860836971787e-02   -1.776670114135169e-01   +1.773019452121589e-01   -3.238891643465329e-01   -6.777472969594596e-02   +3.609664155430531e-01   -2.978601318656207e-01   -2.225948578328041e-01   -1.724181398501692e-01; -3.668688758893812e-01   +2.534038994670417e-01   +2.503787468282120e-01   -7.949350897667321e-02   +5.517163170491934e-02   +1.051017319466230e-01   -2.178605172602060e-01   +7.313711664054895e-03   -3.427497387611166e-01   -5.574561596184364e-01   +2.401935489888152e-01   +1.401121507345851e-01   -8.938002806252787e-02   +1.646772027234858e-01   +2.436200244408926e-02   +2.046493507858811e-01; +1.163244907953586e-01   +3.941596034747797e-01   -9.346906696408144e-02   -3.125889194612543e-01   +1.599147271743142e-01   +1.015928640452447e-01   +1.744450955222260e-01   +3.560806812771864e-01   +6.504685402896544e-02   +1.102937476775843e-01   +1.993054976533323e-01   +1.552333117587140e-01   +9.717787527124080e-02   -3.431955018251473e-02   +5.633054002456664e-02   +1.685921960968569e-01; +1.281371500042154e-01   -1.910891996368099e-01   -2.779708523367856e-01   -7.706021206716934e-02   -2.283892992412171e-01   -5.513389547987940e-04   +9.430167259494754e-02   +2.619910515267296e-01   +1.200386926881704e-01   -8.139542959028834e-02   -1.590149207291095e-01   +1.755243243660053e-01   -3.823338853614863e-02   -9.380520052783814e-02   -1.973074670690148e-01   -7.634840486183864e-02; -4.455703808286548e-01   -4.482171256804225e-01   +1.275528711131180e-01   -2.754164391070371e-01   -3.374358570103818e-01   -1.166836920224879e-02   +2.144367122098350e-01   -2.173646093676605e-01   +2.815629985838339e-01   +1.910951989983318e-01   +7.126031624893375e-02   +5.848132262978592e-02   -6.228921765729994e-02   +4.959337756587857e-02   +3.437400175011615e-01   +2.067601582632689e-01; -1.210458630352511e-01   -5.231750002221611e-01   -2.073588405953107e-01   -2.611021536848052e-01   +1.645470765711027e-01   +2.737050281660897e-01   -1.893937837135293e-01   +1.697250688449726e-01   -4.153686004713468e-02   -3.420455705626257e-01   +1.810868082728466e-01   -2.172123692836092e-01   -3.533641695876437e-01   -2.424970207207097e-01   -3.759059028611837e-01   +6.432692355014202e-03; -1.095108505295566e-01   -1.512941896615064e-01   -9.799087153789986e-02   +3.089838346589552e-01   -2.479869170584468e-01   -8.636369864919655e-02   -1.787216196059895e-01   -2.383845510598120e-01   +1.278816105654414e-01   -7.306744222160767e-02   +2.452315780256672e-01   +1.445094372243990e-01   +3.935331035161027e-02   +8.208837391834305e-02   +2.793662647438273e-01   -6.358310155076541e-04; +2.444427953241184e-01   -9.820489338108176e-02   +3.651368829543777e-01   -1.820486527805523e-01   -1.197773840608571e-01   +3.580027193397795e-01   -2.039999532253903e-02   +1.154411821074864e-01   -2.113004984310567e-01   +1.666338700775851e-01   +1.439753111322181e-01   -1.733282283708021e-02   +1.035687484576175e-01   +5.650420381959805e-02   +1.040946723931676e-01   -3.042219084437576e-01; -3.344344018985679e-01   +2.946006076732831e-01   -3.951358926357383e-01   -2.309262248828636e-01   -2.215672993880662e-01   +2.067524808598590e-01   +7.494072797154694e-02   -1.021206064047438e-01   -3.994049741794115e-01   +4.613339623509783e-01   -3.056140145801970e-01   -1.776274678195241e-01   -9.191393671586945e-02   +5.824827007142519e-01   -2.854258458855843e-01   +1.715142010547178e-01; +1.397787267496490e-01   -2.489428163523293e-01   -3.235867484341270e-02   -9.445023122845508e-03   -6.294434351958170e-02   +3.300124011072467e-01   -3.140118567734683e-01   +1.313474300476352e-01   -3.200176404696157e-01   +2.107099307998265e-01   -2.216629609607974e-01   +1.074358004783089e-01   -3.635010549212392e-01   +1.515775319259807e-01   -1.835956595619805e-01   -3.656559073554784e-01; +2.282421439029828e-01   -4.090767476592490e-01   +2.677460692447267e-01   +5.203038240199258e-02   -2.267630032078670e-01   -1.962128477285229e-01   -3.917566096623631e-02   +1.453188139088001e-01   +1.127025729229300e-01   +3.465148243250372e-02   +3.926192472843325e-01   -2.281855017577937e-01   -5.842101180496553e-02   +7.566130931263323e-02   +3.606300715628970e-01   +2.638205562718258e-01; +1.301640174814011e-01   +1.453224780111359e-01   -3.644445426436946e-01   +3.933368894057506e-01   +1.888577096146304e-01   +1.470380517186798e-02   -1.769127621742935e-01   -1.225509997643218e-01   -4.149715417185976e-02   -2.509246494402281e-02   +2.852502394674601e-01   +2.629043493721438e-02   +6.843190094272933e-02   -2.747457567266418e-01   +1.212513385645730e-01   +2.060667627999851e-02; +2.594029486610112e-01   -2.561751925146517e-02   +1.672819547225424e-01   +4.210807609521749e-01   +3.799887735251046e-01   -4.270434611622737e-02   -1.780455752760533e-01   -3.588486110295538e-02   +8.419141370864022e-02   -7.407202768402828e-02   -4.503664551899678e-02   +3.132059368039732e-01   -3.822213287406807e-02   -7.004672289053666e-02   -3.509127397086942e-01   -8.719179538699412e-02; -6.879641775156539e-02   +2.236678530075243e-01   -1.121145666616209e-01   -4.016263865816533e-02   -7.688252724561875e-02   +1.004683119379938e-01   -2.727633734510996e-01   -3.294488950135003e-01   -6.537300135540575e-02   +1.985500494475042e-01   +1.640493557303354e-01   +1.780435687298760e-01   -1.105109076939142e-01   +7.067100506805757e-03   +3.244552489661306e-02   -1.818158925892534e-01; -2.242608431789118e-01   +1.822413410206078e-01   +1.362027219566151e-01   -1.300393710400151e-01   -4.904337836804630e-01   +3.824337689295211e-02   +3.499694013062006e-01   -4.257463920569513e-01   +1.275529038262787e-01   +1.908702301250363e-01   -2.288440088795833e-02   -2.304758608977732e-01   +9.997203647475549e-02   -1.680615060469298e-01   +1.395311881932637e-01   -2.482845042919253e-01; +2.792580265579487e-02   -2.923550968782269e-01   -1.584272050427158e-01   -7.383474710078552e-02   -4.849656563794618e-02   +2.335008885336551e-01   -4.826800261717287e-02   +9.511412048833892e-02   -4.556965364665398e-02   +2.629164248887541e-01   -1.959914433980345e-03   +5.421486759426797e-01   +1.692628405712159e-01   -1.318144458385101e-01   +3.651765974762463e-01   -4.747576013188952e-01];
L2I_L1I_iGABA_netcon = [+3.339360094538397e-01   -2.259051406805429e-01   -2.535160639942330e-01   +1.886408606060547e-01   +1.183435268557450e-01   +2.896614556785962e-01   +3.101106594503091e-01   -6.498863211970371e-02; -1.938576422323553e-01   -1.827418051105207e-01   +1.558518458436960e-02   +1.850305498093731e-01   -2.598135060771682e-01   +1.032961665130350e-01   +2.896663390960206e-01   +1.559947912227717e-01; +2.563212212782582e-01   -1.368179714257759e-01   -1.577956462184625e-01   +4.945329919736727e-02   -9.120912430235717e-03   +2.289070226005763e-02   +2.505861509009807e-01   +1.590970332838359e-01; -3.758442640062249e-01   +3.424669594358128e-01   -1.672956394451859e-01   +2.547923986153481e-01   +2.974508825540623e-01   -3.046407503624766e-01   -3.437696243686590e-02   -2.472053152492557e-01; -3.261736898840054e-01   +1.214658219573149e-01   +4.101768239567106e-01   +7.167269210453465e-02   +3.612627945531162e-01   -1.275271060933796e-01   +8.839838541948514e-02   -3.445709859330496e-01; -1.961663460374383e-01   -2.641534590922014e-01   +1.491234576329536e-01   +2.597476951129796e-02   +2.323972149628179e-01   -1.152782635128100e-02   -9.883101989416727e-02   +2.019412463395013e-01; -1.876149564070764e-02   -4.957266827927630e-01   -4.008353153097345e-02   +1.568024150195761e-01   +8.420490422603732e-02   +3.600750818982675e-01   +2.935824052665904e-01   +1.316636499566268e-01; +2.771522598212721e-01   +2.657199803313093e-01   +2.173075027062486e-01   +2.862490568010408e-01   -6.426123486758473e-02   +1.435256637211468e-01   -8.624705460308546e-02   -8.123672303890302e-02; +2.223417037867667e-01   +6.213649821192541e-02   +2.032811095204884e-01   +1.410997060605531e-01   -7.883335560597880e-02   -1.315685985339551e-01   +4.616750988629211e-01   -1.035250515108004e-01; -1.597246571094825e-01   +3.525099103945517e-01   +4.040163457441748e-02   -4.051205963907004e-01   -8.876961152110835e-02   +2.870633856914669e-01   -3.375973070439076e-01   -1.832583862337611e-01; +1.097144505894804e-01   -1.215112971683462e-01   +1.292554992488487e-01   +2.797071843528834e-01   +3.877937900633645e-02   -4.164120458039294e-01   +1.521321251893335e-02   +7.609517825397569e-02; -7.406524349134713e-02   -3.691136529750710e-01   +1.452149987096882e-01   +8.942390533382542e-02   -2.976770498782164e-02   -6.592963763545345e-03   -1.069631975912692e-01   +1.604797866845425e-01; -5.915569916727705e-02   +1.285659257409822e-01   -4.197293387184400e-03   +3.623696541823180e-02   -1.872830456184125e-01   -2.283282402034502e-01   -6.346237711562888e-02   -1.707323563383257e-01; +3.946206769782089e-01   -8.706069915497525e-02   +1.753631939838752e-01   +7.118303257068265e-02   -2.891420470272671e-02   +1.599850846377004e-01   +3.910557241891202e-01   +5.722287420109946e-02; -1.310637670887508e-01   -1.640724777043908e-01   +3.800817840553448e-01   -3.315539002788455e-01   +4.135263817129703e-01   +4.525144534951282e-02   -6.289721822365531e-02   +5.800417698858436e-02; -3.744182596215770e-01   +3.938869210651152e-01   -2.236533849147202e-01   -2.755226252465585e-01   +9.094509933012887e-02   +1.516331595603949e-01   +3.211244212749400e-01   -1.463089566687698e-01];
L1I_L2I_iGABA_netcon = [+1.472278645415621e-01   -1.610732377773248e-01   -2.980723499565026e-01   -3.729121222189880e-04   +8.823004658526183e-02   -2.408449800490868e-01   +1.381424708699503e-01   +1.965544934311081e-01   +2.592710298894588e-01   +2.476600198615450e-01   +7.415226087884066e-02   -2.123350576901696e-01   -1.157114962714422e-01   +3.850395398103793e-02   +2.731010567604185e-01   -4.075015614813371e-01; -4.330355133867233e-01   -3.578842015067399e-01   -1.590558422233779e-01   -1.701240937177548e-02   +2.532263862456207e-01   -2.815645574730081e-01   -2.166839640537887e-01   -1.351989346962650e-01   +7.363355125555227e-02   -2.001176998656769e-02   +6.189752585707251e-01   +8.340527614897311e-02   +2.031143737491897e-02   +1.484181908545206e-01   +3.256529501059197e-02   +1.761321543728704e-01; -3.094316989486899e-01   -8.728332410784322e-02   +7.141886020456766e-02   -2.412917181318070e-02   -2.426831278980731e-02   +2.442722715156144e-01   +2.003347729659938e-01   +1.281677706159026e-01   +2.837898854845257e-01   -7.631353554087883e-02   +3.823349349031696e-03   +1.491351777416408e-02   -4.613819285641185e-01   +2.941751159253848e-01   -2.548009301015726e-01   +3.387704274915401e-02; +2.671706965380746e-01   +1.111721337000614e-01   +1.415937024791572e-03   +7.557098283132449e-02   +1.932247647678682e-01   +1.131906599826845e-01   -1.979512959027784e-01   -2.063067636018637e-02   +7.127917168947115e-02   -1.131527209207966e-01   -3.558775582444164e-01   -2.440441468994269e-01   -3.623976974268440e-01   -3.195133683329825e-01   -4.753725941683377e-03   -3.123066563576898e-01; +3.196857836196287e-01   +2.523592105591205e-01   +1.508038561328860e-01   -2.000440661425499e-01   -5.871801551643280e-02   -1.362324939248604e-01   -4.504987780408313e-01   +2.616012609312428e-01   -1.559137646391640e-02   -3.141826390666088e-01   +4.412793377296413e-01   -1.105501799864127e-01   +6.162193595290974e-02   +4.342531705318108e-01   -4.165334936488338e-03   -1.821107488921588e-01; -1.548374873951359e-01   -2.670805495758409e-01   +3.954168786789912e-02   -3.894099256441901e-01   -4.404425215248915e-02   +3.706530531874319e-01   +5.547437999606337e-01   +3.045441316971252e-01   +2.027017996431300e-01   -2.726037430723391e-01   +9.382761566706134e-02   -1.861566668231394e-01   +3.718469041115336e-01   -3.799314620417489e-01   +1.237170330114254e-01   +1.791718173894929e-02; +7.558654859805475e-02   +1.007206457895966e-01   -3.325689598061043e-01   +2.197371262215186e-02   +3.733593498270550e-02   -2.500384859805847e-02   -1.359022030831925e-01   -2.972632825401355e-01   +3.182757445533645e-01   -8.218038764968860e-02   -4.536830082803861e-01   -2.994209534387868e-01   -3.080415978773579e-01   +3.001887080189596e-01   +2.124315131135654e-01   +3.339808462586036e-02; +1.246337908805113e-02   +3.513572443440238e-01   -3.761129544796136e-01   -5.719269063335242e-02   +2.646014601015602e-01   +2.483110079581904e-01   +1.041729583005540e-01   -3.502480949126046e-01   +1.424505617964993e-01   -1.665317751258250e-01   -2.228243073504748e-01   -2.050070206579276e-01   -1.862298940341295e-01   -2.841340109678880e-01   +4.333558793687853e-01   -1.701895138556605e-01];
L2E_L1E_iAMPA_netcon = [-1.326066067552886e-01   -1.673899883721572e-01   +2.469572189520414e-02   -7.994165762008364e-03   -1.498115930473000e-01   -6.922474552914923e-02   +1.055862588821847e-01   +2.168216888252133e-01; -1.748986876801276e-01   -5.547600014221554e-02   +1.880195054727045e-01   +4.680392811446589e-01   +1.228608757873301e-01   -3.088760435074969e-01   -1.179623968086219e-01   -2.130232459327768e-01; -1.836554298764144e-01   -2.583712841344431e-01   -5.882335131863217e-02   +3.413905071423594e-01   +2.464126650748401e-01   +2.202502367177598e-01   -2.890151347069292e-01   +5.367872030308655e-02; +1.255676629133827e-01   +8.003726964050467e-02   +3.324023721136102e-01   -1.971017342756083e-01   +5.817218430937714e-02   -2.625980507893427e-01   +1.586640940099305e-01   -3.752533179124516e-01; -1.643626568770172e-02   +1.408584440308617e-01   -2.136439612771765e-01   +7.342495256624504e-02   +2.917267137486844e-01   +1.436253408326038e-02   +9.312255972106004e-02   +3.597125716925602e-01; +1.729152218287908e-01   +8.966040943297852e-02   -1.592785365579870e-01   -3.507291226182000e-01   +4.001073149219345e-01   -2.350727211029257e-01   +1.143756233413426e-01   -1.368638102295628e-01; +7.428643698065673e-02   +2.725675386573091e-01   +1.329816287181624e-01   -2.021690163783870e-01   -8.488388114614839e-02   -2.654287836263003e-01   -5.721883181378776e-02   -1.356453956305715e-01; +1.287391666685609e-01   +2.384018080165214e-01   -6.277415894730831e-02   -4.411716028341710e-01   -2.338900138738059e-02   -1.109942840678302e-01   -2.826795692222681e-02   +9.066626079199699e-02; +1.600120418941808e-01   +3.445259546114380e-01   -8.547297972304151e-02   +8.003171600261619e-02   +1.589834311328882e-01   +5.096581849550644e-01   -2.924328893253418e-01   +5.232975640101153e-03; -2.827636969979593e-01   -5.014981051839235e-01   +2.529615597490029e-02   -2.809973781984153e-01   -2.983687206515946e-01   +2.144555992416705e-01   +1.167002240425204e-01   +1.623435295660534e-01; +4.101600496619842e-01   +4.546205936550394e-01   +7.777471945947013e-02   +3.640035971071019e-01   +2.019702967668709e-01   +1.400603823679475e-01   +5.696044916056974e-02   +2.490438117734878e-02; -8.118324248073032e-02   +1.448917576519517e-01   +1.897984035937575e-01   +1.966275621230796e-01   -1.316121836097005e-01   +2.287256374571615e-01   -7.639488395329047e-02   -4.952613370961360e-01; -2.212342658996583e-02   -1.834431032561108e-01   -2.612884340894701e-01   +8.870368770380929e-02   +1.401005916455370e-01   -1.302798567533471e-01   -5.517359371583162e-02   +9.809225761073537e-02; +2.381999596136039e-01   +6.416323336964899e-02   +7.414496856570336e-02   -1.948830363854621e-01   +2.019764609408673e-01   +1.364777804703416e-03   -7.652260298833410e-02   -3.426033309628218e-02; +1.400201777886072e-01   -6.103676184189080e-02   -1.636599232152577e-01   -2.906531728399689e-01   +6.987314110394641e-02   -1.863166678432237e-01   +4.475424439866177e-02   +2.761032956368308e-01; -6.142482479483635e-02   -3.022948840666538e-01   +3.913256366853562e-01   -3.239948189879801e-01   -1.292157661013515e-01   +8.714824859249233e-02   -3.063496796860654e-01   -3.939856796172957e-01];
L1E_L2E_iAMPA_netcon = [+4.147286612495689e-02   -1.508738572173742e-02   +3.537613762866223e-01   -3.096715688307201e-01   +1.255548383489700e-01   -9.858374659400274e-02   -1.467131558359340e-01   -3.259582582729652e-01   +3.202895202606836e-01   -3.904370660385479e-01   -1.416699656334676e-01   -1.045482475774718e-01   +3.314645547157566e-01   -6.300970960508044e-03   -2.259424830697383e-01   +1.110414980803450e-01; +1.601425608133104e-01   +2.556402025260314e-01   +4.009591564336668e-02   -2.968287142995537e-01   +3.472689976114907e-02   +1.449704865552807e-01   -3.369264090129582e-01   -1.573873309451726e-01   +2.281563821461330e-01   +2.417196889689630e-02   -4.492072858065664e-01   +2.369681928188049e-01   -1.486823340746557e-01   +2.459117326006914e-01   +1.589375813958208e-01   -1.254900484212529e-01; +2.185574974911329e-01   +2.589180285852799e-01   +1.486329989477897e-01   +3.694437853301517e-01   -2.982474173497356e-02   -2.520229794295233e-01   +2.825091088031011e-01   +2.434071952568400e-01   +6.057257542909111e-02   +3.639534263900421e-01   +3.687819269872908e-01   +2.667961304252218e-01   +1.200776202824693e-01   +1.675561035486438e-01   -3.340205521552533e-01   +1.148265306782492e-01; -2.452414744369591e-02   +2.466125124073496e-01   -7.206400283311662e-02   -1.245501351250383e-01   -1.049374075148573e-01   +1.739634250060443e-02   +3.807861019669806e-02   -4.072703978929629e-02   +8.365863677583707e-02   +7.221752797374917e-02   +3.106757815923837e-01   +4.464443088311065e-02   -3.971174640133621e-01   +1.745423342391482e-01   +1.835879432263298e-01   -1.051434340504600e-01; +3.666835187160010e-01   +2.726699334917809e-01   -2.850352164281075e-01   -2.864650091592338e-01   +2.920318896328775e-02   +2.941584105720931e-01   -2.551953096620131e-01   -3.798783964877661e-01   +2.024687485727192e-01   +5.657610287473333e-02   +5.476186334166658e-02   -1.948814384409267e-01   +3.047542366015673e-01   -1.310882435235044e-01   -1.559542555930767e-01   -4.173669047756071e-02; +2.685287102026408e-01   -2.673186845503461e-01   -3.202582130049508e-02   +1.045480747551978e-02   -3.424593037179186e-01   +1.053476921942923e-01   +9.788105304528538e-02   -7.500391072020485e-02   -1.964088150019355e-01   +1.220853834771492e-01   -2.086592245006573e-01   -6.185707131862655e-02   -6.178987966875597e-02   -2.034258405532335e-01   +9.443201999996169e-02   -9.705666125380026e-02; -5.342868362067446e-03   +1.446138556832933e-01   +2.173372784380729e-01   +3.159657191400717e-02   +1.502635188319864e-01   +1.772011677246526e-01   +2.843962567354894e-01   -5.699216984412162e-02   +2.057066549376177e-01   -6.994498457775761e-02   -3.759702924749364e-05   +1.259843708112348e-01   -1.227361917622819e-01   +3.763103527368913e-01   -7.193206511714856e-02   -1.067363101836665e-01; +2.459930236383882e-01   -4.324159668039253e-02   -1.325476846046607e-01   -3.586291358549237e-02   +1.809507249215157e-01   -1.274744860110686e-01   -1.902678517972065e-01   +5.483139581487018e-01   +4.272934742105581e-01   +2.503584188816162e-01   -6.267143588275639e-02   -4.177885747248506e-01   +2.784299509114707e-02   -1.682136661243891e-01   -2.412223833840771e-01   +9.885358483318810e-02];
L2I_L2E_iAMPA_netcon = [+1.817247335533426e-01   -2.646515813379560e-01   -3.190679481078947e-02   -5.798362175267090e-02   +3.305742129617846e-01   +3.300626030023097e-01   +2.559430284702344e-01   -1.024235775592567e-01; +3.029351919684888e-02   +1.601167786403158e-01   -6.784746035614564e-02   -1.345934520483284e-01   +1.536522752531751e-01   +4.684725168426075e-01   -7.595709446192037e-02   -1.225081489238311e-01; +1.792122739221154e-01   +2.270246276746174e-01   +1.244148412952852e-01   +3.008444346223270e-01   +2.630822648398712e-01   +5.036855677736821e-01   +4.712663307184231e-02   -2.375721643738115e-01; +4.179299962462481e-01   +2.112279785897934e-02   -3.316517719512578e-01   +1.949921993730899e-01   -3.621657764289758e-01   -5.361738358707670e-02   +3.437615650269590e-01   -5.642385658037508e-02; +1.789819963036378e-01   -3.588846617278121e-02   -2.495841371264189e-01   +2.026843266540297e-01   -1.651480168676802e-01   +2.529142707377017e-01   -8.149691971034491e-02   +1.485148444415128e-01; -8.837284719440369e-02   -1.062423346429753e-03   -2.053252847173825e-01   +2.189095811392878e-01   +1.000872605304187e-01   -2.713540807692044e-02   +1.388913435889441e-01   -1.404748151607046e-01; +4.369903230535355e-02   +3.019917911328838e-01   -9.682613262200801e-02   -1.438602648415014e-01   -1.010290449685529e-02   -2.312518279115058e-01   +9.014457320423555e-02   +1.307050456361544e-01; -3.521869281093693e-01   -2.234118867364542e-01   -6.400470983268280e-02   +2.838152325112978e-01   -9.990191718606273e-02   -3.410132723630676e-01   -4.905219230073739e-01   +3.277325251196131e-01];
L2E_L2I_iGABA_netcon = [-1.992649858953732e-01   -1.122919240951777e-01   +6.322577031056982e-02   +1.951057726638846e-01   -4.762846939204937e-02   -8.093180413745590e-02   -2.318404063666739e-01   -1.019621210330583e-01; +2.467579553145560e-01   -2.118009015836862e-01   -1.184172054775170e-01   -5.752538054925023e-01   -3.184321915962426e-02   +1.042477326050408e-01   +2.140004862369534e-01   -1.342728774014414e-01; -1.989636812441041e-01   +2.519085699184330e-02   -6.645570466292271e-02   +6.077006473458807e-02   -1.197909665470938e-01   -1.673280934848713e-01   -4.384725781663914e-01   +3.440596489008052e-02; +2.399633371995142e-01   +3.099572162882199e-01   +1.796127519117872e-01   +2.544900609371609e-01   +4.386292643840242e-02   +4.655576643897362e-01   -1.761656672416141e-01   +1.117859335980729e-01; +4.933446488734857e-02   +6.129448566211730e-02   +2.149996967620104e-01   -8.827686565738929e-02   +9.012301600947126e-02   -7.544324733497662e-02   -2.199201285974209e-02   -2.413108488267507e-01; -2.306310491394254e-01   +1.215142400741106e-01   +3.494962300192118e-01   -3.330649238222096e-01   -1.499889806636854e-01   -1.886655559557132e-01   +2.619223339516122e-02   +1.339302824730407e-02; +2.121396321270866e-01   -9.601290664627884e-02   -2.018820452491105e-01   -2.908805777117676e-01   -3.357110167462539e-01   +1.149159765978268e-01   +2.551185751774379e-01   +1.587951243078081e-01; -4.314858906397169e-01   +2.360516384641984e-02   -1.404549903166841e-01   +2.274628342558620e-02   +2.894084960503648e-02   -3.046986117033751e-01   +6.961552881961336e-02   -1.945741774455373e-01];
L3E_L2E_iAMPA_netcon = [-2.134228258965715e-01   -4.463551227079815e-02   -3.903285532662251e-02   +9.259243586604435e-02   -1.818536895286766e-01   +2.654702022405749e-01   +1.174732444481854e-01   -4.051680034717663e-02   +1.157909507524715e-01   +7.066295236824643e-02   -4.585458459966663e-01   +1.104220107017731e-02; +3.383908222230328e-01   +2.747596128371642e-01   +4.279472284596424e-01   -2.969199763352331e-03   -3.454593058402447e-01   +1.175803211379556e-03   -3.148454120602392e-01   +2.877313685891419e-01   -1.456475816393808e-01   +1.499569142033885e-01   -2.591672736156494e-02   +1.960360937502021e-02; +6.970235873909586e-02   -7.778831182369109e-02   -4.174415661600728e-02   +3.574795622400048e-01   +1.090243617555531e-01   -1.463848560957137e-01   -2.895604835281740e-01   +9.375029885129406e-02   +3.489012853300312e-01   +1.540340076584742e-01   +1.373794906663005e-01   +2.871950084000577e-02; +3.189801972040074e-01   -4.572802309869350e-01   -9.221058868004076e-02   -4.391037913892504e-02   +6.293600152837725e-02   +1.985910943229590e-01   -7.414656874552580e-02   -2.165469522245455e-01   +1.456689558178582e-01   -3.498599352811148e-01   -9.084888900120525e-02   -4.261786091495273e-03; +1.014964557523264e-01   +6.814198210160824e-02   +4.713561023638124e-02   -6.588449347601677e-02   -3.212046192300479e-01   +5.775478767264730e-02   -3.279659266710881e-01   -2.475186088400289e-01   -2.206418010872418e-01   +2.153054932879915e-01   +1.764560260977550e-01   +2.252212504066414e-01; +4.999500214032845e-02   -2.220802212458213e-01   -3.475704152651914e-02   +1.832110049416202e-01   +2.360319345502827e-01   -6.807646942874016e-02   -3.288967405879302e-02   -3.844836238767559e-01   -1.287840625639226e-01   -1.930441117018776e-02   -2.093620083239375e-01   -3.550148727957644e-01; +6.933661337282812e-02   -2.865233395595476e-01   +3.610301754063950e-01   -1.782335970065716e-01   -9.595704986264536e-02   +1.151161240064668e-01   +3.269033992026148e-01   +3.461244196600340e-01   -6.736041272120855e-02   -1.018472809506388e-01   -4.087547139182599e-01   -1.602594996365577e-01; -3.810757473748295e-01   -6.716822513563567e-02   +3.299064863634819e-02   +5.527023408410862e-02   +1.563518478187293e-01   +4.600192207090541e-01   +2.733018377332845e-01   -1.356253365964035e-01   +2.662644791909380e-01   -2.116399329607793e-01   -1.241755856686258e-02   -1.840549622986930e-01];
L3I_L2I_iGABA_netcon = [+3.071762067640482e-02   +2.543809425627451e-01   +1.477738635512960e-02   +4.496602447316127e-02   -1.781888351153446e-01   -2.453542323090764e-01   +1.536322515662701e-01   -7.804813016635317e-02   -1.024180722509815e-01   +2.902371311725483e-02   +9.295729794093557e-02   -2.262715057906380e-01; -1.750952820474441e-01   -1.766040145182916e-01   -1.334252577636824e-01   -3.465683346277712e-01   +2.602015424377524e-01   -1.578163473702793e-03   +4.968029396451243e-01   -2.963768737688777e-03   +1.236854439730922e-01   -1.315492258427260e-01   +1.360756280319386e-01   -2.789454133004718e-02; -1.307937136615668e-01   -4.169876952993433e-01   -5.120639869999707e-03   +7.460871919543047e-02   -1.391450104523370e-01   -4.334626869734264e-01   +1.735605650487392e-01   -2.460552969002766e-01   -1.986121312582962e-01   -4.829863266483776e-01   +1.773334296313739e-01   +2.400904006533235e-01; -3.133520663610980e-01   -2.001451774618698e-01   +3.821917552208115e-01   +3.814057712990668e-01   -2.333272497478212e-02   +1.637821215337633e-01   +7.556589442372816e-02   +3.456745667785975e-01   -1.737644697491310e-01   +2.530220030585363e-01   +3.552366339673081e-02   -1.131174707486098e-01; -4.709650934849736e-01   +1.789483860731756e-01   +3.593360588042990e-01   -1.574559805032061e-01   -1.546973854224529e-02   +2.466923035924228e-01   -9.402827161113216e-02   -1.208179755216010e-01   -3.184457250024695e-01   -1.014407528467128e-01   +1.225820266358127e-01   +1.744514609987033e-01; -2.146569756595668e-02   +4.376363002137246e-01   -1.068145414142947e-01   +1.735018044023652e-01   -3.288771529410944e-01   +3.102222071683344e-01   -2.463507228786765e-01   +2.707635473745575e-01   -4.235896643510344e-01   +5.964844490041393e-02   -1.195440191581901e-01   -2.771433907296165e-01; -1.946635953588962e-01   -4.972300787471006e-01   -1.024264241234794e-02   +3.400503950531997e-01   -2.273025249618587e-01   +4.098264446361614e-01   -2.381019292145738e-02   -1.381330760798649e-01   +2.766253075146006e-01   -3.897528965516283e-01   +4.537492592749826e-02   -1.262230279785872e-01; -2.538050629641857e-01   +1.212881200941205e-01   -8.203557935495334e-02   +1.787569687129692e-01   +8.104623156998313e-02   +1.385392440380553e-01   +7.290656663291523e-02   -1.105189388319085e-01   -1.573571039570817e-01   -5.685147261577131e-02   +2.989033513191495e-01   +7.069914605994418e-02];
L2E_L3E_iAMPA_netcon = [+1.470821071748873e-01   -5.929835030579565e-02   -5.435011060665837e-02   +1.139116044290808e-01   +1.641199636929547e-01   +1.005121715990792e-03   +1.662088869348171e-01   -3.866374558547153e-01; -6.650706060429640e-02   -4.330932429940705e-01   -2.037593525035737e-01   +6.619932356180418e-02   -4.937002955356371e-01   +2.755478693948933e-01   -1.782258201436955e-01   +2.082168037088978e-01; +2.090023208430383e-01   +3.311808823645623e-02   -2.667415016868074e-01   -2.911875068771889e-01   +2.129107910675522e-01   -1.375941273526891e-01   +1.899217656049897e-01   -5.766702407056131e-02; +6.275738135824573e-02   +9.682946524916541e-02   +1.992807485936536e-02   -1.109343060118681e-01   -1.326372058945338e-01   +5.467968043345628e-02   -1.674187899789620e-01   +1.634225899100347e-01; -1.084050462997109e-01   -1.454945201459206e-01   +3.405578352417525e-01   +2.616120015948866e-01   -1.787922648181011e-01   -3.371877208976826e-01   +2.285296372834556e-01   -1.710620564277312e-01; +1.011142371373630e-01   +1.155272826810617e-01   +2.657620700695544e-01   -3.728166236003081e-01   -1.996182098074188e-01   -2.492043670409123e-01   -2.498552445907618e-01   -1.105638550625973e-01; +1.758349994916813e-01   -2.128183739824907e-01   -3.195639260487325e-01   -4.220679753832445e-02   -2.361791224307916e-01   -5.781101021947259e-02   -1.295054027367832e-01   +1.586344960544434e-01; -3.327181736663086e-01   +5.447136843471719e-01   -2.198507163397297e-01   -2.475162224722904e-01   +2.952188568583445e-01   +4.518422215335383e-03   -6.501653209996464e-02   -5.093137694708344e-02; -4.743679290337277e-02   -1.703093110813006e-01   -1.232708325604075e-01   +3.021357241653251e-01   -2.580918665958383e-01   +6.628268750263452e-02   +2.919979466945446e-01   -1.926204519961683e-01; +1.329574879791558e-01   -1.059665625358659e-01   +2.929693621128460e-01   +2.020534745941631e-01   +8.098806951617779e-02   +3.754372856303122e-01   -2.539262628256896e-02   -4.468444192007601e-02; +4.119572876888904e-01   -4.073635385364629e-02   +2.374278251490514e-02   -1.909775995784885e-01   +2.547096051841585e-01   -3.627194076493598e-02   -1.916991968087822e-01   -3.231512902070781e-02; +2.128551443869028e-01   +6.838469486480772e-03   -1.423604409598959e-01   +2.294677783026735e-01   +2.064401706507546e-01   -7.926066090543490e-02   +2.060656050101145e-01   +4.357057596829524e-01];
L2I_L3I_iGABA_netcon = [+1.492041741939131e-01   -6.915066101807543e-02   -3.813216668125777e-02   -2.189176677775201e-02   -3.079949032836715e-02   +6.006802452487495e-02   -1.691898630786574e-01   +2.841709245523645e-01; +2.464878285187944e-01   +6.257521715906042e-02   +2.190138336425375e-01   -7.880316192226883e-02   +1.709170665985949e-01   +1.357852237748898e-01   -2.372727097022191e-01   -2.670027396181576e-01; -1.971495238738981e-01   +1.242057094820036e-02   -2.248322971696063e-02   -1.128150826119425e-01   +4.392807147103137e-01   -1.018369131998566e-01   -3.580259859394843e-01   -2.189063154143198e-01; -2.146860994183311e-01   -1.917068388600077e-02   -4.019364971135678e-01   +7.908484938036794e-02   +5.632865161563345e-02   +1.779009520334190e-02   +4.204493405109789e-01   -1.939972883870494e-01; -1.560040263435392e-01   -4.725511428256140e-02   +2.866046201916758e-01   -3.272357774695087e-01   -1.162131834243679e-02   -1.173453278816448e-01   +9.264852176415869e-02   +2.670422753064231e-01; +1.735693737143162e-01   +5.752034800835844e-01   -1.431379031379567e-01   +5.197183730126410e-02   +3.605510950710563e-01   -2.561864553937121e-02   +8.739899574137874e-02   -2.218049187454257e-01; -1.887332068465933e-01   -1.075472128590654e-01   -1.043848496577954e-02   +1.273096341853251e-01   -3.820893983854577e-01   -3.654428421986785e-01   -1.044069261243052e-01   +2.859497878205248e-01; +1.484311588870045e-01   +3.760013100658842e-01   +1.681069616571478e-02   +3.030929231470699e-01   -3.006730391093879e-01   +2.825915040355673e-01   +5.003912079019825e-01   -2.072616603970807e-01; -8.802221852258629e-02   -9.624792419451286e-03   -8.273710123542205e-02   +3.307069827239431e-02   +2.922487303433863e-01   +2.609013859884803e-01   -1.346715687418024e-01   +3.490951810439473e-02; -1.072562182960834e-02   +2.323761938630233e-01   +2.780130227457393e-01   -4.021359169852847e-01   +1.078365210953149e-02   +3.567114623998606e-01   +2.014821562498175e-01   +3.925278809647471e-01; -2.173701418682850e-02   -2.207105550524009e-01   -3.363335706611491e-01   -1.632633907614772e-01   -2.194208169642833e-01   -3.263037259306228e-02   +1.816071005520132e-01   +2.440092007294562e-01; +1.806255664745331e-02   -1.103001978632270e-01   +2.122320114368737e-01   +2.672215951259618e-02   +3.181964350874323e-01   -5.866186122077302e-02   +6.349238933669035e-02   -3.997426457728541e-01];
L3I_L3E_iAMPA_netcon = [+1.590760124791031e-01   -1.827551192488706e-01   +3.552098278181669e-01   +1.045333116954339e-02   -1.065054510139151e-01   -9.920766289608576e-02   +2.766994392086274e-01   +1.896377812048957e-01   +1.049794668426188e-02   -2.917033028667444e-01   -2.776504101481387e-01   -4.030029069044782e-01; -6.596791613663391e-02   -7.667521451502793e-02   -2.933362235437891e-01   +2.579625892271063e-02   +1.881850615433057e-01   -1.641087154061696e-01   +1.284466781290746e-01   +2.413332889489249e-01   -2.083257207023092e-02   -1.181647054486621e-01   +5.523541106628443e-02   -5.958005461516730e-02; -1.620126888012240e-01   -1.800625006170742e-01   -3.714991521489459e-01   +4.020292242036236e-01   +1.104619653051391e-01   +6.951774842673733e-02   +2.224373302604216e-01   -2.486895174578301e-01   +2.897381585629084e-01   -8.858166875595787e-02   +3.565968548075473e-01   -1.586964206527751e-01; +3.222268798865775e-01   +3.163427074228784e-01   +2.262794914048769e-01   +1.877731251560856e-01   +2.403242353579875e-01   +2.914566507819574e-01   +1.480119880881389e-01   -3.271961534370139e-02   +1.907058531594214e-01   +4.630781032101988e-03   +5.817559281106030e-02   +2.675489409842036e-01; +9.522651424191439e-02   +3.046299824088550e-03   +1.021342044958805e-01   +3.937452660460871e-01   -2.473086049555054e-01   -6.351216134039231e-02   -1.020240737707931e-01   +2.543108348303226e-01   -1.709836519959865e-01   -1.371578213618058e-01   -2.821367812374054e-01   -1.363872074486520e-01; +6.711079122430554e-02   +8.581256715046601e-03   +2.827052875562575e-02   +9.873517112587112e-02   -5.534768072782098e-02   +1.347638396221772e-01   -1.171909776047746e-01   +1.091456621260751e-01   +2.369162653329685e-01   -8.072136268218685e-02   +3.890725671354164e-03   +1.044647196282988e-02; -9.787665515652226e-02   +1.397172294782821e-01   +2.086240162124565e-01   +1.346313083493888e-01   +5.733815797805879e-01   -4.133652574064152e-01   +1.655680585266815e-01   +1.971554277967635e-03   -9.214814160883846e-03   +1.741605454779316e-01   +2.446618619168762e-01   -2.430113468568739e-01; -8.133528231650171e-02   +1.570587565954440e-01   -2.026419284004788e-02   +4.061301436859740e-01   -2.171845445998432e-01   +2.643785808260520e-01   +2.411337767467555e-01   -2.219483801248961e-01   -2.401974547734005e-01   +7.028752907781766e-02   -1.006681553288774e-01   -1.329006805326541e-01; -2.173732233377919e-01   +3.693210949418261e-01   +1.502041070162391e-01   -3.573613143142434e-02   +4.154228577349792e-01   -3.330890619180081e-01   -1.063311481620605e-01   -9.630716714116841e-02   +1.701321987927215e-01   +2.731811865414913e-02   -4.035045823301375e-01   -3.601112513545143e-01; -2.091134024977475e-01   -8.259422907070069e-02   +1.646766863318239e-01   +2.628556789644879e-02   -4.131686328842742e-01   +1.150162855932679e-01   -5.052057812812485e-02   +1.790242720051984e-01   +3.070407229950536e-01   -2.843933158303896e-01   -6.292091692778029e-02   -6.036440658681654e-01; +1.060720855535469e-01   -1.607470669358615e-01   -4.499874389706088e-02   -1.322161830103431e-01   -1.007914735956140e-01   -6.090579971290952e-02   -4.453351098089891e-01   +8.232679048839686e-02   -2.982440725723037e-01   +3.482245250763453e-01   +1.256930712867610e-01   +3.153043494286296e-01; +1.675132074667559e-01   +1.221540996911696e-01   +4.055468606352962e-01   -1.907754641356454e-01   +2.379366083697420e-01   +2.734642768376864e-01   -1.390994244123777e-01   -3.928702705020413e-02   +1.007986497203203e-02   -3.096055314722438e-02   -3.564709665938521e-01   -2.204280233886781e-01];
L3E_L3I_iGABA_netcon = [+1.234010557660858e-01   +6.197057696871025e-02   +1.203432283923213e-01   -1.834125881093059e-01   +2.178677554883770e-01   -3.168180971872356e-01   -3.865546814387095e-01   -2.429603584662864e-02   -1.511038434883061e-01   +4.682114438710916e-03   -1.506314504447241e-01   -1.528563297450979e-01; +1.486569464054465e-01   -9.414420467196748e-02   +3.189630000238647e-01   +3.887755304654404e-01   -3.843621273230450e-01   -1.986051212495669e-01   +2.697260481075143e-01   -7.868851539866187e-02   +4.813275301622665e-01   -3.088007559677050e-01   +2.564375650539883e-01   -4.359257262023256e-01; +1.076322298250017e-02   +1.545422823378040e-01   -1.806811605534217e-01   -1.915106535671280e-01   +7.006475459507823e-02   +5.652802181086258e-02   -1.419853661924889e-01   +4.082265897459839e-01   +1.829361797508952e-01   -1.845127374731935e-01   -7.869224778245407e-02   -6.953508870335752e-02; +3.283599856477452e-02   +2.587983149689328e-01   -2.943671021481521e-01   +4.895424232562996e-02   -2.106291885389165e-01   -8.214800679130171e-02   -2.364640583371612e-01   -6.357759503989918e-02   -1.666077591877582e-01   +3.109232933550740e-01   +1.295993354085954e-01   -2.782577754256751e-01; +1.750828439462234e-01   +1.488776522132493e-01   +1.200747346383278e-01   +2.737416930257406e-01   -1.243983040205588e-01   -1.822536401898050e-01   +6.886973615723868e-02   +7.862968668098902e-02   +5.619661869962148e-01   -5.980472403899004e-01   -2.895651378619273e-01   -1.662628972169483e-01; -4.826986007412041e-01   -1.360851007969011e-01   -1.377891784330411e-01   +6.508476765639662e-02   +9.141667935194800e-02   -6.646558829463822e-02   +1.101693838311768e-01   -9.564142385156768e-02   +2.957992681118709e-01   -2.869724839709210e-01   +3.847296072740163e-01   -1.719531804376778e-01; -4.160627172863707e-01   +4.024191655697690e-01   +4.042234933412289e-02   +3.687756853353016e-01   +2.320003511144021e-01   -1.549370304376778e-01   -3.486565354859840e-01   +4.008327704142743e-01   -4.464435623197648e-02   -1.246791708086591e-01   -5.356643527038789e-03   -1.749509036874085e-01; -3.745724545735910e-01   -2.768941298563811e-01   +2.130596438833771e-01   +1.342734255218856e-01   -1.265395473995444e-01   +2.811544618925351e-01   +1.772071286698930e-01   +1.128421725370410e-02   -2.722618504349850e-01   +1.149941660856359e-01   -1.520567401412954e-01   -3.010482822284191e-01; +5.320390163934666e-01   +1.144695050736313e-01   +6.693898549088455e-02   -1.359416240720871e-01   +2.070425674515999e-01   +2.161033725468740e-01   -1.228929364731512e-03   -1.405973854085788e-01   -1.617826130555539e-01   +1.524988058411373e-01   -3.458945696337406e-01   +1.903224797775969e-01; -3.079405927585028e-01   +4.215213976601906e-03   +2.711020825546500e-01   -4.313385807080516e-02   -3.449838772655614e-01   -1.182521445241066e-01   -2.584066990731515e-01   -1.709676888324362e-01   +8.558506712153929e-02   -2.411984031055312e-01   -8.703460587435737e-02   +1.517447849114535e-01; -3.140904826264835e-01   -1.353131821345663e-01   +2.668700086139120e-01   -8.923566327723377e-03   -1.522710351174896e-01   -2.833532851796229e-01   -1.419781480844588e-01   -6.292097086327136e-02   -1.925601558039832e-01   -2.438497285311977e-01   -3.395129075250570e-01   -1.466374518220979e-01; +3.996896752111266e-01   +1.379168684041797e-01   +5.587266567116798e-02   -3.510204818304886e-02   +4.228735176586793e-01   -3.299520359639698e-01   -2.689924573603196e-01   +3.618007819389447e-01   -2.793406793045320e-01   -2.146231957678231e-01   +5.092812172544285e-01   -1.545838504059782e-01];
L2E_Input1_iAMPA_netcon = [+1.426778731330915e-01   +3.465679191439185e-01   +6.573989526287799e-02   +4.212377565484794e-02   +3.866508054271561e-01   -8.570180884571096e-02   +9.190066241763115e-02   +2.592527558679655e-01];
L2I_Input2_iAMPA_netcon = [+2.482801836528439e-01   -1.266059575380502e-01   +4.100753267911449e-02   -2.274600868959776e-01   -1.833206523558317e-02   -4.006406392820853e-02   -5.922120089297365e-02   -9.651259243746682e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
