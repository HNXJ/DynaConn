function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.952841556543844e-01   +2.379851180399988e-01   +3.622839176330441e-01   +3.877274211832949e-01   +4.235787821404103e-01   -2.041279400302102e-01   +2.380933653528009e-01   -5.176698696454758e-01   +2.912874955381668e-01   +3.511533579558369e-01   +3.131536323206217e-01   +5.465372538850877e-03   +1.824599839492143e-01   -9.326446304964628e-02   -1.446437190963686e-01   +2.620031473155554e-01; +1.109310273566264e-01   -2.093999417947913e-01   +4.959475074946678e-01   +8.291858728952263e-02   +6.180128229635847e-01   +1.807432032844289e-01   +3.561987928356206e-02   -3.652039426213542e-01   -1.515617718805890e-01   -1.727935181466610e-01   +3.322970498830341e-01   -4.720223362100526e-02   +6.878170259597093e-02   +2.840129111824186e-01   -7.631726731727685e-02   +5.212784161292668e-01; +5.248476103334185e-01   +3.810024136031979e-01   -1.399855135718824e-01   -1.159388417524905e-01   +3.018539199633264e-01   -4.617508877001862e-02   -1.200582524385366e-01   -3.294899039672612e-02   +3.188003421540104e-01   +3.139961688997760e-01   +4.870020794211888e-02   -3.213578273003311e-01   +7.489346075334341e-02   +2.571627180472826e-01   -2.899143682285212e-01   +4.130242247960722e-01; +4.125111186232974e-01   -1.655885045434587e-01   +7.070149752389768e-01   +6.147685285978180e-02   +8.701685338196935e-02   +6.507466056099424e-01   +7.459727444161941e-01   +1.564472095954118e-01   +6.169839633828664e-01   -4.121567830949713e-01   +1.467820237394470e-01   +3.727667508145226e-02   -1.135087869351273e-01   +1.113636704486635e-01   -1.897667604348842e-01   +5.846089333827055e-01; -2.080915306299237e-01   +9.157894313895497e-02   -1.671109948947036e-01   -4.642251126686456e-02   -1.812811113831534e-01   +4.058577745055126e-01   +2.548448558979423e-01   +2.532977954487443e-02   +4.540131687481867e-02   +3.906599437405603e-01   +5.218847581661576e-01   -2.100179122406562e-01   -6.827248872825849e-02   +9.965477856022588e-02   +5.149445229220829e-01   +7.230929889036822e-02; +1.453598005711554e-01   -4.653389826606236e-01   +7.717445151929320e-03   +1.669137222448829e-01   +2.229308978620657e-01   +5.663553651600627e-01   +2.590510069387202e-01   +3.372850162956900e-01   +1.412420821918338e-01   +7.046614923269463e-01   +2.139803984264067e-02   +2.434635116318208e-02   +1.257983015263815e-02   +2.679583864586180e-01   +9.092713986574698e-02   +3.761717935427443e-01; +2.454537710030164e-01   -1.964921601955589e-02   +5.436513003573361e-01   +2.637385744993596e-01   +1.055317293135603e-01   +1.392367985867325e-01   +4.027897540803684e-01   +7.026139817750920e-02   +1.231961824006331e-01   +2.641442382062728e-01   +7.306686528519725e-01   +6.428565092797115e-01   +8.389224709654350e-02   +3.667869984530762e-02   +3.791807629806811e-01   +9.992811865267287e-02; +4.522809665535657e-03   -4.930051724282988e-01   +3.026733758366789e-01   +4.869850464074219e-01   +1.745400139482569e-01   -8.639795812846268e-02   -4.804882153619370e-02   +1.962970755161072e-01   +3.105264152943886e-01   +4.543811359589776e-01   -1.728378379921056e-01   +1.087942960829238e-01   +1.656192740937185e-01   +3.131949295514438e-01   +4.946889300479174e-01   -2.142368412328842e-01; +4.988115854487752e-01   +2.754939922024995e-02   +1.575020994119211e-02   -6.733406870665895e-02   -2.761271677758481e-01   +4.994960087391852e-01   +1.742436679388944e-01   +1.977415633059463e-01   +4.431023108590737e-01   +5.873915419767291e-02   -3.889313233763795e-01   -2.397352343097844e-01   -3.580674774747818e-01   +2.960827380184723e-01   -1.317991660501114e-01   -1.823134487757200e-01; +8.595576123927051e-02   -1.682470166908082e-01   +9.925597587068503e-02   +2.246666418984337e-01   -1.577872585170383e-02   +5.026440936846314e-01   -1.556820137451467e-01   +2.767922907525920e-01   +2.659283694280908e-01   +1.418315519633081e-01   +4.168089638014248e-01   +2.952228060775534e-01   -5.835597469831118e-02   +6.635525882082124e-02   +6.977677294027097e-02   +3.342922139033921e-02; -1.911963181279645e-01   +1.151225060393829e-01   +4.841485988673777e-01   +3.450280541699520e-01   +2.168493262743511e-01   -2.596653339190892e-02   +3.086388456016165e-03   -1.255692958419308e-02   +6.664613604529199e-02   +2.226862832732433e-01   +4.146202912829444e-01   +1.753514736692386e-01   +9.597843032528167e-02   +5.508147813818232e-01   +6.889476644640767e-02   -3.939416507998943e-01; -7.376707329228394e-02   -1.633834348914962e-01   +1.662177262486626e-01   +6.512144093984200e-01   +5.885868757455108e-03   +1.063125353303507e-01   +5.426304232076605e-01   +7.978797292340428e-02   +6.142138768847379e-01   +4.836772659829107e-01   -3.441856405838499e-01   +3.306050560167809e-01   +4.926417978921184e-01   -1.006711423594464e-01   -1.576531217128113e-01   +9.739462258455067e-02; +2.969569943244799e-02   -1.192820764812377e-01   +1.733897303017224e-01   +4.935892265689918e-01   +6.388453331375925e-01   +1.639062719758961e-01   +2.221527112672698e-01   +3.652930531753440e-01   -2.307301939752709e-01   +2.271022547654502e-01   +3.235457044175812e-02   -2.446961757250656e-01   +2.192146830444977e-01   +3.853734520507273e-01   +6.721557230500490e-01   -1.767943789863053e-01; +1.107339431860207e-01   +3.621731249171859e-01   -3.319415425398446e-01   +4.826019027961676e-01   +2.685818750876821e-02   +3.208438896517368e-01   +1.761982233409078e-01   -1.011036162208718e-01   +4.995237188211398e-01   -1.638185736735835e-01   +3.270060183155582e-01   -5.397984930123641e-02   +5.674759407479447e-01   +1.440488491615326e-01   +1.005231467181463e-01   -2.771907657941995e-01; -2.747445883108022e-01   -1.038515139808595e-01   +6.765982042829567e-01   +3.653281595679102e-01   +2.627803204084470e-01   +2.728292441736048e-01   -1.748062510264485e-01   -8.969679990312918e-02   +1.028701322807449e-01   +3.618312593414433e-01   -8.888372999975287e-02   -5.438593520645061e-02   +6.024589448681218e-02   +4.984150967256192e-01   -2.948451889698775e-01   +3.968218703028344e-01; +2.577191830879373e-02   -5.987493029351010e-02   -3.808636278449461e-01   -3.414696477978795e-01   +3.939627318506778e-01   -2.368706340219073e-01   +3.500563844375285e-01   +1.878123847936276e-01   +2.763139645510257e-01   +4.560477955793887e-01   -3.826270194998244e-02   +9.576894829159965e-02   -1.928080608650490e-01   +3.152179867920995e-01   -6.353897264982132e-02   -3.686873395016317e-01];
L1E_L1I_iGABA_netcon = [+5.477264537869728e-01   +1.713147617837182e-01   -2.766092548000152e-01   +6.803985420805470e-01   +2.337335148730844e-01   -4.052254458587061e-01   +4.163860465302490e-01   -9.618362854083294e-02   +7.597450902378616e-01   -2.741105759387555e-01   -1.285758085500236e-01   +3.913444591006686e-01   +2.077426129006833e-03   -3.562254257026346e-01   -2.244950901260188e-01   +5.345705368103928e-01; +3.593944676284995e-01   +3.169891403540212e-01   +1.398770012789471e-01   -1.383289151019452e-01   +5.830953981556439e-01   +7.974039430581753e-04   +3.426972086180527e-01   +5.672055747280023e-01   -6.266422676967561e-01   +1.847272274212660e-01   +6.990971736863479e-01   -5.475026232960892e-02   -2.003356478265332e-01   +2.229377453600604e-01   +4.512879111363958e-01   +1.864572215240149e-01; +6.128329546925405e-01   -1.457518945879201e-01   +1.984658804972463e-01   +2.677748988143015e-02   -2.206567931936270e-02   +2.365883646610525e-01   -6.812205507553246e-02   -2.103610562835273e-01   -8.474967121305277e-02   +1.793751274558007e-01   +1.822218288485087e-01   -1.396649099624059e-01   -1.899586010120350e-01   +1.811798669995277e-01   +3.891774591085488e-01   +2.191324355411673e-01; +4.795746286906998e-02   -3.755406497233498e-01   -1.847621826682630e-02   +2.308357727529030e-01   -1.189202557770574e-01   -6.439254507058445e-02   +2.591658726565390e-01   +1.970800427040922e-01   +3.336982120564546e-01   +3.903685129041741e-01   +2.374687672192657e-01   +2.214965546809080e-01   +6.223834706185357e-02   +7.020140112730117e-02   -6.947146880068179e-02   +6.480615012948424e-02; -5.634831093102078e-01   -3.892747522011033e-01   +3.044288577348880e-01   +1.531382403635944e-01   +2.137150764086900e-01   +2.567189587158655e-01   -1.026921766504235e-01   +1.798166007400149e-01   -1.897029203363911e-01   +1.583750245379515e-01   -7.780098351509161e-03   -3.263345344745154e-01   -4.926085589760802e-02   +2.280893998771566e-01   +2.043968585804034e-01   +4.957254135904671e-01; +1.712120113809561e-01   +1.399895345478091e-01   -9.633692472207542e-02   +1.781021330819670e-01   +4.960061605919475e-01   +1.151768620282555e-01   +1.690744842602819e-01   -1.413025746125340e-01   +5.249827650891078e-01   -4.973149276363317e-01   -6.703086392404885e-02   +4.811127598428593e-01   +5.556122348842343e-01   +4.832446119548391e-01   -1.740874945230992e-01   +1.931194070255240e-01; -3.596259856033157e-01   +6.639387749646547e-02   +7.882646956431861e-01   +3.883484008192907e-01   -3.205978232789110e-01   +8.042787899054440e-01   +7.137915699322502e-02   +1.926075703465739e-01   -1.270898111466434e-01   -2.781088497387908e-01   +2.781583447374875e-01   +6.837455450508667e-01   +5.132283378566843e-01   +1.325301771213768e-01   +3.533557177825823e-01   +1.547701605462186e-01; +7.136320763480185e-01   +3.159778840690903e-01   +5.058306122975866e-01   -1.925972232003587e-01   +6.406182234611814e-01   +5.120376822081963e-01   +5.572387019633216e-01   +5.492811510035464e-01   +3.813519050363514e-01   +2.008709573379507e-02   +1.105047239390358e-01   +2.102949479697977e-01   -9.709627592771289e-02   -1.207891038833320e-01   -2.585035159908792e-01   +4.769576452723061e-01; +3.127348934842015e-01   +2.282309533461289e-01   +1.685065710066544e-01   +6.785791207409059e-01   +3.919960345322329e-01   +2.529265638720624e-01   -1.823133157452915e-01   -2.846686825631620e-01   -4.005968759045835e-02   +6.894517697852829e-01   +3.709847308821827e-01   -3.575136499816542e-03   +5.018971938567774e-01   +1.111434671138528e-01   +2.547573738676245e-01   -2.223435611009228e-01; -1.671268258704932e-01   +3.370543114351732e-01   +2.576930808110935e-02   +1.253679998018807e-01   +2.911589994353287e-01   -3.359086835930595e-01   +2.092684842570048e-01   +2.595301027867524e-01   +1.907595091541761e-01   +7.077323908727404e-02   -1.001034838050051e-01   +1.585996900903938e-01   -2.984325838361426e-01   +1.521538393820991e-01   -4.832563457487592e-01   -4.453158445355716e-01; +1.756471673267557e-02   -4.369079124594216e-01   -1.135381371979038e-01   +4.318434167851471e-01   +4.856756158712948e-01   +9.005546279371066e-01   +5.175522271776212e-01   +6.735715913602750e-01   +2.727528865368270e-01   +4.197954972234567e-01   -7.898248025258200e-02   +3.463979437516395e-01   +7.490566204424097e-02   +5.056047337833814e-01   +1.210872392925284e-02   +9.170222700471048e-02; +4.550914587226674e-01   +2.244387980684970e-02   +2.497398475139386e-01   +8.173040885563720e-01   +7.447274054812202e-01   +2.470576033807068e-02   -8.339672917253593e-02   -1.640418767987470e-01   +4.219932433128671e-01   +4.108889844615732e-02   -1.359461605091648e-02   -2.841410482660350e-01   -8.446216484990401e-02   -3.045395992157946e-01   -4.114053146151065e-01   +3.497672709686295e-01; -9.604734208272087e-02   -4.298211542475493e-02   -1.981815441256355e-01   +3.187513032996184e-01   +3.965539585406156e-01   +1.981073512950131e-02   +9.416675374792587e-02   +7.762682632194620e-02   +5.087433263424045e-01   +2.629411983098003e-01   +3.899902570452951e-01   +3.501617855976867e-01   -3.780356505665050e-01   +4.344281511166104e-02   -5.149549784183091e-01   +2.237887041236437e-01; +2.046058100570843e-02   +2.446135119593147e-01   +2.652649525179425e-01   -2.360890480064150e-01   -2.547238368485577e-01   -3.521760307716213e-01   +9.015339741321451e-02   +6.821897158818379e-01   +2.876477665603219e-01   +6.110539430869437e-01   +5.386016577877404e-01   +7.425013281394939e-02   -3.727415018764885e-01   +4.882584303528861e-01   +2.346957543174284e-01   +1.830665688488555e-01; +3.150445351607779e-01   +4.862759169289964e-01   +1.764821691319195e-01   -2.137825993367495e-01   +5.820534991212418e-01   +2.873341937515416e-01   +2.205809661812483e-01   -5.821747902555377e-02   +4.868897058485062e-01   +3.573420769229864e-01   +2.703885072672116e-01   +7.557514150567415e-01   +1.172717851178597e-01   +2.413616564041022e-01   -2.639682061460438e-02   -2.842628718883880e-02; +6.009088620480263e-02   +5.139041671098697e-01   +4.991665733155221e-01   -2.840153568596602e-01   +1.133621914324019e-02   +1.130323279236367e-01   +4.905508456263753e-01   -1.352412298701219e-01   -3.248080870360947e-01   +1.818184939555188e-01   +1.067217381179243e-01   -1.789702953693517e-01   -3.766365412836719e-01   +1.894097216456291e-01   +3.729964512398949e-01   +5.804236245162444e-01];
L2I_L1I_iGABA_netcon = [-6.319890841525124e-01   -1.900838834571520e-01   -5.048660349462447e-02   -2.487574122683727e-01   +1.871475012424636e-01   -2.752206312647861e-01   +6.167650091945885e-01   +3.565737130768943e-01; +8.921488045015050e-02   +3.979556905322466e-02   +2.744449154573156e-01   +3.615111473640411e-01   -2.490524785498645e-01   +1.961905879339880e-02   -2.231292299322947e-01   -1.784941350694017e-01; -7.322680691683497e-02   +3.668507878022151e-01   +6.228659982056206e-01   -2.385301073965322e-02   -1.203118579875327e-01   +7.912785212220509e-02   +5.313208346139349e-01   +2.346296800336337e-01; +1.511305261882441e-01   +6.569295181610083e-02   -2.667453943415223e-01   -2.800996101722569e-01   +2.298042374434699e-02   -2.852536951934813e-01   +1.880535124171102e-01   -6.045852107721279e-02; +1.907913594621563e-01   +2.156712045732671e-01   +7.479658845220072e-01   -4.001253941485519e-01   -6.411459994493963e-02   +1.407946623229601e-01   +3.978124009821272e-01   +4.210236839325618e-01; +1.154860481877215e-01   +3.878024044112413e-01   +3.935159508308335e-01   -3.438775831553104e-01   -1.146544874008416e-01   +4.374066634125298e-01   +4.402968714888025e-01   +2.223453616470178e-01; +4.744155367102298e-01   +3.642138124151172e-01   +1.564586518752365e-01   +2.023059752657099e-01   -7.417373950158176e-02   -1.292649222231292e-01   -1.799725014787552e-01   +4.228874843531281e-01; -8.686458860065113e-02   +1.301431227697594e-01   +2.456634885616080e-01   +2.161200251641349e-01   +4.850252935432679e-01   +4.299692269076069e-01   -5.164945071749237e-01   +6.905259110310406e-01; +2.800848993100773e-01   +2.173103744567307e-02   +1.540941628439584e-01   +2.725272744674895e-01   +9.573839226219016e-02   -4.222598368791991e-03   +2.262601318437245e-01   +4.716894778778513e-02; -9.992851624987013e-02   +3.729507893117284e-01   +8.424889610028841e-02   +9.836740650233319e-02   -1.036762788304361e-01   +2.015382301983442e-01   -4.041099412472023e-01   +4.878687416392060e-01; +8.387475703339431e-02   +1.731599499671616e-01   +3.980789738935422e-01   -1.828741306098690e-01   -1.175972312053350e-02   -8.275721722342344e-02   -3.251577490445118e-01   +1.211388627183788e-01; -4.902286455409829e-02   -3.167326913241415e-01   +5.919093101805458e-01   +1.829461086795115e-01   -8.354458202866891e-02   -7.780969066837556e-02   +1.449478890915549e-01   -3.409043635097523e-01; +4.547731424089888e-01   +4.059958180381079e-02   -5.306559227162859e-02   +1.951671530753822e-01   +6.258442425875785e-01   +5.683404575821367e-02   +2.180494029377916e-01   +5.219397356536317e-01; +2.839699697239702e-01   -7.710189374652913e-02   +4.814738694907638e-01   +2.434026181547660e-02   +2.212132258556692e-01   -1.526215227924406e-02   +3.146793600504122e-01   -1.788735116472366e-01; -1.289826165111574e-01   +1.974004310958805e-01   +3.761831988858491e-01   +4.246767480463682e-01   -1.119016676080077e-01   +4.047239922556028e-02   +3.331892141334638e-01   +5.237714044506676e-01; +3.628441132822979e-01   +1.912144437138132e-01   +7.611042725571933e-02   +1.443119759490315e-01   +2.643966659650434e-01   +3.206071052371722e-01   -5.229500985144574e-01   +2.716547986819114e-01];
L1I_L2I_iGABA_netcon = [+5.502460252506323e-01   +6.445200675100599e-01   -3.373242747378425e-01   +5.922855222301929e-01   -3.654004125213888e-01   +5.910850810491408e-01   +4.076844391542757e-02   -2.793034454576558e-02   -2.265112016390087e-01   +2.713459474460327e-01   -1.463403412629971e-01   -3.430196271659843e-01   +3.171548430873689e-01   +2.765595197467829e-01   +1.888646660399466e-01   -7.986797369054507e-02; -3.442007125923001e-01   +4.601601613059146e-01   +3.055199667818568e-01   +1.653438825733233e-01   -2.542620432373112e-01   -3.905279369379810e-02   +5.084866535605867e-02   +2.032206508192474e-02   -2.698707356027916e-01   +4.728867571504728e-01   -3.447591728503732e-01   +4.821629619184448e-02   +5.370191823189951e-01   +3.249423044771916e-01   +7.168828233791746e-02   +1.469506035517913e-01; +3.353746311333539e-01   +4.199324988072012e-01   +6.662807066653831e-02   +6.476170774815285e-01   +4.031283544295104e-01   +3.314222155021351e-01   +1.327311805947812e-01   -1.993036983711839e-01   +3.385897895495310e-02   -1.033820462631171e-01   -3.172377183659653e-01   +2.751325637261203e-01   +6.394979078124159e-02   +5.052193664411183e-01   +3.091466143090482e-02   +9.913928279451772e-02; +1.873260305012858e-01   -2.714170936043032e-01   +1.028108539275693e-03   +1.435924612700233e-01   +6.408082191075838e-01   +3.421193079667846e-01   +1.817894760199397e-01   -1.674894939148727e-01   +5.812182614564403e-01   -2.662520123794211e-01   -1.671005043120866e-01   -2.259933388664934e-01   -3.768637602535212e-02   -2.414727258024146e-01   +3.580366238404539e-01   -2.078477175968812e-01; -2.294741565587183e-01   +6.198394340981610e-01   +3.497719127272345e-01   +2.749516553494717e-02   -7.240630379310656e-02   -5.440696209749653e-02   +1.705321755322436e-01   +1.754075814621122e-01   +1.299323691612329e-01   -2.423303329615011e-01   +6.726010603046096e-01   +2.361807108127223e-01   +1.483066283795028e-01   +4.000506233635284e-01   -5.103029715373560e-02   +3.158996063651447e-01; +3.731023381038771e-01   -1.741248905909350e-01   -1.302705105178587e-01   +1.911163843807218e-01   +4.064785031918601e-02   +1.465344412275839e-01   -7.343525241944734e-02   +6.170062064002115e-01   +1.262813467255801e-01   +3.655349496538278e-01   -2.303331480577468e-01   +7.298145060030535e-02   -1.168321638727043e-01   -2.714402690641421e-01   +2.610183620709828e-01   -2.294312556095721e-01; -3.320694213421963e-02   -1.283838722860590e-01   +8.702526880738243e-02   +1.753834554979361e-01   +5.228598203082094e-02   +1.247677165762260e-01   -1.937899647227850e-01   +1.819867660268970e-01   +3.874404837812337e-01   -1.416013384661144e-02   +2.420831489596302e-01   +3.331063133780822e-01   -2.871569174875731e-01   +4.328853864367797e-01   -3.528873136289730e-01   -4.090901583980826e-01; +3.922120842636985e-01   +1.000056475873446e-01   +2.294462333453918e-01   -2.099819651009053e-01   +2.411284549936279e-01   -1.532471514826826e-01   +3.597699731405168e-03   +1.047147103308871e-01   +3.128972146667793e-01   +1.296245167744582e-01   +8.968161803864932e-02   +3.222610435639681e-01   +1.999242517330556e-01   +2.465635143758906e-01   +5.960355018157075e-01   +1.760695265947570e-01];
L2E_L1E_iAMPA_netcon = [-1.187837022328595e-01   +3.538374840570940e-01   +5.756194359578646e-01   -2.638763339309806e-01   +1.808057330820669e-01   -5.678605394582042e-02   +3.663175173824460e-01   -1.388579918992028e-01; +9.079130487230377e-02   -4.049648870759938e-01   +3.323248215996844e-01   +2.227487717251279e-01   +4.539884269195852e-02   +4.621063941822072e-01   -3.663784681725905e-02   +5.253047275196164e-01; +3.657551320823434e-01   +3.570549630887213e-01   -3.328222143903839e-02   -4.886897751385986e-01   +8.625211339112110e-02   -2.749403644976965e-02   +3.562936020263374e-01   +2.733374512125613e-01; -4.221371734317707e-01   +3.855039087089056e-01   +2.042454345232939e-01   -3.960337758713710e-01   +3.357881681569550e-01   +2.955326593149979e-02   +1.981655610943475e-01   +3.091788183881827e-01; +1.635461229945004e-01   +5.684267057731569e-01   +1.274738903488951e-01   +3.862701867241631e-01   +1.055068601590360e-01   -2.519115677379342e-01   +3.034906581697522e-01   +3.918735838493491e-01; +3.452716927089690e-01   +1.749664292932009e-01   -4.576682477089417e-01   +4.442775139445810e-01   +7.115719245758645e-01   +6.218829083388315e-01   +1.833985116371894e-01   +2.435226787663338e-01; +8.377607588923724e-03   -9.459559731052780e-03   -4.284530270803301e-01   +2.839787506629354e-02   +7.267494769350270e-01   -1.564390928958587e-02   -2.461954503350906e-01   +4.006264508934684e-01; +4.001776262939064e-01   +1.281050930441639e-02   -4.239421712429700e-02   +1.843868732902620e-01   +1.547572525122135e-01   -5.616705114441983e-01   -1.509171510263080e-01   +5.261847838376211e-01; +9.367058434630521e-02   -4.728222102331011e-02   -1.931294956710160e-01   +2.033238455429461e-02   +4.710388192040343e-01   -2.705580029472539e-01   +5.049805206525141e-01   +3.158242028504774e-01; +3.005970217350300e-01   +3.052549661626178e-01   +5.937632169481804e-01   -3.949032955258028e-01   +6.879203027863906e-01   -1.819445680362210e-01   +4.578453645249537e-01   -1.088218898249404e-01; +3.943156250005347e-02   +9.049488391007655e-01   +4.657436623806856e-01   +4.407463143386492e-01   -2.117514690794543e-01   +3.007068557826248e-02   +6.127133622308348e-01   +5.500493844216454e-01; +3.472814578725657e-01   +2.529446401177251e-01   +2.941497932253299e-01   +1.636075191988675e-01   +5.132279557280411e-01   +3.317637232760803e-01   +2.788812172597219e-01   +2.510697843399602e-01; -9.711404908599358e-02   -1.790839336150989e-01   +8.106220951605446e-01   +3.333165839650193e-01   -1.727913023123285e-01   +1.986768380244934e-01   +5.806950844678803e-01   -2.836469768977211e-01; -2.668969064729823e-01   +3.374096881312014e-01   +3.124978858459654e-01   +2.309664892841733e-01   +2.894171014318256e-01   -1.358254378488720e-01   +8.508411786970433e-01   -3.096906302864860e-01; +4.043784527313203e-01   +1.346048260187699e-01   +5.456582717786884e-01   -2.140675735138070e-01   +6.822858784639449e-02   -9.580835511729924e-02   -1.676646816953271e-01   +3.210669078735499e-01; +1.990210413646881e-01   +1.488269697878950e-01   -3.419557591850653e-01   -2.190497595727917e-01   -3.748678356490181e-01   +3.793129250254322e-01   +6.299113801213854e-02   +4.904763795679692e-01];
L1E_L2E_iAMPA_netcon = [+5.696058873549958e-01   +4.609133607321639e-01   -9.365853576870198e-03   -8.702333611497282e-02   +5.348231258706728e-01   +4.140074010982410e-01   +4.090462384574180e-01   +1.586164714811801e-01   +4.078392981068859e-01   +4.981601902689410e-01   +4.260310336868227e-01   +5.403613729762961e-01   -6.437318357196842e-02   -2.649022374395167e-01   -6.542349217898033e-02   -2.134506558223869e-01; +3.190833106701776e-01   -3.899215409185117e-01   -1.680988693998785e-01   -8.724290710784294e-02   +6.662073828777531e-01   +5.040260475186290e-01   +5.033121656686998e-02   +3.659863785198468e-01   +2.895294923082894e-01   +1.735465430167932e-01   -3.699522485086168e-01   +4.740914826760244e-01   +6.987185826193271e-01   +5.197302621598904e-01   +3.134181861600368e-01   -3.506885409497128e-02; -4.325070231026725e-01   -1.141198551061319e-01   -3.694703208350743e-01   +2.677171444922141e-01   +3.723563780416527e-01   +4.800543481831773e-02   -7.874079681311133e-02   +5.787200269486450e-01   +1.579374163920748e-01   +4.598742140454481e-01   -2.386015658656641e-01   +3.296446941145919e-01   +2.019513196665034e-01   +2.436023402262416e-01   +1.841612673687322e-01   +7.968623042680205e-02; -2.073827259345148e-01   -2.062864126435734e-01   +5.465283192655629e-03   +2.652936795852656e-01   +3.019502896305567e-01   +6.869170425386695e-02   +1.201000413233374e-02   +5.906394691734353e-01   -3.089372691297383e-01   +6.808533331985205e-01   +6.784791929459880e-02   +9.140619837185344e-02   -4.960745713797880e-01   +5.490783177977315e-01   -3.021899415606611e-01   -3.350995270036526e-01; -9.145757586401737e-03   +1.184842667786830e-01   -1.401280762641691e-01   -4.807276990651357e-01   -1.165109558491741e-01   +3.938986392177849e-01   -2.437846874437000e-01   -4.660970729270156e-02   +1.204842117358356e-01   -2.242672413405382e-02   +1.664755464845538e-02   -4.074231395027780e-01   +3.563224316957920e-01   +4.392512492393327e-02   +6.583542767669720e-01   -1.925043444991366e-01; +5.399649907856133e-01   +3.183255711386347e-01   +7.555466752380571e-01   -2.115034238470942e-01   +1.753030012497240e-01   +4.742896049928462e-02   -4.958756045549019e-02   +2.572641705906835e-01   +2.146373299119996e-01   -1.042216910875288e-01   -4.517940623959202e-02   +2.132090269353474e-01   +6.454755679983575e-01   +2.909757855913636e-01   -2.198871781767658e-01   -1.175686327465049e-01; +3.781605766358485e-01   +4.311240959777470e-01   +1.234772727955777e-01   +4.956561566812051e-01   -5.811091658609426e-02   +4.739802251086675e-02   -2.438289402188902e-01   +3.601601784704845e-01   -7.648131916050213e-02   -8.998025599426780e-02   +9.110975826078942e-03   -1.297617527363891e-01   -2.625728366192775e-01   +4.932087910876157e-01   -1.323361697278935e-01   -6.229540811738961e-02; +1.514038992681525e-01   +1.593322009651410e-01   -8.856968311836728e-02   +2.633106072311177e-01   +2.684852786226030e-05   -2.927663004192755e-01   +3.863014364431728e-01   -4.621953948837812e-03   +1.789182723439453e-01   +1.861570938485420e-01   +2.059642196615029e-01   -2.047177411159918e-01   -1.166067336003117e-01   -1.625031859903105e-01   +1.839703318532606e-01   +3.962801535244288e-02];
L2I_L2E_iAMPA_netcon = [+3.353556866343342e-01   -4.847408389235685e-03   +6.625646317120676e-01   +8.004752216004206e-02   +1.540402827664766e-02   +4.375905619503753e-01   +6.275802909526689e-01   +5.535345850695662e-01; +6.012232997454774e-01   +6.040200109345149e-01   +1.784203707474868e-01   +1.787507384464095e-01   +2.100867909377612e-01   -2.301947074874504e-01   +5.505472727578718e-02   +2.159198063844750e-01; +2.191093386218351e-01   +2.076314948752595e-01   -2.163306396309011e-01   +1.034983305662900e-01   +2.852245754541501e-01   +1.073709535613350e-01   +3.402861159662517e-01   +4.224266901311018e-01; +4.083245611720884e-01   +1.022161986580687e-01   +2.789400922967426e-01   +3.074373235814282e-01   +1.418476245366486e-01   -4.072979079103330e-02   -4.179666584666950e-01   +2.945050207552640e-01; -3.615642792210595e-01   +4.664789112877304e-01   +2.434448056774924e-01   +2.234182302955271e-01   -1.283891646736464e-01   +2.116796598577602e-01   +6.382121962399140e-01   +3.701727683398344e-01; +7.024451734937909e-02   +1.907950353012743e-01   +3.723096194329911e-01   -2.030093390794102e-01   +9.046857037471251e-02   +2.184975277031114e-01   +2.139352872788837e-01   -5.166247802670657e-01; +2.173966813571750e-01   +5.325399052971796e-01   +1.141802370427162e-01   -4.165042238560697e-02   +1.324574465973887e-01   +9.149994270197620e-02   +6.552433107091116e-02   +1.109501718491670e-02; +7.498603024125687e-02   -3.127543865957561e-01   -4.680070082835180e-02   -1.389513530197462e-01   +1.604175403565777e-02   -2.643652120491224e-01   -4.222674927320518e-01   -1.720109121494225e-01];
L2E_L2I_iGABA_netcon = [+2.394510085092017e-01   -2.999623280853513e-01   +7.824206591595673e-02   +2.395571945059286e-01   -5.331080633319325e-02   +1.483511019932692e-01   +2.739989529053966e-01   -4.294649869608751e-02; +4.512954864758137e-01   +1.803149830382836e-01   +4.170078308427615e-02   +9.450644142844253e-02   +5.985416193706589e-01   +3.822732873219528e-01   -2.633166372936175e-01   +6.468772340663267e-01; +2.275447461169235e-01   +4.827754323952850e-01   +9.747331292620030e-02   +5.860262618078768e-02   +4.169130597965450e-01   -2.425555006383644e-01   +2.603404548269139e-02   +1.774870430912117e-01; -4.328653759493117e-01   -5.301395520591823e-02   +6.715417091692597e-01   +7.451533188396549e-02   +1.886552662546864e-01   +1.853410673474643e-02   +2.853097175900218e-01   +8.172697648509372e-02; +2.004512142285017e-01   -4.381248392976456e-01   +3.374547321296342e-03   +2.300655086222927e-01   +4.052961261067717e-03   -1.228813588405415e-01   +7.676989299307466e-01   +1.121432768180448e-01; +4.930909535111612e-01   +6.110257335189610e-02   +2.260240224458467e-01   -1.601929111349890e-01   +2.290238874204050e-01   -3.674557503935755e-02   -1.882979113689050e-01   +3.597598608506170e-01; +1.393658928770089e-01   +2.832462926989071e-01   -5.770977087441034e-02   +4.320817962908425e-01   -1.078701903641680e-01   +4.041874729151774e-01   +9.745072013980338e-03   -2.159084358294580e-01; +5.504298628658457e-02   +1.536793686606697e-01   +4.449593234788863e-01   -7.538894157141600e-02   +4.764803070437562e-01   +1.253980668509803e-01   -7.768444760275563e-02   +5.309268806532728e-02];
L3E_L2E_iAMPA_netcon = [+7.552307180376405e-01   +2.426010924071736e-01   +8.828759567751410e-01   +1.695359710212441e-01   +1.751907771903614e-01   +2.942839705641092e-01   -2.606439822994239e-01   +4.402089125937805e-01   +3.576907134619713e-01   -2.896303998024401e-01   +1.597750404175424e-01   -1.465235965333635e-01; +4.679811565188535e-01   +3.650114044829136e-01   +7.135242099477811e-01   +5.959458310545886e-01   -9.790959111135801e-02   +2.648313311409834e-01   +3.551953124669401e-01   -6.299817599158299e-03   -5.178372303670774e-02   +4.471026694851823e-01   +4.417922982018604e-01   -1.981446811286207e-01; +3.301892361490125e-01   +4.200369224051507e-01   +5.429937268928184e-01   +7.350351916843834e-02   -4.629176715192704e-02   -6.681464368917564e-02   +3.867115841285672e-01   +2.199291554221425e-01   -4.732899823555969e-01   +1.665321662913285e-01   +3.683694758256502e-01   -2.449575159074886e-01; +1.238940028915909e-01   +2.848360007469044e-01   +5.986241634643412e-01   +5.768698181175853e-01   +5.001474808809623e-01   +4.967627719934652e-01   +1.071246886676751e-01   -4.196382552130381e-02   +6.110782515481362e-01   +1.261095672726828e-01   -1.594565250523538e-01   -1.599608148494136e-01; +2.839949341891382e-01   +2.677140284561026e-02   -1.702987430697126e-01   +3.772582803706880e-01   -1.681692943613388e-01   +3.499955951623636e-01   +3.900921865932481e-01   +7.202422445801521e-02   +1.496307306417672e-01   -2.835414038848967e-01   +3.289184948585536e-01   +1.480290315905974e-01; +5.209670739542012e-01   +3.181070930710274e-01   +2.130292353028316e-01   +1.896515526643825e-01   +6.087165463201037e-01   +5.512486359122482e-01   -6.027326040874995e-02   +2.521796955133577e-01   +6.808175711989380e-01   +1.083194895533540e-02   +5.915726129079125e-01   +6.334747113714994e-01; -1.335870792572347e-01   -1.011334744550496e-01   +2.378095211287826e-01   +1.033801665539710e-01   +9.940650348321693e-02   +1.793029078586489e-01   +1.587132453699736e-01   -1.667692684607440e-01   -2.597609568817890e-01   +2.527974392838097e-01   +2.305553079859657e-01   +1.706125552064069e-01; +4.986483538941409e-01   -1.026898444612425e-01   +7.111500841536454e-01   -2.801604442108199e-01   -2.345141636513609e-01   +3.817422323777249e-01   -3.200348595338084e-01   -6.509891526681064e-02   +5.373410316481747e-02   -1.322315917124967e-01   +4.403707545666796e-01   -3.065806056173118e-01];
L3I_L2I_iGABA_netcon = [-1.951882072265576e-01   +3.040321962173784e-01   -3.906259684455923e-01   +1.347773900905191e-01   -3.831901049395020e-01   +3.186496663837347e-01   -2.708572986210441e-01   +1.999516294826196e-01   +2.777977559422984e-01   +2.341756342219581e-01   -2.135081787406766e-01   +5.223693278927589e-01; +2.710077901262019e-01   -6.762659816516672e-02   +7.343813196519633e-01   -2.467981577373607e-01   +5.149569057496772e-01   +3.956220620626695e-01   +3.373938362617421e-01   -1.156567750082656e-01   +2.781521801154998e-01   +3.848076096362487e-01   +3.772788964382707e-01   -2.619823901010671e-01; -1.156806871543102e-02   +2.104846453701706e-01   +5.103557158593773e-01   +3.917611533067101e-01   +1.045599221891101e-01   +2.541553978517033e-01   +1.169019684137815e-01   +3.905652626309554e-01   +3.325181188030800e-01   -4.314936897924216e-02   +2.394936933672715e-01   -1.438881639330936e-01; -3.720493313022817e-01   +5.038656119115701e-01   -3.171153591395515e-02   +5.140090228598363e-01   -3.087092701359657e-01   +2.060389378392644e-02   +2.541338938879117e-01   +1.049039081076235e-01   +2.343156848145311e-01   -4.036498397135183e-02   +4.442912145528539e-01   +8.182839664276247e-02; -1.393993782273661e-01   +6.709351371116393e-01   +3.986204899215027e-01   -5.863691517040998e-02   -1.354608561777828e-01   +4.395871274205101e-01   -8.200686214777558e-02   +1.589923605694967e-01   +5.273855083798997e-01   +2.081791814521849e-01   +2.531563988958621e-01   +5.947693651161056e-03; +2.830763061630347e-02   +1.938870221390606e-01   -1.946355839732127e-01   +8.199738555043051e-02   +2.836668732313776e-01   +4.204199448811298e-01   +5.423576409378930e-01   -3.621672403938845e-01   +1.916114916887771e-01   +5.067549454763300e-01   +6.167553893047645e-02   +5.538486260287786e-01; +3.208481548296340e-01   -4.151950825360633e-02   -2.426250323662126e-01   +1.935820963024593e-01   +7.555439689414788e-02   -1.140579124690528e-01   +4.028314961706504e-01   +4.405341181946393e-01   +2.280846309578714e-01   +6.099639750223841e-01   -3.672293573485836e-01   +1.051966060430588e-01; +5.468273010797328e-01   -1.193656737452789e-01   -3.612093851808622e-02   -1.924742160656473e-01   +4.249448661386488e-01   +4.881828152960999e-01   +1.206039737609600e-01   -6.514161276678668e-02   -2.165306434034353e-02   -4.338955955564308e-01   +3.140778507496271e-01   -1.617468523809097e-01];
L2E_L3E_iAMPA_netcon = [+3.422273879428413e-02   +1.437382184653300e-01   +2.643573207747566e-01   +7.716630979745730e-01   +3.039430772552072e-01   -1.591210595919466e-01   +2.960654792091212e-02   +2.268222433710545e-01; +2.347852751932131e-01   +3.814374616953802e-01   +4.735466879947554e-01   -4.889585954716731e-04   +4.362971828695342e-01   +1.320150599464405e-01   -4.207285321226186e-01   +3.894841703135855e-01; +1.382020807405777e-01   -2.978603033011611e-01   +4.278234201217632e-03   +7.587116988570148e-01   +5.773588605764909e-02   +1.725233120579342e-01   +1.081541746207657e-01   +1.503509243854191e-01; -1.787829492070303e-02   -3.519698462342714e-02   -1.782063960274515e-01   -3.943783885895292e-01   +1.036423109730727e-01   +1.318196663554789e-02   +1.057912697696520e-01   +1.410918556451451e-01; +5.013790970252878e-01   +2.006045902074814e-01   -7.691024001166205e-02   +1.698336834363031e-01   +6.256820931618459e-01   +2.212532045405719e-01   +5.115451019453741e-01   +6.589323141519446e-01; +2.144469147320793e-01   -1.304923595186755e-01   +1.951022317862384e-01   +6.423251023588316e-01   -1.797649582284342e-01   +2.543061833839109e-01   +2.252038243435467e-01   -6.782966025772855e-02; -3.609987708524380e-01   -1.492988403341046e-01   -2.893601869826984e-01   -5.326661277656818e-02   +3.681899357125832e-01   -2.013552333093971e-01   +3.365483731367849e-02   -8.326311578788319e-02; +9.314340553872551e-02   +1.721524029844477e-01   +6.996430424581260e-01   +3.449590958588977e-01   -1.190396388154424e-02   +2.797324769890149e-01   +1.660425942584322e-01   +4.376041156584219e-01; -1.419165188167093e-02   +3.458987023963468e-01   +2.682848080977898e-01   +1.859557345377717e-01   +4.623536974655020e-01   -1.053234745143646e-01   +4.043322592090502e-01   -2.222535385810911e-01; +2.019375532033863e-01   +1.902926954091139e-01   +4.153335688508933e-01   +5.989093270474226e-02   -2.665958711869915e-01   -3.036431316559003e-01   +1.438325641257012e-01   -8.982164801766487e-02; +7.445183330096814e-01   -3.740040688862343e-01   -2.369180700559284e-01   +3.560926963289898e-02   +8.163541501293323e-02   +4.347976244130162e-01   -2.075060552660125e-01   +2.957579123855973e-01; -1.973895788779668e-01   +5.102412367615393e-01   +2.290388289944407e-01   -4.009327750860942e-02   +1.818750405849079e-01   +4.687749177486258e-01   +1.444479803453382e-01   +1.468314842636693e-01];
L2I_L3I_iGABA_netcon = [+1.892298161558521e-01   +6.181772851214429e-01   +9.712643364544118e-02   +2.994133538537478e-01   +5.504401208882903e-03   +2.799629836044886e-02   +1.056399564898637e-01   +6.047666238865185e-01; -1.291053254589483e-01   -5.536609416347203e-01   +5.300793896360227e-01   +7.184557810644103e-01   +2.173898375169128e-01   +1.774566474192539e-01   +1.431846334278185e-01   -1.446736803928153e-01; -1.329007734204321e-01   +4.440280245382324e-01   +6.465338845199213e-01   +4.946224428274579e-01   +3.911172920297267e-01   +2.539837871392843e-02   -4.070109250111913e-01   +2.717045721088235e-01; +1.005552350303999e-01   +2.145271273403231e-01   +4.913420105800895e-02   +1.646533824064893e-02   +5.899031969865545e-01   -1.641005638565389e-01   +3.668687016279001e-01   -2.699307264789143e-01; +1.965764400904917e-01   +7.641990535742516e-01   +8.104102683518521e-04   -4.369415548774798e-01   +8.790637202094498e-01   +3.218729594836824e-01   -2.222448387698739e-01   -9.067198245075601e-02; -4.203467723887760e-02   +8.856010083044014e-01   -3.591906062537594e-01   -2.386058284120813e-01   +8.348626611190687e-01   -4.498344056691466e-01   +5.934888081664451e-01   +4.927519535728825e-01; +7.024804669052907e-02   +4.809304404905939e-01   +3.915798235877762e-01   -3.842631272601247e-01   +5.722670568810830e-01   +2.562433151491311e-02   -4.716644195407503e-02   +5.724350037785448e-01; +3.523112981307980e-01   +3.038185434654505e-01   +2.361058944984847e-01   +6.358950236889849e-01   +1.651690614870362e-01   +5.601483883825427e-01   -4.517458081111714e-01   -1.667000896786133e-02; +5.714917328774169e-01   +3.252136355990610e-01   +2.440434255618034e-01   +3.076574635579111e-01   -2.881925274297225e-01   +8.356935346576666e-01   +6.447443633992531e-01   +2.686129467704131e-01; +5.699631107970911e-01   -4.692751511486127e-01   -5.962768583735040e-03   +4.884695229900292e-01   +5.843760209351729e-01   +3.404237960962815e-01   +2.470949104991933e-01   +9.776685567906834e-02; +6.470534583051724e-01   -1.395833021804735e-01   +1.901293040513127e-01   +1.418531488468935e-01   +2.283256504945463e-02   +2.750389533090212e-02   +7.495041008167411e-02   -2.650122415820595e-01; -2.192864512835117e-01   -2.587228853318777e-01   +2.664136575194863e-01   +4.951759775533133e-01   +2.576951787669190e-01   +2.473937869024430e-01   -2.464571418154983e-01   +6.027717139987809e-01];
L3I_L3E_iAMPA_netcon = [+5.167693688965459e-01   +3.884474354320657e-01   +2.555469743619350e-01   -2.779830543283492e-01   +1.731775218185397e-01   -1.011013871582826e-01   +1.107439589502335e-01   +2.051099330635689e-02   -9.651284821145426e-03   -2.807685957329247e-01   -1.021544715588123e-01   -5.073614506464703e-02; +3.623503144738551e-01   +6.444276739812749e-01   +7.021953619260667e-01   -9.074707236306193e-02   +4.300279100948346e-01   +2.392957428669285e-01   -3.053231571437989e-01   -6.025289295166580e-02   -3.216443879498140e-01   -5.067466207336451e-01   -1.951224673546964e-01   +7.881349809375757e-03; -1.574510077450501e-01   +1.070584354831919e-02   -3.202126021731295e-01   +2.446872741725625e-02   +3.802280089143674e-01   +5.195506995890298e-01   +1.682443982654425e-01   +5.525324573516289e-01   -1.049353358706108e-01   +3.028143445016652e-01   +2.869553612963747e-01   +1.681198360457316e-01; -1.096015439720111e-01   +2.909203417397568e-01   -1.108099070635613e-01   -2.420957905215605e-01   +2.429318574635877e-01   -1.082592146737963e-01   +1.448786992184628e-01   +2.917777837923459e-01   +7.029763886559496e-01   -2.081822419152950e-01   +4.531322616896018e-02   +2.681816128711427e-01; +3.153982070616720e-01   +7.378580421339501e-03   +2.387828223594699e-01   +1.579092981364023e-01   -1.167495548208643e-01   +6.769439856676747e-02   +6.255087596595264e-02   -5.388567207283717e-01   +2.832893808228629e-01   +2.882808388078035e-01   -2.548963179778588e-01   +5.280485207389005e-01; +4.204943926472516e-01   +3.462607511807731e-01   -1.379648926591129e-01   +5.164711652946553e-01   +9.679453061207914e-02   +1.915291724861625e-01   +3.240403817539378e-01   +5.810352874158123e-01   -1.586520429331694e-01   +2.078682334692067e-02   +2.779147479239815e-01   -7.773241725787151e-02; +9.168559199377901e-01   +1.136428292801057e-01   +4.159083797496257e-01   +1.935537630410367e-01   -5.410598949197248e-02   +2.992481673476577e-01   +1.076612759437688e-01   +6.914511967101847e-01   -9.559824161906801e-02   +1.377409738487730e-01   +3.632752168750044e-01   +4.140967963410760e-02; +6.360607922355057e-01   -2.504068935071795e-01   -3.182820763942256e-01   +1.026749824708205e-01   +1.951686272299665e-01   -8.446875254662924e-02   +3.211770161153933e-01   +2.521518545955078e-01   -2.902508818007514e-01   +1.230075498357651e-01   +1.856862437869658e-01   +1.568789067523318e-01; +3.940350710399634e-01   -6.223135054583978e-02   +1.100147252180800e-01   +2.077901787099036e-01   +3.182678693177592e-01   -1.711012801997984e-01   +3.120575017419542e-01   -2.761834886554260e-01   +4.177321778400445e-01   +4.190159785755785e-01   +4.306486318451442e-01   +4.639861526166760e-01; -1.002482731307883e-02   +3.408707801222002e-01   -3.663317951192689e-01   +4.570104546407589e-01   -1.070153780919458e-01   +1.840757494157106e-01   -3.175308279871062e-01   -2.751047209309074e-01   +2.800168423380208e-01   -3.105801304487246e-02   +4.247899434149187e-01   +4.034045749886060e-01; +5.165144371592680e-02   +3.565097439173511e-01   -1.059412758629631e-01   +1.977438626177107e-01   +2.528796313418418e-01   +5.260661741063368e-01   +5.292051078174466e-01   +1.568932484804685e-01   +9.982953849431063e-02   -1.755803006895541e-01   +1.604773108591339e-01   +5.433858788903115e-01; -1.494461778782772e-01   +6.281277229789213e-01   +2.630435661650687e-01   +2.924820525763024e-01   +1.238985814951847e-01   +3.831171804342534e-01   +3.640951259107926e-01   +2.365104403571558e-01   +3.222308327153899e-01   +3.781507432613139e-01   -9.718539644294158e-03   +4.953550453460084e-02];
L3E_L3I_iGABA_netcon = [-1.656869101229681e-02   +1.344815519127113e-01   -5.411780989257056e-02   +1.879194467883646e-01   +1.888988032909990e-01   +7.916925648367543e-02   +2.432935864799184e-01   +6.897619647933273e-01   -2.381577912641909e-01   +3.138959195497456e-01   -1.859577735715314e-01   -2.690282512225957e-01; +5.179566342935162e-01   +5.802790141712508e-01   -4.752708992367884e-03   +4.116903858295302e-02   -1.751291519416351e-01   +4.312342362985249e-01   +1.428296541743095e-01   -2.128742398945103e-01   +5.661236288186376e-01   -6.713214537491596e-02   +6.677282322606845e-01   -9.404179070368293e-03; +7.737837419999658e-01   +2.277302338046007e-01   -1.204181687587274e-01   +1.264523293815653e-02   -1.083617438837228e-01   -3.822669722274787e-01   -2.208932696066997e-02   +4.988055135858467e-02   +3.866859279086968e-01   +9.770394475719302e-02   +1.261353398691815e-01   +1.623078818221475e-01; -9.279880587365849e-02   +4.832483263114626e-01   -2.712734695244911e-01   +2.393307126364362e-01   +8.285013194817858e-02   +5.591902411038205e-01   +1.767263467291823e-01   -2.211871653559108e-01   +6.759212649238241e-02   -2.709228104697466e-01   +2.939572025985663e-03   +1.163422494743300e-01; +6.037268334902061e-01   +7.595115974020050e-02   -2.765538659910829e-01   +1.107383359723545e-01   +2.664101696253513e-01   +1.066989484718049e-01   -4.530659653959310e-01   -4.640774217435533e-02   +3.338427957117900e-01   -6.255824724504806e-02   -6.654311871658695e-02   -2.195916527864596e-01; +1.242993018896822e-01   +1.374525875490920e-01   +4.196521454586410e-01   -2.940849619576835e-01   +1.527826293698743e-01   +1.457317426209421e-01   +1.271194779773808e-01   -1.571061902997019e-01   +1.661188897997078e-01   +3.176147102679290e-01   -9.150781248946736e-02   -1.576174752701279e-01; +2.097355867543530e-01   +3.224790682920708e-01   +5.423680784644085e-02   +1.189123198277579e-01   +1.105130970117019e-01   +6.556632496496818e-01   +4.499673498609506e-02   +1.802284466715443e-01   -3.036843353476849e-01   +2.353023501504992e-01   +3.740946402616062e-01   +2.983309342718088e-02; +3.325192658868849e-01   -2.739190895974743e-01   +4.502871017073343e-01   +3.869284938530306e-01   +4.173306550242337e-01   +1.496369915908828e-01   +5.927322280493860e-02   +5.261051205787022e-02   +2.093569873213653e-01   -3.080884975935404e-01   -4.427880166640726e-01   -1.021468744055047e-02; +4.311635321673921e-01   -1.390776409464568e-01   -2.043677947946813e-01   +2.660166295047263e-01   +1.368234811276166e-01   +2.424230920127812e-01   +1.700343470995534e-01   +6.555834999732053e-01   -7.484677286755007e-02   -2.553324734200174e-03   +4.741808587263265e-01   +1.955904987013136e-01; +4.710550008583304e-02   -2.030314927619825e-01   +3.001262681200170e-01   -2.770256269186198e-01   +6.604868570356829e-01   -1.274707416663987e-01   +1.750932383467718e-02   -3.510933720527611e-02   +3.603149303635693e-01   +1.214048078892231e-01   +4.001463078729677e-01   +3.593491595394244e-01; +4.933544474434378e-01   -7.009845056050323e-02   +1.736404624522234e-01   +2.530391872692923e-01   -3.860421525767559e-01   -3.579988387152747e-01   -2.911016767283984e-01   +5.606457183167264e-02   +2.323549749412723e-01   +1.650672003085553e-01   -1.832895550473180e-01   -1.481304801221087e-01; +2.614342742604726e-01   +2.114444421220879e-02   +5.515435149139688e-01   +1.773149670728421e-01   +5.317875883653650e-02   +4.480599276414702e-01   -7.171865537544667e-02   +3.038537730425484e-01   -2.853154092733943e-01   +2.452091044978429e-01   +2.271484650679213e-01   +1.750946201701278e-01];
L2E_Input1_iAMPA_netcon = [-2.072147467924238e-01   +6.998174624963444e-01   -2.393196444030979e-01   +1.375048534444882e-01   +2.601834737304659e-01   -2.441701202366959e-01   +4.843426945933510e-01   -2.872824672644779e-02];
L2I_Input2_iAMPA_netcon = [+7.304075284689136e-02   +1.498946249887339e-01   +9.356782195614233e-01   +1.458633376309926e-01   +3.887359512809082e-01   +1.929681601532146e-01   +1.153236576368572e-01   +3.638082539629434e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
