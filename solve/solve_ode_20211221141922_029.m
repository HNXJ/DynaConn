function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.400068601427455e-01   -2.189357382397141e-01   -3.340519416312746e-01   -2.017300261810760e-02   +1.798144133703269e-01   +1.398585317507641e-01   +3.837411412535393e-01   +2.842924802439281e-01   +2.720688752196543e-01   +3.898626886560140e-01   +2.034131738678317e-01   -3.325280255257802e-01   -6.956148081564334e-03   -3.279875776572626e-01   -1.627949683595449e-01   -2.319786344801528e-01; -3.186957280888886e-01   +4.681918016644689e-01   -5.966530352792145e-02   +1.902489693956162e-01   +2.186391748236395e-01   -3.527514899973220e-01   -8.135668605404289e-02   +7.259951973978017e-02   -3.049921171119830e-01   +1.937102871686049e-02   +1.993913208457930e-02   -4.747145847410781e-01   +2.161779142300401e-01   +1.774988680358096e-01   +4.661103750398635e-01   -8.199480215807370e-02; -1.266258666992907e-02   +5.446018754309642e-01   -4.492146994038507e-01   +9.599985274190426e-04   -2.006366590545010e-01   +7.569313241858015e-02   -4.937107416716113e-01   +2.920475505252925e-01   +6.701958205444004e-01   -3.205598047065505e-01   +1.150660679258290e-01   +4.548792238557717e-01   -1.763772770407084e-02   +3.915479112400042e-01   +9.314162110958639e-02   -7.528738732041879e-02; +6.531135777533389e-01   +5.854786797894929e-01   +1.358658832833752e-01   +3.181929804553324e-01   +1.211349611272282e-01   -3.861204315741964e-01   +2.497394407985693e-01   -1.538568807738955e-01   -1.626796943069800e-01   +4.289454449510849e-01   -5.661121403718963e-02   -3.844782224994571e-02   -4.248782829126408e-01   -5.532437384708508e-01   -4.172855965543620e-02   -4.405447356256795e-01; -3.861503467835454e-01   +5.605440875204597e-01   -2.129656750355448e-01   -3.106138233838014e-01   +4.464578407168557e-01   +6.906319611441609e-01   +9.674025527721987e-02   -2.023920681572385e-01   -6.933202630548073e-01   +4.623576834849904e-01   -2.441204507054234e-01   -3.170729389530146e-02   +1.840640559257427e-01   +1.685476620162065e-01   +4.898774326199316e-01   -1.663174213958399e-01; -3.498474822617385e-01   -4.728145118907292e-01   +3.427932398117552e-01   +8.323065284721987e-02   -3.824615891401541e-01   +3.980908897701204e-01   -8.725959954867067e-02   -2.598918557371758e-01   -4.372444403374537e-02   -4.138100739339607e-01   -1.399827820235582e-01   -5.368261426124047e-01   +3.282095819879719e-01   -3.137650440880431e-01   -1.729455641930600e-01   -2.280063147041138e-01; +3.200042976689180e-02   -2.245115540774789e-01   +1.766761365282531e-01   -2.193551045026229e-01   +9.099609889952945e-02   -1.887166519263495e-01   +1.603593947429800e-01   +7.162045310087863e-02   +4.013703198319429e-01   +4.769090649219959e-01   -4.170522319019991e-01   +7.581602474038500e-02   -2.282989299537000e-01   -2.522216978985691e-01   +2.395722948443159e-02   -4.818696580548698e-01; -8.944194740521558e-02   +1.062906405385754e-01   +8.954862909895367e-02   +6.299054276038611e-02   +4.578000061077034e-01   -2.281649931513568e-01   -4.101827804483122e-01   -1.642795252738727e-01   +2.937607323548225e-01   +7.426725419775496e-02   +2.647406260234421e-01   -1.965808598536758e-01   -4.191977739995879e-01   +8.216714044063429e-01   -8.451670476866823e-01   +6.895017526311868e-01; -4.499628666874690e-01   -8.825422622548772e-02   +1.246921770310883e-02   -2.726212352535410e-01   -1.817700769596187e-01   +4.548174501551351e-01   +5.055944274872106e-01   +1.254324471393027e-01   +6.699235835483885e-01   +1.741832737079241e-01   -2.813084170454366e-01   +1.077110847232526e-01   +5.097256531013681e-01   -4.713024410070547e-01   +3.375245225187659e-01   -2.169440377710609e-01; -3.675903179905236e-01   -3.847649807152222e-01   +4.344785719738244e-02   +7.598905614798231e-02   -3.896871541486360e-01   +3.905918300789429e-02   -6.764810393862491e-01   +4.714213438262040e-02   +6.956309157297282e-01   -1.685803170328700e-01   +1.404477621861009e-01   -4.563152691304572e-01   +1.788566338055852e-01   +1.312881929495667e-01   +1.468201429159539e-01   +5.761338717732861e-01; +1.275835525297242e-01   +1.529537670831584e-01   -1.717697011919006e-02   -1.187609504036098e-01   -2.715000843190998e-01   -1.966109593515031e-01   +5.971306046913413e-01   +4.792834499257073e-02   -6.389627999015446e-02   -1.321028633310483e-01   -2.020673917458802e-01   +1.435072468591960e-01   -7.372563795365348e-03   +3.741946833997292e-01   +4.503862340825423e-01   -4.085272624223634e-01; +4.556652856269756e-01   -2.411026454279996e-01   +4.686300447202464e-01   -1.554788744951876e-02   +6.587034072629278e-01   -5.377729455692022e-01   -4.147008421791200e-01   -3.847913288220512e-01   +1.438326077158311e-01   -8.909497656854241e-02   +4.581839236533212e-01   +6.326409927896801e-01   +1.275688841295705e-01   -4.099496997307612e-01   -4.734862043530816e-02   +4.039007801379989e-01; +5.595653464764795e-01   +4.970994857540094e-01   -5.110438102121014e-01   -5.598996941368435e-01   -3.433599797451313e-01   -3.551747012144666e-01   -9.485305856528578e-02   -2.964852067509313e-01   -4.076686175790518e-02   -1.620442613251785e-01   +2.116582688279471e-02   -7.654530768655929e-02   +4.710534625762863e-01   -1.920496127735762e-01   +3.768890398428302e-01   +2.212739862348674e-01; +5.020463326908433e-01   +1.368935641153608e-01   +3.686103799834746e-01   -2.833292457278449e-01   -1.160246741585030e-01   -6.352600354131865e-01   +4.262816140527753e-01   +2.363160973322467e-01   -6.720324866656135e-01   -3.419250365409110e-01   -4.714081434104566e-01   -4.444032038528466e-01   +1.204499165474586e-01   +3.281620087916388e-02   +4.093463723184624e-01   +1.642231048384002e-02; -1.972279187294560e-01   -2.777208842965131e-01   -2.431996450071957e-01   +4.138579315656845e-01   -9.852457301789991e-03   +2.080393901345998e-01   +8.695099936478465e-02   -2.215903864335076e-01   -4.159609946550678e-01   -1.747624803378118e-01   -9.801726757305841e-02   +3.055244689466345e-01   -2.451257613067803e-01   +4.205093762260058e-01   -4.481173664039618e-01   -4.123955655433152e-01; +5.237147958639422e-01   +5.687604138251301e-02   +1.220237779805158e-01   -1.081646631280295e-01   +4.096518960554035e-01   -3.608700969654201e-01   -2.909408327483440e-01   -2.183574827276997e-01   -1.930230791833105e-01   -1.629551710387016e-01   -1.000518077220969e-01   +2.756146165161414e-01   -1.088200202874398e-01   -6.868410104938316e-01   -1.160808104394416e-01   +1.285003140200479e-01];
L1E_L1I_iGABA_netcon = [+1.435340787956192e-01   +3.499592166528784e-02   +2.045658876611157e-01   -3.638183760027469e-01   +1.747722827893305e-01   -3.628355973901253e-01   +1.219928973892012e-01   +6.929898768979207e-01   +1.257726349493467e-01   +7.420433842393009e-02   -3.968826612403310e-01   +5.431784807990930e-01   +1.563983519768303e-01   -6.299535850682142e-02   -6.717616640810796e-02   -2.359341394777142e-01; +1.055251142463386e-01   +6.574198520404320e-01   -6.286446634674850e-02   +8.971484051561200e-01   -1.258827080940829e-01   +4.527358013958382e-02   -2.519149556965893e-01   -2.642086524988805e-01   +5.752249907556963e-01   -1.498861223109255e-02   -5.455589630509156e-02   +4.205851158070924e-01   +3.745280472067118e-01   +7.957292186534452e-02   -3.217475830390235e-01   -5.949283113631665e-01; -1.397401945771126e-01   -4.997298324637454e-01   +3.799309722359585e-01   -3.556001504350761e-02   +2.246735120423018e-01   +2.077326469430712e-01   +9.231443795968751e-02   +3.900402878138104e-01   -4.681260381435770e-01   +5.523637368313272e-02   -1.011200696143716e-01   -2.461408859765896e-01   +4.386746331664751e-01   +4.132965364749593e-01   -4.801140083836724e-01   +3.137723037413132e-01; -3.983083338395601e-02   -6.235918608555757e-01   -1.468203858217612e-01   -4.750210723336403e-02   +3.282165852725566e-01   +4.099653816999700e-01   -7.676352714814219e-02   +5.739620068217363e-02   -3.318054942496929e-02   -2.610534757409057e-02   -5.354406207214698e-01   -1.941875795120419e-01   +1.345549951447834e-01   +4.204690788768537e-01   -3.226031064522699e-01   -1.531890582886452e-01; -2.279434445537074e-01   +2.731755602058263e-01   +5.525434446203861e-01   +2.497955669356836e-01   -5.547240378027116e-02   +4.231034365578044e-01   -7.454765686834314e-03   -2.806509894344053e-01   -2.495014784969606e-01   +1.521113649330171e-01   -1.095454817712307e-01   +2.122775051851851e-01   -1.284994353615069e-01   +3.456078077677087e-01   +3.716510895731592e-01   +9.055182347876328e-02; +4.324291119853010e-03   -3.708469284742373e-01   +1.756676774020118e-01   +5.780776960881778e-01   +8.650358296719840e-02   +3.118484497454757e-01   +1.336738647674127e-01   -4.437430401856454e-01   +2.739237099660185e-01   +4.409631532172988e-01   -3.375904701739596e-02   -1.634375488300254e-02   +5.095182410293200e-01   +3.825802875071532e-01   +3.836190648928484e-01   -1.931607832716370e-01; +7.673381160678788e-02   +1.803421597575675e-01   -6.184343305060674e-01   +2.091429155697290e-02   +4.940216988530821e-01   -2.462188879927047e-01   +3.706080443843127e-02   +2.661189700176228e-02   -6.545698903871993e-01   +1.441793058195362e-03   +4.545624512727952e-01   -6.633048600614710e-02   -4.262783384257873e-01   +3.514360551099755e-03   -1.230501740341067e-01   +1.353476939946721e-01; +1.042082295390395e-01   +7.440657395489773e-02   -9.737894763950136e-02   +2.332450975673089e-01   -2.156249840899440e-01   -1.449358250346135e-01   +2.213484272229984e-01   +2.162883009087999e-01   +7.678156826096458e-01   +2.497610988674610e-01   +2.560338003641629e-01   +6.182522373480661e-02   -1.388527465646860e-01   +4.080998190250857e-01   +4.315008942536631e-01   -6.574383186146722e-01; +1.424689325953456e-02   +2.709817377004650e-01   -1.256213503200176e-01   -2.787739356839098e-01   -2.605936867740974e-01   -2.619657242521765e-01   -8.411467943578150e-01   -5.361767666554600e-01   +1.948463137164232e-01   +2.526999216077132e-01   +1.632514409886373e-01   -9.667677510159600e-02   +3.122810957919133e-01   +5.508115269254408e-01   -1.118989747387006e-01   +2.225239184270343e-01; +2.032746241246766e-01   -2.682658738676951e-01   -3.643966837154916e-01   -6.326005895234323e-02   +5.002079828177778e-01   -1.047345427251797e-01   -1.370716286302794e-02   +3.567991699525694e-01   +5.967471460027344e-01   +4.931607515811388e-01   +4.850299830174233e-01   -7.508448117081029e-02   -7.118961089315906e-02   +1.878576847462764e-01   -1.949277735309533e-01   +4.850936773488298e-01; -4.797633790824879e-01   +2.865357230748941e-01   +3.166448047657452e-02   +3.688822740674809e-01   +1.871920399337326e-03   +2.292357498786268e-01   +1.462304900502767e-01   +4.618620032718920e-01   -4.890289660919116e-01   +3.434255338704211e-01   -9.684559957192029e-03   -1.354703980989307e-01   +2.104156541274235e-01   +3.913339947308511e-01   +3.659253398703871e-01   -2.399970803661436e-01; -1.810940236142848e-01   +2.509032345572720e-02   +1.028657496525046e-02   +6.764627316379326e-02   +1.220402382854934e-01   +2.712248984568162e-01   -7.243987953238924e-02   +2.540475817795002e-01   -6.740734028450932e-02   +7.196451622336159e-01   +3.949240731134018e-01   -2.156855181734617e-01   -3.011696082286719e-01   +1.124615186899655e-02   -8.321089377546778e-02   -4.558161230825927e-01; +5.370384559852097e-01   -2.869260552617861e-01   +4.408238148950907e-01   +6.937631446694464e-02   +5.619785705417772e-02   +1.767363931282875e-01   -1.972745343173637e-01   -4.274040511845342e-01   +6.295640929014643e-01   -2.491134750589207e-01   +1.418899788683342e-03   -5.612403437746618e-01   +3.706478295167989e-01   -6.326845638563466e-02   -4.263740677870799e-01   -1.313244039612254e-01; -6.992298706210086e-01   -2.012854143012532e-02   -1.612639903912852e-01   +6.846087083309992e-02   -7.302438698537881e-01   +4.504688478948112e-01   +3.066743355167789e-01   -8.458162580539758e-02   -1.315616203943088e-01   -4.250289169459007e-01   +1.944181207927412e-01   -3.252067270790038e-02   -2.726317196459355e-02   +1.753947910563980e-01   +2.437519045727645e-01   -1.288708326906554e-01; +2.655556242098124e-01   -4.373244052990896e-01   -4.214306647081624e-02   +2.521447414797280e-01   +4.600291758499152e-01   +4.935681705373509e-01   -2.083207427673884e-01   +3.190765900848442e-01   -1.785196741052248e-01   -4.953105912012933e-01   +3.075447371327419e-01   +1.587352304962727e-01   -1.908858072748564e-01   -2.004416435959548e-01   +2.597624182871634e-01   +7.142167586965431e-02; +1.626388105231783e-01   +1.222200027730291e-01   +6.773604473448971e-02   +7.538369844651252e-02   -2.347242145498371e-01   +4.300057374572388e-01   +2.460611332876692e-01   +5.801902221941057e-01   +1.980672905929445e-01   +2.854709248358828e-02   -2.511490130103418e-01   -1.983302047856819e-01   -8.944448797248677e-03   +3.780543691309084e-01   -1.143724460010888e-01   +1.613192021234587e-01];
L2I_L1I_iGABA_netcon = [+2.903804659576747e-01   +2.417526686096548e-01   -3.221255330071917e-01   +3.206875203020674e-01   +7.156954745481534e-02   -8.260665539604655e-01   +7.485928878389296e-01   -2.999822639747235e-01; -4.350995734306164e-01   +2.613088505468251e-01   -1.376413982668383e-01   +2.805822436068237e-01   -4.326725841221659e-01   +1.235162253827087e-01   -6.683859349659032e-01   +4.488061455040293e-01; +8.025840230711082e-03   +1.657241355469502e-01   +2.890672071575745e-02   +2.881782528215379e-01   -1.039966675341031e-01   -4.376041259332035e-01   -9.894337946045213e-02   -1.079426304800872e-01; +2.804119244471830e-01   +4.594786570855630e-03   +1.661263086820615e-01   -8.463209934244136e-02   +1.465336476915646e-01   -8.216862126092131e-02   +3.851860238123631e-01   -4.695313988142519e-01; -3.826726072535938e-02   -3.402695593595845e-01   -5.936729376415152e-02   +5.547409271672286e-01   -1.753010949757344e-02   +7.738669129203949e-01   +5.495171469346056e-01   -2.063317390924328e-01; -1.909247472109903e-01   +2.258055202672095e-01   -6.138415108430732e-02   -6.083531416934004e-02   +4.387207517139208e-02   +4.560583592695645e-01   +1.669556299357072e-01   +2.875752613418490e-01; -7.948893538223278e-02   +4.588776653690493e-01   +5.448959763159941e-02   -3.466111511238309e-01   +1.821678200018069e-01   -6.854533171234375e-01   -1.741221774624959e-01   -7.793262352983482e-02; +1.934515956953932e-01   -7.336173678564517e-02   -5.442790415915854e-01   +8.327563337406573e-03   +2.424186220030299e-01   +3.252968847371625e-01   -9.197618414620426e-02   -1.152019055710991e-01; +8.335405032371194e-01   -5.899760386435753e-02   +2.469420355997180e-01   +4.892872710765307e-01   -6.357414751557136e-02   +6.733172765111378e-01   +5.839473228730071e-01   +3.533628451936248e-01; +4.073460706093948e-01   -2.759179975135715e-01   -7.790349181227260e-01   +3.278434749692468e-01   +5.822280514175830e-02   +3.447150969275909e-01   +4.581767378706542e-01   +1.128818620284094e-01; -2.172213850056198e-02   -1.364857690539734e-01   +1.661486168721193e-01   +2.274373774622188e-01   -1.011033400846542e-01   -6.999380413104509e-01   +1.801790852546235e-01   -6.550805794774797e-02; -2.453145431746706e-01   +3.559803574442872e-01   +3.635068236091087e-01   +1.192497873897412e-01   -7.922804349485280e-04   -7.998314341763846e-02   +1.294850499366897e-01   +7.189562856800995e-01; +3.648231663393163e-01   +3.938703193870835e-01   -1.312796334044330e-01   +9.733091561274979e-02   +8.589544808187574e-02   -1.416100819926900e-01   +2.939205080634395e-02   +4.074540330569622e-01; +6.786126298787643e-01   -3.821858506128123e-01   +2.830928393519606e-01   +7.088406092705338e-01   +2.842934283907169e-01   +7.413531638499903e-01   -4.685793260527979e-01   +2.392261008738729e-01; +3.854328270849897e-01   +9.985057530693736e-02   +2.508540886089350e-01   +2.030747379768815e-01   +2.154624917138846e-01   -2.237954812059142e-01   -6.371295885265156e-01   -5.366658489780012e-01; +4.723681670210788e-01   -4.623184117055956e-01   +3.776951654474824e-02   +1.616455411938938e-01   -2.476813045031676e-01   +1.737393642673985e-01   +5.961212110487883e-01   +1.186793338585808e-01];
L1I_L2I_iGABA_netcon = [+9.628132020489383e-01   +1.993194233740652e-01   -1.507921029890320e-01   +5.719993964625627e-01   +7.824700174944946e-02   -1.441752184804798e-01   +1.847708495893453e-01   -1.031915438378326e-01   +5.199057889834552e-01   -2.887383492827982e-01   -3.128291989641305e-01   +6.925992705408184e-02   -3.962410315381147e-01   +4.964515292171151e-01   +7.888494229366346e-01   +8.257848352279082e-02; -4.484800804998036e-01   -7.572037592205522e-01   -3.255568531356956e-01   -7.464584452229200e-01   -1.743626815140087e-01   +7.711348959945521e-01   -3.069978490808845e-01   +4.032600845349757e-01   -5.976706707504833e-01   -1.592498436772189e-01   +4.338179541655403e-01   -5.814754491217791e-01   -3.457069328771645e-01   -4.242194792692869e-01   -2.270331214488508e-01   -2.222656092932124e-01; +3.591249846305920e-02   +4.667828592222943e-01   -1.345326313501621e-01   -4.339737120091603e-01   +4.770049362708151e-01   +3.199866290540687e-02   -1.809016534115049e-01   +3.428248553874947e-01   -1.046558011048205e-01   +3.717276632829137e-02   +3.491536642694237e-01   +7.056800663442537e-01   -4.920084271844177e-01   -1.258534834746229e-01   +4.712504535304455e-01   -2.201442663944936e-01; +1.779181724237119e-01   +4.139041067311230e-01   -3.422590897094006e-02   -2.062970686488089e-01   -1.305827105125529e-03   +1.980214928696496e-01   +1.679320799477372e-01   -2.961009658659947e-03   -1.120604098611558e-01   -3.522889302552580e-01   +2.577797836718237e-01   +4.713952382223755e-02   +2.024893304371345e-02   +9.895216773419158e-01   -3.326832247638396e-01   +2.775101385057749e-01; +4.075715512700260e-01   -1.443357822527523e-01   +2.248843685039202e-01   +1.398914084545338e-01   +8.505398072398690e-03   -3.424427137987325e-01   +2.845259493225696e-02   +5.443867715479306e-03   -2.698315670361219e-01   -4.697422641092813e-01   +2.788990242482767e-01   +2.432030880186677e-01   +1.395464581699824e-01   +6.585895697218493e-02   +2.251137313517838e-01   +1.136826898896455e-01; +1.809150960484902e-01   +3.083812250445748e-01   +1.291847600391270e-01   +3.792443688631087e-01   -3.288214320237941e-02   -2.556014345243243e-01   -1.055463105846203e-01   +1.742884570716984e-01   +8.537359531909330e-03   +1.331914717941967e-01   -1.511422689323769e-01   +1.029810520589602e-02   +2.712716864397832e-01   +2.304695809178270e-02   +4.034668283095849e-01   +5.024827910530366e-01; +4.106120013070946e-02   +4.724238060604674e-02   +1.708947960282939e-01   +5.187141559500442e-01   -6.314741595249203e-01   -2.914061520283742e-01   -1.826136606357359e-01   -3.231360495370892e-01   -8.480118461560715e-02   +4.854020467440140e-01   +7.798188271277756e-01   -2.756200620134966e-01   +3.017512530507007e-01   -1.706588180537956e-01   +8.802597371455535e-02   +1.032452853803212e-03; -1.554620860423098e-01   -2.412925604026474e-01   -9.699110312951284e-02   -1.067692230112393e-01   +1.424910857706643e-01   +4.762776593494106e-01   -1.028079760851560e-01   -8.261605016945514e-02   +4.152228694885686e-02   -1.932892363701608e-01   +1.693518100578670e-01   -1.916619358485777e-01   +2.604939728020383e-01   +3.474673479020144e-01   +9.200824378141348e-04   +2.147133929473060e-01];
L2E_L1E_iAMPA_netcon = [-5.922323936966195e-01   +1.259974712360386e-01   -2.146790223031738e-01   +4.793011316981405e-02   -2.429314309052848e-02   +1.856036385136754e-01   -1.150108825173696e-01   +4.348568959693733e-01; +5.478766181151442e-01   +6.140094924521743e-01   -3.848014014148252e-01   -3.154090074543421e-01   +3.002971629565225e-01   -3.752319824330689e-01   -1.494021512333388e-01   -1.533921514626689e-01; +1.396298992744239e-01   +3.446065179232561e-01   +1.009787355540289e-01   -2.881188380509189e-01   -4.431504500515750e-01   +2.196203005845448e-01   +7.984314835416779e-02   -1.510179398775061e-01; +2.324688967952626e-01   -1.702842644683852e-01   +3.243785187357958e-01   -7.971564250767654e-02   -2.276693256198762e-01   +2.551264487991297e-01   +5.375480580769663e-01   +2.661278581380270e-01; -4.602599521240225e-01   +4.231573486371100e-01   +2.979084801523869e-01   +6.440585501469195e-01   -5.489560560235093e-02   -1.796684239094689e-01   +1.631846288716468e-01   -2.263743345997050e-02; +8.913943797424720e-02   -2.214204949505192e-01   +1.617299685145705e-01   +3.121333861975901e-01   +1.747592756418418e-01   +5.442937978286533e-01   +2.476457372750776e-01   +1.728272805292921e-01; -1.380132310525479e-01   -1.410425240920981e-01   +5.057955804040335e-01   -4.519282811625424e-01   +4.902360875160318e-01   -7.560345985875245e-01   -1.743680075943893e-01   +4.965240287584490e-01; -5.889906276517645e-01   -4.601289489697891e-01   -3.669713671609391e-01   -6.126965623461669e-01   -7.213209684531326e-01   +2.287280709340470e-01   -3.435489622561446e-01   -4.134379373437495e-01; -1.953219752303174e-01   -6.757075258439247e-01   -1.691077243921859e-01   +1.744078688814265e-01   -1.548338429648795e-01   -2.775757589169056e-01   -5.146637399888701e-01   +1.123940754495260e-01; +7.011896380824437e-02   -1.892551815128824e-01   +3.891328702815844e-01   -1.367715834343850e-01   -2.235446877326837e-02   +2.039644213671074e-01   -1.876928829762215e-01   +1.703745475164552e-01; +3.206500917028530e-01   +3.979523141004371e-01   +1.907362506439002e-01   -4.046547782341630e-01   -8.427853763763179e-01   +1.263816638901013e-01   -3.569956051760414e-02   -5.188127431523425e-01; +2.911536399837463e-01   +7.444196690592442e-01   -5.257469607490617e-01   +2.260618253537550e-01   +4.003188835384811e-01   +2.980892568400493e-01   +5.615671355699930e-03   -4.940645108187708e-02; -2.067053606535213e-01   +6.079343299620775e-01   -3.568288894347264e-01   -4.195318214074017e-01   +2.903532518789249e-01   -1.909784237596952e-01   +3.121562764894496e-01   -5.487955931073575e-01; +1.259931095505549e-01   +6.204265933050265e-01   -1.077657879821586e-01   -5.458567940400331e-02   -8.045828925528679e-02   -3.097158990640229e-01   -4.882010429531429e-01   +2.829181907447131e-03; +2.739650297798419e-01   -5.806290163269225e-01   -1.565359135601990e-01   +1.098868802299480e-02   +3.107425670264136e-01   +1.362399281864869e-01   -6.571259269505849e-01   -3.549858533607499e-01; +3.903723099373583e-01   -9.218366895260488e-02   -3.005068689452871e-01   +4.639783319888379e-02   -1.107696101336288e-01   +4.387519460560258e-01   +2.847048385419652e-01   +8.894045624518077e-02];
L1E_L2E_iAMPA_netcon = [-7.562156911882495e-01   -2.289601956318504e-01   +3.556492733562578e-01   +4.966866845118061e-01   +5.101602477373686e-01   -1.787073574229124e-01   +1.835936690504842e-01   -7.053709167513951e-01   -5.942637573322932e-01   -3.843380848478248e-01   +1.181375061280595e-01   +3.946733380370059e-01   -1.539727738351832e-01   +1.838738544713290e-01   +2.007563286388366e-01   -3.977518924958783e-01; +9.818285095428865e-02   -3.728856574842035e-01   +2.551968890187192e-01   +3.884251852168754e-01   +5.626796408155303e-01   +2.492374790409914e-01   -5.800168817662135e-02   +2.191365249133820e-01   -1.858884971294648e-01   +5.558473503991876e-02   -2.273463608474016e-02   -6.948727018252374e-02   -5.079474195346095e-01   +3.252165416055390e-01   -7.183598614446471e-02   -2.271155847443153e-01; +3.502000772916883e-01   -2.589678332236061e-01   +2.707123994717076e-01   -4.806928430035627e-01   +3.058872092461172e-01   -2.539142809092438e-02   +4.533308027397526e-01   +6.043391007647589e-01   -8.888035924640072e-01   +1.418404953691299e-01   -7.611131900291573e-01   -6.691119461893582e-01   +5.307483173879766e-01   -2.021934997394838e-01   -1.759817223768928e-01   +1.268890569108883e-01; -1.197492300220793e-01   +7.483770466929183e-01   -2.116723465425961e-01   -8.765634454923282e-02   +2.284451676082279e-01   +1.255901622035853e-01   -2.107529773021313e-02   -5.586721330913832e-01   -1.747184997754764e-01   -5.244933294377232e-01   +7.384759502705185e-02   -1.196498057208617e-01   -3.836622231349105e-01   -1.437443080460252e-01   -5.908246070706296e-01   +5.490532793822273e-01; -2.549536941488198e-03   +4.538270312458356e-01   +4.944630494506541e-01   +2.788435993981818e-01   +5.219219602009869e-01   -2.407794983331491e-01   +4.611294286627156e-01   +4.461038840453735e-01   -3.404584172149224e-01   +1.068648026083823e-01   -3.028709992580180e-01   -5.874055679189565e-01   -5.882095245855137e-01   +3.449593745534271e-01   +6.150234353957150e-01   -1.028991091880911e-02; +3.462096290422716e-01   -4.114700596266502e-01   -1.723948800595354e-01   +5.039502510572706e-01   +2.179525274288772e-02   +3.371034033348440e-01   -4.412054531264147e-01   +6.387925411114499e-01   +1.684414838738063e-01   -2.782428766959266e-01   +3.617172104018724e-01   +3.952519822840588e-01   +3.615379037301344e-01   +3.325153430082687e-01   -7.566970311067633e-01   +2.978339306558101e-01; -3.904467780941770e-01   -3.558687593908219e-01   +8.454379957420027e-02   +6.760653603040028e-01   -2.618306060094111e-01   +6.383019230743796e-01   -1.477640169952834e-01   -5.890293279300268e-01   +1.558611036464311e-02   -6.814982732258784e-01   +3.207244296897233e-01   -7.664417124527576e-01   +1.002397039193862e-01   +7.691230061972301e-01   -1.234302041398148e-01   +5.137588015432598e-01; -2.633663582983629e-01   -7.269783729692794e-01   -3.144375684805076e-02   -3.009647384244740e-01   -2.213033608895016e-01   -4.846674313023985e-01   +4.073756928257353e-01   -1.113175684853394e-01   +4.184847490630711e-01   +4.203747158406131e-02   +6.781006911225127e-01   +2.502242610976301e-01   -3.010783809180017e-01   -3.178889046251319e-02   -4.798806085889826e-01   +1.569365853272705e-01];
L2I_L2E_iAMPA_netcon = [+1.766051338097939e-02   -7.853308163944394e-01   -1.494073580520223e-01   +1.080346060644355e-01   +5.996015113351568e-01   +6.251963731228847e-01   +3.981023549311159e-01   +2.158226849797655e-01; +5.206614596357231e-01   -7.086149081586622e-01   -2.966987848912251e-01   +7.005489322324747e-02   +9.080805418710589e-02   -6.513515685979440e-01   -1.872433800800765e-01   +3.672350374955419e-02; -9.764920431783564e-02   +2.551431909281518e-02   -1.890457968257246e-01   +7.417972084122201e-02   -5.177709840874468e-01   -5.124637132344591e-01   +5.063197997912698e-01   -2.053950875282016e-01; +4.364126828884720e-01   -1.058996597344910e-01   -8.084965616239190e-02   -1.605496978293030e-01   +1.444933635999453e-01   +4.449563430890188e-02   -1.833734057080903e-01   +2.280477953482846e-01; -4.489538948027287e-01   -4.822476493165767e-02   +2.713511958037292e-01   -5.728124737398115e-02   -4.300208532329265e-02   -4.580839314110632e-02   -1.643289896433664e-02   -2.763376633168220e-01; -2.882561894717774e-01   -6.467453530976424e-01   -4.801450699476348e-01   +6.121310819287581e-01   -2.175323826623775e-02   -2.991883269064195e-01   +9.662692580755480e-02   -8.676012080149031e-02; +5.644231602991229e-01   -9.050402966505170e-01   -5.092826798857024e-02   -1.508408301978016e-01   +1.532517432680484e-02   +1.946574780813565e-01   -7.032286315055428e-01   -1.670995953546625e-01; +2.920134694151895e-01   -2.989192862453582e-01   -1.901720967508795e-01   +4.367563055266495e-01   +6.893741463986907e-01   -3.571649642679701e-01   +2.327788480243650e-01   -3.621099435175524e-01];
L2E_L2I_iGABA_netcon = [-1.016343742751216e-01   +5.248865069229550e-01   -2.118234096823020e-01   +7.690992281156691e-01   -2.604222298832171e-01   +7.007554390038019e-01   -2.764121531945163e-03   -7.680004504593915e-02; +1.934706832841315e-01   -1.825961253682575e-01   -2.183129659978092e-03   +1.882044956967416e-01   -4.755266619922464e-01   -1.832326854662427e-01   +3.479234927597343e-01   +1.533288543186073e-01; +8.966447265659289e-02   +2.134929683883206e-01   +6.408923982846668e-01   +4.534808447438283e-01   +4.381230863380307e-01   +9.187371271356491e-02   +4.892193888763262e-01   -1.720961364055905e-01; +5.754117616735152e-01   -3.003543359896561e-01   -1.365525875950408e-01   +2.375551563680862e-01   -1.293297970826576e-01   +3.265562335525447e-01   -2.760315883895769e-01   +1.543957051986128e-01; +5.501205743477546e-01   +5.341025326997186e-01   +5.637994577018057e-01   -2.586307133508120e-02   -3.559212074940340e-01   +6.598133420770740e-01   -2.254189036052134e-01   -1.351593077796950e-02; +8.466585950827127e-01   -3.964084081272852e-01   +4.173253786272997e-01   +2.205764095188406e-01   -8.481690113926310e-01   -2.426488571589709e-01   +3.173541725464334e-01   +1.168611834543606e-01; -3.122644748260208e-01   -4.471023718276661e-01   +4.456226774277642e-01   -5.977869889165111e-01   -2.809263871509235e-01   +6.000554796504998e-01   -3.567739533633733e-01   -3.712112243245007e-01; -2.365463472491353e-01   +7.693747094469100e-02   +1.670069507485044e-01   +3.752685254772066e-01   -5.186210853407298e-01   -1.659287867014581e-02   +2.185778156918233e-01   +5.177240840071256e-01];
L3E_L2E_iAMPA_netcon = [-3.299374270731140e-01   -2.448631562793336e-01   -1.765048283198854e-01   +3.876001642288106e-01   +7.166146878616311e-02   +6.105525989595597e-01   +1.474821287483757e-01   -6.060243684624442e-01   +4.426450038121522e-01   +3.265907568061782e-01   +6.192025247591724e-01   +1.925498606666895e-01; -2.793303383836722e-01   +2.617799573743289e-01   -5.907884746888188e-02   -7.956061058861591e-01   -5.369364748062075e-01   -4.699408546511000e-01   -4.068259611964908e-01   +2.294098591360617e-01   +4.192088849778548e-01   -5.784646866159641e-01   -4.396970011615527e-01   -2.526367786983965e-01; +1.383080215835263e-01   -2.214653630869931e-01   +3.639250137905844e-01   +2.111116051045533e-01   +4.375667361733312e-01   +1.924816809649475e-01   -8.894855014812494e-02   -4.457677048710512e-01   +4.182169418067874e-01   -5.165745484573191e-01   +1.576676577236124e-01   +9.244773186162611e-02; +1.504721804251103e-01   -1.691053975995399e-01   -3.355028904101681e-01   -5.960893288225638e-02   +8.136550457287347e-01   -4.076682385841944e-01   -4.333561330999227e-01   +3.984121677941318e-01   -5.191481387525890e-01   +8.760104994431024e-02   -1.472285981749193e-02   +2.664090036862798e-01; -1.989004471490461e-01   -7.078580194891241e-01   -1.423758178082397e-01   -2.051956637343486e-01   +3.199356869985074e-01   -4.691972882742865e-02   -3.179952644126205e-01   +3.471656995747512e-01   -1.059822305179776e-01   -4.821673541218514e-01   -6.248421723029483e-01   -5.810569481792889e-01; +9.140123665504130e-01   +2.399537303549265e-01   -9.167351256215076e-02   -4.391967554177924e-01   +5.176445441967323e-01   +5.717685243720696e-01   +3.411054736010172e-01   +6.314512297074116e-01   +2.850115247145835e-01   +7.724403229812848e-02   +2.321981981661913e-01   -7.183169749061455e-01; +3.357147555690540e-02   -5.063872764845638e-01   +3.947128943928812e-01   -6.929657763308691e-01   +3.018579125729214e-01   -2.997402897177246e-01   -1.859262561691816e-01   -1.504248062076617e-01   -3.694430518295003e-01   -5.492170515407221e-01   -6.433412867194083e-01   -2.899248207270840e-01; +1.482947433129542e-01   +5.623628256727263e-02   +2.837637690926816e-01   -7.022641995977749e-02   +1.817022627079399e-01   +3.755446654100520e-01   -2.218527028215359e-01   -1.618040083584020e-01   -5.369757551932788e-01   -5.483758753284426e-01   -1.001241946074840e-01   -4.240562413989089e-01];
L3I_L2I_iGABA_netcon = [+1.196071813801946e-02   -2.260672336638154e-01   +1.778031414684692e-02   -1.595321219144726e-01   +7.391119334594285e-01   -1.662678042757923e-01   +3.893291802085830e-01   -5.694229754599754e-01   +6.689232503380469e-01   +3.379346143814539e-01   +1.034631224915851e-01   +2.027941283146647e-01; +6.897942836542123e-02   -3.380061259344086e-02   +3.812635885175277e-01   +4.862318572490791e-01   +5.761117440225387e-04   -3.921948211792786e-01   -1.792659679071225e-01   -4.253044664664447e-01   +4.959072704633697e-01   -3.218005385706723e-01   +5.122206614826683e-01   -1.409179884568880e-02; -6.315726964270576e-01   -4.438821835386240e-01   -1.599674569150759e-02   +4.532719088656591e-01   -4.045175664165064e-01   +4.835839409934794e-01   -1.353709893061695e-01   -4.594639543116130e-01   -4.627573096555330e-01   +1.971477311052151e-01   -2.808839476420356e-01   +3.493906545942460e-01; +1.583610398949746e-01   +5.383664000030660e-01   -4.476503239543262e-01   +3.623371211573952e-01   +3.738325444358928e-02   -3.402348948440339e-01   +5.961796940705912e-01   +1.092274966352266e-01   +4.852797419415243e-01   -2.930307896440087e-01   +4.262520049760583e-01   +2.421153258967447e-02; -2.198122022130796e-01   +3.849812580507342e-01   -4.725808502966843e-01   +1.126690381448349e-01   +3.032034271971049e-01   -3.591625718614768e-01   -5.489776770799558e-02   -8.049156082801607e-01   -4.039909820010071e-01   -5.500412404695702e-02   +3.015329423329047e-01   -7.501724040281837e-02; -7.066239591074799e-01   -1.314469397532794e-01   -3.670512749574306e-01   +1.812671329103102e-02   -4.653843899117268e-01   -3.700423262304252e-01   -4.937067412558646e-01   -6.798026068174003e-01   -4.544117181856082e-01   +3.935046645182129e-01   +2.456028541833488e-01   -2.710454601012600e-01; -4.689436961996307e-01   -4.653618885147680e-01   -1.243337732258049e-01   -5.679238441639531e-01   -2.179729756324347e-01   -2.868435764622991e-01   +4.198444351093236e-01   +1.418550353279560e-01   -6.917688787854184e-02   -7.218536867146106e-01   +4.182035005528585e-01   +7.351064508075361e-01; -1.871282626646789e-01   -5.309701000903890e-01   +2.411193166905542e-01   -1.350651011297140e-01   +7.220231668751131e-03   +8.414738800128369e-01   +6.958154913426882e-01   -7.628919898851627e-01   -5.632330272007241e-01   +1.806013782152084e-01   -1.416579737157656e-01   -5.523333573288898e-01];
L2E_L3E_iAMPA_netcon = [-4.042903399121341e-01   -5.661639258350143e-03   +1.586800839860290e-01   -9.886374706720324e-02   -3.978168663540393e-04   +7.095726544945247e-01   -4.019529292090121e-01   -3.705296848724497e-01; -8.216454145360904e-01   -6.187356412296308e-01   +2.930608577733095e-01   -3.276696911118090e-02   -1.508523699508740e-02   -5.506384138823945e-02   -2.838667610729753e-01   -5.679109151067043e-01; -1.697138192403887e-02   -3.397105243507865e-01   -3.803728841348724e-01   -6.362145116046828e-01   +2.377947616013237e-02   -1.182387095951649e-01   +4.555176544154576e-01   +2.382794872901798e-01; -2.877656055681994e-01   -4.509454824592650e-01   +2.770607128465296e-01   +5.504518706826803e-01   +3.401024299252287e-01   +8.585962124908980e-02   +4.556209356868748e-01   +3.052155403123135e-02; -1.345759511544132e-01   -3.819584646455645e-01   -5.143747303107106e-01   +2.436997198671716e-01   +3.176577508061572e-01   +5.195951599681279e-02   +6.383515505570216e-01   +3.090233352339042e-01; +4.235078896477862e-01   -1.428749802907862e-01   +1.613903446123533e-01   -7.836168162573525e-01   -5.633999574821705e-02   -5.947608454340346e-01   +7.044621907205792e-02   -1.512937852712178e-01; +1.640766077019173e-02   -1.707159252388597e-01   -1.536711658961437e-01   +4.135776146987160e-01   +2.968575104075200e-01   +1.856788378194937e-01   -3.733458285275052e-01   +4.087452703043049e-01; -3.347384325596287e-01   +7.058448289672099e-01   +3.624125251024856e-01   +1.930083367574605e-01   +3.288805224703760e-01   -6.491284405669171e-01   +1.933540103589680e-01   +1.505105595642655e-01; -1.357241441501638e-01   +1.460236694408201e-03   +1.025482343645947e-01   -6.583511154991381e-01   -3.230604919097813e-01   -1.483800235868394e-01   +2.139230026241579e-01   -5.912497406713520e-02; -5.680814470393445e-01   +8.255837147726142e-02   +1.078297704596184e-01   +2.258196319360748e-01   -3.224776269501805e-01   -2.400849788340903e-01   -4.484844585616712e-01   +5.876085295797717e-01; +5.101322544296314e-01   +9.285698354673652e-01   -1.386554177821586e-01   +1.732668083084378e-01   -5.638270205197031e-01   +2.531830115062915e-01   +2.138015549514323e-01   -1.193284383453286e-01; -3.320648008046670e-02   -4.723858190157502e-01   +1.587035750319581e-01   -1.731933575248640e-01   -5.387804667856265e-01   -2.872134203310230e-01   -2.914930534261823e-01   +8.649599648038502e-01];
L2I_L3I_iGABA_netcon = [-9.132722955811942e-02   -6.340483004428364e-01   -3.506818493959735e-01   -3.607902005088444e-01   -1.883801081055158e-01   +4.919019106071505e-01   -3.575214093791245e-01   +2.218297767779456e-01; +2.558072215613963e-02   +3.181991415726018e-01   -3.476871332465802e-01   -9.797042981220225e-02   +6.833619708653030e-02   +4.989353666742184e-01   +1.091454057363488e-01   -4.339442663665405e-01; -3.132690832996795e-01   -4.625814756460019e-02   -1.072291849044630e-01   +1.359820752542432e-01   -5.371866535496040e-01   -2.451297489029530e-03   -6.018500724880706e-02   +1.979434724515535e-01; +1.399657790971027e-01   +5.899233691178803e-02   -2.746241587798627e-01   -1.442464944036428e-01   +4.872462139051740e-01   +4.514801239609605e-01   -3.453089802440691e-01   -6.522475504830760e-03; +2.354166968628869e-02   -1.688687830534990e-01   +3.209109298079703e-01   +1.095997277922541e-01   +3.539869042955124e-01   -2.526052214051814e-01   +2.300360107090959e-01   -4.395397559023632e-01; +3.183166637524200e-01   -2.361373458927933e-01   -1.336775183063816e-01   +3.475612081061717e-01   +5.841712878991088e-01   -1.558714271324698e-01   -1.860445269269775e-02   +3.609751633600152e-01; +2.400173730829778e-01   +1.005640417380927e-01   -4.563297002003794e-01   -4.301104342262766e-01   -2.893705518357158e-01   -2.380277669653935e-01   +2.311048852144015e-01   -5.912025226032272e-02; -1.173403572858171e-01   -5.571161003187849e-02   +1.344760371600646e-01   +1.991878591373595e-01   +4.737862465222042e-02   -4.842614739649362e-01   -1.010373557150210e-02   -3.531002227424909e-01; +4.714803479269315e-01   -4.472724434620907e-02   -3.594524630588694e-03   -5.879765974613149e-01   +3.189360633345480e-01   +1.975215700347952e-01   -2.491724029113976e-01   +4.960485110860104e-01; +1.743053426324430e-01   +4.082473660789790e-01   +1.155365306400013e-01   +4.874082231733058e-01   -1.216612539386806e-02   +2.216136277962901e-02   +1.365827039668558e-01   +3.517486842945817e-01; +6.011320413815641e-01   +8.021760390156028e-02   +3.115502440104503e-01   +1.525389197846139e-01   +5.056032628984832e-02   +1.767678633293993e-02   -3.883896299438511e-01   -6.675679954125344e-01; +6.135873530087976e-01   +6.287038247289595e-02   -1.818309694611126e-01   -2.027279828418496e-02   -1.547468920707144e-02   +1.423434872143733e-01   -1.253666690648976e-01   -9.966908717339079e-02];
L3I_L3E_iAMPA_netcon = [-4.834446488162637e-01   -5.264322951834567e-01   +7.334709980978149e-02   -3.127523710953937e-01   -4.002951251546927e-01   +3.714263529022125e-01   -1.172600695044986e-01   -5.592743636123316e-01   +1.309336516235146e-01   -3.881315689383444e-02   +3.913496945178945e-01   +1.894889568819997e-01; -5.284556516786162e-02   -8.556060495435202e-01   +2.759271022575898e-01   -2.394350745989001e-01   -1.265712002322711e-01   -4.547420134192957e-01   -6.464552194002093e-01   -3.365347104834932e-01   +7.324942222167455e-02   +3.692473828563539e-01   +3.957605310544229e-01   +6.050746282637280e-02; +4.973328617989965e-01   +6.382856766066455e-02   +5.556857206072507e-01   +4.249121032411985e-01   +4.311549905681091e-01   +3.288207543017377e-01   -3.812936137381506e-02   -2.498893113915477e-01   +2.141895859645511e-01   +4.973746849100447e-01   -8.470765484069684e-01   +2.164081217516287e-01; +2.938533909334970e-01   +1.958955051656557e-01   +2.747453232484171e-01   -2.863742836855530e-01   -6.203168685049431e-01   +3.423002801461939e-01   -1.033738534059156e-01   -2.641979531979516e-01   -1.309332795604552e-01   -4.469780398908991e-01   +5.759793377198646e-01   +2.121983373931985e-01; +3.631848263092459e-01   +3.337854586477847e-01   -2.225032615552298e-01   +8.648671484597183e-01   +1.002870970212488e-02   +3.534440461630088e-01   +2.970129241746817e-01   -2.579195088946829e-01   +2.411876374130612e-01   +1.470911885704794e-01   +3.070438329417233e-02   -5.534298365669106e-01; -2.368917616876298e-01   -2.646572086513024e-02   +1.326489601000775e-01   -4.747844708007122e-01   +3.662245206505226e-01   +4.148788121825598e-01   +4.674558961800335e-02   -9.115977987540534e-02   -4.299637705691158e-01   +2.336915700542017e-02   +1.969279811591210e-01   -4.323062092020616e-02; -7.732065057372610e-01   +2.097560185868663e-01   -1.803603535556987e-01   -2.259529943998179e-01   -2.588742928779293e-01   +1.379364449328801e-01   +1.682635760310587e-01   -2.648504717909256e-03   +8.825620960830059e-02   +4.867457137720194e-01   -6.596638935640928e-01   -2.149057680088846e-02; -1.168856003738039e-01   -7.961430869149945e-02   -2.289462180105979e-01   +1.367107618122061e-01   -1.901682971647323e-01   +2.026754087888840e-01   +1.503983986679700e-01   +3.375003205010759e-01   -1.652972093702041e-01   +6.299079170448236e-01   -1.298869323641382e-01   +4.889133965486434e-01; -1.380227722837685e-02   +9.500325946632812e-02   -2.665537277914064e-01   +5.803980939748633e-02   -3.679166893715911e-01   -8.042281259091899e-04   -1.022649297009373e-01   -2.654531749480910e-01   +1.384283268087461e-01   -9.397357101895640e-02   +1.789331924446240e-01   +1.406200636542278e-01; +4.290019507048732e-01   +4.902353905457429e-02   +4.336936129654241e-01   -3.651191736295622e-01   +9.421309648573736e-02   +5.435152204984506e-01   -8.206328005508745e-02   -2.036989129840718e-01   +4.361478721232662e-01   -7.278662507290251e-02   -7.857184965363322e-01   -5.607563302837940e-01; -9.279074038625772e-01   +4.626735445524640e-01   +1.356230874553143e-01   +1.649999251970442e-01   -1.238423014649869e-01   +2.528144959648183e-02   +1.171297319870015e-01   +1.529821707850434e-01   -4.689278902832364e-01   +4.066844007265403e-01   +3.957305310524538e-01   -7.016739050668826e-02; +4.031791145528153e-01   +4.134776082488162e-01   +3.168608653289043e-01   -2.518722564491428e-01   +3.461210714085476e-01   -1.769110329943528e-01   -3.951428486531128e-01   -2.180165216541158e-01   +2.313178593709573e-01   +4.967551413962636e-01   -2.938847518241368e-02   -3.158478207368597e-01];
L3E_L3I_iGABA_netcon = [-7.386536640943420e-02   +2.688440450346991e-01   -1.882169856511647e-01   -3.150471726281117e-01   -1.118259143039577e-01   -9.421567642156065e-01   -3.513276526087198e-01   -4.686651005547963e-01   +9.867669597296473e-01   -3.487409256774265e-02   +5.976716259108267e-01   +1.359142964664348e-01; -1.037780026476649e-01   -4.787101409988267e-03   -3.331955097544309e-01   +2.745066089462422e-01   +1.303368553948776e-02   -1.081981451165618e-01   +1.570984201038482e-01   -6.046320843257625e-01   +6.074932706805598e-01   -4.168685718331405e-01   +6.338026373000530e-01   -1.803372093730362e-01; +2.208778250751495e-01   +2.499956422893025e-01   -1.322381631983192e-01   -5.725240122306080e-01   +7.255998086411695e-02   -4.667575438107131e-01   +1.682453339445523e-01   -3.213243499313673e-01   +3.101850943252982e-01   -4.052567017350432e-01   +3.798188383738496e-01   -1.096698590498482e-01; +2.038951798793266e-01   -3.127759004780611e-01   +9.493827403010308e-02   -2.466760466100328e-01   -3.313081932751755e-01   +5.190220467841189e-01   +1.060623801865816e-01   +3.697884076316126e-01   -4.854023490925277e-02   -3.009083429323633e-01   -6.509188830429247e-01   -2.536217039019085e-01; -1.227053038830842e-01   +5.410492229559225e-01   -1.436589376463070e-01   -2.420528869335700e-01   -2.331437911155437e-01   -3.401512483240228e-01   +9.945262492129250e-02   +1.287550954000008e-01   -1.946366332529779e-01   +1.070168910846942e-01   +4.048934625523698e-02   +2.986080781800771e-01; +4.772495638273360e-01   +1.974512075735829e-01   -4.079296513469814e-01   +2.326508356860055e-02   -6.055274728874699e-01   +5.034905472460760e-01   -2.163710083341264e-01   +3.103881869694856e-01   +4.991097532703315e-01   -5.637843577326180e-01   +4.485500333380276e-01   -5.676035747422179e-02; +3.181651190677894e-02   -9.420497490869453e-02   +1.555478969438638e-01   +4.766975038701702e-01   +1.413135182623849e-01   +3.879433665795982e-01   -2.199902155909696e-01   -3.292193924749243e-01   -4.757616481860855e-01   +2.693806255617991e-01   -9.304502711939397e-02   +2.448083334986669e-01; +6.617756975810115e-01   -3.018371011448369e-01   +5.106527719165260e-01   +3.984875615233853e-01   +1.481220028253619e-01   +9.125893074396829e-02   -9.229540565944216e-03   -1.920776833797185e-01   -8.126667360010090e-02   -3.043220173972160e-01   +3.033532157404359e-02   +2.038140579255125e-01; +9.979053790322934e-03   -3.431685510924664e-01   +1.086847473687699e-01   +3.259408475772984e-01   +3.508763908414588e-01   +1.477794587444504e-01   +5.499653568474870e-02   +1.136112671352846e-01   +1.584678288309657e-01   +1.688743785089216e-01   -1.312699251111344e-01   +4.743564717449883e-03; -3.829458026250123e-01   +3.695994122120986e-01   +6.460336533498869e-01   +3.580689933377521e-02   +5.115512235968722e-01   +2.078444949767576e-01   -4.478419443385070e-01   +3.690233727410042e-01   +7.104189914210401e-01   -6.914679525235876e-02   -3.021053075070540e-02   +6.866875390310255e-02; -2.976613647023879e-01   -5.549648560084968e-01   +2.866092316849044e-01   -5.988779811078770e-02   +7.135038423749338e-01   +1.645872994273975e-01   +5.872786194521503e-01   -3.006992176967513e-01   +2.928764782033215e-01   +5.794351682268637e-01   -6.079329281012796e-01   +2.309645874159753e-01; +4.758807309585128e-01   +7.876459488639553e-01   +2.212618530437399e-01   +1.388862560028956e-01   +4.836442585192413e-01   +2.902380600501783e-02   +5.310481438224818e-01   +2.747511343200633e-01   +1.488293179252983e-01   -1.710429573502738e-01   +2.055655537666994e-01   -1.798358255376147e-01];
L2E_Input1_iAMPA_netcon = [-3.598772047531466e-01   -1.837730123057074e-03   -3.698864783723733e-01   +5.278943021127442e-01   -5.597706867949775e-03   +7.956039818247798e-01   +3.038991808135799e-03   -8.214667840811617e-02];
L2I_Input2_iAMPA_netcon = [-6.019644254611118e-01   -1.181538875034064e-01   -6.652717947397567e-01   +7.083037685983850e-01   -3.273436671278741e-01   -4.367860916553785e-01   +1.757699622255010e-02   -3.982626664096878e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
