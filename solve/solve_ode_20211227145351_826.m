function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.152854732209203e-02   +2.534561821100377e-02   +2.745050736426780e-02   +1.162361533984526e-02   -3.328548722975284e-02   +1.947807156661761e-02   -1.181523175184855e-02   +1.638314786096450e-02   +5.120517635201933e-02   +2.975384119693794e-02   +1.936621003235589e-02   +3.946055770722656e-02   +6.827853720344033e-02   +5.625966631640569e-04   -2.614921277796558e-02   -4.253885234808110e-02; +3.207099845473393e-03   -4.041152790436640e-02   +8.294779571007601e-03   +1.464954347156827e-02   +2.338006514830542e-02   +3.882984800635016e-02   -1.520662837676818e-02   -1.515264422803163e-03   +7.701595954758037e-03   -3.125797494062125e-02   +9.165883631069523e-03   -1.518707066726452e-02   -1.255535631875248e-02   -2.814898935950438e-03   +2.754330141278204e-02   +7.543676872705693e-02; +8.318695368686953e-03   -4.261026195716736e-02   -1.622237003834161e-02   +4.145318868174859e-02   +2.992392382692417e-02   -2.128080546463475e-02   +2.042215395641452e-02   +9.661545383608871e-03   -8.872728926695654e-02   +2.988018263936485e-02   +3.247590171499481e-02   -5.308527297230314e-02   +2.960312631886956e-02   +4.623122863063225e-03   +7.294660247516256e-02   +1.324116103468748e-03; +3.883127143902129e-02   -2.076832158033879e-02   +6.313079309387806e-03   +4.900481243749576e-02   +6.046826859234596e-04   -2.020338145959851e-02   -2.137864786836608e-02   -3.672421949329812e-02   +2.075185820967185e-02   -3.048135261903421e-02   -5.887229574645015e-03   +9.331110572913276e-03   -3.623090421879611e-02   +2.695960635574879e-02   +2.130002414032285e-02   +2.971833441457340e-02; +1.052942904664597e-02   -3.028461004064359e-02   -3.579103085144193e-02   -1.608681435559671e-03   -6.028570072462287e-02   +9.263928953468294e-02   +4.642556648369484e-03   +3.970476692543985e-02   +3.640858418982776e-02   +5.343459539793342e-02   +7.907082365554232e-03   -1.579825022141283e-02   -2.318376679693599e-02   +4.317381600033886e-02   -5.093084941458954e-03   -7.511760955842930e-03; -8.558707632265855e-02   -4.424440079426167e-03   +7.744388836325958e-02   +3.971598269432292e-02   +2.445690948700249e-02   +2.666162825917182e-02   +4.733805392572626e-02   -1.710329127589170e-02   -1.630606736865929e-02   -1.696405156872867e-02   +3.244612708916086e-03   +2.531286406959300e-02   +3.826489170445327e-02   -5.115931609364533e-03   -6.086364994845054e-02   -2.746583727781565e-03; +1.807253942587013e-03   +7.251030106530917e-02   +9.911712253503163e-03   -5.086729310550397e-02   +1.675798230702681e-02   -7.809347039463980e-03   -2.621076091790100e-03   -8.163710603522244e-03   -4.267599139307453e-02   -2.957133255860226e-02   +2.989970656732213e-02   +6.435167188075354e-02   -2.681527768863807e-02   -6.908836792402506e-04   -3.672521338017731e-02   +4.989224062245086e-02; +9.044276971562590e-02   +7.555399085452935e-03   +2.726509866434364e-02   -5.754972643066612e-02   -5.852735042161122e-02   +4.285764723616549e-02   +3.058617642109747e-02   +3.541381637536038e-02   -1.129455757896705e-01   -8.466125681110517e-02   +4.558076169225164e-02   -3.037084396921561e-02   +2.599071806182066e-02   +1.888633505260404e-02   +1.813543640262441e-02   -4.076961346563679e-02; -9.514973224604839e-02   -1.128085418313135e-03   +5.467772904276361e-03   -1.978158412669207e-02   -1.739207628557286e-02   +6.144778236654852e-03   +3.276048519069820e-02   +5.148126044534263e-03   -4.041705135610611e-02   +1.030009787326646e-02   +1.063050118237193e-02   -4.058961757816874e-02   +3.028620549637090e-02   +2.944314590211102e-03   -2.311398223305549e-02   -1.311119927389933e-02; +1.759321945839256e-02   +1.092789976967091e-02   +4.145099531731962e-02   -5.496507853842633e-03   +3.285757554672643e-02   +5.424585217302676e-02   +3.675665852412386e-02   -5.417674971361913e-02   +1.259630655856956e-02   -1.172376283349817e-02   +3.520701906169831e-02   -1.138465900844911e-03   +3.030619645812194e-02   +8.057201242174124e-02   -2.078540245931387e-02   -5.240210876352273e-02; +5.776551560115399e-02   +3.690190301533971e-04   -1.749633329943728e-02   +1.484997084620642e-02   +9.408513219737191e-03   +9.332094359166243e-02   -3.854566130517037e-02   -1.510073467675366e-02   +2.182655189873427e-02   -2.287013286474460e-02   +3.207763311388093e-02   +2.507903802231549e-02   +1.014021308769416e-02   -3.374913525870467e-02   -2.917985438314342e-02   +2.729981167476090e-02; -6.873353729488686e-02   -4.104154282427402e-02   -2.300814535714944e-02   +8.361562084121265e-03   -1.409818566422791e-02   -1.375651629909131e-03   +4.085345965126319e-02   +5.183035629501018e-02   -2.470662245999086e-02   +2.806070972919627e-02   -4.186113167855329e-03   -2.329900447514220e-02   +5.215750934425675e-02   +4.742823277458694e-02   +3.635302290452707e-03   -7.171513078904102e-02; +1.161683567789961e-04   -2.508596055905057e-02   +1.686023206540788e-02   +1.697128544122439e-02   -1.197155329094811e-02   +1.675878266092985e-02   -1.428308794688427e-02   -4.980706698998220e-02   +9.458206910953482e-02   -6.777020010017688e-02   -4.268520853956606e-02   -2.958600839768707e-02   +1.914898444439586e-02   +1.643507670990613e-02   +2.890338132779445e-02   -2.122442808099961e-03; +5.168560838294151e-02   +7.321263389866458e-03   +2.578601258522850e-02   -2.287856040509563e-02   +5.094234912767778e-03   -1.561492846805672e-03   +2.422792720845383e-02   -2.056310864742816e-02   -1.533311748310011e-02   +2.913480619111913e-02   -1.034108861616527e-02   -2.899066697893599e-02   +3.864006420068348e-02   -5.674548519211463e-02   +8.492336023495986e-03   -3.447236328831273e-02; -5.119436305734314e-03   +2.729002344460126e-02   +1.253297880902021e-02   -6.673991083523262e-04   +4.096500771150390e-02   -3.559295933016951e-02   -5.446537204094172e-02   +3.163701532689273e-03   +2.916463311063764e-02   +1.901117776612157e-02   +4.502148046788387e-02   +5.017494895860043e-02   -1.062125047899271e-02   +2.951226542956036e-02   +1.613755654947321e-02   +9.200335272337053e-03; -6.781511028648071e-02   -1.904412335443989e-02   -1.683121292814849e-02   -4.730689278547369e-03   -1.970972576337291e-02   -4.112738601532215e-02   -1.806782930701814e-02   -5.624359581714714e-03   +3.090828804931373e-02   +6.934248679412122e-02   -2.869337909717347e-02   +6.870235041312638e-03   -6.430471589131632e-02   -7.634652609738059e-02   -3.151467559525754e-02   -6.027180097487417e-03];
L1E_L1I_iGABA_netcon = [+5.561421192212170e-04   +2.362389752840468e-02   -8.185838075480852e-05   +3.049131849660104e-02   +3.236199431589148e-02   +2.783987610331507e-03   -4.202853446950947e-02   +4.571181964435575e-02   +2.093658710482500e-02   -4.885822715871842e-02   -1.848572950981995e-02   +1.147966133876693e-02   -3.522654758688158e-02   +3.806595492010082e-02   -1.627166497827728e-02   +1.479817344075842e-02; +8.266244711726088e-02   -1.174115545331422e-02   +2.769920566696687e-02   -2.472322620456824e-02   +5.892699000036160e-02   -3.028235689287095e-02   +1.314409510554362e-02   -8.276610641565551e-03   +3.091145129793553e-02   +2.512963615696084e-02   -1.122671629987247e-02   +8.096735861171793e-02   +2.439560232379256e-02   +3.954761743478070e-02   +2.068865303293105e-02   -4.174797044533089e-02; -2.790283530421046e-02   -2.097670588871697e-03   -5.381370043130305e-02   +8.033222302443564e-02   +1.317156135027740e-02   -2.673648272550951e-02   -1.139418215391157e-01   +3.673300837888196e-02   -9.530548424754280e-04   -2.839636103914330e-02   +2.818160098673457e-02   -9.010775456264513e-03   +3.076010015674834e-02   -2.752389454370020e-02   -2.843339331296811e-02   -1.292164152217054e-02; -6.126951051517957e-02   +6.919736809866806e-02   -7.699381557884431e-02   -2.090385707456760e-03   +1.877569537291842e-03   +2.928756706068038e-03   -2.668956025606020e-02   +4.379144120768984e-02   -4.860580769244015e-03   +6.501616971186055e-03   +4.639076179191386e-02   +5.498603675218835e-02   -2.374206743805863e-03   -6.282887811640098e-02   +4.388269777552177e-02   -1.917632703310762e-02; -1.446309982741932e-02   +2.037200694284145e-02   +7.052164750815951e-02   +1.459608890366387e-02   +7.616503325440557e-03   +3.263363466390151e-02   +1.247502469951732e-02   +2.873934596607526e-02   -2.356264097498455e-02   +2.091978869363561e-02   -2.319208839121394e-02   -6.829448997042052e-02   +6.667239541419519e-02   -3.961579781824195e-02   +1.871717624997606e-02   +2.708025740826787e-02; -3.957595407708068e-03   -1.399066404025758e-03   -1.178653583403714e-02   -3.390424777704522e-02   -2.101485087596602e-02   -4.763838208696269e-02   +7.955176495163896e-02   +4.844938499510466e-02   +7.754547942400681e-03   +8.723207767917456e-02   +4.972083664799553e-03   +1.633490534118701e-02   +6.401223143566689e-02   +4.515915033773049e-02   -2.965980230107241e-02   -3.275131811869680e-02; -4.219905501311100e-02   +7.769745144235389e-03   -2.111097781950378e-02   -4.856568513150239e-02   -5.935768215171077e-02   +3.440125947907216e-02   -1.160497368943534e-02   +6.907219585333392e-02   -4.278781904398395e-02   +6.363858359445598e-02   +1.993183549388928e-02   -6.504234660062325e-03   +8.256830834501074e-02   -5.673817386690885e-02   -2.813992139574240e-02   +1.190861730182489e-02; +1.528103698124821e-02   -8.894703400374026e-04   -5.010340785839011e-02   -1.074874272790372e-03   -3.324591953456674e-02   +6.967680008368279e-03   +3.297090856473323e-02   +5.228422068660853e-02   -1.337186504380922e-02   +5.573947015992660e-02   -2.004890291151917e-02   -1.345913749405182e-03   -6.810947532166690e-03   -4.613409788940814e-05   +3.290232734941715e-03   +2.038371887020540e-02; -5.686764109449068e-02   -9.977009021463856e-02   -2.017130425893410e-04   +4.588664753396784e-02   +2.186548685023008e-02   -4.141973265606058e-02   -6.225762928602767e-03   -5.185632138335451e-02   -1.013053821272977e-01   -4.340367724965585e-02   -1.118609376040699e-02   +4.414608382305324e-02   -2.682952361784220e-03   +5.205787192156917e-02   +7.712153181038545e-04   -1.146812065716963e-02; +6.746061758501745e-03   +4.107770448189286e-03   +1.285759996391472e-02   +8.558681023958092e-02   -5.145073797078767e-02   +1.042589702385362e-01   -3.093013363955451e-02   -1.404096864357437e-02   +3.999884778950653e-02   +1.674724496147904e-02   -7.749807655654278e-02   +1.751305752421862e-02   +2.108527939234616e-02   -8.374051386874801e-02   +3.400365939974948e-02   +1.735849524980099e-03; +7.280960722120795e-02   -1.526451974661270e-03   +5.451621142417638e-02   -9.459977974816696e-03   +3.333718484263808e-02   -5.859919132726495e-02   -3.140823667216946e-02   -4.318043791924582e-02   -3.354345519577815e-04   +1.975134241947494e-02   -3.781475986678243e-02   -5.678767879915740e-02   -3.453825251481456e-02   -3.165150910086809e-02   +6.613950506146507e-03   -2.603859637300550e-02; -7.352448986470436e-02   +6.656752850572206e-02   -4.935185224147554e-02   -4.501915423607885e-02   -4.966282395840406e-02   -2.569531160440705e-02   -4.753145010325297e-02   -7.367240236519416e-03   +4.029122232969359e-03   -3.091804200199013e-03   -1.085926346470044e-02   -2.655021058377225e-02   +1.875710666213286e-02   -6.400322957888205e-03   +5.680084544719955e-02   -1.263411418515807e-02; +2.310772390009010e-02   +5.302646330964798e-02   +2.281406808346248e-02   +1.702799989459077e-02   -4.543956225703926e-03   +5.111786213595296e-02   -2.080726049246817e-02   -4.185119350876924e-02   -1.717939232674550e-02   -4.946859958393302e-03   -7.265015774016306e-03   -5.685903374964711e-02   -2.257530998598658e-03   +2.876885037813272e-02   -8.735881157227773e-02   +5.731874896766290e-02; +7.621713478888803e-02   -4.255221099189757e-02   -3.576278432992991e-02   +5.044500996211670e-02   -1.871737710297380e-02   +5.320017794545748e-03   -3.817553250614088e-03   -1.036295852737874e-02   +4.372645601633409e-02   +6.178872347677508e-02   -9.617142387632890e-02   +3.538361517786746e-03   +3.962535112446276e-02   +1.205819551529371e-02   -6.362631510386124e-02   +3.196770491106842e-03; -5.203076716765210e-02   -3.530855110687850e-02   -5.566551412197585e-02   -1.749689004183285e-02   +9.032388739166688e-04   +2.741297201192909e-02   +6.021882631850876e-02   +3.977946245809502e-03   +9.600120139899042e-02   +3.658250940780398e-02   +5.106992354877699e-02   -1.123170770956729e-02   -2.211326995875163e-03   +1.617654445038276e-02   +1.555391151819291e-02   -5.955302530362639e-02; +1.781881111415857e-02   +4.690697993482248e-02   +7.708999362133377e-02   -2.096533711479646e-02   +4.280701634449088e-02   -1.667919195965512e-05   -3.464665948771276e-02   +2.760678030394351e-02   -3.430306358464626e-02   -2.777635225742112e-02   +1.704478548208627e-02   -1.076291509917760e-02   +2.652464153771800e-02   +2.154458852974635e-02   -8.793887314693365e-03   -2.190161282216385e-03];
L2I_L1I_iGABA_netcon = [-1.641538843422654e-02   -1.913419142623565e-02   +2.549460144877100e-02   -2.670388837627913e-02   -7.738189579968859e-02   -2.790139206678365e-03   +2.900438833156950e-02   -1.825937500082821e-02; +1.408480903581082e-03   +1.198852261583251e-02   -1.901857323451100e-02   +5.716834781315981e-02   +3.120216688964848e-02   +4.978165618949598e-02   -1.281396635674109e-02   -7.922814009687985e-03; -7.948237684873971e-02   -5.164187434655335e-02   +1.618469427899081e-02   +3.968498312339405e-02   +7.506688757751099e-04   -2.054322444406738e-02   -7.774201705498701e-02   -3.951827950137844e-02; -3.618530882314915e-02   +4.298850717375024e-02   -8.464315641890285e-02   +9.419262127108610e-02   +2.761790746170788e-03   +2.742400221135327e-02   +3.933012374355885e-02   -9.980334760956441e-03; -5.886025399048514e-03   -2.192676941046736e-02   +9.475691071658399e-03   +2.075584793809639e-02   +3.640036988280178e-02   -6.220388271925328e-02   -1.262135415669043e-02   -4.053445881838518e-03; +2.795155093095003e-02   +1.116630804992712e-01   +2.526519305678645e-02   +5.352290226946264e-02   -8.960298955789764e-03   +4.114125552589909e-03   -3.758024786195674e-02   -9.515272407480572e-03; +1.468207610251256e-02   -8.189058370866198e-03   +5.925296568546363e-02   +5.847786499889405e-03   +7.458564041959162e-02   +2.324166429742112e-02   -1.176642684589442e-02   +2.636416300405292e-02; -2.237921355333813e-02   -6.244242143142129e-02   -7.536986394184171e-03   -6.475619667273566e-02   -1.982235644613476e-02   +3.943334630647678e-02   +1.016667559084001e-02   -2.151459211416965e-02; -2.056683218824574e-02   -6.808970255727562e-02   +8.669925092307311e-03   +4.109018675655812e-02   +4.911867560975037e-03   +3.352475205712095e-02   +1.067964816069913e-01   +1.915208613265415e-02; -2.020916402593415e-02   +1.384821137075157e-03   -1.396991625135892e-02   -2.482080568897330e-03   -5.199745730887061e-02   -1.381880523002783e-02   +1.871253021542776e-02   -3.725817742095346e-02; -5.491470263559157e-02   +4.097890205399730e-02   +3.107805589042652e-02   +1.038789019919825e-02   +1.108061914234401e-02   -1.052508900642665e-02   +1.872043485192713e-02   +7.865175705571721e-03; -1.264434669845224e-02   -1.734286373657977e-02   -3.987323682150459e-02   +2.293200622508928e-02   +3.549240710735456e-02   +5.856610439204316e-02   -1.129059704940408e-02   -4.538240707092787e-02; +7.258675364696121e-02   +1.744485582392417e-02   -2.994195996139711e-02   +5.101346395982111e-03   +5.861122610605489e-02   +8.272390056888025e-02   -4.255819986366956e-02   -2.447873890439652e-02; +1.826438082690284e-02   -2.833052068682820e-02   -6.610471643515581e-02   +3.010088050337784e-02   -3.067210145849691e-02   -4.977316426679348e-02   +9.936756638248787e-03   -7.533325872067440e-04; +3.032696708665161e-02   +1.824710175071898e-02   -4.599878518376491e-02   -4.427836820163440e-04   -6.190006944305755e-02   +7.405998766551988e-02   -2.387713136959974e-02   +2.526675140532144e-03; +1.421103900328584e-02   -1.225310626623429e-02   -2.233786243990352e-02   -1.476938508567036e-02   +3.251455852094749e-02   -7.214844831562976e-02   -3.750669104264005e-02   +1.139270324065321e-02];
L1I_L2I_iGABA_netcon = [-3.959776785865945e-02   -1.888502871505409e-02   -9.652536956596802e-03   -2.984668070276918e-02   -8.264363943244762e-02   +3.537801982222842e-02   -1.090570042955908e-02   +1.634650251547345e-02   +5.973439104575483e-02   +3.025431851986875e-02   +7.677802487486165e-03   +1.236292792969570e-02   -3.453956625354392e-02   -2.040001456320345e-02   -8.227616648571817e-02   -7.475681626780556e-02; -2.463228720902143e-02   -2.972884447959381e-03   +4.499049960061591e-02   +1.928277602162729e-02   -6.836555890727646e-02   -1.341228147292525e-02   -3.230349852892764e-03   -4.317692112995471e-03   +7.147075104743326e-02   -6.293777121629319e-03   -6.651731287346995e-03   -3.201914930207771e-02   +1.689805265591728e-02   +2.993749871658402e-02   -1.279154478934650e-02   +1.347735905036760e-03; -1.565730627688933e-02   +1.177341924823454e-02   -5.157486794788629e-03   -4.206722600433405e-02   -2.769824459905801e-02   +2.874253644128241e-02   -1.477060932772965e-03   -5.819548718662901e-04   +3.429556095516569e-02   +1.942773007701415e-02   +3.526477890134851e-02   -2.222293585671743e-02   -3.009358185188787e-02   +2.503873523249305e-02   -4.498997392425866e-02   +5.168380608483379e-02; +2.265350392910434e-04   +7.831628782843951e-03   +2.110569165587616e-03   +1.597983425272289e-03   -4.643485153037204e-02   -2.158454502735191e-02   -2.523179069741273e-02   +5.967446612998428e-03   -3.826133251018994e-02   -5.044340293280454e-02   +3.320038113540782e-02   +5.823785761582916e-02   -6.746566490065699e-04   +1.744566127517260e-02   +6.244751942098498e-02   +1.741470867333911e-03; -4.108032296736066e-03   +1.365245983189114e-02   +3.208193604508289e-02   -1.492230179260863e-02   +2.612104908417863e-02   +3.959464360933986e-02   +6.563903910538940e-02   -2.779884329322732e-02   +8.710267840884631e-02   +4.461589453581098e-02   +1.330391417452699e-02   +2.890060112491864e-02   -4.838698243548666e-02   +4.665696433124068e-02   +1.547237781789347e-03   -5.528589111969349e-02; +3.256225361766308e-02   +4.126062990017698e-02   -2.802049294380690e-02   +4.719741847792291e-02   -1.277664886126677e-02   +1.510171759802028e-02   +3.217934048435821e-02   -1.484226900828269e-02   +1.017015737894340e-02   -1.420095813233516e-02   +4.264967748471217e-02   +2.505022183466356e-04   +8.840489597406515e-03   -7.850963427971466e-03   -1.658063732494640e-02   -5.627860069179191e-02; +1.235231445258092e-02   +3.541887190999525e-02   +1.365323372135537e-02   -1.937732508260167e-02   +7.783479818846234e-02   +3.831165702677543e-02   +2.728813644969966e-02   +1.955881933543477e-02   -1.190441532428897e-02   -7.659918728444809e-02   +4.552093128639173e-02   +5.478696422161775e-04   +1.875001122424427e-02   +6.552238100893416e-02   +5.421598157923707e-04   +1.278829771630018e-02; +4.183033498520857e-02   -7.383959263892655e-02   -1.060115618283742e-02   +6.504435424937505e-03   -6.227147171127269e-02   -2.596559393031182e-02   -6.831326472813540e-02   -4.901865510721547e-02   +1.329162276191811e-02   +4.236435036211060e-03   +4.791907135257993e-02   +5.200562266119855e-02   -8.370090186946647e-02   +2.146217943200872e-03   -1.631496245341617e-02   -5.938069139711589e-02];
L2E_L1E_iAMPA_netcon = [-8.416552376419204e-02   +2.170410312053235e-02   +3.425383530852604e-02   -2.690408330315019e-02   -2.958651798194505e-02   -2.480479085778259e-02   -1.614814339837867e-02   -3.631963413525489e-02; +6.545900265150923e-03   -5.173369167231932e-02   +1.245798950117774e-03   +5.750012329224736e-02   +7.879445754578603e-02   -2.962726829306059e-02   -1.946431139576993e-02   -4.269247057079546e-02; +3.310237323275974e-02   -6.842931304282986e-02   -7.724337402481014e-02   -4.178752459581228e-02   +1.933854556614791e-02   +3.183179754322414e-02   +3.764471902959826e-02   -2.106686232550352e-02; -7.658166122441159e-03   -2.755062269203740e-03   +2.512874494093001e-02   -1.331570730336297e-02   +1.381290278036651e-02   -3.537556789043438e-02   +3.257606136166673e-02   +6.113293938026935e-02; +3.106526336069357e-02   -3.643703179400862e-02   -1.573435945464742e-02   +2.835806700272125e-02   +3.559916293763080e-04   +4.572602739684985e-03   +2.935449231336423e-02   +2.727214065844323e-02; +3.856606336440725e-02   -2.972893716144157e-02   -3.119598744600072e-02   +6.211080212754808e-02   -4.901424348247214e-02   -3.272207351318079e-03   -1.278071296001285e-02   -1.971678080702092e-03; -5.753112536624162e-02   -1.082254234847311e-02   -1.830880478711091e-02   -1.924203617794812e-02   -2.140319786640565e-02   +1.878819567762539e-02   +2.041669720593188e-02   -2.492370640785721e-02; +5.396881192037347e-02   +1.171726508925374e-02   -9.115045216659571e-03   +3.992882596106040e-02   -2.197189215811134e-02   +2.201148882780290e-03   -4.902322920133884e-02   +6.881768669979216e-02; +1.072253309628382e-02   -4.007274937776438e-04   -4.704443920181553e-02   +7.541916429540763e-02   -4.957598885177917e-02   +5.772354176273682e-03   +1.659086232316451e-02   -5.646927636137022e-02; +7.478247028379280e-02   -2.531046206123536e-02   +6.641190589876973e-02   -5.201923149691264e-02   -2.792748483202223e-02   +3.429913559587895e-02   -5.854743909743231e-02   -3.616176790088001e-03; -3.637800775501154e-02   -2.677242019254573e-02   +3.911095943320327e-02   -3.877551324143182e-02   +9.338190727900540e-02   +5.539025434166050e-03   +3.374015913068525e-02   -3.500174124977090e-02; -3.020224952389964e-02   +1.071470425253401e-03   -1.207806333120917e-02   -4.691392674826809e-02   +2.099100783894606e-02   -2.357007024760900e-02   -4.443969550045888e-02   -2.127336652405229e-02; +2.242945370697154e-02   -5.908102467997538e-02   +7.236095216652767e-03   -2.530498581717466e-02   -5.294271749956937e-02   +4.975820231398287e-03   -6.935989460342608e-02   -6.929808312831577e-02; +1.588136779455112e-02   +7.030471189361270e-03   -1.597460471646217e-04   -1.415088004696044e-02   -5.099485586568981e-02   +3.201194929960727e-02   +2.332136507201302e-02   +5.281820712039494e-02; -5.836982545616362e-02   -2.345181685656011e-02   +3.730535504947331e-02   -3.770466784568971e-02   +3.423262892900809e-03   -3.317397468204950e-02   +2.752662341858288e-02   +1.893172874538227e-02; -4.312763543785208e-02   -1.917767463552838e-03   +1.935244355860236e-02   -6.085759818450343e-02   +3.808311046547630e-02   +3.471589501919391e-02   -6.140865637817332e-02   +4.434406875619743e-03];
L1E_L2E_iAMPA_netcon = [+5.187769555061991e-03   -5.077909214774566e-03   +3.168494293971151e-02   -7.555553310318901e-02   -4.081220873057213e-02   -2.669658856737896e-02   +8.459867870810271e-03   +2.596081717030531e-02   -5.284920122862147e-02   -1.052046329369009e-03   +3.603736150549963e-02   -2.080334349021300e-02   +2.465893663326911e-02   -3.765004080816461e-02   +2.593774821211182e-02   -2.174159036580544e-02; +2.784075073929074e-02   +1.445342863946788e-02   -3.740797285603037e-02   +4.026417463781753e-02   +4.393545612861731e-02   +9.177548177458306e-03   +2.563879296500718e-03   -2.489223637182586e-02   -2.014792736338767e-02   +3.641420789365636e-02   -5.336904401957630e-02   -3.293939946377739e-02   +5.611354240674715e-02   +1.645738439890633e-02   -6.551210741108771e-02   -1.333702724547233e-02; -1.214765327920968e-02   -2.673583831365163e-02   +5.601975465846370e-02   -1.256552122467497e-02   -1.320782520318330e-03   +1.296536300580818e-02   +2.869074436349685e-04   -6.257045234876576e-03   -1.423609521730923e-02   +4.930110784345542e-03   +2.332084592861732e-02   -3.530072539022974e-02   -1.029127409032702e-02   +8.047369294836781e-04   -2.573212718130205e-02   +2.922878968957229e-02; -8.910979403476094e-03   -2.376429659989141e-02   -2.442567640089047e-02   +3.277381164768052e-02   -2.249454472793286e-03   -7.548105371260982e-02   +1.271587868458817e-02   +4.780384384637595e-02   -6.832943531441509e-02   -5.791179030140500e-02   -1.999105103022154e-02   -5.707077133786913e-04   +1.516352730541956e-02   +4.346506395113567e-02   -5.004069611835280e-03   +2.087480397615479e-02; +6.981652203835641e-03   +4.558496361258879e-03   -5.814011772622988e-02   +2.470119929643168e-02   +2.160749711684157e-02   +5.017467789447200e-02   -5.153395132496810e-03   -2.596729328621183e-02   -2.079594015120999e-02   -3.159679122677416e-02   +1.153199206150814e-02   +9.450992443483224e-03   +3.195871444088520e-02   +4.683615856542192e-02   +5.553179151687679e-02   -1.159338500306884e-02; -3.910899676499650e-02   -1.834030751246486e-02   +4.327224933886539e-03   +3.128161452860347e-02   +7.529639913729643e-03   -8.596627185551445e-03   -2.213197226859138e-03   +9.259360842057588e-03   -7.757787014824356e-02   -1.955496404003387e-02   -1.287620475214431e-02   +6.803380275517039e-02   -3.188539534108996e-02   +1.321043635832611e-02   +3.827276358059979e-02   -1.115012455592758e-02; -2.145063978892527e-02   +9.207837404246733e-02   +2.838299114307549e-02   -1.023464357324914e-03   -5.687634687698299e-02   +7.121925692990524e-03   -1.319043879177235e-02   +1.239809806268827e-02   -1.469985012764408e-02   -3.321321107969476e-02   +3.154496163785288e-02   +3.454028760559274e-02   -5.168686892472555e-03   +6.976881164175727e-02   -9.681587501596091e-03   -3.287655395227524e-02; +2.601017058204216e-02   +3.125885186673249e-02   -1.106606493844534e-03   +1.295977722638581e-03   +4.706352899311399e-02   +9.021433470710023e-02   +2.734001461627061e-02   -1.823537578284022e-02   +2.487697326807776e-02   +4.217269940131652e-02   +3.533745157326913e-02   -1.651449318441600e-02   +1.081634421116713e-01   +1.882321291431720e-02   -1.509722095068015e-02   +5.867242007364318e-02];
L2I_L2E_iAMPA_netcon = [+2.738428766079627e-02   -3.180066504326692e-02   +1.397508902054847e-02   +7.587746292382119e-03   +7.996547680730505e-02   -2.891928824172217e-02   -1.610646304881177e-02   -9.099954608787143e-02; -2.128279997217156e-02   +1.112316569656438e-02   -1.852587190042542e-02   +7.423832644607498e-02   -1.484463163018597e-02   -6.991002748293115e-04   -3.860495101093585e-02   -4.046122226600673e-03; -2.822202904481424e-02   -5.788737904530186e-03   +2.666048274901128e-02   +6.183736671783484e-02   -6.331521451721780e-02   +4.267591209123500e-02   +5.046075632717024e-02   +1.826322731277105e-03; +4.928929812244813e-02   +1.406181325380912e-02   -5.694963478941904e-03   +2.981056744807721e-02   -7.284648458924629e-03   +2.404567230854493e-02   -2.390624952557430e-02   -1.697943238182746e-02; +4.651694958781938e-02   +4.491488621976755e-02   +2.173780539732315e-02   +1.971438066100797e-02   -4.571330145328846e-02   -6.647314916542908e-03   +5.625849455821423e-02   +7.410069268350325e-02; -5.286925083379196e-03   +2.397771595650563e-02   -1.528814325282013e-02   +4.250267603320407e-02   +6.835872577004576e-02   -5.926396647854870e-02   -6.461484301199968e-02   -2.570222534773882e-02; +3.827492954873851e-02   -2.520681711783602e-02   +4.731940041351836e-02   -1.113254053889642e-02   -3.161265261382572e-02   -1.621726606437522e-02   -1.285522950323945e-02   +5.574658907815711e-03; -1.334921657242080e-02   -2.027313033018014e-02   +1.409038525902708e-02   +4.084372949711240e-02   +9.269431884200947e-02   -6.349714428896704e-03   -3.564552934058079e-02   +5.059026634365608e-04];
L2E_L2I_iGABA_netcon = [+6.694494978483678e-02   +3.863561105577893e-03   +1.719371739630819e-02   -2.714247537363696e-02   -1.630068644017702e-02   +9.304214078896140e-03   -3.674396909903434e-03   +3.770784180087721e-02; +2.404879772171034e-02   -1.131348699130809e-02   +1.295940189648855e-02   -5.037696025743919e-02   -6.134645967248070e-02   -3.715579610060704e-02   -7.200971435701252e-02   -3.429845412158291e-02; -3.219237439279984e-02   +2.541958415243412e-02   -4.019425518574461e-02   +5.781293329938478e-02   -5.188845950970938e-04   -2.901168068879489e-02   +2.195421155167212e-02   -1.582932134006816e-02; -3.767939133986832e-02   -9.239254050521888e-03   +8.215431402570492e-02   -8.863636388945684e-02   +4.460308849320306e-02   -7.120249351547430e-03   +3.299225684053633e-03   -8.001175016514074e-03; -3.197051012147183e-02   -3.132244372977840e-02   -2.671261150703143e-02   -2.327595668037629e-02   +5.131594390951500e-03   -5.531374172401317e-02   -3.726885594188670e-02   -3.781320346323147e-02; -5.492720541028920e-02   +3.226085659137598e-03   -9.425700129821357e-03   +2.370871478111318e-02   -1.817297211785907e-02   -5.179492906458180e-03   +6.440408160956262e-02   +7.086694861128053e-02; -9.119580657755220e-03   -3.300882658160435e-02   +1.475620692219600e-02   +6.685821061279064e-02   +4.015216107091167e-02   -3.009875285977525e-03   +6.811276428227633e-02   +3.512457732038990e-02; +3.385919673064408e-02   -1.703420319589705e-02   -6.538394310080199e-02   -5.593198144874889e-02   +1.552307707551795e-02   +6.888557756901126e-02   -6.111609859550129e-02   +1.787274031342996e-02];
L3E_L2E_iAMPA_netcon = [+1.918196890647850e-02   +5.355905530686316e-02   +2.834839146777995e-02   +2.556538604586614e-02   +1.360864473924637e-02   -1.694724384118870e-02   -3.145314379403865e-02   -1.126438310829464e-02   -8.933847602656244e-04   +8.545915178892613e-02   -2.574328381951896e-02   -5.610730524621632e-02; -2.788057470531857e-02   -4.040687867054990e-02   +2.078983507320464e-02   +2.878160523364102e-02   +4.095179754143431e-02   -7.801526274353007e-03   -1.939121338228835e-02   -2.978667267158214e-02   +3.734239507903299e-02   +5.424717050061742e-02   +2.938116037308331e-02   +6.322647303874551e-02; -5.984034709296134e-02   -4.240225286276127e-02   -7.660440484072550e-02   -4.429895220397564e-02   -6.035393927436652e-02   +5.273610678402832e-02   +3.006358222141335e-02   -5.411351675726596e-02   +1.231694834188902e-02   +1.388924144762010e-02   -2.773910380156121e-03   -2.095952824559683e-02; -2.242342781521419e-02   +1.961764034317929e-03   +1.370772627635682e-02   +5.869858978973333e-02   -6.755099933486808e-02   -1.379039412232887e-03   +4.538035197605052e-02   +5.192384388211813e-02   +7.297201375288803e-02   +4.407115999398979e-02   +3.212116736643991e-02   -1.759423982444925e-02; +3.326608021611355e-02   +3.776856856138175e-02   -2.521854049302762e-02   -3.708467379347041e-02   +1.235088216184068e-02   -3.398241214522986e-02   +6.943022041214761e-02   -1.862181577332295e-02   +2.449757841081533e-02   +7.920538772560985e-03   -5.447437111251036e-02   -7.274484036150181e-02; -2.370168405361829e-02   +6.243126234777033e-02   -8.244790293953790e-03   +5.256805325026537e-02   -2.925872083099149e-03   -2.665578542087113e-04   -6.285435021496340e-03   +4.077665634651656e-02   +1.567044753853072e-02   +3.316868486888820e-02   +1.571084607019584e-02   -3.868395283207339e-02; -1.499682659984757e-02   +4.075338853452716e-03   -5.744087405709589e-02   -2.109167343873057e-02   +1.293336878839100e-02   +5.284084130537438e-02   -9.925382299689339e-04   -5.068226068439709e-02   +7.107157503411614e-02   -1.908216002368830e-02   +5.586529669962013e-03   +3.398006483629799e-02; -4.308954294061845e-02   +2.361516084849271e-02   -6.182497501186787e-02   +3.715278203647011e-02   +2.147228074591344e-02   -2.655235964766730e-03   +1.644831776274823e-02   +4.494449376067707e-02   +3.309856644985085e-02   +9.196324241202078e-03   +3.034502174828819e-02   -4.742697753807583e-02];
L3I_L2I_iGABA_netcon = [+1.727516485293137e-02   -1.369114421846760e-03   +5.894702346645184e-02   -2.335462916070528e-03   -5.103488595832423e-02   +4.858262634712082e-03   -9.386999696879977e-04   +2.708603150908182e-03   -5.433872779307054e-02   -3.416691910878657e-02   -4.615243242413601e-02   +1.123930944724220e-02; -4.835655772812397e-02   +8.508408079173721e-02   +1.553406835889899e-02   -3.839586464575518e-02   -3.029962768800621e-02   -2.225434853538493e-02   -3.155953806744015e-02   -4.438234432224150e-02   -1.153359010620050e-02   +2.724203849198914e-02   +9.899782065662924e-03   -1.707181565220089e-02; +2.047054383623635e-02   -8.740364595765000e-02   +6.588599965193995e-02   +2.308609218385060e-02   -4.346125059320138e-02   +1.272463536464256e-02   +5.722096176385590e-03   -1.760822619101456e-03   +2.018324608650264e-03   -4.209183117625609e-02   +2.114430936198558e-02   -3.771293075121089e-02; +3.611137225506841e-02   +9.752724061671028e-03   +1.721125421714115e-02   -4.718870444533257e-02   +3.479685835175394e-02   +7.368261198503292e-04   +4.043429735184741e-02   +4.246860456891467e-02   -1.484234135661548e-02   -7.239979866069564e-03   -1.151613211121257e-02   -1.215190475912015e-02; +2.214371218956809e-02   +4.924826056860859e-02   +2.366946704815591e-02   +2.645531516659305e-02   +3.354487113412039e-03   +2.734031951726890e-02   +1.733236712164115e-02   -1.236386263219936e-02   -1.653143002991041e-03   -3.480130017085198e-02   +3.444850800982998e-02   -7.159461678989266e-03; +1.665814688141513e-02   +2.372161806367995e-02   -4.497091725187992e-02   +2.632713666615707e-02   +9.469679390455843e-02   +2.701460094048999e-02   -1.524965542568950e-03   -3.688668858996346e-02   -4.737485876640669e-02   +1.060151316784214e-02   -5.601467191199024e-02   -4.290082373961523e-02; +1.335037527549476e-02   -7.149929078603116e-03   -6.000490925385227e-02   +2.175584749000878e-03   -1.954338712929674e-03   +7.490637800731977e-03   -2.779213900012553e-02   -5.542729824000702e-03   -5.534830714614120e-02   -3.167583462286633e-02   +2.415067929054113e-02   +2.056057962181662e-02; -5.125975115175496e-02   +1.954120863337429e-02   -5.338193037310859e-03   -2.360235199551076e-03   -8.634628145710632e-02   -3.170482432301056e-02   +5.920287614335515e-02   -5.788550496357858e-03   -3.424159519668056e-02   +2.027504674713979e-02   +3.596351331978280e-02   -1.198489490892345e-02];
L2E_L3E_iAMPA_netcon = [-1.251038213954329e-02   -6.208958414903828e-02   -5.819614441741063e-02   -6.750067285438538e-02   -2.305676918949455e-02   -5.365971568546138e-02   +2.464460801927999e-03   -6.536900047958472e-02; -1.506404474838731e-02   +4.890070937320881e-04   +5.824655761783366e-02   +1.091959002578096e-02   -8.865294785654969e-03   +1.125393795256604e-02   -6.704845984833238e-02   +7.335368459729467e-02; -2.464109937901173e-02   +3.158579585340425e-02   +1.427915172009532e-02   -1.452165248728946e-02   -2.622437966936311e-02   -1.584447146337562e-02   +3.976866868392836e-03   +4.646355167777363e-02; +4.233840636520593e-02   +2.428309730344478e-02   +1.529481408417696e-03   +1.426954239908663e-03   +7.933530322979762e-02   -3.917876268808058e-02   +1.208311980990291e-02   +2.008019383498531e-02; -3.068406402772271e-02   +2.061151088820981e-02   -3.891523069838603e-02   -5.406472617810580e-02   -3.087254870664441e-02   +4.965594943452785e-02   +2.053789661801916e-02   +1.374836179710584e-02; +3.111313840845202e-02   -5.301630990862725e-02   +7.096633831335243e-03   +4.191936403772537e-02   +2.779338300044375e-02   -4.202211794605732e-02   +1.814596818801338e-02   +4.875382186760976e-02; -8.457076996625908e-03   -1.031354675998395e-02   -1.216698431728130e-02   +2.349516906080924e-02   +3.828365486728995e-03   +4.019615686063065e-02   -6.091568791834631e-02   +3.538740838285080e-02; +4.670256089653507e-02   -2.832126457577785e-03   -1.159232700400967e-02   +4.453071865096612e-02   +6.427374906741441e-02   -1.654964756340994e-02   -2.324551999971267e-02   -3.149172607386791e-02; +3.197295599902424e-02   -2.354404983923011e-02   +2.574917705123468e-02   -2.838507466823485e-02   +3.424832205702573e-02   +5.784151040616208e-02   -2.121195618571380e-02   -1.846713202306619e-02; +1.888297504537925e-02   -8.391790065797820e-02   +1.955851645137665e-02   +2.820355729324741e-02   -2.065458547229235e-02   +3.369435315411032e-02   +3.836411946878442e-03   +6.574361354412402e-02; +2.473092107030698e-02   +1.700222349571925e-02   -2.758159432657718e-02   -3.947219547731312e-02   +4.164258011316420e-02   -1.764145624344058e-02   -6.984473487017538e-02   -3.826266669934719e-02; +1.130138203334982e-02   +9.592142106880601e-02   -5.938533969098887e-02   +1.133342676558219e-02   -1.884883559941652e-02   -4.968247536238765e-02   -1.212072069226032e-02   -2.514926392264710e-02];
L2I_L3I_iGABA_netcon = [-3.094966504413079e-02   +3.940029030424952e-02   +4.873512963822088e-03   +1.580086686508074e-02   -2.376594871722830e-02   +4.386421654288893e-02   +8.705430316486145e-03   -1.885492226713411e-02; -2.626074093935277e-02   -1.381633199016714e-02   +2.204751280348731e-02   -1.156533971445852e-02   -5.483911139645985e-02   +1.069413457753018e-02   -6.331886376626019e-03   -7.737122268692519e-02; +1.018256269635245e-02   +2.761769532574591e-02   -6.391288363047629e-02   +2.978307311126739e-02   +1.074888577547178e-02   +2.880893984439814e-02   +7.169932857043568e-02   +2.090143715024110e-02; -2.154771925401695e-02   -1.563554486977564e-02   -1.328850095724171e-03   +1.404979172904385e-02   +1.782370696226716e-02   +1.279954902997467e-02   +4.744502322292203e-02   -3.275103032028109e-02; +3.591806160386762e-02   +1.818634173905710e-02   -9.085181336651836e-02   +3.296438912494895e-02   +4.164481019059182e-02   +8.412955837826641e-03   +3.009234225788149e-03   +1.561932363335813e-02; +2.767155961698386e-02   +2.045040051884282e-02   -4.576710567002712e-02   -3.448976134662128e-02   +1.845740235577233e-02   +6.570772155607035e-02   +7.121643050667931e-02   +2.656084442761356e-02; -3.170164087307462e-02   -8.407884602622148e-03   -4.883079857005616e-02   +5.024630723562015e-02   -1.591526010201359e-02   +1.436226462190707e-03   -2.799875669344930e-02   -2.392339816554568e-02; +3.632512991758644e-03   -5.571631680176218e-03   -3.957801418661908e-05   -2.077809919410519e-02   +5.396402094765920e-02   +2.054612064960394e-02   +6.347633623546293e-03   -2.665347405111215e-02; +1.348886553952831e-02   +1.085366762407556e-01   -1.612093601177732e-02   +8.189223372074236e-02   +5.217988718353630e-04   +2.298291650665755e-02   -1.813612891064972e-02   -1.643481961487915e-02; +7.213263365105983e-02   -9.325798637220214e-03   +1.211859469786082e-02   +2.144445034220344e-03   +2.612031434356233e-02   -3.988467856190986e-02   -5.428376668369148e-03   -1.640770014750859e-02; -2.434085279884096e-02   -1.083799089593821e-02   +4.668921078057374e-02   +4.704558645522577e-03   +3.044226734848192e-02   +8.446214859521767e-02   -4.525512021006532e-02   -1.618467906601610e-02; -5.329112343404906e-02   -6.894061230281013e-03   +3.972313762096008e-02   +1.060981332554814e-01   -1.218785245161663e-02   -1.374674406745421e-02   -5.733969936793731e-02   +3.840123751776866e-03];
L3I_L3E_iAMPA_netcon = [-1.979500462837101e-05   -6.715764854728343e-03   +5.431506532402709e-02   +4.133990390701468e-02   +2.573858336088639e-02   +1.731659012000209e-02   -6.196122521520256e-02   +4.163352102087242e-02   +3.249862336251105e-02   -6.586376323499951e-02   +1.427428480485573e-02   -3.218666847414797e-02; -2.281525000309012e-02   -2.749222100687182e-02   +3.219911235594800e-03   +5.119422768823632e-03   +1.675583696948093e-02   -1.817595065084467e-02   +2.518196339124770e-02   -1.585070745477560e-02   -4.543494124497810e-02   +2.140852235041937e-02   -3.985022116950940e-02   +3.999905549352495e-02; -1.263048285172360e-02   +3.652465742816220e-02   -1.935183764928506e-02   +5.098821871713181e-03   -7.758863993930110e-02   -1.311180467060669e-02   -1.920190812878730e-02   +2.602455818210768e-02   -4.974036264544055e-02   +3.930419626023040e-02   -4.272748512023854e-02   -8.145874346904275e-03; +2.728070385695675e-02   +9.589293990675658e-03   +4.954393258622941e-02   -4.853978769329442e-03   -3.064229616009755e-02   +1.683306807815192e-03   -1.417206132594527e-02   -3.805492450443160e-02   +2.709405248297348e-03   -2.824519798825271e-02   -3.055411994224580e-02   +3.161096296740649e-02; +3.444956331601436e-03   -3.572321266103592e-02   -4.566156493407474e-02   -1.628425484541641e-02   -1.714643619544531e-02   -2.010958200616266e-02   +1.567581123666524e-02   -1.516779110615245e-02   -8.640893951087987e-02   -6.549127944218801e-02   -4.535716036879345e-03   +1.737659207041534e-02; -6.135219661359086e-02   -1.870747092825268e-02   +1.046034088353566e-01   +2.127759363151049e-02   -6.994092056742743e-03   +8.267396875054808e-02   +1.362423529302043e-02   +3.260141399692647e-02   -1.597119794558569e-02   +4.053271193198901e-02   +9.636797861152234e-03   +9.454476097610015e-03; +1.006075091413500e-01   -3.717750508632037e-02   -7.199231954051900e-03   +1.237535424563547e-02   +3.293801430461919e-02   -3.546439676662196e-02   +2.419304290183179e-02   +8.256891935917300e-02   +4.028496170059440e-02   -6.311282356740554e-02   -4.011480871707825e-03   -2.390280963738387e-02; +2.713661572391875e-02   +3.835498577329807e-02   +1.095102859554596e-02   -5.836784763005184e-03   -1.110178161500801e-02   +1.959088295291965e-02   -1.499512045529620e-02   +1.609613827869067e-02   +2.345272859385947e-03   +8.877516167963423e-06   +3.997670840755692e-02   -9.608052919310323e-03; +6.553684614805237e-02   -2.069698626370935e-02   +3.452330340612782e-02   -1.000696927154035e-02   +1.304545734770789e-02   +1.170814235367188e-02   -4.415972828449723e-02   +4.897835192470858e-02   -3.713043806466190e-02   +5.759997773894220e-02   -7.431196815270572e-02   -6.089497480761169e-02; +1.398596760013853e-02   +2.833926116721292e-02   +2.609557335974430e-02   +3.913166487028375e-02   +2.147192810011528e-02   -5.605781000119341e-02   -9.056685905224268e-02   -1.303723662539445e-02   +2.977166115374744e-02   +4.471510494643130e-02   +1.352581315815793e-02   +1.911407242655580e-02; -6.010517305727932e-03   +5.716480147326890e-02   -5.177628509179347e-02   -2.249320284418280e-02   -4.774068494809268e-03   -7.109544401598156e-03   -8.900892559152973e-03   +2.016553204986545e-02   -6.416204196592835e-03   -5.478677508659343e-02   +3.088723805338467e-02   +3.045857834027452e-02; +4.969092764153576e-02   -1.528528082712187e-02   +6.309480188663144e-02   +6.256140639524384e-02   +6.379437151725867e-02   -2.496019571294737e-02   -8.856884101272035e-03   -5.161650657833155e-02   -1.155597347098489e-02   +7.733087651908659e-02   +2.165489835928018e-02   -1.210496126659564e-02];
L3E_L3I_iGABA_netcon = [+2.084179892589245e-02   +5.726014200971852e-02   -5.068228567206589e-02   +1.551647626210107e-02   +1.784834391224661e-02   -6.207068357818722e-02   +1.478497050923455e-03   -3.281961133674380e-02   -8.204215530296110e-03   -4.058968864070700e-03   +7.052986032539868e-03   +1.327891328859125e-02; +1.263603565803262e-02   -2.010994663329631e-02   -5.295519833271770e-03   +4.861565913580712e-02   +2.273322956670782e-02   -9.447872431522919e-02   +1.096860742495866e-02   -3.188902569189965e-02   -5.823247859389907e-02   +1.160701170506888e-02   +6.322282672595926e-02   +2.128198000671089e-02; -2.214783182750322e-02   +3.879020365465287e-04   +2.270770866233150e-02   +5.918328626136581e-03   -1.272796504569955e-02   +2.399148317719601e-03   +5.646401795720660e-02   -6.305588284644916e-03   +6.543948785766247e-02   +5.134552983150616e-03   -1.994360275391259e-02   -3.690702846762857e-02; +5.827278061405296e-02   -1.705821621918310e-02   -2.491886197319095e-02   +2.464786481393644e-02   +5.084381526232805e-02   +3.847464708015840e-02   +4.938219996910434e-02   +6.613521449499080e-02   +6.523859841440111e-02   +5.218562926370895e-02   -9.184071575562620e-02   +8.395911388626850e-03; +4.627924448797435e-02   -1.049808457526422e-01   +5.288694053670020e-02   +7.059604679076084e-02   +1.091521513272091e-02   +3.042531934525181e-02   -3.098206707622286e-02   -6.193405039527391e-03   -4.289072461675985e-03   -5.117745619678372e-02   +5.035382263775049e-02   +5.316336461233513e-02; +3.321344676595465e-02   +6.088507411352598e-03   +1.596064969342959e-02   -7.791240724569784e-02   +1.427113541945546e-02   -4.801156092649146e-02   -8.826182586983734e-03   -3.764298281262501e-02   +2.151569416478494e-02   +1.611532233142001e-02   -3.701964722389434e-02   -1.419402484409871e-02; -1.286057163648674e-02   +7.015450212739839e-04   +7.061198346233999e-02   +4.728956669643746e-03   +3.530044807495197e-02   +5.748195814616676e-02   +1.766287298578152e-02   +8.285475322256670e-03   -3.288173317602411e-02   +9.152782700385836e-02   -1.167902855733652e-02   -2.428009668005561e-02; -1.724297523047109e-02   +5.596179223055327e-02   +4.405708319232496e-03   -4.038912627008792e-02   -3.883456289141428e-02   +2.302122850849933e-02   -1.891074550492308e-02   -3.276601002776135e-03   -2.681014913143409e-02   +2.860587361905898e-02   -5.240205728594866e-02   -1.931524896164387e-02; -2.173661319344613e-02   +3.459018535120433e-02   -1.866815818187387e-02   -9.645117640884578e-03   -4.378964953393184e-02   -1.641117158765581e-02   -2.528316930844204e-02   -3.378177217788924e-02   +6.681983285633943e-02   +3.799300909426213e-02   -6.965739812200457e-03   -5.494152326855674e-02; +6.190619457458559e-02   -4.650937374257795e-02   -3.365427796440536e-02   -1.054999711685019e-02   +2.842570690127094e-02   -1.615482039669448e-02   +2.100163408157583e-02   +3.724145509089526e-02   -4.471243477769338e-02   +1.362705275388670e-02   -6.588939005990671e-02   -6.353765715180314e-02; -2.856872285083268e-02   +8.267423902857426e-02   -2.598889746255320e-02   -3.154542568757330e-03   -5.454725958535006e-02   +3.504323908422181e-02   +1.233658486824104e-02   +3.884446907588355e-02   -2.161672938620774e-02   -3.105442770611048e-02   -4.419137336254245e-02   +3.136482290416742e-02; -4.348310862518007e-02   -1.157329410162539e-02   -9.253921099559647e-03   +3.772192060770758e-02   +1.958786228187185e-02   -9.954384074158759e-03   +4.322327674169028e-02   +8.961149787431046e-03   -6.906820487131416e-03   +8.883647546470837e-02   -5.961180877978103e-03   -4.893866158901083e-02];
L2E_Input1_iAMPA_netcon = [+1.990223589540063e-02   +4.704977222370387e-03   +5.533775480618393e-02   -4.315141509778579e-02   +5.962612941623428e-04   -4.375996201764362e-02   -6.584227300716491e-03   +3.782541767149784e-02];
L2I_Input2_iAMPA_netcon = [-7.998918854820149e-03   -6.879262248200811e-04   +1.166000564823992e-02   -4.333985345365197e-02   +8.120059963853564e-02   +4.259696476640652e-02   +3.174628251597221e-02   -7.437372701581259e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
