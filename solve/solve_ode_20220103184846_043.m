function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147639797839854e-01   +9.462539881774515e-01   +6.992660951023729e-01   +1.554756445314139e-01   +9.217696808703874e-01   +2.195155010428162e-01   +7.404499469097533e-01   +3.018632838556308e-01   +5.327331403737758e-01   +8.294803174089883e-01   +9.688593487818629e-01   +9.644173927145999e-01   +6.958500618415289e-01   +3.712412231827911e-01   +2.974216253968144e-01   +3.787035751716897e-01; +3.447717710745832e-01   +1.360764318247496e-02   +1.413752829489353e-01   +1.751762586479290e-01   +7.158575256117086e-02   +8.072400564503820e-01   +7.949263317766531e-01   +7.579821237349459e-01   +7.844928764856044e-01   +1.815064548440513e-01   +4.661908084496710e-01   +6.563461522731803e-01   +3.755745954131351e-01   +2.749033537904284e-01   +6.854521631654941e-01   +9.532154085343474e-01; +2.079133200561227e-01   +4.674835736075443e-01   +8.354925823335295e-02   +7.033834045074547e-01   +3.141425091073426e-01   +3.823370710445868e-01   +6.637108456205433e-01   +9.526723512996391e-01   +4.878415435325049e-02   +9.265995977705429e-01   +8.695133597721465e-01   +2.090930796867177e-01   +5.413991466669308e-01   +7.527190674748051e-02   +7.723727053389432e-01   +8.114147028331240e-01; +2.505428010111925e-02   +4.897602547399491e-01   +4.330255173330803e-01   +8.318181657035885e-01   +6.273501528462646e-01   +8.564595773878994e-01   +4.420863237843765e-01   +8.179248968071684e-03   +4.628266324023913e-01   +4.205158126274177e-01   +9.459434097984376e-01   +8.977490690794672e-01   +5.181040652903588e-01   +1.510886540515863e-01   +7.204907163349018e-01   +8.914502714548301e-01; +7.658126417092037e-01   +5.155171085310598e-01   +8.948310251985070e-01   +8.155592407868073e-02   +9.053177850139061e-01   +3.242971063318849e-01   +5.749511301738497e-01   +4.074206926338783e-01   +9.382788512678165e-01   +3.010956642398497e-01   +2.325338347212385e-01   +4.880090270156632e-01   +7.639948295197607e-01   +3.649020580633777e-01   +2.785336527896223e-01   +6.812304577544588e-02; +5.709040358416736e-01   +2.872569087832622e-01   +7.323231627792661e-01   +8.353708761699292e-01   +7.969816175679699e-01   +3.791833965179033e-01   +5.179293739075495e-01   +1.510686037993339e-01   +4.725444141174435e-01   +3.484688702462361e-01   +9.184980104853137e-01   +6.613684479817156e-01   +7.965712266052821e-02   +7.183151609924404e-01   +1.363044140870584e-02   +9.030691235598546e-01; +5.764342696171887e-01   +5.646954109470866e-01   +6.800878563123929e-01   +5.409567975642773e-01   +6.428354243694455e-01   +6.371770990538425e-01   +7.246555593389177e-01   +8.211205347297533e-01   +7.789408990831452e-01   +9.723777054528612e-01   +6.348551539048128e-01   +5.262129724929513e-01   +5.106884461956062e-03   +5.327731611589587e-01   +1.480758297839501e-02   +6.680514876942422e-01; +3.907090235552893e-01   +5.098303829834314e-01   +2.010570479370285e-01   +9.627172278438635e-01   +4.403613110906225e-01   +3.880950191473159e-01   +2.227281019815118e-01   +2.875243637612785e-01   +1.093028560884501e-01   +5.309623206340837e-01   +2.836178030126087e-01   +7.083634534624854e-01   +4.001935454455297e-01   +2.325899290731858e-01   +9.367865702530088e-01   +3.468825671025630e-01; +5.564859572154603e-01   +6.782587487649121e-01   +5.293603016459941e-01   +6.774876566810213e-01   +7.480368323641081e-01   +6.716550195107775e-02   +9.980196400308189e-01   +9.784489879421575e-01   +5.226259659462522e-01   +7.902749929781407e-01   +8.551718997408467e-01   +7.187825613849259e-01   +6.620365854592889e-01   +4.706076862939204e-01   +9.336490719606266e-01   +8.365937796716947e-01; +1.834960554543424e-01   +6.154925390026523e-01   +8.301154741677479e-01   +3.366005267868560e-01   +8.253919330923996e-01   +1.687614126952049e-02   +6.202543938201049e-01   +6.253340737402315e-01   +6.363554505236159e-01   +7.934564528186944e-01   +1.656334739626623e-01   +2.950051776638127e-01   +3.679430987237086e-01   +7.170448943457675e-01   +3.743037087862046e-01   +1.989019923458540e-01; +1.185136620188293e-01   +5.652691446528461e-01   +1.746763370504669e-01   +2.208116337272892e-01   +3.410553712203581e-01   +8.792302324124962e-01   +9.798504697126412e-01   +7.439517609011077e-01   +5.783716536762592e-01   +1.453116963687557e-01   +8.285081653858070e-01   +1.168776508074037e-01   +3.919928947786637e-01   +5.143767931823341e-01   +1.092155848300756e-01   +8.419575646988032e-01; +5.854964478271857e-02   +5.046422992179597e-01   +5.187055083067533e-01   +5.694239236728855e-01   +1.396139646112903e-01   +1.574542921598854e-01   +4.950911465553858e-01   +8.729575100873996e-01   +8.351170545637739e-01   +4.559352162483159e-01   +2.168013933025693e-01   +3.250711488905685e-01   +1.345492131339465e-01   +5.144514808018174e-01   +7.193501506585444e-01   +4.253879801672433e-01; +9.327301517454036e-01   +6.680255083363190e-01   +3.556134920480850e-01   -2.371317118318701e-04   +5.037656546770459e-01   +9.141937281175987e-01   +5.232245001400176e-01   +3.289117732916221e-01   +1.158458353749803e-01   +4.585451022907696e-01   +2.682863369041221e-01   +4.566157949749114e-01   +3.382790413655768e-01   +3.857217053641268e-01   +4.493296420014419e-01   +5.587453423636061e-01; +7.454319271753442e-01   +6.327795956237647e-01   +6.446497274463523e-01   +5.886185474142831e-01   +4.135653562331811e-01   +5.558352698447140e-01   +8.550309822164388e-01   +9.885494753397260e-02   +5.247593188914777e-02   +9.537842421548921e-01   +8.631622190537293e-02   +7.171239135499280e-01   +1.221491424424699e-01   +4.797214594818920e-01   +1.243356639574033e-02   +4.482690706888526e-01; +2.428361164581129e-01   +1.454225784483658e-01   +2.821613995417921e-01   +8.913587017733895e-01   +1.716568565990728e-01   +9.222012856448144e-01   +2.537682811065020e-01   +4.507090555270461e-01   +5.172998927905997e-01   +5.368498340733827e-02   +9.163103954852532e-01   +4.050976861107632e-01   +3.691865532539910e-01   +7.398739259132947e-01   +1.239653176506429e-01   +7.599099287959683e-01; +2.042008297855358e-01   +1.791770232399015e-01   +4.369081484961132e-01   +2.546348025219026e-01   +4.940864022655811e-01   +5.974206733777879e-01   +5.825745779115121e-01   +2.396541359431800e-01   +6.973254872710786e-01   +3.645511240588335e-02   +7.265686007394722e-01   +2.415710450334380e-01   +2.509088499175431e-01   +7.017919814823564e-01   +6.586834034428896e-01   +9.603107032267139e-02];
L1E_L1I_iGABA_netcon = [+8.437143244279883e-01   +7.529382187072439e-01   +8.743516880098855e-01   +4.354130588258715e-01   +9.178347376175272e-01   +7.791981704801308e-01   +3.217992997855461e-01   +6.412247584843197e-01   +9.409747264290369e-02   +2.643251226847084e-02   +1.292605022882722e-01   +5.204997805031486e-01   +8.699991646620620e-01   +5.762974938456049e-01   +1.655603345123307e-01   +6.271135693543927e-01; +6.216028557225747e-01   +9.951405988879100e-01   +3.089622452629114e-01   +1.471678723906912e-01   +8.829922702008876e-01   +2.729703187237354e-01   +9.631635478132188e-01   +4.292490860206826e-01   +2.926674263255474e-01   +5.146728999761632e-01   +4.247541484400760e-01   +2.038921391686873e-01   +8.030213454360601e-01   +2.881139403849957e-01   +5.481710177589463e-02   +3.364717802672549e-01; +6.717325997889372e-01   +3.708412757140646e-01   +4.338003492047035e-01   +6.542036011579523e-01   +5.857982940223270e-01   +5.266292918283663e-01   +3.528519164408728e-01   +4.779243945117806e-01   +3.259005537460702e-01   +8.630994092123099e-01   +4.807796971390321e-01   +7.752990372169283e-01   +6.466069001586364e-01   +1.319845663579914e-01   +2.109878003073616e-01   +1.562717063614922e-01; +7.818751668947003e-01   +5.019323028447753e-01   +3.814604644019703e-01   +7.213796121522590e-01   +8.351274512465819e-01   +4.030071177912489e-01   +3.198731877190573e-01   +1.005385684218026e-01   +4.829575600022531e-01   +5.810904773621863e-01   +6.737725962686690e-01   +3.910094805816239e-01   +7.345308689435338e-01   +4.947759975174564e-02   +2.043207380797585e-01   +4.021739585410319e-01; +3.091529107962523e-01   +7.586905884234607e-01   +6.566909592537338e-01   +1.616969324202812e-01   +7.763285711039712e-01   +7.787971562137910e-01   +9.082422676826760e-01   +8.075249771628967e-01   +2.419327711120958e-01   +4.223179432046049e-01   +3.575029630428218e-01   +6.691600174851575e-02   +6.673295971960141e-01   +6.244184559286892e-01   +2.174909438674984e-01   +9.130535950805119e-01; +3.305773172635810e-01   +1.270159326355754e-01   +2.370917830270302e-01   +3.425138388850343e-01   +7.845864813318913e-01   +2.561341550502691e-02   +8.848622106879255e-01   +6.501629977142531e-02   +4.539243154121495e-01   +7.134099165552092e-01   +5.049011714691759e-02   +7.558329908851208e-01   +8.810493270622153e-01   +6.061470776899419e-01   +5.781874644464216e-01   +1.487396359107754e-01; +6.339913642275056e-01   +5.180947241389948e-01   +6.857673097793450e-01   +1.066567431828785e-01   +7.012105991573939e-01   +4.121555474481919e-01   +3.520662241720237e-01   +9.543396004105342e-01   +7.585913838251902e-01   +2.336809874583602e-01   +2.905095945386749e-01   +4.531035861474822e-01   +8.528754723509191e-01   +3.713816853162876e-01   +3.335347332957751e-02   +4.639065043120247e-01; +9.016660070363500e-01   +9.062293180176381e-01   +3.266474164199110e-01   +4.095063052319843e-02   +1.862545727985642e-02   +8.261240428884107e-01   +7.499261937398953e-01   +7.729824509186741e-01   +7.187493176873145e-01   +5.865748687168277e-02   +7.942027529130594e-01   +3.188112661383779e-01   +4.037605682774456e-01   +8.320343487202477e-01   +7.952320871755297e-01   +7.889633271057052e-02; +3.714482812175369e-01   +9.902964426858675e-02   +8.813855932862655e-01   +4.783773846479383e-01   +3.304299423723220e-01   +5.925409328678130e-01   +1.264257258351877e-01   +4.402114024896289e-01   +2.375615043232790e-01   +9.765480391844826e-01   +6.517578846470058e-01   +2.778116468507550e-01   +1.056951941856492e-01   +5.197822744544836e-01   +1.344499097166598e-01   +3.423520402359018e-01; +8.815981251091293e-01   +1.792240038440614e-01   +9.989949492788973e-01   +4.769734771002790e-01   +9.480005454559610e-01   +2.131651973155104e-01   +5.991907006068186e-01   +1.658796471724351e-01   +6.996117949049208e-01   +9.697890211122927e-01   +7.101292020088391e-01   +5.836399369938217e-01   +4.031064207313176e-01   +8.006781378668045e-01   +5.822399623799833e-01   +4.968971033626488e-01; +1.245430914211126e-01   +1.728980678004887e-01   +6.807455224186809e-01   +5.461579372727114e-01   +3.988782333901474e-01   +2.961294641932312e-01   +4.367250623604328e-01   +8.104921063343920e-02   +3.050880876193761e-01   +1.367600757589826e-01   +7.654233154589248e-01   +9.117428273893822e-01   +3.407818195817900e-01   +5.705375680848050e-01   +8.572759049221433e-02   +4.892354046442454e-01; +8.881213986123680e-02   +5.339863077077087e-01   +3.447026445200809e-01   +6.511774008970990e-01   +6.323310239674950e-01   +2.677618076872998e-01   +9.592043137589983e-01   +7.422468654590665e-01   +4.702474526775583e-01   -5.885231149347862e-04   +3.835868066179306e-01   +4.507649844665276e-01   +1.143579027698220e-01   +7.148134197564527e-01   +2.291209069531891e-01   +1.277071155184319e-01; +5.460258516910242e-01   +9.794592961004567e-01   +5.606910407597105e-01   +3.489394753004049e-01   +8.591349716058911e-01   +9.284960213127713e-01   +9.643257679028767e-01   +5.439645255894976e-01   +4.442838581534531e-01   +9.365587167267351e-01   +3.619214681524867e-01   +9.802089029535925e-01   +8.518836444234568e-01   +7.329041979873827e-01   +4.516999379443766e-01   +8.577403768736902e-02; +6.107723187760018e-01   +8.435052943943252e-01   +8.906601027253884e-01   +2.561312029338339e-01   +3.769996475268753e-01   +5.527636794601288e-01   +2.425176649553572e-01   +4.859652092033097e-01   +7.341633016681921e-01   +7.411247399062912e-01   +8.100903052674269e-01   +1.108849114159955e-01   +8.926488688795597e-01   +4.548233609272433e-01   +1.785004625668908e-01   +6.738913781679385e-01; +7.275745288084821e-01   +6.728311431172731e-01   +6.466127499184953e-01   +1.764910696971156e-01   +2.045644978554455e-01   +4.323495181009796e-01   +7.704098089583232e-01   +8.958116509488238e-01   +8.763381367428908e-01   +4.323769240543476e-01   +3.861315135227975e-01   +4.157109403896445e-01   +6.857964751391250e-01   +2.834101483838919e-01   +4.139464377691351e-01   +1.220333677119574e-01; +9.918126914862330e-01   +9.323480114793529e-03   +3.771611688482129e-01   +4.785149102173794e-01   +9.118292148325824e-01   +3.277216534728565e-01   +7.126731734925287e-01   +5.826550087105643e-01   +9.136704955750412e-01   +9.440938122519660e-01   +8.715610627342142e-01   +3.830850489291272e-01   +7.431853152197498e-01   +1.513399342352741e-01   +9.651061862276948e-01   +9.890245745626921e-01];
L2I_L1I_iGABA_netcon = [+5.738719515981768e-01   +5.645452119353442e-01   +1.081388099830239e-01   +4.598257359664741e-01   +7.969826598056911e-01   +9.783045369225229e-01   +2.239834462312860e-01   +7.584639493186929e-01; +5.583567807004067e-01   +9.531905696733247e-01   +1.186710247838944e-01   +5.667941399615665e-01   +5.421865895634774e-01   +4.222730330819764e-01   +6.635783929770520e-02   +5.064870762787712e-01; +6.112116443277120e-01   +8.730299301156793e-03   +4.338708847538935e-01   +8.168396164418396e-01   +2.574264508156607e-01   +3.932016915482205e-01   +8.357425643171317e-01   +8.285325373899116e-01; +4.669319252261588e-01   +1.262049410044138e-01   +9.321228686289067e-01   +3.556824999869056e-01   +7.811445974319463e-01   +4.611207248823451e-01   +4.128886046100844e-02   +9.274883755281381e-01; +4.343428496601152e-01   +8.538220565142508e-01   +1.399545546816391e-01   +2.484047647762359e-01   +7.795050892592997e-01   +1.215814593272378e-01   +9.096749357249191e-01   +7.106749118392250e-01; +6.272534382801717e-02   +2.182010456144332e-01   +8.258932697948336e-01   +7.708948786368819e-01   +1.444168179593080e-01   +4.542070249131605e-01   +4.494390467992285e-01   +7.978140908230824e-01; +6.469467818470778e-01   +7.100701385013194e-01   +9.329434955134186e-01   +1.874474124496175e-03   +8.237058339764003e-01   +2.646663432724048e-01   +2.846300921018479e-01   +9.589023856698081e-01; +4.262155651751803e-01   +7.747775737125504e-01   +5.728782868441145e-01   +2.763592892714097e-01   +6.233038188296834e-01   +9.267623150845013e-02   +7.556742647286800e-01   +9.517289951898803e-01; +7.562829413186191e-01   +4.215306175981409e-01   +4.988014534077087e-01   +2.309450634071777e-02   +4.566153398171289e-01   +6.620776959629658e-01   +9.267972205455927e-01   +2.954029258301281e-01; +3.062699313820477e-01   +7.256136231782061e-01   +9.311840695411415e-01   +6.700054639522902e-01   +4.835613112806671e-01   +9.448626757039528e-01   +1.408746527401132e-01   +3.521880061708890e-01; +5.972125700012076e-01   +4.579642944671912e-01   +8.626509970908309e-01   +9.670651822948670e-01   +2.191384140027683e-01   +7.649014875879608e-01   +9.554793994633759e-01   +5.413781401453146e-01; +3.343683917788783e-01   +8.052307516838755e-01   +2.538902666316056e-01   +9.456937200413127e-01   +8.576584493889987e-01   +4.319565683561215e-02   +3.044645468647385e-01   +2.127386108125893e-01; +6.432185047767972e-01   +4.280092870101814e-01   +4.583483628585224e-01   +4.601096724674094e-02   +8.801356524259624e-01   +2.607157917839568e-01   +2.095099716508354e-01   +8.088767648504123e-02; +7.554734681030683e-04   +1.490485634980455e-01   +7.408786065053111e-01   +2.867089759639705e-01   +8.460124669112372e-01   +6.346538094013195e-01   +4.639678581842816e-01   +5.067305045609435e-01; +1.442223933760304e-01   +8.049987332589515e-01   +7.526357962719257e-01   +4.875723955723946e-01   +4.429945961174956e-01   +8.935651367829207e-02   +5.974013085458786e-01   +1.947819571212624e-01; +2.477207345784101e-01   +3.815720420213511e-01   +2.298114928713595e-01   +8.877624383729428e-01   +5.429422274046487e-01   +7.516698491128891e-02   +5.518596502468862e-01   +1.455718337320503e-01];
L1I_L2I_iGABA_netcon = [+6.990026122630159e-01   +8.670863807032128e-01   +6.141944415569304e-01   +5.520051080531636e-02   +1.433593718414135e-01   +2.343858431986192e-01   +8.383908441440933e-01   +3.705230246271681e-01   +7.068431341167281e-01   +3.841009897866426e-01   +2.396795059124560e-01   +6.667438690194373e-01   +1.684375300208784e-01   +5.694742618217290e-01   +4.328502277302220e-02   +4.869830071701932e-02; +5.983119211274840e-01   +7.976872635152525e-01   +6.100319466820125e-01   +5.787050882140149e-02   +7.447276089240726e-01   +5.564473248081510e-01   +1.974619663972499e-01   +5.587356630934301e-01   +1.870831097722176e-01   +7.195078473760554e-01   +5.137054525582851e-01   +3.290993566266641e-01   +1.148341441155854e-01   +8.095730278144232e-01   +4.421326433368427e-01   +9.218051169622150e-01; +1.630684415859081e-01   +6.270439774062985e-01   +3.144281102251927e-01   +5.971118751450728e-01   +9.512897294238192e-01   +1.137954298805947e-01   +6.172925677229798e-01   +8.298232651893065e-01   +2.313636020455678e-01   +6.420063228988008e-01   +7.322673770232115e-01   +5.513664091801277e-01   +7.356990476819262e-01   +6.743097403675116e-01   +9.169969752207956e-01   +1.742666670176841e-01; +4.837864844051907e-01   +4.726210284861220e-01   +1.421664435545256e-01   +6.575314944636746e-01   +2.657807154446135e-01   +8.177515261277010e-01   +1.551929452969342e-01   +7.067325985233198e-01   +9.983587037329955e-01   +1.017672750312755e-01   +7.703372208848930e-01   +5.325975994406991e-01   +2.110924059414923e-01   +4.435424265078621e-01   +8.848158659493076e-01   +7.438992430758198e-01; +2.857298628425602e-01   +1.830078227904715e-02   +6.050514618050026e-01   +4.807879941210992e-01   +9.487394274369026e-02   +6.505874417059323e-01   +5.832581200472999e-01   +1.156503396772823e-01   +9.057868286416676e-01   +4.916335586682249e-01   +6.770848751569197e-01   +9.009978353295129e-01   +4.839438953391492e-01   +8.937701364899061e-01   +9.281931071113411e-02   +4.752444175364734e-01; +4.040606490284432e-01   +1.177560321776803e-01   +8.894171126301539e-01   +9.780950144568976e-01   +2.314744309885911e-01   +2.377135830410897e-01   +5.448800926384691e-01   +7.407173189263532e-01   +1.161977215276917e-02   +5.611812206556367e-01   +8.132436393958342e-01   +2.839574191143521e-01   +5.090583327073495e-02   +7.826871138596146e-01   +6.753943754020986e-01   +2.462579937111752e-01; +4.913570828846170e-01   +7.193628571583495e-01   +5.624154204383441e-01   +8.638572060407745e-01   +8.958185643665745e-01   +3.021008694266339e-01   +6.813401720527594e-01   +9.240726467188448e-01   +8.338899011671610e-01   +5.536712568651293e-02   +4.185652015328848e-01   +1.388302629530459e-01   +5.715326308103710e-01   +5.815363573167887e-01   +9.489940311261656e-03   +6.634775446893690e-01; +8.627073242080811e-01   +6.822296983192377e-01   +6.327910644104546e-01   +9.543813710644813e-01   +1.998691450435857e-01   +3.304849968399414e-01   +6.986598826198557e-01   +9.233494057894646e-01   +2.532910804872445e-01   +8.908798797125277e-02   +4.979267097478123e-01   +9.572443102046384e-01   +4.912351623738971e-01   +6.159575760376913e-01   +1.216991510324663e-01   +6.090806505139115e-01];
L2E_L1E_iAMPA_netcon = [+3.678054857388052e-01   +5.616661405263672e-01   +2.005081826660788e-01   +5.137042133669654e-01   +2.898885839553923e-01   +7.405254907995526e-02   +2.787805719038714e-01   +2.670400493261022e-01; +4.375313578663402e-01   +1.934389415654440e-01   +1.371080092395058e-01   +6.852249244518771e-01   +6.198990951099431e-01   +5.934702450574265e-01   +9.292152328514918e-01   +9.048538205507655e-01; +7.184254149660629e-01   +6.127298800081822e-01   +8.182512855799116e-02   +2.069868402102294e-01   +8.628326309554145e-01   +7.568561155003477e-02   +7.640277133921652e-01   +1.593903289037129e-01; +1.916740258047838e-01   +7.409665302702202e-01   +9.062683851538164e-02   +9.715207456603160e-01   +8.201197593925843e-01   +3.971669984437418e-01   +2.616302653426468e-01   +5.537635973793757e-01; +3.983973082964037e-02   +8.314134791349219e-01   +5.509919799168781e-01   +3.503718143678612e-01   +2.056287602303603e-01   +5.900939897772120e-02   +2.429950650156719e-01   +4.223856659923069e-01; +3.148032530782471e-01   +2.767467660712364e-01   +7.322057488502721e-01   +1.851539210131097e-01   +7.509529738174271e-01   +1.287559725553810e-01   +1.657776605318074e-01   +5.467536775791341e-01; +7.900303020790266e-01   +6.086571221204512e-01   +5.443578939161334e-01   +2.380125279253511e-01   +1.986166896154850e-01   +2.445984720193281e-01   +2.872728614192855e-01   +7.542962630566757e-01; +4.750189463166267e-02   +5.480269494661831e-01   +5.476185779867189e-02   +2.534887675515743e-01   +5.776467715875611e-01   +9.439220228651084e-01   +5.644025416970978e-01   +1.403230011157244e-02; +2.159401893007671e-01   +2.741586557465777e-01   +6.325134837545190e-01   +2.224196488034808e-01   +8.767796310581679e-01   +2.029266388257603e-01   +4.048217440028480e-01   -1.414982533476254e-03; +2.740237713360785e-01   +3.396085959089671e-01   +9.943325794492404e-01   +3.592754831136667e-02   +7.144253963744002e-01   +3.274884098181397e-01   +9.874296375594277e-01   +2.114379970297179e-02; +7.893769912675354e-01   +5.668636342404296e-01   +9.149415775261137e-01   +3.570417362727568e-01   +7.003964692751850e-01   +8.669972612034710e-01   +5.448314200025218e-01   +3.595631696298321e-01; +9.903762179540784e-01   +7.440818657045677e-01   +7.687181065307610e-01   +8.984349906262227e-01   +4.679202334195443e-01   +9.222990492431030e-01   +9.291108885918149e-01   +4.268291298485268e-01; +9.444400037862645e-02   +7.720199686333551e-01   +1.909879144633154e-01   +1.403228603639600e-01   +5.042031635455497e-01   +2.335862987586685e-02   +9.926190728027604e-01   +5.446359078330818e-01; +1.964319563690901e-01   +3.980339968218478e-01   +3.187979366631349e-02   +9.559453240166017e-01   +7.960681049258280e-01   +3.647146767993572e-01   +8.364686449502139e-01   +4.921538511901449e-01; +1.165060163573642e-01   +1.486098128491624e-01   +3.733248107623996e-01   +9.021795991734838e-01   +9.400544965181699e-01   +5.280784384380728e-01   +1.805537616617798e-01   +9.201034777960237e-01; +6.472333768500312e-01   +2.077596920275968e-01   +5.756588993411653e-01   +4.104145675153028e-01   +7.819170742468460e-01   +4.067016729141850e-01   +3.134653250828104e-01   +4.163075803140165e-01];
L1E_L2E_iAMPA_netcon = [+4.970178766485653e-01   +4.492085719838260e-01   +6.161894056737759e-01   +4.905811097355846e-01   +2.302454411312505e-01   +7.205486881310083e-01   +6.942417769957759e-01   +6.327765370168268e-01   +5.221749084943761e-01   +2.412577671595620e-01   +8.763921796076450e-01   +1.740002612550519e-01   +1.382985988694827e-01   +2.435456122121429e-01   +1.833416399079905e-01   +2.405423810819005e-02; +8.381744171251574e-01   +3.694863836895559e-01   +1.042527873175246e-01   +6.611890054537634e-01   +8.359440948375595e-01   +3.805935535584863e-01   +9.788925099004362e-01   +6.266154068894588e-01   +6.729059514961984e-01   +7.288478436381817e-01   +6.587655856897847e-01   +3.022844059258252e-01   +2.824594344663152e-01   +7.487907424968189e-01   +1.462674223630903e-01   +2.508011757272244e-01; +1.848975145723895e-01   +3.008248428640237e-01   +7.522771973588200e-01   +1.789097122515417e-01   +7.339049349158611e-01   +3.839085177029994e-01   +7.502665620485901e-01   +4.070473308606009e-01   +7.777009186767034e-01   +1.366657511121743e-01   +5.381510793425099e-01   +1.094695740442036e-01   +7.204536943230762e-03   +9.372795246838230e-01   +1.322718674575353e-01   +9.892647312278275e-01; +3.371152329634844e-01   +2.329105299941497e-01   +5.360875319963592e-01   +4.798657746649879e-01   +4.886214977061725e-01   +7.156853946202349e-01   +5.538782611919066e-01   +4.253082654499262e-01   +4.640764283712889e-01   +4.130165334251622e-02   +2.523379354424268e-01   +4.515781882530263e-01   +3.057320802815464e-01   +2.949741632818237e-02   +1.719828929699886e-01   +6.295991074311813e-01; +6.924708743524399e-01   +1.368699722502873e-01   +4.434501579522218e-01   +4.984507224588304e-01   +8.489495561464613e-01   +8.388541630039326e-01   +2.963602593478187e-02   +5.101833649265073e-01   +9.076876888646083e-01   +6.496164289180107e-01   +1.048383334070309e-01   +5.840656275920477e-01   +9.050579984731139e-01   +4.352093385628475e-01   +9.227024491858641e-01   +3.574953085847258e-01; +6.928753686645255e-01   +9.938993098740688e-02   +7.427099474335355e-01   +6.001667642118663e-01   +7.151751755001748e-01   +6.678763431224705e-01   +1.949148738312333e-01   +2.595087779264824e-01   +2.568372630042517e-02   +2.000906033312717e-01   +9.718093824693649e-01   +2.246257389023046e-01   +2.946017162310265e-01   +8.310888524354313e-01   +2.590907756877342e-01   +9.381474778874045e-02; +3.684583165000260e-01   +2.269504062123160e-01   +3.876032298822336e-01   +2.410364583823269e-01   +5.215619492007284e-01   +6.512679494096298e-01   +9.418055660932655e-01   +4.229237396654679e-01   +4.795016268032998e-01   +9.736554774846504e-01   +5.969192383302895e-01   +1.101081056074443e-01   +8.330406372904779e-01   +9.996840362738674e-01   +2.055912792995719e-01   +4.097003977583943e-01; +3.491535149367835e-02   +3.465380762814952e-01   +5.259837095941067e-01   +5.170933540813041e-01   +9.377175948604346e-01   +5.633971307047499e-01   +3.974653742268882e-01   +5.236332753773051e-01   +2.715651371018817e-01   +8.206581628303450e-01   +8.191648555610905e-01   +5.601781741867187e-01   +7.452739616026498e-01   +9.205929806317448e-01   +6.128778083214192e-01   +9.310280161727681e-01];
L2I_L2E_iAMPA_netcon = [+6.774993737170641e-01   +6.146233139371624e-01   +4.184681983594561e-02   +7.928438695302584e-01   +5.240760207862526e-01   +8.261215623086354e-01   +6.439060345042564e-01   +3.860406460771145e-01; +2.299996337606484e-02   +9.453473459600720e-01   +5.447139784302495e-02   +9.294312137249473e-01   +5.438720322085568e-02   +1.074632765430780e-01   +3.930083971767837e-02   +1.671156181531592e-01; +7.334680105107764e-01   +9.637206574835590e-01   +4.013357992794005e-01   +9.364798904355255e-01   +2.871706917010457e-01   +2.338673377989509e-02   +5.684024567419111e-01   +4.440147830091163e-01; +2.124327477333088e-01   +3.686891682208196e-01   +9.835067190527836e-01   +1.462780406157675e-01   +7.098397459585418e-01   +1.166939395406640e-02   +3.042107219889319e-01   +8.732457869860326e-01; +8.603517312731298e-01   +7.947396720800376e-01   +7.122305592872226e-01   +3.188751013419825e-01   +8.782026787358228e-01   +3.364691099647589e-01   +2.611688855418872e-01   +4.114289169570141e-01; +1.569977104166251e-01   +7.284867079608960e-01   +9.885132570227213e-01   +4.280486821385847e-01   +3.663804521998120e-01   +6.635676376758536e-01   +7.215095199433286e-01   +1.623557889664012e-01; +6.686804488518193e-01   +9.538516926908844e-01   +6.459049635440628e-01   +7.011242428401402e-01   +5.605565195249070e-01   +5.953013018692673e-01   +3.057434174695925e-01   +6.621861889604655e-01; +9.361812364171919e-01   +1.108427453416114e-02   +5.026875609949777e-01   +6.152832951808292e-01   +8.838327493821588e-01   +8.059226922914088e-02   +8.953695377066920e-01   +9.255994618608014e-01];
L2E_L2I_iGABA_netcon = [+6.020302818996857e-02   +5.191131328091201e-01   +3.527449515318968e-01   +2.620219055964029e-01   +4.232317119476763e-02   +8.908128151231893e-01   +3.443354375308159e-01   +4.512831803764761e-01; +3.537918547926385e-01   +6.944091997197627e-02   +5.571342076959254e-01   +9.846264681261316e-01   +3.604687453813337e-01   +5.406678780975501e-01   +9.354411770194772e-01   +6.715610134740233e-01; +9.318357297581854e-01   +1.844665245255601e-01   +6.923536913983892e-01   +3.495757215971715e-01   +3.574274651306100e-02   +7.171361224445100e-01   +9.184303824385271e-01   +7.688809450826245e-01; +2.418567230604428e-01   +3.171540762873684e-01   -6.524796267816407e-03   +4.025363646303393e-01   +4.856086747040230e-01   +7.113025247021240e-01   +7.248443809664383e-01   +9.271746406883845e-01; +1.022379122740858e-01   +2.440143262911379e-01   +4.737359772625890e-02   +7.522548981252658e-01   +7.234242911736986e-01   +1.694892037415331e-01   +4.428556316269587e-01   +6.582084507236883e-01; +7.164655858808675e-01   +3.226933704421518e-01   +3.080159795734941e-01   +1.013378495670497e-01   +1.410389861211049e-02   +3.523453892372239e-01   +1.512561028554536e-01   +5.016993961054927e-01; +5.722030725829528e-03   +8.791393994636344e-01   +8.689983067832662e-01   +5.907828099647939e-01   +5.170925427095486e-01   +3.790853254316103e-01   +8.315434758664382e-01   +3.420836648365390e-01; +1.851171183658973e-01   +3.010803709450404e-01   +6.272714461607103e-01   +1.239084177831829e-01   +2.389644957729494e-01   +7.576815921384790e-01   +2.568793846945641e-01   +9.462562432633493e-01];
L3E_L2E_iAMPA_netcon = [+7.959964314892903e-02   +1.525236849237630e-02   +3.684416839308119e-01   +4.963735265614583e-01   +1.748238012033633e-02   +9.558398610671768e-01   +3.592712625597160e-01   +1.390158109283631e-02   +2.037742863157109e-01   +6.187346213565310e-02   +2.432026561239966e-01   +9.988919373307616e-01; +9.524871099002535e-01   +9.770895995768032e-01   +1.166287297115184e-01   +6.580682115757788e-02   +8.061691200138129e-01   +3.871365379238328e-01   +2.243341661015542e-01   +1.211788343880437e-01   +3.566549819009996e-01   +7.414866165474261e-01   +5.339549947932711e-01   +3.447132930009189e-01; +6.625078068328120e-01   +7.243052801830643e-01   +5.143400355916983e-01   +8.622914740864350e-01   +7.916785244436256e-01   +6.642903226605816e-01   +7.247499121173298e-01   +6.699320882432445e-01   +8.877874250407874e-01   +9.906196546598366e-01   +3.335254757258813e-01   +8.222523871735492e-01; +1.691021308183524e-01   +8.720404924231316e-01   +6.855551200490593e-03   +9.966969629269832e-01   +4.237675177203281e-01   +5.855135062552050e-01   +7.722371318061232e-01   +5.083103648411473e-01   +8.083765053322192e-01   +7.674171137907851e-01   +6.747651989323554e-01   +1.090562694911596e-01; +1.971750627622484e-01   +8.148210285412381e-01   +8.688330434779633e-01   +1.223936964332676e-01   +6.306809668107536e-01   +5.912485124553347e-02   +3.423471537102384e-01   +7.021715491716120e-02   +3.196670027354282e-01   +8.819233633867483e-01   +8.751839346301026e-01   +7.735739441735864e-01; +9.955933824226327e-01   +3.009011063231490e-02   +9.039804760489016e-01   +1.000364380204227e-01   +5.682230692893261e-01   +7.597143282353988e-02   +5.761272608488609e-01   +5.353697094574839e-01   +6.010503091544646e-01   +3.626234725007753e-02   +9.830861852803161e-01   +1.503013623217572e-01; +9.259795556243783e-01   +9.678767277475624e-02   +1.131799700709439e-01   +1.492141467958022e-01   +8.958853083201151e-01   +2.278320899160438e-01   +6.430944861181405e-01   +6.775904798501398e-01   +6.984558044150618e-01   +7.943808453635532e-01   +1.459026398513593e-01   +7.311892241099928e-01; +9.819868799760305e-01   +8.522512068458975e-02   +4.407683989297085e-02   +1.287944046010534e-01   +7.488824501070696e-01   +4.210215377469764e-01   +3.662543387003406e-01   +5.884385596255836e-01   +1.781589241355064e-01   +7.066464857344581e-01   +8.770204089885691e-01   +1.089558533414149e-01];
L3I_L2I_iGABA_netcon = [+7.683409617474789e-01   +5.352423833852911e-01   +5.968475997440266e-01   +3.036994995697393e-01   +9.654131684736984e-01   +1.150452594047225e-01   +2.981178686193725e-01   +7.952295068874049e-01   +9.139922152742305e-01   +9.956707278852125e-01   +3.100013163378471e-01   +9.965503272174407e-01; +6.368122324453873e-01   +4.530860396043190e-01   +5.630507958964920e-01   +7.630393781282124e-01   +5.438225096651120e-01   +7.088796586383153e-02   +1.675830723943398e-01   +5.273300059281794e-02   +3.854581635159962e-01   +2.877190437549764e-01   +4.422158261356989e-01   +9.154248263370898e-01; +7.963761897567752e-01   +1.144932969382344e-01   +6.806021833263458e-02   +6.479647249578607e-01   +9.819706437789616e-01   +5.045712143162516e-02   +7.246072232950024e-01   +1.809285073000468e-01   +7.511900948218293e-01   +5.158367617281813e-01   +2.092750325095035e-01   +6.904819326759243e-01; +9.596005162070298e-01   +7.204480574857242e-01   +7.680568011688260e-01   +3.324464735185993e-01   +1.248027183917761e-01   +1.300905587139607e-01   +2.988522721349213e-01   +2.461446123136586e-01   +8.783988204689169e-01   +3.586655850819507e-01   +9.413406183039018e-01   +2.209577457722088e-01; +7.171284380205790e-01   +1.856714597800600e-01   +8.680848815862717e-01   +9.709249702820679e-01   +1.684806270675981e-01   +4.910243657187793e-01   +6.781977579955566e-01   +2.616378010093162e-01   +3.921940142011562e-01   +5.168981030701464e-01   +2.899845284725183e-01   +3.137550427526458e-01; +6.440689202930666e-01   +3.248041038755655e-01   +7.091043637834857e-01   +5.318411406369782e-01   +3.339082469616428e-01   +4.679923596361155e-01   +7.463052630867937e-01   +6.476702753511728e-01   +1.669834986659692e-01   +5.008413291055380e-01   +1.220527976346269e-01   +2.371160475970757e-01; +5.118099147892967e-01   +9.670950952203831e-01   +1.083323234068661e-01   +7.517553504598598e-01   +5.312392053128075e-01   +1.586062541525234e-01   +7.453323018484705e-01   +9.750987427751806e-02   +4.367784863070980e-01   +1.888423642806633e-01   +6.975519704028038e-02   +7.081991887118811e-01; +9.517975957904441e-01   +7.006776854590576e-01   +6.655929052997704e-01   +2.706374279442061e-01   +6.924760885830736e-01   +1.385486472386392e-01   +7.848240626983910e-01   +4.690184631403631e-01   +8.585353745127425e-01   +4.771841180245064e-01   +7.292895829301664e-01   +3.754772050695299e-01];
L2E_L3E_iAMPA_netcon = [+6.562466813007839e-01   +3.871967921351916e-01   +2.348232882517672e-01   +4.634858730492192e-01   +9.048709846402183e-01   +9.502026330779859e-01   +7.621986101031788e-01   +3.544852799660174e-01; +3.845844692302111e-01   +2.296770010136527e-02   +9.045834126711854e-01   +2.832208010978750e-01   +6.794952091724775e-01   +2.635030514874054e-02   +9.033570084253933e-01   +6.637172976598537e-01; +3.083300196132142e-01   +3.299405772756396e-01   +4.872662936282249e-01   +2.764355239012953e-01   +8.425914048043031e-01   +5.015777332263254e-01   +7.962992864452579e-01   +5.924316071414063e-01; +1.574455954303389e-01   +4.847117255765775e-01   +5.959710627246644e-01   +1.421742946563258e-01   +9.474729111761973e-02   +3.390347629196421e-01   +9.564447411628816e-01   +5.448548574966265e-02; +7.780395045702301e-01   +2.619012803139348e-01   +9.548873289420102e-01   +1.394920832416282e-01   +7.354656523871368e-01   +6.720774850577559e-01   +5.350619688562294e-01   +2.165286868717274e-01; +7.091623143172564e-01   +5.264019659874463e-01   +8.507936660453425e-02   +2.654365926174317e-01   +5.435361279227616e-01   +1.677895583937465e-01   +1.638516084081408e-01   +6.023171617118647e-01; +1.728218828711314e-01   +4.163494576994728e-01   +2.223637802816138e-01   +6.103396922956493e-01   +2.567085406910106e-01   +2.268116976808713e-01   +1.347828128096148e-01   +2.691326006930264e-01; +4.481440082022587e-01   -4.667717486138008e-03   +1.517322555345207e-01   +1.060910108554906e-01   +7.147084877290180e-01   +1.179297856565912e-01   +3.406992037391880e-02   +1.093184755561497e-01; +8.380099439569001e-01   +8.937639731240163e-01   +3.893583910313210e-01   +4.847749533684164e-01   +3.604480890765623e-01   +9.928427141722220e-01   +6.807947311984958e-01   +2.112844475259645e-01; +6.975012410029683e-01   +2.387290866485586e-01   +1.848683041617218e-01   +8.933999200518966e-01   +8.545652142962624e-01   +1.397790495244148e-01   +5.873408887611663e-01   +8.731239988526400e-01; +7.654672390024344e-01   +7.924071776823252e-01   +7.633528254802440e-01   +1.882084699192327e-01   +8.186311337536398e-01   +7.691717052908130e-01   +2.985870796959607e-01   +4.594502979787118e-01; +9.802161288358021e-01   +5.787040722117165e-01   +2.286077307503361e-01   +5.174136113693673e-02   +6.108307307371539e-01   +6.343805649951956e-01   +7.372924641901728e-02   +7.273306426348375e-01];
L2I_L3I_iGABA_netcon = [+5.894581535419123e-01   +1.476794597838623e-01   +3.445382447955789e-01   +3.697143951428623e-01   +5.994425193508777e-01   +5.071469983185566e-01   +7.730052990990655e-01   +2.647476128845793e-01; +8.457242911447524e-01   +9.903750726308255e-01   +4.659749986459943e-02   +5.373906180045375e-01   +4.785811757661031e-01   +2.368716466747122e-01   +1.792989506102386e-01   +5.853130218716630e-01; +6.049070548459551e-01   +4.806752748332923e-01   +9.420652739093507e-01   +9.748308700586831e-01   +3.766328884823842e-01   +2.722301352868762e-01   +4.544511584704954e-01   +6.790007462978298e-01; +7.441611103979191e-01   +3.510447850667844e-02   +8.675003265390084e-01   +9.968903718537395e-01   +9.783872765007448e-01   +4.050243689459465e-01   +3.055637326294958e-01   +4.153445168781110e-01; +8.493881951294016e-01   +2.694521649982901e-01   +1.334021703681291e-01   +4.150431414719664e-01   +1.383845941751621e-01   +2.602084814168728e-01   +3.875714418425167e-01   +5.117194362492683e-01; +1.466559273350284e-01   +6.758791989228961e-01   +5.911886233285537e-01   +4.512528655478560e-01   +2.709583367423387e-01   +8.537926468238370e-01   +8.035180838661936e-01   +8.143125794166042e-01; +7.416555691180786e-01   +1.472592898946566e-01   +6.217421164323339e-02   +2.551547925078034e-01   +2.253467618786980e-01   +4.791194283892745e-01   +7.779326048917889e-01   +5.446042366565150e-01; +1.684912047879664e-02   +7.739660586441318e-01   +9.469935882800684e-01   +6.013797082655884e-01   +7.909455110101994e-01   +3.413679697564990e-01   +6.454498073326359e-01   +5.894314202584711e-01; +2.281486438040390e-01   +2.671287266172286e-01   +4.967406556365164e-01   +7.783222971995701e-02   +8.173929119594762e-01   +6.390333128542258e-01   +2.418417301909891e-01   +5.352742316908052e-01; +5.374267898790762e-01   +8.807969508086656e-01   +2.627446144587001e-02   +9.122430450639047e-01   +7.919645740845627e-01   +4.154650425421917e-01   +6.093326569297540e-01   +5.415147303873108e-01; +7.207958004204427e-01   +3.688871029908828e-01   +5.745275476622506e-02   +4.727913201398538e-01   +1.127638870843850e-01   +5.431634517013634e-01   +4.201326387808578e-01   +1.517910853762484e-01; +4.339756067737893e-01   +1.022356043117554e-02   +3.006289175899903e-01   +5.083455038717490e-01   +6.326440088754303e-01   +3.393046829182397e-01   +2.942704159879768e-01   +7.028124464381802e-01];
L3I_L3E_iAMPA_netcon = [+6.435989826048397e-02   +7.735792681007899e-01   +5.552777054617716e-01   +5.732299489901318e-01   +9.197768990911540e-01   +8.350625543862664e-01   +8.490451492672613e-01   +8.624276689121715e-01   +5.341129347198235e-01   +9.884557689224549e-01   +4.816149813930578e-01   +3.506862683784472e-01; +9.224797949709758e-01   +8.390536598289228e-01   +8.442353057605395e-01   +9.352203217422498e-01   +5.923414636485409e-01   +3.926193616489447e-01   +6.278062630251730e-01   +8.559114611770106e-01   +5.668273518166529e-01   +7.010369663711447e-01   +7.396381405235106e-01   +3.996425103016142e-01; +1.804178155175118e-01   +5.928638112853470e-01   +9.691473956005534e-01   +7.785466948633106e-01   +5.751626171227274e-01   +6.976663843989292e-02   +4.448486862902869e-01   +9.496000817712674e-01   +9.799953841601663e-01   +8.442214552412811e-01   +5.952561400212373e-01   +9.877684121179753e-01; +5.435108215363990e-01   +7.673078751756550e-01   +4.667298301427917e-01   +5.973413270400493e-01   +6.585650045881501e-01   +3.736530153360945e-01   +2.346728057797497e-01   +6.938147136207758e-01   +9.674816937559597e-01   +7.377779235102609e-01   +2.627530705103960e-01   +2.969475644467272e-01; +3.968579186018552e-01   +6.586877131658319e-01   +7.761041313928919e-01   +5.814632128333443e-02   +4.354129113287683e-01   +8.494699576098669e-01   +5.090925333203279e-02   +3.631688877913501e-01   +5.600527664294228e-01   +9.961258624401361e-01   +6.073588771665229e-01   +2.245853905468864e-01; +9.498059737917525e-03   +5.889396469332969e-01   +2.146618811320773e-02   +5.437783429671277e-01   +9.353949991458538e-01   +2.439419847885341e-02   +7.128795519622653e-01   +3.736323319020662e-01   +5.325481049284987e-01   +5.080165171912437e-01   +2.323371794789851e-01   +3.305687156127810e-01; +1.025348676214893e-01   +2.651527960173527e-02   +6.776648647444247e-01   +8.647755070179448e-01   +1.023006161775455e-01   +4.219042939678234e-01   +8.485269239088883e-01   +8.427386724831617e-01   +4.787913431613505e-01   +1.893916508365171e-01   +1.949047911541339e-01   +1.647059138006688e-01; +8.561674825682365e-01   +6.929760241646752e-01   +8.356197431951360e-01   +3.382167534216233e-01   +4.094800333157631e-01   +2.550835790292506e-01   +4.047572581380698e-01   +3.838440565579473e-01   +9.009609597502583e-01   +9.596604816149074e-01   +2.134799509604538e-03   +3.841248898672078e-01; +3.382271554633901e-01   +3.272200854437156e-01   +6.843359441160336e-01   +1.787539416547436e-01   +8.927433547537011e-01   +7.426080608521628e-02   +2.865425680635920e-01   +7.698345596517394e-01   +4.822218994874234e-01   +4.524126453516364e-01   +6.462058565707615e-01   +5.255264355881645e-01; +1.499921018793177e-01   +7.567048573633964e-02   +8.960033470132707e-01   +8.814107311722128e-01   +7.386396494276743e-01   +9.206112705771498e-01   +2.626851424457732e-01   +7.721767275250997e-01   +4.874760422717994e-01   +6.055950609429551e-01   +4.000314069591426e-01   +5.951308264373193e-01; +8.074569051703345e-01   +7.441113579695678e-01   +9.555342376586022e-02   +8.416420855492117e-01   +9.586682157473928e-01   +2.680145323357839e-01   +5.050528046082458e-01   +4.334262284737425e-01   +3.138870744809139e-01   +6.437692408428095e-01   +2.722380131644898e-01   +1.702621003821904e-01; +6.559546177220826e-01   +9.649554155831176e-01   +7.089263632682358e-02   +8.337181375112760e-01   +9.698598982883828e-01   +1.010463920157806e-01   +1.168394047708758e-01   +4.875893629863453e-01   +8.596014186131858e-01   +7.664617282063140e-01   +4.097621224292290e-03   +7.258193880732823e-02];
L3E_L3I_iGABA_netcon = [+4.373452357839684e-01   +7.091456546965415e-02   +5.170396905207995e-03   +4.952714576801476e-01   +5.435112262753201e-01   +2.520099373486646e-01   +7.177920521039558e-01   +7.613400437003297e-01   +3.785085402007915e-01   +4.488107142098230e-01   +2.000779030191467e-01   +6.493562599397013e-01; +5.791975944165242e-02   +8.079965530067202e-01   +1.327581516059362e-01   +1.937671073778370e-01   +2.115676206969306e-01   +3.341201270794860e-01   +2.223044451405077e-01   +8.885155543472832e-01   +6.110644905920541e-01   +3.945286144342319e-01   +8.280784559394537e-01   +8.986000713581224e-01; +6.251481295275966e-01   +9.096992071643266e-01   +3.087145942475751e-01   +6.421395787426123e-01   +2.696300293705736e-01   +5.917783363679147e-01   +4.988629060988503e-01   +7.313187098938374e-01   +1.678606377380433e-01   +6.682760463189132e-01   +4.468500648826850e-01   +8.386385862261005e-01; +7.986065272299978e-01   +4.259435474037530e-01   +2.383887829722522e-01   +2.554858415184024e-01   +1.325658799514196e-01   +4.815998571740682e-01   +4.754017488754151e-01   +6.978135606142341e-01   +1.052660928665382e-01   +3.319830225612449e-02   +4.251939308071074e-02   +1.704690014657737e-01; +4.011190829853047e-01   +1.840891104246023e-01   +6.492666344920615e-01   +9.484317734490516e-01   +1.630778407163073e-02   +8.972268710294954e-01   +4.312389193129395e-01   +6.465143221577800e-01   +6.257918869316978e-01   +7.872151058703570e-01   +7.688389519755073e-01   +1.609263015071597e-01; +8.845026821060396e-01   +1.834479589523908e-01   +8.081675004986264e-01   +2.879327918748786e-01   +1.560230768507797e-02   +2.947701253444952e-01   +5.570802353475529e-01   +6.205300422871477e-01   +9.526444167785767e-01   +3.786485715431674e-01   +9.802336980511139e-02   +1.357415623643317e-01; +7.221337975940534e-01   +6.722043124367821e-01   +7.398385080983608e-01   +1.492125410946367e-01   +9.790225453269422e-01   +7.928048664365120e-02   +2.069844325318846e-01   +7.819299688805613e-02   +6.652654154116519e-01   +6.513464295330883e-01   +6.523065719081382e-01   +1.588601889882398e-01; +1.967810094494395e-01   +5.241582046846227e-01   +1.224262624227353e-01   +8.702963789249022e-01   +6.472924497613632e-01   +3.921127169862809e-01   +2.772415010157265e-01   +5.480239046573784e-01   +4.730996771890743e-01   +4.969579410977872e-01   +2.706697311623559e-01   +3.942554958245008e-01; +3.744292148279371e-01   +7.763542155943989e-01   +1.727116328147547e-01   +8.867718022620916e-01   +8.157034657231318e-01   +1.984499654593388e-01   +8.122667911180621e-01   +8.839988327928552e-01   +3.406006331494138e-01   +2.130153482485972e-01   +4.369323934455579e-01   +6.667027354819944e-01; +2.117234929632766e-01   +2.991314174622807e-01   +2.737728442911734e-01   +6.684065370043691e-01   +2.756351300039147e-01   +7.224750517227909e-01   +9.567009146635828e-02   +9.876901858872879e-01   +5.914098842719708e-01   +2.166202967247318e-01   +8.488189110589969e-01   +2.227015624143492e-01; +2.594727009065851e-01   +4.743093054666757e-01   +8.148495054243886e-01   +9.971217118193878e-01   +1.546734785522686e-02   +4.214875509716215e-01   +3.297857632078428e-02   +7.092580511629246e-02   +5.456714825484497e-01   +4.520682693559403e-01   +9.023548226963614e-01   +6.436116097481174e-01; +9.918471998729650e-01   +7.064974259769878e-01   +5.914459192921183e-01   +2.678518753546296e-01   +1.013790342192683e-01   +2.680979105389719e-01   +6.503670680852275e-02   +3.277921552558997e-02   +3.960868600660913e-02   +6.291049595581431e-01   +2.849278205901390e-01   +6.117223491841323e-01];
L2E_Input1_iAMPA_netcon = [+9.920027928077880e-01   +9.897138393706683e-01   +9.998858609295743e-01   +9.876352239059105e-01   +9.853044728020828e-01   +9.993135651133808e-01   +9.833270903390431e-01   +9.968770778986898e-01];
L2I_Input2_iAMPA_netcon = [+9.920431300995395e-01   +9.984698538719127e-01   +9.854196323891025e-01   +9.943404088039349e-01   +9.891247804270381e-01   +9.902737356865531e-01   +9.953314719192715e-01   +9.968729379485352e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
