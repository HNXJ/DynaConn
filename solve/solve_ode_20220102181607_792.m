function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.141485528294064e-01   +4.580356067843238e-01   +9.626248891652818e-01   +6.900545116755331e-01   +2.142657292626161e-01   +6.685963523469711e-01   +1.084731281204773e-01   +5.111652980313736e-01   +4.309903833987674e-01   +9.262631899765951e-01   +1.618925978039029e-01   +2.032033074012833e-01   +4.011481251232428e-01   +3.992693868963397e-01   +2.534161910117915e-01   +1.710404443182408e-01; +7.507909732979497e-01   +8.477284531485053e-01   +6.291636883281154e-02   +8.274854829130717e-01   +6.687777146342334e-01   +6.300150372630295e-01   +5.791086919772783e-01   +4.248429694686336e-01   +7.311538868374756e-01   +6.876211964534290e-01   +4.999544920001963e-01   +5.797713676919849e-01   +4.609805563104305e-01   +8.582964533672016e-01   +5.015278194465979e-01   +1.372614655930831e-01; +9.023477337769583e-01   +1.729872581242887e-01   +3.851827408139589e-02   +1.940906367024511e-01   +5.450267592096298e-01   +1.696330671813555e-01   +8.127225277057020e-01   +6.165278165493776e-01   +7.806145701664847e-01   +6.043602977380645e-01   +2.326374166447912e-01   +1.012622600212815e-01   +4.436070881752278e-01   -2.970938286813725e-02   +4.173402907606452e-01   +2.053112217493863e-01; +9.007956573253791e-01   +8.402079173287649e-02   +1.261604697136753e-01   +9.379659182977437e-01   +5.864170183866712e-01   +5.697647553073120e-01   +6.919598919841539e-01   +8.462265536099688e-01   +6.008155911143960e-01   +3.624956162204958e-01   +6.224854797959799e-01   +8.443099835008999e-01   +3.567974902745309e-01   +9.183124746064190e-01   +2.441321905466320e-01   +2.221358013974870e-01; +6.362949137192597e-01   +2.555541269185520e-01   +1.000000000000000e+00   +7.667074854132179e-01   +3.363120407017193e-02   +1.345323315088081e-01   +2.702371324890693e-01   +8.978717539097364e-01   +5.987069167073878e-01   +5.216884296154845e-01   +5.562900069867103e-01   +9.889528916899742e-02   +3.075547344349476e-01   +9.633606838744123e-02   +6.391474434945252e-01   +4.156307094268891e-01; +3.106413896250422e-01   +5.954989690242508e-01   +5.607298091704747e-01   +7.141648207979791e-02   +9.417574428431561e-01   +2.455580334924500e-01   +8.658816615539642e-01   +3.863099235252040e-01   +4.039147263195951e-01   +7.228611253050320e-02   +1.352192538960743e-01   +5.744570281680693e-01   +9.359280136674265e-01   +1.873416661448310e-01   +2.355831366496780e-01   -3.763069568007021e-03; +7.229056075735609e-01   +8.264790693808738e-01   +5.209950358591953e-01   +3.865946089555598e-01   +1.278007918292475e-02   +3.480802463566011e-01   +9.688950309109426e-02   +6.381630379506005e-02   +8.756980920320983e-01   +5.257204047552263e-01   +3.543027014000077e-01   +8.924193009196230e-01   +3.877125473346951e-01   +3.694643816755139e-01   +8.164776119792585e-01   +5.701929624523017e-01; +3.716003024144963e-01   +6.349420736372999e-01   +4.193789387125953e-02   +7.687825534050008e-01   +3.992146268211281e-02   +1.775586066430095e-01   +5.563053367392676e-01   +6.995626726759839e-01   +4.181219900813329e-01   +5.712403219590456e-01   +2.478010524756576e-01   +7.117310789866361e-01   +7.865630633820352e-01   +5.665753723561410e-01   +8.254416334479501e-01   +5.010805893570830e-01; +3.003033109730214e-01   +8.885155127889777e-01   +2.907588308582271e-01   +6.636828151098578e-01   +2.533314386194205e-01   +8.948744644240827e-01   +9.178839240551195e-01   +1.912073726610004e-01   +1.071247615397042e-01   +7.671322311255867e-01   +8.788385982205487e-01   +9.030064311140253e-02   +8.186961165590182e-01   +6.138283661597796e-01   +1.429222344697937e-01   +9.977247155733467e-02; +4.784635174870948e-02   +6.161681945261627e-01   +8.783517164905109e-01   +8.496326161831805e-01   +7.250439543782087e-01   +7.503698282919596e-02   +9.484101504143877e-01   +6.580934723246136e-01   -1.693600776359827e-02   +4.293125712781353e-01   +6.806131476829358e-02   +8.292370837187454e-01   +9.049988002594701e-01   +2.669915916361003e-02   +5.262676557952032e-01   +7.241314334652870e-01; +3.131879347763538e-01   +6.650094859874862e-01   +9.672121029627272e-01   +5.897051942854419e-01   +8.265254757552174e-01   +7.607918681032771e-01   +3.890620942242871e-01   +4.697422931545678e-01   +3.854833742932966e-01   +5.778942221096264e-01   +6.018805656479085e-01   +6.045419071027451e-01   +6.552884179436887e-02   +7.478358376869276e-01   +5.356696581642363e-01   +8.075763814268485e-01; +8.916283876601880e-01   +8.890452399825918e-02   +6.073183047216619e-01   +2.423863660998178e-01   +4.633889482289014e-01   +5.947496069426638e-01   +6.174022184613633e-01   +4.306828641799524e-01   +8.574226444186260e-01   +2.628096741186778e-03   +4.431774464134942e-01   +7.232073008188955e-01   +1.066550134187332e-01   +2.503116226801947e-02   +2.313098872656595e-01   +7.271318808400710e-01; -3.586390946178614e-02   +7.494954328597974e-01   +6.614727751755209e-01   +7.085277952509271e-01   +6.920155903209007e-01   +5.995828754270085e-01   +4.951227828843128e-01   +5.861388013243719e-01   +9.062341810925161e-01   +6.644976745881954e-01   +1.670319475675318e-01   +3.174543032567635e-01   +9.060570175679945e-02   +8.067458323824069e-02   +7.688607347033628e-01   +4.747716903440328e-01; +4.434821780722746e-01   +7.255159657569826e-01   +5.383148607411173e-01   +1.973369514378998e-01   +6.165020052004790e-01   +6.911588881001355e-01   +6.901038538614116e-01   +9.085359490521246e-01   +2.045379762153456e-02   +3.969593529593642e-01   +5.022207241780327e-01   +4.451731053575916e-01   +8.549489506436490e-01   +3.677667683213550e-01   +8.225127398081146e-01   +5.682421478206421e-01; +5.883842026397913e-01   +1.151444014350159e-01   +2.938626040757463e-01   +9.498006657854068e-01   +5.966310851674812e-01   +5.247163902506242e-01   +4.095322080737417e-01   +5.636256475532556e-02   +1.458315517850407e-02   +4.874747568151382e-01   +4.250150649980945e-01   +8.293132900186079e-01   +9.202890278710486e-01   +6.903807322663275e-01   +7.512024929872680e-01   +4.831962560884401e-01; -4.041122018049477e-02   +3.055114742561611e-01   +7.702761583744715e-01   +3.349700416524273e-01   +8.026382071390986e-01   +7.850100261496867e-01   +3.780929026159136e-02   +9.505136986947202e-01   +4.569253468411193e-02   +7.800582365135453e-01   +4.975798220854978e-01   +3.180577509369153e-01   +7.509451800418597e-02   +7.345213323670768e-01   +8.453614310930926e-01   +2.964564747223751e-01];
L1E_L1I_iGABA_netcon = [+9.828211702028035e-01   +5.642210416320153e-01   +7.687892332406983e-01   +4.875606330815512e-01   +3.698666227558433e-01   +4.690988904713329e-01   +7.539294078158417e-01   +4.413086216705164e-01   +4.480417856376086e-02   +1.760527466076779e-01   +5.109233878380774e-01   +3.271818924358949e-01   +7.570361721115658e-01   +1.273932317501547e-01   +3.000578448356687e-01   +8.973682545515581e-01; +5.920994156150434e-01   +2.608328145223508e-02   +7.787881242235715e-01   +2.439919448997494e-01   +4.007621035921552e-01   +9.060952057953817e-01   +5.261205391965412e-01   +9.289717866496788e-01   +4.916002364642189e-01   +6.872347549860718e-01   +6.426290367225577e-01   +9.934997853284185e-02   +9.115382182276870e-01   +3.428515350135887e-01   +3.214223219150188e-02   -4.132605199741086e-03; +2.898099812995034e-01   +8.116702604948934e-01   +8.063532418412794e-01   +2.800612376737793e-01   +7.719299383856053e-01   +7.494796700518038e-01   +4.669129651303958e-01   +6.605441905647430e-02   +2.132177386503686e-01   +8.499160429470561e-01   +5.674063883733489e-01   +7.201484788179771e-01   +3.895649275130028e-01   +1.628519680499116e-02   +8.515717411788891e-02   +8.434244293218773e-01; +8.999540579878431e-01   +1.081617270075429e-01   +2.927430253077625e-01   +6.449873266886852e-01   +2.259237847496123e-01   +1.315752415125384e-01   +5.517681264829617e-01   +8.673619370425796e-02   +5.224741053649862e-01   +2.887873659259507e-01   +4.511919567475367e-01   +8.275999266832672e-01   +1.679136112652694e-01   +8.644415037921884e-01   +5.027336740401931e-01   +1.056660474215858e-01; +5.180756614827969e-01   +5.038725049781702e-01   +4.180411154283937e-01   +2.227358409135843e-01   +6.953169042677022e-01   +3.287338211909819e-01   +8.419437878799200e-01   +1.992669289794863e-01   +6.743411841929586e-01   +2.728165493138048e-01   +3.414869623474031e-01   +9.178868752229107e-01   +6.072526354454815e-01   +2.121600130931477e-01   +3.055002827897026e-01   +6.390231670131701e-01; +4.069378818073593e-01   +9.021957674232816e-01   +7.197820365840115e-01   +5.119808482376437e-03   +7.464342290614432e-01   +7.227447811441878e-02   +4.065730450388396e-01   +7.777171732531932e-02   +3.978219158258945e-01   +4.035409010068629e-02   +7.300405677188706e-01   +9.429323639666176e-01   +6.554509093225430e-01   +2.302669133917190e-02   +5.802971511938882e-01   +4.037255595647979e-01; +6.432201714123507e-01   +3.844991608798837e-01   +3.800631202255862e-01   +4.495909698684177e-01   +9.914796078402480e-02   +4.673142189557553e-01   +6.623090818577813e-01   +2.838295451318205e-02   +3.306027082104145e-01   +4.010149179628768e-01   +3.765058964715686e-01   +5.216186111899267e-01   +9.901530575541625e-01   +6.210236695459662e-01   +5.432069333861035e-01   +4.361334593674782e-01; +9.607395417681162e-01   +6.553590244731148e-01   +7.370313378133089e-02   +4.734668167285816e-01   +6.564870615118239e-01   +1.105348119150562e-01   +5.077911605627509e-01   +2.398047429350697e-02   +1.000000000000000e+00   +1.276681014950677e-01   +7.747124747637453e-01   +1.668646595178786e-01   +3.943672815165927e-01   +3.516247655378902e-01   +6.850686066656186e-02   +5.680398539791027e-01; +6.761406721354870e-01   +2.535874978119473e-01   +4.480399751442181e-01   +1.284028758821053e-01   +6.510854241798428e-01   +9.540885419649507e-01   +4.018333319432927e-01   +6.847560844503685e-01   +5.643476277968864e-01   +5.096405708815405e-01   +5.539819392292871e-01   +7.604661302703859e-01   +3.009913965136661e-01   +5.219833401152493e-01   +3.666424976487573e-01   +2.550460751642416e-01; +1.221096836797414e-01   +7.280694729807859e-01   +1.829483650166863e-02   +8.904482161524684e-01   +2.427787150367280e-01   +8.082319874795658e-01   +5.313263762866666e-01   +3.195688885741649e-01   +8.999039781869430e-01   -1.003719031768915e-02   +7.072814560379179e-02   +5.091994483313611e-01   +7.032428651591468e-01   +6.153655773271191e-01   +4.665406968007321e-01   +7.512886209047888e-01; +7.672323617761264e-01   +2.910956840436634e-01   +5.082511046767924e-01   +4.880516814544912e-01   +9.773643706757211e-02   +3.452105464851561e-01   +6.812342328334203e-01   +3.792319600676951e-01   +9.436266086913175e-01   +3.632396045353029e-02   +3.550838047755498e-01   +9.087348516947386e-01   +6.725320592602301e-01   +2.000692600342582e-01   +4.916141456029992e-01   +1.654170646419648e-01; +6.566477395443144e-01   +3.386829692531897e-01   +3.171946858881439e-01   -2.983457981416236e-02   +1.764854994191261e-01   +1.070093837206888e-01   +2.826539572749684e-02   +9.562276077329347e-01   +1.694556303750189e-01   +9.025605923987776e-01   +5.296098827322006e-01   +9.741240105113848e-01   +4.064429609566221e-01   +2.367968606224353e-01   +4.951600004710295e-01   +7.569944424390710e-01; +7.509767866016837e-01   +2.753603939393149e-01   +1.192852306144974e-01   +9.178282669868949e-01   +2.621568720938202e-02   +3.217573830736840e-01   +6.580124952456747e-01   +3.152653502160500e-01   +1.352865685921860e-01   +7.128789443754899e-02   +9.344466067220949e-01   +3.020271647370663e-01   +1.682188797986803e-01   +3.788116360497429e-01   +8.889818705541136e-01   +5.754648152860039e-01; +1.685947826392472e-01   +5.764849794954499e-01   +2.545197881696650e-01   +7.680725667369267e-01   +7.990341006723639e-02   +7.001120512147264e-01   +5.279359546711530e-01   +5.055829358205137e-01   +8.412708578324005e-01   +1.138487043952453e-01   +4.535700570350713e-01   +1.059249443711781e-01   +6.140407628341429e-01   +2.657675762944341e-01   +2.106309021706194e-01   +1.864024698051413e-01; +8.288378855926389e-01   +7.424367744570586e-01   +2.035054712028636e-01   +1.911340897122221e-01   +6.224176632121647e-02   +4.975506623599867e-01   +4.034088820972520e-01   +8.105079485693646e-01   +3.450575699789249e-01   +4.306896679165295e-01   +6.927364344707145e-01   +4.015162481115421e-01   +2.826797996189176e-02   +2.100972910213079e-01   +4.625444427535365e-01   +9.744340642918436e-01; +7.932158340414922e-01   +4.435242260061419e-01   +8.618228397506146e-01   +5.156018689257262e-01   +7.334092723119088e-01   +5.968435347758524e-01   +5.351330472969764e-01   +3.559932270424406e-01   +8.076885026240642e-03   +3.556291680783773e-01   -3.318295824355739e-02   +7.089382734089076e-01   +5.713302968097790e-01   +5.348539568994055e-01   +2.028479613956420e-01   +3.687063904952760e-01];
L2I_L1I_iGABA_netcon = [+5.060769133461351e-01   +1.044999464713363e-01   +1.644461268581656e-01   +9.288899742963304e-01   +3.062748317535949e-01   +3.534796895024884e-01   +8.023880978382372e-02   +5.999256838635415e-01; +6.489246851769144e-01   +6.553695012259459e-01   +4.337010795142056e-01   +3.449727674387179e-01   +5.035648638482373e-01   +4.182838440125927e-01   +5.908578747823520e-01   +4.318842222843398e-02; +3.507976234328606e-01   +7.514686449897622e-01   +6.814107353010980e-01   +2.715903835832641e-01   +5.723570415735226e-01   +1.414649101212716e-01   +4.095037212152398e-01   +2.473558619029296e-01; +6.549135701436722e-01   +2.003456831980724e-01   +6.542925172177451e-02   -5.178407420127947e-02   +6.821672161917762e-01   +5.211031339853778e-01   +5.862486181282764e-01   +6.738184863298446e-01; +1.128894374605434e-01   +8.918402733613880e-01   +2.584359868255831e-01   +7.243497961239448e-01   +6.281757688463992e-02   +3.764909741336075e-01   +4.446549923245467e-01   +2.958804563901379e-01; +7.425205297356632e-01   -3.714681651021777e-02   +1.991206938258729e-01   +4.137604414682428e-01   +5.727056540852325e-02   +4.124437031015136e-01   +5.651960086859923e-01   +9.360756422632913e-01; +5.783588952906542e-01   +1.000000000000000e+00   +9.405077402440711e-01   +5.895315122635605e-02   +4.939705221015494e-01   +2.650096842537405e-01   +7.744998131436704e-01   +3.133023692847442e-01; +4.641522263412008e-01   +5.557850798878352e-01   +1.477337839454656e-01   +2.730756185087626e-01   +6.573763132349015e-01   +3.408856746191464e-01   +4.002443064267620e-01   +2.081148889687128e-01; +6.241528450619661e-01   +8.716061114158205e-01   +2.017556179276319e-01   +5.526237297307581e-01   +4.875588041663076e-02   -9.848077925016898e-03   +1.494068549109654e-01   +4.193986382730871e-01; +1.070738858919788e-01   +2.366064717207102e-01   +2.434364398240797e-01   +9.123012906401993e-01   +8.370066246043270e-01   +4.220262208391750e-01   +1.326108270988932e-01   +8.295208311173572e-01; +1.762195136171858e-01   +7.505195659409361e-01   +1.353901992029462e-01   +7.206904753282096e-01   +6.136614099201421e-01   +5.777996515977835e-01   +5.169208097135376e-01   +1.471252807688770e-01; +4.779219676694113e-01   +8.697141117819175e-02   +7.730655749279177e-01   +5.860823051974429e-02   +7.747219351709675e-02   +6.895277708379600e-01   +6.037763421181729e-01   +4.210945817973764e-01; +3.113464882572422e-01   +6.305924060490365e-01   +9.530861231742891e-01   +7.933907165884053e-02   +1.644199094835260e-01   +2.950426365612306e-01   +9.602918705350472e-02   +4.772318754319414e-02; +1.979661492306819e-01   +2.500347620810379e-01   +1.050007691494627e-01   +7.756450908426205e-02   +4.613941040203253e-01   +2.054573416885749e-01   +4.356838024349605e-01   +4.871230537214531e-01; +8.234822117656868e-01   +7.633956392363037e-01   +9.155190196015517e-01   +8.839164404622551e-01   +7.493947417666608e-01   +9.296391935131975e-01   +8.712171501054097e-01   +7.517225550747226e-01; +4.126067651722671e-01   +3.705932831358605e-01   +8.265911207502195e-01   +5.004726297913339e-01   +2.672811358333755e-01   +3.989518952494401e-01   +7.707461744135626e-01   +9.028691203427114e-01];
L1I_L2I_iGABA_netcon = [+7.024642381589591e-01   +3.903476414041868e-01   +3.945050816711937e-01   +7.882956129939117e-01   +4.665230434754601e-01   +4.270997937295613e-01   +7.187265167216005e-01   +8.596706346972024e-01   +6.457577640807713e-02   +6.661221325181029e-01   +5.053790996371382e-01   +4.466124145635171e-01   +8.478852274799615e-01   +3.654692923025316e-01   +2.546356016525537e-01   +3.002903914572669e-01; +3.188389718079191e-01   +9.625454519955706e-01   -9.814878129458868e-03   +1.961848313525366e-01   +4.672722566042360e-01   +6.306375241535079e-01   +8.079669784932877e-01   +2.074881038324046e-01   +9.846271063371476e-01   +7.492344961816789e-01   +7.102741720370922e-01   +4.251128478775513e-01   +4.252611551997317e-01   -1.150293727623926e-02   +2.590313096776347e-01   +7.298832515389529e-01; +1.958904420394316e-01   +3.441583021508300e-01   +5.491967566132696e-01   +6.098684109968033e-01   +7.532578257386187e-01   +8.865075906990602e-01   +8.033009120248862e-01   +8.500438427850455e-01   +7.745525809830790e-02   +1.899467139980018e-01   +6.833629935704852e-02   +7.256071423898719e-01   +7.240617335825942e-01   +8.894599675449785e-01   +6.058202206692761e-01   +9.142200378140635e-03; +8.851631725731111e-01   +5.606400605382655e-01   +4.803812865522082e-01   +4.991398670932189e-01   +8.938081368713033e-01   +3.766673631329437e-01   +6.923074173775964e-01   +6.551940223852719e-01   +3.845231720662141e-01   +3.309699642903831e-01   +1.749053015122074e-01   +4.239913027262248e-01   +7.064636629391011e-01   +3.638760741528156e-01   +5.836483816756083e-01   +1.749935638945023e-01; +8.232804270522485e-01   +3.590952734651962e-01   +6.957890321433020e-01   +9.200232270684301e-01   +2.440113559340138e-01   +9.215422952558346e-01   +9.460217424761569e-01   +5.678653174583548e-01   +6.917670792904282e-01   +4.057157340070227e-01   +2.095076979226880e-01   +6.782831188081503e-01   +1.024949466957836e-01   +5.539699293155965e-01   +5.644768757533697e-01   +3.382314011515383e-01; +4.217005862403454e-01   +5.974508465560285e-01   +2.448519593925380e-01   +6.673440771611131e-01   +1.080314714898664e-01   +5.515801320550092e-01   +7.771866176080127e-01   +3.017241445427516e-01   +2.976647196082907e-01   +2.449739552799202e-01   +5.564583584614765e-01   +1.323301151769923e-01   +5.812860538193059e-01   +4.599695905568551e-01   +2.799189713619991e-01   +3.019115665596241e-01; +6.070133882222496e-01   +6.525237236608269e-01   +2.560846629884392e-01   +3.409609503554458e-01   +9.446462819953275e-01   +7.217648881648425e-02   +5.432585349347375e-01   +3.096254274551735e-01   +4.201346952723254e-01   +8.660538806629440e-01   +1.474462327384649e-01   +4.628911987441566e-01   +5.145508626400783e-01   +6.237059554571545e-02   +3.614588327926181e-01   +6.753285667650597e-01; +5.171429774768377e-01   +4.513851719714684e-01   +6.668095139688053e-02   +6.984245867951540e-01   +8.559821340343227e-01   +5.918035236843476e-01   +5.367377909573554e-01   +5.584214983789196e-01   +1.512329849714212e-01   +2.137873803451308e-01   +1.000000000000000e+00   +3.400721852206828e-01   +8.515717360741923e-01   +2.809692939443769e-01   +8.778249481435038e-01   +2.969936765803789e-01];
L2E_L1E_iAMPA_netcon = [+6.703148712857515e-01   +5.819588957190620e-01   +1.587170514201737e-01   +4.782155118107250e-01   +8.434656235994190e-01   +7.926811420502834e-01   +4.228352652545946e-01   +7.080517571208111e-01; +1.464141723210425e-01   +4.688168798384430e-01   +8.124945029174854e-02   +4.050575579075258e-01   +6.595550101989925e-01   +4.272500596061622e-01   +4.233219097116494e-01   +5.232986312319723e-01; +7.090819662201346e-02   +9.183494386606277e-01   +3.868342125006952e-01   +4.057590414052960e-01   -5.511711470412817e-03   +6.259517871403005e-01   +6.394616302419445e-01   +9.186109252437856e-01; +5.898407151229511e-01   +3.555348600673898e-01   +2.148292686958146e-01   +7.674061789559730e-01   +3.833679284182488e-01   +5.295970343239378e-01   +3.599292390660738e-01   +3.708357857073455e-01; +1.569788588128715e-01   +5.558535883840597e-01   +1.164799018555632e-03   +5.490362084040564e-01   +8.182804195188071e-01   +4.426901107922589e-01   +9.416096794314478e-01   +1.000000000000000e+00; +7.083606267231988e-01   +1.653893794756542e-01   +8.822808473050097e-01   -9.042779591166365e-03   +4.030083605871889e-01   +7.711821988002621e-01   +8.838898851035284e-01   +3.080545954131229e-02; +2.337420922951008e-01   +7.478177680049397e-01   +2.508638155328553e-01   +8.333808888990579e-02   +1.703324831370142e-02   +4.082887538969575e-01   +7.206804803969650e-01   +1.757628973239805e-01; +6.473868910040480e-01   +6.387425150224372e-01   +8.022617124461786e-01   +3.108259026375325e-01   +1.315607807539324e-01   +4.479372091186055e-01   +6.909591857988358e-01   +1.044776852285464e-01; +8.818217908457515e-01   +5.227152712707150e-01   +6.246835544207805e-02   +8.085483227989967e-01   +3.967775614544280e-01   +6.444415481435248e-01   +2.269995154214116e-01   +2.088671162496372e-01; +3.336757343852620e-01   +7.219491801122385e-01   +8.409764169524383e-01   +3.112014252278712e-01   +2.668648546641578e-01   +3.230300624095335e-01   +5.548799791653130e-01   +9.134281209746989e-01; +6.222664917262969e-02   +4.640804675102947e-01   +5.005313231482974e-01   +6.101829416514724e-01   +4.814404691584261e-01   +5.315670110354047e-01   +4.473342251216327e-01   +7.063916248130371e-01; +1.803367777507886e-01   +3.793314666303361e-01   +5.763268666831923e-01   +1.144804805130949e-01   +3.059932117165322e-01   +5.302721538702896e-01   +9.899453263448359e-02   +4.015606364633434e-01; +3.189345312677908e-01   +5.389283184797917e-01   +1.548238387269522e-01   +5.724017746783857e-01   +6.683898476266572e-01   +2.261309300898292e-01   +3.337045211422833e-01   +9.126889381969180e-02; +2.760335387975464e-01   +6.297046711142664e-01   +4.866733832435167e-01   +7.688888250222518e-01   +6.418714792183419e-01   +3.075949173034625e-02   +4.699118267873467e-01   +5.878066233380294e-01; +1.798396493794752e-01   +1.278161904954234e-01   +6.673559909565098e-01   +4.898108467139370e-01   +4.498030214832744e-01   +8.688461113117173e-01   +2.495332649715062e-01   +7.840751932130600e-01; +4.704184509720014e-01   +1.172282730604237e-01   +3.640084759885340e-01   +4.132024606807810e-02   +8.000331695389615e-01   +6.530811955227784e-01   +5.291924435361526e-01   +7.223146495701565e-01];
L1E_L2E_iAMPA_netcon = [+1.873033453126218e-01   +2.130529984727919e-01   +1.208398072102537e-01   +7.326411701414208e-01   +5.070181327546538e-01   +4.692650655676723e-01   +4.692386083196413e-01   +4.975442622703834e-01   +9.049493274679401e-01   +7.464139329015945e-01   +5.308438436830648e-01   +8.410764627006531e-01   +4.885643591632518e-01   +3.528701686697904e-01   +6.312677143384892e-03   +4.081865029340603e-01; +5.068247125095613e-01   +1.761018070231070e-01   +6.240187202980910e-02   +6.830833405644141e-01   +5.786262380469862e-01   +8.853174788655795e-03   +1.305717784395077e-01   +7.096264218678856e-01   +6.361667538492817e-01   +1.451356751073676e-01   +7.177220282294644e-01   +7.932209788857807e-01   +3.595227276009421e-01   +2.284977213833080e-01   +2.266591891399119e-03   +4.074161801964838e-01; +9.296443199045950e-01   +7.447826422528930e-01   -1.417109368753555e-02   +5.031594970968988e-02   +7.327104607551211e-01   +7.783497654828825e-01   +3.853502724442927e-01   +9.673355497831038e-01   +3.784381025881268e-01   +3.361954913384588e-01   +9.980650487092024e-02   +1.718618214855809e-01   +2.708104169430410e-01   +6.353572558609361e-01   +9.170076176879149e-01   +1.951998026058706e-01; +4.995743189325101e-01   +6.908311189113369e-01   +7.392094804604202e-01   -2.308768020940662e-02   +4.123540284566383e-01   +5.813055276435206e-01   +8.904830148530861e-01   +5.339406237708068e-01   +3.579196020635186e-01   +4.248990845244352e-01   +8.437964405169718e-01   +3.298442094187392e-01   +6.075195118523425e-01   +4.711619180556748e-01   +9.163863835883524e-01   +6.453112107678471e-02; +2.428498278138071e-01   +3.841357786455503e-01   +9.494096804679681e-01   +4.006038783426243e-01   +9.749380628116368e-02   +9.379962298984448e-01   +2.732714132509841e-01   +5.033167427014018e-01   +9.591714727936067e-01   +3.321670513575338e-01   +5.787849571883158e-01   +3.085763040894905e-01   +6.926704050458596e-01   +1.000000000000000e+00   +8.478074136843591e-01   +5.633148685678979e-01; -4.428046360083684e-02   +8.131208960276304e-01   +2.927874197417623e-01   +5.375729653857886e-01   +2.774569332147251e-01   +9.579314234851584e-02   +9.044174392504909e-01   +4.147954104190124e-01   +9.115493123303514e-01   +3.735823746170271e-01   +8.813970061157343e-01   +1.710679406521877e-01   +4.424671304076747e-01   +1.402536198335522e-01   +2.492517902147273e-01   +1.925005020574633e-01; +3.443703443803124e-01   +3.093486619337480e-01   +6.782040237810966e-01   +9.028526170235280e-01   +1.941829051407090e-01   -7.937486280516768e-03   +9.177347245812238e-01   +7.486940774712167e-01   +3.106887422083691e-02   +8.263787963894280e-03   +4.278095761028561e-01   +3.545558057705339e-01   +1.484691744485016e-01   +6.220674788604895e-04   +5.420114815805728e-01   +1.763924505719029e-01; +1.132622728911711e-01   +3.379465445267955e-01   +9.006451840799851e-01   +6.116715782959609e-01   +8.383397126955431e-01   +9.485595877823392e-01   +9.716878770800429e-01   +2.391746778856634e-01   +2.395861586400843e-01   +6.799231420622047e-01   +9.260796588438717e-01   +6.194578895857347e-01   +4.708174043847576e-01   +3.834379532035644e-01   +2.953106923934816e-01   +3.116854418371745e-01];
L2I_L2E_iAMPA_netcon = [+6.529023710353912e-01   +9.297755218061338e-01   +6.044918768554087e-01   +2.907291613508121e-01   +4.653118161970084e-02   +8.496582573807318e-01   +5.366554863275750e-01   +5.137965842468118e-01; +9.206945854233095e-01   +1.347994774616235e-01   +9.533101270948129e-01   +7.879758997228153e-01   +9.730206793341599e-01   +1.437579075475724e-01   +3.790430557631139e-01   +4.914404739462835e-01; +1.000000000000000e+00   +4.220990623608100e-01   +2.398622637347484e-01   +9.530165765231093e-02   +5.362667583661006e-01   +7.901226171644481e-01   +5.311021015833536e-01   +5.596582565244740e-01; +2.782035893492386e-01   +7.520570798726994e-01   +4.266880978704820e-01   +9.202501906868196e-01   +4.407136677794214e-01   +4.532627056921971e-01   +3.126560106144191e-01   +8.277693493518435e-01; +6.965572874317565e-01   +6.177835592628221e-01   +6.669580708875477e-01   +7.507374155352163e-01   +6.300143986610588e-01   +7.763722494936635e-01   +8.144621083838532e-01   +1.489696720103269e-01; +3.638719650503123e-01   +9.014995525962370e-01   +2.183617590469566e-01   +6.930759764147311e-01   +4.007410355006062e-01   +1.419830311350963e-01   +7.708945233668947e-01   +2.803774012757910e-01; +5.843653883053053e-01   +2.057999133223563e-01   +4.482258072874585e-01   +8.987836328326271e-01   +8.004280429086117e-01   +7.559841661806309e-01   +9.082803748674784e-01   +4.373790331522039e-01; +8.235600494137472e-01   +5.863220568621046e-01   +1.339385657068327e-01   +4.045394521276801e-01   -7.074772569400248e-03   +7.652837462401106e-01   -5.034779546077232e-02   +7.377125178329956e-01];
L2E_L2I_iGABA_netcon = [+7.530261452908570e-02   +4.768103932539638e-01   +4.771445825844988e-01   +2.283689016810311e-01   +2.616970158980562e-01   +3.118953306993372e-01   +5.450380752392699e-01   +8.224632879674316e-01; +5.816122129530488e-01   +9.472704661112821e-01   +7.236305169419578e-01   +4.954872729581056e-01   +8.267308258425961e-01   +6.967967293668588e-01   +1.696489418179777e-01   +2.949262304111123e-01; +2.795181186153796e-01   +1.000000000000000e+00   -1.665169889869632e-02   +3.332598832546817e-02   +5.140765831829689e-01   +8.573344287049276e-01   -3.960826842316956e-02   +4.992326258409272e-01; +2.255958531834954e-01   +9.654421833493690e-01   +4.752521110738853e-01   +8.620829619327084e-01   +9.472689400705377e-01   +8.813220669369864e-01   +1.964175446238784e-02   +3.288052178582936e-01; +5.580408235151586e-02   -1.824570619792006e-02   +2.835887674550328e-01   +7.903884400451292e-01   +8.437673683295934e-01   +5.779310719823781e-01   +1.134769540319568e-01   +8.790871252166302e-02; +3.321913275737889e-01   +2.810762969540416e-01   +3.042580903474877e-01   +3.859686708050344e-01   +8.714128353002607e-01   +1.036053685957896e-01   +6.312729673437244e-01   +1.330703049298168e-01; +8.373431071731909e-01   +9.114254009571607e-02   -1.145904004606223e-02   +3.222372702039129e-01   +1.529815218621281e-02   +1.026472926926790e-01   +5.916704458642277e-01   +9.499603734314399e-01; +6.003753423452923e-02   +8.187592220480675e-01   +5.573601160063271e-01   -2.826099915827309e-02   +8.670378277744484e-01   +8.752733103488990e-01   +6.849428362303592e-01   +7.079634344013729e-01];
L3E_L2E_iAMPA_netcon = [+2.893777289569905e-01   +4.971316080932364e-02   +6.070861779210296e-01   +6.409826296069102e-01   +2.596993792176525e-01   +2.365817114598559e-01   +4.814023821146906e-01   +8.494674116316312e-01   +6.559476027942645e-01   +4.139033476755062e-01   +8.688496152000107e-02   +6.879281753136242e-01; +5.895208891010792e-01   +9.515842355892514e-01   -1.215331398932321e-02   +3.104777384580572e-01   +3.166136864196045e-01   +5.676310092836771e-02   +3.052779559140132e-01   +4.111336894105327e-01   +8.838601457099696e-01   +2.841195337192491e-01   +6.675680537109233e-01   +4.045745305764855e-01; +2.693233426225062e-01   +7.558011417091006e-01   +5.874658616532082e-01   +6.433933851362694e-01   +9.227300250797001e-01   +8.285775677078625e-01   +9.793230997471623e-01   +6.527462077177836e-01   +6.550582822016219e-01   +2.196050432651201e-01   +6.367249768835290e-02   +8.026077036376082e-01; +3.590943011396385e-01   +3.544836656928645e-01   +8.855761862975731e-01   +2.333317205892783e-01   +7.642516249642743e-01   +5.088555609527464e-01   +2.321845517037130e-01   +5.059353700165993e-01   +5.408389787327522e-01   +8.213551048318929e-01   +4.341609498275452e-03   +2.426210890725981e-01; +7.148335290778460e-01   +3.228981570239432e-01   +2.135394687390624e-01   +1.152400161402849e-01   +9.200919913901259e-01   +4.314336654824197e-01   +3.034521708015223e-01   +2.091028114940844e-01   +9.236636594288277e-01   +6.533162633277736e-01   +8.528711592789120e-01   +6.771538098608957e-01; +7.356721862952255e-01   +7.271568000631041e-01   +6.911260511922397e-01   +1.550856202761228e-01   +8.778166574469316e-01   +9.570267438235395e-01   +1.463369816791227e-01   -1.821147135460340e-03   +3.345774199774638e-01   +9.692840130101363e-01   +7.806815741034742e-02   +6.046684444665462e-01; +2.515083269538370e-02   +5.455311633052933e-01   +7.081203584035389e-01   +3.239944831805869e-01   +5.351324102744540e-02   +8.505321924660920e-01   +8.154412189664387e-01   +9.220505049368274e-01   +3.957763454957191e-01   +5.457047376888092e-01   +1.422376348568694e-01   +3.309539663545698e-01; +1.635383242405933e-01   +6.472987532556754e-01   +1.005853514497045e-01   +2.078846073192800e-02   +4.274440013791836e-01   +7.147361272008715e-02   +5.597120891136491e-01   +1.230138265829817e-01   +1.000000000000000e+00   +8.657024153917606e-01   +1.597827158866462e-01   +4.327633764759888e-01];
L3I_L2I_iGABA_netcon = [+7.147159615426806e-01   +6.278832784181778e-01   +5.563758586746662e-01   +8.004806999501319e-01   +3.048302759683088e-01   +2.424305275112690e-01   +7.863563533768133e-01   +3.529564892876899e-01   +8.579535842117449e-01   +1.297273735395398e-01   +7.563718798061220e-01   +6.476158347506725e-01; +6.377809340736899e-01   +6.840878813980804e-02   +4.407503875842624e-01   +3.150334074410376e-01   +8.127440962556725e-01   +2.793277759268248e-01   +5.971701005400064e-01   +2.425823636358816e-01   +3.832423680956807e-01   +2.068351776451046e-01   +6.468863456277537e-01   -4.448755495261470e-04; +5.700679038486772e-01   +7.073675552499756e-01   +8.117181661772056e-01   +2.577354420603437e-01   -4.593733367744895e-03   +7.919795263983637e-02   +3.838097907361542e-01   +8.931753565200203e-01   +1.866917780001573e-01   +2.361498832632033e-01   +2.244080282805585e-01   +4.911102333062175e-01; +2.476953855801143e-01   +7.500307301237086e-01   +7.258565885080419e-01   +2.772080121115695e-02   +1.615330186217105e-01   +7.221925872173917e-01   +8.571489184727903e-02   +3.376337639479110e-01   +5.473006039743877e-01   +1.632130189824960e-01   +7.964569442067740e-01   +3.607371689684272e-01; +3.181507152501041e-01   +5.087393588930394e-02   +2.101241012368091e-01   +5.495016083594719e-01   +7.681170259119642e-01   +8.297710491640842e-01   +2.503445837225348e-01   +6.810657776994304e-01   +7.886170416314127e-01   +3.833175523073782e-01   +3.407664193250974e-01   +9.229114879182058e-01; +1.317308222927793e-01   +9.205982851956651e-01   +2.315193745687755e-01   +7.438122091961901e-01   +7.818833907198802e-01   +3.057812279794610e-02   +1.408050616309074e-01   +5.652562352609407e-01   +3.220896738806935e-01   +3.235592048075684e-01   +7.803683411060948e-02   +8.992007313530552e-01; +7.954194662465180e-01   +5.387995314418315e-01   +5.956924888585745e-01   +4.081927169907063e-01   +2.560528569085906e-01   +3.910970019485839e-01   +1.000000000000000e+00   +4.008595331756992e-02   +1.397456859756450e-01   +5.400617826925144e-01   +5.322723057081333e-01   +2.817670180673558e-01; +2.257798545483878e-02   +3.467051732220561e-01   +7.983793734977048e-01   +9.432523011833124e-01   +7.481181855712381e-02   +5.635191886575942e-01   +4.919269202165252e-01   +4.561434269169009e-01   +5.638245425529858e-01   +5.185631099747924e-01   +3.631125619523078e-01   +8.244114598386040e-01];
L2E_L3E_iAMPA_netcon = [+3.117431776779518e-01   +1.993802225246006e-01   +1.849929672722063e-01   +4.647714938256654e-01   +1.255551590831024e-01   +1.128211556827777e-01   +2.358373590784813e-01   -2.955872572125044e-02; +4.792149024962861e-01   +8.036874640575448e-01   +5.503223459476202e-01   +2.819770840289216e-01   +8.365448869670802e-01   +7.796520635603561e-01   +1.248865723102121e-01   +6.337401511413750e-03; +2.745277366163405e-01   +2.866848044944336e-01   +7.145408649118173e-01   +8.322753111861264e-01   +2.417019445106248e-01   +2.158396406195068e-01   +7.934159806577917e-03   +4.622778618533532e-01; +1.083667554333382e-01   +6.819783255928320e-01   +6.416403479624335e-01   +5.181662705554747e-01   +7.452781959127378e-01   +3.949905434253357e-01   -3.846281491338123e-02   -1.279984889795065e-02; +1.372356435551950e-01   +5.247974151724296e-01   +6.539563905839031e-01   +9.413290405176959e-01   +6.088902281966645e-01   +2.100775548385389e-01   +2.237322126617013e-02   +6.017603288875978e-01; +6.341838944579048e-01   +6.497698005330544e-01   +9.475027779688410e-01   +6.473207941741613e-01   +1.871685088419259e-01   +6.835013746416088e-01   +8.772914306353130e-01   +4.075944944842156e-01; +8.687192486872590e-02   +5.660537763961095e-01   +9.313841833688418e-01   +7.125778433536598e-01   +4.198235069057023e-01   +5.605685982208359e-01   +2.135543867623980e-01   +4.730399382143993e-01; +7.508360465484057e-01   +4.926006109797567e-01   +3.534490577000365e-01   +2.990023199047185e-01   +6.829552066884010e-01   +6.018147995182576e-01   +6.384031718709823e-01   +7.716346624200383e-01; +7.625122177823873e-01   +4.282153715634577e-01   +8.558004843866167e-01   +4.316641702576879e-01   +3.151741986641088e-01   +4.105044158457138e-01   +5.976575416418668e-01   +5.327357891607080e-01; +2.431200540819389e-01   +3.115841018876408e-01   +1.493899202407956e-01   +8.924080684826288e-01   +5.769691740686442e-02   +3.893086926120425e-01   +8.896905565102510e-01   +3.087908516033460e-01; +5.090605926371936e-01   +2.312873463570453e-01   +2.660755580757234e-01   +7.599681206511381e-01   +9.245819221394307e-01   +8.669886682001042e-01   +2.373109777587593e-01   +9.392511443300443e-01; +5.539704468982702e-02   +6.027758026059413e-01   +1.000000000000000e+00   +4.385817369028913e-01   +1.177833128487468e-01   +1.521551708803440e-01   +1.365571706122717e-01   +6.784444580147843e-01];
L2I_L3I_iGABA_netcon = [+4.164676164085093e-01   +2.128282226211335e-01   +8.795262244462266e-01   +1.000000000000000e+00   -2.640162562452086e-03   +5.286258476086597e-02   +2.517325332362344e-01   +4.071509840019184e-02; +9.186099179364543e-02   +5.324576257533900e-01   +7.172664885272753e-02   -1.533588766252441e-02   +3.339415022202897e-01   +3.094280693601427e-03   +7.862082011915029e-01   +3.604608557631168e-01; +3.914214831998035e-01   +3.301668674791082e-01   +3.426058398627720e-01   +2.281250100504588e-01   +7.664959456883662e-01   +8.955344292744541e-01   +5.925828570762716e-01   +3.809605400165228e-01; +4.952060016965644e-01   +3.494940985060764e-01   +6.533802807481839e-01   +1.871520699994101e-02   +8.564555851921409e-01   +3.779640309356421e-01   +2.484229114350664e-01   +3.489715816035194e-01; +7.432415342577158e-01   +8.655986242967139e-01   +6.315996192811362e-01   +1.272916622785689e-01   +3.234413326708979e-01   +9.691616371416215e-01   +4.244956930315932e-01   -1.167034330902124e-02; +5.297090152887965e-01   +6.226379618557176e-01   +7.803685898848890e-01   +4.896564061192508e-02   +1.714717306518579e-01   +6.295955768747171e-01   +4.664309458887502e-01   +4.962549556519576e-02; +8.991755819568257e-01   +6.688049499654548e-01   +2.837204409981225e-01   +8.684578415962434e-01   +3.819382139473265e-01   +8.305232296526700e-01   +7.613211532343507e-01   +3.065656581955862e-01; +1.250043735993942e-01   +6.861669376794146e-01   +1.279611681100592e-01   +4.450888115806413e-01   +4.675966323375757e-01   +1.588966564449248e-02   +9.087497755331907e-02   +4.189750095442275e-01; +4.469866067761920e-02   +3.829442803812513e-01   +5.126124618747596e-01   +2.139605290447991e-01   +7.227127277867275e-02   +7.186296243003916e-01   +8.631988167465601e-01   +4.676266783837128e-01; +5.799011170250942e-01   -1.342240633515435e-02   +1.772011427267166e-01   +7.622403839594959e-01   +3.336144415194172e-01   +7.718302260478136e-01   +4.519293291146133e-01   +4.554494943864215e-01; +3.705336967716254e-01   +2.122254343334134e-01   +4.812582913300980e-01   -3.179284634404530e-02   +8.018908513226688e-01   +1.242215776654696e-01   +3.392174157659151e-01   +9.323320659182640e-01; +1.962514876001940e-01   +8.798405915075778e-01   +2.428655201403294e-02   +5.461894593203793e-01   +9.904845097678209e-01   +3.798010570285899e-01   +2.935314386827839e-01   +3.544293348922955e-01];
L3I_L3E_iAMPA_netcon = [+8.870304176947443e-01   +9.947278868711577e-01   -3.853541597929861e-02   +8.989504927488616e-01   +6.239564874127641e-02   +4.280095329036258e-01   +3.713192245214527e-01   +2.130466087628962e-01   +4.704880283426738e-01   +7.355522507036779e-01   +3.611089941655703e-01   +4.402793076849655e-01; +7.256463063112161e-01   +5.622977649069189e-01   +6.591585014387091e-01   +4.360083516117775e-01   +7.155861792558892e-01   +2.680200949361179e-01   +2.539789298774084e-01   +4.666524520519073e-01   +9.583955721729215e-01   +9.705388335628805e-02   +2.512930151651994e-01   +2.884297136343704e-01; +4.355199292252592e-01   +9.128205231195855e-01   +1.000000000000000e+00   +1.690059725600401e-01   +5.394714216500648e-01   +9.577824347306885e-01   +7.519500720774499e-01   +7.121297249877795e-02   +3.351655411824069e-01   +5.802905606061103e-01   +1.481235461447918e-01   +9.013174230547393e-01; +9.006162372801514e-01   +6.617815553692296e-01   +3.449270499753010e-01   +4.891783632800606e-01   +9.302697153952870e-01   +8.081611803960858e-01   +2.668812882749156e-02   +4.260250801320579e-01   +2.624505043974035e-02   +2.510081509364239e-01   +4.936461466839094e-01   +7.904509640088866e-01; +6.498681468412102e-01   +4.472115951487687e-01   +8.604527933024181e-01   +3.940203572611631e-02   +8.774491299196612e-01   +5.169263490696288e-01   +1.425558596095442e-01   +6.326933147084776e-01   +7.928935656848000e-01   +7.965161186844967e-01   +8.845140742274776e-01   -3.147752618483525e-02; +2.732853085288680e-01   +7.423056536587705e-01   +6.127417523504953e-01   +1.317313113759396e-01   +1.134179983447281e-01   +1.753072664299236e-01   +2.515048072544924e-01   +1.241409664094632e-01   +7.608643762499273e-01   +2.141768545785859e-01   +2.805318841482766e-01   +1.029878474865522e-01; +1.075548259453534e-01   +1.563087493154972e-01   +7.331505241279188e-02   -1.058353170918505e-02   +5.650782902437050e-01   +4.810255748225989e-02   +4.832175499982701e-01   +5.352920089096049e-01   +4.084022428541979e-02   +9.601194705053190e-02   +6.561176704174484e-01   +2.431385761063647e-01; +8.460794107661272e-01   +8.255865518944743e-01   +3.807824152706550e-01   +6.968417090862157e-01   +1.156519869497825e-01   +1.957440640861532e-01   +2.157151203807094e-01   +7.674065976848587e-01   +2.363556711921757e-01   +3.516815915266163e-02   +2.748549422533063e-01   +6.886260289118891e-01; +2.012059604825498e-01   +8.740435893293144e-01   +3.281714017903108e-01   +8.808728891128217e-01   +6.218321429700382e-01   +4.681484950078202e-01   +5.688089053958313e-02   +6.831567957390819e-01   +4.435697608183332e-01   +8.175655748196690e-01   +3.847164147105326e-01   +8.105385592286519e-01; +8.966725432054038e-01   +1.574265308732280e-01   +7.260671357709767e-01   +6.929860090804001e-02   +7.734511112630756e-01   +3.034778041082179e-01   +5.664233110147273e-01   +3.982085139962963e-01   +5.240263250175450e-01   +5.318536954990112e-01   +8.561064358306715e-01   +2.941129971850762e-01; +1.123255365930245e-01   +5.293938355737985e-01   +3.397969795577213e-01   +3.214494279919973e-01   +9.529119438488625e-01   +3.101398462817425e-01   +6.446394385463224e-01   +8.246960750635629e-01   +7.044071683758447e-01   +2.668049069395011e-01   +9.076837953752472e-01   +8.212606967537887e-01; +7.604915497274407e-01   +7.349619238403059e-01   +2.254853746481636e-01   +7.157559047214621e-01   +3.658041211110375e-01   +3.475724775915989e-01   +3.074610607019245e-01   +3.545763610781361e-01   +8.732853400446549e-01   +3.149395842652299e-02   +7.526649737892168e-01   +6.061618456269107e-01];
L3E_L3I_iGABA_netcon = [+7.725634095617503e-04   +8.941960720461321e-01   +9.133051920123268e-01   +2.873582095603043e-01   +1.745367067370266e-01   +8.374035981331017e-02   +9.625031291201834e-02   +5.090932612868915e-01   +4.069053277766757e-02   +5.946520326041048e-01   +1.484405148495136e-01   +2.903013090695920e-01; +8.628610036163138e-01   +7.912316553322448e-01   +1.179598947727744e-01   +2.960359225109915e-01   +7.583510428374587e-01   +4.764848740458000e-01   +5.772530213253445e-01   +7.809814074483312e-01   +3.484478482395884e-01   +1.036542664431698e-01   +1.926400801536624e-01   +4.876074724430273e-01; +5.770486915281247e-01   +1.656444480069339e-01   +5.674973613546581e-02   +5.791089034207365e-01   +7.904900310226148e-01   +5.226967151200989e-01   +4.023862226321023e-01   +4.111711412631111e-01   +3.015200388330108e-01   +4.845564979126532e-01   +1.190009786158712e-01   +9.590834193660919e-02; +3.000379842038642e-01   +7.338960983983519e-01   +1.782927043052138e-01   +7.497025708248655e-01   +8.132989284898118e-01   +3.251673114963108e-01   +1.057829329858279e-01   +3.725399979191538e-01   +3.685354871819444e-01   +2.659278961296581e-01   +6.343696021208612e-01   +8.998749820232633e-01; +8.128608516402078e-01   +8.009507619004900e-01   +6.758966878426287e-01   +8.130673331050846e-01   +4.576826239622841e-01   +8.335690612239227e-01   +9.263270169456077e-02   +9.346498174300384e-01   +6.628376407357076e-01   +7.027854722106032e-01   +8.377434892287933e-01   +1.001784497292742e-01; +3.385898939776641e-01   +3.940413670860248e-01   +8.341027651237576e-02   +4.316171222398447e-01   +4.297750446606595e-01   +9.081679553184332e-01   +1.414555551749011e-01   +5.953030067387765e-01   +7.051968232370424e-01   +6.683234337135172e-01   +5.475553284863267e-01   +6.824932646795647e-01; +4.256517128237618e-01   +8.621588180726035e-02   +5.576641955065966e-01   +7.194627441483565e-01   +7.802697589146715e-01   +4.028917840071172e-01   +6.807463507677496e-01   +8.849066972531920e-01   +4.944341833583899e-01   +6.436288167526449e-01   +9.190311682953229e-01   +1.108877945863309e-01; +5.340145889976023e-01   +1.292255906852819e-01   +8.894377080161177e-01   +7.708430755939584e-01   +1.000000000000000e+00   +1.341344259021365e-01   +2.443403312769768e-01   +1.139885068438168e-01   +3.627338535268065e-01   +6.602149931208462e-01   +7.913554655380116e-01   +9.515497582662642e-02; +4.801951332526791e-01   +7.883722507310511e-01   +7.220561493415072e-01   +1.406712145262053e-01   +5.237814575179718e-01   +5.793457476629260e-01   +2.363776858769617e-01   +6.715554545251452e-01   +6.419310891648302e-01   +5.645976183892115e-01   +9.689465183274204e-01   +7.417228357767616e-01; +4.705487945284283e-01   +5.983471825786638e-03   +7.564566403666283e-01   +5.426269378587159e-01   +2.868811472243445e-01   +6.263681266763015e-01   +6.375785910359115e-01   +5.869860527678968e-01   +5.416631596366743e-01   +3.055439442889571e-01   +3.386391075585556e-01   +9.343905418800632e-01; +8.074250837567875e-01   +2.193096006842120e-01   +2.613583721648599e-01   +2.528043197379773e-01   +3.123350597124752e-01   +5.232879291248247e-01   +1.459781286578552e-01   +8.693672172521715e-01   +1.836939338847108e-01   +5.562124339643452e-01   -3.007890652122783e-03   +4.129145260308526e-01; +5.445917106092659e-01   +4.547045378902053e-01   +2.713887134647263e-01   +9.612428330244783e-01   +7.607002096884202e-01   +7.041272093728331e-01   +7.262061120004161e-01   +2.456585317195927e-01   +2.630033914571578e-01   +1.731661282400706e-01   +3.447483956922827e-01   +1.643047343216145e-01];
L2E_Input1_iAMPA_netcon = [+8.931012065128158e-01   +9.470977907667224e-01   +9.331771956346298e-01   +9.086025471787400e-01   +9.089716224036301e-01   +1.000000000000000e+00   +9.967482780520346e-01   +9.394835661516788e-01];
L2I_Input2_iAMPA_netcon = [+9.193588811500205e-01   +9.130488980880276e-01   +9.493200391182928e-01   +9.242144418587707e-01   +9.285523700757912e-01   +9.231248328132581e-01   +9.626697031963944e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
