function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.558915391859878e-01   +7.378093170699040e-01   +8.558076491449365e-01   +2.474124180977783e-01   +2.720058090885624e-01   +6.645035697555440e-01   -7.838459902318168e-02   +3.814624250869314e-01   +2.627776296059904e-01   +1.577883167564647e-01   +3.854945852656428e-01   +1.758797106183561e-01   +4.464607977627411e-01   +2.703432151291897e-01   +2.403490343091232e-01   +1.101020508942379e-02; +9.230201231728452e-02   +8.824213401823832e-01   +7.890407726945685e-01   +7.038423455610535e-01   +2.910418486428871e-01   +6.467844963004988e-01   +6.634694012571815e-01   +1.935249994309354e-01   +1.272232016249867e-01   +7.226939767286014e-01   +5.306343611368830e-01   +6.012106515281185e-01   +3.915462956976259e-01   +2.368413252314944e-01   +5.685980997947366e-01   +2.854393214298896e-01; +2.251449479591622e-01   +2.679188780200227e-01   +4.154251340030428e-01   +4.742208956641454e-01   +6.164766636780613e-01   +4.187952831951669e-01   +1.452721344404424e-03   +6.322860290482499e-01   +2.998126698968801e-01   +4.999757144285071e-01   +7.452589564893516e-01   +2.507619228153166e-01   +3.632683377224902e-01   -5.660238006110514e-02   +3.099983892487497e-01   +8.583823763486534e-01; +2.075136931766712e-01   +6.325846463413231e-01   +1.259721719119213e-01   +2.130684535820389e-01   +7.808023389026284e-01   +7.857956936522520e-01   +1.911258935813150e-01   +5.510143200065638e-01   +6.772158644154285e-01   +3.585433599527597e-02   +1.832928895638002e-01   +7.881335558416835e-01   +5.064665762094706e-01   +2.346996028693836e-01   +5.585885449390018e-01   +4.360741960139050e-01; +6.646330821512617e-02   +6.631323707593382e-01   +7.656391966696175e-01   +7.245780063904268e-01   +4.837248303100815e-01   +3.236212725183585e-01   +4.470445474932216e-01   +3.411328721671290e-01   +3.532819407482853e-01   +4.500677526130507e-01   +2.082570808824139e-01   +6.153198975201830e-01   +3.447194897282422e-01   +7.278038902384679e-01   +2.135739853326568e-01   +8.487333989905725e-01; +1.568569565004894e-01   +1.808394747586247e-01   +6.975845018141767e-01   +7.731968406359859e-01   +5.416984808790447e-01   +7.849010547326172e-01   +2.581120761839932e-01   +3.959996127414764e-01   +8.271934186835302e-01   +8.333144361194736e-01   +7.907115692886104e-01   +9.594843285791385e-02   +3.860002226788019e-01   +1.136618395377811e-01   +8.362370756813485e-01   +3.741888402228634e-01; +3.015291644681020e-01   +6.555997283287813e-01   +7.990189723416276e-02   +3.478575140742958e-01   +7.290414526129866e-01   +4.925524914761569e-01   +4.094115568286194e-01   +5.444396315113669e-01   +8.658098536160936e-01   +8.477152260586226e-01   +5.782202041925798e-01   +1.411205361896391e-01   +3.315178073596577e-01   +4.167575495130935e-01   +6.438094298806821e-01   +8.096957687270476e-01; +6.109488591438453e-01   +6.741220561621889e-01   +7.431980303398589e-01   +3.553367051551962e-01   +5.400041020972087e-01   +5.188721101402745e-01   +9.326569191585569e-02   +4.315691674355495e-01   +9.973331979313902e-01   +7.954729759571395e-01   -4.943584915747364e-03   +6.887210962243510e-01   +7.315124935319911e-01   +5.238123748292097e-01   +2.694333938244766e-01   +8.227485166108771e-01; +4.249147596656557e-01   +9.769024446781977e-03   +2.304875093882857e-01   +2.253434711071206e-02   +4.018227143076942e-01   +1.417905221298397e-01   +7.673715465937320e-03   +5.096257321336792e-01   +4.732000072091659e-01   +7.157091918753526e-01   +6.898936662839383e-01   +4.576201994725562e-01   +2.258043932474131e-01   +1.640216883682986e-01   +8.798262323838746e-01   +7.792386970815903e-01; +6.226468886135136e-01   +5.162178199210410e-01   +5.428260038898944e-01   +2.323636460223800e-01   +4.446339057777486e-01   +2.394234716393022e-01   +7.737487722920185e-03   +2.388299911311648e-01   +4.424647151084246e-02   +7.265448787103743e-01   +1.095203550992333e-02   +1.113277640477255e-01   +3.367925588753410e-01   +7.277100486015330e-01   +3.124076173703367e-01   +6.950442311593700e-01; +3.255066585367338e-01   +6.048240102173098e-02   +3.967146414906041e-03   +2.087912187969764e-01   +8.207009856237415e-01   +5.694983954079106e-01   +1.948580502766711e-01   +1.684474887765792e-01   +1.625181308905357e-01   +8.100123352245140e-01   +1.245288035566729e-01   +7.283249460274427e-01   +4.946982985250494e-01   +7.657425180268840e-01   -2.199730285884541e-02   +4.529747037265434e-02; +1.366076141959364e-01   +4.815612747775203e-02   +8.652670329316166e-01   +4.550006031464081e-01   +6.149130110068991e-01   +4.778805997592747e-01   +6.268280949641242e-01   +3.196612847337329e-01   +6.314212283989529e-01   +1.127289405331565e-01   +2.420248479022667e-01   +7.193016750900545e-01   +2.016492673755413e-02   +5.046692514512806e-01   +3.494835781291043e-01   +4.477148311260649e-02; +3.581038836064354e-01   +3.053634716374751e-01   +6.059895608634536e-01   +2.418309413953726e-01   +9.896630283993459e-02   +4.369496077388442e-01   +3.729705329849776e-01   +6.183676820158736e-01   +2.905383176265602e-01   +8.768878933503514e-01   +2.098059483149382e-01   +4.231944089411656e-01   +2.081903355529187e-01   +2.285190440492239e-01   +2.682435392046034e-01   +1.718420250089756e-01; +1.433943443667024e-01   +8.615639869851095e-01   +6.627935705061558e-01   +6.663800168641293e-01   +7.482983350810610e-01   +5.328998519353421e-01   +2.194905163676004e-01   +7.425970554535114e-01   +3.685523709586371e-01   +4.423857291171574e-01   +7.233033589587959e-01   +5.947620428871148e-01   +5.331205219617764e-01   +4.645110769278573e-01   +7.968088048488309e-02   +3.841900958133373e-01; +1.519755882650689e-01   +1.974740957431466e-01   +1.032516086142368e-01   +3.638052421394458e-01   +2.861877471361157e-01   -2.816251975768421e-02   +5.861183063434098e-01   +2.670162694411678e-01   +7.669833062057260e-01   +4.323223463488902e-01   +6.280739418731879e-02   +7.073542656896270e-01   +5.552423604155309e-01   +1.533034757027610e-01   +6.469764946465039e-01   +1.243259632440250e-01; +5.237228904667968e-01   +1.923284191301402e-01   +3.195652456669429e-01   +5.757797634899223e-01   +4.837240976782864e-01   +5.773261160507854e-01   +2.060376280491691e-01   +9.284767841699824e-02   +5.583844585683445e-01   +3.983277914615591e-01   -3.820335419561644e-02   +3.548111544023874e-01   +1.638917074200549e-01   +8.546673143425652e-01   +8.438341540436008e-01   -1.878085608473587e-02];
L1E_L1I_iGABA_netcon = [-1.487749862227774e-02   +2.899398416888906e-01   +9.164613191331820e-01   +1.540160688350940e-01   +4.388767028724285e-01   +1.158641680370127e-01   +2.608470000091442e-01   +3.496435181322001e-02   +1.916863447433456e-01   +1.114309174294182e-01   +4.331312872132669e-01   +9.464214069553757e-01   +1.871815540390285e-01   +7.355281773126887e-01   +1.099403871448106e-01   +3.535660389165589e-01; +8.077672360695827e-01   +7.607140751083383e-01   +5.347358210000219e-01   +8.370580653792580e-01   +6.403119385927413e-01   +7.774023317256438e-01   +5.889929145851197e-01   +7.656390324944535e-01   +8.732618229238399e-01   +9.380547957411957e-01   +1.727734691086636e-01   +1.110480006082026e-01   +5.604844869177911e-01   +8.662708740766955e-01   +9.965098238216098e-01   +2.195486821940225e-01; +2.201027017880240e-01   +8.296740935702209e-01   +9.391485219437462e-02   +9.510407506994742e-02   +1.359841527652554e-01   +2.397778869704246e-01   +5.673674174070273e-01   +5.487715657400233e-02   +3.150301456701393e-02   +1.372438256650433e-01   +5.086300530532158e-01   +4.050019492093461e-01   +7.548810488861507e-01   +7.769833646252646e-01   +7.522399617390023e-01   +7.436638218671149e-01; +3.676443063212679e-01   +5.703854973680162e-01   +6.276923859123517e-01   +7.354467051777186e-01   +6.561109792376376e-01   +6.170848040973234e-01   +5.892189241793644e-01   +8.365058227840924e-01   +1.307383076581662e-01   +2.610375667404660e-01   +4.691884430849033e-01   +3.240541879511321e-01   +7.841794421313917e-01   +4.505491733760718e-01   +8.932176256684125e-01   +5.132224914046937e-01; +6.864366094007374e-01   +5.817977523339013e-01   +8.396312351688212e-01   +3.695809721826103e-01   +9.223556802387102e-01   +5.234455331271358e-01   +3.527207470276173e-01   +4.493543161476823e-01   +2.895584606786545e-01   +3.277897003021096e-02   +4.700225793122287e-02   +5.626224705382058e-01   +8.588521699190050e-01   +7.916075076186917e-01   +4.228725595125640e-02   +1.263040831023630e-01; +2.191658427229769e-01   +4.280336441374892e-02   +3.357405344544638e-01   +1.877354913893455e-01   +7.465305938180518e-02   +4.386866095482034e-01   +8.211076448539244e-01   +3.295672409937832e-01   +5.409161779327147e-01   +4.534683375470007e-01   +8.866158467320704e-01   +1.489873646561900e-01   +2.264423384781122e-01   +2.131684789454824e-01   +6.791603626717369e-01   +3.053868801387706e-01; +6.625015409586836e-01   +5.223799161222054e-01   +2.893249139013719e-01   +7.551989843097814e-01   +3.037139025805642e-01   +8.318793061300066e-01   +6.157677953199001e-01   +5.305750830255155e-01   +7.827484815558686e-01   +6.056037259124560e-01   +8.150343790896525e-01   +2.260108215488153e-01   +8.064911148099784e-01   +5.590998240640743e-01   +9.239965479400499e-01   +7.718879099701923e-01; +9.191491570142795e-01   +1.458749986213091e-01   +5.944376631390214e-01   +4.712381895798016e-01   +6.910370099272748e-01   +2.073631467563353e-01   +3.451158923740048e-01   +5.427173886253579e-01   +1.825017991452646e-01   +8.056488300836661e-01   +7.185919965104524e-01   +7.997187116265044e-01   +2.439510157996800e-01   +6.601702259888729e-01   +4.957908291495046e-01   +5.647304667085983e-01; +5.695375437985314e-01   +9.763701537520578e-01   +3.707966057940743e-01   +9.074970847544905e-01   +2.019516713409474e-01   +6.516254161770112e-01   +5.529997529107383e-01   +8.986209875571449e-01   +8.740267852507193e-01   +7.251741332888484e-02   +1.525278031013886e-01   +1.874130590317778e-01   +8.778529261458229e-01   +2.246237719322499e-02   +7.351824118139404e-02   +4.409579718639769e-01; +1.923588663807025e-01   +3.375685329339203e-01   +5.308103241880038e-01   +2.089748694960232e-01   +8.860762090333063e-01   +3.922356355544576e-01   +3.082044043735293e-01   +9.028671569577298e-01   +8.659074910559448e-01   +8.687980416494321e-01   +8.165418195574566e-01   +9.320327077611900e-01   +4.974011335155936e-01   +3.962970980072655e-01   +3.184252658744122e-01   +7.526871617946747e-01; +1.778870588698024e-01   +2.074036782806111e-01   +7.295632461000804e-01   +8.248905544306585e-01   +2.058079635016473e-01   +6.243691054750435e-01   +5.385853642424186e-02   +4.527861849335163e-01   +3.796031640464568e-01   +6.192165980530339e-01   +3.776974549098837e-01   +8.662213031381807e-01   +8.839138377436535e-02   +4.732880524981330e-01   +4.474071533764661e-01   +3.915929656115132e-01; +1.690255566292037e-01   +9.300633967405366e-01   +7.336853854140671e-01   +5.365348574329993e-01   +4.491610096032193e-01   +7.149706562388310e-02   +1.576644405822441e-01   +3.677455563273391e-01   +1.501195148920140e-01   +4.949436822166792e-01   +2.071173882796558e-01   +3.856260810115512e-01   +3.743211108749274e-01   +8.793596848269649e-01   +3.864025831171298e-02   +4.755222375366532e-01; +8.908542332025817e-01   +1.540314999801822e-01   +4.995747474262132e-01   +5.117654956557959e-01   +5.894425201228861e-01   +5.741602623897246e-01   +1.751491607104041e-01   +4.603315554202584e-01   +4.444932666337325e-01   +3.262249819095401e-01   +8.904024664492398e-01   +9.241538080314469e-01   +7.776315221012827e-01   +5.334411766418012e-01   +2.422509468204938e-01   +7.198814419594841e-01; +4.604568991954560e-01   +8.032875611847980e-01   +3.310474873298431e-01   +3.813201147957208e-01   +7.130516542460705e-01   +2.230806804824474e-01   +2.849057215635252e-01   +5.676695712011204e-01   +3.348598283208289e-01   +4.624102879851128e-01   +1.950015308295424e-01   +1.638048058383442e-01   +2.742611934799021e-01   +2.532473294182834e-01   +5.431901069011109e-01   +8.845620284162159e-01; +5.667479793666872e-01   +5.934117783474314e-01   +6.917266529888612e-01   +6.319859635465788e-01   +6.818346350912829e-01   +1.127353764251214e-01   +8.496417448198801e-01   +2.393252251632594e-01   +8.237354246022387e-01   +4.940304373353329e-01   +7.265605072877889e-01   +5.137981400166713e-01   +2.898258518219140e-01   +5.010497952120553e-01   +8.188156493976881e-01   +4.191857664810230e-01; +3.355560708755468e-01   +5.804698812348836e-01   +5.811283758200007e-01   +2.454955513784440e-01   +4.293469105025580e-01   +2.942430030790031e-01   +5.056648320691467e-01   +2.173937104572104e-01   +8.190701523229479e-01   +2.459805997984841e-01   +2.442378645714483e-01   +1.640776207009637e-01   +3.981461666512030e-02   +4.368067811128294e-01   +9.701281876301544e-01   +9.179645726549021e-01];
L2I_L1I_iGABA_netcon = [+6.463565894711316e-01   +4.329432759959205e-01   +6.805373914144761e-01   +5.779673071063964e-01   +9.306697619878411e-01   +6.075237989967253e-01   +8.965668719624811e-01   +1.079523641032443e-01; +4.606071825321734e-01   +1.658662052685705e-01   +2.207969461596425e-01   +9.239991955833966e-01   +2.318652725089144e-01   +3.116589480379906e-02   +8.059040319551770e-01   +6.331075987210401e-01; +1.000000000000000e+00   +5.143107871159498e-01   +6.086296357838815e-01   +6.861191962937213e-01   +7.314715756376924e-01   +6.448643717690846e-01   +2.773345832962257e-01   +2.563801907320652e-01; +3.625187722121282e-01   +1.762540614022752e-01   +8.600389206725437e-01   +4.524970821636366e-01   +7.529004589420215e-01   +3.412142581604357e-01   +9.385484365018055e-01   +1.735206764912957e-01; +6.719071494342569e-01   +4.785153656085865e-01   +6.452945097293492e-01   +2.093836185235327e-01   +9.297910491818069e-01   +3.322932787863067e-01   +5.359043989227072e-01   +2.276628234279892e-01; +5.857713102610499e-01   +5.560821607805208e-01   +7.485394077422887e-01   +1.537299989225721e-01   +2.114018100540361e-01   +8.017643231834969e-01   +8.696462770419248e-01   +5.105236431381898e-01; +7.650813946469156e-01   +4.892283128912788e-01   +2.088193500736134e-01   +2.612458426555692e-01   +7.235581320623450e-01   +1.623854249593104e-01   +6.517798006550221e-01   +3.751075477923638e-01; +9.405280250837018e-01   +4.225943594905346e-01   +6.232420100878874e-01   +8.438761263022961e-01   +1.063655616600674e-01   +4.506233518801505e-01   +4.418574388887423e-01   +2.636336536015904e-01; +7.479358813508438e-01   +1.460088293611115e-01   +4.356826781291263e-01   +1.114179214180358e-02   +7.208314309839934e-01   +3.508287728582856e-01   +7.153091172415313e-01   +7.097582125915459e-01; +4.305940917481444e-01   +7.440918585559316e-01   +5.973396112863476e-01   +7.814911934789456e-01   +3.680310821270575e-01   +8.246442079856350e-01   +7.936661293803384e-01   +2.490821353555452e-01; +5.502582968788311e-01   +5.525707778532902e-01   +5.237848174038096e-01   +3.458805298231485e-01   +6.128299658224369e-02   +8.521181642517086e-01   +5.794389711250822e-01   +4.455496981623877e-01; +7.987182890201135e-02   +3.866129787818372e-01   +4.074606875916320e-01   +4.180823605877554e-01   +3.562512326411833e-01   +4.507249919950728e-01   +2.564732713255383e-01   +5.184789454510791e-01; +3.741709343439079e-01   +1.440263449601601e-01   +6.570609773589119e-01   +7.377110894638571e-01   +1.782098997337052e-01   +6.785528823571229e-01   +3.584451009860333e-01   +7.015152649660983e-01; +4.904182192130250e-01   +4.673114417223695e-01   +6.237032396933355e-01   +3.430339723161244e-01   +7.906465679638750e-01   +3.843332879451143e-01   +3.654290703911328e-01   +3.095549497289633e-01; +5.551683996075386e-01   +1.457992194996323e-01   +2.048384054769178e-01   +2.124317735409986e-01   +6.111843826089636e-01   +5.399891889233005e-01   +2.543435182755119e-01   +7.003732887922931e-01; +7.567329357577164e-01   +8.536254720516069e-02   +6.707689766058842e-01   +3.651388767108564e-01   +3.446995767966342e-01   +5.195438378898607e-01   +1.788928638388710e-01   +3.342308176983342e-01];
L1I_L2I_iGABA_netcon = [+4.826798157245137e-01   +1.740164864042554e-01   +8.322666045473261e-01   +2.823810710626531e-01   +5.140693339702043e-01   +2.515205992076987e-01   +8.443825138251888e-01   +2.184688162320181e-01   +4.910428398384257e-01   +8.297595171064815e-01   +3.514584151398620e-01   +4.020972814424978e-01   -4.572971664599183e-02   +6.862401257934003e-01   +6.199041053758436e-01   +4.658892160775017e-01; +5.514076663638335e-02   -1.709214582356472e-03   +3.173972420794908e-01   +2.672943557322109e-01   +8.643313255375114e-01   +3.981627644944766e-01   +3.013868442502172e-01   +1.512758378460028e-01   +4.484382550558443e-01   +2.338400454440597e-01   +3.021333348111593e-01   +2.603105988824564e-01   +9.922429260377249e-01   +2.041436144730668e-01   +7.813266509428318e-01   +2.672663512266889e-01; +3.585655789577603e-01   +6.163061164254114e-01   +2.948410559693599e-01   +6.615624912440350e-01   +2.671098475744180e-01   +5.627336557537032e-01   +7.445799320382681e-01   +7.997654951050595e-02   +7.483439088703980e-01   +4.997832356805078e-01   +5.661974524544252e-01   +8.672704520823900e-01   +9.629259236520459e-01   +6.647395520199446e-01   +3.824427860267460e-01   +2.110935617166350e-01; +8.661414761786432e-01   +8.546733295237256e-02   +6.595912227545574e-01   +9.369615920749914e-01   +4.461392080651090e-01   +8.587945129926503e-01   +6.409705822187164e-01   -3.554250956982132e-02   +4.404673510458991e-03   +3.140643054501479e-01   +3.799130133915697e-01   +4.266341636443936e-01   +2.935215821156776e-01   +4.928778013219479e-01   +1.858284716364607e-01   +2.168964177337269e-02; +9.086576807270028e-01   +7.999453343096157e-01   +7.672673508286199e-01   +5.684032973371793e-01   +2.961495960450428e-01   +6.417571896159019e-01   +6.328059651639364e-01   +5.987038010845598e-01   +1.084318370662272e-01   +6.663205856771915e-01   +2.272163405966934e-01   +4.691435925917998e-01   +4.695372626889589e-02   +2.330188873991232e-01   +6.837230989599951e-01   +9.302191783067145e-01; +5.433749615650624e-01   +4.813970151912414e-01   +1.260877441310040e-01   +3.152644959462017e-01   +8.923995052058707e-01   +1.595860690716470e-01   +7.318680351687080e-01   +6.078905234780546e-01   +4.857470837564044e-01   +7.125011944192432e-01   +2.925484654768492e-01   +4.982410093407474e-01   +9.056796935328262e-01   +1.222457452540583e-01   +2.351230792030087e-01   +6.939618638877575e-02; +8.866162782819578e-01   +1.069449572670985e-01   +4.183285632596031e-01   +3.269294301569250e-01   +5.467329899114709e-01   +8.486791103990422e-01   +6.695001878185358e-02   +2.703000854779084e-01   +7.682963171423455e-01   +9.405605705950906e-01   +8.863537610674999e-01   +8.292745747514256e-01   +1.525472012166237e-01   +2.281396719052131e-01   +1.428393819082301e-02   +5.449364506501361e-01; +9.202624877645210e-01   +3.572961301043502e-01   +1.337161069882269e-02   +8.727869557970579e-01   +1.850567560580939e-01   +9.545154002142916e-01   +7.682222757129694e-01   +8.256752953249982e-02   +7.814133267020197e-01   +1.806630509196867e-02   +8.978766414244584e-01   -2.533210579198725e-03   +8.446661986156854e-01   +7.220944024720159e-02   +9.409108193938099e-01   +7.004810774155903e-01];
L2E_L1E_iAMPA_netcon = [+3.320374346112962e-01   +9.273892108516716e-01   +6.424202986947232e-01   +1.865565239247130e-02   +3.512835266609879e-01   +3.371790141524026e-01   +6.667767622814819e-02   +5.923228905406425e-01; +1.950421882989316e-01   +1.531390916782041e-01   +7.571832964586058e-01   +8.581194032922350e-01   +3.751411442144079e-01   +5.335451641126931e-01   +2.063800309512389e-01   +1.121134429604628e-01; +4.901572847782926e-01   +8.711202078758282e-01   +7.455369798741728e-01   +4.222220596514258e-02   +6.402996093760946e-01   +3.575523210019511e-02   +4.287343136810506e-01   +8.388312699994102e-01; +4.381522487042362e-01   +6.397204308038157e-01   +4.700606813111768e-02   +5.599148580306528e-01   +2.500573803216731e-01   +5.957673463414903e-01   +1.381309592170029e-01   +4.640857830681312e-01; +8.272825222057397e-01   +6.686775102347322e-01   +7.588041805378583e-01   +5.289363893096718e-01   +7.130567916486156e-01   +3.803256429006214e-01   +4.040882983481798e-01   +5.237929767823575e-01; +4.817241996582640e-01   +6.484081868758391e-01   +9.049962316146652e-03   +6.316613313617646e-01   +6.554433488674404e-01   +8.521090834778370e-01   +3.203377670304313e-01   +1.020381760861759e-01; +4.279966245724008e-01   +3.303067545429303e-01   +2.392520254781975e-01   +4.000064042013798e-01   +4.167739789051362e-01   +2.521034899531832e-01   +5.497698690172462e-01   +2.549540334329102e-01; +7.348474033735642e-01   +1.885724929145389e-01   -6.258047071156923e-02   +9.741378029931006e-01   +5.567797940603777e-01   +3.730430830779671e-01   +5.926779367740422e-01   +6.480649776965501e-01; +7.886633753445434e-01   +5.939706562186248e-01   +6.621676517917539e-01   +1.133899994853930e-01   +3.746331800119183e-01   +2.348920615005322e-01   +8.065470810653230e-02   +9.737897003389255e-01; +3.396269833918328e-02   +1.728737391063645e-01   +1.512821072324391e-01   +1.998733344747867e-01   +1.607644053417991e-01   +5.491696295389066e-01   +8.646420480438510e-01   +8.594333031931506e-01; -1.287218782031673e-02   +2.254560729458606e-01   +5.584442059492457e-01   +4.000060673356617e-01   +1.665709302438042e-01   +4.610238527396994e-01   +2.384288368644557e-01   +7.154693912804749e-01; +3.276971074872566e-01   +6.043591599162115e-01   +5.896209174364049e-01   +4.508418595857711e-01   +6.682985163309221e-01   +2.829082384321605e-01   +7.007468338341553e-01   +4.731006015213197e-01; +6.990845189200693e-01   +7.108245166615477e-01   +5.503360480993427e-01   +1.772220443220950e-01   +2.253416219074811e-01   +1.177658537753880e-01   +6.041028116727312e-02   +5.300655424641136e-01; +6.945181984319209e-01   +8.014632572971357e-01   +6.656546053863793e-02   +9.158116879086996e-01   +5.217258010946757e-01   +7.872657563863793e-01   +5.699344940664286e-03   +1.749231938772591e-01; +9.500995274057525e-01   +1.977312464847281e-01   +5.080647430612063e-01   +6.055333429588157e-01   +3.055712191420185e-01   +2.001415995307422e-01   +6.441561454529673e-01   +4.641656184790482e-01; +7.719602105144436e-01   +6.026997816028778e-01   +7.407721799255491e-01   +3.833791687628628e-01   +4.727712551608729e-01   +8.159107958611707e-01   +6.995060433077989e-01   +1.545405431726111e-01];
L1E_L2E_iAMPA_netcon = [+8.279246550787467e-01   +4.173845556381984e-01   +5.720563221032255e-01   +1.857742468422259e-01   +9.437063565663970e-01   +2.071235147075010e-01   +5.096539158127558e-01   +4.540692954077497e-01   +9.751332534763915e-01   +4.999007945457479e-01   +5.839070469710766e-01   +4.537647223634720e-01   +5.660373385742690e-01   +3.354797356622120e-01   +5.894276877791053e-01   +3.137044017127396e-01; +8.018615997774811e-01   +1.713459892782626e-01   +1.640409929285184e-01   +5.520520259776274e-01   +8.158338308059582e-01   +5.586761916743889e-01   +9.041820896089701e-01   +2.608940789000048e-01   +3.565650607451090e-01   +3.172819617076439e-01   +6.161667873559972e-01   +6.651675166794193e-01   +6.449477260475479e-01   +8.860888955948920e-01   +3.700699929055256e-01   +5.322236151224760e-01; +7.520923866441676e-01   +9.952542010244056e-02   +1.423260646805859e-01   +9.727089499922500e-01   +2.330856827531903e-01   +3.494638699878712e-01   +8.565877474924922e-01   +3.321628891249372e-01   +1.996627525463500e-01   +6.192595482715623e-01   +7.783354513299491e-01   +4.856406514450035e-01   +7.787389096947799e-01   +9.223242856209217e-01   +7.880843002519154e-01   +6.170515926898986e-01; +6.433362996108475e-01   +1.007547602673049e-01   +5.182247794455097e-01   +3.489734186813644e-01   +3.732436718395831e-01   +7.772060364269787e-01   +2.154749161190582e-01   +1.673778562630829e-01   +5.846516096617753e-01   +5.177827243409917e-01   +4.117722278615736e-01   +9.586379907952414e-01   +6.958205735027513e-01   +1.182631051870604e-02   +7.800645678987890e-01   +7.884376861614579e-01; -1.845459827507941e-02   +2.264915189720934e-01   +1.316665118704860e-01   +7.316297548480677e-01   +1.490633623756058e-01   +4.227400598812595e-01   +9.398397290081416e-01   +3.438664376346388e-01   +9.738302655436716e-02   +7.702250712643722e-01   +9.170091751719903e-02   +5.315050421776402e-01   +4.950983310245143e-02   +6.251869562163755e-01   +4.558186595235625e-01   +1.779785248722042e-01; +6.660617734059970e-01   +3.530952418035814e-01   +4.055295810040739e-01   -1.752088289963423e-01   +8.801903985725996e-01   +1.221492510549189e-01   +4.919631119611875e-01   +1.978534471084667e-01   +7.353599673814466e-01   -1.461620427058537e-02   +7.240712657958649e-01   +2.471028613935945e-02   +7.294523519483904e-01   +5.241259146206191e-01   +6.796352704686732e-01   +3.155040632858714e-01; +2.589218186898731e-01   +7.252385950030555e-01   +3.220118734869172e-01   +4.028273042323952e-01   +2.434470870837240e-01   +8.415304668120080e-01   +9.516241172788710e-01   +4.300583105276087e-01   +6.642786567613291e-01   +7.408419688014881e-01   +1.481834955390726e-01   +1.337195429830529e-01   +9.834813453200657e-02   +3.296215499892549e-01   +2.942687518109664e-01   +7.612949702394121e-01; +1.577528329512172e-01   +3.952826820212314e-01   +2.490378523322452e-01   +4.500402154044281e-01   +1.000000000000000e+00   +4.388034213740849e-01   +9.259961909817023e-01   +7.909103583101860e-01   +4.061175803181523e-01   +3.419341626411238e-02   +3.744927267919775e-01   +4.125862812641675e-01   +3.321918744637167e-01   +6.834589646675260e-01   +7.991349536126350e-03   +5.167167518999326e-01];
L2I_L2E_iAMPA_netcon = [+3.285622137879222e-01   +2.846384211118200e-01   +3.140717669765606e-01   +5.701722363814072e-01   +1.672866582459334e-01   +8.233092124683447e-01   +6.866458436173535e-01   +2.246184323314707e-01; +4.621588183838353e-01   +1.421074828002388e-01   +6.917054649679147e-01   +2.684078258209108e-01   +6.705958106215253e-01   +8.525130040499687e-01   +9.333181460309058e-02   +5.028024071639838e-01; +6.325481369056837e-01   -6.292048916755127e-02   +6.926415643040181e-01   +5.734937677415376e-01   +1.814615005404392e-01   +6.112421404092155e-01   +7.742982446379314e-01   +1.940407036892945e-01; +5.005157765736976e-01   +2.438632610040037e-01   +4.104980599062764e-02   +9.467928268649656e-01   +3.458517062001918e-01   +6.221811137292200e-01   +9.576836373193595e-01   +1.792373217182921e-01; +9.517736747135103e-02   +3.888094080252386e-01   +5.029170299007748e-01   +8.227299375123447e-01   +8.497380296367573e-01   +5.323697816326245e-01   +6.932460803816853e-01   +2.127176329433575e-01; +8.142364986253164e-01   +4.422079554100191e-01   +9.003179102368591e-01   +9.075993010711142e-01   +6.746345738347068e-01   +8.038944004141438e-01   +8.404995997074757e-01   +4.785555368179075e-01; +8.253008843032686e-02   +5.456463274209721e-01   +8.878026213197955e-01   +7.974531002842916e-01   +9.828005632374165e-02   +7.177890488266562e-01   +2.161235517649433e-01   +1.045980972410113e-01; +5.741746772568913e-01   +4.194685197444028e-01   +1.553853298999828e-01   +3.016655169793583e-01   +6.704079980042045e-01   +4.180160883339988e-01   +1.000000000000000e+00   +6.682380366646442e-01];
L2E_L2I_iGABA_netcon = [+4.476853758854228e-01   +6.225365086417483e-01   +5.801668886563670e-01   +4.027833296377696e-02   +4.287802762337443e-01   +4.986588296961669e-01   +2.627598006937357e-01   +6.789618183474281e-01; +5.077406966103043e-01   +2.989800038436674e-01   +6.437057465265700e-02   +4.818704513974901e-01   +4.456943368224023e-01   +6.432736936791045e-01   +5.138784598722740e-01   +3.933532433533628e-01; +5.660613447287292e-01   +5.570949138068712e-01   +4.293621889648138e-01   +6.352965799847317e-01   +3.312677850827279e-01   +3.094669192358800e-01   +1.357989234701138e-01   +9.373224796925714e-01; +6.957000848738446e-01   +5.492003056810664e-01   +4.027269090016029e-01   +8.595593837159058e-01   +2.006749198086276e-01   +5.503662664369690e-02   +1.547151905999224e-01   +4.312197854458122e-01; +4.782297305571602e-01   +7.922832023285921e-01   +4.998805451966233e-01   +7.305161866868484e-01   +4.139761127261388e-01   +7.530296963851423e-01   +6.016732476111299e-01   +3.990462825530418e-01; +3.474473415343255e-01   +2.610471604413363e-01   +4.146655931538526e-01   +4.211899346233960e-01   +7.593411477075006e-01   +7.936475767705244e-01   -7.035301626909678e-03   +4.374428826203866e-01; +7.672778799431290e-02   +4.567393394513719e-01   +8.010804966735249e-01   +5.346154596009748e-01   +5.022174500083475e-01   +4.354616597650129e-01   +8.995009516818597e-01   -6.144718371576466e-02; +8.700357412831559e-01   +5.636188637989775e-01   +8.272557249110724e-01   +4.850853629054793e-01   +8.791768493098425e-01   +5.326007782877258e-01   +2.972846038015007e-01   +3.245433366982540e-01];
L3E_L2E_iAMPA_netcon = [+2.381744981261699e-01   +9.103461993654890e-01   +4.642142338870164e-01   +7.088325648273830e-01   +1.794943082831748e-01   +3.948985429708070e-01   +2.892486811612388e-01   +1.009303288950378e-01   +1.308411660066491e-01   +5.293165875377273e-01   +1.506853906683898e-01   +4.866882732984711e-01; +2.681959610061735e-01   +4.466438945716921e-01   +1.514050026589695e-01   +2.015165463101388e-01   +4.883271731904915e-01   +9.094840802669854e-01   +7.051590003503660e-01   +5.590783764311937e-01   +2.487093066955155e-01   +5.077124968348488e-02   -1.275635928480765e-02   +8.214906091569220e-02; +8.027339855974420e-01   +3.593755651162630e-01   +5.446648459622615e-01   +1.334631032963292e-01   +8.184818072535915e-01   +8.965393196154423e-01   +5.299097833970063e-01   +6.517070645000340e-01   +7.157119353117507e-01   +3.239840247233945e-01   +3.712580149378329e-01   +8.964106601615935e-01; +1.091046392210493e-01   +4.517762601455463e-01   +1.789949892632856e-01   +7.568935409351236e-01   +4.813541824193293e-01   +5.476516334590690e-01   +8.514578582139741e-01   +3.110424178396516e-01   +8.090277327702475e-01   +7.644123355541873e-01   +4.147396433934475e-01   +1.314914314516680e-01; +1.762654825265199e-01   +7.287088954106606e-01   +4.354270355688667e-01   +3.438809046095906e-02   +1.434808433000646e-01   +9.069980448562932e-01   -2.998690406887122e-02   +6.569548744916934e-01   +1.074738774864286e-01   +8.487582829262088e-01   +2.507392478999645e-01   +1.951080076204111e-01; +2.991271241545810e-01   +3.929748242691484e-01   +8.123734496995586e-01   +1.000000000000000e+00   +3.807867682147714e-01   +8.639236824772893e-01   +2.769351054410920e-02   +3.408514892781494e-01   +5.080286139649457e-01   +7.714310268087864e-01   +5.813856394693441e-01   +7.976699710698558e-01; +2.566841117697594e-01   +4.635199327882285e-01   +5.638767798584924e-01   +1.438754624383479e-01   +6.484683875974485e-01   +4.760663613826462e-01   +6.937944472856785e-01   +1.231069075778439e-01   +3.968097802174912e-01   +4.272549731876460e-01   +9.584477834615215e-01   +7.233642615354184e-01; +5.281782746841791e-01   -3.552763469328767e-02   +3.505799043049533e-01   +1.274457599414322e-01   +4.472552688008135e-03   +8.749776756496548e-01   +4.031389052416144e-01   +4.622134953970176e-01   +8.584455793148908e-01   +9.871986638567196e-01   +8.855269894433671e-01   +2.620370237265117e-01];
L3I_L2I_iGABA_netcon = [-2.062821241788493e-02   +1.903941457597539e-02   +9.527138012960029e-02   +6.331574535976771e-01   -8.326219959825227e-03   +5.069665612958569e-01   +7.843196032575520e-01   +4.134148668649033e-01   +3.767466218969907e-01   +8.861124230219388e-01   +8.174488597621280e-01   +6.672503731764032e-01; +4.288392626169445e-01   +3.970319037013081e-01   +2.652595994847035e-01   -9.222266320851685e-02   +4.789855885960106e-01   +6.064966395177585e-01   +4.773196594327599e-01   +8.950088660577048e-01   +1.533881678556953e-01   +8.979479995329960e-01   +2.182915111678571e-01   +6.024652559001239e-01; +3.507031267863175e-01   +6.413430181780692e-01   +2.752784999011661e-01   +7.770847176773987e-01   +3.177387516401146e-01   +8.107458846308877e-01   +8.910105962030196e-01   +9.390486341553832e-02   +6.647451086988996e-01   +4.509531863852955e-01   +1.122967399677469e-01   +5.657305567577093e-01; +5.854680137234701e-01   +1.000000000000000e+00   +2.766282551939516e-01   +1.952493542996019e-01   +1.583628503832865e-01   +5.913278974728059e-01   +1.893794414152359e-01   +2.081294631546761e-01   +4.277409544544880e-02   +3.549721152693351e-01   +5.560539204635934e-01   +7.784451442735099e-01; +9.203040499236418e-01   +9.626608347822974e-02   +4.327732319645737e-01   +8.539740695602823e-01   +4.559525728441131e-01   +8.354166700991943e-01   +1.043119746673975e-01   +5.209831156556674e-01   +5.381781972327441e-01   +7.103521227981185e-01   +7.069940447470180e-01   +4.573072528130926e-01; +8.507133048161264e-01   +1.930838735722327e-01   +1.701173376637403e-01   +7.131845264802555e-01   +8.830990848620889e-01   +7.681661615819435e-01   +9.462830746108558e-01   +5.985583744648887e-01   +1.103822235693480e-01   +8.026604876907445e-01   +3.365932288541578e-01   +5.549971915985696e-01; +9.789400043542971e-02   +4.645431862405905e-01   +8.768401890079470e-01   +5.705307410779775e-01   +9.654341992769417e-01   +7.374990647668053e-01   +8.328734373469568e-01   +6.909251227401777e-01   +5.693039276451115e-01   +3.704113425036817e-01   +3.219818475079755e-01   +4.728886938394603e-01; +3.975091237394423e-01   +4.649965232368058e-02   +7.224920592284052e-01   +1.905885838352456e-01   +4.228744274470704e-01   -3.611877270748955e-04   -3.404583298653811e-02   +8.789209264872867e-01   +4.402783710731694e-01   +8.943054910738349e-02   +7.258991307393017e-01   +4.521753048360807e-03];
L2E_L3E_iAMPA_netcon = [+9.396821042381337e-01   +2.088928824733400e-01   +4.933043824724946e-01   +7.098168961036403e-01   -4.015614010294412e-02   +6.676013421249349e-01   +7.664504447927206e-01   +1.316443892444326e-01; +3.425387382823250e-01   +4.965691037760779e-01   +6.892892629434535e-01   +6.140958392072329e-01   +2.572297047625176e-01   +1.808858077767184e-01   +8.587785099312777e-01   +9.200963737080259e-02; +5.881073069396767e-01   +5.171684818607247e-01   +8.429161765071090e-01   +5.408544031186394e-01   +9.003942119326761e-01   +4.543822372714791e-01   +9.551883020548260e-01   +4.096280380592867e-01; +2.290379267407610e-01   +8.882279080436840e-01   +8.526038962313027e-01   +3.829473675138854e-01   +3.152436974885767e-01   +9.671680168956115e-01   +2.507086962738488e-01   +4.700366020073246e-01; +5.737853724807523e-02   +1.831870559944808e-01   +7.158408549882314e-01   -5.130419990613030e-03   +2.375162005715354e-01   +4.956761523648215e-01   +4.327536391600817e-01   +5.929775199811980e-01; +3.610488781933160e-01   +8.078590198009400e-01   +1.800942588583592e-01   +7.667137758352439e-01   +8.529414232077184e-02   -1.382677365668460e-02   +4.768438605453652e-01   +1.912652416724216e-01; +4.296113247962680e-01   +7.156331080439117e-01   +6.988263833543742e-01   +2.089152285652902e-01   +7.376133603689301e-01   +1.922095864614674e-01   +6.674250854541953e-01   +9.091414173662169e-01; +6.293329422236666e-03   +4.928970968810596e-01   +8.833342385999504e-01   +4.053469622495363e-01   +1.198645150275000e-01   +7.218587294941673e-01   +1.109175813776429e-01   +3.274182028467426e-01; +1.000000000000000e+00   +8.953057511889965e-01   +8.523219626611379e-02   +1.162036642069774e-01   +1.020421088772968e-01   +8.988627536320547e-01   +2.565594707310312e-01   +8.679933932091062e-01; +1.446521620672931e-01   +3.801370470092500e-01   +8.091554631698985e-01   +3.154398898668298e-01   +3.960616459226080e-01   +8.479618157074965e-01   +6.788731203369214e-02   +8.423600340580955e-01; +6.434990204165777e-01   +3.602120806886356e-01   +2.931659790904915e-01   +2.964375200617272e-01   +1.431975269898774e-01   +2.995365310499133e-01   +1.716498691805694e-01   +1.304802622367618e-01; +1.180453567505344e-01   +5.887546430005491e-01   +7.910183572137488e-01   +4.350118681936156e-01   -5.282161798300609e-02   +6.949656532716892e-01   +7.599656122756523e-01   +7.321800779415196e-01];
L2I_L3I_iGABA_netcon = [+3.639299180636900e-01   +6.821556082336890e-01   +2.901382774253087e-01   +6.550499220414377e-01   +5.220997706999000e-01   +3.579017673734300e-01   +3.953791063921833e-01   +4.527029508510014e-01; +3.579340002801003e-01   +6.884552894780355e-02   +2.146742427650632e-02   +7.925906459195141e-01   +7.224668373524811e-01   +3.311212602779782e-04   +6.705807720999597e-02   +6.295613550686209e-01; +3.087140232278105e-01   +5.959936586127751e-01   +3.537039456041600e-01   +5.968882556014488e-02   +8.029035458367958e-01   +6.627858363334957e-01   +2.420382160737813e-01   +1.055790302096150e-01; +5.943495069452037e-01   +8.422893986091265e-01   +5.402410062423066e-01   +4.781739441675519e-01   +5.410898539289398e-01   +6.591099432655491e-01   +3.913463299481368e-01   +6.791203289260479e-01; +6.955850992502746e-02   -4.469784864557515e-02   +4.552166430039362e-02   +7.177963944951460e-01   +2.157105959294416e-01   +6.320536539243718e-01   +4.394391131144036e-01   +2.805753975050530e-01; +5.702422201849737e-01   +3.724599588549357e-01   +4.334139022523830e-01   +7.255043470097284e-01   +2.622191847226871e-01   +7.811011785239785e-01   +5.071582869237543e-01   +1.317160063044713e-01; +2.623990541290006e-01   -3.015365043794767e-02   +4.128258732583691e-01   +9.585688657870842e-01   +7.411043115012521e-01   +8.215011187758192e-02   +2.429197628998337e-01   +8.157418258074561e-01; +2.039529751311511e-01   +8.898212988841312e-01   +8.986783483112316e-01   +9.046056711251850e-01   +5.027381875803072e-01   +1.221938678641742e-01   +6.343684820207257e-01   +1.136176932011177e-01; +3.147521627184671e-01   +5.242333628153441e-01   +2.271253216875548e-01   +1.437832597867888e-01   +4.308039815766863e-01   +3.374366757327844e-01   +6.245420090786582e-01   +4.858377690031040e-01; +4.216194942368017e-01   +1.602792920311115e-01   +1.840510781305889e-01   +4.236159736819687e-01   +9.387596411624417e-01   +5.253469407054440e-01   +4.740441704093881e-01   +9.444947330972057e-01; +5.526109884867945e-01   +9.090816008249859e-02   +2.685106561423265e-01   +5.891491705917289e-01   +5.076050105536469e-01   +6.832690055900001e-01   +9.152102853676974e-01   +5.973835834640887e-01; +3.625761471127133e-01   +1.677927335196359e-01   +6.482757486610771e-01   +3.487174718848975e-01   +1.283695568989956e-01   +1.989879897096280e-02   +3.469706683494455e-01   +6.171713100077578e-01];
L3I_L3E_iAMPA_netcon = [+1.233008048656777e-01   +5.801366319895612e-01   +4.822122890200804e-02   +1.477625448017166e-01   +1.902981436106119e-01   +6.592297175828103e-01   +2.720794433602771e-02   +3.630743846542195e-01   +4.812632762081958e-01   +3.161331809347575e-01   +5.406945755258764e-01   +8.553845314579414e-01; +3.367781285760237e-01   +7.429884707033950e-01   +2.542200731898620e-01   +3.061335910950828e-01   +6.895555035398614e-01   +4.429233885989951e-01   +3.618433272225708e-01   +3.679848432446162e-01   +6.222137091281190e-01   +2.316609158731606e-01   +6.463726203259226e-01   +2.228664819549556e-01; +4.266227821095579e-01   +2.700772564362086e-01   +7.069192071422954e-01   +8.415331190226604e-01   +5.231165984935199e-01   +6.081953288937556e-01   +9.768367013113791e-01   +4.358087823532670e-01   +2.654205106294827e-01   +3.617675666839856e-01   +8.229776151952544e-01   +8.489586633129295e-01; +4.724570875183302e-01   +1.029075451481286e-01   +5.518994901449169e-01   +6.865652775556814e-01   +4.118286565695322e-01   +5.881307722356340e-01   +5.364393696823782e-01   +6.371168981548152e-01   +5.163447414465753e-01   +2.060407462157183e-01   +3.697372017312814e-01   +4.710612029166183e-01; +8.795017503970913e-01   +7.394298818768186e-01   +5.239974460614875e-01   +4.339184375623916e-01   +2.033068153035380e-01   +2.660034927351818e-01   -4.003085490217897e-02   +2.413239201012116e-01   -9.628670642189294e-03   +1.975495132480377e-01   +3.177191004121918e-02   +4.371213311301133e-01; +3.538171663510107e-01   +1.545155946002435e-01   +6.077132039873031e-01   +4.388659398358044e-01   +9.710798425575015e-01   +5.942553516823645e-01   +2.380554728650939e-01   +1.433082244554379e-01   +1.784850443142157e-01   +5.472564611109467e-01   +2.632173977736406e-01   +9.753920822063772e-02; +4.875920266287281e-01   +2.462066784217287e-01   +8.042646927222366e-01   +8.324562058652808e-01   +1.596382900244193e-01   +1.534887634911408e-01   +3.689354755119260e-01   +8.461024796691648e-02   +8.889503278611166e-01   +6.925938061356954e-01   +3.425856027490741e-01   -1.659986212359773e-05; +3.411792976997675e-01   +4.281360630343772e-01   +3.377520568617596e-01   +5.993348081304466e-01   +7.964146818145308e-01   +1.991412881905510e-01   +3.332977963762201e-01   +2.716551336968156e-01   +2.927694399932981e-01   +2.615219596120452e-01   +6.206153832390008e-01   +4.958276898596626e-01; +3.599247601082562e-01   +4.424159836963389e-01   +3.885502358106148e-01   +5.886614501461519e-01   +5.546047999334666e-01   -8.652884915129307e-02   +8.758493924976957e-02   +2.505062466558966e-02   +3.086670227129024e-01   +2.317684166803810e-01   +7.976557484529512e-01   +9.184070971988877e-01; +6.949201544408776e-01   +6.089832263381350e-01   +5.764587811884020e-01   +3.942486677409046e-01   +4.785322630368993e-01   +3.824136020218043e-01   +4.612437969390926e-02   +6.646851015753238e-01   +4.088132488024874e-02   +8.083521530115086e-01   +3.893595961454122e-01   +1.077163594179616e-01; +1.187780801214953e-01   +2.518884523341950e-01   +5.924175511783313e-01   +2.345185348665079e-01   +3.290717631936620e-02   +4.912869997798956e-01   +3.659228438122118e-02   +7.200583405659388e-01   +6.629259223870936e-01   +1.927580434943698e-01   +6.397568852099318e-01   +3.066424019365702e-01; +6.412731438509091e-01   +6.882586090458396e-01   +3.972672353543857e-01   +6.020688463520015e-01   +6.328681642141568e-01   +3.305728642156409e-01   +3.172193154999389e-01   +8.643645193735935e-01   +5.483267413147641e-01   +3.220284238256048e-01   +4.672853386191940e-01   +4.304449029233145e-01];
L3E_L3I_iGABA_netcon = [+3.555419098810615e-01   +7.457735655109798e-01   +6.484861603966506e-01   +9.328060288594822e-01   +5.014726772082949e-01   +6.682137932446462e-02   +2.759046659749242e-01   +6.693723374592390e-01   +6.714962126436131e-01   +3.215612584134573e-01   +4.544552610997082e-01   +2.882605220801404e-01; +8.585957349935637e-01   +3.706194298096611e-01   +5.722078686535326e-01   +8.456513557701474e-02   +8.240855558293726e-01   +3.838641197960782e-01   +8.673732057879014e-01   +6.647816925403667e-01   +5.708138661908684e-01   +7.503946418056148e-01   +2.729130334777096e-01   +4.597433080508670e-01; +7.599853527230489e-01   +4.090768872029091e-01   +4.487476180675359e-01   +5.515736099139039e-01   +5.576901562383764e-01   +5.219071278989962e-01   +2.831850786257514e-01   +8.653799282677030e-01   +4.787483264208260e-01   +2.077872769729527e-01   +7.789443166081914e-01   +8.833036242600522e-01; +1.569980396097175e-01   +6.404134340679689e-01   +2.968264531380454e-01   +3.360368424408354e-01   +9.058872471547194e-02   +5.764761852499781e-01   +3.102517522246173e-01   +8.758627954471011e-02   +2.765560051122448e-01   +5.139409559190299e-01   +7.843486889061262e-01   +6.143475405981021e-01; +2.793912623179559e-01   +6.179711131973810e-01   +5.879037310123418e-01   +3.170120644169140e-01   +1.016344447102790e-01   +6.779823651695519e-01   +8.217917676482199e-01   +2.979987500659197e-01   +2.294079660244911e-01   +7.816410059059966e-01   +5.632690627142676e-01   +2.154204064270972e-01; +4.163568849113876e-01   +7.769115264949112e-01   +6.924278844078844e-01   +4.557037573917435e-01   +7.086423188629462e-01   +8.701955938955699e-02   +3.149127552239702e-01   +2.009175034378408e-01   +8.656438623795929e-01   +8.708826610427368e-01   +8.381807447380840e-01   +2.261639752305448e-01; +5.885880324534277e-01   +7.562355796089089e-01   +2.277230659441813e-01   +7.770888022837714e-02   +4.339107356260800e-01   +5.844237434215114e-01   +6.147036159046989e-01   +1.908228379460377e-01   +9.361608578055760e-01   +5.913543102995045e-01   -2.793120796629000e-02   +3.133544054206372e-01; +5.102582788609377e-01   +3.707401749437029e-01   +8.872279022054040e-01   +4.123140657797337e-01   +1.276414716788156e-01   +5.988047251013263e-02   +5.567280033998478e-01   -1.357768918953573e-03   +5.959025126901429e-01   +7.770976453772082e-01   +2.408956487749050e-01   +9.854683268966258e-01; +2.725910864052477e-01   +5.521173688733302e-01   +2.822365886069569e-01   +7.752217047802714e-01   +7.758229678413942e-01   +9.309452311827264e-02   +3.743564058866581e-01   +5.978386225099934e-01   +5.724269512122632e-01   +7.820341786079238e-01   +6.754412977466090e-01   +6.508936998783625e-01; +6.190586986950344e-02   +9.135180428615615e-02   +3.029382181633374e-01   +5.809720514084037e-01   +6.990793431288521e-01   +2.081990289583915e-01   +5.954235255996955e-02   +3.005009440342097e-01   +7.210370865314933e-01   +2.333241151479343e-01   +6.057023381848902e-01   +5.394668366391800e-02; +8.913438253975693e-01   +1.069166100545302e-01   +7.156778165849935e-01   +5.275302007246835e-01   +3.725572628947155e-01   +8.455514465866000e-01   +1.714280574411380e-01   +7.970221197243414e-01   +3.034660970449800e-01   +8.889907336504901e-01   +5.409963737102459e-01   +7.299219997353618e-01; +6.493849609800374e-01   +8.023532773205601e-01   +4.924081268778797e-01   +8.343302420310859e-01   +8.156260035911895e-01   +5.371174528030230e-01   +8.865731152565420e-01   +8.737176018860956e-01   +5.203222257868323e-01   +8.033912951823228e-01   +4.738806077529671e-01   +8.919125255174873e-01];
L2E_Input1_iAMPA_netcon = [+9.455920158622146e-01   +9.740418488033590e-01   +8.910874952151215e-01   +9.398306840087157e-01   +8.449398572634881e-01   +1.000000000000000e+00   +8.919150799668877e-01   +9.287670997163764e-01];
L2I_Input2_iAMPA_netcon = [+9.301142097255424e-01   +9.250527198704579e-01   +9.608432574650946e-01   +9.176095984426961e-01   +8.227010546193837e-01   +8.665389577091905e-01   +9.398626409622616e-01   +9.360733080020490e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
