function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.185246437808062e-01   +1.027017701773759e-01   -9.907960507974883e-02   +5.810021701598458e-02   -2.200506717081543e-01   -1.131793284844633e-01   +4.516106950940534e-02   +8.999659308094789e-02   -2.493477508468758e-01   +4.283774859446052e-02   -3.628615993575499e-01   +9.795164315623237e-02   +1.109537094513514e-01   +2.650207539007647e-01   -1.510045945262402e-01   -2.584782213859174e-01; +1.690465118827000e-01   -2.725595032013833e-01   +2.658485341867074e-01   +3.970159077418603e-02   +1.487683921892247e-01   -9.682406541525818e-02   +3.751365509846331e-01   +2.161906105560363e-01   +7.148186200871576e-02   -1.799733373149615e-01   -5.383457688520880e-01   -2.038829327792166e-01   -2.773148451779905e-01   +4.209719183952426e-02   -2.014165729021811e-01   -1.749315180532250e-01; +3.437810206922549e-02   -3.187570988248369e-01   +1.656106999448703e-01   +8.176348128955027e-02   +1.344833368053102e-01   +3.610291751647152e-02   +1.603487492280066e-01   +2.010381790178422e-01   +1.411651627707080e-01   +3.066170864559877e-01   -5.600041730709307e-02   -1.409493386227992e-03   +1.341630324405280e-01   +2.410046381122027e-01   -2.795201265933242e-01   +1.018299049936480e-01; -2.234398016815425e-01   +9.422082626248476e-02   +2.402641378398479e-01   -3.024198455711763e-01   +2.640840247658492e-01   -6.847310787511093e-02   +8.354189539907637e-02   +1.223852872826018e-01   +8.716945182725241e-02   +4.039592028150484e-01   +1.466073949743874e-01   +1.966893533007482e-01   -7.689239624407457e-03   -8.831601666437966e-02   +5.806109413289684e-03   +2.101558275198179e-01; -4.201229456218997e-01   +2.833792393067222e-01   +3.626271511907032e-01   +4.920628888077649e-02   +3.011422357786059e-01   -3.685050743662327e-01   +1.261136258960938e-01   +1.014880304605254e-01   +1.077477050122153e-01   -3.613623461699976e-02   +2.926023211156714e-01   +1.203342550442477e-01   +1.038478043505605e-01   -1.110150979369127e-01   -1.396870330126709e-01   +9.941645026987753e-02; -1.982607125984934e-01   -6.099891266006317e-02   -2.767019519998073e-02   -7.487056952302339e-02   -1.741027131031167e-01   -1.897570196376152e-01   -2.324043646515970e-01   +4.024449369942498e-01   +3.216518851106421e-01   -3.268379675348082e-01   +1.176966202189705e-02   +4.105428495527697e-03   -5.231301930163395e-01   +2.416840871300517e-01   -1.549345477069627e-01   -1.873567878127321e-01; +1.049274029165222e-01   -3.338540746545566e-01   -2.469757722347867e-02   +2.638486996734352e-01   -2.960015564653683e-01   +4.599664141795110e-01   +3.749909795497862e-01   -3.101985654349483e-01   -1.931696127264964e-01   +2.316117433687008e-01   -5.287906331802453e-02   +4.610976875302361e-01   +3.689898039005600e-01   +1.409958031269516e-01   +2.841475449708791e-01   +1.193954732600234e-01; -1.931213526890240e-01   +1.961412989589955e-01   -3.596698369795283e-01   +5.744309880845613e-02   -2.643395916909626e-01   +1.158161304824660e-01   +3.625659610965367e-01   -1.681566524743068e-01   -1.616495212266137e-01   -1.583163833063102e-02   -2.390064133358558e-01   +1.867158457601233e-01   -9.458270741022212e-02   -4.352310736886881e-01   +3.383965034500980e-02   -9.632172056442781e-02; -2.774304706278837e-01   +1.723697400073982e-01   +4.208811810576913e-01   -4.262565403013932e-02   -9.008426404451014e-02   -2.449258114050942e-01   -2.106106116810652e-01   +1.819984868587114e-01   -1.985741534584296e-01   -1.177786772650480e-01   -8.818785126339053e-02   -2.878962833381304e-01   +1.300352202874654e-01   -1.636214265920107e-01   -1.258255746377283e-01   -1.788993543876810e-01; +6.928596500246159e-03   -2.323712830315013e-03   +3.121314186871006e-01   -2.421256978163572e-01   +2.289477994970567e-01   +2.250011899452175e-01   +1.060668410478396e-01   +1.164565338127864e-01   -2.136897436419990e-01   -2.766649631381241e-02   -2.229393465540712e-01   +3.075946690531376e-01   -1.052266136262272e-01   -3.170420864737001e-01   +9.891690132875261e-02   -8.784700951410013e-03; -7.600821499727770e-02   -3.344885748709622e-01   -3.055194104821233e-01   +2.419146075801780e-01   -2.548003346226591e-02   +2.445691192170851e-01   +2.283278682797695e-01   +3.672675975320969e-01   -3.678539154669837e-02   +1.983184778970420e-01   +4.876929264761970e-01   +9.473256316809150e-02   -2.798305289410748e-01   +4.809931225262384e-01   +4.111728647303203e-01   +2.440514866833048e-01; -7.842934578860740e-02   -5.045267549612598e-02   -2.591610824255344e-01   +2.659646724776986e-01   -1.566383409097628e-02   +3.097848183705742e-02   -1.984596366806352e-02   -2.005324478845887e-01   +2.033532536835783e-01   -2.765005438959780e-01   -4.556659914623084e-01   -1.568825889281025e-02   -3.347517487320638e-01   +2.744166647678545e-01   -1.692099047633594e-01   -2.139045186458259e-01; +1.950578025418260e-01   -2.908167593536100e-01   -3.860308087899653e-01   +8.569513170833840e-02   +3.108894452198026e-02   +2.212852508703254e-01   -3.638618969876334e-01   -1.316707873322888e-01   -7.948783950749125e-02   +8.349401243696261e-02   +1.194803932327972e-01   -3.530766570954238e-01   -1.558009019039388e-01   -1.807476774536842e-01   +2.168333204521442e-01   -7.185453842924072e-02; +5.685167272600782e-01   +4.913838013899238e-02   -3.062939579059593e-01   -9.318145145372070e-02   +6.732414727648325e-02   +8.590459047753130e-04   +1.385791381992379e-01   -2.280888718506381e-01   -1.831149722916214e-01   -8.424305427204148e-02   +2.377137623714332e-01   -1.289954810839026e-01   -3.222914569871092e-02   +1.565220230943156e-01   +4.181275024409908e-02   +2.250050271467507e-01; -3.561896489519362e-01   +2.384688051410353e-01   +1.624359905166230e-01   -6.251591146945767e-02   -2.121271777387412e-01   +2.616603397780252e-02   +8.437850431754988e-02   +3.686825583693122e-01   +2.694512161988408e-02   +2.667124622620925e-02   +2.206446757926492e-01   -2.428648598247760e-01   -6.860341084833146e-04   +2.531390772463138e-02   +1.743757843034915e-01   -1.933254868854217e-01; -1.128355745968166e-01   -3.292521957792116e-01   +1.149864225124324e-01   -1.107676165788345e-01   -1.814352838580269e-01   -1.183612839818410e-01   -1.039709724133807e-02   -3.390290611249155e-01   -1.582836684306885e-01   +1.544775759091602e-01   +9.901240192840620e-02   +1.544664259574891e-01   +2.701259244525749e-01   -2.104118083287256e-01   -3.039881114151115e-02   +1.110903419432069e-03];
L1E_L1I_iGABA_netcon = [-2.278516953772729e-01   +2.502832140760903e-01   +3.452167440396301e-02   -1.117824492214132e-01   -1.606793029845345e-01   -1.477348292260170e-01   +2.624175439259194e-01   +9.035334507563914e-03   -1.223248076193917e-02   -3.577661163053190e-02   -2.576942058576301e-02   +5.279692790608020e-02   +9.242274953818011e-02   -5.915547623221078e-02   +1.194668017862934e-01   -3.273965107474715e-01; -9.139507360746341e-03   +1.323468773798830e-01   -1.596076986219052e-01   -1.711731086739242e-01   +3.298247975894980e-03   -1.422527465731509e-01   +4.272102043862370e-01   +3.827773941998962e-01   -2.602353571137559e-01   -3.353180731426192e-01   -2.123482139056356e-01   -1.873596059090697e-01   -1.108502763251597e-01   +3.496082594322064e-01   +9.175661478246386e-02   +1.746071449033018e-01; +4.657242386822177e-02   +2.606191757787608e-01   +2.355394864289090e-01   -6.806313459165353e-02   +1.005962702296548e-01   -3.102474969813683e-01   +1.514381145720400e-01   -2.481832014937249e-01   +2.147292860845114e-01   -7.015797512301505e-02   -1.268717691446773e-01   -4.191313488913591e-02   +1.400270146281249e-01   -1.296812891726120e-01   -4.852156155602215e-01   -1.588021244737488e-01; +1.521981722666470e-02   +2.966618434885819e-01   +2.195276975716012e-01   -3.750271771722992e-01   -2.915033595091146e-01   -3.436070382930622e-01   -1.740084945367029e-01   -3.980174754299908e-01   +9.519092617687229e-02   +1.315377475194655e-01   +1.134965168362992e-01   +3.352670006648016e-01   +1.015509227147793e-01   +2.445581468106178e-02   -4.678750178313616e-02   +1.911741822895562e-01; +5.196677943788547e-01   -1.038813911305867e-01   -4.749014897002932e-01   -1.128407820569102e-01   -3.059480349354737e-01   -7.600792859623919e-02   -1.600276986091504e-01   +3.546266105089128e-01   +2.230258311522527e-01   -8.141688564115021e-02   +5.393445807397942e-02   +2.047745724639608e-01   +9.955103984963645e-02   -9.970719603893285e-03   +1.564648561787476e-01   -4.012317415885806e-02; -1.357736293057554e-01   +1.823875499267515e-01   +9.932925079008348e-02   -9.049015173033162e-02   +3.461300147952595e-02   +1.541519874645296e-01   -4.221735650901379e-02   -1.062345637833903e-01   -1.655568379377019e-01   +6.512269757181001e-02   -2.465184638894702e-01   +1.899471462967377e-01   +3.546053769575747e-01   +3.122644086188847e-01   +4.207063727404360e-01   -1.260810815940075e-01; +2.815631058637230e-01   +1.965326113683271e-01   -1.336608598618060e-01   +1.253589952980515e-01   -1.986086141821892e-01   -1.387751318245308e-01   +3.601529535052429e-02   -2.739443626392038e-02   -4.035820935164057e-01   +2.407904611797552e-01   -1.423585274212996e-01   +1.405389859120250e-01   +1.043518128621908e-01   -4.527072628471275e-01   +9.206572073646124e-02   +9.632566311500071e-02; +9.177897638397044e-02   -9.806332918005523e-02   +2.078406963237406e-01   +7.745125116251526e-02   +2.487877255941790e-01   +1.425735807424450e-01   -3.441121746148582e-01   +4.262164467512194e-01   +5.262362053509374e-02   +3.059947695024394e-01   +4.609969254988174e-01   +2.626178501748718e-01   +5.384386899980562e-02   -1.348129504504224e-01   -1.906581982808949e-01   -2.287699685907571e-01; +3.731615297107232e-01   -1.914612644694064e-01   -1.239422133720638e-02   +8.377415866909865e-02   -1.943946121406083e-01   -1.310210589556318e-01   -6.741666891193285e-02   -3.552087847601598e-01   -3.910865159034941e-01   -1.803699727224217e-01   +2.885722266021866e-01   -1.133052463694806e-01   +2.857740957916984e-01   +5.616710403079747e-03   +1.571972261093182e-01   +2.292878928589304e-02; +3.071249723814011e-01   -2.841944502410189e-01   +1.370135245791976e-01   -1.439894614091253e-01   +3.821950060982593e-01   +2.237579629976415e-02   +2.588034984497930e-01   -5.693922476217453e-02   -3.141283410444068e-01   -8.726361942755265e-02   -9.927363002692164e-03   -3.627908393612069e-01   +2.322892004555806e-01   +1.984144775906008e-01   -3.336849598173123e-01   +8.514535812775872e-02; -2.329230922891646e-01   -1.125267947264761e-01   +3.106267275018789e-01   +2.789166442736039e-01   +7.847402130126246e-03   +2.788908497421260e-01   +2.686083412683782e-01   -3.286134158712199e-01   +4.096422818428083e-01   -4.416516058040262e-01   +3.424322446880862e-01   +1.091020113726918e-01   -2.233036408688372e-01   +1.897836700956499e-01   -2.861922708872323e-01   -6.658679284128667e-02; +7.344970761520553e-02   -1.483042356381128e-01   -3.937434946976563e-01   -3.185740457943398e-01   +8.458829608520455e-02   +5.026955481170209e-01   -3.878081690347662e-01   -1.249915256282354e-01   +1.510467868235727e-01   +1.000538736101881e-01   -1.698328352586904e-01   -2.237195651781451e-01   +1.335863892820634e-01   -1.227555080674877e-01   -1.932300156995162e-01   +1.552610197711417e-01; +9.638384032213682e-02   -1.914507462537710e-02   +1.746880384273298e-01   -1.573905046820207e-01   +1.975886281240304e-01   +2.220865927168915e-01   -2.668697749568358e-01   -1.942633964054584e-01   +2.087607151730789e-02   +3.941930374645133e-02   -4.698292321300052e-02   +8.915635321551960e-02   +1.974772475716257e-01   -1.714384994364461e-01   +1.075236514776696e-01   +2.088123743436852e-01; +7.949391383914162e-02   -1.507734874489911e-01   -9.311640544001524e-03   -2.356785714359537e-01   -1.381568855958772e-01   -2.784210383088742e-01   +1.377651405303104e-01   +3.456975011042175e-01   -1.439258060648609e-01   +2.962508847995723e-01   +3.003032305776121e-01   -3.513338199281276e-01   +2.115215476285296e-01   +8.775709368773282e-03   -2.739882679428619e-01   -1.083398040478406e-01; -1.447286105167570e-01   -2.534970159977504e-01   -2.091663904655961e-01   +2.104846113252747e-01   +1.420579985047953e-02   +1.874992280550424e-01   -2.644494331241791e-01   +7.221530521766870e-02   -4.106861231217211e-02   -3.365918021899293e-01   +6.761922383313995e-02   -1.009203010319026e-01   -1.249198312222324e-01   -2.941733386975729e-01   -1.753537952227095e-01   -3.323390982858538e-01; -3.080524082089095e-02   +2.026207958967678e-01   -2.202672135137925e-01   +2.483104700914767e-01   -9.085767706660039e-02   +2.350083355273079e-01   +1.981396660001562e-01   -1.632127365153778e-01   +2.920128570363348e-01   -1.932049638240874e-01   -4.066777771768051e-01   +3.970608456296488e-01   +1.722937612496650e-01   +1.643333040397887e-01   +4.252214068079367e-01   -3.271365681461343e-01];
L2I_L1I_iGABA_netcon = [+5.876646086962201e-04   -2.454873497095668e-03   -2.381037037265685e-01   +1.212861462236549e-01   +5.379681248192710e-02   -9.593829227699982e-02   -8.294143185125662e-02   -2.682436609152989e-01; +1.200608714240119e-01   +2.582950047819818e-01   +7.258864713589072e-02   -3.545994059002409e-01   -1.669153121377448e-01   +2.094831486610814e-02   -1.332556685211338e-02   +5.014118899847209e-02; +1.336321365354322e-01   -7.357695112067561e-02   -3.535871849423819e-01   +3.445747436930690e-01   +2.259067601686036e-01   -7.456788449098771e-02   +4.168255664524044e-01   -1.629899165215451e-01; -2.133782394911195e-01   -1.194674554948281e-01   -2.287889402659794e-01   -3.908777060647465e-01   -1.678989301024207e-01   +3.082619496905434e-01   +2.361548451899948e-01   -9.882685124910709e-03; +6.928212086528873e-02   +7.488532850096305e-02   +1.547824666226023e-01   -2.580986915139331e-01   +7.230475491525291e-02   -1.495548619766583e-01   +1.983823478071552e-01   -3.223852299309052e-01; +4.471314125943360e-01   -1.948615948908007e-01   +1.105164421747850e-01   -1.739254141379428e-01   -3.462047076032645e-02   -3.178702708206479e-01   -1.231854201373608e-02   +6.393910676358081e-02; +2.253315547248934e-01   +2.046114806047001e-01   -5.234806308864586e-02   +2.432894218805121e-01   +5.488162586862103e-02   +3.193558944020901e-01   -1.829184430331010e-01   -4.426079230236079e-01; +2.413618900288016e-01   +2.801065981223207e-01   +5.792268100357598e-02   -1.492671964760724e-01   -4.311287452663406e-01   +1.211977238285191e-01   +3.709649658506858e-01   +1.634377862247778e-01; +3.717659934493347e-01   +1.621995893979027e-01   +3.810222629216542e-01   +2.187740943957474e-01   +1.003849456989922e-01   -3.070187666871688e-01   -4.739400706456792e-02   +2.232266658116396e-01; +3.162152432126825e-02   -1.816549180713905e-01   +6.152485612818706e-02   -2.290286917893164e-01   -3.558711849806593e-01   +2.399617498106123e-01   +3.612611657049207e-01   +2.918622577430028e-01; +3.534618063051758e-01   +2.706788979447282e-01   -1.364238768680595e-01   -9.789527155454229e-02   +1.211080867194945e-01   -6.744130786522515e-02   +2.521520450524107e-01   -2.924203122329916e-02; +3.717036436826036e-02   -3.506156386510179e-02   +1.227586234000715e-02   +3.200229494119718e-01   +2.089402292156559e-01   +3.164657219086250e-01   +4.463252191169044e-01   +1.188055500651220e-01; +4.491649437322944e-01   +2.955604894671028e-02   +3.095565899381622e-01   -1.591015836871667e-01   +1.598041818566520e-02   +3.891365659835774e-01   +1.236949108998221e-01   -8.101420581324846e-02; +2.981913318709544e-01   -4.408399997295758e-01   -2.602737646447686e-01   +1.505835303476740e-01   -2.726268800532857e-01   -2.651485788693299e-01   -3.750435258097041e-01   +2.168251128090053e-02; +1.724959727912460e-01   -5.043409584830154e-01   +3.775023596797886e-01   -1.678714976794898e-02   -3.286342064813328e-01   +4.350672583843726e-02   +2.215939359854740e-01   -1.092774757990355e-01; -3.023919351806664e-01   +6.750792529806450e-02   +3.114557533541563e-01   +2.751078776655278e-01   -1.187757387012366e-01   -4.129092751902098e-02   +1.175101697039706e-01   -1.200000129163257e-02];
L1I_L2I_iGABA_netcon = [+3.186830497297374e-01   -2.820707619798685e-01   -3.963282220330457e-01   -2.177772537221156e-01   +5.197461267980039e-01   -2.023690715468843e-01   +5.274088828325680e-01   -2.424140233978266e-01   -4.127716160823402e-01   +6.057354622690017e-02   +7.034163939243944e-02   -2.974063184091022e-01   +3.150265253331671e-01   +7.843853237209944e-03   +6.539563458572144e-03   -2.319661243564833e-01; +1.077360720764489e-01   -1.711616264813547e-01   +1.902946002070682e-01   -2.126478363894156e-01   +2.276328679142411e-01   +2.249703090683451e-01   -4.741244444424112e-01   +4.373604600308754e-02   -3.295652127000774e-01   -2.033942030841359e-01   -2.134333194948496e-01   -1.668733053211930e-01   +1.665131340097768e-01   +2.031388101994874e-01   +2.211459234987729e-01   +2.416943680226997e-01; +2.662844459092294e-01   -4.989027125606472e-01   -3.571809264058474e-01   -2.379246185326005e-01   +1.015137692639020e-01   +2.443966830646500e-01   +3.243818973926749e-01   +2.431323518727079e-01   -2.117951450036852e-01   +1.633054088017693e-01   -1.126887001142634e-01   +1.212626194914763e-01   +1.628232310801883e-02   -1.834572147340257e-01   +1.064109775835480e-01   +3.058561161410113e-01; +1.336320253790066e-01   -4.303931406024241e-01   -1.831548161580426e-02   -5.916294263512890e-02   -2.261184464849679e-01   -7.840700635527838e-02   -2.232653622312033e-01   +3.832881658603205e-01   +2.638509884931198e-02   +2.487148928513034e-01   +1.593049762864717e-01   +5.973917190615420e-02   -1.392660815165278e-02   +4.021958324504178e-01   +2.359276892019336e-01   -7.435050326973597e-02; +1.719314610251361e-01   -1.491564571830479e-01   +1.212933561930731e-01   -2.052990258623600e-01   +8.629568597591321e-03   -1.830235541131203e-02   +3.281038157090669e-01   +4.391594605868866e-02   -2.438281147943526e-01   -2.361288073176913e-01   -9.195774840248601e-02   +2.304054498984357e-02   -1.442396352148418e-01   -1.742393314144861e-01   -4.271104227889055e-01   +1.189749294048953e-01; -4.337764817433334e-01   +5.260619934210867e-02   -1.361155229156445e-01   +8.487716908449423e-02   +1.764508830273491e-01   -2.172948245665877e-01   -3.190280814091546e-01   +2.442989735834407e-01   -9.926763060026531e-03   +2.085424573119196e-01   -2.235715607122533e-01   +6.910060433441015e-02   -6.336383158056340e-02   +2.063014552423313e-01   +1.310736236088446e-02   -2.528404568720208e-02; -1.806714008873643e-01   +1.221692062995094e-01   +3.017358765860342e-01   +3.801059096614383e-01   +1.883115380416079e-01   -1.138110633343496e-02   +2.793410674032381e-01   -1.117441178484042e-01   +1.229597088450141e-01   +4.779229587538660e-01   +6.651277607093770e-02   +2.740215309566625e-01   -3.120134095048538e-02   -1.567293555769228e-01   -2.173823620580718e-01   -1.593982823313132e-01; -2.303644144875994e-01   -6.445407745024087e-01   -2.418157080834030e-01   +3.911671102456984e-02   +5.457374824364614e-02   -1.349426902955859e-02   +9.135241974899749e-02   +1.040217540509452e-01   -8.384730696932322e-02   -2.093220265029358e-01   -3.515192922620658e-02   -9.194864088626545e-02   -1.703285278766146e-01   -3.164914965226279e-03   +7.736924741552360e-02   -9.234512083840880e-02];
L2E_L1E_iAMPA_netcon = [+4.455621081956389e-01   -4.675942258489366e-02   -2.009140728183673e-02   +2.137071430502104e-01   -8.805412513340587e-02   +2.425301573156491e-02   -3.188770925382594e-01   +1.203766251688572e-01; -1.328586147136687e-01   -7.868570288210394e-02   -2.674075418784902e-01   -1.081787516634438e-01   -3.470844606369372e-01   +3.253579797983804e-01   -5.100088664621819e-02   +5.501821481439642e-02; -1.230870421599903e-01   -1.045932339621007e-02   +1.409795024199016e-01   +3.065001199498446e-02   -7.817957397912395e-02   +9.936051125983185e-02   +3.283486337734386e-01   -4.073837907129699e-02; +1.073894014671378e-01   +3.149723497988256e-01   +1.650857434488521e-01   -1.559957598975162e-01   +2.674944458578685e-01   -5.582058388030124e-01   +3.320014099677916e-02   +3.132221577189691e-01; +1.232750830660757e-03   -4.017603126894541e-01   -1.646104465626345e-01   +4.955374979719385e-02   -1.548554697134299e-01   +6.100367568242222e-02   +1.112765526475898e-01   -6.394359161222772e-02; -4.643975510206846e-02   +4.085520061451405e-01   +1.464918148239541e-01   -3.996512342466016e-02   -1.582203423777142e-01   +1.904495966786837e-01   +9.962213738447753e-02   +9.330817868433378e-02; -2.147989916851241e-01   +3.628036681706084e-01   -5.061258718693114e-01   -4.365304887964629e-01   -7.177395405352216e-02   -1.614317057332172e-01   -5.119418560427259e-02   -2.757456641479381e-02; +3.315223234783815e-01   -4.704036514699090e-01   +5.545979918922082e-01   -2.175415903074206e-01   -1.064241725086625e-01   -1.293836507228641e-01   +1.605592886071133e-01   +3.116520810577008e-01; -1.577514161743190e-01   +3.879665540232058e-01   +8.241426394511212e-03   -3.185462796947562e-01   +2.127254309676193e-01   +4.135265720749279e-01   -3.584645918271327e-01   -4.648482249604425e-01; +1.437041612641786e-01   +4.565266351778248e-02   -2.478915723658776e-02   -3.738765806755647e-01   +1.411003780559661e-01   -1.463039738512587e-01   +9.896528300939972e-02   +3.617999851806719e-01; +4.656185975154123e-01   +1.769504638154273e-01   -2.210793780593295e-01   -2.049984966678010e-01   +1.362223804796550e-01   -1.048382551413060e-01   +3.877825562532500e-01   -4.781503132195314e-01; +4.972450097908759e-02   -3.968119713150212e-02   +8.116059731808842e-02   +4.236875211398935e-01   +2.361331542348701e-01   +1.139164201893634e-01   -3.786154536734007e-01   +4.102710177236767e-01; -1.546550800959288e-01   -3.431478515832911e-01   -3.145942372241228e-02   -3.534104808890240e-01   -5.399300369613372e-02   +1.170568060979981e-01   +1.555800974655444e-01   -5.368494776086501e-01; -1.502534798177805e-01   -9.662609218567066e-02   +1.211865027958916e-01   -4.882703213813354e-02   +2.290277448356209e-01   -1.334458902530435e-01   +3.521275003625928e-01   -1.135272038308185e-01; -4.202872791676060e-02   -3.292556614222306e-02   +8.523981279285496e-02   +2.957172260527802e-01   -3.805436075595361e-01   -2.885263413353305e-02   -1.538718973887125e-01   +2.169595266004500e-01; -1.913046933625930e-01   -2.205028782950575e-01   -4.399069932176020e-01   +2.154734360041129e-01   -3.789103896469709e-01   +1.390149998171625e-01   +4.349077976591104e-01   +9.173125348253157e-02];
L1E_L2E_iAMPA_netcon = [-1.311813888985461e-01   -3.721494298395513e-01   +6.574356436523060e-02   +1.642112146329939e-01   +5.816944327319293e-02   -6.709630800355199e-02   +4.916669575388975e-03   +6.997183130966626e-02   -7.266979833569437e-02   +1.579348611650105e-01   +4.921483311926653e-02   -2.011134409494631e-01   +3.406480618490723e-02   -4.079720085854466e-01   +1.374830241685081e-01   +1.318531381961428e-01; -2.099466782027758e-01   -3.119332649411158e-01   +2.456698242473690e-01   +3.123268942885778e-01   +1.930123249681441e-02   +3.810179494770337e-01   -3.736173530098368e-02   +8.180076010052763e-02   +1.752997745899808e-01   +1.453513772667432e-01   +1.587501151850884e-01   +6.553305986298133e-02   +1.616794322169046e-01   -6.880140499157501e-02   +1.169694582202138e-01   -8.979118169667290e-02; -2.703639011066508e-01   +1.473516035237708e-01   +1.016907976969351e-01   -1.258647648158520e-02   -1.089118497700660e-01   -9.541760382479492e-02   +6.155579257512815e-02   +9.256746861196914e-02   +1.709928963267541e-01   +1.603829995522577e-01   +1.403266982843354e-02   +1.693769368255642e-01   -2.224735798588080e-01   -7.634150324910749e-02   -3.398859103896648e-01   +1.408239410558749e-01; +2.471988758618029e-01   +2.857781318504377e-02   -2.143084239410368e-02   +3.321061514752053e-01   +2.311725790662065e-01   +3.942942503456824e-02   +8.372186841854418e-02   +1.352300551075636e-01   +7.820847615595095e-03   +5.358364348957189e-01   +2.125687334914663e-01   -2.809113567199763e-01   -5.454427323629957e-01   -1.445230351943535e-01   -2.138347679444395e-02   -1.633543566906627e-01; +1.899037092047772e-01   +1.606384462198346e-02   +3.585778472034462e-01   +2.416021373854784e-01   -1.619969389738843e-01   +1.550683327516679e-01   +2.904647742564988e-01   +1.387639169039685e-01   +1.176646695827286e-01   +8.286454958273493e-02   -2.464218266981602e-02   -1.918835020782780e-01   +6.755721180853276e-02   +2.748318121981262e-01   +1.888833628654119e-01   -5.569422587482117e-02; -7.820944898861615e-02   -1.185262717661219e-01   -2.056699914565245e-01   +3.139544439477616e-01   +2.144586451801428e-01   -1.317925981871666e-01   +9.104030384712432e-02   -2.029516309783439e-01   +3.557407305293497e-01   -2.486587176953786e-01   +9.099037585631280e-02   -8.333009406710086e-02   -2.697136391383838e-01   +1.990691107050906e-01   +1.240106926552333e-01   -6.179975577475064e-02; -2.068275915596518e-02   -1.722760385576907e-01   -1.437732821023197e-01   -2.609885264451008e-02   +5.225936395389655e-01   -2.893153529260429e-02   +1.145505767284963e-01   -1.726334362096947e-01   -8.184269300430402e-02   -1.210605762881755e-01   -8.015199165674680e-02   -1.784791344051213e-01   +4.394163594555659e-01   +2.907275727408516e-01   -2.905441307493931e-02   -3.728593249159570e-01; -4.534207024323791e-02   -3.422067604623584e-01   -2.140162658733467e-02   +7.741694655150792e-02   -1.508517604007206e-01   -3.314880755323701e-02   +6.920903025589289e-02   -1.197577031962946e-01   +2.088667263967107e-01   -1.016319059033441e-01   +7.722309771757835e-02   -2.135628860246997e-01   -4.097367237565306e-02   -6.166192666311149e-02   -2.274377081365269e-01   +5.642880477473866e-02];
L2I_L2E_iAMPA_netcon = [-3.509451366436316e-01   -4.551743439727717e-01   +2.613917558925052e-01   -2.044108742604023e-01   +3.174759357450505e-01   -2.666813160029451e-01   +2.662303142510410e-01   +4.440557194527616e-01; +2.013471077906509e-01   +2.324391340897535e-01   +1.561051353727518e-03   -1.366736749221578e-02   -2.430463581847223e-01   +5.200808257206452e-03   -4.328081934461581e-01   -9.831369908146229e-02; +2.496467965794001e-01   -3.729791265117767e-01   -3.822421572394500e-01   +1.604886044428349e-01   +2.681426409907942e-03   +2.077124713308947e-01   +1.225360570220793e-01   +1.463442170294043e-01; -1.475618366920020e-02   -3.185528036198823e-01   +2.292192994799890e-01   +8.788513463461943e-02   +3.353618467174505e-01   -6.367182069153765e-02   -1.727867529066160e-01   +5.179721042029717e-02; -1.895259379458075e-01   -2.197959951792148e-01   +3.039693571153920e-01   +4.595831908931219e-01   -9.897137746307336e-03   +1.521041342298038e-03   +1.482132736293829e-01   -2.705053505469442e-01; -1.162219512912854e-01   +2.739779837177324e-01   +6.835412385978097e-02   -3.550510600560970e-01   -1.852696098577195e-01   -1.064199538245557e-01   -9.967525706765579e-02   -8.473495959639699e-03; +2.834728479679304e-01   +3.469861442232538e-01   +1.202879803901865e-01   +2.652893238642382e-01   -1.141996130419995e-01   -1.415064450131259e-01   +1.937472013015368e-02   -1.170568185666062e-01; -3.168876562656511e-02   +3.758102261966680e-01   +1.685840423174233e-01   -1.579924128368874e-02   -2.904951615270873e-01   -3.607634133322166e-02   +4.028649876979911e-01   -1.580656446616329e-01];
L2E_L2I_iGABA_netcon = [+3.030142608705886e-01   +5.814645105976369e-02   -3.429917426054597e-01   +7.785319193316204e-02   +1.667532169189719e-01   -3.176521492654804e-01   +6.211227863018610e-02   -4.877667981734202e-02; +2.480841910409166e-01   -2.643745768086157e-01   -1.340917425043300e-02   +3.528046292326669e-01   +2.881430315679853e-01   -3.201993393953814e-01   -1.436679887731511e-01   +2.735955195796837e-01; -2.535686461681615e-01   +7.156327688714959e-02   +1.627933560707331e-01   +3.023116918755972e-01   +2.471904248546729e-01   +1.606310843525132e-01   -9.075660114374400e-02   +1.613927886697161e-01; +2.142310519243132e-01   -4.943898032844289e-01   +2.010881046454413e-01   -3.455498368762861e-01   -1.087105817485747e-01   +7.506746994874769e-02   -3.018642626767003e-01   +1.774200695595770e-01; +8.963458663636076e-02   +5.483833671097127e-02   -3.160979397699875e-01   -1.710875784091458e-01   +1.949556578669399e-01   +1.480831313117667e-01   -8.243101359112207e-02   -8.115072101171841e-02; +2.500675031478122e-01   +4.715993865062157e-01   +3.076504393918559e-02   -3.176930859879155e-01   +2.424433974975539e-01   -2.069996685492417e-01   +6.325054951891750e-02   -2.523604081265739e-01; -2.899914337344400e-01   -4.486070781086701e-02   +1.805242267219818e-01   +1.029003766883437e-01   +1.436780395036874e-01   +2.102350328946355e-01   +9.129768888447487e-02   -4.723347942571959e-01; +1.037606061752059e-01   -3.154516637404485e-01   -6.775480457649700e-02   -2.777136178633559e-02   +2.178835472524954e-01   -2.610318833019660e-01   -2.254130536299244e-01   +2.955298968217898e-01];
L3E_L2E_iAMPA_netcon = [+1.228205140457997e-01   +2.549716277707704e-01   -1.179677024674816e-01   -2.542797008414037e-01   +4.802379894023426e-01   +5.780778117212207e-02   +8.514884260972075e-02   -4.673579267739944e-02   -1.076838641658863e-01   +2.470194672518122e-01   -2.536003837158494e-01   +8.019977088637065e-02; +1.660735529531205e-01   +2.342724724182196e-01   -1.306400934864607e-01   -4.143951483334503e-02   -2.444849924756549e-01   -3.868219250802275e-01   -2.342603933793471e-02   -5.362904020982027e-01   +1.319914138078434e-01   +1.295253952458834e-01   -1.086461230981299e-01   -1.353757322150106e-01; -6.649426910839137e-02   +5.774392115445804e-01   -2.025884534087427e-01   -9.707119571460253e-02   -1.200947764384284e-01   -1.410742291245266e-01   -1.023360630337889e-01   -1.556751527704711e-01   -3.448846167909465e-01   -2.380445549215834e-01   +1.732685359365680e-01   -6.956253730619172e-03; -1.555504020244797e-02   +2.240075095588175e-01   +1.664517095599562e-01   -2.720353317028136e-01   +8.506775550668357e-02   +2.526522502151221e-02   +2.623476122782658e-01   -1.284022130201434e-01   -2.281860312424313e-01   +1.826729827463884e-01   -1.296835025748422e-01   -1.717522122878654e-01; -3.215012030368294e-01   -8.990208749252940e-02   +1.382046262012770e-01   +5.915204870183036e-02   +1.992525077439639e-01   +1.072480259974130e-01   +9.913843703385219e-02   -3.209021332509290e-02   -9.714528451894264e-02   +7.145881976981242e-02   -4.346884645678174e-01   +1.863469383827160e-01; -9.780604163110071e-02   -1.158450029869337e-01   +1.347009793096164e-01   +2.894052141193026e-01   -7.714623634290627e-02   +1.714974897279468e-01   -2.006493306044297e-01   -2.176850737011405e-01   +6.767805649062390e-02   -2.641743406654557e-01   +1.175506620724455e-01   -2.227096532583475e-01; +1.257097726960484e-01   -2.590610820800972e-01   +2.456942961414503e-01   +1.377489100558228e-01   +1.218855142809433e-01   -1.120094891577630e-02   -2.540345780240524e-01   -5.091210535157600e-02   +1.069105654878512e-01   +3.006831116783821e-01   -2.563964387476582e-01   +7.296223357017440e-02; -3.663453046481718e-01   -2.565505194067423e-01   +4.458931359803153e-02   -3.797293941867218e-01   +1.991675694455585e-01   -3.180603679418033e-02   +2.293390395892723e-01   +3.513075118034367e-02   -3.646531194571899e-01   -1.766699044578654e-01   +6.333623667326660e-02   +1.077246996841535e-01];
L3I_L2I_iGABA_netcon = [+1.339307324820334e-01   +3.735799873948343e-01   +1.767237066185430e-01   +1.303745767879975e-01   -3.014258222051291e-01   +1.190599077371094e-01   +2.095807583745347e-01   -3.121770264854635e-01   -1.164071564071941e-01   +1.630411945252867e-01   -3.731781104595265e-01   -1.426674623486096e-01; -2.462837283594285e-01   -1.550271819466519e-01   -2.288929379704951e-01   -1.241762580564336e-01   -4.393718448442819e-01   +7.006067548705533e-02   +3.113503804066690e-01   -1.279977160187305e-01   -3.027950810854723e-01   -4.522569728396238e-02   -3.073327197818024e-01   +4.940285916721693e-02; -3.121893336936358e-01   -2.056262045365984e-01   -1.854907231821321e-01   -7.396528254490747e-02   -5.169307806241782e-02   -2.448025439973123e-01   -5.006340440949538e-01   -1.042395831142279e-01   -9.549203641438908e-02   +1.074998715041356e-01   +6.821221632350365e-03   -1.996891484027316e-01; +9.261762208804390e-02   +5.359748620604166e-02   -3.091735482591527e-01   +4.692159910252143e-01   +6.590931551244961e-04   -1.211150534565750e-01   +7.560478285213332e-02   +1.326340187084994e-01   -1.802832906490648e-01   -5.343763119614446e-01   -4.528607974180383e-01   +4.870623812728883e-02; -4.049727667002518e-01   +3.058164880180427e-01   -2.489579167961278e-02   +2.541875642700125e-01   -1.995179586614793e-01   +8.995182300356058e-02   -4.189024343508638e-02   -1.943777985549149e-01   -1.973004733284532e-01   +2.337198037064279e-01   -2.778460922723494e-01   -2.084863960585132e-04; -1.859049593798385e-01   +3.987037926534504e-01   +1.068708806031151e-01   +2.438578183379612e-01   -7.384908145328657e-02   +1.413121717533499e-01   +1.384527172897087e-01   +2.495709254763388e-01   -7.089650895438686e-02   -2.623873533897180e-01   -1.831171482907803e-01   -1.566084740240172e-01; +1.333226227007680e-01   -5.593515246693634e-02   -1.725941372003225e-01   -4.224920355725095e-01   -7.046300347734170e-02   -8.178794707004589e-02   +1.493145995418669e-01   -3.894138941428232e-02   -3.949404198051207e-01   +1.916984003816491e-01   +2.665205661561002e-01   -1.435410379985008e-02; -3.045550347776401e-01   +3.015059721137573e-01   -2.254424124567725e-02   -3.026225400649078e-01   -1.697737674411159e-01   -1.418915188034404e-01   -4.372235407102372e-01   -2.284474718028508e-01   -1.812027998252677e-01   +3.731409558705392e-01   -2.544621623370242e-01   -4.615136136179147e-01];
L2E_L3E_iAMPA_netcon = [-2.803905907129988e-01   -2.487688705746102e-01   -7.108749942959082e-02   +4.136172679371408e-01   -3.522804438175930e-01   -1.303135706328734e-01   -1.230316816191463e-01   -2.628313377123312e-02; -1.076224693985601e-01   -2.451665062135873e-01   +2.161821746879741e-01   +2.187534388547661e-01   -2.530915032469963e-02   -8.763162265581916e-02   -2.443757303830106e-01   -2.280914166442477e-01; +2.911852816104816e-01   +3.394373057188593e-02   -2.512959562465870e-01   +3.142545438420213e-01   +2.224364476908740e-01   -4.962419155435688e-02   -4.685976432318474e-01   +6.820291306283560e-04; +4.132647676879769e-01   +1.389108236391072e-01   -1.159594517486781e-01   -7.329977502194988e-02   -2.434494492399920e-01   -5.312766365480090e-02   +4.648727515688553e-02   -5.933586595580609e-02; -3.934513700271985e-02   -1.797718080329886e-01   -5.942171131504607e-02   +1.377843558508292e-01   +2.373607695301952e-01   -3.499883235892663e-01   +1.386930635328728e-01   -3.371467594903113e-01; +6.748393916227571e-03   -7.976908552466919e-02   -1.104805421567157e-01   +4.989556086463637e-02   +4.814338127428860e-02   -1.038828179828272e-02   -4.003010898488024e-01   +9.593461578951487e-02; -1.903538079003481e-02   -2.701855896118116e-01   +1.336280101166745e-01   -3.818558450759806e-01   +2.270805512461848e-01   +2.213386791927531e-01   +1.275982587993199e-01   +2.552867672885309e-02; -3.440109060685851e-01   +2.272206729995362e-01   +1.046062815341322e-01   -2.079064287271137e-02   -6.010617745765254e-01   +2.235537815593041e-01   -2.166013109201542e-01   -1.391431974061291e-01; -6.361470045743488e-02   -1.721454327336049e-01   +2.749073297421785e-01   +9.258485751424345e-02   -2.121325442479646e-02   -3.596824691818090e-01   -2.421924292639182e-01   +1.991390133490552e-01; +5.085498209165887e-01   -1.380814859183885e-02   +2.040666585436901e-01   -3.016414649277105e-01   -3.034738522072457e-01   +1.481146758192025e-01   +2.833663207998947e-01   +7.876081841747049e-02; -2.649867266890349e-01   +2.101314291147406e-01   +2.020015029225147e-01   +4.126055052708011e-02   +1.114465649710388e-01   -1.371974157065138e-01   -3.260965957063878e-01   +2.973713331611475e-01; +1.874695028843451e-02   -3.891285379141308e-01   +1.164291590326827e-03   -1.938021504114065e-01   +7.452008213124769e-02   +7.719295054114488e-02   -3.671221678412167e-01   +1.882421319249020e-01];
L2I_L3I_iGABA_netcon = [-7.827153388334926e-02   +7.180017839744106e-02   -7.548281653497074e-02   -1.690366469317831e-02   +1.652916865418361e-01   +2.806666496439165e-01   +1.882024494343064e-01   -1.742336843450880e-02; -2.019484822128265e-02   -1.754590863742519e-02   +8.679084093858153e-02   +2.453149201977110e-01   -1.709861612232482e-01   +1.046261435379396e-01   +1.553074306403053e-01   -1.735258657136289e-01; -2.113915063807825e-01   -5.639949270709813e-02   -6.419541925586802e-03   -1.343541805856160e-01   -6.755700253584675e-02   +7.545041340506251e-03   +3.837243625482942e-02   -8.783405718506859e-02; -1.199696107631252e-01   -3.803091541199373e-01   -1.538561695081525e-01   -4.123220102234343e-03   +1.954998648381800e-01   +2.619945376272683e-01   +5.005222682199059e-01   +2.348548248554228e-02; -2.333403601558635e-01   +4.907926592517753e-01   +2.779210036954852e-01   +2.153124902451767e-01   +3.090722637002599e-01   -7.008337446717929e-02   +2.418737287827888e-01   +8.242828056839530e-02; +3.275718127052202e-01   -7.287416981539006e-02   +5.954863173034566e-01   -3.775425501168437e-01   -4.383100535259118e-01   -1.141676305879630e-01   +2.050553256492579e-01   +4.278536909353301e-01; -1.434757527207715e-01   +3.252922491326693e-02   +2.328059445004038e-01   -2.347551236289812e-01   -3.961649124950193e-01   -1.856669564134101e-01   -5.782328590713477e-02   -3.930290728587726e-01; +5.698022060566485e-02   -1.036121259174012e-01   +2.685256482569975e-01   -8.520271428732895e-02   +2.947610514450323e-01   -2.676057601587886e-01   +4.187543595899191e-01   +9.044410882894090e-03; -1.870440846421314e-01   +2.141589955462620e-01   -8.219136551576198e-02   -5.551431154301883e-02   -1.170729976688135e-01   +1.930764712969146e-01   +1.673356679277613e-01   -3.047073968884986e-01; +8.455966610726320e-02   +2.113149633484236e-01   -9.457163614482798e-02   +2.409817453460532e-01   -2.381638573680794e-01   -5.406740754695244e-02   -1.801070920853619e-01   -2.905183248849211e-01; +2.826264739142049e-01   -4.729569529122805e-01   -9.693447886509735e-03   -1.164677841959863e-01   -1.565967736587215e-02   -3.807674995006287e-01   -3.035160104888658e-01   +3.936195456524114e-02; -2.242451900442539e-01   +3.548641974027150e-01   +1.465119178960247e-01   +5.129584531966717e-02   -6.997300484175994e-02   -2.153932435930213e-01   +2.402481129098403e-01   -1.745490884349643e-01];
L3I_L3E_iAMPA_netcon = [-2.283802224254288e-01   -2.746343676763320e-01   +6.450235892976466e-02   -1.200511818367812e-01   -1.123684568936183e-01   -2.185787925859950e-01   -1.351889820945959e-02   -9.862197807205764e-03   -7.954150397988587e-02   +8.560374103531576e-02   -3.133866897280257e-01   +2.661819652685223e-01; +1.993598505898278e-01   +2.411307409664889e-01   -2.853503566786518e-01   +2.721937320606249e-01   +3.798257079510262e-02   -1.780847382760928e-01   +1.334123719308358e-01   +7.292739433886436e-02   +1.273628192605691e-01   -1.352777622009295e-02   -1.593720678423714e-01   +4.721131044143279e-02; -2.608277437823758e-01   +4.277488227077894e-01   +7.319157057212711e-02   -5.921146082148801e-02   +6.213522723977964e-02   +6.596173928822205e-02   -7.855497534325562e-02   -8.486997174459240e-02   -1.589108966166503e-01   -1.759818919910955e-01   -2.726854119547568e-01   +1.500636419381608e-01; +1.787080668004194e-02   +2.863685583912443e-02   -3.212425735162093e-01   +2.538614405627772e-01   +2.135667723644839e-01   -5.969890679158926e-02   +2.102573788181806e-01   -1.201114719547371e-01   -4.553067898136732e-01   -1.199898015808226e-01   -2.386294492069768e-01   +2.739962605781709e-02; -4.795869175821844e-02   -2.188210469461899e-01   -4.183776628291411e-02   +1.450288300730283e-01   +2.217091115042380e-02   -1.110745041332881e-01   -1.377127815773095e-01   -1.384102794781124e-01   +2.041612481945567e-01   +8.082848278353214e-02   -5.753709980556576e-04   -2.947473673314592e-01; -6.646301535013943e-02   -5.202036269061438e-02   +2.392642147561993e-01   -3.884020015790390e-01   +8.534554582182505e-02   -2.326908678950574e-01   -8.044333528823788e-02   +9.598003953703363e-02   -1.991601957566353e-01   +2.884331987143612e-01   +4.502260135512742e-02   +1.620231786595179e-01; +1.086782467904132e-01   +1.900700276347623e-01   -4.486614363703362e-01   +2.572166744616911e-01   -3.064656789904642e-01   -2.594853976793178e-02   -3.122633537655373e-02   +3.647449068423866e-02   +1.750509540574954e-01   -1.653918608479937e-01   +2.062572428186771e-02   +2.806873184900917e-01; -1.966761796889681e-01   -2.681894105125370e-01   +1.284513352552727e-01   +3.364686880568345e-01   -1.678720513340085e-01   +9.524659262713223e-02   +1.033183625350632e-01   +3.249111038713124e-01   -2.394279705827678e-02   -4.894206562275030e-03   +1.447493212642822e-01   -1.554887708525148e-01; +4.479430565926811e-01   +2.311670867191776e-01   +6.884593716597590e-02   -1.668549034134912e-02   +3.481651327950382e-01   -3.458337937602134e-01   +2.502036640160607e-02   -5.352375704419536e-03   -1.787573268461538e-02   -3.016673107309589e-01   -3.589671150305941e-01   -4.826083555970616e-02; +1.902107537471895e-01   -2.384530328516195e-01   -2.797629822424518e-01   -2.808626958411937e-01   -2.562028537414462e-02   -2.100718309017574e-01   -2.504751628164709e-01   +7.399597409386416e-02   -5.892914419499261e-02   -1.768196283457487e-01   -1.297853076821500e-01   -3.980297030489177e-02; +1.756019122601976e-01   +1.853897166721549e-01   -5.851660739249756e-02   -3.301752105798502e-01   +2.062947307258875e-02   -7.493934137085848e-02   +9.796834212939609e-02   +4.617870025055956e-02   -3.215562231708585e-01   +2.174810207959619e-02   -1.334264646933161e-02   +1.124294249281149e-01; -9.980577967630910e-02   -2.152296108975511e-01   +1.675314558852296e-01   -2.119303496040160e-01   -1.826903183219460e-01   +1.584153688826938e-01   -3.661049916553927e-01   -5.420610944658341e-02   +1.827451473471991e-01   +4.774524801597402e-02   -3.531676697297811e-01   -1.901714178130490e-01];
L3E_L3I_iGABA_netcon = [+3.510773071975198e-01   -5.394592294665429e-02   +2.358540517466702e-01   +3.478928867877518e-02   +1.012749734228004e-01   -1.531436540530857e-01   +2.117409074594211e-01   +5.103326003702954e-02   -1.749240042139014e-01   +2.116772524767466e-02   +3.128541377235858e-01   +3.331068660116440e-01; -2.506891089637909e-01   +1.168336592184523e-01   +2.367972324743656e-01   +1.104712722050734e-01   -1.093785720036202e-01   +3.182955348075195e-01   +1.267266133716970e-01   -3.534416704270735e-02   +2.103561627734827e-01   +4.462996470818947e-02   -1.003881109366597e-01   -3.654560099770888e-01; +6.427389038546798e-02   -9.814722603610904e-02   -5.753760578976176e-02   -3.939980965552514e-02   +3.950625003334362e-01   -4.427056287171181e-03   +4.940480456535690e-02   +5.507441193530627e-02   -2.391714930525160e-01   +2.293070936714771e-01   +1.784228072636594e-01   -3.034674577119021e-01; +9.904213037972401e-02   +3.819206270845099e-02   +3.063848803557856e-01   +1.459049085994935e-01   +1.373784869306047e-01   +2.798008312345975e-02   -1.282597162243329e-02   -8.757422232257425e-02   -5.316173592014870e-01   +1.833665310342808e-01   -5.314020494548150e-02   -1.601767085485773e-01; -3.732565379941326e-01   -1.984179201387078e-01   +3.857756854612818e-01   -1.885947839781031e-01   +1.129165070520490e-01   -2.951530855057992e-01   -2.407789639669640e-01   +3.031910816956308e-01   +1.330075716459038e-01   -1.494706866807534e-01   +8.930257751062977e-02   +1.025725778779388e-01; +5.311181468683425e-02   +2.647974279708874e-02   +2.775310445817950e-01   +8.725321742865695e-03   -1.031812064752650e-01   +9.234307405644870e-02   -1.611962438895933e-01   -1.112093207220625e-01   +2.570017751917437e-01   +1.448687162677838e-01   -3.467488646414382e-01   +3.123697310833149e-01; +1.723578253440685e-01   +2.256702563641339e-02   +1.302140989478233e-02   +3.800449145298448e-01   +1.815277890588097e-01   +4.295128954167970e-02   -1.057330751097489e-01   +2.763569827950308e-02   +1.013503042051188e-01   +5.729765918168954e-02   -1.092274394839537e-02   +1.274269121028734e-01; -2.631117858915137e-01   -2.402985966632207e-01   +1.442994244049213e-02   -1.270032595914694e-02   +1.405189725949400e-01   -3.238003195589116e-01   -1.538432783709416e-01   +2.292627730094238e-01   -1.677516761058775e-01   +5.880031071801944e-02   +3.215237582548627e-02   +3.992798748395356e-01; -2.301423963808831e-01   +5.316641567842018e-02   -2.134158327546800e-01   +2.875966928663920e-01   +1.808725765305765e-01   -1.939593391990174e-01   +2.288376678454679e-02   -5.647996943676244e-02   +1.038989581597648e-01   +4.878035696408928e-01   -1.102610334363875e-02   -3.395913714223305e-01; +1.970139538175395e-01   -2.116308233384807e-01   +1.747887975401790e-01   -3.538642388763648e-02   -1.375325895430686e-01   -3.001002495244339e-02   -2.238386739932229e-01   -3.012866041093741e-01   +3.400738172946897e-01   +2.913595855009656e-01   +1.889175173450669e-01   +2.615151638995364e-01; +4.176000905851285e-02   +2.775815124165796e-01   -1.629015029202390e-01   -3.034639213794135e-02   +3.332014332341201e-01   +4.418545341368552e-02   +3.135824121577453e-01   +2.829844251388870e-01   -2.435185126630215e-01   -2.457509936238795e-01   -1.333541110270103e-01   -9.074414111326191e-02; -3.295860697196628e-02   -2.811295501259777e-01   -1.629990348027308e-01   -1.799117460731627e-01   -3.829731892333352e-01   +1.997470701451549e-01   +7.925659571789034e-02   -2.699885639952694e-01   -3.601889935104378e-01   -1.215454762389263e-01   +1.978446804442378e-02   -6.025318573918134e-02];
L2E_Input1_iAMPA_netcon = [-3.678068590222193e-01   +1.328972395173673e-01   -2.445388474509272e-01   -2.842216450037161e-01   -1.294022869870771e-02   -1.738141374377759e-01   -2.969384622429455e-01   +5.056971333262528e-01];
L2I_Input2_iAMPA_netcon = [-3.096538435087631e-01   -3.277446062503639e-01   -5.069419547894777e-02   -6.318881790257855e-02   +2.731651171999276e-01   +2.591820519375334e-02   +1.638205178672205e-01   -5.612216774572365e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
