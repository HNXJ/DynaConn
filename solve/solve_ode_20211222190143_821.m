function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.386100132838144e-01   +4.167220425089391e-01   +3.188667068091545e-01   +3.590384295507354e-01   +6.016567081040652e-01   +3.852077814791949e-01   +1.711705407150277e-01   -2.278343011120420e-01   +3.242555465224421e-01   -7.536878279109274e-02   +6.484379818857009e-01   +1.957710472235319e-01   +2.433349692613803e-01   +2.279056960047549e-01   -7.659756261251693e-02   -1.716343107149495e-01; +8.925094748814349e-01   +4.211296198864052e-01   -1.084101259832883e-01   +3.147773148703080e-01   +4.782023386270424e-01   -6.282632892392864e-02   +1.301651081484320e-02   -4.970604375681360e-01   -5.744348236890231e-01   +4.049904728907991e-02   -1.998860558191284e-01   -5.112530266692757e-02   -4.516546250358271e-02   +2.118020587301610e-01   +1.291128880031130e-01   +3.072386362999837e-01; +1.908599207403555e-01   -4.912569736453627e-01   +1.982827621760671e-01   -2.076122746076152e-01   +2.621017812798072e-01   -4.762907050192619e-02   +3.794277464195198e-01   +2.166454813131203e-01   -3.078487712333886e-01   -3.783315455833094e-01   -2.342973633590852e-01   -4.095035563692524e-01   +3.104892408443981e-02   -1.550084048516155e-01   +5.171098935814629e-01   -3.378399309595684e-01; +3.152249509896787e-04   -3.213166428647710e-02   +3.612428503792585e-01   +3.471973910843882e-01   +1.026814392659459e-02   -1.956213212087992e-01   +6.551931982580177e-01   -4.956512824906373e-01   +7.818593349051184e-01   +4.472382394533469e-01   +5.451998390153634e-02   -2.002870210807666e-01   +1.389034313596608e-01   -1.779473524523245e-01   -2.667432984342856e-01   +5.503272458641287e-01; +3.040187500622375e-01   +9.423426381531767e-02   +8.110623070663352e-02   +4.714942031371585e-01   +4.901635982325944e-01   -3.345673639066391e-02   +9.081776764521318e-02   +2.918792518344194e-01   +2.454988179250553e-01   +2.163200209393044e-01   +4.141258164480660e-02   -1.673907828125684e-01   +3.376858470508456e-01   +2.988349533939479e-01   +3.465697821356988e-01   -1.047026724406558e-01; +3.558287186028472e-01   +4.501287818097247e-02   -1.402299111229087e-01   -6.299703028639811e-02   -1.799889798720881e-01   +9.574851110930394e-02   -3.923036733206368e-02   -2.146896317026468e-01   +5.327751211964961e-01   +5.428891320702857e-01   +2.070906972866645e-01   +9.556305846126317e-02   +3.614914849565710e-02   -5.646923843474117e-02   +3.294611443183874e-01   -8.924970576944963e-02; +3.874241798938928e-01   +3.685471440887450e-01   +7.587687345107155e-02   -1.498371012941705e-01   -1.305568206979461e-02   -6.319859578717715e-02   -2.839951986106224e-01   +8.118871904267788e-01   -1.076852561089789e-01   -1.083846785327740e-01   +2.925266801249710e-01   +9.927299782657843e-02   -1.644133918947534e-01   +6.986049281420212e-01   +6.035941575231131e-01   +2.790115097206869e-01; +1.582348114657063e-01   +2.104736704657953e-01   +8.451441218771141e-02   +1.675990002900471e-01   +2.540374711909962e-01   -3.435815085551731e-02   +4.256693833022208e-01   -2.073089243815228e-01   -1.148784062053397e-01   -8.499680654775298e-02   +4.637341607516232e-01   -4.701171765873796e-02   -5.109008884933004e-01   +3.335229366166624e-01   +5.000350538203254e-01   +8.393174308870047e-02; -5.958492257647612e-02   -3.697149265476057e-01   -2.687936781271481e-01   -5.796195498981171e-02   +7.255418294604608e-02   +6.672210359684444e-02   +1.867561433171718e-01   +3.813356292816816e-03   -1.124491736801489e-01   +3.047759097460085e-01   -1.003798473810580e-01   +9.628293234904431e-02   +6.720405578062482e-01   +3.382034871292261e-02   -2.226836428729823e-01   +2.535085665956155e-01; +1.538424947778081e-01   +2.335035054946815e-01   +1.884201503182799e-01   +6.727407766759782e-01   -7.049311740688116e-02   +4.823002153885369e-01   -1.122787499739317e-02   +7.304949321598898e-02   +4.943783364795133e-02   -2.663969425582186e-01   +1.318563372028155e-01   -1.587613761279114e-01   +4.301769530066627e-01   +3.246199455684282e-01   +1.998565388745668e-02   +5.087340480601846e-01; +6.466863288776246e-01   -5.089222976567496e-01   +2.015726566527975e-01   +9.666633825843853e-02   +2.185232048754059e-01   -3.174548582261646e-02   +6.757786006845493e-02   +4.327213190398843e-02   -1.719122655985739e-02   +7.056886196951424e-01   +3.849683732387403e-01   +6.718566539159921e-01   +2.556969522770312e-01   -5.423146014155517e-01   -2.543714440201659e-01   -1.626883769234763e-02; +1.460026012507564e-01   +3.675884809129117e-01   +1.161337126226771e-01   +5.127341155258459e-01   -1.684278822211184e-01   +8.384927512699586e-02   -1.419808091244356e-01   +4.806032438789191e-02   +4.256701431280324e-02   +2.238814532348221e-01   +5.189535550491999e-01   +2.016602396630920e-01   +5.606324611198604e-01   -3.214012894099269e-01   +3.307690679120279e-01   +3.142634826161032e-01; +5.641747563122361e-01   +2.957058336887793e-01   +5.225839021719185e-01   -1.489080091991233e-01   -1.747505283238808e-01   +4.078107280640599e-01   +1.817270853761161e-01   +4.659973147761332e-01   +2.497998262724178e-01   -4.372946195619964e-01   +3.904134358123773e-01   +2.431971007120976e-01   +4.251194793558514e-01   -1.521146274006137e-01   +2.285692916252691e-01   -1.246393141366406e-01; +5.428433994950773e-01   -8.391050196883673e-02   +5.860107152096111e-02   +9.770025103909297e-02   -3.403738407016310e-01   +2.340800798286233e-01   +3.647982692341213e-01   +3.137707963270436e-01   -8.062217399488663e-01   +4.672530610374777e-01   +5.989550242853798e-01   +5.312140096791348e-02   +1.865464474141631e-01   +1.343660444103292e-01   +9.055150988422035e-02   -6.706276029420354e-02; +5.950063166059791e-01   -3.872309684031334e-01   +1.511742510119633e-01   +4.997287258708774e-01   -2.747323974864281e-01   +1.985234459244437e-01   -5.281730850979603e-01   -1.984317528245684e-01   -1.973150493386603e-01   -1.375394197121097e-01   +1.850551946734772e-01   +2.918027245728505e-01   -2.241760662697559e-01   +5.512033930780560e-01   +2.183402205833311e-01   -5.144137115567257e-01; -1.843709268650401e-01   +3.876274440245590e-01   +1.140096786124533e-01   +4.049416407633233e-01   +3.180198348331859e-01   +5.997481970990801e-01   +2.692359320792777e-01   +2.544377384254053e-01   +1.387430160079470e-01   +2.571727953035272e-01   +3.109019817242271e-01   +3.074002423850996e-01   -1.148274473875888e-01   +2.622553299335000e-01   +2.887283740145252e-01   +4.572236745704036e-01];
L1E_L1I_iGABA_netcon = [+8.705949458343487e-01   +4.297135041935625e-01   +4.965517009244252e-02   +2.096347320465672e-01   -2.280234204046278e-02   +7.778001410129454e-01   +5.457247299091624e-01   +3.693151550504400e-01   +3.682136908774301e-01   -2.161166734526275e-01   +4.582914772489363e-01   +1.930416393905207e-02   -4.598251499817806e-02   +4.003767115144207e-01   -1.804874652344832e-01   +4.424947397564297e-01; +1.892072584049229e-01   +2.690951810471603e-02   +2.666554615719945e-01   +2.017734645767461e-02   +1.681971781977813e-01   +4.941753851212357e-01   +3.538589633043879e-01   -3.501279722976854e-01   -2.712354444627852e-01   -4.209001678916729e-02   -1.302786807963802e-02   +5.323855298522664e-01   +2.641926281238930e-01   -4.768857765914145e-01   -3.100695048853369e-01   -2.592458603424027e-01; +5.154171565203399e-01   +4.636088663848580e-01   +3.360102185884430e-01   +4.222047509970776e-01   -1.416684547609210e-01   +5.507070454997476e-01   -1.044338587893529e-01   +4.832769995574420e-01   +3.102161989756260e-01   +3.914693694041449e-01   +3.503526696655693e-01   -2.936519864684720e-02   +5.637172091285481e-01   +7.123911922222110e-01   -1.813668141711782e-01   +5.938915064609700e-01; -9.076972098790931e-02   +5.979615715734647e-01   +7.519878715250458e-01   +1.649534413728887e-02   +8.160404118260516e-01   +1.419627346665102e-01   -2.493006542888239e-01   +3.985242814577021e-01   +6.319502448284650e-02   -1.880356927014362e-01   +6.908297655603496e-03   +1.951561560539138e-01   -1.553524339140417e-01   +1.352957289791868e-01   +1.464760358920523e-01   +4.818757118831177e-01; +2.979698740503571e-01   -2.631969720006753e-01   -5.134864402251698e-01   +2.369784563576547e-01   +1.518102305821484e-01   -1.564519515169819e-01   +2.409416989173255e-01   -2.007022871639952e-01   +2.410501562361231e-01   -8.826767975872835e-02   -3.640037175562905e-02   -1.540519845192890e-01   -5.798445447720865e-01   -2.003499347191586e-02   +2.531489709610053e-01   -8.008307956477295e-01; -1.817821066297489e-01   +8.853152659520663e-03   +3.001436604180677e-02   +4.494413626287113e-01   +3.603961895378738e-02   -2.434596687614132e-01   +4.124834394616299e-01   -2.160151657491136e-01   +1.981274315143830e-01   -1.186420758450656e-01   -1.753194266859527e-01   +4.465835860356056e-01   +1.149940020680990e-01   +9.093013213859868e-02   -1.901946354314408e-01   -4.187697580687567e-01; -1.337834256798934e-01   +1.321498346142127e-01   +2.246247393452347e-01   +6.102358904677737e-01   +5.393823388301058e-01   -7.499647339624407e-02   +1.798149811059225e-01   -1.250089811708026e-01   -5.112879786244698e-01   -7.994648026529066e-02   +1.133995734147372e-01   +1.564370105923967e-01   -3.813153291094238e-01   +7.270966771535460e-01   +2.592150036850300e-01   +3.679214349125022e-01; -1.311778121710624e-01   +6.179797683716894e-01   -3.741401285088941e-02   -4.885770458309873e-01   -1.352751926747758e-02   +4.312702664585705e-02   -2.094248061291654e-01   -1.577465515985108e-01   -1.467119885107545e-02   +1.899514280372770e-01   +2.655998247179387e-01   +2.215786161416426e-01   -2.461267944612739e-01   -7.524417592439339e-02   +1.672796313932747e-01   -3.512678462824863e-01; +3.580764372429106e-01   -2.792711955164899e-01   +7.772130278854652e-01   +5.034392485070738e-02   -5.992769212285094e-02   +4.364811542625578e-02   +4.638577246401848e-01   +4.487130706047752e-01   +2.077137831976425e-02   -2.967119454042246e-01   -2.662008603457521e-01   +1.733284802647601e-01   +6.967789990761348e-01   -3.329318139289389e-01   +5.563543789921543e-01   +5.041406862001265e-01; +3.603737577160421e-01   +3.758471286257999e-01   +1.170767601257423e-01   +6.821943708064174e-02   -1.417113475364468e-01   +5.161011654998044e-01   -1.987474698728667e-01   +5.531621311575001e-02   +1.123131808464404e-01   -1.893634098981901e-01   -1.158999848008787e-01   +6.409968853779929e-01   -1.133171681531126e-01   -6.348955745556931e-02   -1.089548166211593e-01   +1.602634170181375e-01; -4.327564637020391e-01   -1.699098544174940e-02   +1.973695369540469e-01   -2.111436752001435e-01   +3.385304286149141e-01   -3.190552138177742e-01   -2.280040759302804e-01   +3.341437874359837e-01   -1.489335796164223e-01   -2.582740934339989e-02   -1.370186921294070e-01   +7.415610524451280e-02   +3.406324516194853e-01   +1.649966022134726e-01   +1.441222914366803e-01   +8.726189529981956e-02; -3.037399234457490e-01   -2.180345247605228e-01   -1.881553132470937e-01   +1.206670652553520e-01   +1.531587512595492e-02   -9.162572181785410e-02   +1.202113690608524e-01   +1.615576314374973e-01   -6.471410998288145e-01   +1.111599232745528e-01   -4.409106643804151e-01   +4.174536255539760e-01   +5.516910867706204e-01   -2.199443385289165e-01   -5.493608176590431e-01   -3.065598512083759e-01; -4.645541015886087e-01   +4.839097439026613e-01   -2.177181911512635e-01   +2.006444662938371e-01   +1.971784147884477e-01   +8.103255887277681e-01   +1.647925398556925e-01   +4.645192645035133e-01   -1.245851915507710e-01   -5.971357017196272e-02   -2.976595578765741e-01   -1.629292216555484e-02   +6.298573676503150e-01   +5.342768987892460e-01   -3.586025439109399e-01   +3.448852679287144e-01; +4.004083439918986e-01   +7.531311756665565e-02   -5.561391708303844e-01   -3.802204903869409e-02   +5.841416086790259e-01   +2.534034448637673e-01   +7.255950475848195e-01   -1.297020356529662e-01   +5.074634415196450e-01   +5.341859909571689e-02   +1.046219890810749e-01   +4.232360477833105e-01   +2.472771018472931e-01   -8.087520587267669e-02   +4.307697824424310e-01   +8.816630394848146e-02; +3.174652613179029e-01   +2.372010171384483e-01   +3.315065479545413e-01   +3.532919025036361e-01   +8.541680031694365e-01   +1.736754553604025e-02   -4.224870155651356e-01   +2.056516400986185e-01   +9.763122477634455e-01   +7.624496415859719e-02   +3.590684044046334e-01   -2.916803568604407e-01   +3.303663590128019e-01   -2.533591666383880e-01   +3.416375642164551e-01   -1.101784390506313e-01; +2.963596084868330e-01   -9.412491157135125e-02   -1.289807774307940e-01   +3.764276566249440e-01   +1.484681169603853e-01   -1.802289523328939e-01   +2.313251584960578e-01   -2.935294720921624e-01   +1.676970432759487e-01   +8.141220089556847e-01   -1.167361257667794e-01   +9.638928914155553e-01   +4.983897403023652e-01   +8.542144638496169e-02   -3.993284879068592e-01   +4.146350759835039e-01];
L2I_L1I_iGABA_netcon = [+2.583884288257674e-01   +2.775241083555464e-02   +5.081621138313562e-01   +3.485675484175328e-01   +3.549653810562817e-01   -3.868575718606389e-01   +5.804516386629306e-01   +4.958650618988618e-01; +3.781956437318915e-01   -2.403479806287400e-01   +5.441954919487556e-01   +1.646581697590540e-02   +2.350303403318146e-01   -1.539148391685546e-01   -2.160360645817466e-01   +4.982146099810746e-02; +3.821299507468941e-01   -1.996217373183913e-01   -3.718631445876757e-01   -1.352230070600128e-01   -2.554455762919751e-01   +1.834352045886430e-01   -3.147491984472525e-01   +2.549514749175687e-01; +4.121813581317674e-01   +4.778596234239011e-01   +1.782798330714186e-01   +2.461189576414064e-01   +1.845302415979815e-01   +3.662615807097567e-01   +4.211810326241213e-01   +7.394833385502377e-01; -6.990335610086906e-02   +2.321724884069109e-01   -9.379064428237747e-02   -4.651995039266235e-01   +5.721573084955254e-01   -3.889725727799793e-01   +3.488588547622126e-02   +2.435142385121832e-01; -3.294141941300428e-01   +2.188250198656644e-01   +3.266781126617420e-01   -3.530951677209402e-01   +7.350897482579041e-01   +1.000000000000000e+00   -1.316535868861337e-01   +7.856829225144324e-01; +2.777755095777559e-02   -2.880827956840482e-01   +2.705761337898672e-01   +2.664453924284778e-01   +2.769698219815981e-01   +1.853147746642965e-01   +4.025370566138590e-01   -3.004481707336931e-01; -5.695724448313328e-02   +1.960815207591090e-02   +3.396602680964909e-01   +5.224952668423137e-01   +3.111684962927594e-01   +3.325514536903060e-02   +4.876457900032896e-01   -5.275742115983439e-01; -2.143304814322848e-01   +3.688889006809429e-02   +5.979936408714123e-01   -1.973558464087173e-01   -1.246191837446573e-01   -5.081490535661648e-01   +2.263684198632785e-01   -2.780051028343447e-01; -2.079473997208489e-01   -2.813597636702395e-01   +4.141984622809816e-01   +2.900446529589145e-01   -2.147637336546871e-01   +3.654147716346198e-01   +2.447429391224895e-01   +6.953054012437877e-01; +2.132557150887717e-01   -5.896667622338886e-02   +4.627107395670568e-01   +4.147273807451697e-01   -3.857104953796427e-02   +3.782357608296190e-01   -2.202862265512279e-01   +7.694215555365395e-02; +2.647575721927198e-01   +9.427178182959747e-02   +1.747757700669931e-01   -5.712625650527060e-02   -2.227998602916008e-01   -5.171152015925218e-02   -3.673934383215839e-01   +2.734917290484708e-02; +1.958593843628628e-01   -2.314846527783356e-01   -6.813775369743090e-02   +2.285758448250652e-01   +7.585967572174336e-01   -2.633131515548414e-01   -2.214617250902854e-01   -3.366264961566539e-01; +3.129480422811804e-02   +7.853512469377001e-02   -1.073900387542580e-01   +1.619339893867366e-01   +9.000751714938371e-02   +3.887829547998367e-01   +1.473725048400629e-01   +4.672913362371278e-01; +4.771681704872889e-01   +1.619606751074720e-01   +8.692381698855745e-03   +2.307603817142844e-01   +8.316358988009778e-02   +5.077722314412263e-01   +6.627680240911605e-03   +3.491529533492938e-01; +3.389835914214599e-01   -2.473381765943252e-01   +3.501731575515959e-01   +3.040791483957226e-01   +2.666386318392811e-01   -2.123797799815295e-02   -2.423512780662830e-01   -1.465545223626483e-01];
L1I_L2I_iGABA_netcon = [+3.610510629376067e-01   -1.059065168762955e-01   +9.138890273010955e-02   +5.160697000908815e-01   -6.298662962945452e-02   +4.454429949260124e-01   +3.333264636136242e-01   -4.735406010027667e-01   +3.599835118154915e-02   -1.164385502045297e-01   +5.239578746717889e-01   +4.766523368836154e-01   +2.421771135329609e-01   +5.112823114562914e-01   +6.003047002259496e-01   -2.287249982167002e-01; -2.593071901742698e-01   +1.133678609795360e-01   +5.322226482416902e-01   +4.919766857640180e-01   +2.850699338333979e-01   +3.772029754980994e-01   +7.600788010609708e-01   +5.427422108873194e-02   +4.717137511593538e-01   +4.394189252796735e-01   +2.641942729978663e-01   -4.726060591053131e-02   +3.090502597711402e-01   -1.284851111324932e-01   +3.591425010702209e-01   -2.135150091020944e-01; +1.955901127735790e-02   +6.416150279898363e-01   +5.776494886573926e-01   -1.164188751445912e-01   +4.287838444019296e-01   +4.431763337016770e-01   -7.798517023393460e-03   +3.732606103941321e-01   +8.072190192474158e-01   +3.446048232543594e-01   -4.123714711757772e-01   +3.100337340076827e-01   +2.061865053545340e-02   -1.161218558627891e-01   +3.405139368403769e-01   +6.062160126995093e-02; +5.606420737608980e-02   +6.852233124122761e-02   -4.093827197170747e-01   -4.797490034376330e-01   -1.080879479229392e-01   -5.174648914096169e-02   -7.093647609791743e-03   -1.870374359112650e-01   +4.614415402365566e-01   +6.795604706675170e-01   +4.396198547099658e-01   +1.101734958412326e-01   +1.000000000000000e+00   -1.700900166360227e-02   +2.620621976813420e-02   +2.093750679050237e-01; -1.313489409381448e-01   +1.813147772764413e-01   +2.931648581814281e-02   +2.023762229195073e-01   +3.412729065484290e-01   +8.282159445063662e-01   -3.115119190952597e-01   -4.440108735006522e-03   +3.089084608140203e-01   +2.035147370266093e-01   -5.575103037573520e-01   +1.163781830774939e-02   +2.221434135949411e-01   +2.267057004550126e-01   +4.859345021866873e-01   -5.088070233436290e-01; -3.611393013760560e-01   +4.530123370672987e-02   +1.570992077622253e-01   +2.666697118619128e-01   +1.460526829254548e-01   -2.796173433106867e-01   +4.215166802370316e-01   +1.777986670140516e-01   -1.596963267381524e-02   -4.334702643354092e-01   +1.526810483340211e-01   -3.046689297659342e-01   -1.389111649657531e-01   -1.472392009790061e-01   -2.134327731320022e-01   +5.864591880326981e-01; +4.917994781218933e-01   +3.973431583595654e-01   -3.046922993357682e-01   -3.792795366996530e-01   -8.904576973688050e-02   +2.233445934916889e-01   -2.605792051503295e-01   +3.706889255337014e-01   +4.379361672796984e-01   +1.161545470006226e-01   +3.339801438628280e-01   +2.428384722254001e-01   +1.612387585267085e-01   -3.660604604271516e-01   +3.887448051381888e-01   -1.715939954122641e-01; -3.519084382261331e-01   -5.366073160859307e-02   -1.162373771820482e-01   -2.508438673489088e-01   +1.115304431156199e-01   -3.217947948246296e-01   +3.141234226524554e-03   +8.204722769063896e-01   -1.891202782956668e-01   +2.104696636413096e-01   +5.773476125725358e-01   +4.997292177522119e-01   +3.612285847144405e-02   +7.534361033435190e-01   +1.738700893600661e-01   +3.970653208346294e-01];
L2E_L1E_iAMPA_netcon = [+3.834125142122087e-01   +1.544719427021797e-01   +3.451957924634664e-01   +5.497976437462049e-01   +9.661725002491893e-02   +9.591659156045967e-03   -6.523248298710989e-02   -1.588311258758221e-01; -2.305641711421197e-01   +4.351579489102544e-01   -4.028107759147079e-01   -2.439855449383494e-02   +3.249080949479591e-01   +5.165526502719050e-02   +2.801736943601991e-01   +2.117081944726416e-01; +8.849400192393776e-02   +4.059300436549330e-02   -6.594510702772234e-02   +5.437606256708960e-01   +2.761465574246056e-01   +4.924405198089052e-01   -1.951971610302473e-01   -5.057637507856328e-04; +3.591521649293222e-01   +3.838209812994581e-01   -2.978093015371519e-01   -2.350553448883014e-01   +7.025906855275763e-01   +3.111291862268119e-02   +1.239759790679113e-01   +4.890015536474166e-01; +3.836611806100103e-01   +9.958080350652179e-02   +4.500768313323074e-01   +2.537008050563243e-01   +4.507313447851276e-03   +4.667335552583365e-01   +7.328753959919452e-01   -2.401180758040602e-01; +4.385132506639339e-01   -7.629420728571397e-02   -3.115009379124069e-02   +3.882380663158568e-01   -3.441877955988064e-01   -1.922512004705572e-02   +1.617646036817359e-01   +1.241600215242812e-01; +3.318037300373055e-01   -3.689277624420297e-01   -4.500483277939381e-01   -2.360396481816984e-01   +1.603770576920132e-01   +1.386941510680622e-01   +2.180290399646417e-01   +1.361905436240405e-01; +5.704773727102480e-01   +2.178122094260037e-01   -1.981010714638841e-01   +1.387870238816844e-01   -1.380815584326975e-02   -1.793664288968363e-01   -6.859215857029724e-02   -2.006791294352010e-01; +4.645358982728919e-02   +3.355403437135706e-01   -4.868116282828278e-01   -1.540541171359033e-01   +2.046897310319869e-01   +3.348682457237073e-01   -1.014154712210013e-01   +6.020790535231682e-01; +4.417380616480474e-01   -2.396212104600936e-02   +4.999950684828287e-01   +3.378350067019399e-01   +4.254668566779673e-01   +4.152997482858874e-01   +6.674241052607195e-01   +2.407770773555940e-01; -3.452757475615343e-01   -2.934596584010698e-01   +1.617507982999018e-01   +4.131341052520411e-01   -8.305319853541887e-02   +3.072842546283418e-01   +4.493583566825889e-02   -3.430867421918971e-02; -1.336440004744597e-01   -6.960539934935607e-02   +6.104772417437266e-01   +6.532379261084860e-01   +2.090098960880462e-01   -2.593147844455311e-01   +3.475494648870607e-02   +2.485979158936888e-01; -2.105884150327685e-01   +2.637888452161562e-01   -2.910476122707943e-01   -1.714874114447439e-01   +9.178218458028541e-02   -2.915114048943443e-01   +1.000000000000000e+00   +1.268666454342080e-01; +8.370368324574626e-02   -4.694758805672739e-01   -1.890748526825659e-01   -1.486706847585038e-01   -1.208533817769066e-01   +3.727774114116235e-01   +4.203461968990155e-01   -6.929156714074223e-01; -2.792918619668550e-01   +5.395297864280711e-01   +7.966873147918443e-02   +5.981836640373702e-01   +5.577243990370548e-02   +4.314191627282712e-01   +2.022820564968112e-01   +2.093336771735678e-01; +1.297076816645859e-01   +3.046474214096901e-01   +9.565316685386849e-02   +9.222243814707354e-02   +1.267492604765018e-01   -3.883123357981580e-01   -4.089585557796805e-01   +2.828462625102878e-01];
L1E_L2E_iAMPA_netcon = [-1.496994158869095e-01   -1.984332788330983e-01   +7.997220075433871e-01   +2.410450438026257e-01   +2.211856400570992e-01   -2.155732304430918e-01   -1.848442652460613e-02   -2.268084320462160e-03   +1.229482404692969e-01   -8.988954033061375e-02   -2.826488544793195e-01   -6.993664876578347e-01   -1.458161956215443e-01   +1.876436346100232e-01   +3.558387794905959e-01   +7.441608845959506e-01; +2.129502663705372e-01   -4.052222232014186e-01   +4.113277767005409e-02   -6.653654681407926e-01   +3.195449593638443e-01   -3.410807997521401e-01   +2.139818392894892e-01   -5.691412021598476e-02   +2.901980439084806e-01   +3.022343883570121e-01   +5.422383009089753e-01   -2.896507079198941e-01   +2.070195164447496e-01   +2.993713103759281e-01   +3.496170190859500e-01   +3.680226327198858e-01; -3.649937623258870e-01   +4.867151706124279e-01   +4.066253453998216e-01   +4.454692298034461e-01   +7.707887933087419e-01   -6.419555322104871e-02   +7.829623125503102e-01   +3.983648983099090e-01   -1.419489286602600e-01   +9.524695383311879e-02   +8.958013226795059e-02   +3.584234213568969e-01   +5.994803486382929e-01   +3.569317947032075e-02   +2.238422379775019e-01   +3.523708696429270e-01; +7.625443420308684e-01   +4.395205516900718e-01   -8.354203349104705e-02   +8.068510708911449e-01   -7.941310596059303e-02   +5.324668710286466e-01   +3.438288035543491e-01   -4.070456744378504e-01   -7.724406102478501e-03   -1.631046755131708e-01   -4.679554456684264e-01   -4.765615535188952e-02   +6.183604086606321e-02   -1.187586672226420e-01   +1.872789973110564e-01   +1.064923225865980e-01; +1.128804875928656e-01   +2.064612189472723e-01   +8.584659456141314e-02   +4.639180905795248e-01   -4.925657014817825e-01   +2.882894643679018e-01   +1.772909399339939e-01   +4.246095900810588e-01   -3.440079814112404e-02   -8.933238370044390e-02   -6.555715429905182e-02   +4.371366518211317e-01   -3.651264045686345e-01   +4.219598589255432e-01   +2.724273970958521e-01   -7.292337332952351e-02; +1.938182287825362e-01   -6.330997476349847e-01   +3.217604622656252e-01   -3.601374390774834e-01   -2.836773073564138e-01   -2.342479904145151e-01   -1.123747767157348e-01   +4.815609247704781e-01   -2.123648086845711e-01   +1.499308680842368e-01   +1.171526525268284e-01   +7.311198806609415e-01   +6.894394115039566e-01   +2.992684256845547e-01   -3.190553945914640e-01   -5.329885052251003e-01; +3.286526476472599e-01   +1.086056637164362e-01   -8.510091684590411e-02   -2.436781795732083e-01   -1.714799234817593e-01   +3.892109819615341e-01   -6.269510068672837e-02   -2.612522889479004e-01   -1.866471128892502e-01   -7.744996680170121e-02   +3.498816856047254e-01   +7.067597334815482e-01   -1.408951545746336e-01   +1.701689089562205e-01   +4.902241925878486e-01   +4.749110673730871e-02; +4.187262914831412e-01   +8.303176805750754e-01   +4.753971810740500e-01   +4.708951754051816e-02   +8.902614368504805e-02   +2.306417246745425e-01   +2.151600709481658e-01   +2.418706376116726e-01   +1.311465646167096e-01   +1.261381716597193e-01   +1.762786935331185e-01   -2.731920638424489e-01   -2.615916475500160e-01   +4.628544821459329e-02   +6.403727395186127e-01   +3.281570793857390e-01];
L2I_L2E_iAMPA_netcon = [+1.918930577306895e-01   +4.547709463215375e-01   -3.248850537567415e-01   -5.118527096659672e-01   -5.102766533902173e-01   +5.690187854269082e-01   -1.357597014725609e-01   +8.964565787673189e-02; +6.018478736444892e-01   +8.252963884452250e-02   +2.132296037796366e-01   +4.303516657645205e-01   +4.856871872965812e-01   +5.885777696030808e-01   +7.275777572410455e-01   +2.251782696076464e-01; +1.000000000000000e+00   +2.714302221099925e-01   +1.816092346100465e-01   +1.282402491794605e-01   +6.131239248115175e-01   -1.262609218299713e-01   +1.712736017163206e-01   -1.999680729609072e-01; -1.248361840637649e-01   +3.000528467141538e-01   -3.061205344604001e-01   -3.082821495221874e-01   -1.750043074224934e-02   +4.671003620726057e-01   +4.644232268424131e-01   -2.578153784355031e-01; +2.749533327959902e-01   +8.729051248788246e-02   -2.555601442877434e-01   +5.813979720814505e-01   +5.906204181995010e-01   +3.811249653982215e-02   +2.469023728199951e-01   +7.859977790848601e-01; -2.846940849806677e-01   -6.810559174638867e-02   +4.819048647138647e-01   +3.480128589131369e-01   -2.446657194598982e-01   +1.965935428351166e-01   +8.918586830522663e-01   -3.398845950814507e-02; +1.396140102348584e-01   +2.168205238051555e-02   +4.618877203643519e-01   +1.458726620129655e-01   +3.371660886896499e-01   +8.637571849407830e-01   -1.591782074173987e-01   +2.582017952036348e-03; -2.964795134458756e-01   +4.681880953780230e-01   -8.131239295117283e-02   -2.026518690720029e-01   +2.581067903064495e-01   -1.442982521911272e-01   +9.674040394215817e-02   -3.421570953453589e-01];
L2E_L2I_iGABA_netcon = [+2.277451141167122e-01   -1.399322249428864e-01   +4.300762351760700e-01   -2.268683306576182e-01   +2.389910840925030e-01   -3.607478409994178e-01   +5.056551539900889e-01   +7.256079779585387e-01; -5.441587534411757e-02   +1.044815057005090e-01   +3.832954766487338e-02   -1.254894405384379e-01   -2.968614099852299e-01   +4.999623605207337e-02   +1.313384555914405e-01   +4.191728810627657e-01; +4.439666313796801e-01   +2.143394709058161e-01   +1.390753088054619e-01   +4.813720970482103e-01   +1.476714515426726e-01   -1.573338043460787e-01   +4.154012672018743e-01   -6.029576347964150e-02; +1.428805388999431e-01   -1.589875443039249e-01   -3.043525832711788e-01   -6.547283115724657e-03   +3.908415236469179e-01   +2.435742330680805e-01   +1.174466737158234e-01   +1.840044947444004e-01; +4.784780573472469e-01   +1.739492461257114e-02   -5.842598853961388e-01   +9.395460490556255e-02   +2.454876284870220e-01   +5.680879909927827e-02   -1.666815795914943e-01   +4.659507022101111e-01; +5.892306125291056e-01   -2.024758543651996e-01   +1.567479818929851e-01   +7.824108087662965e-02   -4.770996231833854e-01   -6.225030751478318e-01   -2.582963674433668e-01   -6.518487689280794e-02; +5.288727420407315e-01   +1.429655910866239e-01   -2.138311855940155e-01   -2.560273926483909e-01   +2.225516605691424e-02   -5.752472164497058e-02   -3.148046778171251e-01   -2.446618893858252e-01; -3.053747907319819e-01   +4.795769900322884e-01   +5.966893598815203e-01   +7.161476624085450e-02   +6.164427574568864e-01   +4.072646896201798e-01   +1.658925357902621e-02   +8.527069172803465e-01];
L3E_L2E_iAMPA_netcon = [-6.151173747678367e-01   +4.107092183953052e-02   +5.248279415431971e-01   -3.337490168847098e-01   +1.659096061884499e-02   +1.325593443465992e-01   -3.637133065188237e-01   -5.762218140574794e-02   -1.349492605278343e-01   -2.881371108576176e-01   -1.723047830879275e-01   +9.268842091861011e-03; -1.096210968152907e-01   +2.538489634347781e-01   -2.565872485153485e-02   +3.029300583527241e-01   +4.451999132738157e-01   +5.932178205425740e-01   +2.673182168638554e-01   +2.791600861589953e-01   -5.866426196780395e-04   -7.580203579587962e-02   -4.327859026740726e-01   -2.169071727951388e-01; +1.000688106904710e-01   +9.287272232744587e-02   +4.139681666383988e-01   +1.569911366954329e-01   +1.219206177816782e-01   +1.782171171056909e-01   +4.036596128556244e-02   +8.335632959551701e-01   +5.390404751327684e-01   -2.767592174173627e-01   +5.737561160433985e-01   -6.492995752788784e-02; +9.802489334582368e-01   +4.057440335276745e-01   +7.457117155937004e-01   +9.717672561696775e-02   -1.952443538128445e-01   +2.531494759532198e-01   +5.475140374535060e-01   +4.443074128840248e-01   +2.460320488125273e-01   +4.204477657328397e-01   +5.496495928459099e-01   +3.416799654067679e-01; +1.419954151590023e-01   +3.053220264758563e-01   -1.863239216067903e-01   +4.816879866349970e-01   +2.059355126621605e-01   -3.201353825677500e-01   +4.433266063452462e-01   -1.361348587883484e-01   +2.190090359584168e-01   -4.726113741654971e-01   -6.705791687584089e-01   +7.633449668164641e-01; -2.686284118893740e-01   +3.349986350617438e-01   -2.401379980570560e-01   -1.348141397859196e-02   -6.412659033853470e-02   +5.084825426035510e-01   +6.451936752853330e-01   -2.026892060345145e-01   +7.208473645002673e-01   -9.989565479901559e-02   -1.626554127123036e-01   +1.671968397952578e-01; +2.481138826466202e-01   +4.736773319391706e-01   +5.594735657889852e-01   +1.402184776844709e-01   -5.430289846356870e-02   +2.744693500848892e-01   +3.258999396332840e-01   +4.515197252596462e-01   +3.231056370038233e-01   +8.866724211896211e-02   +4.959112275272705e-01   +3.344453114367004e-01; +1.417807138628599e-01   +4.471963388005613e-01   +5.548683668441927e-01   +9.403841545049781e-02   +1.000000000000000e+00   +9.735823772268686e-01   +3.064124775434538e-01   +3.817433392443724e-01   +3.919902088085231e-01   +8.002867352924296e-02   +1.073204623181920e-01   -9.170805337869464e-02];
L3I_L2I_iGABA_netcon = [-2.058101734526094e-02   +3.899073147355880e-02   +1.488493868974270e-01   +3.535026008664318e-01   +1.303566312199611e-01   -2.300448264718783e-01   -3.038426509531604e-01   +7.309784207010275e-01   -2.602815093706448e-01   +7.229167285914828e-01   -6.147134877786147e-02   +3.328816182220676e-01; +5.053554409703638e-02   +6.774276532245221e-01   +1.348509578059256e-01   -2.066860507892275e-01   +6.053762993091067e-01   +6.423154537134070e-01   +5.555379183670623e-01   -1.934675574311751e-02   -4.528440144813639e-01   +2.699873285278278e-01   -1.476763559229976e-01   +2.540517984773384e-01; +8.211145256336159e-02   +8.445187726099995e-01   -2.959845811575813e-01   +5.182590325447345e-02   +3.432923263735416e-01   +2.753301652569007e-01   +8.197589578020018e-01   -3.780889386616164e-01   +2.151734911757890e-01   +4.908581443160344e-01   +2.361561825172697e-01   -7.902486289175638e-02; +1.082211751743283e-01   +2.545867270249101e-01   -5.976199706471748e-02   +4.686104253581618e-01   +4.171742432434500e-01   +3.097239257707446e-01   +9.481850069186547e-01   -1.235344733035268e-01   -6.040252625589001e-02   +5.966621958725948e-01   +7.053351525936700e-01   -5.371235324187557e-02; +1.766882380919217e-01   -2.038295216993194e-01   +5.561368887490939e-01   -1.193211202642403e-01   -3.795350274818896e-01   -1.457741109347822e-01   -2.667655046563605e-01   +2.734381602154617e-01   +2.995594430298514e-01   +4.287545661988789e-01   -1.138902732319849e-01   +1.940465416296825e-01; +6.321916165315584e-01   -5.244112219169728e-01   -2.674542574145357e-01   +1.134149371774933e-01   +2.605970380194320e-01   +1.329919203080833e-01   +1.930494202172494e-01   +1.985525822901938e-01   +3.304245836467444e-01   +2.102259816934587e-01   -2.836474288181106e-01   -1.061581091409842e-01; -1.179182016313443e-02   -2.428381800654768e-01   +2.143335388410999e-01   -2.572044800577649e-01   +2.109279050957635e-01   +2.911365791167116e-01   +3.433057147518361e-01   +5.312247624062846e-01   +4.137053001505347e-02   +1.599196597088084e-01   +2.275827711417011e-01   -1.411685240025404e-01; -4.792477478318793e-02   +1.077453112785213e-01   -1.408652732265864e-01   -8.645671499991547e-02   -1.439968280483278e-01   +6.063679642672027e-01   +2.128200531375582e-01   +4.068051683043248e-01   -6.331602084749093e-02   +3.011687172266980e-01   +2.072959179898125e-01   +3.586597367900224e-01];
L2E_L3E_iAMPA_netcon = [+5.743584364512211e-02   +2.999717381262368e-01   -1.129110390540590e-01   +5.045705795476176e-01   +5.794261592156537e-01   +2.917082617585467e-01   +1.177525285220534e-01   +7.076104510865362e-01; +6.937550878036210e-04   +8.854216370986634e-02   +4.119058509639976e-01   +1.189258071940188e-01   -4.140024435677159e-01   -1.283284841075880e-02   -2.981570107799377e-01   +2.557391231289695e-01; +4.517386851655372e-01   +4.714989991773985e-01   +6.832097426422745e-01   +3.749437689126686e-01   +1.496414202244694e-01   +6.371191048362242e-01   -1.833123038026036e-01   +6.287924923030168e-01; -1.857852385139656e-01   +3.121989945698906e-01   +7.968487318753199e-01   +2.001921867835169e-01   -3.137742912474358e-01   +7.144421772320343e-01   +1.740595889005866e-01   -4.665061441054934e-02; -8.126484966428570e-01   +3.625216655761461e-01   +4.022294823190501e-01   -1.038209035216896e-01   -6.941634602523586e-02   -4.714048375500802e-01   -7.358091792814797e-02   +3.486527100333714e-01; -3.680012874773823e-01   +2.007443479401000e-01   +6.768226847182193e-02   -1.598390447411186e-01   +2.974310289048376e-01   +2.490853318703843e-01   +1.026646701939701e-01   +2.616802625637150e-01; +4.953202872062171e-01   -4.500355511579297e-02   +1.396631752110031e-02   +6.846926716769828e-01   -4.550591639804939e-01   -1.918784569694694e-02   +4.485463080736544e-01   +8.652414269017875e-01; -1.784057581382613e-02   +6.193198793634200e-01   +4.359642752808687e-01   -9.824118866371226e-02   +2.141756228086708e-01   -2.015619050387260e-01   -5.668610005563193e-02   +1.551756095854099e-01; -4.015755982663626e-01   +1.504146151693467e-02   +3.499427359185276e-01   +5.182127017113215e-02   +1.556224038710750e-02   +3.184076527375722e-01   +5.181412368508621e-02   -3.828709926153344e-01; -8.278811705172244e-03   +3.720070410484340e-01   -8.324373314545996e-02   -4.477225437833176e-01   +1.427014179267890e-01   +4.108152568771499e-01   +8.374583184792472e-01   -2.491808815784116e-01; -2.236474222990817e-01   +1.151217069818528e-01   +1.297597576760629e-01   +6.415926805248580e-01   -2.685537507861009e-01   -4.006157156018442e-02   -3.045673396099151e-01   -4.986703385379382e-02; +1.680618320152426e-01   -2.830031206783680e-01   -6.399319175103074e-02   +6.175482619765660e-01   -1.189818426778219e-01   -1.317795043234698e-01   +6.141527609654589e-02   -3.937283445015877e-01];
L2I_L3I_iGABA_netcon = [-6.089205702630526e-02   -3.047504048924330e-01   +1.042810646841185e-01   -2.697877937714025e-01   +2.359805346469512e-03   +1.658643804935440e-02   +7.594865200190509e-03   +8.145721507425113e-01; +1.300620546062913e-01   -2.058864818309639e-01   -7.939408832382652e-02   +4.935144725724353e-01   -2.839709153801895e-01   -1.909893826163959e-02   -2.365643798083082e-01   +3.353810099672353e-01; +4.241325583734581e-01   +4.019730585503486e-01   -1.058634959871664e-01   +4.948100705481834e-01   +5.910273717135801e-01   -4.780206583138918e-02   +1.010771068245374e-01   -1.928743317714943e-01; +6.799365744387064e-01   -7.719223790570565e-03   +4.079477203312851e-01   +5.028815919078432e-02   +2.885892520509529e-01   -3.511431624185597e-02   +5.445872440938692e-01   -1.082587968919660e-01; +4.063864319882609e-01   +3.322469490980188e-01   +6.557233527040344e-01   +2.765614971642084e-01   +5.475031871888496e-01   -1.699188859730772e-01   +3.909785244968472e-02   +5.191198630942659e-01; +3.023160284724206e-01   +3.353209363104571e-01   -9.037883008522059e-02   +5.502680564901141e-01   -1.514734812958676e-02   +5.066758428493370e-02   +5.226693375081262e-01   -3.003354972753978e-01; +6.214293684601618e-01   +1.375703628701036e-01   +3.864644920371106e-01   +2.573380202572843e-01   +1.377610807876777e-01   +2.708557126249946e-01   -4.483641245303155e-01   -4.088815122274099e-02; -2.719347616353682e-01   +1.221483567513207e-01   +5.687769058350947e-02   -2.393617318346089e-02   -7.370315087591112e-02   +8.078168349089901e-01   -2.006104452177452e-01   -8.740698220779385e-02; -1.411361609283785e-01   +3.374872204904817e-01   +6.487648281431674e-02   -4.829534059300924e-01   -8.385951447103797e-02   +4.129806899356142e-01   +4.631559417157958e-01   +1.987348277778886e-01; +2.161724732184744e-01   +2.201364338799123e-01   +7.688046540351692e-01   -2.758517722023746e-01   -3.339709480550140e-01   -2.538918046757579e-01   +4.142725479932682e-01   -2.637425883108074e-01; +1.986043601282150e-02   +1.773478145766567e-01   +7.016623483107096e-01   +2.449354401077266e-01   +3.291454528202542e-02   +5.221382111695280e-01   +4.589070457246038e-01   +4.323696628533645e-01; -8.648417560734356e-02   -5.403270840922889e-01   +5.823623467431269e-02   -4.084050038550291e-01   +2.704873573464538e-02   +2.713845658248087e-02   -5.105332897296232e-02   +2.992230769242777e-02];
L3I_L3E_iAMPA_netcon = [-4.214264242629837e-01   +4.971204047218802e-01   +5.522851359911588e-01   +2.898118743740877e-01   +6.356615910621141e-01   -2.830609220452410e-01   -7.205815211135490e-02   +6.390480232213200e-02   -3.215076177317673e-01   -1.497800363987641e-01   -6.832622482225320e-02   +3.301618206414107e-02; +2.759856402709907e-01   +1.102735895568566e-01   +6.816758436824224e-01   -3.734189560171823e-01   +2.766855891229650e-01   +2.032300077535984e-02   -3.420567741235830e-02   +8.280488943845629e-02   +3.248106028756976e-01   +9.250278810955231e-01   -1.029181286994577e-01   +1.026507635497372e-01; +6.136608837624701e-01   +3.588811703914161e-01   +1.110003633952346e-01   +1.052023331671393e-01   +5.719910102197727e-01   +2.009505057190783e-01   -2.686614217209483e-01   +3.140612529354698e-01   +4.422710548210712e-01   +6.004857532720250e-01   -4.906064993863997e-02   -1.594517122797061e-01; -1.763962417343579e-01   +4.083131086077341e-01   -2.474422946355198e-01   -6.792529219724859e-02   -2.656092431393896e-01   +8.118321666567105e-03   +4.415756813530900e-01   +6.162172182588275e-01   -1.152952757021669e-01   +7.162036524083548e-02   -2.868104592265774e-01   +8.247576425384507e-01; -8.742429419404257e-02   -6.307557799496588e-02   +2.474933301337663e-01   +6.658968604246682e-01   +9.935588299670449e-02   -9.750451255325408e-02   +6.693702759189257e-02   +6.010728817513350e-01   +3.250703146725120e-01   +5.030840518436982e-01   +4.027536159155678e-01   +2.916111707233198e-01; -3.222971802926828e-01   +2.240792658644132e-01   +3.441939583530461e-01   +4.808367343894017e-01   -5.586301662667829e-01   -4.696463685316484e-01   -1.120149885138023e-01   -1.388452645106226e-01   +5.438844855671408e-01   +3.277047186423105e-01   +3.676605087217882e-01   -2.236685541778994e-01; +7.155974880232362e-01   +6.714688391829872e-01   -1.703261765595973e-01   +3.464450008373801e-02   +6.406792988386768e-01   +7.934123592190699e-02   +3.636309398214527e-01   +6.816491869561659e-01   +4.363142685040624e-01   +1.493907475194369e-01   +2.897940723906756e-01   +1.763900720282174e-01; +2.512000762343106e-01   -4.355774995760540e-01   -5.369591344319252e-02   +9.736995030585598e-02   +2.880960149687863e-01   +1.407296097062727e-01   +5.459052980245480e-01   -2.756688363412664e-01   -6.460361922749795e-01   -2.762309757314015e-01   +1.891878075824752e-01   -2.248402376410472e-02; +2.204702119346361e-02   -2.945538844483000e-01   +9.724362495971500e-03   +2.154373709970965e-01   +3.212191458295392e-01   +4.873683856606156e-01   +9.039851467176804e-02   -3.164000423991604e-01   +3.501427365758586e-01   +8.357420192684160e-01   -8.307527344741825e-02   -2.527149583840705e-01; +3.507901522307477e-01   +3.402418350536310e-01   +3.329530291322167e-01   -5.094247998235910e-01   +4.256193837861947e-01   +2.421324753650393e-01   +1.735373174147513e-01   +4.010976617752560e-01   +4.213686770132929e-01   -2.476114996705941e-01   -1.332808367778292e-01   +4.009494667087425e-01; +1.459488140497925e-01   +4.201164554581599e-01   +4.553510571633640e-03   +6.169460562760420e-02   -3.281096518411697e-01   -3.751179363575426e-01   +7.926738112296287e-01   +6.889468496057916e-02   +3.362514956512089e-01   +2.627477268234152e-02   +1.357947531223381e-01   -2.729032066505835e-01; -1.481649065335650e-01   +2.240821353773272e-01   +4.825493066133714e-01   +3.986059344427196e-01   +4.145030966590207e-01   +7.306338462674016e-01   +1.096885643842425e-01   +3.956332572137814e-02   +5.093807542529539e-01   +3.383035476217078e-01   -1.692237980488413e-01   -2.576159874063865e-01];
L3E_L3I_iGABA_netcon = [+2.418291444204220e-01   -1.648674203915815e-01   +1.531647634350854e-01   +3.556655431101401e-01   +1.699212299034665e-01   +7.641098034162422e-01   -5.197602508110093e-01   +1.261805170716287e-02   -4.909074415060528e-02   +7.873172822842553e-02   +2.605760762811382e-01   -3.126167190823880e-01; +3.376330948452980e-01   +2.358585494851710e-01   +4.181385384182416e-01   -2.724230074620726e-02   +9.208351897654811e-02   +7.158138601626973e-01   +3.752845031636881e-01   +5.876894510065118e-01   +1.916875674478568e-01   -2.815861881356709e-01   +2.649250790466399e-01   -1.354263854237031e-02; +3.911827297746613e-01   +4.725952379932168e-01   +4.028813487649932e-01   +1.642903767302167e-01   +2.988048360827517e-01   -1.703890782498353e-01   -3.785457310811051e-01   -4.439895621006001e-02   +1.494474066447800e-01   +2.124337479904002e-01   +4.336564068326001e-01   +5.089278122253569e-01; -5.202943435826476e-02   +2.275391286148071e-01   -6.867842139753693e-01   +9.520222296018641e-02   +8.031729780091797e-02   -1.000285603172417e-01   -1.588759049985873e-01   +8.456456079490291e-01   +7.242289622080799e-01   +2.787359827883394e-01   +4.386682160095391e-01   +8.674906826498686e-01; +3.692407313933257e-02   +1.834677208810279e-01   +4.534323750187363e-01   -1.388319521938936e-01   +3.250222097784429e-01   +7.079426867316859e-01   +4.641655797124955e-01   +2.656868774345750e-02   +1.114840383793241e-01   -1.754136978683875e-01   +4.945936532517410e-01   +4.086624950141540e-01; -1.350397030309236e-01   -6.002844421645044e-01   +1.597211594885155e-01   +1.492941842340750e-01   -3.577982327597010e-01   +1.456469181375419e-01   -1.353325344360133e-01   +2.425402959514659e-01   -8.396674437969699e-02   +8.029900398536723e-02   +5.711422006805651e-01   -5.614409945248207e-01; -3.134580256101429e-01   +1.437188946710484e-02   +5.729513978276328e-01   +4.374936489830983e-01   -5.006440180242863e-03   +2.088692116879522e-01   -2.981773274724113e-01   +9.234947452850820e-01   -8.346569302746717e-02   +6.921159982690110e-01   +6.054964507670461e-01   +5.779483553808681e-01; -3.232372321748124e-01   -2.655429950542618e-01   +2.164696585465441e-01   +4.048981832081461e-01   +3.428109673229689e-01   +3.698401818368816e-01   -2.363484358939085e-01   +8.194359817236349e-02   +5.780557197421302e-02   +5.070858223816888e-01   -9.088461097107510e-02   +3.267301053311433e-01; +2.455497683329382e-01   +3.653837358959994e-01   +2.034033744061587e-01   +2.923679872392119e-01   +4.990815499782072e-01   -3.784454212914119e-01   -7.145754409998605e-01   +3.662898999476275e-01   -4.226163781565361e-01   +3.478987655511727e-01   +3.920612216592111e-01   -1.551738855104429e-02; +2.328866011584105e-01   +3.211792775194442e-01   +7.591518259832188e-01   +4.407342758995784e-01   -6.480128528907847e-01   -5.510078408153294e-01   +2.554284001295940e-01   +2.093239939283920e-02   -3.086141955312371e-02   -2.408328999068308e-02   -2.956170234693623e-02   +4.916040878981155e-02; +4.499506505481702e-01   -2.148641606343986e-01   +2.724303996280933e-01   +7.868954301572502e-02   +7.920163896925285e-01   +2.912061511054918e-01   -8.716687729567574e-03   +3.777198528772407e-01   -1.126047728772636e-01   +5.314925206397826e-01   +8.086041292246038e-02   +1.789103935154619e-02; +1.204806396605465e-01   +1.683954935484992e-01   +2.562996074531473e-01   -4.051102076323005e-01   +2.242910626890665e-01   +6.077010355560509e-01   +8.214524625005624e-01   +4.048167801606494e-02   -2.070308748929480e-02   +2.480229061175683e-01   -1.785974869093934e-01   +3.713668851696734e-01];
L2E_Input1_iAMPA_netcon = [+1.424764059709940e-01   +4.320418518957695e-01   -3.188839007863033e-01   +2.879625716870728e-01   -5.404103104092339e-02   +6.602373880848273e-01   +5.452509623827194e-01   +4.023040846395287e-01];
L2I_Input2_iAMPA_netcon = [-3.450760481383712e-02   -1.333854142390327e-01   +1.374809243335631e-02   -1.087584585130230e-01   +5.604554436987645e-01   +3.075891491932914e-01   +2.556324836367066e-01   +1.841121514431809e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
