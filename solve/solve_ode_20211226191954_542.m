function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.284297223738544e-02   +5.105838277780569e-02   -2.411459654132506e-01   +2.098254133304112e-01   +1.722235041493870e-02   -1.779858353013392e-01   -1.082324486966216e-01   -2.087554268814008e-01   -4.428615914877311e-02   -1.191486539498263e-01   +2.339606225987048e-01   -8.943273948462953e-02   -2.383821865917656e-01   -8.866158161816941e-02   -8.909776390586420e-02   +2.358112580900001e-02; +6.192492240626905e-02   -2.595330913187324e-01   +5.410178641869670e-03   +2.870896130269299e-01   -4.826118631549330e-02   -2.450084620147871e-02   -1.880453237311854e-01   +6.451643043643777e-02   -2.414083602053723e-01   +1.572003444791022e-01   -1.908339604277759e-02   +2.276480575568592e-01   -7.449591205054573e-02   +6.440205904835575e-02   -6.706505460778311e-02   -1.948546228756083e-01; -2.730682730885092e-01   -1.532651923075664e-01   -1.707219139827870e-01   -1.455288864818336e-01   +4.392915107952549e-02   +5.206654369363401e-02   +1.067449212803463e-01   -1.848349848494270e-01   -8.140406911790651e-02   +6.059648829142454e-02   -9.401848566432193e-02   -8.610593343819063e-02   +1.274552690418696e-01   +8.113443969676884e-02   +1.587786486102896e-01   -1.746322374836358e-01; -2.735028281745843e-01   -1.726374267907963e-01   -2.576939824666103e-01   +1.763689149539373e-02   +1.785987171172390e-01   +1.006077088349073e-01   +1.040291916207137e-01   -1.084037129046284e-01   -1.747300888163859e-02   +1.723108103567279e-01   +9.571235718055129e-02   -2.329250719371474e-01   +7.474910653117200e-02   -2.301235343246769e-01   +1.456329061424744e-01   +2.332124510062652e-02; -3.149024221271242e-01   -8.325545449164864e-02   -6.093567391369060e-02   +1.585432885177260e-01   -1.495619715049928e-01   +1.240668635185152e-01   -2.213444640485548e-01   +7.631227594692817e-02   -3.116001143884187e-01   -1.455298171102954e-01   -6.912345188488385e-02   -4.130817878934163e-02   -8.513894326030143e-02   +1.337980075256371e-02   +1.625289237184956e-01   +2.514974462127321e-01; -3.797583819868185e-02   -1.369446268614603e-01   +4.112550865458807e-02   +1.390275310183463e-01   -1.722576312633779e-01   +9.714652092704107e-02   +1.094218832811926e-01   -9.269332549599436e-02   +1.821441055718162e-01   -1.132149757092412e-01   -1.865545224376716e-01   +1.856115495815610e-01   -2.477676267617385e-03   -1.282161427453032e-03   +2.602619521463611e-01   +3.577366999026694e-01; +3.303669734073864e-02   -4.758795187619336e-02   -6.922110040715473e-02   +2.597812831547314e-01   -2.777915788382286e-01   -2.231174385677069e-01   +3.481406705281929e-02   -2.393254731309009e-01   +5.946732759555041e-02   -8.336624948151257e-02   +9.516500271643391e-02   -9.454377559370876e-03   -5.551598845489950e-02   -8.501713970212219e-02   +2.197491941857107e-01   +5.175162645566089e-02; -2.260216521840326e-01   +8.608536344338294e-02   +1.234312975539358e-01   -2.122867132308797e-01   +3.744446635796875e-03   -2.832216538126903e-01   -7.780751026676680e-02   -3.235453703229424e-01   -5.932481728643650e-03   +6.403059239353928e-02   -4.717848791509018e-02   -2.251339759699729e-02   -6.499925373846306e-02   -4.977690463158405e-02   -7.136546124029573e-02   +2.266235333681186e-01; -1.733439765115569e-01   +1.922097425535484e-01   +1.053286615027680e-01   -1.933552774219380e-01   -1.850948905342715e-01   -1.443059534535481e-01   -8.926872378356017e-02   +1.118318745072950e-01   -1.985238292020990e-01   -3.383630565302800e-02   -9.607725779310021e-02   +1.398056096413907e-01   +1.979285578716938e-01   +1.727609355066647e-01   -1.084509173069916e-01   +1.071048968128267e-01; -5.927501846659165e-02   +1.560987635435759e-01   +2.329599916943009e-02   -1.429062661045840e-01   +2.379521849499869e-02   -1.256647824380082e-01   -1.525897722277210e-01   -2.205595888173413e-01   -9.447105268013199e-03   -1.253703323759125e-01   -9.328168406995548e-02   +7.193441295963248e-03   -3.102265653477153e-01   -1.268917177959737e-01   -2.296291453199723e-01   -2.961191634626633e-02; -8.140863679023501e-02   +8.325290136549993e-02   -2.741569019305019e-01   -1.640533803662622e-01   +3.051674657568173e-02   -5.648182863512322e-02   +2.175416930209944e-01   -5.886081356466594e-02   -8.741894618216664e-02   +6.628347635518664e-03   -2.397117117823160e-01   +9.080631471951420e-02   +2.484254581491538e-01   -1.517375017909003e-01   +6.121897173685546e-02   +1.270119547836780e-01; +2.027376469910996e-01   +3.094520719076544e-02   +2.463698818822257e-01   -3.225523363821852e-01   +1.403222554035894e-01   +2.605342380169435e-01   +3.563830851275041e-02   +9.677454506063221e-02   +1.672617358407184e-01   +2.048849772376682e-01   +1.833525054337473e-01   -3.763867380090171e-01   -1.023898591172339e-01   +2.411861935645389e-01   -2.345853205876445e-01   -1.109666476447275e-01; +2.051783841270438e-01   -1.866270651491190e-01   +1.655952141392536e-02   +1.024383392062643e-01   -1.256983264782726e-01   +1.224600190123188e-01   -3.338415488693333e-02   -1.024347757998842e-01   -2.146191212574841e-02   -3.436601692754034e-01   +1.461129932918428e-01   -8.515162896020690e-03   -6.845785683487717e-03   +1.011405172318735e-01   -2.340744450932258e-01   +1.833488890924281e-01; +2.719172577730071e-02   +5.050823244346780e-02   -7.759791218816910e-02   +2.164496629427031e-01   -3.798809179616140e-02   +9.822341778589377e-02   +1.255776757062854e-01   -1.109800347006219e-01   -3.868868614402023e-02   -2.153962098199452e-02   -3.778484990416719e-01   -1.005271400514731e-01   -2.199012577417084e-02   -8.220515963615918e-02   -8.436796119036871e-02   -1.681241580546354e-01; +1.321307483417502e-01   -3.918353551930694e-02   -2.966126367138322e-02   +5.840419571082743e-02   +1.399322007005341e-01   -1.326170317866944e-02   -1.593049290671397e-01   +1.029515034584007e-01   -1.475840900694771e-01   -2.742339039185962e-01   -1.689119744634423e-01   +2.579561910454083e-01   +1.507404201029045e-01   -1.322121145827788e-01   +4.518114167652476e-02   -2.935396543705650e-01; +2.107503158150700e-02   +5.054562931917056e-03   -1.285381354661508e-01   +1.987927669163152e-02   +9.194493143922880e-02   +1.226794412401353e-01   -3.626163264647742e-02   +1.664219035021469e-02   -1.064639982757082e-01   -2.009072182286329e-01   +5.836969993542125e-02   +2.984303715026017e-01   -2.588983913337414e-02   +4.885553154424477e-02   +1.699566591920540e-01   +1.045131594603889e-01];
L1E_L1I_iGABA_netcon = [+1.056762997025533e-01   +6.453930222777274e-02   -1.160639003115730e-01   +6.782499231210094e-02   +5.257856627242034e-03   +1.933614461391621e-01   +5.413966674878014e-02   +9.347870213392007e-02   -9.962083665744448e-02   -1.557149162224766e-01   -8.855282435705293e-02   +6.121716391960595e-02   +6.778945086457761e-02   -1.169569041812462e-02   +7.100406808337609e-02   -5.673907472031983e-02; +2.382719955224231e-02   +8.744548065386373e-02   +4.987963676609167e-02   -2.047347873734758e-01   -1.309521343785407e-01   -4.742414944721560e-03   -6.111746850443972e-02   +2.564893997386512e-02   +3.744783656427272e-02   -1.482031153945861e-01   -1.986781203994656e-02   -9.485127810641436e-02   -2.389528918702628e-02   -6.875872866437659e-02   -1.424748587709011e-01   -2.661950959634040e-01; -1.990623171159661e-02   +1.640003436634576e-01   +7.508680641598256e-02   +1.392889988272333e-01   +2.980981623691866e-01   -5.999271122166541e-02   -6.157983964959243e-02   -2.059481642912023e-01   -2.674958228360548e-01   -2.115510691134369e-01   -2.030333205439911e-01   +3.068831716565417e-02   -4.371912300882549e-02   -1.736442135257400e-01   -1.485120069980822e-01   +4.538981386543749e-02; +1.724815362227301e-01   -2.069200499950423e-01   -8.505641018385852e-02   +2.136911820092070e-02   +1.926370265325650e-01   +1.714066751698084e-01   -8.793556106302389e-02   +1.496165602409617e-01   -1.922223720737432e-03   +2.577901373792217e-01   -7.261419443231068e-02   -2.246062166569884e-01   -4.753327906854910e-02   +6.481590954001819e-03   +3.311922823727285e-01   -3.887247874373806e-02; +5.163227206245982e-02   +5.108905809609266e-02   -1.274260731576856e-01   +1.202247761732475e-01   +3.919035288153030e-02   -6.349241120668785e-02   -3.334033559487840e-02   -1.293693565874756e-01   +2.173546551890374e-02   +5.553917983966519e-03   -1.312373861442585e-01   -1.569321504740716e-01   +1.971386045925345e-02   -2.714349890431265e-02   +1.073655336499986e-01   -2.106034951623991e-01; +2.545246759984339e-01   -7.688756143072535e-02   +2.706632010420912e-01   +5.967666208031740e-02   -1.977898814549388e-01   -1.147580406210111e-01   +1.115988018235422e-01   -9.206315134446288e-02   -1.228127582170327e-01   +1.588726846630440e-01   -2.119624914035074e-01   +5.306261530165263e-02   +4.723206891455457e-02   +2.296171732716037e-01   -7.695446880816481e-02   +2.281959817357710e-02; +7.527854279866009e-02   -1.924588483268199e-01   +8.538972541053372e-02   -2.150199902408760e-01   +2.669456402246164e-02   +7.316761083225039e-03   -5.358525513494761e-02   +2.735147454757930e-01   -2.629465640559025e-02   -3.898594686434964e-02   -8.018391794014899e-02   +1.643609894415246e-01   +1.589216133297870e-01   +1.260466013107407e-02   -8.253313918934624e-02   -6.208605726131863e-02; +1.478524324107342e-01   -3.378683635036765e-01   +7.489078981995750e-02   +2.427734441677810e-01   -1.378281587160126e-01   +2.306027418330287e-01   +4.383983378636680e-03   -2.796468043572924e-02   +2.068811078884056e-01   +2.309164722522214e-01   +1.130858322303862e-01   +1.646546335015059e-01   -2.631344488480442e-01   +1.206080868590081e-01   +9.705608638382980e-02   +1.640060324728686e-01; -1.659926795092650e-02   +3.076120218439232e-01   -4.330478853815653e-02   +2.101892299326068e-01   -1.912163900811333e-01   +9.200139010964052e-02   +9.303801426891009e-02   +1.002252136321166e-01   +1.726609300725522e-03   +2.016455939497741e-01   -2.778079990427549e-01   -5.466430060316578e-02   +1.747177799697503e-02   +7.703213792578488e-02   +6.182557411467381e-02   +3.859959489577332e-01; -1.597779480651819e-02   +1.650293950237140e-02   -2.049120527487717e-01   -2.619707385272183e-01   +1.209136993269410e-01   +2.093279202741181e-01   -7.591611893040746e-02   +1.127458269530003e-01   -1.716382047871426e-01   -1.718869492204254e-01   -2.746737184533479e-01   +7.776039967264908e-02   -3.257838561685794e-02   +1.581179274912354e-01   +1.971427254351413e-02   +3.626850575258754e-01; +2.322794113550176e-01   +2.057050773747292e-01   -8.145138541935038e-02   +5.125082355362512e-02   +1.785941582633325e-01   -2.122621179630550e-01   -1.804180864320599e-01   +4.529754000194130e-03   +2.584677400924056e-02   -7.216688058226690e-02   -1.524018653199249e-02   +2.067301559721711e-01   -2.634477265723140e-01   -6.028022545896154e-02   +6.540483714996777e-02   -2.184689693037415e-01; -1.467859702648286e-01   -1.644158327493427e-02   +8.721431288742150e-02   +4.433408712495296e-02   -1.296140184136687e-01   -4.125206497611150e-02   +1.429922570046341e-01   +7.350126072363872e-02   +9.000343260221245e-02   +1.484628887436075e-01   +1.016452821997997e-01   -8.533928017595732e-02   +7.773600849363684e-02   +1.802153300806356e-01   +2.269658055397685e-01   -2.016216306864642e-02; -8.870784121258729e-02   +1.855150747499921e-02   +2.434529194645783e-01   +8.088151607496577e-02   -8.723035795889304e-02   -2.043536098315305e-01   +6.317318227189664e-02   +3.259292114289294e-01   -9.860457383515678e-02   -3.345310768121208e-02   +8.700052472779431e-02   +2.434005908515359e-01   +1.337619011362388e-01   +5.964161944970948e-03   +6.541501486627464e-02   -5.542255710189529e-03; +1.261252911491892e-01   -3.280066472600797e-03   -1.740265604073437e-01   +8.594566462987012e-02   -1.056978831536700e-01   +1.201842564020124e-01   -2.306302363462552e-01   +1.850284800051311e-01   -7.684940261522849e-02   +9.735943344308537e-02   +1.742945424042507e-01   +1.311451872807958e-01   -6.224587076179282e-03   +3.071356284048647e-01   +1.271742870148879e-01   +7.965026255661825e-02; -4.592881285231096e-03   +3.751387026049354e-01   -2.264721584500789e-02   -1.258514029453900e-01   -8.776782383257563e-02   +1.171234145773566e-01   -1.495247265383991e-01   -1.195742124009258e-01   +1.822782006034170e-01   +9.737729027142969e-03   +1.116036117693860e-01   -1.783396197436088e-01   +1.985183344057856e-01   -1.136329875583629e-01   +6.008777410477920e-02   +3.594579581252282e-01; +1.538048464720712e-01   +7.466904803847195e-02   +6.293714799647726e-02   -9.030163377737038e-02   +3.767047106699598e-02   +1.359424626599556e-01   +2.366253067040531e-01   -2.743835683213211e-02   -3.708388024829561e-02   -1.248510532314655e-01   -1.054209150817285e-01   -1.408004926003765e-01   -6.233313870134621e-02   -2.531436374627331e-01   -4.542137194083386e-02   +1.260216254839502e-01];
L2I_L1I_iGABA_netcon = [-9.720608565873101e-02   +1.248175698606676e-01   +2.084451952540341e-02   +1.272473348869929e-01   -9.925311519444029e-02   +1.025931761386115e-03   -5.408155247106339e-02   -1.748852476212309e-01; -1.508485454780891e-01   +1.728879087017265e-01   +6.655727202856954e-02   +6.647713206542520e-02   -1.792797955088527e-02   -4.807111817435269e-02   -7.616481034111861e-02   -2.892834716870319e-02; -4.704056030276472e-03   +2.657078082323426e-01   -1.033361637218420e-01   +1.019771118155365e-02   +1.009191549240371e-01   +1.816428421284850e-01   +4.705473553873753e-02   -1.870696552276854e-01; -1.832091022906519e-01   -1.654467922682444e-01   +1.863148757449149e-01   -1.433825900133456e-01   +2.260285030338365e-01   -1.210422647753490e-01   +1.506095445307485e-01   -9.019309331689117e-02; -6.748404450014213e-02   +3.201943832002552e-02   -1.410010422271611e-01   +2.648620210069275e-01   +1.877278798052916e-02   +6.995195142666760e-02   +1.113015641508798e-01   +2.699225010544615e-01; -4.929824824030132e-02   +1.631383157769321e-02   -1.085020672100648e-01   -8.390218814186184e-02   +3.423483100121343e-02   -7.000165845223529e-02   -2.395898002781933e-01   -2.097084830910100e-01; +4.045277740730856e-02   -7.054183846448922e-02   -1.404031131140737e-02   +3.019414256041183e-03   +1.811090776820116e-01   +5.540466108415479e-02   -1.061618685970565e-02   -7.920215958211133e-02; +1.551318538558633e-01   -6.538652255902433e-02   -6.296199154715845e-02   +8.467632083736576e-02   +2.133667450178424e-02   +2.924324501237900e-01   +1.514251370524108e-01   +1.402293242016713e-01; -1.413400918903847e-01   +1.892367317923975e-01   +1.710110599425485e-01   -5.645928105053077e-02   +3.571725266775937e-01   +4.993141186252623e-02   -1.133673740884962e-01   -1.169771088570600e-01; +3.078606462223838e-02   +2.566453534568763e-01   -2.095747862456431e-01   -9.299277812569035e-03   +1.028660086438286e-01   +9.038667556690975e-02   -3.773583593106686e-01   -8.655328081640383e-02; -6.520026601359141e-02   -3.755914518620836e-01   +2.098339849349353e-01   +1.569089479764069e-02   +5.515026317814145e-02   +9.234141186887122e-02   -1.184142834067393e-01   -5.894802699193313e-02; +5.815438437133259e-03   +1.270073524658817e-01   +1.087918329072353e-01   +1.650558659974521e-01   +1.819930363906426e-01   +3.079559727436770e-02   +3.681352151650445e-02   +2.389573635401492e-01; -1.435320832973623e-01   +1.953056939862537e-01   +5.488106853258014e-02   +1.793445893738264e-01   -1.334516551980085e-01   -1.664919641048287e-01   -9.008505824811951e-03   -3.443775016073326e-02; -7.923589817163214e-02   +1.359057251208004e-01   -1.225784080702355e-01   -8.461719522885031e-02   +1.434308048411708e-01   +5.340022306629678e-02   +4.818934626654937e-03   +2.961656152037282e-02; -1.680635630965179e-01   -3.027893563016233e-01   -3.054162744498216e-01   +7.509838434540521e-02   -6.220504613127394e-02   +1.302457455201338e-01   +7.959595043267889e-02   +1.182805438260155e-01; -2.076256612165455e-02   +2.461049014267368e-01   +6.929302892398087e-02   +7.879726931775342e-02   +1.001785230261312e-01   +8.672264710824215e-02   -4.205086689465162e-05   +2.895528573373876e-02];
L1I_L2I_iGABA_netcon = [-4.101293440835725e-02   -1.958897483134075e-01   +2.005604193077000e-01   -2.748546001512116e-01   +1.124916328534697e-02   +2.372550830919268e-01   -2.944484733297031e-01   +1.148572399114946e-01   +1.159443775379602e-02   -3.254837464260120e-01   -5.076233667113648e-02   -1.567963078025361e-01   -1.965797599586990e-01   +1.887178468737392e-01   +9.770700748743842e-02   -6.524119313780267e-02; +2.711689857300705e-01   -8.578792943139710e-02   -6.432247160112459e-02   -2.761528801134993e-01   -2.109650790593505e-01   -5.477834107075020e-02   -1.788397073223051e-01   +2.805087817621824e-01   -1.158782578781966e-02   -1.722248617848903e-02   +1.461934534843185e-01   -3.277637566899903e-01   -7.389158374787437e-02   +1.924315892920628e-01   -2.094385035646593e-01   -9.497210537679808e-02; -3.137900405250964e-02   -1.601986582811936e-01   +6.819527710965703e-02   +2.685423584836423e-02   +7.030871471967953e-02   -1.742223769846751e-01   -2.619454805340617e-01   +2.100759768271985e-01   -2.087987415384635e-01   +1.368552823278626e-01   -6.104864314618033e-03   -1.265604351251061e-02   +1.601994232677197e-02   +2.183038043227888e-01   -9.459377032112343e-02   -2.094063399614895e-01; -7.346812899600928e-02   -1.594348075160528e-01   -8.766369911839824e-03   +2.156086893574903e-02   -2.955880079880667e-02   +9.529292161669709e-03   +1.896992583432534e-01   +3.801018209734237e-02   +8.684869794076445e-02   -4.031038797438924e-02   -3.635772587446011e-02   -1.980315737183829e-01   -4.679106517870586e-03   -5.247025573278472e-03   +2.987927256112394e-02   +1.504033987726927e-02; +2.371371890638535e-01   -2.766534569328435e-01   +6.083178043742839e-02   -1.293735802584176e-01   -3.858690953618987e-02   -1.710289302866565e-01   +6.976812476129718e-02   -6.257379605785897e-02   -3.632563295985747e-01   -1.467905081118693e-02   -7.900506215918185e-02   -2.788494215516400e-02   +1.547337743080859e-01   -2.130933639730131e-01   +9.722483246271404e-02   +7.183812171427073e-02; +2.159830021260372e-02   +2.189963249176651e-01   -1.777272357796416e-01   -1.459418016121131e-01   +2.097066147472675e-01   +1.384643859134146e-01   +1.127007568425949e-01   -1.752914999907050e-01   -6.905080146042750e-02   -2.624876145309902e-02   -1.635408085380091e-01   -1.620749426926351e-01   +1.373623664893749e-01   -9.459360448741197e-02   -1.021261016661811e-01   -5.082027826472686e-02; -2.997778295629500e-02   -1.813318010010926e-01   -1.578926957062963e-01   +2.504391340345247e-01   -1.864845819207413e-01   -1.188558296220676e-01   -2.142320497858590e-01   +2.058942638115405e-02   -1.135133778555619e-01   +1.321043443459635e-01   -1.299831709436265e-01   +1.696323707339511e-01   +9.461456473133559e-02   +3.160722958839032e-01   +2.046605038607760e-02   -1.306429887454379e-01; -1.454131318609113e-01   -3.122521921025773e-01   +1.494068943470772e-01   -6.387768403174619e-02   -1.874530952231006e-01   -1.503286352586866e-02   -1.905233347746380e-02   -1.815211326023504e-01   +9.909781954821584e-03   +4.858103487884143e-02   -1.271965306116773e-01   -1.013260374120563e-01   +6.716018158558425e-02   -2.458090958960380e-01   -4.610525345472734e-02   +2.969903361702212e-02];
L2E_L1E_iAMPA_netcon = [-1.070376874384197e-01   +2.546878117424501e-01   -1.421301599356531e-02   -1.386048072820173e-01   +9.742201232060335e-02   -1.032533163651214e-01   +1.411672600385683e-02   -2.477373119592781e-01; -1.525531258887653e-02   +3.068174175509632e-02   -3.811435036189713e-02   +1.767771739471463e-01   +1.073381301035787e-02   -1.782604192047394e-01   +7.202033368232216e-02   -3.397693522911666e-01; +2.214380179281949e-01   +1.056454091345192e-01   -2.305973852499101e-01   +4.188018292339288e-03   +1.177154170526931e-01   -9.963233309743834e-02   +3.770749667505175e-02   +1.755838934225342e-01; -3.853640931442347e-02   +1.159746441126775e-01   +2.832539051384607e-01   +6.640381349064951e-02   -8.083233403025430e-02   -3.478049113775240e-01   +2.324669025307849e-01   -2.571983635087875e-02; +7.971396639081862e-02   +2.259263095262724e-01   +3.318432738711899e-02   +7.484522997779566e-02   -1.661609116172506e-01   -1.855033347113101e-01   -1.990078610854198e-01   +1.976339281397535e-01; +8.035869165546557e-02   +2.513044851295166e-01   +2.389272581814204e-01   +4.004280549247332e-02   -1.364568416190016e-01   +1.586052953041457e-01   +8.836679535013056e-02   +1.188438769612972e-01; -1.161243706699479e-01   +1.077703248438202e-02   +5.635299299523485e-02   +2.107517996802925e-01   +1.606249598080246e-01   -1.950199288988842e-02   -4.754932892972037e-02   -3.269918534681505e-01; +1.034600829758345e-01   +8.084455360141526e-02   -1.716259949857923e-01   -1.310362369944106e-01   -5.588577896352842e-03   +6.795095843031979e-02   -8.576789457428965e-02   +6.685116220970466e-03; -6.131614838219153e-02   -5.384432255387257e-02   +1.879723432480787e-01   -1.821429507382201e-01   +2.036420331942510e-01   +4.908319223461877e-02   +2.212009793454672e-01   -2.041211666934015e-01; -3.481477177612594e-02   -2.749743003792673e-04   +2.420777547116993e-01   +1.508846148790433e-02   +1.056439782034434e-01   +7.727340219062388e-02   -2.412880647803500e-01   +9.730429890627107e-02; -1.483537518325532e-02   +1.532815499274950e-01   +7.823350601803036e-02   +7.842927381190822e-03   +7.220917969666053e-02   +2.520401724005257e-02   +2.345687755263156e-02   +3.391788115575881e-02; +8.872477711910529e-02   -1.169785447086372e-01   -1.447600663712747e-01   -1.981719185647106e-01   -4.704307228480648e-02   +2.799130004784828e-02   -3.729956246136768e-01   +3.391960241782867e-01; -9.806172028462842e-02   +1.244106715154936e-01   -2.570836882705909e-01   +4.286389377761991e-02   +1.427398305019581e-01   -7.115589698366795e-02   +8.290174327566496e-02   -3.782238206275566e-02; +1.490410341691007e-01   -1.283755704914336e-01   +3.044848555805619e-02   +2.206158106576637e-01   -3.557950660241609e-02   +4.073430489452050e-02   -1.188768728904115e-01   -1.432594140070230e-01; +2.495002201325414e-02   +2.316199344096312e-02   +1.836888896475840e-01   +1.323834196696166e-01   +1.719663544588676e-02   +1.520812673602250e-01   +6.201710144072582e-02   -1.109842243406820e-01; -1.073622218637562e-01   -1.966712886203861e-01   -8.049339505487593e-02   -2.022129619913271e-01   -1.431061597174530e-01   -4.346411706328490e-02   +3.847115985565032e-02   -1.488944643237231e-02];
L1E_L2E_iAMPA_netcon = [-1.798301385728511e-01   -1.366776309534159e-01   -5.759149293809951e-02   +1.441557848203585e-01   -1.346551901816194e-01   +1.286281930612597e-01   +1.525272551815110e-03   +1.205594368956804e-01   -5.870528404453380e-02   +1.334584504077257e-01   -7.631061381657482e-02   -1.216948143986629e-01   +4.958309171642198e-02   +2.044519406053994e-01   +1.417052397605729e-01   -2.260740050313000e-01; +6.282729153758824e-03   -2.251600767892619e-01   +4.161330550583552e-02   +2.078050264019626e-01   +6.558287796551440e-02   +1.266877331177608e-01   -1.355676880975485e-01   +5.517732779648095e-02   -1.649591111352124e-03   +9.246476796285788e-02   +8.214017011531195e-02   +1.410362633913399e-03   -1.697382895194587e-01   +1.879491396347314e-01   +9.018858265521292e-03   -2.435756488569304e-01; -1.474130858743055e-01   +1.202217378823637e-01   +3.737699326653462e-01   -2.855056677393406e-01   -1.255365451064835e-01   -9.340332937886843e-02   -8.418183023507464e-03   +1.697071772326074e-01   -3.790883481944248e-03   -1.318168187263520e-01   -4.856939599122072e-02   -7.940921643746818e-02   +1.364090137451233e-02   -5.253662980790984e-02   +1.462929739684308e-01   +8.012260663977198e-02; -3.107750469010282e-02   -8.829912526861845e-02   +1.361348992307415e-01   -9.666249680894848e-02   +2.644031277983592e-01   +8.532814775034761e-02   -1.211105293236921e-01   +9.515185133835322e-02   +8.667924050779939e-02   -1.683866556209365e-01   -3.236496218518218e-01   +1.332456675469847e-01   +3.328621234362772e-02   +3.128412137396286e-01   +4.209808818478233e-02   -6.150806420766046e-02; -5.309402840365955e-02   -2.206011545196855e-01   +1.823043486758731e-01   -1.710081252939175e-01   +1.145620382161553e-01   +1.609500201456038e-01   -1.171583334130979e-01   +1.705070413635166e-01   +3.661745983264649e-01   -1.617314764924323e-01   +1.007065664841884e-01   +4.972556409199855e-02   +1.689768894838006e-01   +5.593761004660858e-02   +4.136163107684886e-02   +1.774995430021213e-01; +1.414235848689718e-01   -7.719581572966769e-02   +2.592584984493513e-01   +9.192620189696980e-02   +9.936480213682382e-03   -1.252093234688163e-02   -1.880330185987139e-01   +2.435097550035219e-01   +1.312936949564452e-02   -9.490483869898526e-02   -1.246882843289592e-02   +1.058744664318882e-01   +2.672522514888139e-01   +1.099704473435304e-01   +2.162356035820971e-01   -2.230524705732063e-01; -5.739147380178754e-02   -4.198047930340416e-02   -8.257447062458551e-02   -3.183695776112580e-02   +1.341357485441115e-01   +2.713873915093713e-02   -8.168796047760396e-02   -5.330236221707228e-02   +1.667503553154620e-01   -1.518639089448150e-01   +6.543884547632360e-03   +2.073845707569811e-01   -2.019068492627328e-01   -3.165790487106989e-01   +2.348208585936296e-01   +2.255300278358742e-01; -5.114727768675759e-02   -1.859561523210737e-01   -1.764922882723505e-01   +2.513379801955565e-01   -8.090681789164327e-02   +1.125833220152928e-01   -1.932443384312659e-01   +4.587508187448497e-01   -6.809638858204097e-03   -2.384277210872827e-01   +9.111689473157811e-02   +1.265757595045202e-01   -1.493277688692121e-01   -1.190866755492400e-01   -1.390375105274782e-01   -2.163493738582547e-01];
L2I_L2E_iAMPA_netcon = [+1.089377222537597e-01   +1.940473548564400e-03   -3.895754692484898e-02   +1.999802886460055e-01   +1.034289802404908e-01   -4.142639956950418e-02   -5.831712153442313e-02   +1.637135376644473e-01; +7.807520704288896e-02   +2.786130592126478e-01   +1.802494253299511e-01   +7.441597473265807e-02   -1.041808273134382e-02   +9.237044431051611e-02   -1.756774007249418e-01   +4.550834235517585e-02; +1.006518501795436e-01   -5.882897430348767e-02   -3.658450696511804e-01   -2.560429819645212e-01   -1.049985609890495e-02   -1.067877691615005e-01   +2.443837569008166e-02   +1.332623365141090e-01; -1.130073102011666e-01   +3.149570632020328e-02   -1.183708185022222e-01   -1.076140430719678e-01   +4.364484011477691e-02   +2.721733906238316e-01   +2.553748185157874e-02   -3.601383104067910e-02; -3.070325650433431e-01   -1.713734129784086e-02   -1.414801342557972e-01   -1.919470255426944e-01   -1.046647897395605e-01   +7.629094344831412e-02   -1.357140049808598e-01   -1.491022441020390e-01; +1.500273590157407e-01   +7.280347603273221e-02   -1.321489502548505e-01   -1.421123424135347e-02   +1.324312415330413e-01   +1.354362122068280e-01   +2.269506031541446e-03   -5.566752263457851e-02; -1.491906539409815e-01   -2.345164242810832e-02   +1.027890565483367e-01   +1.057921629442412e-02   +2.225924561753145e-02   -3.815670915748084e-02   -1.816563595892363e-01   +1.065544498320742e-01; -2.771489718377678e-01   -1.637791566221485e-02   -2.296167151220367e-01   +2.951451229636813e-01   -6.189427104592442e-02   -9.080174055616054e-02   +2.336396011165970e-02   +1.430020930281850e-01];
L2E_L2I_iGABA_netcon = [-3.235513712515156e-01   +1.075879389663731e-01   -1.376603123091455e-01   +2.107870152135621e-02   +3.566169966708459e-01   -9.289650162574035e-02   -2.090362504491373e-01   +1.152615775875863e-01; +9.638644218558570e-02   +1.757639047631099e-01   +4.798686354990755e-03   -9.670245728831144e-02   +7.510085457394279e-02   +2.045605397775410e-01   +9.141591392371859e-02   -1.814004800735258e-01; +2.887927498614317e-02   +9.740171388111961e-02   +2.022563517611692e-02   +1.310981803811824e-01   +8.915197823023668e-02   -2.118521810073325e-01   -6.358768594209611e-04   +1.558819527410639e-01; +2.855204467458167e-01   +8.427418878542269e-05   -6.149446633113465e-02   -5.334751868232818e-02   +2.073240418715511e-02   -1.871183294090991e-01   +7.247046748325733e-02   +4.267451755043389e-02; +8.536434315598782e-02   +1.511848152821994e-01   -7.692834133123995e-02   +1.900868046018891e-01   -1.283474386453184e-01   +1.881937438323277e-01   +1.787440450702921e-01   +9.004377831074822e-02; -1.933733870811531e-01   +2.897208330754105e-01   -9.094231571966947e-02   +1.910750488351834e-02   -1.723901060788230e-01   +2.046358546766124e-01   +2.198178518413036e-01   +6.992724431523964e-02; -1.822493543462830e-02   -2.659791881594263e-01   +1.674821224467004e-01   +1.846001871186563e-01   +2.565079341870108e-01   +6.935853572128864e-02   +9.516438927616645e-02   -8.986895926256971e-02; +1.397196035318255e-01   -1.206742509578754e-01   +1.018648208533856e-01   +1.895865464744931e-01   +2.584409866021642e-01   +2.488202831719593e-01   +2.082978333495691e-02   +1.050312653851628e-01];
L3E_L2E_iAMPA_netcon = [+5.454000562347292e-02   -1.197330270204735e-02   -9.780688016994096e-02   +1.404104712452648e-01   +7.551165162216227e-02   +1.699021433849925e-01   +2.250784451746269e-02   -1.281580647579213e-01   +3.536124327689414e-02   +3.945070667871763e-02   +1.148338454112980e-01   +2.527587052867132e-01; -8.240768545578588e-02   -4.310325334034452e-02   -1.993302217228981e-01   -4.559072369333436e-02   +2.205789106690063e-01   -1.725006458586979e-01   -1.321584808387773e-01   +1.308384180319895e-01   -2.078344294853496e-01   -7.292086636376864e-02   -1.192428185343257e-01   +2.817948802723392e-01; +1.962319251975355e-01   +4.220490552524261e-02   +2.823479982887376e-01   +6.879740728294097e-02   +4.464989652537476e-02   +2.111517452600664e-01   -1.383239631427588e-01   +3.680729344789326e-02   +1.736806851734800e-01   +2.001169939629932e-02   -1.298745824098481e-01   +2.381081363923676e-01; +2.531839315986668e-01   -1.293630446234252e-01   -2.700148925309315e-01   -6.448610208040065e-02   -1.375565574950930e-01   +5.092873868745405e-02   +2.824434021826568e-01   -3.463773293590552e-02   +1.535397132576749e-01   -2.340983206775284e-02   +8.547105783795503e-02   +3.821207598341744e-02; +6.674150032238786e-02   +1.424819835620716e-01   +1.386329937766206e-01   -3.884353663566681e-02   +1.932473241087538e-01   -1.081475961297491e-01   -4.152780148004127e-02   -2.667319798273308e-02   -9.287047049376555e-02   +2.318335472293315e-01   -4.727100576015262e-02   +6.172650765087880e-02; +6.767979955478406e-02   -2.001331475957814e-02   -2.558672636444379e-01   +3.947138141025302e-02   -5.761051537322481e-02   +2.009209847583251e-01   -4.482010837918011e-02   +8.912019689022513e-02   -5.035426125176979e-02   +2.039571902552073e-01   +2.323815238414886e-01   +8.780594518200223e-02; -2.602417378732021e-01   -9.108983026691619e-02   +2.852367644304915e-01   +2.832058562963915e-01   -6.223918943060765e-02   -1.339050500297445e-01   -3.204229120765466e-01   -1.128832740222529e-01   +1.486221200415861e-01   -3.558071343129654e-01   +2.745676114770064e-02   -1.480650241824593e-01; -3.189986159775764e-01   -7.811020730194475e-02   +9.408669197342330e-02   +5.543113420043751e-02   +1.262403067445998e-01   +7.236475212303015e-02   -2.927131386953645e-01   +1.341562912290076e-01   +2.015367700739888e-01   +1.785238620828474e-02   +9.656589830260583e-03   +3.205348346202596e-02];
L3I_L2I_iGABA_netcon = [-1.020379349068337e-01   +5.778046622411848e-02   -7.435911974191589e-02   -1.604623457244431e-01   +1.680049724474900e-03   +2.980622798784638e-01   +1.025129005973449e-01   +5.542747832620282e-02   +8.389120845614997e-02   -1.653574951955232e-01   +1.314084215220431e-01   -1.286401425186240e-01; -1.021973721276973e-01   +4.645565643041150e-02   -8.473544319098553e-02   -2.186805974599665e-01   +2.082375307821421e-02   -9.126795197630216e-02   -1.617361687208171e-01   -1.965252512034076e-01   +9.615984084283845e-02   -2.579485600382905e-02   -2.304480219114831e-01   -1.192208116060232e-01; +3.869195112435560e-02   -9.082946076266904e-02   +1.138080574105601e-01   -7.904850289376641e-02   -8.105883756500537e-02   -1.888992565354014e-01   +1.534101245329495e-01   +1.536418528754213e-01   +1.259535227127948e-01   -1.537028166688147e-01   -2.410023704589416e-01   -1.003882965308408e-01; -1.367439999469904e-01   +1.216659509981427e-01   +5.887993961487094e-02   -6.884204507872614e-02   +2.089178913016836e-01   -9.730127717974382e-02   -3.435704957630546e-02   +9.340339623633802e-02   -8.036920845178219e-02   +8.772213172344095e-02   -1.234085333980886e-01   -1.990930770560652e-02; -1.645647270636781e-01   +1.849097571369979e-01   +2.504488537532481e-02   +2.701789600042359e-01   +2.197180871594704e-01   +2.178194049202346e-02   +6.347107721288681e-02   +2.511789420601881e-01   +2.547791080003391e-01   -1.189548708506446e-01   +4.555336031229809e-02   +1.302825519574735e-01; -1.098249879759038e-01   +1.729405794170570e-01   -1.772353784700089e-01   -7.273006607262122e-02   -4.582937970726400e-02   -5.298747893427643e-02   +5.881644064741786e-02   +2.467141785224056e-01   +9.670907137890400e-02   -1.561780303100754e-01   +8.483069970535929e-02   +1.172621204677466e-01; +4.686548033701424e-02   -1.094408591101922e-01   +1.814853205271787e-03   +2.621731239977351e-02   +3.420232102556585e-02   +2.029018885079409e-01   -1.321161673886228e-01   +1.696893999075398e-01   -1.371141195205713e-01   +1.808493034749442e-01   -1.896731242050610e-01   +1.126852973300784e-01; -2.283512785554299e-01   -2.770903146155879e-01   +4.112541482641140e-02   -1.421713563965779e-01   +6.591108412311283e-03   +1.970467027651748e-02   -2.735444225266507e-01   -1.819153172131775e-01   +1.734945148115743e-01   +1.847240561377344e-02   -7.350633418378739e-02   -1.448654139820807e-01];
L2E_L3E_iAMPA_netcon = [-8.594361794736512e-02   +1.268080960287251e-01   +1.090914647948221e-01   -2.943736344749538e-01   -1.818548114602962e-01   -1.870990607045554e-01   +1.699035713247763e-01   -1.767711256511669e-01; +1.497304270663055e-01   -1.502236142459593e-01   +6.458345293891325e-02   +1.085845725522472e-01   +1.986169299506809e-01   -1.336325381744675e-01   +7.439047317131456e-02   +7.482323306499074e-02; -1.538024438617003e-01   -4.823283301239841e-02   +2.510192167082451e-01   -1.031494151906223e-02   +9.828920942949025e-02   -1.483347629195484e-01   -2.027006710201351e-01   +1.121722432460115e-01; +3.887736472335158e-02   +1.074440926408228e-01   -1.046512016176622e-01   +1.556687986542315e-01   -9.909587542351379e-02   -2.853634257534521e-01   -7.254909769202866e-02   +5.745430700468110e-02; -1.912731618101006e-02   -2.022264465957040e-01   +2.080532535278725e-02   -8.812940791111508e-03   -1.367703806225539e-01   -2.176894101371033e-01   -1.815085270889065e-01   -2.139878120871403e-01; -1.575809685875870e-01   +2.467903245105169e-02   -6.438219709818011e-02   +1.455504467097103e-02   -7.020184537303716e-02   -1.894231452424802e-03   -7.940191445800315e-02   -3.137238888084571e-01; +2.556123686238901e-01   +3.481778352598985e-01   +9.077582098195684e-02   -3.783694394162676e-02   +3.131061071228258e-02   +1.073442323662515e-01   -2.384933680191319e-01   +2.182161450549495e-01; -8.901955977478572e-02   +7.692380867343464e-02   +9.986123208978803e-02   -3.399367729745139e-01   +1.455519020511651e-01   +6.300775366560303e-02   -2.461243736989169e-02   -3.302364078743293e-02; +2.649147152639530e-01   -2.288351609953299e-01   +2.755211681671886e-02   -4.922222105190714e-02   +1.039874752853824e-02   -8.265489067269166e-02   +1.695201719578501e-02   -1.485575797904675e-01; +3.858310417972401e-02   +4.621764343752401e-02   +7.750102717400811e-02   -1.966202068957877e-02   +1.631199626296604e-01   -1.339915125165929e-01   +4.849704113275820e-02   -6.221609167565557e-02; -5.557159295568779e-02   -2.505514288741549e-01   -2.479876379326832e-01   +2.227180371475159e-01   -2.610047256719897e-01   +3.272013034081701e-01   -1.542400952233867e-01   -1.068469326028592e-01; +2.856517748348642e-03   -4.283353534482105e-02   -2.152948739408279e-01   -6.725783221485275e-02   +7.356353307441815e-03   -2.941058514658649e-01   -2.027679574800936e-01   -8.482580555222823e-02];
L2I_L3I_iGABA_netcon = [-1.943066831628638e-01   -5.327755181818268e-02   +1.618368905155144e-01   -9.331434684216471e-02   +1.921930382907572e-01   +5.910739028518051e-03   -2.060676000377142e-01   +2.264625224982601e-04; -2.471777551427937e-01   -1.094753444816503e-01   -1.303390474378610e-01   -1.160845784912648e-01   -2.440945617029424e-02   +2.518106137802214e-01   -2.357934035960660e-01   -7.385181820416212e-02; +2.253344959012389e-01   +1.202150252785659e-01   -1.170713621927405e-01   +1.335010765992302e-01   +2.351537546312476e-01   +1.433499257132874e-01   -9.450113901676425e-02   +3.240531097092066e-02; -2.419375652795320e-01   +6.812483206139335e-02   +7.244383086624695e-02   +1.313671195452371e-01   -1.014407332352697e-01   -2.797808641078640e-01   +7.867153620109377e-02   +1.164433647150380e-01; +9.937949185881201e-02   +8.507984884091551e-03   +1.511889212699956e-01   +5.343150668444924e-03   -8.296013465003134e-02   +9.772265549002864e-03   +1.087525842734694e-01   -1.590329449430468e-01; +7.832718099611344e-02   -3.260888017181846e-01   +1.410372629370784e-02   +1.880847571725951e-01   -2.700537880069691e-01   +1.273745131011306e-01   -3.799869091319133e-02   +3.023785289183482e-01; +1.475099526302769e-01   +1.251622320399383e-01   +4.407984823208111e-02   -1.805840893368807e-01   +1.771074527832125e-01   -1.608145038588661e-01   +2.980569389371708e-01   -6.596879926824649e-02; +2.013781668279507e-02   -6.746523594181120e-02   -1.510672572664298e-01   -3.759614122738018e-02   -2.202527945154347e-01   -4.748466309599759e-02   +3.260817768099387e-01   -2.174517164493534e-01; +4.602923463642371e-02   -3.257359801555664e-01   -1.265729621279364e-01   +7.839316519604168e-02   -1.426266936740624e-01   +6.100854750014354e-02   +4.946451613496317e-02   -2.546286663301346e-01; +1.819813440844540e-01   -5.123201053164300e-02   -8.659130597801146e-02   +5.465681212641506e-02   -1.377355800707915e-01   +4.342424844019724e-02   +1.734523314464396e-01   +5.334272104239735e-02; -3.480166123126641e-01   -2.776541960188423e-01   -7.104490706833599e-02   -1.025412634975401e-01   -7.907408754599332e-02   -1.072737482212358e-01   -3.467453787591798e-02   +1.394307534061681e-01; +2.814918324591775e-01   +1.173874783342904e-01   +1.553675147378289e-01   +7.801878412555947e-02   +8.175826352314122e-02   +9.955656165282841e-03   +3.443492428828877e-01   +8.514253331809041e-04];
L3I_L3E_iAMPA_netcon = [-2.261754128226006e-01   +4.300431607235615e-02   -9.620033231224884e-02   +1.284679096165895e-02   -1.140358801078921e-01   -4.366901194720360e-02   -2.981022233407069e-01   +1.388194576453646e-01   -1.828742386867427e-01   +6.289181606248843e-02   +3.919428040778253e-03   -1.001809940465575e-01; -3.578144524616477e-03   -1.220832016291972e-01   +3.024874019342753e-02   -1.395455848307540e-02   -1.295371209993570e-01   +2.284638919476920e-01   +6.869560480058792e-02   +1.787793787938289e-01   +1.143134905785498e-01   +3.464363243841578e-01   -2.186338595823041e-02   +3.422804773718619e-02; -9.062895476644318e-04   +1.298669319015872e-01   -1.569491799690909e-01   +1.111187883914672e-01   -1.639049374962837e-01   +5.507433110223772e-02   +8.371291726173428e-02   -5.975031655475974e-02   -6.040487515224893e-02   +6.446302760109462e-02   -1.534307742887432e-01   +7.087728256034292e-03; +5.742368691566053e-02   +2.096361935549081e-01   -2.599918784118729e-01   +1.923449788906506e-02   -1.275883939553907e-01   +8.093553531732212e-02   +3.062044831626017e-02   -2.387956973361358e-01   +9.782526949922238e-02   -3.466606433359305e-01   +6.923623121529913e-02   -1.494437244109903e-01; -1.293082215817917e-01   +3.248493930316094e-02   -1.629710990584642e-01   +3.100422059479238e-01   +1.026415006271370e-01   -1.602044054824295e-01   +2.840017511516659e-01   +9.330702027682941e-02   +6.675886287836304e-02   -1.728621253153231e-01   +2.655014543918365e-01   +1.674830623210603e-01; -9.407667457228749e-02   +9.982507652014369e-02   -2.090492332079657e-01   +1.243253689838203e-01   -6.292251020676165e-02   -1.158274984262201e-02   +1.443700078022422e-01   -1.645452880681536e-01   -3.427480527809542e-02   -2.933850023439221e-01   -1.434039580795117e-01   +4.386034737310103e-02; +2.803356049063022e-01   -3.018329709377223e-02   +1.602927467936134e-01   +1.449216447039548e-01   -2.194855495117888e-02   -1.947034803403924e-01   -2.496187161641346e-01   -1.435929342341425e-01   -9.655146608953473e-02   +4.272631152678563e-02   +3.433155519998037e-02   -3.256405247949409e-01; +9.293443131564133e-02   -3.522842850312197e-02   +1.302943697482315e-01   -8.126140584150182e-02   -2.018566194641054e-01   +8.401885979347634e-02   +1.729254314074709e-01   +8.499659084869077e-02   -1.834887411434419e-01   -1.128352719609473e-01   -2.743397545163420e-01   -4.732227605216783e-02; +4.788024117690271e-02   +5.905293091799294e-02   +1.540011897743756e-01   +6.776768126553320e-02   -1.075352477915334e-01   +2.104394728370999e-01   +9.212111904431397e-02   -4.301283819399630e-02   -2.273356273194360e-01   +1.167942361228157e-01   +3.838254489812609e-02   -1.157983268584155e-01; +2.369898419576303e-01   +1.844961409212181e-01   +7.007408853055469e-02   -5.870605693675815e-02   +7.472275378239479e-02   -2.055570128233797e-01   +1.113539878479689e-01   +6.798467134908977e-02   +8.587185683021087e-03   -2.448134423087710e-02   +6.011676201913662e-02   +6.901206448607128e-02; +3.914077871292052e-02   -1.356929022517706e-01   -3.021190197440382e-01   +8.751874403016187e-02   -9.633588670842039e-02   -4.606237862765192e-02   +6.080346926499171e-02   +1.411605700175895e-01   +2.020912244906345e-01   -3.093768480819821e-01   -1.119861338433230e-01   -8.121946628193404e-02; -1.182936205300619e-01   +2.286328650392275e-01   -1.775144340578161e-01   -2.114631194642724e-02   -5.475791525833528e-02   -2.650427501320050e-03   +2.344987280336058e-01   +8.043394727788730e-02   -1.792847940761702e-01   -2.022965736346582e-01   -7.303783082873688e-02   -1.618823993061957e-01];
L3E_L3I_iGABA_netcon = [-8.471196811996626e-02   -1.566961879997322e-01   +1.990872114144117e-01   +2.051379064717536e-02   -1.027243482898788e-02   -1.129667111693424e-02   -1.284877214448175e-01   -8.990770493203994e-03   -2.071566518754761e-01   -1.727282405731924e-01   +5.014854348140324e-02   +2.380335169879755e-01; +2.017182950675954e-01   -2.856029980846869e-01   +2.102673945334780e-01   -5.836411914241321e-02   -1.391702929407435e-01   +1.583318287764757e-01   +2.193908008001161e-01   +1.501574214212419e-01   -5.156063182631353e-02   -4.645643718002117e-02   +4.016751688088479e-02   +1.896037970640872e-01; -2.432141598107281e-02   +1.326510019625551e-01   +4.133076522693667e-02   -3.265105132734253e-02   +2.819078720232773e-02   -1.778115816698275e-01   +3.162261849178465e-01   +1.000127216919591e-01   -3.112682678458721e-02   -3.946395711719789e-02   -4.362936696704168e-03   -1.184357567206881e-01; -2.475624695580662e-01   -2.127914116009274e-01   -2.809782087098397e-02   +1.179501823741416e-01   -6.491413794027263e-02   +1.055087097586676e-02   -2.744124408581253e-01   +2.040573706504017e-01   +2.287565501453467e-02   +2.824674107390898e-01   +2.743319548884857e-01   -4.219190295377113e-02; +2.546925809524442e-01   +1.681712098969207e-01   +1.666401702485280e-02   -1.771517093180338e-01   +1.564650246344879e-01   -2.574742203096005e-02   +7.184174241992065e-02   +1.260198828690357e-01   +5.608236255840211e-02   -1.827411741476793e-01   -3.277353084790609e-01   -1.429870562364793e-02; -6.118105921894880e-02   +2.501469836336470e-01   +4.494971967682634e-03   -7.563661427593121e-02   +1.183931465479888e-01   +3.101914128827986e-01   -2.952200304506662e-01   -6.987817407168850e-02   +3.348155589367428e-02   +4.606323358978449e-02   +1.605655537072772e-01   -1.099642410928911e-01; -2.466101343215157e-01   +7.156127343934662e-02   +2.100110006237660e-01   -8.094701439550325e-02   -1.472503440789545e-02   -2.326876311926347e-01   -3.672940513637495e-02   +2.583160587912690e-01   +2.344781602580030e-01   +1.568040645328866e-01   +3.223447307925325e-01   -2.534079692389545e-03; -1.590853331880403e-01   -4.486325171835562e-02   +4.938380096138448e-02   -1.000756491275861e-01   -4.676119693132316e-02   -9.684600003003488e-02   +8.157039838094202e-02   -1.114708079422742e-01   -2.526612217078560e-01   -6.570895920079491e-02   +1.069628236136817e-01   +1.339561747364714e-01; -2.042154545915025e-01   -2.277534049367039e-01   +5.566744158789164e-02   -1.857784734884912e-01   +2.096158021301344e-01   +2.137141473352252e-03   +3.173012522933516e-01   +2.210622668517215e-01   +1.979797706713440e-01   +2.317732417644691e-01   +2.850537731883104e-02   +9.383942181409527e-02; +5.509904756856369e-03   -6.795036852766762e-02   +1.012486899337953e-01   -1.189242335242478e-02   -1.727194265555438e-01   -2.256245987700005e-01   +1.004857749750263e-01   +9.702636510854351e-02   +9.424107984455250e-02   +2.204820890840993e-01   -2.505160420124515e-01   +3.443601369008720e-01; -2.439724260576745e-02   +3.033889769450500e-02   -1.954105363421052e-01   +5.250391672377847e-02   -2.796659397920772e-01   -1.269656420763610e-01   +1.080723694304851e-01   +7.184034934803255e-02   -7.241602578569074e-02   -2.709143938729761e-01   -2.339511382026628e-01   +1.522837886426661e-01; +7.692385938506606e-02   -3.020136610289470e-03   -1.628680312519284e-02   -1.026895512615195e-01   -1.443800015308759e-01   +1.641462005406953e-01   -1.914668894749616e-01   -1.091297919089171e-01   +7.154368326916745e-02   +1.578149592762832e-01   -5.561435848729208e-02   +1.216782774162910e-01];
L2E_Input1_iAMPA_netcon = [+1.905228995815249e-01   +1.721283948879777e-01   +1.468638337283519e-01   -1.798508628570243e-01   +8.314115212891281e-02   +8.190514616169563e-02   -1.804738111301695e-01   +7.591550677968217e-02];
L2I_Input2_iAMPA_netcon = [+5.873226031976547e-02   +1.916977379706202e-01   +7.137643603038030e-03   -1.597047862097660e-02   -1.326502417817695e-01   +1.716605961870121e-01   +1.238500974972028e-01   -6.157783355198215e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
