function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.917270644933341e-01   +5.437944089760502e-01   +3.595240663120299e-01   +2.102432131093750e-01   +6.369320784659755e-01   +7.051819330131885e-01   +2.352002116595162e-01   +5.568887281798105e-02   +7.747285459913551e-01   +3.845428829886152e-01   +4.091517708558129e-01   +2.680918812821433e-01   +7.122290543713358e-02   +5.421750351514613e-02   +7.495872547551314e-01   +5.638793146623992e-01; +1.190598552043341e-01   +7.735155171975585e-01   +1.196973809791271e-03   +1.093008345222506e-01   +5.818893683242500e-01   +4.796008765479255e-01   +1.489043478228356e-01   +7.661436311661380e-01   +6.495498650985509e-01   +5.179044539303056e-01   +3.627633781248799e-01   +7.915330066125627e-01   +5.331393114299589e-02   +3.954293779401412e-01   +3.101132546194124e-01   +1.587424059278794e-01; +7.874695260719858e-01   +7.100078310337937e-01   +4.945939626863806e-01   +2.256868521283434e-01   +4.554571323575073e-01   +2.485554291488318e-01   +1.735498280553487e-01   +2.633265142738758e-01   +5.503342903335310e-01   +2.631518238952524e-01   +7.790189089858056e-01   +4.633139124626340e-01   +3.669135632135757e-01   +6.641663043655751e-01   +5.698475486342017e-01   +7.225649237494759e-01; +3.818165786760903e-01   +1.116108658307480e-01   +2.200371661808102e-01   +1.550291882859353e-01   +1.634161357764173e-02   +3.750077801550442e-01   +2.442964475021625e-01   +2.141901641976073e-01   +2.194057917663406e-01   +5.931393071433847e-01   +7.792814519847788e-01   +1.499213055192306e-01   +2.311875859788112e-01   +5.211310482600825e-01   +3.079549702067964e-01   +1.408100445635286e-01; +7.528028764306648e-01   +2.479730069017981e-01   +5.302337259019662e-01   +2.607363808062132e-01   +7.141759641205697e-01   +6.985237076082889e-01   +1.590907803143536e-01   +6.001753318689468e-01   +2.237787891125775e-01   +5.309277404151164e-01   +1.567335033249430e-01   +5.411628409812607e-01   +6.538598921842260e-01   +7.074011155022836e-01   +6.638491110349809e-01   +6.571857744350936e-01; +7.819509473897954e-01   +3.530290828032535e-01   +7.804008627117804e-01   +3.344311697512430e-01   +2.576054681850551e-01   +6.991718963743691e-02   +3.262632737010792e-01   +3.054892518498470e-01   +1.570210957810033e-01   +4.761203839242131e-01   +1.793792357800736e-01   +2.802467041644021e-01   +5.166294341420714e-01   +6.321929360697491e-02   +3.344293428125665e-01   +7.138780565624304e-01; +2.050971093036129e-01   +7.091168706439528e-01   +8.251761071021635e-03   +6.013775349323542e-01   +2.167511735931548e-01   +4.138387177752204e-01   +7.963305986316846e-01   +5.086817944619708e-01   +5.775130052760200e-01   +5.220176221775557e-01   +4.984592102337368e-01   +7.947300250537433e-01   +4.442231544365112e-01   +6.087011866965003e-01   +4.400499823140439e-01   +5.065916783919724e-01; +5.214235784164615e-01   +7.461765443478128e-01   +1.947069183428674e-01   +2.946863394402941e-02   +5.872289322081414e-01   +4.034546501373148e-01   +3.318396711640129e-02   +4.848101055067035e-01   +3.579960868139046e-01   +6.743027267162846e-01   +6.059954466571483e-01   +1.827675570582111e-01   +2.223468793287617e-01   +5.139846650206915e-01   +4.083730787667458e-02   +5.180897650698998e-01; +4.703393948004651e-01   +1.197220795122008e-02   +3.914681221085727e-01   +7.041750539915900e-02   +2.937351207624225e-01   +6.668976167143583e-01   +3.003796081704590e-01   +7.252445023031175e-01   +4.461127635876027e-01   +4.835649303216085e-01   +1.929512619912979e-01   +3.301611854028793e-01   +4.319085035176831e-01   +1.963866254604331e-01   +4.182060430861293e-02   +1.871485858682772e-01; +6.385805807095916e-01   +1.345429608951499e-01   +6.622889192648078e-01   +6.790305302113813e-01   +2.248948889908061e-01   +3.186656811803475e-01   +4.025466212286749e-01   +2.106969492492407e-01   +4.756097476256048e-01   +2.917446802044313e-01   +1.958994735050334e-01   +5.977038359639489e-01   +4.482859133826146e-01   +3.518641010520290e-01   +3.784290617289363e-01   +2.281589273474160e-01; +4.502016833770086e-01   +7.537002657999838e-01   +3.548203999562473e-01   +3.380147917456101e-01   +2.557248506369376e-01   +1.454938682514164e-01   +5.569144522544626e-01   +1.375244691232548e-01   +6.136052094293570e-01   +4.360221465517081e-01   +7.455490241689138e-01   +6.767099986176341e-01   +3.945912705582691e-01   +4.315734894344089e-01   +1.262898928848744e-01   +7.592340343738153e-01; +4.609811466091784e-01   +7.254446747757887e-02   +3.029018688460627e-01   +7.687898982290783e-01   +3.661387926670468e-01   +6.364742638839114e-01   +4.405355433405875e-01   +5.408907316088307e-01   +1.937593139700402e-01   +5.870189283903866e-01   +4.250364107415931e-01   +7.011133570744408e-01   +6.501754659310707e-01   +6.450692393279032e-01   -1.118142120971495e-03   +6.206952870587542e-01; +7.233026613246886e-01   +1.985789972108775e-01   +2.113988270309216e-01   +8.023102473135084e-01   +1.663941783260963e-01   +5.529881265124673e-01   +4.637085491429679e-01   +7.677225167503019e-01   +9.269617843613773e-02   +4.321618703699852e-01   +4.015053191427428e-01   +5.019261609295714e-01   +6.253788018074703e-01   +4.919253519467446e-01   +1.378421181839733e-02   +7.883973920179548e-01; +5.123478022766415e-01   +2.515427371648144e-02   +8.008613701128094e-01   +7.645329446449813e-01   +6.976048630694748e-01   +2.603287480065030e-01   +8.514271201476399e-02   +6.113869808847122e-01   +5.670301961637370e-01   +1.901637618923848e-01   +3.446533289206099e-01   +4.294037053518118e-01   +5.420323371134230e-01   +2.672735879046584e-01   +7.464730406408255e-01   +2.089492935115486e-01; +3.289117233499925e-01   +7.541502692986038e-01   +4.356133767967159e-01   +7.390361467707693e-01   +5.380143607815429e-01   +3.756852367102694e-01   +3.394974758355460e-01   +8.353420581962639e-02   +1.595350518292212e-01   +7.970176407685602e-01   +1.714033975226023e-01   +2.100146771827503e-01   +7.321101715305608e-01   +3.278838246417041e-01   +1.179026392760209e-01   +5.566790412373811e-01; +7.888183371397349e-01   +1.870535487763211e-01   +2.791705907016845e-01   +3.656609553238356e-01   +1.653752945904847e-01   +4.249429145684864e-01   +6.986109407340886e-01   +1.234995997679134e-01   +5.992466017794713e-01   +4.691993397822948e-01   +4.286901303642179e-01   +3.625634249072400e-01   +1.341751272294601e-01   +6.113831538459331e-01   +1.962367792563415e-01   +3.394236105414884e-01];
L1E_L1I_iGABA_netcon = [+6.819809110628888e-01   +7.574080071641092e-01   +1.525760850230325e-01   +1.918114479961359e-01   +9.793404562269379e-03   +6.764074030936900e-01   +4.671173097058341e-01   +7.400675148668479e-01   +1.300719766709963e-01   +7.278919441424938e-03   +1.559663082796245e-01   +4.568207334006096e-01   +6.615734311748456e-02   +1.840781415016876e-01   +1.884867140583369e-01   +3.226983489785690e-01; +5.483472662426682e-01   +4.607774799533524e-01   +8.060553371321207e-02   +5.417011890034387e-01   +5.512597336483173e-01   +6.232535939094381e-01   +2.322202076281530e-01   +6.162859549003689e-02   +7.925038274675282e-01   +7.867011483612865e-02   +7.026946558447670e-01   +3.041348202267955e-01   +3.648312003174147e-02   +7.109240558144917e-01   +6.883801439103258e-01   +3.548118342676937e-01; +7.825664466758243e-01   +5.503095690234425e-01   +7.280715335077709e-01   +7.447192239490631e-01   +7.293505525595132e-01   +1.954574863124003e-01   +3.079827374874977e-01   +1.965419606651289e-01   +5.912215669409925e-01   +6.649590020912924e-01   +1.163286449836154e-01   +6.019717274355626e-02   +7.033972213105403e-01   +5.776828261098270e-01   +1.947994829609519e-02   +4.051152119468633e-01; +5.112835676682785e-01   +4.471002007703724e-01   +5.163233956249565e-02   +5.095435552873333e-01   +3.093009689862414e-01   +6.485009006238595e-01   +2.588462177909573e-03   +3.576972259559482e-01   +4.493541127646947e-01   +3.192095631729234e-01   +4.687447743326456e-02   +7.018899199772255e-01   +1.349015772623064e-01   +5.115837070916790e-01   +5.396557277607514e-01   +5.231138022149082e-01; +4.200410100653238e-01   +5.354097867549477e-01   +6.940980174828651e-01   +5.942036827288019e-01   +1.030839932203509e-01   +3.969128228365479e-02   +8.839864713267816e-02   +7.126297397211899e-01   +7.226661715205794e-01   +7.397726253611305e-01   +4.986328551135582e-01   +3.505758927284509e-01   +4.893695384468777e-01   +4.504925497284507e-01   +4.233455989200561e-01   +4.570043469785217e-01; +4.354382181804251e-01   +4.183133641724330e-01   +1.085018286755751e-01   +1.486520129782356e-02   +5.787407519772539e-01   +4.996218013795701e-01   +2.592694475200238e-01   +8.056467583790594e-01   +7.913039483198360e-01   +4.919112886184413e-01   +1.273889155799144e-01   +2.331219698451218e-01   +7.469794666137425e-01   +6.570915823035041e-01   +4.200354588479928e-02   +3.357794334167165e-01; +7.607143742760162e-01   +6.941061099325549e-01   +2.962821827132468e-01   +6.226386537289942e-01   +5.042870822916405e-01   +1.060656041638812e-01   +3.964438272201244e-02   +7.118905888536705e-01   +6.213050960663845e-01   +8.857622362133051e-02   +6.851287929518846e-01   +1.674167775123589e-01   +1.415556552394189e-01   +2.673952600169764e-01   +6.253924951986543e-01   +7.739791215038766e-01; +3.100945605262694e-01   +7.639212331134632e-01   +4.271221531585838e-01   +5.424982693584766e-01   +7.547623535795035e-01   +2.618644238931991e-01   +3.513006988370165e-01   +3.209929727450144e-01   +5.716115517125748e-01   +1.427893892468894e-01   +1.925893319078582e-01   +7.918540861325630e-01   +1.795073250023248e-03   +6.732157606175733e-01   +4.535190973666958e-03   +2.957857218851833e-01; +6.553015509918225e-01   +4.182449197205156e-02   +7.596946816493875e-01   +1.740120736863178e-01   +8.003557065795285e-02   +1.242006133763636e-01   +7.672605018551454e-01   +5.054990840666840e-01   +7.372746112741455e-01   +7.782908528795535e-01   +3.127947510112008e-01   +6.924838423019096e-01   +4.770891956902916e-01   +2.915014977347572e-01   +5.723913202745378e-01   +2.720190030278344e-01; +1.268291342914637e-01   +4.670081882332467e-02   +4.129515828834807e-01   +7.091335994063767e-01   +5.610489347564136e-01   +7.667034838293638e-01   +5.365794973388703e-01   +6.471674708374323e-01   +2.806085522301351e-01   +7.699635360956587e-01   +3.332523686917627e-02   +3.135441288151998e-01   +1.517813240914838e-01   +3.447953641818777e-01   +6.828110322726940e-01   +4.776900311074996e-01; +1.734646951167785e-01   +1.467140793657994e-01   +7.939158589317279e-01   +7.289988355782070e-01   +2.037601697056945e-01   +5.443120124780828e-01   +5.427266461759649e-01   +7.179521966341449e-01   +2.699592590345227e-01   +2.023079778475650e-01   +7.463504652962200e-01   +3.249197416069406e-01   +6.643697093588465e-01   +6.319662904405013e-01   +2.749269982025225e-01   +7.914533245996801e-01; +6.743056662053821e-01   +1.144625359127841e-01   +7.423617705558774e-01   +2.199461140659331e-01   +2.727835466937703e-01   +7.011872656504995e-01   +6.842521888970733e-01   +2.208026463715140e-01   +5.302351451195795e-01   +7.965264596773231e-01   +3.327106601395239e-01   +4.802529580313876e-01   +5.817892484703739e-01   +4.107412156451192e-01   +2.842542958031405e-01   +1.031733622257998e-01; +2.601092857337879e-01   +4.908649290951513e-02   +2.997161428602925e-01   -3.835645955488172e-04   +8.296258944867774e-02   +5.027639996330066e-01   +3.353568403193090e-01   +1.658737948283469e-01   +4.805965768607397e-01   +5.464963126531533e-01   +8.212546678766693e-02   +6.922854716200881e-01   +2.126014876053372e-01   +2.472074303346928e-01   +2.585692409692148e-01   +4.536570955567387e-01; +6.329692922508132e-01   +4.902946018651645e-01   +7.428325968373557e-01   +3.553913727507165e-01   +7.802970399759489e-01   +4.671240190306992e-01   +3.464903547072839e-02   +4.245054573197489e-01   +3.355734913466844e-01   +7.914442806562185e-01   +2.105265062529829e-01   +1.856492142923299e-01   +1.580080467310931e-01   +2.685663304509137e-01   +2.022372129023978e-01   +5.811019392795838e-01; +6.331929928098966e-01   +2.249187749906764e-01   +4.254544197199912e-01   +2.696271857854736e-01   +4.396589382104876e-01   +1.464582305882574e-01   +6.846833262434868e-01   +4.053018539158693e-01   +2.135128113470283e-01   +8.282139601983467e-02   +4.651859337063634e-02   +6.817270257776109e-01   +1.554912927964895e-01   +7.258852635606275e-01   +4.802841968789466e-01   +7.880863585261663e-01; +1.180280631896101e-01   +2.170303533198669e-02   +5.269417569802245e-01   +1.942936949024793e-01   +2.378906651271183e-02   +4.771669816913114e-01   +2.605586219086726e-02   +1.657673527031742e-01   +3.504515650386842e-01   +4.776581891783263e-01   +3.494280381095571e-01   +1.135113018095641e-01   +3.977134883669300e-01   +5.903466243195834e-01   +5.235534530813417e-01   +4.692406765105185e-01];
L2I_L1I_iGABA_netcon = [+3.769507457705096e-01   +5.154683051371867e-01   +4.901771407221706e-01   +2.506506146851059e-01   +1.721574657550247e-01   +7.403091611077982e-01   +4.025002916395162e-02   +7.471076229062895e-01; +6.907019061517796e-01   +3.923657362516086e-01   +3.370811250924947e-01   +6.520767482108514e-01   +2.460579767740426e-01   +1.770741475469608e-01   +2.651700696461504e-01   +5.683666242615310e-01; +7.502027365986804e-01   +5.299118419442325e-02   +8.533453961848075e-02   +7.176471562267915e-02   +4.854916535912336e-02   +7.608647639120468e-01   +4.913643317184539e-01   +2.701362388378252e-01; +3.699399269247752e-01   +6.865173662236370e-01   +3.301035334895871e-01   +6.526814223011872e-01   +4.394671187739171e-01   +5.932434890225868e-01   +4.263357674290667e-01   +2.321884604640427e-01; +7.452453780016986e-02   +7.257469215975272e-01   +3.635931099506596e-01   +2.236702066392377e-01   +1.738184325786847e-01   +1.282732510943392e-01   +4.701061546657078e-01   +3.598454919254626e-01; +1.592440050494404e-01   +1.550476489741931e-02   +6.423149267398086e-01   +4.685726988028127e-01   +5.924283334254220e-01   +4.187002664438723e-02   +7.368442891065984e-01   +6.571232540215008e-01; +2.242794859681330e-01   +3.660545741007007e-01   +5.996014702562348e-01   +6.688257450212902e-01   +3.549980377202240e-01   +4.388337132005444e-02   +6.682415292957163e-01   +2.132616677206657e-02; +4.975837074883525e-01   +7.135129199798054e-01   +2.369374800338293e-01   +1.011864656204603e-01   +8.335775908991172e-02   +1.574005344594076e-02   +6.557203853739793e-01   +5.894308296152580e-02; +4.083893802313641e-01   +6.964378559490931e-01   +5.018865843523166e-01   +7.012325775671735e-01   +1.485408141179038e-01   +4.479682610169779e-01   +4.240832483694313e-02   +6.723250590558300e-01; +6.621770411467823e-01   +1.099064565229523e-01   +4.520613860397188e-01   +1.680846890258829e-01   +6.139217536556717e-01   +5.580214794567281e-01   +1.071305874900491e-01   +4.789214409196116e-01; +2.572328203307670e-01   +4.982513429807180e-01   +5.027358393363304e-01   +3.864220693710663e-01   +1.954131360755094e-01   +3.542854633700145e-01   +3.865888210149774e-01   +2.471278466702893e-01; +4.009498732777453e-01   +3.757434004949011e-01   +6.905227007417472e-01   +9.007284316677036e-02   +5.210874186648079e-01   +4.734433234886444e-01   +4.836479648087770e-01   +2.335595862521309e-01; +3.829654186865893e-01   +7.189943437613577e-01   +1.972479247852565e-01   +2.237442522241674e-01   +4.912531779159475e-01   +2.770903354289503e-01   +6.451035781484774e-01   +2.090277957828754e-01; +6.304433151249874e-01   +4.375344966048806e-01   +4.315342194451001e-01   +4.908435656482105e-01   +1.048820393242371e-02   +4.059093179328824e-01   +5.635706580671633e-01   +7.458035907036011e-01; +2.196290700781686e-01   +7.157279071131582e-02   +6.256389833333970e-01   +1.020870144886059e-01   +2.865145871178126e-01   +1.943632821100888e-01   +2.951431136488281e-01   +1.129317014173853e-01; +7.869889680673888e-01   +3.201801314168222e-01   +9.844722312042654e-02   +5.515066797309253e-01   +4.442776308924131e-01   +3.907058803081753e-02   +7.780617144539084e-01   +7.676649567165945e-01];
L1I_L2I_iGABA_netcon = [+5.935261425474860e-01   +1.710867145932703e-02   +4.812447250201692e-01   +7.749968589248597e-02   +6.116554121708846e-01   +6.425074520106778e-01   +3.550234689840654e-01   +1.616564049958658e-01   +1.001553839411506e-01   +3.842244562772237e-01   +5.265690263539077e-01   +6.649086290082580e-01   +4.940839082020583e-01   +4.088243432960807e-01   +6.784693171690254e-01   +3.026800393473294e-01; +3.047697169199489e-01   +2.940853700756106e-01   +4.638584132605691e-01   +7.685427891565264e-01   +3.664768133737701e-01   +7.822758198975771e-01   +1.435057224668730e-01   +1.035925142253004e-01   +7.727231444227869e-01   +7.912209230060199e-01   +7.123376289559006e-01   +5.306482708866885e-01   +5.681992990753839e-01   +4.593184617489648e-01   +7.333437133266718e-01   +7.401720177145283e-01; +5.997989610025816e-01   +3.514297207697239e-01   +6.441074866265645e-01   +4.800842294114078e-01   +7.190356722415052e-01   +6.185517899350806e-01   +7.661272773744784e-01   +4.763776814782513e-01   +6.804451856123356e-01   +2.428232082882689e-02   +7.527502713691534e-01   +3.489982073959267e-02   +1.921921241554350e-01   +4.013876440697988e-01   +3.461692527412990e-01   +7.503726507053353e-01; +2.825702897891417e-01   +3.617371206145939e-01   +2.856446713906087e-02   +8.983122499675254e-02   +7.821492023988112e-01   +4.660638506583911e-01   +4.873510346290281e-01   +4.589389805096262e-01   +2.424516846911635e-01   +2.025740823408475e-02   +1.151005163972227e-01   +1.176928639369776e-01   +1.896614542174673e-01   +7.235398964711207e-01   +1.231163542845180e-01   +3.671206702136324e-01; +6.815617420833185e-01   +1.202630584386715e-01   +9.889792486552643e-02   +1.600646310584058e-01   +5.766425636204728e-01   +9.765812324860990e-02   +6.558136518188030e-01   +2.231977582585572e-01   +2.539354334871643e-01   +3.161812654815661e-01   +3.958325749124554e-01   +4.561772079378611e-01   +3.485493643801896e-01   +6.450176079669119e-01   +4.739743327644181e-01   +7.203308512648817e-01; +4.568485277053399e-01   +3.370167460358908e-01   +5.443168335618708e-01   +7.101589381578458e-02   +5.495221383029799e-01   +2.980877954691776e-01   +5.896000789287634e-01   +1.138389392241766e-01   +3.760789315239857e-01   +5.902077527410521e-01   +1.090418185894400e-01   +3.928053583727679e-01   +1.058069908059457e-01   +7.046817332653784e-01   +2.617389252668015e-01   +2.619843133929557e-01; +5.948997896953426e-01   +2.562524284576062e-02   +4.300081576258059e-01   +2.879486995543442e-01   +2.549342172700792e-01   +1.116052249402603e-02   +4.703487692285552e-01   +5.855081742012585e-02   +3.044681341312621e-01   +5.594144810472572e-01   +4.568931967806564e-01   +5.145662224091181e-01   +1.849282984454554e-01   +2.300890593027954e-01   +3.871733225680554e-01   +7.229986835107955e-01; +5.979087829895601e-01   +5.651733091356159e-01   +1.545576065630060e-01   +4.137652566907501e-01   +7.851590988953677e-02   +6.506992531809855e-02   +2.082132721082350e-02   +6.743010080953281e-01   +5.978715318512282e-01   +7.366010677620043e-01   +4.245808755718882e-02   +5.989953520690884e-01   +1.710857224909450e-01   +5.915194936190625e-01   +4.733190152493117e-01   +2.053031187319955e-01];
L2E_L1E_iAMPA_netcon = [+6.254687688333420e-02   +1.608613454992998e-01   +6.647748342774153e-01   +1.259231328180984e-02   +1.909585897753297e-01   +1.563885275987822e-01   +5.645146630351855e-01   +7.601263708766290e-01; +7.910476891057159e-01   +2.695941330694365e-01   +4.164374640470336e-01   +3.824369991886813e-01   +5.577912391742504e-01   +7.107640344834731e-01   +3.729471117620021e-01   +2.891193502956357e-01; +1.038140420638079e-01   +3.419732186414044e-01   +2.067511296206784e-02   +7.018679246793055e-01   +4.622961436956998e-01   +1.306959227878962e-01   +5.417638575903694e-01   +6.576755485363079e-01; +6.867460087152009e-01   +3.881946826043400e-01   +7.150387503474002e-02   +4.493797413154047e-01   +4.621137633646853e-01   +4.680250868607428e-01   +3.500840347409759e-01   +3.099846527409711e-01; +3.651498793317964e-01   +4.648740311095224e-01   +4.341671628738656e-01   +3.475274470107655e-02   +4.938557331052257e-01   +5.656701187081904e-01   +7.620036298029149e-01   +6.929937793348968e-01; +5.748795468575024e-01   +6.166074784978098e-01   +4.300362904007758e-01   +4.892539918787752e-01   +2.411145321952858e-02   +6.441112288077905e-01   +4.070081808422534e-01   +6.947662220638720e-02; +7.209053924667290e-01   +1.338849084760645e-01   +4.823074790852522e-01   +2.042479489188130e-01   +2.857723255662830e-01   +3.140522733530514e-01   +3.631162467581964e-02   +1.509522429922140e-01; +3.613724477624702e-01   +1.126274691209154e-01   +2.161423323139410e-01   +6.505049225147596e-01   +3.363469327665953e-01   +2.664846839709712e-01   +4.933269595906067e-01   +1.541236313086008e-02; +4.002617475387353e-02   +2.050240896163621e-02   +3.907330872089525e-01   +2.375943548227291e-01   +5.370178044716841e-01   +3.838506410103541e-01   +3.026348829547879e-01   +1.754121579969529e-01; +1.557329796811559e-02   +2.586221351962067e-01   +1.458956059202391e-01   +3.816836096286523e-01   +5.647850577355388e-01   +3.345295103154100e-01   +3.329965614518623e-01   +6.925608740546167e-01; +4.657939732370615e-01   +3.660410598049753e-01   +5.990660317616038e-01   +5.160929399956181e-01   +3.792920385026885e-01   +2.465527795556414e-01   +2.177331767490958e-01   +1.319811734541433e-01; +4.453217961187528e-01   +4.307042288042319e-02   +1.051673981024559e-01   +2.116401790838850e-01   +3.440517415334095e-01   +2.378818560288805e-01   +3.029252979011723e-01   +2.882084566686849e-01; +3.310653985123979e-01   +4.908185666818857e-01   +7.731744533758845e-01   +7.551243620425019e-01   +5.527420143888463e-01   +1.404682046847855e-01   +5.839339617211483e-01   +4.287771626175161e-01; +1.784060026985601e-01   +4.153988495294201e-01   +2.756887706260205e-01   +3.018021177320419e-01   +2.789009080470580e-01   +2.739876628014757e-01   +6.958187432236794e-01   +3.034144088445733e-01; +4.498341086944050e-01   +6.822361553883887e-01   +1.800305609115817e-01   +7.737322632259949e-01   +3.968175381001902e-01   +5.104452478991263e-01   +1.357896165973630e-01   +6.495748169435943e-01; +1.023954862510204e-01   +7.791234245939258e-01   +4.493471156132423e-02   +7.219325032865349e-01   +5.953575191934921e-01   +3.263691925859841e-01   +2.137625588755412e-01   +4.434543999858222e-01];
L1E_L2E_iAMPA_netcon = [+1.613890312689450e-01   +5.345154997021363e-02   +2.060500648022196e-01   +5.551954192235431e-01   +1.360694467737230e-01   +7.772797289200518e-01   +6.738078658336506e-01   +1.924466328767735e-01   +6.710921053589723e-01   +5.270439318717161e-01   +3.315898113245350e-03   +6.353697242973261e-01   +8.527873706437557e-02   +7.363438512292814e-01   +2.356976166152400e-01   +7.637761001699590e-01; +3.278041496282841e-01   +1.753664755206393e-01   +1.164716040167565e-01   +6.054184105997792e-02   +1.308809228372231e-01   +5.746009180155320e-01   +4.556138972629614e-01   +3.280310924367139e-01   +6.139944949795917e-01   +2.692409782838805e-01   +1.352814571584987e-02   +5.379169780240235e-01   +4.958331505575565e-02   +3.291024428460725e-01   +3.395605819358164e-01   +3.371133521350612e-01; +5.037022182776503e-01   +4.870356694118785e-01   +3.673221691729790e-01   +3.276308002866193e-01   +4.336102495380360e-01   +3.147591692612088e-01   +5.777320143310779e-01   +7.887067703833972e-01   +1.375252262483386e-02   +5.983024516847270e-02   +3.427532592037267e-01   +6.466314547929792e-01   +1.564018442470536e-01   +2.876743840848923e-02   +5.165728063952638e-01   +3.339293518415224e-01; +2.175598319641733e-01   +3.712720031222240e-01   +6.977149029723156e-01   +4.326662282227892e-01   +3.832003369256237e-01   +5.286882125242072e-01   +7.553721137097713e-01   +1.711386693339856e-01   +2.915640245306277e-01   +1.652165210859673e-02   +6.365981734772103e-01   +3.259747197448603e-01   +2.204624531119715e-02   +4.198808925586044e-01   +7.867431529650256e-01   +7.904623074179185e-01; +4.578301188087418e-01   +7.180432224256655e-01   +4.031986645124719e-01   +1.777825806186307e-01   +3.453536597325998e-01   +6.735247701774053e-01   +3.498978079943466e-01   +4.202566966967967e-02   +6.680104890094334e-01   +3.402256589721364e-01   +1.879859492116862e-01   +7.010872895018043e-02   +7.384663360043745e-01   +5.567327124407594e-01   +6.231548555888879e-01   +3.734912321615829e-01; +4.102097676897347e-01   +5.774455350746120e-01   +2.709948345092592e-01   +5.292510991210568e-01   +5.626004602464429e-01   +1.355235767927381e-01   +1.969259587187483e-01   +2.147123745920454e-01   +2.752571951558641e-01   +7.204289481277371e-01   +4.350786265561024e-02   +5.921452794673292e-01   +6.367113530224570e-01   +3.060998145614552e-01   +5.974076510138093e-01   +3.292765210671256e-01; +3.854255088082236e-01   +3.777569493418300e-01   +5.033390108357242e-01   +3.155944234452904e-01   +4.228235826725403e-01   +7.459842751747084e-03   +5.052929677207243e-01   +7.053414281835076e-02   +1.859127421532687e-02   +3.562297367682427e-01   +6.517183712428893e-01   +3.092971387217373e-01   +4.621581836091362e-01   +1.048356922794199e-01   +1.651211482047442e-01   +6.829675728779925e-01; +4.999463638863052e-01   +1.624292046765418e-01   +5.674110156023415e-01   +4.700138412016602e-01   +3.219323100946294e-01   +2.880795552074676e-01   +6.413930657214655e-01   +6.339941792614845e-01   +1.875922333533867e-01   +7.177068651389946e-02   +6.131108879657364e-01   +2.114917159804457e-01   +6.195775823658651e-01   +6.142628104208028e-01   +6.941326971865834e-01   +1.869138935403090e-01];
L2I_L2E_iAMPA_netcon = [+4.911105831508299e-01   +1.093062396590951e-01   +6.408083696823836e-01   +4.956955599866230e-01   +5.750683195063203e-01   +7.414431860711241e-01   +3.696950662555633e-02   +1.074773639113902e-01; +5.947114056776998e-01   +2.504092811675400e-01   +7.854959874400266e-01   +7.283043400760572e-01   +3.545557408495825e-01   +2.665340855265578e-01   +2.309771404766430e-01   +4.938740103206771e-01; +7.770419542888791e-01   +7.364834034018157e-01   +3.026744979386560e-01   +1.079017833428972e-01   +5.372677199673577e-01   +6.074215034460587e-01   +6.614724524926924e-01   +6.934548612728314e-01; +1.452244378616499e-01   +1.495060481706070e-01   +3.583911339677297e-01   +3.577903890491229e-01   +3.828222243696062e-01   +4.126652912617416e-01   +7.436609124974894e-01   +3.562060897544722e-01; +8.708586232166658e-02   +5.084027772605691e-01   +3.632041304943047e-01   +3.141451646375777e-01   +6.841240922916978e-01   +7.715179263178842e-01   +5.681031021478536e-01   +5.822771398629789e-02; +4.536795418861910e-01   +5.631884325365747e-01   +1.789766941231635e-01   +7.033307598175617e-01   +3.171000752221972e-01   +4.289359249982734e-01   +5.307090425832746e-01   +6.516350191625900e-02; +7.632548371662452e-01   +2.508627811410755e-02   +6.164412300350277e-01   +1.002152890914359e-01   +3.250525931417030e-01   +4.972016602912178e-01   +1.186578066313873e-01   +7.152896353655745e-01; +1.116891254678297e-01   +5.255412542483423e-01   +1.479896805671782e-02   +2.076161945144041e-01   +5.667865991016506e-01   +6.754733477704002e-01   +3.894733562658830e-01   +4.190558321549978e-02];
L2E_L2I_iGABA_netcon = [+7.849383940057375e-01   +4.887993355572940e-01   +4.631753557995049e-01   +5.522927076203709e-01   +7.041157158124692e-02   +7.628870581207113e-01   +1.372446966497289e-01   +5.599241899068209e-01; +5.610959949593000e-01   +3.076356804311132e-01   +4.536913922769834e-01   +2.344458763658629e-01   +3.236327528553177e-01   +4.904829243209832e-01   +4.251626126101376e-01   +7.852786100172933e-01; +5.358788424381454e-01   +8.720489620448486e-02   +5.234054448971394e-01   +9.284476352013570e-02   +3.782342667555614e-01   +8.758703439860233e-02   +7.971612849311064e-01   +5.868608554548815e-02; +7.143079940157924e-01   +1.560017392431440e-01   +4.605464813597541e-01   +7.513882471230003e-01   -2.828219011225149e-03   +7.535527710815368e-01   +6.331073707511875e-02   +2.943279785528869e-01; +7.459109220911747e-01   +5.771564652371515e-01   +4.444007804187622e-01   +3.434271005146943e-01   +4.941130832822686e-01   +7.386073549082950e-01   +3.295346698472310e-01   +2.880379280005789e-01; +3.239738668114135e-01   +4.744057223953982e-01   +4.642418379774353e-01   +6.275042383374745e-01   +4.013746361542959e-02   +7.367737920064806e-01   +1.464311715811716e-01   +6.633614592471102e-01; +7.307504398151522e-01   +5.513687448391751e-01   +4.707210366638569e-01   +3.687724503937509e-01   +5.787429735278083e-01   +5.786497348179390e-01   +2.826066032154414e-01   +2.074698345299093e-01; +6.537193027908149e-01   +2.194383257144132e-02   +7.215083314992499e-01   +2.389364839089844e-01   +6.671298884947364e-01   +4.903247600614833e-01   +7.113840756312109e-01   +2.262549150323864e-01];
L3E_L2E_iAMPA_netcon = [+2.543426506759702e-01   +4.415062259600169e-01   +4.734826007937407e-01   +6.953735438526442e-01   +1.061272088409680e-01   +6.316180914874016e-01   +5.244149164790406e-01   +6.126758497060520e-02   +7.105968536120290e-01   +5.705987439451710e-01   +3.557883149696995e-01   +4.408218834039871e-01; +3.764272525936846e-01   +3.432291172352908e-01   +2.378087292847080e-01   +3.863818522145637e-01   +1.561249422239181e-01   +4.098955947205410e-01   +5.963104958320399e-01   +9.738093919998388e-02   +7.326306147303115e-01   +4.764664875693631e-01   +7.023880844480522e-01   +6.489907794851191e-01; +5.663271862780133e-01   +7.444126489129494e-01   +6.099572595248689e-01   +6.857673597806899e-01   +1.536492574791269e-01   +1.736692536411676e-01   +3.264761597242424e-01   +7.819429032960705e-01   +5.206558341135400e-01   +2.609547107193261e-01   +2.668386450239694e-01   +5.197100260833860e-01; +2.815856406307755e-02   +7.011316820768435e-02   +4.879879403095784e-01   +2.217127174766467e-01   +2.432850989821023e-01   +7.091949046254780e-01   +4.377821728932366e-01   +4.709740952163637e-01   +2.497930442504096e-01   +6.915059495259762e-01   +7.932128571882306e-01   +1.687994490566818e-01; +7.831496057006641e-01   +1.722038864999684e-01   +2.406349224168730e-01   +4.846100361098926e-01   +3.753953987874624e-01   +9.987490859760839e-02   +2.264251618663953e-01   +6.468347170135316e-01   +4.121403696528169e-01   +7.468554437458702e-01   +6.498264955206271e-01   +1.437031923325236e-01; +4.964670022332098e-01   +3.612088550776722e-01   +1.398294344831620e-01   +7.429917790671311e-01   +6.608097440679160e-01   +1.393679203992240e-01   +7.659655394393001e-01   +1.792159936245709e-01   +5.251494507270715e-01   +3.756924427004654e-01   +4.289722824237902e-01   +6.780637309300993e-01; +4.927528505438841e-01   +5.918836974791178e-01   +4.732676355492435e-01   +5.063749595861123e-01   +6.963936639534040e-01   +3.567052451087837e-02   +2.570223322118968e-02   +1.214184131584985e-01   +6.257681053645772e-01   +8.568349933418905e-02   +7.031214932187460e-01   +4.682836591810595e-01; +4.085757113360019e-02   +2.132789821160586e-01   +4.201709617282220e-01   +2.865961457215651e-02   +7.208963429962491e-01   +2.978789992992795e-01   +5.953165630333143e-01   +7.801428382445801e-01   +1.048176034097458e-01   +4.305187995546188e-01   +4.242658858636297e-01   +7.037715632543130e-01];
L3I_L2I_iGABA_netcon = [+5.927358078423643e-01   +4.489944534976545e-02   +1.877049042530122e-03   +4.167447569541989e-01   +3.233444885762655e-01   +1.496049024189117e-01   +5.736716733825419e-01   +6.240394545594055e-01   +6.975191735965223e-01   +5.925652619385873e-01   +4.947863474846904e-01   +1.824407291677920e-01; +3.748598347882776e-01   +7.520816773362293e-02   +5.008762086739055e-01   +3.099967356272845e-01   +3.204463051706806e-01   +2.251370534861092e-01   +3.907812927824529e-01   +4.896900444219300e-01   +4.246276279756407e-01   +7.204965556707148e-01   +1.877159651371448e-01   +6.273620023496126e-01; +7.798035602159532e-01   +1.621758250120428e-01   +4.452119399535825e-01   +6.642258811428471e-02   +4.634835011113688e-01   +4.265435813331727e-01   +4.097926229843487e-01   +9.495482624566412e-02   +3.909265290731324e-01   +1.148372009354239e-01   +5.062491060160048e-01   +1.930938656016322e-01; +1.726181394274566e-01   +2.948801894176796e-01   +3.694457431774394e-01   +8.150779415017746e-02   +2.342179854210205e-01   +6.091404364333306e-01   +3.390865213295816e-01   +5.940276162169836e-01   +5.809258948854389e-01   +4.467139650802512e-01   +2.923895731915472e-01   +4.624076639005845e-01; +7.812119114800754e-01   +7.909958088367089e-01   +6.227551160441803e-01   +1.340066055761811e-01   +4.086062951620003e-01   +5.877153428207602e-01   +4.340946096163722e-01   +6.256263043092603e-01   +7.818283941562636e-01   +2.266992874685064e-01   +1.926477917882212e-01   +1.186869790920239e-01; +7.135671750733026e-01   +7.884783180169131e-01   +1.523737328729017e-01   +4.875206502489395e-01   +1.667680642370699e-01   +3.074562706160429e-01   +6.229925034270898e-01   +5.479611000124244e-01   +2.473852040387108e-02   +2.061147882547393e-01   +1.229647632324540e-01   +3.415616735119933e-01; +6.527196790467421e-01   +2.388183822947046e-02   +6.078964656751046e-02   +9.417602597979988e-02   +1.079914534295478e-01   +1.272456713517116e-01   +6.186431777712854e-01   +6.418156902437698e-01   +6.677019290626691e-02   +5.935530375977914e-01   +2.519706305515818e-01   +5.930509274761413e-01; +2.698375324848882e-01   +6.496144466714219e-01   +5.080534074330154e-01   +5.494407053988076e-01   +4.571280283625678e-01   +2.366535311566643e-01   +7.561214872471159e-02   +7.055080196879800e-01   +7.597229529273402e-01   +5.364346767026219e-01   +1.657516596073556e-01   +1.368577645712514e-02];
L2E_L3E_iAMPA_netcon = [+1.157765885820949e-01   +3.305040474632717e-01   +3.426350467040056e-01   +6.043811199291610e-01   +4.775720970173908e-01   +1.788595394318997e-01   +3.007913669358446e-01   +4.796107376820336e-01; +7.575654181459225e-01   +7.284287923942532e-01   +6.751136118763227e-01   +1.642970156800120e-01   +5.043295750806209e-01   +2.078996215545419e-01   +5.657202525131293e-02   +1.211207074021956e-01; +5.563527420499969e-01   +4.841321516759455e-01   +3.349554033987515e-01   +4.922428755357906e-02   +4.762913764986944e-01   +5.464523511151612e-01   +3.997666536202516e-03   +1.192252050223588e-01; +5.207897618772819e-01   +7.159072476624784e-01   +7.460522328318794e-01   +5.082473658337529e-01   +1.941682036967009e-01   +5.397279885330625e-01   +3.901786183651453e-01   +4.036662299561537e-02; +3.058535453646978e-01   +2.224381121758785e-01   +6.049754165457401e-01   +7.542099352614579e-01   +6.890289002661718e-01   +3.327374123471887e-01   +4.656530323773954e-01   +6.997191653584247e-01; +5.964997559802783e-01   +6.501915432380113e-01   +1.872304105981356e-02   +4.704533942388877e-01   +3.823651370696626e-02   +3.280560040952882e-01   +1.435147467896314e-01   +4.664341701542690e-01; +5.658636012201571e-01   +5.903362282901477e-02   +2.068614074409652e-01   +6.147672478624997e-01   +1.924009393593188e-03   +5.129678398954972e-01   +5.675402803315166e-01   +3.256106212170504e-01; +5.003780644539391e-01   +3.043896945985383e-01   +3.661626605213295e-01   +7.254509633735911e-01   +6.531589748938842e-02   +2.303002068110194e-01   +2.925380331726208e-01   +5.818288216624559e-01; +1.630554884780193e-02   +1.569239988252330e-01   +4.353397547186381e-01   +6.760143334645006e-01   +3.036395920685504e-01   +5.059248987806332e-01   +2.236918239882439e-01   +3.412617294609706e-01; +1.737727877953483e-01   +1.127300522047205e-01   +7.065684294737821e-01   +3.615935164465309e-01   +6.820526105097043e-01   +1.240718301755059e-01   +7.218542974187300e-01   +1.441926245613465e-01; +8.589149144009588e-02   +3.785281236289065e-01   +3.546620011559652e-01   +4.383868226249349e-01   +3.637288655055970e-02   +5.040156258670869e-01   +5.512607024281030e-02   +6.179424904623816e-01; +6.561936760399705e-01   +1.107628013722860e-01   +5.570834353583182e-02   +8.476094076459653e-02   +4.251386845380485e-01   +1.383363093494151e-01   +6.451547671603793e-01   +3.800495323786210e-01];
L2I_L3I_iGABA_netcon = [+2.018479805344569e-01   +2.403827440620250e-01   +2.520644213176284e-01   +1.817856024158984e-01   +7.196161401489350e-01   +5.398147952009460e-01   +6.885667072459778e-02   +2.742636639287572e-01; +5.497305774447534e-01   +4.520197883629704e-02   +1.687536007962134e-01   +4.192899301092895e-01   +7.570995199296425e-01   +4.957102585366046e-01   +3.987986649868815e-01   +6.806117986409715e-01; +6.092505599356089e-02   +5.214169227765381e-01   +7.646877628805228e-01   +3.790412625323137e-01   +7.749149942201372e-01   +1.623093921702955e-01   +1.569131524956704e-01   +4.432937721046675e-01; +5.832134920951675e-01   +4.775625229745610e-01   +3.458068284078336e-01   +2.230053407605520e-01   +7.823969490640585e-01   +6.556875466527575e-01   +3.076044295882860e-01   +5.589349525789069e-01; +4.745391979427908e-01   +5.854945947304998e-01   +4.990207012866750e-01   +1.283142988490066e-01   +4.802762937654343e-01   +5.526221187944447e-01   +6.594210809497490e-01   +5.783559536711752e-01; +2.408468331587013e-01   +1.871065827788790e-01   +2.944670390977626e-02   +5.909688924121000e-01   +1.760898922435139e-01   +7.819433493123598e-01   +5.793166708994663e-01   +7.880056112161166e-01; +5.472649822614569e-02   +1.740455879484333e-01   +1.656111396550176e-01   +5.907394283840249e-01   +8.417830158399388e-02   +2.511158338394526e-01   +3.124265184914308e-01   +8.563382724509314e-02; +4.061918277622162e-01   +2.888650890021359e-01   +6.948195080347255e-01   +3.551626818072545e-01   +3.700932151480226e-01   +1.464846606004257e-01   +6.986946097359988e-01   +7.166685679171605e-01; +6.984072562533126e-01   +6.942764197177034e-01   +6.836181227508942e-01   +5.321759099188242e-01   +5.253509817077864e-02   +6.873603347529673e-01   +3.174757742694777e-01   +3.967303475216840e-01; +6.699673640351412e-01   +3.937171068588748e-01   +1.165212238535559e-02   +2.994770248000601e-01   +6.598506447168646e-01   +7.047925627572982e-01   +4.019239568641466e-01   +7.446621059339144e-01; +4.985153170647979e-01   +7.885853018864726e-01   +6.438592838145221e-01   +5.942006646654744e-01   +1.416388091223855e-01   +7.089434077462298e-01   +3.533187734008473e-01   +7.504250888222108e-01; +4.605719313889530e-01   +6.431625080479776e-01   +2.668311663416189e-01   +6.186715319694031e-01   +7.169421468938049e-01   +1.390433254347564e-01   +2.755650839548771e-01   +1.070523474183514e-01];
L3I_L3E_iAMPA_netcon = [+6.499600147823674e-01   +8.038046965232722e-01   +5.037007665103643e-01   +4.282165155829371e-01   +1.909310419809722e-01   +6.065996823346749e-01   +3.471991279035052e-01   +2.775518697250657e-02   +1.696744784059535e-01   +2.143236381800138e-01   +7.504852540754218e-01   +5.684070345160299e-01; +2.360685382875098e-01   +5.674326934492568e-02   +7.531119925001540e-01   +4.320487881233249e-01   +5.470264780016854e-01   +4.205335168815682e-01   +7.271919864152510e-02   +7.347839420612796e-01   +1.052600481936683e-01   +1.667730898690199e-01   +4.017114073628429e-01   +2.528742458119276e-01; +7.416816442100999e-01   +3.077664947310932e-01   +7.457634922257528e-01   +2.605955345615254e-01   +1.271750845616302e-01   +5.344177317552040e-01   +4.696362201671939e-01   +3.485434451309053e-01   +2.094519065006607e-01   +5.176401619912862e-01   +4.194299264399824e-02   +5.995994521924498e-01; +5.083646900301338e-01   +5.926421293086056e-01   +3.919531263726461e-01   +7.030299512140367e-01   +7.472486652612947e-01   +1.372150641326153e-01   +5.607498497045809e-01   +5.851892234868962e-01   +7.514436622105544e-01   +4.554898591659216e-01   +3.467945867013176e-02   +5.049324738034928e-01; +5.574987519032734e-01   +1.790758064425851e-01   +5.862146707025440e-01   +7.810247012665722e-01   +6.750404961689085e-01   +1.484796284755897e-01   +6.214207063687741e-01   +2.584999782599568e-01   +4.059349822020810e-01   +6.278918612180316e-01   +3.237160252109456e-01   +4.521695973674245e-03; +6.567839395206416e-01   +4.579380478831959e-01   +7.948708283892612e-01   +1.219378555240129e-01   +1.518366022300604e-01   +8.485959632547179e-03   +6.081710864342292e-02   +2.739717181815790e-02   +6.885018637849604e-01   +7.931520265498858e-01   +5.776016416040402e-01   +5.639837767904466e-01; +5.712360129317464e-01   +3.715731106623518e-01   +6.224215574074700e-01   +7.400637159841713e-01   +3.152905132385631e-01   +5.035542606727984e-01   +4.159966592020072e-01   +4.162132609101125e-01   +5.265790246915497e-01   +4.430727367834369e-01   +7.505115131385295e-01   +3.151004293195908e-01; +5.736504234172511e-01   +5.491815579561526e-01   +2.264170245252696e-01   +6.884106561339990e-01   +2.843767541393015e-01   +7.139169192109012e-01   +4.299701385193445e-01   +6.083690718330327e-01   +6.908313084019163e-01   +7.958240536158008e-01   +1.565316027030476e-01   +1.988351064884978e-01; +1.040254843928158e-01   +5.401139509211558e-01   +3.946056552471047e-01   +7.441673227486933e-01   +3.249445472259359e-01   +2.768449544743415e-01   +4.960014552442032e-01   +5.873937966425670e-01   +4.207471676638887e-01   +2.103781650039656e-02   +6.688061565929798e-01   +6.825082384913753e-01; +5.987842419508949e-01   +2.189221138096565e-01   +1.750224227818531e-01   +2.918309879886349e-01   +5.420581726191601e-01   +1.486505254279700e-01   +1.206137630254755e-01   +2.121088461679282e-01   +1.892972814845429e-01   +1.286930474449274e-01   +1.122871818186269e-01   +4.936177272701975e-01; +3.530938349697357e-01   +4.910475070046831e-01   +8.002926746874629e-01   +4.224057072706877e-02   +4.729057104351371e-01   +2.355875660675045e-01   +7.121880910248604e-01   +1.346613415815968e-01   +7.742929534949667e-01   +2.809783891290225e-01   +2.501877291788731e-01   +7.222469798664337e-01; +7.398487480148088e-01   +3.771592307381352e-01   +5.161240725358995e-02   +3.860529000728808e-01   +8.174491103485096e-03   +4.283429442416611e-01   +7.850815270201735e-01   +5.059508846809838e-01   +3.882336054781158e-01   +6.098162525212205e-01   +7.234796528279894e-01   +4.959639225722594e-01];
L3E_L3I_iGABA_netcon = [+3.519889079076086e-01   +3.180921022103481e-01   +6.411147607217960e-01   +1.827083103694670e-01   +1.615833858455627e-02   +6.004015157711488e-01   +7.651822656279761e-01   +7.235179325712445e-01   +7.006337840886804e-01   +4.392467740179677e-01   +3.574028421616020e-01   +5.725378807602403e-01; +6.170110019329567e-02   +1.683662666337834e-01   +1.649397552287265e-01   +3.202909534332495e-01   +5.147463551464092e-01   +5.702038646875964e-01   +7.051205368593316e-01   +6.612205956677379e-01   +1.539400465039943e-01   +6.935497993836129e-01   +8.372234144117480e-02   +7.315125749005490e-01; +3.209458623600812e-03   +3.035361889857155e-01   +5.520683731071744e-01   +5.519435119869212e-01   +4.507045442354775e-01   +2.986662099563601e-01   +7.617731629391586e-02   +1.157123206917561e-01   +2.236742912406900e-02   +8.000099704398361e-02   +1.429978064629895e-01   +2.471146418004986e-01; +7.379965686329284e-01   +4.339323980076027e-01   +6.483796708469062e-01   +7.802986919762059e-01   +1.853096922690814e-02   +4.304365405607037e-01   +2.789269576966062e-01   +7.758027433631471e-01   +1.419516233882264e-01   +6.546814166578913e-02   +6.684878824871257e-01   +7.150726469347481e-01; +1.897163265233982e-01   +8.436632572729803e-02   +1.291331210324344e-01   +9.052218990670451e-02   +3.882575033907981e-01   +1.323193497984792e-01   +5.557588113275790e-01   +3.321341452936408e-01   +6.998070153470618e-01   +7.643278786114202e-01   +8.857436112651176e-02   +2.816762977426410e-01; +6.088552958450053e-02   +5.810817237623214e-01   +5.344018641366187e-01   +6.748196486857054e-01   +5.177564735196590e-01   +7.746429437043640e-01   +6.680323010775937e-01   +1.801362205027643e-01   +6.574345112502832e-01   +1.481223942400650e-01   +3.396774665530168e-02   +5.582854941887249e-01; +2.362498097098851e-01   +3.077852535996261e-01   +6.180619625543268e-01   +3.096541244754378e-01   +6.903418009722699e-01   +4.818699534111665e-01   +5.119905631253935e-01   +5.653295546176995e-01   +6.331074930151989e-01   +2.360379137703441e-01   +6.211907053001534e-01   +3.092759639355980e-01; +6.618754347555347e-01   +2.501231348565455e-01   +3.468627879667732e-01   +2.160087088416659e-01   +1.470610569170418e-02   +7.631797673895651e-01   +4.922699841160104e-01   +4.773803020521862e-01   +5.833951889364153e-01   +2.104890628686557e-01   +7.614156733544041e-01   +2.961025236537482e-01; +1.567060915497559e-01   +1.650927933134436e-01   +7.325736257106344e-01   +2.842276781427826e-02   +5.297561723954659e-01   +5.703689822708776e-01   +3.185624698429589e-01   +6.013848497870498e-01   +7.527569384057082e-01   +7.160078745156459e-02   +5.212326061758055e-01   +3.801838725896530e-01; +5.310929405895497e-01   +1.847297881954217e-01   +5.913445509027524e-01   +5.306135941842681e-01   +3.250973435035756e-01   +3.102316572687737e-01   +5.771869546022337e-01   +4.533535211336193e-02   +7.764566321819916e-02   +4.402727742836720e-01   +5.672803416807036e-01   +6.008890621370467e-01; +2.346582764149510e-01   +4.669000089244897e-01   +6.950522303559189e-01   +3.277939527440986e-01   +7.624385454171638e-01   +7.176605379842788e-01   +4.601771614171789e-01   +6.720174007272770e-01   +3.858875221640138e-01   +8.706571887910368e-02   +6.470497141977033e-01   +4.541742773505195e-01; +6.891347376140953e-01   +4.800913660874597e-01   +3.510841203087666e-01   +1.255589542482967e-01   +5.616082786669597e-01   +1.469697191479728e-01   +7.585859817662295e-01   +1.278752582485300e-01   +5.873694541318353e-01   +3.588973041336657e-01   +1.248644058919317e-01   +5.954261677492909e-01];
L2E_Input1_iAMPA_netcon = [+4.499935292552402e-01   +4.922377026390389e-01   +6.778432426658401e-01   +4.891150024756570e-01   +2.884205004501430e-01   +7.023187386040375e-01   +6.139834239360632e-01   +4.557638420648487e-01];
L2I_Input2_iAMPA_netcon = [+2.874079844620368e-01   +2.755843352610764e-01   +2.602874913195563e-01   +3.804880440444950e-01   +6.169136585086787e-01   +1.037697142280814e-01   +4.278467572999647e-01   +2.245847670274338e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
