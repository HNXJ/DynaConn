function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.189473578373124e-01   +3.862720709750810e-01   -4.462008244226809e-02   +5.122150487264793e-01   -5.740750782905607e-01   -2.571133538443516e-02   +8.910406055252630e-02   +1.287133991138012e-01   -7.224132561749187e-01   -5.639280557537280e-01   +1.835143359894958e-02   +7.262886336245101e-01   +9.591976254100815e-01   +7.155696084784868e-01   +7.248921822006175e-02   +2.389427567000109e-01; -9.223068074936745e-02   +3.828685963076573e-01   +1.127984374784279e-01   -1.804945498370212e-02   -6.240105819696961e-01   +7.053949775944944e-01   -4.291932633138617e-01   -6.566508516311653e-02   -3.829391038876082e-01   -3.591915860712079e-01   -3.586392373455142e-01   -7.425354707931806e-01   -7.923256413038160e-02   +4.367888295232354e-01   +2.279023052755324e-01   -3.829308904362900e-01; +3.811191336142964e-01   +3.627949963674443e-01   -3.451947998585828e-01   -5.930226502730430e-01   +5.912768974321090e-01   +6.775712559071465e-01   +6.370403972146871e-01   -7.427169912243154e-01   -7.055934684400352e-01   -3.896288845060683e-01   +1.599219330014161e-02   -6.163080590956042e-01   +1.584676555133860e-01   -4.213098197192944e-01   +1.282148023975447e-02   -4.532026377912354e-01; -4.680776642694519e-01   +3.093272289948024e-01   +2.942695047996945e-01   +4.076905305525982e-01   +6.676577432559089e-01   +5.395848167668638e-01   +7.917664872907955e-02   -2.075391988549400e-01   -2.787885190894948e-01   +4.886902745544899e-01   -3.860369478024239e-01   -7.378306764737302e-01   +2.733768006638523e-01   +4.898598398428293e-01   -4.186062079784095e-01   +2.430755442456829e-01; +7.124980464475346e-01   -6.225177505798076e-01   +6.227155513051147e-02   +1.359067542977844e-01   -3.342573925618424e-01   -1.168321701627785e-01   -7.759257326899754e-02   +5.099695069557837e-02   -3.087402291642254e-02   -4.066415653887667e-01   +3.078088294048291e-01   +1.067696476121699e-02   +2.039351363923459e-01   -5.252166162199129e-01   +6.565085904491278e-01   -8.304623762415060e-02; +4.431707198448708e-01   -7.555693215278536e-01   +7.556133521622758e-01   -4.717731212530517e-01   +1.080283867927153e-01   +2.613731940647396e-01   +8.832362356592225e-01   +8.040409111668482e-01   -5.511811787380234e-01   +5.216664429026869e-01   -1.184930440589854e-01   +2.717527427990271e-01   +6.676252322813417e-01   -1.850783068987180e-01   +6.887042891306461e-02   -7.945776163867784e-01; -3.762464820352979e-01   +1.654657792685050e-01   -1.776645658217236e-01   -1.608282141631486e-01   +7.746865795319232e-01   -7.170268782969335e-01   +3.749147478059063e-01   +7.400905798453392e-01   +4.355862163537736e-01   -4.962682489882461e-01   -6.293475449105950e-01   -7.065109579756014e-01   +5.330840029472651e-01   +7.235432046372156e-01   +3.187605906888634e-01   -1.626123681996355e-01; +5.611503438941303e-01   +2.671358770807823e-02   +8.713990115480141e-01   +3.420659763410210e-01   -2.551695122934834e-01   +4.384612469915098e-01   +4.182879547302499e-01   -2.007610792217960e-01   -8.984722064753786e-01   +4.718105318058158e-01   +3.796026550502257e-02   +2.405594829080081e-01   -7.174959438821753e-01   +2.921586893098115e-01   -1.540549218861942e-01   +9.646279860275389e-02; -5.353062704831781e-01   -2.259084120637060e-01   +5.448156785038060e-01   -3.245620048247753e-01   -4.970858479791982e-01   +2.931245167350823e-01   -5.935546588830815e-02   -4.083968372283907e-01   +2.412013292362728e-01   -6.721034135584414e-01   -1.286063080967328e-01   +6.181389261267378e-01   +8.864623858672316e-01   +4.399436063873187e-01   -6.872214535584997e-01   +3.770567645805591e-01; +5.897389150725467e-01   -3.339210416896473e-01   +6.727943503174191e-01   -2.674414971458485e-01   +5.530612335596972e-01   -2.704223487332464e-01   +2.473014410616541e-01   +1.000000000000000e+00   -7.322607989490838e-01   +7.528658786853792e-02   +5.168410298326003e-01   +3.109717128850223e-01   +4.389429106380768e-01   +6.641055102701985e-01   +6.922804284501402e-01   -4.351698391677174e-01; -4.247439537926419e-01   -2.860364543808773e-01   -7.138731623523863e-01   +6.170006259837738e-01   -4.718159992384922e-01   +7.272905501333135e-02   -5.606252094127546e-01   -2.345517390364678e-01   -7.741111270096835e-01   -1.801531412879984e-01   -4.492193226948207e-01   +6.754038148084350e-01   -6.546956842775810e-01   -2.946347307316295e-01   +3.471820889225303e-01   +6.909537273784666e-01; +2.719779809232913e-01   +7.222171415440556e-01   +2.911344177257204e-01   -1.130141522225842e-02   +4.609106889293076e-01   +3.861492081119774e-01   -1.094280489239966e-01   +1.046958270284153e-01   +4.042189930400404e-01   -5.008267900132763e-01   +7.081511793186077e-01   +2.276282467796906e-01   +3.718427227660632e-01   -2.752442173989953e-01   -9.045762761715542e-02   -4.280917139290857e-01; +4.011743159899337e-01   +3.958288249537796e-01   +9.848224363677079e-02   +6.565650494118719e-01   +4.494709395013360e-01   +4.875264643020214e-01   -9.814836044487247e-01   +2.112962168095484e-01   -5.894421612042983e-01   +6.189808539638980e-02   +2.810303800922166e-01   +3.644752219853731e-02   +1.350463990012859e-01   +5.144563190110785e-01   -5.482091250514071e-01   +2.683369113139773e-01; -1.531570895916360e-01   +1.474382094893031e-01   -3.413195160004786e-01   -2.466876906678191e-01   -8.575736321245274e-01   -4.906874346926782e-01   +4.952161618103417e-01   -4.574655606313530e-01   +4.282003673112046e-01   -4.069112635343722e-01   -7.420773197460476e-01   +6.358161958729540e-01   -2.710161277925046e-01   -9.952491211788564e-02   +3.571405388162290e-01   +6.876430967603644e-01; +6.424166992440657e-01   +5.457402030088540e-02   -4.160887169078826e-01   +6.135447508876537e-01   -3.325992610724524e-03   -8.604522210060703e-01   -4.524884145512830e-01   +8.137475360916863e-01   -6.937184105057561e-01   -1.532251064792523e-01   +9.496551547632132e-01   -4.949154323365894e-01   -4.642802012832656e-01   +6.805965017688053e-01   +6.822602773794152e-02   -1.967212375151192e-01; -3.827843636287875e-01   +1.839135533435230e-01   +5.952167235808155e-02   +5.209465172034118e-01   +2.345124691305638e-01   -4.487840381145239e-01   +5.770855144134532e-01   +6.758732458354249e-01   +1.925389122982321e-01   -8.108790705081658e-01   -6.426860106340065e-01   +6.233679118678422e-01   +1.269800747971415e-01   -7.526609406595943e-01   +4.039748351933690e-01   +4.294459431776546e-01];
L1E_L1I_iGABA_netcon = [+4.189374233249993e-01   +6.555474024860108e-01   +6.885619330933118e-01   -7.477819599752461e-01   -4.429980555668191e-01   +1.307998601218589e-01   -6.470481600097050e-01   +6.194894617156029e-01   -1.487102309757395e-01   -4.881485987872646e-01   -3.943288413237858e-01   +8.209136419979892e-01   -2.529597458904225e-01   +7.271487566398417e-02   +6.964174709838030e-01   +2.570934438104863e-01; +3.594249963877743e-01   +7.530633658449811e-01   +2.747908583541022e-01   -2.366200268764009e-01   +1.355923048744146e-01   -8.024785929961696e-01   -1.470155636981303e-01   +9.458003499504727e-02   -6.964930474644285e-01   +1.849024270372696e-01   -3.524629640372826e-02   +7.977800967608666e-01   -7.428068080368763e-01   +3.093538905164540e-01   +5.769599116520597e-01   -4.883637568414890e-01; +4.098540450254432e-01   +1.140816836798268e-01   +6.749199792495978e-01   -1.437276321405904e-02   -2.185937387324668e-01   -3.467085994619267e-01   -5.988242316067316e-01   -9.044581134274894e-01   +6.793306177779251e-01   -8.621212972338750e-01   -6.532668741247766e-01   +7.142058850440166e-01   +2.829471894653456e-01   +3.948420766380378e-01   -6.019812383795324e-01   -1.843302791447641e-01; -6.388932453719859e-02   +7.053500164392288e-01   +3.288695039847990e-01   +4.875428295106687e-02   -4.522960082813646e-02   +1.645574782750277e-01   -4.408093935953269e-01   -3.990562394400421e-01   -1.219133507257216e-01   +9.056898742160523e-01   +1.086023821647040e-01   +3.087591665003462e-01   +6.297877088013940e-01   -6.695417348780852e-01   +7.133376678162012e-01   -8.674319808599195e-01; -1.899063173590061e-01   -1.783756064923892e-01   +8.128836829884277e-02   +3.192221110927725e-01   -6.431884319221812e-01   +2.284863130158240e-01   +6.273180100309640e-02   -5.601671956477280e-01   +8.352715799678299e-02   -1.645013642558044e-02   +5.319988782638916e-01   -3.645697800664469e-01   -1.990575580483965e-01   -3.093747854333708e-01   -1.849472549549207e-01   -3.171314242119698e-01; +8.628529493693196e-01   -5.871718019685969e-01   +1.118648208679311e-01   +8.319028327438996e-01   -9.931872883398303e-01   +1.391210143983016e-01   +7.255832912356291e-01   +3.152667736432729e-01   -1.846848804369055e-01   +1.216748678689779e-01   -3.321076671280848e-01   -2.819308253971903e-01   -4.832709322933399e-02   -4.273594135001009e-01   -3.429818091873615e-01   +8.443919260763986e-01; -3.397395456551485e-02   +1.474160274746585e-01   -6.382062731105876e-01   -5.504793102920568e-01   -9.084485782710611e-01   -5.633394841678264e-01   -9.685332620673304e-02   -8.108085769313982e-01   -5.725351359965256e-01   +5.304093646010160e-01   +7.857541718978425e-01   -6.563488868613936e-01   -5.806037681643748e-01   +8.089872389549025e-01   -5.788433237465384e-01   +1.378394067007035e-01; +6.397522957815077e-02   +4.923776375425795e-01   -5.313628607520102e-01   -6.049811267233295e-02   +2.197440335715772e-01   +4.834454861840669e-01   -6.713921873808096e-01   -6.949840794866906e-01   +6.947012193191245e-01   +3.617805070394766e-01   -4.149988787030876e-02   -1.352107999088517e-01   -2.815895851635108e-01   +1.405624029128304e-01   +6.041375650593320e-01   -3.629289866287881e-01; +2.693054335219726e-01   +6.814470754562177e-01   +7.473068079567269e-01   +5.632477396327160e-01   -8.843508203819897e-02   -9.118500005543918e-01   -6.540912963499481e-01   +4.128314405013565e-01   +1.400224638430347e-02   +3.311036526776706e-01   +3.744337175089338e-01   +5.278418516750495e-01   -6.334004939206040e-01   +7.854641360353074e-01   +8.089681772531074e-01   -5.175691609320900e-01; -2.195141858099095e-01   +2.313447655642649e-01   +7.525453879745372e-01   +2.735518017223454e-01   -1.186314394485623e-01   +9.054913524177631e-02   -6.239016106110840e-01   +1.008255370602787e-01   +4.514217574590835e-02   +2.682893401756442e-01   +5.905016102186735e-02   -3.527972648545618e-01   -6.146226015906983e-01   -2.703206081121937e-01   -2.150632860686414e-01   -2.411356645771662e-02; +1.000000000000000e+00   -5.627218227140575e-01   +8.171929216101916e-01   +4.436892282372011e-01   +3.521514079409604e-01   -4.603424118551122e-01   -6.649677109781420e-01   -8.813331534884262e-01   -1.462947971265229e-01   -3.083817984400427e-01   +7.670616651439169e-01   +8.125576045263140e-02   +1.589358112277743e-01   +5.599429813824424e-01   +4.511163803606400e-02   -1.767834423819599e-01; +3.456320872391295e-01   -9.213353465321115e-01   +3.424174038367137e-01   +7.539483859525512e-01   +6.238529351455842e-01   -1.014601876832637e-01   +1.583352735111372e-01   +3.879762591714381e-01   +3.726535371528884e-01   +3.950960237883039e-01   +4.097659405069696e-01   -6.348170368182481e-01   -8.413712959637618e-01   +2.232407028712775e-01   +4.401506823944351e-01   -1.078036679007957e-01; -1.352934615508494e-01   +2.560046181800201e-02   +3.674205392142516e-01   +6.608545606508582e-01   +2.432585774051790e-01   -6.157492185991648e-01   +4.768862721396206e-01   -6.026735896057964e-01   +4.616948267641800e-01   -3.209514019834719e-01   +2.098039907524714e-01   +7.068999230287161e-01   -7.744336663600587e-01   -6.391027037653449e-01   -6.893935569111317e-01   -1.897798216793082e-01; +3.660605874705375e-01   +6.797060553778551e-01   +5.960039848053502e-01   -2.513126410291689e-02   -2.478756581956484e-02   +1.608932786552473e-01   +1.254734179432745e-01   -3.149888783847173e-01   -4.991998707168511e-01   +7.096329700830851e-01   +7.401647754369746e-01   -2.020293838052029e-01   -6.871307415869509e-01   +6.624877997927279e-01   +4.038418263075732e-01   -2.481524669556530e-01; +5.794019015866014e-01   +2.914364557027840e-01   +1.609020471898467e-01   -1.097763078604490e-01   +4.992862578902087e-01   -4.682564298162522e-01   +3.695965190267531e-01   -7.322596245756632e-01   +7.459835364030845e-01   -2.821679812165738e-01   -2.985369522627982e-01   +2.929446673722856e-01   +5.623273764778940e-01   +3.472305983754126e-01   +5.190298998877071e-01   +5.319702458090380e-01; +6.689015629850988e-01   -7.437339272256209e-01   -9.886080506111937e-01   +5.978055359686675e-01   -4.041496470001290e-01   +2.896570124027892e-01   +5.583221937785425e-01   -5.894548069259268e-01   -6.687940164773987e-01   -2.573602918277708e-01   +1.275898266064879e-01   -4.570212224670121e-01   +5.016011394418414e-01   -3.388282654982156e-01   -4.104016740571181e-01   +3.952863114211183e-01];
L2I_L1I_iGABA_netcon = [+3.210714765397054e-01   -7.317950133014790e-01   -4.032280494993470e-01   -6.781844348087489e-02   +3.089446318827782e-01   +6.213953534989590e-01   -3.598485836017408e-01   -8.372216620387164e-03; -1.742355054034924e-01   +1.732055613545609e-01   +4.060729040227272e-01   +5.638618515046613e-01   +1.786387854943952e-01   +4.758910208067049e-02   +3.230807228818803e-01   +4.367780400759845e-01; -9.854153952907350e-02   -2.315190729060663e-01   +8.221403824357827e-01   -3.955190915940798e-01   +2.126040296423370e-01   -5.392268316020472e-01   +4.357906018175012e-01   -1.883017445528326e-01; -4.568727893376633e-01   -5.503329785016328e-01   -4.173672597969649e-01   +7.136705750692188e-01   +5.467855377215501e-01   +4.039585688028972e-01   +3.189842788613739e-01   +5.447212910205195e-01; -3.903488726727016e-01   +5.790260112517680e-01   -5.554174393390586e-02   +3.055611274498576e-01   -6.980268878245947e-01   +4.842416449180628e-01   +2.000573726934010e-01   +1.755640496017927e-01; -2.110886045264201e-01   -2.190020686789169e-01   -6.186122560031960e-01   +6.769364241721545e-01   -6.618137972737705e-01   -3.927563161565785e-03   -3.155429793230994e-01   -2.636559710974894e-01; +1.928212204738229e-02   -5.926660769206432e-01   -7.266313518387028e-01   +2.048515450149890e-01   -4.191331908121985e-01   -1.295010620481665e-01   -4.139674073875460e-01   -3.574066059320355e-01; -8.875508006788277e-01   -5.383315178519853e-01   -1.476937527370783e-01   +6.379446657974068e-01   -2.316796658483720e-03   -6.600984018995288e-01   -1.008404249819061e-01   +4.798235508810598e-01; -5.830050216192479e-01   +2.123522634486504e-01   +5.196207608559809e-01   +3.162494697979772e-01   +5.664543358741082e-01   -4.083055811855234e-02   -8.511062037362448e-01   +1.497944129743590e-01; +2.881072057315705e-02   -4.048968805048674e-01   +4.315779424360301e-01   -4.009552579569248e-01   -1.915336186094225e-01   -5.882448041417269e-01   +2.641913525875783e-01   +4.331746333060740e-01; -3.965058898895540e-01   +6.378516025761923e-01   +6.547186861150490e-01   +1.565284288981886e-01   -4.123887470612413e-01   -7.198619155703091e-01   +6.375635440077726e-01   -7.303071527433911e-01; +1.180428783410372e-01   -2.737785788512169e-02   +5.722331980368604e-02   +6.873046345365518e-01   +1.368614521007547e-01   -4.987662685353729e-01   +5.518761250537568e-02   +1.330735767469796e-01; +4.590048861190765e-02   -2.855065415968743e-01   +1.044845156000703e-01   -7.649910986176515e-01   +1.628027920609405e-01   +2.310215908337246e-01   -1.275778436715153e-01   +3.908466941911049e-01; -8.670393244933972e-02   +5.669666989317945e-01   +2.687637177170862e-01   -8.666496572961885e-02   +4.996795470450854e-01   +5.784334305490677e-01   -4.841106881968206e-01   -2.913593016262087e-01; +2.752414254554145e-01   +7.821512359346464e-02   +9.201563675761194e-02   +4.908361542247440e-01   +3.254419239684688e-01   +1.000000000000000e+00   +6.343979560572194e-01   -4.258380932161235e-02; -6.956849547479541e-01   +2.888024459145244e-01   +6.130788969058565e-01   +3.947165195163197e-01   +5.617878700863515e-02   -3.478696916273091e-01   -5.081078600270397e-01   +6.592644137878888e-01];
L1I_L2I_iGABA_netcon = [+4.035879519866260e-01   -2.698831790578590e-01   -4.168801824467182e-01   -6.123419538323969e-01   -2.986442914115665e-01   -7.052613889440366e-01   -8.611628643475980e-01   -4.598682595460560e-01   -1.226398301899503e-01   -6.871643236316087e-01   +7.307227310116327e-01   +7.052543483179469e-01   -4.667758372802571e-01   -1.033698908766084e-02   +1.301982727448699e-01   -6.862518913799865e-01; +3.104971009938955e-01   +2.016482532685180e-01   -1.271437394222918e-02   -8.174408433249067e-01   -9.109292579774696e-01   +2.078676924752838e-01   +3.274611026861509e-01   +2.091933679550770e-01   -3.350125668399478e-02   +2.095748498161601e-01   -1.246445917761572e-01   +2.709038039608225e-02   +3.284662943941313e-01   +3.694149901468883e-01   +5.314713885141166e-01   +2.838865515376699e-02; -4.948586003967357e-01   +6.553695371689622e-01   -6.323622873637175e-01   +5.028790818939413e-01   +6.564859851013024e-01   -8.953942975259803e-01   -6.841873615624021e-01   +2.367663991076953e-01   -4.401537836385563e-01   -7.801570949237144e-01   -2.133995372729120e-01   -7.241180222270718e-01   -4.783079787036977e-01   +1.000000000000000e+00   +5.951838505044577e-01   +1.212812403795528e-01; -5.304828862641232e-01   -4.496616865353288e-01   +1.333224044681366e-01   -4.551785515653049e-01   -1.685228617949876e-01   +7.334211525176662e-01   -6.678664514125014e-01   -8.519097795096132e-01   +6.668676525688101e-01   -2.194857918551748e-01   +2.243497023161873e-01   +1.750338710489693e-01   -4.182323294679426e-01   -6.515407044852594e-01   +1.358989251429555e-01   +4.970640214488876e-01; +1.848799284412003e-01   -5.072952560084174e-01   -3.898654030960281e-01   +8.907908269335122e-01   +4.492264917535398e-01   -4.270964937236170e-01   +1.074281763724738e-01   +5.353898925237631e-01   +6.536453631218991e-01   -6.742676736964905e-01   -4.650316511945048e-01   +8.101475577092910e-01   +6.472489363897956e-01   +6.338359272608911e-01   +1.604267890977178e-01   -7.068994463244246e-01; -4.153940285622281e-01   -4.845638560498601e-01   -4.536625844653718e-01   +1.135366722232267e-02   +3.146727902787012e-02   -1.951344225527036e-01   +7.504229200109991e-02   -6.896700756943529e-01   +7.453373014388479e-01   -2.114481463658764e-01   +2.578014377467776e-01   +1.873792319842372e-02   -3.252846501447786e-01   -8.444137485651518e-01   -6.878988326587979e-01   -2.744101330467592e-01; -3.091283696323390e-01   +7.439227476008799e-04   -3.950497782897904e-01   +9.133005258688301e-01   +5.074262037017767e-01   +2.235499875347224e-01   +1.686886524504185e-01   +4.397201081157197e-01   +1.338156287599740e-01   +1.622603823718863e-01   -4.154010381251881e-01   +1.316469476818548e-01   -4.195104923855940e-01   -5.391314504770499e-01   -3.061505444246179e-01   -5.110228423204435e-01; -4.131133269642438e-01   +5.136780854712467e-01   -6.477739953441966e-01   +4.057840750271111e-01   -5.372601218871228e-01   +6.182611460426937e-01   -1.857417245538028e-01   -7.677508791416190e-02   +1.902702713737104e-01   -6.154801486723814e-01   +8.331151300108286e-02   +6.631427701720354e-01   +4.770646388697853e-01   +9.638154660189602e-01   +4.387236127408851e-01   +2.567974488754496e-03];
L2E_L1E_iAMPA_netcon = [+6.238025769724126e-01   +4.694138428637986e-01   -6.821306649321532e-01   -7.869467453864892e-01   +2.416327736894797e-01   +9.449108934141731e-01   +7.454292402829283e-01   -4.563381084004388e-01; +7.251162413907528e-01   -2.127633207076785e-01   -8.773320788932104e-01   -1.166980139347161e-01   +2.374455663257982e-01   -1.631625433931803e-01   +8.413143809192272e-01   -7.294635058308161e-01; -3.396048487002695e-01   -7.508689033193422e-01   +5.714067704076939e-01   +4.104947193560196e-01   -2.036891195522392e-01   -3.268161491937024e-01   +7.275275801360803e-01   +5.014873546065195e-01; -8.081243729931171e-01   +7.276262670794494e-01   +7.864802844680169e-01   -9.602728957876404e-02   -1.243881371975274e-02   -1.632081847673646e-01   +6.014339123731894e-02   +1.984941535426951e-01; -1.001515826204194e-01   +1.022077061241010e-01   -3.553013448905857e-01   -2.966590120184785e-01   -4.119904996845554e-01   +1.751063348551590e-01   -5.798802617224671e-01   -2.145040281623590e-01; -1.309370299182600e-01   -7.069959485845108e-01   -4.532677799897707e-01   +7.011354200278337e-02   +5.354399827264198e-01   -5.122504314588024e-01   +7.792185465642043e-01   -1.937653649584651e-01; -5.409040984386424e-01   +7.931685967855506e-01   +4.733475773803108e-01   -6.231223351213776e-02   -8.966690379720571e-01   -5.424456652915727e-01   -8.770695648251847e-01   +5.467077763314964e-01; -7.201757446843836e-01   -6.125882136940601e-01   -7.536731569837105e-01   -6.096118299656457e-01   -4.853729246186063e-01   -1.771141707824453e-01   +9.637751664436683e-01   +1.289079225816177e-01; -1.020414689799902e-01   +5.013264182268623e-01   -1.780208602163429e-01   +8.408143094581536e-01   -5.531700746118277e-01   -6.415773457698750e-01   +4.958839147107694e-01   +4.159282893297092e-01; -5.693946290765710e-01   -5.644901980339816e-01   -6.375415728919543e-01   +7.630257674020344e-01   -8.449106911850793e-02   -4.451276456479268e-01   +5.009276810032178e-01   -9.025705039692533e-01; -6.990556274249070e-01   -5.280151339680867e-01   -6.168275442638055e-01   +4.500251571100554e-01   +6.978232322067237e-01   -3.560717442540733e-01   -1.026364788938396e-01   -4.830391238505233e-01; -8.010102512219047e-01   -6.206936598331375e-01   -4.297151385469560e-01   -8.403644104549556e-02   -4.565747926753954e-01   +1.000000000000000e+00   -6.924473625011369e-01   -3.883666193934370e-01; +8.864354949755573e-02   +6.567652716536423e-02   +5.827807232641947e-01   -1.603514287066151e-01   -9.633161230876828e-01   -2.912937239101930e-02   +2.012210127405277e-01   +3.953380054836145e-01; -9.865331388721736e-01   +3.197055852668322e-01   +6.201924040771640e-01   -1.980202955318995e-01   -2.084403514384980e-01   -6.545505363151543e-01   +1.539715673740059e-01   -5.522027664964824e-01; +5.832503534045229e-01   -3.888237214428092e-01   -5.135973074005461e-01   +6.811298626267686e-01   +7.890380212975378e-01   +7.624885727487107e-01   -9.163507163634594e-01   +2.488776620295369e-01; -7.204534592581592e-01   +5.900836328582318e-01   +8.391846292963305e-01   -7.473720758522432e-01   +4.104481566887865e-01   -2.478551287695570e-01   -4.454065130909719e-01   +6.372030885959596e-01];
L1E_L2E_iAMPA_netcon = [+7.683108880408879e-01   +7.129039567746186e-01   +2.963959456412358e-01   +5.816648410438888e-01   -1.542388490544757e-01   +8.526728989561076e-01   +2.594553662325566e-01   +6.169277721251516e-01   +6.926659509579860e-01   +1.025077031265051e-01   -9.252767094769816e-03   +4.080806774590415e-01   +4.444813095288523e-01   +7.025417245730181e-01   -2.329555502905208e-01   +5.425770940666790e-01; -5.672016827555487e-01   +2.153963485400971e-01   +4.436887535955311e-01   -2.838604342510527e-01   +4.202065154945234e-01   -2.853407685647910e-01   -8.371004743113134e-01   -4.860244340989998e-01   -9.203807214986143e-01   +3.971366454107551e-01   -2.095140287057847e-01   +1.822787663687128e-01   -5.186788335415796e-01   -2.205122988211957e-01   +5.262365106255416e-01   -3.935838245605042e-01; -5.237939367033796e-01   -7.674826917663055e-02   +4.927516675479913e-01   -2.231712218574084e-01   +4.174446100135990e-01   -2.910326540577852e-01   +1.080288895904763e-01   +5.433373941252347e-01   -4.449561311613769e-01   -8.144347848827302e-01   -3.924022920218821e-01   +6.756379815252020e-01   +5.922569658299710e-01   +6.813222745332846e-02   +1.911273177398139e-01   -2.644264250315809e-01; -1.624150484199908e-01   -1.881841359355620e-01   +5.555433169365143e-01   -2.897778034276950e-01   +8.044152177568841e-01   -3.655654936429382e-01   +1.820193510808605e-01   +7.403076549622410e-01   +3.052787974042763e-01   -6.037736930961416e-01   -2.997228649207209e-01   -7.113574115173706e-01   +1.098881270848635e-01   +6.213983641401854e-02   +2.714767847347780e-01   -5.805122756949436e-01; -6.237439843420630e-01   +1.569635424173635e-01   -1.612670493563844e-01   -8.792247869884976e-03   -2.934394912390606e-01   +1.949915075019568e-01   +2.182689137163679e-01   +6.248153774192570e-01   +2.584571125264148e-01   -2.751027440554756e-01   +9.318585859025369e-02   +3.743157208773470e-02   -2.735583621513231e-01   -1.570667263257129e-01   +6.061687998218858e-01   +5.703634111891480e-01; -6.025335062440302e-01   -4.266566232629279e-01   +6.858936315756363e-01   -3.833131816005548e-01   +7.454790910324044e-01   -1.615678927579148e-01   -5.573130489611290e-01   +9.557824362199857e-01   -5.399699834068373e-01   +9.195902735719853e-02   +1.000000000000000e+00   +8.371931922130621e-01   -7.199440195303550e-01   +6.324590110595099e-01   +1.919476550206331e-01   +6.428445490799963e-01; +8.119992654439986e-01   -7.376273250308918e-02   +7.417816723140396e-01   -7.789924911224317e-01   +2.506930221416661e-01   -4.585595653517777e-01   -8.607707444882116e-02   +3.155474605223715e-01   +2.813103103301892e-03   +5.645222381459808e-01   -1.433068095473464e-01   -4.098272242838849e-01   -1.716873834470583e-01   +2.733185166917356e-01   -4.832414021757508e-02   +4.713688436095419e-01; -7.839860909791513e-01   +4.742463456288462e-01   +1.502278388827379e-01   -1.384606085274468e-01   +3.957607035854394e-02   -2.148563582460053e-02   +3.892760319698333e-01   -8.395994347077975e-01   +9.974610854725478e-02   -2.882399749435763e-01   +3.731424497402562e-01   +7.980789417377082e-01   -2.011527524126823e-01   +7.647496658362202e-01   +6.941713339923228e-02   +1.216024298991854e-01];
L2I_L2E_iAMPA_netcon = [-4.812926690804593e-01   +1.379879110355803e-01   -1.306423097619943e-01   +6.728424273721576e-01   +2.159310547638514e-01   -5.045521060191083e-01   +3.245923754256962e-01   -7.206801073498297e-01; -5.871004794634057e-01   -1.585253053093345e-01   -1.395776646261020e-01   +1.000000000000000e+00   -4.485970218686062e-02   -3.830801051581764e-01   -4.686404271842314e-01   +6.733647867525824e-01; -4.648671761228869e-01   +5.824008304106307e-02   +5.572475888974820e-01   +2.038233760347688e-01   +2.698101285998943e-01   +2.733681752963764e-01   +3.229163987623342e-01   -2.475784857296011e-01; +3.035915208660802e-01   +2.007954176456128e-02   +1.540432495640769e-01   +8.111468966896306e-01   +7.273341495204270e-01   -4.553624068545988e-01   +1.195959739427321e-01   -5.961026083769897e-01; -1.909723570821694e-01   -6.177345675464984e-01   -4.187447296987709e-01   -7.457940902208605e-01   +2.647814558853271e-04   +2.985135371469111e-01   -7.504168903258176e-01   +1.192109051559870e-01; +4.538686224648772e-01   +2.670029244546259e-01   +6.401403343223654e-01   -5.528754397916575e-01   -6.414723468244564e-01   +8.225221113309227e-02   -4.976063487948079e-01   +9.346281828361338e-01; -3.506030904637676e-01   +4.527486834958615e-02   -6.344323208070576e-01   -2.419357690822656e-01   -7.204269830329715e-01   -6.373116562568966e-01   -6.586681760167827e-01   -6.742666370300386e-02; +6.814950416177920e-01   +1.349017561296880e-01   +3.594049425638678e-02   +2.346390125911293e-01   -5.809570461551333e-01   +5.916623871249368e-01   +4.561342250214275e-01   -6.450809546123322e-01];
L2E_L2I_iGABA_netcon = [-8.741546525301500e-01   +4.744065722521466e-01   +9.879506584331686e-01   -5.085032924777017e-01   -4.840832022578038e-01   -9.976532261621983e-02   -9.316266659415467e-02   +3.740548691326326e-01; -2.216892419764029e-01   +1.000000000000000e+00   +4.496492251889699e-01   +3.894445826602256e-01   +6.515705258742213e-01   +3.189841633042428e-01   -7.726897767944086e-01   +9.466589058146768e-01; +7.289839759286494e-02   +4.322504915280401e-02   +4.096492026880358e-01   -1.842978548918750e-01   +2.185636107453734e-01   +6.961386197201833e-01   +8.294182229326833e-01   -4.074266908402261e-01; +1.212220999109940e-01   -8.450420988578000e-02   -6.818994619562206e-01   +4.014995881185123e-01   -4.376093816968038e-01   +8.619121937008991e-01   -9.290119733427363e-01   -4.652821092079242e-01; +8.254718076705037e-01   +2.175390082414517e-01   -5.664519216673215e-01   -9.353378079833616e-01   -7.536591180126321e-01   +4.735511591976281e-01   +5.321729315623815e-01   +7.190997349525270e-01; +1.983328707400159e-01   -9.527368978670397e-01   +7.830143922633076e-02   -6.990483324515830e-02   -4.358590448157900e-01   -1.008333220762222e-01   +6.013600705098482e-01   +9.182538316276986e-01; +2.959656283654254e-01   +5.320814738676413e-01   +2.737058400333550e-01   +9.576210362704080e-01   -1.612415755812874e-01   -1.329714969721392e-02   -1.754725048500804e-03   -9.485424717956044e-01; +2.931167156068272e-01   -9.189363274607881e-01   +3.853439933679798e-01   -4.549439866439404e-01   -9.811300792465878e-01   -3.253927243252518e-01   +8.695989036376189e-01   -8.280079134895023e-01];
L3E_L2E_iAMPA_netcon = [-4.122790346320577e-01   +9.105582911151269e-01   -5.317564420155076e-01   +2.917047177945276e-01   +8.353631047654918e-02   -7.330421620293371e-01   +7.456524416959041e-01   -7.474305316212718e-01   +1.686172113983403e-01   +8.775382140011811e-01   +3.425397196062039e-01   -2.503619067343347e-01; -1.189303176647470e-01   +5.620199637432990e-01   +7.257255520203361e-01   +5.733793902107189e-01   +6.489935828634636e-01   +7.389749815687596e-01   +3.038553173273281e-01   +8.035596008739372e-01   +7.066801411002060e-01   -5.807797933025384e-01   +2.534612259981149e-01   +5.273965667962838e-01; -2.944373981200001e-01   -3.177234347076248e-01   +6.700834639784962e-01   -6.660930276751970e-01   +3.421676993005371e-01   -3.137789493074857e-01   +4.037466475830454e-01   +7.821689229730818e-01   -7.944472475137515e-01   -7.103793674033385e-01   -2.361882102407603e-01   +9.285870627805197e-01; -4.204673357319158e-01   -5.830577173109086e-02   -2.528867198876246e-01   -6.661854217565958e-03   -2.456615021326155e-01   +7.023880773074846e-01   -5.876613212107937e-01   -4.148737984909287e-01   +7.211447129350703e-01   -3.641720012880684e-01   -8.055862792992732e-01   -5.572266589415099e-01; -4.334349490004979e-02   +4.738132050999522e-01   -8.486854270128226e-01   +8.822619134252453e-02   +3.903945248844026e-01   -6.324639529091828e-01   -2.924492969338467e-01   -5.961681922192267e-01   -1.094773112292819e-02   -2.666103627082816e-01   +7.455042530605022e-01   -5.842240203424572e-01; -1.704668612242357e-01   +2.084233862758775e-01   +4.443368948040086e-01   +3.746762428788118e-01   -5.379909063514760e-01   +7.641604695362698e-02   -7.678996989436870e-01   +2.577020079639618e-01   +3.442043300883156e-01   +3.195320691268690e-01   -5.308274842215126e-03   -6.943523934281901e-01; +4.058593361362619e-01   -7.522851982898043e-01   +1.000000000000000e+00   +2.337593400741766e-01   +4.969017456419409e-01   -2.099736240654115e-01   +3.071036685956767e-01   -4.447431510496907e-01   -3.300796215494070e-01   +2.479242613096914e-01   -4.266870398146616e-01   -2.300055905309554e-01; -3.900662286453342e-03   +2.099300031498193e-01   +1.150219736679098e-01   +5.449432551457508e-01   -3.842274411171568e-01   -6.032145779520826e-01   +2.771829797848970e-01   +2.856778049527371e-01   +3.904354855463667e-02   -2.055545902125051e-01   -3.569272551898360e-01   -9.054296026731452e-01];
L3I_L2I_iGABA_netcon = [-8.387710310155407e-01   +4.299302292325995e-01   -5.603924992485896e-01   -2.687743669185576e-01   +7.843357206616919e-01   +2.607289682866430e-01   +3.753511918225969e-01   -3.562469617521524e-01   +8.132156548895066e-01   +5.655764660266949e-01   +2.062481767335296e-01   +3.563328194727094e-02; +3.423345943681855e-02   +8.482154488247047e-01   +1.911759933480646e-01   -1.000000000000000e+00   -2.292568236153077e-01   +1.222326012781926e-01   -5.170833454720055e-01   -4.497686084921180e-01   -3.048211879060532e-02   +5.423405829462495e-01   -1.343350964949046e-02   +2.841565608290009e-01; -3.182833923514814e-01   -4.365349482207069e-01   -9.966261255706333e-01   -5.103383970783661e-01   -3.277798717448255e-01   -6.384225914352801e-01   -7.773382563290797e-01   +1.713173206637736e-01   +1.794304358754872e-01   -6.593249444565102e-01   -4.039139330502463e-01   -7.206148662882248e-01; -1.273259597260641e-01   +4.604514393041609e-01   +6.238212075185083e-01   -3.602038431449577e-01   +9.059701876215249e-01   -1.771249007321975e-02   +6.726984042099790e-01   +4.580183359826582e-01   -1.665511032302577e-01   +5.972012541858799e-01   -2.872301996086211e-01   -4.094097541397076e-01; +7.896561061562047e-01   -7.064288220276872e-01   +1.928127118566649e-01   +6.068104939556763e-01   +4.553999386269302e-01   +1.165524309677727e-01   -1.110023975308202e-01   -5.019944915830141e-01   +7.202941924641735e-01   +4.465138714705348e-01   -7.203764724923962e-01   -2.196578584187316e-01; -5.553508730788008e-02   -6.629869704666738e-02   -9.576152026876354e-02   -7.428314669182698e-01   -5.250261596660146e-01   -1.739228438639126e-01   +3.609493633002314e-01   -1.806637535187225e-02   -6.410899891905197e-01   +5.520249573019282e-01   +1.981042172119303e-01   -9.231436009381248e-02; +5.729160397414775e-01   +4.051152334798668e-01   -5.073736133475533e-01   -6.130101136332863e-01   -7.308599942851582e-01   +2.678291468893382e-01   -2.106439023736158e-01   +6.615989130660643e-01   +6.972747506011795e-01   +2.781899911151697e-01   +4.181589661491799e-01   +4.730382336361892e-01; +1.729393639495289e-01   +6.375192751479564e-01   -7.192864527986281e-01   +2.592022491931445e-01   +1.412967841813494e-01   -6.275657687252661e-01   +1.646983137765626e-01   -1.051038443801459e-01   +4.248243644559118e-01   -7.705318347321477e-01   -7.124184447053637e-02   -7.376382414809458e-02];
L2E_L3E_iAMPA_netcon = [-4.692184703540201e-01   -2.919467799130284e-01   -2.407577048871220e-02   -4.732417867112316e-01   +7.195896040650829e-01   -1.520449825967189e-02   -4.923324125010294e-02   -8.804125978650623e-01; +2.786519718476133e-01   +6.095180073323873e-02   +5.736796842687750e-01   +2.753094954915778e-01   -2.154100666901301e-01   -2.430433844148458e-02   -5.552664109231497e-01   -7.353949010940239e-01; -4.149142162113381e-01   -2.959619758591105e-01   -9.176642053256763e-01   +6.468915379955301e-01   -1.074362719727186e-01   -5.975694087126537e-01   +2.826502032697784e-01   +2.826548733491182e-01; +4.680715758179091e-01   -1.988508056315673e-01   +2.529344984623231e-01   -4.842417160943794e-01   +1.131033906724982e-01   +2.051531866308261e-01   -4.783032862002486e-01   -5.601418300074551e-01; +3.313151207702902e-02   -4.006024791804498e-01   +4.500354751477260e-01   -1.000000000000000e+00   -2.396945838085597e-01   -3.463702793041006e-01   +6.608126802234401e-01   -6.961670144199708e-01; -6.647041165948911e-01   -1.706484829899532e-01   +6.594649667560675e-01   +5.150914193872402e-01   +1.730170586849757e-01   -6.955821484656923e-01   +4.288248661624396e-02   -2.050561616652678e-01; -7.872110930170888e-01   -9.761140964508079e-02   +9.063183491494660e-02   -7.446849913835019e-01   -1.418769749782538e-01   +7.983000047246940e-01   -3.887956970193611e-01   +5.664183220001442e-01; +1.737803106057557e-01   -7.794394478995326e-01   +8.853989488368249e-01   -5.699804753624013e-01   -5.548830838259650e-01   -4.250925267785035e-02   +6.305639815779129e-01   +5.653413048062388e-01; +1.540919901985160e-01   -3.882167432428146e-01   -1.911993792104638e-01   -2.932721662457448e-01   -3.802294018552091e-01   +7.304103740790059e-01   -7.045449767327546e-01   -1.809721850104609e-02; +3.078175984185128e-01   +8.566976537065188e-01   -1.221841778374397e-01   +4.873280621811533e-01   -5.005734804414449e-01   +1.692077483671619e-01   -5.071551331589969e-01   -4.932887929760733e-01; -5.375344732359268e-01   +3.323312108800162e-01   -7.938731983803248e-01   -1.659942371651116e-01   +2.100377249230614e-01   +2.177388042673332e-02   -4.266266468465522e-01   -4.295732289870060e-01; -5.877457922675096e-01   +4.142357478719598e-01   -3.782724410390689e-01   +6.493789492099912e-02   +1.886147952442069e-02   -7.637799102784941e-02   +6.920636535649770e-01   +1.916448192559834e-01];
L2I_L3I_iGABA_netcon = [+6.548366235587907e-01   -1.827431438551574e-01   +4.963866809753028e-01   +2.060611314978178e-01   +3.169786653396720e-01   +2.444895856880925e-01   +4.088243719968215e-01   -2.914879264013610e-01; +1.000000000000000e+00   +7.270272176132747e-01   +4.179162163441665e-01   -4.204741544124400e-01   -1.311426387102033e-02   +4.712070140056001e-01   -2.863063199885438e-01   +2.528319416285043e-01; -1.466310515105624e-01   -4.958915154437765e-01   -5.406410994420671e-01   -5.936270279554615e-01   -4.074313820666875e-01   -4.892311453508395e-01   -6.361288198668970e-01   -5.341695339694037e-01; -3.968444800423956e-01   +5.891087191613332e-01   -9.317928393418885e-01   -5.176052090469172e-01   -3.477606998352527e-01   -5.746960649269319e-01   -2.172174747053877e-01   +2.051043208571214e-01; -1.278260855659581e-01   -1.546088536380872e-01   +3.647709405446656e-01   -6.493037339508129e-01   -1.215065088107421e-01   -4.950056578638041e-02   -1.614344499356497e-01   -1.639586007553180e-01; +3.900907420508256e-01   -4.316771479841889e-01   -5.751293812521525e-01   -1.174385155742928e-01   -3.206642726399853e-01   -2.166505563655316e-01   -6.926991349767677e-03   -3.495802742631959e-01; -6.857808729183430e-02   -2.443523212631830e-01   -2.265601221055373e-01   +6.442471174946554e-01   +2.981474609880539e-01   +2.783519397804235e-01   -6.569919441005925e-01   -7.593956189896957e-02; -5.182585325500156e-01   +2.794726385861699e-01   -2.413845247832789e-02   +4.627409514085662e-01   +2.139930557642000e-01   +1.198671606467772e-01   +7.525585535226866e-01   +3.429074206515460e-01; -1.725034032874875e-02   +5.972393082118881e-01   +3.399904111324051e-01   +2.124734342687103e-01   -7.291795508466110e-02   +2.889250870013989e-01   +5.571587118562477e-02   -3.069775409902817e-01; -5.611532857369014e-01   +3.705324944580144e-01   +2.868536790670583e-01   +6.540570753649624e-01   +7.519998995055994e-01   -2.256767545879182e-01   -6.142472591695015e-01   -4.538289398285489e-01; -2.319553619740880e-01   +3.842898557691036e-01   -2.924292635106316e-01   +2.405900131740909e-01   +5.700060470170785e-01   -4.316278730809118e-01   -3.990199658206404e-01   +3.492905729508676e-01; +1.939100807330963e-01   -4.821878797985963e-01   +2.838743087492112e-01   -6.859677209628445e-01   +3.831170921683039e-01   -4.275987518983682e-01   -5.658835650889807e-01   -2.930963246139266e-01];
L3I_L3E_iAMPA_netcon = [-3.063499240128476e-01   -3.603105690804081e-01   +3.891558658684225e-01   -8.209883487208339e-01   -7.497541739770428e-01   -4.377873785306665e-01   +1.050882761088756e-02   -7.243262799238787e-01   +4.067603470414720e-02   +2.197291183941241e-01   +4.039491080867034e-02   -3.339083618725015e-01; -7.287724324013459e-01   -4.964426776239633e-02   -4.736574205513812e-01   -4.328087307874318e-01   +2.833472409654510e-01   -5.776382766220338e-01   -4.464671991781716e-01   -5.284388541656507e-01   -6.795016526497613e-02   +4.599636325316041e-01   +5.876576447498139e-01   -6.481176607003084e-01; -2.138517173069300e-01   -3.413840532059638e-01   +5.690804578600465e-03   +5.216721620923098e-01   +7.238591034351330e-01   +6.447333388608042e-01   -2.542712529596955e-02   -4.339514227866399e-01   -1.836991410131613e-01   -1.652996787507373e-02   -6.880919186781762e-01   +7.834830019221298e-01; -2.401602120638333e-01   +9.821957149267971e-02   -6.379282331459601e-02   +7.395518384416166e-01   -4.094779263987033e-01   -3.457921328632584e-01   -6.792738117602756e-01   +8.027855718323011e-01   +7.202823124410113e-01   -9.977887291761031e-02   -4.059890777345699e-01   +6.044799598151337e-01; +6.029198205990549e-01   -4.932337999387985e-01   +3.027147692781115e-01   +5.415131953189724e-01   +5.992696892761999e-01   -5.436797193652644e-01   -6.073800436343179e-01   +3.695184848424587e-01   +3.386494323236124e-01   -2.558027396838026e-01   +7.295964355665551e-01   +7.532801667126147e-01; -4.460487954705747e-01   -6.941562582635581e-01   +1.665629750292393e-01   -1.201339695035242e-01   +4.915013659711670e-01   -1.386281652033293e-01   -3.405042444014849e-01   +2.599236510212444e-01   -4.234381657539193e-01   -2.872717363335863e-01   +2.641925766986921e-01   +3.209984497210931e-01; +6.118347393133294e-01   +7.055862045987916e-01   -7.360492036900861e-01   -1.279463386401372e-01   +5.462542661846940e-01   -2.448876789177072e-01   -6.389872946573985e-01   -2.818326598644457e-01   +5.175231522042644e-02   +7.948028308765900e-02   -1.136388102484940e-01   +2.666247157846195e-01; +7.339182039214591e-01   +3.788329341125865e-01   -2.811501663537050e-01   +5.978304078493465e-01   -6.994431490145024e-02   -1.366985893217825e-01   -5.730118953304633e-01   -8.183143284031781e-02   +2.169235654226515e-01   +3.831322133009398e-01   +4.982686875944800e-01   +3.887058898487191e-01; +2.410377077414524e-01   +9.454542217116906e-01   -9.528822929107593e-01   +8.202216797500197e-01   +2.530058810037500e-01   -4.236193439250229e-01   -7.697312474189640e-01   -7.257118338639127e-01   -7.531181564015255e-01   -4.740163812094404e-01   +1.478615534518634e-01   -4.594370415371359e-02; +3.554862065696367e-01   +5.659597124721271e-01   +6.971253264425691e-01   +5.143640788063338e-01   +2.986309996884378e-01   +5.181741988814340e-01   -3.599728392549317e-01   -3.589058237563068e-01   -1.446533800810324e-01   +6.609131403278253e-01   -1.000000000000000e+00   +4.442104247383746e-01; +8.552790733335428e-01   +1.621672523496747e-01   +2.336598027443551e-01   +8.463477651270139e-01   -4.908958181800427e-01   +2.071841806621593e-01   +7.869428843191288e-02   -1.605757257773941e-01   +3.791513811036100e-01   +7.121341552465964e-01   -2.107841416193531e-01   +7.490172265555335e-01; +2.035348870766599e-02   +4.574741399370086e-01   +4.117770564749184e-01   -1.845592620636340e-01   -1.587512483347088e-01   -1.735482712657509e-01   -5.531826252815460e-01   -5.894651382086020e-01   +1.083259771478938e-01   +6.595725470539573e-01   +4.142405036011810e-01   +3.569845923100810e-01];
L3E_L3I_iGABA_netcon = [-8.622911466988118e-01   +3.680522618267764e-01   +2.928810027018454e-01   +9.026589419314166e-01   -3.239542257642676e-01   -7.812898321371844e-01   -9.866163919511768e-01   +6.299115591946628e-01   +4.484931058018549e-01   -9.286335330891263e-02   -4.246720726303317e-01   +4.840599223064448e-01; -2.144371461678257e-01   -9.844265028166954e-02   +5.756216983869026e-01   -7.488238266536573e-01   +3.622968789334551e-01   -5.028949178286924e-01   -3.253057578608642e-01   +8.514571280598397e-02   -3.241901301324343e-01   -6.548551294166208e-01   +3.617632053711198e-01   +2.237992493270382e-01; -4.298600014860123e-01   -4.088840905830989e-01   +1.652665557710810e-01   -3.767583833577111e-01   +1.553344285016475e-01   -1.000000000000000e+00   -8.198036320480164e-03   +5.464020939229769e-01   +3.379004517031358e-01   +6.147206049796771e-01   +2.365001531183957e-01   +3.277176430060224e-01; -7.279579762544631e-01   -3.514961655620708e-01   +7.577004041697030e-02   -2.903598230269408e-01   -3.181089328684947e-01   +7.994762363069613e-01   -6.290701816327896e-04   +6.091829639273175e-01   +7.905688940473623e-01   -1.510614914162005e-01   +9.463784094643765e-02   +6.424985030715626e-01; +5.141152232873439e-01   -2.361708289871686e-01   -6.327297317330846e-01   -3.606867028843593e-02   +2.745442100399540e-01   +4.727324016963760e-01   -6.698578556339658e-01   +1.822624905929534e-01   +1.324316616250100e-01   +9.306855126674701e-03   +6.694098148237635e-04   +6.802214548524671e-01; +5.855858353317157e-01   +5.171480530559511e-03   +3.689646098562395e-01   -5.426962668866603e-01   +3.065952437815220e-01   +7.845216656518881e-01   -5.167454080098478e-01   -9.601488106100375e-02   +1.964419507620948e-01   -7.271015425095224e-01   -5.805623805685295e-01   +7.126141170274489e-01; +4.166628395322622e-01   +5.863268145385778e-01   +4.456995663932767e-01   +2.404932262097621e-01   -2.545213007954488e-01   +1.480410365416738e-02   -3.134060972397559e-01   -2.087715021310401e-02   -4.737501664483890e-01   +2.923667712154072e-02   +6.444002919392218e-02   +7.910673566887721e-01; -8.172059982086753e-02   -3.280233128466816e-01   +2.848294240497292e-01   +8.290459468815209e-01   -1.735073437741204e-01   -2.105325074029557e-01   +3.281149177369177e-01   +3.523173937376925e-01   -2.839039905738356e-01   -5.287912803684609e-01   +1.122587531589063e-01   -2.697247224154741e-01; -1.917400523653194e-01   +3.264869632175467e-01   -3.454862522386111e-01   +7.751307549295936e-01   -8.455966450825880e-01   +3.308979805111111e-02   -7.186023283890990e-01   -4.009506746182552e-01   +9.359392466244360e-03   -3.937029175207653e-01   -2.340693688134659e-01   -5.242237718082987e-01; -2.428584916061676e-01   -6.547600230880029e-01   +6.600890413177608e-01   -7.170817094721628e-01   -5.690100473733233e-01   +2.790288305656386e-01   -1.533097781406549e-01   -6.283425826587427e-01   +2.005872597977446e-01   -2.469027168914978e-01   +7.882497431361184e-01   +6.415316972718721e-01; -2.021939907729289e-01   +3.287633503195517e-01   +6.707481371792692e-02   +7.824318603599911e-01   +5.103066442055404e-01   -2.742840472233048e-01   +7.097898007495727e-01   -6.312102805175808e-02   -2.473623982949118e-01   +2.565979386293473e-02   -7.475565342252358e-01   +3.108112509563399e-01; +4.350888925313690e-01   +9.891105783071070e-01   -4.627008098767958e-01   +1.569425079082782e-01   +4.233481007205205e-01   -3.572101874346610e-01   -4.112846309632429e-01   +3.798198409823659e-01   -5.330766253205864e-01   -6.898210285950159e-01   -5.732103670855543e-02   +5.804248817430217e-03];
L2E_Input1_iAMPA_netcon = [+3.516242445447148e-02   -4.239492994886192e-02   -4.343890002021099e-01   +1.869851984451354e-01   +3.194344866105485e-01   -2.196636810113133e-01   -3.108043569622046e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+5.933162477915308e-01   +1.000000000000000e+00   -4.799221355566205e-01   -7.192844530438895e-01   -3.293131816018206e-01   -3.969105279764782e-01   -1.308762079746127e-01   +6.711001987031400e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
