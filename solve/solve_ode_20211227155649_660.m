function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.772709955583969e-02   +5.429786122297348e-02   +4.515253896922905e-02   -1.314295371685498e-04   +5.368221662364741e-02   +8.805968956995761e-03   +3.630871486269178e-02   +3.552184741525648e-02   -2.917480703052107e-02   +1.911685497596700e-03   +5.054075603443810e-02   +8.055047564823258e-02   -7.259176152722720e-03   -1.936916909047347e-02   +8.905773164263635e-02   +2.742517972261484e-02; +2.619248072367935e-02   -6.185788652636454e-02   +1.161220824098189e-02   +1.163919106957261e-01   +7.119750220081518e-02   +8.938757927465592e-02   -5.509991512181550e-03   -6.489695152866313e-03   +3.696300513114806e-02   +3.913001887604715e-02   +4.048850848548929e-02   +4.919111922708091e-02   +7.691757119571600e-02   +4.370857100488949e-02   -2.144844843627692e-03   +3.144854135089181e-02; +4.410236190406151e-02   +5.385308229971862e-02   +3.040609885370004e-02   -8.803686501526020e-03   +1.059963340557160e-03   +5.070453557890542e-02   -1.304832724278795e-02   +1.113039497632068e-02   +2.741898960273322e-02   +6.135486787498474e-02   -7.758046730815239e-02   +6.217226974155003e-02   -1.568476745684030e-02   +5.802017733531833e-02   +4.873721199265295e-02   +3.280159148956258e-02; +3.270664660794188e-02   +1.113674630454351e-01   +3.586696668081010e-02   +7.702227149565519e-02   +6.905861003922249e-02   +5.865616003065661e-02   +2.019754508666469e-02   +4.058612021420011e-02   +6.016534099752060e-02   +2.771950616730225e-02   -3.594104652121816e-02   -4.538558273878560e-02   +4.344116862066594e-02   -7.489265190694491e-02   +6.397674074522368e-02   +8.048456887355214e-02; +2.995481676975293e-02   +3.758397003435109e-02   +9.275211254427920e-02   +5.596572225587783e-02   +3.174165853773868e-02   +7.356020362690799e-02   +4.868449431042782e-02   +5.297876865550574e-02   -4.988918598419496e-02   +4.174139738824112e-03   -3.634709796779372e-02   -4.034350803742838e-02   +3.629341565619791e-02   +8.661500186112754e-03   +5.245351013093932e-02   +9.658438301906933e-02; +8.010796552290289e-02   +9.293315244724916e-02   -4.463234712487640e-02   +5.454964961648407e-02   +4.320015591609348e-02   -3.709644513296887e-03   +7.268785995680280e-02   +4.553304068867671e-03   +2.732475711597035e-02   +2.319652492581806e-02   +1.413588386843905e-01   +1.029434206973035e-01   -6.047193440869353e-02   +1.107576448093375e-02   +3.175483599949926e-02   -1.301621204780674e-02; -4.086448095426613e-02   -5.225877677376363e-02   +7.348135068393845e-02   +6.135177391811597e-02   +5.728570117082709e-02   -4.768863789644866e-02   +1.005582481672352e-01   -1.178341275174109e-02   +1.371077456428097e-01   +6.589697991383855e-03   -4.957698694760126e-03   +5.388507652971081e-03   +5.071572015165893e-02   +7.959067357537028e-02   +1.137776044607901e-03   +8.670344727623572e-02; +3.001455898398763e-02   +8.226390051490300e-02   +2.524172353234352e-02   +1.955933551573086e-02   -1.308953419796873e-02   +8.244925001077540e-02   +6.498085614058716e-02   -1.469918924307367e-02   -7.642498711342721e-02   -8.209091328047495e-03   +8.814396181261476e-02   +2.534920236842529e-02   +2.897797489817823e-02   -1.422330957172361e-02   +1.673184229874117e-02   -3.932091238528662e-02; +5.704868548602017e-02   -4.860293978384167e-03   +1.978008135919028e-02   +1.835287155288828e-02   +7.133138556558709e-02   -2.757584027311012e-02   +1.023023693831739e-03   +1.211273925689396e-02   -2.678702388973823e-02   -2.485321099326206e-02   +1.111568848603951e-01   +4.462599178054865e-02   +5.836453799915486e-02   +4.581105417078782e-02   -1.206880734603591e-02   +7.691600707114010e-02; +5.806770302496467e-02   +1.104120736814568e-01   +5.664110639703514e-02   +5.724596020000133e-02   +3.241786509272561e-02   +1.042642419022337e-01   -1.726069619861964e-02   +2.312038064479407e-02   -1.930493661823783e-02   +7.143154137083484e-02   +1.045315956570848e-01   +9.516030458557109e-02   +1.303413098180397e-01   +2.388898047520108e-02   +2.358960556872649e-02   +3.613365243417861e-03; +1.520552664087430e-02   -2.198274809442923e-03   +4.349883549119181e-02   +1.692449033048831e-02   +3.855958621535405e-02   +1.135288231081505e-01   +6.103960364208897e-02   +6.420907797772416e-03   +6.471347867653998e-02   +2.281666587818872e-02   +6.722112774169257e-03   -3.565451303817614e-03   +9.786622290866601e-02   +4.554063028227681e-03   +2.772444647492465e-02   +2.337368110489907e-02; +1.762339528441176e-02   +6.147995853851142e-02   +2.128976432729292e-02   +3.141069498289497e-02   -1.612317682626987e-03   -2.071788612279887e-02   +7.300048118298989e-02   +4.827013722459630e-02   +1.085511413966401e-01   -4.306528575670368e-02   +9.760711276393352e-02   -1.702167122297339e-03   +2.157000892249191e-02   +6.285408012327186e-02   +8.876712923825265e-02   +1.059362966085208e-01; +9.828938886176494e-02   +7.415723164511284e-02   +1.229695024132402e-02   +1.586241677654123e-02   +3.158002000455026e-02   +2.390991655636344e-02   +6.594022348192516e-02   -1.950144311801914e-02   +2.378862736038549e-02   +5.600530644418424e-02   +6.389718900640963e-02   -1.988937146226677e-02   +2.585514144328048e-02   -1.108691952112973e-02   +6.400047801453146e-02   -6.673248006845478e-02; +9.833081678323187e-02   -2.432529767881540e-02   +5.049862701569374e-04   +8.041499803217304e-02   +6.586752307066768e-02   +8.337254156388968e-02   +6.968845510159455e-02   -5.562512444605162e-02   +9.031410400357316e-02   +3.014507058019227e-02   +4.045994296267505e-02   +5.062293086666010e-02   +4.783864643235793e-02   +3.491026298292176e-02   +5.302700605121241e-02   +1.279959863923821e-01; +3.651510655775368e-02   +5.609978483146649e-02   +1.635593830056249e-02   +3.153865140631613e-02   +4.863286477546592e-02   -3.310757048320031e-02   +3.413826578781944e-03   +5.382538878188171e-02   +8.423324005425395e-02   +7.297471523219958e-03   +3.847064105959026e-02   -5.119313592334442e-02   +8.243278172469692e-02   +7.165580714867126e-02   +2.964984352290679e-02   +4.842513514598516e-03; +7.010210058660825e-02   -1.619863516819243e-03   +8.932782692735317e-03   -1.784820173452434e-02   +1.048274077735122e-01   +6.641584770667412e-02   +3.521421306756729e-02   +3.021266996626239e-02   +4.722342458850042e-02   +2.526514525656827e-02   +4.414118315299104e-02   +2.146594740204413e-02   +8.938271700033790e-02   +6.752339426190290e-02   +5.128556638376101e-02   +6.952147528142272e-02];
L1E_L1I_iGABA_netcon = [+9.748861669737926e-03   +1.011109788017522e-01   +2.732839293455758e-02   +5.707509920683355e-02   +9.779990570482351e-03   +4.358589585503986e-02   +3.448302243819064e-02   -1.617210093532648e-02   +7.849966918553455e-02   +1.628378730288637e-03   -1.380206706684515e-02   +1.326419696980813e-03   +4.254852379234543e-02   +3.040640046331122e-02   +1.734260828960363e-02   +7.922141152819322e-02; +4.177640796893109e-02   -3.546302064317360e-02   +9.809618083072187e-02   +4.368296496730952e-03   -7.227809740325064e-02   -8.688740711427405e-03   +2.277620469853796e-02   +7.088539609021746e-02   +5.408342365210574e-03   -6.330699133411979e-02   +4.422597865369080e-02   +4.821778776499249e-02   +6.260416478991732e-02   +3.064909448822849e-02   +4.917443111312194e-02   +5.582816306151309e-02; -5.036782607360692e-02   +9.994981007955017e-02   -2.039928544125940e-02   -2.041037472357855e-02   -1.508751137960142e-02   -4.976298838283261e-03   +7.629768385489474e-02   +4.211615566890985e-02   -9.802720770554748e-03   +1.679414833365136e-02   +7.164119212427915e-02   +7.210601206244860e-02   +5.644603535862383e-02   -1.577951069425516e-02   +5.795230642960925e-02   +8.787748566792965e-03; +5.669659827937593e-02   +3.996832701055748e-02   +6.642523261748846e-02   -7.809727277048392e-02   +4.476882740289247e-02   +8.258183640716968e-02   +4.057851493002702e-02   +3.062739796204234e-02   +3.989917293624037e-02   +9.260855012560940e-02   +5.105681092071339e-02   +6.182219668448951e-02   +5.688565912744914e-02   +3.132203132027708e-02   +5.149285083219974e-02   -3.680309577486298e-03; +4.889864429039061e-02   +5.825597549681168e-02   +8.312324258319363e-02   +4.296310696536353e-02   +5.366481410145245e-02   +8.426651050389299e-02   +3.786137906614219e-02   +5.056700041411554e-02   +8.075705320258580e-02   +2.244113180193443e-02   +8.410011057647004e-02   +2.352262621908340e-03   -1.427469715516666e-02   -2.506940133568571e-02   +5.686956261983579e-02   +3.547869048801368e-02; +6.603672478412614e-02   -8.404281365750424e-03   +2.949213795325852e-02   +6.422506552320546e-02   +7.953176423651323e-02   -3.055819358359061e-02   +1.620467543551648e-03   -2.903981425139398e-03   +1.211227925018890e-01   +7.346728740485543e-02   +7.099406753849470e-02   -1.382287066067441e-02   +9.399122843818142e-02   -7.539960536215487e-02   +1.275409331920093e-02   +3.596774911699391e-02; +1.577094960419682e-03   +5.210986576538018e-02   +6.668162642210795e-02   +4.611766099759897e-02   +5.513116920798637e-02   +4.726879603637600e-02   +6.979339399282089e-02   -1.547099242830184e-02   -5.580364958644644e-03   +4.301168633157647e-02   -2.274605357654110e-02   +7.384239991043065e-02   +4.163093075614570e-03   -4.848458518605901e-02   +1.653946056306921e-02   +4.095493669518638e-02; +2.981038368839067e-02   +7.600729308018037e-02   +4.494204944670816e-02   +4.337211926235994e-02   +1.904194986988463e-02   +2.271095462048772e-02   -2.687662383585792e-03   -5.791808104012376e-02   +3.263136676159974e-02   +6.092924329010971e-03   +3.714411352018667e-02   -6.778495761948546e-03   -6.953293365306130e-03   +6.380732994801935e-02   -1.597425551890682e-02   +1.519130853882012e-01; -8.993605932156186e-03   +8.355005838163485e-02   +6.655992609596699e-02   -4.032353902617750e-02   +3.987530203905682e-02   -2.593583377556598e-02   -3.702562932699862e-02   +3.749021542095000e-02   +6.793739999120296e-02   -1.166666689954394e-02   +5.842063451706180e-02   +2.744139858473976e-02   +1.812397509056178e-02   +1.034878523939052e-01   +3.244628624767312e-02   +9.798356318570439e-02; +4.227106439686257e-02   +7.434302258192149e-02   -1.589696629768261e-02   +4.966677098042054e-02   -9.388838075641073e-04   +5.424822202349824e-02   +1.129123213105841e-01   +2.795120886735725e-02   +9.975287173138010e-02   +4.705965296216084e-02   +4.358330437173168e-02   +9.232490099704256e-02   +4.391227515404736e-02   +1.157763923809243e-01   +8.862050076298918e-02   +1.162668126845573e-02; +3.669101615544205e-02   +6.148614810808702e-03   -1.430258526045264e-02   +6.534810511769044e-02   +4.391826483884503e-02   +1.012011576201099e-01   +1.636709196309908e-03   +4.847071838132245e-02   +5.826052563509134e-02   +7.887439184838826e-02   +3.274758879920429e-02   +7.830121408944163e-02   +1.148406908522387e-02   +6.609777135791470e-02   -3.921184041078222e-02   +7.300662540990578e-02; +2.829798953213080e-02   -2.328623706015261e-02   +4.109304012623605e-02   +8.015299257423081e-02   +4.033712029719753e-02   -2.614718679748891e-03   +2.539134725284067e-02   +6.133285467267598e-02   -6.110220905128594e-02   +6.388821258611499e-02   +3.609540416411464e-02   -4.157531023338421e-02   +4.615767927292123e-02   +6.538185001244767e-02   +5.370156354133322e-02   +8.694173297116750e-02; +5.338762913199700e-03   +5.233683665096114e-02   +8.606143111483851e-02   +3.466768610336610e-02   -1.519040361252815e-02   +1.220099620379918e-02   +6.751661953386125e-03   +3.031678399461514e-02   +4.610643071169373e-02   +4.973046889704634e-02   +6.673533538330093e-02   -8.640741584136193e-03   +6.552362690357441e-02   +4.639621435054868e-02   +5.507712063990367e-02   -9.546560420077739e-04; +3.784784969445591e-03   +5.275657392523003e-02   +2.998148690568901e-02   -5.031471454828478e-03   +1.656107661138093e-02   -5.144657169505977e-02   -2.098253017455689e-02   +4.245646585823697e-02   +5.949379609288583e-03   +6.511314073739995e-02   -5.152844247596766e-02   +3.767987149706316e-02   +1.817936653273416e-02   +7.257387696756727e-02   -6.131960016887131e-02   +5.810637387968047e-03; +3.455672572020986e-02   -1.527852342171556e-02   +2.303305795272859e-02   +5.051069339085078e-02   -1.734191701273480e-02   +4.698115264978511e-02   +3.060771954008984e-02   +8.315024959016329e-03   +1.059576618726113e-01   +3.642983270274251e-02   +1.613225185283744e-02   +5.876824588127844e-02   -4.431155296802317e-02   -1.702384971447898e-02   +5.542843740488085e-02   +9.508138062800296e-02; +3.164411264813963e-02   -9.119359480731608e-04   +8.383232631569378e-03   +2.629941897192602e-04   +2.493968848394405e-02   +1.440650054309762e-01   -3.472031483640808e-02   +5.090695713601075e-03   +9.962415716991964e-02   +5.866427941848956e-02   +1.166501726320315e-01   +1.506765724946019e-02   -2.351260084171040e-02   +7.162955923463704e-02   +5.987854732538894e-02   -2.409178224480997e-02];
L2I_L1I_iGABA_netcon = [+4.374167100466316e-02   +4.793478306488112e-02   +2.087950059759194e-03   -1.102121471296093e-03   +2.907405382977311e-02   -3.549068551695479e-02   +4.862842326678365e-02   +4.020206252705380e-02; +7.204473996771391e-03   +7.206372079317770e-03   +2.369528279316113e-02   +5.826232981958133e-02   -4.008274727803518e-02   +1.910509248686597e-02   +9.864313111485536e-02   +3.894341406767805e-02; -8.980259910198497e-03   -6.071537886456512e-03   +1.072005071521538e-01   +1.860234882990611e-02   +1.940203513515316e-02   -8.478311850052508e-03   +9.074062926121267e-02   +1.026368656839256e-02; +9.982282355244967e-02   +9.678450782231268e-02   +5.515581151362466e-02   -1.611641512174238e-02   +8.943727793842453e-02   +2.104363306568087e-02   +1.336529049476878e-02   +1.503512545636254e-01; +5.614425275437654e-02   +5.116033435545284e-02   -1.751968042816587e-02   -1.748074830520134e-02   +3.128503111581783e-02   +5.361858839415662e-02   -4.415012838981914e-02   +9.069525449420333e-03; +3.994716562162993e-02   +8.419456818541664e-02   +9.518626392951091e-02   -1.385160097813212e-02   +7.657276627001880e-02   +4.915478177582720e-02   +2.826531318623796e-02   -9.099608291084632e-03; +5.430399097962672e-02   +4.040640202065016e-02   -6.268226145758854e-02   +3.087774616590949e-02   +1.873169537697933e-02   -4.040979997231690e-02   -8.373825856332853e-03   +7.293239680569236e-02; -1.237847729865231e-02   +6.120347625166919e-02   -4.849890433563529e-02   +1.183174362826215e-01   +2.846458701455061e-02   -6.321186502152638e-03   +4.063107491007200e-02   +9.501008294246376e-03; +8.004818103023012e-03   +1.096303930051271e-01   +2.465598688261116e-02   +3.272597295043660e-02   +3.921287110783443e-02   +3.251293895632088e-02   +5.105144924427821e-02   +3.548270977762261e-02; -1.751668337169825e-02   +4.600077495396805e-02   -1.945361468212234e-02   +5.717766439916236e-02   +6.663430377449306e-02   -3.758341260387139e-02   +1.738994376533015e-02   -5.179655723678712e-03; +7.865803524912421e-02   +4.733327680726471e-02   +7.583543565776710e-02   +5.663390921227703e-02   -1.170354597657749e-02   -4.125012831441616e-02   +9.635425400649891e-02   +7.544198260340604e-02; +1.082658363613759e-02   +5.273771793929597e-02   -1.123494311335043e-02   +5.110810202358476e-02   +7.937843010868684e-02   +9.572675889678392e-02   +5.903820344558840e-02   +6.017049802895831e-02; -1.800028290384550e-02   -7.067545692043460e-02   -2.213203916909186e-02   +1.175360765310807e-01   +8.903243033994704e-02   +8.920621243411453e-02   -3.352202414552324e-02   -4.218054210844392e-02; -1.882995596141895e-02   -3.140298662641720e-02   +6.046501915593544e-02   -2.452173590928305e-02   +2.803299268677588e-02   -1.180656512880380e-02   +2.380825567115597e-02   +6.569773431443807e-02; +3.258944538855107e-02   +1.320643924411949e-02   +3.913325464936963e-03   +7.147301154051922e-02   +2.469914878783612e-02   +9.011241182110487e-02   +1.170181045374423e-01   +7.049469070431330e-02; +3.709730821758995e-02   +9.909959528487246e-02   +2.464992206130493e-02   +1.057800627517933e-01   +5.096220492770231e-02   +5.229571388838937e-02   +4.948241353898092e-02   -2.782125265564828e-03];
L1I_L2I_iGABA_netcon = [-5.471414346614041e-02   +3.689926922877345e-02   +4.583108625221868e-03   -5.263592873811687e-02   +6.831388862865939e-02   +7.532232285543600e-02   +6.557674491357743e-02   +8.191672515387342e-02   +6.119317775907783e-02   +8.965092460491021e-02   +7.622251569485058e-02   +2.946130552543122e-02   -2.314874358884524e-02   +4.174356406864260e-02   +4.215047284950785e-02   -3.256984486635936e-02; +7.808737769441934e-02   +1.446529006466814e-02   +2.185669929032958e-02   +2.637402442818304e-02   +3.680768196682695e-02   +2.123649761214332e-02   +5.526855844171422e-02   +4.987782868003151e-02   +7.352740957430501e-02   +8.924402812213064e-02   +2.436092902108514e-02   -2.617895118182936e-02   +9.783976337293321e-02   -1.469271622891488e-02   -5.857333975978042e-03   +6.085054139562208e-02; +6.464724884031836e-02   +3.739546147537142e-02   +1.071828901230759e-01   +1.656500328272822e-02   +9.871842079851824e-02   -3.678318210306754e-02   +6.153010446496249e-02   +1.417112473829670e-02   +3.619904767100039e-02   +9.324987236238735e-02   +7.235470981217862e-02   +6.110156479211640e-02   +6.774379084986762e-02   -5.622098082317940e-02   -3.079499787334512e-02   -5.551689498348102e-03; +2.908488088526438e-02   +6.699979702535080e-02   +6.705055661936246e-02   +1.590577497791056e-02   +4.605659490570699e-02   +6.166550728840915e-02   +1.370173427285350e-02   +5.452634449036179e-02   +9.355894384345115e-03   +1.001731055733091e-01   +7.123300359503959e-02   -3.627805465661245e-02   +5.685692581793031e-02   +6.181540179114388e-02   +6.180219860421658e-03   +8.664658275225740e-02; +4.069002897835140e-02   +2.222205815662451e-02   +8.892824984898731e-02   +6.847219596702753e-02   +1.153135378515871e-01   +7.514044989008212e-02   +1.555063843048367e-02   -1.152679322203762e-02   +9.604615435743549e-02   +2.294343236329607e-02   +2.138626923094128e-02   +5.158434995988875e-02   +2.681394002066601e-02   -5.719574103862564e-03   +6.658604758613342e-02   +6.580737136064860e-02; +4.263659229381290e-03   +2.623289621970919e-02   -4.587188322320849e-02   +8.707250069744631e-02   +8.158878387131553e-02   +5.034874807388093e-02   -1.853650763844070e-02   +1.194753651824547e-02   +4.458770918169939e-02   +2.929397981592933e-02   +6.556788054066694e-02   +3.369791992226486e-02   -7.841675131989412e-02   +6.733649223169458e-02   +3.223345083721677e-02   +1.143362884826756e-01; +5.146419844549495e-02   +1.327667955346358e-02   +6.009788618989379e-02   +7.073994138462508e-02   -2.504676734331227e-02   +7.129075110753047e-02   +1.937230882974184e-02   +1.520009655569879e-02   +3.342434342799502e-02   +3.687196760135164e-02   +5.318890120935245e-02   +2.537173510557937e-02   +4.629573057101098e-02   +6.149156902803699e-04   +8.284623998409023e-02   +2.415268858104246e-02; +3.375058795003858e-02   +4.699708849101433e-02   +5.596373565251614e-02   +3.738687068807238e-02   +4.416934510367296e-02   +8.539293223693176e-02   +7.463352141803520e-02   -2.934645417935405e-02   +9.448403338162209e-02   +7.093136887474281e-02   +8.927744745406503e-02   +1.626969240706387e-02   +1.663945066892413e-02   +7.781065894065436e-03   +3.466985911067723e-02   -7.282004481936599e-02];
L2E_L1E_iAMPA_netcon = [+1.518102553886669e-02   +1.001585735625597e-01   +4.088267722238175e-02   +7.986949618804379e-02   +4.960541664845556e-03   +5.495696254989094e-03   +7.906177840794801e-02   +1.313180383958043e-02; -4.816541288904462e-02   +3.010099931351484e-03   +3.153125951031967e-02   -1.241211398763014e-02   +1.664130461141570e-02   +1.218210711571610e-02   +2.781795862069622e-02   -2.569382561338420e-02; -3.036983361648872e-02   +3.042112395796709e-03   +9.505320448187712e-02   +6.642458926865213e-02   -8.535566872476218e-03   +4.450859519415896e-02   +9.151469681919266e-02   -1.835065411501867e-02; +8.145233434153482e-02   -9.628947727433704e-03   -4.800761184738527e-02   +4.816645650306332e-02   -9.136014559795572e-03   +4.538240882016903e-02   +4.345951069799926e-02   -5.016099788853347e-02; +9.145743607737489e-02   +1.167485691690836e-01   +1.510855037246493e-02   +2.676141990673158e-03   +7.973537345881317e-02   +6.179201993887351e-02   -1.609245318723898e-02   -7.354071713641551e-02; +1.147671778674629e-01   +3.261206527722740e-02   +3.248757689187996e-02   +3.617215493729330e-02   -3.549941710035431e-02   +6.953640234959135e-02   +9.503411955148118e-02   +2.649475004025282e-02; +3.613654725801909e-04   +4.617919296487693e-02   +3.405699289267729e-02   +2.864888339171887e-02   +4.742375348228585e-04   +1.059209270318233e-01   +6.149297018710667e-02   +9.338325194424252e-02; +7.874468045957553e-02   +1.185578501557240e-01   +7.868991043538204e-02   +1.209872452259438e-02   +8.986423652773630e-02   +1.485314705158149e-02   +3.184655591115984e-02   +7.933541450334826e-02; +9.440713776121731e-02   -1.333898226942772e-02   -4.344532753041427e-02   +2.593638570024509e-02   +1.109730946868356e-01   +3.545072061456144e-02   +5.495691991131373e-02   +9.497397612135303e-02; +5.982460991966352e-03   +5.469304080715806e-02   +2.686184432548911e-02   +2.195450486842422e-02   +7.949733202313015e-02   +2.330183229881976e-02   -3.161018127373461e-02   +1.910865618329743e-03; +7.953918461229155e-02   +7.714931178683300e-02   -1.249624554355313e-02   +1.478937403147733e-02   +2.835242284600509e-02   +6.829222463664972e-02   +4.013776264221938e-02   -2.886505166651551e-02; +2.925070498024290e-02   +2.028664781105203e-02   +1.262714261860292e-02   +6.540844196013794e-02   +3.170994068944950e-02   +8.910811744349914e-02   -1.893639158813577e-02   +7.599222304211831e-02; +2.890256617315157e-02   +7.797578029454319e-02   +9.018621394061289e-02   +1.560079481249590e-02   +7.288319837257523e-02   -3.786848262890032e-02   +8.810480536107021e-02   +5.638512538817544e-02; +2.613465163687475e-02   +7.101597761910862e-03   +8.847823171775349e-02   +8.257469057742269e-02   -2.527158391691591e-02   +7.197172504175939e-02   +1.198509086869824e-02   +3.794849459448341e-02; +4.908912934318642e-02   +5.183104055683960e-02   -5.074091289972919e-02   +6.492156921260149e-03   +3.102480495115832e-02   +1.290160763392755e-02   +1.335674404750216e-02   +5.083564554320030e-02; +4.212833922502428e-02   +4.578513449709615e-02   +3.831279258051201e-02   +3.027568676250445e-02   +2.428335594834497e-02   -3.677972835060615e-02   +4.557473579984701e-02   +2.914784358051483e-02];
L1E_L2E_iAMPA_netcon = [-8.083353857964125e-03   +3.170814011581161e-02   +8.476508335013888e-02   +6.363346526819971e-02   +5.776309397586798e-02   +7.603227337804809e-02   +1.094509037615879e-02   +5.815927538348216e-02   +1.262647777940722e-01   -4.152156564320608e-02   +6.073080845913151e-02   -2.365926915361427e-02   +1.805344496218008e-02   -3.953528535868438e-02   +2.210202802113228e-02   +7.090050006368870e-02; +2.254556936151619e-02   +1.940502521658261e-02   +3.788728248151300e-03   +4.113639075084537e-02   +2.573283808995831e-02   +7.212396707498119e-03   +1.860585600880029e-02   -3.930739197897546e-02   -3.120059803208959e-02   -8.031829398037066e-02   -7.913407641946918e-02   -6.562848420645504e-03   +8.287047051693266e-02   -3.717539957652604e-02   +3.100519791841403e-02   +2.338597824176197e-02; +5.144932720330481e-03   +4.681708778162498e-02   +1.124476852197855e-01   +6.224464145915315e-02   +8.571399214045530e-02   +4.716959077300114e-02   -2.733724816768271e-03   +5.630065751470940e-02   +4.020951414164903e-02   -1.965692819174491e-02   -2.633371734442934e-02   +5.329834267720217e-02   -1.019536186379136e-04   +2.207292676921254e-02   +1.654995276525262e-02   +7.004055742769774e-02; +5.131994682601917e-03   -1.694967952897760e-02   +1.550978233232020e-02   +1.255374958794513e-01   -1.419065330637356e-02   +3.652040952828611e-02   +3.306168222548109e-02   +3.991955651413878e-02   +8.763472557660541e-02   +1.334050064705840e-01   +4.593226749415100e-02   -9.513415199696333e-03   +5.795290057093232e-02   -1.659962532789975e-02   +4.819562532088136e-02   +1.143852713530625e-01; +5.346714084208690e-02   +3.063480463516098e-02   -3.807807361085043e-02   +1.825615734073746e-02   +1.122413835916728e-01   +1.078532592732681e-01   +7.339154019953328e-02   +4.345413114652245e-02   +3.297151185784480e-02   +3.479280105952135e-02   +1.346178744555598e-01   +2.549541778007857e-02   -3.752349035997224e-03   +8.270896231668991e-02   +4.149793906164077e-02   +1.808840443580791e-02; +6.349865845998964e-02   +3.595606345391587e-02   -1.584131408375913e-02   +6.704893844742040e-03   +2.530950209216178e-02   +4.753161737372772e-02   -3.611673755286768e-03   +2.749453916770762e-02   +9.757961533495424e-02   +2.309100731151711e-02   +1.294638411562310e-02   -1.628566576760006e-02   +6.119854390660515e-02   +4.243278878401140e-02   +4.873855794696272e-02   +3.229010817760909e-02; +3.868165046927123e-02   +1.708340999571905e-02   +2.114924896953041e-02   +4.646912369124560e-02   +7.068107559176305e-02   -1.629309751871410e-02   +8.771602816390969e-03   +4.251620753812119e-02   +3.617856470700346e-02   +2.656572668773964e-02   +1.464485894532916e-02   -4.071186708009163e-04   +2.107670990230008e-02   +2.998811543829603e-02   +8.261632641472877e-02   +6.258344252296924e-02; -8.931875406310468e-03   -4.627029506057776e-02   +1.018018333781850e-01   +5.111989775967948e-02   +3.330575356016537e-02   +6.918875736857419e-02   +6.340191624280361e-02   -3.633108760386437e-02   +1.715852086106883e-02   +8.837738525303733e-02   +1.302687384056402e-01   +4.239681294691180e-03   +5.152083197157734e-02   +1.221719067752417e-02   +8.808775209794652e-02   +6.051898331786473e-02];
L2I_L2E_iAMPA_netcon = [+1.632409302229388e-02   +2.653011803202364e-02   -1.061034653264457e-02   -2.755397463546156e-02   +5.858607792434857e-02   +4.896099018369916e-02   -2.969076824841275e-02   +7.972092157640619e-02; -2.523387297703246e-02   +6.682508378713392e-02   +5.428144219726922e-02   -2.220706639128750e-02   -1.419951279454155e-02   +6.754839992191383e-02   -3.894967519040201e-03   +1.841091172141773e-02; -7.326179229871013e-03   +3.323068418822911e-02   -1.512905138879486e-02   -1.949611132267306e-02   +4.957649166119947e-02   +1.081672531062310e-01   +3.243273321669923e-02   +1.084828225100147e-02; +2.015488040030760e-02   +4.440131593665013e-02   +2.235711101174951e-02   +3.089658078658776e-02   +5.298346365449813e-02   +4.767365496307258e-02   +6.903472296845900e-02   +5.584470343419906e-02; +1.930601899659604e-03   +7.782110434287286e-02   +2.282099900772108e-03   +1.171815570740162e-02   +7.405540657098135e-03   +4.753556914575616e-02   +5.055474330760765e-02   +1.112451228440281e-01; +2.719134417051484e-02   +3.601905734947021e-02   +3.619107801430299e-02   +4.855276818005314e-03   +8.605676779813784e-02   +2.707119752354242e-02   +2.294907398795282e-02   +1.234060178905940e-03; -2.395358365829137e-02   +1.245627316563194e-02   +3.254947572298417e-02   +8.276095656636248e-02   -6.443460788317577e-02   +5.333084809488537e-02   -2.021649253301485e-02   +9.275721106346074e-02; +6.031306739058219e-03   +5.144412292860903e-02   +1.065288591049787e-01   +5.481656917001380e-02   +3.358328763270498e-02   +4.246383327075176e-02   +1.164947416079754e-02   -2.876068072986711e-02];
L2E_L2I_iGABA_netcon = [+5.251203738537170e-02   +6.916002973923623e-02   -2.655994630011477e-03   -1.537693554624008e-02   +1.098203392669216e-02   +8.095480421295151e-02   +3.359135770843177e-02   -3.793272595672714e-02; +1.244200127097920e-01   +3.259394811778575e-02   -1.004826826665106e-02   +4.176745805666397e-02   +3.531395144665111e-02   +9.690317983853071e-04   +5.132496397660431e-02   +3.085380825655147e-02; +7.913840055473464e-03   +4.870890361659716e-02   +4.485289207029053e-02   +3.291096763611333e-02   +2.018624432488406e-02   +9.839322413305117e-02   +1.098964424918077e-02   +2.635563512987899e-02; +6.809390097132099e-02   +2.386430427250143e-02   +7.101717171466566e-02   +1.969868694197096e-02   +5.993072061855037e-02   +1.183780611624040e-01   +2.914144619508444e-02   +3.116908121554490e-02; +4.071755921113100e-02   +4.272536795270566e-02   +5.749172920535479e-02   -2.087143862970316e-03   +5.196649311165823e-02   +3.479496439427480e-02   +1.005148767780767e-01   +9.165401225423874e-03; +7.884505569147032e-02   +4.131288314949236e-02   +5.707747130299038e-02   +1.419193598016480e-02   +2.289761721887618e-02   +8.551533457234779e-02   +2.596135866650694e-02   -6.032998878730748e-02; +9.428520142269090e-02   -1.304009653782085e-02   +5.610445151554078e-02   +2.752089305573362e-02   +8.434574754135143e-03   +4.074424363642599e-03   -1.415723247696904e-03   -6.106517054416376e-02; +4.938998846445081e-03   -1.382829971583257e-02   -1.346883827704229e-02   +4.328827880148466e-02   +2.295800959970635e-02   +3.146687283248741e-02   +8.373655079458621e-05   +3.078625225640079e-02];
L3E_L2E_iAMPA_netcon = [-3.524206450216125e-02   +4.580285786842987e-02   +6.512916629608169e-03   +7.300352634491265e-03   +8.881822583252616e-02   +3.188747984331993e-02   +5.954164864882289e-02   +3.011922559994998e-02   -1.420400718561333e-02   +1.007280956090557e-01   +7.211994524894989e-02   +2.135367327463504e-02; -1.890000351767266e-02   +6.474982815010551e-02   +2.850028702090196e-02   +4.181358440368425e-02   +5.159985267412880e-02   +1.198453438324234e-01   -4.433285987399619e-03   -5.841029496175942e-04   +6.023916096578986e-02   -3.451394628322101e-02   +8.935870810275286e-02   +1.509501451883109e-02; +3.764856661785497e-02   +1.099976818940327e-01   +7.012269271421545e-02   +2.645787222441745e-02   +1.589022766561520e-02   +1.443948939000179e-02   +5.870546615555160e-02   +1.827512376946028e-02   -1.150058716805183e-03   +9.660007329706430e-02   +1.819177780849545e-02   +4.261618218739268e-02; +3.859282903348977e-02   +6.587577478800646e-02   +7.453219488239579e-02   +2.391759774281917e-02   -4.237462451970646e-03   +2.957927197754798e-02   +1.926799685026801e-02   +6.049862270439300e-02   -3.919277567962441e-02   +9.399883462959577e-02   +3.405915904561632e-02   -1.431197707459673e-03; -7.622687748307443e-03   +5.774207052942829e-02   +1.422839021528645e-01   +8.468815540590106e-02   +9.432708886121986e-03   +8.152096000877168e-02   +3.105015831124611e-02   +6.951298554514937e-02   +1.766270351427430e-02   +4.710586033806929e-02   +9.289153336918163e-02   +1.950253578008298e-02; +6.289295607099273e-02   +1.868606374822042e-03   -1.939111819486984e-02   +6.413468398926046e-02   +9.335197182209193e-02   +2.133155655323655e-03   +8.000822267833425e-02   +8.043998746757745e-02   +3.750633754181042e-02   +2.040698381826072e-02   +1.461314705709729e-02   -4.886588318532660e-02; +9.733879123630890e-02   +6.011575310980676e-02   +6.723587722159668e-02   -1.535376228154320e-03   -2.481578668181305e-02   +5.775158017034752e-02   -1.522355212158016e-03   -6.059871412216309e-03   +4.958172888059224e-02   +4.007188658036262e-02   +1.235254189294605e-01   +7.848103171784036e-02; +1.111955575638547e-02   +4.830976554188007e-02   +6.054305249019212e-02   +4.931225643944215e-02   +4.840733255665084e-02   +2.116247356472765e-02   -8.333615112814894e-03   -5.657065015781566e-02   +1.261941850076605e-02   -8.623061688850462e-03   -1.489566480032248e-02   +6.652820605232518e-03];
L3I_L2I_iGABA_netcon = [+1.035678143908025e-01   +8.439612725326252e-02   -2.831416186753743e-02   +7.206070452640229e-02   +3.309183573888116e-02   +8.858212456057762e-03   +2.041572039237412e-02   +5.257987091211769e-02   +4.487167988044332e-02   +5.345868352274973e-02   +7.861332250890285e-02   -4.286577559977418e-02; +4.343847319838363e-02   -3.227078985679538e-03   +2.826538038988743e-02   +4.540617805064072e-02   +3.225979485196412e-03   +8.468873626084324e-02   +4.202885016239014e-02   +1.680271817826627e-02   +5.608633138958395e-03   +8.702248705992002e-02   +3.860856799406683e-02   -5.146013154227077e-02; +1.786647880040489e-02   +1.200708856489643e-01   +1.985482244140357e-02   +6.060445186118554e-02   +9.230797632878063e-02   +2.727012551794484e-02   +6.330114398404887e-02   +4.412848649557777e-02   +1.262782592803093e-01   -2.835985417362728e-02   +4.909738827108479e-02   +6.027174896238401e-02; +4.572797973938377e-02   +5.431744557815314e-02   +8.368792545085767e-02   -6.045015958181597e-03   +1.243193098368660e-01   +4.241062954503107e-02   -4.561097127941398e-02   +6.429504214903639e-02   +9.533528203743935e-02   +1.506089826811232e-02   -2.384255476882469e-02   +1.189383989405882e-01; +2.915852247994519e-02   +4.674575864946746e-02   +1.070043485885261e-01   +4.027964597988399e-02   +1.306705853069736e-01   +5.066369295617375e-03   -2.077478448968050e-02   +1.231834630233063e-01   -1.169758265575517e-02   -8.367996047145471e-03   +1.409440892604388e-02   +6.576156418566791e-02; +6.417057781027488e-02   +8.412444683682468e-02   +5.090358361899396e-02   +2.556390397220357e-02   +7.345944657185326e-02   +5.057406544391829e-02   +5.836865486890525e-04   +2.119696799435997e-03   -3.285691025801846e-02   +6.404461996570077e-02   +4.641651864653772e-02   -2.111210844490703e-02; +1.478316388714461e-02   +3.804929510871891e-02   +3.745144627488589e-02   +8.554907244180543e-02   +2.247992831864589e-02   +5.146537558606755e-02   -9.554815519633261e-03   -6.981388660625690e-03   -3.941805664461051e-02   +4.130352184071514e-02   +4.620538900604133e-02   +5.151136674542008e-02; +5.258697141903725e-02   -2.314655337586114e-02   +3.700267318318273e-02   -1.266205756044493e-02   +9.005774932138386e-02   +9.454514556479927e-02   +5.014976200596898e-02   +6.863881055364601e-02   +2.257941881184317e-02   +9.813151361077833e-02   +7.795481028170200e-03   +3.183308781396529e-02];
L2E_L3E_iAMPA_netcon = [+7.309211821590103e-02   +3.953762115323296e-02   +4.335277114486834e-02   +2.847976462970363e-03   -5.601756209904186e-03   +5.253139186150872e-02   -2.964460743536405e-02   -2.647827633256487e-03; +5.561868936080730e-02   +7.625845817307492e-02   +8.181385712938408e-02   -3.097905462630433e-02   +1.405198102202393e-01   +7.056222541274804e-02   +2.089506644587768e-02   +5.498815223348535e-02; -3.030104976932013e-02   +1.863136036259363e-02   +1.334607113232816e-02   +3.419160494500911e-02   +1.949710935527162e-02   +8.197243592374416e-02   +8.973234746636075e-02   +9.844011155977252e-04; +2.481547459276278e-02   +2.605143989008245e-02   +1.596598559173133e-02   +1.048528227140213e-01   +4.693962699193902e-02   +8.175464609731595e-02   +5.041832155870114e-02   +3.922376182999942e-02; +4.820396721159242e-02   +1.193065418283185e-01   +5.537494434787477e-02   +3.420982142835407e-02   +4.033006211510823e-02   -4.901883449397972e-02   +5.949659483581669e-02   +4.652982925244577e-03; +2.141615893972352e-03   +1.135063155392853e-01   +1.015626603312006e-02   -2.523202137052465e-03   +7.297100420984373e-02   +5.102881315887301e-02   +6.330438318641765e-02   +6.026648276363216e-02; -4.794264575892493e-04   -6.559290498060282e-03   +1.409727250195251e-02   +3.948237725179207e-02   +5.620418587736382e-02   +9.454822606616562e-03   -2.667139869246857e-02   +6.035064831062713e-02; -2.211012831069834e-02   -5.081877303729970e-02   -1.982626351795541e-02   +1.724992490084430e-02   +5.370213416932813e-02   -2.774655487048645e-02   +3.996045963033179e-02   +4.280070783149505e-02; +6.360769899279262e-02   +4.901119265913026e-02   -1.948568292155256e-03   +5.639840767978947e-02   +8.333464273902868e-04   -1.252690924285993e-02   +6.460278712477967e-02   +6.432257443980474e-02; -3.002099247874945e-02   -8.008858454266321e-03   +2.130299763126609e-02   +3.187950157627249e-02   -3.604759414081948e-02   +1.871830364397774e-02   -1.585824373968641e-02   +1.193158973315538e-02; +4.942001358572957e-02   +1.594434333311080e-02   +4.988430074067848e-02   +5.849237325786868e-02   -3.998472722515550e-02   +1.205518274021742e-02   +3.330565620719603e-03   +4.949538627151406e-02; +8.670595554658028e-03   +2.745378839969073e-03   +9.882878936216072e-02   +4.030124366473715e-02   +8.594265150046673e-03   +2.579207840613731e-02   +4.727038752709861e-02   +5.699535720154483e-02];
L2I_L3I_iGABA_netcon = [+2.353366493256750e-02   +2.925670238794454e-02   -3.474495459877998e-03   +3.441318306178938e-02   +5.169608818103248e-02   -1.562292144854341e-02   -4.554087347798207e-02   +3.762340037661951e-02; -3.103492660600622e-03   +7.917909492389878e-02   -1.318838987774587e-02   +6.193188882305558e-02   -2.973728673991829e-02   +2.752270083449895e-02   +4.300975435699969e-02   +2.198146532069438e-02; +2.089077065513028e-02   +7.315361716164812e-02   +6.801504691677186e-02   +4.051034506454435e-02   +2.418194451213586e-03   +4.711803806248234e-03   +6.470600684611674e-02   +7.128127087850288e-02; +6.078139183239507e-02   -8.347957362901965e-03   +3.777401260783479e-02   +8.434650496715135e-02   +6.074432018415486e-03   -1.086633038066339e-02   +4.354235992969757e-02   +4.297565220962329e-02; +6.032764524121689e-02   +7.409109814809797e-02   +5.102097468693306e-02   +2.572260513380952e-02   +4.143915349252614e-02   +5.369497786749388e-02   +5.706620361980600e-02   +5.315630254978159e-02; +4.176034219417893e-02   +5.096110356374191e-02   +2.748710604391235e-02   +2.643152168279816e-02   +6.383369933132264e-02   +1.845192236305315e-02   +5.091382940620378e-02   +4.133934805241239e-02; +7.306866254821470e-02   +2.799749977051268e-02   +2.843297293649284e-02   +4.590515065510662e-02   +2.986536893288546e-02   -2.972886238053869e-03   -1.758104346008640e-02   +2.216442954843581e-02; -3.808826139785015e-03   -4.919775579573944e-02   +7.885203073716220e-02   +9.519720579022148e-02   +6.032899923957289e-02   -2.199140045971253e-02   +1.413240789507228e-02   -3.883622263137284e-03; +5.658001158210529e-03   +9.174027583146107e-03   +9.963239659255073e-02   +5.236732224259787e-02   +5.181566198207985e-02   +3.787911545307254e-02   +3.266088318228336e-02   +9.300817344677278e-02; -1.418683639274431e-02   +1.620658559407587e-02   -2.725280569333392e-02   +5.301435029631919e-02   +1.186171283381962e-01   -1.466904210361210e-02   +6.388071294072085e-02   +6.713691697826288e-02; -2.025792909527023e-02   +5.818292965361055e-02   +1.280741837801493e-02   +2.461643796959490e-02   +1.357365851515755e-02   +3.819829689518073e-02   +4.163746221264158e-02   +6.853599628566355e-04; -1.431857359572729e-02   +1.266096966218857e-02   -4.083598211047928e-03   -2.794106518939979e-02   +1.482343428682593e-02   +5.711763669592212e-02   +1.868266803937881e-02   -2.214844308162436e-02];
L3I_L3E_iAMPA_netcon = [+5.969670054614089e-03   -5.833935062931160e-03   +4.051095960403917e-02   +5.639469433936829e-02   -5.091057088936245e-02   +6.197123816844970e-02   +7.689693275240848e-02   -4.901784594015819e-02   -2.992727738553632e-02   +9.435925704326303e-03   +5.900678048073968e-02   -3.177804397661126e-02; +5.124317751703333e-02   -6.138576464354110e-02   -1.459140999003031e-02   +2.349803250924950e-02   +3.110837023008698e-02   +2.685617812285244e-02   +9.194994774430901e-02   +5.714722222301090e-02   +5.920531012076632e-02   -1.103056283507965e-02   +6.629928509446448e-02   +1.026012582156401e-01; -2.734392899995880e-02   +6.529184025435991e-02   +8.301826288993369e-03   -1.494616143556696e-02   +2.355903558328441e-02   +9.048805426784666e-02   -5.234206258345333e-03   -1.221061773380465e-02   -1.488921536402734e-02   +5.509505341532946e-02   +3.341989410831046e-03   +6.211965588870245e-02; +3.213189228367200e-02   +3.660019532985117e-03   -3.721610732078535e-02   +4.835046639646002e-02   -1.283581078242264e-02   +3.749875798047174e-02   +2.683131421547692e-02   +5.134443523232793e-02   +5.212159714289470e-02   +4.245238012344213e-02   -1.379561575937251e-02   +6.006118836675178e-02; -1.578349725985338e-04   +6.042186167143525e-02   +2.061963961828360e-02   -1.656446406562213e-03   +3.850499272482338e-02   -3.992402391963094e-02   -3.748776201419098e-02   +3.850993339754413e-02   +2.286655987982862e-03   +3.193450647983159e-02   +1.677678394416449e-02   +6.473325519584175e-02; +3.975992988982957e-02   -1.398111035031335e-02   +2.133707207819295e-02   +1.209828096393560e-01   +2.306012896243587e-02   +7.082878165491557e-02   +1.738290964310142e-02   +3.373691588709344e-02   +1.027579023194090e-01   +2.729956092420101e-02   +4.533871063734396e-02   +7.140077995068098e-02; -1.733382713166625e-02   +4.806630272911497e-02   +7.034319019628174e-02   -1.582689885737852e-02   +5.902205949674993e-02   +3.345791000986812e-02   +4.019379479371077e-02   +9.228327797290477e-02   +2.772125174120166e-02   +3.209531588267954e-02   -1.958817774565155e-02   -2.226883715734044e-02; +6.159523925127521e-02   +1.008228210606080e-01   -3.734912534052722e-03   +1.179639179434951e-01   +8.593613161150435e-02   +2.443065509418672e-02   -5.181117773522000e-02   +7.716502163924034e-02   -2.555071989686077e-02   +3.993283112977800e-02   +1.039226274261743e-02   -3.708357587061511e-02; -7.724133122963125e-02   -7.703750299098611e-03   -4.382575501143027e-02   -6.191730553444748e-03   +3.676068561798255e-02   +1.875874561562807e-02   +1.462296473772032e-02   -9.168138836429869e-03   -2.773532974588322e-02   +7.362983350963705e-02   +3.280684071702401e-02   +1.229342337876180e-02; +7.258595036882998e-02   -1.041625800227935e-02   -3.575490763342522e-03   +1.175395267850011e-02   +2.508763508763840e-02   +3.166550639559990e-02   +2.564359840868643e-02   +1.331030333182107e-01   +9.111314165663123e-02   +1.091280658407452e-02   -3.113219303294623e-02   +5.356098247170267e-02; +8.098635700093457e-02   +1.377576547924254e-02   +1.533016482937935e-02   -3.432238209987706e-02   -2.558902391994133e-02   +4.781746922731721e-03   +8.887423398956623e-03   +4.427144186174944e-02   +3.012978478071708e-02   -4.422708258484360e-02   -2.881931440215301e-02   +5.416446360965244e-02; +5.227812823871224e-02   +3.145166305040953e-03   +5.934621725566857e-02   +9.781574807922876e-02   -3.052599579471475e-02   +2.783027984505580e-02   +9.951343929577280e-02   +9.803508841342167e-03   -2.622494731419893e-02   +2.983654537841407e-02   +5.253428979382339e-02   +6.830069419498097e-02];
L3E_L3I_iGABA_netcon = [+2.176989050085670e-02   +4.140630332691231e-02   +4.087893547228923e-02   +1.216198619922007e-01   +3.276201466355245e-02   +8.047549003341313e-02   +2.139951783657506e-02   +3.625390415611085e-03   +3.770522600162854e-02   +6.963726074515889e-02   +7.970121922825127e-02   +4.482763425914105e-02; -1.144090032035439e-02   +1.812836086432161e-02   +7.909591266770398e-02   +1.934117669188486e-02   +2.471793173822187e-02   +3.200652467694678e-02   +5.228931397628916e-02   +5.066738697336787e-02   -5.313331891507611e-02   +8.305981213710582e-02   +5.351280461072843e-02   +5.751312753501900e-03; +6.078695506313964e-02   -1.437025095957545e-02   +5.792724135721632e-02   +8.963071221080066e-02   +3.576136155222195e-02   +5.303884172888233e-02   +3.807583892823863e-02   +5.501268852628012e-02   -2.407586565141198e-02   +1.223395243370599e-01   +3.364011170878631e-02   -2.294415968106510e-02; +1.530920338751854e-02   +5.188205201751492e-02   -1.925040923394140e-02   -2.466657310272467e-02   +7.166711660180108e-03   +8.856298039249039e-02   +4.567896458725801e-02   -4.343081841434868e-03   +1.448750672352461e-02   -3.984030617555323e-02   +8.519263428179823e-02   -2.761789707161934e-02; +6.993292522397472e-02   +5.326577102018924e-02   +9.028375109422412e-02   +3.167385973608513e-02   -1.624465813889749e-02   +1.822982817648858e-02   -9.538681984589365e-03   +7.009777513353187e-02   -1.379256550290175e-02   +9.805075275740170e-02   +2.312671558344928e-02   +5.150094475491120e-02; +1.627036626726183e-05   +1.875632959212072e-02   +4.073113116408031e-02   +4.476407369815909e-02   +6.667086210805666e-02   +5.046748770882240e-02   +1.334615318724066e-02   +4.090514301851517e-02   +5.105114588810746e-02   +2.658586517504108e-02   +4.989183086804470e-02   -9.432048741998546e-03; +5.103581171541253e-03   +3.031296380129126e-02   -8.502722798178527e-03   -7.138196682182175e-02   +4.675602655651048e-02   +3.820700001404403e-02   +1.092767157842508e-02   +5.884894611611659e-02   +4.413230988801756e-03   +4.384981158120440e-02   +1.515744985351018e-02   -8.817482943193565e-03; +7.898598929600952e-02   +3.331667722388483e-02   +1.023698966446302e-02   +1.159388841177060e-01   +3.052926724906284e-02   +3.788990346568086e-03   -1.230235913708155e-02   +5.236499156936049e-02   +3.651039936804699e-02   +1.664233390527937e-02   +4.894341531723214e-02   +1.468384063632803e-02; +1.537310323237512e-02   +7.729293214662360e-02   +4.761019383535305e-03   -1.549028961402821e-02   +1.072171008763400e-01   +7.461928470405890e-02   +3.698936390401726e-02   -3.582912632043542e-02   -8.232025860611367e-03   +6.574947236175006e-02   +7.430501959197093e-02   +3.784456830503081e-02; +5.374536427731921e-03   +3.593095198109518e-02   +5.982170223122137e-02   +2.512299098108400e-03   -4.340429014316492e-03   +5.760695714494778e-03   +4.882798492649364e-02   +6.138495521284645e-02   -1.642968074186880e-02   +7.316921505888865e-02   +7.668524345055994e-02   -9.972259773702963e-03; +5.250999615593907e-02   +2.903554834221491e-02   +2.513814682530349e-02   +2.354720657265078e-02   +4.575713928931424e-02   -4.800693964945178e-02   -7.805966694710223e-03   +2.032630462158481e-02   +2.436987014923733e-02   -4.676787921981435e-02   +1.282355056063333e-01   +6.225944999839974e-02; +1.338941072839692e-02   +4.308684850172896e-02   -1.219320874628204e-02   +1.839459603324992e-02   +4.078771401571923e-02   -9.701295191511866e-03   +8.883950764119837e-02   +4.759703315353924e-03   +1.304576354255634e-03   +2.376917947855151e-02   -1.098733705058675e-02   +3.833278436717925e-02];
L2E_Input1_iAMPA_netcon = [+1.265928001755339e-02   +3.466506382464341e-02   +2.893372519089481e-02   -1.354224001354621e-02   +2.081035140660885e-02   -5.740864449991417e-03   +5.777801805293370e-02   +9.407293392203389e-02];
L2I_Input2_iAMPA_netcon = [+6.940945742283257e-02   +2.500109232188353e-02   +4.486596432847555e-02   +2.882937113297704e-02   +1.064383946222708e-02   -2.168614739311301e-02   +1.042379704249964e-01   +9.864755894165418e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
