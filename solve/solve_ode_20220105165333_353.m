function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.239113125613896e-01   +4.225844124386006e-01   +5.305176600371149e-01   +6.365647090846802e-01   +5.998727984512469e-01   +3.413618778185841e-01   +6.477623290994049e-01   +8.396411223243901e-01   +5.446265074644736e-01   +1.929840352861152e-01   +4.452325119527775e-02   +8.223049352350191e-01   +7.677846545584003e-01   +1.099156437012454e-01   -6.140521623350612e-04   +8.416330120605532e-02; +9.833265324909570e-01   +9.588308097934654e-02   +3.245381710402406e-01   +9.566923038527714e-01   +3.867814583824117e-01   +6.068805951613769e-01   +6.786070036383821e-01   +8.316687513813930e-01   +7.227489148972617e-01   +1.383039442478046e-01   +7.536134439462686e-01   +4.302310544124804e-01   +1.674055995381140e-01   +1.357863992815204e-01   +8.649350300592353e-01   +6.268944866852618e-01; +7.305443378621274e-01   +5.976821120474214e-01   +1.055983078110223e-01   +2.418046943777348e-01   +9.157925293282918e-01   +1.916167074610318e-01   +6.349869832514738e-01   +2.562055424653222e-01   +5.211967895858000e-01   +6.962320461613249e-01   +2.418001149637379e-01   +8.872767054339119e-01   +8.635714632061408e-01   +6.789934890557255e-01   +6.126559450411596e-01   +6.615453432006158e-01; +3.441659707678735e-01   +4.723841354787648e-01   +6.118357525184286e-01   +6.756898820389319e-01   +1.208434835480692e-03   +7.392710088063192e-01   +9.454891153083665e-01   +6.136076535303694e-01   +9.932753700209142e-01   +9.306131584551702e-02   +4.425813395539651e-01   +3.920298413744633e-01   +9.903056635253672e-01   +4.941569816008422e-01   +9.883300675848420e-01   +7.300875704166641e-01; +5.861195498070803e-01   +6.959911083776301e-01   +7.797047673422778e-01   +2.883797173192634e-01   +4.625110442487129e-01   +2.420328626248676e-01   +2.089868668822090e-01   +5.823394826875677e-01   +2.209074660337280e-01   +5.237956442823096e-01   +6.874481892584883e-01   +7.690773497816755e-01   +5.156753793782342e-01   +1.893195513583032e-01   +5.265482181382062e-01   +8.924940846671577e-01; +1.088194041133884e-01   +7.004017187792790e-01   +4.240032724763443e-01   +6.706157437350097e-01   +4.251699294935644e-01   +9.190885703388183e-01   +7.091612359574619e-01   +5.411161754360573e-01   +1.048818675968222e-01   +5.309469496995259e-01   +3.584673283585362e-01   +3.970631651786195e-01   +8.840133833674491e-01   +4.943481872397815e-01   +4.809200863475186e-01   +9.824101783035021e-01; +9.053475422709953e-01   +6.394830273892309e-01   +9.059076398935081e-02   +6.943020146692147e-01   +4.608806594381441e-01   +2.705180803978933e-01   +2.373198680539861e-01   +8.707945369478781e-01   +1.109255131359433e-01   +8.616523096315047e-01   +7.367847942105157e-01   +8.099589098763049e-01   +5.877151585373567e-01   +1.481185128157688e-01   +8.024947210697315e-01   +7.690805026435575e-01; +8.809909271170104e-01   +3.335262248797990e-02   +2.652705987766575e-01   +6.707042160965748e-02   +7.706944267213180e-01   +7.655917899261230e-01   +1.194202821883964e-01   +2.645943629684750e-01   +6.525074516216245e-02   +4.850899539185776e-01   +3.943328151006613e-01   +7.551130759850367e-01   +1.553901588563640e-01   +5.343290014400065e-02   +2.283240823133477e-01   +5.829110389437571e-01; +8.176409130180012e-01   +6.819666574816417e-02   +1.539664008479614e-01   +2.528198474111672e-01   +3.242396129540735e-01   +1.900429757403984e-01   +6.080263174719820e-01   +3.163018026710585e-01   +4.042180207785330e-01   +3.923933897872732e-01   +6.844209008431497e-01   +3.776308477325940e-01   +1.999187686457926e-01   +8.510263940099947e-01   +4.967273110223712e-01   +9.266995603092989e-01; +2.600847424861696e-01   +3.191452733833290e-01   +2.818405560885250e-01   +2.214599443301489e-01   +7.840902874182464e-01   +2.858499445534057e-01   +4.520490095854373e-01   +1.188590038688805e-01   +4.476920866455853e-01   +6.714013337561973e-01   +7.043445083036149e-01   +2.163340855542117e-01   +4.077588200062167e-01   +5.618981434482002e-01   +8.989759547956965e-01   +5.812742326124962e-01; +5.938656349442525e-01   +5.297419845241050e-01   +4.419998868323327e-01   +6.682131969962753e-01   +4.701060727216245e-01   +9.083924881793241e-02   +4.585916763876440e-01   +9.400795474539327e-01   +3.653312647845102e-01   +7.420024754555048e-01   +4.427322792413985e-01   +7.903330233258775e-01   +7.480350843711298e-01   +9.300871550519085e-01   +5.759334967958342e-01   +1.653460631344416e-02; +2.294770951966582e-02   +6.541115305768032e-01   +5.260773617818723e-01   +8.443016556992656e-01   +3.575392266947410e-02   +5.780465492879657e-01   +6.621336724814576e-01   +6.458294910934772e-01   +7.629898512228197e-01   +5.189549241409238e-01   +1.858511950764184e-02   +9.500023633630476e-01   +8.242740708274416e-01   +6.979618583518598e-01   +8.444470958940953e-01   +1.215171893588965e-01; +4.260494956898247e-01   +4.075792672980660e-01   +4.585831240134604e-01   +3.448485061678507e-01   +1.766603735463994e-01   +6.839722378526274e-01   +7.698815654965340e-01   +4.797265015251886e-01   +6.264120946774784e-01   +3.448841799839300e-01   +3.296722063987547e-01   +3.287171236663859e-01   +7.914017321765817e-01   +5.842847299175777e-01   +7.388330634814263e-01   +8.624044001645852e-01; +3.122339737896453e-01   +8.193045013201837e-01   +8.751174479579631e-01   +7.822811182931090e-01   +7.203046963552915e-01   +5.467369083170182e-01   +3.497716035305816e-01   +6.396209702682913e-01   +7.726136003667884e-01   +1.495725631300174e-01   +4.235076085924239e-01   +6.727130460065346e-01   +3.194274297503467e-01   +8.152365472969180e-01   +5.864528771428280e-01   +4.833132782345982e-01; +1.602867081770769e-01   +7.206975867835439e-01   +5.192249034541906e-01   +6.765055286797818e-01   +4.739015755082754e-01   +4.238862512031461e-01   +6.624005436821130e-01   +5.446469585867538e-01   +9.331944256181496e-01   +5.866553697185463e-01   +2.691304545910554e-01   +4.397285368886824e-01   +5.338813076452236e-01   +8.811139330465838e-01   +2.450034761928435e-01   +8.451976773752909e-01; +1.777986458813378e-01   +9.685326475091273e-01   +9.452956440114335e-01   +7.334052784455927e-03   +1.527502272218153e-01   +6.434039668988343e-01   +4.157831390415466e-01   +6.471017728036665e-01   +9.736997299041067e-01   +2.611246863445395e-01   +1.966283227044528e-01   +8.331360408797875e-01   +9.021056004161435e-02   +9.893275914696997e-01   +6.652359381250881e-01   +2.097293283791132e-01];
L1E_L1I_iGABA_netcon = [+5.510252788507861e-01   +6.943798018368047e-01   +1.049964781192992e-01   +1.773011002339277e-01   +5.468025804965558e-02   +1.786321737861737e-01   +5.959625052411099e-01   +9.968310368857570e-01   +3.392734546034520e-01   +7.790294300262904e-01   +6.835273677300645e-01   +3.652147943673952e-01   +7.829198008238696e-01   +4.327814390157939e-01   +5.948086218945608e-02   +9.704425321275749e-02; +6.316797960672453e-01   +4.992315338099486e-01   +1.424706544706558e-01   +3.985146978485706e-01   +1.779386805323956e-01   +3.604890776768986e-01   +3.004707173902915e-01   +3.309754143311381e-01   +2.940515691789698e-01   +3.378593100277069e-01   +1.317697927840021e-01   +3.688885921921115e-01   +1.007439580758395e-01   +6.550777652752828e-01   +3.140947148112199e-01   +1.416435372632508e-01; +3.249448984298985e-02   +5.354203606463693e-01   +1.673015429891237e-01   +1.332574790056505e-01   +6.608963743644921e-01   +5.616261517430125e-02   +1.350555017421368e-01   +2.973979630422043e-01   +7.456088423102618e-01   +6.078651471857839e-01   +7.233715744235293e-01   +6.848522236759259e-01   +2.930433887228049e-01   +1.115583750029659e-01   +7.719155365900487e-01   +1.687857479059537e-01; +6.143753646380152e-01   +4.436043323122823e-01   +6.224841893100105e-01   +2.899404827169485e-02   +3.322231918226152e-01   +5.222349485762245e-01   +2.110373569266515e-01   +6.237473015617478e-02   +1.087197554919921e-02   +7.415704691528499e-01   +1.098203154874370e-01   +5.976427930351879e-01   +2.365077845806265e-01   +9.319143165441438e-01   +6.954349287896414e-01   +1.958731183962895e-01; +3.631173881383610e-01   +1.240247417412783e-01   +5.740650235652318e-01   +9.384744998029105e-01   +8.982307901525384e-01   +3.348648256539425e-01   +8.959438752720317e-01   +2.975606923704230e-01   +4.805242983814221e-02   +1.057152236870163e-01   +1.172799154654089e-01   +7.883788813145901e-01   +5.302486406743619e-01   +1.858146032112861e-01   +1.253530172536677e-01   +3.174389958347183e-01; +4.957001469131227e-02   +4.916116550450749e-01   +5.300202034845770e-02   +3.024137024896329e-01   +1.169919328815152e-01   +1.737570807806656e-01   +7.218247139422669e-02   +4.461056718199049e-02   +6.675284478172768e-01   +1.265452255742796e-01   +6.402914288033454e-01   +3.683413777405429e-01   +9.270660429707037e-02   +2.666121936090022e-01   +1.279711107388476e-01   +3.175024597456581e-01; +4.873174183585960e-01   +8.528954005419378e-01   +9.320682819574321e-01   +2.958701118263828e-01   +9.881223009142525e-01   +2.108285698399046e-01   +2.429635767456958e-01   +5.058539485971015e-01   +6.047432444068541e-01   +5.488336561867154e-01   +3.286719469663439e-01   +2.055603228207308e-01   +4.054611698424181e-01   +7.978389922334240e-01   +9.147723769964135e-02   +2.172398555123938e-01; +1.919848970109968e-01   +8.747511369482749e-01   +7.280252269578287e-01   +3.354537961304678e-01   +5.414818780293615e-01   +9.056936406339753e-01   +5.405433276770329e-02   +7.609225636472221e-01   +5.267451145456814e-01   +4.851376270614163e-01   +6.539931540042724e-01   +8.713512634383574e-02   +1.039949225676476e-01   +4.877778054530574e-01   +8.332843833130316e-03   +2.517797257049257e-01; +1.222514962233097e-01   +2.708355455784947e-01   +7.368117824405918e-01   +4.685780461604372e-01   +7.055620627100843e-01   +6.746427346966400e-01   +4.408027729387209e-01   +6.316087911097186e-01   +7.295841524122925e-01   +8.904672837881266e-01   +7.508311673132450e-01   +7.726309291045710e-01   +1.108838070098939e-01   +7.695368264686958e-01   +4.241292151418221e-01   +8.934434629305171e-01; +2.062157287217911e-01   +2.100351013920622e-01   +6.339815585963919e-02   +6.480936945587241e-01   +9.988748660479165e-01   +4.682304073849229e-01   +1.466572126811082e-02   +9.119986655950442e-02   +7.074532566013945e-01   +7.999092964710813e-01   +5.840404816658948e-01   +2.073926716925736e-01   +7.859258620845659e-01   +3.971644496462929e-01   +6.553409630914471e-01   +7.029778348314089e-01; +1.464327379801152e-01   +5.637230902982419e-01   +8.594219905537551e-01   +2.416513338825473e-02   +2.878944200204819e-01   +9.120076405511736e-01   +8.971099960883407e-01   +8.060647640325132e-02   +7.805402826545484e-01   +7.347605456124388e-01   +7.408293787035681e-01   +3.888499059100179e-01   +2.908863169143386e-01   +2.727843795586541e-01   +7.233445592895342e-01   +5.555998836425506e-01; +1.888867122121697e-01   +6.386420082452423e-01   +9.330552966772462e-01   +8.426791723680794e-01   +4.134363982494521e-01   +1.033608904244158e-01   +1.954685816111560e-01   +7.752378458644346e-01   +2.881038668048182e-01   +5.252701160510754e-02   +2.343314025353462e-01   +5.519435267853787e-01   +6.037983067164175e-01   +3.747016187413340e-02   +5.301531887394499e-01   +1.842523124370806e-01; +4.315940697049180e-02   +4.163288487972146e-01   +9.838923915425469e-01   +5.582978256879456e-01   +4.664624542408543e-01   +7.447209291899423e-01   +9.296184252152978e-02   +9.054939369913342e-01   +6.901419470295332e-01   +7.242051730839782e-02   +7.344965159603454e-01   +2.286931869855802e-01   +9.636250653600815e-01   +6.737826099657710e-01   +1.077638036628740e-01   +2.116527443418342e-01; +6.350175335702147e-01   +2.065207501977823e-01   +8.573204280400318e-01   +8.535006908279401e-01   +7.643371120402843e-01   +7.376422284638711e-01   +3.072217057170277e-01   +5.336082793556597e-01   +5.554732651112827e-01   +8.726943644074461e-02   +9.717087666313131e-01   +6.421007945279290e-01   +4.317340958735473e-01   +4.306759245541114e-01   +6.327337452605096e-01   +7.746792704814180e-02; +2.819170108477090e-01   +9.489063100372968e-01   +7.854162341604403e-01   +3.484498405386648e-01   +8.176433828997800e-01   +5.619833212790326e-01   +4.556792516960612e-01   +1.084492764287898e-01   +3.948998372909908e-01   +7.957946845861008e-01   +8.674635934345235e-01   +4.832826671668635e-01   +6.945173962686986e-01   +4.507809959300896e-01   +1.286264915571177e-01   +9.143313535165399e-01; +5.375753720049393e-01   +8.094547092518600e-02   +5.143267809761444e-01   +4.464204641609134e-01   +9.933254378281392e-02   +1.854642507691537e-01   +1.017700158269538e-01   +8.269461648589166e-01   +6.157403799418674e-02   +9.423803630452618e-01   +8.662288984812438e-02   +1.516123095719489e-01   +7.584989513065361e-01   +6.084668020580821e-01   +1.345081407643502e-01   +7.070884162967765e-01];
L2I_L1I_iGABA_netcon = [+5.585849773499978e-01   +1.593458328756344e-01   +4.231695779457632e-01   +6.830116411116171e-01   +8.085845988137146e-01   +7.951583708599664e-01   +7.884794066758879e-01   +2.618028294793683e-02; +3.127871735918655e-01   +7.586607387822520e-01   +4.293572387543280e-01   +4.633941200712969e-01   +7.477398673441787e-01   +5.778665093005171e-01   +8.512399344044690e-01   +4.209014076083694e-01; +1.658705154306203e-01   +8.705831460632637e-01   +1.253019792678597e-01   +2.130998278814348e-01   +1.186024878420420e-01   +4.415555238688413e-01   +5.065349934296817e-01   +1.827966271476184e-01; +6.214067747064139e-01   +3.510670815068376e-01   +2.375311518566556e-02   +9.843857531255251e-02   +5.250568501065751e-01   +2.572402953899829e-01   +6.355808131929285e-01   +7.267044803683532e-01; +9.875571350527427e-01   +6.856890172470862e-01   +2.902722812484106e-01   +8.229658355196621e-01   +3.250534408880721e-01   +7.522193484142010e-01   +9.519651622874686e-01   +3.700688613696837e-01; +1.712646631852235e-01   +2.934406543399679e-01   +3.182527346377415e-01   +1.755970500136871e-01   +5.459482465936802e-01   +2.287211978090918e-01   +4.439888457606381e-01   +8.416268775339689e-01; +2.582092053359554e-01   +5.298282817354597e-01   +6.538504229082185e-01   +1.644059947651674e-01   +4.001860268347454e-01   +6.522747927744528e-02   +5.814759146993804e-02   +7.328483596576379e-01; +3.974966247039329e-01   +8.329661257238976e-01   +9.572266030686705e-01   +6.674632306573971e-01   +4.153607228375825e-01   +7.666921615304957e-01   +8.676443965266014e-01   +5.692154040091025e-01; +7.499145846691928e-02   +5.992478504505432e-01   +9.368502704986845e-01   +8.935071917032469e-01   +1.795031936515301e-01   +6.719624809042093e-01   +6.307356709599488e-01   +1.776086425385255e-01; +6.840403567185465e-01   +3.348181418804267e-01   +4.581544470555289e-01   +5.165444287153609e-01   +2.558009526307714e-01   +7.142100491678696e-01   +3.529279238521430e-01   +9.592498798981395e-01; +4.039501233573225e-01   +2.987619202346785e-01   +2.400444861546160e-01   +7.027913337319189e-01   +1.940256807357360e-02   +6.428345219188965e-01   +9.969531666224498e-01   +2.651927791100942e-01; +9.824880902913928e-01   +4.528692826929975e-01   +7.644053809893964e-01   +1.521234136172084e-01   +9.229075288526384e-01   +4.191265203356694e-01   +2.249200182595119e-01   +9.247134385618109e-01; +4.008783860563633e-01   +4.235993700589619e-01   +7.593857167215541e-01   +9.530423050857216e-01   +6.544210652222268e-01   +3.901591050394441e-01   +6.523957157940423e-01   +2.221323075781423e-01; +6.215371735913912e-01   +3.596284962315691e-01   +7.398579007164434e-01   +5.402948116980019e-01   +9.335942630357341e-01   +8.174479180692896e-01   +6.039260684069117e-01   +3.726198038552960e-01; +1.550391008037172e-01   +5.604978026160051e-01   +7.445119038457062e-01   +6.809835734625290e-01   +1.642581848746449e-01   +3.163857982469463e-01   +3.874604820937356e-01   +8.796944673240990e-02; +3.818067131859468e-01   +7.428450937140513e-01   +1.085690854856481e-01   +3.708572864082164e-02   +9.221925975052363e-01   +8.159319787260294e-01   +1.402049454911135e-01   +6.413067507631600e-01];
L1I_L2I_iGABA_netcon = [+1.812238673868444e-01   +9.118603656727873e-01   +2.759088431415870e-01   +8.685371809305320e-02   +5.334084370151099e-01   +1.067609959219997e-01   +9.887167837519687e-01   +4.116235965738698e-01   +7.194577344249283e-01   +2.177200411991920e-01   +9.222688089910243e-01   +6.738594407985848e-01   +1.064838330178173e-01   +5.562140860924117e-01   +6.307488805365528e-01   +4.837783678813563e-01; +4.567306670762280e-02   +8.002583238495025e-01   +2.473754233164965e-01   +8.028553049114816e-01   +8.869454014833693e-01   +6.152648536456123e-01   +7.671805746217351e-01   +6.009583649314986e-01   +9.968106722107226e-01   +1.261976946382755e-01   +7.699934273722201e-01   +4.773202482776491e-01   +1.805740783676051e-01   +7.714411036231206e-01   +1.005139410100605e-01   +8.944429453783544e-01; +7.233651316528596e-01   +7.447590335961013e-01   +4.522782091758527e-01   +9.893304677229557e-01   +8.981842494546195e-01   +9.405256171411709e-01   +3.362766916959172e-01   +7.495939452413708e-01   +3.545836166838216e-01   +3.087051886442174e-01   +4.239920615252889e-02   +6.237071889024958e-01   +9.983745689578126e-02   +3.122608114531508e-01   +3.922641924950076e-01   +1.388749566043080e-01; +3.486167378620244e-01   +8.123926555547852e-01   +2.266649701677069e-01   +6.653795442271851e-02   +6.258572809867390e-01   +3.530681519551624e-01   +6.629020634503994e-01   +5.844856520889125e-01   +9.709043450192816e-01   +7.249449325408264e-01   +3.795141805300842e-01   +2.375051857802099e-01   +4.902418244299163e-01   +1.781916995684283e-01   +5.529477270877051e-02   +3.889992290693813e-01; +6.603280075153258e-01   +3.834238057871142e-01   +8.048556041834103e-01   +9.401400586088110e-01   +1.374239297743645e-01   +4.109940069764633e-01   +2.456688267129978e-01   +5.516381304454264e-01   +3.479186237416844e-01   +7.829149698825937e-01   +7.040111406091222e-01   +1.780570394595877e-01   +1.927943911366962e-01   +3.382114309688371e-01   +5.005710426320760e-01   +9.274472946241573e-01; +3.855192689786546e-01   +6.181432194679461e-01   +9.855150773807211e-01   +1.776036796423799e-02   +2.185919208279154e-01   +9.837184130497659e-01   +2.942684150013872e-01   +5.806839465956986e-01   +8.860627609273376e-01   +6.921144904627271e-01   +7.273008030621479e-01   +8.286072510969038e-01   +8.941115037692385e-01   +2.098098893842382e-01   +4.310013986828576e-01   +9.192838033248123e-01; +6.279958621832404e-01   +5.772889514369181e-01   +3.039377257182462e-02   +6.845754444444339e-01   +1.812160598368122e-01   +9.457062697003856e-01   +6.783925804354964e-01   +5.114962998304086e-01   +4.549011303008820e-01   +9.943162267835095e-03   +2.253905612232214e-01   +7.659277483817032e-01   +9.907788876408714e-02   +5.102718550899569e-01   +9.982628910401016e-01   +7.153426014359513e-01; +2.315015563627962e-02   +5.276306402439624e-01   +5.357081069002138e-01   +7.834536349349552e-01   +4.220226018696777e-02   +6.773197398329132e-01   +5.265262671673616e-01   +8.120579024325203e-02   +4.148175039006519e-01   +8.452935060569354e-01   +2.687316611039230e-01   +9.348268246419073e-01   +4.452213451630239e-02   +9.047114612119518e-01   +8.103988272500199e-01   +6.177556177616129e-01];
L2E_L1E_iAMPA_netcon = [+3.424739156275333e-01   +7.584505848174204e-01   +5.897001812555170e-01   +5.013239564503794e-01   +8.521530746833680e-02   +4.764108271247196e-02   +9.237948219925828e-01   +4.756806655274805e-01; +9.369369287735393e-01   +4.143241171092388e-01   +6.615186349694921e-01   +4.893420805472111e-01   +9.742009257617533e-01   +3.436775766681553e-01   +8.010966808250641e-01   +3.640561549909374e-01; +1.236541630095622e-01   +4.936696894493720e-01   +4.817139070564339e-02   +8.787806557103118e-01   +6.512113637583790e-01   +7.376086871443742e-01   +2.864866999354578e-01   +7.884481648845961e-01; +7.313460308847864e-01   +6.961360751467276e-01   +3.484778464679158e-01   +3.520695925935597e-01   +2.313271392016717e-01   +7.951467991336151e-01   +5.439948959956274e-01   +7.807688900111722e-01; +6.467532912541751e-01   +9.741988670484553e-01   +4.491210763071092e-01   +4.487863276259597e-01   +4.026734732930548e-01   +5.449593594131380e-01   +9.838776743494724e-01   +6.683785302211939e-01; +8.332661968061505e-01   +3.276106867131610e-01   +2.387659897439326e-01   +9.639314100729627e-01   +1.212069062356992e-01   +6.872316474857080e-01   +7.153780426246583e-01   +1.336332942039608e-01; +3.969603116348941e-01   +8.375115371358696e-01   +7.148816462991151e-01   +4.229826530709777e-02   +2.686126518302693e-01   +8.953122780365763e-01   +8.383300979066295e-01   +1.986145619088947e-02; +7.501472020410896e-01   +7.400054126794609e-01   +8.572602888147179e-01   +9.739643179767209e-01   +2.561621005219999e-01   +5.390705511169582e-02   +4.346483494504948e-01   +5.597710443821894e-01; +8.351173981714370e-01   +9.539282009547669e-01   +2.830022905666968e-01   +1.876606778756177e-01   +3.328327629527541e-01   +3.039919303352369e-01   +4.713337260874657e-01   +3.014824363184080e-01; +3.238460840574042e-01   +3.315929419773238e-02   +7.314253275867462e-01   +6.661066637124401e-01   +1.495123379102110e-01   +4.533714245947108e-02   +5.612542990036891e-01   +9.388316027361401e-01; +5.514289748844018e-01   +3.552987305525996e-01   +1.399147497980215e-01   +5.878948616477557e-01   +3.474259441012447e-01   +1.952879980989448e-01   +2.694693122093296e-01   +9.819002031386527e-01; +9.811217333826822e-01   +6.622641210588572e-01   +8.390118852318675e-01   +6.754278330580430e-01   +1.206060298882600e-01   +7.187952450389588e-01   +7.481238315151911e-01   +2.863111548868150e-01; +5.486402381789934e-01   +2.815190617928024e-01   +1.390749155991746e-01   +3.592974176948384e-01   +8.833482907070963e-01   +7.222570397897949e-01   +5.043454759018563e-01   +8.004328336736567e-01; +3.310787696002219e-01   +2.303669921625846e-01   +5.875804677461395e-01   +6.200907303695673e-01   +9.527283951230137e-02   +8.776467791437084e-01   +6.471077340278909e-01   +8.947588384740159e-01; +6.188777059460518e-01   +7.103339055167771e-01   +3.670335368185047e-01   +8.110681505259530e-01   +9.308919286309275e-01   +5.806888098960448e-01   +3.077487437793237e-01   +5.985705147557183e-01; +3.620667118310160e-01   +6.235043540517680e-01   +8.058021198218167e-01   +1.986164556153017e-02   +4.000142198833712e-01   +7.230463684280281e-02   +1.390370037435880e-01   +8.838357035458119e-01];
L1E_L2E_iAMPA_netcon = [+9.429065454945824e-01   +3.724584799579384e-01   +6.681043431013060e-01   +4.852894263701964e-01   +2.469419207628494e-01   +4.520793592303503e-01   +1.232844099964366e-01   +4.972504057244380e-01   +8.824918805605390e-01   +3.244337359896365e-01   +5.144776204870085e-01   +8.580686643096652e-02   +6.318030625215110e-01   +4.289825412189838e-01   +6.128299090323538e-01   +5.035729481871823e-01; +5.486589337392082e-01   +9.364457927404116e-01   +2.088039111797223e-01   +7.573496871222637e-01   +7.849265422860805e-01   +2.058037522469062e-01   +4.061543119251187e-01   +6.932524372114323e-01   +7.196426839938653e-01   +2.459899115763146e-01   +6.575902658698601e-01   +1.632244606285732e-01   +8.584251277342746e-01   +4.919732260724895e-01   +8.203733661307349e-01   +6.124290572087694e-01; +7.288226823446790e-01   +8.287082691239550e-01   +6.535784700233856e-01   +4.163869259395100e-01   +8.828850218076050e-01   +8.986512932620262e-01   +2.758959595371083e-01   +8.336127330917310e-01   +1.899759191967723e-02   +3.430407673267973e-01   +9.516749612138679e-01   +3.245685411190443e-01   +9.761323964329250e-01   +7.137251589613085e-02   +8.865004055040905e-01   +8.198863186773275e-01; +5.772625869416644e-01   +8.500768039458216e-01   +7.215368789260174e-02   +9.723428286592275e-01   +9.122491824570664e-01   +7.634496487636830e-01   +7.170521482579216e-01   +6.117632340696826e-01   +6.742899737031951e-01   +3.754373201390603e-01   +7.224238149732284e-01   +3.015106741258839e-01   +5.696795347747311e-01   +8.876833815387167e-01   +9.309677936454525e-01   +5.327944472229031e-01; +2.556580496514316e-02   +3.714854111501149e-01   +4.071791019243475e-01   +9.893477587266202e-01   +5.580133721685282e-01   +8.832105748016069e-01   +2.828157845135836e-01   +5.747805169488572e-01   +4.392297923674285e-01   +5.454584958921229e-01   +3.997893896581741e-01   +1.156753787454324e-02   +9.968804333342497e-01   +6.483396799623928e-02   +1.921115712689944e-01   +2.026043574402044e-01; +4.474906862486023e-01   +5.927318174563956e-01   +6.659491103212728e-01   +8.637414264729906e-01   +5.991442340299350e-01   +2.865848793380592e-01   +8.959147133437737e-01   +3.240892724474796e-01   +4.363505618046580e-01   +5.635219855424155e-01   +8.340620062565750e-01   +5.411125934548837e-01   +5.534707522577365e-01   +4.354605519674269e-01   +2.578013506152874e-01   +4.546934150308026e-01; +6.473982607443994e-01   +8.741934236751105e-01   +9.360237425756246e-01   +3.878362073236286e-01   +1.480178071832989e-01   +6.710612911310262e-01   +8.269782087560874e-01   +4.558671700388550e-01   +1.163139237864269e-01   +3.950274073185263e-01   +1.354890604998610e-01   +9.667015829074491e-02   +5.150625168110355e-01   +8.252958817082039e-01   +8.968940903199716e-01   +4.284721071962183e-01; +5.217793516343984e-01   +9.334389216868605e-01   +8.094993990631889e-01   +4.535815660414350e-01   +9.014316679947717e-01   +6.635203890590676e-01   +3.900541338876578e-01   +7.141735964810458e-01   +8.144729882205787e-01   +3.970111696781531e-01   +5.992940861049813e-02   +1.471661430155182e-01   +3.316450759746011e-01   +3.924835487807965e-01   +5.938809430066809e-01   +9.657095255055500e-01];
L2I_L2E_iAMPA_netcon = [+6.194117395372984e-01   +6.958625313337458e-01   +7.344380398681127e-01   +5.902888610072070e-01   +6.695895254998367e-01   +5.501170731975149e-02   +9.943604984688570e-02   +8.482904773468803e-01; +6.971766309294555e-01   +4.265105203834137e-01   +4.300696484046191e-01   +4.590829981274119e-01   +5.004941781434457e-01   +1.536098841178598e-01   +9.079338248341624e-01   +9.171371520406224e-01; +7.211711559510150e-01   +8.367197992943467e-01   +6.940991232737937e-01   +5.205547950314152e-02   +2.194435581134605e-01   +1.980107101382501e-02   +1.103026332110690e-01   +9.869311187006831e-01; +3.473148219563479e-01   +7.304171646163673e-01   +9.452987344487643e-01   +2.287569679880614e-01   +5.721027577248964e-01   +4.351308231808552e-01   +5.179480185027322e-01   +5.039113456854520e-01; +5.175525886581203e-01   +3.604035500154008e-01   +7.840361004703822e-01   +8.337893128406881e-01   +1.221327571169219e-01   +8.321220525484029e-01   +1.429777540231037e-01   +2.709649928723654e-01; +5.570924270054846e-01   +4.538571861619460e-01   +7.054711428896505e-01   +1.522997370334455e-02   +6.704582408466586e-01   +6.167994802193020e-01   +5.590567940821346e-01   +1.012561613959262e-01; +1.577844105264739e-01   +3.875492841447146e-01   +1.093507278769706e-01   +8.642699415300019e-01   +5.997373684987714e-01   +5.193220363386145e-01   +4.657877804072513e-03   +5.081693199375036e-01; +5.636957110857276e-01   +7.753036361017552e-01   +3.897646920343608e-01   +7.885802618005854e-02   +5.582376579086777e-02   +8.634636982770815e-01   +7.679653098359877e-01   +5.845288934140132e-01];
L2E_L2I_iGABA_netcon = [+7.643550037525482e-01   +9.420964400503700e-01   +2.384295643807152e-01   +8.334658269116783e-01   +2.577162061532093e-01   +7.521754710872812e-02   +1.736918938205556e-01   +5.237990091093538e-01; +8.267432811554593e-02   +6.567783258634814e-01   +5.782112747132631e-01   +4.023725996948915e-01   +2.985111043718939e-01   +3.943430812433916e-01   +1.396431223404099e-01   +2.647007048671303e-01; +6.602325330022859e-01   +4.515098710339296e-01   +8.664416823422932e-01   +3.910410367379200e-01   +4.248846037925709e-01   +3.999188478934313e-03   +5.980493245131787e-01   +6.823765763361028e-02; +5.166851805111121e-01   +8.397854188574110e-01   +4.056896526595224e-01   +3.620435267874125e-01   +1.183147654491444e-01   +2.198295966315005e-01   +8.997658783843909e-01   +4.361578726808570e-01; +1.719652350583395e-01   +5.332278307198505e-01   +1.120416410233567e-01   +1.379640322453219e-01   +4.967786139079218e-01   +4.995301477904943e-04   +9.388803914706928e-01   +1.727792679016101e-01; +9.398632409101126e-01   +5.537912505490568e-01   +4.440285266507248e-01   +2.577163796316006e-01   +7.065946095213477e-01   +1.903140118841991e-01   +2.200058607068371e-01   +2.696433395901290e-02; +5.911126947551940e-01   +6.804723851238162e-01   +2.981026834990456e-01   +8.645225275776074e-02   +2.436685976970691e-01   +1.421754016702193e-01   +4.812884235364511e-01   +9.540149951494384e-01; +4.403890519560672e-01   +3.672030946645164e-01   +4.010562598343416e-01   +4.292726162620117e-01   +7.846885445207867e-01   +2.678915708992727e-01   +3.768445971350304e-01   +4.308517751485146e-01];
L3E_L2E_iAMPA_netcon = [+9.618016859125491e-01   +7.731111191406126e-01   +9.113252968712383e-01   +5.309508846465978e-01   +4.762808028556329e-02   +8.187065791323928e-01   +6.251454346484241e-01   +7.484329108703002e-01   +6.737738647322697e-01   +9.053881050921204e-01   +5.822506700668594e-01   +5.921482855482470e-02; +7.624706040329285e-01   +2.270764670005380e-01   +9.074508995471762e-01   +7.160770711632923e-01   +5.520524108319006e-01   +7.268203293839058e-01   +5.419402398828573e-01   +6.464568050730048e-01   +4.318388426281067e-01   +3.939532154552207e-01   +6.868982282828027e-01   +9.809081440890876e-01; +8.226616591079688e-03   +3.704371875820177e-01   +5.916628654382606e-01   +1.800053126055276e-01   +2.743400176447273e-01   +1.779343587515286e-01   +4.377545709393417e-01   +1.217638107791308e-01   +6.924185901893467e-01   +2.515050462989126e-02   +7.204616060725036e-01   +2.846823083003395e-01; +6.796731914728107e-01   +8.921649837377841e-01   +3.315967427957058e-01   +3.350933396902980e-01   +2.433718381371860e-01   +3.607140120219220e-01   +2.865553446334221e-01   +5.051733323504215e-01   +2.568776713952982e-01   +6.703582870532587e-01   +6.492787677016526e-01   +5.936459990529347e-01; +7.049285796768469e-01   +8.566821306674659e-01   +8.530543492852329e-01   +1.871319167497325e-01   +2.426433353933103e-01   +1.870051622818086e-01   +5.010759684214909e-01   +3.477819733420980e-01   +1.161610111574220e-02   +8.371964001493390e-01   +7.254042636438067e-01   +9.610972521266742e-01; +6.452592684860190e-01   +4.010707876196840e-01   +4.428218369035971e-01   +3.211748700415916e-01   +1.545084319996010e-01   +1.191918075898880e-03   +7.627388397689766e-01   +9.075842358977279e-02   +5.314640149030287e-01   +9.711325664272715e-01   +3.743760240135601e-01   +1.870894530321396e-01; +5.536995315572873e-01   +3.189419295692268e-01   +9.021438397971075e-01   +4.039657150440820e-01   +9.581965242813354e-01   +3.144687836888276e-01   +7.617423762828008e-01   +1.478031226696889e-01   +2.797996165649739e-01   +5.682559532913674e-02   +5.802020530405967e-01   +1.929684862850506e-01; +2.176065695922334e-01   +6.084746825247209e-01   +3.426106457008500e-02   +5.484574266391041e-01   +9.361404321812743e-01   +6.984951171157330e-01   +5.767597870773348e-01   +1.991428854722015e-01   +9.459700341154791e-01   +4.498877159533141e-01   +1.146544620104900e-01   +3.405833875614704e-01];
L3I_L2I_iGABA_netcon = [+9.332279364056867e-01   +9.295122696023302e-02   +6.189903223319065e-02   +2.783930331321908e-01   +2.545233311635389e-01   +4.041561466342616e-01   +5.295096550257514e-01   +1.088065238515298e-01   +9.126197071774048e-01   +5.844208812722412e-01   +2.084650156926660e-01   +9.079600606368845e-01; +3.907795588706082e-01   +6.167455465945210e-01   +4.946129139230690e-01   +7.459216153249825e-01   +8.577038927210634e-01   +9.877053994313518e-01   +8.296410277742670e-01   +2.711465935928702e-01   +6.392664493173731e-01   +2.836040395609762e-01   +3.176306587606292e-01   +5.512189543738183e-01; +2.725614970147624e-01   +1.139444360203178e-02   +6.434894099970611e-01   +2.378890142476668e-01   +9.112234340631090e-01   +8.962576493659619e-02   +8.574096885052530e-01   +5.239599919447456e-01   +2.550157017021218e-01   +8.279774509743461e-01   +1.333539267756187e-01   +3.398766823404085e-02; +1.523191087259942e-01   +5.732710051517353e-01   +2.226668836319654e-01   +9.575575833458287e-01   +6.993273974934177e-01   +3.222095666838605e-01   +7.882325046054988e-01   +9.725153589042229e-01   +9.049586855178554e-02   +1.918585166739927e-01   +6.725592696685750e-01   +5.405668497242513e-02; +3.966389514393470e-01   +7.877161862212317e-01   +8.376424751621858e-01   +6.217141452705953e-01   +7.262849554025047e-01   +5.135024023099354e-01   +3.189267690365752e-01   +7.088536030837957e-01   +8.385533498017667e-01   +4.412804784910093e-01   +5.703181365068517e-01   +8.058043018173278e-01; +3.745588922038295e-01   +2.355628204889383e-01   +9.711180928618324e-01   +6.007426472206009e-01   +2.302250581411041e-01   +5.909407444701029e-02   +4.527440162940255e-01   +3.106686414616263e-01   +5.843096374650123e-01   +3.931368207174013e-01   +1.703589469819752e-01   +4.515413702371978e-01; +1.294717844433678e-01   +4.479956289706388e-01   +8.466605885642332e-01   +1.729493517179508e-01   +5.745781837545626e-01   +7.252550277741572e-01   +7.525213827667906e-01   +2.936958924762020e-01   +9.483316870187669e-01   +8.272301092457069e-01   +1.478302672518784e-01   +3.809089877317586e-01; +4.340665219862691e-01   +5.691114736839176e-01   +5.066656441307723e-01   +8.997040398069792e-02   +8.111521911267796e-01   +5.571914218024030e-01   +1.109578612555542e-01   +8.498390173175036e-01   +6.165629688131088e-02   +6.788039684959790e-01   +4.762119654641753e-01   +7.906014258187215e-01];
L2E_L3E_iAMPA_netcon = [+3.646652657969785e-01   +7.558462927386014e-01   +7.409423285514170e-02   +5.178759165665003e-01   +7.576917068018131e-01   +4.319617256003954e-01   +1.997087259124570e-01   +8.758447706715197e-01; +5.318421747149130e-01   +9.975736304123118e-01   +5.914548169864571e-01   +9.946175376867263e-01   +9.951431616750049e-01   +5.426640168758495e-01   +1.935995669487101e-01   +7.862408338619666e-01; +7.130750311831009e-01   +1.875532890027142e-01   +9.101662304059057e-01   +8.566316390380624e-01   +9.626206985108384e-01   +7.119096901997681e-01   +3.265149080390743e-01   +4.666634315628806e-01; +8.709668220127698e-01   +7.810561963469128e-01   +1.918568736172876e-01   +9.611093094921480e-01   +5.356931205000621e-01   +1.603186948250256e-02   +8.803643776469959e-01   +8.135256408389062e-01; +3.289429672095954e-01   +1.956403949072176e-01   +4.316730296871177e-01   +6.780402745463845e-01   +9.655582677933899e-01   +8.015985689537551e-01   +4.716153567515641e-01   +8.969254818103075e-01; +6.495558312337004e-01   +9.921517963811232e-01   +7.488957738108939e-01   +4.023206807255493e-01   +1.171095490713486e-01   +1.421016596819212e-01   +4.042748649076216e-01   +4.281004194505894e-01; +9.761419943568874e-01   +8.017520003729359e-01   +4.000899640342981e-02   +9.336042197175021e-01   +5.016341958633047e-02   +4.793805691903908e-01   +1.804561599492784e-01   +3.338928494704774e-01; +7.655404614626007e-02   +4.241953594553768e-01   +9.461456413756776e-01   +4.802217867777696e-01   +3.028813422607036e-01   +2.554781147400445e-01   +9.694308741332452e-01   +5.965123660985587e-01; +5.885615901855612e-01   +7.286887035787590e-01   +7.633916213949071e-01   +2.298378499039887e-01   +5.813560576824800e-01   +3.694736606934328e-01   +4.084425749950261e-01   +9.010676614164829e-01; +4.130489012967407e-01   +4.976289871677862e-01   +5.568140830545872e-01   +3.966323732816291e-01   +5.319172647674412e-01   +6.611674889057434e-01   +8.441397643056705e-01   +7.018324542480724e-01; +3.085818041231011e-01   +8.088428050572969e-01   +1.836919858781043e-01   +7.044974447387394e-01   +9.004392438948454e-01   +1.680641669461782e-01   +6.167630066197773e-01   +3.785460891067361e-01; +2.636473927565278e-01   +3.570758021572994e-01   +5.001242377352568e-01   +5.585104665286793e-01   +5.402522542379979e-01   +2.799583724529752e-01   +3.744881204064941e-01   +7.349546680560615e-01];
L2I_L3I_iGABA_netcon = [+9.547219864618770e-01   +3.138141353123087e-02   +9.089794587644517e-02   +4.595405080950866e-01   +3.271187214416486e-01   +3.676886160060027e-01   +6.851729678991834e-01   +8.048957529989285e-01; +5.425022286085405e-01   +2.084697344902657e-01   +5.936589773089423e-01   +6.383507752426519e-01   +8.043601939002836e-01   +2.097998000472444e-01   +9.100652942132107e-01   +6.651380432167070e-02; +5.388009750747194e-01   +4.544687700590201e-01   +2.406926132976700e-01   +9.165271166143375e-01   +9.999530575611186e-01   +4.405312841668418e-01   +6.109515769148027e-01   +9.484513454404051e-01; +3.094456419383247e-01   +1.265665917048055e-01   +8.391766995720188e-01   +1.612757900367979e-01   +9.795503529077767e-01   +9.543875667731152e-01   +8.997569794306932e-01   +4.954971881077601e-01; +6.986794452536656e-02   +9.268571818957834e-03   +8.575901793131482e-01   +7.140577892474537e-01   +1.255900740017830e-01   +1.236102666688190e-01   +1.937492443525237e-01   +7.539507287393544e-01; +1.822483042966541e-01   +7.276665337511212e-01   +9.611727943235561e-01   +5.771302005840447e-01   +2.302129984847866e-01   +4.695365781746453e-01   +7.536151026462632e-01   +7.402273754242892e-01; +9.218688251286000e-02   +3.530084783165180e-01   +4.885673815569115e-01   +4.318284332435992e-01   +2.390918162086118e-02   +8.548863035200395e-01   +3.472347608640884e-01   +8.308500653873815e-01; +4.637671078610764e-01   +7.789453042245503e-01   +2.185519572753733e-01   +8.829447178856400e-01   +6.077644865126425e-01   +4.227864473426332e-02   +4.188747763861713e-01   +1.556800448324104e-01; +9.941875045661101e-03   +4.363084775814773e-01   +2.267289463857794e-01   +3.914041401898506e-01   +1.095989188117728e-01   +6.898061097886372e-01   +1.542720200276304e-01   +4.570344317734706e-01; +9.140453628281655e-01   +4.370736685492482e-01   +5.366327681292693e-01   +1.775683813273025e-01   +4.069284952954378e-01   +9.768651842984056e-01   +8.190774455409100e-01   +6.184868415450896e-01; +6.423942413789496e-01   +5.036427741636103e-02   +7.618184801642314e-01   +6.314374852105037e-01   +8.835689178763324e-01   +2.837551696570377e-01   +6.227917176009774e-01   +9.297396525579767e-01; -7.661952761615592e-05   +4.805119857861475e-02   +3.460339862810223e-01   +6.237719498864667e-01   +5.483200810784923e-01   +1.335721074763351e-01   +7.397760005200125e-01   +8.337820788072802e-01];
L3I_L3E_iAMPA_netcon = [+8.948356514696451e-01   +2.551648840508872e-01   +7.402414868115222e-01   +6.815411814002369e-01   +6.017043716860145e-01   +7.484869780783997e-01   +7.454983591917596e-01   +2.233517244088341e-01   +4.527803618473857e-02   +8.008108291654560e-01   +2.905507019968400e-01   +8.023589705439269e-01; +5.819091478846363e-01   +3.227701035895870e-01   +6.934462576502217e-01   +2.360811129587176e-01   +8.560393398549861e-01   +5.435436073896295e-01   +1.270727957795840e-01   +3.513061961060420e-01   +2.139185269066460e-01   +2.337926244420943e-01   +4.030165038730689e-01   +1.037038845000646e-01; +5.825896405785754e-01   +4.018730374033348e-01   +8.229822932060875e-01   +4.555709920141380e-01   +9.897269797809989e-01   +3.392977541781673e-01   +8.215661461837936e-01   +2.863351810155009e-01   +3.970371089270022e-01   +9.311041454895105e-01   +8.628772047089165e-01   +8.210246785213596e-01; +8.553434245858084e-01   +4.052811696114717e-01   +8.289222086189009e-01   +3.838126854357420e-01   +9.290070278363178e-01   +8.321706902586071e-01   +2.664247779184955e-02   +9.270923365742723e-01   +3.337076018374784e-01   +7.631746800769891e-01   +6.149998834202173e-01   +8.410016389967174e-01; +3.353352515753229e-02   +3.864343510068036e-01   +2.948930751083677e-01   +5.379522695312919e-01   +4.103596531549333e-01   +5.511525743903980e-01   +4.160963489604204e-01   +5.093098025202342e-02   +2.286923365888473e-01   +8.276442662850182e-01   +9.904276131333549e-01   +3.559094299818614e-01; +8.844391790911470e-01   +6.087644601705992e-01   +3.089233211243566e-01   +9.909679739562969e-01   +7.906794654392254e-04   +9.578490236850414e-01   +7.301986501520961e-01   +5.928620485994618e-01   +9.348325712520948e-01   +5.729195295429592e-01   +2.037326747513513e-01   +4.296808367398280e-01; +4.066160752889168e-01   +1.654096152196309e-01   +5.238630280877483e-01   +7.553363925584373e-01   +5.424003856883391e-01   +8.933358107885601e-01   +7.815992068766705e-01   +1.617996525771578e-01   +6.819396077993664e-01   +7.926438466585162e-01   +8.280626402485904e-01   +5.702366289846630e-01; +3.679061939066813e-02   +1.888367510918357e-01   +3.269876235153523e-01   +9.816452098809436e-01   +2.084661504884617e-01   +3.575297372967919e-01   +3.677330775539107e-01   +8.376109212931231e-01   +9.634472272307731e-01   +3.290754376378219e-01   +6.766098343245081e-01   +6.999306391485385e-01; +7.461655786404217e-01   +9.600521668509862e-02   +8.342204285762896e-01   +2.351797623371684e-01   +2.196497963615031e-01   +5.479046646647071e-01   +7.464028895992670e-01   +1.680672486499627e-01   +4.388855087874433e-01   +2.235171319459815e-01   +2.486526166839772e-01   +7.431468378949382e-01; +1.556849839541507e-01   +3.220646406666661e-01   +8.088841710788631e-01   +5.286768013298944e-01   +3.278301553570182e-01   +3.468162475060694e-01   +8.925222223272754e-01   +5.012757364182163e-01   +9.385650393664410e-01   +3.110892997336045e-01   +4.772732688748422e-01   +7.571389569122597e-01; +1.442338149404970e-01   +7.699333607001377e-01   +5.586623357918619e-01   +5.352221411277543e-02   +9.601463111187433e-02   +6.230217119535701e-01   +2.444176198296158e-01   +9.989450526632880e-01   +5.862508188334234e-03   +5.847848061583744e-01   +3.991691080580198e-01   +3.892012196955809e-01; +6.067981869815651e-01   +2.351594236752655e-01   +2.638232765397637e-01   +7.577221678608091e-01   +7.495863295604627e-01   +7.980470911266438e-01   +1.291496552504239e-01   +3.547235437943574e-01   +6.110663547219658e-01   +8.300259011098786e-01   +5.988019530855657e-01   +4.267539401111763e-01];
L3E_L3I_iGABA_netcon = [+9.555949830256730e-01   +8.848502191804012e-01   +8.001168435071687e-01   +9.852050665855990e-01   +9.018921124768619e-01   +9.613869880789705e-01   +6.536971545226468e-01   +4.941168394911782e-02   +1.086537341990757e-01   +4.523220629103549e-01   +8.292027299465713e-01   +5.807536535499744e-01; +5.725648657800484e-01   +4.375681192630290e-01   +9.868030981092535e-01   +5.599470314350585e-01   +9.946647935714056e-01   +5.420982666516002e-01   +6.594256520542127e-02   +4.662551727402574e-01   +4.610627470494134e-01   +3.341946876226168e-01   +6.259044775586067e-01   +6.366803968535625e-01; +8.500747408031766e-01   +7.820206926379164e-01   +1.594933293918823e-01   +9.326749423827758e-01   +6.517193092406592e-01   +3.149238530488722e-02   +2.756692301425646e-01   +3.248448198966359e-01   +4.511889302454091e-01   +5.891695913312440e-02   +5.398104135931441e-01   +6.506195698143992e-01; +2.767038919556056e-01   +1.494268443331713e-01   +2.374545102248813e-01   +7.204412703700354e-01   +1.072047936223075e-01   +6.959584534904872e-01   +2.816447785049293e-01   +6.307037675206126e-01   +5.502059850404148e-01   +7.410640446179139e-01   +6.503182268442057e-01   +8.636238558065729e-01; +6.224390511074041e-01   +6.203895776016976e-01   +7.017748708364678e-01   +4.848851093004860e-01   +3.766489500718170e-02   +5.194270829783897e-01   +8.792079414977996e-01   +2.293955858927743e-01   +8.063775096022353e-01   +5.064096296542872e-01   +7.259684520922678e-01   +5.676305802566817e-02; +5.902941706750526e-01   +2.603707760724576e-01   +3.768434299117761e-01   +6.393671672785369e-01   +6.190524804838886e-01   +6.018766655424562e-02   +4.446970835946977e-01   +5.800026614813117e-01   +7.010903006027113e-01   +2.011164377657447e-01   +9.447056419385325e-02   +8.182411195966223e-01; +9.643898918723217e-01   +4.449374446277485e-01   +9.752120076528480e-01   +8.878180378014396e-01   +5.661638036478824e-01   +8.889370011970372e-01   +7.575730179655699e-01   +6.040673547528669e-01   +8.728969398737695e-01   +4.262028634676496e-01   +8.788215730098931e-01   +5.287742970682989e-01; +8.665188125883544e-02   +8.451674012856950e-01   +9.711469116332799e-01   +1.972618567743279e-01   +9.618674628935706e-01   +3.298560497560628e-01   +6.018003662296022e-01   +6.000512237581733e-01   +5.213048433816646e-02   +1.680997183174527e-01   +1.264696155229184e-02   +6.954962274252955e-01; +5.011019005266431e-01   +1.976311524224410e-01   +6.426431838105742e-01   +3.959992801501735e-01   +7.474912615413974e-01   +2.283229097750681e-01   +7.830842582344670e-01   +4.480221071220751e-01   +2.186637857815557e-01   +7.510579619827361e-01   +2.920035860931618e-01   +2.120611225553887e-01; +5.218771514086338e-01   +3.032512039410391e-01   +8.597119649335830e-01   +9.921712372323854e-01   +6.625230274904228e-01   +1.137534467237091e-01   +1.141774461496603e-01   +3.349027808229633e-02   +4.588856070139985e-01   +3.673074716177913e-01   +1.792412399703397e-01   +5.442081118942222e-01; +9.039847816360365e-02   +4.805102276476703e-01   +4.015417473655751e-01   +4.016245111937066e-01   +5.237828123633756e-01   +3.122293724814487e-01   +9.775306303538559e-01   +5.125596779330850e-01   +9.584530482336586e-01   +9.423294537486416e-01   +9.261944479842653e-01   +7.038384341545977e-01; +9.059999986589096e-01   +3.375640895158217e-01   +6.310891942912276e-01   +6.590179650022251e-01   +2.594288886229555e-01   +2.271071860034916e-01   +8.491403099910716e-01   +4.067405483305291e-01   +7.916926802538242e-01   +1.598415983679916e-02   +6.859269244162659e-02   +9.557335752363078e-01];
L2E_Input1_iAMPA_netcon = [+9.972126146707625e-01   +9.998372156092281e-01   +9.983794174100170e-01   +9.988786429291842e-01   +9.969787352138703e-01   +9.971920058439874e-01   +9.979289592046962e-01   +9.967755648519151e-01];
L2I_Input2_iAMPA_netcon = [+9.984349220078023e-01   +9.984199583966445e-01   +9.990428841095891e-01   +9.992874657740054e-01   +9.988168536432148e-01   +9.974327928597614e-01   +1.000000000000000e+00   +9.975637111818132e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
