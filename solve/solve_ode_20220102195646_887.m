function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.377802032142224e-01   -3.221659104928085e-01   +5.643555827021284e-01   +5.433238385250536e-01   +5.509523179865587e-02   +3.792235417201535e-01   -2.456253480751316e-01   +1.712618896295236e-01   +2.784931695467538e-01   +5.999483494201006e-01   +2.236882007102028e-01   +4.604347090244571e-01   -9.339011570862709e-03   -1.228707720962381e-01   -3.216589477459873e-01   +8.902419456322400e-03; +1.774434242063614e-01   +3.753724254179117e-02   -8.351521840150329e-02   +5.394062448654761e-01   -5.860544098966331e-02   +4.253942521780189e-01   -4.086128919911864e-01   +3.862651245703002e-01   +5.084932648939876e-01   +9.937822425530396e-02   +6.240625109673388e-01   +4.721051770136868e-01   +1.971786380056456e-01   +2.854392930787590e-02   -1.211025783867569e-01   +1.572163844230678e-02; +6.795908200158626e-01   +3.777410938317454e-01   +3.011873428031589e-02   +1.352123774609929e-01   +2.171560431141892e-01   +9.556428653861025e-02   +4.015923142572337e-01   +1.916126760838166e-01   +2.808245217887910e-01   +2.920988197406679e-01   +3.483053565888061e-01   +8.574580461337773e-02   +8.730875541535592e-02   -3.042767778831949e-01   +1.701224273877728e-01   +3.189542566468798e-03; +1.336868007004720e-01   -2.084476978916869e-01   +4.392431297242776e-02   +5.153902158455190e-01   -2.225255270036201e-01   -7.483193054260126e-03   +3.995754654989090e-01   +8.099669016428415e-01   +5.766160239202039e-01   +8.033948675633987e-02   +3.309637063826448e-01   +5.749930360697120e-01   +1.246050217158900e-01   +5.867678317039789e-01   -2.243775456218179e-02   +7.024681918780938e-01; +6.416513712523706e-01   +1.237082555471629e-01   +3.347653003543120e-01   +6.840561748435220e-01   +2.174679328106152e-01   +5.321358950953627e-01   +3.778962888104301e-03   +4.748138333074656e-01   -9.474081002115878e-02   +2.287683486395690e-01   +5.203401204569605e-01   -2.824211540049504e-01   +8.914196837901178e-02   +3.857685527679166e-01   +3.864912768633609e-01   +1.357832613374116e-01; +8.823144912120980e-02   +5.734694884328524e-01   -4.048913545188533e-02   +1.734384600118748e-01   +8.101108441003871e-01   +2.928851413392801e-01   +7.666689647397209e-01   +1.825005970338826e-01   +2.471189113999744e-01   +3.233108001014887e-01   +2.736384723946717e-01   -1.200468444952727e-01   +1.419462889471184e-01   +2.316672844369314e-01   -2.077862351581591e-02   -4.112747129947626e-02; +4.488774698038644e-01   +6.235962750410869e-01   +2.248339329706956e-01   +1.157877703434201e-01   -1.099397699592274e-01   +3.769630869708949e-01   +3.400093111280726e-01   +3.207807520875645e-01   +2.987361242784415e-01   +3.344205335485372e-01   -1.162813283550403e-01   +5.841703574480728e-01   +3.376057222045741e-01   +1.291990555872222e-01   +4.687493656350403e-01   +3.894619267835718e-01; +2.432956708194678e-01   +3.859255767605692e-01   -4.251750545874324e-03   +5.340476756344144e-01   +1.357639235359951e-01   +1.406362291215587e-01   +1.968629656950324e-01   +6.160097009669365e-01   +6.915638782568394e-01   +4.143443335576860e-01   +1.230053875949280e-01   +3.543589004297432e-01   -1.389335745869517e-02   +7.380910686509873e-02   +6.200620487528851e-04   +3.391889359179394e-01; -4.239441345267381e-02   +5.423622320714018e-01   -2.901388704755046e-01   +2.235676848200143e-01   +2.935484247386677e-01   +4.140001485824460e-01   +1.791260612852004e-01   -1.940205400000795e-01   +4.185919494006576e-01   +1.870551064800574e-01   +6.217369285454537e-01   -6.078749438980115e-02   +3.994186203431355e-01   +4.257494444153822e-01   +2.413412876846089e-01   +3.585575180929652e-02; +2.104972647271013e-01   +3.409664768865608e-01   +3.460278206507446e-01   +3.672862741873891e-01   +3.538758826147061e-01   +9.911996968249748e-02   +4.282011502168028e-01   -1.667810149460252e-03   +6.531307099623494e-02   -8.232426779708407e-02   +8.966225184380294e-02   +8.602075636208691e-02   +7.713327150691001e-01   -2.305154044164189e-01   +2.200683924866129e-01   +4.845420408598205e-01; -2.521747821966926e-02   +5.907623852445247e-01   +3.361005412977678e-02   +1.682952299823679e-01   +4.972298768968534e-01   +4.138029816079776e-01   +6.611563669120676e-01   +3.349318897538530e-02   -1.324702534643867e-02   +4.574992086923715e-01   -1.134048444304192e-01   +5.408378587832358e-01   -3.643704196748428e-01   +3.837787150364673e-01   +5.807635978019787e-01   +2.295863698591983e-01; +5.868694297437990e-01   +8.202158768385083e-02   +9.132791027419822e-02   -1.246933776552905e-01   +3.541180952385613e-01   +4.683693893600389e-01   +7.876209893027258e-02   +3.359888903058487e-01   +5.433320428140920e-01   -1.096893167087963e-01   +1.493214655125996e-01   +4.063196505317797e-01   +4.850448311314837e-01   +4.103285757526527e-01   -1.029327488957450e-01   +2.963512066697856e-01; -5.440068691320532e-02   +4.091910793206388e-01   +7.068883631918644e-01   +2.458171001382374e-01   +5.399030235627720e-01   +4.567678649050786e-01   +2.296961196374604e-01   +7.376684899058162e-01   +6.838576648207368e-01   +2.085804108118307e-01   +1.387604221404475e-01   +2.375569131018415e-01   -2.890535241047976e-01   +2.955201931641117e-01   +2.401592239860023e-01   -5.751979505269554e-02; -1.764148150210360e-02   +3.015258998947714e-01   +3.619438130888826e-01   -4.744655163077741e-01   +4.611660971510666e-02   +7.856682775162251e-01   +3.774799661894154e-02   +2.822153124406400e-01   -4.447092201327329e-02   +2.362365495831730e-02   +6.197805501033248e-01   +2.752870674326494e-01   +3.654098708055870e-01   +5.792849371682541e-01   +1.777722742913306e-01   +2.454039890677686e-01; +1.659796923069365e-01   +5.969596204106032e-02   +3.508468221525136e-01   +6.700224578754999e-01   -2.845223301691878e-01   -8.567276602343224e-02   +6.754991902363016e-01   -1.353357853853105e-01   -2.491600755597551e-01   +2.474829774635429e-01   +9.553558815260105e-02   +2.031318718867355e-01   +1.281907609507702e-01   +1.505159714842182e-01   +2.421218245423894e-01   -2.692793149680152e-01; -2.961512496989567e-01   +4.164270864809569e-01   -5.977299798230468e-02   +4.263535866676597e-01   +1.000000000000000e+00   +6.715791124623584e-01   -6.601475154882570e-02   +7.319838732642062e-01   -1.475635577138377e-01   +5.232578472506636e-01   +6.202735835994758e-01   +3.835279406452313e-01   +1.347340745843476e-01   +4.182536089010184e-01   +6.259610455237882e-01   +2.555790889274238e-01];
L1E_L1I_iGABA_netcon = [+2.346786184486228e-01   +4.168811201516184e-01   +2.609320951964226e-01   -9.023120291053463e-02   +3.688809011511618e-01   -2.943877173976042e-01   +6.703803756578897e-02   +5.882148532578865e-02   -3.469956280261347e-02   -1.202022519945464e-02   +3.741211316987135e-01   +4.284509083910144e-01   +7.308817370896425e-01   -3.022691795973139e-01   -8.574574193236773e-02   +8.899470454624356e-01; -1.955988619266693e-01   +3.595598667456117e-02   +4.017212754379222e-01   -2.360322678631480e-01   +1.336664338880855e-01   -2.477804260316261e-01   +6.268813407422611e-01   +2.277192663327045e-01   +4.114464296898088e-01   +2.240535125237653e-01   +5.626603181593490e-01   +2.819542203010710e-01   +6.053942742479526e-01   -1.959071457217847e-02   -2.589288972456653e-02   -2.554463052510818e-02; +3.020418011480118e-01   +3.481312858163587e-02   +1.764364559295780e-01   +5.546139489050063e-01   +4.458712142279522e-01   -1.057213999259567e-01   +3.449241204468567e-01   +2.204488456395828e-01   +2.119697607582699e-02   +1.000000000000000e+00   -2.853227253141181e-02   +2.215561827699843e-01   -1.029132844111254e-02   -1.905963213922770e-02   +4.453519707577260e-01   +5.350800131256688e-01; +5.572987283753797e-01   +1.538937704726611e-02   -2.549050282101750e-02   +1.204323673627465e-01   -1.292518479492695e-02   +2.017119096607258e-01   -6.887513612604929e-02   -2.296250192273408e-01   +2.693949230884012e-01   +9.516585507058564e-02   +1.348494978317009e-01   +4.006525029454325e-01   +2.774529553529193e-01   +2.025689864056736e-01   +8.998562488549344e-02   -6.493686540914699e-02; +2.605635303506052e-01   -9.198138548274885e-02   -6.697365900204981e-02   +2.400650053351713e-01   +6.155237029197415e-01   -2.185917161425287e-01   +3.064238705973814e-01   -1.250552819865604e-01   +2.407296760003161e-01   +2.198147437520178e-01   -2.516170372243506e-01   +5.840471920889823e-01   +8.442476637243458e-02   +3.425687838847698e-02   -9.015229703493555e-02   +4.379516356633150e-01; -2.128515777777869e-02   +2.574384307772618e-01   +2.545338514012162e-01   +3.063017446620171e-02   +2.899586357181100e-03   +3.570654592303728e-01   +1.929345678837409e-01   -6.684779738872744e-02   -8.412390433392383e-02   +3.231065496585707e-01   -1.591811766890007e-02   +3.721524261898914e-01   -2.571778554125198e-02   -2.028015278481013e-01   +3.746722798410063e-01   +3.584874966628070e-01; -8.500639333846506e-02   +2.682320954078834e-01   -4.008913918389276e-02   -1.231337707071840e-01   +2.508191232519786e-01   +2.113642556152555e-01   -1.120844764199201e-02   -2.368233158270396e-01   +2.142069516022421e-01   +2.037504949452793e-01   +5.710937260674213e-01   +2.572691884686020e-01   +2.652607989199656e-01   -9.842459778165182e-02   +8.887958051475755e-01   -2.109688717405844e-01; +1.459574853087460e-01   +3.605058541761967e-01   +3.758983334981817e-02   +2.784440971831333e-01   +8.900186726462801e-03   -2.391933578346465e-01   +7.011777872258794e-01   -2.552361005401490e-01   +5.951923455298861e-01   -6.851512422740574e-02   +2.782598579561167e-01   -8.990398227132466e-02   +3.250776592552405e-01   +2.736441447500366e-01   +1.854016799297294e-01   +2.438766991611969e-01; +3.623625498466048e-01   +7.152697579835812e-01   +5.020705017416651e-01   -1.939198832074483e-01   +4.145713151843800e-02   +7.473699880653444e-02   +3.403761047672457e-01   -1.479652950958540e-01   +2.349713980415577e-01   -1.165498724556616e-01   +1.694487053922597e-01   -3.338182907196205e-02   +1.347366038436674e-01   -9.760683343493172e-02   +6.818510398437592e-01   +1.607141230071108e-01; +8.041307686657639e-02   +5.723549199380714e-01   -2.606259223642096e-02   +3.730343107528982e-01   -1.697635427220117e-01   +3.769768030432702e-01   +9.194423788188205e-02   +2.169662969898350e-01   +4.611147806747811e-01   +6.609807605599161e-02   -3.524444303803925e-01   +2.762311607915102e-02   +3.165117211820262e-01   +4.978550750429226e-01   +1.982300349586351e-01   +1.277872582128458e-01; +2.337518510604063e-01   +3.282746460771009e-01   +6.836026258562993e-01   +2.456434186109643e-01   +2.941260410675560e-01   +1.249159819387353e-01   +5.653272500288186e-02   -1.260222155531718e-01   +3.773227707410783e-01   +4.362988516027798e-02   +2.367870742165434e-01   +6.827726416752302e-01   +6.671900989420618e-01   -4.293386495823880e-02   +5.095525424891974e-02   -3.663856440628256e-03; +3.921164478699924e-01   +2.000847398095855e-01   +1.676522898017169e-01   -2.777003053181230e-01   +2.235601775323970e-01   +4.166803715964491e-01   -2.396257941128997e-02   +2.365233897371861e-01   -2.432873520544724e-01   +1.324146052936553e-01   +4.522502166707916e-01   +5.296332540593003e-01   +3.090125792094443e-02   +7.693818142939899e-03   +2.113977540668257e-01   +1.190376048415455e-01; +2.166574287674669e-01   +3.115853937484234e-01   +7.402793764376307e-02   +9.749363178482549e-01   -6.099302770305094e-02   +1.442666262215534e-01   -3.477279067428923e-02   +3.085514134764038e-01   +2.657102077027512e-01   -2.327062689524465e-01   +3.665357292275685e-01   +2.788608804997715e-01   +2.948755415343850e-01   +2.619888240515237e-01   +5.748398272714901e-01   +1.817706665374459e-01; +3.161047585152438e-01   +1.497800278174779e-01   +1.815408165937218e-01   +2.345302123687003e-01   +1.702630188501872e-01   -6.417839816305396e-02   +1.626944350835254e-01   +1.401178302643685e-01   +1.921695491892774e-01   +4.754626128560984e-02   +3.070087062143111e-01   -2.420514732264436e-01   +1.713064488840143e-01   -2.149882110322230e-02   +3.918652665946043e-01   -2.473218192605532e-01; +3.900866047344592e-01   +5.776091023135164e-02   +8.974901324611689e-02   -1.882160137926839e-01   +1.350661822464567e-01   +2.226874730619195e-01   +8.199067062901540e-02   -2.780779714569799e-02   +4.585975805813379e-01   +2.217905388589141e-01   +3.287619535937283e-01   +3.284769964740649e-01   +1.312359776242395e-01   -7.748904996491950e-02   +4.364104198853445e-01   +2.682069925405707e-01; -1.168658697185655e-01   +3.292390667551300e-01   +3.186395815953597e-01   -1.415578866841463e-01   +2.580409398837191e-01   +3.301334412224926e-01   +4.646165529910793e-02   +2.818021586529803e-01   -1.493009909330364e-01   +2.381076105973392e-01   +3.158451136825202e-01   +2.651452564456372e-01   +2.562692581077755e-01   +4.197417925324342e-01   +1.991032578265372e-02   +3.440830171060345e-01];
L2I_L1I_iGABA_netcon = [+3.219023979489781e-01   -1.920981731768134e-01   +1.421454410897526e-01   +5.636938312790816e-01   -1.278192685503306e-01   -2.197726708537174e-01   +4.813024550029712e-02   -3.131658419086478e-02; +4.259124453104152e-01   +7.015338506209299e-01   +4.571233894230034e-02   +2.979902713929415e-01   +1.701480509319298e-01   +2.698660308196306e-01   +3.827792440018738e-01   -2.106857888865178e-01; +4.499786133304912e-01   +2.697328915613973e-01   +2.996235228928310e-01   +5.085295740341358e-02   +3.812759845011907e-01   +1.537123379319063e-01   +1.809977646231358e-01   -4.698658628055890e-01; +6.563372857258256e-01   +2.608611997389003e-01   +4.343373959301069e-01   +1.302005247075640e-01   +8.586606041520504e-01   +4.521835072693036e-01   +6.071068649515307e-01   +3.581742526339117e-01; +2.906639669641295e-01   +2.328242923111289e-01   +2.198396239432340e-01   +2.950465093440861e-01   +2.550158925922694e-01   +2.620366561216038e-01   +1.636065792304239e-01   -6.413392820205287e-02; -7.373159910096018e-02   +1.881900584836408e-02   +2.790476746265845e-01   +4.829783601751625e-01   +5.168155661854046e-02   +5.059888401472890e-01   -1.175731661400648e-01   +6.169961382771182e-01; +4.665852725262145e-01   +1.950320024442315e-01   +2.209336365550991e-01   -1.272703681638292e-01   +4.266147534110774e-01   +2.247288801463308e-01   +4.981997476978057e-01   +1.883334791712985e-01; +1.424581961722498e-01   +3.553955336381531e-01   +4.949378370017771e-01   +1.891363166397064e-01   +3.214656319381033e-01   +3.574603364761688e-01   +5.781304519830507e-02   +2.719180871016123e-01; +4.223101324261180e-01   +9.602633003877561e-01   -2.941758065587253e-01   +3.885656123767035e-01   -1.797745717142954e-01   +1.799188734243119e-01   +4.575949452158403e-03   +5.767628451512606e-01; +1.006202561606087e-01   -2.870441703351498e-01   +2.825262862865005e-01   +3.576384827167594e-01   +4.950604633758298e-01   -1.739360843124576e-01   -9.372118044522849e-02   +4.246791275805539e-01; +7.588347527021137e-02   +1.170552587792659e-01   +5.458774712031522e-01   +1.561870752339892e-01   -1.290844410057769e-01   -9.355846769479238e-02   +2.419786523385370e-01   +2.529837504756663e-01; +1.203887074496222e-01   +5.658018752899642e-01   +5.012374698245521e-01   +2.682986053276644e-01   +1.921936882628471e-01   +3.895724683876596e-02   +2.748906806374046e-01   +5.233819196888516e-01; +3.034494546128101e-01   +6.025687585817732e-01   +5.970088853388889e-01   -2.567941603978924e-01   +1.422123242023095e-02   +9.509865370508123e-02   -2.362137665634422e-01   +3.595814368219606e-01; +2.494225539767478e-01   +4.453400256494357e-02   +1.858938459524979e-01   -8.515256787491705e-02   +5.878422087689931e-01   +1.233735683920124e-01   +1.297399209325442e-01   -9.138768385462352e-02; +2.726374539106107e-01   +3.815032048123427e-01   +3.375958328065016e-01   +4.368040431962655e-01   +1.618263702132384e-01   +1.000000000000000e+00   +1.889197588306931e-01   +4.331817278707107e-01; -1.264025324491574e-01   -7.575842366989814e-02   +2.675140829734214e-01   +1.925156015309468e-01   +4.316172598594775e-01   +8.046370899793626e-02   +1.712742317563827e-01   +2.216462361309203e-01];
L1I_L2I_iGABA_netcon = [+3.968610564038199e-01   +1.796038278049860e-01   -3.744197254470163e-02   +5.606591682337458e-01   -1.170810435335110e-01   +1.699631251028204e-02   +3.532782165206524e-02   +4.342952331343440e-01   -4.178699442806990e-01   +6.417848748541018e-01   -1.630501019322419e-01   +5.708614724889977e-02   +5.160119492398008e-01   +4.080108260793029e-01   +3.967308849778697e-01   +3.666933272165545e-01; +4.552476816626013e-01   +2.179663168478608e-01   -3.521310361487504e-01   +3.965408223201144e-02   -1.116152690433276e-01   +1.340155364578100e-01   +5.771518975462239e-01   +3.497791028606089e-01   +5.696748682690329e-01   +7.640819766753087e-01   +3.156048826335944e-01   -3.378506924305206e-01   -8.207793719640130e-02   -5.065375371804821e-01   +2.869845422890675e-01   +5.786666753232860e-01; -7.870046514582565e-02   +5.753085068510646e-02   +5.118241394231506e-01   +2.085866034173489e-01   +9.196747942939707e-03   -7.497320078707048e-02   +6.104953883570327e-01   +4.666651975194751e-01   -4.162108193303155e-01   +4.993893410490617e-01   -4.243814790253553e-01   +4.101831800503141e-01   +6.430887163954402e-01   +4.501858461146577e-01   +6.633311036233114e-01   -7.915469166241891e-02; +6.741891879915946e-01   +3.109869033957559e-01   +2.182398802774485e-01   +1.219087339132972e-01   +7.816521161009887e-01   +2.001662951867475e-01   +7.859214161940133e-01   +6.636170495424648e-01   -3.737526086274894e-01   +6.762393569927985e-01   +6.858314577239383e-01   +4.860222770201181e-01   +4.224611656973057e-01   +1.958489329632388e-01   +1.646430040778199e-01   +2.506796648390763e-01; +1.403130844672141e-01   -1.416292281358247e-02   +2.974286767196890e-02   +1.811064590121061e-01   -5.369516291891368e-02   +8.887603307468944e-01   +6.862606741221314e-01   +2.585368404916694e-01   +5.369355079402098e-01   +4.907522797785621e-01   -2.338671660250562e-01   +4.624130043518627e-01   -3.242019457550540e-01   +4.127471154121449e-01   +8.289551039385057e-02   +8.019852552451302e-01; -3.591408013464571e-02   +3.951812640071652e-01   +3.403742932516678e-02   +5.907422237848063e-01   -2.835586681412754e-01   +3.905344574050398e-01   +3.208676055018326e-01   +2.801377070367163e-01   +1.166106882948749e-01   -3.705660517368521e-01   +4.190200251654317e-01   -3.349181406532570e-01   +7.261716089785304e-01   +8.592662665496488e-01   +5.156989250428951e-01   +4.047995741316817e-01; +3.958543988489263e-01   +6.201368930278405e-01   +2.299730163101635e-02   +3.455003006898331e-01   +2.118761933768476e-01   -2.188825987360703e-01   +4.545585866032318e-01   -1.626603621229081e-01   -1.543877174460146e-01   +5.239143691731947e-01   +6.150905835905336e-01   +2.770191635398225e-01   +1.621960053905157e-01   -1.677482233238328e-01   +3.211959541969101e-01   +6.968382786115680e-01; +4.258439008588232e-01   +1.193936341385083e-01   +2.053115569435434e-01   +2.578243502141629e-01   +8.719446791027397e-02   +6.618460566342130e-01   +4.890475290795209e-01   +2.368903010392807e-01   -9.725636090026327e-02   +2.358544839227348e-01   +9.639239376793645e-01   +4.636076750333747e-01   +3.366656030619949e-01   +2.867104709531942e-02   +2.591238472649623e-01   +2.914216292943574e-01];
L2E_L1E_iAMPA_netcon = [+5.424348095449913e-01   +2.184045669937119e-02   +9.760652667404840e-02   +3.844090054078231e-01   +9.726430136665607e-01   +3.569857672406135e-01   +3.271198257759083e-01   +1.396871109209478e-01; -2.693251225428699e-01   +4.617025676167102e-01   -2.152537485604281e-01   +5.707167624907517e-02   +4.627444178076145e-01   +1.391087930759936e-01   +5.180014285558816e-01   +4.670273870097211e-01; -4.999478984560540e-02   +5.614337673016342e-01   +5.969043467023551e-01   +2.751981481621022e-01   +2.505539391573024e-02   -5.418230566411047e-02   +5.542758500742554e-01   +2.835140996109959e-01; +4.530023554076835e-01   +3.196106249137574e-01   -2.263135089443571e-01   +5.680941462244516e-01   +4.350650836083034e-01   +2.179452483917441e-01   +4.003124022207130e-01   -3.529170460840921e-01; -2.403909745043457e-01   +6.416622534303495e-01   +4.829176546305876e-01   -1.367768540472694e-01   +2.554210901761452e-01   +1.052623704742487e-01   +5.553556467214747e-01   +6.225891227930840e-01; +4.583984519441518e-01   -1.444180345007643e-01   +3.749072089182500e-01   -1.942593759664233e-01   +6.400072050234601e-01   +7.992783517139002e-01   +2.818058421628411e-01   +1.847725502970807e-01; +1.360304159738779e-01   +4.221484080264578e-01   +3.139905130122229e-01   +1.550885472317937e-01   -3.797827552290521e-01   +5.297288307778260e-01   +9.758345475316439e-01   -1.503269579271770e-01; -7.454419259186981e-02   +4.078546927291335e-01   +6.936838124807859e-01   -4.296325106851480e-02   +2.945351427270951e-01   +6.286758941801292e-02   +2.933581864625775e-01   +4.045475145991900e-01; +5.551121335089341e-01   +1.926218483330057e-01   +4.499627207844366e-01   +8.048783652754276e-01   +5.899579131553759e-02   +4.155160783190151e-01   +2.390171652284837e-01   +4.018950246120576e-03; +1.156571335444970e-01   +1.635440810634264e-01   +2.092072963720643e-01   +5.950701517340953e-01   +1.733256500725385e-01   +1.439878020873832e-02   -4.650475748614052e-02   +4.036966385757835e-01; -2.395644075705804e-01   +4.365845339203226e-01   +4.370142355406598e-01   -2.496207843000742e-02   +6.207524627758526e-02   -1.916612291655254e-02   +2.690731108014960e-01   +1.417538547570223e-01; +3.679572744068280e-01   +5.118636220578459e-01   +8.174501028637728e-01   +8.395094494997472e-02   +6.845384496481655e-02   +3.031990784492257e-01   -3.611316590203128e-01   +1.475197255730380e-01; -1.430932978590087e-01   +5.018776536600733e-01   +3.243031466815642e-01   +1.325980815850944e-02   +8.010658885986133e-02   +8.722404723152713e-02   +3.201857169866458e-01   -3.533944004359428e-02; +9.101453092264941e-02   +4.221178351100330e-01   -2.886665715155363e-01   -3.050444157742319e-04   +3.918610018383728e-01   +1.429385357337103e-01   +1.256412423863265e-02   +2.983699260295252e-01; -3.548464397284781e-02   +1.235786860811529e-03   +3.093752293687950e-01   +5.882761778016232e-01   +1.141184146972131e-01   +1.956019750464329e-01   -1.463201653256967e-02   -5.272680625138877e-02; +2.470547957260906e-01   +2.209937199244130e-01   +1.476202717021325e-01   -1.204501743614466e-02   +4.452972611864054e-01   +2.216138382617864e-01   +4.524466474058563e-01   +5.521643047373690e-01];
L1E_L2E_iAMPA_netcon = [+1.381836325442244e-01   +2.983580829539445e-01   +1.235578875893303e-01   +1.897349204449861e-01   +2.328558506459520e-01   +4.408702939144413e-01   +2.249054896570986e-01   +2.612371513163076e-01   +3.238434257201845e-01   +2.413691448279758e-01   +4.356321884458841e-01   +4.020679738310249e-01   +4.961994129656529e-01   -1.841143998980732e-01   -2.775105461820561e-01   -7.811961092391753e-02; +2.764091563037583e-01   -2.952159346746703e-01   +7.798673300135450e-01   +2.898956836184980e-01   +2.805046085271048e-01   +1.104014761035017e-01   +4.100874187348374e-01   +3.248108733570649e-01   +7.287202550120543e-02   +4.721470588592369e-01   +4.159263083948270e-01   +2.242754549570330e-01   +4.243144158349975e-01   +2.366852768409599e-01   +3.742934986995023e-01   +6.569408876325197e-02; +5.487787196403909e-01   +6.898489061259981e-02   +2.869530167249832e-01   +2.732975637383595e-01   +2.531421141715961e-01   +5.218659963724104e-01   +2.051153338304955e-01   +3.415358862580175e-01   +1.433830002409682e-01   +2.114303268694855e-02   +3.228863807862520e-01   +5.593652470763436e-01   -2.691916579019502e-02   +5.196080260801810e-01   -4.498923849906840e-02   -3.930310655287557e-01; +2.268110181292845e-01   -6.593978380444759e-03   +3.322055753613442e-01   -1.660328850978899e-02   +2.606207513959641e-01   +5.088139659619192e-01   +9.606876933976330e-01   -1.183988877877947e-01   +6.727280307301958e-02   +1.378006749574447e-01   +4.630890785308324e-01   -2.278876470790762e-01   +1.197191440638687e-01   +6.479610106684881e-01   +3.694355801120382e-01   +1.791227798888129e-03; -1.456049595226947e-02   -3.450808223753033e-01   +4.455860900888188e-01   +1.111665811790626e-01   +6.578762148719854e-01   +1.198361342721431e-02   +4.623397181774880e-01   +2.259997349427001e-01   +2.054206121380269e-01   +1.915950027990269e-01   -8.381856165695045e-02   -3.271975124969917e-01   +4.060069656549441e-01   -7.502751838533776e-02   +8.119025396672969e-01   +1.174766124447555e-01; -2.167743998796993e-02   +6.435990064654780e-01   +3.420358126284648e-01   +5.343948249321597e-01   +4.323417893564095e-01   +1.482073637593817e-02   +5.378386734100659e-01   +3.404631506425173e-01   +6.608229325292407e-01   +1.246430488961377e-01   +4.642793906566136e-01   -9.747301042566013e-02   -1.236616144185806e-01   -2.558252763076652e-01   -3.911324781927618e-01   +4.706883157178930e-01; +4.883711636515542e-02   +7.731541755243632e-02   -2.463645559994921e-02   +6.459436077421733e-01   +1.914820592326778e-01   +1.718987115572748e-01   +7.343246989725061e-01   +4.505828895039324e-02   -9.671237250079529e-02   +1.348769240948073e-01   -2.748042003535012e-02   -2.766270085630458e-02   -1.672930541618015e-01   -4.407088542897932e-02   +5.950949512712870e-01   +2.480706946473550e-01; +2.540726683631461e-01   +2.307749111494342e-01   +1.213010885357978e-01   +5.310617063190234e-01   +3.529733047146172e-01   +8.171220439603792e-01   +4.903713309019146e-01   +4.153813912081949e-01   +3.694796724493634e-01   +2.718764448657722e-01   +1.039686870814640e-01   +2.972688389340909e-01   -2.408557804789929e-01   -2.528364243860896e-01   +4.912429270201082e-01   -2.026230625875738e-01];
L2I_L2E_iAMPA_netcon = [+3.189078150168502e-01   +5.712701260506783e-01   +6.390749686140669e-01   -1.464199344991146e-02   +7.899568344912911e-02   +7.154900621280498e-01   +2.125565113567994e-01   +5.269083783479078e-01; +3.803800646097147e-01   +3.693663117148760e-01   +7.889959106241708e-01   +5.722888022552312e-01   +4.401276620465056e-01   +5.225024136356544e-02   -9.360895765307196e-02   -3.315076738466764e-02; +8.988035376546948e-02   +3.829475547605375e-01   +1.425605957699640e-01   -8.289785352682458e-02   -3.614747273453350e-01   +6.776840967456099e-02   +4.991437493013254e-01   +8.194235325075340e-02; +5.809934627018263e-02   +1.819710527135026e-01   -3.688673386136530e-02   +5.396123527458992e-01   +2.524516134149475e-01   -1.712969463815830e-01   +2.092360307683665e-01   +6.255631683471215e-02; +4.825696545305233e-01   +6.296194724642991e-02   -2.682801507097614e-03   +4.630376032811332e-01   +1.615887890976001e-01   +2.022532525573581e-01   +6.767595850146048e-01   +1.725542354545938e-01; +3.402926034727741e-01   +3.054590622383734e-01   +1.286702240180851e-01   +3.873233134454412e-01   -1.307562210314363e-01   +2.860400366499116e-01   +1.123502953758184e-01   +1.977329654399406e-02; +5.331960950751964e-01   +1.105972245648662e-01   +2.309407508702619e-01   +6.013907531944762e-01   +3.134489142634958e-01   -1.436559198478325e-01   +9.805105039842424e-01   +1.786205833579378e-01; +3.746792346154203e-01   -3.610921114720199e-02   -2.141328667109939e-01   +2.429465933719632e-01   -2.243178837353094e-02   +6.910382122803987e-02   -9.244446321540814e-02   +4.178174892698819e-01];
L2E_L2I_iGABA_netcon = [-1.230374791482190e-01   +2.253110808387330e-01   +5.295813213257108e-01   -1.579367095047908e-01   -1.646028570927637e-01   +1.724308096973687e-01   -1.110991278710786e-01   +4.225690867154608e-01; +8.736749377332034e-02   +2.939972702721175e-01   +1.548612863577618e-01   +4.004739632229019e-01   +6.215569641018328e-01   +1.958398933054959e-01   -6.184366215628284e-01   +2.298668249754834e-01; +3.124648520980887e-02   +7.584609963673360e-01   -1.785295846417159e-01   -1.829100884417600e-01   +2.644862404754141e-01   +4.965986642972151e-01   +2.001588676847088e-01   +7.983100182556253e-01; -1.106573214035317e-01   +3.647381047989450e-01   -1.006903991597057e-01   +7.116512378183156e-01   +6.574920008205198e-01   -1.018392215114942e-01   -3.251596451362880e-01   -1.619266172300833e-01; +7.249007475772586e-02   -2.070736076365234e-01   -8.731758471829701e-02   +2.195802138960108e-01   +8.208355438195956e-01   +3.123584325891851e-01   +1.268505380710458e-01   +1.445277252097663e-01; +4.914042941692492e-01   +3.067873228965644e-01   +1.811037255363473e-01   +3.974848163929359e-01   +2.721327157255977e-01   -2.749978954658461e-01   +2.680709816052442e-01   -1.804536458393303e-01; +1.224725637858836e-01   +5.028434308723406e-01   -2.178628809138320e-01   -6.634724078233539e-03   -2.171267963387571e-02   +7.575524200843544e-03   +9.533900400547954e-02   +6.740865825558676e-01; -1.803120319696927e-04   +4.382759426700918e-01   +6.087404815221340e-01   -1.393570020674931e-01   +4.585819371902902e-01   +2.337465540907230e-01   +3.185575037482833e-01   +6.586625833235259e-01];
L3E_L2E_iAMPA_netcon = [+4.760510329925480e-01   -4.027089755602500e-01   +1.665008022643440e-01   +2.853608858482853e-01   +5.875015567838487e-01   +2.326714969894063e-01   +2.193480419372869e-01   +6.169353467248864e-01   +3.993301426568796e-02   -6.933783155600215e-02   +2.187555031474431e-01   +7.895667066656564e-03; +4.351073730667539e-01   +8.621598971875456e-01   +7.730091784478746e-02   +4.653704706438763e-01   -4.734688809370564e-02   -5.200520667696498e-01   +9.981045813326958e-02   +1.790455261110802e-01   -2.598453282219289e-01   +6.510323347041375e-02   -3.774204758490507e-02   +4.207054144310833e-01; -3.259091762308194e-01   -1.832226469034729e-01   +1.548323067414080e-01   +2.579970218191540e-01   +9.341514156499572e-01   +5.227783363595021e-01   +4.284450366817899e-01   +2.759595212929328e-01   +6.958253423417224e-01   -1.780783244116893e-01   +3.731108853063146e-01   +6.030305633893445e-01; +2.709138583908849e-01   +2.162271063513131e-01   +2.269012540151685e-01   +1.763203972704175e-01   +5.734201939486793e-01   +2.149665012043613e-01   +2.535927398932033e-01   +1.752729596188983e-01   +6.387300856205010e-02   +4.366958989520178e-01   +2.239221445342789e-02   +2.910315802607955e-01; +3.495715580965419e-01   +8.070200288781974e-02   +1.370373565999318e-01   +2.456434573777607e-01   +7.925697327724749e-01   +1.290093688004749e-01   -2.046893019442243e-02   -7.221319440096172e-02   +3.665364153831829e-01   +6.397020415208696e-01   +7.712767398115252e-01   +8.065907962486568e-01; +5.893269034772605e-01   +6.460275893673206e-01   +2.287246108677551e-01   -2.007254033187753e-01   +1.775389866458897e-01   +4.880721825587127e-01   +1.236780858808251e-01   -2.024578723579046e-01   +1.656977843927653e-01   +5.302381269538706e-01   -1.818509107192338e-01   +2.591136215478675e-01; +3.147387938658494e-01   +1.483381150704305e-01   +7.732278086487913e-01   +3.754241773216985e-02   +2.646831621139245e-01   +4.184993261821816e-01   +4.237305454522240e-02   +1.720064381700549e-01   +5.041168493244048e-01   +5.065987749349987e-01   +6.198767402410362e-02   +2.576385752318110e-01; -1.283779038228939e-01   +8.777711259368148e-01   +5.003807571636356e-01   -3.587951602838189e-01   +8.551316534667022e-01   -4.415442437676581e-03   -6.069805483675421e-02   +1.101162819300541e-01   +4.899421509847339e-01   +5.042842717403540e-01   +1.210112712397795e-01   -6.899111030290173e-02];
L3I_L2I_iGABA_netcon = [+6.041527689250913e-01   +6.059198910320557e-01   +1.899791433512211e-01   +2.337573685981637e-01   -1.445606208081678e-01   +2.170777803310933e-01   +7.239698379921506e-01   +5.954967034955485e-01   +7.890079270332458e-01   +2.333768733768465e-01   +1.674968108452111e-01   +3.901498815640689e-01; +3.133619631443019e-01   +1.210939085650916e-01   +7.439939283956082e-02   +3.346808339317768e-02   +4.952974410630275e-01   +4.409973127898792e-01   +5.796759949492709e-01   -1.165559944040468e-01   +2.856736271281218e-01   +1.494631246298693e-01   +3.434486123414602e-01   -1.409568499232983e-01; +6.757197338914442e-02   +3.797941802567916e-01   +2.803507684143154e-01   -2.403017729132523e-01   -2.055064959359025e-01   +1.869086291295787e-01   +4.559614129016705e-01   +3.394229405474088e-01   +3.047710027637938e-01   +8.801556312717158e-02   -1.593712183061264e-01   +7.829761819077032e-01; +3.588656183378077e-01   +2.999775622951587e-01   +5.113674640567897e-01   -4.938687763089227e-02   +1.212697316452511e-02   +6.560627786706678e-02   +3.052704962290400e-01   -1.196985840033234e-01   +4.726215831915744e-01   +2.341813739326987e-01   +7.038215501777735e-01   +2.221983217703290e-01; +4.037768935921848e-01   +2.810006926853212e-01   +1.294521696697054e-01   +2.775540740283239e-01   +4.740450445265614e-01   +5.110521745264694e-01   -5.802438627434725e-02   +9.620164314505473e-01   +6.982151334998908e-01   -2.391879652370608e-02   +2.659130945140609e-01   +3.879268125583321e-01; -1.045836274768467e-01   +3.229538241724471e-01   +2.145979075397550e-01   +2.803747759783931e-01   +6.894752605285211e-01   +3.197434889209188e-01   +2.530944357652203e-01   -9.633470448909705e-02   +1.544396205871392e-01   +2.953027790381731e-01   +1.189345763514486e-01   +4.865053044334995e-01; +5.242632751944518e-01   -1.496864966197960e-02   +2.610372466498717e-01   +2.280449804412674e-01   +1.481284636538168e-01   +4.449664267730659e-01   +4.497717640193635e-01   -4.891711221366785e-02   -3.206670387144415e-01   +6.209120688388634e-01   +4.373889745993879e-01   +2.753430423464680e-02; -1.724003665353987e-01   +3.051829467669150e-01   +3.951305384214343e-01   +5.664232790145555e-01   -1.227613470372294e-01   +5.277164426624465e-01   +6.215706133989539e-01   +3.927100132303581e-01   +4.315986573591361e-01   +2.952073624281675e-01   +4.802129846508906e-01   +4.945289332608090e-01];
L2E_L3E_iAMPA_netcon = [+4.860282541791859e-01   +3.100558799553161e-01   +3.929996518832844e-01   -3.216145683786372e-01   +1.179413914044537e-01   +1.643516843310547e-01   +4.228437588974000e-01   +2.232096816214982e-01; -6.703322415897578e-04   +1.013458243631693e-01   +3.439152000790565e-01   +4.118051295683280e-01   +5.100427097950483e-01   -2.866148611441178e-01   -7.996248658389467e-02   -4.145401437286889e-01; +3.635051319558413e-01   -6.415750570879104e-02   +2.234131755077273e-01   +5.641721001860029e-01   +3.631023794188253e-02   -6.992867743117379e-02   +2.430323985053312e-01   +1.262643208984078e-01; +1.318674025373859e-01   +2.547229167769033e-01   +7.029939084641003e-01   +9.071993170098819e-01   +4.504172589090156e-01   +5.432400860401660e-01   +1.015396264034568e-01   -8.447312207235530e-02; +2.501054033499438e-01   +1.241103380565164e-01   +8.856758610629650e-02   +8.066110619320408e-01   +4.818949537498121e-01   -3.563920504662413e-02   -8.933686780359040e-02   +1.343280594946377e-01; +3.604286946023189e-01   +8.724593430719564e-01   +6.282389430694473e-01   +5.514000603925117e-01   +5.384614766751067e-01   +1.295271121338353e-01   +4.987689054749649e-01   +5.840642346898883e-02; +1.719410272426892e-01   +2.893881307975039e-01   +4.455454149225807e-01   -1.734619717189120e-01   -1.039057691846317e-01   +1.258204429632280e-01   -7.241770984068426e-03   +4.442132460742512e-01; +4.405138344627487e-01   +2.328154984929425e-01   +2.422272038528779e-01   +2.030080717895228e-01   +4.722869669348585e-01   +4.073530060813258e-01   +3.304682597405074e-01   +7.230748464652624e-01; +5.096814489680175e-01   +4.434911218453943e-01   +4.371921826142811e-01   +1.266211382638377e-01   +1.448298183212322e-01   -2.648597992231118e-02   +8.044995055213704e-01   -2.859495267647522e-01; +3.335910492168484e-02   +2.618194389725001e-01   +3.000555641176789e-01   +1.259085926901269e-01   +1.583113815012415e-01   -2.858314775713160e-02   +4.605182794714943e-01   +7.050414208736294e-02; +4.911232338183278e-01   -5.936137304263396e-02   -2.086621591941299e-01   +9.774886212916644e-01   +2.574993517765444e-01   +3.149167405569665e-01   +2.298574031659308e-01   +4.119854141441394e-01; +8.878594782752730e-02   +8.751035968097227e-01   +5.679112795208004e-01   +6.337114761737385e-01   +2.285517333766658e-01   -3.265738163092628e-02   +1.929548826634980e-01   +4.739349448922783e-01];
L2I_L3I_iGABA_netcon = [-2.241809747505644e-01   +2.022558320645308e-01   +3.425041571618894e-01   +4.228691493885665e-01   +4.502446000058255e-02   +7.220098954192691e-01   +1.866603341129487e-01   -3.180593315234508e-01; +2.415281529118442e-01   +1.286694335306925e-01   -1.700320928500943e-01   -3.486769673272318e-02   +2.426783317347649e-01   -7.126848690098872e-02   +3.554562756010771e-01   +2.789388965591404e-01; +8.027565659308565e-01   +8.225723265833546e-01   +8.728598437100313e-02   +5.808708309165999e-01   -2.038487891205547e-02   +7.194129064918409e-01   +2.690213143203142e-01   +2.798331974004847e-02; +2.214104597965360e-02   +3.742427007219275e-01   +7.029477845640523e-01   -3.576860916480403e-01   +6.981634036927187e-02   +5.037646563539128e-01   +7.728057653309731e-02   +4.166615823939099e-01; +6.470301566524563e-01   +2.323171505144497e-01   +1.304706001500096e-01   +3.548712164156601e-01   -1.909686628741945e-01   +2.823089911369365e-01   +6.978671548687973e-02   +8.262764960008018e-02; -3.666851332091229e-01   +2.348925330243365e-01   +7.987322554182495e-01   -2.546532970675107e-01   +4.385615277434493e-01   +9.308210777474032e-01   -2.742770173930373e-01   +1.864709056939028e-01; +5.468271841821495e-01   +1.014847664562131e-01   +2.955698112187088e-01   +2.166931741037416e-01   +2.622148532866196e-01   +6.249579554410403e-01   +8.282028777329233e-01   +5.510778958081202e-01; -3.256410175107021e-01   +7.087054242672101e-01   +2.571036968875090e-01   -1.822349392971395e-01   +1.703234395663928e-01   +3.863824990543959e-01   -2.212440408783931e-01   +8.234266635759842e-01; -8.505718504722780e-01   +8.392254141228679e-01   +6.604560543154515e-01   -1.133941539931029e-01   +1.618503240139231e-01   +5.266564072490619e-01   +4.763067098239394e-01   +3.127752593390818e-01; +2.993645869061601e-01   -3.643114156616926e-01   +1.590881968123037e-01   +1.900311059097216e-01   +4.766919943178294e-01   +5.054037960485894e-01   +1.374499066882255e-01   +5.792563199526947e-01; +8.546695412824062e-01   +3.562810143738554e-01   -4.677027639488439e-01   +1.569434055909346e-01   +4.900241459769743e-01   +2.029474603582065e-01   +5.615107193951658e-01   +9.357607449435533e-01; -3.049115985587310e-01   +7.439817787773875e-01   -2.596381995695437e-01   +6.914649678058167e-01   +6.558645932340147e-01   +3.332925912018771e-01   +1.539558946169920e-01   +1.498698018485974e-01];
L3I_L3E_iAMPA_netcon = [+4.752563635725277e-01   -1.470575880688268e-01   +2.565929809007365e-01   +4.562231019251710e-01   +1.820276378008012e-01   -2.938194419623991e-02   +1.477104133191492e-01   +1.148485833259249e-01   -3.043658042142899e-01   +4.027594659103020e-01   +6.512351473125903e-02   +4.298922109987849e-01; +1.873685093186762e-01   +9.509415071362944e-03   +8.559869163195195e-02   +5.030814912416661e-01   +3.365659861349176e-01   -7.036644637299765e-02   +2.089972119577161e-01   +3.567382714745674e-01   +5.391011408099998e-01   +2.912102087878119e-02   +7.207886494863593e-03   +1.758870697303813e-01; +3.618615272360100e-01   +5.088437951725223e-01   +5.015665718236431e-01   +2.320504968302429e-01   +6.582142436976219e-01   +2.486377943964228e-01   +5.660713858430702e-01   -1.221169804577214e-01   +3.682834453970654e-01   +5.042674423990599e-01   +1.001402779340211e-01   +3.608624090117667e-01; +4.160048357610666e-01   +3.174882535323160e-01   +4.803602174023712e-01   +6.477777427484721e-02   -2.112282078314841e-02   +7.489669926193756e-01   -1.441248287702476e-01   +3.759560241231603e-01   +3.774814875616855e-01   +4.023104527798454e-01   +5.317333598268033e-03   +2.772844355682144e-01; -2.045355297598720e-01   -1.017754640241485e-01   +8.461755223143816e-01   +3.612869151426951e-01   +4.734612354042486e-01   +3.878322130440091e-01   -2.820428881045246e-01   +2.999832977296304e-01   +5.547842631251312e-01   +6.409742727801691e-01   +3.242076897058458e-01   +4.323471174080851e-01; -1.275481035640522e-01   -1.037809392284973e-01   +1.502050466883506e-01   +5.478751793023319e-02   -2.175175954395412e-01   +1.038162001561404e-02   +2.812591848688386e-01   +3.420387983211077e-01   +2.843928006966963e-01   -2.340896552877960e-02   +2.201067261165483e-01   +4.612317454662809e-01; -8.825901568526287e-02   +1.180413910699836e-01   -1.838275638044780e-01   +5.117651000794467e-02   +4.600525583204687e-01   +6.177007203600362e-03   +6.380584547958688e-01   +4.862562534588597e-01   -7.628601202253955e-02   +3.448607944825511e-01   +5.010371850768797e-01   +3.639110589453610e-01; +3.229840621368166e-02   +3.338769916314537e-01   +1.558572272142552e-01   +1.177352251450365e-01   +3.445750785460967e-02   +1.304071256810276e-01   -1.233114475482543e-01   +3.981624551344840e-01   +4.564442338188768e-01   -3.408635164075747e-01   +2.369786516304622e-02   +4.792473644234393e-01; -6.294393909947037e-03   +6.153186101916106e-01   +1.354111769704136e-02   +2.969122738716044e-02   +1.985867855250059e-01   +8.315815616473453e-01   +2.484067225180079e-01   +5.711462544659767e-01   +1.219290145946046e-01   +2.086159271582396e-01   +5.290554241003881e-01   +1.000000000000000e+00; +7.049450102361058e-01   -5.948041182130258e-01   +8.309556343835318e-01   +1.724526567267713e-01   +2.615077677617538e-01   -3.468137685841745e-01   +5.002602148156670e-01   +1.440579954033147e-01   +7.932984825252570e-03   -1.096804953650875e-01   +9.700796938691402e-01   -4.346173706482310e-02; -4.808871408495312e-01   +3.857390369143506e-01   +8.002373526185967e-01   +4.894802285699063e-01   +2.237163259046437e-01   +1.745131193862669e-01   +2.876279560757727e-01   +1.850817766774079e-01   +6.553547254848934e-01   -2.354645880541854e-01   +1.332519392651262e-01   +3.090385836610789e-01; -2.055706674079283e-01   +1.429327479813334e-01   +1.694947167933719e-01   +2.955501996222276e-01   -2.714414506158808e-01   -2.617815055766369e-01   -3.195874339694172e-01   +1.998438163904677e-01   +6.241592785570187e-01   -1.985208878763308e-01   +1.720058978290941e-01   +1.778537322943962e-01];
L3E_L3I_iGABA_netcon = [+9.998374483178571e-03   +2.380283187518760e-01   -1.562742239199393e-01   +2.986500414917920e-01   +7.294544949859322e-02   +6.084280087045452e-02   -2.161849562685421e-02   +2.079083965680944e-01   +1.017576893834246e-01   +2.540574046443200e-01   +3.440660275836649e-01   -8.543600503116755e-02; +3.275542957435675e-01   +2.955687104853928e-01   +1.245930632106083e-01   -1.209858142680395e-01   +2.889501662109218e-01   +1.347162194436650e-01   +1.606332996052791e-01   +2.847336297301109e-01   -3.708941923585213e-01   +6.689667687566359e-02   -2.196119647720340e-01   +2.502603641908832e-01; -1.970176069590517e-02   -6.541152882412891e-02   -2.363795173095815e-01   +3.389331740189927e-01   +1.965413822180738e-01   +7.525591537653656e-02   +7.335070165011262e-02   +2.438275048813582e-01   -2.329545821876609e-02   +4.318790012294783e-01   -7.883787021586952e-02   -1.177088125958907e-01; +1.128165127144156e-01   +4.042905102173015e-01   -1.668015039502975e-01   +2.886395553505510e-01   +6.396818860513550e-01   +8.995799579968977e-02   -1.063142870801177e-01   -6.169937026334645e-02   +6.912428623920136e-01   +4.252398957017227e-01   +2.579617636042393e-01   +1.486899344279964e-01; +2.432571147126686e-01   +1.181202858106729e-01   +1.435922772204354e-01   +1.855635448257969e-01   +7.893774058618294e-02   +1.942764222324492e-01   -3.263093036933535e-01   +6.674819004898992e-01   -2.499094215353819e-02   +3.831436469414615e-01   +4.444480971517863e-01   +4.522862244233198e-01; +6.139381890514765e-01   +1.112568791679697e-02   -1.129413643615072e-01   +2.955323492887352e-02   +6.919013348698780e-02   +1.646048938342162e-01   +7.994266332842156e-02   +2.874358561647123e-01   +4.109186309833660e-01   +3.721826654484796e-01   +1.477379175819787e-01   -3.525738624757364e-01; -1.029801506849098e-02   +3.647967156168891e-01   +4.749705655045831e-01   +9.829322503375791e-01   +2.199416033646694e-01   +3.140924335442478e-01   +6.141678653980326e-01   +2.578900997900767e-01   -1.188259659403999e-01   +4.278372907084231e-01   +4.961196324410566e-01   +3.853963943980679e-02; +1.755175502057125e-01   +4.308519438583792e-02   +5.891104102665787e-01   +7.128151131547145e-02   +2.663414630948324e-01   -1.624503053759766e-01   +8.745134003494559e-02   +5.023294195046565e-01   -3.738580066057920e-02   +5.284888496464965e-02   +2.259665757603725e-01   +4.058002757249508e-01; +2.431955654547080e-01   +8.822353506111894e-02   +3.865826343156092e-01   -7.568001762257813e-02   +1.528478647990832e-01   +6.112616246021561e-02   -2.308367935113223e-01   -1.467315558370154e-01   +3.482571247820918e-01   +5.653509837164831e-01   +3.822753649112917e-01   +5.149150557196015e-01; +1.283650329377825e-01   -4.376610437209365e-02   +4.038673359626388e-01   +1.286913886058301e-01   -2.959830177629660e-01   +3.234754574389597e-01   +2.673813415458335e-01   -1.342088089914641e-01   +2.706513937039551e-01   +3.087143691596004e-02   +1.415129122139070e-01   +3.391969925838589e-01; +1.495518277501360e-01   +1.312265248232860e-01   +4.724222689513146e-01   -5.165375501624252e-02   +2.103227895988221e-01   -7.906103201404552e-02   +3.063060102107017e-01   +7.994404717646250e-02   -7.441119280233091e-02   +1.489781711214299e-01   +2.768359317417829e-01   +2.894420392379509e-01; -2.799437094970684e-02   +3.761695213996410e-01   -9.168337852734465e-02   -4.012476957091202e-02   +8.014469432867565e-01   +3.300435202254984e-01   +6.143634440284056e-01   +4.357992772346814e-02   +1.695723798777027e-03   -2.562233827215791e-01   +3.022591739077749e-01   -1.958546452925349e-01];
L2E_Input1_iAMPA_netcon = [+6.054352362107054e-01   +7.329891422944573e-01   +9.235145016651073e-01   +9.013657399598628e-01   +8.408686739528737e-01   +7.918118850582059e-01   +7.284846562479732e-01   +8.265948094144038e-01];
L2I_Input2_iAMPA_netcon = [+6.354106859006046e-01   +7.525325237273809e-01   +7.625206213916361e-01   +9.791389824048640e-01   +2.128925722061513e-01   +9.071600710982118e-01   +1.327022838418855e-01   +2.700315635199990e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
