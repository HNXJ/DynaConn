function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.247627025887212e-02   -2.355307975635684e-02   -3.090586896602383e-02   +4.452789875524479e-02   +1.185603068773353e-01   +8.484774405188622e-02   +6.664265871462553e-02   -2.092222309141054e-02   +1.905801463706785e-02   +1.007415067221731e-02   +1.369793625146049e-01   +3.992706411439523e-02   +4.950762582418071e-02   +9.499914404129692e-02   +5.690611941078055e-02   +9.734381820280953e-02; +9.529024629231826e-02   +4.879991108706069e-02   +6.626591005076048e-02   +2.075854925916103e-02   +2.604731447814805e-02   -1.201504016297696e-02   +5.536171877851313e-02   +1.748403770295219e-03   +1.818625205188429e-02   -3.516546393406664e-02   +9.074055654354893e-02   +1.405604417017165e-02   -6.624946478364520e-02   +1.004282259257833e-01   -2.193017891827002e-02   +3.249726588244305e-02; +7.522832746658950e-02   +7.136780907986474e-02   +1.200179192767696e-01   -1.433416051612089e-03   +8.959045606399198e-02   +7.425723554337191e-02   +9.582269591241810e-02   -4.791356962666106e-02   -2.050678517349290e-02   -3.182627325227956e-04   +7.604345857916575e-02   +6.445800712641114e-04   +3.414088969731537e-02   -6.802429666334901e-02   +3.765182742848865e-02   +4.847410712475086e-02; +9.179889517941901e-03   +5.794023939533448e-02   +5.631983185965558e-02   +1.805061258830138e-02   +5.036657565914249e-02   +1.266753505399839e-01   +5.043658350791699e-02   -2.650121746120039e-02   +4.552404781296081e-02   +8.004265645458594e-02   +8.312934876173245e-02   +1.696024214300319e-02   +3.568231644787156e-02   +9.319744804385231e-02   -5.143297294135648e-02   +3.191399168315911e-02; -1.945669179680082e-02   +1.261745433240226e-01   +3.856478330725563e-02   -4.723761253751528e-02   -5.972898587750025e-02   +7.097741404149031e-03   +7.905853437386910e-02   -2.982063498388289e-02   +4.714577786063984e-02   +4.819337720096721e-02   +5.849764807916076e-02   +1.117218007943891e-01   -9.543701495093419e-04   +5.654272453752573e-02   -4.625474376345330e-02   +7.020762609444901e-02; +3.156157945288538e-02   -2.304887154065006e-02   +8.222866569098035e-02   -4.685894525690541e-02   +1.045292273247661e-01   +3.104887828642201e-02   -1.074752002119143e-03   +6.020248573334493e-02   +1.920197352444111e-02   -2.786393443212624e-03   +2.863408434416560e-02   +2.886950772458472e-02   +4.563231370716595e-02   +6.838135444299669e-02   +4.906514677816071e-03   +1.230321310996673e-01; +8.420692649194983e-02   +4.125539691716314e-02   +7.196864455244562e-02   +3.882210277964249e-02   +2.525830505853117e-02   +8.933549538281411e-02   +1.468576122956121e-01   -1.705217743061093e-02   +1.169181097469974e-02   +1.175226058920775e-01   -1.768052106593223e-02   +6.787329485824266e-02   +6.419979490268368e-02   +3.913029483759804e-02   +1.273130695572573e-01   +3.471231700593715e-02; +7.041632615137021e-02   +7.141455603284209e-02   +2.533418735183925e-02   +3.626329884660362e-02   +8.056983066700810e-02   +1.242734432929257e-01   +4.651209909982396e-02   +1.121938385724099e-01   +8.013332145310956e-02   +2.739419877572198e-02   -3.270427816308395e-02   +4.195829419977413e-02   +2.123237558948490e-02   +1.335375735387292e-02   +4.214848602184955e-03   -1.306830339903492e-02; +1.122854985001591e-01   +9.315125771753623e-02   -1.703893424087494e-02   +1.646897924463041e-01   +1.627803050190174e-02   -1.321045612207233e-02   +2.376625114977438e-03   +2.160493324436015e-02   +1.144600806556189e-01   +5.506603959464158e-02   +9.358164213865680e-02   +4.539584974417506e-03   -7.171164078055584e-02   +1.375656609747881e-01   -5.626421849963897e-03   -6.097624683511016e-03; -2.789374094446716e-02   +4.501994027000423e-02   +1.413407948920004e-01   -6.003554227683759e-02   +5.416271279765068e-02   +8.243601994505695e-02   +9.080655332835778e-03   +4.259564799909614e-02   +8.512518657758344e-03   +1.155910917828293e-01   +8.763652235120090e-02   +3.185852570873617e-02   -2.117553341034643e-02   +5.582446720636772e-02   +4.969468392497556e-02   +6.077433292430300e-02; +9.580383039369750e-02   +7.834718743176830e-02   -2.086100251810907e-02   +4.612389480635529e-02   +1.493325395945194e-01   +3.647807059268323e-02   +1.007391658538475e-01   +1.238075465596936e-01   +3.232920220840682e-02   +7.936533185019955e-02   +2.184309314777971e-02   +1.017309340229589e-01   +1.112976427232018e-01   +3.341110888046341e-02   +3.303639949474645e-02   -1.484723470071211e-02; +5.547415923048230e-02   +6.788202763056186e-02   +5.041545590743791e-02   +7.899908537566315e-02   +6.376336322189255e-02   +2.911356647734882e-02   +2.885496180453968e-02   -3.780908098418342e-02   +2.549613136493701e-02   +1.577090208593820e-02   +4.659330382027090e-02   +9.277891300289805e-02   -7.146232080975118e-02   -1.137820150016242e-02   +6.361472843054519e-02   +6.144591447160075e-02; +1.172755769172460e-01   +2.619744599583846e-02   +6.486997117753268e-02   +3.498532067427353e-02   +1.020443636236509e-02   +1.318861216475618e-02   +8.818510779428251e-02   -1.003472464471670e-02   +8.612672017123413e-02   -9.704682813177868e-03   +3.198968719674340e-02   +8.974935745122389e-03   -3.883844971301996e-02   -2.497952288444327e-02   +5.604714975827956e-02   +3.779990212255072e-02; +8.041895777705036e-03   -6.852694731998774e-04   -4.045496010712107e-02   +7.540161360081510e-02   +8.141100488785288e-03   +4.551394878391443e-04   +8.299524262866030e-02   +1.580081654411067e-01   -7.442205592814330e-02   +5.609242461629971e-02   +1.646923350029651e-01   -8.035461950402084e-04   -4.866696449405816e-02   +4.196280203420553e-02   +4.678969458300881e-02   +9.064848533213674e-02; +6.303089203318138e-02   +4.838079393580220e-02   +3.214487722861688e-02   +1.373956278953670e-01   +6.117698197304555e-02   -4.202367789644679e-02   +7.895580569965904e-02   +9.503948127828887e-02   -2.011601089118988e-02   +1.284196199688409e-02   -2.718446246990243e-02   +3.109168994841801e-02   -1.518857595718011e-02   -8.854107718021115e-06   +1.110442473710108e-01   +9.775398448927919e-02; +7.940557149160984e-02   -9.061023103268721e-03   +2.678335100276352e-02   +9.769708503923188e-02   +1.349298535098785e-01   +5.312369878711164e-02   -2.823913085071440e-02   -5.532697821417364e-02   -2.657874240805050e-02   -1.190713424442346e-01   +2.393756460516190e-02   +9.367657304443758e-02   +8.026558396223778e-02   +8.396753567453288e-02   -3.756609235163584e-02   +8.914141855914655e-02];
L1E_L1I_iGABA_netcon = [+6.276042868219973e-03   +3.885000830257827e-03   +8.108907155816991e-02   +8.548288451254717e-02   +3.612057409708135e-02   +1.507739194479045e-01   +1.125969348688204e-01   +4.853844069130166e-02   -3.682476725866221e-02   +7.511244913029591e-02   -4.185379240890139e-02   +6.050941728737680e-03   +1.184005633874388e-01   -1.509356380711314e-02   -4.438115054306819e-03   +1.522691036320239e-01; +3.909718657507813e-02   -6.523294647091915e-02   +5.558413864407268e-02   +5.926621829639542e-04   +9.139842888945548e-03   +4.950773222983267e-02   +3.023173860704440e-02   +8.962347494161009e-02   +3.833068117259755e-02   +3.196593255022508e-02   +2.869675877623363e-02   -3.391147793767960e-02   +3.078149446067354e-02   +7.081040908959277e-02   +4.818850985497884e-02   -7.411939719159500e-03; +7.001048432918853e-03   +7.227748201635020e-02   +6.611341431301250e-02   +1.150131685846555e-01   +3.778968637349809e-02   +8.255800342519465e-02   -3.373457247265083e-02   +6.443125912923345e-02   +4.791061136910676e-03   +5.716886809247333e-02   +7.159695414839969e-02   +1.125492028704354e-01   +5.304764173833345e-02   +3.694933263030541e-02   +3.804890152374645e-02   -1.245804180284708e-02; +6.507455121519938e-02   +5.946244420596110e-02   +3.686948312812603e-02   +3.833499748364178e-02   +8.556976876034909e-02   +3.300598583055513e-02   +3.665631911674523e-02   +7.047604775916283e-02   +5.445189252378299e-02   -3.905288788108530e-03   +4.351882166621999e-02   -5.145524555457044e-02   -2.383216108406440e-02   +8.868012171866932e-02   +9.386270411721215e-02   +7.737131887762110e-02; +6.407166914222602e-02   +5.276730529190998e-02   +1.407553219267985e-02   +2.377197284354483e-02   +9.214388352067364e-02   -3.624053783724684e-04   -9.404637395014016e-02   +2.864810637725093e-02   +6.155351937569313e-02   -5.504931015985761e-03   -4.719162717156010e-02   +4.185705325777558e-02   +1.711890267683575e-01   +4.053527928039800e-02   +1.588215835020873e-02   -4.012064783752343e-02; +4.682084549815328e-02   +7.821963307526109e-02   +2.907886633773199e-02   -4.197779479368921e-02   +4.095748938405692e-02   -5.821891647450776e-03   +8.933656919871009e-02   +1.263086383940494e-01   +3.223280588125224e-02   +2.103055076417894e-02   +8.395943199568438e-02   +2.549819844689969e-02   +9.747165257950721e-02   +1.024991662723692e-01   +3.786277293054931e-02   +1.318629389199429e-01; +3.512359758744034e-02   +2.130419014329312e-02   -4.280463691824325e-04   +9.535244906303189e-02   +1.326723310184195e-01   +3.124111220136017e-02   +7.419729060983410e-02   +5.054084224509504e-02   +6.239665602204299e-02   -9.972612776866476e-03   +3.126126559775468e-02   +1.398139739449512e-03   +1.896357533241570e-02   +1.470718857557856e-02   +1.574081198477410e-02   -7.971053813789684e-03; +1.630205112847521e-02   +4.699779935180095e-02   +2.216737850783054e-02   +6.684242672488962e-02   -6.494274212578408e-02   +2.361162060462289e-02   +1.428960285616362e-01   +2.952038849773638e-02   +4.372077694648131e-02   -3.460051082123132e-02   -1.737466847022825e-02   +1.332240897791633e-01   +4.413015450287644e-02   +2.055871623791121e-02   +3.473835470293823e-02   +2.053415973056492e-02; +1.850073724644501e-02   +5.976053160380173e-03   -8.875036975371772e-03   +8.660977328464414e-02   +5.365534607821806e-02   +8.366718557350269e-02   +8.703410713751188e-02   +3.769024097338335e-02   +1.043656301867511e-01   +3.428617176754604e-02   +6.965612102435942e-02   +4.414764489053599e-02   +7.149013941370065e-02   +3.763312494415198e-02   +7.479499448851745e-02   +1.222855822355031e-01; -1.648839519388896e-02   -8.789923408794012e-02   +5.448438993017692e-02   +2.129052406186420e-02   +2.464295716794557e-02   +3.739135883922050e-02   +3.986535559365827e-02   +9.206723714389467e-02   -3.954447100393980e-02   +6.864574329026647e-02   +3.601512926499562e-02   -2.702720372945654e-02   -1.807887496602348e-02   +2.561988578271919e-02   +2.498632405369713e-02   +3.406544331289788e-02; +8.279726440269485e-02   +1.701031370982217e-02   -1.342866881229155e-02   +3.504883288828862e-02   +3.504470220220896e-03   +6.747639313196342e-02   +1.130844024658530e-01   +1.010766864023099e-01   +7.329745005646353e-02   +3.744772586955770e-02   +6.755354497702666e-02   +1.124037498774761e-01   +7.781633677962335e-02   -4.395954258341807e-03   +9.243477835097418e-02   +9.213982984193087e-04; -3.051222080406268e-02   +2.129794032924898e-02   +5.367786160692166e-02   +3.594249747993544e-02   -3.130742118929511e-04   +1.017171819699910e-01   +5.888431882559223e-02   +3.268147523120161e-02   -8.313227249511982e-03   +1.849038457551550e-02   -1.624780252619153e-03   +3.786208935957125e-02   +2.742586667383373e-03   +8.921302532145518e-02   -5.539702887620970e-03   +3.378708241853678e-02; -2.320628230469284e-02   +1.080345216090678e-01   +1.221227750395266e-02   -6.279406651080963e-02   -1.376810917399169e-02   +6.357822607641667e-02   +1.005483494052106e-03   +1.242382224088974e-01   +1.090566829806773e-01   +2.158790762386175e-02   +6.020086482597855e-04   +8.261067107700860e-02   +3.063355946599553e-02   +1.253035381321680e-01   +1.644406991030305e-02   -4.359301814129910e-02; +7.773109854165952e-02   +1.075366391245009e-02   +7.899446621959604e-02   +9.769675384620184e-02   -7.520958665457010e-03   +4.250401570596288e-02   +1.194190364587280e-01   +3.020194909459759e-02   +3.917383561656620e-02   +8.701256558214439e-02   +2.022063404251628e-02   +6.277381791786128e-02   +1.620341248391515e-02   -9.837323947182765e-03   +1.182442411259311e-02   +1.503290848723226e-02; +4.616584397040797e-02   +3.632964376711126e-03   -3.795200229339520e-03   -2.184784185813618e-02   +8.322235427271855e-02   +8.567532160343315e-02   +1.817485446567545e-02   +8.949491688319391e-03   -2.275804764712302e-02   +9.005924755888700e-02   +5.984668249803281e-02   -1.668853867283524e-03   +7.617326414371686e-02   +1.602791076719710e-01   +4.212408154252686e-03   +8.248341738809720e-02; +4.178089698958376e-02   +2.646836252092017e-02   -5.842517426882114e-02   -6.730757005349673e-03   -6.542758760622155e-03   +8.272437259587853e-02   -3.414344634484612e-02   -2.341856153404316e-02   -3.491310019413163e-03   +7.651916545132237e-02   -1.704177823384632e-02   -8.070378022111975e-03   -3.772351187218329e-03   +4.691214573200239e-02   +1.172946092430265e-01   -2.047523594589540e-02];
L2I_L1I_iGABA_netcon = [+1.246715277933469e-02   +6.640267337013209e-02   +1.433012199007270e-01   +4.313861207491120e-02   -8.644336684193565e-03   +4.643905729338588e-02   +3.649099021316778e-02   +6.555203970254833e-02; +6.770028420399681e-02   +6.489670558564707e-02   -1.430216987160712e-03   -3.462919161729505e-02   +4.781220099571944e-02   +1.082243094542048e-01   +3.732665952142659e-02   +6.980824954587894e-02; +5.329514147675411e-02   +3.769355175099590e-02   +2.360051798642168e-03   +5.052697200146929e-02   +4.824866696441871e-02   +3.170619110972170e-02   +4.562474192184718e-02   +2.208097280815894e-02; +3.266829928333730e-02   +4.516907034301300e-02   +4.658153553895893e-02   -1.796164840194462e-03   +8.894554906875889e-02   +6.015772452656943e-02   +6.741685551697937e-02   +9.283255208405151e-02; +1.434963326514030e-02   +2.516290295947693e-02   +1.389913512780761e-01   +4.677561181274439e-02   -1.322515814550551e-02   +1.507512443488745e-01   +2.613615775387992e-02   +8.318760825510343e-02; +3.321621164671203e-02   +8.252683878388681e-02   +1.638842037919830e-01   +9.875071476305332e-02   +1.042195845570695e-01   +9.699988501550014e-02   +1.513902677726560e-02   +1.075493149801636e-01; +1.967591766317704e-01   +3.165318472685769e-02   +6.541703320289757e-02   -9.016776109017792e-03   +3.608371251331581e-02   +1.715470343948461e-01   -2.288467354448268e-02   +1.155780088080871e-01; +9.263091446280669e-02   +8.234534291708583e-02   +8.738133636184808e-03   +1.043631263678181e-01   +1.530965439915514e-01   +3.229151056813694e-02   +3.360479138065425e-02   +3.706219789964081e-02; +7.082416817331509e-02   +2.883230374472549e-02   +1.198917846268744e-01   +2.192778099288881e-02   +1.554756043268004e-02   +3.686332960101370e-02   +7.159765528954587e-03   +7.762600984745026e-02; +1.250600275687769e-04   +3.533621247116317e-02   +6.706717295583629e-02   +3.268405667307613e-02   +7.352438503093806e-02   +8.640560585277178e-02   +5.703060239035000e-02   +4.736389079525261e-02; +5.222917307259729e-02   -3.919939562045738e-02   +3.559373978322512e-02   -1.798340182166465e-02   +6.760886264343570e-02   +3.060516586991321e-02   +1.547796960149322e-01   +3.717783675894839e-02; -1.332688775821402e-03   +1.388992772720108e-01   -3.103239717663188e-02   +3.354861021113210e-02   +4.331795735391100e-02   -1.496579046062990e-02   +1.132125848629543e-01   +3.682349135426854e-02; -9.610612290825519e-03   -1.377800082883072e-03   +2.998674791891786e-02   +1.310877522367660e-02   +1.739806630164289e-02   +4.240398896553769e-02   +8.772129439472337e-02   -3.068559063499141e-02; -2.360412680629483e-02   +9.392465926358150e-02   -8.845557226025383e-03   -4.387456344022528e-02   +3.468086554691477e-02   +6.538488378544628e-02   +5.977626480913470e-02   +7.855729690086508e-02; -1.110076002673957e-02   +3.852294664392788e-02   +3.209511128700099e-02   +6.905972716241876e-02   +8.700772909141027e-02   +1.728919841789611e-02   -2.930908557817480e-02   +5.164778095173948e-02; +1.553414655281642e-01   +1.249806950730397e-02   -1.234837978042972e-02   +7.515691609569738e-02   +1.360920571578692e-01   +1.332231741401264e-01   +4.209811241344101e-02   +6.649306295657519e-02];
L1I_L2I_iGABA_netcon = [+6.170218188404369e-02   +8.242679484903029e-02   -8.199770841683245e-02   +8.267677181167186e-02   +2.706411125078870e-02   +2.826002253221596e-03   +4.003411178018315e-03   +4.285053616478682e-02   -4.469090309687675e-02   +7.191243275721133e-02   +3.131486060049582e-02   +5.303588887859825e-02   -8.370686658999980e-02   +1.353445732398975e-01   +2.416927072748605e-02   -8.427245925702709e-02; +1.221688228504857e-01   +1.092233285790374e-01   +2.662531519127197e-02   +8.543111930547613e-02   +6.844510141683410e-02   +4.540427499211535e-02   -5.593347056579816e-03   +1.163051160345730e-01   +3.461197134709600e-02   +1.219276763802970e-01   +2.292475045497860e-02   -5.962120778474054e-03   +7.764889339656726e-02   +7.107742110383405e-02   +6.612169940890807e-02   -2.049833679222726e-02; +8.249320849656006e-02   +4.164617923344605e-02   -1.186627621689169e-02   -4.746908612273480e-02   +1.280295238616728e-01   +1.203074186465530e-01   +3.898419501000579e-02   +9.677312538332118e-02   +4.006981704379825e-03   +6.025012221290491e-02   +6.043968170941043e-04   +6.446198868488495e-02   +2.565859131887303e-02   +7.254957361161053e-02   +3.460285186898001e-02   +1.063850466200379e-02; +1.109779951255354e-02   +9.819857302361198e-02   +4.210026367619802e-02   +6.425471946944229e-02   -1.107439776405515e-02   +1.101467095157160e-01   +8.945529134497515e-02   -2.998210564461253e-03   +4.218034875700314e-02   +1.292859403871235e-02   +1.575267893428486e-01   -4.263970624087982e-03   -7.120445140031632e-04   +1.198196439440891e-01   +9.004619670028274e-03   +5.561255787639073e-03; +3.542910279065992e-03   -3.079706446052243e-02   +7.231337760459097e-02   +3.999137033772650e-02   -1.101520417269507e-02   +7.776258271196783e-02   +4.985462258764099e-02   +1.105969166358936e-02   +4.811229410145677e-02   +9.001081903494332e-03   +5.511250495679924e-02   +1.986247439037302e-02   -1.206628978763280e-03   +7.531597509533399e-03   -2.757404745143834e-03   +3.118672893052624e-02; -2.558448321854602e-02   +2.534781403533756e-02   +8.765826579821313e-03   +6.059232315118235e-02   +3.321050144750032e-02   +3.189630261064857e-02   -4.460544784133186e-02   +7.465934983378830e-02   +9.582812934227530e-02   -2.566390396934825e-02   -6.771591987754386e-02   +9.641325985864049e-02   +1.116101139393811e-01   +8.059592278570434e-02   +1.219490429951853e-01   +6.380867633917779e-02; +7.596452750622565e-02   +6.152355162611704e-02   +3.547147867549166e-02   -8.312153078871411e-02   -3.782194044290206e-02   +6.757341816435850e-03   -6.832311806635881e-02   +4.575484296300239e-02   +8.018595378328533e-02   -8.450693716979291e-03   +7.469380445592001e-02   +4.806619131518594e-02   +6.973419553838731e-02   -2.897836887521538e-02   +1.070156475226531e-01   +3.868681022704014e-02; +5.015164239655084e-02   +1.008031757305596e-01   -4.963115510325116e-03   +5.947288228847033e-02   +6.220111809342152e-02   +2.395129843613698e-02   +4.780697861782603e-02   +3.947345459302076e-02   +8.503068272701210e-02   +4.538577949107188e-02   +4.812910768959312e-02   +1.024907317205136e-01   +8.739293222471731e-02   +4.990576822917616e-02   +6.192930237842979e-02   -2.498170923521985e-02];
L2E_L1E_iAMPA_netcon = [-1.097072590596675e-02   +1.316726039216084e-01   +1.534102931632337e-01   +3.565907920886451e-02   +1.471990779231282e-02   +3.155798528423985e-02   +4.763698431936005e-02   -7.177153726290547e-02; +8.122204023720887e-03   +1.993803628822039e-02   -3.301562603747908e-02   +8.979655159916414e-02   +1.028656953550927e-01   -3.932811623399139e-02   +1.234653245807363e-01   +8.022310544166893e-02; +1.008473991515754e-02   -1.210193904410160e-03   +1.347232433618249e-01   -1.402605604653419e-02   -5.885912813457413e-04   +1.030958674263500e-01   +6.402601431238421e-02   +4.159782716597051e-02; -1.507224645594946e-02   -8.240273331292604e-03   +1.251111480989478e-01   +2.785810245383404e-02   +9.275810762931531e-02   +1.065841222902898e-02   +1.288126289872994e-01   +3.102013359666220e-02; +1.779203567776460e-01   +6.024108832926036e-02   +6.133557109735577e-02   +1.326262619651329e-01   -8.659902069735864e-02   +2.436423343981731e-02   +2.645500597487086e-02   +1.091160951623812e-01; +1.257452990367252e-01   +7.710565472164493e-02   +4.532449312195670e-02   +3.726260001567493e-02   -2.372716673338007e-02   +5.002358966399861e-02   +4.545717252240371e-02   +6.241752147452914e-03; +9.178116432772956e-02   +1.260488362031445e-02   -6.669633306287899e-03   +8.951698016705424e-02   +1.716071183989929e-02   +1.476593025305844e-01   +1.640593573699618e-01   +7.173607835409984e-02; +7.934493929957159e-02   +5.686808724617103e-04   -4.907374370451571e-03   +8.512093163821631e-02   +4.676666738574824e-02   +4.252330159298186e-02   +2.475797569435274e-02   -2.081581114763296e-02; +1.517867763078397e-01   -1.206478530895798e-02   +1.021829836819476e-01   +2.506530011411133e-02   -3.361670648220690e-02   -1.171593983747494e-02   +2.765187374987590e-02   +1.246893312445619e-01; +5.561534898334292e-02   -7.791988869469418e-03   +5.113450106916961e-02   +3.710473113375420e-02   +1.547041391249222e-01   +3.496235439091246e-02   +1.827822072391710e-02   +5.377826575342326e-02; +1.844335394073770e-02   +1.356387479471807e-01   +3.654771678910657e-02   +4.850693269133335e-02   +2.021876202863829e-01   +2.514597177046393e-02   -7.992096812209963e-03   -2.806767942880039e-02; +7.356675685099465e-02   +3.148726395073789e-02   +1.451015126761713e-02   +1.250001433955023e-01   -2.728919126747831e-02   +9.343437306146712e-03   +9.628320905324855e-02   +2.195066460387639e-02; +5.454920841616312e-02   +3.862954392777090e-02   -5.346383329615061e-04   +3.465385996120578e-02   +8.365569085704501e-02   -2.149733882871300e-02   +8.686903623237056e-02   +7.663358855265277e-03; +1.174776219599717e-01   +1.141163251656390e-01   +3.960463391586672e-02   -3.132025151872949e-02   +1.974778135554723e-02   +1.132252237965842e-01   +5.268017986186861e-02   +6.744892635223870e-02; -5.804691523844475e-02   +9.843780367767134e-02   +3.891939581911114e-02   +2.425253960364676e-02   +1.461708223198095e-02   +1.223747088434917e-01   +1.116567949636788e-02   +7.469605533034480e-02; -1.559389979015148e-02   +3.408304003407792e-02   +3.849256455992702e-02   +4.914844345677495e-02   +8.907105612722037e-02   +4.534273446248267e-02   +8.746411654049474e-02   +2.396538398809422e-02];
L1E_L2E_iAMPA_netcon = [+4.941196634649281e-02   +2.154463790033462e-02   +6.207802448429605e-02   -1.679780750120639e-02   +1.211390520174865e-01   +9.158882414342209e-02   +1.061202243188567e-01   +1.846652510387473e-01   +3.510272195274191e-03   +8.893929968780895e-02   +2.465674378114016e-02   +2.506209770277192e-04   +5.488819006179504e-02   +2.228941695863330e-02   +1.272143565269008e-01   +4.162550109058232e-02; +1.250570722394383e-01   +1.113640894557692e-01   +2.630080145088797e-02   +1.212213473104304e-01   +3.823334989993067e-02   +2.991563345699984e-02   +1.005768952949442e-01   -2.998629245554083e-03   -1.006819616722584e-02   +5.224878565258640e-02   +7.831972520841810e-02   +6.929244523498881e-02   -2.032976503512649e-02   -1.071783384742107e-02   +4.825436369396890e-02   +6.332278633563711e-02; +1.518248872801993e-02   +1.341512754010467e-01   -4.061518676761859e-02   +6.523330753488180e-02   -2.427562646302137e-02   +4.996231036605488e-02   -8.660808161833559e-02   +1.593759223264865e-01   -1.617021263083759e-02   +5.077495694694621e-02   +8.783185857420467e-02   -7.338612876077477e-02   +6.909402285868299e-02   +6.211289618457507e-02   +1.121086884359111e-01   +1.521074995143418e-01; +5.354179655525929e-02   -2.390909637269407e-02   +4.522619006587680e-02   +3.472594415343738e-02   +8.013463095274853e-02   -3.491209960048199e-02   +8.219784080700475e-04   +1.586592918591000e-01   +2.617459010760432e-02   +7.574814213638807e-02   +4.357746819846246e-02   +7.449887465574223e-02   +1.576747660316220e-01   +3.601188673983310e-02   +2.256043301695456e-02   -8.364055296525216e-04; -1.371108787369747e-02   -2.074402227156078e-02   +6.852295377663663e-02   +8.036101587079568e-02   +1.147355632819913e-01   +1.726127233122254e-02   +2.112582212791076e-02   +9.435659132129927e-02   +8.769862050812760e-02   +1.327966911613806e-02   +2.199448237794801e-02   +1.203909224548907e-01   +1.051706342515022e-01   +7.016108478156763e-03   -6.121743757492326e-03   +7.158963859762915e-02; +3.912783072191547e-02   +6.519294608163281e-02   +2.108555829734755e-02   +1.381229843032261e-01   +4.865824421221842e-02   +4.614375062984633e-02   +8.137202656623908e-02   -1.257691548133475e-02   +6.139629196878656e-03   +6.206851375347054e-02   -3.388853395373109e-02   +4.216599047914255e-02   -1.247381823816333e-02   +7.904595075855050e-02   +7.242389382444801e-02   +2.761369077378861e-02; +1.303037854451250e-01   +1.096124285173379e-02   -3.510308232895345e-02   -9.349848919132150e-02   +6.184482485870448e-02   +1.077294859056906e-01   +3.353452040586852e-02   -6.713873187662635e-02   +1.028971631830136e-02   +8.105419820206475e-03   +7.509155082764954e-02   +1.511189926990789e-02   +2.023401549672212e-02   -3.957406088439872e-02   +3.662115021945494e-02   +3.425940151276863e-02; +3.669830079427347e-02   +2.126031158695291e-02   +7.521135926542322e-02   -3.350106624719715e-03   +6.364217228184170e-02   +1.262939090482337e-01   +3.657288886005416e-02   -3.664428525197818e-02   +6.476908187916773e-02   +3.306613522370339e-02   +9.313960431812389e-02   +7.037567016505251e-02   +9.622622391367253e-02   +1.076274397249844e-01   +6.997433438452326e-02   +1.417519357042146e-01];
L2I_L2E_iAMPA_netcon = [+1.364576436140088e-01   +2.462012904177392e-03   +6.006055143316863e-02   +6.525924212406108e-02   +9.758698120256640e-02   -2.275054164530155e-03   +3.264042807894754e-02   +4.512530821837082e-02; +1.285938065664035e-01   +8.410194330167482e-02   +2.981166435814464e-02   +7.147123166806033e-02   +6.070340725331150e-02   -2.468286646846436e-02   +8.944928341107579e-02   +3.238523291595428e-02; +8.624104392825853e-02   +2.887249890040095e-02   +4.468792827723279e-02   +2.579374251245720e-02   +1.381783191936976e-02   +1.106789812585530e-01   +1.114572652536806e-01   +8.810130910681388e-02; -1.871200805279867e-02   +7.185561822503708e-02   -8.735049060634473e-02   +2.220657791628856e-02   +1.005475621847280e-01   +7.598513268620043e-02   +1.685731322561853e-02   +2.180076262819709e-02; +1.148355579374021e-01   +2.078170269530989e-02   +4.347742474433675e-02   +3.530062906164852e-03   +5.619419355927180e-02   +8.012416366805515e-02   +2.720672428194578e-02   +1.001557545610429e-01; +6.881549171243068e-02   +1.128307191197508e-01   +1.294481769106056e-02   +1.093809892673114e-01   +6.427809147994462e-02   +9.448036294585850e-02   +2.972052265991962e-02   +1.529943128277042e-02; +1.150040845635395e-01   +5.222344919976954e-02   +1.139549131520918e-01   +1.020034893057108e-01   +3.829944089017900e-02   +6.466362662781178e-02   +1.089431184398528e-01   +1.819848731378904e-02; +1.647038922439389e-01   +1.236161004888574e-01   +5.778226625204144e-02   +2.729047313231043e-02   -4.467778713203523e-02   -3.422851909672185e-02   +1.494252818819566e-02   +1.119816668402774e-01];
L2E_L2I_iGABA_netcon = [+1.167170216390374e-01   +1.388591077350678e-02   +9.918172095124206e-02   +1.285965923701232e-01   -5.091063342553786e-02   +1.072548437398563e-01   +6.553562278056912e-02   +2.472282825717865e-02; +4.986473583745384e-02   +8.648531255091799e-02   +3.932138045184291e-02   +6.254405333472662e-02   +1.186543866258529e-01   +6.388872030758320e-03   -3.291151483148125e-03   -9.273137714955254e-02; +2.741607913073425e-02   +3.621931306821422e-02   +4.008088005271036e-02   +8.946956701568143e-02   +1.017442058611538e-01   +2.036159494285885e-02   +3.175012599352510e-03   +6.000509669867163e-02; -9.194185443520295e-02   +8.673712312180418e-02   +3.468856370870202e-02   +5.761024867450397e-02   +5.040541644550943e-02   +3.253588256899718e-02   +6.469351016272600e-02   +7.650217251750838e-02; +3.969684786478796e-02   +4.351966206853787e-02   +6.597520065268714e-02   -9.254457241942890e-03   +8.820885526762728e-02   +6.750525139348805e-02   +5.498819824202238e-02   +6.339191709332534e-02; +1.438693270463479e-02   +7.920021212914118e-02   +1.342678322717129e-01   +9.105401236815740e-02   +1.265888338333911e-02   +4.257348657852252e-02   +1.209396154334129e-01   +4.042299162387985e-02; +1.478219433461920e-01   -2.357973988149326e-02   +1.679349354221565e-03   +9.866152528416013e-02   +2.932342140041022e-02   -5.638442261001875e-02   +3.307384710894928e-02   +6.097086432741436e-02; -2.558861312417702e-02   -8.836965743864805e-02   +1.015839566642675e-01   +1.125080958275357e-01   +8.282163913501995e-03   +5.062649538774137e-02   -4.978554908100675e-02   +2.727344519314337e-02];
L3E_L2E_iAMPA_netcon = [+6.051317976273453e-02   +1.573646734404772e-01   +1.186781203883241e-01   +3.627999023865547e-02   +1.588151697483504e-01   +5.868008653363563e-02   +9.296899635417366e-02   +4.526610894159678e-02   +3.363563408536518e-02   -4.154810414709541e-02   -3.758828304820723e-02   +4.632882972004815e-02; +1.400714560178002e-02   +4.333610183704994e-02   -2.105547233220703e-03   +4.715052501055825e-02   +1.019821807100708e-01   -1.991116829014798e-02   +3.020595108284798e-02   -6.073902572208605e-02   +4.019228590646173e-02   +2.412328512512158e-02   +5.417929952668231e-02   -4.052604052452648e-03; +1.010187267445970e-02   +4.732220656813533e-02   -5.896193309929028e-03   +1.368757449507378e-02   -2.061848003455200e-02   +4.339926056394574e-02   +7.128744977809848e-02   +5.981584001559062e-02   -1.797437151946514e-02   +5.681997872085745e-02   +8.052687406035962e-02   -1.621479359595768e-02; +3.053357748095132e-02   +1.415739162003601e-01   +6.022039435752793e-02   +1.022125295138273e-01   +8.799846450147961e-02   +3.570281708057090e-03   +2.973584656234093e-02   +1.109542131562937e-01   +1.266686750555172e-01   +8.825670557662378e-02   +6.777526315886197e-02   -4.688300045261745e-04; +7.131005745630563e-02   +3.519284384124338e-03   +4.512852391223425e-02   +7.469450356440784e-02   -2.899656710627392e-02   +7.057219389995069e-02   +6.496505451253924e-03   -8.341704456392424e-02   +3.697871885108000e-02   +3.822360361587195e-02   +7.106311224267722e-02   +4.122293030156447e-02; +2.113864528515752e-02   +1.261008670470881e-01   +3.268323179613075e-02   +7.589277830964095e-02   +7.061909393890729e-02   +9.276396501007485e-03   +5.552944099513404e-02   +8.961808910069927e-02   +9.100038357678349e-02   +7.016799510607438e-02   +1.204644698887764e-01   -2.920968201464311e-02; +9.282200200085361e-02   +6.632293975140927e-02   +2.912744764636060e-02   +3.381233193474591e-03   +1.328214476182073e-02   +2.654348741696498e-02   +5.027018380157726e-03   +5.810754807986818e-02   +1.025813412737010e-01   +3.549452501151845e-02   +7.648733854797425e-02   +7.555014594147194e-02; +1.809268940948923e-02   +7.764913002813360e-02   +6.321932665474636e-02   +3.310170182225770e-02   +2.373380146899320e-03   +9.068199859376753e-02   +5.180956080346871e-02   +4.508015322410074e-02   +8.572991220581162e-02   +5.208604257819614e-02   +1.714965304424756e-02   +3.435758518334568e-02];
L3I_L2I_iGABA_netcon = [+4.589903990303036e-02   +9.299851684535911e-02   +5.253069338087885e-02   +5.607573572659189e-02   +1.243428775191652e-01   +7.190978074695459e-02   +4.618628116265670e-02   +2.273591358559625e-03   +7.577921534545999e-04   +1.279718093642449e-01   +6.554085588083497e-02   +4.072071455451060e-02; +1.067190339141218e-01   +2.021384824218099e-02   +4.488453899012004e-02   -5.324593501755478e-03   +7.258190323518987e-02   +5.167168848997777e-02   +4.325408580497919e-02   -2.736858525901356e-02   -7.727272441169844e-03   +3.444804213447532e-02   +7.518067142694682e-02   +3.504858984114397e-02; -4.935170416968675e-02   +8.711432601045341e-02   +3.516486312830231e-02   +1.173916787279514e-02   +8.537412425517765e-02   -5.938292281048227e-02   +2.356248303734660e-02   +1.162959357717279e-01   +2.104219968345742e-02   +6.767600447286376e-02   +8.099386665470146e-02   +1.214933803526871e-01; +6.765676918994172e-02   +1.874248698933796e-02   +4.944158887768958e-02   +4.219854224913720e-02   +1.767105574661667e-02   +8.500534504297720e-02   +2.204592520562848e-04   -2.107516161096004e-02   +5.601238863460906e-02   -1.857266415479999e-03   -1.383772654969380e-02   -5.316674765564810e-03; +5.860593812600608e-02   +3.963442582369291e-02   -2.230978886172305e-02   +4.890129439228488e-02   -5.284623150035397e-02   +2.934700315361535e-02   +9.641582459283009e-02   -4.765910436061291e-02   +1.544385130756371e-01   +8.880755014714883e-03   +2.173280708039216e-02   +1.475691635223454e-02; -1.007561151867164e-01   +1.061105478717107e-03   +7.037267500742177e-02   +7.385662750826737e-02   -6.371896606391120e-03   +1.807635070545950e-02   +7.243272939187463e-02   +2.487734048659291e-02   +1.111852804372624e-01   +8.546697493732014e-02   +9.219058302058322e-02   +7.008520803005791e-03; +1.019109616344370e-01   -5.026847484239483e-02   +7.660579970060363e-02   +5.565197384408967e-02   +4.577032302196081e-02   -1.006005186396632e-02   +7.275974015784456e-02   +5.564203129550951e-02   +9.921638716849925e-03   +3.283919085812066e-03   +1.501404147845530e-01   +4.490407452727824e-02; +9.296707043901671e-02   +2.589042315000170e-02   +5.571510975992425e-02   +5.096978356150615e-02   -3.558303021614195e-03   -1.813360943204321e-02   +4.853324155648098e-04   +3.766199596320873e-02   +1.361281946080313e-02   -1.160199265374161e-01   +3.066497868945030e-02   +8.726574137075427e-02];
L2E_L3E_iAMPA_netcon = [+5.116706886181052e-02   -1.058385093170980e-03   +4.657879351160969e-02   -5.070921949082770e-02   +1.420747538361047e-02   +9.162705626997307e-02   +8.050535625388397e-02   -5.516778982596768e-02; +1.513490986140366e-02   +8.207918852236828e-02   +4.441673857077844e-02   -1.274402379576901e-02   +1.494140550428366e-01   +7.856246055458795e-03   -4.689074795896368e-03   +3.033816440356282e-02; +8.131019241792679e-02   +9.428413186107085e-02   +7.714844474979619e-02   -4.603827838819333e-02   -4.581114826141632e-02   +1.066216282110780e-02   +3.538686749689748e-02   +6.376694305159757e-02; +2.108836123106194e-02   +3.434827677681256e-02   +9.642345263686297e-03   +6.875618463681812e-02   +3.000841069912615e-02   +1.364676314529660e-02   -7.778469704454161e-03   +1.501715333532680e-01; +6.075140689493193e-02   +3.410006181525134e-02   +3.715774213398783e-02   -2.190405558738778e-02   +9.881707471999612e-02   +6.591480340689451e-02   +6.720132110611382e-02   +1.120919715465720e-01; +1.088078516093218e-01   +7.318029568492279e-02   +1.093842561669313e-01   +5.032090159846395e-02   +1.030827502689707e-02   -2.510853009789182e-02   +5.638461915674178e-02   +1.259368756206411e-02; -5.189508593143991e-03   +6.097376068410758e-03   +2.794471737781519e-02   +1.624439610320799e-02   -2.485692719636493e-02   +5.962619913065445e-04   +1.436753233215731e-02   +7.611470762616740e-02; +7.152644397409394e-02   +4.627391859170394e-02   -9.822566884811883e-03   +4.313283715394552e-02   +2.244495788734892e-02   +2.328598769191152e-02   +3.490855600226178e-02   +5.005983847357071e-02; +1.174653519578076e-01   -4.215977057410066e-03   +4.338379529644040e-02   +4.560123861368183e-02   +5.843598250951146e-02   +7.421420146004480e-02   +1.300046749355356e-01   -6.213864729557501e-02; +4.197076488200931e-02   +6.396844536250901e-02   +3.011280537012924e-02   +1.223471679683841e-04   +1.085366864098492e-01   +3.548604642792403e-02   +2.761621455324242e-02   +8.063507478146030e-02; -6.373082455504862e-03   +4.401910939638976e-02   +1.802813789958202e-02   +1.624621066882996e-03   -7.335691684100006e-02   +8.563729530565223e-02   +8.829403477318742e-02   +1.312060617018505e-01; +8.192825903391385e-02   +3.159438288929672e-02   -4.167311161724905e-02   -2.867597363336419e-02   +3.215051024825812e-02   +1.293776062767865e-01   -9.495817955400096e-03   -2.602684894502183e-02];
L2I_L3I_iGABA_netcon = [+2.604191424688023e-02   +2.505035271809513e-02   +4.924395239666129e-02   +1.506356019909641e-01   +6.223890041423610e-02   -3.372205811038388e-02   -8.533179316509152e-03   +1.129846070772570e-02; +6.088249584033310e-02   +1.260435403710836e-01   +4.013486136973272e-02   +5.486382149115711e-02   +9.558911349870416e-02   +4.509184008597220e-02   -5.825425207392906e-02   +2.298029527294308e-02; +6.047354560917491e-02   +7.393976313017614e-02   -8.514319802425202e-02   -4.579286753736757e-02   +2.809464791310911e-02   +1.253141139274226e-01   +6.300687266936666e-02   +5.573942192367776e-02; -2.295058810282483e-02   +5.662134960982615e-02   +1.439625725886628e-01   +1.450352431906883e-01   -3.970274662422443e-02   +8.813233548160890e-02   +2.529820853039417e-02   +8.967188337318424e-02; -1.877052231587725e-02   +3.401474258867539e-02   -1.577784108444169e-02   -1.210247881069157e-02   +5.175410706164296e-02   +2.816076029179754e-02   -1.627548963240116e-02   +1.214317909658100e-02; -2.678168301651723e-03   +1.286640751391631e-01   +1.178808290034166e-01   +1.865853070849750e-04   +2.438902488802401e-02   +8.452191448862376e-02   -5.367100388574933e-02   +6.052314370992003e-02; -2.157705480342012e-02   +3.800417484728346e-02   +7.326958064466105e-02   +6.775876012060149e-02   +5.077576697972749e-02   +7.745077784401783e-02   +4.994126154920314e-03   +1.670564892535929e-02; +5.394012001391487e-02   +3.976641703116672e-02   +1.316086165008366e-03   +3.738339464743670e-02   +2.954567786785273e-02   +1.550116451962030e-02   -2.048137719023216e-02   +6.838130848592083e-04; +1.247686200400870e-01   -7.316653384743649e-02   +7.068466568255818e-02   +1.243281382966553e-03   +3.060243472428030e-02   +3.352223613271033e-02   -5.047923809197845e-02   +1.338965703735481e-01; +4.488734634682154e-02   +3.852709295401642e-02   +1.450910608010143e-01   +5.131265122586613e-02   +6.028293553351426e-02   +1.211593596731158e-01   +1.037787455963908e-01   +5.465901402379508e-02; +6.060415372096553e-02   -7.642232251743741e-02   +8.631193937100826e-02   +8.559688931746687e-02   +2.090200808249008e-02   -3.305744442398628e-02   -1.105431976717572e-02   +6.835759620998159e-03; +9.538157897226569e-02   +2.233802850010120e-02   -4.046424007472765e-03   +2.140157809628910e-02   -1.518957792468909e-02   +2.173912041010185e-02   +1.175893507383795e-01   +1.161439457980900e-01];
L3I_L3E_iAMPA_netcon = [+3.670719408125116e-02   +7.419689964396360e-02   +3.778325242852053e-02   -3.726330816672126e-02   +6.191229725955275e-02   +9.704003315489394e-02   +1.213999986429312e-01   +1.015466446529646e-01   +5.463464002925712e-02   +5.756064730584580e-02   +1.544534299539392e-02   -4.489728234457020e-02; +2.499501957844305e-02   +2.003965215309256e-02   +5.094535284359428e-02   +5.868105827995247e-02   +6.730852296556904e-02   +2.054927879685762e-02   +2.417388419062755e-02   +6.752152196609855e-02   +3.278055821570976e-02   -2.416166498446830e-02   +7.098504752738173e-02   +8.946750199977272e-03; +6.097133816388420e-02   +1.045014982355248e-01   +1.202923492736074e-02   +3.130368395119736e-02   -4.996352260344561e-03   +9.207640438691013e-02   +1.185094229774598e-01   +1.027906441718341e-01   +9.183562208727911e-02   -3.973249724095704e-02   +4.858759102689072e-02   +1.570072429363787e-02; +2.317521794282934e-02   +7.400034555417451e-02   +7.436730958171912e-02   -4.589036604077930e-02   +1.654655569349972e-02   +9.253050405989910e-02   +8.396094743811675e-02   +9.333126984178107e-02   +5.939787321646961e-03   +2.653585629535511e-02   +5.908991200848156e-02   -6.800918891767121e-04; +3.905694295948420e-02   +3.886477178272816e-02   -1.113342865358722e-02   +4.179106540786251e-02   +8.818587956339588e-03   +7.081822642236682e-02   +1.138419476168047e-01   +9.687332231165310e-02   +7.413828371008578e-02   +1.609808321992977e-02   -2.205049859054847e-02   +4.390034919169717e-02; +6.938030560544528e-02   +5.188637099396123e-02   +7.521183127443050e-02   +1.045407484903834e-01   +1.004274955928912e-01   -2.528435097879665e-02   +2.303865393019345e-02   +4.906833981702549e-02   +1.772240586140685e-02   +7.815566791775784e-02   +5.586498329469970e-02   +4.090445190102881e-02; +8.461605616056833e-02   +4.357313612195621e-02   -1.391218605615356e-02   +1.303443661586713e-02   +8.902144584504523e-02   +3.978781001313709e-02   +7.139184170166324e-02   +3.935056443880713e-02   +4.689121719498868e-02   +2.892477960748926e-02   +7.662076803790413e-02   +1.113229566326191e-02; -5.934063640888377e-02   -3.061574369048808e-02   +1.021689836583244e-01   +6.337271623268979e-02   +3.978709651039201e-02   +1.240333701108259e-01   -5.023153280214321e-02   -9.019076757674054e-02   +1.363964732367474e-01   +6.077132963625186e-02   -2.044121437917501e-02   +1.242719180997899e-02; +8.886358284348271e-02   -3.535653259570393e-04   -6.667812659147959e-02   +4.337563238753489e-02   +1.456845517272893e-01   +1.642419947805364e-02   +1.037239873699188e-01   +1.054187827098186e-01   -6.631815944569333e-03   +9.804836254130121e-02   -8.969572194375877e-02   +1.114464982763147e-01; +4.472501015883371e-02   -5.056251736428249e-02   -2.295583951313632e-02   -4.388012370206158e-02   +2.034951584800433e-02   +5.133602286418428e-02   +8.032119114388345e-02   +3.619215449410004e-03   -4.344316123076799e-02   +6.228502730258115e-02   +3.816100973923471e-02   -2.555477174758510e-03; +9.506696949515639e-02   +1.061491377261500e-01   +1.484803804035631e-02   +8.060035466813092e-02   +1.763914253602679e-02   +4.034941532969450e-02   +1.159117433104401e-02   +9.161839499472824e-02   +5.215181665454212e-02   -4.376800462885230e-02   -4.319021901626024e-02   +6.279792648451138e-02; -7.308646468600336e-02   -4.205894604637742e-02   -3.765695164750277e-02   -9.821552683768130e-03   +3.436735295496741e-02   +1.018421870079023e-01   +7.648374730256875e-03   -2.026701975219806e-03   +4.711631996811227e-02   +5.224993654091544e-02   +3.568800141537364e-02   +7.449466427876320e-02];
L3E_L3I_iGABA_netcon = [+9.187754899578668e-02   -2.298265449883614e-02   +6.872910918929671e-02   +3.362005837693956e-02   +5.757423950383133e-03   +8.923082603341151e-02   -4.140763199574805e-02   +7.163906013610600e-03   +3.272789798191897e-02   +7.955484842111540e-02   +2.218939883624379e-02   +5.825934282799333e-02; +9.074857199806682e-02   +3.774433612063349e-03   -4.178230568264306e-02   +3.571714030411920e-03   +3.553498691907360e-02   +1.136902359597723e-01   +7.684034171169174e-02   +1.102643426103449e-01   +8.910724096831947e-02   +4.482726239936564e-02   +5.344938075820498e-02   +9.100168235924244e-02; +8.051677219899783e-02   +8.171163886542056e-02   +1.070335145579475e-01   +6.609100173910372e-02   +7.531675766789869e-02   -6.470201626943711e-02   -3.491108820513502e-02   +1.189334139473766e-01   +1.262217194901777e-01   +9.402345161573530e-02   -2.597530203279182e-02   +6.656724856955499e-03; +4.735640438785262e-02   +1.394685293803387e-01   +1.145536032290069e-01   +3.208418849528585e-02   +1.428455819322600e-01   +7.450207018430968e-02   +8.562109248453169e-02   +4.863161452494004e-02   +9.646433514561098e-03   -2.276607455289398e-02   +5.874026650163125e-02   +5.144188786995790e-02; -4.649926978457233e-02   +6.995696877581545e-02   +2.871403193035938e-02   -1.167735361081233e-02   +5.140315841543423e-02   +1.379351726676523e-01   -7.129956895516096e-02   -2.688209371913748e-02   +5.707590363402371e-02   +1.693222880756498e-02   +1.703804657189398e-01   -4.472900209335804e-03; +3.143550378904897e-02   -1.903726950819505e-02   +3.006358835228494e-02   +5.450408213787831e-02   +4.642464511235671e-02   +7.195021659416764e-02   -8.124578653867093e-03   +1.570328680306271e-01   -4.302128404428320e-03   -1.637109620291068e-02   +4.827579482021237e-02   -1.892034995701105e-02; +1.308031721114976e-01   +2.083920663054353e-02   +3.635020987492663e-02   +5.476071344295189e-03   +2.225357207170583e-02   +5.894033360712023e-02   +1.211125934165383e-01   +2.158563062994362e-02   -2.825464199230042e-02   +9.069638811911827e-02   +5.423483898630885e-02   +1.372191027012790e-01; +1.054949266846844e-01   +1.070155673310665e-02   -1.072465357083635e-03   +3.447499175674663e-02   +4.223605467381314e-02   +1.083270887993262e-01   -5.260130202389869e-03   +2.562974464591359e-02   +4.662420509299273e-02   +7.674121699584827e-02   +1.558204043033349e-01   -7.645433963949823e-03; -2.617136588447225e-02   +1.281434968420643e-01   -1.297423893229652e-02   +5.747399723037590e-02   +8.579970149853466e-03   +8.694405555852280e-02   -9.090519307114653e-02   -1.149059252960369e-02   +1.553432139984016e-02   +9.995385382607576e-02   +8.379408688140114e-02   +1.229305355074304e-02; +9.220617276558241e-02   +4.992367984647989e-02   +1.083997621868855e-01   +8.633291360098154e-03   +2.889671760193969e-02   +3.464457887681895e-02   +8.165572548244682e-02   +1.246054684283783e-01   +7.013413258891507e-02   +8.097100128889560e-02   +7.296588201813545e-03   +1.395258697764991e-01; +7.329788534609449e-02   +7.920914169854142e-02   +5.026596358215838e-02   +5.773452831943311e-02   +5.370747777618166e-02   +6.239641002439404e-02   -2.443519562797833e-02   +2.291736436080327e-03   -3.861898583040017e-02   -6.115116886836622e-02   +6.488699884770616e-02   -9.002006963112364e-03; +6.622794905837802e-03   +4.336614914070259e-02   +4.179119225993428e-02   +1.035590950442650e-01   +6.643296298103969e-02   +5.887015650479759e-02   +3.455060276307295e-02   +4.986512718760488e-02   +3.345254205761915e-02   +1.269404410664954e-01   -1.322692365113478e-02   -1.660469936206208e-03];
L2E_Input1_iAMPA_netcon = [+9.937068840386759e-02   +3.077285993563302e-03   +1.366543506406960e-02   +7.518768824003838e-02   +3.481545848380961e-02   +6.236339038219015e-02   -1.271132062473614e-02   +8.455211991324166e-02];
L2I_Input2_iAMPA_netcon = [+5.115361028146330e-02   +2.793441077550642e-02   +4.756486209917207e-02   -2.891092740167090e-02   +8.157752014188457e-02   +6.117787823569081e-02   +7.993529529603267e-02   +9.284960710348031e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
