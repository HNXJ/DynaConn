function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.111371383837725e-01   +5.474083157568027e-02   +2.923292680970292e-01   +1.831885372640547e-02   +1.042050137966063e-01   +3.716849473733760e-01   +2.500723120811736e-01   +2.230313710152448e-01   +2.392219842361558e-01   +4.669255115401364e-01   +2.619503666000702e-01   +4.206402955761478e-01   +2.159867567143488e-01   +1.796103372288278e-01   +3.778467219263825e-01   -1.104569588402936e-02; +2.201144569287929e-01   +2.609542193249181e-01   -3.662669870880386e-01   -1.443996259032322e-01   +3.719099065171302e-01   +4.782893448816168e-01   -3.226553206298730e-01   +1.079395142546955e-01   +2.412807852307969e-01   +1.977198116284364e-01   +4.590854423686319e-01   +5.700586181376214e-01   +6.646586888425966e-02   +4.776907603064381e-01   -2.528657751303242e-01   +3.223509881544440e-01; -2.900026005649240e-02   +2.700238616080997e-01   -2.896566885388641e-01   +3.154085626899297e-01   +5.167744113603401e-01   +1.504135790768700e-01   +1.914436055666173e-01   +4.984316643078168e-01   -3.672328487366637e-02   +4.610410647882031e-01   +6.152160019527882e-03   -4.112404925065622e-03   +2.716872773469595e-01   +2.885866085367457e-01   -8.070466107845872e-02   +5.159202576207517e-01; +3.746462727708203e-01   +1.471185788438962e-01   +3.546468982392219e-01   +6.658232673704575e-01   +4.148816436505706e-01   +6.093308644898323e-01   +6.586122989123327e-01   +8.723800324212868e-01   +7.384875252900341e-01   +1.831402104908029e-01   +1.825677518617212e-01   +2.259276925395008e-01   +7.157467508935637e-02   +3.548492136437440e-01   +2.710126157378798e-01   +6.445120902712679e-01; +3.128139854423844e-01   +3.948757670204702e-01   +2.463440729177295e-01   +6.313765460048310e-01   -1.271058705555903e-01   +5.311107554774027e-02   +1.569656080298312e-01   +1.000000000000000e+00   +3.690969601504983e-01   +1.874078483527066e-01   +9.519486402092446e-01   +1.146198732312490e-01   +6.751278232858297e-01   -1.654374914829891e-01   +7.027084894526750e-02   +5.942207352742969e-01; +1.570651282083896e-01   +5.562143656858894e-01   +4.945258376628222e-01   +7.272884693035921e-02   -7.821637690363503e-02   +2.711117472548116e-01   +2.121228414598993e-01   +2.594805995173859e-01   +2.714651016324467e-01   +4.030623759632577e-01   -2.642991807387642e-01   +3.916695725058495e-01   -9.903361304442779e-02   +5.231465766463174e-01   +2.870973977198028e-01   +8.758995715883678e-01; +4.183675416675152e-01   +3.379732649736191e-01   +1.459706839872764e-01   -3.024627392081400e-02   +1.784654263741498e-01   +6.159377642024223e-01   +4.572256046998765e-01   -7.156774548886460e-02   +1.794977406993531e-01   +8.657481903162549e-02   +3.478774333253752e-01   +5.143215917755382e-01   +2.491336204363749e-01   +5.286857063335373e-01   -1.321372383557207e-01   +3.195367596950606e-01; +2.021345021477757e-01   +3.499318354277584e-01   +5.556403622797136e-01   -1.185964978555777e-01   +3.937558903599276e-01   -2.234578720541370e-01   +3.605929268711623e-01   +2.022892219299976e-01   +1.948385400112373e-01   +5.178844727544449e-01   +2.934381861553660e-01   +2.363331052295761e-01   +2.014017848574747e-01   +1.922933016515204e-01   +4.338020517349287e-02   +3.469401087206244e-01; +1.798045020003990e-01   +5.389261218149352e-01   -9.011232622364843e-02   +6.272255611314498e-02   +6.706743255282541e-01   +1.805237040207627e-01   +4.300426370717865e-01   +2.683922636694908e-01   +3.272018055146888e-02   +4.585275767272678e-01   +4.458213951476234e-01   +3.494090836647127e-02   +1.669848828266780e-01   +1.169009535461350e-01   +1.801090944731071e-01   -5.390814577794739e-02; +1.848877956860838e-01   +3.553623762491094e-01   +3.361207666209326e-01   +4.379778131524813e-01   +1.255918966133140e-01   +6.525025336040376e-01   +4.445784813504008e-01   -5.964016335568549e-02   -1.304097432404550e-01   +3.966850460543435e-01   +2.027213567195753e-02   +3.516024581847313e-01   +7.157352234043137e-01   +5.982790264899848e-01   +2.530306396756514e-01   +3.569822092799030e-01; +1.198172267342455e-01   -5.035647654866716e-02   +3.850681487624649e-01   +3.801057118818268e-01   +2.341296247080562e-01   +2.281662567561884e-01   +1.687633462540092e-01   +4.345471008400615e-01   +3.240509389569191e-01   -1.288303766752153e-01   -4.794622576624823e-01   +2.931610806162619e-01   +3.627654349296115e-01   +1.863674186426977e-01   +3.406373836183623e-01   +1.006940422385030e-01; +2.489937909039606e-01   +1.060698567161550e-01   +2.549629519268837e-01   +3.434103473114015e-02   +2.857460385209284e-01   +9.246476906103521e-02   +4.034790236322938e-01   -3.435105474348369e-01   -8.959532953640988e-02   +4.425224050490991e-01   +2.505757751432684e-02   -3.122100100074299e-01   +4.280377833974635e-01   +3.280084420797779e-01   +2.195454828894361e-01   +2.312141460332748e-01; -2.662367648535019e-01   +8.509761415178695e-02   +7.280232456335386e-01   +5.783286818859742e-01   +3.332424134544814e-01   +8.418197541507308e-01   +2.913145143574222e-01   +2.988361601220736e-01   -8.214184150653646e-02   +7.731088407185170e-03   +3.440477330494162e-01   +4.359586479114341e-01   +3.206726177107901e-01   +2.273018635720476e-01   +3.145305635516439e-01   +2.594378530105740e-01; +5.433775050665647e-01   +4.076150399870770e-01   +4.607165618701023e-01   +4.982287048149692e-01   +3.848734693961742e-01   +2.839822074943991e-01   +2.295534074076141e-01   +1.185122978654868e-01   +4.487027438716755e-01   -2.822649336235533e-01   +4.686081070892885e-01   +2.446914458968164e-01   +1.329290935820491e-01   +2.331267287003449e-02   -2.160709066119052e-01   +5.833184366999035e-02; -1.876149558955709e-01   +2.838621711206842e-01   +2.208350750474250e-02   +2.629719983183068e-01   +1.481585716041938e-01   +5.336020944462125e-01   -2.048117918684712e-01   +6.976582155611005e-02   -3.159965552341559e-01   +1.804097575449300e-02   +5.723770402612541e-01   +5.135831536911143e-01   +4.157119973994501e-01   +5.274884489137831e-01   +5.223612148853486e-01   +1.747964130444015e-01; +1.805510266712280e-01   +3.544842836770003e-01   +4.205067561240951e-02   +2.323993830324185e-01   +3.120218522820527e-01   +5.954445052085142e-02   -2.476368815353885e-01   -8.190541876766523e-02   +2.136983485426100e-01   +1.183747202571207e-01   +1.349664547016623e-01   +1.277667422156137e-01   +4.872929255779309e-01   -1.972058618080900e-01   +2.554150409011934e-01   -1.540873247555445e-01];
L1E_L1I_iGABA_netcon = [+4.337094491973460e-01   +5.051384114527020e-01   +6.314546979620090e-01   -1.315973761714918e-01   +1.818263929823173e-01   -1.921843050576975e-01   +4.944257050747409e-01   -4.183587608585507e-02   +5.406300713288645e-01   +6.748885945731018e-01   +4.939698949084851e-01   +3.821846960157942e-01   +4.523798084240571e-01   +8.673626209770344e-02   +4.318756199392068e-01   +1.025247466123769e-01; -2.272388116275736e-01   +3.243894520912146e-01   +2.181013452437583e-01   +1.769222739354596e-01   +2.603897790513091e-01   +1.064079500599619e-01   +2.421853488903636e-01   -1.316017077083378e-01   +6.353062648975291e-01   +3.518851794087481e-01   +2.480126731210316e-01   -5.562685250455224e-02   +3.850755869189590e-01   +1.713677848564761e-05   +3.439366292604131e-01   +1.181658860589123e-01; +6.387895511090046e-01   +1.866884989730357e-01   +4.086671991181637e-01   -2.353507289279048e-02   +5.411772891932102e-01   +6.378973648656472e-01   +4.895410606445312e-02   +2.273388634908508e-01   +3.819421558787459e-02   -6.034834062538807e-02   +7.127143746394872e-01   +5.947192630914806e-01   +3.933041930170799e-01   +3.153388668123198e-02   +4.024218318765927e-01   +5.793157031064630e-01; +7.520418450266579e-02   +7.481953504816649e-02   -6.500110525333415e-02   +7.001034613510024e-01   +3.782289603951304e-01   +7.613789292416867e-02   +6.125847619006293e-01   +1.775324339379441e-01   +6.459962312120557e-01   +5.932302564083846e-01   -1.054167440881926e-01   +1.055107520173539e-01   +7.366393340294466e-01   +6.753046706979653e-02   +4.355810089069169e-01   +3.684617958210159e-01; -2.014478609226915e-01   +1.568997972596809e-01   -1.158350054277687e-01   +7.446352832047019e-02   +3.348560655272127e-01   +5.759871655630591e-01   +5.501358668566846e-01   +4.514359419272064e-01   +2.802818277241718e-01   +7.463613934679528e-01   -7.293852177164696e-02   +3.663755974319622e-01   +4.739148731633966e-02   +3.264802569133312e-01   +3.832678477669230e-01   +8.107037026866327e-02; +4.711928140647900e-01   +1.105811245540178e-02   +3.878592579411209e-01   +1.452875508062651e-01   +3.110544828199220e-01   +4.303427652556774e-02   +5.098083808501596e-01   +2.104820947952217e-01   -1.038476990192307e-01   +2.271374491800714e-01   +3.575149531146162e-01   +2.010626241209555e-01   +3.765104589553775e-01   +2.377450614774868e-01   +3.827843817560230e-01   +3.983145775149448e-01; -4.157238286683038e-02   +2.659988667535511e-01   -3.751076981637682e-02   -2.446755657642398e-02   -6.458417208533054e-02   -4.684159142343316e-01   +6.602770062058805e-01   +4.217215287025819e-01   +1.046842974253111e-01   +6.427171357941927e-02   -1.912207814660744e-01   +1.364529871030415e-01   +1.648039101558740e-01   +1.564244029715359e-01   +3.559424480513200e-01   +3.068036284401997e-01; +1.669515197799532e-01   +6.730123744882882e-01   +5.389692034557468e-01   -4.793488117660351e-02   +1.637444240820529e-01   +5.033496433241084e-01   -2.616804572778081e-02   -2.642593386096698e-01   +2.514884510447810e-01   +1.611038390468343e-01   +4.737877901677619e-01   -4.063742310514646e-03   +1.758235106459082e-01   +4.398507963545036e-01   +2.010341120830753e-01   -1.792998746025490e-01; -2.797795377880665e-01   -3.243724258519109e-02   +3.415597152571251e-01   +2.803568388578179e-01   +6.474461536976258e-01   +1.076183491695744e-01   +1.829988177381865e-01   +3.353252600439846e-01   +1.655023569817324e-01   -9.839326765220372e-03   -1.099824955896363e-02   +3.687968823404232e-01   +2.376600981519946e-01   +7.862581501121745e-01   +2.208224462541505e-01   +2.035319433306929e-01; +2.714608169176171e-01   +1.000000000000000e+00   +4.647633974912802e-01   +3.324074885296472e-01   +1.128293704371106e-01   +5.296709760136309e-01   +1.354478747613100e-01   +7.508810674128252e-02   +1.740808663987803e-01   +3.611895289602802e-01   +5.262924792733661e-01   +5.069168125143910e-01   +2.861556812775318e-01   +3.375670182224974e-01   +3.496459914467808e-01   +5.956215526846877e-02; +1.961388570709686e-01   +9.474523355705653e-01   +4.748938169338071e-01   +3.789786932993565e-01   +4.406153986721709e-01   -1.543003373114387e-01   +8.143365880853513e-03   +5.310594920895899e-01   +4.789303588236700e-01   +1.874327925769834e-01   +3.466737772619456e-01   +3.474596403343624e-01   +2.203347953255160e-01   +3.231295365824814e-01   +1.545065891460037e-01   +6.533461844790460e-01; +6.807946660109229e-01   +3.926243415099422e-02   -1.283873444388375e-01   +2.731282786843080e-01   +7.060483211372248e-01   -4.532322838340925e-02   +9.739464871727367e-02   +3.944840818463473e-01   -6.974508691801589e-03   +1.355850414791156e-01   +2.585684305863765e-01   +5.644104195634613e-01   -4.223015169644024e-01   +2.541401143050734e-01   +2.299103122552727e-01   +6.813212525869117e-01; +4.352540357171882e-01   +6.485051062979805e-01   +4.520263544494658e-01   +9.989145576820047e-02   +2.160129576656883e-01   +9.691121938676960e-01   +1.894918661944710e-01   +1.372006625331491e-01   +4.177318990584683e-01   +3.688450263348869e-01   +5.649127811431286e-01   +1.216483745832821e-01   +2.924984686106501e-01   +1.957516386593125e-01   -1.113886899487202e-01   +2.509958090217051e-01; +3.778821190888168e-01   -6.756345907395229e-02   +6.431206351424610e-01   +6.406713702474259e-01   +5.880413089449636e-01   +6.311430203297144e-01   +5.831473509392677e-01   -1.819668608134811e-02   -8.516407843450043e-02   -2.675591145942093e-02   -8.968977147592214e-02   +4.076776603812600e-01   +4.421674008313275e-01   +2.437506325975979e-01   +2.825589968860939e-01   +2.830040305320685e-01; +3.570809596565526e-01   +7.669098300888209e-01   -1.540723924698171e-02   -8.723806328703623e-02   +4.790217085941111e-01   +8.272059119941319e-02   +1.547925333428477e-01   -2.636097083726839e-01   +4.408492493879088e-01   -1.358427722036743e-01   +2.091333908411432e-01   +3.295833137575911e-01   +4.649536769396033e-01   -2.418130232857418e-01   +2.913900518397744e-01   -4.089985946084388e-01; +6.138740825666449e-02   +4.486040202482898e-01   +5.955447491128516e-01   +2.177822984538160e-01   +2.595089029557668e-01   +4.070882634414425e-01   +1.257654425771117e-01   +4.932244345533864e-01   +5.125392547400681e-01   +1.758806393618969e-02   +4.721306621958781e-03   +3.890659144459061e-01   -3.116496674173535e-02   -4.491086602469438e-02   +1.468875440753139e-02   +1.512520951522326e-01];
L2I_L1I_iGABA_netcon = [+3.381764760990255e-02   +3.090184384794013e-01   +7.172760883682711e-01   +2.927760074144422e-01   +4.716371390537282e-01   +6.613569921651314e-01   +5.419528583144473e-01   +5.494221098319477e-01; -1.431506480649150e-01   +1.855014739375924e-01   +1.261700432741988e-01   +1.621286936077680e-01   +2.984067065379655e-01   -3.143025739536625e-01   +4.497225861330162e-01   -4.463974203896353e-02; +2.313497618828832e-01   +5.798320093402389e-01   +1.622023937915145e-01   +1.880113377245053e-01   +4.881575639706670e-01   -4.358669985780534e-01   +4.743646949556503e-01   +2.909692467922726e-01; +4.667344528829441e-01   +2.508172146004475e-01   +4.061281728371149e-02   +2.948031875271910e-01   +3.273537493188647e-02   -4.317561607986992e-01   +8.151206124065580e-02   -9.145483745588504e-02; +2.668461674390183e-01   +6.198583656040165e-01   +2.576811531461347e-01   +1.283131861654948e-01   +5.260938514102051e-01   +2.719788657611946e-01   +6.425062758452871e-01   +5.032712638745686e-01; +3.269507198635274e-01   +3.168573411971445e-01   +4.653876280899227e-01   +3.571739164477685e-01   +1.867749695654228e-01   +1.066509629526630e-01   +5.881676389108883e-01   -2.781733556461795e-02; -2.512985591734065e-02   +7.257740314172466e-01   +5.075121997602737e-01   +7.884659960445636e-01   -6.256939906933448e-02   +4.021798797221088e-02   -1.871491689241379e-01   +2.026128333271533e-01; +6.598997643696544e-01   +5.457300344675532e-01   +1.282648699831132e-01   +6.141464944103466e-01   +8.704972721567956e-02   +4.297965722384081e-01   +3.875657662373612e-01   +8.052394763077302e-02; +4.864904795588413e-01   +3.642391577651892e-01   +5.057030796489341e-01   +9.301928782727586e-02   +1.326924155489863e-01   +9.546668034348704e-01   +1.262545366471461e-01   +3.761401833103118e-01; +9.608920546514594e-01   +1.409246291159592e-01   -1.239057645940659e-01   +4.922157862574177e-01   +1.712973634871248e-01   -7.637259155129211e-02   +3.873726904966979e-02   +4.652735633887530e-01; +2.013818234381004e-01   +8.775155641543018e-01   +1.994320078490255e-01   +6.307112519946965e-01   +3.782781433017602e-01   -1.631927388216761e-01   +5.726924113639572e-01   +4.593064049756326e-01; +5.154074532234625e-01   +7.977066388789369e-01   -2.736000081616985e-01   -7.015486245935268e-02   +3.098972092002353e-02   +6.832107975003862e-02   +2.590033051567835e-01   +7.085976478363923e-02; +8.895541833645149e-01   +3.342881142886034e-01   +5.365048389489274e-01   +2.589930915904530e-02   +5.421764407609777e-01   +5.764545223082003e-02   +7.587983915597588e-01   -9.032991369142401e-02; +5.121354002321972e-01   +1.141635986609661e-01   +3.271475652279693e-01   +8.037107649061592e-02   +5.116706552528311e-01   +3.206609559414875e-01   -1.849034520855007e-01   +1.753016166272901e-01; -2.384558697824013e-02   +9.922244049294491e-01   +4.679243920266154e-01   +1.787910369641711e-01   +3.708118112349207e-01   +3.779045075908998e-01   +8.705428951844210e-02   +1.304044917111926e-01; +4.916162850233192e-02   +6.182900622522431e-01   +2.069873347826909e-01   +2.596946921136011e-01   +1.741428998000314e-01   +3.345288137080548e-01   -1.157228403136583e-01   +2.049377313149366e-02];
L1I_L2I_iGABA_netcon = [+3.713766980013871e-01   +4.153485455594175e-01   +1.966022317811406e-01   +5.679852827199052e-01   +6.683249310986372e-01   -8.186915784966325e-02   +6.471683216680534e-01   +2.110147945069814e-01   +7.088767130952991e-02   +4.208924801513184e-01   +1.282522350843746e-01   +1.910375903745232e-01   +6.134704801310161e-01   +2.960506626051994e-01   -2.124338960454054e-02   +2.517578062210165e-01; +8.129624691512084e-01   +1.897683685694420e-01   +7.170495828322568e-01   +8.192494627644149e-01   +3.018931211918127e-01   +8.897094107263738e-01   +1.717837753036270e-01   +8.791439202899769e-02   +4.298893350387711e-01   -9.439140356564057e-02   +1.861797574176649e-02   +1.000000000000000e+00   +5.387823800811515e-01   +5.490036248927023e-02   +5.159213631755838e-01   +4.537526695292800e-01; +5.960449873147317e-01   -4.756849364059637e-01   +6.702080366813004e-01   +4.115577684288358e-01   +5.242445552621525e-01   +3.968957899281720e-01   +4.098111839436303e-01   +3.919272601414487e-01   +4.887584728746078e-01   +3.479717781213835e-01   +4.098019413018087e-02   +2.947270353892869e-01   -3.408788528272766e-02   +4.966354310134998e-01   +4.666825840332097e-01   +3.097430004024150e-01; +1.259227614686663e-01   +4.860465684472894e-01   +3.095899170842127e-02   +1.922710540639716e-01   +2.459260334369445e-01   +3.691662740608846e-01   +9.295014708526760e-01   +4.560262526906114e-01   +5.898165561261791e-01   +2.192570484378541e-01   +3.086965788319340e-01   +4.903375145114182e-01   +4.029970153760390e-01   +2.869750667143184e-01   +8.722330408868640e-01   +3.922759990462756e-01; +1.479825413878407e-01   +7.908948414218809e-01   +2.516408083438086e-01   +9.830161553922089e-02   +3.344665060148730e-01   -2.626633379293817e-03   +2.243739912804822e-01   +2.119369139356990e-02   +5.867336544332683e-02   +2.448622184507819e-01   +4.209997276323536e-01   +5.247391712134265e-01   +1.316610818598678e-01   +1.001605486273903e-01   +4.987898874163660e-01   +7.068031278313534e-01; +6.383635860786726e-01   +2.427325630308270e-01   +6.279500909177599e-01   -1.418005861519477e-01   +3.185239906789448e-01   +1.118659502597169e-01   +8.831255103015628e-01   +1.597392225116769e-01   +4.637317941765485e-01   +7.464382548616981e-01   +6.985254686143633e-01   +2.696205310459340e-01   +4.150764237434342e-01   +2.033639227273528e-01   +3.007822201062200e-01   +4.158200270566776e-01; +7.125847460561255e-02   +5.150555147987319e-01   +4.452611933164591e-01   +5.579303232033267e-01   +3.710543842677144e-01   +7.891264544091474e-01   +6.924230171077780e-01   +1.400433499991231e-01   +3.687638986756993e-01   -1.871090719142276e-01   +8.194615016246536e-01   +2.190449822141056e-01   +5.241063200165480e-01   +3.597398363824174e-01   +6.685298305607063e-02   +4.382435709215046e-01; +6.438398791497719e-03   +7.437922881644881e-01   +5.067896582775466e-01   +6.109205908780917e-01   +3.990071300917222e-01   +3.069956093341007e-01   +5.442155404900885e-01   -2.574494082690498e-01   -3.831973870290210e-02   +1.906504270506655e-01   +2.265233692021133e-01   +4.822300898872651e-01   +3.360126246731727e-01   +6.107132545223912e-01   +2.282259129642664e-01   +1.790218624625079e-01];
L2E_L1E_iAMPA_netcon = [+1.813217464250274e-01   +4.148719569932094e-01   +3.299332548039731e-01   +2.972445837217768e-01   +1.313848849515743e-01   +9.872033823563812e-02   +2.061416840582469e-01   +4.661565423643999e-01; +2.827956946576682e-01   -5.344138730006084e-02   -1.871312055374800e-02   +2.021300104143168e-01   +3.185657745891816e-01   +8.258856712834049e-02   +2.619000445167747e-01   +2.270344288601798e-01; -4.564043997367393e-02   +1.711110040742458e-01   +4.113964700941944e-01   +1.000000000000000e+00   +3.918876585778115e-02   +2.656769730269858e-01   -6.244555458633111e-02   +4.138025301063764e-01; +4.311183075724029e-01   +2.096681583494635e-01   +1.703634257449736e-01   +3.438947709272379e-01   +4.968351510914361e-01   -3.738032401052083e-03   +2.872871576612031e-01   +3.466785945192458e-01; +4.647468285154938e-01   +4.886440154413972e-01   +3.682091390703394e-01   +4.374176131075362e-02   +1.264293904668892e-01   +4.160297641382961e-01   -4.761991990543749e-02   -2.027312479503065e-01; +4.487007856966259e-01   +5.227424010183491e-01   +4.081574577202591e-01   +4.771660521741994e-01   +4.931142894019967e-01   +1.811631787989451e-01   +5.300098999155101e-01   +7.477732838363852e-01; +8.893445115237746e-01   -3.029263882091407e-02   +1.549912271087316e-01   -1.281848131773694e-01   +9.002850342838242e-02   +2.207238530569418e-01   +5.408094652219115e-01   +5.852699608835683e-01; +6.674442130777964e-01   +2.649798988070400e-01   +3.077660086549132e-01   +6.161698555069133e-01   -3.886475220945484e-02   -1.303541278091002e-01   +3.779608100251876e-01   +9.901331291405874e-01; +2.733056586975263e-01   -8.268966126400333e-02   +2.187288812367816e-01   -1.994681299410633e-02   +4.394434258117601e-01   +4.162976565799369e-01   +4.656761754661847e-01   +1.538012464336074e-01; +2.567271595345889e-01   +4.056355933038998e-01   +3.101845263200668e-01   +5.541360815877786e-01   +4.087467927272926e-01   -6.249365145098650e-01   +5.111947585063500e-01   +4.504493478936391e-01; +2.427808389116671e-01   +3.425298474265786e-01   +4.523441021740430e-01   +4.760566817709538e-01   -1.134436617618453e-01   +2.133868764488555e-01   +5.912532499934016e-01   +1.997492639504471e-01; +3.650150743932566e-01   +2.348141029929202e-02   -5.347439944769032e-01   +6.859828247395298e-01   +3.787787711746282e-01   -5.387550508176189e-02   +3.762448686508253e-01   +3.610758282816035e-02; -7.569459090177061e-03   +2.130015928578274e-01   +4.032068240886127e-01   -1.499845475092814e-01   +2.958231828876661e-01   +2.120969903460833e-01   +1.090887008600115e-01   +3.270325582176353e-01; -3.199593052605230e-02   +5.082503705145761e-01   +6.786077513392678e-01   +3.364048718595905e-01   +1.401486808377091e-01   +4.073315632348690e-01   +9.114274223147105e-02   +1.844411938942648e-01; +1.364270893077513e-01   +1.122594883068562e-01   -4.881108401732003e-02   +5.048101782152384e-01   +2.474417107493413e-01   +4.190407843342540e-01   +2.084327227334390e-01   +5.352097146697109e-01; +8.422779871275515e-02   +2.390406704905403e-01   +3.210111812454242e-01   +2.463365779955067e-01   +1.892620258593613e-01   +3.570467265094013e-01   -1.379085060527695e-01   +3.352443249402922e-01];
L1E_L2E_iAMPA_netcon = [+4.315908144967769e-01   +7.082784652725775e-01   -1.439219658476871e-01   +4.351427155029510e-01   -4.504838251012089e-01   -1.330237233233706e-02   -1.095564802194592e-01   +7.737285337817488e-01   +7.174773932939508e-01   +3.120864236521387e-01   +4.512360577229660e-01   +8.060531688584620e-01   +5.934177922041057e-01   +2.028765555750935e-01   +1.308319722707876e-01   +7.550373334051335e-01; +2.981336307688737e-01   +4.761185785170088e-01   +4.751703413509950e-01   +4.992924314738829e-01   +1.803712032666567e-01   +1.771232124131967e-01   +5.032496802781617e-01   -9.627623062508622e-02   +1.661261930861209e-01   +6.683481038262129e-01   +5.349297961564395e-01   +2.499476903165565e-02   +6.352384916655134e-01   +6.279866636535308e-02   +1.219568020915391e-01   -2.024387243654338e-02; +1.586649402514991e-01   +5.719611488178675e-01   +3.747811827314582e-01   +3.669094463717252e-01   -4.492418326909622e-03   +1.397415785910711e-02   +2.474714563275945e-01   +2.501779139428011e-01   +4.696243306786182e-01   -6.083287609498849e-02   +6.678659040479140e-01   +7.626575668529065e-01   +3.722375552185291e-01   +6.520212738621350e-01   +5.196728722064723e-01   +5.007245346615105e-01; -4.155631668279761e-02   +4.223748175021808e-01   +6.911952223280367e-02   +3.719133127278397e-01   +3.917781245636643e-01   +8.169567121970889e-01   +1.740319574454445e-01   +3.857534393055774e-02   +2.525020075763854e-01   +2.631157059710358e-01   +3.422563114749532e-01   +1.391151992000840e-01   +2.019801098023027e-01   +3.004276117588203e-01   -1.933638705655790e-01   +2.593082381652960e-01; +2.105034398552336e-01   +7.671631174684312e-01   +4.818344131827182e-01   -1.691184190410260e-02   +2.962624963289103e-01   +7.751015107993977e-01   +1.896607258243609e-01   -4.577730220004912e-02   +4.307156295735615e-01   +3.910323101867246e-01   +8.172861805314844e-01   -2.111348396449629e-01   +5.066686515145806e-01   +5.382782627648118e-01   +1.653130662857904e-01   +1.771695077334672e-01; +4.750520104314204e-01   +7.772356049167647e-02   +5.354804026111134e-01   +6.393942873455297e-01   +3.208364438480056e-01   +2.520926006169675e-01   +5.089399919971251e-01   +3.229618921957985e-01   +3.916962009243350e-01   +4.260309770223994e-01   -2.219657907555102e-01   +3.653152161857504e-01   +2.715832943181077e-01   +4.832987306456568e-02   +6.016951680176161e-01   +7.283721863991991e-01; +7.406785627911129e-01   +8.036763269319276e-02   +1.329230316480587e-01   +2.494640208952837e-01   +4.147898863825432e-01   +1.723103929823625e-01   +7.119080747805676e-01   +5.361695840005314e-01   +3.053658120255280e-01   +2.723405702014935e-01   +4.613909055457309e-01   +3.406387809668046e-01   +7.028168006088062e-02   +2.420677696896764e-01   +2.632696508024935e-01   +2.740517368917371e-01; +5.156258972930371e-01   +3.522643844715888e-01   +4.534260110090854e-01   +6.660375849413228e-02   +7.039228367365461e-01   +4.788971930911051e-01   +2.908139362516571e-01   +2.234925668739080e-01   +4.658166024864097e-01   +3.764188618892762e-01   +9.690914200542006e-02   +2.912613599970425e-01   +1.959495457520116e-02   -3.622447101023273e-01   +1.382804898528049e-01   +8.959339059034541e-02];
L2I_L2E_iAMPA_netcon = [+2.641103815401220e-01   +7.860279342344538e-01   +4.755232725400915e-01   +5.657698410909872e-01   +2.840678421107999e-01   -1.348528153646958e-01   +6.328204046691198e-01   +4.578855639094868e-01; +6.457010838439677e-01   +5.468091563823375e-01   +6.763319012664464e-02   -1.285296949896001e-01   +1.596880766985007e-01   +4.105321381454162e-02   +4.274175289480987e-01   +1.842399916103381e-03; +3.048254541787745e-01   +5.922811697016266e-01   +6.556343637101004e-01   -7.136548092938211e-02   +8.000451919324982e-02   +3.684208686906830e-01   +2.210140630175222e-01   +1.632737048371792e-01; +4.225652677148922e-01   +6.779287392470013e-01   +2.419453005331177e-01   -1.081342598569008e-01   +5.794995354036026e-01   +8.396728498439108e-01   +4.428589347741640e-01   +7.516716672591781e-01; +1.000000000000000e+00   +1.314971205339161e-01   +1.545215988089137e-01   -1.661317744518034e-01   +1.888314684394303e-01   +6.275267935676950e-01   +4.968386489906133e-01   +1.677371089581532e-01; -1.263286364208133e-01   +6.715361380479748e-02   +4.858535320730274e-02   +2.645497748665987e-01   +3.088303312528438e-01   +6.584854594600453e-01   +5.065517077180915e-01   -3.011969714268883e-02; +5.523737506233435e-01   +1.257850904061150e-01   +2.715959200008631e-01   +6.500759943163641e-02   +2.652084526497349e-01   +1.013600961678269e-01   +2.923820800408190e-01   +4.475067927028907e-01; +3.322519946395474e-01   +1.148358257547317e-01   +3.415434045797512e-01   -1.424048194750886e-01   +6.049335291450753e-01   +2.884645425341066e-01   +3.008853125556763e-01   +3.721396686476341e-02];
L2E_L2I_iGABA_netcon = [+9.583015543475674e-01   +4.358142037149766e-01   +5.176740073048310e-01   +4.513458499718025e-01   +1.496891321581262e-01   +1.611337824581179e-01   +4.005464631289355e-01   -1.839809211746795e-02; +3.643464466890660e-01   +5.544605522056735e-01   +8.720263039497466e-01   +1.000000000000000e+00   +7.594821021739823e-02   +2.150102104527296e-01   +1.521383073500731e-01   +5.690005502270652e-01; +2.610615760358757e-01   +5.274409777197532e-01   +6.941609584509864e-01   +6.006541265768729e-01   +6.026240548893865e-01   -3.076076944229963e-01   +4.256446784600959e-01   +6.006411907085453e-02; +2.819503336026988e-01   +2.473674536589962e-01   +6.448145658842458e-01   +3.865595167775083e-01   +2.552964769920658e-01   +2.288950915649844e-01   +4.211925169597514e-01   -4.555716882849338e-01; +4.764521314226226e-01   +6.572487128256822e-01   +2.281489438001340e-01   +4.135051828708719e-01   +8.131829201870344e-02   -1.265574462632074e-02   +7.605858064137179e-01   +8.317107899107304e-02; +2.516105754714007e-01   -8.395665564466075e-03   -2.285041047230573e-01   +1.256135271247189e-01   +4.089154572943922e-01   +3.760736420799642e-01   +3.964027373900523e-01   +5.804363593223336e-02; +3.412548364317886e-01   +4.629402033053605e-01   -2.261646246007787e-01   +2.394071264392144e-01   +4.074937311731676e-01   +6.071667622814882e-01   +4.632532143524836e-01   +5.973828262219362e-01; +3.730352207779367e-01   +2.414321702007403e-01   +5.662468638893017e-01   +2.157553726471695e-01   +3.162433743384402e-01   -1.091989268218410e-01   -3.981192049393484e-02   +7.579854071763058e-02];
L3E_L2E_iAMPA_netcon = [-1.101697237080719e-01   +1.063637149424880e-01   +3.926495638229862e-01   +3.569349639495965e-01   +6.837209143196435e-01   +2.900857343681149e-01   +5.956225764554119e-01   +6.920424622507146e-01   +3.673758305369703e-01   +8.449747209952267e-01   +6.219459094983003e-01   +5.248273104261827e-01; +2.619657965714510e-01   +1.735369546927757e-01   +6.115440524620490e-01   +3.873155957890541e-01   +1.193266231827756e-01   +4.652904213505671e-01   -1.201017414064520e-02   +5.886643797151947e-01   +3.929590936084678e-01   +3.530147077532418e-01   +3.905094747366449e-01   -2.429182122559334e-01; -3.455879882193620e-01   -4.144688335340152e-03   -9.539792663717445e-02   +2.425618646693225e-01   -4.255377945454019e-01   +9.392084981528202e-02   +1.086793503068974e-01   +3.461507383030629e-01   -2.183018137146649e-01   +1.995489177152373e-01   -2.226918025371701e-01   +5.171952156233506e-04; +4.223936564843254e-01   +4.687710457901550e-02   -1.057608961061267e-01   +3.842432825073234e-01   +3.943862897755763e-01   +1.425171356999096e-01   +1.019277238940684e-01   +7.851106533865622e-02   +4.756892800724072e-01   +1.533002494284392e-01   +4.006406043350613e-01   +8.727827850384025e-01; +3.878358808975826e-01   -1.644268344093246e-02   +4.283268772708997e-01   +4.677737883030393e-01   +3.785770237601871e-01   +6.370092505283166e-01   +6.087960558186221e-01   +5.028788712057860e-01   +1.274218315867572e-01   +2.149844569368087e-01   +2.018455759039921e-01   +3.451895429411793e-01; +7.309338691137576e-01   +1.730042917474081e-01   -1.344858026649062e-01   +3.088268316331595e-01   +1.394513450709667e-01   +4.244220979753427e-01   +7.470295786944267e-01   +4.500490907823190e-01   +1.746451102251557e-01   +9.626976621695904e-01   +4.417462520172770e-01   +2.754388802315557e-01; -4.585474329428883e-02   +3.531668778125940e-01   +1.882851019785013e-01   -7.456228718791884e-02   +9.434054827630677e-01   -2.439336698364087e-01   +1.392043951097242e-01   +5.235146689170205e-01   +2.627309644272323e-02   +3.779366733615728e-01   +6.666461139743608e-01   +9.671125629889996e-01; +5.263853566787087e-01   +3.984672847588938e-01   +3.488771258095805e-01   +1.552355157328465e-01   +5.141014263794920e-01   -3.795378219484684e-01   +6.677985808737000e-01   -9.002164193841186e-02   -2.337107281783349e-02   +1.720354590542523e-01   +4.171937363747866e-01   +1.916134272295605e-01];
L3I_L2I_iGABA_netcon = [+3.887898611159743e-01   +5.193667632084208e-01   +2.993988837084677e-01   +2.048676661901591e-01   -4.157512356621867e-02   +2.791670912116356e-01   +3.388250543694944e-01   +1.510622842153821e-02   -1.466353115184302e-01   +3.798166182017316e-01   +2.808493673594276e-01   +5.826346503772009e-01; +2.869039167858414e-01   -2.624260137520311e-01   -1.265329346024322e-01   +6.338990902569228e-01   -2.713479855061099e-02   +7.156064617815741e-01   +7.260013820847505e-02   +9.048712153432861e-02   +6.915610913943897e-01   +1.820499394914463e-01   +7.753830538460574e-01   +1.015553879757651e-01; +2.556924674012051e-01   +7.669963273103249e-01   +7.826571858255731e-01   +4.973867204459899e-01   +3.730326112342068e-02   +6.408679438093958e-01   +2.285784895260514e-02   +4.603888662255691e-01   +5.396376723208995e-01   +3.878774709117231e-01   +4.727888901836019e-01   +2.143151906413645e-01; -8.222369481234831e-02   -3.982119297353050e-02   +7.616603378887139e-01   +4.096621369383935e-01   +3.356623948180983e-01   +5.495494627454401e-01   +8.887914816208176e-02   +1.587305361291666e-01   -2.486278440097381e-01   +9.695415015049685e-02   +1.941837322603534e-01   +3.029223380477506e-01; -6.518130098264709e-02   +2.574226692016017e-01   -1.177185668893079e-01   -1.209670655205335e-02   +6.550763279824492e-02   +4.167915268844630e-01   -4.906539240893301e-02   +3.067982767734829e-01   +3.831582917652678e-01   +3.310205491292550e-01   +5.190622387846133e-01   +4.303014243930825e-01; +1.939236084251895e-01   +5.464494341809343e-01   -3.332225394993689e-02   +6.659518152096970e-01   -6.229600319034731e-02   +1.887124039417544e-01   -3.574914012122385e-02   +9.114528830204213e-02   -3.797768641677595e-01   +5.361303070947290e-01   +7.497042253160243e-01   +4.499140791968983e-01; +5.506476477603187e-01   +6.780452490760655e-02   +3.832345242013569e-01   +5.658557250546303e-01   +3.168806374070630e-01   +2.561906395079637e-01   +2.943967158764516e-01   +1.370563886854594e-01   +2.688018922177723e-01   +6.216074740695176e-01   +1.222722315953906e-01   +4.148993929801829e-01; +2.536578624997508e-01   +6.844925899675579e-01   +4.588960466366299e-01   +6.733143530085023e-02   +5.627893697439150e-01   -2.752876865299830e-01   +9.462280983016000e-01   +3.712737790597906e-01   +6.029818018805416e-01   +2.774426420383815e-01   +3.112499518729732e-01   +2.483824087332354e-01];
L2E_L3E_iAMPA_netcon = [-1.205441765707039e-01   +2.059273088147680e-01   -1.131289666907933e-01   +4.960112217637728e-01   +2.715404203126458e-01   +3.423816575459105e-01   +4.255859976705707e-02   -2.477874774246663e-01; +4.347297652101433e-01   +3.142593972590267e-01   -1.108413947350925e-01   +4.858123961312437e-01   +2.127211229237023e-02   +2.178025385983625e-01   +2.942996739214180e-01   +4.993825494828795e-01; +5.079095706023354e-01   +1.215290031958983e-01   +2.055224598984774e-01   +2.748841063963720e-01   +5.896917498894706e-01   +2.098821723399808e-01   +1.969797948140226e-01   +4.341454226499373e-01; +3.390601702984697e-01   +5.671126499548029e-01   +4.179246391700117e-01   +2.167784106275971e-01   +6.441425168132584e-01   +5.200298540357083e-01   -1.585105734143625e-01   +3.044779809627098e-01; -1.262548389224770e-02   +1.469955699306223e-02   +4.386942326741665e-01   +4.274634864295528e-01   +2.574594548333118e-01   -4.462338346828120e-02   +6.847515400022807e-01   -8.559935587207088e-02; +6.886813499896737e-01   +7.093443166909802e-01   -4.653284837464840e-02   +6.972663990314962e-01   +1.085549222081517e-01   +3.160246168412426e-01   +2.584114137653346e-01   +8.071354417452639e-01; -1.455238475649132e-01   +1.511728890898377e-01   +4.073979205202222e-01   +5.396388923674362e-01   +4.429260968732134e-02   +9.366452535137804e-02   +8.662560094977736e-01   +3.627611666025326e-01; +1.260924088449271e-01   +5.626915926816882e-01   +5.561429056794173e-02   +1.056315509572031e-01   +8.641937806074261e-02   +5.454643696128918e-01   +2.617745724049930e-01   +6.244635524532305e-02; +4.505990842700343e-01   +7.019944825305495e-01   +3.602063776089096e-01   +5.702899390374278e-01   -8.852761359051570e-02   +2.298617210685752e-01   +5.034309724469519e-01   +9.577965330398822e-01; +4.766316471731982e-01   +1.062891972250983e-01   +5.169664483961260e-01   +7.080700544465790e-01   +4.588085773719622e-01   +2.453355484494042e-02   +5.220105135649330e-01   -5.926345841537929e-01; +1.535870361371955e-01   +4.140716036536419e-01   +1.022492093716727e-01   -1.722863274048143e-02   +3.794934432897767e-01   -7.050353884279959e-03   +2.332811320886473e-01   +9.831925668330076e-01; +3.325088117943299e-01   +2.609943249103120e-01   +3.870131770230807e-01   +2.783332945766581e-01   +5.137682052005860e-01   +2.388773664147800e-01   -4.355267895070092e-02   +3.391570586278367e-01];
L2I_L3I_iGABA_netcon = [+2.041643915256940e-01   +3.344660650504152e-01   -1.643863988692341e-01   +9.398209576759139e-01   +5.607740925988855e-03   +3.704181335298873e-03   +1.434085220866120e-01   +2.101052905285822e-01; +4.656162468060333e-01   +1.597315746195824e-01   +1.286912641102533e-01   +3.219613447443198e-01   +1.792435790097202e-01   +1.586782629822300e-01   +8.937559013179726e-01   +1.379628300716115e-01; +1.193058622374387e-01   +3.305391113786109e-01   -1.153877005764017e-01   +4.478183000964695e-01   +2.636932434498614e-01   +1.313865013918891e-01   +8.007686294060244e-02   +4.770809805792435e-01; +2.822289639186554e-02   -3.794808492763765e-01   +2.395036333774990e-01   +3.815397875696487e-01   +4.852819021682852e-01   +1.333881992749591e-01   +6.077015080742773e-01   +2.242804216512989e-01; +6.444888984979824e-02   +3.781404441970063e-01   +2.010549680711150e-01   +2.480777911096390e-01   +4.297822271608094e-01   +2.568372469333429e-01   +4.775780091987847e-01   +7.051324954297645e-01; +8.351516764812980e-02   +2.600930733235117e-01   -8.881015607160303e-02   +6.633333083632141e-01   +2.257586840238003e-01   +5.719949883591998e-01   +2.136231073186083e-01   +1.523341319866529e-01; +3.596338512408200e-01   +1.550463239193871e-01   +3.145597034497860e-02   +5.193103865217140e-01   +4.270982895776024e-01   -1.333143680130354e-01   +3.405846602306356e-02   +1.523541974536712e-01; +3.955223132216169e-01   +6.563142845366539e-01   +9.340002175316660e-01   +2.952730095391138e-01   +2.088538895684299e-01   +6.152157864415454e-01   +2.494852154738445e-01   -8.067368081420259e-02; +3.986767907296559e-02   +1.730348893643692e-01   +3.162405649351706e-01   +4.787660602670641e-01   +1.724825567920950e-01   +5.425787327343805e-01   +3.332511511226539e-01   +6.978095609035798e-02; +5.974717798606913e-01   -1.498510091914491e-01   +2.755243178948753e-01   +4.234863964808421e-01   +6.563594226235178e-01   +2.817253489869070e-02   +2.892302264915139e-01   +1.443608308861903e-01; +4.104626727273858e-01   +8.447505078089383e-01   +1.828037374149632e-01   +4.260691117778628e-01   +8.474284524905629e-02   +3.152910885995371e-01   +4.380140027324926e-01   +1.481720814654865e-01; -2.010080154296361e-01   +1.312845006603230e-01   +1.110555048014526e-03   +2.551529433695642e-02   +8.505793467385658e-01   +1.955127691804205e-01   +4.692148086457175e-01   -1.075016548899010e-02];
L3I_L3E_iAMPA_netcon = [+9.949788059767467e-02   +6.050970893540186e-01   -2.044061419151522e-01   +6.178539557781567e-01   +5.823142790147972e-01   +2.368527052426912e-01   +1.913823560835680e-01   +3.871690531090146e-01   +2.026843522444615e-01   +2.048717718781614e-01   +2.141356047760237e-01   +4.603221762541574e-01; +4.553681191643797e-01   +6.711896614373783e-01   +4.388441238719196e-01   +7.633739527168648e-02   -3.779780597607411e-02   +4.298253551528858e-01   +4.100337479147908e-01   +7.576274059415192e-01   +1.077844454592414e-01   +7.172070018078353e-01   +4.188984201458142e-01   +4.656142227974565e-01; +2.433052536173513e-01   +5.599302466996363e-01   +2.299769490179988e-01   -1.705645015596718e-01   +8.753856444636258e-01   +4.390014149730880e-01   +7.234103171208260e-02   +4.895731067350589e-01   +3.735606399549009e-01   +1.669146480213704e-02   +5.083647598559595e-01   +3.305087807408618e-01; +9.169600053305853e-01   +4.572038798310334e-01   +2.998144474855167e-01   +8.415650365740659e-01   +5.814810331880204e-01   +4.837515941078822e-01   +6.519307207574936e-01   +2.864847271575677e-01   -2.840845987751077e-03   +3.227118165379776e-01   +2.207880974063385e-01   +6.151870849457745e-01; +4.747139212453362e-02   +3.213513255633001e-01   +3.134582399878564e-01   -3.806276502143673e-02   +5.944443288640630e-01   +9.175835737263111e-01   -1.074751149777899e-01   +7.355243717281936e-01   +1.000000000000000e+00   +1.651539753013332e-01   +7.071919416862650e-01   -1.810394371762181e-01; -4.465384672172769e-02   +6.187149075504320e-01   +2.991895057156476e-01   +3.243634357265138e-01   +1.855390654667765e-01   -7.176505928006204e-02   +3.352552085748066e-01   +7.105450741973232e-02   +4.234546968715239e-01   +2.171244130740353e-01   +5.400694213500955e-01   +3.132646317875263e-01; +1.839605149881206e-01   -1.060145623116820e-01   -5.120798374081482e-03   +1.474109150668156e-01   +4.827010234993083e-01   +4.262553369451400e-01   +5.036364611608125e-01   +4.417090871097211e-01   +1.212852847837713e-01   +7.503879329103819e-01   -1.021243615776990e-01   +2.256343674378430e-01; +2.932636864657431e-01   -1.970335545763308e-01   +5.774780116940350e-01   -7.464532010579152e-02   +4.165365686015683e-01   -2.257361392809545e-01   +2.358551995371637e-01   +1.934499752115734e-01   +1.492966938088130e-01   +6.286262886908259e-01   +3.572012226132233e-01   +1.836452634871821e-01; -2.736924752813199e-02   +3.452093786212736e-01   +4.577168298459347e-01   +8.750399985213209e-03   +1.758551625878454e-01   +3.368301254216083e-01   +3.149123590214777e-01   +3.404535231288160e-01   +4.956127724711228e-01   -6.470867658317954e-02   +4.024560980546928e-01   +2.454551998863194e-01; +3.791254154852607e-01   +7.202476328697098e-01   +2.073285604528536e-01   +5.660314800758071e-01   -2.571398577908323e-01   +5.130728243969639e-01   +4.952588384090740e-01   +7.809341931466324e-01   +5.667337306359604e-01   -4.608999385596151e-01   +6.368917890328133e-01   +5.377068602480425e-01; -2.812619444915609e-01   +3.719232913287612e-04   +2.320717368755512e-01   +5.325935819224417e-01   -2.343937348967753e-01   -4.820770073964237e-02   +8.732749526254295e-03   +4.755102028760181e-01   +7.783676974830870e-01   +4.557200171290108e-01   +1.195726126657155e-01   +5.853491932938695e-01; +1.389004769121732e-01   +5.040805113271029e-01   +1.966720237470801e-02   +6.641592750147438e-01   +7.819623622625843e-01   +1.290218945055214e-01   +1.886618179205051e-01   +5.229256491525432e-01   +6.356794274412733e-01   +3.665904031859161e-01   +9.868011359758602e-02   -7.609841558651005e-02];
L3E_L3I_iGABA_netcon = [+6.737863079670086e-01   +1.584644341346775e-01   -4.760000120850758e-03   +4.730044737298409e-01   +3.668905900414980e-01   +7.396021064924695e-01   +7.185363617160873e-01   +8.260539141426129e-01   +4.983634468370186e-01   +8.838096558893872e-02   +2.905415977557632e-01   +3.437727945238988e-01; +5.354965767059896e-01   +1.025309974493733e-01   +7.698826457484765e-01   -9.791528008473198e-02   +6.734826938116886e-01   +6.704997458317458e-01   +1.000000000000000e+00   +1.938634692139476e-01   -2.143229475128752e-02   +3.229819946487193e-02   +1.256266929069473e-02   +3.877104142609560e-01; +1.017156137832580e-01   -8.431931239913075e-02   -3.578411216029744e-01   +7.990833818789571e-01   -1.147011001189947e-01   +4.515780100810798e-01   +1.696898579021417e-01   +6.131853395224037e-01   +4.246664784651422e-01   +5.386857670511351e-01   +3.555876395499764e-01   +1.992049483306434e-01; +1.151367395862046e-01   +5.880683979809371e-01   +3.494835176698726e-01   +3.063881728401476e-01   +4.513696767934295e-01   +4.101782939687454e-02   +2.502050791382424e-01   +5.468389047593852e-01   +3.650620464212606e-01   -7.844775165023311e-02   +8.762413396418119e-01   +1.748637338309413e-01; -3.889813978413558e-02   -3.042000360985889e-01   +2.371497602998255e-01   +4.880681215136193e-01   +2.926809075007026e-01   +6.235257747129162e-02   +5.634577799647689e-01   +3.726482364962277e-01   +2.394986941495131e-01   +7.836264488866444e-02   +6.297163110377563e-01   +1.627746802472337e-01; -1.803697043551336e-01   +1.166451891600182e-01   +4.747308391127303e-01   +3.128832804945227e-01   +5.685593934084467e-01   +3.569239010650632e-02   +1.030680634337635e-01   +2.329886814411284e-01   +3.733975126910558e-01   +1.170935552199647e-01   +2.593581498068483e-01   -1.600879682306529e-01; +6.240848871298627e-01   +3.956925699761585e-01   +2.768707855026906e-01   -3.206089613502502e-02   +4.065274284556256e-01   +5.061317313621533e-01   -1.597061732414859e-01   +7.046774232703513e-01   +4.154681453782974e-01   +1.937080093002482e-01   +4.390633975151914e-01   +2.243916701099059e-01; +8.713378528971896e-02   -1.223389132342307e-01   +2.331861713717002e-01   +6.154719210291556e-01   +6.473412613074848e-01   +1.928562388747242e-01   +3.312019480773962e-01   +8.795368790275125e-02   +2.328356463995690e-01   +5.209852310136664e-02   +3.773947060985778e-01   +8.789815367160669e-01; +2.334205933106498e-01   +2.269940716327262e-01   +2.910640440431391e-01   +6.576257463784625e-01   +5.946923013884569e-01   -4.072574051610006e-01   +4.695446312665065e-01   +5.101755512336911e-01   +1.634996521768523e-01   +4.409231276037452e-02   +4.322306106236295e-01   +8.292249521727254e-01; +2.809721051673713e-01   +8.381817854993725e-01   +8.016378852939484e-01   +8.624825183956475e-01   +1.898388985087682e-01   +3.330871255760179e-01   +7.940085461288310e-01   -1.723224811902339e-01   +6.334831912328222e-01   +4.531751678379880e-01   +1.967286519524630e-01   +9.497072682491590e-02; +5.278147288671401e-01   +4.165708820390601e-01   +1.176681270476885e-01   +8.733448093925816e-01   +6.410816450216815e-01   +3.535631231488099e-01   +6.129181276601972e-01   +7.810798037956732e-01   +7.658120807300741e-01   +1.592360910484922e-01   +2.282457214430251e-01   +7.499702216374091e-01; +6.641361093487952e-01   +1.374332737972735e-01   +2.155201405680748e-01   +5.207832147657904e-01   +4.610083656972934e-01   +5.215828274858531e-01   +6.063590786578498e-01   +1.512093430472948e-01   +1.296845946817474e-01   +8.237871837018167e-02   -8.320045176865470e-02   +5.483892145701403e-01];
L2E_Input1_iAMPA_netcon = [+4.923501637081154e-01   +8.222472562862263e-01   +7.696543184629607e-01   +9.087310928398763e-01   +1.000000000000000e+00   +7.248055481510346e-01   +8.270132134188003e-01   +5.311295833098967e-01];
L2I_Input2_iAMPA_netcon = [+8.736203233454708e-01   +5.934314613859466e-01   +5.576892749021515e-01   +6.516774952405721e-01   +5.302899168975437e-01   +1.000000000000000e+00   -8.125259757436962e-02   +4.898512770772913e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
