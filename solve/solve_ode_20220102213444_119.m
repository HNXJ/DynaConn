function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.301521294152186e-01   -5.458691540181776e-01   +9.011483629489599e-02   +1.023383078710336e-01   +9.160633874392203e-02   +1.810747387207576e-01   -3.664844887953174e-01   -8.980451005541233e-02   +7.030764459609604e-01   +5.458452460577214e-01   +1.880057787238978e-02   -4.688795646837671e-02   +4.752288463200246e-01   +4.955472396603508e-02   -3.173026952584770e-01   -2.556857688007370e-02; +3.176463805623703e-01   +3.234841162277840e-01   +2.072210434027626e-01   +1.026554923251301e-01   +2.029105571693559e-01   +5.453256351046146e-01   -2.232814631541079e-01   -3.537114180731600e-02   +2.185600927134214e-01   +3.534383275299662e-03   +1.471086545063378e-01   +2.221362862789437e-01   +2.711636114974215e-01   +4.839356814032164e-02   +1.500280028400338e-02   -1.082845812448600e-01; +1.990884273246924e-01   +3.418859570608818e-02   -1.164473181147475e-01   +2.609876098332944e-01   -2.443715741782649e-01   +2.829529270651188e-01   +6.035318593973462e-01   -1.829612533476968e-01   +5.053716854824670e-01   +1.796029257593302e-01   +5.237633119806281e-01   -4.723601982014636e-02   -6.913519565084646e-03   -4.562883526536052e-01   +1.202345919075116e-01   +4.391269405671799e-01; +3.001903565998180e-01   -2.362407989504441e-01   -1.395945225863925e-02   +4.405165154205358e-01   -4.884434942012112e-02   +6.141376767243054e-01   +6.167380774908003e-01   +5.887242999278964e-01   +1.493661636273193e-01   -3.529962065523938e-01   +3.682271084922046e-01   +9.978104592650276e-02   -2.824650759282868e-01   +4.646861101613216e-01   +2.429390962943255e-01   +9.510392711848129e-01; +2.595676003879569e-01   +1.700313598277254e-01   +5.724197014664041e-01   +3.974026314949540e-01   +8.429668565574390e-02   +2.196567416758335e-01   +2.049485882024052e-01   +1.606746194054552e-01   +1.576642111289634e-01   +5.977399861027101e-01   +6.492341454378543e-01   +3.207498091980184e-02   +5.229250818401302e-01   -3.306460999372586e-02   +2.431507232790276e-01   +4.089775303054624e-02; -9.297329195022583e-02   +9.623223223686758e-01   +4.156208446776286e-01   +9.287083033797687e-02   +4.255650359406258e-01   +2.804014663377392e-01   +5.517616528133573e-01   +1.667879977233563e-01   +2.509453538707394e-01   -2.852180716618617e-02   +1.282018538650793e-01   -2.505549738434977e-01   +3.429860519851970e-01   +1.231384526385590e-01   -2.526182246574079e-01   -2.611850502232744e-01; +1.704823630610854e-01   +3.115343843501758e-01   +6.844171157082122e-01   +4.995525698935203e-01   -4.310585409467995e-01   +2.318547703465827e-01   +8.102694477662807e-02   +1.775589380544066e-01   -6.271918956746516e-01   +7.907471140738519e-02   +5.801026041395043e-02   -2.481602446554838e-02   +3.240678817010051e-01   -1.541402099786415e-01   +5.124537880279162e-01   +6.027687258395242e-01; +8.744341812564596e-02   +4.447605807095734e-01   -1.558321243431444e-01   +1.955605263711695e-01   +2.680150661677403e-01   -1.543826937261091e-01   +6.131632304467515e-01   +3.152198574532722e-01   +3.235833227064597e-01   -1.395887557144086e-01   +3.501747319415134e-01   -8.047250871773623e-02   -2.146230050033042e-01   +9.054284355518392e-02   -7.732085104016373e-02   +1.496255717738161e-01; +1.800283823614242e-01   +7.519368185119080e-01   -2.636071020491049e-01   +2.225549891457017e-02   +3.728726725762851e-01   +3.642307258230488e-01   -1.451841198383287e-01   -1.706918814313466e-01   +2.111669017586730e-01   -3.765856103495865e-02   +3.296918672461558e-01   +1.346681631688677e-02   -5.459392056136914e-02   +3.036364581440157e-01   -1.005020271623769e-01   -2.394405413420159e-02; +4.729207044523239e-01   +3.720150972824769e-01   -9.950404567072028e-02   +4.447129598877366e-01   -2.925776230866380e-01   +1.015550424990812e-01   +4.444829545014101e-01   -1.242011169081312e-01   +1.738817021298592e-01   -1.777087888879451e-01   +8.354395290016767e-01   +1.873954039639135e-01   +2.813315405100483e-01   +4.231578410808530e-01   -3.501896707396446e-02   +4.251701355418324e-02; +1.906084867966032e-01   +7.690423500667897e-01   -7.589412856311897e-03   -3.207590936818880e-02   +4.509071098314363e-01   -8.663244308521971e-02   -1.992733432615473e-01   -1.189513743621811e-01   +3.115152980673230e-01   +4.752144574554312e-01   -1.992717239989025e-02   +9.136826038048440e-02   -6.051881274923783e-01   -2.194006980154223e-01   +3.545200336530097e-01   -4.998850595655406e-02; +3.462713061621929e-01   +2.734780048294611e-01   +1.692804160054638e-01   -1.976371215386806e-01   +8.909310454283924e-02   +1.375476517222410e-01   +2.440581655574437e-01   +9.737769390231127e-02   +4.404482515895520e-01   -5.222701189775927e-01   +2.416995181056252e-01   +4.904702810195131e-01   +6.041782697852512e-01   +6.514038563092184e-02   -4.647727260341845e-01   +1.098354623909625e-02; -4.564741055073827e-01   +2.241168723005591e-01   +1.034717816271590e-01   +4.070370256987687e-01   +8.952685710969794e-01   +7.059351145194832e-01   -1.439665111168182e-01   -5.499902235607654e-02   +4.185565941040245e-01   +4.220991786907453e-01   +1.444025231704760e-01   +2.369476899989644e-01   -3.157971197077176e-01   +1.105662362827129e-01   +3.355325671658896e-02   +1.517689765756080e-01; -4.084546204369716e-01   +5.176246164677580e-01   +2.157793853750194e-01   -5.064677784578220e-01   +3.465981009000530e-01   +3.115350078241489e-01   -3.121752486610919e-01   +2.017073102366660e-02   -1.722438343508664e-01   +2.869256764526413e-01   +7.900808139819722e-01   -7.024205195593362e-02   -1.054822603559357e-01   +5.155028642241661e-01   -3.068737990199008e-01   -2.677128124554327e-01; +3.652186993393142e-01   -3.432859805027628e-01   +3.813758434635231e-01   +2.236998051598660e-01   -8.820227156925961e-02   +2.948512416285288e-02   +1.220049395102251e-01   +1.267084583664720e-01   +2.066862609469032e-01   -3.074913561602423e-01   +2.987641445432259e-01   -1.076547621736933e-02   +7.681085450146226e-01   +1.559303308522941e-01   +1.048846105079150e-01   +8.399469323711160e-02; -8.081214195252403e-01   +2.753682765912627e-01   -4.499887101648955e-01   +4.315153402288313e-01   +8.137436407220141e-01   +2.526315264368217e-01   -5.229060753436010e-02   +7.068274820947305e-01   -2.562421137305546e-01   +2.785710547116163e-01   +4.882862850257920e-01   +7.166729965148283e-02   -1.462294561161938e-02   +2.185076334112455e-01   -6.755788863583927e-02   +3.506082456102472e-01];
L1E_L1I_iGABA_netcon = [+3.681868539332871e-02   +8.354547665692895e-01   -4.184349289113437e-01   -2.407493830711584e-01   +3.508670959269027e-01   +3.699399001640238e-01   +7.247628061593807e-01   +3.539754723733405e-01   -5.045948687167265e-01   -1.415528630002239e-01   -3.129416669028113e-01   +5.485647740986144e-01   +8.104350409200337e-01   -3.460967995427812e-01   +5.790595148927454e-01   +7.118664333756232e-01; -3.153184974974679e-01   -9.909303383274604e-02   +9.604202553176561e-01   -3.931775808965906e-01   +5.637155882555016e-01   -3.865282762342458e-01   +6.830059316429344e-01   +5.686962876938599e-01   +2.838160363973194e-01   +3.296710628262243e-01   +3.695859591284913e-01   -1.540260890169343e-01   +5.276715538382610e-01   +5.039916828965433e-01   +6.005710556953020e-01   -8.591029747973401e-02; +5.352094666424669e-02   +4.621380904551914e-01   -3.006155639842996e-01   +4.106605529531361e-01   -1.750966949871200e-01   -2.108501857181216e-01   -1.670815384487360e-01   -2.598890069085213e-01   +2.021482690205336e-01   +3.007704680452005e-01   -8.661534563233689e-02   +6.834727726917758e-01   +4.724456211278792e-02   -4.422224228396109e-01   +6.417447272537447e-01   +4.062021746811871e-02; +3.889329974180047e-01   -1.450067806576283e-01   -3.299254188698071e-01   +1.495423726659196e-01   +1.170853989567398e-01   +1.935199206884932e-01   -5.352455636876569e-02   -8.734834756779590e-02   +2.249749726809924e-01   +3.155390216260995e-01   +5.236151081416937e-01   +8.328191453696630e-02   -3.563869832388488e-02   +3.649252073174221e-01   +2.605517817365345e-01   -1.020217981926757e-01; -2.530729632066971e-02   +3.685924294140225e-01   +5.806776648042793e-01   +7.361647026275051e-03   +6.047238232060018e-01   -2.605762587658187e-01   -1.135612349918187e-01   -3.561937414232164e-01   +1.744642558303444e-01   +3.468182960968122e-01   -5.708051347813523e-02   +7.316869790299630e-01   +6.944781129961847e-01   +4.722183154972873e-01   -3.403761092333428e-01   +2.902997435625766e-01; +2.388036843131191e-01   -3.581104448538501e-02   +1.322485365003894e-01   -4.621102753372183e-01   -5.641795492588308e-02   +4.588860889432892e-01   -6.708361719305382e-02   -3.217553660857525e-01   +6.557515235948558e-02   -6.417665316980348e-02   -8.023125704357814e-02   +5.349278192808087e-01   +2.292829762466556e-01   -2.344939047157089e-01   +2.315408941745332e-01   -4.985087755943512e-02; -7.430534806374034e-01   -4.540190125403064e-01   -3.854773243033793e-01   -5.715253838108368e-01   +4.893439377234536e-01   -1.103335252745418e-01   -2.520029743321471e-01   -2.827473460896228e-01   +5.263768198221072e-01   +5.269282416831377e-01   +6.462463520818640e-01   +4.689659994225848e-02   -2.178589507050704e-01   +4.166531417714223e-01   +6.807304427571719e-01   +6.364076313973960e-02; +4.264334518180109e-01   +2.045060136528354e-01   -3.243035391010881e-01   -1.875478139254327e-02   +9.599203113787391e-02   -1.741231598257616e-01   +8.631043534876046e-01   -5.329591001528033e-02   +6.352901118625396e-01   +2.935484863204310e-01   -1.386028132078281e-01   -8.383539436183629e-02   +8.121133196522385e-01   +5.158291170812117e-01   +3.925524911741488e-01   +8.400235899269202e-01; +2.996820086056860e-01   +7.044420996063924e-01   +2.401048283193458e-02   -1.723547290179784e-01   -5.293434548146393e-01   +6.609981680710952e-01   +9.144462835845722e-02   +4.089160003783798e-02   +1.103394956618020e-01   -5.614219532813992e-01   -9.618114258901495e-02   -2.417749308298558e-01   -2.174459824699644e-01   +3.742332689467939e-02   +8.595117191874420e-01   -9.619748063891093e-02; +3.794901970826958e-01   +7.223616549003439e-01   +3.748116003331173e-02   -4.035006455554523e-01   -1.845665633940309e-01   +5.628334654924783e-02   -3.428875035747199e-01   +3.969779288259421e-02   +6.135354539513543e-01   -2.334235180489360e-02   -4.993122704130691e-01   +8.336364865110375e-02   +6.583565772591757e-01   +3.019515015590911e-01   +1.065781648897163e-01   +1.491698032357065e-01; +3.286185178775471e-01   -1.079992227626943e-01   +2.974713784068447e-01   +5.903339828707259e-01   +3.425929948960700e-01   -1.078870299166640e-01   +3.648811782613053e-01   -2.055682661025850e-01   +5.317284146735388e-01   +2.858106357887258e-01   -4.140253869072902e-01   +3.687970257072429e-01   +4.597682914482373e-01   +3.301806144390543e-01   +2.019891222945112e-01   -7.028798585225243e-01; +1.881518091514003e-01   +9.352396062040927e-02   +2.292328694900245e-01   -6.049962744950751e-01   +7.945278290394704e-02   +4.255750141040500e-03   -2.872341240628853e-01   +9.294153239142698e-02   +5.831222083056839e-02   -1.239761265044611e-01   +1.811163081850359e-02   -9.317580891378029e-02   +5.428309920559837e-01   -1.314239812216335e-01   +5.807874237753210e-01   +2.183113814323649e-01; +4.974279563348791e-01   +2.997473432498724e-01   +8.551784422242301e-02   +2.868692735883797e-01   -1.964186042326370e-01   -1.715801241817915e-01   +1.630211205891993e-01   +1.595848002670789e-01   +2.173325080023661e-01   -1.981523284513547e-01   -1.230629419569043e-01   -2.452407039626229e-01   +2.917758773329532e-01   +3.120807380845483e-01   +2.884987910414414e-01   +8.349139321287312e-02; +3.599945605179233e-01   -2.223885967808154e-01   -2.854433535691563e-01   +3.591355993757608e-01   -6.312725913821796e-02   -3.278279909220301e-01   +1.917946461640352e-01   +3.657237602496449e-01   +5.896761908419054e-01   -1.000246634386939e-01   +3.380143633381883e-01   +1.875034261524537e-01   -1.577072175280016e-01   -2.000060752362368e-02   -1.488462271259491e-01   -7.932567503366775e-02; -1.542827998866770e-02   +3.671421607857698e-01   +2.540835625196381e-02   +3.553961762579567e-02   -1.858080747675901e-01   +6.427958802587201e-02   +1.980939895581426e-01   +1.056209563900003e-01   +6.840353372589539e-01   +1.192050191697658e-02   +6.960677744430657e-01   +7.150573893429342e-02   -2.371870572751726e-01   -7.372416717460649e-01   +9.867626757782076e-01   +3.223500168317613e-02; -4.564771479340893e-01   +5.034042003683720e-01   -1.027098190601809e-01   -1.507806561228975e-01   -2.984921880605944e-01   +1.189753843966173e-01   +2.254664276679539e-02   -4.237783132583881e-02   -2.505928085785782e-01   +4.964726727558844e-02   -3.843638945467948e-01   -1.475756766632270e-01   +2.665953299872389e-01   +4.416969302778565e-01   -2.471146404308821e-02   +2.721855989174088e-01];
L2I_L1I_iGABA_netcon = [-1.247468978225762e-01   -2.192896299525559e-01   +1.962064756974006e-01   +5.322523472831068e-01   -3.543021206600167e-01   +4.662335082347617e-01   +1.951440166989243e-02   -2.635380230571428e-01; +1.706707682844296e-02   +7.849690686449514e-01   -8.036605594263852e-03   -8.822595253464888e-02   +4.705950222478296e-01   +5.035221748296625e-01   +7.848077798267054e-02   -2.376093220632978e-01; +4.495201686990656e-01   -7.820704123603461e-02   -9.773333714961525e-02   +4.041396091859451e-01   +2.065852190947931e-04   +7.948185069482058e-02   -1.187953722037666e-01   +2.514043264504238e-01; +1.497039852203245e-01   +5.497153269966997e-02   +6.677830832846010e-01   +3.380796868031219e-01   +1.843927645609228e-01   +4.544002385669786e-01   +3.366119759156936e-01   -2.112847259277691e-01; +6.707767782052851e-02   -4.446456901772224e-01   +6.683649040279626e-01   +5.288035311483632e-01   +5.359361321586358e-01   +5.133139879951294e-01   +3.274862384223129e-01   +1.045969952183202e-01; +6.497076215133019e-02   -1.353331568250491e-02   +2.960021320238521e-01   +5.362443784382508e-01   -1.059529782670171e-01   +4.666915010431845e-01   +4.627256585529033e-01   +5.337449788296299e-01; +2.435359341940318e-01   +3.543481996574381e-02   +1.562347655449030e-01   -1.269594219146072e-02   +1.731759851900657e-01   +6.804043586680752e-01   +4.078868440406512e-01   +7.269980499309645e-02; -3.231078696806600e-01   +5.027941994334563e-01   +1.191718171992601e-01   +2.391813279124635e-01   +5.558832256873509e-01   -1.514735473902737e-01   +3.429582161979178e-01   -5.554629550141722e-03; +3.622861782876230e-02   +9.113665441974593e-01   -4.715282605058894e-01   +4.257704841479124e-01   +3.618992597328738e-01   +4.360241709878494e-01   +2.427502158566062e-01   -2.391897148777663e-01; -1.846353434960414e-01   -2.736155573065395e-01   +3.928635199572301e-01   -1.266810883894516e-01   +9.877191269755352e-02   +1.113727547458344e-01   -5.914977159430674e-01   +3.593968301246249e-02; -1.438427298290596e-02   +1.693560543192894e-02   +1.156250565134729e-01   +3.165123895136283e-01   +5.381422153940008e-02   -1.616509351432465e-01   +1.369096613376524e-01   +2.854901687848818e-01; +3.977816329789796e-01   +2.952983670787568e-01   +2.701374911666791e-01   -2.601614021180447e-01   -9.092442485207224e-03   -1.215704293403274e-01   +7.855315181366972e-01   +5.102222529157689e-01; +3.876796658549652e-01   +3.349498300388045e-01   +9.070489398356496e-02   +2.287968460822519e-01   +5.813147133031410e-01   -3.002984708811461e-01   -3.095922799939103e-01   -9.965328903734100e-02; -2.816336845313602e-01   -3.450222768824045e-01   -8.026388213292016e-02   -3.982244086536332e-01   +1.914943879065653e-01   -4.692177975453807e-02   +4.300163535134018e-01   +5.057135315988497e-01; +5.229442406451368e-01   +2.631614433207250e-01   +4.031423467639870e-01   +1.468066083351322e-01   -3.120091315887004e-01   +6.473560716353157e-01   +6.648451075382422e-01   +2.737584752503165e-01; -4.496013238470788e-02   +7.461317661507427e-03   +2.592917250325554e-01   +4.348818237205264e-01   +4.166463568110415e-01   +2.287187838920903e-01   -1.122250414284608e-01   +1.646175380992693e-01];
L1I_L2I_iGABA_netcon = [+4.383345748325613e-01   -2.804429621454491e-01   -6.893840352222526e-02   +3.427667162657930e-01   +2.893087183984524e-02   +1.521167048783777e-01   -3.689690213509292e-01   -4.885035462836781e-02   -1.457673748182243e-01   +2.930420312571242e-01   -1.171333449538788e-01   -1.173608543770867e-01   -4.086520616909166e-02   -6.049359349788633e-02   -2.381778377231447e-01   +3.074541066072625e-01; +2.527516296640736e-01   -4.785250103824373e-01   -5.543616283826287e-03   -1.780164020927094e-01   -1.921503384087315e-01   -1.008713259947439e-01   +2.452033770038568e-01   +4.365972868053059e-01   -8.763965357510976e-02   +8.514285807074664e-01   +2.503605250882018e-01   -1.153648660569266e-01   +1.485553994569554e-02   -2.285174113185982e-01   +4.599890366186132e-01   +3.011847183345559e-01; +3.395632694764662e-01   -6.708759768237750e-02   +2.626212859385597e-01   -1.609217086393867e-02   +3.211135533952665e-02   -3.300739008237338e-01   +3.600923650830373e-01   +1.229353891825704e-01   -9.804795358999660e-02   -5.528759888632395e-02   -2.821187912332795e-01   +2.127227107178641e-01   +3.296356276492622e-01   +3.829682194390937e-01   +4.439725094291033e-01   -1.660847224171323e-02; +2.672072398760184e-01   +4.452929980390420e-01   +4.279895785777291e-01   -8.740831700720847e-02   +4.572230097795910e-01   +8.486752875060820e-01   +2.382959914535440e-01   +3.729314013984157e-02   -5.662370813057591e-02   +6.730177183150943e-01   +3.971560865166288e-01   +3.800427262398742e-01   +2.214342591435003e-01   +7.854161561901735e-01   +3.303123647394306e-01   +4.847246665709843e-01; -3.595388568767339e-01   +1.980888661195716e-01   +1.540499664160055e-01   +2.367576206229550e-01   +2.952601553617738e-01   +4.870965923696260e-01   +4.496805594697696e-01   +2.897107698597962e-01   +3.437292049488049e-01   +2.578302849640150e-01   +1.496703888014539e-01   +1.034409624869325e-01   -7.081365410009652e-01   +2.823299727527480e-01   +3.575385220118545e-01   +5.979643033908112e-01; +3.355022183281132e-02   +5.205032944356356e-01   -6.626363293903560e-01   +2.356302396913642e-01   -6.298775113370476e-03   -7.804035753289820e-02   +4.930558706770798e-01   +2.822928529252806e-01   +2.499950343273133e-01   +2.718551705050615e-01   -4.802564703122460e-02   -2.697338575750271e-02   +1.835221839515281e-01   +8.429188221404046e-01   +2.541694903066721e-01   +1.440616167139062e-01; +1.613643327499060e-01   +2.834941290087365e-01   -3.049307584800520e-01   +2.113668801083900e-01   +4.148031824710268e-01   -4.397124307656936e-01   +3.984624788214876e-01   -5.940353591353710e-02   -2.996192033680928e-01   -4.076488736533100e-01   +1.801088232171225e-01   +3.946887184788438e-01   +1.542560123743789e-01   +2.402138572878624e-01   +1.935200734846101e-01   +7.662932798563020e-02; +2.501487393773970e-01   +1.481894198506065e-01   +2.029862668511348e-01   -7.148285622284320e-02   +1.464248836880594e-01   +3.256074407033478e-01   -2.040324736078861e-01   -1.001116127224647e-01   +2.327553445483228e-01   +2.882507552617586e-01   +2.319396161815533e-01   +5.712811326396784e-01   -9.959789460709451e-02   +1.033099267411861e-01   +2.772075708811326e-01   +6.252868728289926e-01];
L2E_L1E_iAMPA_netcon = [+3.117191970087879e-01   -5.795210357310696e-01   -1.306822983884403e-01   +4.498918372067033e-01   +6.039386228090257e-01   +3.113642409149047e-01   +4.671182644316395e-01   -2.672245727154924e-02; -8.540139285180452e-02   +6.262131938684420e-02   -4.082740947072377e-01   +3.980105873716069e-01   +2.314734340599778e-01   +5.105081128571587e-01   +1.331306763753906e-01   +2.679962517042885e-01; +5.024204723176734e-01   -5.017406519142967e-02   +1.066524816279757e-01   +2.376196957486560e-01   -1.307512505892613e-01   -7.877041793139208e-02   +9.761774236337654e-02   +1.892210480166955e-01; +4.641831064955406e-01   -2.466962736157566e-01   -2.822270947789524e-01   +3.849852659556937e-01   +6.400317431677130e-02   -1.564474123075918e-02   -2.003251750787012e-01   -3.725807648679288e-02; +1.605612346973849e-02   +4.739222258742062e-02   +4.136482188999768e-01   -2.715691421349477e-01   +1.123497807165744e-02   +6.294683115944832e-02   +1.527370926045801e-02   +3.562867292768813e-01; +6.034097805815228e-01   -9.957961761151543e-02   +1.751624248753402e-01   +5.744142435359063e-01   +4.722693416848059e-01   +5.058802402533049e-01   +5.404743354962487e-01   +2.781883441004327e-01; -3.198201421564826e-01   +7.478817855176884e-01   +5.332128141899834e-03   -2.810849782000948e-01   -1.575475503660187e-01   +2.484193431693831e-01   +5.516951242520313e-01   -3.828873188209881e-01; +8.945015032731549e-02   +3.378089431945613e-01   +7.628920477672341e-01   +2.761902472420294e-02   +3.313202159949651e-02   +1.038285051028444e-01   +5.104277766720485e-01   -4.746209346928787e-02; +2.906044462493511e-01   -1.200892100250765e-01   +6.085555784849528e-01   +7.648048164645245e-01   -4.893930286944981e-01   +3.884240672365216e-01   +5.256536623279586e-01   -5.402818349762474e-02; -1.952168776925992e-01   +2.124790475235405e-01   +3.883453425143800e-02   +5.331747857115244e-01   -9.079398892885997e-03   -2.682671227686131e-01   -1.435289801485406e-01   -2.835629597797348e-01; -1.078082662658349e-01   +7.106815055554960e-01   +7.029795822711660e-01   +1.394744114609745e-02   +4.724782259150247e-03   +1.815189499422267e-02   -1.392191501601954e-01   +4.092457231374835e-02; +6.087302366124664e-02   -2.174929544513411e-01   +4.942335795969751e-01   -2.239591705786337e-01   -3.507754307165060e-01   +1.347439412089505e-01   -1.054202541746846e-01   -3.389661420230357e-01; -1.542759541014390e-01   +4.114629433552744e-01   -1.359979352637293e-01   +3.952970826311225e-02   +4.390484240860333e-01   -3.375900124017995e-01   +1.240716144836468e-02   -6.153749936621039e-02; -1.478219484077722e-01   +9.183091333840129e-01   -2.411301007761036e-01   -9.798531160108599e-02   +5.093807727617923e-01   +7.326607437727137e-02   -2.023918229282655e-01   +2.465259344624289e-01; +3.363177775654521e-01   +4.023147371188384e-01   -1.398682329917935e-02   +2.044579492532149e-01   -5.966230239980456e-02   -7.087814849006482e-02   -1.756785930633941e-01   -1.715079297458273e-01; +5.020807735650070e-02   -1.052677855315653e-01   -4.766430718146994e-01   +1.833163281862396e-01   +2.097207112644463e-01   +2.243504082541113e-01   +7.936534750121313e-01   -9.070646564415180e-02];
L1E_L2E_iAMPA_netcon = [+4.148724367461399e-01   +1.453686915185229e-01   +1.157626964920624e-01   -1.869914610569484e-01   +3.302222922008369e-01   +4.099939581959770e-01   +3.125382848705464e-01   +3.875612771190941e-02   -4.919907202901333e-02   -1.239913199635734e-01   +6.955509757297093e-01   -2.997967561479620e-02   -1.156944006553579e-01   -1.948707004390636e-01   -7.294534518172351e-02   +2.521840803357091e-01; +2.830142813102213e-01   +2.042764825841818e-02   +2.859472232789103e-01   -2.357865525815615e-01   +3.211167640928341e-01   +1.484963574242508e-01   +7.397707062813242e-01   +2.322236615811515e-01   -7.747917646053014e-02   -5.850476712824189e-02   +3.590539969476692e-01   -1.075041516890907e-01   +5.660935884730902e-01   +3.931039616421023e-01   -7.563581714143704e-02   -6.646662123490246e-01; +9.382659051055738e-01   +1.210396031049856e-02   +2.281172223349996e-02   +2.577389563695945e-01   +1.890888422649080e-01   -3.229991192212506e-01   -1.310977326920087e-01   +1.440918551521920e-01   +1.803476828315471e-01   -4.359735474687275e-01   -2.054229469008313e-01   +3.465969996191127e-01   -1.659686166986910e-01   +6.422372616054436e-01   +1.010195773404008e-01   +5.224052340528047e-02; -1.042561848505547e-02   -6.829708595033188e-02   -2.699084371992094e-01   +3.783957820715208e-01   -1.703069254219533e-01   +7.766703878867988e-01   +5.188323052694954e-01   -1.589261264246959e-01   -8.659785601730915e-02   +1.648054943678365e-01   +4.495989357498986e-01   -2.891433698312929e-01   -1.428266877402582e-01   +9.265181374023971e-01   +4.270427541355243e-01   +3.534076857717348e-02; -1.828748086715599e-01   -4.028361205396247e-01   +5.170824160561795e-02   +2.557913830149979e-01   -3.148900750550296e-01   +1.963135423790759e-01   +4.053265001814968e-01   +1.863518783180175e-01   +4.250367013030130e-01   -6.688163472301244e-02   +2.270406454596283e-01   -4.971173646253004e-01   -4.188957530825949e-01   -1.026456641581793e-01   +1.740800713454974e-01   -2.760882829131343e-01; +7.163616280788004e-02   +5.199420786355543e-01   +5.365931667039882e-02   +6.749097277849837e-01   -1.317944025526994e-01   -1.432000485933310e-01   +8.759116416855187e-01   -2.751540777271657e-01   +3.846799577433935e-02   +1.820001074137253e-01   +4.466303021245164e-01   +2.737094400461805e-02   -1.969453014371513e-01   -3.722038305866808e-04   -2.003647034660612e-01   +6.644859710799812e-01; +1.947690267326831e-01   +3.555027714615103e-01   +1.599626150881838e-01   -1.515322702457245e-01   +2.280197817516376e-01   +2.618978619003997e-01   +5.190049377636197e-01   -4.699716365228182e-01   -1.540847754097204e-01   +8.588972244086741e-03   -1.346150630618817e-01   +3.187456740496863e-02   -6.609332887417345e-01   +5.674362530853538e-01   +6.032640754769227e-01   +4.372475957015654e-01; +6.023929899235352e-01   +6.208427837779439e-03   +2.327635115451139e-01   +5.429629763205153e-01   +4.275627295473093e-01   +5.324968662334268e-01   -8.693118990055808e-02   +1.712093044294849e-01   +1.388095163768511e-01   +3.757707937863533e-01   +2.825538467180976e-02   -1.155301381027511e-02   -7.909674231693536e-01   -1.034319974727126e-02   +3.969530418279170e-01   +3.717822249994334e-01];
L2I_L2E_iAMPA_netcon = [+8.117682918721611e-02   +6.827482968489929e-01   +3.195803697226340e-01   -1.843097019342500e-01   +9.200381194939643e-02   +1.887955516381672e-01   -1.074013374536466e-01   +6.510838448088655e-01; +6.560447760680785e-01   +4.182057820063255e-01   +4.548427430174585e-01   +9.135403780739449e-01   +3.272949718640221e-01   +3.041663779048885e-01   +1.508873915416765e-01   +4.395920377565620e-01; +2.150702387323207e-01   +1.148306258954527e-01   -3.943974163278049e-01   +5.002426258443454e-01   -3.038473443463647e-01   +1.225989809307198e-01   +4.494604467348264e-01   +1.681283464493159e-02; +4.475005558218033e-01   +5.096643689581443e-01   -6.522675265052467e-01   +3.723742639087262e-01   +5.658868077047547e-01   +6.174460331479688e-02   +2.060093554930080e-01   +4.710279729932991e-01; +4.550220118713283e-01   +1.543128948203508e-01   -3.608528433363750e-01   +3.737444955881948e-02   +7.580487662795615e-01   -4.532569447388936e-02   +1.355336812666184e-01   -1.187896959866814e-01; +3.443048428011130e-01   +3.353339001748971e-01   -3.719645077235139e-01   +4.857647140077923e-01   -6.553751942511706e-01   +1.095334291130640e-01   +1.353582132658309e-01   -1.928955679795687e-01; +4.863919640007106e-01   -2.428014597201368e-01   +2.303384444370546e-01   +4.508629460603864e-01   +2.166385298870186e-01   -2.994112870223581e-01   +8.281826494968196e-01   -7.313991490242017e-01; +2.616564584599188e-01   -5.013244310369716e-02   -6.967632522960572e-01   +2.690809165236088e-01   -2.732630963393225e-01   -1.494804372006984e-01   +1.101097986284084e-01   +8.951927588788391e-01];
L2E_L2I_iGABA_netcon = [+2.721080391373226e-01   +4.654722392170801e-01   +4.982685388150865e-02   -1.793343505188728e-01   +4.390369494218022e-02   -1.369565716012487e-01   -2.960380267653083e-01   +5.839573285338610e-01; +2.087599457219269e-01   +2.028513335850087e-01   +2.720221798326345e-01   +1.000000000000000e+00   +4.474367507558853e-01   -2.343471250647918e-01   -3.075305510281683e-01   +3.081879215637844e-01; +1.674198253507905e-01   +5.537126641736176e-01   -5.946921347198674e-01   -4.038471469099250e-01   +1.277199297562784e-01   +5.981360146751716e-01   +1.673057794848576e-01   +1.771606642029826e-01; +2.535060569791727e-01   +1.732736547488899e-01   +1.239023052841744e-01   +5.839107671392436e-01   +5.337312280936140e-01   -2.529619554565324e-01   -2.538909218901851e-01   +8.389808796989209e-03; -1.933484953402245e-01   -4.261221917086890e-02   -2.390700948137912e-01   +4.322256114524852e-01   +5.169533194693511e-01   +2.023813670610769e-02   +2.560870450690925e-02   +2.166079699103456e-01; +8.234461137438629e-01   +4.764740002119384e-02   +1.739777772764151e-01   +2.412842801231189e-01   +3.274119721656243e-01   -4.435162721935698e-04   +4.246085446580380e-01   -3.517408813728213e-01; -3.100715701005468e-02   +9.045697356626030e-02   -3.289964012897079e-01   +7.775017237036586e-02   -1.049864677541272e-01   -1.162060834657821e-01   +1.633737572798623e-01   +7.927475203231431e-01; +6.872522849289248e-02   +1.562903220968755e-01   +4.031884793499880e-01   -1.439273263897431e-01   +5.070235190257198e-01   +2.434321700848473e-01   +3.180803959241671e-01   +4.373729608257544e-01];
L3E_L2E_iAMPA_netcon = [-2.139197359586287e-02   -3.436983517887411e-01   -2.425515305381056e-01   +2.792581352109599e-01   +7.539898010339831e-01   +2.100410232861876e-01   -2.207124278303830e-01   +9.889324121971863e-01   +4.852322525103394e-01   +2.249143043865750e-01   +2.081724633060173e-01   -5.311824917814809e-01; -2.333842987644210e-01   +1.616573569093884e-01   -1.231634359789270e-01   -6.539046313793017e-01   -3.904886639051222e-01   -2.526139769758616e-01   -2.330649786504554e-01   -2.137126531065349e-01   +4.970345505740706e-02   +5.238571207836551e-01   -1.658554893765909e-01   +4.959714224415050e-01; -7.144183520793272e-01   -2.393566020837730e-01   +5.302892462039066e-01   +1.887420813421879e-01   -1.873505773104642e-02   +3.630371264562730e-02   -7.932486778649576e-02   -6.790183597358401e-02   +5.678869669600892e-01   -6.481084320185255e-01   +7.353668734458391e-01   +4.959243354109751e-01; +3.877593971122945e-01   +4.107565299726911e-01   -2.606218973554862e-01   +2.909269736328617e-01   +6.178460196305728e-01   +1.983436969134143e-01   +3.625066713754819e-01   +9.255263084732563e-01   -2.804042370316989e-01   -2.476814854034920e-01   -1.470935518117681e-01   +3.837592630888109e-01; -5.688052893051822e-02   +3.730545075741967e-01   +4.020475957348549e-01   +2.792465815631100e-01   +4.745268760676097e-01   +4.375573344729451e-01   +9.940366517115905e-02   +4.835510722626948e-02   -4.572723945587787e-01   +3.579394022325550e-01   +4.896528829396839e-02   +3.052098527033342e-01; +1.504087860854594e-01   +7.212762599915186e-02   +3.122340280855062e-01   +3.957747478599540e-02   +7.594336069049988e-01   +5.209501147716986e-01   -2.913294536628130e-01   -9.202178419339804e-02   -1.676245087647884e-01   +3.727459673782149e-01   +4.819318617974487e-02   -1.581491180718223e-01; +5.229888630548246e-01   +2.513079976710657e-01   -7.376465493170614e-02   -1.538422031609045e-01   +1.521457543356872e-01   +3.982751273285193e-01   -1.268760511197938e-01   +2.731289633687711e-01   -1.321421220832907e-01   -9.228947050848889e-02   +3.819317569691086e-02   +2.926873412604497e-01; +4.820465085512191e-03   +7.442451031304597e-01   +7.282765997900453e-02   -7.402742890528150e-01   +3.005970191123112e-01   -2.826209231476752e-01   -2.629737088305141e-01   +3.960361857781355e-02   +2.552518242811618e-01   +2.857255621116750e-02   +5.357554197256432e-01   -1.114249268507358e-01];
L3I_L2I_iGABA_netcon = [+7.312212509318207e-01   +6.067321895756711e-01   -1.641729299625810e-02   +1.387062575164811e-01   -4.165845360384020e-01   -1.034726405300800e-03   +9.908893858119519e-01   +4.703399242944694e-01   +2.040576236512295e-01   +3.062504378863150e-01   +1.635588617825271e-01   +2.973228710055309e-01; -6.636033339066452e-02   -3.154072469568464e-02   +2.306518720735027e-01   -2.439369275212473e-01   +2.491235410777255e-02   +9.781126766703646e-02   +2.039418798224601e-01   -3.086507143067733e-03   +1.473155633477559e-01   -2.396111591320583e-01   +1.519706808654409e-01   +2.635137431193633e-01; +8.714812806851489e-02   -1.479060370116041e-01   -1.020419323141254e-01   -1.778684861110950e-01   -3.719037516297994e-01   +4.772185951500164e-01   +6.276881162046541e-02   +8.127488545897590e-02   +6.097025635322380e-02   -1.911383860594970e-01   +5.566375276340640e-02   +5.602543512627406e-01; +7.123330253615536e-01   +2.423697888450538e-01   +3.589264103454105e-01   -2.256663293535387e-01   -1.087623662783759e-01   +2.289976001464360e-01   +1.163324386689335e-01   -2.812912895079338e-01   +1.341866143749852e-01   +3.672243597034907e-01   +3.428024308548087e-01   +1.051107014082497e-02; +1.225210728465635e-01   +3.697712999970106e-01   -1.782054057965629e-01   -2.074970605835894e-01   +9.776827992627335e-02   +4.786341319968108e-01   +7.849710410439145e-02   +3.400210083050671e-01   +2.607986314703143e-01   +1.092777796154098e-01   +1.388101953701726e-01   +2.420218547015553e-01; -2.348383356960386e-01   +8.448972476835641e-02   +4.493982043370289e-01   -7.053458472619067e-02   +3.941094310387679e-02   -6.361247857566271e-02   -7.726613719346957e-02   -1.900103868765745e-01   +1.849861512836471e-02   -9.873994359983335e-02   -7.188486794519580e-01   -4.368864619176976e-02; +2.215024787757917e-01   +1.619529245190917e-01   +4.267095023755643e-01   +2.894072013428470e-01   +4.390453991370802e-01   +5.690449370349990e-01   +3.655989269579320e-01   +4.297588706626114e-02   -6.088223935617130e-01   +2.570211180112357e-01   +3.905871954715389e-01   -2.382301132741558e-01; -4.833862095042055e-02   +6.726611795875519e-03   +3.802705437316964e-01   +1.455885224025701e-01   +2.026841875768782e-03   +4.670717183309687e-01   +1.994546622586372e-01   +4.156272116688812e-01   +5.894147515094837e-01   +1.562793888574383e-01   +2.343439011046441e-01   +3.083674507103273e-01];
L2E_L3E_iAMPA_netcon = [+6.086404102457760e-01   +4.115416124907604e-01   +4.675653619082698e-01   -6.368759953771562e-01   -1.309343909881074e-03   +1.612344505115209e-01   +6.608159818232664e-01   +1.655656105208119e-01; +3.436600955304558e-01   -1.218875018554323e-01   -2.021730229978845e-01   +9.569937839554321e-02   +9.561375147665320e-01   -5.640551794816028e-01   -8.804314124945474e-01   -5.881659372854465e-01; +1.664252633906077e-01   +1.628890153796376e-01   +3.000312547860496e-01   +2.459789000019801e-02   -1.261601798852293e-01   +2.563334176274619e-01   +7.884578345844451e-02   -1.513118931749080e-01; +4.637218794467590e-01   +5.137574161195561e-01   +8.034638739007982e-01   +8.535638836825802e-01   -1.913388094695277e-02   +5.268810510681128e-01   -7.350189719518631e-02   -4.800401896185617e-01; -1.702917573640321e-02   -1.080773710197464e-02   +3.296319806135469e-01   +3.358386847146913e-01   +3.587117192995842e-02   -1.444505878841948e-01   -6.693389361632353e-02   -5.650732542470047e-01; +7.381796574504489e-02   +2.104274197584379e-01   +3.854138915695698e-01   +5.400776225841910e-01   -1.112912941764195e-01   +7.664057085026692e-02   -6.491109262436531e-02   +2.329596844392572e-01; +3.004108713413083e-01   +7.999221183117133e-01   +6.668435066471570e-01   -2.900372619264131e-01   +5.521836740751838e-01   +1.665882970385922e-01   +6.865317349295369e-01   +1.058818278252788e-01; +4.249306543078253e-01   +4.718599182134242e-01   +3.077293602556772e-02   +1.491615637894674e-01   -4.567133445143230e-01   +2.020456367189099e-01   +2.925751141487433e-01   +7.005756087969239e-01; -1.706817858741461e-01   +5.752426004640143e-01   +5.744684987558207e-01   +6.901262806462353e-01   +9.894254688330963e-02   -2.151213349998710e-01   +3.619522753696688e-01   +1.081573260771702e-01; -3.053514773075959e-01   +2.256002055881798e-01   +5.685318294168010e-01   +1.713287301824028e-01   +1.415972922680015e-01   -4.191042285499252e-01   +5.516966574030453e-01   +2.433000789079384e-02; +7.626719925052011e-01   +5.966157217909090e-01   +9.949820527620094e-02   +4.439231107846439e-01   +1.350153349464258e-01   +9.456032681286871e-01   -5.297099080521679e-01   +8.998685371768481e-02; -1.650605052845311e-01   +4.635726830243105e-01   +6.394379788711527e-01   -3.209955918619992e-02   -9.596160968861105e-02   -1.121522612242980e-01   -4.591740905192922e-02   +2.928635746180511e-01];
L2I_L3I_iGABA_netcon = [-5.409282782875514e-02   -1.784725049434451e-01   +2.722152050501980e-01   +2.198903333152034e-01   +2.597231133203887e-01   +6.816761669471497e-01   +5.923331104056289e-01   +1.288287340238423e-01; -3.346485633801893e-01   +4.352393430540554e-01   +3.550640455697528e-01   -2.265563027415088e-01   -1.592749006366434e-01   -2.292767048821994e-03   +3.501538964029725e-01   +4.069583275816363e-01; +1.671406588295748e-01   +8.634758415591540e-01   +3.812441226515087e-01   +1.018595546382981e-01   +3.169602928282537e-01   +4.967636286848824e-01   -6.893581938481264e-02   +1.182754199391359e-01; +1.311969692248358e-01   -3.541747473699153e-01   +4.618276384665844e-01   -1.584154555298743e-01   -3.006758049663821e-01   +1.634324622477937e-01   +3.570394578727025e-01   +4.139433656780669e-01; -1.691725150649238e-01   -1.841052000514873e-01   +1.272523448247383e-01   +4.246866647060608e-01   +9.629831322969133e-02   +4.398581500805743e-01   +3.429513355825413e-01   -1.811454774844707e-01; -4.124758257294914e-02   +5.835519339810303e-01   +1.355507535745194e-01   +2.307558950153442e-01   +5.107652544662173e-01   +2.072694564225921e-01   -4.907724397107330e-01   -7.642798478525517e-02; -2.526430258228241e-01   +9.903572613531881e-01   +5.375511417775986e-01   +1.425854893948926e-01   -1.843789269094548e-01   -1.282552881336121e-01   +7.880043653215087e-01   +4.166441489101065e-01; -4.503478282624284e-01   +4.192343919966951e-01   +3.535034040781465e-01   +7.398700181147026e-02   +1.184347111030711e-01   +4.400802684366497e-01   +5.218301704094046e-02   +7.815706612588194e-01; -6.700352533961083e-01   +9.066072593927766e-01   +3.563942914651338e-01   -4.559667533690461e-02   +2.675426359358688e-02   -1.729704918711874e-01   +1.892295145135403e-01   +2.125234328291579e-01; -4.872769558518791e-02   -3.432644024816153e-01   +5.991207830931925e-01   +2.353145739913315e-01   +4.284705169555041e-01   +4.194049154982066e-01   +8.654789785191730e-02   +8.297344547919833e-02; +6.286720065099124e-01   -2.500627453746764e-01   -6.371529500510292e-01   +6.243037909476860e-01   +2.245618557054564e-01   -1.874506836498400e-01   +4.500891722654632e-01   +2.365096447454529e-01; -1.841172142347491e-01   +6.564909569306894e-01   +2.487174112453840e-01   +2.782192072004382e-01   +2.253799078774619e-01   +4.204666109776038e-01   +9.043899881587371e-02   -1.898308610428573e-01];
L3I_L3E_iAMPA_netcon = [+2.148471337726064e-01   -7.197675264321826e-01   -1.376491844868460e-02   +1.525732729024457e-01   +6.650721133215323e-02   +2.307207455973054e-01   +2.642771750567071e-02   +4.059930424905753e-01   +7.919147125570206e-01   +6.275553823136294e-02   +1.209954543342513e-01   +5.027576307392924e-01; +1.161145419407052e-01   +2.767122367782145e-01   +1.931252434502451e-01   +5.016352388526658e-01   +4.382818655695591e-01   +3.622966318641795e-01   +4.866240518698552e-01   +8.659640892520917e-01   +5.363655977305335e-01   +1.015492678206548e-01   +1.566782319866607e-01   -4.201317979756817e-01; +2.754557624627125e-01   +3.508186271686875e-01   +2.874518516781753e-01   -3.209730365547273e-01   +8.951302467414820e-01   +3.357013227556375e-01   +6.336907997861997e-01   -2.464385380037805e-01   +5.902747613076799e-01   -6.895029781776948e-02   -1.237217032745849e-01   -3.506339801829404e-02; +1.126385040008248e-01   +2.587335490877436e-01   +1.573571240256243e-01   -3.547651589462744e-01   +5.406474052799842e-01   +4.765363082628153e-02   -2.230058837959338e-02   +5.747651981842701e-01   -4.050566496760005e-01   +3.115393170298264e-01   -5.316718585618242e-03   +4.083909718560350e-01; -2.755530947149963e-01   +2.849941592397504e-01   +7.346093210823751e-01   +5.528869663924955e-01   +3.370464212157520e-01   +6.528104433274542e-02   +6.437485627085503e-02   +1.943736097582812e-01   +2.406406472922709e-01   -9.808944146755334e-02   +8.838205677132040e-02   +7.972738886908552e-02; +3.316352759776630e-01   -2.775731600664758e-01   -3.201176595237111e-01   -1.265871747904014e-01   -1.920404051072075e-01   -3.422910373201933e-01   +6.969556940231330e-01   -1.593095908165621e-02   +1.929561587043102e-01   +4.609762622983073e-01   -8.932547132368771e-02   +1.000000000000000e+00; +3.240421478107395e-01   +2.894669856283947e-01   -1.348877783811694e-01   -1.135979628342908e-01   +2.782086078273809e-01   +9.335436268025828e-02   +2.215801513438490e-01   +1.491140317351392e-01   +2.126462057614161e-01   -6.174860994006863e-02   +1.182634594434030e-01   -1.785926743230960e-01; +2.153601108469147e-01   +3.492800608799826e-01   -2.879632476872652e-01   -3.366614164379409e-01   +4.419075593038117e-01   +3.075763963096401e-01   -6.206129590292243e-03   -2.587300089035429e-02   -1.959471554514577e-01   -3.962719887884773e-01   -5.817703368116819e-01   +2.171016396666098e-01; -2.109221614037244e-01   +6.549084002659551e-01   +3.119173130970821e-01   +8.145371904579959e-01   -5.355433333838858e-02   +5.561762809874767e-01   +3.589403397188283e-01   +4.059805072920611e-01   +2.877633756175110e-01   +5.201765902057700e-01   +1.139311116641772e-01   +3.870363000148310e-01; +9.446231910685062e-01   -6.111045420852590e-01   +4.892908040068203e-01   -2.783015744901873e-01   +2.003695144046581e-01   -4.543320902445503e-01   +9.928029989125750e-02   +2.600831322275243e-01   -1.740653509743683e-01   -2.019379777598645e-01   +5.245814514749075e-01   -4.702415269205830e-01; -2.641032922507272e-01   +7.155426146650504e-01   +3.530722520433900e-01   +2.707171764614880e-01   -1.727193741881750e-02   +5.785469996167506e-02   +5.539129007582615e-01   +3.996183929062745e-01   +5.138613014548447e-01   +2.440783323481591e-01   +7.061346183728683e-02   +6.484261089416887e-01; +6.435634970623220e-03   +1.378709151154126e-01   +1.713351330592025e-01   +4.679059644681977e-01   -1.136064833912181e-01   -1.812241541670771e-01   -4.132942963523084e-01   +3.985526708095464e-01   -1.147698812743577e-01   -2.169563645392640e-01   +2.057931250645633e-01   -2.814939216410028e-01];
L3E_L3I_iGABA_netcon = [-9.527703626405759e-03   +3.304939562105585e-02   +4.245594733991311e-01   +3.503496262562543e-01   +3.647283211904871e-01   -2.993868775514591e-02   -1.878726593025570e-01   +2.940631959607474e-01   -1.271998850230031e-01   +2.858413517713740e-01   +5.333727111412455e-01   +3.795387833362400e-01; +3.010813358454510e-01   -5.212013647217369e-01   +2.549303040647352e-01   +1.680373997429622e-01   +5.209668881882905e-01   -3.202933907776842e-01   +1.337719922839342e-01   +1.321596052675955e-01   -3.019923967849890e-01   +1.299002792216883e-01   -6.942690497024496e-01   -1.063716022285664e-01; +1.536976541179376e-01   -2.131692186607741e-01   -4.504396337202783e-01   -2.272490719146562e-01   -8.870257005147837e-02   +4.393302790737983e-01   +3.150454990219851e-01   -2.159512962220137e-01   -8.369770133642206e-02   -1.428740006905040e-01   -4.151999881017455e-01   +7.691108144512990e-02; +2.984731666743687e-01   -1.005768200177306e-01   -2.946092627429164e-01   +6.093399662528693e-01   +9.183842540447841e-01   -2.331819390028820e-01   +1.027312264392129e-01   -1.013424076776285e-02   +8.904365251629461e-01   +4.706938650449525e-01   +4.091823097384816e-01   -1.430887663175551e-01; +1.208454200030648e-01   +4.541330088285770e-01   -2.525697209865846e-01   +1.449123948527899e-01   -2.556605350512960e-01   -2.206771206894732e-01   +2.951084058057465e-01   +3.016648401912888e-01   -3.539299802055220e-01   +6.788634191973949e-01   +5.145968265525868e-01   +7.579973634722783e-03; +2.534787824076520e-01   +1.838516654018399e-03   -1.857274769386474e-01   -9.576527749474528e-02   +2.521825049364317e-01   +1.517864596859876e-01   +2.356644689792531e-01   +6.459224548897300e-03   +2.932895811877763e-01   +9.876413650884572e-02   -1.166655721967214e-01   +6.991915490446400e-02; -1.894396104361539e-01   +1.643653196763252e-01   +1.400465762124510e-01   +8.070586385613311e-01   -4.906838327743379e-02   +6.394111218280220e-01   +3.268403724873756e-01   +8.179646352172095e-01   -2.954137271041744e-02   +2.801676578998723e-01   +2.872620362054392e-01   +3.067920344454411e-01; -4.890199719789669e-02   +2.225741188193261e-01   +6.522415138452997e-01   -8.438737252960055e-02   +2.211417490520843e-01   -4.481510154142282e-01   -6.555266050556381e-01   +5.565353409400893e-01   -3.853311584391466e-01   -4.237280678476599e-01   +4.964009700358718e-01   +8.756822805266554e-02; +3.127553961003077e-01   -2.053740072357214e-01   +5.940187600803963e-01   -2.843019769391584e-01   +1.840115735194350e-01   -5.275793369892137e-02   -5.608948257790414e-01   -3.393281996966004e-02   +2.861747554333052e-01   +2.978318080502591e-01   -2.579229951910929e-01   +4.958025718914837e-01; +2.659258865897853e-01   -2.422174662924625e-01   +2.678909807829851e-01   -1.146691862649530e-01   -5.330072892018399e-01   +1.611354753881788e-01   -3.996188498716936e-01   +3.038671462436309e-01   -1.911220255702526e-01   +1.278267112226235e-01   +1.978866193408680e-01   +2.339890601573961e-01; -1.420581280836285e-01   +1.331196309580403e-02   +7.615653912900755e-02   -1.285379027788316e-02   -2.231568741799914e-01   +1.414350260268308e-03   +2.872076520671458e-01   +3.073687461920126e-02   +3.058946962844508e-02   -5.783622988190729e-01   +1.455090226190364e-01   +4.139708515599200e-01; +9.412338706925169e-02   -1.282474296556983e-01   -4.920320806036005e-01   -1.892404998625087e-01   +1.000000000000000e+00   +1.172985784063555e-01   +5.548917586312214e-01   +3.866525451896554e-01   -4.794028187426674e-02   -3.730724045039396e-01   +5.908562567419132e-02   -5.153620471610930e-01];
L2E_Input1_iAMPA_netcon = [+8.559983867949693e-01   +8.388828863629060e-01   +7.441424685198141e-01   +4.142165414626207e-01   +2.879823372433353e-01   +2.736015670143080e-01   +8.933135842945631e-01   +7.257304763059456e-01];
L2I_Input2_iAMPA_netcon = [+6.512648058374342e-01   +8.066450889052581e-01   +2.746366492854444e-01   +2.196869932705922e-01   +1.055565400130202e-01   +7.049433966286008e-01   -3.520056451105636e-01   -2.597475041967947e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
