function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147493833114023e-01   +9.460536725644990e-01   +6.996009568784383e-01   +1.554672172799634e-01   +9.222206387204137e-01   +2.193011870699195e-01   +7.402567567685705e-01   +3.014677923273869e-01   +5.327027637308961e-01   +8.297058775560039e-01   +9.687123382773557e-01   +9.643327107219307e-01   +6.958615338191508e-01   +3.710161516772842e-01   +2.972371181179637e-01   +3.782300041816580e-01; +3.451714714838733e-01   +1.395366590531040e-02   +1.409892179035672e-01   +1.748324363343199e-01   +7.201475989984456e-02   +8.071454843038699e-01   +7.947631326173286e-01   +7.577895900580438e-01   +7.846211555609749e-01   +1.818912265795888e-01   +4.657463710185160e-01   +6.560140556477082e-01   +3.754651191652995e-01   +2.750379337380021e-01   +6.850323510095232e-01   +9.534528397896120e-01; +2.078810008191391e-01   +4.670968020352197e-01   +8.307145923739727e-02   +7.032998230360001e-01   +3.145553054678082e-01   +3.819874999853076e-01   +6.635302858160635e-01   +9.523372035433930e-01   +4.917579546450510e-02   +9.264470150224118e-01   +8.694116839299375e-01   +2.094817062503480e-01   +5.414816724437579e-01   +7.506388622765797e-02   +7.721767009573181e-01   +8.118739804557923e-01; +2.538472533036159e-02   +4.900266840392533e-01   +4.326065500673538e-01   +8.322211866107587e-01   +6.276904739084517e-01   +8.559479203224480e-01   +4.417438017173983e-01   +8.403683653592826e-03   +4.627914554021144e-01   +4.209058440846766e-01   +9.458219950374396e-01   +8.979430940482086e-01   +5.179200249903351e-01   +1.507954749895053e-01   +7.201591259791188e-01   +8.910204718862298e-01; +7.659647687625054e-01   +5.153315420744276e-01   +8.948967402884692e-01   +8.114183688962048e-02   +9.055701715920510e-01   +3.243681871583540e-01   +5.745961748683555e-01   +4.071521593715707e-01   +9.385380513663025e-01   +3.014455357625785e-01   +2.329760195483684e-01   +4.880902905552359e-01   +7.635599209475719e-01   +3.646346806102019e-01   +2.786969432169066e-01   +6.815813554059705e-02; +5.709053314074768e-01   +2.876875565669516e-01   +7.323073800850537e-01   +8.352131434095720e-01   +7.970891460395616e-01   +3.790121164056969e-01   +5.175975198250476e-01   +1.515032450624515e-01   +4.727074019817099e-01   +3.488349738556489e-01   +9.184843882337220e-01   +6.617191650461577e-01   +7.955702851542426e-02   +7.186788826717072e-01   +1.387999788836221e-02   +9.035687085831882e-01; +5.767089284610993e-01   +5.644539301993778e-01   +6.802760349880185e-01   +5.411549711322985e-01   +6.428976466173698e-01   +6.369390728743730e-01   +7.248800640636783e-01   +8.206617016659495e-01   +7.794123645227892e-01   +9.727395227298520e-01   +6.347734524981978e-01   +5.264716501778511e-01   +4.739972295252136e-03   +5.323596430698571e-01   +1.480438130468882e-02   +6.685387749060052e-01; +3.904214524392909e-01   +5.095260308383619e-01   +2.006148179878235e-01   +9.631982969891415e-01   +4.407970232072823e-01   +3.881678008775568e-01   +2.230452756745737e-01   +2.875910442306711e-01   +1.092009263791450e-01   +5.310586377187351e-01   +2.833019093296963e-01   +7.083117275697881e-01   +4.002327053808559e-01   +2.321041124269661e-01   +9.363153367567895e-01   +3.471920266764850e-01; +5.561386655833549e-01   +6.786518041348794e-01   +5.291307961090403e-01   +6.773156144072813e-01   +7.479747047114937e-01   +6.693245220628216e-02   +9.979573812865391e-01   +9.786907090518884e-01   +5.221757328399750e-01   +7.898605183573704e-01   +8.550644927783225e-01   +7.190690888328993e-01   +6.622393214881982e-01   +4.709535877783358e-01   +9.331669871525976e-01   +8.368392321283157e-01; +1.830037367648354e-01   +6.152971609265658e-01   +8.302005916052815e-01   +3.368344149819721e-01   +8.252990925693859e-01   +1.677508755074814e-02   +6.200451304700466e-01   +6.248355391485101e-01   +6.366306960297700e-01   +7.932909896805992e-01   +1.654165480179273e-01   +2.948600440708556e-01   +3.676746018373939e-01   +7.166907114989388e-01   +3.747229452402239e-01   +1.990795411986617e-01; +1.182554235615152e-01   +5.656311543251973e-01   +1.750430439693139e-01   +2.212788891121159e-01   +3.412295071751948e-01   +8.787604236879470e-01   +9.798104025556850e-01   +7.437557277478242e-01   +5.782562823054265e-01   +1.452081981400684e-01   +8.281068078479519e-01   +1.170245779078149e-01   +3.916143665808463e-01   +5.142516315105038e-01   +1.096504305785278e-01   +8.416397864740396e-01; +5.907362523699925e-02   +5.045650774060032e-01   +5.189029766838514e-01   +5.692607791180450e-01   +1.394260285151007e-01   +1.579283062193308e-01   +4.947112998774885e-01   +8.734610612067684e-01   +8.350641403175336e-01   +4.560396891665306e-01   +2.166344303966497e-01   +3.248032082141760e-01   +1.348426302605511e-01   +5.143729492742498e-01   +7.197910848840671e-01   +4.253706967391722e-01; +9.329271479756480e-01   +6.676884605688433e-01   +3.555531422511821e-01   -2.505432600736229e-04   +5.041958039889641e-01   +9.142692549950469e-01   +5.237228111316481e-01   +3.289907153709768e-01   +1.160712289925917e-01   +4.581510349355430e-01   +2.679737897698744e-01   +4.561357860654617e-01   +3.382532154285119e-01   +3.858853001245307e-01   +4.495020407056246e-01   +5.584860038481074e-01; +7.455924800028895e-01   +6.329116723091763e-01   +6.443588934225902e-01   +5.884361654996156e-01   +4.132235795340169e-01   +5.560582260762749e-01   +8.554065214035053e-01   +9.908576449732226e-02   +5.280928955895779e-02   +9.536145459682867e-01   +8.595451054783013e-02   +7.173771360979248e-01   +1.225404727738773e-01   +4.795189303806638e-01   +1.201309919863089e-02   +4.479911430143450e-01; +2.427033609257280e-01   +1.455772374027278e-01   +2.816585767298990e-01   +8.918175830864550e-01   +1.716078777463428e-01   +9.225316600728068e-01   +2.533919236996318e-01   +4.506956678199224e-01   +5.173956068676875e-01   +5.332758144315362e-02   +9.164753280466656e-01   +4.054046999969857e-01   +3.691677467736283e-01   +7.396383264784564e-01   +1.236632207183752e-01   +7.596705623247709e-01; +2.040969499276808e-01   +1.790239249343696e-01   +4.372360628234184e-01   +2.543596277163060e-01   +4.942606257682202e-01   +5.973216564674853e-01   +5.821722006583754e-01   +2.393766001523478e-01   +6.968682239235204e-01   +3.678109615640734e-02   +7.264216699572723e-01   +2.419242900600749e-01   +2.512042441107558e-01   +7.018690642578804e-01   +6.584876386553489e-01   +9.565075811990786e-02];
L1E_L1I_iGABA_netcon = [+8.435947228209353e-01   +7.525392944761922e-01   +8.740724333639296e-01   +4.352623124498718e-01   +9.176781623966982e-01   +7.795459199001319e-01   +3.213725705113073e-01   +6.412496619861044e-01   +9.447629328887255e-02   +2.596616593163591e-02   +1.290189782444637e-01   +5.209984869610075e-01   +8.701120450747455e-01   +5.766554867348114e-01   +1.654050465529961e-01   +6.275002548749682e-01; +6.216425587332147e-01   +9.948786472212001e-01   +3.090051742945871e-01   +1.473279415314434e-01   +8.833696950095425e-01   +2.728248693953015e-01   +9.632492062330609e-01   +4.295365930227247e-01   +2.922287234505388e-01   +5.146216422145442e-01   +4.249043077354946e-01   +2.035452979136998e-01   +8.035034831781781e-01   +2.884173598866577e-01   +5.449301806356233e-02   +3.368637137927779e-01; +6.718354779085727e-01   +3.709678460755134e-01   +4.333491575035984e-01   +6.540401372308630e-01   +5.857935830187403e-01   +5.264867113360179e-01   +3.531387020753760e-01   +4.779484731766861e-01   +3.254527935774729e-01   +8.629801112469089e-01   +4.805948162110663e-01   +7.756011322330335e-01   +6.464063732075666e-01   +1.322616686153567e-01   +2.109907339038377e-01   +1.558882183809394e-01; +7.823131824163775e-01   +5.024297555783356e-01   +3.812855626565126e-01   +7.211921074817867e-01   +8.355704188837080e-01   +4.025808775044267e-01   +3.194689645996167e-01   +1.009945062578535e-01   +4.827735707380105e-01   +5.815502279670297e-01   +6.742081828906429e-01   +3.906136290815533e-01   +7.347152825640675e-01   +4.987518065281330e-02   +2.042033144687286e-01   +4.026917176605213e-01; +3.094913083276962e-01   +7.590825337757481e-01   +6.568278742990744e-01   +1.621301670095094e-01   +7.760157482492036e-01   +7.788591107296517e-01   +9.084317669150129e-01   +8.070308435346175e-01   +2.419303350219125e-01   +4.226522435475981e-01   +3.571275831231796e-01   +6.727274861719498e-02   +6.668826958051920e-01   +6.247502335631950e-01   +2.177293216316717e-01   +9.128642485542415e-01; +3.302043695408820e-01   +1.266982338363311e-01   +2.373625198404835e-01   +3.429257199331748e-01   +7.847497599591190e-01   +2.549897698476805e-02   +8.853573466635775e-01   +6.512439350231009e-02   +4.535258747277094e-01   +7.129766726397898e-01   +5.012406364962915e-02   +7.556177319214987e-01   +8.809901043340538e-01   +6.061748496448596e-01   +5.778481104303732e-01   +1.491067853843061e-01; +6.336489200807663e-01   +5.179459905976587e-01   +6.855438183695373e-01   +1.071182878705950e-01   +7.010706680033397e-01   +4.121230883747684e-01   +3.518189584884541e-01   +9.541273239068521e-01   +7.591255122269897e-01   +2.337017229050680e-01   +2.907550727802554e-01   +4.530508789731558e-01   +8.526839252321970e-01   +3.715901476838308e-01   +3.344656652839339e-02   +4.639788491617176e-01; +9.014735143453937e-01   +9.057842311758697e-01   +3.262355361341920e-01   +4.075861529540818e-02   +1.862679376659715e-02   +8.262549251581507e-01   +7.498331915545576e-01   +7.726719574944269e-01   +7.185641173498483e-01   +5.820817917948623e-02   +7.942544897895560e-01   +3.187022718435989e-01   +4.037553713084306e-01   +8.317874358462173e-01   +7.947824430506102e-01   +7.929440001896622e-02; +3.714081470069737e-01   +9.926402128523869e-02   +8.811104524685627e-01   +4.785918265158691e-01   +3.308846645653390e-01   +5.923927452736354e-01   +1.263153871581494e-01   +4.403234442074180e-01   +2.372002596656360e-01   +9.769905237801618e-01   +6.514594744410914e-01   +2.774732821703166e-01   +1.060898835861827e-01   +5.193740253736984e-01   +1.344915953031043e-01   +3.425625189055010e-01; +8.816920103634939e-01   +1.789123766100258e-01   +9.986067239047932e-01   +4.765555231345065e-01   +9.476090659455974e-01   +2.130470641330360e-01   +5.990581488705725e-01   +1.661280623371443e-01   +6.992556847921133e-01   +9.693052627041622e-01   +7.103825551272530e-01   +5.838941660375667e-01   +4.033921836791025e-01   +8.010840696307299e-01   +5.825406297384625e-01   +4.969106924396829e-01; +1.248747768433906e-01   +1.728219710576329e-01   +6.808561802144443e-01   +5.460964204258948e-01   +3.984597175607024e-01   +2.958137199598670e-01   +4.366861789277408e-01   +8.060155290065688e-02   +3.048748771020260e-01   +1.366582832388392e-01   +7.649594512765098e-01   +9.119956079686288e-01   +3.410680457267430e-01   +5.704932113346579e-01   +8.545053099265285e-02   +4.890925505566541e-01; +8.872793733012718e-02   +5.341631052896834e-01   +3.442739691217152e-01   +6.510796222677158e-01   +6.320591516236188e-01   +2.680273208016880e-01   +9.595552625527676e-01   +7.417253645532997e-01   +4.698176332596011e-01   -2.286472952643201e-04   +3.834670468469981e-01   +4.502808938017506e-01   +1.147698484012601e-01   +7.143886406351591e-01   +2.287981232061447e-01   +1.272047359426336e-01; +5.459538774889595e-01   +9.792383597806440e-01   +5.606816183606520e-01   +3.492397819313103e-01   +8.595027936657265e-01   +9.281649124059881e-01   +9.643828804667377e-01   +5.437006202995026e-01   +4.444395413689262e-01   +9.363661504235913e-01   +3.617671475268158e-01   +9.802587108821297e-01   +8.523451156308531e-01   +7.332394894781098e-01   +4.520008129124127e-01   +8.553690533422716e-02; +6.107542199771410e-01   +8.439427091952507e-01   +8.911086803458438e-01   +2.565133152397269e-01   +3.767590770642390e-01   +5.531317661226848e-01   +2.427695475791357e-01   +4.858452584144539e-01   +7.338941445765702e-01   +7.408791842229255e-01   +8.097626503883260e-01   +1.112293052031328e-01   +8.927841791928147e-01   +4.551760243348468e-01   +1.779955643807893e-01   +6.741665102209417e-01; +7.272085896941524e-01   +6.725290262096226e-01   +6.468717016164081e-01   +1.761163241388731e-01   +2.049545970246932e-01   +4.320142138173562e-01   +7.708310601874117e-01   +8.961126118899339e-01   +8.767676995450833e-01   +4.323707255870352e-01   +3.858466480164041e-01   +4.155827288906268e-01   +6.859070767483176e-01   +2.834498108218834e-01   +4.141808280676363e-01   +1.221543379428700e-01; +9.917478571363532e-01   +9.541580468430117e-03   +3.767819765815320e-01   +4.785647024100664e-01   +9.117231107341759e-01   +3.272860531426027e-01   +7.125093080778284e-01   +5.822112121213303e-01   +9.132405513668787e-01   +9.443417859647895e-01   +8.711900667374263e-01   +3.835327229331244e-01   +7.428361314076645e-01   +1.514048590038900e-01   +9.654034627292628e-01   +9.885742844205715e-01];
L2I_L1I_iGABA_netcon = [+5.737744386109482e-01   +5.646706800828265e-01   +1.084996014768715e-01   +4.600905145456961e-01   +7.965261480940939e-01   +9.782523483221988e-01   +2.241507053686518e-01   +7.589299751146577e-01; +5.587242917962219e-01   +9.535025741193197e-01   +1.183386946879450e-01   +5.670267382133918e-01   +5.419400579428802e-01   +4.225365039123630e-01   +6.629568759300423e-02   +5.061552050440192e-01; +6.113425214879551e-01   +8.460660508133792e-03   +4.339941155136255e-01   +8.164712407358905e-01   +2.577837742096470e-01   +3.930921870027526e-01   +8.354819722163068e-01   +8.286796355575567e-01; +4.667756760050922e-01   +1.266853641660794e-01   +9.323376110348434e-01   +3.554111545485826e-01   +7.808602431625737e-01   +4.613030692805975e-01   +4.138576564418438e-02   +9.278955487524382e-01; +4.341660162893496e-01   +8.540743300859496e-01   +1.400483277980322e-01   +2.479883780329680e-01   +7.797659522096700e-01   +1.215268614110255e-01   +9.098988492075315e-01   +7.107198343335402e-01; +6.309845293733127e-02   +2.179618546666161e-01   +8.260918821991423e-01   +7.705848787262436e-01   +1.441803642200260e-01   +4.547453359306093e-01   +4.491058278972227e-01   +7.983470048140897e-01; +6.467279270236314e-01   +7.102093073284927e-01   +9.327498511484469e-01   +1.920644062509878e-03   +8.235339852573081e-01   +2.648010318298712e-01   +2.846570636216620e-01   +9.591574585342937e-01; +4.266511194532675e-01   +7.744191898216107e-01   +5.732025565447582e-01   +2.768112438630061e-01   +6.237731827809814e-01   +9.269173586777714e-02   +7.554971105965489e-01   +9.520456600979963e-01; +7.561712219770544e-01   +4.213693241503666e-01   +4.988941726128779e-01   +2.280599829154084e-02   +4.561375368088704e-01   +6.617929021404484e-01   +9.266619006026210e-01   +2.957877120814263e-01; +3.058633246204248e-01   +7.252797449834412e-01   +9.310261205821097e-01   +6.703901312887072e-01   +4.832509619752643e-01   +9.449793264851534e-01   +1.410777838398593e-01   +3.519907664387196e-01; +5.972330251725184e-01   +4.577554848629533e-01   +8.626994386597756e-01   +9.672651964808480e-01   +2.187972989127415e-01   +7.653832864425708e-01   +9.558430826565961e-01   +5.412699069602521e-01; +3.349069845230436e-01   +8.053392662942871e-01   +2.540870952351900e-01   +9.457685792054500e-01   +8.574273536006095e-01   +4.277805803523427e-02   +3.046037257400732e-01   +2.130795941258289e-01; +6.435423560113667e-01   +4.281752941196865e-01   +4.580747890539072e-01   +4.560356745602515e-02   +8.805457332194777e-01   +2.608764689732897e-01   +2.098709238248453e-01   +8.096459366193343e-02; +1.034660937189570e-03   +1.491219890731631e-01   +7.409752257729071e-01   +2.869676318366080e-01   +8.460965332359279e-01   +6.342071251240472e-01   +4.639395296591015e-01   +5.068621479615261e-01; +1.446564527328190e-01   +8.047921571110617e-01   +7.529145295635172e-01   +4.870943968903236e-01   +4.426065173218444e-01   +8.921396885642048e-02   +5.976972347183073e-01   +1.949272577337677e-01; +2.476086900699673e-01   +3.816960155176661e-01   +2.299019391666773e-01   +8.877325136207207e-01   +5.429789244729180e-01   +7.530930790714155e-02   +5.515479589465191e-01   +1.457902254353856e-01];
L1I_L2I_iGABA_netcon = [+6.989635089959590e-01   +8.666496813779674e-01   +6.146566049566007e-01   +5.481067889027422e-02   +1.430947754549856e-01   +2.345085433976537e-01   +8.380155808005050e-01   +3.702782712761583e-01   +7.068507663282414e-01   +3.842606742399928e-01   +2.396164195247815e-01   +6.663242347620779e-01   +1.682938308215630e-01   +5.698666883533345e-01   +4.373069812307143e-02   +4.871422316529603e-02; +5.987679188639219e-01   +7.977753964317704e-01   +6.103825974064363e-01   +5.742106912989926e-02   +7.446557469866919e-01   +5.566671815533235e-01   +1.974047106012197e-01   +5.584291139470529e-01   +1.865744955852371e-01   +7.198822421631411e-01   +5.136536663826015e-01   +3.287535396888409e-01   +1.143915350579028e-01   +8.095550167810582e-01   +4.425303036342679e-01   +9.214483105608740e-01; +1.627495673666685e-01   +6.274440459837115e-01   +3.148252758878191e-01   +5.970453491564832e-01   +9.515673652424160e-01   +1.142151021618783e-01   +6.174101465953086e-01   +8.295760002530507e-01   +2.309911634186785e-01   +6.422605270543329e-01   +7.319578350226968e-01   +5.513220190507946e-01   +7.358374977614536e-01   +6.741199684365330e-01   +9.171251236820389e-01   +1.739141202104828e-01; +4.835146311290236e-01   +4.724616672362937e-01   +1.426329856734566e-01   +6.577209659522968e-01   +2.662353679674750e-01   +8.181784322254326e-01   +1.550398326647594e-01   +7.069157873564766e-01   +9.987945355276258e-01   +1.019206440425864e-01   +7.704083128588670e-01   +5.323370647248260e-01   +2.108853479170735e-01   +4.435272006405059e-01   +8.846676227340435e-01   +7.442831906171905e-01; +2.857770896649333e-01   +1.871987409635465e-02   +6.055429300296095e-01   +4.807750103676715e-01   +9.480076259578658e-02   +6.505721103253747e-01   +5.836586469995035e-01   +1.160214747196251e-01   +9.061025791280624e-01   +4.920399983816123e-01   +6.772975590370411e-01   +9.012008228217425e-01   +4.842268619281711e-01   +8.940142413763382e-01   +9.253379279069639e-02   +4.749487144731942e-01; +4.036950499222959e-01   +1.179984592326783e-01   +8.892065517659172e-01   +9.785138877146370e-01   +2.318892925442390e-01   +2.380100365098333e-01   +5.452597176719203e-01   +7.406954149113624e-01   +1.126479497355743e-02   +5.609393638736088e-01   +8.136798179297215e-01   +2.834777792444502e-01   +5.066819020574044e-02   +7.831225799137405e-01   +6.758040973337566e-01   +2.467345259576754e-01; +4.918214544411209e-01   +7.194256010845723e-01   +5.622979115955039e-01   +8.640583026103895e-01   +8.955756722828561e-01   +3.018224444066192e-01   +6.812069090850856e-01   +9.243321889219478e-01   +8.334133216958300e-01   +5.577125021395092e-02   +4.187556034943815e-01   +1.391716817863139e-01   +5.712022107335535e-01   +5.819984211762400e-01   +9.304242524499736e-03   +6.629731604683710e-01; +8.627298918937708e-01   +6.824403565410606e-01   +6.332700176617690e-01   +9.547000596057661e-01   +1.998585205018507e-01   +3.306196163630271e-01   +6.988318677441779e-01   +9.238204970155556e-01   +2.537233620875022e-01   +8.873581940655038e-02   +4.976378834429839e-01   +9.577578420880288e-01   +4.911770494284772e-01   +6.159285557685776e-01   +1.217821388148792e-01   +6.088633845453968e-01];
L2E_L1E_iAMPA_netcon = [+3.678499701740159e-01   +5.616740199826259e-01   +2.010061288547606e-01   +5.134499551932883e-01   +2.902808465317214e-01   +7.444028868534969e-02   +2.789318825505815e-01   +2.666620351770123e-01; +4.370865187822263e-01   +1.929846439657329e-01   +1.367799560339327e-01   +6.856442647297214e-01   +6.197339291308375e-01   +5.930012374285343e-01   +9.293314510167412e-01   +9.044340247505448e-01; +7.180694588645373e-01   +6.129600290682051e-01   +8.208519358690328e-02   +2.066404240929202e-01   +8.626353250335053e-01   +7.556448716744786e-02   +7.644281400430095e-01   +1.592993266418273e-01; +1.911600635962508e-01   +7.407544694037161e-01   +9.075929008341732e-02   +9.711905958262814e-01   +8.205875454972359e-01   +3.972151084077649e-01   +2.615204541008155e-01   +5.537356353824799e-01; +4.027300573675963e-02   +8.314128188038914e-01   +5.514476451452395e-01   +3.501195961940925e-01   +2.054940515741125e-01   +5.893520754082661e-02   +2.433894563641509e-01   +4.220882186274068e-01; +3.148927548120209e-01   +2.767042181613458e-01   +7.320663813254665e-01   +1.849698135945091e-01   +7.506400413830230e-01   +1.284758885280392e-01   +1.653828302220939e-01   +5.468465421237745e-01; +7.899727093616568e-01   +6.083525531735190e-01   +5.445852248090987e-01   +2.382142676661542e-01   +1.985283685283856e-01   +2.450164987363641e-01   +2.874923564121544e-01   +7.545811036301202e-01; +4.707732155338102e-02   +5.475913778581651e-01   +5.469531194769682e-02   +2.539397076984470e-01   +5.777853248002676e-01   +9.442435692916463e-01   +5.641547444180117e-01   +1.392546819674633e-02; +2.156467402936161e-01   +2.737701037438141e-01   +6.329217201405050e-01   +2.228293050010214e-01   +8.769892681380196e-01   +2.032670825536318e-01   +4.051547763199372e-01   -1.603718230533720e-03; +2.739061955364994e-01   +3.394478731949440e-01   +9.940054274124041e-01   +3.577704949543423e-02   +7.147338491849946e-01   +3.279362657106317e-01   +9.875513168623954e-01   +2.106989934222553e-02; +7.898311830059206e-01   +5.666353349829198e-01   +9.152362581412193e-01   +3.567467708169396e-01   +7.006919056386796e-01   +8.665587689064945e-01   +5.447093951022798e-01   +3.591197814577208e-01; +9.903163292305722e-01   +7.436304267426975e-01   +7.682453886851346e-01   +8.986493973241546e-01   +4.680347206052770e-01   +9.227351262245429e-01   +9.293267738376638e-01   +4.267579288671341e-01; +9.477405548833413e-02   +7.724648216544325e-01   +1.904941122996514e-01   +1.407314580965346e-01   +5.040406670738083e-01   +2.380242713951605e-02   +9.928983806943941e-01   +5.445581054720324e-01; +1.959126193494019e-01   +3.976807114310486e-01   +3.163300867556848e-02   +9.554705466387131e-01   +7.962447957772725e-01   +3.647547986785694e-01   +8.365038465519834e-01   +4.921115367171040e-01; +1.164775605293533e-01   +1.486385311547304e-01   +3.731530298392957e-01   +9.021425623782079e-01   +9.401086019547662e-01   +5.276706667204419e-01   +1.809336613818770e-01   +9.205680122155899e-01; +6.472856149221730e-01   +2.075140930129651e-01   +5.753115048466287e-01   +4.107011684484464e-01   +7.823914072817486e-01   +4.071372169177504e-01   +3.138718039120518e-01   +4.160950425352220e-01];
L1E_L2E_iAMPA_netcon = [+4.965368687684795e-01   +4.489073957348472e-01   +6.157854884351672e-01   +4.907305682121100e-01   +2.299257910738086e-01   +7.205853137138420e-01   +6.946205006357773e-01   +6.331377336603093e-01   +5.220534385266131e-01   +2.416440933648561e-01   +8.766490549268823e-01   +1.735366355893098e-01   +1.378798768162608e-01   +2.435909442505821e-01   +1.832422342458314e-01   +2.365573519818948e-02; +8.386378529891885e-01   +3.693284558962179e-01   +1.041756354845500e-01   +6.611513875513286e-01   +8.358207096288021e-01   +3.804471121105318e-01   +9.792576144371020e-01   +6.266416344254691e-01   +6.727501032707880e-01   +7.285361689107193e-01   +6.587788436419487e-01   +3.021979101372116e-01   +2.819862235292248e-01   +7.489109370121326e-01   +1.462513506880160e-01   +2.505280484109845e-01; +1.849734229592459e-01   +3.008969596401700e-01   +7.525844570846816e-01   +1.788414447246905e-01   +7.342345267336849e-01   +3.836917298975373e-01   +7.502290300659893e-01   +4.065833511724211e-01   +7.781153572609638e-01   +1.363832872044529e-01   +5.377376480997742e-01   +1.091800328139910e-01   +6.975960836097431e-03   +9.368103824973236e-01   +1.318351939068211e-01   +9.892227237747995e-01; +3.367234400146151e-01   +2.325755586991122e-01   +5.365350079714428e-01   +4.800458356440984e-01   +4.887048072865651e-01   +7.156804512847141e-01   +5.540503769403506e-01   +4.252309031940851e-01   +4.645187808220922e-01   +4.085063205375710e-02   +2.524986303872340e-01   +4.514663100457568e-01   +3.061147343591685e-01   +2.975120872069274e-02   +1.716317740302691e-01   +6.298544068441160e-01; +6.921694645869154e-01   +1.365730717887722e-01   +4.438092439492635e-01   +4.985937639837162e-01   +8.486830685190841e-01   +8.393399260178840e-01   +2.989506969690476e-02   +5.106476302898769e-01   +9.077443913676809e-01   +6.498552139728100e-01   +1.045263635478520e-01   +5.844062948151204e-01   +9.049159712292210e-01   +4.352831890641423e-01   +9.228427109023083e-01   +3.578437239190241e-01; +6.926051360294819e-01   +9.971434362889604e-02   +7.429256049540488e-01   +6.000294845215051e-01   +7.154038631669333e-01   +6.683887921464201e-01   +1.947230241516244e-01   +2.595023155644081e-01   +2.560491972704055e-02   +2.000799990378066e-01   +9.720754679744587e-01   +2.243520940568817e-01   +2.944197985042941e-01   +8.306954748572604e-01   +2.587046471028714e-01   +9.398743885292017e-02; +3.680523499333675e-01   +2.269487740855161e-01   +3.879580193397741e-01   +2.405914034688379e-01   +5.211130773226542e-01   +6.509979746534158e-01   +9.414489108272076e-01   +4.233674759362545e-01   +4.795600847142906e-01   +9.735935313615420e-01   +5.973273647364237e-01   +1.105442062249654e-01   +8.328160970113453e-01   +9.996365612436763e-01   +2.058882978984457e-01   +4.097161760147806e-01; +3.487437466720949e-02   +3.461032481380976e-01   +5.259698928471136e-01   +5.166034878983486e-01   +9.379621169880609e-01   +5.634381851718092e-01   +3.975945806643909e-01   +5.237929351001851e-01   +2.716385221759277e-01   +8.207932312007284e-01   +8.188459957549445e-01   +5.603421499894913e-01   +7.451408397817209e-01   +9.202139529740863e-01   +6.133131423058754e-01   +9.312504761535317e-01];
L2I_L2E_iAMPA_netcon = [+6.777998909785816e-01   +6.145474046166366e-01   +4.136528177967211e-02   +7.932312267257895e-01   +5.244918614205635e-01   +8.261678647248996e-01   +6.439494897406856e-01   +3.863596619021738e-01; +2.342021509459400e-02   +9.451869454248436e-01   +5.412702762555957e-02   +9.293820960081377e-01   +5.475869179914721e-02   +1.078435413041056e-01   +3.946739703194582e-02   +1.669993849391943e-01; +7.332768732120795e-01   +9.636460855921657e-01   +4.008549109699455e-01   +9.366578744367287e-01   +2.867513735682560e-01   +2.315327836376370e-02   +5.685260389843350e-01   +4.439801749563193e-01; +2.126794002295600e-01   +3.684257535165841e-01   +9.835540017422555e-01   +1.462547117453197e-01   +7.100802252870255e-01   +1.178111630576459e-02   +3.038628253685612e-01   +8.731766240166450e-01; +8.603313595506434e-01   +7.950689248796671e-01   +7.126179317752119e-01   +3.192541966242474e-01   +8.786123568009458e-01   +3.364282841744973e-01   +2.612425415088082e-01   +4.111742628225691e-01; +1.573454423404423e-01   +7.280489874930600e-01   +9.880737369305297e-01   +4.277419303261875e-01   +3.662040951829654e-01   +6.632348874610120e-01   +7.217457689592220e-01   +1.625792111356859e-01; +6.685388060380704e-01   +9.540434890023323e-01   +6.455233768409994e-01   +7.011181605036889e-01   +5.609792513102732e-01   +5.952531757786735e-01   +3.055688888244200e-01   +6.625310300593473e-01; +9.359260115049981e-01   +1.152347432081022e-02   +5.025034059387101e-01   +6.156703782522481e-01   +8.838979401251690e-01   +8.095582018629556e-02   +8.948807150287813e-01   +9.255859064540209e-01];
L2E_L2I_iGABA_netcon = [+6.028674607918531e-02   +5.186692264842550e-01   +3.524313588460390e-01   +2.620770424181477e-01   +4.267680163275710e-02   +8.906791800327956e-01   +3.443374351561069e-01   +4.513302328743963e-01; +3.536748769194393e-01   +6.971651381039537e-02   +5.572108617027532e-01   +9.851043396341929e-01   +3.609390730717027e-01   +5.405686496063902e-01   +9.350066746411431e-01   +6.713316632477697e-01; +9.315728593409340e-01   +1.841027641232869e-01   +6.920169460335260e-01   +3.493562702985007e-01   +3.579706647470689e-02   +7.171661013810524e-01   +9.186993085014228e-01   +7.688879027601671e-01; +2.421020664414414e-01   +3.174904746606850e-01   -6.373173267699272e-03   +4.026639678656392e-01   +4.855333890940926e-01   +7.109568397970510e-01   +7.251482177297267e-01   +9.269744301250656e-01; +1.024105857517630e-01   +2.438615231272270e-01   +4.770602528048038e-02   +7.519318547829610e-01   +7.234806076082547e-01   +1.696279303186654e-01   +4.430322970600405e-01   +6.585099980708966e-01; +7.163092059299269e-01   +3.226121571687549e-01   +3.075434136020400e-01   +1.011030639790897e-01   +1.419670974554909e-02   +3.522821630706441e-01   +1.509278764876451e-01   +5.020227463866799e-01; +5.590036283577640e-03   +8.788696992236270e-01   +8.690650804393912e-01   +5.904949566145941e-01   +5.174356301681112e-01   +3.787568823245209e-01   +8.313744052672113e-01   +3.416206619755469e-01; +1.854975275492709e-01   +3.007515207095978e-01   +6.272487791057002e-01   +1.239487004744535e-01   +2.393257323174960e-01   +7.572843537150228e-01   +2.569849526804445e-01   +9.458795417439514e-01];
L3E_L2E_iAMPA_netcon = [+7.992085541420749e-02   +1.483651449055832e-02   +3.682591899541105e-01   +4.961399387273192e-01   +1.708272906397389e-02   +9.557556577735641e-01   +3.594806746814599e-01   +1.344876024346421e-02   +2.040886386341369e-01   +6.225121137891063e-02   +2.435954538613139e-01   +9.984535491243689e-01; +9.526684559435674e-01   +9.767838771295649e-01   +1.165703621940795e-01   +6.594271725369213e-02   +8.058511790767161e-01   +3.874677413317884e-01   +2.245658821421528e-01   +1.208138008203855e-01   +3.566564659977940e-01   +7.411891947514189e-01   +5.340666955937342e-01   +3.442614798827733e-01; +6.627443685408194e-01   +7.240374256731000e-01   +5.145171748454803e-01   +8.617693831459948e-01   +7.916974452896325e-01   +6.645700222206028e-01   +7.250746323514026e-01   +6.694897289820317e-01   +8.878229969190766e-01   +9.903115540174567e-01   +3.332473018501096e-01   +8.221382921843949e-01; +1.686545332505923e-01   +8.724925838285141e-01   +6.953893252396489e-03   +9.966370564195765e-01   +4.234326141917219e-01   +5.854405469967361e-01   +7.721640615202509e-01   +5.078439872698783e-01   +8.081953174975504e-01   +7.672224756992194e-01   +6.745610378866523e-01   +1.089384994424432e-01; +1.968518554544902e-01   +8.153361858251079e-01   +8.691833557460081e-01   +1.226938214150017e-01   +6.309391728968373e-01   +5.924531303518878e-02   +3.423581041598495e-01   +6.979187166157942e-02   +3.197817034736625e-01   +8.818586592834454e-01   +8.752283248725392e-01   +7.731392301804232e-01; +9.952763211570546e-01   +3.039821696269316e-02   +9.037528264720337e-01   +1.003046784732048e-01   +5.684126971165330e-01   +7.548614353501533e-02   +5.759656420188207e-01   +5.355002525693719e-01   +6.007052405697084e-01   +3.630847350697756e-02   +9.829189559197559e-01   +1.500267129960630e-01; +9.255420628389995e-01   +9.640072993060361e-02   +1.127291218841675e-01   +1.495969297856188e-01   +8.959714244130322e-01   +2.282004967310126e-01   +6.432821968548051e-01   +6.779537136532562e-01   +6.988350313306777e-01   +7.942999105350522e-01   +1.455918191932072e-01   +7.309536207749412e-01; +9.822751665616349e-01   +8.540859690115737e-02   +4.426514567283324e-02   +1.292079391198337e-01   +7.493684136102162e-01   +4.206692828386688e-01   +3.665770036094562e-01   +5.880280749925457e-01   +1.777458281122375e-01   +7.065560935366113e-01   +8.765843736321757e-01   +1.088173798308680e-01];
L3I_L2I_iGABA_netcon = [+7.685279693430415e-01   +5.349422879425166e-01   +5.965508941237567e-01   +3.036290838949408e-01   +9.653172338292452e-01   +1.146064540179728e-01   +2.976147063946045e-01   +7.950134623205714e-01   +9.141856277363249e-01   +9.959330389690526e-01   +3.099870594926188e-01   +9.966463554888397e-01; +6.363133646653437e-01   +4.531354476707591e-01   +5.635269036793786e-01   +7.634152048059455e-01   +5.437585527571162e-01   +7.088533914721362e-02   +1.674132013279789e-01   +5.222416606461298e-02   +3.859927636777176e-01   +2.875964101717592e-01   +4.421243963819070e-01   +9.150234427944343e-01; +7.959712644601580e-01   +1.146943703680537e-01   +6.810108713792566e-02   +6.475711383251194e-01   +9.817647982756269e-01   +5.052394600612705e-02   +7.247138327284182e-01   +1.811842843669054e-01   +7.514323656301640e-01   +5.156184899682029e-01   +2.094975537723386e-01   +6.908747829415993e-01; +9.591555273954364e-01   +7.208828915774006e-01   +7.681699622235727e-01   +3.321836886256525e-01   +1.247100456765185e-01   +1.305627773908134e-01   +2.987899518157914e-01   +2.460907937559224e-01   +8.783054629314977e-01   +3.586402533711184e-01   +9.409111552083440e-01   +2.210141883245790e-01; +7.174633729387796e-01   +1.852052192917200e-01   +8.682243480696941e-01   +9.705947243019382e-01   +1.685656783461679e-01   +4.909279278609722e-01   +6.781916940166172e-01   +2.613622538193108e-01   +3.922585607965960e-01   +5.170424266147829e-01   +2.904859117678812e-01   +3.141405375842786e-01; +6.439530370475446e-01   +3.249107833630403e-01   +7.095702539661316e-01   +5.321377424724175e-01   +3.342663348704381e-01   +4.680700065952712e-01   +7.465495823479157e-01   +6.476464539701102e-01   +1.672374183355853e-01   +5.009121398520232e-01   +1.221593957787874e-01   +2.368376033077547e-01; +5.113759168150981e-01   +9.673273542183266e-01   +1.085396165624160e-01   +7.517260797747879e-01   +5.308482082763492e-01   +1.585043778815408e-01   +7.453084746909532e-01   +9.782553289441920e-02   +4.370923372929878e-01   +1.883216478011598e-01   +6.980655801472979e-02   +7.086350281729401e-01; +9.514732127307287e-01   +7.011119310716196e-01   +6.652638192438672e-01   +2.704500671318789e-01   +6.924778750463150e-01   +1.382983786746410e-01   +7.848054369456713e-01   +4.691745397898130e-01   +8.582616079754091e-01   +4.774511492702168e-01   +7.289338766146034e-01   +3.750136742608095e-01];
L2E_L3E_iAMPA_netcon = [+6.561072702800761e-01   +3.867919492941996e-01   +2.347048614484315e-01   +4.634677006747961e-01   +9.050002273218929e-01   +9.502143157978478e-01   +7.625421190519028e-01   +3.548743559948365e-01; +3.842312542800308e-01   +2.326210404999884e-02   +9.043028567460779e-01   +2.835513611920317e-01   +6.798408748060629e-01   +2.630100618742452e-02   +9.033681241884739e-01   +6.641621017691242e-01; +3.080638623246273e-01   +3.301151213064480e-01   +4.874757824075373e-01   +2.761666546946173e-01   +8.421355705018815e-01   +5.011558699253075e-01   +7.960100711346445e-01   +5.923079309704922e-01; +1.574134949360397e-01   +4.846318202380514e-01   +5.962227688359361e-01   +1.420810964273012e-01   +9.454714929844728e-02   +3.388592679308207e-01   +9.563285056790616e-01   +5.476753602180211e-02; +7.779083791984132e-01   +2.614340813598380e-01   +9.553562637843824e-01   +1.399425741725628e-01   +7.351508664157025e-01   +6.718988799848302e-01   +5.352120407986998e-01   +2.164678017569379e-01; +7.093031377096479e-01   +5.267303810073114e-01   +8.513852227531243e-02   +2.655921218801432e-01   +5.431561006602977e-01   +1.678568079695754e-01   +1.642198081630507e-01   +6.026706282990409e-01; +1.732524346513269e-01   +4.166708290391267e-01   +2.228201010454416e-01   +6.103462195812914e-01   +2.562359418145584e-01   +2.270144558960338e-01   +1.350484932341968e-01   +2.691530544658354e-01; +4.482101431596620e-01   -4.849851129854269e-03   +1.513078143812992e-01   +1.058213126882243e-01   +7.144620794517275e-01   +1.181812468685627e-01   +3.413463117147644e-02   +1.094294057038364e-01; +8.376356038942031e-01   +8.938977825889166e-01   +3.893039970968438e-01   +4.850350625572529e-01   +3.599094671958579e-01   +9.928932695550916e-01   +6.809022311551779e-01   +2.115191108972363e-01; +6.970298556887903e-01   +2.383207191261396e-01   +1.852214188535454e-01   +8.934666574618203e-01   +8.543795289642236e-01   +1.397062646871813e-01   +5.872664928592676e-01   +8.732637384804188e-01; +7.652567221788495e-01   +7.928599928768688e-01   +7.629207915749883e-01   +1.880650452822076e-01   +8.188187256077102e-01   +7.688578313687792e-01   +2.990615395757438e-01   +4.592746692159636e-01; +9.800133124492548e-01   +5.788485040681174e-01   +2.289014092967652e-01   +5.176645347781282e-02   +6.110856421973502e-01   +6.346369525695678e-01   +7.391386101977561e-02   +7.271439910774476e-01];
L2I_L3I_iGABA_netcon = [+5.894874368691330e-01   +1.473148987380004e-01   +3.443278013948062e-01   +3.693520868368756e-01   +5.991394898223522e-01   +5.073319143428844e-01   +7.734687071969796e-01   +2.649050670995716e-01; +8.458792521958834e-01   +9.906388302178393e-01   +4.625346949382617e-02   +5.374880150879161e-01   +4.783608217344088e-01   +2.371245326689629e-01   +1.789854634663127e-01   +5.853149048448065e-01; +6.051402276914671e-01   +4.809964008065502e-01   +9.420970854276826e-01   +9.748227036187883e-01   +3.769807517522024e-01   +2.719555146002338e-01   +4.542892462369794e-01   +6.794732664193360e-01; +7.436748918577124e-01   +3.544528015490066e-02   +8.674841741331086e-01   +9.971032279477109e-01   +9.783490229922469e-01   +4.054372229557032e-01   +3.055586654375166e-01   +4.151809246770671e-01; +8.491972842723891e-01   +2.699279505690985e-01   +1.329371083120840e-01   +4.150295631262814e-01   +1.385614713574383e-01   +2.600643484886020e-01   +3.875700952681132e-01   +5.118828770630308e-01; +1.462349409039932e-01   +6.762010352399502e-01   +5.914503356391484e-01   +4.512724690470735e-01   +2.712732229381418e-01   +8.541372127572937e-01   +8.032633867662275e-01   +8.147435599165773e-01; +7.419430289752468e-01   +1.473825433325366e-01   +6.259947945439284e-02   +2.548464065014086e-01   +2.253768932232194e-01   +4.794892146656911e-01   +7.782189505290424e-01   +5.445644389410368e-01; +1.731464883640278e-02   +7.744095644814977e-01   +9.474268760100454e-01   +6.013468783904085e-01   +7.906120347889217e-01   +3.413037056692241e-01   +6.449971274761517e-01   +5.891396885527187e-01; +2.285106850694019e-01   +2.675003559033148e-01   +4.967184749741420e-01   +7.815541520485991e-02   +8.171344967585740e-01   +6.394441416534831e-01   +2.418755334310898e-01   +5.353580730120818e-01; +5.374987985454371e-01   +8.812292156993199e-01   +2.641386848525317e-02   +9.122109901468737e-01   +7.920731128586704e-01   +4.158997676705889e-01   +6.096412694002177e-01   +5.419478333896152e-01; +7.208331470736511e-01   +3.684640083681180e-01   +5.751601319164784e-02   +4.725457292159903e-01   +1.128310335215365e-01   +5.429133538124705e-01   +4.199965305777190e-01   +1.512733200892778e-01; +4.336255486982415e-01   +9.786645929182079e-03   +3.002913410750720e-01   +5.083638005591392e-01   +6.330211171862238e-01   +3.392371742432914e-01   +2.939039146561595e-01   +7.027797567264401e-01];
L3I_L3E_iAMPA_netcon = [+6.479250181575959e-02   +7.736801111804458e-01   +5.554786894289624e-01   +5.734355001167580e-01   +9.201306666609871e-01   +8.348451135496682e-01   +8.490273776168795e-01   +8.626321353670482e-01   +5.339516469375721e-01   +9.884068617291317e-01   +4.814318964285117e-01   +3.509329341303486e-01; +9.221635016677202e-01   +8.392600186394278e-01   +8.444055055447005e-01   +9.350194448380896e-01   +5.919791262118886e-01   +3.924831792183927e-01   +6.281905256778000e-01   +8.559717664668227e-01   +5.669024720074303e-01   +7.012076119949817e-01   +7.392877744845573e-01   +3.999275046083277e-01; +1.807742560497502e-01   +5.925986395465966e-01   +9.690730677662095e-01   +7.790064312201417e-01   +5.748823989178026e-01   +6.932688810072862e-02   +4.446171886511454e-01   +9.493035731137086e-01   +9.804375484739977e-01   +8.439746752821198e-01   +5.948520304539610e-01   +9.872919247576071e-01; +5.437978707349520e-01   +7.675280963372628e-01   +4.670385052877751e-01   +5.977114030754183e-01   +6.584335300140980e-01   +3.732947751101310e-01   +2.346618887753213e-01   +6.935430623557877e-01   +9.679291133285013e-01   +7.381590553563030e-01   +2.631850462747177e-01   +2.970382235151247e-01; +3.969035624546741e-01   +6.583325896209526e-01   +7.758937372425073e-01   +5.794323487867206e-02   +4.351400748176734e-01   +8.499461111174318e-01   +5.045045499925017e-02   +3.635974195240054e-01   +5.604653211293402e-01   +9.958476769615027e-01   +6.076120610439559e-01   +2.241936601371194e-01; +9.564836201840201e-03   +5.891937157914960e-01   +2.105034431607017e-02   +5.435564955129846e-01   +9.357186590870168e-01   +2.449443499328911e-02   +7.132158508760530e-01   +3.734599816317486e-01   +5.328154180734124e-01   +5.076132836351037e-01   +2.322584806869805e-01   +3.310363590578714e-01; +1.024522115978615e-01   +2.628261195572177e-02   +6.772968697134456e-01   +8.642785552972010e-01   +1.019833232880830e-01   +4.220682875857641e-01   +8.487485893078680e-01   +8.426860894084268e-01   +4.782894126606766e-01   +1.897136250028761e-01   +1.949030063412933e-01   +1.652265248067397e-01; +8.563396971996460e-01   +6.928204495282770e-01   +8.352538068259443e-01   +3.385766626476016e-01   +4.096529339057159e-01   +2.548949525960334e-01   +4.050064554120094e-01   +3.834409427912222e-01   +9.006339840474918e-01   +9.596152172905702e-01   +2.270629485709206e-03   +3.842799732511749e-01; +3.384966116466677e-01   +3.271413596022326e-01   +6.844067338761121e-01   +1.791159111574842e-01   +8.926001657523523e-01   +7.398988295116432e-02   +2.867274311845292e-01   +7.694765583884899e-01   +4.819540992085928e-01   +4.529269048027579e-01   +6.466099331175535e-01   +5.258917898680487e-01; +1.499516561941308e-01   +7.601980506156839e-02   +8.964621636674933e-01   +8.813239585183298e-01   +7.382596159680689e-01   +9.209373021025447e-01   +2.628639061567302e-01   +7.726367008720495e-01   +4.873702231631435e-01   +6.052182068006829e-01   +3.997360982087891e-01   +5.947756486466111e-01; +8.073411043504992e-01   +7.438343001687755e-01   +9.520251136653082e-02   +8.416422222062747e-01   +9.585039519177259e-01   +2.680072089044623e-01   +5.047049596511415e-01   +4.338500498832135e-01   +3.141726964843088e-01   +6.433840102707302e-01   +2.717857553003292e-01   +1.699282327276832e-01; +6.556868367123257e-01   +9.652478387200134e-01   +7.137319827915205e-02   +8.335613951254812e-01   +9.703146135652350e-01   +1.007981241564976e-01   +1.167822121385096e-01   +4.879645040221788e-01   +8.593538968028145e-01   +7.668215388170374e-01   +4.205565290322799e-03   +7.266346800117107e-02];
L3E_L3I_iGABA_netcon = [+4.377137822913967e-01   +7.137086394747602e-02   +4.762359305486557e-03   +4.950066832911500e-01   +5.436566128884517e-01   +2.519222086626025e-01   +7.183022192246712e-01   +7.609421203889279e-01   +3.781167062450925e-01   +4.485837902423896e-01   +2.003742299120740e-01   +6.495352907747760e-01; +5.804161524894716e-02   +8.078144244948879e-01   +1.327043408765292e-01   +1.942299330569623e-01   +2.118906811232127e-01   +3.345647078467738e-01   +2.226475423634900e-01   +8.889591721229050e-01   +6.113533901116739e-01   +3.944926544763411e-01   +8.282192207542793e-01   +8.982648074419113e-01; +6.251658002574609e-01   +9.100216236284198e-01   +3.086104763218277e-01   +6.418403540312895e-01   +2.693613632836379e-01   +5.914737108482645e-01   +4.984160265601053e-01   +7.315179003313101e-01   +1.681899706977779e-01   +6.677692141947604e-01   +4.467656840184860e-01   +8.381588188916632e-01; +7.983363826583776e-01   +4.254897778847430e-01   +2.384230076046626e-01   +2.554756006135718e-01   +1.328867235464689e-01   +4.820488483074122e-01   +4.752987766092219e-01   +6.973152527763883e-01   +1.053939410194570e-01   +3.367638621949529e-02   +4.259026239685242e-02   +1.708046534893845e-01; +4.010175975153096e-01   +1.841905443420717e-01   +6.496529012106926e-01   +9.484001446833750e-01   +1.661277540094133e-02   +8.976655595277275e-01   +4.313058519391000e-01   +6.467318895153806e-01   +6.256997131243064e-01   +7.870029552529642e-01   +7.689618140550502e-01   +1.609673758808647e-01; +8.845036174054818e-01   +1.833974022871236e-01   +8.084630658656133e-01   +2.879301759741232e-01   +1.532491148534003e-02   +2.949935985165136e-01   +5.568351384872932e-01   +6.209066601354829e-01   +9.528022541939600e-01   +3.785878793692962e-01   +9.838625800879813e-02   +1.356642798253267e-01; +7.222927216901218e-01   +6.722874764595853e-01   +7.394059484168400e-01   +1.490400675801487e-01   +9.788764568812176e-01   +7.929147996948205e-02   +2.069526548039973e-01   +7.854488165339628e-02   +6.656749111615936e-01   +6.508598109402882e-01   +6.526711189126498e-01   +1.589230661007268e-01; +1.971919595495712e-01   +5.243586807193955e-01   +1.228597223350640e-01   +8.705159611157560e-01   +6.468392163713163e-01   +3.922386643546358e-01   +2.774145200615171e-01   +5.483215687089715e-01   +4.727856435583241e-01   +4.971976785035905e-01   +2.702374400961953e-01   +3.944679148517395e-01; +3.740572975157562e-01   +7.766590427811811e-01   +1.728127628434871e-01   +8.868329973600629e-01   +8.160172554698162e-01   +1.987510523801346e-01   +8.119724711947518e-01   +8.844707226956390e-01   +3.407491610599603e-01   +2.126794236914232e-01   +4.367133698248791e-01   +6.671453580376300e-01; +2.114556650399278e-01   +2.991452942250921e-01   +2.742571924642284e-01   +6.685923361784688e-01   +2.759707855374493e-01   +7.226800987559230e-01   +9.560456942270601e-02   +9.872120946156555e-01   +5.909842168923721e-01   +2.169005698864357e-01   +8.491784484081171e-01   +2.226391837423170e-01; +2.591918594595494e-01   +4.740555721146792e-01   +8.149749124288358e-01   +9.974039082335380e-01   +1.590463679852138e-02   +4.217898401674788e-01   +3.309252141545697e-02   +7.106804430750430e-02   +5.454579339791633e-01   +4.517252148620716e-01   +9.021056519818967e-01   +6.435286293413642e-01; +9.915982662759889e-01   +7.063445920636476e-01   +5.916360482869041e-01   +2.679354125760650e-01   +1.015837163499274e-01   +2.684762841658099e-01   +6.486006471704005e-02   +3.283892366165428e-02   +3.953458309707088e-02   +6.291625510414310e-01   +2.849366175114674e-01   +6.119217202036218e-01];
L2E_Input1_iAMPA_netcon = [+9.920736289968434e-01   +9.900463146046672e-01   +1.000000000000000e+00   +9.871714565469483e-01   +9.851194656334287e-01   +9.989734585316072e-01   +9.829564489116287e-01   +9.966700708797311e-01];
L2I_Input2_iAMPA_netcon = [+9.923515944625089e-01   +9.987911606469105e-01   +9.850453529602868e-01   +9.946393635984462e-01   +9.887243915168688e-01   +9.900262119032590e-01   +9.951059200443315e-01   +9.965250442189878e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
