function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.966705126442221e-01   -5.456795824342497e-03   +1.283297680202931e-01   -1.143553825333956e-01   +4.723822270062401e-01   +5.891652316721269e-02   +4.099879317345433e-01   +6.356938703741379e-02   -2.160128112026746e-01   +7.093552078862356e-02   +6.330133369227517e-02   +1.064237458803150e-02   +1.513286829388829e-02   +1.841969374173708e-01   +2.504855924971269e-01   +3.313868839305159e-01; +2.982246497056105e-01   +5.751931952027865e-02   -1.261142812361801e-01   -1.053501463592506e-01   +1.914776843053619e-01   +7.491149612675579e-02   +2.265792996909155e-02   +7.462106746189099e-01   +3.900413654101491e-01   +2.990907021793461e-01   +1.080943852293012e-01   +5.082731662538205e-01   -3.071746166505841e-01   -4.086932991680265e-01   +2.269689294280363e-01   +6.670274812600449e-03; -1.518869709352012e-01   +5.911000230728163e-01   +1.413414600461530e-01   -8.144731298688310e-02   -5.410660026293282e-01   +1.313299357275476e-01   -2.186780199798366e-01   +3.317373846671557e-01   -2.644369319942717e-01   -2.733552405335473e-01   +1.702061958540655e-01   -9.697849280875132e-02   -2.998324008303401e-02   +4.666090581099634e-01   +3.349439300937196e-02   -5.991670611802447e-01; +3.121841824264338e-02   +3.709142315427916e-01   +5.564411984785484e-01   +3.957414919340125e-01   +1.043110420464775e-02   -1.162580336266561e-01   +5.855573108564718e-01   +2.397876296723764e-01   +5.312430804341426e-01   +1.036513564505139e-01   -5.273650555626963e-01   -9.860572040231243e-02   -1.307158190766256e-02   -4.699306983944697e-01   +5.331865507105193e-01   -3.416096121304012e-01; -3.749194921180845e-01   -3.469442815822793e-01   +3.725310117368230e-01   -2.776412047094398e-01   +2.716067734863938e-01   -3.687118178697313e-02   -5.873533094814420e-02   +4.781415784732683e-02   +3.041145086893375e-01   -6.045452818662900e-01   -1.373837688452724e-01   -1.798729060505074e-01   +5.729832677678101e-02   +5.344239266471719e-01   +2.762204222467239e-01   +4.046619349769817e-01; +9.620978761866592e-02   +3.917984030749864e-01   -2.360185213051732e-01   +2.872176465493870e-03   +4.392562019140785e-01   -2.284975890543308e-01   -5.434379847091486e-01   +1.615793711932254e-01   -9.810072064970592e-02   +6.735350931127294e-01   -1.576521566663087e-01   +8.495076757785078e-01   -2.223974531805382e-02   -1.714231040104568e-01   +1.690646532387344e-01   -2.440159128676077e-01; +1.629490050642621e-01   +6.452129712157736e-02   +7.677541315525780e-01   -3.132370468945303e-01   +2.665068565092956e-01   +4.039612815778781e-01   +1.428097113918422e-02   +5.785278679257921e-02   +7.965042712278245e-01   -3.454743447723343e-01   -6.604775575964916e-01   +2.942770928660142e-01   +2.137494971711542e-01   +4.781119025334798e-01   -6.043245110674051e-01   -5.264042900791635e-01; -3.808183413172670e-01   -2.711471746164712e-02   -2.286693005100831e-01   -3.402225491241520e-01   -3.406049449740206e-01   +5.531753392592846e-01   +3.775974314650843e-01   -4.027487340546277e-01   -1.867666182411331e-01   +1.462394974041969e-01   -1.715577554697672e-01   -6.674213193425519e-01   -2.091563866584784e-02   -7.688213215134830e-01   -6.004812652576221e-01   +1.893654405562359e-01; -7.014612712408137e-01   +1.994108553927759e-01   -2.232072616963157e-01   -2.111919987558146e-01   +4.511045494126978e-01   +2.204920391147047e-01   +2.897204489851669e-01   +2.138613697743071e-01   +1.664635531998016e-01   -5.095766193882887e-01   +1.140582477849071e-01   -9.779788911381965e-02   -3.935972890456723e-01   -8.536865660817834e-01   -6.032709296474401e-02   -5.787563291928759e-02; -4.573260705031256e-01   +1.368316999966249e-01   -1.007638568662648e-01   +2.341168966201390e-01   +6.870723289049004e-01   +4.183480154948683e-01   -1.173887167220408e-01   -9.062532048660137e-01   -6.714508995363841e-03   -1.833179815494067e-01   -1.780256923489084e-01   -6.844077758026637e-01   -6.622999482759644e-01   +1.792768351979545e-01   +3.329029832546068e-01   -3.153059436076422e-01; +6.108079070850126e-01   -1.276105434343494e-02   -1.445571541885392e-01   -4.432219440395341e-01   +5.556952442748390e-01   +2.733383430501163e-02   -7.367184841905250e-01   -1.747165370698798e-01   +2.270831408938114e-01   -4.219368176054170e-01   -7.837542927676122e-02   -3.193230598842294e-01   -5.069622373978671e-01   -2.899569188144348e-02   -1.759455860933908e-01   -5.227467440499496e-01; +9.160234262493661e-01   +5.182086335788004e-01   -4.862106636151472e-01   -1.843190719215011e-01   +2.710317661848829e-01   +3.309416814502188e-01   +2.722727121495645e-01   +1.614842261519797e-02   +1.284631431363845e-01   +6.090994496324559e-02   +1.023223552903331e-01   +4.078926159682212e-01   -8.031687010086360e-01   -5.193274094239675e-01   -1.614593451961849e-02   -4.358207075471114e-01; -2.264553881913806e-01   -8.080264493255704e-01   -3.247321990570881e-01   +2.618134379898857e-02   +3.083280618471793e-01   -5.211453801095357e-02   +7.061818024415911e-01   -5.087134438674683e-01   +1.713325425644645e-01   +1.638105459093837e-01   +2.424359242863852e-02   -4.742612432578316e-01   -6.298694206284632e-01   +2.748942996957132e-02   -6.966221519104421e-03   +2.351817208777579e-01; +3.505443018494662e-01   -4.154419071670340e-01   +4.623349674489152e-02   +1.047806092143246e-01   +1.930224602999175e-01   +3.127201655320601e-01   +1.635948534058852e-01   -2.014446420198107e-02   -7.496707725729026e-01   -9.557250538684173e-01   -2.798965226483537e-01   -1.865443488421595e-01   -2.387843230326288e-01   -4.649328786657275e-01   +2.179437490995642e-01   +4.170905158444712e-01; +2.006855702886684e-01   +5.514697983503855e-02   -6.054811842873767e-01   -3.991248836530038e-01   -1.782568270404687e-01   -1.497345194226206e-01   -2.810840209978301e-01   +8.111989837529170e-01   +2.774934210501762e-02   -4.833503094483486e-01   -3.679540036178712e-01   +4.794902367020345e-01   -4.157937484857379e-01   +2.235343370868628e-01   -2.644932671780962e-01   +2.618685334643012e-01; -3.289638761735093e-01   -2.310334728632185e-01   -1.066482837625687e-01   +1.420060608636440e-01   +1.211145782381524e-01   -5.917250116072911e-02   -9.026416901977057e-02   -1.502670855073133e-01   -4.712113192324580e-01   -2.566210237742123e-01   -3.035055681039562e-01   -1.154184875685236e-01   +1.115082291789966e-01   -1.534469704393647e-01   +2.265070194997992e-02   -7.001724955082328e-02];
L1E_L1I_iGABA_netcon = [+1.430533999194734e-01   -1.393035232332532e-01   -4.643424523910821e-01   -1.020350793146177e-01   -2.303762430095246e-01   +2.575272619132111e-01   +4.342661161375519e-01   +3.973395471399322e-03   -6.385129103889241e-02   -5.347291896692221e-01   -4.423277756220128e-01   -1.593324602715922e-01   -5.409723994147118e-01   -8.839117119892707e-01   -1.274177106071782e-01   +3.673191095377918e-01; +9.958697122846999e-02   -6.801027366127549e-01   -5.445279709506445e-01   -1.404922844224956e-01   +1.290829357279982e-01   +2.668134059105876e-01   +6.178231144364107e-01   -1.165366344201285e-01   +6.231280363005613e-02   -3.747581077111666e-01   -3.738860361860331e-01   -3.751993067518969e-01   -8.490847692832643e-02   -4.487726223283995e-01   +1.776930329476752e-01   +5.954310974355246e-01; +3.524319973164433e-01   +1.131499845388029e-01   +7.578904266676332e-01   +9.174129104322552e-02   +2.405940726206051e-01   -5.393865204065339e-01   +1.000000000000000e+00   +8.357709873664904e-01   +2.466695612122433e-03   -9.166491389032612e-03   +6.609445397048844e-01   +1.221465289413444e-01   -3.232794566332441e-01   -3.042598347039831e-02   -6.645984327011599e-02   +5.931844055701221e-01; +2.023562455926591e-01   -6.649223932159095e-01   -7.473919210530096e-01   -3.944864224522457e-01   -2.118846507309905e-01   +3.694270445045356e-02   -7.440860299402601e-01   +4.252856328553506e-01   -1.448378419173663e-01   +8.316666391715096e-01   -4.907021462428501e-01   -1.751307541745160e-01   -5.262377958653388e-01   -2.789373945278241e-01   +2.591396990360945e-01   +3.675794313962878e-01; +1.678924907637951e-01   -1.735938926822855e-01   +8.878694118196044e-02   -1.852876203322343e-01   +5.510286945307974e-02   -5.484455882674846e-03   -5.310143403048168e-02   +1.802682056563036e-01   +6.364025660734073e-02   +3.699530659281264e-01   +2.074191677196989e-01   -3.013177560359722e-01   +2.775914044569904e-01   -8.068720332465945e-02   +2.780297478862921e-01   +3.002541440869640e-01; +9.238711932627639e-01   -4.030268097685952e-02   +2.225643344164673e-01   -6.011537178243658e-01   -4.153371928651185e-01   -5.170768809584915e-01   -6.014458904129254e-01   -6.759221464854164e-01   -1.089380828643606e-01   +3.322467281739726e-01   +9.401506722268980e-01   +7.550385775165965e-01   +2.302380217987353e-01   +6.031261398662875e-01   -5.553269742137326e-01   +3.550044791133179e-02; -1.020129715000533e-01   +9.732087257676221e-02   -1.539710969601105e-01   +1.469150998986770e-01   +6.156310701371624e-02   +7.616389853081643e-02   -1.170989369691236e-01   -5.149761383715955e-01   -1.671380249569213e-01   -2.634977632215080e-01   -2.816911661904648e-01   -5.005676333072228e-01   +1.824838416015397e-01   +5.549315881321197e-01   -2.944681396433402e-01   +1.186429682618438e-01; -9.868987250044528e-02   +1.016983704654445e-02   -1.650923970922810e-01   -1.626236352357600e-01   -1.242649902838453e-01   -7.028149689226606e-01   -1.617495915540418e-01   -5.894899083132236e-02   -4.039428431913028e-02   +5.873386479178641e-01   -7.202446923013537e-01   -2.781517220316200e-01   +1.716460254313071e-01   +1.022449859936666e-01   +3.178042579375397e-01   +2.207613314880209e-01; +3.954983242826621e-03   +1.703634521340300e-01   -2.454495771243407e-01   +4.299206608434479e-01   +1.849480417247897e-01   -1.666702413160861e-01   -2.024090377013598e-01   +2.162440787599653e-01   +2.653546103435572e-01   -4.979222711971382e-01   +1.953568946603340e-01   +3.662554089730892e-01   -1.110042528200703e-01   +6.861567231852969e-01   +4.990022799959837e-01   +1.406816780947545e-01; +3.101557688990090e-02   +4.110259216043242e-01   +5.335548194198988e-01   +3.946755901070472e-01   +4.585105181517862e-01   +1.538940946050532e-01   -3.740136771790214e-01   -3.935267586169085e-01   -2.188266295838148e-01   -5.334004072344238e-01   +4.028298097823001e-01   +4.138889052901466e-02   -1.180246776671603e-01   +4.050145681702604e-01   -7.161433458486527e-01   -3.686728641184567e-01; -5.780031475965829e-02   +5.646210060239081e-02   +1.961068622614794e-01   -1.041025010768019e-01   +2.715201198752211e-01   -3.066313537794830e-01   -9.174967437049072e-02   +5.666354992411037e-01   +3.324330928254011e-01   +4.967875615410914e-01   -1.633745826828043e-01   +7.537018819384125e-02   -2.451994663781861e-01   +2.033788718467091e-01   +6.266378929448443e-02   +6.070348033147079e-01; +1.616055988584859e-01   +7.723383450699640e-02   -1.264668426514338e-01   +5.590997550113840e-01   +5.751787373996579e-01   -1.077430814702431e-01   -5.719810321272634e-02   -2.081210292408428e-01   -1.467296530431696e-02   +5.725910033008540e-01   +4.012136946136730e-01   +2.438299797189007e-01   +5.389852045966201e-02   +2.199267672550543e-01   -2.965099135021122e-01   -8.267444188633777e-01; -1.667693294163950e-02   -4.004116530878795e-01   +2.941258974615106e-01   +4.746375236976495e-01   +2.761810094705187e-01   +4.179208529015196e-01   +2.361197622040257e-01   -1.574257136644185e-01   +3.499619522234987e-02   +1.880879104599324e-01   +1.275928415310971e-01   -5.611168558351416e-02   +1.189767820378095e-01   +3.182451571437836e-01   +3.144230389221328e-01   -2.171339628200318e-01; -1.417840616283253e-01   -3.279712237714745e-01   -2.077053723597050e-01   +1.548349833309392e-01   +1.286297394340040e-01   +1.461493366487024e-02   +4.906169818566736e-01   +3.223331514275853e-01   -2.147900802291844e-01   +8.224795691735666e-02   +2.222173132244986e-01   +3.984050650400603e-02   +5.346753760780001e-01   -7.063137505026815e-02   -5.127644753670773e-01   +8.615133211528828e-02; -2.169203443329366e-01   +2.190777125461181e-01   +7.835849600130479e-02   +1.539971976064750e-01   +3.787085550094572e-01   +1.309058697070742e-01   +2.278221369146475e-02   -4.353091502320633e-01   +2.275602597258908e-01   +4.290570443147257e-01   -8.901786437377852e-02   +7.682863855679617e-02   -2.933741674169103e-01   +6.372355462505422e-01   -5.405812020655498e-01   +2.978344883047430e-01; +3.658578370618485e-01   -3.951096551697240e-01   +2.220424299526842e-02   -3.110629112391882e-01   +4.462698488284769e-01   +3.543582199168235e-01   -1.197712971237909e-01   -1.821783028814495e-01   -2.953487611345424e-01   +6.167903025928208e-02   -6.072150975660169e-01   +3.849725060463152e-01   +6.853045424996111e-01   -5.235354891294651e-01   -7.119811224435005e-01   -8.786203046018470e-01];
L2I_L1I_iGABA_netcon = [-2.378872153678214e-01   -3.483918499376737e-03   +3.116994081136442e-01   +1.972824208229488e-01   +1.950917640499671e-01   +2.807178866459753e-01   +3.523222055773685e-01   +8.829340993985308e-01; +3.702622803980811e-01   +3.913832283148554e-01   -6.467630835848455e-01   +4.545355223806768e-02   +3.759521626764465e-01   +6.408226274112994e-01   -9.387548745595703e-02   -4.758580447304162e-02; -8.430810346092395e-02   +1.708069529845105e-01   +5.526054570264380e-02   -2.609584686309910e-02   -6.238415784789387e-01   -6.492652661007656e-01   -1.671203821572514e-01   +5.094396665142509e-01; +3.728543902426945e-01   -4.481433804770992e-01   -2.764971719021955e-01   +1.385693658787983e-01   -7.562000984184636e-02   +5.732446271985727e-01   +1.982244272286465e-01   +5.557502444083682e-01; +2.476936958921206e-01   +8.775212810204427e-02   -1.689953503807577e-01   +6.729353454827496e-01   -4.505564903927474e-01   +4.116947537886757e-01   +1.542073239700952e-01   -4.239576542262395e-02; +3.976312308469777e-01   -4.530134361614594e-01   -4.549995401338842e-01   -2.035735310078741e-01   -3.014653043959580e-01   -6.564572863559860e-01   -7.481658083146513e-01   -1.441757942991219e-01; -7.904675437529951e-02   -3.127187010157596e-01   +2.724734841159818e-01   +1.651948014442004e-01   -7.661375239950466e-01   +1.656630181215550e-01   -5.526639083184059e-01   -1.466420324294381e-01; +8.718271188844986e-01   +8.089210008758138e-02   +3.151111696515531e-01   +4.154811278342440e-01   +6.159009289989732e-01   -3.999502610964921e-01   +4.869900991570695e-01   -3.843412243480349e-02; -3.150174476225045e-01   -1.061145436787098e-01   -8.101256697611148e-02   -4.282276934857504e-01   +1.822456456446634e-01   -3.074367387433834e-01   -1.229351868057691e-01   +3.522857061986849e-01; -4.734360304434407e-01   -1.744799430926751e-01   +7.605851610039888e-02   +4.955288998929387e-01   -7.455244459065478e-01   +3.691848125292245e-01   +5.958791700622699e-01   -3.862865283385354e-01; +3.447299004660254e-01   -4.074262542201778e-01   +4.998210008193661e-01   +3.374894674056028e-01   -5.001086947405119e-01   -2.647660871923896e-01   -7.717864995879481e-02   -3.552462314538997e-01; -8.900247831831528e-01   -1.652322081103155e-01   -3.397868573682736e-01   +1.318086066271782e-01   +6.063730472773690e-01   +2.680012024340314e-01   -5.109688136428354e-01   +3.447620610856313e-01; +8.538961827820186e-01   +5.101189635708003e-01   -1.779775192129995e-01   +2.775460312734623e-01   +2.652736551535517e-01   +5.143025358033275e-01   +2.796410176911099e-01   +1.156835256951469e-01; +2.302854686303989e-01   +6.895148623126958e-01   -6.909537927177329e-01   +1.215241277206244e-01   +5.526788489042944e-02   -2.476382137951863e-01   +4.639384273152886e-02   +1.273574050797937e-01; +6.150646593573753e-01   +5.905956782612376e-02   -2.657889655845475e-02   -3.141422672115028e-01   -1.005891084010841e-01   +1.418925442008549e-01   +7.802956849826844e-01   +9.687539588457472e-01; -3.806173116326991e-01   -5.351089812798235e-01   -1.048967421486593e-02   -3.345637499247647e-02   +7.723891356415175e-01   -7.598633163146402e-01   +2.862248986762551e-01   +5.047326523431201e-01];
L1I_L2I_iGABA_netcon = [-5.550807605536862e-01   +6.750550866141247e-01   -3.232956346759217e-01   -6.603741540606645e-01   +6.213396745165542e-02   -3.318852686173705e-01   -7.129998808148513e-01   -1.936197258654410e-01   -5.721418625406847e-01   +2.942527324050423e-01   +1.514924087897666e-01   -1.082035709762919e-02   +3.723213284331906e-01   -2.662093954046907e-02   +3.637540279433986e-01   +5.213696603001631e-03; -1.761483318387672e-01   -2.503946873721244e-01   +6.974373725307179e-01   +5.823012433928777e-01   +2.666974610993914e-01   +7.538168137769024e-01   -9.073940328034728e-02   -5.562572652729499e-01   +2.100914264065728e-01   -4.050019058586755e-01   -2.906395679914325e-01   -8.120845032967536e-02   +2.037300993044966e-02   -1.611328260231221e-01   -3.968688756582004e-01   +7.532726157375169e-02; +1.775012913008415e-01   +6.391107369851928e-01   -3.168980617657197e-01   +3.574272758402310e-01   -5.342441829478350e-01   -1.882147534959528e-01   -1.990682812428239e-01   +3.796202124932130e-01   +7.152851889985450e-01   -5.215450141097145e-01   -3.784587391402500e-01   +4.963997043875518e-02   +6.789531074058869e-02   -1.563661935364533e-01   -3.280096321875378e-03   +1.140057349212172e-01; +5.861943825771715e-01   +7.186076399729989e-01   +2.064471211479858e-01   +3.878153840087986e-02   +7.112049270929429e-01   +5.743947194320114e-01   +1.100119759561174e-01   -3.172054113034934e-01   +1.166355624849494e-01   -4.219485687631983e-01   +3.914155722376219e-01   -3.202783742895282e-01   -4.208873433118213e-01   +1.638204233443442e-01   +3.639995498585740e-01   +5.974357660526537e-01; +6.784803151738573e-01   +1.317181296826267e-01   +2.535396542330998e-01   +3.748376345983393e-01   -1.879463071942136e-01   -4.065012926568428e-01   -1.542049551963184e-01   +2.817109690361324e-01   +6.777001686093841e-01   +1.125397773483637e-01   -3.804250973123025e-01   -1.234483013479746e-01   +8.590589342512966e-01   +6.636831031272057e-02   +6.812426199917154e-01   -3.495453407208726e-02; -1.886999436845368e-02   -6.504085308306263e-01   -7.315991193964571e-01   -9.301318335994226e-01   -4.792714458070279e-01   -9.173366829081973e-02   -2.915389647277522e-02   -4.182783961175217e-01   -4.143455573499994e-01   +3.708277348187335e-01   -2.468254877143333e-01   -5.501020564889969e-01   -6.024321587955813e-01   +4.067729791386513e-02   -4.732248922047039e-01   +3.004927302203497e-01; -2.779754825081655e-01   +3.289228026140165e-01   +5.246328118017956e-02   +2.694719964106702e-01   +3.870654868532766e-01   +2.273653769320622e-01   -1.144637196456987e-02   -3.347528304128690e-01   -1.704176953594945e-01   +7.277658492310269e-03   -4.911380013270296e-01   -4.289618330662097e-01   -2.664662319779457e-01   -1.769434425841747e-01   -4.698633658323952e-01   +7.187067023312713e-01; -1.794039556777602e-01   -4.655888093948467e-01   -3.884748256626929e-01   -4.599210018347290e-02   -6.891529361199423e-01   +4.834658884945980e-01   -3.392055460439300e-01   +7.050251902856312e-01   +2.153844879353828e-01   +6.855055231233762e-01   +2.382521110207142e-01   -6.087420489669002e-01   -3.688167598734072e-01   -1.000000000000000e+00   -3.447868085514784e-01   -4.585428581852747e-01];
L2E_L1E_iAMPA_netcon = [+3.640129514331890e-01   +3.902257580536329e-01   +3.772175251217010e-02   -3.433624904897388e-01   -3.458595682135162e-01   -5.939684351545295e-01   +3.938228483674929e-02   +5.421598234177730e-01; +1.183022299834783e-01   +6.372026368562749e-01   -2.108297115454446e-01   +1.896701573845608e-01   -1.959263005767951e-01   +1.451324575606409e-01   -3.883095108615935e-01   +2.179082177001144e-01; +3.038357463910241e-02   +5.241185227701511e-02   -2.201776596320052e-01   +8.213034558111003e-01   +4.103040383967015e-01   -3.976377786952247e-01   +4.885615359550824e-01   -5.589786130162825e-01; +3.285024293374947e-02   -1.550173946034664e-01   -2.198263846279341e-01   +4.289152548898967e-01   -3.196528552326487e-01   -1.792789502418913e-01   +3.583815974420348e-01   +2.355713210902094e-02; +3.967825546267562e-02   +1.495330499194218e-01   -2.501004329391541e-01   -7.592912133238516e-02   +1.600396506017329e-01   +2.533859502618597e-01   -2.632885099189458e-01   -3.103418358776121e-01; +4.367765604383537e-01   -7.085936509108292e-01   -1.314615296102268e-01   -1.238312463142273e-01   -6.820833699951931e-01   -1.469529191095965e-01   -1.372020905578805e-01   +3.066835524110867e-01; -6.533416546335480e-01   -1.248094660966013e-01   +2.260931530884987e-01   -1.920526807774576e-01   +2.563305446365432e-01   +1.115366773767414e-01   -9.128355396200882e-02   +6.779098563272017e-01; +2.745017116934151e-01   +3.895530037355501e-01   +6.435881850054431e-02   +1.686811588091822e-01   -7.116496865598451e-01   -1.198959284414852e-01   +2.890780230568555e-01   +7.162357992346975e-01; -1.564823768692805e-01   +6.616215964839394e-01   -1.273062155166124e-01   -2.571968649789307e-01   -1.177323005696296e-01   -4.594960851994847e-01   +7.059135424957171e-01   +2.160865453943688e-01; +2.552205239293107e-02   +3.572633274547210e-02   +6.309050020592630e-02   +4.623753613447064e-01   -2.678318667558772e-01   +2.626424499266597e-01   +1.868544092613601e-01   +1.797985999878525e-01; +1.731135539455183e-01   -3.979712078373688e-01   +6.878990688797277e-01   -4.990168239546893e-01   +1.276682843670462e-01   +1.742243101221116e-01   -2.677651160483515e-01   -2.716073077956160e-01; -6.802095131390085e-01   -3.455593161713786e-01   -1.680683228745945e-01   +3.816167741496602e-02   -6.046302514582402e-01   +7.453471622686147e-02   +2.011597476835275e-01   -5.813540393375868e-01; -2.288937398014422e-01   +5.724048412284553e-01   +7.292404996574642e-02   +3.663021258924729e-01   -2.074883584155567e-01   +7.892459544362605e-02   -3.989706771486395e-02   -3.325529308199292e-01; -7.563304782640814e-01   +1.523867622995347e-01   -2.443828389551869e-01   -6.117713812930130e-01   +5.369024947516124e-01   +8.690012326927183e-01   +3.121081908868704e-01   -6.355251569261146e-01; +7.886584263683670e-02   +1.386099509461348e-01   -1.547801983948658e-01   -7.845776586547613e-01   +3.438296686788669e-02   +2.470617473913842e-01   +4.851605870570769e-01   -6.387097769438002e-01; +1.770087028900845e-01   -4.077015408835679e-02   -1.894205976341108e-01   +7.526782911052178e-01   +3.863343944889715e-01   +6.111334428948115e-02   +1.567677646490268e-01   +6.490514823820991e-01];
L1E_L2E_iAMPA_netcon = [-4.204534191659652e-01   +2.299241421726069e-01   -3.590085800168358e-02   -2.381047524173177e-01   +4.729552807503608e-01   +2.250180822605036e-01   -3.778496619710289e-01   +4.364774872744720e-02   +3.464897870476821e-01   +6.716539205338139e-01   +4.259380264305427e-01   -4.544354793844579e-01   -9.580445071755939e-02   +3.943650187485269e-01   -1.896961799787122e-01   -5.679408556922345e-01; -2.036821066796477e-01   +4.561540695148254e-02   -4.156504506689755e-01   +1.425469506336539e-01   +1.842444400103881e-02   -2.310891762962844e-01   -1.025940247287780e-01   +3.405092557795331e-01   -3.601948205847269e-01   +4.872657364567072e-01   +9.595245920271571e-02   -2.110068420646379e-01   -3.362286491095171e-01   -1.321599883783550e-01   -3.723141330310343e-01   -1.483428362429057e-01; -2.663820258910720e-01   -2.243837187958228e-01   -1.638815230782625e-02   -2.000560836141113e-01   -1.575948769547668e-01   -2.343684179078322e-01   -1.642212238519808e-01   -5.014911701452718e-01   -2.528985807477865e-01   -4.333972793453762e-01   -1.260440845206072e-01   +4.356885268387736e-01   +2.384367532668520e-01   +3.819261225717518e-01   +5.027385100645507e-01   +3.932005459461774e-01; -3.705152513353104e-01   +1.680702652889825e-01   +4.552107338540994e-01   -4.455933587206398e-01   +2.476253665172739e-01   -5.416048447004256e-02   -1.118959185066415e-01   +2.438615444708825e-01   +2.905119325050090e-01   +3.300563645660645e-02   +4.626096590449592e-01   +4.124164798856367e-01   +2.909060888742314e-01   +2.977488708673870e-02   -3.040675228464976e-01   -1.707240620449645e-01; +6.446350013585243e-01   -2.594084077227048e-01   +1.560032280665029e-01   +2.819837632799139e-01   +2.724908032156002e-01   -5.481115146473683e-01   -6.343580767985069e-01   -4.414361659866864e-01   +5.352683682958614e-01   -1.529304522051191e-01   -4.193735780034009e-01   +1.172360146482192e-01   +2.475819985287491e-01   +2.302616772212080e-01   -2.153436227174294e-01   -1.502044357814405e-01; +4.903877392920165e-01   +3.361351480657003e-01   -5.365264016774425e-01   +7.911972666173999e-01   +3.678948794123070e-01   -4.835468348912313e-01   -1.083957915967071e-01   -4.193555575544924e-02   -4.555266230179754e-01   -4.984268186623937e-02   +1.651084762642629e-01   +1.392989115314555e-01   -4.400478374979980e-01   -5.377394383086137e-02   +3.525383714057201e-01   +1.401607947163002e-02; -2.627357241886957e-02   +6.151730342360178e-01   +7.720522037932775e-02   +1.156820720616059e-01   -4.522467345384762e-01   +2.152157703876824e-01   +1.484792343040598e-01   +8.283545568872440e-02   -4.724896866180178e-01   -5.815203437334568e-01   +5.541951014099169e-01   +2.125557090076734e-01   +1.527689120075319e-01   -3.466910333216797e-01   +4.249314647612971e-01   +1.594434277108204e-01; +5.568348887788270e-01   -9.657514689098476e-02   -1.162576170020606e-01   +3.317800670158366e-01   -1.497553966619970e-01   -8.478180811618230e-02   +2.557194092800447e-03   -8.134622407980021e-01   -8.741288410877971e-01   +4.039593572929894e-01   -2.815207898529701e-01   -8.059580157221780e-02   +1.469520781961986e-01   +5.557910966874229e-01   -6.253946971534736e-01   -6.275125020535283e-01];
L2I_L2E_iAMPA_netcon = [-7.771958005263211e-01   +4.234234993700539e-01   -2.185339577976288e-01   +1.780316794715149e-01   -3.737669056838417e-01   -8.872172070030200e-02   -9.948004277922201e-02   +6.197461440826648e-01; +2.844211543528716e-01   -1.517653354301934e-01   +2.690869237229967e-01   -2.332750097009297e-01   +2.713813060236211e-01   +5.986598916514553e-01   -3.245639826117273e-01   -4.475641280846954e-01; -4.555411978782857e-01   +8.569335954311919e-01   +2.124323379008672e-01   +1.025701345665480e-01   -1.887252901212036e-02   +2.395637054552841e-01   +2.523302948380455e-01   -5.805074619486999e-02; -2.223795209731418e-01   +1.000000000000000e+00   +3.031942045262743e-01   -4.890081445476642e-01   +8.672509314597365e-01   -4.480448678450512e-01   +1.867053362599110e-01   +2.257158420468071e-01; +5.473679889783210e-01   -2.113024476517187e-01   -4.505930207893288e-01   -2.818284123568286e-01   +2.370986050279806e-01   +4.665493741148449e-01   -1.567867248747845e-01   +7.235421861798946e-01; -4.759141821537732e-02   -1.960706373410724e-01   -3.516650716758633e-02   +4.430673684742236e-03   +4.211547938554294e-01   -5.974381759478894e-02   -4.332035272501608e-01   -3.220432545446944e-01; +4.683001124452018e-01   +1.164719373979761e-01   -3.079718539955317e-02   -4.496084928521662e-02   -6.745384071732883e-01   -5.994091888219719e-02   -7.071056349391207e-01   -2.298722434804049e-01; +1.938407885336452e-01   -5.418570152996058e-01   +3.425874604822363e-01   +1.189120310353966e-01   -2.002358308330497e-01   -3.112280225552673e-01   -8.781036128628125e-03   +1.161787109096407e-01];
L2E_L2I_iGABA_netcon = [+3.785033468445701e-01   -3.797170786729084e-01   +2.544054306229873e-01   +9.978681831574120e-02   -4.752951865308780e-01   +3.525987110714827e-01   -6.713709243365001e-02   +5.338264349763561e-02; -5.073694058236250e-01   -9.940514649180122e-02   -5.840961092433604e-01   -4.469384558525010e-01   +3.846661738559360e-01   +6.460537844201504e-01   -2.534074342221134e-01   -7.327948418021633e-01; +6.122355233374141e-02   +4.404505174413544e-01   +4.412887845860970e-01   +1.000000000000000e+00   -4.530624417768582e-01   -5.142219998693170e-01   -2.829006297758009e-01   -2.612773260684473e-02; -6.675306618036617e-01   +2.400393263246900e-01   +5.031542216228547e-01   -3.972296099885096e-01   -2.607539220438527e-01   +3.026179167521607e-01   +7.697662172001098e-02   +1.144349549984753e-01; +4.006788021479533e-01   +4.251334127432977e-01   -4.273244058654412e-01   -5.680609062691958e-02   -4.947202826316297e-01   +3.141699394270066e-01   +2.919023184787516e-01   +2.780721484823230e-02; +8.276273844663440e-01   +7.530544191732320e-01   -6.061992208496181e-01   -1.948040814045024e-02   +3.752384477062382e-01   +3.200876051009054e-01   -9.754368159293238e-02   -1.160943334756311e-01; -6.224327309931004e-01   -9.060678845715361e-02   +8.461455183992100e-01   -3.513976008002128e-01   -5.376736366304951e-01   -1.635863846334284e-02   -1.431769683377879e-01   +8.847672250058818e-02; -9.900587085562475e-02   -7.854968971898878e-01   -6.649502615280777e-01   +4.505692491446499e-01   +3.748721783752970e-01   +4.938291363679077e-01   +3.819949594534627e-01   +1.325631873614126e-01];
L3E_L2E_iAMPA_netcon = [+2.767461781074250e-01   +3.698859679452655e-01   +8.850017408379775e-02   +6.517130882149922e-01   +2.225868697042504e-01   +2.362676237036363e-01   +3.323578088991891e-01   -2.801090002813160e-01   -2.404915256965187e-01   +2.929423781821248e-02   -6.542842858857275e-01   +1.390849885925877e-01; -7.939004815796756e-01   +8.379279851567036e-01   +5.425742210307156e-01   -4.727411007546509e-02   +3.770982734262432e-01   +1.542292073299107e-01   -5.940432671813289e-01   -6.222971739860661e-01   +6.958943256426956e-01   +1.647579410715888e-01   -3.285677645744451e-01   +7.431819928804231e-01; +7.045068374658900e-01   -3.907224574264246e-01   -2.676996799434104e-01   -2.842663330196997e-01   -2.916063560133355e-01   +4.547867628416187e-01   +6.208590649899663e-01   +3.058800989918993e-01   -1.869737757844972e-01   +3.183630725808383e-01   -6.752710540727366e-02   +1.478480088000244e-01; -1.873567470498699e-02   +5.748920525079607e-01   -3.613567193475206e-01   -2.840494308313803e-01   -2.812886382207781e-01   -6.807235901446010e-01   -1.972962392589549e-01   -1.516954091181250e-01   +4.026521645087748e-01   +6.868360592034910e-01   -3.499088007948585e-01   +3.930526333568872e-01; +6.496868619077240e-01   -5.171362454302399e-01   -1.914823421056250e-01   +5.805811222152618e-01   -8.342632154526985e-02   -3.203534867734905e-01   +5.723869579663219e-01   +2.959323909453020e-01   -4.155927043393651e-01   -4.103252682104430e-01   +5.964922028602548e-01   -1.074192666887756e-01; +4.299820338941920e-02   +7.041103402326646e-01   -5.079512228474660e-01   +9.556345128133133e-02   -4.247902058232834e-01   +7.642652475511548e-01   -1.349907607803132e-02   -3.769305791057119e-01   +5.989865583850172e-01   +1.000000000000000e+00   -6.397732292501843e-02   +6.028857114751273e-01; -4.962785152503414e-01   +7.777296264679361e-02   +9.125165893484947e-01   -7.999210979026227e-01   -2.956093917444038e-01   -2.508739150709778e-01   -2.089124671630846e-01   +2.836395951619004e-01   +9.366958711031391e-02   -1.508667546585784e-01   +3.177288154693946e-01   -9.056575280691885e-02; -4.322868773075441e-01   +5.597351579231680e-01   -1.114746462763366e-02   -5.718389307305707e-02   -5.588682527466324e-01   +3.040473150756766e-01   -3.748227674036237e-01   -3.808039014853836e-01   +1.445135370739378e-01   +9.574541312220473e-01   -3.185834561652062e-01   -1.389032617704188e-01];
L3I_L2I_iGABA_netcon = [+1.981670708853308e-01   -7.325026800532031e-01   -3.270352172626453e-01   -1.623378970585660e-01   -6.574639915956149e-01   +1.004885272003332e-01   -8.315827215331637e-01   -7.867773710499767e-01   -8.902069019985250e-01   +3.326455753733311e-01   -8.057936311031307e-01   +7.776604608071883e-02; -4.530801282949273e-01   +4.135341373800140e-01   +9.687705782272996e-02   -9.897582793962036e-02   +6.851586895970863e-02   +2.896467695442564e-03   +5.158804844401234e-01   +5.217153760432665e-01   -3.009742642630745e-01   +2.519230184116061e-01   +5.996282655712031e-02   -2.573886836388334e-01; +4.562751140588520e-01   +2.159461052716636e-01   +8.473541263021361e-01   -8.671525268151160e-01   -5.383098806064505e-01   +4.821600845167648e-01   -1.419235105357961e-01   -2.450824796787336e-01   -1.645916786321363e-01   +2.443916621360948e-01   +3.281684562630453e-01   +5.156681025505134e-01; +7.103795423337529e-01   -2.509629706886107e-01   +4.265973503814366e-01   -7.510401622432036e-01   -6.452690297038419e-03   -8.862280713344267e-02   -3.786788137461309e-01   -2.131302872420942e-01   -4.651424586036181e-01   +6.765772955001237e-01   -6.386993564416880e-01   +4.958436444751053e-01; +5.979889613903997e-01   -6.771529771609284e-01   +1.192998325002660e-01   -3.462806381007544e-01   +3.324731962880574e-01   -1.707911305445935e-01   -2.180678114380572e-01   +3.190113838626676e-01   -4.374176689952547e-01   -1.122166738954923e-01   -6.059818580950166e-01   -2.423151194863404e-01; +5.580770649016893e-01   -6.801225312536241e-01   -1.216515553485935e-01   -2.703971680263509e-01   -2.208391240892489e-01   +2.998559164911863e-01   -1.721830316483506e-01   +6.253272031173895e-02   +5.844592758347034e-02   +3.734668010575172e-01   -1.655577129375864e-01   -4.826117019649975e-01; +5.053066189088228e-01   +8.071602964078628e-02   -3.327379361630078e-01   +1.458142995588533e-01   +2.779456702138298e-01   +5.258751939217008e-01   -3.483308984776546e-01   +4.798255104989473e-01   -7.500237117287551e-01   +4.005249116909700e-01   -2.859190093400644e-01   -1.140535860479048e-01; -2.169883167833762e-01   -2.924993528488502e-01   +2.477567591827593e-01   -6.352066087076181e-01   -6.652961591756552e-01   -2.603364123117483e-02   -3.596433357845963e-01   -1.612404465723109e-01   +1.033387650194475e-01   -3.020490613003577e-01   +2.096656268804635e-01   -1.866645114412452e-01];
L2E_L3E_iAMPA_netcon = [+6.209787824046059e-01   +6.631534426383949e-01   +2.503913710294071e-01   +2.749360548397902e-01   +5.545140324509878e-01   +3.738597335397951e-01   +2.251615830423459e-01   +3.875288775235875e-01; -2.999416191665437e-01   -2.317168254922674e-01   +4.997272970185077e-01   -1.164460557382226e-01   +4.038097583940175e-01   +1.163195771722617e-01   -2.067946562111538e-01   -3.446490343421876e-01; -8.747517537936289e-03   -4.876473603894634e-01   -4.824240708710859e-01   -1.377374433319202e-02   -6.123721786557562e-02   +1.071127862891529e-01   -4.561089657838847e-01   -1.792789466802326e-01; -2.005416971428745e-01   +1.798021429261734e-02   +4.775745249017608e-01   +6.844985913749259e-01   -2.910094367927054e-01   -2.585693145409406e-01   +3.677988066738453e-01   +2.455472477626082e-01; -1.781889401409522e-01   +3.766363397758221e-01   -6.199250145993718e-02   +2.518482514167165e-01   -1.608302781214781e-01   +1.732758562686130e-01   -1.096641591457307e-03   +3.476590927879894e-02; +4.366063482304831e-02   +9.750177584250611e-02   -8.415617293632018e-01   +6.848932542020241e-01   -6.568664476631594e-02   -2.317886861939419e-01   -4.281699241100876e-01   -2.615950288703227e-01; -6.644051150968937e-01   -4.510206382142771e-01   -3.735153235027875e-02   +1.098586775788326e-01   -4.092284441941518e-01   +2.719579878077861e-01   -1.301001248032024e-01   +1.632493507846995e-01; +6.876139123968844e-01   -3.267880910769549e-02   -2.371633289266452e-02   +4.223891696138702e-01   -2.097529196728504e-01   -7.777754933680389e-02   -5.187085744796710e-01   -1.340394523514910e-01; +1.833710199401434e-01   +2.220266345693063e-01   +3.856335096912413e-01   +2.144280429731844e-01   -6.250914969052326e-01   +3.556652805860573e-01   -2.286644875879866e-01   -5.923919593451118e-01; -4.449606836895723e-02   -7.365724379014629e-01   +4.351822993337349e-02   +1.531431143609299e-01   +4.480823477271754e-01   -1.748486446541294e-01   +4.536302448084819e-02   -4.741916373888925e-01; +3.808465580452648e-01   +1.608552281261782e-01   -2.592991432991249e-02   +4.009002149998846e-01   -7.602145582336856e-01   +4.895039045832850e-01   +3.220082573065259e-01   -4.885895686818835e-01; -4.351400908399088e-01   +4.775694952051541e-02   -2.684974130352207e-01   +9.298581348390035e-02   +1.995610644261906e-01   +1.000000000000000e+00   +6.609218124946226e-02   +1.461357315747070e-02];
L2I_L3I_iGABA_netcon = [+4.829654808058527e-01   -5.321880041333202e-01   -2.340424285425554e-01   -4.726198048326345e-01   -7.409036608430407e-01   +2.440433909658095e-01   +1.556332521072935e-02   +7.720847243272187e-02; +4.802772667224280e-02   -9.570581383093858e-02   +3.370306866582942e-02   -3.107087049146111e-01   -3.043821042281667e-01   +7.967673555921670e-03   -5.400614492396560e-01   +1.309440940099885e-02; +6.587493430500777e-01   +2.593398798893904e-01   +1.056567709736196e-01   +4.630594635528062e-01   +2.393899177351066e-01   +3.065744954817883e-01   -3.069817526597268e-01   +1.000000000000000e+00; -4.738079885190680e-02   -3.142004669246294e-01   -4.908510802791360e-01   -2.009481921693179e-01   -5.365388760976009e-02   -2.796065190001614e-01   -1.191731552984108e-01   -3.922603333872836e-01; -1.703869157544799e-01   -6.152473787743227e-01   -6.812555936352523e-01   +7.968445111702128e-01   +6.829179459916629e-01   +2.307118971751062e-01   -4.760712283020395e-01   +3.408633885431147e-01; -4.290519869243121e-01   +2.096787510963340e-01   +6.023655854544812e-01   -3.031878031312900e-01   +6.950162835661191e-01   -1.857583761470030e-02   +4.306618685707358e-01   +5.278778804023204e-01; +5.382303652888216e-01   +2.938469793759073e-01   +5.043307935290430e-02   +1.969474435948211e-01   -5.372156996237219e-02   -9.470592785957223e-02   +6.461926944969463e-01   +3.069927052421519e-01; +5.581488067964236e-01   +1.624392651482353e-01   +3.325145271516941e-01   -8.005276950877140e-01   -4.527029103337251e-01   -4.775137271278359e-01   +5.492961543702901e-01   -5.532229011388383e-01; -2.752126433519936e-01   -7.242442616767873e-01   -2.331605970444677e-01   +9.253588918436535e-01   +3.333453676831927e-01   -2.079386699172305e-01   -1.420670091876143e-01   +5.775055585097913e-02; -2.766679142969367e-01   -3.820353277061546e-01   -3.212637409528943e-01   -4.211250652020024e-01   +6.112936636809652e-01   +1.369265950170142e-01   -9.837523011017646e-02   -2.025421044542744e-01; -4.750415851870780e-01   +2.380792642435658e-01   -2.209842447537260e-01   +1.823986094629958e-01   -6.015450563933048e-02   -2.536724143924715e-01   -6.744431215948814e-01   -2.164293923192390e-01; -1.934960517904104e-01   +1.265204440591773e-01   -2.633817065781417e-01   +5.447613981160202e-01   +5.535790286012409e-01   +3.278067366083203e-01   -8.173426879025407e-01   -7.280964456338286e-01];
L3I_L3E_iAMPA_netcon = [+1.154885893840890e-01   -2.484526216410838e-01   -7.995655923958516e-01   -4.799279950921468e-01   -5.140206642889954e-01   +2.300396659755438e-01   -9.396484473244520e-01   +1.389650760274229e-01   -1.940937599810506e-01   -9.988089528889275e-02   -6.075304833938741e-01   -8.744783248927610e-01; -3.033369860358397e-02   +7.504245319964731e-03   -1.334338267146675e-01   -8.565145871663624e-02   +3.103832230763929e-01   +2.237460680890139e-01   -3.334897863552000e-02   +7.700619527190895e-02   +3.173804649280880e-01   -2.297823240611026e-01   +4.149333158919159e-01   +5.357889728610297e-01; +6.391414374349920e-03   -1.509299342777770e-01   +1.000000000000000e+00   -6.413041072864958e-02   -1.626270691424156e-01   +1.962608858038805e-02   +4.618568216434811e-01   +7.399870178519891e-01   -2.271465095106243e-01   +2.529102621753607e-01   -3.809363942524959e-01   +2.762692990114104e-01; -6.516460882377302e-02   -1.561972409004449e-01   +6.910073033677919e-01   -1.164393989775909e-01   +1.089131715671739e-01   -1.579497832720435e-01   +3.531985362854097e-02   +2.651089309530163e-01   -2.177056644790892e-01   -2.814839898481283e-01   +3.542515885867584e-01   -8.965520536605078e-01; -1.553009250085017e-02   +2.633617458708400e-01   -3.915416992510758e-01   +2.089269879217095e-01   -6.607177403331673e-01   -4.881819789800851e-01   -4.113935142321569e-01   +6.124872195533116e-01   -1.961222051002337e-01   +1.311951970109730e-01   -2.750787836389121e-01   -2.982024074810461e-01; -1.269780953137107e-01   -3.715413718248584e-01   +2.132399927948331e-01   +8.567630446123843e-04   +7.713099618939712e-01   +2.685792341476426e-02   +4.846557665513817e-02   -1.798653391178789e-01   -6.820909353891449e-01   -4.533169150713585e-01   +4.271597909940349e-01   -4.078950408197128e-01; +2.531694629949182e-01   +4.574666153505597e-01   -4.148853822032278e-01   -7.523781614947548e-01   +9.715720218576739e-02   +3.820167589805382e-01   -1.948383209772300e-01   -3.396769612141615e-01   +4.803244115810003e-01   +4.779507858449211e-01   +5.330595366190776e-01   +9.892696118886159e-02; +4.303067876966834e-02   -3.831878977202592e-01   -4.968939509939503e-01   -3.946199830280051e-01   -2.891978360899184e-01   +6.146578418394783e-03   -3.627347648043146e-01   +3.188116820002104e-01   +1.509358729302606e-01   -4.055160229837768e-01   -2.424476965528440e-01   +1.498168791755656e-01; -6.197469990120745e-03   +2.975515589852082e-01   -5.787228934908567e-01   +7.071746220647068e-01   +6.075469515956980e-01   +2.998981606763586e-01   +1.242162555347002e-01   +1.239079095790922e-01   -3.296284196015862e-01   +1.450053401952689e-03   +1.451665592818371e-01   +3.794152116654167e-01; -4.638516291258000e-01   -6.225373658669174e-01   +2.217312217957939e-01   +6.419658628526413e-01   -4.927196217989183e-01   -1.365606845882909e-01   -2.743355796347787e-01   +3.048551612688838e-01   +2.770505776909956e-01   -1.344018095640431e-01   -1.406844363367279e-01   -1.116629132312902e-01; +2.584900662352752e-02   +2.217787343384326e-01   +3.184766578656375e-02   +7.621717089368046e-01   -7.124660899160260e-01   +3.977737146969028e-01   -4.464335039624173e-02   +2.391202037075856e-01   -2.207792802162060e-01   +4.766149824911939e-01   -5.510652868883642e-01   -2.705225326074677e-01; -3.381056418708492e-01   -7.278125594620518e-01   -1.380206707092377e-01   +3.432883565147541e-01   -9.032543708594816e-01   -1.883411079513266e-02   -3.936884862640400e-01   -1.613330301575137e-01   -4.105613624733325e-01   +2.605207346349323e-01   -3.028608183421570e-01   +6.962656531554061e-01];
L3E_L3I_iGABA_netcon = [-3.854744656912891e-01   +3.804841928755754e-01   -1.097776483901631e-01   +3.902326482464557e-01   -6.335846620555657e-01   -2.666361553093194e-01   +6.206134285674780e-02   -1.729657706619050e-02   -2.111510114243592e-01   +4.282934375429257e-02   +6.542929892033437e-01   -6.659395967164164e-01; +1.883303946078462e-01   +1.625446907696234e-01   +1.054076540113852e-01   -3.821145339542359e-02   -5.402425429704413e-01   -1.161049215724007e-01   -8.850061631924273e-02   +5.041259314667870e-01   +6.726402211483236e-01   -1.397180391086080e-01   +4.066315291586982e-01   +1.988824204558921e-01; +1.984193093054273e-01   +1.864941477176618e-02   -2.620943830160544e-01   -6.602185193913923e-03   +3.364189291250378e-01   +1.806310595517867e-01   +6.320395159535112e-01   +1.940143717249292e-02   -5.849943085281375e-01   +2.634175009035013e-01   +6.443319428897876e-01   +1.363517250886678e-02; -2.713914556842784e-01   +5.603604737290873e-01   +5.520828405344217e-01   -2.973779738469723e-01   -3.322537913671981e-01   +7.762193668532569e-02   +2.649656814878764e-01   -2.420735408335770e-01   -6.253789361961815e-02   -2.177796548367891e-02   -3.781175705556451e-01   +3.402952505714470e-01; -4.766820639434137e-01   +2.546663049313449e-01   +6.789597277627769e-01   -3.633630935383476e-01   -6.324343953913523e-01   -1.889131113739747e-01   -3.731228587954943e-02   -2.381739881758010e-01   +8.114355026282329e-01   -8.165488128742547e-01   -5.772802649630576e-01   +7.681191978601911e-01; +2.639284149784215e-01   +2.191024133150029e-01   +3.747869244919466e-01   -1.333501080859933e-01   -3.305156677427387e-01   -3.991903458189150e-01   +3.342524394326690e-01   +6.247681313895422e-01   +4.091135746525582e-01   -1.589717098708733e-01   +6.058470051724815e-01   +1.478742883668072e-02; -1.271097034125710e-01   +4.456523662524001e-01   -2.184051025414159e-01   +4.877599868073849e-01   -2.620593808290550e-02   +4.775263651083070e-01   -5.749649540732112e-01   -2.197908979109120e-01   +4.404918475135484e-01   +2.065580209320539e-01   +2.051535993518955e-01   +3.999184110396331e-02; +2.032763627873087e-01   +3.510441616447166e-01   -6.543369807929492e-01   -6.582581133036958e-01   +4.968309343175873e-01   -1.526410581764694e-01   -5.255700755577380e-02   +4.852436429843933e-01   +4.268735407937008e-01   +5.572218022919857e-01   -1.477009117167744e-01   -4.023663743416058e-01; -5.001428009406530e-01   -6.607274566598791e-01   +1.859384208984806e-01   -6.554595563861519e-01   -8.437238046500821e-01   +1.307386462056768e-01   -7.504954901149760e-02   +4.971402319013718e-01   +1.960924848779107e-01   +3.823514693158236e-02   +4.564262826774638e-01   +2.535816113970629e-02; +1.883770281169607e-01   -2.427964341709485e-01   +3.513727357875430e-01   +5.386970192928786e-01   -5.870668622614519e-01   -6.937902183008778e-01   -3.999847675081575e-03   +6.436945399866376e-01   +8.226643841911512e-01   -6.583939172871260e-01   +4.562110701310005e-01   +3.960273367330325e-01; +5.896941721097817e-01   +1.077423385340966e-01   -5.263433279057284e-01   -1.850829835587203e-02   +6.103133447466127e-01   -3.581721466796124e-01   -3.956334177505305e-02   +8.069924792574262e-02   +1.687178864431136e-01   -9.724680598674085e-01   +6.235840093222915e-02   +2.120628128062285e-02; -9.824497086256952e-02   -1.365187588165963e-01   +2.749088137376539e-01   +2.605491883429782e-01   -1.072903050455059e-01   -4.180218281515394e-02   +4.255962698145274e-01   +3.742892991502097e-01   -5.613831585856301e-01   +5.871921048530678e-02   +1.433337295394675e-01   +2.504665660103331e-02];
L2E_Input1_iAMPA_netcon = [-8.034044918226839e-01   +2.057654880388862e-01   +2.270496173858324e-01   +6.230013278112325e-01   -6.163073649845399e-01   -2.661134867504085e-01   +8.142304907261033e-03   +3.684706860807291e-02];
L2I_Input2_iAMPA_netcon = [-1.799332287526955e-01   -1.722745844721565e-01   +3.168546113290706e-01   +3.303064464903595e-01   -3.242653437365219e-02   -5.249896665674495e-01   -3.655106374861636e-01   +5.005528589061643e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
