function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.693632547480434e-01   +1.786660735987589e-01   -6.641706910580701e-01   +2.967567508547885e-01   +4.624624919935222e-01   +6.103951503212148e-01   -4.453890861240967e-01   +1.786210231169723e-01   -2.100359772282126e-02   +1.600484098377524e-01   -7.825685626446078e-01   +4.041543124518428e-01   -2.781184224428572e-01   +2.996184922545747e-01   -3.605583798754904e-01   -8.107886266249689e-02; -1.591608417369547e-01   -4.788906147336596e-01   +4.561019580100457e-01   +1.394348848954660e-01   +6.658420406011946e-01   -1.958215223707594e-01   -2.825562394842498e-01   +5.222473672940596e-01   -5.991783494486722e-01   +1.290629510530090e-01   +6.464405481791130e-01   -1.711730692616037e-01   +1.100860681802824e-01   +3.192379170831393e-01   +5.172548707782121e-01   -1.796745892275071e-01; +4.984184367616362e-01   +4.688195675984437e-01   +1.147507673431378e-01   -6.926091149287619e-01   +3.769007219125503e-01   +7.526367113971322e-01   -2.307543564149245e-01   +6.117462302495786e-01   +3.624364805551691e-01   -7.724427569432381e-01   -1.866776293705714e-02   -1.666755077696170e-01   +2.249842312749034e-01   +1.999671946562054e-01   +4.871432495529273e-02   +5.969493115958781e-01; +3.197292869490871e-01   +8.788158483515722e-02   -3.468482282517438e-02   -2.581792383809709e-01   -4.243789735250681e-01   +9.494975791844149e-02   -7.715273995671985e-01   -1.482500943058659e-01   -4.416270279479119e-01   +3.232433687834102e-01   +4.206669126810115e-01   -6.653923089693602e-01   -3.894387805692530e-01   -9.811480651541676e-02   +2.418802039490980e-01   -8.449024149820674e-01; -5.879365669898808e-03   -2.120733952917337e-02   +5.004531453683916e-01   -2.940744845278292e-01   -3.494309778895267e-01   -4.670667601931717e-01   +1.346934177367129e-01   +2.804753072906617e-01   -2.638674033385074e-01   +2.292916941377245e-01   +1.647457517080041e-01   +5.685403734848206e-01   +7.160538604951149e-02   +5.226358149659235e-01   +8.113090807090950e-02   +1.580851853140613e-01; +7.552726037622121e-01   +1.055185864598145e-01   +5.534949394067037e-01   +6.657254246540739e-02   -7.350737761404010e-01   -2.860024104946876e-01   -2.365918930165197e-01   +1.725266392524378e-01   -6.862589148389276e-01   +3.990043719601127e-01   +1.846054499878993e-01   +3.171947612671801e-01   -7.193522750307590e-02   +3.981289701611365e-01   +5.159265211524158e-01   +2.367086664636676e-01; -3.511540632579211e-01   -6.122929303651486e-01   -6.543733884001038e-02   +7.360968488647200e-01   -6.444319295250032e-01   +7.068396035515425e-01   +2.476619164430375e-01   -1.271731877224799e-01   -6.415631204375815e-01   -4.231021379754106e-01   -8.534857447067211e-01   -2.073704456343823e-01   -2.814117128261106e-01   +3.120917750033099e-01   -4.516011835703006e-01   +4.313855999234660e-01; -5.138434203263739e-01   -2.317977073353343e-01   -1.777163124301361e-01   -4.626981186124981e-02   +3.081167233784084e-01   -1.342133830901273e-01   -1.614252469222405e-01   +3.564195188177813e-01   +7.454569032117541e-01   +4.603962997547840e-01   +3.313736639996172e-01   -3.125710275862379e-01   -1.903538668326687e-01   -1.264753552617021e-01   -1.019722525178819e-01   +3.824106773125172e-01; +3.350825822586183e-01   +1.675478499884502e-01   +1.324641766938463e-01   +1.559524070795194e-01   +7.517739774524403e-02   +4.452293275692648e-01   -5.005515240404883e-01   +2.620025784101712e-01   +1.994825991747353e-01   +1.849254838931233e-01   -3.592867435046054e-01   -1.854705499240112e-01   -4.173007927290662e-01   +1.171148751511328e-01   -4.763931863535763e-01   +4.206510204101778e-01; -6.994111124320465e-01   -1.505054173972295e-01   -2.470819799378714e-01   +8.368350988709422e-01   -2.445533326674562e-02   +3.611161395575515e-01   -3.832132055415576e-01   -8.970107953003805e-01   -4.798404717413408e-01   +2.018983029235851e-01   +5.681203015261840e-01   -1.000000000000000e+00   -5.123254141205951e-01   +8.941005329912507e-03   -2.097567041188928e-01   -3.686884592560347e-01; +5.710304674659770e-01   +6.546505584644929e-01   +8.375448220809416e-02   -7.089477782859059e-01   -4.069953133455578e-01   +4.898524660797984e-01   +4.743714305294349e-01   -2.533864330410286e-01   +3.920613117036530e-01   +9.759730179351582e-02   +1.170781997260377e-01   -9.037510868221957e-01   -7.644938969636321e-01   +5.992679456411650e-01   +5.760523606505003e-02   -3.091222490719256e-01; -1.472801035667992e-02   -4.902959978879626e-03   +1.810349071534793e-01   +4.887204040124368e-01   -5.357962619896625e-01   +2.828499504862466e-01   -1.531294953209875e-01   +6.570113896644225e-02   -3.488684863090800e-01   +7.230487181188991e-01   -7.722060506990688e-01   -4.904742914890454e-01   -2.792452014089675e-02   +3.954699326397215e-01   -1.726795390941038e-01   +4.656025564636927e-01; +7.200589353024349e-01   +2.868576345841139e-01   +5.640942760841205e-01   -1.845071755109022e-01   -9.670411966591512e-01   -2.007675503947682e-01   +5.604054905921008e-01   +4.035950647515307e-01   +3.882210837093637e-02   +3.828360482935680e-01   +1.036435749106841e-01   +8.461139040296799e-01   +6.732812674576818e-01   -8.051866695536264e-01   -8.479838710935517e-03   +6.599870651903866e-01; -3.481862125467493e-01   +1.113707941764156e-01   +4.172639984597786e-01   +7.141393695301326e-01   -6.267928774004911e-01   -2.564505716550776e-01   -2.725957722325131e-01   +6.202819606809629e-01   +3.305796047625042e-01   -2.812183841517152e-01   -1.531281318446990e-01   -4.402913918715092e-01   -5.958785909521161e-01   +5.591471887432923e-01   -1.498353674389840e-01   -4.005402980333378e-01; -2.742703992818420e-01   +5.135163416087907e-01   -5.562211226887958e-01   -1.636159372745328e-01   +8.676838640184978e-02   -1.377362326295780e-01   +5.705275399090974e-01   +1.881315847143287e-01   +3.909583048447636e-01   -2.454027755324213e-01   -4.495533525021293e-01   +4.193498878244272e-01   +5.043570523481855e-01   -1.910393264071702e-01   +6.614505853801410e-01   -4.129138215507226e-01; +3.388127981507323e-01   +5.277892910510396e-01   +1.351395102146549e-01   +3.572143449373676e-01   +6.595724414170159e-01   +4.235519081834681e-01   -4.859916191102739e-01   +1.166799961732501e-01   -3.786048930319837e-01   +4.197529933821830e-01   +1.275821653505508e-01   -5.178109864337826e-01   +3.741871611031122e-02   -1.864746540291044e-01   +2.578357448262490e-01   +5.973069509144721e-01];
L1E_L1I_iGABA_netcon = [-3.326386214332575e-01   +7.549364108184359e-01   -4.049298579253576e-01   +3.013564279263410e-01   -4.805073769399039e-01   -2.968636798762234e-01   -5.839317061288892e-01   -3.554900168094610e-01   +2.737811580368103e-01   +2.347166201308818e-01   +5.431607527734492e-01   +8.668198883908114e-02   +1.813577589686933e-02   -8.161677421520196e-02   +3.463570960035086e-01   +4.944905449884290e-01; +3.941529192046689e-01   +2.973971443356852e-01   +3.041591653796751e-01   +5.485601050637868e-01   -3.420832016450365e-01   +6.068728396951220e-01   -5.064293680664705e-01   -5.073071893581489e-01   +6.585355570074253e-01   -4.172596129650262e-01   +9.804810297974075e-01   +5.878925348234151e-01   +8.234208878870027e-02   -1.508371286891734e-01   -6.607414625740460e-01   -3.522459309610652e-01; -1.281954972324622e-01   -7.497599403127504e-01   -3.170964785380105e-01   -4.895068726152734e-01   +5.372896907677801e-01   +5.112927884553370e-01   +1.445706656011323e-01   +2.891282176127365e-01   -5.179188114043575e-01   -8.631577027151465e-01   +3.870092241963906e-01   -1.503571377960827e-01   +1.054496154212036e-01   +3.753903802149656e-01   +5.975660782365710e-01   -2.673641429093013e-01; +1.419246412288754e-01   +2.305044674295527e-01   -4.442087352237322e-01   +6.140397069328383e-01   -6.181246966477373e-01   -2.297363542390633e-01   -7.072508139022798e-01   -3.104080058269973e-01   -6.176817348307651e-01   +3.763059854453134e-01   +8.614693156527951e-02   +1.000000000000000e+00   -4.710035351263884e-01   +3.118250193776725e-01   -7.387842358285968e-01   +1.100401135245698e-01; +7.546026097206654e-01   +4.339619037794580e-01   -5.227760331301942e-01   +9.216981825168772e-01   +2.895981875198837e-01   +4.748433021299648e-01   -2.764312280076598e-01   +6.567687837123196e-01   -4.909761345705673e-01   +6.043416945407325e-01   -1.488298647764728e-01   -7.713670727420986e-01   -1.731081377507776e-01   +2.213105227428623e-01   +6.040146527163255e-01   +2.133483515356353e-01; -2.036487268969942e-01   +1.512986827349448e-01   -1.561981538027901e-01   -2.098021162005589e-01   +8.780295529605252e-01   -7.849187379486476e-01   -4.280854729154085e-01   +7.494596487477329e-01   +1.011786837098800e-01   +3.578144527012188e-01   -4.086001608583403e-01   -3.872725254303368e-01   +6.978994120864490e-01   +4.423337834519934e-01   -5.140091053161784e-01   -2.401618657949549e-01; +3.535372228985442e-01   -7.967160815438580e-01   -8.790650450910106e-02   -5.349220665621712e-01   -7.102116878506229e-02   -3.075426295325280e-02   -5.292819474337468e-01   -2.545926706782096e-01   -6.197604236796730e-01   -3.424659324067099e-01   -9.799868875715691e-02   -1.356204178585919e-01   -7.891852394327232e-01   +9.014439023977856e-02   +4.747582269335583e-01   +6.013615684853809e-01; -8.357982442133262e-01   -2.213228339217423e-01   +5.582143442254540e-01   +6.785380789867019e-01   +5.747166415341027e-01   -2.631177878448799e-01   +1.179575159438901e-01   +7.160368802506343e-01   +9.595491538367626e-02   -3.527692476567441e-01   -5.087305850310919e-01   +9.014991260513500e-01   -4.353934857364269e-01   -4.056998138189473e-01   +1.253083724632994e-01   +4.121502173325671e-01; +5.766908547577471e-01   -6.472190450729989e-01   -4.860276922355719e-01   +1.083001653222951e-01   +6.223777390284394e-01   -7.143727751492321e-01   +3.061885549617678e-01   +4.678056119118921e-01   +2.453509049174383e-01   +5.562792680814529e-01   -9.478921066927665e-01   +7.791104610773786e-01   +4.926586168324384e-02   +8.753523028069236e-01   +1.962744494869268e-01   -6.905481220971348e-01; -5.907151329556515e-01   -4.375286047920366e-01   +7.269995312382355e-01   +4.371132072565940e-02   +4.919351467266176e-01   +7.107363971341825e-01   +3.045723320345287e-01   +1.567930469791190e-01   -2.073786798452328e-01   +8.155300654386850e-01   +5.038992772439659e-01   +7.548275882312598e-01   +3.543129983727276e-01   -4.330836682911726e-01   -4.621403730821087e-01   -7.326033164573044e-01; +4.297971389690671e-01   +5.121860396572921e-02   -5.534397478795827e-01   +4.197673202788356e-01   -2.383332760852280e-01   +1.955203687131125e-01   +8.969451635220619e-01   +7.339853678411843e-01   +4.954850779312873e-01   +4.589090318751560e-01   -4.247601561707271e-01   -8.036180751938892e-01   +5.377504615693031e-01   -4.630522303156541e-01   +1.681945731327191e-01   -2.141385404880281e-02; -1.119162464835454e-01   -3.362297174554980e-02   -2.232594396111982e-01   +4.171775276619299e-01   +8.103883808537669e-01   -6.074271434356380e-01   -4.505150112148052e-01   +6.770750587041289e-01   +2.849762922554042e-01   -6.058147456592972e-01   -8.788723027905134e-01   -2.382047956113672e-01   -1.721317413430959e-01   +2.264796978966649e-01   +8.841812890834299e-01   -2.965957383945760e-01; -2.230224012224403e-01   +5.445277782114222e-01   +4.636518689900295e-01   -2.775370302364975e-01   +1.559962397248081e-02   +3.821356606719887e-01   +4.108800851236359e-01   -4.273564879796005e-01   -2.740123081502894e-01   -2.248386055419883e-01   +8.209563674128525e-01   +3.954520456279877e-01   -4.799451364669117e-01   -1.264963507362658e-01   -9.232599784942864e-01   +4.994726929899697e-01; +5.851191764151072e-01   +2.133294541258536e-01   +1.541726635088677e-01   -7.173981952979669e-01   -3.337410073457435e-02   +7.641763024899181e-02   -7.725297526143288e-02   +6.164239005677745e-01   -6.663621964474281e-01   +6.587389626719309e-01   +3.824650044721924e-01   -5.092912242417615e-01   -3.855791290490814e-02   -7.173352918250679e-01   +6.683029632481460e-01   +3.613392060522287e-01; -1.676206882588350e-01   -5.793111108047450e-01   +4.694450867771497e-01   -1.214150213430968e-01   +8.676769066641126e-01   -6.524248976758401e-01   +4.045453502932618e-01   -3.747364182359822e-01   +3.077767373138612e-01   -1.189329445217322e-01   -2.282026316105569e-01   +1.214573460690356e-02   +2.165080701620691e-01   -6.294541837830675e-01   +4.925751761475040e-01   +1.807202348438205e-01; +1.263431392299223e-01   -1.952458978776786e-01   -2.719811597583142e-01   -5.278427133272231e-01   -5.529414948943030e-01   +5.380209604965532e-03   -1.858755233883621e-01   +3.450278052298429e-01   +7.287099701238294e-01   +6.695645798438133e-01   -4.675516601545185e-01   -1.192244790552415e-01   -3.650175405016974e-01   +6.130579570297265e-01   -4.516552776765950e-01   +9.113995642934213e-01];
L2I_L1I_iGABA_netcon = [-4.987288059991865e-01   -3.652974802327681e-01   +2.186774304906206e-01   +1.490408309241001e-01   -7.659917202709684e-01   -3.014450359188099e-01   -5.851546546201558e-01   +2.503586959956271e-01; +2.054438175511865e-01   +1.506990725108419e-02   -4.765856132983027e-01   -1.207307830888636e-01   +1.491902422490484e-02   +3.642713941121282e-02   +2.678193284010777e-01   -1.188197373859214e-01; -7.463304679464606e-01   -6.042423326674657e-01   -1.000000000000000e+00   +2.940837593298185e-01   +3.497640621866181e-02   -6.565400568145000e-02   +2.802891139288587e-01   +9.370442764020727e-01; -5.408452474849694e-01   +2.872027521165907e-03   +1.446549726547190e-01   -1.713623282329392e-01   +2.392566495338706e-01   -5.234744932495708e-01   +6.304822723273635e-01   -8.506624841457793e-01; +2.628206836606479e-01   +5.987466111165777e-01   -3.672931733567041e-01   +5.669017926703624e-01   +7.329841224002187e-01   -1.462442118031838e-01   -3.044562162076062e-01   +6.718622742495015e-01; -6.429992520424529e-01   -5.049631290097912e-01   -2.787034202364118e-01   -1.126014814608952e-01   -8.112132468174560e-01   +2.005676480417153e-01   -7.851444072739979e-01   -5.647995318100484e-02; -3.643653765991762e-01   -1.318065940684605e-01   -1.822483164010643e-01   -1.823309745103754e-01   +6.949727364685450e-01   -9.565767807838044e-02   +4.816953641015212e-01   +1.155994921680681e-01; +8.565583658733761e-01   +2.446870715202576e-01   -3.299617391314250e-01   -2.359815460266933e-01   -6.460087362030621e-02   -1.108829786877707e-01   +3.252236677565847e-01   -2.369158476927331e-01; -6.770035080758952e-01   +2.064601952815263e-01   -4.611051550874089e-01   -1.759434526065537e-01   +4.135661072826741e-01   -2.433332813741396e-01   -4.834662810970461e-01   -2.676446521438740e-02; -4.481662145846280e-01   +3.691619896501597e-01   +8.072516647710971e-02   -6.561055929676946e-01   +3.439310068717951e-01   +4.440010876029779e-01   -7.749080344262503e-01   +4.713717800966262e-01; -8.595081012383987e-01   +3.745783709670422e-01   -7.749281983435290e-01   +7.790914360407259e-01   -4.783070058969339e-01   -6.218930111324398e-01   -2.270283709183274e-01   -9.826501098418393e-02; +1.919770063790426e-01   +4.882814675547534e-03   -1.894573597380750e-01   +1.868554295754649e-01   +8.477124738682601e-01   +3.686986718308770e-01   -4.176327323292124e-01   -9.680418033430824e-02; +4.222373949810805e-01   +9.168209930132435e-01   -7.517128651640689e-01   -8.533088856843486e-01   +1.731219556972967e-01   -2.093442468980268e-01   -7.190874427335668e-01   -4.043513917133578e-01; +4.405211822501089e-01   +1.479078837994911e-01   +7.224992872359587e-01   +3.486245946800101e-01   -6.650061823259714e-01   -3.396437558108814e-01   +1.320403256754922e-01   -3.248419429292853e-01; -5.617242447092001e-01   +8.992700321272035e-02   -2.046557440836640e-01   -2.890812713484117e-01   -6.028783506541134e-01   -7.100512166080715e-01   -3.578806451305112e-01   +2.956308793635640e-01; -2.874016091855861e-01   +8.323573613583035e-02   +9.907172495424520e-02   -4.262620052143696e-01   +1.959661587289953e-01   +9.239705216781066e-02   +7.330620908191083e-03   +6.195619548995522e-01];
L1I_L2I_iGABA_netcon = [+2.634263561722595e-01   -1.600569427672605e-01   +9.615165069376789e-01   -7.515841508561869e-02   +5.692274638231678e-01   +6.379132244701828e-01   +7.144913784805390e-01   -8.243149736094786e-02   +9.961950719323635e-01   -5.720320384532378e-01   +3.115309359562238e-01   -8.105121639385414e-01   +6.136995882899226e-02   +1.406739252821617e-01   -2.573281856201467e-01   -6.336179668250436e-01; +9.194621622524715e-01   -5.262516434309599e-01   +7.097115834426116e-03   -3.327767051445465e-01   +5.961016664605129e-01   -5.079395463814954e-01   +7.279156109477848e-01   +5.688850658749914e-01   +1.159386552764379e-01   +3.433678694376979e-01   -4.566091651579564e-01   +3.183126899980289e-01   -7.295740198620619e-01   +4.258958269381731e-01   +1.807098679501323e-01   -9.347943242409306e-01; +1.977701540123646e-01   +6.013612648250913e-01   +3.853435245244560e-02   -1.259964892647044e-01   +1.426787023076283e-02   -1.740318883747798e-01   +9.187345482466519e-01   -3.032705234035822e-01   -4.056240583494295e-01   +6.492541424538300e-01   +3.442603910860553e-01   +4.748478253841419e-01   +1.000000000000000e+00   +3.018432918023908e-01   +2.390282957505930e-01   +3.261292401278075e-01; -3.657851691228637e-01   -6.959784778124749e-01   -1.111955649690321e-01   -3.623995150216575e-01   +6.727886528180029e-01   +6.354657109964247e-01   -2.476124300396200e-01   +2.823184670319372e-01   +9.547312601953050e-01   -3.488023489935194e-02   +4.134989592334745e-01   -4.202382074436640e-01   -4.914929210884794e-01   -1.263034928051427e-01   +2.892893312901664e-01   -1.968813386809648e-01; -4.763130410643127e-01   -1.848734898077893e-01   -3.711759137253969e-01   +4.026347090682597e-01   +6.935957452317205e-02   -2.866679762848047e-01   +1.952486086615482e-01   -2.116856726641551e-01   -5.287752588402539e-01   +1.645076506894954e-01   -1.483417176194853e-01   +2.267945680613905e-02   -7.619003280613800e-01   -3.766505844600123e-01   -1.655769586480074e-01   -2.238119910222278e-01; +2.767777417251385e-01   +1.816138030516631e-01   +1.065116502007846e-01   -1.479976142388377e-01   -7.320298315525936e-01   +4.790224400063346e-01   -2.056065427772769e-01   +1.243584099232285e-02   +5.686441931137191e-01   +4.099676911612287e-01   -6.478677657045082e-01   -5.277414077873002e-01   -2.336165326380150e-02   -7.525418751584754e-01   -2.572871623841915e-01   -5.551277099658680e-01; -3.254260674891967e-01   +6.458555234332781e-01   +6.388336648118503e-01   +1.823397780668017e-01   -1.870332234395224e-01   +4.979972779071645e-01   -3.244828775294317e-01   -8.301892682313692e-01   -6.951923047468012e-01   +8.542631022461084e-01   -5.671241720949209e-01   +1.746102379088776e-01   +2.804956788698369e-02   -5.227526660124823e-01   -2.896461243998727e-02   +1.828219031817124e-01; -7.110892404121480e-01   +2.263655225903858e-01   -1.619886989933927e-01   -9.697712734457948e-01   -2.870484854263438e-01   -4.271684604796996e-01   -4.605374050721003e-01   -3.346898958504552e-01   +3.612593634274868e-01   +1.098553906814549e-01   +3.040886170593832e-01   -4.875937884590865e-01   -2.585945159463702e-01   -1.951169250297430e-01   +8.905029476268975e-01   +6.524887192424010e-01];
L2E_L1E_iAMPA_netcon = [+1.134290619732057e-01   -1.347680542358378e-01   +9.404154348313908e-02   +5.352589342712041e-01   +5.489306946520823e-01   -1.659265500037605e-02   -1.532286947379939e-01   -4.720279453371202e-01; +8.674076021883182e-03   +1.314950932005489e-01   +6.111868682537344e-01   -3.788032186984480e-01   -4.429307079199776e-01   -7.515474102182973e-02   -6.296488783274546e-01   +2.521667253454424e-01; -2.601837161705221e-01   +7.217285462688221e-01   -1.105412428438481e-02   +7.157038439272866e-02   -2.799142934120453e-01   -1.858099252033692e-01   -4.988276673460423e-01   +6.251979662511176e-01; -2.951114521747624e-01   -2.585788264967460e-01   -4.905728504681541e-01   +1.693052331325241e-01   -7.386681057079700e-01   +3.991227172571473e-02   -8.593669490877907e-01   -2.914751491255692e-01; +3.062763855166852e-01   +1.763016561335286e-01   +3.464472855192995e-01   -9.053283402436822e-03   -3.103183300422358e-01   -2.312783813737854e-01   +3.237304230501850e-01   -6.124596439769319e-02; -7.186385709946267e-01   -6.438917492096886e-01   +1.219292224775370e-01   +1.246066953958505e-01   -6.171195044369191e-01   +1.841811693214649e-01   +3.714737018176885e-01   -4.663356991046693e-01; +4.203889372201902e-01   -2.243921598811797e-01   +4.576811657879055e-01   +7.411624501231800e-01   -9.340855422242592e-02   -4.903909107844182e-01   -3.161342198041353e-01   +4.153757361860443e-01; +5.125834450600999e-01   -3.773490298689980e-01   -3.832291098918110e-01   +7.069917383815651e-02   +5.522153949142432e-01   -6.883797111825305e-01   -4.734380176629833e-02   -7.498665486248454e-01; -1.020298401569571e-01   +1.466777917018552e-01   +3.503255775062884e-01   -4.165376846079447e-01   +3.567815202299569e-01   -8.058108702135733e-02   +4.877139733726176e-01   +2.004948969877608e-01; +5.522386856301303e-02   +4.635394060063778e-01   +9.346240794897452e-03   +3.478369991074078e-01   +2.768353832896437e-01   +6.849635693310603e-02   -1.462317659840719e-01   +4.408088121451498e-01; +3.938304169584340e-01   +8.230850413629809e-02   +1.172717986133874e-01   +2.741055632210796e-03   -1.886316904172240e-01   +5.919155251250324e-01   +2.306141825347128e-01   -4.051243540348446e-01; +4.425741571389497e-01   -5.717251272143028e-01   -4.413493213747244e-01   -4.258444926445508e-01   -2.517369929278385e-01   -6.083464992911037e-01   -4.018331207998521e-01   -1.395290945231382e-01; -6.319421541435963e-01   +3.663719884373138e-01   +7.204466029691071e-01   +1.764158867158612e-01   +1.908943413900400e-01   +1.584193408590619e-01   -1.321203280119642e-01   -4.570247412008017e-01; -3.198760408741410e-01   -4.394432471652440e-01   -5.927350273449769e-01   -5.308824454636424e-01   +1.489904952693505e-02   +2.054755130595705e-01   +2.596359452163781e-01   -6.231999002488309e-02; +2.395572860986054e-01   -4.164313504149679e-01   -2.248651796544502e-01   -1.335531601225755e-02   -3.317701999974866e-01   +2.699972339957101e-01   -2.586425686686181e-01   -3.479869051722039e-01; -3.031035945400357e-01   +3.518326031517949e-01   +2.681103148299310e-01   -6.320688930696118e-01   +1.000000000000000e+00   +3.910977149728032e-01   +7.724664936235059e-01   -8.135243182931848e-02];
L1E_L2E_iAMPA_netcon = [+4.643660160622406e-02   +4.321456690293098e-02   -2.750053706119445e-01   -7.395605784778463e-01   -7.674726551254166e-01   -5.816617365743195e-01   +3.612691574875971e-01   -5.130372488462891e-02   +4.873438814125240e-01   -1.490161802404513e-01   +1.752894475142474e-01   +2.979442001280336e-01   +4.667823640044685e-01   +4.927239261946934e-02   +2.805873899954221e-01   -1.785317418675609e-01; +1.791538418263580e-01   -2.366571248447354e-01   +3.836129272497140e-02   +3.849283123574116e-01   +3.505774903372299e-01   +2.032301851441704e-01   +2.445134565474875e-01   -3.805627822246097e-01   +4.090405929878831e-01   -6.009878815235875e-01   +1.849381593262188e-01   -5.610446587827552e-01   +3.055756995481907e-02   -3.618726732530884e-01   +6.422738673078071e-01   +2.864433466932168e-01; -1.816022011894898e-01   +2.739615142456333e-01   -7.230019599527171e-01   +1.000000000000000e+00   -3.304162595656136e-01   +4.112583574028425e-01   -2.027320691104261e-01   -8.889393659981945e-02   -3.212531957282085e-01   -5.960353133560186e-01   +5.399274115020805e-01   +2.087799373533649e-01   +4.343817731203339e-01   +4.487715180270337e-01   -7.056732215702488e-02   +5.884383846984842e-01; +6.460033662217287e-01   -3.140306793719209e-01   +3.805546422871442e-01   -1.601901945676434e-01   +3.435813794290963e-01   -8.495656611805460e-01   -3.529207896925379e-01   -4.897966532060787e-01   +4.837951429131656e-01   +1.933681865517401e-01   +6.095373835950608e-01   +1.440527002900297e-02   +1.983645633567407e-01   -7.864826694078288e-02   -7.059249336529151e-02   +8.521830417126344e-01; -3.145335701493734e-01   +2.004134224250893e-01   -4.937715094787704e-01   +2.987386535318176e-01   -7.898681467405455e-01   -7.742232695192156e-01   -3.391958420178938e-01   +7.292493986008814e-01   +7.339197091626336e-01   +9.360236791446074e-01   -4.122078440958066e-01   -3.792991521368044e-03   +4.953493227194471e-02   -2.118051936104000e-01   +8.183181146590876e-02   +4.822700156196122e-01; +8.049098543547500e-01   +3.119876079342302e-01   +4.556517683763541e-01   +5.862104760820215e-01   +4.714685427552694e-01   -2.196420159953482e-02   +4.253308105794714e-01   +6.666027237307859e-01   +1.461620665981471e-01   +7.609916559144245e-01   -1.390489473851780e-01   -9.563150503075139e-02   -1.392083848753449e-01   -4.145088005314999e-02   +3.044620767868518e-01   +4.330407298656948e-01; +5.992285051207744e-01   +6.283315636543986e-01   +4.395064938382331e-01   +7.013724482655368e-01   -2.042840321167800e-01   +3.641869575360751e-01   -7.155444042676349e-01   +3.528914059003472e-01   -7.221604674926907e-01   +1.473830919833687e-01   -2.370063812143674e-01   -7.332608741912827e-02   +1.218162477104830e-01   -6.525075374826461e-01   -4.795823470627149e-01   +6.636714823381468e-01; +4.741169177477313e-01   -5.638063915601558e-01   -4.157830376295989e-02   +7.144836054738456e-01   -6.696521103070409e-01   +3.631747835670825e-01   +5.744210674954354e-01   +5.654014893230300e-02   -7.157329418588002e-02   +1.888016005283355e-01   -4.534407653865130e-01   +3.474419527410252e-01   +1.790137487522668e-01   +2.306561434805984e-01   -4.904314287182120e-02   -1.782790211398649e-01];
L2I_L2E_iAMPA_netcon = [-4.295647044932791e-01   +1.203233805681289e-02   +1.710600489672098e-01   +7.815173055203369e-02   +1.252554327727624e-01   -4.493253041660049e-01   +1.601345881409471e-01   -2.159749024857334e-01; -5.380341219492338e-02   +5.472513516590212e-01   -5.664432246368942e-01   +1.612840073060164e-03   +2.008306731993156e-01   +1.626982820495371e-01   -1.928619603583134e-03   +7.950095562356795e-01; +1.118365140945772e-02   -1.449726156730930e-01   +8.466432730782325e-01   -2.258880225506292e-01   +3.580997299426044e-01   -5.279286751191773e-01   +4.667334029957329e-01   -7.143870924469254e-01; +7.278622896863925e-01   -2.773327900913038e-01   -1.000000000000000e+00   -2.156158745367037e-01   -1.310151368832985e-01   -3.197876535279750e-01   -4.414566995545818e-01   +5.718845395535478e-01; +4.700667431875810e-01   +4.667533615145615e-01   +3.380698668961720e-01   -5.448114332595339e-01   +2.213043508567412e-01   -8.131967029008255e-02   +5.047356655142040e-01   +6.059370158159912e-01; -4.893527024706681e-01   -4.055854622631546e-01   +2.853982383419338e-01   +2.426141633165347e-01   +7.385600984566589e-01   -1.671630721380363e-01   -2.659930651259696e-01   -1.119893015828204e-01; -8.255633106208643e-01   -6.405445208396527e-01   +1.344572107993609e-01   -1.521665262047072e-01   +1.677698935005311e-01   +1.901218732584097e-01   -8.437901613124471e-01   -5.240321301824454e-01; +1.865374825571969e-01   -9.159157700940941e-02   -1.628502937303784e-01   +1.602735539012699e-01   +3.903388323744891e-01   -9.775626768252802e-01   +5.062929335929761e-01   -1.043643409993096e-01];
L2E_L2I_iGABA_netcon = [-8.798639858795740e-01   -1.665579365466500e-01   -4.735403365209183e-01   -9.568951439283058e-01   -7.436817697382878e-01   -2.621418703056892e-01   +3.711370083946983e-02   +7.562776007243275e-01; +7.363247787297679e-01   -3.998980708368187e-01   -7.227397463789627e-02   -5.285424968748965e-01   -6.439974133730825e-01   -4.243750637130824e-01   -7.770799132266680e-01   +3.647333890318458e-01; +2.148528039809935e-01   +4.282451145882381e-01   +6.342373777844496e-01   +5.504616971426260e-01   -5.069721713755453e-01   +5.868106017546615e-01   -1.000000000000000e+00   -4.183646133830967e-01; -6.438125010701468e-02   +1.282640792090972e-01   -1.755023316766129e-01   -6.029210951937496e-04   +5.707966525108196e-01   -3.605945002303109e-01   -2.058875809964862e-01   -2.217811628194679e-01; +5.863430184280489e-01   +5.778331940467092e-01   -7.607761204619946e-01   -9.973245419450142e-04   -4.000000853417651e-01   -3.094749310099066e-01   -3.394336595081234e-01   -3.319543166415768e-02; +2.278713486368661e-01   -3.608383413035487e-02   +8.671970417599555e-02   +7.018768957867176e-01   -2.246990267628924e-01   -5.346905409829409e-01   +8.163146611021230e-01   +3.235356897911854e-01; +6.625536578751449e-01   +7.239242619101202e-01   -2.989745571234133e-01   -4.981602084213566e-01   -3.704179049987102e-01   -7.880569908083780e-01   +2.946680196163961e-01   +4.562518321693347e-01; -3.710956805398450e-01   -5.200801508845028e-01   -2.137858090595832e-01   -2.584738362714715e-01   -1.394638694634758e-01   +3.940922407494837e-01   -8.136309716522926e-02   +1.549082433815789e-01];
L3E_L2E_iAMPA_netcon = [-2.425049422053442e-02   -4.138424470344292e-01   -5.253724351182784e-01   +4.933078536347597e-01   +3.558392819774136e-01   +2.534076263566889e-01   -5.695692601439100e-01   -5.810847858110180e-01   -3.612780910230693e-01   +7.273407874867938e-01   -5.171984053048900e-01   +2.996037036470625e-01; +1.717131164779642e-01   -6.708577592331330e-02   +4.028851796055463e-01   +8.053502702380415e-01   -1.483184773744741e-01   -7.377205485605169e-02   +9.644801274601760e-01   +7.710599644132058e-01   +1.843053812787135e-02   +1.588486438963752e-01   +1.328667937072513e-01   -1.172734740261426e-01; -1.182640722172020e-01   +4.913388007622774e-01   +4.271962917807919e-01   -4.860170021939118e-01   -1.000000000000000e+00   +3.195184355213095e-01   +3.561634391606454e-01   +5.228114727747647e-01   +4.885304119876288e-01   -1.696301500835790e-01   +3.367322390198498e-01   -5.924623423934408e-01; +8.493130207018218e-01   -2.657605672168519e-01   +3.640501743688553e-01   +4.582584739808919e-01   -2.629839829575844e-01   +6.192975531647670e-02   +3.155612715916640e-01   -6.205920468915471e-02   -2.145319352804059e-01   +2.878895905184070e-01   -4.973096260217332e-01   -4.483233826429788e-01; -6.143576002513009e-01   +4.342329113148808e-01   +1.423256952295399e-01   -1.118524725168112e-01   -8.712530917896859e-01   -2.785835391053407e-02   +1.819172681511549e-01   +8.017250583475553e-01   +3.002881852575396e-01   -2.144266721673442e-01   -4.008268513615240e-01   -6.931751229016886e-01; +3.013954292044667e-02   +3.118566435805097e-02   -2.909311666969006e-01   -3.437153009544662e-01   -6.651120989822025e-01   -1.297663902146783e-01   +3.917540046189598e-01   -4.331297831106926e-02   -4.106303816999052e-01   +9.133689878548307e-01   -3.135993697201829e-01   +3.182361428177451e-02; -2.588915612267683e-01   +1.323753868404790e-01   +2.119629343446933e-01   -9.100979792549875e-01   +5.195501989400007e-02   +5.405191360300723e-01   -7.440621495151616e-01   -9.221109289181330e-02   -9.179951052453862e-02   -1.289182760003159e-01   -4.891498547786181e-01   +5.317717600292868e-01; +4.283818542155859e-01   -1.188933101047600e-01   -3.610642001803319e-01   -3.835530607521549e-02   +1.732201919670929e-01   +5.246238025889409e-01   -3.212402468872324e-01   +4.253860168947810e-01   -2.601500751453392e-01   -7.564578098674593e-01   -5.308371606006940e-01   -1.641673665821206e-01];
L3I_L2I_iGABA_netcon = [-1.886176188847677e-01   -4.166219257454937e-01   +6.083649520899182e-02   -1.730559494651720e-01   -9.716269444968489e-02   -1.532368430419322e-01   -8.720244868178985e-01   +3.476001875546240e-01   +1.795744427633649e-01   -6.470401903478786e-01   +7.456088372380215e-01   +2.044273962792627e-01; +3.436915042080332e-01   +1.226378674226070e-01   -3.556613872984628e-01   -1.332421798569631e-01   -1.871886264099642e-01   -1.235669336463590e-01   -2.715469931568816e-01   +8.585615042971300e-01   +7.293103236307321e-01   +7.029577370854825e-01   +2.475260531559086e-01   -4.296540533864852e-01; -3.403278562890127e-01   -3.080043253942329e-01   +6.451420993765765e-03   -3.514912670180201e-01   +2.446322229057153e-01   +1.673646110004663e-01   -2.216374048188062e-01   -9.300378053802238e-01   -7.312769724092938e-01   -3.838296940328955e-01   -6.414700052293089e-01   +8.699749131393885e-01; -1.231498588904688e-01   -3.572568966292576e-01   +6.279347892752573e-01   +1.225233615083884e-01   +8.527602963410069e-01   -1.719655658077323e-01   +5.665349549139748e-01   -7.818567778102858e-02   -3.674909265599121e-01   -2.473712918912135e-01   +4.553439008837429e-01   +4.455378972914789e-04; -1.110190954622899e-01   -4.308134221079842e-01   -6.801865111096262e-01   +5.330439168347181e-01   -7.634846166546906e-02   +6.843613993922332e-02   -4.128348497802629e-01   +2.975984408503827e-02   -1.173450832983177e-01   -8.743363103704219e-01   +1.967985317924062e-01   +5.748982303995557e-01; -3.858697795227803e-01   -1.669402224010926e-01   +2.613169038291719e-01   +5.517846660419773e-01   +8.464218303352501e-02   -4.011695590806098e-01   +3.193730253247528e-01   +2.001489249045583e-01   +1.913398563022681e-01   +1.027779884465399e-01   +9.435531238352782e-02   -3.484692862020971e-01; +4.868045679300403e-01   -1.069974752315348e-02   -1.212228507198622e-01   -2.816257578097074e-01   +7.220116880840010e-01   +4.309386780614262e-01   +5.012151481255647e-01   +7.751060183330515e-01   -1.946324131641605e-01   -6.120114059993610e-01   -3.517559497667333e-01   +3.211399498793940e-01; +6.681268661309536e-01   +1.000000000000000e+00   -5.753508415005203e-01   -3.968778113906449e-01   +2.688958269129031e-01   +2.918454481819253e-01   -2.411634016472266e-01   +2.629532928244256e-01   -2.209186749889427e-01   +2.142000846885241e-03   -1.730731253559884e-01   +1.307759615875189e-01];
L2E_L3E_iAMPA_netcon = [-5.731846237183389e-01   +6.772667128043320e-01   -1.091628939379557e-01   -6.681947053990553e-01   +6.313914144588549e-01   -1.861925626864539e-01   -2.927756337066622e-01   -5.937327843672422e-01; +2.429499989004093e-01   +2.742026226244390e-01   +7.190126249195868e-01   -4.581358837590579e-01   -5.318747022630690e-01   -2.687466240781159e-01   -5.036000647441853e-01   -6.267068360049763e-01; +4.669310139272473e-01   +3.604687956364010e-01   -3.933773882357181e-01   +3.848594682293861e-01   -4.383441510304258e-01   +3.208887137579348e-01   +8.208001892747091e-01   +6.498145140707858e-01; -5.216211915103472e-01   -2.953958772313716e-03   +5.686016475039616e-01   +4.066555429297602e-01   +1.468908573883380e-01   -5.387659447890684e-01   -4.740299118409324e-02   -3.157242365563436e-01; -1.888313330787530e-01   +5.774964083503243e-01   -2.930255569493165e-01   +3.091085939980295e-03   -2.191895370263476e-01   -5.753364353963528e-01   +1.811134905028191e-01   -3.855531606933201e-01; -7.119633156761002e-01   +2.415715959326168e-01   -5.888288140435270e-01   +4.469404868478820e-01   +1.698351931897468e-01   -1.989814578436380e-01   -2.125306536390221e-02   -3.842556356853510e-01; +2.471834114998314e-02   +5.239285697157072e-01   +6.502682263330875e-03   -1.931552809991432e-01   +3.628135198983059e-01   +4.081427140208337e-01   +4.297610222938418e-01   +6.673407904880567e-02; +1.908248826943782e-01   -4.395528194694874e-01   +8.945283932285379e-01   +5.137551890017671e-01   +4.028314266518507e-01   -3.734519843899687e-01   -7.212086345009119e-01   +1.153844078288531e-01; -9.318369670207959e-02   -2.406128263225546e-01   +6.894562238527073e-01   -8.080043463617516e-02   -6.230934609410598e-01   -1.789265745834475e-01   +3.380580959077662e-01   +1.000000000000000e+00; +3.639398948324176e-01   +3.451103843289542e-01   -5.939744986390071e-02   -5.704474600726680e-02   -6.651599036515246e-01   +2.603383279116305e-01   -5.766423895129017e-01   +8.596687358914520e-01; +4.479179805054781e-04   +1.672186257365733e-01   -5.653125430935056e-01   +9.494630401873701e-03   +5.403961181724011e-01   -4.771453000130992e-01   +3.217501452396334e-01   -4.960000538661746e-01; -2.143987043073834e-01   +4.923090115248724e-01   +3.933105873907179e-01   -7.107349768124946e-01   -1.723077732869883e-01   -4.178035922074843e-01   -9.654964931527372e-01   -1.934257167002845e-01];
L2I_L3I_iGABA_netcon = [+1.696681262766215e-01   -4.760364516618971e-01   -1.895230148500426e-01   -2.521954636893497e-01   +3.204140922933727e-01   +1.865667702603627e-01   +2.230063378648106e-01   +2.607076832272258e-01; +6.295196772632464e-01   +8.073801902087028e-01   -8.656701731948733e-01   -2.226693292526824e-01   -6.916123386983434e-01   -3.857945706018345e-01   +7.238905365401978e-02   -3.574190908723127e-01; +1.892666260701167e-01   -4.188525438253556e-01   +2.461471732241602e-01   +3.604259661245440e-01   -7.094760593488152e-01   +5.829271692817369e-01   +3.309882748818359e-01   -2.133345067582312e-01; +6.085398029246049e-01   -6.486561959758952e-02   -7.148053925415899e-01   +2.570474219219692e-01   -1.098894963313216e-01   +1.676889986688056e-01   -1.221439806951017e-01   -5.600530531789417e-01; +2.433556905055462e-01   +3.876098942403478e-01   +3.475146376125199e-01   +1.431070875072011e-01   -3.304925256436160e-01   +1.000000000000000e+00   -3.697143559525294e-01   +5.826711496404490e-01; -6.485867956103654e-02   -6.243568088715297e-01   -2.099712247154892e-01   -3.783619837465421e-01   -7.062666248686901e-01   -4.720342826810813e-01   -6.040484011891241e-01   -3.434341488121543e-02; +4.831621049273042e-01   +3.183943471349316e-01   -1.766124976914427e-01   -8.212328553628240e-01   +5.709559051787042e-01   +4.216012935901065e-01   -5.843302465220573e-01   +2.301105269265147e-01; -2.723216775062485e-03   +5.148150134079863e-01   -2.139250946155985e-01   +4.874018557913756e-01   +3.358072797356448e-02   +5.453829032790918e-01   -7.933650483495227e-01   +2.201419678633630e-01; +1.072523424471584e-02   +7.113398634349760e-02   +4.038547981716462e-02   -2.924805631610796e-01   +9.911343161245892e-02   -6.042763012001812e-02   -4.184732753780347e-01   -7.787921736774735e-02; -5.520197267403876e-01   -3.785006960433774e-01   +4.581032395448817e-01   +1.927260317585262e-01   -8.025986386095885e-01   -3.998378920492834e-01   +2.621678615668002e-01   +8.600156126421354e-02; +2.265736621519041e-01   -7.041644436456231e-01   +1.418031249145414e-01   +8.456955399253725e-02   -3.181659756869821e-02   +7.215616249418756e-03   +3.362107177867371e-01   +4.528101199967685e-01; -2.435005306497725e-01   +3.351172253128846e-01   +3.577328353774253e-01   -8.211955935477996e-02   -7.784242994931456e-02   +1.951776193369766e-01   +1.569733096367500e-01   +5.886159975955367e-01];
L3I_L3E_iAMPA_netcon = [+1.207235279596283e-01   +6.366812563820603e-01   +3.820476588639951e-01   +4.672664690997412e-01   -5.747521618313962e-01   +1.794556244145469e-01   +4.007747013691486e-01   +2.979044312650957e-01   -7.028376410578252e-02   +3.402620360253859e-01   +1.078611350001213e-02   +2.772152373915326e-01; +3.815350552280307e-01   +5.197118578857933e-01   -9.594303325852123e-02   +7.053081454977994e-01   +7.094588139796645e-01   -1.049691132121170e-01   -3.979173796934707e-01   -3.728363394023149e-01   -9.416617779702934e-01   -9.437793500876607e-02   -3.705086215551546e-01   +4.424514013716121e-02; +5.381445147045131e-01   -3.597396393363492e-01   +7.266356867824428e-01   +5.829863540871167e-01   -3.358435678988259e-01   +2.452827486939871e-01   -4.804295048713085e-01   +2.942810512698417e-01   -2.075132737080870e-01   +4.980487408758761e-01   +9.285065521594453e-02   -7.156477999295213e-02; +4.445667839986470e-02   -7.292653447621174e-01   +3.225584400311392e-02   +1.710851940456886e-01   -6.227920556490030e-01   -4.998110162880791e-01   -2.901618573464145e-01   -1.159666624424863e-01   -5.527533650484101e-02   -4.615272338696889e-01   +6.280248146018939e-02   -5.542115706803462e-01; +2.729103096729121e-01   +5.483231678183528e-01   +6.772479725993924e-01   +4.762572353473487e-01   +2.526746548842849e-01   +3.878795584714998e-01   +5.361200156942474e-01   +1.611823037812734e-01   -1.000000000000000e+00   +3.210895300439753e-01   +4.862269691343373e-01   -3.954623028379489e-01; -8.638589742009814e-02   -3.593501320202185e-01   -3.612770220522592e-01   -8.380519368226143e-01   -2.877160430744702e-01   +2.091306884749269e-01   -3.192435459254959e-01   -3.455519452378547e-02   -6.170621126798538e-01   +1.290592783667996e-01   +1.687749666096179e-01   +1.410409931557325e-01; +2.950459287896394e-01   -6.197705398176266e-01   +2.610460464909601e-01   -1.422445719105123e-02   -5.388371371814430e-01   +3.091356814467294e-02   +2.840016279598968e-03   -3.085236703404901e-01   +8.097856856913687e-01   -6.463467885943913e-02   +5.641180643110594e-01   -6.234205367326181e-01; +1.238627569790432e-01   +7.656056898614748e-01   -5.119804917076975e-02   +2.022483304657118e-02   +1.495277920888484e-01   +1.487884384918200e-01   +2.205129165699369e-01   +6.792481209355506e-01   +4.105106764321514e-02   -4.961869813991241e-01   -2.162085739967012e-01   +4.084294800881879e-01; +6.022582320375709e-01   +4.116896252591595e-01   -4.786753722608399e-02   +3.786346695338026e-01   -1.706057719734193e-01   -4.565029224004664e-02   -2.042392321408988e-01   -2.107299743216730e-01   -4.337764076035797e-01   -1.625800259136420e-01   -5.535422031316475e-01   +1.006919018202986e-01; -8.925992026755894e-02   -1.465648441200630e-01   -1.991052294388593e-01   -2.058578624517523e-01   -1.433116387685062e-01   +2.766796562820169e-02   +7.259333823671209e-02   -3.201884360458961e-01   +4.079955138762447e-01   -2.487861857826157e-01   -8.549155003983731e-02   -4.076537237504952e-01; +2.838687587365922e-01   +3.512228683811242e-01   -2.610241783674186e-01   +3.724312424401368e-01   +3.526619283475054e-01   +5.335288716696420e-01   +8.249593267047263e-01   -6.170117884124348e-01   +3.260918586943511e-02   -3.978489252478123e-01   -3.253927149279793e-01   -1.469377538287645e-01; +5.058593042653818e-01   +4.320354909730678e-01   -1.957668369623135e-01   -2.597225664565196e-01   +4.888832972779248e-01   +4.821643117317747e-01   +4.956381682637379e-01   -3.171330365456161e-01   +3.765488449280805e-01   -5.158725254295216e-01   -4.000099471542228e-01   -1.159340138575164e-01];
L3E_L3I_iGABA_netcon = [-6.105914407104749e-01   -1.144257557371683e-01   -1.625750464240222e-02   +6.392064822260748e-02   -1.183366457154895e-01   +4.903582345372109e-01   -1.483920217490222e-01   -3.691562103378914e-01   +6.060195274291850e-01   -2.537876841079171e-02   +6.043631131721016e-01   -3.074373441159691e-01; +4.610473681301089e-01   +4.686279236043089e-01   -8.717450302851799e-02   +4.471050657103832e-02   +6.626098798863521e-02   +6.402573203839160e-02   -8.189938302707884e-01   +4.841813311438859e-02   -3.181889134991578e-01   +2.112170078053439e-01   +5.118550773975673e-01   -1.048114932645408e-01; -4.939570390501220e-01   +7.712480882036667e-01   +4.953574560541917e-01   -1.279008783710161e-01   +1.287380983315714e-01   +3.472090397270720e-01   -2.036288995294601e-01   -1.632859607125367e-02   -3.395651911471281e-01   -6.648315870054523e-01   +2.799578541777245e-01   -6.334926091874223e-01; -1.360502266114389e-01   -5.412600358410394e-01   +1.790562292750321e-01   -5.225201866174117e-01   +4.255892736209488e-01   +5.187159142680053e-01   -3.156965073429083e-01   +9.466876282035698e-01   +5.799806087684087e-01   -4.151851482918147e-01   +1.608119505515456e-01   -9.519314936228389e-02; +5.306802683025537e-01   -6.060101051903717e-01   +2.067962729273924e-01   +4.034918073739193e-02   -3.750767707497473e-02   +4.422685401778260e-01   -7.338607211734097e-02   -2.056131973073904e-01   -5.635475614929260e-02   +4.676202725382276e-01   +4.412305031642166e-01   -4.912000809822981e-01; +1.628164049196201e-01   +6.491169918897580e-01   -4.049324155489514e-01   +3.540928098614290e-01   -4.770315990128545e-01   +2.759482620251695e-01   +6.281979748551446e-02   -6.874116765097537e-01   +7.039549550423960e-01   -1.192448822628295e-01   -4.815313378196720e-01   +2.126386648187761e-01; -5.982712324530183e-01   +1.056103011921006e-01   -5.740752812129282e-01   -2.824520802519317e-01   -1.000000000000000e+00   +4.506045298651299e-01   +2.163407746765010e-01   +5.661324320950143e-01   -5.570155509363514e-01   +3.322364958580009e-01   +5.649981099868557e-02   -6.667477056812844e-02; -7.361693255007505e-01   -3.485227566663789e-02   +2.266068376345236e-02   +4.935497275537270e-01   +1.122227097452847e-01   -1.947205520674916e-01   -2.198582983870633e-02   +2.898253376556261e-01   +3.494068710552517e-01   +6.709102079289605e-01   +2.206158907873884e-01   -3.864372655478125e-01; +7.790233457166148e-01   -3.595756078823268e-03   +5.449353673394908e-01   +2.268377477138502e-01   +1.644428325505654e-01   +4.190297940907768e-01   -2.881690831354874e-01   +2.908178930930518e-01   +1.405496462939000e-01   +7.443815557771767e-01   -4.698819143913862e-01   -6.962642749408275e-01; -5.576573581171969e-01   +2.039578585031631e-02   -5.046119008373268e-01   +4.257699393293653e-01   -3.656171456087697e-01   -2.997885423840744e-01   -8.455768110000342e-02   +5.720521954444621e-01   +6.289656009368297e-01   -1.173849651177945e-02   -5.056035865391165e-01   +2.136668284695677e-01; -2.672122880130086e-01   +2.854834697236736e-01   -2.660974325184906e-01   -3.427657452341643e-01   -7.072027024863518e-01   +7.326513295558132e-01   -1.142317356799146e-02   +8.567853846385930e-01   +4.005244933424918e-01   -2.623783157862656e-01   +5.384839462461295e-01   +7.176581190725913e-02; -2.343065254825929e-01   +5.159747951031000e-01   -7.191807984153837e-01   -1.479977367790747e-01   -4.532737250062180e-01   +6.354913010393040e-01   -7.316316484823232e-02   +3.102887112318298e-01   -3.182197039532931e-01   -2.069024577949379e-01   +1.319372766008788e-01   -1.491082765578889e-01];
L2E_Input1_iAMPA_netcon = [-8.333441005420207e-01   +7.011844435170306e-01   +1.925580480765073e-01   +1.000000000000000e+00   -4.859840799808303e-01   +6.183428234763273e-01   +2.945588180123884e-01   -2.511452977720636e-01];
L2I_Input2_iAMPA_netcon = [+2.502726381451623e-01   +1.000000000000000e+00   -7.200278891368675e-01   +4.824445082506948e-01   -2.107137001071885e-01   -2.222648172969648e-01   -4.836657902117240e-01   +1.067654459362071e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
