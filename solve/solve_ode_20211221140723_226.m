function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.140538251641525e-01   -2.934034925893273e-01   +5.116216915383598e-02   -5.710212254478095e-02   +2.253535862112174e-01   +7.774335530774225e-02   -2.059926739533943e-01   -1.814962322569711e-01   -1.448090182408074e-01   -4.304760275595320e-02   +1.308540625168255e-01   +4.989069254822693e-02   +4.800513263822520e-01   -1.229851570166058e-01   -2.718728750844724e-01   +4.306729536878935e-01; +1.416776281543992e-02   +5.534134640038971e-01   -7.471890543216081e-02   +1.236823345019742e-01   -8.200050894572011e-02   -6.848138994999842e-01   -1.096577939473483e-01   -3.687350500897670e-01   +5.564321733595452e-01   -3.595046556256482e-01   +7.059065416284152e-01   -7.113687855499068e-02   +5.865653971800354e-01   +5.189064555292493e-01   -3.050280387510340e-01   -5.258800299827113e-01; +3.859766617549011e-01   -4.530049466423013e-01   +6.886511844230987e-02   +1.456320568379407e-01   +8.026742431669925e-04   -3.209460131045580e-01   +5.884519345459757e-01   -9.817946465442973e-02   +2.742815544759826e-01   +2.998194351140840e-01   +7.700258417405331e-02   +3.349999910052645e-01   +3.065087834549807e-01   +1.000000000000000e+00   -2.160756989973319e-01   -4.383776168380165e-01; +9.618365101259618e-01   -9.864065545363823e-02   +7.256317914617608e-01   -1.765305779993704e-01   +1.944118590322305e-01   +3.952245894604387e-01   +6.243042616501204e-01   +5.947276391225830e-01   +4.458772240519415e-01   -2.597014948731461e-01   +1.807155632584237e-01   -1.488079473988932e-01   +5.853343317132145e-01   -1.382134964149852e-01   +3.195576176643175e-01   -5.177002643600925e-01; +5.957374537750086e-02   +2.184078810530351e-01   +1.400621346262710e-01   +6.568689964220839e-02   -6.901555498248657e-01   +3.010948025344497e-01   -1.775681942018175e-01   -4.181612066474398e-01   +2.838993741621075e-01   +5.809095757294545e-02   -4.879135719508716e-01   +5.233302407002904e-01   +4.945092104558532e-01   +2.439116455411040e-01   -2.212116552948045e-01   -6.640349171223892e-01; +1.310991803906398e-01   +7.707075967768457e-01   -4.148020335004291e-01   -2.639908032089194e-01   -6.952606146962503e-01   -7.209745006625978e-01   +3.888329270439242e-01   -4.350523116981461e-01   -1.525854438440992e-01   +2.287136868018185e-01   +4.341829338301475e-02   +1.863364734988996e-01   -5.374340195558208e-01   -2.749522978559022e-01   +5.011196424678110e-01   +1.609271359163099e-01; +3.388465215588506e-01   -1.478048287726970e-01   +1.662409579915200e-01   +1.553807293222628e-01   +7.845949848869889e-02   -3.489958777929728e-01   +5.329146734454631e-01   +2.266174595072444e-01   +5.444111539211707e-01   +5.047958092106190e-01   -2.938098362494492e-01   +5.045408273182465e-01   -2.780030222315404e-02   -8.100299385355800e-02   -6.151315730156557e-01   +4.435824686331775e-01; +3.785166815409827e-01   +2.999628371495810e-01   -1.193404680808668e-01   -1.932220070358811e-01   -2.440514036987790e-01   -7.091924523784382e-01   -7.935684965125002e-02   +5.302865041266465e-01   -2.965752186995033e-01   -6.741274505489826e-02   +2.114653729066515e-01   +3.162196434158154e-01   +6.068249449480224e-01   +3.093344698365141e-01   -3.528320940204336e-01   -3.284934249105038e-01; -4.414213836601477e-01   +1.241996308499903e-02   +1.440609958745416e-01   +9.700040851389714e-02   +2.673850659696853e-01   -9.863417862876615e-02   +6.016818200426154e-01   +2.941117616863175e-01   +3.466421034583952e-02   -8.204360995777511e-02   -1.867909764753063e-01   +3.340514048096473e-01   -2.865688013702434e-03   +1.370037421913805e-01   +3.803990154594715e-01   -4.552278458517022e-02; -1.529048580721890e-01   -2.326375991974842e-02   -3.220299754467717e-01   -2.323442346733748e-01   +9.296412743327284e-02   -4.906530671279145e-01   +6.388791911678254e-01   +6.489379003033744e-01   -2.618440940532371e-02   +2.033561053353768e-01   +5.830442732941249e-01   +2.633997536006099e-01   +6.027150075907152e-01   +4.312334234965287e-01   +1.696376746087918e-01   +7.967420781686479e-01; -9.287603166116715e-02   +3.877555769963234e-01   +6.280401500866090e-02   +2.157671206508791e-01   -2.430256746585984e-01   +2.634963781421958e-01   -1.373441018928315e-02   -5.437184653267316e-01   -3.652058035523886e-01   +8.418568618245529e-01   +3.197560281327111e-02   +3.314025973452389e-01   +1.460613049560181e-01   +1.494544027988726e-01   +4.810161597897560e-02   -4.983821824226560e-01; +2.608945016124954e-01   +7.626196746039242e-01   +8.692261327485926e-02   -5.827967116790782e-02   +9.402045516828171e-02   +2.036544787623331e-01   +2.669390768317854e-01   -7.636853886817262e-01   -3.241131427232667e-01   +5.453720632891133e-02   -2.494490179638977e-02   -3.229532702692914e-01   -4.019520693570152e-01   +3.453574174470195e-01   +8.430290934217989e-02   -4.788176685896910e-02; -9.258357531660771e-02   -3.714811215394263e-01   +2.168004795252923e-01   +2.870064133446531e-01   -4.320108561287460e-01   +2.194052731930106e-01   -1.105861264979662e-01   -4.216481226793739e-01   -4.161179588605631e-01   +3.842052377315713e-01   +3.385565885346551e-02   +5.555624090236970e-01   +6.445329934474991e-02   +8.285611273728637e-02   +1.758391835933139e-01   -4.805495777440422e-01; -4.293860283487935e-01   +3.204527736374937e-01   -5.289194042267354e-01   -6.546184846710209e-01   +2.221681103281030e-01   -6.125058233709429e-02   +3.235667730835530e-01   +5.793861890560496e-02   +2.963308468335477e-01   -1.876921470385903e-01   -4.711153115296146e-01   +2.247977147092679e-02   -3.610640807450648e-01   +7.628454837012411e-01   +4.663868043886097e-02   +6.914511602483850e-01; +1.817211454896964e-01   +2.976182719285780e-01   +4.280687735697771e-01   +3.944910473929703e-01   -2.476896121445760e-01   -8.699735955320614e-02   +3.541258663277850e-01   +2.218552562457691e-01   +1.981771544280080e-01   +4.399274443041483e-01   -5.907760619160516e-02   +1.698203035031123e-01   -2.314820839821834e-01   -5.852158337053107e-02   +1.978240263868974e-01   -1.461578185677427e-01; +1.228285402538964e-01   -1.228334863399708e-01   -5.449757438894691e-02   +1.182611763074142e-02   +8.518640988952850e-02   +5.957472572121500e-02   -2.325750749397857e-01   -4.934538150868333e-01   -1.704196702741197e-01   -6.951461602954636e-01   -3.585294260363600e-01   -4.529008218368692e-01   -1.736076732941833e-01   -3.559251354380885e-01   -4.437849034808218e-01   +2.633818634330239e-01];
L1E_L1I_iGABA_netcon = [-6.237061345800271e-01   +3.220133159613110e-02   +7.682804972465988e-02   -7.527200674041387e-02   +2.109764264801723e-01   -6.705811038442930e-01   +7.639803262625888e-02   +2.969786181501283e-01   +9.995814357692426e-02   +9.003628994843854e-02   -2.860843697823567e-01   -6.251710484874161e-02   -4.948225831005639e-02   +1.382763418900205e-01   +9.135823840321222e-02   -3.268436980502900e-01; +8.209535792692130e-01   +2.919840383496174e-01   +3.871261889077801e-01   +4.370750823112345e-01   +3.472003945775177e-01   -6.615250690126945e-01   -1.412652869011928e-02   +6.005040347111564e-02   -5.286857997142127e-01   -1.441177889997458e-01   -2.016731710104530e-01   +1.298071518193550e-01   +6.110157826977335e-01   -4.478180068553531e-01   +4.218700500035790e-01   +2.795590071131000e-01; +7.370093211315466e-01   +2.091927280144838e-01   +6.318167792276054e-01   -1.941945654748020e-01   -4.368759863616753e-01   +2.316593483295433e-01   -4.064631370050345e-01   -5.106818282667136e-01   -3.035266658052239e-01   +3.715731447901235e-01   -3.129551304005063e-01   -4.978402996662038e-01   +6.963888891496468e-01   +6.800060753991042e-01   -8.750695048070295e-01   +2.578771260864400e-01; +2.057792127789067e-01   -2.010475840031215e-01   -4.070977547468775e-01   +4.667753065006291e-02   -1.237216498128993e-01   +2.170809009837632e-01   -6.110382117371334e-01   -3.593962128780108e-01   -1.491829756733243e-01   -4.732436165707825e-01   +8.054406984215795e-02   -2.986633166832886e-01   +4.966468939080876e-01   -1.024641298668121e-01   +4.618135847893985e-01   -2.108041295777388e-01; -2.622922187971658e-01   -2.462370499961677e-01   +3.892740786661137e-01   +3.510683986422842e-01   +2.062132663187008e-01   +4.659647674386991e-01   -2.268261487801793e-01   -1.166601235751479e-01   +4.567927944423226e-03   +1.683463897106387e-01   +1.884346997708111e-01   -2.660602931458288e-02   +4.223378605157433e-01   +3.434355347747160e-01   +5.908778838774108e-01   -1.383111158820810e-01; +3.745047418575788e-01   -8.107975208666807e-01   -1.681106800763657e-01   -8.054301862305210e-02   -2.144654753301085e-01   +1.932014867646793e-01   -2.135782152887469e-02   +2.413179266884972e-01   -2.785956588773729e-01   +3.032401588592372e-01   +8.484558223660965e-02   +1.000000000000000e+00   +1.651367766966653e-01   -7.406584434943930e-02   +3.547308014995162e-01   +2.693614531775493e-01; +6.377154539582643e-02   +9.222423546395618e-02   +4.706913078410363e-01   +4.368504799042621e-01   -4.479084211579066e-01   +3.383062972518101e-01   -2.452170887774498e-01   -1.373152825470763e-01   +2.549635019279330e-01   -2.900424848123232e-01   +4.722110042018144e-01   +6.376041689158369e-01   -6.120193097277787e-01   +1.345587328365706e-01   -2.867691045682791e-01   +6.742547240941703e-01; +4.377949012810261e-01   -9.511267779891025e-02   +2.293439624032033e-01   +2.965694164945744e-01   -4.935289351271502e-01   +5.639178996603317e-02   +2.331398900568775e-02   +2.230883193905246e-02   -2.467050118459845e-02   -1.814136530871142e-01   -2.492360888135206e-01   +2.391370325504548e-01   +8.897012739412648e-03   +3.598934159171810e-01   +3.859588879357353e-01   +3.515946058211469e-01; -2.225968793926948e-01   +1.554501732299839e-02   -3.111446371504005e-01   +2.242547866798046e-01   +5.896051408189040e-02   -8.675654216520916e-01   -7.230774603106565e-01   -7.954415587781919e-01   +3.966243159945442e-02   +2.121162595513206e-01   -2.077516373060752e-01   -1.140308057865994e-01   +4.628396791940275e-01   -6.093432739038777e-02   -4.789997536236386e-01   +2.142566820732065e-02; -2.488642408605855e-01   -4.079055698640152e-01   +4.576281453954006e-01   +3.377083420444812e-01   +3.702357395360367e-01   +1.947288144184063e-01   -5.454195981265966e-01   +3.856198735675320e-01   +7.147890751140559e-01   +1.658246689498211e-01   +9.431242105744117e-02   -1.799735246938859e-01   +1.785640326182874e-02   -6.140492430735238e-01   +6.594897775132402e-01   +4.286329795079321e-01; +1.106929716819231e-01   -2.885758236021324e-01   -1.401160366843064e-01   -1.211041390376280e-01   +2.190950713393909e-02   -2.212752460627111e-01   +2.839351869244672e-01   -1.562498782285811e-01   -6.717119542520139e-02   +5.111824127832152e-01   -3.677445339786280e-02   +2.834425238448792e-01   +2.097077299368036e-01   +3.372356170190462e-02   +3.186478785883695e-01   -4.309490652587305e-01; +4.452231241483424e-02   -1.974428738214963e-01   -3.664882294306493e-01   +7.780077277199618e-02   +8.604277793059798e-01   +1.901768509271458e-01   +5.031919412389797e-01   +1.478978474490861e-01   +1.752999031882279e-01   +3.965525723403673e-01   +7.206743654740810e-01   +5.590062668355220e-02   -1.878794460187794e-01   -3.908581848602435e-01   -3.585923026287650e-02   -1.628154540738627e-01; +4.693771004037098e-01   +8.604254944704388e-02   -2.484177469792937e-01   -4.597375333041007e-01   -7.420854643860718e-02   -1.817195182919201e-02   +4.105804071866709e-01   +4.194937898473520e-01   -8.228183726567833e-04   +6.300790827595582e-01   -2.454453902786715e-01   -3.876639528349943e-01   +3.940519885453960e-01   -2.947044451708792e-01   -1.107512300004566e-01   -5.585557507604711e-01; -1.020432200026671e-01   +4.617664205272002e-01   -2.122603713011705e-01   +5.087701543473822e-02   +4.265586947931337e-02   -1.293082559056834e-01   -5.752130099060898e-01   -2.277863874695427e-01   -6.578217172994187e-01   +1.718743493149710e-01   -1.114564702906482e-01   -4.342046411193302e-01   +8.400154096818402e-02   -8.034499887632045e-02   -1.974166314705918e-01   +4.846463596863421e-01; +2.009060608447049e-01   -8.161123898508812e-02   +5.536628436874722e-01   -4.690261660286249e-01   -4.344105406466278e-01   +1.485363735149500e-01   +5.176100881340309e-02   +3.288733461722547e-01   -1.665715779279356e-03   +1.842853412140418e-02   -2.785558737926396e-01   -7.960015979406314e-02   +4.608080270443781e-02   +5.303548938480113e-03   +6.530315396955108e-01   +7.673908258856397e-01; +2.352442206595377e-01   +5.153970542047513e-01   -1.333432516079067e-01   -1.057363261766656e-01   -4.323842205124023e-01   -2.278308056765866e-03   -3.589536291039481e-01   +8.368232840135716e-03   -2.769007209552292e-01   -1.231732768482237e-01   -1.043336071071645e-01   +3.035892751381286e-02   -7.546716100255247e-01   -5.988472324383821e-01   +6.723073784395690e-01   -4.021654923718682e-02];
L2I_L1I_iGABA_netcon = [-9.313737943300342e-02   +6.584319920124833e-03   +6.828329327125754e-01   -7.922391545090093e-01   +2.105927445769488e-01   +2.814944326205928e-01   +1.968861704476867e-01   +9.512954600701237e-02; -4.304944787827503e-01   -2.129966868048638e-01   +3.283215007781161e-01   +4.438372817320565e-01   +3.183290503096209e-02   +2.487817118088532e-01   +5.199462222769088e-01   +2.324423418092612e-01; +2.019039852154345e-01   -6.255212156049436e-02   +2.116212773617402e-01   +2.297044028614482e-01   +5.955280532284587e-01   +1.340343719593536e-01   -7.242492514019853e-02   -4.421773613762895e-01; -2.559607123949413e-01   +7.279971451993916e-01   +1.774329496138675e-01   -2.428542188843604e-02   +2.242632495941161e-01   +1.223342934381563e-01   +5.787951801839409e-01   -1.000000000000000e+00; -2.339769977203524e-01   +9.285182012342863e-02   +4.210311642003902e-01   +3.539747890658714e-01   +2.570475924121018e-02   -2.652555530780351e-02   -6.745705209135454e-02   -6.941743135033503e-04; +5.634385400764432e-01   +1.013766196312693e-01   -6.728337103628602e-01   +8.205697974553725e-01   -3.826239731011045e-01   -2.270651206900808e-01   +2.301834759158477e-01   -7.066061047691816e-01; +2.297151859959918e-01   +3.493097022979749e-01   +1.218415673644298e-02   -4.397174250449682e-01   +1.431530245047149e-01   +8.543381273547224e-02   +4.278054412736274e-01   -4.989718774824870e-01; +2.866854680918925e-01   -3.733935799008425e-01   -1.972965873918444e-01   -1.981373425658252e-02   -8.692946363467820e-02   -8.690832506799397e-02   +5.419324895390484e-01   +1.686048161775162e-02; +5.405830167731810e-01   -7.141706156384936e-01   +3.604560913856206e-01   -1.516663397880558e-01   +3.924818780807299e-01   -3.709080863573858e-01   +1.351428071873733e-01   +6.007948850250355e-01; -7.227688901434304e-02   -1.571163950609104e-01   -5.630630929393398e-01   +1.308640518670016e-01   +2.311870258136714e-03   -4.899543629987000e-01   +1.957052341709537e-01   -5.880659273956387e-01; +6.206581512191787e-01   +5.638813505722481e-02   +1.739523063455198e-01   -1.710970089403988e-01   +4.048800853628470e-01   +1.538189380795789e-01   +4.724765091701943e-01   -2.857171283089168e-01; +3.292218501737105e-01   +3.191115913271624e-01   +2.980215674315115e-01   +3.642855925360522e-02   -5.979878908124640e-01   +1.338075626006764e-01   -7.831274804525591e-01   +2.598505404552170e-01; -4.780433312502118e-01   +7.417772947362686e-01   +5.221797268825534e-01   -5.299635994260095e-01   +2.857941504879353e-01   -3.373539305269582e-01   -4.217256038969940e-02   +3.667901103868360e-02; -7.315591906454528e-01   +5.195364594214521e-01   -3.073638939976505e-02   +5.212459888148507e-02   +9.824411206140755e-02   -3.671923630335777e-01   -3.157937789459633e-01   +5.047098579644809e-01; +2.416587785206157e-01   -5.108898804987898e-02   -3.843583452824859e-01   -1.880713800862457e-01   +3.817565543790199e-01   +3.119364601782543e-01   -2.557877661148133e-01   +6.148583432721705e-01; +9.873507458168708e-02   +8.987456076582732e-02   +3.452589653008433e-01   -2.128168216256513e-01   +1.594747888525130e-01   +5.222980113201636e-01   +5.097603976203560e-01   +2.592650142448460e-02];
L1I_L2I_iGABA_netcon = [+2.162960910704556e-01   -4.427446223853667e-01   +1.096489384879442e-01   +5.515163683715053e-01   +2.891307440837613e-01   -4.206585118405028e-01   +3.542094248133150e-02   +9.710672489152623e-01   +4.067230683733923e-01   +3.764576161375099e-01   -3.923778433780784e-01   -1.054514356562167e-01   +1.942595486280379e-01   -2.359407526770580e-01   +6.986529623902328e-01   +8.214316294465270e-01; +4.003746140274566e-01   -3.932268701987831e-01   +7.073564676303093e-01   +4.415001988500675e-02   +3.313095596590864e-01   +3.560523125439095e-01   +2.252919265481969e-01   +2.047926097583482e-01   -5.366373003219048e-01   +6.224576965431644e-01   -3.016856624112211e-01   +3.335482510250894e-02   +8.357033217827185e-02   +2.489701801960199e-01   -6.386439408773481e-02   +5.098532848654471e-01; -2.923048679428245e-01   +5.105061467244919e-01   -4.660082525492764e-01   -4.427844306847651e-01   +3.687547845440822e-01   +2.055361524789372e-02   -3.331978449268694e-01   -7.476167491186150e-02   +2.720790728038072e-01   -6.101830313294436e-01   +1.582807392317488e-01   +4.197386862240726e-01   -5.225928645084851e-01   +1.017035227875941e-01   +8.294888854702985e-02   +1.737786363793713e-01; -3.106764719320680e-01   -1.211593055824476e-01   -3.412690977716518e-01   +4.772044157082842e-02   -3.156387695830196e-02   +3.232340604090775e-01   +4.545180826886005e-01   -2.842952592463325e-01   +3.509931635347230e-02   +3.375494694837289e-01   +4.212840080580675e-01   +1.128872880801546e-01   -3.508405219058964e-01   +6.821836138448217e-01   +3.893102957067641e-01   +2.515753558652037e-01; +9.824547724820615e-02   +3.244395071894392e-01   +1.949577732148856e-01   -2.782228652020125e-01   -4.344300023789728e-01   +1.021178804859532e-02   -2.355013984854781e-02   -1.461056661691639e-01   -3.143053116734361e-01   -5.362794310374566e-01   +1.360794551826368e-01   +1.000000000000000e+00   -2.466927463776874e-01   +2.341834858887420e-01   -5.478366763191426e-01   -4.048583735783556e-01; +9.212595431485124e-02   +1.264278186362125e-01   +2.560166210518722e-01   -2.620189325458201e-02   -2.596769571848447e-01   +6.054458548027972e-01   -1.102093388811243e-01   -5.921423158780211e-01   +1.149170677367001e-02   +6.281812177876871e-01   +2.081991411042229e-01   +7.239376641090052e-01   +8.313037644935591e-02   +2.856274276851904e-01   -1.673416867153786e-01   +4.425082737733373e-01; +5.576884994526359e-02   +2.351894863439937e-01   +3.875638901472232e-01   +9.775286572942248e-02   -3.346429411453708e-01   +6.788991344641745e-01   -7.316642043588331e-02   +9.418992738055978e-02   +5.749896648264821e-01   +4.083851335691816e-02   +1.911374332223680e-01   -3.726638223795205e-02   +1.740064532023237e-01   +6.894568490564923e-02   +2.036653333751960e-01   -8.375779031363001e-02; +5.526470581700786e-01   +2.740257334186883e-01   -3.643281958534214e-01   -4.892467254321021e-01   -1.117603963618336e-01   +2.059312178284654e-01   +1.578417849442630e-01   +5.464956764696463e-03   -2.690351668419852e-01   -1.467617966410638e-02   -4.465853665015930e-01   +6.167015857241411e-03   -5.598049899027849e-01   -7.739267367007210e-01   +1.321630879409986e-01   +1.974920422975115e-02];
L2E_L1E_iAMPA_netcon = [+2.886216223923015e-01   +1.402820576406770e-01   -4.331273605989432e-01   -1.622982891183714e-01   -5.915184486231259e-01   +7.455482782206697e-01   +1.818617422836283e-01   +6.379853066030066e-01; -2.508106473495681e-01   +7.301594702889599e-01   -3.244921350683637e-01   +1.033512881809479e-01   -2.311219004528997e-01   +1.972385668321893e-01   +1.000000000000000e+00   +6.789058977250377e-01; +4.719653844752225e-01   +6.576294376100435e-03   +7.850326186768909e-01   +5.449374861883749e-01   +4.501235812755602e-01   +5.962948072362552e-01   +2.145590491967863e-01   +9.210968758563225e-02; -3.434790694979350e-01   +1.435302576561599e-01   -2.022725343304620e-01   +2.065897178848225e-01   -7.071041382533509e-02   +9.602847340456913e-02   -1.598715622651339e-01   -6.475870480556339e-01; -4.722627182856733e-01   +6.373574599764138e-01   +4.047134846942130e-01   -2.601384916497427e-02   +2.113189930139274e-01   +2.344068900885849e-02   +2.311758881849169e-01   -5.541273471181448e-01; -1.049221732576676e-01   +4.339478239068356e-03   -3.100746654549780e-01   -4.446722128675100e-01   +4.709370605436073e-01   +2.041943433538353e-01   +5.337938887768623e-01   -7.565601014909784e-01; -1.030728401247769e-01   -2.031576866821938e-01   -2.471415806788340e-01   +3.012236499117313e-01   +1.166732213444456e-02   -9.444922806534710e-02   -5.358228897668356e-01   -2.329540652787122e-01; +2.166069348016460e-01   +3.338969755587496e-01   -5.911372798107460e-02   +1.441452654120953e-01   -2.496845110747757e-01   -3.632849872403890e-01   +1.279031146439745e-01   +7.968878643803250e-02; -1.586661103618971e-01   -2.777498164938718e-01   -2.779033131001591e-01   +4.548158288878783e-02   +2.389874661274362e-02   -1.652947387926647e-01   -9.778816269973819e-01   +1.203425392938331e-01; -1.107697927475560e-01   -7.809380183094223e-01   -1.245733171187369e-01   +7.214609775876044e-01   +3.313975975077242e-01   +2.276839407734021e-01   +6.297875992786716e-01   -3.552093313958163e-01; -1.839368122521758e-01   -3.052770367709539e-01   +3.633939301896281e-01   +5.047007432804548e-01   -4.602792812862752e-01   +4.184928555368159e-01   -3.091107623998662e-01   -4.323494494892941e-01; +7.463594756619129e-01   -1.534773935785668e-01   -2.238961025572005e-01   -1.476377088467963e-01   +7.049703397797091e-01   -2.070315470348111e-01   -2.193738276378749e-01   +5.769153711245193e-01; +1.015318259052291e-01   +4.127342571975174e-01   +5.242277717165689e-01   +9.108722261868045e-02   -2.424315648892248e-01   -4.228473582373692e-01   -6.927485650803650e-01   -2.836424752572254e-01; -9.370637350787799e-02   +1.774955061004685e-02   +8.789685220045679e-01   +4.788924618971532e-01   -5.383467241146852e-01   +2.590101033585979e-01   +2.057470012691300e-01   -2.540758215625881e-01; +2.863603465820634e-01   +2.745166310557369e-01   -3.317189995464632e-01   -3.255401777391644e-01   +2.901077203302823e-01   -3.562827631414597e-01   +3.996379766095209e-02   -2.272174757323006e-01; -2.432992640681687e-01   -4.020285372762526e-02   -7.615042919617024e-02   +5.141027747597433e-02   -2.935035680293843e-01   -6.483058503581717e-01   +4.311119701499175e-02   -7.289561785040543e-01];
L1E_L2E_iAMPA_netcon = [+2.424600977212302e-01   +4.486953195845137e-01   +6.200465800401268e-01   +8.850082299552832e-02   +3.715401802426053e-01   +8.441816767065656e-01   +4.929443284595973e-02   +8.722664793891454e-01   +8.806473544273502e-02   -5.752561449669065e-01   -1.807007557160780e-01   -4.171090579832717e-01   -6.707459800559558e-01   +4.796293772626740e-02   +1.138750112220284e-01   -5.277110583908631e-01; -9.552752575617249e-02   +2.515981940254450e-01   -1.108367399682971e-01   +5.653206255161247e-02   -8.505421114608837e-01   +1.903176155105346e-01   -3.303218621544800e-01   +6.507338074461674e-01   +5.379059193695638e-01   +5.275645772794911e-01   -4.902516664624066e-01   -7.671011428462923e-02   +9.392582247947550e-01   +4.652174651209438e-01   -1.695441334020945e-01   +7.379455494324867e-02; -5.007867273808988e-01   -4.191523327672624e-01   +6.369085550248840e-01   -2.644276923282806e-01   -2.897484741617832e-01   +7.870607386832529e-01   -1.816567265891572e-01   -2.934590082019535e-01   -1.131674109724133e-01   +7.123101391073254e-02   -8.732438698759440e-01   +2.481070539109349e-01   +4.122346671160428e-01   +6.584980517666036e-02   +2.538508126465485e-01   +3.116545696618354e-01; -5.730301339545211e-01   +3.624776628122124e-01   +3.837265005287281e-02   +6.633159486045662e-01   +1.471066208530074e-01   +8.617306087044059e-02   -1.068793072289626e-01   +1.113385078372207e-01   -1.916332620901423e-01   +4.096395611678022e-01   +2.781860706277106e-02   -2.361210885470095e-01   -5.712336499303339e-01   +2.562036821049050e-01   -1.042614083483917e-01   -5.434383895999477e-01; -1.884691392122686e-01   +5.423388250243447e-02   +5.170142540814222e-01   +6.919041578374698e-01   +9.378608238896607e-01   +3.328731790059958e-01   +6.565098858013790e-01   +1.237521941532051e-01   -3.129794670995171e-01   -7.523446843946546e-01   -2.208209331402380e-01   +6.126752933507118e-01   +6.033963212864028e-02   +3.868506900077932e-01   -4.217935801403611e-01   -1.010075048272490e-01; +2.776731894502241e-01   +3.748341154814514e-02   +9.526848103411568e-02   +5.361876451495475e-01   -5.279401355215158e-01   +9.630610154552873e-01   -1.493941663231706e-01   -1.944676218575200e-01   +6.877780830644252e-01   +1.697149994292910e-01   +1.912713983735692e-01   +6.367337132630364e-01   +1.449074508046631e-01   +8.835922383665067e-02   +3.248722907950482e-02   +1.816462493690766e-01; +5.802515126380384e-01   -2.133746724331455e-01   -1.527862106719730e-01   +2.620538225027497e-01   -1.422556675552588e-01   -8.351518534108693e-01   +3.824658592462906e-01   -8.609800138232874e-01   -2.570043023738718e-01   +2.825126404075302e-01   +7.424364772902117e-01   -4.065560725759968e-01   -4.382804278440610e-01   +7.575879367674740e-01   +1.000000000000000e+00   +1.494598118535146e-01; -2.256065295327092e-01   +2.550564475902459e-01   +2.578119053816960e-01   +8.957331390088960e-02   +9.609730571413250e-02   -9.757428570120907e-03   -7.259391002799559e-02   +2.651002796262872e-01   +2.311282866064424e-01   +6.039521888198043e-01   +1.860156057035500e-01   +4.230249210217272e-01   -4.303899129411474e-01   -9.025233377051592e-02   -4.112879072643546e-01   -2.623741671811621e-01];
L2I_L2E_iAMPA_netcon = [-2.046368533853087e-01   -2.170803660991143e-01   +3.331596162465122e-01   +2.384468681187387e-01   -7.777433515132488e-01   -2.616369342722099e-01   +1.209902010539589e-02   +2.280186932311651e-01; -1.099502757072501e-01   +2.379751770167308e-02   +5.398009453173453e-01   -4.769479414905429e-01   +5.047337355424748e-02   +4.082159249366362e-01   -4.751547529946041e-02   +3.543690121541655e-01; +2.613681009751204e-01   -2.952145971030546e-01   +5.589392657089827e-01   +3.532647362181503e-01   -7.962001210504052e-01   -1.282507200864272e-01   -9.177652034837447e-02   -2.383317493005126e-02; -1.863844116406796e-01   -1.687038820163899e-01   -1.832145101595980e-02   -1.367456304576993e-01   +5.821151991416031e-02   +1.374869730456219e-01   +9.457152918489234e-02   -1.176400944321349e-01; +1.866389224717619e-01   +3.769836967259815e-01   -2.037881847297779e-01   +1.692531512501157e-01   +4.510134329083129e-01   +5.434035993177765e-01   +4.654769729882438e-01   +1.297895693059030e-02; +2.639150953125526e-01   -3.961468300435096e-01   -4.127807167038658e-01   +3.149064300698833e-02   +6.952809982401342e-01   -6.609453000470521e-01   -3.576387333015448e-01   -4.467556943689253e-01; +2.481105514623001e-01   -5.934404898578417e-01   -1.239260233036502e-01   -9.618481450608216e-02   +7.559689029643825e-01   +6.145023529717456e-02   -5.546321068638539e-01   -1.000000000000000e+00; -7.087496024466652e-01   +3.874802614257330e-01   -8.891605083456290e-01   +1.149620504537004e-02   +3.923716700720196e-01   +1.972872358198497e-01   +9.023640992428689e-01   -1.036725832245258e-03];
L2E_L2I_iGABA_netcon = [-3.525941134783897e-03   -1.270924082503337e-01   +8.813557651692061e-02   -1.647972805075457e-01   -2.930097687032318e-02   +3.170945022134135e-01   -5.119925746860637e-02   +3.406502389113783e-01; +3.085623617139537e-01   +8.237372422602082e-02   +6.953166893970144e-01   -3.167227366846417e-01   +5.578980603487620e-01   +2.340266190715103e-01   +2.231288638651104e-01   +4.517522743900727e-01; +2.709999513609343e-01   +2.894821768488360e-01   +6.433771753061959e-01   -1.409282238360423e-01   +1.354691094165274e-01   +1.000000000000000e+00   +6.730333056392479e-01   +2.601249865376507e-02; +3.218647917561290e-01   -1.162544735156866e-01   +7.760867441181609e-01   +1.736521974378921e-01   +3.397059640678448e-01   +2.805663066285389e-02   +4.470029241478219e-01   +2.351264864405976e-01; +6.008526871522726e-01   +2.420912740298398e-01   +4.593388295138815e-01   +5.332290962824090e-01   -2.668955292273040e-01   -1.973476323538187e-02   -8.443390354960083e-02   +8.055586592229549e-02; +7.220851328637871e-02   -4.109814297007951e-01   +3.138212268184060e-01   -4.394074305613663e-01   -1.412556759283549e-01   +2.332672557062865e-01   -4.941026831142761e-01   +5.682527585592677e-01; -4.302930443876699e-01   +5.620706675437325e-01   -2.251763772824697e-01   +3.440973472264338e-01   -9.462776293795513e-02   +1.405554624080862e-01   +4.939483901233741e-01   -2.516522853413420e-01; -4.862975030018176e-01   +2.199989779265087e-01   +3.945175246352702e-01   +2.288176246993724e-01   -1.673392688892781e-02   +1.518367874365676e-01   -1.933568194531972e-01   -5.723318024158603e-01];
L3E_L2E_iAMPA_netcon = [+6.380169341361288e-01   +5.231046392644927e-02   -3.462344352572365e-02   -8.009226278705587e-01   -1.713777460181604e-02   +4.426750208485777e-01   -3.132782686943451e-01   -5.636936172555181e-01   -1.168161637217211e-01   +5.977477867579161e-01   -1.760312071271720e-01   +5.866958121115494e-01; +3.884832465720813e-01   +5.379016780379515e-01   +3.430712548210491e-01   -4.868808429647932e-01   -6.040632235652657e-02   -1.261307416793979e-01   -6.396780701609999e-01   +6.353500699892441e-01   +6.237867813880533e-01   +4.048153058323906e-01   +1.667629639289751e-01   -3.398204817113082e-02; -1.883105093114820e-01   -3.831349198126061e-01   +3.348356816799792e-01   -4.248512392968637e-01   +7.468562528531849e-01   +1.108823781134209e-01   -2.713630259494078e-01   +1.769873600651181e-01   +2.090248829618097e-02   +6.171666688399505e-01   -5.410149090826190e-01   +4.720408985390957e-01; +3.015938130420791e-01   -2.638006627355928e-01   -3.329603923590271e-01   +4.896127560512699e-01   +3.481553285416151e-01   +7.459891905965813e-01   +3.843458299017973e-01   -1.129230932315654e-01   -1.832831316864253e-01   -7.081663029861414e-01   +1.358419188443736e-01   +8.986217566718780e-01; -2.325220929823066e-01   +2.342686601503821e-01   -7.532570753903376e-01   +2.456422589220960e-01   -1.787466267557282e-01   +2.227775873545194e-01   +5.144777433591050e-01   -5.643843570148654e-01   +1.245779050483186e-01   -3.321118244854980e-02   +7.459356492957349e-02   -9.402115848090377e-02; -1.994191588589217e-01   -6.373929133689722e-01   -1.285655184789204e-01   -2.819197471821254e-01   +5.212133801690085e-01   +7.877167363399550e-01   -1.782681643867414e-01   +5.001444055017874e-01   -7.456949261195773e-01   +3.892515873151060e-01   -1.031109276193921e-01   -8.284544250193546e-01; +1.000000000000000e+00   +1.060418551103933e-01   -4.521407689340287e-02   -2.154586395549482e-01   -3.980022755703099e-01   -3.577715913799256e-01   -1.393381941336702e-01   +3.285716711509564e-02   +8.449830117082182e-01   +2.949572314491258e-01   +2.005943046859087e-01   +2.193866282467846e-01; -4.742244767910728e-01   +3.270667892875138e-01   +4.138649678714502e-01   +6.374606068868733e-01   +2.910775195440806e-01   +4.408693299236694e-02   +3.079931885933355e-02   -3.420158654041407e-01   -3.586664450310208e-01   -4.084393983234140e-01   -3.553561622390181e-01   -2.758784860629940e-01];
L3I_L2I_iGABA_netcon = [+5.996588572425332e-01   -3.770742285157865e-01   +3.141979734008550e-01   -4.238826783609788e-01   -1.274859824887807e-01   -2.912233886767068e-01   -8.459137285929432e-01   +4.047725564528488e-02   +4.474941967653273e-01   -2.688696113099687e-01   +5.258895552716100e-01   -6.415583893579211e-01; -1.280638859098140e-01   +6.280974753573259e-01   +3.029974272411490e-02   +1.698746639253703e-01   -2.531640048296711e-01   +1.337929856359217e-01   -4.403583448773180e-01   +1.000000000000000e+00   +1.315861923009807e-01   +5.381899061970889e-02   +1.694895683957860e-01   +3.237346663771396e-02; +1.768578959561645e-02   +1.406270213057625e-01   +1.333681012909484e-01   +4.620980318122413e-01   -3.927064832300957e-01   -2.012451312565575e-01   +1.637117154402710e-01   +3.204114701737172e-02   +1.574013244103048e-01   +6.635636918758535e-01   +4.038548569864647e-01   +6.755714612792368e-01; +1.433354428903259e-01   -3.460079395483078e-01   +1.756108504861753e-01   +5.449788592570336e-01   +1.836609852197305e-01   +6.624140410186256e-01   -1.861942292124128e-01   -4.888663204293208e-01   +8.789916933314660e-03   -3.743732029210295e-01   +5.779514449964730e-03   -5.836279741100573e-01; -1.851277487600832e-03   -7.299744404517415e-01   -4.615562850084228e-01   +1.377329332500617e-01   -2.601460525411998e-04   +1.097896325185998e-01   +1.225267892469313e-01   -6.565238350561201e-02   -3.095612711976332e-01   +1.758424700517993e-01   -2.954566986905464e-02   -9.687171430715935e-02; -4.133066522743566e-02   +4.417563173048618e-01   -1.137009500148457e-01   +6.381309584807950e-01   +1.722840556104047e-02   +9.668381561624186e-02   -8.832275595273907e-02   +7.394381389393576e-01   +3.845491063634082e-03   +8.873398171088774e-02   -6.143661175068151e-01   -1.391152602898119e-02; +3.425474266316512e-02   -3.678288853778749e-01   -2.016855750345877e-02   -1.032792387729537e-01   +2.054872168596887e-01   +2.739106234984257e-01   -6.421777138220502e-01   -4.300730794277149e-02   +1.045367537752687e-01   +6.594209773535407e-01   -7.693346841907127e-02   +3.556157517408814e-01; +4.790200237969718e-02   -2.676566742429795e-01   +4.520634831583645e-01   -9.915884177608629e-02   +1.708440453454081e-01   -4.075059768922364e-01   -1.070098039430370e-01   +6.753321991741253e-01   -7.051204681534423e-02   -3.773425027210220e-02   -1.458814544504553e-01   +4.984144423739092e-01];
L2E_L3E_iAMPA_netcon = [+2.402591354721295e-01   +3.742348764123516e-01   -4.678301271864191e-01   +3.169149511751674e-02   +6.358649886030753e-01   +1.339237978819584e-01   -3.181121717980369e-03   -2.900508964078697e-01; +7.387588892743015e-03   -4.310481966091363e-01   -5.254027827765092e-02   +4.439379234897738e-01   +2.828557028434716e-01   +1.735981088952527e-01   -4.811839445856452e-01   +1.254440961911824e-01; -6.372816965146820e-01   -8.364717693851137e-01   +8.046461943350183e-02   +5.912123277865771e-02   +3.241275526986924e-01   +1.000000000000000e+00   +1.312436941298980e-01   +9.971546110386442e-01; -5.052412547976409e-01   -2.156980495056865e-01   +7.682261480898404e-01   +1.220211538726006e-01   -3.441224339735590e-01   +6.840051391777383e-01   -7.322615914667507e-02   -5.756993254578054e-01; +4.952264857621539e-01   -2.218020222136845e-01   +1.309702404010541e-01   -1.988670606324014e-02   -9.887138579134201e-02   +6.086071699091109e-01   +9.466670166675667e-01   -4.647541622414184e-01; +5.110343368188688e-01   -6.732355939793562e-01   +9.366933397480577e-01   -4.901893723845039e-02   +3.244294863949541e-01   -3.265545043128256e-01   -4.442299015744153e-01   +3.556315528089866e-02; +2.510571628359649e-01   -9.036626174014408e-01   +4.649842787257952e-01   -6.666721275343972e-03   +7.306640454817141e-02   -1.784546031583709e-01   -1.988552167732544e-01   +4.585692771144781e-01; -8.210022677844965e-03   +5.897268392238431e-01   -3.734499076755579e-01   +1.347174133984385e-01   -2.511529852151342e-02   -5.339130759980344e-01   -1.704195625933865e-01   -5.371703912998214e-01; +7.535198362106618e-01   -6.209752023945559e-04   +4.600033594735266e-01   +1.990284569917513e-01   +1.248136896376316e-01   -9.993862221597991e-02   -3.796829608727439e-01   +6.224462151614850e-01; -1.509976294344864e-01   -4.826498773181100e-01   -7.153270508142888e-02   +4.108708707086159e-02   +2.009010495600799e-01   +3.808305590412940e-01   +2.837525460287182e-01   -4.330438435423231e-01; -4.376524949518544e-01   +8.463045692713849e-01   -2.305254870332610e-01   +3.258859442454491e-01   -5.145682165824331e-01   -4.533379299448934e-02   -6.310944759015515e-01   +4.102432577037189e-01; -7.899858719631406e-01   -4.346267036989997e-01   +4.345682001528012e-01   -8.145900915644734e-02   +7.581762633097437e-02   -2.682016433476556e-02   -2.656044468270235e-01   -5.920846320058013e-01];
L2I_L3I_iGABA_netcon = [+1.740700267324187e-01   +6.989124001206319e-01   -4.492021950716257e-01   -1.097850279792510e-01   +9.337585774433027e-02   +6.487786749456712e-01   -4.703249658744292e-01   -2.516332622092776e-01; -3.984037464051935e-01   +9.444644820951490e-01   +1.690092702763913e-01   +5.207192035107523e-01   +1.555464861579938e-01   -2.121224529950949e-01   +5.735594151702116e-01   +3.907617179211201e-01; +8.913071437966107e-02   -8.167956254381652e-01   +3.603424364527228e-01   -5.527925373688023e-01   +3.548465330673869e-01   +6.970012845986751e-01   +1.551355512918978e-01   +8.181363742720834e-01; -1.132696786496883e-01   -3.855624932468814e-01   -6.424973632153119e-01   -5.068373279422991e-02   +8.324239929701786e-01   -7.642480357772634e-01   -9.108428809380795e-02   -8.538382979253017e-02; -1.986407377433166e-01   +3.424883506441515e-01   -2.616998826723244e-01   -4.489253621834759e-01   +1.179702589994670e-01   -5.574101944506815e-01   -1.483477584067711e-01   +9.940215533449170e-02; +8.158505165666631e-01   +6.740058273822922e-01   +7.556621165370545e-02   +1.974664935926886e-01   -4.639403971806616e-01   +2.655587362158218e-01   +4.427112979490361e-02   +1.755846799813667e-01; +2.828552152761242e-01   +1.283983732402339e-01   -3.063200921799130e-01   +7.138905798637938e-01   -7.381549810309125e-01   -2.871175733660994e-01   +4.788176983089643e-01   -1.458339875628956e-01; -6.415016291565305e-01   -1.440285273503724e-01   -3.877417956224281e-01   +1.392822621730032e-01   +7.792654722444088e-01   +7.411824920528567e-01   -2.802949550804762e-02   +1.890283996331669e-01; +3.210725843468534e-01   +8.774718180024194e-01   +8.797197845255178e-03   -3.333101081465621e-01   -1.207163380554331e-01   +3.437967721345667e-01   +1.824416487688751e-01   +2.860826099114314e-01; -1.292492448718725e-01   +4.466479639836049e-01   -2.279462158460943e-01   -1.427553751047241e-01   +5.530568903794539e-01   +3.481528216919272e-03   -7.933098847365627e-01   +2.940687259893019e-01; +6.758713585794645e-01   -6.624392266728304e-01   -2.690293233961226e-01   -3.969026630404812e-01   -5.158487448101173e-02   -4.445609725404245e-02   -1.385590334717273e-01   -4.502269900402736e-01; +4.012581102487787e-01   +4.009214091673374e-03   -6.266018933921682e-01   +4.847709611001008e-01   -7.157985134559885e-02   -4.180088818154948e-01   +4.143268374708270e-01   +1.872643740043330e-01];
L3I_L3E_iAMPA_netcon = [+2.369862572876066e-01   -2.014252625647807e-01   +8.507550954494844e-02   +9.268303412463584e-03   +4.677694141611226e-01   +3.982132229108691e-01   -4.921491575942533e-01   -1.446812860178934e-01   -1.059931406760604e-01   -2.878550518543693e-03   +7.876505197689719e-02   +1.712541562046057e-01; -5.224133645698650e-01   -5.342169209302009e-01   +5.406084781253593e-01   -5.333011208850403e-01   -1.361108435664274e-01   +3.237162766739061e-01   +1.332531010776654e-01   +1.081525989019756e-01   +3.644252231761380e-01   +1.158938298218129e-01   +7.176881566915970e-01   -7.968834388983997e-02; -3.704973230822737e-01   +7.211193531052580e-01   +4.988067665405064e-01   -7.630780403950557e-02   -1.639600028185296e-01   +2.620058722676447e-02   +6.096554192001197e-01   +5.168480905723064e-01   +8.948216432335434e-01   +3.636836586726612e-01   -3.340361705671784e-01   -1.972192323946925e-01; -9.445106766236978e-02   -4.941271071144783e-01   +1.504950131133991e-01   +2.499667819568402e-01   +1.809585532290383e-01   -6.719819885945643e-01   -2.762605723859573e-01   +4.820368145567742e-01   -7.625990220796838e-01   -1.000000000000000e+00   -2.784484059985829e-01   -4.712368001828338e-01; -1.685944826436835e-02   -2.937610069019501e-01   -9.465833443263563e-02   -7.229667183784988e-02   -6.101077621274560e-01   -2.724148337067617e-01   +1.578228795316888e-03   +4.321265168371956e-01   +1.149014251196072e-02   -1.159666826621297e-03   -2.833793524198808e-01   +3.172956860218203e-01; -3.783064070237571e-01   -2.566466321005298e-02   +1.019592061166412e-01   +3.882764479208704e-01   +6.372096131729020e-04   -5.609501293000885e-02   -6.403748168134827e-01   -9.775027354404005e-02   +5.433932714246192e-01   +5.532558460934731e-01   -3.811515484396972e-01   +3.844798850571101e-01; -4.157414770469161e-01   +4.268723185757934e-01   +1.882293741002929e-01   -3.280158384729351e-01   -7.527617050176071e-02   +1.252003403434050e-01   +3.156830329904295e-01   -1.004166320707060e-02   +7.198663797624193e-02   -3.499602578590447e-01   +3.980708614386977e-02   -4.662369603793846e-01; -5.593658748670164e-01   +7.288448020230982e-01   +2.842499877926600e-01   +3.747210927715086e-01   -6.063096253668606e-01   +2.637775607529393e-01   +1.373955492489132e-01   -1.551117483378024e-01   +7.190684857235307e-01   -5.164900124464986e-01   +5.475016326119980e-01   +5.489333184091683e-01; +5.249296760332162e-01   +1.369312056429651e-01   -3.080425428240366e-01   +5.871470951950319e-01   -5.526569427788887e-01   -8.328156136380266e-01   -1.417466314542208e-01   +1.377585172857458e-01   -1.810752483107101e-01   +5.012504165690475e-01   -3.009421024624188e-01   +2.495572988801679e-01; -1.240889575596717e-01   -7.873186799610510e-02   +3.550913044281227e-01   +4.864296459516991e-01   -4.511345045954387e-02   +2.161672572442183e-01   +3.677634399074670e-01   -1.059806132929501e-01   -4.406869623106090e-01   -3.725186348029745e-01   -3.650399891624803e-01   +8.217397947518219e-01; -7.253481225037913e-01   +7.717136314266306e-01   +8.838129848213652e-02   +1.293387838518368e-01   -4.957349839373517e-01   +1.783918921779989e-01   -1.075512411484557e-02   -3.987906353835590e-01   -1.235762129522856e-01   +5.688136221294861e-01   +9.397183049762711e-01   +1.567308667752663e-01; -8.161600439177508e-01   -1.538283633388955e-01   -3.259065879708831e-01   +2.959139717682139e-01   +3.908636035182135e-01   +2.618579131740271e-01   -6.182764085908056e-01   +3.637092259215358e-01   -4.982977485340839e-01   -7.968917146071688e-02   -1.245098118979265e-01   +5.142841348629649e-01];
L3E_L3I_iGABA_netcon = [-4.654812958309328e-02   -3.087412469488295e-01   -2.394218470292349e-01   -3.712143631956715e-03   -5.963887555008093e-01   -9.153443925034339e-01   -6.338514403355699e-02   +6.836629817162854e-01   +2.105452879550963e-01   +5.575890564703306e-01   -1.081192763337457e-01   -3.586921880442203e-01; +2.546848872517875e-01   -4.499413424618353e-01   +5.810699868830546e-01   +4.902922633424954e-01   +1.289169571063084e-01   +3.247913665322564e-03   +1.588486768435116e-01   -1.065800011125035e-02   +6.233412243496876e-01   +1.000000000000000e+00   -6.357563919120303e-03   +4.358886175265274e-01; +4.293509379293654e-02   +2.717950518169449e-01   -4.045029898616269e-01   +9.768773151526935e-03   -3.671963907686274e-01   +5.169033058380380e-01   -7.791593824467374e-01   +8.339688203970028e-02   -1.083760345797836e-02   -3.250184848807930e-01   -7.515804330656495e-02   -4.518015860138052e-01; +1.800298053858424e-01   -1.902963092842613e-01   +3.424927116810403e-01   +1.298115031779164e-01   -2.340037850370431e-02   +2.743291300392677e-01   -2.043482707231426e-01   -1.907867812804042e-01   -4.318279092950899e-01   -4.841371624691554e-02   -8.316390216423114e-02   -2.283170234381037e-01; -2.521684516429321e-02   -6.926246633895050e-01   +3.823597051895648e-01   +4.989480714016309e-01   +6.648964121107860e-01   +3.408879942729147e-02   +6.531417652023254e-02   +6.775521144856998e-02   -2.339227237329102e-01   +6.606111209141519e-02   +7.552894482067400e-01   +6.058054834853055e-01; -9.303445461475184e-02   -2.128442918374479e-01   -7.114229386138411e-02   -1.358682500787517e-02   +4.382751467382788e-01   -1.621720871713938e-01   +8.608252210050045e-02   -5.610311699382033e-01   +5.958237654164239e-01   -1.780828469620779e-01   -1.354468001080512e-02   -3.210140525552432e-01; +1.650276876473220e-01   -4.233328348526001e-01   +5.978295339788211e-01   +2.155855729833400e-01   -5.769065179682535e-01   +1.027578002576802e-02   +2.113191732643262e-01   +1.810889965198351e-01   +1.071618426710414e-01   +4.442948788603929e-02   -2.453395460030592e-01   +4.413492262725671e-01; +2.584249483854318e-01   +8.429981988886743e-03   -1.193228417352636e-01   +4.272558676147172e-01   +7.015117757069622e-01   +3.488745030808939e-01   -5.704167575038001e-01   +9.377620033582604e-02   +5.600312417358450e-01   +4.202791783001001e-01   -2.872847187149197e-01   +4.288893036659826e-01; +5.200941509980562e-01   +3.736397308323272e-01   +5.991275449674779e-01   +1.936857718327285e-01   +2.364949099378471e-01   -3.195971718642839e-01   -6.613376201644724e-01   -1.650973569238311e-02   +2.263181630130995e-01   +1.432340830592439e-01   -3.179345809832289e-01   -5.923640031780661e-01; +2.644462223475388e-01   +3.807380039658798e-01   +5.190442627665878e-01   -2.573429683204201e-01   +4.176842829437905e-01   -6.332926614267529e-03   +4.013499222385606e-01   +2.230406738882554e-01   -1.539987575449918e-02   +3.711623424953019e-01   +3.024016384221662e-02   -8.484994666485870e-01; -1.506084024944144e-01   -2.651791614625578e-01   -4.767015941981945e-01   -1.905790371038652e-01   +6.589628726671612e-01   -6.716773566207680e-01   -6.173778784286882e-01   -1.292224894173231e-01   +3.508285837521951e-01   +9.826390150677719e-02   +6.276767822530646e-01   +1.376735587432505e-01; +6.043667983385856e-01   +4.096130309215252e-01   +5.168725965557313e-02   +2.328424351585522e-01   +1.840475926077954e-01   -2.020511570419614e-01   +7.601859788750269e-02   +4.436985210794256e-02   -8.438749525724290e-02   +6.343688110091936e-01   +6.073160502414413e-01   -4.068487496677194e-01];
L2E_Input1_iAMPA_netcon = [-2.230782876807825e-01   +3.634592929175209e-01   -7.422833427252340e-01   +1.625832646709828e-01   +2.193061273377193e-01   -2.766600600287231e-01   +4.288080890904214e-01   +1.092350148161779e-01];
L2I_Input2_iAMPA_netcon = [-9.070570691834223e-01   +2.824440176437604e-02   +5.644232640419383e-01   -4.578614484590591e-01   -5.718173503612985e-01   -4.070183460212498e-02   +6.420835918332154e-01   -2.965708201465491e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
