function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.243777708407629e-01   +4.224692990406201e-01   +5.307893853806037e-01   +6.364558721468379e-01   +5.995992924204651e-01   +3.411036736646164e-01   +6.481311449046341e-01   +8.393847650924608e-01   +5.443672482870947e-01   +1.927206123184662e-01   +4.449074537695275e-02   +8.224158073213732e-01   +7.677794926630117e-01   +1.102544136385898e-01   -6.038477187850017e-04   +8.401863841060210e-02; +9.829333485057750e-01   +9.632877474513801e-02   +3.239702606878503e-01   +9.570663417902155e-01   +3.869705354384778e-01   +6.064005260628224e-01   +6.785264560566830e-01   +8.319920763218469e-01   +7.222985260161038e-01   +1.379813871731720e-01   +7.529678319283994e-01   +4.305603113698901e-01   +1.678109736623194e-01   +1.360336374089183e-01   +8.652813979483942e-01   +6.268403988944256e-01; +7.305885248727031e-01   +5.971011119580069e-01   +1.058635127693286e-01   +2.413725068268519e-01   +9.157554854376583e-01   +1.917258187253419e-01   +6.347436614580153e-01   +2.559283491855577e-01   +5.211976054607383e-01   +6.959493957442967e-01   +2.410578888694258e-01   +8.875656011509522e-01   +8.634456976338488e-01   +6.793208531838419e-01   +6.129680406644098e-01   +6.614853584636865e-01; +3.448152282482616e-01   +4.723395310531753e-01   +6.112270111376356e-01   +6.761963140525155e-01   +7.833106759892448e-04   +7.397672332512731e-01   +9.458739253297584e-01   +6.139083931414505e-01   +9.930336489173227e-01   +9.250449885960174e-02   +4.420220490211059e-01   +3.918640363146403e-01   +9.903293950768106e-01   +4.948185347293129e-01   +9.886091603605913e-01   +7.301019747109485e-01; +5.860190429295737e-01   +6.955911245956303e-01   +7.802770971681698e-01   +2.883341884138115e-01   +4.625016612674601e-01   +2.420109057941684e-01   +2.089264593100038e-01   +5.825028681793751e-01   +2.212472216965373e-01   +5.234272311078141e-01   +6.874846589989208e-01   +7.694836024259571e-01   +5.156528945935025e-01   +1.887842651608735e-01   +5.264393915530824e-01   +8.928290349354412e-01; +1.087633751775011e-01   +7.003213223576773e-01   +4.233932765613296e-01   +6.705270300048185e-01   +4.251844782508525e-01   +9.195490664634050e-01   +7.087995551099272e-01   +5.412469760337112e-01   +1.045091967238393e-01   +5.314792424421669e-01   +3.583317181152398e-01   +3.969481160083476e-01   +8.845286533781089e-01   +4.940827654548939e-01   +4.808479444397780e-01   +9.819409106790078e-01; +9.051468602379600e-01   +6.397149455198939e-01   +9.088641094231890e-02   +6.940225856147220e-01   +4.604727893087907e-01   +2.708349989176017e-01   +2.370050711053225e-01   +8.709593780992814e-01   +1.112531894824538e-01   +8.610705560263968e-01   +7.364032237506638e-01   +8.099050951725828e-01   +5.875877589303261e-01   +1.487582937582508e-01   +8.026178731315604e-01   +7.692006190407970e-01; +8.813981933646947e-01   +3.290080167824763e-02   +2.652547116100424e-01   +6.682845300570360e-02   +7.706985868266913e-01   +7.656676616386162e-01   +1.195198910658994e-01   +2.647828240391796e-01   +6.566378048133077e-02   +4.847366784315478e-01   +3.940854912093248e-01   +7.549206425432370e-01   +1.553174678473954e-01   +5.401630916400368e-02   +2.283669559990719e-01   +5.831237821623523e-01; +8.177337396541446e-01   +6.794671505306892e-02   +1.537466915154278e-01   +2.522931941282212e-01   +3.239688852420495e-01   +1.898885181564244e-01   +6.076561160621878e-01   +3.159197745803693e-01   +4.042738585894062e-01   +3.926904333552181e-01   +6.841554132400635e-01   +3.781198673133798e-01   +1.999948171896726e-01   +8.513998521793112e-01   +4.970245635605052e-01   +9.268423404833388e-01; +2.598195264484578e-01   +3.192859296049186e-01   +2.816908074539199e-01   +2.215609730644456e-01   +7.839785516496522e-01   +2.857532184440642e-01   +4.523044761686459e-01   +1.189904526425193e-01   +4.474634726136451e-01   +6.713166091894329e-01   +7.041885909839000e-01   +2.171242130796827e-01   +4.075859489889023e-01   +5.611502957548197e-01   +8.991485701668915e-01   +5.809862083470171e-01; +5.939407436495593e-01   +5.296706942197343e-01   +4.415926313978881e-01   +6.685149712364798e-01   +4.703140625166969e-01   +9.104060739543909e-02   +4.589676331243067e-01   +9.399983777868022e-01   +3.657738430985917e-01   +7.415724579729018e-01   +4.423444747004753e-01   +7.905538332422003e-01   +7.478060579819550e-01   +9.299479709897004e-01   +5.758133574009401e-01   +1.670410974725873e-02; +2.271356017430823e-02   +6.540591707287539e-01   +5.260975448798777e-01   +8.449709351848838e-01   +3.608651588788265e-02   +5.777701421622163e-01   +6.621023233158528e-01   +6.455554899106030e-01   +7.625937279756985e-01   +5.193547405710705e-01   +1.859752650446343e-02   +9.500973566251568e-01   +8.240167416600023e-01   +6.978449035734640e-01   +8.440309012014487e-01   +1.210699685177206e-01; +4.259640962192818e-01   +4.069432186951170e-01   +4.585101608683894e-01   +3.451548535254469e-01   +1.762398502682014e-01   +6.834782547335945e-01   +7.697515034078170e-01   +4.802640940211836e-01   +6.268039068996899e-01   +3.449966749028092e-01   +3.292073967542922e-01   +3.288121400873353e-01   +7.917208866828854e-01   +5.843808968290243e-01   +7.384220000209963e-01   +8.622732484086356e-01; +3.116131872634514e-01   +8.193976742803344e-01   +8.747157460389328e-01   +7.820237127572066e-01   +7.199846117961576e-01   +5.466187194592513e-01   +3.500398225261253e-01   +6.393764516416429e-01   +7.725750587066198e-01   +1.493308997418882e-01   +4.235454853229602e-01   +6.730837754712942e-01   +3.200963303845729e-01   +8.148353059342822e-01   +5.866185438022570e-01   +4.828974829187385e-01; +1.608724242117671e-01   +7.201035331086473e-01   +5.193077971462308e-01   +6.768997401750355e-01   +4.739352364115965e-01   +4.241761544167067e-01   +6.617355084061349e-01   +5.446234503055092e-01   +9.325521556014323e-01   +5.870525746445238e-01   +2.687183285167516e-01   +4.400198120053376e-01   +5.338160639911730e-01   +8.806741190959173e-01   +2.444920356799180e-01   +8.452058961598425e-01; +1.776809452791389e-01   +9.681160164972746e-01   +9.449537805085075e-01   +6.638153743079104e-03   +1.527836042131686e-01   +6.439655219225969e-01   +4.155961804217629e-01   +6.470807664123344e-01   +9.733800333355270e-01   +2.612154203110796e-01   +1.966754714560415e-01   +8.326380397753604e-01   +8.983961067037871e-02   +9.898087415352176e-01   +6.651023635951909e-01   +2.095929194046399e-01];
L1E_L1I_iGABA_netcon = [+5.510031854829932e-01   +6.947166588977433e-01   +1.053408580424789e-01   +1.770769193112634e-01   +5.419689310097456e-02   +1.785928932632569e-01   +5.962653957464858e-01   +9.969991447638280e-01   +3.392400724288814e-01   +7.788151029682289e-01   +6.837350758809181e-01   +3.654211394578138e-01   +7.828716775942729e-01   +4.323485343293796e-01   +5.960536933284145e-02   +9.660341007184388e-02; +6.311482776749884e-01   +4.987879252403540e-01   +1.428184752622388e-01   +3.985432134010223e-01   +1.777641226844058e-01   +3.607385920532503e-01   +3.000495069002895e-01   +3.308318813382643e-01   +2.941752177569882e-01   +3.377491570488281e-01   +1.323881172824750e-01   +3.693625193005481e-01   +1.011722403556239e-01   +6.551380894365373e-01   +3.138712169829165e-01   +1.414136852822185e-01; +3.222475593186316e-02   +5.357090153502643e-01   +1.679917516923941e-01   +1.338994245430108e-01   +6.608029510824853e-01   +5.606194216189622e-02   +1.347159157514485e-01   +2.970335614646043e-01   +7.458669271651426e-01   +6.079775902024115e-01   +7.233872879129697e-01   +6.849437589910495e-01   +2.931404618650552e-01   +1.116725475299208e-01   +7.719065334647819e-01   +1.680504852308913e-01; +6.141605087375847e-01   +4.434494494717542e-01   +6.225398262017927e-01   +2.888006211256941e-02   +3.327444694369360e-01   +5.225359004775896e-01   +2.109331913582231e-01   +6.228333475072322e-02   +1.071781055500120e-02   +7.413936007336677e-01   +1.096201792252565e-01   +5.978340803571471e-01   +2.359934030480397e-01   +9.316666469602288e-01   +6.957459354890360e-01   +1.958123422266904e-01; +3.633704015185609e-01   +1.240701796489557e-01   +5.738152108725019e-01   +9.382103413788929e-01   +8.981536028082002e-01   +3.345332959378933e-01   +8.962912098888384e-01   +2.980061815252048e-01   +4.749309556992866e-02   +1.052472171987899e-01   +1.170728950633235e-01   +7.890773584374348e-01   +5.300310590647466e-01   +1.854457861051100e-01   +1.254135959135748e-01   +3.180844423193112e-01; +4.984330522376459e-02   +4.914286901856373e-01   +5.342005920852540e-02   +3.027172954097506e-01   +1.165921908901209e-01   +1.738583819059095e-01   +7.160694431998825e-02   +4.434521679163370e-02   +6.674865626262344e-01   +1.266448844182346e-01   +6.406332084674723e-01   +3.682332549273850e-01   +9.301789815561545e-02   +2.661886363936541e-01   +1.275173521755468e-01   +3.176940396265207e-01; +4.870256243874175e-01   +8.531473247238416e-01   +9.322309595318726e-01   +2.955887700651949e-01   +9.888224044167276e-01   +2.110582443933386e-01   +2.426472710911220e-01   +5.056342312135124e-01   +6.043962406476845e-01   +5.487734885143003e-01   +3.292426664001804e-01   +2.053367262836479e-01   +4.054859734556611e-01   +7.982583398574727e-01   +9.149573615973824e-02   +2.171937110016799e-01; +1.919704681248749e-01   +8.744947897056411e-01   +7.282623315903011e-01   +3.354602664162358e-01   +5.414726759774957e-01   +9.054410442446552e-01   +5.453706908815362e-02   +7.610086565844987e-01   +5.264486505031345e-01   +4.852646947020691e-01   +6.539353579766156e-01   +8.728022689686189e-02   +1.043414693846956e-01   +4.880181441973574e-01   +8.344780260198442e-03   +2.518897778993764e-01; +1.219626404652134e-01   +2.712106787181005e-01   +7.373697478776092e-01   +4.686807099958935e-01   +7.057651905913936e-01   +6.750483688234492e-01   +4.409898173819186e-01   +6.312300367371447e-01   +7.301133677002554e-01   +8.897837454996670e-01   +7.502010392566860e-01   +7.720041040911244e-01   +1.103252065221165e-01   +7.690507565932008e-01   +4.245499755847080e-01   +8.932628503446743e-01; +2.063711974076275e-01   +2.103025663718796e-01   +6.352065698750678e-02   +6.476341251841742e-01   +9.994012854882248e-01   +4.683642745781627e-01   +1.476872738175117e-02   +9.133997618099030e-02   +7.078431198954600e-01   +7.997716374761652e-01   +5.842843067092957e-01   +2.074956195418160e-01   +7.859807084928346e-01   +3.976173169050843e-01   +6.558371702310505e-01   +7.028652663659485e-01; +1.465513882135067e-01   +5.634780691600663e-01   +8.597055386511859e-01   +2.433357692324285e-02   +2.878848899177930e-01   +9.121366653249861e-01   +8.970536680985227e-01   +8.075223249270760e-02   +7.807276492249416e-01   +7.352658051202413e-01   +7.407920674777527e-01   +3.895127433133775e-01   +2.911811329969561e-01   +2.725349183546618e-01   +7.228642960950492e-01   +5.551161699597004e-01; +1.887579313167436e-01   +6.388181697099462e-01   +9.329960702706724e-01   +8.426058935724394e-01   +4.132831134656010e-01   +1.039543178230678e-01   +1.954815526234448e-01   +7.748035011366171e-01   +2.884215790271238e-01   +5.320063819393353e-02   +2.343537244745005e-01   +5.512968178747712e-01   +6.039458759777687e-01   +3.737443424148855e-02   +5.303300745948601e-01   +1.841550539625688e-01; +4.303361784058155e-02   +4.161043263955847e-01   +9.840819472412355e-01   +5.580987424225838e-01   +4.664428587632795e-01   +7.446100438283476e-01   +9.314616110450144e-02   +9.055842985469611e-01   +6.908251023554625e-01   +7.323594081598203e-02   +7.345854979472156e-01   +2.288971998317442e-01   +9.641660801650980e-01   +6.732473377513791e-01   +1.081726296227772e-01   +2.121262819508013e-01; +6.354924828961328e-01   +2.064196715832086e-01   +8.577190912093559e-01   +8.534873406493267e-01   +7.643954279627295e-01   +7.376924953957463e-01   +3.075885263544438e-01   +5.334278298850306e-01   +5.552524437726374e-01   +8.697152336158220e-02   +9.711859488338940e-01   +6.420808258072577e-01   +4.314461155103198e-01   +4.309652838978032e-01   +6.322365731888028e-01   +7.695790270169484e-02; +2.819461534464848e-01   +9.486692832631187e-01   +7.856025061369164e-01   +3.490217504659449e-01   +8.174142238690857e-01   +5.622921802545421e-01   +4.558090257034589e-01   +1.078798773043464e-01   +3.950169662288585e-01   +7.960545042207648e-01   +8.677402937381221e-01   +4.828538685278981e-01   +6.947942690407968e-01   +4.510046520049993e-01   +1.292083157459470e-01   +9.137928800498363e-01; +5.381640806495859e-01   +8.082490046074750e-02   +5.143199577285100e-01   +4.466162554438580e-01   +9.933454334460996e-02   +1.850239325822853e-01   +1.020919058900793e-01   +8.270304633589284e-01   +6.166363397560908e-02   +9.418993382912020e-01   +8.718720020296261e-02   +1.514821489050927e-01   +7.580842536694746e-01   +6.091608744467544e-01   +1.342456800549665e-01   +7.067140859698663e-01];
L2I_L1I_iGABA_netcon = [+5.584695857158027e-01   +1.595423077882614e-01   +4.230309428104996e-01   +6.834380429556531e-01   +8.084102179597301e-01   +7.953581861108836e-01   +7.888120014019371e-01   +2.657282830017873e-02; +3.134601168785015e-01   +7.583511065981801e-01   +4.296348844764109e-01   +4.637645056182245e-01   +7.471095997254187e-01   +5.777913271114786e-01   +8.516266527637476e-01   +4.206282513615232e-01; +1.662477826124298e-01   +8.703936443700994e-01   +1.251420526333738e-01   +2.129087947047563e-01   +1.184865465156451e-01   +4.415449581964771e-01   +5.068914802442445e-01   +1.830082534927573e-01; +6.217791670132548e-01   +3.509495586689557e-01   +2.386567682125263e-02   +9.835506341029637e-02   +5.255659522015391e-01   +2.572024854999244e-01   +6.357277655756066e-01   +7.264657451611537e-01; +9.875480402180736e-01   +6.860376169255656e-01   +2.905545424587999e-01   +8.232015613949683e-01   +3.247830462799283e-01   +7.524497034799168e-01   +9.523012312312226e-01   +3.703824576086555e-01; +1.712603313452461e-01   +2.936036132073953e-01   +3.184391494862528e-01   +1.754752877980651e-01   +5.458854651382883e-01   +2.291111948405910e-01   +4.443012794287201e-01   +8.417804955662198e-01; +2.580500996254424e-01   +5.298134683072220e-01   +6.535294854134719e-01   +1.642270675443765e-01   +4.001541196054086e-01   +6.514407857058327e-02   +5.853785750975322e-02   +7.330430072706817e-01; +3.973413075594305e-01   +8.331260563479889e-01   +9.570680986334883e-01   +6.676473554021571e-01   +4.156778982824141e-01   +7.665120710495235e-01   +8.677257038068480e-01   +5.695511206329007e-01; +7.484264072554554e-02   +5.991987000527580e-01   +9.366501067403936e-01   +8.934263357018978e-01   +1.788724723773625e-01   +6.713642660102750e-01   +6.310122316021203e-01   +1.780623137048382e-01; +6.844740541327421e-01   +3.348245566015943e-01   +4.583543989455267e-01   +5.157661569813785e-01   +2.561562596862785e-01   +7.146268631421961e-01   +3.532899703263767e-01   +9.589178764417260e-01; +4.036416025218348e-01   +2.993597154257771e-01   +2.395670717664982e-01   +7.028163243029995e-01   +1.951370807026084e-02   +6.424083334657797e-01   +9.970642809157586e-01   +2.652849080172084e-01; +9.825757510648342e-01   +4.529904748524222e-01   +7.647354008942941e-01   +1.520207299914141e-01   +9.228201316935731e-01   +4.192445339581696e-01   +2.248384974968840e-01   +9.245603108439625e-01; +4.006088902145910e-01   +4.238835494741985e-01   +7.594247962437702e-01   +9.527717907535832e-01   +6.548503638532950e-01   +3.898146154568310e-01   +6.527275184645605e-01   +2.215287838256373e-01; +6.211077950089258e-01   +3.596655398395635e-01   +7.403335989414404e-01   +5.402935961526573e-01   +9.335441203176943e-01   +8.171783195268875e-01   +6.044230504626876e-01   +3.727678124758039e-01; +1.548440851831070e-01   +5.602775108848155e-01   +7.444861672003275e-01   +6.808673143464731e-01   +1.638066200256243e-01   +3.165851697371855e-01   +3.881540482236566e-01   +8.810793795481986e-02; +3.815368412893264e-01   +7.429923918684750e-01   +1.084968615188506e-01   +3.734002274707064e-02   +9.215608202690241e-01   +8.162447940379042e-01   +1.398842861906593e-01   +6.417649635447417e-01];
L1I_L2I_iGABA_netcon = [+1.809653953586163e-01   +9.119219215999220e-01   +2.759550448330484e-01   +8.748806121307300e-02   +5.331951598863508e-01   +1.064695624052283e-01   +9.883737631478320e-01   +4.119432464401771e-01   +7.193897652435413e-01   +2.177126540087631e-01   +9.220632532481230e-01   +6.737520429225881e-01   +1.071397919541340e-01   +5.563037537831913e-01   +6.307583066453899e-01   +4.835195920232586e-01; +4.572452219687673e-02   +7.997136460132144e-01   +2.473640301155023e-01   +8.030602875794445e-01   +8.874393343686126e-01   +6.153885072752907e-01   +7.669847035873332e-01   +6.003949670689109e-01   +9.966074191374090e-01   +1.260424216010293e-01   +7.704944329587580e-01   +4.774750320061490e-01   +1.810763895768749e-01   +7.713543909969929e-01   +9.993528892909063e-02   +8.946888534154167e-01; +7.235743561086816e-01   +7.445110216037449e-01   +4.518235000975857e-01   +9.893283721852095e-01   +8.981494004494686e-01   +9.407328113743637e-01   +3.361304372943467e-01   +7.497766600542393e-01   +3.545372036718175e-01   +3.091354135315585e-01   +4.205810344755443e-02   +6.237323632547920e-01   +1.000211473620472e-01   +3.120462598817255e-01   +3.920226535044983e-01   +1.386990400379002e-01; +3.484514480630108e-01   +8.128078315937707e-01   +2.265502835138986e-01   +6.659278602903321e-02   +6.252914461308019e-01   +3.534098982566783e-01   +6.632537353140812e-01   +5.840159542239034e-01   +9.704002759048436e-01   +7.248975328100159e-01   +3.790888825536034e-01   +2.376998235930450e-01   +4.901823641331825e-01   +1.780625643207842e-01   +5.573651569485601e-02   +3.888601373276739e-01; +6.606026398794796e-01   +3.838276658333429e-01   +8.043029384468789e-01   +9.399245448077678e-01   +1.373103948387392e-01   +4.110073405175357e-01   +2.460497220470361e-01   +5.511557775299607e-01   +3.476590213146049e-01   +7.832969150990172e-01   +7.038507115824446e-01   +1.777444649986834e-01   +1.929035041135972e-01   +3.382136553080461e-01   +5.007632171935102e-01   +9.276420661041819e-01; +3.854843155604646e-01   +6.176946629389907e-01   +9.853273147091756e-01   +1.808664671082761e-02   +2.189324880688017e-01   +9.833557267713735e-01   +2.947246483347747e-01   +5.807649720046703e-01   +8.859292426060605e-01   +6.920506820741128e-01   +7.275044858482413e-01   +8.286410906349022e-01   +8.938398509314860e-01   +2.098572341567729e-01   +4.312254091836397e-01   +9.189213150759812e-01; +6.281426409937199e-01   +5.770108358347861e-01   +3.036301437011246e-02   +6.852114037789430e-01   +1.819052874929861e-01   +9.456520891895832e-01   +6.779555833901592e-01   +5.111046284805143e-01   +4.548384981307272e-01   +9.742074642250589e-03   +2.251586434320839e-01   +7.660555459263505e-01   +9.894863074744341e-02   +5.103839215061343e-01   +9.977962629499497e-01   +7.160719184006759e-01; +2.262872326018418e-02   +5.277501599074300e-01   +5.355085691606696e-01   +7.832388177958718e-01   +4.187510879520858e-02   +6.768522259018088e-01   +5.268486830836085e-01   +8.048573121627824e-02   +4.146770000046507e-01   +8.454497330097619e-01   +2.691095364245882e-01   +9.347694817552513e-01   +4.517386789354533e-02   +9.048950198214557e-01   +8.104512318171300e-01   +6.174914711063827e-01];
L2E_L1E_iAMPA_netcon = [+3.421158989415349e-01   +7.585598805793449e-01   +5.899049133407476e-01   +5.012402285865244e-01   +8.479307854815409e-02   +4.761479233292801e-02   +9.237805327574200e-01   +4.755892761404496e-01; +9.366146500983008e-01   +4.143641164215816e-01   +6.608577370200489e-01   +4.890622389607168e-01   +9.742111166197670e-01   +3.434856381645464e-01   +8.008328770561414e-01   +3.634766032577779e-01; +1.233952319002091e-01   +4.941367840211540e-01   +4.782973285893705e-02   +8.782444173722536e-01   +6.513618381877023e-01   +7.378313599043960e-01   +2.859975239791003e-01   +7.883167356618017e-01; +7.319189306292577e-01   +6.960812687867306e-01   +3.484766984818240e-01   +3.513847738792761e-01   +2.310699337764726e-01   +7.951894337894770e-01   +5.442863397995829e-01   +7.802573338927872e-01; +6.470056548171446e-01   +9.742540537796190e-01   +4.489916925633708e-01   +4.484810955960515e-01   +4.029023430087475e-01   +5.445427223347498e-01   +9.845418854329452e-01   +6.685674918033303e-01; +8.335067445287048e-01   +3.274770173222861e-01   +2.393206343001671e-01   +9.643972456884397e-01   +1.211877195597340e-01   +6.875651092664964e-01   +7.151420703700726e-01   +1.336611650906682e-01; +3.971271970938810e-01   +8.371364023700489e-01   +7.150659302676818e-01   +4.258382150737641e-02   +2.680384614492712e-01   +8.953162927258571e-01   +8.382350073409071e-01   +2.030960204838317e-02; +7.501961039502173e-01   +7.397809258977981e-01   +8.572678069180458e-01   +9.739839450442674e-01   +2.556788135560839e-01   +5.390570147315727e-02   +4.338942165287582e-01   +5.598508415422655e-01; +8.353057291124621e-01   +9.539821456763181e-01   +2.831738731164593e-01   +1.878065534407037e-01   +3.328318044463638e-01   +3.039136427615299e-01   +4.711778219916719e-01   +3.009491440326739e-01; +3.241500013924725e-01   +3.329319645336340e-02   +7.313712392016655e-01   +6.653852274403823e-01   +1.493080443408744e-01   +4.542861618274811e-02   +5.612854769469654e-01   +9.390974595328202e-01; +5.514820019651194e-01   +3.550459661380357e-01   +1.397669454714042e-01   +5.877266286897264e-01   +3.469758509646138e-01   +1.953023815428539e-01   +2.700400714949079e-01   +9.819256170429910e-01; +9.815366371242178e-01   +6.619991415063622e-01   +8.388923649706761e-01   +6.754941283369492e-01   +1.204700228213560e-01   +7.184689314573943e-01   +7.482317432016991e-01   +2.861000667522058e-01; +5.491677346515237e-01   +2.817690651610823e-01   +1.391360084301750e-01   +3.593143264580224e-01   +8.833697741573175e-01   +7.225749280811430e-01   +5.046469526938504e-01   +8.001356633453237e-01; +3.311890894862980e-01   +2.308666817101641e-01   +5.870585314906919e-01   +6.198448096198342e-01   +9.520167421018369e-02   +8.775074542174010e-01   +6.469871534665922e-01   +8.949457039637693e-01; +6.192655593830488e-01   +7.101739396852924e-01   +3.667554910448848e-01   +8.110746136448946e-01   +9.311005164155571e-01   +5.808811006140120e-01   +3.071660033909168e-01   +5.986030191929715e-01; +3.616798885950132e-01   +6.235489331254750e-01   +8.056510556629016e-01   +1.953339515621457e-02   +4.000218228445574e-01   +7.196835284374403e-02   +1.390415486831567e-01   +8.840125369292181e-01];
L1E_L2E_iAMPA_netcon = [+9.428521009334310e-01   +3.731669858695779e-01   +6.680928326172899e-01   +4.851511809411660e-01   +2.471211879441574e-01   +4.524192462522501e-01   +1.236705401900383e-01   +4.968402053849325e-01   +8.825208396656969e-01   +3.249985555736252e-01   +5.147592706588815e-01   +8.641881340060466e-02   +6.318907995514272e-01   +4.289742942317599e-01   +6.128632097880530e-01   +5.034246400768470e-01; +5.485257016516928e-01   +9.358693958250531e-01   +2.081483498213242e-01   +7.570318872049191e-01   +7.843585731890946e-01   +2.059276442885993e-01   +4.064556191654967e-01   +6.931446646229301e-01   +7.203264894145274e-01   +2.461166522798716e-01   +6.576362159883985e-01   +1.631781503368624e-01   +8.583941089568531e-01   +4.921163971262127e-01   +8.205109169711189e-01   +6.122606554178545e-01; +7.287218705003062e-01   +8.286188288227594e-01   +6.535370468105113e-01   +4.161026403531975e-01   +8.826838021831973e-01   +8.985906338040011e-01   +2.754090215675655e-01   +8.337622656940918e-01   +1.856708070439941e-02   +3.423643344056058e-01   +9.512016359881718e-01   +3.246360597433466e-01   +9.757885354742231e-01   +7.141301278450982e-02   +8.867050597760223e-01   +8.198534701774215e-01; +5.773236575314634e-01   +8.505594013645291e-01   +7.190508465562273e-02   +9.720291267242308e-01   +9.126477592296581e-01   +7.629537661648084e-01   +7.171470448068755e-01   +6.117660937328639e-01   +6.746657798256176e-01   +3.757298611810460e-01   +7.224926506969778e-01   +3.011988906927276e-01   +5.696975560836021e-01   +8.873392996526758e-01   +9.303977978289402e-01   +5.330937148323168e-01; +2.588994309716086e-02   +3.718852919585857e-01   +4.068471154906937e-01   +9.899081747606781e-01   +5.584431504841182e-01   +8.835580068323456e-01   +2.825665653957161e-01   +5.751037231378294e-01   +4.388060299234416e-01   +5.460119919562102e-01   +3.996549034641080e-01   +1.116929779115879e-02   +9.964724104950401e-01   +6.487760664070252e-02   +1.921949770611648e-01   +2.027425462391076e-01; +4.473709326020037e-01   +5.930341663458014e-01   +6.665725259497085e-01   +8.637560563769137e-01   +5.985877555515140e-01   +2.866923171306685e-01   +8.952657740917973e-01   +3.244212746539314e-01   +4.362369283015434e-01   +5.630651275485746e-01   +8.342074415301646e-01   +5.410909579335546e-01   +5.537325417952325e-01   +4.360585527388830e-01   +2.574630067463322e-01   +4.544189052773850e-01; +6.479486346547376e-01   +8.743853122560551e-01   +9.359491481946856e-01   +3.879570681055052e-01   +1.480445718810016e-01   +6.704541158770537e-01   +8.266003426710675e-01   +4.559907054593488e-01   +1.159534816592337e-01   +3.954210141164997e-01   +1.353885308358361e-01   +9.658823478144392e-02   +5.153319341888889e-01   +8.251897779503456e-01   +8.970517030441280e-01   +4.285197698035617e-01; +5.221354737278294e-01   +9.336754908652236e-01   +8.094490121020661e-01   +4.530114747736017e-01   +9.016435293509670e-01   +6.640421588597066e-01   +3.896948963973296e-01   +7.141068039625668e-01   +8.146329445566791e-01   +3.969100680788410e-01   +6.017962065898662e-02   +1.467794203704177e-01   +3.315475236532756e-01   +3.923251489986027e-01   +5.934939126428919e-01   +9.654703407106067e-01];
L2I_L2E_iAMPA_netcon = [+6.189456514254447e-01   +6.959485494219328e-01   +7.341259515204109e-01   +5.903083189938763e-01   +6.696377413026843e-01   +5.506055404773900e-02   +9.908501486039541e-02   +8.482985345864940e-01; +6.974221331080052e-01   +4.262200370803743e-01   +4.299354089622517e-01   +4.589371677808737e-01   +5.003729115187283e-01   +1.534091181448160e-01   +9.081315746696081e-01   +9.172558195083719e-01; +7.215162040262681e-01   +8.367241670639876e-01   +6.933892657120904e-01   +5.176300450671042e-02   +2.199381343226105e-01   +1.986265660212386e-02   +1.104040892416704e-01   +9.866174614361427e-01; +3.472804230856658e-01   +7.305080975107121e-01   +9.450234449047075e-01   +2.286189042810838e-01   +5.718157656183367e-01   +4.350251824478032e-01   +5.183861468997709e-01   +5.043992506911448e-01; +5.170011857726737e-01   +3.602685138910027e-01   +7.845694363183529e-01   +8.342374627297411e-01   +1.221049483823584e-01   +8.315544918533294e-01   +1.426401233442997e-01   +2.710894220620338e-01; +5.569955413689873e-01   +4.541965414756577e-01   +7.048956213024169e-01   +1.554353086856496e-02   +6.708372661514307e-01   +6.175006731634427e-01   +5.595891095750239e-01   +1.017382196482662e-01; +1.581028873524864e-01   +3.880132259392786e-01   +1.096444670689106e-01   +8.641520442813095e-01   +5.991037529740221e-01   +5.195854859476519e-01   +4.475101509893485e-03   +5.079743593824791e-01; +5.635714898260794e-01   +7.746412206458990e-01   +3.897751600273437e-01   +7.929180976442342e-02   +5.615413882202670e-02   +8.639147244176906e-01   +7.680872307635177e-01   +5.847202205741345e-01];
L2E_L2I_iGABA_netcon = [+7.644257688162192e-01   +9.414268925006546e-01   +2.385342450279815e-01   +8.336778858692835e-01   +2.574522465500410e-01   +7.559965416414884e-02   +1.738122363788994e-01   +5.236113573557677e-01; +8.274549390766668e-02   +6.566128764988605e-01   +5.785023237787750e-01   +4.021264269874176e-01   +2.983304555679730e-01   +3.939950743794081e-01   +1.402027453113360e-01   +2.642285520740729e-01; +6.599595967213369e-01   +4.522760483048960e-01   +8.659544544066680e-01   +3.909779682305990e-01   +4.248323171019111e-01   +4.263332417387501e-03   +5.979969580330026e-01   +6.850485602208334e-02; +5.171710086189585e-01   +8.396729586123591e-01   +4.051697320334667e-01   +3.623896574410733e-01   +1.178508915603037e-01   +2.200178856420462e-01   +8.997082968219350e-01   +4.360586895761258e-01; +1.718860512246568e-01   +5.334044074623325e-01   +1.116761333694566e-01   +1.379221626359979e-01   +4.973426053905604e-01   +1.175083588991814e-03   +9.386245808019745e-01   +1.732564791886573e-01; +9.405003202805063e-01   +5.537669845322283e-01   +4.435715716164921e-01   +2.575252631774829e-01   +7.069047978074756e-01   +1.899744656636734e-01   +2.204787150322282e-01   +2.656431093296598e-02; +5.911586974359636e-01   +6.804614912176594e-01   +2.981008385768607e-01   +8.617226628200715e-02   +2.440904412692201e-01   +1.420619059968121e-01   +4.809689424957763e-01   +9.538520629337013e-01; +4.401079760052220e-01   +3.675357861061940e-01   +4.014314071871841e-01   +4.298058127882134e-01   +7.846803165270165e-01   +2.680551731827608e-01   +3.775841383185689e-01   +4.309085501541684e-01];
L3E_L2E_iAMPA_netcon = [+9.617459303011642e-01   +7.730540443961559e-01   +9.116653936587631e-01   +5.312045967822198e-01   +4.821863469135430e-02   +8.192379279136600e-01   +6.252260764441121e-01   +7.482402712051029e-01   +6.735628707080183e-01   +9.051707769153409e-01   +5.819354813929253e-01   +5.934479005258834e-02; +7.626000538748412e-01   +2.273060779631241e-01   +9.073211261955338e-01   +7.161978048817744e-01   +5.523747347954682e-01   +7.274301444405614e-01   +5.423294840893123e-01   +6.459435462970994e-01   +4.319249574525748e-01   +3.934539960861203e-01   +6.866358526481245e-01   +9.804042012676732e-01; +7.951128143682949e-03   +3.701180725233547e-01   +5.911811779202955e-01   +1.804288101372342e-01   +2.744397107639558e-01   +1.774722282201677e-01   +4.373224305532886e-01   +1.217430829502187e-01   +6.921399126962221e-01   +2.470111398223759e-02   +7.208534020589827e-01   +2.843237895442949e-01; +6.798592657941426e-01   +8.925288149554064e-01   +3.310506269956526e-01   +3.352673881681778e-01   +2.436023321208499e-01   +3.603384005607160e-01   +2.870076350872708e-01   +5.051611918036364e-01   +2.571370842572048e-01   +6.700387770159243e-01   +6.490914586757432e-01   +5.930730553752660e-01; +7.051760709177665e-01   +8.564110136130890e-01   +8.533706486698792e-01   +1.875693656558648e-01   +2.432575502832426e-01   +1.865698161670947e-01   +5.007542943677590e-01   +3.478195226373533e-01   +1.228484739447623e-02   +8.376504031324818e-01   +7.252876791393853e-01   +9.611695777346903e-01; +6.448600513141288e-01   +4.005927119271775e-01   +4.430242222860158e-01   +3.207704461007700e-01   +1.542200772269386e-01   +8.944899628573260e-04   +7.623348445547595e-01   +9.037718748730736e-02   +5.313164961400830e-01   +9.711627037091325e-01   +3.747972049401893e-01   +1.868065683368908e-01; +5.540937958473385e-01   +3.185799371898745e-01   +9.016860607414426e-01   +4.044605388935716e-01   +9.579299524766486e-01   +3.141224680137000e-01   +7.616364190178858e-01   +1.477903783841821e-01   +2.800634609426874e-01   +5.648604427878876e-02   +5.798451823319122e-01   +1.928956689269341e-01; +2.176622089331778e-01   +6.088977700026081e-01   +3.444107000494832e-02   +5.480309701181009e-01   +9.359556321928219e-01   +6.984446400950213e-01   +5.774044583107560e-01   +1.995899817496602e-01   +9.460964521633732e-01   +4.502914134508172e-01   +1.144385818438395e-01   +3.406160985836887e-01];
L3I_L2I_iGABA_netcon = [+9.332569473333738e-01   +9.300872462511292e-02   +6.251954371953929e-02   +2.789711531169907e-01   +2.538936238159674e-01   +4.042527068800248e-01   +5.291356868747621e-01   +1.084172781300859e-01   +9.121060638293332e-01   +5.837154144318174e-01   +2.085380473404967e-01   +9.081225443153210e-01; +3.911659543436797e-01   +6.167793257034166e-01   +4.950882347959784e-01   +7.457162585995255e-01   +8.573704289694256e-01   +9.873986456077080e-01   +8.293871105043468e-01   +2.709742890136483e-01   +6.395296872892399e-01   +2.834839995503191e-01   +3.180374942295185e-01   +5.514509125169892e-01; +2.721297915517271e-01   +1.090542531983211e-02   +6.432186309370090e-01   +2.378648252538895e-01   +9.113174067492315e-01   +8.983143093767913e-02   +8.575315428749692e-01   +5.233929198756807e-01   +2.553634492713975e-01   +8.282049041163304e-01   +1.338690472919437e-01   +3.446332468926860e-02; +1.522789148551936e-01   +5.736618579654150e-01   +2.227817344610670e-01   +9.580732382624548e-01   +6.992177222607673e-01   +3.228310977178720e-01   +7.879764590616370e-01   +9.727463968931361e-01   +9.046530665287052e-02   +1.920251839094322e-01   +6.730537994996354e-01   +5.404101177845663e-02; +3.969807019842046e-01   +7.877166290123321e-01   +8.376652180160401e-01   +6.218117847543496e-01   +7.255702698676354e-01   +5.134288179595843e-01   +3.189640533770719e-01   +7.088846649577458e-01   +8.384919978408737e-01   +4.416580079697958e-01   +5.699319419989004e-01   +8.062566021114701e-01; +3.747976342785481e-01   +2.350365850720124e-01   +9.709261666779856e-01   +6.008995221908811e-01   +2.302238854797964e-01   +5.914937306502217e-02   +4.530019125413076e-01   +3.109770646937750e-01   +5.845037722036819e-01   +3.929578793667386e-01   +1.701551570086188e-01   +4.512038253321869e-01; +1.298862169024275e-01   +4.478683722213864e-01   +8.463648707178706e-01   +1.724613142843653e-01   +5.748657648772033e-01   +7.259360379908805e-01   +7.531725090757703e-01   +2.942747149244800e-01   +9.486970874185732e-01   +8.268785990895337e-01   +1.479391822218110e-01   +3.808538365897024e-01; +4.339852192664647e-01   +5.696605516153370e-01   +5.067363628775271e-01   +9.005482768201113e-02   +8.111710399662577e-01   +5.571006202763171e-01   +1.108169950302934e-01   +8.502461033748731e-01   +6.104859633925942e-02   +6.793464547870020e-01   +4.762942864311769e-01   +7.910279419316524e-01];
L2E_L3E_iAMPA_netcon = [+3.649750920967427e-01   +7.553630898234647e-01   +7.367291457611491e-02   +5.173759671810475e-01   +7.581563824345440e-01   +4.323314706428507e-01   +2.000609806200133e-01   +8.757660029903926e-01; +5.316141094540399e-01   +9.971386334249052e-01   +5.917794210929150e-01   +9.944614010867363e-01   +9.952700976190837e-01   +5.428146037240239e-01   +1.935687320326662e-01   +7.866741925076540e-01; +7.128983674324145e-01   +1.872180814368810e-01   +9.105345448640075e-01   +8.566768622048839e-01   +9.624342479182252e-01   +7.118441277824125e-01   +3.266642952502815e-01   +4.672690264344654e-01; +8.704102615765454e-01   +7.808139202090285e-01   +1.917522412636144e-01   +9.608517656174871e-01   +5.358808173059512e-01   +1.567758641569508e-02   +8.803780650118176e-01   +8.135569033750776e-01; +3.287173814140238e-01   +1.960457915715001e-01   +4.318153536279513e-01   +6.783121841171382e-01   +9.657557058295219e-01   +8.017533605731947e-01   +4.717863657922390e-01   +8.961675172945908e-01; +6.496174845237878e-01   +9.919028037454406e-01   +7.492702977473944e-01   +4.027964181156389e-01   +1.165530731391298e-01   +1.421801807957908e-01   +4.041188002050981e-01   +4.280249624516896e-01; +9.761794288312211e-01   +8.011158250740246e-01   +4.064015092092189e-02   +9.340367240603089e-01   +5.027867010386029e-02   +4.791442416315156e-01   +1.806297428023365e-01   +3.340556343518361e-01; +7.670028435709934e-02   +4.242016213614662e-01   +9.456811892243252e-01   +4.798011374595114e-01   +3.034865889350223e-01   +2.554545510355037e-01   +9.695872036793963e-01   +5.959772091990124e-01; +5.885540470128555e-01   +7.286712748278359e-01   +7.635885873861928e-01   +2.297462136642175e-01   +5.815487737133490e-01   +3.688764941257872e-01   +4.089409248471809e-01   +9.013521566157485e-01; +4.125433236804455e-01   +4.979303991864634e-01   +5.570389357425709e-01   +3.963535857995608e-01   +5.325639043958758e-01   +6.611503776590719e-01   +8.442635938008737e-01   +7.022813199211023e-01; +3.083138439423784e-01   +8.087117136042840e-01   +1.833570164038528e-01   +7.041720836527857e-01   +9.000023726647158e-01   +1.680832762009317e-01   +6.167456839723190e-01   +3.785842811421450e-01; +2.636324274881449e-01   +3.566823068150825e-01   +5.000884172248105e-01   +5.591158003125185e-01   +5.408256535485366e-01   +2.800417517837437e-01   +3.741055344432909e-01   +7.352888414529589e-01];
L2I_L3I_iGABA_netcon = [+9.545444854131357e-01   +3.123036505489414e-02   +9.106474030187175e-02   +4.595589597456432e-01   +3.272511773671288e-01   +3.673805110565448e-01   +6.852186585754340e-01   +8.049192397565942e-01; +5.423419394790837e-01   +2.083376111850554e-01   +5.936913079844844e-01   +6.387818653266913e-01   +8.047304076384497e-01   +2.096369429365932e-01   +9.093649833498639e-01   +6.647747569817335e-02; +5.386651694422711e-01   +4.548653261968212e-01   +2.408458134129194e-01   +9.163852950086998e-01   +9.994561271312445e-01   +4.406116497807719e-01   +6.109122759269062e-01   +9.488513690890285e-01; +3.091188729777453e-01   +1.265832507407435e-01   +8.389239568331371e-01   +1.609117418614970e-01   +9.796191148852279e-01   +9.548770344626946e-01   +8.997512283747624e-01   +4.951238713276529e-01; +7.008563385382560e-02   +9.182654217328078e-03   +8.571885160979252e-01   +7.135256804207738e-01   +1.257545293270065e-01   +1.236111762611862e-01   +1.942922733687135e-01   +7.540226793061116e-01; +1.820509054986661e-01   +7.269944579670764e-01   +9.614886694999899e-01   +5.769055866926207e-01   +2.303935426416386e-01   +4.695170379873602e-01   +7.535319859043398e-01   +7.400984822165138e-01; +9.245465859171224e-02   +3.534422451713850e-01   +4.885348254532872e-01   +4.322965210502137e-01   +2.345893432361046e-02   +8.551614058109829e-01   +3.476338702655726e-01   +8.305944004481086e-01; +4.640450423454465e-01   +7.785137995760001e-01   +2.185336757256388e-01   +8.830844319343620e-01   +6.077746468613767e-01   +4.232950942034661e-02   +4.189849517627024e-01   +1.557865129068699e-01; +9.476802194748979e-03   +4.360935671688266e-01   +2.270462415788735e-01   +3.908110392608365e-01   +1.094412773612288e-01   +6.898127665135505e-01   +1.535590649933563e-01   +4.565911047082302e-01; +9.143755445629349e-01   +4.367189586041167e-01   +5.365240819942843e-01   +1.771968264028203e-01   +4.063193263973399e-01   +9.774797816913987e-01   +8.191221644436022e-01   +6.186075061492886e-01; +6.422059580793612e-01   +5.025570684956238e-02   +7.615125210782395e-01   +6.315467150331450e-01   +8.830748850570924e-01   +2.835915292057150e-01   +6.228206925385897e-01   +9.297419360793188e-01; -3.354300101898045e-04   +4.793425013554659e-02   +3.466108585723246e-01   +6.236938267474467e-01   +5.480084535827298e-01   +1.339588116179077e-01   +7.400690620154642e-01   +8.337189899814524e-01];
L3I_L3E_iAMPA_netcon = [+8.942726325756335e-01   +2.552432325112235e-01   +7.402590956403555e-01   +6.820561021264889e-01   +6.012455502330196e-01   +7.486068424883271e-01   +7.459763135492118e-01   +2.231407876952906e-01   +4.543970688828094e-02   +8.004308295413464e-01   +2.909182770197524e-01   +8.025195799699891e-01; +5.819070546758842e-01   +3.229642801837274e-01   +6.933259463298492e-01   +2.361504966156689e-01   +8.556383933180693e-01   +5.432143089739701e-01   +1.273005869645854e-01   +3.514766589481427e-01   +2.137835913421636e-01   +2.331886923797950e-01   +4.034680382405990e-01   +1.035111414732427e-01; +5.832913250174931e-01   +4.018942029282740e-01   +8.227200396202425e-01   +4.552820046437767e-01   +9.898230362562466e-01   +3.397181699839306e-01   +8.220960165882130e-01   +2.864404375905480e-01   +3.966952556762621e-01   +9.306044782975357e-01   +8.633952719373116e-01   +8.204720581256646e-01; +8.549103115724991e-01   +4.051368696215042e-01   +8.292151775988907e-01   +3.837218355484499e-01   +9.295473872241772e-01   +8.321239320702708e-01   +2.603096886494091e-02   +9.265806731214851e-01   +3.341616854490436e-01   +7.631730189680926e-01   +6.148740069700924e-01   +8.406659092878068e-01; +3.367575404079310e-02   +3.866989367056722e-01   +2.949211018571347e-01   +5.384259757061475e-01   +4.108859134173230e-01   +5.513227751964269e-01   +4.163791821758184e-01   +5.076664627844030e-02   +2.285120409176065e-01   +8.279189391556551e-01   +9.901777828858288e-01   +3.557964172251482e-01; +8.842266724779795e-01   +6.093624287092623e-01   +3.093908906698573e-01   +9.909616964221746e-01   +8.401202926393091e-04   +9.573350050725531e-01   +7.306881366350706e-01   +5.925152908626717e-01   +9.352804307681269e-01   +5.730112895539787e-01   +2.033696351808642e-01   +4.294000603578297e-01; +4.068841911484117e-01   +1.650156463409092e-01   +5.240324564354129e-01   +7.550999971931117e-01   +5.420940434755941e-01   +8.928205435589065e-01   +7.817394732063092e-01   +1.617670895477279e-01   +6.814012852287066e-01   +7.931246221001111e-01   +8.283923392311042e-01   +5.701218949009087e-01; +3.621207982222090e-02   +1.895591065350882e-01   +3.270632055404677e-01   +9.810969385809064e-01   +2.083191251787221e-01   +3.581404950420258e-01   +3.680177644152523e-01   +8.371234012544440e-01   +9.631284234454459e-01   +3.295641014135265e-01   +6.764487618812941e-01   +6.995250542452700e-01; +7.463051015805421e-01   +9.641197028046931e-02   +8.339041955578049e-01   +2.348858971908625e-01   +2.190892941774789e-01   +5.479584836634953e-01   +7.462261719941157e-01   +1.675508994805792e-01   +4.387413773835087e-01   +2.237977369491405e-01   +2.485688204903315e-01   +7.428536618777448e-01; +1.559118725591449e-01   +3.221412812532276e-01   +8.087258197904584e-01   +5.290532323340441e-01   +3.279778145280989e-01   +3.464863180819295e-01   +8.928980643239947e-01   +5.013279743595861e-01   +9.388966702249508e-01   +3.116498415543705e-01   +4.773314988900849e-01   +7.576226681602304e-01; +1.448834472160918e-01   +7.702394125819739e-01   +5.590252405873675e-01   +5.401642894182623e-02   +9.548111045067818e-02   +6.231295745999630e-01   +2.445443775223794e-01   +9.989022777399544e-01   +6.003896760345013e-03   +5.846771834693681e-01   +3.996800493991091e-01   +3.897590957158082e-01; +6.060978768178793e-01   +2.350856360126415e-01   +2.635946871069124e-01   +7.576430654822378e-01   +7.498755608070371e-01   +7.981697674747997e-01   +1.296385721603366e-01   +3.548010407364889e-01   +6.103822937439453e-01   +8.296646429098249e-01   +5.991202574699093e-01   +4.267423313239386e-01];
L3E_L3I_iGABA_netcon = [+9.557939561268232e-01   +8.845471271594710e-01   +8.003459567977280e-01   +9.852544689194496e-01   +9.020342460543371e-01   +9.620172157882285e-01   +6.533000277772257e-01   +4.950197020599818e-02   +1.084610944793532e-01   +4.522986375544512e-01   +8.290467155396414e-01   +5.810817130500536e-01; +5.725569652261295e-01   +4.376280195541263e-01   +9.861957929715827e-01   +5.604056037777986e-01   +9.949492465357983e-01   +5.424271446490269e-01   +6.535249976263384e-02   +4.666773683205945e-01   +4.615377314902573e-01   +3.342452124370762e-01   +6.266154678559753e-01   +6.367079922040070e-01; +8.505454901320804e-01   +7.821492420612691e-01   +1.588422203136393e-01   +9.324981907728583e-01   +6.517829861700094e-01   +3.133554087058811e-02   +2.750413769290563e-01   +3.245455457895164e-01   +4.508888895686942e-01   +5.899678081694688e-02   +5.397129040959091e-01   +6.508493021732727e-01; +2.764953613727215e-01   +1.493469927638034e-01   +2.372317208577683e-01   +7.204786623863757e-01   +1.072052664137374e-01   +6.956341765793037e-01   +2.815516522549586e-01   +6.308322316915598e-01   +5.507360787337563e-01   +7.404433980642731e-01   +6.502084635251587e-01   +8.629816462612390e-01; +6.224321141596471e-01   +6.201457687558215e-01   +7.018667026948954e-01   +4.849074044064953e-01   +3.733016723559583e-02   +5.200091919273330e-01   +8.790299373956312e-01   +2.293930219393392e-01   +8.063887663390850e-01   +5.058978619571204e-01   +7.261593363067130e-01   +5.651383027704619e-02; +5.897751056157801e-01   +2.602157411349956e-01   +3.774213223954289e-01   +6.394555634703085e-01   +6.190487769235481e-01   +6.032073508110158e-02   +4.447131273703475e-01   +5.802249427236518e-01   +7.012340858926651e-01   +2.014552699697820e-01   +9.405615058367631e-02   +8.187597525187559e-01; +9.641843623042450e-01   +4.448291737434568e-01   +9.749102999221145e-01   +8.874197286114428e-01   +5.656125861956013e-01   +8.891113130725666e-01   +7.578406400918143e-01   +6.039395902704349e-01   +8.725168565288713e-01   +4.265684487658858e-01   +8.786917253264799e-01   +5.289529790959893e-01; +8.686579575221480e-02   +8.448782218044043e-01   +9.707038492812943e-01   +1.975214492313690e-01   +9.620208962301107e-01   +3.304168163914627e-01   +6.016696958898889e-01   +5.995266515014033e-01   +5.225070910016957e-02   +1.678844084264206e-01   +1.253077161149452e-02   +6.953184040851546e-01; +5.012977608822292e-01   +1.980544714166076e-01   +6.421984365891621e-01   +3.962695425612691e-01   +7.473984071436813e-01   +2.285622107087141e-01   +7.830234184740119e-01   +4.480452904475691e-01   +2.191246633437093e-01   +7.514891890504914e-01   +2.922437930136529e-01   +2.122789951382110e-01; +5.217465393059185e-01   +3.031811216940447e-01   +8.600878344979511e-01   +9.920068641798344e-01   +6.628732464461160e-01   +1.139534237547279e-01   +1.143113768075404e-01   +3.385086252788182e-02   +4.587533409152576e-01   +3.669707137902231e-01   +1.795192741030502e-01   +5.438256255106142e-01; +9.066125120557363e-02   +4.803402225040267e-01   +4.016989165095773e-01   +4.011462443832912e-01   +5.239191354677666e-01   +3.118927457061789e-01   +9.775116839683100e-01   +5.126910243358086e-01   +9.588584618537852e-01   +9.421301509244568e-01   +9.265541568047090e-01   +7.041180439944557e-01; +9.066016817817066e-01   +3.372782942471271e-01   +6.314539350591546e-01   +6.592881584133092e-01   +2.594084513412631e-01   +2.270158829111502e-01   +8.489880244756647e-01   +4.068064447531943e-01   +7.920961451436563e-01   +1.555030451423636e-02   +6.892578540318850e-02   +9.552895408497671e-01];
L2E_Input1_iAMPA_netcon = [+9.968794543802654e-01   +9.999938890031279e-01   +9.982429240924477e-01   +9.990811698387583e-01   +9.968892908850646e-01   +9.967353668107316e-01   +9.978882834573433e-01   +9.965038903097310e-01];
L2I_Input2_iAMPA_netcon = [+9.986045305298247e-01   +9.983497841985350e-01   +9.987353627523481e-01   +9.991631266564363e-01   +9.985175210384207e-01   +9.974156727403672e-01   +9.999284946329680e-01   +9.979933946124860e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
