function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.365440332693573e-01   -7.274995407788795e-01   +5.016743646222791e-01   +7.781077186742767e-02   -3.475850950628239e-01   -3.945211910307402e-01   +3.050366252117133e-01   +6.255176091797996e-01   +4.233701076837541e-02   +1.825775001088970e-01   +2.464077028074799e-01   +3.408817187258452e-01   +1.397257874758957e-01   -5.926178036181341e-02   +3.544577659884521e-02   -1.249007338157953e-01; -5.491138411709148e-01   +1.761252127972436e-01   -5.480374395169323e-01   +6.081109905098155e-01   +4.236773154621691e-01   -4.896836504119943e-01   +1.952333722411761e-01   +9.725835440696018e-02   -6.658061469663096e-01   +5.981526192723312e-01   -2.726800384981059e-01   +9.210001542204351e-01   -5.620976952474227e-01   -2.356634516030044e-01   +2.798277768399968e-01   +4.030039880676212e-01; -4.271207648821238e-01   -4.484464594016395e-01   -1.437514477742157e-01   +5.116463777429789e-01   -5.528296329462922e-01   +1.343259173620814e-02   -3.513197922254443e-01   +2.596482656590277e-02   -2.055025181281716e-01   -1.636513948602839e-01   -1.715262589352190e-01   +1.516839928196797e-01   -6.488316100378646e-01   -3.878385039996827e-01   +3.485727481443972e-01   -2.286487652956604e-01; -6.152187139920355e-01   +6.162916266340186e-01   +4.943172671024778e-01   +7.248637017776176e-01   -3.684856063413685e-02   -3.598362402911250e-01   +2.852863678022038e-01   -2.667518331674230e-01   +6.757102882355565e-01   -4.891110295373615e-01   -3.063565580920261e-01   +5.388377766234105e-01   -2.811192423318510e-01   -5.136344729665114e-01   -2.521986300871986e-01   +7.470242090521214e-01; +5.803339084234478e-01   +6.252002687518436e-01   +7.708242292772863e-01   +5.882086928272727e-01   +2.177670636678660e-01   -1.620081243111476e-01   +2.657803295544233e-01   +6.798342964307971e-01   -1.836584183208893e-01   +8.284807554854513e-01   +6.533782210064095e-01   -3.985211867740243e-01   +5.136959351125530e-02   -7.834278290248530e-01   -1.424299966685725e-01   +9.322002404401396e-01; +8.968458964786608e-01   -1.484643818432743e-01   -3.724947014509112e-01   +7.757201965703977e-01   +7.258273850371326e-01   +2.436502442311965e-01   +3.270739364442083e-01   -8.533249025773743e-01   +5.390887021638926e-01   +3.143662781436701e-01   -1.018620655078799e-01   -6.666296268502006e-01   +9.403255903186863e-01   +1.794634310488535e-03   +6.266651759321316e-02   +6.142072221996475e-01; -5.443058288765827e-01   +1.075419156977980e-01   -2.789317652049416e-01   +6.600582891040871e-01   +7.979462889507229e-01   -1.649615049925659e-01   +7.412540900572180e-01   +9.149731027552941e-01   -2.489264768138433e-01   +1.431872752533674e-02   +6.246431725840496e-01   -6.530860337385096e-01   +1.210908962810314e-01   -4.978016385988601e-01   +4.178848956291557e-01   -4.927819339974988e-01; -3.326597995059112e-01   +5.767095834932150e-01   -8.090215660774670e-02   +9.348767742615070e-02   +5.120098395113092e-01   -4.377809101886571e-01   +6.657737974959365e-01   +7.609096536454114e-01   +3.037983953347070e-01   -2.615243708365650e-01   -2.971793187092104e-01   +1.659601559710361e-01   +9.180242935938265e-01   +8.118875317118954e-01   +5.519740141114592e-02   +5.747203169985342e-02; +3.997660327923446e-01   +5.059976418478608e-01   -7.018085861635824e-01   +4.097728170735727e-01   +2.133995349768286e-01   +2.571300125844836e-01   +1.532666403462588e-01   -3.036534337131434e-01   +3.651929661743666e-02   +1.363537387924931e-01   +3.184397393092999e-01   +4.272602547167042e-02   +5.985632435949994e-01   -6.458418429292219e-01   -7.342290749659468e-01   +7.365117984659875e-01; +1.759363632404315e-01   +3.138644892168281e-02   -5.982084037231874e-01   +2.143280883239101e-01   -3.811745890547475e-01   -7.965488516808288e-01   -2.581692580781406e-01   -6.023159152623742e-01   +3.202591023709692e-01   +6.284902164959703e-01   -1.379696961151259e-02   -1.100910745281986e-02   -1.147095739111210e-01   -2.460949894898481e-01   +1.518869904736307e-01   +1.190095907365353e-01; +5.591006919886905e-01   -5.995115691988067e-01   +2.433956795295669e-01   +3.694505317094177e-01   +6.029764857722318e-01   +1.857641924384948e-01   -6.054058804899503e-01   -4.057982215741641e-01   +4.396385439738216e-01   -2.893622848743576e-01   -3.975642267490222e-01   +1.112870479292013e-01   +6.057637545613435e-01   -1.508867101515846e-01   -1.164130749074296e-02   -2.632482701054479e-02; -2.643201425524253e-01   -6.060708593306710e-01   -3.026212971972829e-01   -1.322622138691746e-01   +8.513238293779808e-01   +1.783720998584939e-01   +3.901483884439517e-01   -6.737061387142416e-01   -1.521844873507077e-01   +3.249609352986358e-01   +6.668037959739803e-02   +4.252246121064196e-01   +6.745380579798087e-01   +7.341827957581605e-01   +5.307401810330845e-01   +2.879438177295336e-01; -3.415046809750105e-01   +5.564849132962831e-01   -5.024103802801867e-01   -4.486197861972248e-01   -5.558258205049579e-01   +9.290642751835342e-01   +6.740997177841008e-01   +3.164221141396458e-01   +5.257898226610718e-01   +1.826762048983113e-01   -6.418915254830780e-02   +4.893279680924690e-01   +5.157065302448294e-01   -5.655803573726828e-01   +7.201027256067868e-01   +1.993914079532010e-01; +4.668211563027715e-01   +7.787709554304174e-01   -3.866964216536548e-01   +5.192879133349477e-02   -2.092240297227169e-01   +5.106633824818259e-01   -4.199174098024004e-01   +2.349781822407540e-01   +7.053147996442033e-01   +3.111898919106896e-01   +8.413296681260930e-01   -4.127744133442050e-02   +3.122303907108502e-01   +1.473833469806047e-01   +6.675576687741119e-01   -6.646591869224362e-01; +3.696647950457851e-01   +7.275150968801465e-01   +6.245345869184384e-01   -1.537379915737017e-02   -2.300738338939220e-01   +5.132414399624841e-01   -7.833140187911777e-02   +3.178892781017744e-01   +9.046566617902194e-01   -4.528506067864316e-01   +2.973014970100207e-01   -4.641081323870367e-01   +1.000000000000000e+00   +5.441175644787499e-01   -2.421379545166071e-01   -1.020290400326905e-01; +2.001882627008264e-01   +2.772981165115417e-01   +8.370371290667239e-02   -3.632412816581851e-01   -6.170250419471659e-01   -4.984824714019503e-01   -2.338463930474487e-01   +5.266554425826114e-01   +7.766096203824487e-01   -3.230132828977014e-01   +5.910690980869887e-01   +1.037428331285230e-01   +1.844513066708195e-01   +4.492661785947980e-01   +5.556096630062413e-01   -8.089525937821205e-01];
L1E_L1I_iGABA_netcon = [-3.298946521953857e-01   +3.480519670792191e-01   +5.565805944322172e-01   -3.104598044897374e-01   +6.717209989801278e-01   +3.702476736911665e-01   +1.118879978798846e-02   +8.121178693016673e-01   -2.070520986296221e-01   -3.840028134448338e-01   -3.333591289929160e-01   -1.550629855247359e-01   +6.175364060220945e-01   +7.670093399990881e-02   +3.644040417624241e-01   -5.670644615916094e-01; +1.747113734907041e-01   -4.014555159304169e-01   -5.817251303583577e-01   -4.257570120577199e-01   +3.158665612562047e-01   +8.329663256193474e-01   -5.825384314708116e-01   -2.111894961194556e-01   +5.599506377625303e-01   -4.165043482845003e-01   -3.942207913033202e-01   +1.263787820327940e-01   +4.167194414924196e-01   +5.491322001208389e-01   +3.297051506778886e-01   +1.000000000000000e+00; -7.478344085717956e-01   -6.763701925085343e-02   +4.879424420856946e-01   -5.277130343214614e-01   +3.884032357575494e-01   -1.677587727547822e-01   +4.766174874870112e-01   +8.900470907160368e-01   +2.033399956680722e-02   -7.600821119948515e-01   -1.370852737372203e-01   -2.689036298405379e-02   +5.902926701305746e-01   +1.455410823816371e-01   -2.247783786931744e-01   +1.098428010321477e-01; -1.372904360950755e-01   +6.230083187133877e-01   +1.642221400691109e-01   -5.337486219516134e-01   +5.341985173579895e-01   -6.432871603035294e-01   +5.876569419839213e-01   +3.017884598256270e-01   -3.175844402721774e-01   -1.194977183785566e-01   +3.359622483533625e-01   +7.317474308776480e-01   -2.913804885185730e-01   -2.209205660700316e-01   -4.064201941078964e-01   -5.841420344775956e-02; +2.463508679117326e-01   -5.282028028335829e-02   -1.793761773042285e-01   +2.712004000832823e-01   -6.438142262603240e-02   -1.990163792587200e-02   -6.368606759864123e-02   +2.154169968704585e-01   -5.781424495612772e-01   +5.580983538216547e-01   +1.839752639911389e-01   -1.990604446116006e-01   -9.699697128435560e-02   -2.361410466186295e-01   -3.924402106121635e-01   +5.841793770325608e-01; -6.712091931943491e-02   +3.277426774157387e-01   -3.137409473793604e-01   +7.339347822545446e-02   +3.914426926941349e-01   +2.950363559024843e-02   +1.464302245758377e-01   +3.660474227556176e-01   +6.307354206038238e-01   +4.698671855719639e-01   +4.173156905007998e-01   +3.837299587763370e-01   +4.179229523812524e-01   +1.709181593854631e-01   +2.391887140789659e-01   -3.141096881096956e-01; +1.163159297599702e-01   -2.440659864394472e-01   -2.703412245620296e-01   -1.154048886405255e-01   +2.771349509729807e-01   -5.797953470746950e-01   -6.597536749117137e-02   +4.193425535022109e-01   -4.333516627587562e-02   +3.644065233047584e-01   -2.137988144566374e-02   +6.350683861880737e-01   +3.357580663931727e-01   -2.138840643276262e-01   +6.397997419356283e-02   +7.829034528075085e-01; -6.033503199660873e-01   -4.109970816932806e-01   -6.050676096933664e-01   +2.627603773578789e-01   +2.318771352331255e-01   +2.239018640372584e-01   -3.823567743807444e-01   +2.603451266346131e-01   -5.182017403381566e-01   -2.287127258254026e-02   +6.275435721352013e-01   -9.123164184911346e-02   +3.860341187757773e-01   -4.003371073412317e-02   +4.990568701976105e-01   +7.782417692562381e-01; -6.467752638620071e-01   -2.871582819594742e-01   -7.770392689544439e-01   -3.891846651972637e-01   -3.966601465886075e-01   +9.047379178960031e-02   +1.012883732148002e-01   +3.444984685679626e-01   -2.462052663860087e-01   +3.875556743163344e-01   +2.861170637968667e-01   -1.966691120585942e-01   -3.967390803166991e-01   -4.448841387758576e-01   -3.836044545568966e-01   -2.460114070664396e-01; +2.557194249198276e-01   -2.788987401646838e-01   -4.645214657588012e-01   +2.171882742324271e-01   +4.109390442163767e-01   +3.677299681422391e-01   +7.058688444261152e-01   -1.044138659733388e-01   +4.261289274765749e-02   +1.061182632735160e-01   +6.056563071193878e-01   +9.552985239445548e-02   +2.007798785995677e-01   +1.241422228057014e-01   +5.436508763294359e-01   +3.522187095884727e-01; -2.843395482381313e-01   +4.349003027330222e-01   -7.538699725345405e-02   +1.362572405190816e-01   -1.988937961251950e-04   +4.276327950567400e-01   -4.866201700871875e-01   -3.051067325091600e-01   +3.603094619141347e-01   -5.150539389456998e-01   -4.097290300506745e-02   +3.727705701368779e-02   +1.373316887173310e-01   -4.557970165230630e-01   +3.747707908256274e-01   -1.829693436644406e-02; -6.050246895598884e-01   -1.071591575564719e-01   -5.259436753188416e-01   +1.140531986768115e-01   -7.331404108348562e-03   -5.734741167379531e-01   +2.853683561040106e-01   +3.555635709858316e-01   -4.272809898190264e-01   -5.054976127837676e-01   -3.822151259824620e-01   +7.895395899441612e-01   -1.991254684069085e-01   +4.436685207368817e-01   -1.713339128614614e-01   -1.903157020011884e-02; +3.163632995761023e-01   +6.433508913511949e-01   -1.348239182103663e-02   -3.863621915793962e-01   +7.619892801179594e-02   -7.216017257392711e-01   +1.835864386778408e-01   +3.758654052974567e-01   -5.007826647154144e-01   -3.450533121576992e-01   +3.483941565983408e-01   +6.070628793909660e-01   +5.919798460722011e-02   -3.152243770141299e-01   +3.530601131344634e-01   -1.002789749140644e-01; -6.754132102176637e-02   -5.665482367624892e-01   +3.806902815658781e-01   +3.592189777582695e-01   -9.257484838460443e-02   +6.106141900711951e-01   -5.796992898524296e-01   +5.943129492558338e-01   -1.710004285810744e-01   -2.983409156588135e-01   -1.219922085930129e-03   +7.936687560264336e-01   +2.609951995305027e-01   +1.409689409996020e-01   -6.919129741140911e-01   +6.269841244705082e-02; -2.978664851532322e-01   +7.039783345166022e-01   +7.773055690147941e-01   +6.787979503428938e-01   +1.326770945953818e-01   +2.337989527569738e-01   -3.640458289625631e-01   +1.956974693337256e-01   +5.452412700514164e-01   -1.846967882557080e-01   -6.145115270355207e-01   -4.034550647210816e-01   +2.615637989425031e-01   +3.465812998059326e-02   +2.754739175393938e-01   -5.842979858826627e-01; -3.663026000149183e-01   -2.857514885874109e-01   -5.908861511514524e-01   -2.438939000989571e-01   +6.244339204016555e-01   -3.845947414392881e-01   -4.425143278105865e-01   -2.564854674542363e-01   +2.836975130237154e-01   -5.759490932643720e-01   +5.597166827515768e-01   -6.683257387167317e-02   -9.675718691947605e-02   +7.958661936582012e-02   +4.719728821127326e-01   +6.087930131991879e-01];
L2I_L1I_iGABA_netcon = [+3.323242637365342e-01   -3.307621814751860e-01   +1.174909540158789e-01   -7.290689591434503e-02   +4.744335972655842e-01   +1.506513968255675e-01   +4.791628138949816e-01   -2.963023665271241e-01; +3.343622317684844e-01   -3.160330751218502e-01   +2.429548900980291e-01   +3.876029531831227e-01   +9.098292731266465e-01   +7.771085861613714e-01   +2.973851144577215e-02   -3.394151913791618e-02; -3.640539597153235e-02   +1.493246932166474e-01   -5.983724657143887e-01   -1.221040373581707e-01   -6.669855288875929e-03   +2.014694846076733e-01   +3.583654917576555e-01   -2.249080362213568e-01; -5.319426708995761e-01   +5.741723467939329e-01   +6.436702095887866e-01   +3.155627060746994e-01   -5.183639604118587e-01   +3.350707773709380e-01   -4.321474701971376e-01   -3.975879769975396e-01; -5.807423874848380e-01   +4.984371431821502e-01   -5.972340385262106e-02   +2.016201792376343e-01   -5.447109865661008e-01   +7.464090152884946e-01   -4.747294251623074e-02   +3.055317871738095e-02; -3.718057114211930e-01   +1.032051629510310e-01   -1.275992292645464e-01   +5.493939918013805e-01   +5.630212026010507e-01   +2.882038758567489e-01   -5.362767337530666e-01   -4.994288419422209e-01; +4.007710693317435e-01   -2.472875222542707e-01   -2.635253975577027e-01   +7.551415635560307e-02   -3.068737110756123e-02   +1.607315450899505e-01   +2.568037058159004e-01   +8.910186125941504e-01; -3.329287370137947e-01   -6.925486678148339e-01   +3.359273951684004e-01   +5.526815742531335e-01   -2.888756288928812e-01   +1.307316174022787e-01   +2.609028147773046e-01   -6.170936716908971e-01; +2.484539053779746e-01   -1.432582475866649e-01   +6.014497759504676e-01   +1.348175226651434e-01   +1.000000000000000e+00   -2.749332837102229e-01   -8.322921030033273e-03   +6.261056284461196e-01; +5.592879908061135e-01   -1.278797710180704e-01   +5.941075302770807e-01   +1.106327709937041e-01   -1.602134788022956e-01   +2.152167539532812e-01   -9.401839036988349e-02   -2.639066816452280e-01; +4.251338274353888e-02   -2.719083833159988e-01   +3.951257093095578e-01   +5.514888951314891e-01   -6.212812299589292e-01   -7.017406923108957e-02   -1.087031208871530e-02   -3.636927805092218e-01; -1.852743079419961e-01   +6.061217903990309e-01   +4.585016042971836e-01   +3.777346666064787e-02   +2.975184646370317e-01   +5.042832270587079e-01   +4.144222530912340e-01   +4.763813279060966e-01; +4.379670188118404e-01   -3.262696088976901e-01   +3.851876849338207e-01   -6.693558620223227e-01   -6.643021734072041e-01   -1.431679389137726e-01   -5.077344010577450e-01   +3.161256015052947e-01; +2.959758816082896e-01   +5.886347237834759e-01   -3.768452309693064e-01   -4.551824912794226e-01   +8.569645379766849e-01   +3.976520358304186e-01   -3.913337747424840e-01   +5.548776500450182e-02; +6.234608549136407e-02   -1.026023368549713e-01   +1.232029663151656e-01   +1.595315240680342e-01   -3.180065195184725e-01   -2.355455270888603e-01   -1.582593371254369e-01   -3.156276648038074e-01; -4.493163137214418e-01   -8.278427038080625e-02   +1.870068213305034e-02   -4.742452414930586e-01   +2.690196833841573e-01   +2.175245487551157e-01   -5.221175858806542e-01   +1.790375739551526e-01];
L1I_L2I_iGABA_netcon = [-1.674567867357812e-01   -3.740653440527773e-01   +4.516493316165881e-01   +4.936692390711738e-01   -2.342226117354047e-01   -6.338714348142546e-02   +4.102978393162313e-01   +3.874921062300017e-02   +4.896191982676650e-01   +6.979701003371429e-01   -1.644410941565263e-01   -4.073573999968565e-01   +6.873357278920897e-01   +2.798005903607133e-01   -2.140242692351717e-01   +1.000000000000000e+00; +4.319238382353710e-01   +7.614191621655945e-01   -9.040990866593551e-02   +9.220443957814612e-01   -5.965936260872398e-01   +7.230696576904244e-01   -1.611152323762548e-02   +7.616094883703302e-01   -6.371323602361448e-01   +2.350752034890381e-01   +6.407042395475500e-01   +7.622736769901249e-03   -5.390177717183788e-01   +1.909566338397939e-01   -3.777738854410589e-01   +3.383601314578777e-01; +3.090420793068645e-01   +5.638047770250647e-01   +6.865081704036013e-01   +2.660142152576335e-01   +6.512762991170492e-01   +5.602729107716301e-01   +2.840509202700009e-01   +5.215811681500058e-01   -2.338066229352120e-01   +1.424431782716172e-01   +4.178491827778782e-01   -4.897324360157398e-01   +3.910529185168370e-01   -7.059806444696128e-01   -7.304890533116840e-01   -2.871908365970964e-01; +3.391482543116208e-01   -1.410046304473052e-01   -7.504861585237765e-01   -4.388549928919531e-01   -1.753865425506191e-01   -3.931694403816902e-01   +3.666453986124958e-01   -1.667832943539637e-02   +2.329353246002068e-01   -3.630169132056471e-01   +5.361438561565106e-01   -3.891936689381613e-01   -1.740006564375153e-03   +5.835267936226173e-01   +1.299302256096418e-01   -4.885643836797540e-01; -4.615115945688746e-02   +4.724752996790256e-01   -5.810347303351496e-01   -7.068793101098157e-02   +3.787109655143511e-01   -2.902347044197041e-01   -1.384347809991278e-02   +2.308541057490064e-01   +4.549614418965366e-02   -2.691751183853686e-01   +1.491766087964678e-01   +5.676733219232687e-01   -7.621939911947762e-01   +4.396802870770336e-02   +1.403262664233721e-01   -1.197130643214805e-02; +5.206455826542155e-01   -1.874844271912269e-01   +1.930172878243915e-01   +7.486951302265129e-01   -3.111956554151091e-01   -4.506688143079245e-01   +3.783769088104946e-01   +1.163359931149893e-01   -1.640852232620996e-01   -9.917842640969640e-02   +1.331681471461148e-01   +3.967187187524150e-01   -2.733540388055125e-01   -2.546685012058787e-01   +3.275363819863210e-01   -4.613445718748508e-01; -6.201599926238393e-01   +1.135424853004174e-01   -6.295024424497010e-01   -1.163479022781917e-01   -1.444341827294320e-01   +4.106863633226946e-01   -3.111263092053965e-01   -4.501097292763158e-01   +6.019461723437782e-01   -4.737594185381103e-01   -3.419598704699055e-01   -3.654115987066159e-01   -8.377314356323262e-02   -1.576717023579843e-01   -2.124579384551266e-01   -2.623926260871959e-02; +1.900632881405045e-01   +5.367725586704784e-01   -5.737636516143252e-01   -2.321076375737129e-01   +3.960880732480378e-01   -1.473568349931118e-01   +9.913150566895006e-01   +5.651119549936441e-01   -3.337844640480750e-01   +2.803615641502137e-02   +3.141603364761055e-01   +4.465677282592958e-01   -6.952802735649137e-02   -3.188839295745040e-01   -3.446104403501219e-01   -2.276284718214751e-01];
L2E_L1E_iAMPA_netcon = [-3.364376525787930e-01   +7.684821663684628e-01   -5.241251261284675e-02   +1.491835853991593e-01   +8.092155648612613e-01   +4.777152797258357e-01   -5.745601994455354e-01   +5.580491881639379e-01; -5.457818485955648e-01   +8.507022427338912e-01   -5.226268114123348e-02   -3.861965591587240e-01   +1.000000000000000e+00   +2.943918765604250e-01   -2.067422576145769e-01   -7.965908957394169e-02; +3.489376315950929e-01   +9.240979848122029e-02   +3.562995642286137e-01   +2.419393228582186e-01   -4.171009170779511e-01   +1.577133095922688e-01   -4.128347504381321e-01   +1.354823439124676e-01; +6.956827370233344e-01   -1.343918254071379e-01   +2.651810445049148e-01   -1.600011354285017e-01   +7.732015888278131e-02   +8.020477662968513e-01   +2.093253781345492e-01   +3.598593944423062e-01; -6.046902287707975e-01   +9.061890502495629e-01   +3.219890746655171e-01   -3.022442361442079e-02   +3.098552252553485e-01   -3.842551525718209e-01   +3.055130222001187e-01   +2.529047568822138e-01; +2.199010142701308e-01   +1.242376000850479e-03   +4.876458698441286e-01   +2.037768083668843e-01   -4.332774182720555e-01   -7.603424964322185e-01   +6.876988791124238e-01   -3.277204874343791e-01; +8.309782278120883e-01   -3.639793612441401e-01   -9.129868779776003e-01   -6.090296526137486e-01   +4.397067555130337e-01   -7.381132750470569e-02   -5.558135385900401e-02   +6.024714287463513e-01; +5.100320901436499e-01   -1.684203126593797e-02   +4.333843605425768e-01   -4.485605286285544e-01   -1.643093625034004e-01   -4.562809470190018e-01   +5.749098259466441e-01   -7.133875379612178e-01; +1.661024064562219e-01   -3.403530217330970e-01   +5.082482594572117e-01   -2.000547145896491e-01   -4.792478600701876e-01   +1.261184968788258e-01   +3.159357136240707e-01   +1.952146960821121e-02; +8.199834285722203e-01   +1.246538465158173e-01   +2.641050771731445e-01   -3.865716008595461e-01   -6.689628092273175e-01   -5.826357005530935e-02   +7.849031359385216e-01   +4.400214193792931e-02; +3.444528792890860e-01   -7.922759448769096e-02   +2.573750453686541e-01   +7.854033694231830e-01   +3.363285644233642e-01   +1.489225475638538e-01   -5.512418192514174e-01   +6.251419690367606e-02; +5.296935392360647e-02   -4.352848345761886e-01   -4.262916432127588e-01   -3.364602825968347e-01   +4.744806733314881e-01   -8.098463532824183e-01   -4.448171344706770e-01   -1.896455404154231e-01; -5.897624733411646e-01   +2.317392936186907e-01   +6.672196049868876e-01   +2.416058153802536e-01   +6.346190479623761e-01   -1.889379318801230e-01   +3.163359725602512e-01   +3.126497464993150e-01; +4.893838248394078e-01   -1.700690182187853e-01   -5.309677472705900e-01   +4.502281953951449e-01   -5.211079256027440e-01   -1.637339816776903e-01   +2.962274902319483e-01   -2.082064680263445e-01; -6.318331769751647e-01   +3.547987217556796e-01   -7.698077196652316e-02   +3.841646722795815e-01   -4.811002681467058e-01   +1.899796808930267e-01   +4.296992530558483e-02   -5.497677623090887e-01; -8.793363767183023e-02   -2.010977318593906e-02   -3.649479526563900e-01   -1.456238498762638e-01   +1.596116883453892e-01   -4.194939461640316e-01   +5.857657196904746e-01   +4.957991150914369e-01];
L1E_L2E_iAMPA_netcon = [+2.342902406340191e-02   +9.007545093344335e-01   +6.208790987666705e-01   -6.530034921695635e-01   -6.842231287829313e-01   -1.992858944611741e-01   -1.426627131669147e-01   -2.213023868450011e-01   -1.741033151197884e-01   +2.190119304506952e-01   +5.802703575657279e-01   -6.786712474422421e-01   +9.375249571209715e-01   +6.067392518738561e-01   +3.697636743682443e-01   -3.596904499483769e-01; +3.993522461767045e-01   -3.553631571725484e-02   +1.191706621123041e-01   +2.363725885365582e-01   -1.167532185650664e-01   -3.634958456049559e-01   -3.693708241453252e-01   -8.062964411269449e-04   +2.866051722694053e-02   -4.110585779788706e-01   -3.722851170011955e-01   +2.419707377084519e-01   -3.901751461628747e-01   +5.223280814324052e-01   -3.343965693276401e-01   +3.125160507574108e-02; -5.949435626044607e-01   +6.675256879525916e-01   -3.989697708551173e-01   -4.863297653846425e-01   -5.865117745617761e-01   +1.808501168147350e-01   -6.211808173435756e-02   +7.512107081607673e-01   -6.778155564675880e-01   -2.799982383151746e-01   +4.527116712680523e-01   +1.937491674302235e-01   +4.741508515892734e-01   +1.287378303196792e-01   +5.490810880286919e-01   +7.371552051836733e-01; -5.457905309120182e-01   -1.225537000996251e-01   -6.767755904673898e-01   +6.115023484369499e-01   -8.325881108904364e-01   +2.482552648125999e-01   -2.418157388817320e-01   -4.072934362829834e-01   +3.143702999635489e-01   +6.534199701589264e-01   +4.161567985205500e-01   -2.304479694166254e-02   +1.951566870670296e-01   +7.370179845880154e-03   -2.197223903044451e-01   +6.945399570682147e-01; +5.065722171722279e-01   +4.936717810245919e-01   -3.650740828388760e-02   -2.153265046193082e-01   +5.960717640280937e-01   +1.000000000000000e+00   +4.263476433389541e-01   -1.190509092012589e-02   +5.813537651130255e-02   +3.705827805205886e-01   +3.830218518137901e-01   -2.948230241201703e-01   -2.743362295044465e-02   -5.769931490696870e-01   -6.305941681885194e-01   -1.212753790371444e-01; +4.850713993656569e-01   +5.913462867501644e-01   +3.241865475833552e-01   +5.609875433824523e-01   +5.015408587322578e-01   +6.200783640040726e-01   +2.024679095053009e-01   -5.284673479285541e-02   -6.639012438136727e-01   -4.097567430928029e-01   +9.109054665953856e-01   +4.651105431242814e-01   -1.406551256194434e-01   -7.909230253070774e-01   +8.853875766536176e-01   -6.627716261887699e-01; -1.660694976074214e-01   -4.930199923964447e-01   -4.592976976117964e-01   -2.376661425692292e-01   +4.776117045051769e-01   -2.136204239229170e-01   -6.753264612314784e-02   +6.929504071001867e-01   -3.242315557984491e-01   -6.712009976308480e-01   +6.953748927477253e-02   +7.424367408577459e-01   +3.687531270696437e-01   +2.838011825952226e-01   +9.594832331518538e-01   +4.079594278989030e-01; +2.494294140108726e-01   -6.244720632662530e-01   -5.125614552336275e-02   -1.660204336379781e-01   +5.343024753608319e-01   +6.841579493006318e-01   +7.648856054131296e-01   +1.300822755892643e-01   -2.162736203548631e-01   -1.182681107069875e-02   -2.146461447256820e-01   -3.212194481376005e-01   +4.233246763501957e-01   -4.440354239548380e-01   +4.530630475675042e-01   +3.183049971441908e-01];
L2I_L2E_iAMPA_netcon = [-4.273727688398109e-01   +5.933673287916333e-01   +5.744870306369734e-01   +6.725325561555873e-01   -3.748518556142615e-01   +5.358031157260469e-01   +1.986513944768175e-01   +6.631408969312960e-01; +1.638442423734474e-01   +6.631215362669590e-01   +5.155204723768859e-02   +7.962343291780702e-01   +1.427440017354062e-01   +2.160401954395943e-01   +5.033167921106426e-01   +3.475441531212630e-01; -5.317699265845972e-01   -1.372155974829681e-01   +5.287103639351820e-01   +1.903808325342339e-01   -8.496535264956052e-01   +3.872703438047950e-01   +3.054963208284446e-01   +4.972012342039810e-01; +4.225547324940836e-02   +1.000000000000000e+00   +5.387110861963349e-01   +5.764684700038141e-01   -3.819205175987887e-01   -3.433724430590287e-03   -1.911419185896362e-01   +2.649348595097405e-01; +1.098062991482677e-02   -4.360959196070108e-01   +3.369177339749034e-01   +4.967534088885063e-01   -6.009139540537330e-01   -4.467003697890145e-01   -9.097650094652918e-02   +5.789668515976626e-01; -6.795085559072793e-02   +3.165521980799889e-01   -1.170472393357328e-01   -1.137110168295179e-01   +4.441078240551850e-01   +2.460435887611696e-01   -2.579009783192234e-01   -9.547270010482775e-02; +9.474147654258328e-02   -7.104706730369535e-02   +9.604656430142118e-02   +4.492670783376516e-01   -1.831419367566212e-01   -1.442649410730982e-01   +5.723751030688261e-01   -3.981820184755169e-01; +3.142854653315518e-01   +1.515001933696990e-01   +7.088194716140203e-01   -1.994148771931936e-01   -6.838443011351357e-01   +2.359242295866864e-02   +3.646461471506706e-01   -1.855582151538759e-01];
L2E_L2I_iGABA_netcon = [+2.403721702467922e-01   -6.315865120963512e-03   -1.838964324459728e-01   +5.487659565127475e-01   +4.174522105980398e-01   -7.476835056380614e-01   +4.608447386804098e-01   -2.210869761650250e-01; -1.746564435873084e-01   +6.535639362358304e-01   -6.492685487110926e-02   +1.788981877858610e-01   +7.481918477775711e-02   -1.279827155252223e-01   -5.156988259588973e-01   +5.586352613505476e-01; -6.913972944685206e-01   +3.401232072189448e-01   +4.733800132695066e-01   +4.607469979875966e-01   +2.069797951332205e-01   +4.070737333751711e-01   +3.264455011006721e-01   +3.406535062003850e-01; -1.979701494424636e-01   +1.186742886901337e-01   -4.876076934990231e-01   -2.692709023144559e-01   +2.992560630895961e-01   -4.627365010087143e-01   +2.318079825316245e-02   +4.621976719765116e-01; -3.410948160989650e-01   +3.047388793611513e-01   +1.648132618266240e-01   -1.667815759872820e-01   +3.417723812340290e-01   +8.044988556061284e-01   -1.550187687602596e-01   +2.145051231002470e-01; +5.093016465739022e-01   +2.293013051763124e-01   +1.946013822403599e-01   -1.624892717017187e-01   +5.888149973541155e-01   -3.657262266856141e-02   +3.821241607147026e-01   +1.000000000000000e+00; +6.741908879039572e-01   -2.172386366933787e-02   +6.437338886412488e-01   -8.769836244476713e-03   -1.504496563100098e-01   +1.472417389144686e-02   +3.233057679401473e-01   +5.602322385357336e-01; -1.087332526616113e-01   +1.844073637749719e-02   +1.797602062200218e-01   +1.128253444125995e-01   -2.548028438646294e-01   +5.794793174855644e-01   +6.911655123508693e-01   +6.080515986412570e-01];
L3E_L2E_iAMPA_netcon = [+1.169913677844774e-01   +9.156646512220080e-01   -3.543043442098861e-01   +2.736589921573687e-01   +6.460995569078508e-01   -1.312572978929701e-01   -2.338114760050948e-01   -9.809049257922740e-02   +5.886854085912450e-01   -5.569365209006851e-02   +4.037511176652214e-01   +8.619679236888557e-01; +2.923843637913776e-01   +4.440334145139406e-01   -5.666697432377750e-01   +2.821356332933098e-01   +7.207305465413943e-02   -4.242502006122752e-01   -2.570797666212465e-01   +4.368608416544082e-01   +1.421722114706824e-01   -5.446441931707182e-01   -4.588507432784008e-01   -5.315937228757706e-01; -5.589583843846730e-01   -3.972557697300739e-01   -6.092974046406832e-01   +3.171747903467494e-02   +6.832186106642361e-01   -3.521753370007230e-01   -1.101200411312201e-01   +7.502263972707120e-02   +2.049868119318259e-01   +8.671735766284860e-01   +8.217748183866261e-02   -7.953795488622596e-02; -2.268906073360029e-01   +7.597867781084884e-01   -2.229075240405430e-01   -3.358911188018656e-01   -3.307518917365998e-01   +8.552628245047521e-02   -7.972398664190481e-01   +7.679403194481974e-01   +5.132650938488356e-01   +4.363350425136064e-01   +5.115171542176029e-01   -1.630805616302584e-01; -5.592573098652466e-02   +7.946943143735888e-01   -1.982122560809415e-01   +1.000000000000000e+00   -3.421760356960973e-01   -7.985813442076710e-02   -4.958158949490381e-01   -4.030361786577075e-01   -3.170664612736123e-01   -3.818401767604191e-01   +6.607754334588152e-01   +8.855096761492636e-01; -4.304672012789400e-03   +4.133722818439488e-01   +9.546835113932118e-01   +4.627532810138722e-02   -2.294609140818675e-01   +3.515368306539957e-01   +6.591052594154327e-01   -1.542130091482160e-01   -1.392695497023395e-01   -5.659322059119644e-01   +9.008535904496978e-01   -7.184257779733733e-01; -6.430640313252960e-01   +5.615777844091728e-01   -2.650305157650924e-01   -4.517146108102015e-01   -5.312044418200881e-01   -1.711795085328431e-01   +3.424433677753969e-03   -4.825876533499619e-01   -5.949084937046908e-01   -3.215082108658522e-01   -3.968706427040870e-01   -5.674424937294338e-01; +2.086860047566736e-01   +1.827788145722374e-01   +1.584234156014279e-01   -4.469400459119499e-01   +7.911445577750029e-02   +3.325607870101109e-01   +3.515265689838104e-02   -1.738554710822320e-01   +1.787935023011751e-01   -1.119427167507344e-01   -4.925184303661983e-01   -1.835955701352363e-01];
L3I_L2I_iGABA_netcon = [-7.642846190563654e-01   +5.753918449961093e-02   -6.543451002734026e-02   +3.944577225926048e-01   -4.578476061642567e-01   -2.697233395121844e-01   +8.629883660460083e-01   -1.229279251506841e-01   +4.909771186175980e-01   +4.428048854696645e-01   +1.218649419392049e-01   -4.308729787188319e-01; -4.849164274662659e-01   -3.528600181146318e-01   -7.035049262265596e-01   -4.501338990819795e-01   +1.796675653117124e-02   -2.577146671337383e-01   +9.078423080548384e-02   -1.236256548793747e-01   -5.409088148669006e-01   -2.104100591447922e-01   +2.679148674522867e-01   +5.608939680395376e-01; -3.095722711072332e-01   -1.855506126243482e-01   +1.508429022493132e-01   +5.393509909859772e-01   +1.825858322959365e-01   -9.011810745425088e-02   -4.039648972664202e-01   -4.278883018958069e-01   +7.270619046704929e-01   +4.675425843201680e-02   -2.249901912425415e-01   -2.293806083959617e-01; +6.402699219045295e-02   +5.942589448024772e-01   -5.495698939229913e-02   -4.092871758771806e-01   -1.828036286109990e-01   -6.752948591767814e-02   +3.196456219416799e-01   +3.649446022888277e-01   -6.483027176385515e-01   +2.161941204743626e-01   -4.686933246829617e-02   -9.994327133325928e-02; -5.104000091578260e-01   +2.160660150813173e-01   +1.245771553504223e-01   +4.007163354713649e-01   -2.445890675670264e-01   +6.259476922246232e-01   -7.661135578268873e-01   +5.800166100115240e-01   +1.921679709399367e-02   +7.160288538528382e-01   -2.279858688459650e-02   -1.065948839759526e-01; -1.901437635300263e-01   -2.555430512528893e-02   -6.793497629606882e-03   +6.255120026822172e-01   +7.052110899582201e-01   +6.624815686426758e-01   -7.029199853430518e-01   -6.099257577199222e-01   -3.528671521504498e-01   +4.281037066943046e-01   -3.295007852134699e-01   +2.485821999179701e-01; +9.646431906243658e-01   +2.155870933419305e-01   -1.071110579501931e-01   -3.071311480629368e-01   +1.469642481922540e-01   +5.916272702423251e-02   -1.732580848185786e-01   +3.771884452321712e-01   -4.598076214414880e-01   -1.000000000000000e+00   +1.790378498435952e-01   +1.156615144083146e-01; -2.834026443686487e-01   -3.256007758224517e-01   +2.782852002419195e-01   +6.606615545318341e-01   -2.054214087622679e-01   +3.170953177113838e-01   +4.170404449093592e-01   +2.735047932522315e-01   +4.997386778383015e-01   +4.318312158452101e-01   -3.672198673701878e-02   -8.650358349108028e-01];
L2E_L3E_iAMPA_netcon = [-4.244003218734569e-01   -7.064320782158193e-01   +6.177921375577795e-01   +2.912855990252019e-01   -2.249861560557929e-01   +5.794784269270521e-01   +3.998261486652410e-01   -1.435958324646144e-02; +8.355156205348949e-02   -1.280154493130935e-01   -3.909816403751362e-01   -3.471247682111079e-01   +3.845473826674261e-01   -4.950482182006820e-01   -1.189689215731811e-01   +1.368798125062003e-01; -6.950185092369632e-01   -2.524887731738292e-01   -7.308728113185203e-01   +8.775082256728866e-01   +9.841803156824098e-01   +7.788681577318433e-01   -2.759822569651545e-02   +4.194423896477622e-01; +1.000000000000000e+00   +3.565380444464844e-02   +2.665821205303328e-02   +5.585629738351393e-01   +6.586617882371137e-01   -6.873110286296313e-01   -4.576178278072995e-01   -2.491412092226879e-01; +4.204655636632409e-01   +1.489845261146218e-01   +3.970861527344182e-01   +1.937718475252997e-01   +4.934468362563562e-01   +2.543763613420831e-02   -3.717660024985375e-01   -2.512853332145532e-01; +9.508156942979094e-01   +2.476424589591278e-01   +7.400441449544191e-01   +7.091277527110567e-01   -3.808246135929471e-01   -1.647028180538086e-01   -6.266506161126665e-01   -5.973424495000397e-01; +5.432772001422351e-01   -5.514643817093220e-01   -2.202832266373970e-01   +4.609010233285115e-01   -1.629552993391310e-02   -4.664312488257117e-01   +1.969022049430454e-01   +3.804204925352788e-01; +2.082927170825303e-01   +6.788286697179121e-01   -6.048512642547720e-01   -6.112657195998700e-01   +5.045708886378033e-01   -4.976572881673401e-01   +7.287766585258506e-01   -3.577448281749095e-01; +5.173610330102122e-01   +8.108130207551886e-01   +8.072575032760313e-01   +1.151580092680713e-01   -5.944963605346472e-01   +2.598047703825039e-01   -1.496527614052592e-01   -5.693732683656129e-01; -6.317119110479377e-02   +4.869420061565911e-01   -4.045721501908444e-01   -2.967552010614473e-01   +4.559518943027565e-01   -5.321118316175486e-02   -5.047210039478880e-01   -4.577445167757558e-01; +6.067537331179828e-01   -6.405027238493836e-02   -9.575435521427289e-01   +8.310745981803065e-01   +3.526433981869795e-01   +1.033218066790722e-01   -6.807808254902178e-01   -2.455015715070814e-01; +2.284687430953824e-01   +2.109844159321225e-01   -9.518896014139500e-02   +6.820082224092492e-01   +6.297268352358455e-01   +3.922613770394219e-01   -5.076150929705290e-01   +3.382673140403445e-04];
L2I_L3I_iGABA_netcon = [+3.943438861548138e-01   +5.036825908554787e-01   +2.843158725492732e-01   +2.229893689988067e-01   +7.094613433166200e-01   -1.327824267981928e-01   +8.115760734044316e-01   +6.545474410765315e-01; +1.936477466147154e-01   +6.475434170445044e-01   +5.888410712626808e-01   +5.179693601586852e-01   -5.076186923402294e-01   -4.469696185699120e-01   +2.505185460853822e-01   +4.146622153093051e-02; -3.157534656643002e-01   +1.885969830884798e-01   +6.391785646434401e-01   +4.298422576468056e-01   -2.121591392243990e-01   -5.721439720020940e-02   +4.453144576526050e-02   -1.107444794411266e-02; +3.379392281035758e-01   +5.084587025814405e-01   +1.937654916358146e-01   -3.641373538289935e-01   +1.292413975812351e-01   +2.636057686266172e-01   -2.609460520926827e-01   +1.919826659099076e-01; +1.432609457970372e-01   +3.611391159047188e-01   +1.499116127877731e-01   +6.159453277894396e-01   +3.488345511916973e-01   +3.858565500765171e-01   -2.648423259782976e-01   +1.000000000000000e+00; +7.648759347597874e-01   +1.367071231719268e-01   -2.456326602734792e-01   -3.978298090753789e-01   +3.927419472851911e-02   +2.223859377375389e-01   +2.193707559841440e-01   +1.411400874135482e-01; +1.206319566892853e-01   -1.904677350930644e-01   -6.107403321208636e-02   +5.820296101580478e-01   -5.837495420956667e-01   +3.205491397442408e-01   -3.183329393842207e-01   +3.109923260113745e-01; +5.012445555608278e-01   +3.359448502938963e-01   +1.938058187696488e-01   -1.468655300212353e-01   +1.190811814894451e-01   +1.719964596607974e-01   -2.236171271038796e-01   +2.112881261031306e-01; +2.690863914022518e-01   +7.372342331162081e-01   -2.592505248079386e-01   -2.820075155314085e-01   -2.721035203874465e-01   +3.800887512040316e-01   +3.200993835286471e-01   +3.589903609158720e-01; +4.400666952660998e-02   -2.353396447050713e-01   +4.943518336800061e-01   +2.231081154045322e-01   +2.049658283351319e-01   +1.929203025916804e-01   -8.921388584733483e-02   +5.348888474089434e-01; +5.298627782665297e-01   -4.034092735111373e-01   +9.012285408002068e-01   +2.326579141234452e-01   -1.393912711024280e-01   +6.143090582591426e-01   +4.736103136323835e-01   +6.796551381180425e-01; -4.428417504448276e-02   -4.597862100690260e-01   +5.550155308880422e-01   +4.960232419731152e-01   -2.797018046397284e-01   +2.413659568869665e-02   -3.143119593737136e-01   +2.239398273982908e-01];
L3I_L3E_iAMPA_netcon = [+5.177605173889788e-01   +4.021995883010432e-01   -7.961060370312111e-02   -1.029235553322069e-01   -1.018954214315889e-01   +2.642630661616665e-01   -4.882085854818624e-02   +7.254357072553560e-01   +8.544613985112737e-02   +6.079961311938591e-01   +6.862698548560222e-01   +7.573363669673652e-01; -5.266648782142673e-01   -1.096218886812096e-01   -2.450955771166066e-01   +3.034072793909637e-01   +3.638417674674408e-01   -2.251699015349640e-01   -3.339746588336323e-01   -8.150840069876208e-01   +4.286548766283699e-01   -2.643952794143790e-01   -3.360043998844437e-01   -6.276069603532614e-01; -7.481830671975449e-02   -1.343782997990928e-02   -2.777248881259668e-01   +4.098421414802598e-01   -2.127961892327835e-02   +3.898335187632482e-02   +3.843202915574420e-01   +1.848771082462529e-01   -2.344341849008724e-02   -5.815161845692917e-01   +3.731641594111830e-01   +6.978693903180087e-01; +7.735120297060863e-02   +5.723843086405449e-01   -6.639401282030449e-01   +4.535579513736562e-01   +2.172031485389974e-02   +3.655521390877860e-01   -3.296022789037701e-01   +6.073432311856504e-01   +8.456355262984254e-02   +4.617857245225060e-01   -3.386585930464390e-01   -1.101563665469805e-01; -5.154980238891129e-01   +1.644680956000815e-01   +5.388377323220764e-01   +6.298904200784649e-03   -1.023426811344438e-01   +5.473256262481135e-01   -6.652564516475518e-01   -3.909124687516123e-01   +5.017703428865081e-01   +8.790548570449817e-01   +8.045112773789729e-01   -1.578462272585074e-01; +6.189523221902046e-01   +6.266207623081925e-01   +4.008794068438385e-01   +1.501473916035726e-01   -4.003389470768314e-01   +1.120590158982273e-02   +9.965348373145090e-01   +1.242310828069146e-02   +5.682106574160430e-02   -7.043429397422792e-01   +6.267425735991899e-02   +6.387837685628579e-01; +6.034321634590014e-01   -1.001526596213453e-01   -2.078247815646029e-01   +3.859993720815204e-02   -4.012134018284920e-01   +3.940778457786185e-01   +1.443144854766443e-01   -1.640247143229625e-01   -6.156454656198688e-01   +6.926864334784633e-01   -6.001120607689124e-01   -3.294423982767807e-01; -5.457385992356402e-01   +6.569119371627297e-02   +3.359060472205089e-01   -4.321148968808334e-01   +3.099936097841916e-01   +7.597118049669702e-01   +1.000000000000000e+00   -2.235184344883283e-01   +1.710625684457495e-01   +5.331120456095129e-01   +3.451250679930553e-01   -3.127377154000073e-01; -7.723031486955551e-02   +5.833782889788948e-01   +3.827170441448443e-01   +6.179540275327677e-02   +1.539216514529413e-01   +5.619848699041168e-02   +2.294779409650935e-02   +3.988224513899595e-02   +2.467855423503011e-01   +6.398413996423048e-01   +2.305674392877635e-01   -3.201392233174581e-01; +5.334567588464548e-01   -6.073688575353967e-02   -4.123863682292856e-01   +8.099165056280568e-01   +5.964937473874722e-01   -7.893211242636163e-01   +4.450325128011360e-01   +5.311065823703259e-02   -4.554823048390467e-01   +6.180003339251869e-01   -6.413812557461823e-01   -5.895888147940054e-01; -2.537830532050587e-01   -5.459552155069537e-01   +5.685541440975533e-01   +4.639376984296175e-01   +1.402076303581708e-02   -3.517980674130877e-01   +5.457310333831557e-01   -1.103608671765824e-01   +7.701098594906591e-01   +2.980994434336799e-01   -4.638541069248134e-01   +6.868889517273250e-01; +4.411198643235495e-01   -2.997358272107883e-01   +1.215391399242999e-01   -2.438429575368277e-01   +6.958728709987564e-01   -4.392490924838329e-01   +2.672602716519396e-01   +3.976950638297005e-01   -2.238681620470546e-01   -4.034467286922448e-01   -5.347781223384164e-01   -5.784186684949858e-01];
L3E_L3I_iGABA_netcon = [-2.929957233272438e-01   +2.954469538453198e-01   -2.444222640022343e-01   +1.780362416862205e-01   +8.782173034771378e-01   -1.562282361200479e-01   +3.839190287598986e-01   +6.842681117573866e-01   +1.297787967850266e-01   +7.984021572313276e-01   -3.120335750345311e-02   +1.641828971589355e-01; +2.365898145332378e-01   -1.988656881330305e-02   -9.073748642044585e-02   +4.253085609841343e-01   +3.499847750724709e-02   +7.934769256686307e-01   +4.231378068479641e-01   -5.162463591869612e-01   -2.975740439885810e-01   -5.731228988217192e-01   -3.016665304339597e-01   -1.227800092938735e-01; +4.464319519123190e-02   -2.411593539755319e-01   +3.077877786947021e-02   +8.523070287892057e-01   -5.828049761217762e-03   -1.514613594620396e-01   -2.019094993288689e-01   +1.279374193415439e-01   -3.943242546121115e-01   -1.148458090479146e-01   -3.770401685590624e-01   -2.854174006431834e-01; -4.515587909090514e-01   +3.430557580410997e-01   -2.587402027718879e-01   +1.349102422245420e-01   +2.540652578799023e-02   +1.198270977070031e-01   -2.911336811186504e-01   +1.716601075915930e-01   +4.780491806565172e-01   +4.804742989255070e-01   +2.417896095934354e-01   +2.113839345310631e-01; +7.931455521709615e-04   -4.986261520906865e-01   -6.550636423485979e-01   +7.909096765391087e-01   -4.334085976834110e-01   -6.421175762764127e-02   -6.489385193736561e-01   +3.409841789253371e-01   +1.490371124394410e-01   +5.794705277885162e-01   +7.260886291804654e-01   -6.671372233589201e-01; -6.168664036911106e-01   -1.697132217273343e-02   +4.820743537748362e-01   -5.612810169782687e-01   +2.952060514952011e-01   +7.008630555697479e-01   -8.393630008436069e-01   +5.842488813483924e-01   -4.466923560571074e-01   -6.387687688418219e-01   +8.433257225075294e-01   +6.693100151487451e-01; -4.574668777661888e-01   +2.020153148712656e-01   +6.147251855534769e-01   +1.887737102144166e-01   +2.520030599326175e-01   +8.406700467390362e-01   +1.242033455122496e-01   -1.978336793498516e-01   -4.181728308724487e-01   +2.040269433574087e-01   +2.529646741817102e-01   -2.116891225775483e-01; -1.589059455085759e-01   +1.381370219998254e-02   +4.183401214554823e-01   +8.022145842968458e-01   +4.949756301250713e-01   +4.839391642964253e-01   +4.231696689495119e-01   +1.462380980800819e-01   +5.917433008645173e-01   -1.499704995819288e-01   +6.814813465190694e-02   -9.209389939752971e-02; +3.561243720146492e-02   +3.233997153343555e-01   -9.325698918529145e-02   +4.496552251307409e-01   -5.164011990988374e-01   -1.288019423499276e-01   +1.000000000000000e+00   +1.391365613521309e-01   -6.415723252153968e-01   +1.846170752561124e-01   +4.633910962662153e-01   +5.013165431424950e-01; +6.756794643662505e-02   +5.651987575814720e-01   +6.344730867351555e-01   +1.932345812351998e-01   +8.233061839510302e-01   -2.405283777507222e-01   +5.413383250955518e-01   +7.924481489297313e-01   -5.282001469788019e-01   +4.614680611088536e-01   +7.400345128665657e-01   +8.943806751538664e-01; -2.245059054689804e-01   -1.419817846876910e-01   +7.960472055259776e-01   +4.432570543026105e-01   +2.301607108372910e-01   +5.028678760633656e-01   +3.218066917079778e-01   +4.103214315950841e-01   +3.271490954616704e-02   +8.242510113507934e-03   -1.575794643687649e-01   +3.566944032864007e-01; +3.243528484759067e-01   -1.221716806263007e-01   -8.276233895522206e-02   +3.055156261594472e-01   +5.593729367479534e-01   +4.972475443962462e-01   -4.702959664750818e-01   -3.989892341818075e-01   +2.072923332988695e-01   +4.442233579956388e-01   +8.704183265278307e-01   +2.783132339435653e-01];
L2E_Input1_iAMPA_netcon = [-6.261967222029750e-02   +1.000000000000000e+00   +3.460091443558255e-01   -1.935967624933113e-01   -1.198928771980305e-01   +7.218915312928706e-01   +5.810511548426333e-01   +3.610383253738166e-02];
L2I_Input2_iAMPA_netcon = [+3.797963484386533e-01   +3.070391417575917e-01   +2.488551846713596e-01   +1.530652424059903e-01   +1.000000000000000e+00   -5.260476409335475e-01   +1.000651861017922e-02   -2.422058183541122e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
