function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.558993815776079e-01   -9.404925803516805e-02   -2.665947967526731e-01   -1.014655378935061e-01   +2.535509746403218e-01   -2.947872912426443e-01   -2.394881087487366e-01   -1.921496341435098e-01   -1.289938526349398e-01   -1.925313339959550e-01   +1.283776618046429e-01   -1.372429377605841e-01   +7.790589202346848e-03   +3.087783059076825e-01   -3.247118524557516e-02   +1.470776346579266e-01; +2.223853477669607e-02   -7.189415619058522e-02   -1.597084848764284e-01   -1.286326058201276e-01   -2.096351996404954e-01   -3.407428328491571e-01   -1.128896369831809e-01   -8.460320999585577e-02   -2.393591640453634e-01   -2.314901677466998e-01   -1.543836719043268e-01   -2.968630531427439e-01   +7.306119537308671e-02   -2.660752526688718e-01   +2.989961214774595e-01   +2.583888571420379e-01; -2.234587064196714e-01   +5.813111074718032e-02   -2.264049339314052e-01   -2.750925426434168e-01   +2.296620890721928e-01   -2.091315871554277e-01   -2.726974859508127e-01   +7.795268496731994e-02   -1.480974960255190e-02   +1.159512972901140e-01   +8.555004678997771e-03   -2.285856179344911e-01   -1.973397332035823e-02   -1.865681859044376e-01   +3.328675834083705e-01   +2.780498204828037e-01; +8.707395664912178e-02   +2.113096445622678e-01   -5.902887132302315e-02   +9.483607535132119e-02   -2.809419445196942e-01   -1.353339074356937e-01   -8.866874488721027e-02   -2.854588362648293e-01   +1.757196896231658e-01   -8.321316805692716e-03   +1.711780016235666e-01   +5.123687102521703e-02   +1.215145739736724e-01   -8.031482046048177e-02   -1.498000387457632e-01   +2.506656408979500e-01; +7.644201215757396e-02   -1.418526356503577e-01   +1.756782881394369e-01   -7.220028001170320e-02   +1.451523610668781e-01   +1.307743158876985e-02   +1.224286997237436e-01   +1.095110841651711e-02   +2.924267715965128e-01   -2.294608321480336e-01   -2.566696512718522e-01   +1.622794511946820e-01   +2.055816087317514e-01   +2.472606013157368e-01   +7.248546719863061e-03   -9.732841154153637e-02; +2.767012057393612e-01   +6.729695983148812e-02   -3.409279251846688e-02   +2.824501268082492e-01   -1.277755396515117e-01   -1.232045601031387e-01   -3.038995862632847e-02   +1.435466555781784e-01   +2.537638792899145e-01   +1.003253512920842e-01   -2.425007994461552e-01   +1.199969855489303e-01   +1.893636065549864e-01   +6.384283270357724e-03   -3.417319312801729e-01   -5.740312721495237e-02; +3.505710999278642e-01   -2.349561632862457e-01   -1.058296998785479e-01   +2.601172069842911e-01   -1.009023322398214e-01   +3.209318448130401e-01   -1.222859537251664e-01   +2.162696084474862e-01   +1.385695652308131e-01   -1.081297230688375e-01   -1.265771268548321e-01   +2.016986987160214e-01   +3.605758995953736e-01   +6.306306113648813e-02   +2.450710034706344e-01   -9.885222315696013e-02; -2.021411672038874e-01   +2.941619273521002e-01   +6.849362619645985e-03   +9.999428217877920e-02   +5.334325632249481e-02   -1.813593559761763e-01   +1.949909534569623e-01   -2.079794118105659e-01   -1.249261213123152e-01   +1.336832967716963e-01   +1.403359589936801e-01   +9.428563939546299e-02   -3.013189934866484e-01   +1.677270905893299e-01   -8.417235083434768e-02   +1.915235067129608e-01; -2.479088110683055e-01   +1.882648321824683e-01   +2.947871261491144e-01   +2.221854092695182e-02   +6.037587625280214e-02   +2.256059005503374e-01   +6.167598889568621e-02   +1.371107194148809e-01   +2.129279847692563e-01   -2.045269235666116e-02   +3.065354879095429e-01   -1.814564453786054e-01   -7.548386969222629e-02   -2.858350538853222e-01   -2.526454152761674e-01   +2.260013840405281e-01; +2.160052987241633e-01   +2.226088644535032e-01   -2.777048566156318e-01   +3.258550882727379e-02   -2.260141028566953e-01   +6.353132418981815e-02   -2.155015434145702e-01   -1.246765851928508e-01   +2.259404983579779e-01   +2.295444045938550e-01   +3.107223550204927e-01   +2.464657125429126e-01   -6.667108270328286e-03   -1.072313008942433e-01   -2.412756887950494e-01   -2.699944901559369e-01; +5.567604081402333e-04   -2.132426814529429e-01   -1.705783994753027e-01   -1.102789860456610e-01   -1.405016998313530e-01   +2.184126716469934e-01   +3.284390309374589e-01   -6.636174074443474e-02   -5.788163197456098e-02   +1.320649766476051e-01   +3.358045591829497e-01   -2.874465423494668e-01   -1.363678103038103e-01   +5.933718723560381e-02   +7.455017001205903e-02   -1.369418120381560e-01; -9.427617971002689e-02   +1.555227949373588e-01   -9.377460815598045e-03   +2.946693297553107e-01   +9.216005702218222e-02   -1.985284069577639e-01   +3.296172860278627e-01   -3.036971220621414e-01   +7.027071175621574e-02   +4.759569730003842e-02   +1.909812563983053e-01   +6.272436944071577e-02   +1.699917383145736e-01   +1.963835841272840e-01   +5.341738033957177e-02   +2.092710701448300e-01; -6.246241332942142e-02   +4.008206658822950e-02   -1.358247466774909e-02   +2.138752527266082e-01   +1.003767443801535e-01   +1.430659264302810e-02   -8.846760700886534e-02   +1.328381846312301e-01   +3.475649944911454e-01   -6.514287354574508e-02   -2.259349608532515e-01   -9.774204543437258e-02   +2.670724155150621e-01   +2.496637940627350e-01   -1.197834363800979e-01   +3.164541748833615e-01; -1.373502832896565e-01   -1.466262892033041e-01   -2.912909791175596e-01   -2.499555740651102e-01   +3.156737067575929e-01   -1.603688622981368e-01   -7.453437663319638e-02   -2.386299456383273e-01   -3.425614415283308e-01   -2.526177123870770e-01   -1.170501274645206e-01   +2.306358157286508e-01   +1.589259798146858e-01   -2.153027030919650e-01   +7.459502016053052e-02   +2.602026668863960e-01; +1.264643448481422e-01   -1.485375395946879e-02   +4.276379980534872e-02   +3.831862222474706e-01   +6.829359849890256e-03   -7.775236893274173e-03   +1.169917936313663e-01   +8.433865704186498e-02   -9.883059835948449e-03   -9.222231835234462e-02   +2.945795338590554e-01   +2.316110953866959e-01   +1.961637482369827e-01   -4.106505466540487e-02   +6.006974187271963e-02   +6.008356268759359e-02; +2.922650766889163e-01   +6.334685230380271e-02   -1.565438450617438e-01   -7.429364013860255e-02   +1.856684135283246e-01   +2.015928020979774e-01   -9.376518925817909e-03   +2.650717859071775e-01   -2.777829342312643e-01   +1.344955620408806e-01   +1.299085335951193e-02   +5.150539719661665e-02   +2.225586382676257e-01   -1.129103719843831e-01   -7.905357119692080e-02   +2.353152005829359e-01];
L1E_L1I_iGABA_netcon = [+1.926385881609613e-01   -2.623850791810783e-01   +4.284164591619476e-02   +1.359186533510011e-01   +7.593844803246719e-02   +6.810471679726106e-02   +1.622468827266665e-01   +2.107789310126914e-01   +6.886371522986719e-03   -2.233686013275089e-02   -2.066484158612333e-01   +2.518373018805120e-01   -9.341737068469971e-02   -2.419264523636999e-01   +1.652533260939492e-01   -3.710706704049605e-03; +2.905007302545583e-01   +5.087637639346113e-02   +4.539434670540251e-02   -1.474874505634531e-01   +1.777369844421897e-01   +2.106831878185952e-01   -2.172016971123999e-01   +3.568917595230742e-02   +1.090967915527913e-01   +9.829926554028441e-02   +1.179366156054104e-01   +8.034684273892517e-02   +2.206939688983991e-01   -2.472235045026533e-02   +3.063390599283896e-01   -1.068781820740380e-01; -2.029958974033464e-01   -5.302337142877407e-02   +3.143568026071529e-02   -1.810087286972154e-01   -7.921477113284538e-03   +1.327574975323831e-01   +1.216560177360331e-01   -1.673594271172100e-01   +1.061908998320365e-01   -1.672453364397046e-01   +1.124570681623059e-01   +3.873510219393497e-01   +1.885795876590110e-01   -1.256575781186086e-01   -7.959267624208388e-02   +4.383205012542832e-03; +1.875276758777061e-01   -6.132539816295844e-02   +3.655517490589309e-03   -2.401650703062347e-01   -1.955584654692633e-01   +2.103737540162064e-01   +2.156940432684646e-01   -2.598935771450092e-01   +2.825834067016211e-01   +2.928603357187597e-02   -1.305913052771499e-01   +3.058921653127360e-02   +6.396631187557314e-02   +1.952386276365437e-01   +2.444782639597311e-01   -1.496351243889553e-01; -1.525064332234551e-02   +2.663099916186712e-01   +2.903484913392817e-01   -1.907131537708426e-01   -2.680269264625631e-01   -9.223306404136475e-02   -1.760550214300698e-01   -2.098570576691365e-01   -2.188629066783658e-01   +1.434419810243057e-01   -3.169750770493657e-01   +1.520520503602162e-02   +3.641656104609658e-01   -1.727794907375258e-01   +4.941148884316310e-02   -2.026782431171600e-01; -1.124391169274075e-02   +7.517756089218830e-02   +2.614595650193125e-01   -2.954672517908267e-01   +1.955763087636749e-01   +2.778229141207878e-01   -1.788057249519461e-02   -2.615745483172525e-01   -2.438021185419764e-01   +1.086446626105146e-01   +3.036043450373111e-01   -1.634111941578278e-01   +1.174745353620179e-01   +2.300351929865546e-01   +2.251766288726571e-02   +4.062246567335601e-02; +2.591758022501428e-01   +2.646197131873645e-01   +1.325665604014433e-01   -2.373595113395448e-01   +8.650299930353125e-02   +2.959048491191816e-02   +2.195678042349002e-01   -1.004803265053154e-01   -7.839056068355237e-02   -6.037394747033111e-02   +2.966773661979067e-02   +1.522715052725487e-01   -8.491718177206085e-02   -2.090780469369433e-01   +1.117809148282524e-01   -2.454157862731192e-01; -1.599249495309239e-01   -2.743574081766015e-01   +2.504296252198053e-01   +1.701110582258875e-01   -1.407594330605007e-01   +2.551784651160426e-01   +3.261457997576274e-01   -2.582980742908656e-02   +7.696478619869829e-02   -7.163182304985183e-02   +1.916391654590412e-01   -9.262874216539779e-02   -2.331871008540601e-01   +1.557663507685525e-01   -2.329395622669236e-02   -1.016883118674584e-01; -1.041098918263003e-01   -2.506127668676281e-01   +2.179783073042696e-01   -2.117218746691620e-02   -3.181491275898153e-01   -1.212259795805997e-01   +3.532311378012728e-01   -1.432840354162624e-01   -1.096548014726949e-01   -3.132875629440640e-01   -8.273076547767262e-02   -2.931301655608353e-01   +1.539256800135090e-01   -1.176270501248817e-01   +2.689435632824622e-01   -1.426261729891565e-01; +2.586320480325909e-01   -1.750071108604090e-01   +2.707839792904154e-01   -2.375250072997115e-01   -1.221635969093703e-01   -2.275836137358132e-01   +2.154628943570057e-01   +3.613474165597708e-04   -1.865784059155131e-01   +3.141365978024950e-01   +1.743195834229965e-02   -1.338691482341999e-01   -5.166450245594303e-02   +2.795481103899085e-01   -9.883310803813938e-02   -2.234264175258536e-01; +1.895960894814600e-01   -2.246206309635038e-01   +1.807901592558442e-02   -2.608309192028593e-01   -3.004692993307641e-01   +2.652068815192656e-01   +2.465404300358308e-01   -4.549031294225774e-02   +1.649685454490455e-01   +1.392005381545420e-01   -1.111733701875871e-01   -6.278170689720687e-02   +2.892956443317399e-01   +1.541683961015427e-01   -1.516350799283912e-01   -1.562233319367421e-01; +3.170041321908287e-02   +2.203117046206337e-01   -9.039962377096773e-03   -8.214250242463637e-02   +4.618089685459920e-02   +1.014704417594632e-01   +3.169369848271194e-01   -5.719852289477338e-02   +2.827000357447535e-01   +2.323986322786567e-02   +4.428771285528995e-02   -1.785431501536227e-02   -1.851494136464776e-01   -2.405365814393022e-01   +7.145062344925204e-02   +1.249434767399321e-01; +8.152643584469543e-02   -2.140690821940232e-01   +1.690480476512436e-01   +1.367661506949624e-02   +3.613247568713569e-03   -2.163492123242975e-01   +2.239662963021496e-01   -1.599480450992590e-01   +3.326858586444881e-01   -9.150906700347350e-02   +2.191186441307690e-01   +1.706693909901451e-01   +2.567001488606717e-01   -5.573695088523130e-03   -2.010190137466286e-01   -1.630573858092469e-01; +2.210299161825203e-01   +2.718538619642982e-01   +6.339518875724978e-02   -2.307047539043653e-01   +1.749201713519857e-01   +1.420749817378623e-01   +1.135555243091637e-01   +9.634413387331980e-02   -2.204976636901227e-01   -6.976740816944527e-02   +2.921120046380957e-01   -2.672035281586717e-01   -9.931835526678814e-02   -3.406925774356954e-01   +1.533638677549451e-01   -2.022791090180532e-01; +2.776731719215471e-01   +1.577941018152112e-01   +2.004380817143663e-01   -3.129943281228329e-01   -1.921759935593771e-01   +2.854869676585770e-01   +1.773531626720883e-02   -8.321075830074860e-02   +1.540470238298426e-01   -1.651428583949682e-01   +2.586188128110948e-01   +2.215346649009762e-01   +8.855311702588591e-02   +5.575073555088540e-02   +1.889210508923393e-01   +5.992790560364621e-02; +2.715069300052411e-02   -2.297155052240212e-01   -9.187649664415769e-02   +1.453853297744890e-01   -8.756101123345213e-02   +1.614895802703020e-03   +8.108400720287184e-02   +2.247515940983205e-01   +1.595190773131111e-01   +2.289451125660572e-01   +1.348439300096927e-01   -2.889735009314435e-02   +2.064497236176298e-01   -2.757563161638830e-01   +2.815551820827850e-01   +2.472249922788927e-01];
L2I_L1I_iGABA_netcon = [-2.184106506175993e-01   +1.548465349996314e-01   +3.308517302958346e-01   +1.515203359746328e-01   +2.374907063682214e-01   -1.760751092941338e-01   +1.238908026374212e-01   +8.723707114467183e-02; +4.575488530886770e-02   +2.343701553098995e-01   +2.733886047331703e-01   +1.777485716629387e-01   -1.210802169674384e-01   +2.951803716275527e-01   +2.878807005651822e-01   +2.149430687052856e-01; +9.298785860603521e-02   +2.346069016729476e-01   +2.096434761088711e-01   +1.958375520927164e-01   +1.812123268077732e-01   -5.846534595210993e-02   -7.251351191208773e-03   -2.273831292360596e-01; +2.688671407158174e-01   +3.071043323496308e-02   -1.894910186474964e-01   -1.403161160791077e-01   +1.376628960562149e-01   +1.095279153551982e-01   +3.263512749749974e-01   +1.389708932606444e-01; -1.169821368270931e-01   +8.117879802783610e-02   +3.077633176246158e-01   +2.795127027750680e-01   -1.809647645689819e-01   +8.150650145174702e-02   -2.307154899512388e-01   -1.325050149449062e-01; -1.906741940151491e-01   +3.092857831521356e-01   -2.592819636371136e-01   +2.711643131786326e-02   -1.128343666792094e-01   +1.010527239994871e-01   -2.355768576014439e-01   +1.775460560800642e-01; -1.567985011393609e-01   +2.432798629058964e-01   -2.005398125510095e-01   +1.202404538770052e-01   -2.168770645507653e-01   +1.884517030015227e-01   +2.149979394198372e-01   +4.310560263730429e-02; -4.827727130288853e-03   +1.236129322845269e-02   +8.637336419809934e-02   +1.675077520717768e-01   +3.383908599854124e-01   +2.211416002330411e-01   -1.738501724619029e-01   +7.545138261657564e-02; -6.601325823747062e-02   -9.678915441414768e-02   -1.198189869311137e-01   -1.199842386948738e-02   +5.765747023124438e-02   +1.187004719573644e-01   -1.113459849332471e-02   +3.073188186320818e-01; +2.177948140801940e-01   -1.759000389840538e-01   +9.607907956567935e-02   -3.207749346298371e-02   -1.459193154981988e-01   -2.907015664925529e-01   +1.915728034867117e-01   +3.047073470757199e-02; -7.797926767971351e-02   -1.234706261783961e-01   -5.329899802432114e-02   +1.974633029540297e-01   +7.954885843571496e-02   +2.768650252307893e-01   -7.589312380698990e-02   -1.052707272919350e-01; +2.155633395906490e-01   -3.069988506086377e-02   +6.188072450726737e-02   +9.661127277826403e-02   +2.330776087974691e-01   +2.967391906553419e-01   +9.260006227516240e-02   +2.824122740435313e-01; +2.288330918370558e-01   -2.339695020596148e-01   +3.693608918218367e-01   -1.296668578961508e-02   -1.743028828065835e-01   +1.078806377623023e-01   +1.881091079531563e-03   -2.994820857007203e-01; -1.159277271944729e-01   +8.888949262671218e-02   +1.228638189169477e-01   +1.258843781594924e-01   -2.711573333384391e-01   -2.358737590328268e-01   +2.877857802178180e-01   +1.714123467711132e-01; -2.187635186951754e-01   -7.537422460502194e-02   -2.503149749821898e-01   +2.546335256941170e-01   -1.446335944813921e-01   +3.064734171109949e-01   -2.039158146011187e-01   -1.306992323875287e-01; +2.296556676720521e-01   -1.155925079741316e-01   +4.453085672283994e-02   -1.971963355655487e-01   -5.050782615322422e-03   +2.122489914689574e-01   +2.413190418537361e-01   +3.427654282371268e-01];
L1I_L2I_iGABA_netcon = [+1.071950668149831e-01   +3.443814988636255e-01   -1.759704630841661e-01   +1.251832277199246e-01   -2.113477123394393e-01   +1.820045818317925e-01   -1.919908301916758e-01   +2.077140247157108e-01   -5.159474913001228e-02   -1.877000970226232e-01   +1.687387493442312e-01   +2.262203704540580e-01   -3.325220553943172e-01   -3.480759505014058e-03   -1.859494084194800e-01   +2.971610268716285e-01; -1.994608243187558e-01   +2.023992578783069e-01   +3.409475870292879e-01   +3.056897215578847e-01   -1.937035918580998e-01   -2.508226037884621e-01   -2.542812202583055e-01   -1.006489627678805e-02   +1.978316816480974e-01   -2.447898758343817e-02   +1.975076822558957e-01   +1.268271673161903e-01   -2.140606682877472e-01   -1.707544105570940e-01   +1.061233886469349e-01   +2.502311451922333e-01; -1.989251778968584e-01   +1.282573575459398e-01   +2.176942205212666e-01   -1.104157755412764e-01   -2.315852852130183e-01   -6.077903283243962e-02   +1.190513360833470e-01   -1.494601669044233e-01   +2.337402210741877e-02   +1.039876374928452e-01   -2.405727079921727e-02   -4.005417758026329e-02   -1.578518773856902e-01   +2.480196957401819e-01   -1.228527612586995e-01   +2.964411408002067e-01; +1.847914629801436e-01   -1.274978945391436e-01   -1.836720298847467e-01   -1.663168006837911e-01   -1.338006831236991e-02   +3.703586537481821e-01   +1.525666427761194e-01   +3.301371000278406e-01   +1.973287597451773e-01   +8.705906336334446e-02   +4.978232367597667e-02   +1.954667711001753e-02   -1.934027258963325e-01   +1.278043710363163e-01   -1.060134397430089e-01   -2.015038993758441e-01; +2.378855377622377e-01   +2.557610080589753e-01   +3.380127496157275e-01   +1.711572120601549e-01   -2.045867694121272e-01   +2.134210188532335e-01   +1.123725107245781e-01   +1.221119286637476e-01   +2.008262297103676e-01   -2.686152765513005e-01   +1.527485948607504e-01   -1.243896877136360e-01   -2.347337199737859e-01   +1.516651385967404e-02   +8.672022269111297e-03   -8.678710710860749e-02; +4.141991588366781e-02   -9.151919163798616e-02   +1.139551879064830e-03   +2.617751542970923e-01   +2.234183875487151e-01   +1.993901252859124e-01   -2.408743150546171e-01   -1.169165844981413e-02   +2.517232512218642e-01   +2.684751991168324e-01   -3.282192047685029e-02   +2.745841876327706e-01   +1.945626647529444e-01   +1.445548613849456e-01   +3.362773852441539e-02   +1.775762404419983e-01; -9.076318441005078e-02   +2.485262055060155e-01   +9.891361896157806e-02   +1.180667098566209e-01   +5.306162171415238e-02   +2.015336996156234e-01   +6.579094312208944e-02   +2.653692353921328e-01   +3.799345946408978e-02   -7.153831849707193e-05   -2.292370216704206e-02   +2.856087751230320e-02   -3.269202325629257e-02   +2.852133984064011e-01   -2.965298692911133e-01   -3.339533224559101e-01; +2.619505019274933e-01   +2.610487888950251e-01   +1.454335684990445e-01   +6.591542246549459e-02   -1.081091279743760e-01   -1.779652495433965e-01   +4.660773017390091e-02   +9.030085288419382e-02   -4.533293147364355e-02   +2.969078501412009e-01   -1.643256382980201e-01   -2.015225498055708e-01   -2.734361673128471e-01   -4.583147858063411e-02   -1.370376466155406e-02   +1.409879173764306e-01];
L2E_L1E_iAMPA_netcon = [-2.287745264033705e-01   +2.990629016755344e-01   +2.288825068676343e-01   +2.567318858462926e-01   +3.523506943801942e-02   +2.481521188342528e-01   +2.253686714876994e-01   +1.851653996298002e-01; +1.262951443733281e-01   -9.769813671964181e-03   +2.424410245114553e-01   -1.457836671119791e-02   -5.258964145829968e-03   -1.703102418196863e-02   +2.451229590767132e-01   +9.764902773544454e-02; -2.545783661964807e-01   +1.835855719005840e-01   -2.356988007583803e-02   +3.187391575094363e-01   +2.998822940059661e-01   -2.225407278902808e-01   +4.383985698069879e-02   +2.715664088832661e-01; -1.375050533430660e-01   +1.988983405708068e-01   -1.933309607196738e-01   +2.445156280471121e-01   +2.178972060664087e-01   -9.534193486915254e-02   +6.396004462784552e-02   +7.882001142781049e-02; -1.739028115415888e-01   +3.933859962023675e-02   -1.109830207098766e-01   -4.573804764477659e-03   +7.950673257518714e-02   -9.923660141551949e-02   -1.679406121074759e-02   +2.074769743172031e-01; +2.940759819694950e-01   -2.086207214326732e-01   -1.293792167623090e-01   -1.207449226106236e-01   +1.772868645446715e-01   -9.051978030962861e-02   +2.302137424092017e-01   -1.470425408733586e-01; +2.458232582430643e-01   -2.233151726567957e-01   +2.572210466778782e-01   -1.928686340627609e-01   +5.976138865037457e-02   +3.287476161478654e-01   +5.536419021165033e-02   +2.121159733455562e-01; +3.140581340576493e-01   +1.983327036499634e-01   +1.263565039143308e-01   +6.974152095301597e-03   -2.534867911065348e-01   -2.572696799509597e-01   +2.592786101942402e-01   -2.930589769795242e-01; -6.985874310158036e-02   -2.071205799123517e-01   -6.602981411734510e-02   -7.161551667625678e-02   -1.834550671696681e-01   -1.196214818249215e-01   -2.721573094599146e-01   +6.322654427305181e-02; -2.250478820232088e-01   +3.348949251226702e-01   +1.674875498532546e-01   -1.941545555423322e-01   -7.172890070436561e-03   +1.033632354689552e-02   -3.189966290417535e-01   -1.979951602484964e-01; +1.001965060883320e-01   +1.012099423238410e-01   -2.281684526032725e-01   -2.604553097784573e-01   +1.183022398693322e-01   +4.181550250675872e-02   +1.410496711315552e-01   -2.149205252587705e-01; +2.206937621845034e-02   -3.863914956434865e-02   +3.647288154305102e-02   -8.512080346990213e-03   -1.027353497729973e-01   +2.612635390601397e-01   +3.049171036208428e-01   -1.408729586491889e-01; -2.249753039719417e-01   +9.315495100616829e-02   +1.922350175526810e-01   +2.066314488334255e-03   -2.495036325072666e-01   +9.252372174631658e-02   +2.685233943858410e-01   -7.248692545454598e-02; +1.192166569582900e-02   -1.041639040760410e-01   +1.766200465860020e-01   -1.913157470771805e-01   +2.661039509020061e-01   +2.839439035469423e-01   -2.080634247869220e-01   +8.783773543966991e-02; -2.662302978844193e-01   -6.954096691794261e-02   +4.132370568231047e-02   +1.878869256473252e-01   +1.211469513672795e-01   +3.263788772678189e-02   +1.171796741035795e-01   +3.134162721721723e-01; -8.788312609469346e-03   +1.552767023819581e-01   -1.588553327440822e-01   -2.272161290294865e-01   -9.718394519746187e-02   +8.306404657173601e-02   +2.298246995873687e-01   -1.757305592612904e-01];
L1E_L2E_iAMPA_netcon = [-2.798296538689348e-01   +1.788214978627730e-01   +1.058581506801148e-01   -2.385244580522501e-01   +2.909303688481046e-01   +1.868462248028543e-01   -8.822113598281235e-02   -2.650996649154974e-01   +2.711063439622174e-01   +3.269282035785590e-01   -8.068997540633999e-02   +1.959710259351150e-01   +3.293807968974244e-01   -2.444499892898415e-01   -1.258051439704888e-02   -2.106798546364026e-01; +2.197831300089644e-01   +2.406638320242554e-01   -2.373486656276420e-01   +1.297681027990875e-01   +2.547481804271144e-01   +1.155278398349023e-01   -4.238598226492062e-02   +2.110467084873227e-01   +5.265637277819132e-02   -1.259747016086418e-02   +1.136945878132176e-01   -1.646228001549683e-01   -2.972269544620008e-01   +1.314481693622874e-02   +1.320879180210416e-01   +4.397131299962609e-02; +1.055516187160883e-01   +3.238525652388955e-01   +1.182327837614894e-01   +7.903354706184716e-02   -9.109997715434248e-02   +6.250095342085751e-02   -6.876745881577685e-02   +2.654856810000710e-01   -2.580312066584730e-01   -5.646089374582551e-02   +3.145559561982853e-01   -3.483177732239690e-02   +6.385017028684062e-02   +2.319037514255215e-01   +2.789286198570530e-01   -7.580751536213873e-02; +1.490975963657481e-01   -2.469797647275463e-01   -1.916714685054778e-01   -8.337457925369834e-02   +1.913614450074871e-01   -2.918388356460205e-02   -1.574828043710436e-01   +1.059364337591519e-02   -5.528276032060128e-02   +3.614557309831237e-02   -2.502406815890646e-01   -2.091200043507861e-01   +2.364123448760817e-02   -2.621288064397905e-01   +2.595916869518112e-01   +1.117282183737749e-01; -2.732314356270520e-01   +4.861104443239063e-02   -6.726776265035926e-02   -1.475249683125024e-01   +3.197776771302365e-01   +3.802846046842952e-02   +2.402636512442493e-01   -1.459768082676289e-01   -1.702865887463480e-01   +2.852426603693063e-01   +9.068146884464601e-02   +2.433405924673052e-01   +3.085127771170763e-02   +2.537382903435229e-01   -9.878713516387040e-02   +4.925986798308789e-02; -4.863354527367314e-03   +5.199146741878891e-02   +1.720189952063345e-01   -4.176054321199384e-02   -2.772782311488260e-01   -2.320081601659247e-01   -6.116448558518489e-02   +2.954663760807848e-01   +3.190123767398356e-01   +1.387824304985630e-01   -2.121140449345399e-01   +1.644320370686029e-02   -1.076286321940509e-01   -2.515109016765811e-01   +1.195733702695776e-01   -8.455196481632828e-02; +2.497720623483420e-01   +8.035725469084726e-02   +1.699568089515493e-01   +6.113766551676853e-02   +2.934862339422259e-01   -2.077903301994190e-02   +2.103178837662805e-01   +3.012880053522625e-01   +2.802217519325187e-01   +1.338183952527244e-01   +2.524428935042978e-01   -1.331049400168512e-01   +1.686933703110306e-02   -2.572804462406442e-01   +2.902222414546138e-01   -2.841126396278947e-01; +3.315179028586859e-01   -8.561660574134561e-02   +2.026373698696455e-01   +7.038336551986388e-02   +2.729752546652784e-01   +1.144944484106509e-01   +2.785297397337807e-01   -2.355665280626286e-01   +2.953220750419205e-01   +1.804520193287446e-01   -1.832864861000029e-01   +4.880507484345979e-02   +1.334325960890702e-01   +1.262094276612809e-01   +3.108577473962915e-01   +1.454078450404518e-02];
L2I_L2E_iAMPA_netcon = [+2.967921130292115e-01   +1.098003455113014e-01   +2.532297706080244e-01   -3.823458784675682e-02   -2.619685774105644e-01   +1.807625052548756e-01   -1.149985409206236e-01   +5.342751302768018e-02; +1.614537716007860e-01   +1.723775027660673e-01   +1.843042584168677e-01   +4.522954195929725e-02   -1.385789784241624e-01   +5.108116020757324e-02   +3.057500613108593e-01   -1.213614710175006e-01; +3.161982011941716e-01   +2.002404299568878e-01   -7.050400477467942e-03   -9.656383902622526e-02   +5.879694119019058e-02   -2.107517481688740e-01   +1.932616974587576e-01   -1.527471194280507e-02; -9.530125868446639e-02   -1.986939835380834e-01   -1.574811183780306e-03   +2.207761913321492e-01   +2.985106336556092e-01   -9.026759872883550e-02   -2.405870122459859e-01   -9.703251976788924e-02; -3.909651834044417e-03   -2.318834728349169e-01   +2.766838001507443e-01   -9.708187855867931e-02   -7.781388586645864e-02   -2.303293136564567e-02   +2.501213386147737e-01   +2.227847705249397e-02; -1.934601402041263e-01   -1.381756335566207e-01   -2.281360158930291e-01   +7.478553367603587e-02   -2.036429721702849e-01   -8.903565049328797e-02   +2.420735361119091e-01   -1.096482125489799e-02; +2.943736101987135e-01   +2.809252261559871e-01   +6.413425542859123e-02   -1.064274690140640e-01   +1.298846061587660e-01   +5.695856210734922e-02   -5.817459458134248e-02   +2.874340002586011e-01; +7.326988973218251e-02   -2.343214377160374e-01   +2.220546862130525e-01   -6.670684757420908e-02   +2.598691177888098e-01   +2.439794764168432e-03   +3.035049529448433e-01   -1.831925347642660e-01];
L2E_L2I_iGABA_netcon = [-1.276236781945233e-01   +1.483619502398886e-01   -1.833376970137033e-01   -1.634928977393161e-02   +3.942945445324802e-02   +2.858047804737477e-01   +1.554182434009736e-01   +1.447186125191295e-01; -2.591732962623575e-01   +2.972718365921464e-01   -2.733600197935003e-01   +1.237211807198190e-01   -1.023897158345449e-01   +1.958477240156728e-01   +2.075594130446077e-01   -1.883563119831941e-01; +6.919243357395649e-02   +2.790561971972320e-01   -1.049374663197715e-01   +1.713677627498474e-01   -2.532794518493197e-01   +4.558746358219351e-02   -1.100383460392655e-01   +3.309991487132029e-02; -2.980459892232066e-02   -1.410555585413770e-01   -4.993641465354148e-02   +3.867797565957713e-02   +1.549676719616779e-01   +1.913817721978476e-01   -2.222705873235498e-02   +2.287490436694067e-01; +2.604288366208343e-01   +1.262000096036636e-01   +1.097053811011471e-01   +1.865389288424767e-01   -1.153510930271429e-01   +1.594974483978260e-02   -1.692187391754729e-01   -2.294786409901532e-01; -3.959659912285770e-03   -2.399628742887570e-01   -1.223311561945859e-01   +1.108541904830878e-02   -1.453661125843795e-01   -2.321424130882732e-02   +2.397476105124997e-01   +1.916427212965245e-01; +3.599592437710862e-01   -2.998933359119066e-01   +3.135205750261701e-01   +7.350272886615890e-02   +1.736989305398159e-02   +2.747059598660153e-01   -2.691500481375417e-01   -2.834262031841273e-01; -2.504476248981699e-01   +2.774597313372898e-01   +2.186470336489136e-01   -8.072370156365370e-02   -2.886700188811378e-01   -2.305063696186160e-01   +2.248517535517463e-01   +1.533266096037464e-01];
L3E_L2E_iAMPA_netcon = [+1.574203414544371e-01   -1.870223854937846e-01   -1.415656941133647e-01   +2.914306048510162e-02   +2.777145453507182e-01   +2.599452665685222e-01   +4.877356863891096e-02   -1.384751176563281e-01   +2.360518457932102e-01   -2.296756214837015e-01   -3.085652314035009e-01   -1.201164898603385e-01; +1.001161641751534e-01   +6.470427757023924e-02   +2.114918426147782e-01   -1.510139484827681e-01   +1.467287947302625e-01   +1.849558326942104e-01   -6.967486760902138e-02   -1.829564728570479e-01   +2.094868087150037e-01   -1.181722886147233e-01   -2.073323565596344e-01   -1.204123876471061e-01; -1.349729111195360e-01   +2.743220178716204e-01   -3.531176336912733e-02   +1.367132820005102e-01   +1.880450592131754e-01   -3.008754042710845e-01   -1.054434268032403e-01   -2.951520038908122e-01   -2.806269637976216e-01   +2.021964133862085e-01   -1.165520376481563e-01   +4.548388529590402e-02; -2.596934869427052e-01   -2.165958788614790e-01   -3.124129188752648e-02   -1.926033388002028e-01   +1.467414166925775e-01   -3.047851169490707e-01   +5.466649050246517e-02   -2.444813126348908e-01   +1.627863981042136e-01   -1.585731022228884e-01   -1.447644246502669e-01   +2.335870460680425e-01; +8.812928036385493e-03   -8.883604412207452e-03   +2.657933693501196e-01   +1.128379072358110e-02   -1.999802940493867e-01   +1.249732782557920e-01   +2.069187778630103e-01   +1.825720390151347e-01   +3.027612856058920e-01   +1.737115947596329e-01   +4.443961278405477e-02   +2.801653094054380e-01; +1.752700040012226e-01   +5.043950026359741e-02   -7.517455051679564e-02   +1.239369742933361e-01   -1.121736009610908e-01   +2.358109828010122e-01   +2.077340446952256e-01   +1.344357199218977e-01   -2.388470950759630e-01   -2.804419170114960e-01   -3.118540109729917e-02   +6.902135278841452e-03; +1.145425965243223e-01   -1.530246289696904e-02   -2.578226066857239e-01   -4.628107361061520e-03   -2.247207351492055e-01   +1.719804124248630e-02   +9.660690141659620e-02   -1.278692574627159e-01   +2.807598755595832e-01   -2.569993266574309e-02   +2.848805491760774e-01   -8.091042341422669e-02; -9.353048851571173e-02   +2.178166269584765e-01   +1.204754853872732e-01   +1.431347869285806e-01   -1.766910042905475e-01   -2.438888148311505e-01   -6.703175046577051e-02   +1.183614577177179e-01   +1.584744829812066e-02   -2.731949104891084e-01   +2.913366561320487e-01   -2.054799693862367e-01];
L3I_L2I_iGABA_netcon = [-2.699169520395506e-01   -5.911831776085365e-02   +1.510945530029712e-01   +2.240027762469672e-01   -1.653100729705280e-01   +6.040081872505799e-02   +9.217559432271077e-02   +3.165645836580847e-02   -2.042080167607248e-01   +3.418771438559329e-02   +1.735794841841317e-01   +8.074492475670135e-02; -2.042939889687999e-01   -1.534630461783410e-01   +3.276970277625523e-01   +1.067348947164625e-01   -2.406871458000684e-01   -2.436265635489557e-01   -8.687843545963889e-03   +1.492545709487721e-01   -3.009732531771847e-01   -5.368600624376903e-02   -2.153287745599045e-03   -4.958882873004342e-02; +1.267040824329100e-01   +9.362617388337972e-02   +1.894869110078916e-01   +2.919444467821656e-01   +9.664518505733072e-02   +2.943315999220190e-01   -1.158258562900781e-01   -2.069437210452497e-01   -1.896016425307772e-01   -6.626267860715607e-02   -1.616605048783260e-01   -1.268083543284111e-01; +3.492819155870363e-01   +1.027447436393026e-01   -1.342081114390272e-01   -5.916625159043162e-02   -1.669509276702639e-02   -7.472368765208433e-02   +1.739175832062172e-01   +1.547935681577744e-02   +1.598094671347575e-01   -2.879973836143528e-01   -1.209320878780936e-01   -1.827027146190975e-01; -2.779997684644262e-01   -2.453094615731341e-02   +7.350924485334316e-02   +9.559039617339017e-02   -2.069211462950684e-01   -5.782725376604848e-02   -1.536797122055243e-01   +2.021536375105861e-01   +2.175078118738235e-01   -3.613565411512543e-01   +2.574984073489415e-01   +4.623619292217669e-02; -7.089256326621092e-02   +3.112906151833807e-02   +1.485005625497380e-01   -2.435652538431949e-01   -2.620257725504922e-01   +2.432344077816524e-01   +1.016303205503628e-01   +1.186403609090003e-01   -2.494354100561519e-01   -1.975797887300222e-01   +2.332734313477310e-01   -2.322616965279444e-01; +3.698615409715308e-02   -2.880948637155389e-02   -8.631400844207666e-03   -2.777167620444938e-02   -1.546646885182780e-01   +6.547223890039933e-02   -5.169010173315639e-02   +2.124548961198708e-01   +3.399632846063034e-01   +6.364001064798931e-02   -1.825991197091282e-01   +4.111704837279805e-02; +8.361605514564832e-02   +1.268480534541818e-01   -2.852206992262316e-01   +2.659774352718232e-01   +4.641172386392445e-02   +2.235346123241728e-01   -2.449660551507389e-01   -1.487948865966825e-02   +1.641463648944088e-01   +1.752009031964758e-01   -1.987793459658466e-01   +2.197949582804136e-01];
L2E_L3E_iAMPA_netcon = [-1.593923256709090e-01   -1.430471761723786e-02   -2.466271479917413e-01   +2.818965750550957e-01   -1.140704306365481e-01   +1.854928375039896e-01   -1.465391665235038e-01   -1.679310542194244e-01; -2.087748918846704e-01   +2.174789213178290e-01   +7.327822996284064e-02   +2.265855036558679e-01   +2.962205491381177e-01   +1.371420204893501e-01   -2.149273409151319e-01   +9.568924199583395e-02; +2.500504925594763e-01   -8.630440733506529e-02   -2.850417899594432e-01   +2.257060212311175e-01   -2.159840303432429e-02   -2.643154108480873e-01   -1.546352791540813e-01   +2.242216333464503e-01; -2.446750570182907e-02   +6.571479165411674e-02   -2.750449263062006e-01   +9.903720303204611e-02   +2.495374087178024e-01   +1.788957701260937e-01   -1.763275114975641e-01   +1.934922658247187e-01; -2.535701724172404e-02   -1.052443538495916e-01   +3.081382811502119e-01   -1.589480676398525e-01   +8.167411991675019e-02   -7.208070438720987e-02   +2.345123487218798e-01   +2.855645527001409e-01; +2.412474110613334e-01   -8.706056710706565e-02   +2.265319844061091e-02   +1.558405662129000e-01   -2.514744218797151e-01   -2.619942344560404e-02   -2.466728930175418e-01   +2.940302670449365e-01; -2.478714715319227e-01   -4.511385392835320e-02   +2.425914586198174e-01   -2.813287831938646e-01   -5.015646653328927e-02   +2.947606130816731e-02   +2.381489195217658e-01   -1.779828391545504e-01; +2.128582572906093e-01   -8.687207296206376e-02   -1.449719482757180e-01   -1.443643622044317e-01   +2.731360614039431e-01   -1.642265797191563e-02   -1.386403367991172e-01   +1.689271128064508e-01; -2.374403313982291e-02   +1.807396808563322e-01   -2.236599804133136e-01   -3.205529540975949e-02   -2.395320760568721e-01   +2.142192788491448e-02   +3.790450264031975e-02   -1.129126627568417e-01; -2.087094016038055e-01   -7.755763278587625e-03   +1.330125515288836e-01   -3.091264268382696e-01   -1.627884768450025e-01   -2.019462938934653e-01   +1.412622740011472e-01   +5.979168115521462e-02; -2.531660294991502e-01   -4.646681428989057e-02   +1.349778320150291e-01   -2.438983048886056e-01   +1.901546953496580e-01   +1.067240896522791e-01   -3.382578303295548e-02   +2.874516351327474e-01; -6.784076914234133e-03   -1.782966842877761e-01   +1.303783616198909e-01   +4.160793071179476e-02   -2.801022678691235e-01   +2.763148464765123e-01   -3.039326885662073e-01   +7.063745865279403e-02];
L2I_L3I_iGABA_netcon = [+1.777133740609614e-01   +5.617670211562580e-02   -1.110646046135645e-01   +2.874646680016741e-01   -2.148148092553975e-02   -2.604117162270431e-01   +1.256152623249854e-01   -3.929221844101224e-02; +2.854809868520623e-01   +1.460166715788441e-02   +1.373477861001585e-01   -1.431501683736921e-01   +1.430510077119804e-01   +2.413226273358578e-01   -8.021386911823537e-02   -7.168451044475674e-02; -6.665580798349859e-02   -6.979373523445126e-02   -1.778686725229400e-01   -3.066831845520988e-01   +2.274710757993932e-01   +2.090604398127759e-01   +2.523416293378881e-02   +9.050245451785766e-02; -2.054449156710607e-01   -1.685957400467019e-01   +2.644386710726561e-02   +1.502258524030479e-01   +1.053550912855366e-01   +7.627674295342278e-02   +3.185281844748004e-01   +1.221351084193856e-03; -1.205869458410943e-01   -9.034356200580382e-02   +6.781819465841539e-02   +2.112251788800949e-01   +3.458174514231000e-03   -9.971638353022366e-02   +2.534834796502169e-01   -1.509668537496782e-01; +2.016726350069173e-01   +1.210919003494899e-01   -9.572599261484591e-02   -1.093349900464570e-01   -2.096131762437941e-01   -1.574295017576269e-01   +2.511121568068119e-01   -1.988953136243205e-01; +9.499659818332447e-02   -2.268367574729766e-01   +2.228288731855140e-01   +1.296338199962515e-01   +1.268984296031270e-02   -2.267897528187097e-01   -6.658345108236384e-02   -2.574886239464914e-01; +4.759679137254089e-02   -1.813697986894782e-01   -1.004429055338803e-01   -1.033018480624390e-01   -1.798866922254057e-01   +2.529215527583902e-01   -9.313137456125536e-02   +7.415332882652961e-04; +2.795646848340118e-01   -2.430551895189882e-01   -9.825027174291667e-02   +2.047772916944635e-01   +2.130157661225908e-01   -8.539603179809536e-02   -1.084669478611637e-01   +1.488986274296475e-01; +1.107897235314770e-02   +1.313346503387614e-02   +2.982604407520306e-01   +1.952246339001692e-01   +1.932891042326258e-02   +3.304473462562922e-01   +2.944923258273190e-01   -3.917454232650096e-02; -7.032656138711668e-02   -3.295280109414223e-01   -1.290136605742409e-01   +2.457949524021627e-01   +1.099631090596433e-01   +2.461330535705006e-01   -1.421343161614245e-01   +2.235483082900967e-01; -1.658758441055326e-01   -2.328001516252255e-01   +2.957468344504860e-01   +3.070534799529587e-01   +3.422397241291417e-02   +1.870010381210639e-01   +2.092610486531620e-01   -2.676293504587188e-01];
L3I_L3E_iAMPA_netcon = [+1.284281263652336e-01   -3.059000862154647e-01   -2.499276882465745e-01   +8.042206486338477e-02   -3.045194504606048e-01   +1.670468112321301e-01   +2.148026307875283e-01   -4.323160264144443e-02   -2.448127837868842e-01   +2.437090337072101e-02   +5.045862919069063e-02   -5.030878719301697e-02; -1.762810102622608e-02   -1.441045860774100e-01   +1.835153055072180e-01   -1.789046428068630e-02   +2.251237976334906e-01   -1.579469144922445e-01   -1.992484490100847e-01   -1.538804821153880e-01   +7.835150232326982e-02   +2.365994957833538e-01   +2.410752799818490e-01   -3.331614294043402e-01; -1.810437685869739e-02   +1.305093566673463e-01   -2.181247495182866e-01   +2.039076188635909e-01   -1.038670787157003e-01   -1.906133666836035e-03   +2.254599050772204e-01   +3.362275127393654e-01   +1.497852644081975e-01   +2.452257931197584e-01   -2.134038283538699e-01   -1.367483508128407e-01; +2.970917006013767e-01   -4.211272091411901e-02   +2.359378005406136e-01   +6.769908465570243e-02   -5.484659389679708e-04   -5.688201151333392e-02   +2.795098785654848e-01   -1.871536626690324e-01   +1.863375438569181e-01   +9.997156180242991e-02   +2.607114307540693e-01   +2.575670413968127e-01; -5.267594572020014e-02   -9.854836014326070e-03   +1.525882362112336e-01   +2.116666390497903e-02   +1.318415457341350e-01   +4.832140057505330e-02   +2.316542545752651e-01   +2.235882454941700e-01   +2.607249277770651e-01   +1.624661748961278e-01   +1.174157558332748e-01   +8.900488169866286e-02; +1.387021217606406e-01   -5.180374263293937e-02   +3.586872137385443e-01   -2.062324279581335e-01   +1.505607302063477e-01   -1.653151893188621e-02   +2.111482418475947e-01   -4.775766264669010e-02   -9.792567823410667e-02   +1.198082283766722e-01   +3.257087523016353e-01   +2.218248902003706e-01; +2.853931812705751e-01   -1.900431808508464e-01   +1.391184788856496e-01   +2.355376135846594e-01   +2.799153150832872e-01   -1.452174710894576e-01   +2.785821427019604e-01   -4.563325669127927e-03   +5.199301722944600e-02   -1.095233927749577e-02   -2.138316578656380e-01   -2.022422713496472e-01; +8.601375387762852e-02   +2.532325268091991e-01   +1.984312389030413e-01   +2.918797327813675e-01   -2.800347390720667e-01   -1.791508181908694e-02   +5.861878640310446e-02   -2.876867149451028e-01   +1.487485126084976e-01   -1.558620859715666e-01   +2.639454988746293e-01   -2.058077939238932e-01; +3.101055064460223e-01   -5.921502692097860e-02   -1.874322548400988e-01   +1.009221778405722e-01   +3.088700463168082e-01   +1.650922398876004e-01   -2.353435302156427e-01   -2.728400045163120e-01   +1.110207746581025e-02   +1.822006955187418e-01   +1.567801385139009e-01   -2.329906280024235e-01; +2.430013306857141e-01   +1.598384179233713e-02   +1.760044885811609e-01   +6.303551495363391e-02   +5.342136217309966e-03   -1.121698823125232e-01   -2.667867427869831e-01   +3.304083486171767e-02   -2.143594940944189e-01   -6.136256630675203e-02   -1.155618618382243e-01   +7.972235760723273e-02; -5.543554476908365e-02   +1.381613997145366e-01   -1.369680329583438e-01   -2.386983993227825e-01   +9.140574631563476e-02   -1.758520141347749e-01   +8.123982101077992e-02   +7.083735915098263e-02   -1.956916889551362e-01   +1.949915131017038e-01   +7.013009908607895e-02   -2.510639989125200e-01; -2.285881489281931e-01   -1.375807770967557e-01   -1.156177820348710e-01   +5.809502254911247e-02   +6.338304341725956e-05   +1.539521656805323e-01   -2.050597794583349e-02   -3.044626069415859e-01   +1.563295200098537e-01   +1.778878637328232e-01   +1.310917067134551e-02   +1.677362401258262e-01];
L3E_L3I_iGABA_netcon = [+3.049064266156221e-01   -2.944974723052818e-01   -2.035581794730436e-03   -1.243749782349963e-01   -2.404923368327870e-01   +1.775392573061703e-01   -2.057737089784806e-02   -6.810914384467880e-02   +3.040560883607462e-01   -2.263397104914731e-01   -2.515661201506715e-01   -2.088782326116666e-01; +3.085036131856400e-01   -1.426604847746945e-01   +2.361167327102476e-01   +1.118765948455563e-01   +1.865826227772139e-01   -5.278636825701119e-02   +1.767907381428311e-01   -1.128777917439986e-01   -2.702352465189747e-02   +2.999400220149106e-01   +2.234570828630504e-01   -4.090995751792884e-02; +4.094326954227925e-02   +1.886772846972670e-02   -1.005163764809420e-01   +1.775133350454068e-01   +1.102924483836022e-01   +2.223322110622293e-01   +6.988581371237128e-03   -1.770192735332015e-01   -1.198958677890521e-02   -1.765487985101683e-01   -1.269910156083114e-01   +1.442970925102504e-01; -1.848209278684857e-01   -1.761981216064263e-01   -2.959006956914686e-01   +1.507812080282978e-01   -9.801361064062347e-02   -1.244738796981928e-01   +1.008154122989928e-01   -1.855441215514967e-01   +1.797983498777052e-02   +1.228403583410220e-01   +2.085912846028443e-01   -1.086209785022235e-01; -3.256400662852374e-02   +7.896753699755978e-02   +1.107732939767181e-01   +5.266629643148046e-02   -2.928145080202474e-01   -2.264765538801437e-01   -2.541555159870518e-01   +4.229415623221496e-02   -2.110428643082167e-02   +9.512445409105504e-02   -4.141365358850088e-02   -2.877926661449824e-01; -1.448630762534697e-01   -1.951488681557465e-01   -3.821586730496859e-04   -2.259243236088631e-01   +1.381270424742101e-01   -2.417969738093753e-01   +1.536001628830966e-01   -7.786219872957151e-02   +1.893765978144819e-02   -1.326712122603914e-01   -6.208115434937424e-02   +2.303652516906709e-02; +1.146978012440111e-01   -2.741482028685435e-01   +1.983759238116688e-01   -2.525359851546475e-01   -2.893638872412291e-02   +2.378997529620545e-01   +2.247470931287719e-01   +8.662887015016245e-02   +1.650713132304573e-01   +1.538655252316063e-01   -9.443947153974416e-02   +1.185952441199038e-01; +1.035385671411855e-01   +8.049441616777432e-02   -1.180387322358220e-01   +1.989417672945825e-01   -1.268567539202467e-02   +2.320171064629915e-01   -1.288378093238298e-01   +6.963978051185128e-02   -1.587240173227445e-01   -5.013505592968074e-02   -2.489007462141885e-01   +4.536523312374827e-02; -2.321676756930070e-01   +2.293169232582767e-01   +8.192629776373576e-04   -2.191666332045703e-03   +2.685029582571855e-01   +3.088291449485857e-01   -2.723191117473167e-01   -7.123799395226850e-02   +1.886726180032229e-01   +1.839287782956676e-01   -2.982839570595257e-02   +1.862043300286053e-01; +2.491536804794575e-01   +1.697182859750391e-01   +1.727858635580606e-01   -8.751344287848881e-02   -6.277443214439592e-03   +3.289086897811860e-02   -2.514255233831784e-02   -1.697388297742347e-01   +2.782416743850081e-02   -2.349042954841335e-01   -1.726581798037582e-01   +2.818559945268945e-01; +3.682645463860941e-01   -6.446264038728403e-03   -2.319753695128083e-01   -3.152705933157349e-01   -1.761837036729886e-01   -1.972036205723958e-01   -6.135328884775112e-02   -3.594778133099508e-01   -2.460439972106979e-01   +2.161115434056981e-01   +2.478781724807815e-01   +1.888287765925555e-03; -5.292489853874351e-03   -9.664536761274599e-02   -1.447562037792647e-01   +8.453352165863515e-02   -2.399978396138141e-01   +5.709011425328821e-02   +6.822068008769447e-02   -2.510829464816723e-02   +1.565795068238368e-01   -1.389615861203368e-01   +2.376583593837040e-02   -9.642792131284939e-03];
L2E_Input1_iAMPA_netcon = [-2.092642261211652e-01   -2.082678842293000e-01   +1.526687777657814e-01   +2.439846426676246e-01   +2.892518821923837e-02   +1.653153751276331e-01   +3.525229021603023e-02   -2.749779274544064e-01];
L2I_Input2_iAMPA_netcon = [+7.147897461784884e-02   +1.145196766088437e-01   +1.234391385195587e-01   -1.093582160520182e-01   -7.388728027255821e-02   -3.725329488472262e-03   -2.449964671011616e-01   +2.635751212755486e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
