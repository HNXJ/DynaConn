function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.435483340102714e-01   +1.167429822600144e-01   +4.198684772973276e-01   +4.783913965115723e-01   +5.792534447229855e-01   +5.364175008643776e-02   +7.711897742630291e-01   +7.245237565995899e-02   +6.056838749699283e-01   +4.682748996639216e-01   +2.968415105404356e-01   +9.198177027925196e-01   +3.477129491573104e-01   +2.527895199055015e-01   +2.294686723683704e-01   +9.810977348828948e-01; +2.994057652372385e-01   +7.357242167709027e-01   +9.072938732350841e-02   +5.342688831138753e-01   +5.673307598715798e-01   +9.514010387865192e-01   +7.479513951101626e-01   +7.960664058548559e-01   +6.749914597377492e-01   +1.334957952999159e-01   +3.467028872768142e-01   +9.718180449692372e-01   +3.189929717989586e-01   +3.067270607315604e-01   +7.666779534172685e-01   +3.279874775193785e-01; +4.960304778262697e-01   +3.131181662840000e-01   +7.753674372274211e-01   +1.000000000000000e+00   +7.435517409369743e-01   +3.116843876617620e-01   +2.654882486244368e-01   +6.934818042491629e-01   +3.224720181320654e-01   +8.841699840986060e-01   +6.099646576155816e-01   +4.763169120012513e-01   +1.393198315224358e-01   +9.760106404756481e-01   +3.322061361375553e-01   +3.334271691349762e-01; +8.361433939236237e-01   +4.087557104929493e-01   +3.123351030099645e-01   +1.665640502572971e-01   +4.171603648290922e-01   +2.539575035744301e-01   +4.116169280642417e-01   +4.721819286219020e-01   +8.043806724156590e-01   +1.329613021581837e-01   +2.207578507710695e-01   +2.057203104376413e-01   +3.441071563734917e-01   +3.958285203577479e-01   +8.575138834912890e-01   +8.320842286099801e-01; +2.587030971491064e-01   +7.159630313412073e-01   +6.338346105333166e-01   +4.676501155558193e-02   +5.946486609144235e-01   +2.260073519562545e-01   +7.956655746763085e-02   +3.580651049261260e-01   +2.246108692783332e-01   +6.977517278747191e-01   +5.837131128074673e-01   +8.422632012590774e-01   +5.139539508717118e-01   +1.266375327102759e-01   +5.788366967757229e-01   +2.386352286332770e-01; +8.021818440747287e-01   +6.534016303256585e-01   +5.152527330335948e-01   +9.496677348934454e-01   +1.932283738683210e-01   +6.881651007769614e-01   +4.031346049695289e-01   +9.730084219563245e-01   +3.983110341783545e-01   +6.616008569866202e-02   +2.765111053555786e-01   +3.986407881320180e-01   +8.572329719618473e-01   +8.242792410586084e-01   +1.230785162220238e-01   +3.771216484416299e-01; +1.001293538166514e-01   +4.441378376891272e-01   +4.318801114127557e-01   +6.139439841432097e-01   +1.765115976181039e-01   +9.486651216897218e-01   +3.698351641014084e-01   +1.814396437494271e-01   +1.068796711890274e-01   +1.366680015507499e-02   +9.324625151578084e-02   +5.607172909641377e-01   +3.486668863214656e-01   +2.359678694703289e-01   +4.866038596547210e-01   +6.329309267923354e-01; +3.498968495841410e-02   +3.208671793647396e-02   +4.418898059228631e-01   +7.623804203914849e-01   +1.958928622891097e-01   +8.719074247538064e-01   +1.360037410238329e-01   +7.919077244191350e-01   +5.452114441594159e-01   +4.784299955320457e-01   +4.278095301711122e-01   +2.236216462900306e-01   +5.615339120879691e-01   +9.353991687644458e-02   +7.840169337446549e-02   +2.975524935308828e-01; +2.643123953212324e-01   +6.697126591927666e-01   +5.407427978996822e-01   +4.933971697540351e-01   +8.609309953586225e-01   +3.170292598884571e-01   +5.348211676817403e-01   +6.390688668802498e-01   +1.599630502420623e-01   +9.122371390225212e-01   +8.107673375676335e-01   +2.090550412001350e-01   +9.219538703191155e-01   +4.979347613280220e-01   +8.971307834999218e-01   +3.473061747823272e-01; +9.283862962321271e-01   +7.739082910435314e-01   +7.682869330299622e-01   +7.681511880042095e-01   +3.659053252036651e-01   +7.034761411454116e-01   +9.265110100755668e-01   +5.918508141814007e-01   +9.266058996234934e-01   +4.785497383404421e-01   +1.171705829860022e-01   +7.001764254860856e-01   +1.180081544123003e-01   +7.484888502700660e-01   +9.420033711520848e-01   +7.471169646985850e-01; +7.660061900615865e-01   +4.980191708207934e-01   +8.225008577062436e-01   +2.771576126210146e-01   +3.084359000036908e-01   +3.209299609728210e-01   +3.550445938012727e-01   +6.649148588933103e-01   +8.412066384979995e-01   +4.255564340046104e-01   +6.277462430855699e-01   +4.114295636022907e-01   +4.792415742227916e-01   +6.000795627161744e-01   +2.763177363429722e-01   +5.694074216249759e-01; +6.198634370417665e-02   +3.199087721319217e-01   +7.962167913031142e-01   +5.088939219864637e-01   +7.378038768156885e-01   +6.691653279421846e-01   +9.568315655392950e-02   +2.915486315173323e-01   +7.071818468964083e-01   +8.032688895446441e-01   +7.009544829989273e-01   +9.629806831296309e-01   +9.491453083060187e-01   +1.429689585853830e-01   +7.135263586799152e-01   +9.968195314056560e-02; +1.380834210252874e-01   +5.239624139440048e-01   +8.224287632600863e-01   +1.471230422119284e-01   +2.645806489745557e-01   +5.536573312491811e-02   +3.458815903750641e-01   +1.164223972530776e-01   +5.448408098840359e-01   +5.787430928223330e-01   +2.083832144414431e-01   -8.679849644252240e-03   +5.985358256476487e-01   +7.658172228458286e-01   +3.384349746381557e-01   +3.232349962732152e-01; +1.081610876376398e-02   +9.758205701688180e-02   +7.063410291084468e-01   +8.747309674274324e-01   +2.324731647005257e-01   +3.774235086397240e-01   +1.256621296092003e-01   +4.977907429825512e-01   +3.569999106028541e-01   +2.307609165747535e-01   +5.079024204400266e-01   +1.325002744705573e-01   +1.982894534604469e-01   +8.455979118877143e-01   +3.347597855791932e-01   +9.613571768390201e-01; +5.942849986116502e-01   +9.298155404008668e-02   +6.695369462172641e-01   +9.661217834261044e-01   +2.867205932636018e-01   +1.779812747151473e-01   +7.864507658083429e-01   +6.268836131405561e-01   +8.836038819878237e-01   +4.802053924870076e-01   +5.108912183177593e-01   +2.149731947143274e-01   +9.261843401271461e-01   +7.997958549293464e-01   +8.665335308358757e-01   +1.171456363945455e-01; +1.501968649190047e-01   +5.766045920187248e-01   +5.123302392327703e-01   +8.692166652686726e-01   +7.098286731843477e-01   +5.009939270782573e-01   +6.549833848373838e-01   +3.806977576612456e-02   +7.583402183899206e-01   +3.201404898050434e-01   +6.897839645080466e-01   +3.434833241822321e-01   +9.579267338845830e-01   +1.280682379920910e-01   +4.246527688279382e-01   +5.873274539771469e-02];
L1E_L1I_iGABA_netcon = [+2.665975591004323e-01   +9.761677352380831e-01   +2.062308346436171e-01   +3.869782789890642e-01   +3.047827672517752e-01   +1.127934539774262e-01   +9.559361397744605e-01   +2.523608849904800e-01   +1.961784300703382e-01   +7.158779424956510e-01   +6.207258954439698e-01   +4.110387592217779e-01   +3.043574077674095e-01   +2.542483389516915e-01   +1.730041332817866e-01   +9.594882685266438e-01; +4.503643518907003e-01   +2.711428767679470e-01   +8.413078148429334e-01   +3.185109243719083e-01   +5.159376972604121e-01   +8.574461059196282e-02   +4.969218406375861e-01   +1.785154640698908e-01   +2.587950588413304e-01   +3.980158919413691e-02   +9.127157501977250e-01   +6.045287185914270e-01   +9.680012040359569e-01   +3.022257073937318e-01   +1.614720313658461e-01   +1.970507915069300e-01; +3.567898543758718e-01   +4.441178483533816e-01   +1.208395073064579e-01   +1.702084365001716e-01   +3.571787227816044e-01   +5.607280570003792e-01   +3.625943320667011e-02   +1.427060061008812e-01   +9.771688090592345e-01   +5.799454521090274e-01   +1.982833486102577e-01   +3.746424237601016e-03   +4.271026586029656e-01   +6.802650747436203e-01   +2.282138611310905e-01   +7.051000023630222e-01; +8.987010741059246e-01   +3.624116343407967e-01   +6.509049196101880e-01   +2.824248560473755e-01   +6.620693463676725e-01   +2.137662248353517e-01   +6.971829888992650e-01   +5.569892010767784e-01   +7.240354384673736e-01   +1.216132865256933e-01   +1.089451197608298e-02   +7.888100197198231e-01   +2.361337679092579e-01   +6.898370713141919e-01   +6.461962055835093e-01   +3.787868326671945e-01; +6.956077881975703e-02   +6.124331889833109e-02   +3.638461077345583e-01   +9.426858379238979e-01   +5.366823319887185e-01   +5.486414914981754e-01   +2.673168401180265e-01   +2.734655428639044e-02   +8.495400578203350e-01   +2.363197896282003e-01   +8.737291130666158e-01   +1.424100346612139e-01   +2.985425295044738e-01   +4.787253825363949e-01   +7.023848015879813e-01   +4.432277990389200e-01; +1.887385645927344e-01   +1.781500878584779e-01   +1.216567963970389e-02   +7.798172875152151e-01   +1.203645198486342e-01   +9.912461690289613e-01   +5.120648858514896e-02   +9.259442006349130e-01   +1.088490876892798e-01   +6.055795277579936e-01   +9.190330471549173e-01   +3.738368034546616e-01   +5.427940831907396e-01   +2.223598176186733e-01   +6.189648807890960e-01   +4.010326607723865e-01; +9.949094221551690e-01   +1.210253012078188e-01   +2.367819720190862e-01   +5.560517150621728e-01   +7.701251913816712e-01   +4.060641275911540e-01   +3.245380491111900e-01   -6.968056573931950e-03   +8.228932438714505e-01   +2.376922376417385e-01   +4.491733236671335e-01   +7.865324297836320e-01   +2.534261618114285e-01   +2.283261765292949e-01   +5.681873120195986e-01   +4.692506995500342e-01; +4.021610300716182e-01   +1.004675743607172e-02   +2.149079060443668e-01   +3.358549291870805e-01   +2.483284830670470e-01   +6.797436436089364e-01   +9.834352757490719e-02   +9.022137595735860e-02   +3.606412169856902e-01   +6.494567868284582e-01   +8.090797613939336e-01   +3.271251866305243e-01   +8.496689853962062e-01   +9.729810926917509e-01   +4.444877676847335e-01   +4.923037106471014e-01; +6.939830376695200e-01   +8.974718103517094e-01   +5.307855480103519e-01   +7.849163351907383e-01   +6.517733065355862e-01   +1.702584487474107e-01   +5.911784209985390e-01   +2.073430348967056e-01   +9.047364426259487e-01   +7.024615392361295e-01   +2.145902371905672e-01   +7.047202128525938e-01   +7.183606192303090e-01   +2.422152620180383e-01   +2.105200041953003e-01   +1.797504817516555e-01; +6.344251763808768e-01   +3.974377576306050e-01   +6.420571612807500e-01   +4.447680141806281e-01   +7.317671074250502e-01   +9.584272290562623e-01   +6.410195673672975e-01   +9.395138088037233e-01   +6.092779711318168e-01   +7.006829183739105e-01   +1.563369439521764e-01   +5.601820832788359e-01   +3.530449138661519e-01   +7.419931200666553e-01   +9.268082872443539e-01   +5.308245901529985e-03; +6.602273672768149e-01   +9.399977399818903e-01   +6.977704315078581e-01   +5.485788003453932e-01   +7.113102327758563e-01   +5.530038028314131e-01   +3.866989122786023e-01   +6.781448252928877e-01   +3.318870500747492e-01   +8.698916100391410e-01   +8.117180465242559e-02   +4.193461325227881e-01   +7.846105335912960e-02   +7.550839947764030e-01   +9.297759324849317e-01   +4.386322318829068e-01; +2.695552432396714e-01   +6.343666184501240e-01   +5.015206534414046e-01   +6.524862326167482e-01   +3.686678383643680e-01   +9.354095002002165e-01   +2.988506073903754e-01   +8.884697154647391e-01   +2.652920908358435e-01   +5.949124199289065e-01   +8.932991565242351e-01   +7.637097107253179e-01   +5.093413233390015e-01   +9.187337102125447e-01   +9.241490666288286e-01   +2.366784874521499e-01; +9.692616075218272e-02   +8.623290385685450e-01   +4.220855582759101e-01   +3.585995499093464e-01   +9.759156432890252e-01   +5.310362480633746e-01   +7.462206497555772e-01   +6.401364709906808e-01   +7.670830660180646e-02   +2.987233782655833e-01   +3.861592463315101e-01   +7.358058184139086e-01   +2.196708645677963e-01   +6.276603121533791e-01   +6.462200240289094e-03   +5.071196728912847e-01; +3.929524127188770e-01   +7.009273030971971e-01   +6.497429704474776e-01   +7.211999771177082e-01   +8.320318189041134e-01   +4.770937551136966e-01   +8.863671360566783e-01   +9.738365211934441e-02   +3.955775038568875e-01   +3.082147923659513e-02   +5.501918120749354e-01   +2.271559619291499e-01   +7.688893724020612e-01   +6.602452278171138e-02   +5.404278236944718e-01   +2.166304720863650e-01; +9.929278136730558e-01   +7.212878049593147e-01   +2.248805144945540e-01   +5.940916884432221e-01   +6.540759605861234e-02   +5.541058464530112e-01   +1.779087389659028e-01   +8.806234149449370e-01   +5.489196242826778e-01   -4.912528171925027e-03   +5.651314793228509e-01   +1.000000000000000e+00   +3.978310228144409e-01   +2.644452613381331e-01   +2.632810753281645e-01   +4.275902836469735e-01; +9.465352103337088e-01   +4.834243192764603e-01   +5.746859465301087e-01   +9.235482381600499e-01   +4.786951585691783e-01   +3.149988807102520e-01   +3.658220539634628e-01   +6.363435802553795e-01   +2.749210352941955e-02   +3.484268820359561e-01   +4.016737237422643e-01   +2.665976303589918e-01   +6.291086002232721e-03   +5.680193221257093e-01   +5.625660503018485e-01   +3.567774774615066e-01];
L2I_L1I_iGABA_netcon = [+5.764754065410893e-01   +7.993727649920634e-01   +8.447873115250664e-01   +9.683922966236753e-02   +2.917398139544225e-01   +4.912938722457387e-01   +9.544457968828666e-01   +1.400443867144210e-01; +5.228552287548071e-01   +2.615976621366090e-01   +2.665396846418346e-01   +5.792551886014670e-01   +8.496737375615422e-01   +3.795595744228002e-01   +9.045093752075378e-01   +7.538806015363699e-01; +6.706314618602540e-01   +7.069834156462873e-02   +8.533796518413123e-01   +4.359303024740644e-01   +1.425624146426588e-01   +3.818063451868816e-01   +6.539524422047238e-01   +7.515938246601704e-01; +2.679553917353208e-01   +6.842981268307213e-01   +4.751676931933345e-01   +3.356025060395209e-01   +9.311768776175132e-01   +4.251126926399406e-01   +3.310184658557589e-01   +4.491552828990862e-01; +4.295997430191264e-01   +8.435671710646243e-01   +3.047213083629324e-01   +3.644398359965979e-02   +9.055576645415953e-01   +4.148061375725482e-01   +3.747074540178772e-01   +7.549422943831693e-01; +7.199310629614282e-01   +8.559263896682694e-01   +8.152764347688333e-01   +9.421663107735795e-01   +8.430882694116679e-01   +1.682428319495344e-01   +2.349260462848110e-01   +5.533472800884346e-01; +1.025948658142657e-01   +4.079650620832427e-01   +4.752386598341782e-02   +9.557164874336426e-01   +4.640297822390619e-01   +2.050413090103451e-01   +4.603793549264095e-02   +2.861409142511713e-01; +4.913325374821292e-01   +1.567626051457361e-01   +8.603126972861209e-01   +7.256323211057034e-01   +5.125245756155881e-01   +2.769432271595797e-01   +9.941306143280947e-02   +6.668477683371147e-01; +1.726659935978162e-01   +1.079709676863044e-01   +2.335344017281282e-01   +6.784893951271982e-01   +1.950218412979971e-01   +4.133455078374325e-01   +7.518318056638413e-01   +5.667714332209762e-01; +2.356011313334484e-01   +6.194841931007594e-01   +3.633297977740649e-01   +4.104257704419544e-02   +7.964182296237081e-01   +1.355303695774922e-02   +1.814550546190964e-01   +5.997137243153462e-02; +1.170081530879465e-01   +2.331077379429742e-01   +2.696264344619299e-01   +8.456444588853936e-01   +7.651959931527090e-01   +4.930919081386516e-01   +2.833244794399517e-01   +6.302902685923415e-01; +2.884810307926478e-01   +3.090342508208476e-01   +1.961959851695024e-01   +2.950069271441954e-01   +2.856026890697545e-02   +1.453720186620194e-02   +8.350168184141007e-01   +4.086154142732634e-01; +7.182335677678156e-01   +3.653909606084720e-01   +7.357917375293676e-01   +5.600351362234186e-01   +3.273759002225941e-01   +2.760420050020538e-01   +6.436857827116056e-01   +5.291427716043793e-01; +5.042739289416764e-01   +7.730994353194334e-02   +1.427405756544110e-01   +9.963031243829712e-01   +1.008343451073448e-01   +5.683424826425978e-01   +7.864420601439420e-01   +4.110273989231277e-03; +9.212825888013048e-01   +7.666274820827922e-01   +9.884440149041253e-01   +7.654224051230843e-01   +5.548344308903706e-02   +7.203344019320314e-01   +5.825439417741562e-01   +9.870098724309195e-01; +6.565961323984962e-01   +8.123993660176976e-01   +9.697465154665142e-01   +8.988128000367154e-01   +2.680925416227988e-01   +2.032735341306943e-01   +9.448652246645036e-01   +8.212773577427650e-01];
L1I_L2I_iGABA_netcon = [+2.179298165729054e-01   +2.599029548867789e-01   +5.634534232709822e-01   +4.919719658479252e-01   +4.569037317303498e-01   +8.053951369288185e-01   +7.686115669199465e-01   +4.019648133867298e-01   +7.472641145507569e-01   +4.763738124191351e-02   +2.282430706844517e-01   +5.990161965320703e-02   +9.260926379958548e-01   +1.699045528437845e-01   +5.255414805651080e-01   +7.599016134968365e-01; +9.597379401881275e-01   +6.972457311378795e-01   +6.365603909477155e-02   +1.847017541771043e-01   +8.306541834831763e-01   +6.870049030007129e-01   +5.726531344743149e-01   +3.231200479496089e-01   +8.763696384943528e-01   +8.990658202893276e-01   +3.305444369111623e-01   +8.500704742316160e-01   +9.476359823597992e-01   +9.079463702862874e-02   +8.319248922864265e-01   +3.871780137976694e-01; +4.277762258344123e-01   +4.085659215194860e-02   +3.588203381000144e-01   -1.471396533583421e-02   +3.328854408479194e-02   +4.057925760082693e-01   +2.081594127798588e-01   +7.754095895895627e-01   +1.031494026046424e-01   +7.503808128988728e-01   +9.736730030994377e-01   +2.069000159655602e-01   +1.508554238078736e-01   +3.927984268446953e-01   +5.437106344603595e-01   +3.088233420359984e-01; +1.668034582430880e-01   +6.686599991076903e-01   +1.858635616223044e-01   +9.276337504542220e-02   +2.530876006176446e-01   +4.756841309066560e-01   +8.405832583308389e-01   +7.826801352003158e-01   +5.704473263064817e-01   +5.361146491052272e-02   +1.016662792029498e-01   +9.517957379347759e-01   +2.529870637293685e-01   +4.891008932469457e-01   +9.488562346480738e-01   +3.703852680289687e-01; +7.323980045563836e-01   +8.265588244698210e-01   +1.974028778935200e-03   +9.112132696786208e-01   +7.862065128345933e-01   +7.452698964728668e-01   +7.908131611538267e-01   +5.125747667981673e-01   +9.553854695960201e-01   +7.057098244421520e-01   +6.762908850340360e-01   +7.490566997863486e-01   +6.137953127165515e-01   +5.594403156018075e-01   +1.641778039437605e-01   +2.389227255154692e-01; +2.616513431998713e-01   +2.847856081252397e-01   +6.918538111017529e-01   +2.817924748213040e-01   +5.563011221239826e-01   +5.437212587111202e-02   +6.991219277373171e-01   +5.436947015906293e-01   +7.579113007253329e-01   +3.340237094842853e-01   +1.292227244208224e-01   +3.461216259983853e-01   +7.822943851075507e-01   +8.301313600120434e-01   +8.288329174778771e-01   +1.563348013454827e-01; +8.491868875553733e-01   +4.961857935119495e-01   +3.955719026469196e-01   +8.682129799890136e-01   +5.245698670530275e-01   +7.781356652787543e-01   +9.872979729293452e-01   +6.330571139563366e-01   +3.736008267350253e-01   +5.539626516469197e-01   +6.395697712588885e-01   +3.027786243958937e-02   +2.846873285418569e-01   +5.727913322724505e-01   +9.146666774485956e-01   +1.352255636608489e-01; +4.457977051982337e-01   +9.742392267791111e-01   +9.344080046500468e-01   +1.522753932349226e-01   +7.990193734480178e-01   +7.785041153717289e-01   +3.635423666624502e-01   +5.233705490478915e-01   +1.307555487596365e-02   +5.574151343755436e-01   +5.783416673834584e-01   +4.525526537451542e-01   +8.778900550937169e-01   +4.886319583534575e-01   +3.212371832688010e-01   +4.456206709613591e-01];
L2E_L1E_iAMPA_netcon = [+4.855630029599657e-01   +5.638064197322893e-01   +4.789544576666936e-01   +4.828251259658243e-01   +6.571308177257617e-01   +4.576451477924000e-01   +1.583065967860530e-01   +9.822739039336610e-01; +8.061196841477556e-01   +8.119137978755723e-01   +5.846693953204332e-01   +1.632740962096416e-02   +4.557807132569996e-01   +9.045371047435113e-01   +8.091619786606311e-01   +1.763804423702150e-01; +5.704879610323432e-01   +7.469864577562757e-02   +8.592536867534426e-01   +5.183356596069780e-01   +6.995939433304454e-01   +1.259332011156278e-01   +6.153528610306823e-01   +3.901496389629965e-01; +5.405816904539589e-01   +9.249564206077143e-01   +9.659170307925334e-01   +3.621641015081412e-01   +3.230072169291460e-01   +5.388574296701105e-01   +8.594533286679749e-01   +1.682677264732149e-01; +6.182142570315690e-01   +5.600095543740772e-01   +7.192286380688435e-01   +3.043098155352713e-01   +4.294970442203463e-01   +2.668766629470060e-01   +3.083841555284330e-01   +9.581782661580798e-01; +2.805646961010690e-01   +6.724475387381561e-01   +7.281951392945705e-01   +6.524751546200303e-01   +1.768191450346531e-01   +9.926596880475996e-01   +1.228648832247257e-01   +3.356510380709939e-01; +3.589234392060142e-01   +7.898818180050665e-01   +2.645568918997615e-01   +8.637914941906999e-01   +6.693904456149395e-01   +8.196286224266102e-01   +9.805811057692777e-01   +2.507417813881309e-01; +1.660939279960280e-01   +6.984124760382507e-01   +3.795816239312265e-01   +4.728831408495311e-01   +7.445337417632186e-01   +2.615224524492851e-01   +9.990159724536626e-02   +4.138824097550451e-01; +6.029023915655125e-01   +4.710298622701779e-01   +9.066180825648281e-01   +3.570407639030199e-01   +6.882614463276655e-01   +1.000000000000000e+00   +6.707634653462315e-01   +3.978240824366195e-02; +2.227496344029395e-01   +6.068912762823703e-01   +5.510671735583204e-02   +5.192990490636893e-01   +7.066072435410957e-01   +1.442491045276031e-01   +6.300444962725763e-01   +8.131459865051841e-01; +3.157135557378128e-01   +3.246108555120758e-01   +9.048263517490417e-01   +5.981178671177180e-01   +1.317901150460287e-02   +7.307871505212175e-01   +2.896443079381568e-01   +3.178715690862056e-01; +8.466879667598021e-01   +9.553341901020360e-01   +3.905362347570589e-02   +5.364205157503675e-01   +8.358413114231201e-01   +8.339679908781412e-01   +7.051466394446703e-01   +3.236674785524077e-01; +6.908946440864013e-01   +2.311141066441991e-01   +6.440691298756156e-01   +2.974510485345287e-01   +1.922448324095473e-01   +4.673615600768569e-01   +4.186765732379096e-01   +5.135259180054098e-01; +5.729479517899347e-01   +3.736366105451744e-01   +5.815165935368771e-01   +5.242014763545967e-01   +6.990745427300694e-01   +9.358786138697336e-01   +7.605900375285800e-02   +4.534024529384263e-01; +1.866604537708256e-01   +6.347467695403082e-01   +5.157958210754433e-01   +5.102369807271921e-01   +4.175372265502410e-01   +6.907076774324423e-01   +4.755567191613047e-01   +1.217951578543591e-01; +6.256566966934949e-01   +8.615244496541456e-02   +4.110869916881682e-01   +7.170037250117722e-02   +3.197068246124660e-01   +7.777611938692854e-01   +9.388566505518010e-01   +4.257372795396224e-01];
L1E_L2E_iAMPA_netcon = [+5.564667571266858e-02   +4.980768614921642e-01   +1.390050723577058e-01   +8.572134647796783e-01   +1.169848752077606e-01   +2.191568110564235e-01   +3.931703026968562e-01   +5.175967468149190e-01   +8.296562733312060e-01   +5.065331573572989e-01   +1.555224579215803e-01   +2.162047751029466e-01   +4.201383599355671e-01   +6.948292725730448e-01   +3.607305145124597e-02   +7.121513710928168e-01; +3.579650735837333e-01   +6.504469631012997e-01   +6.088669194466407e-01   +4.799145032003060e-01   +4.645714846623959e-02   +8.500706997513727e-01   +1.950562492200139e-01   +4.911523195558235e-01   +3.276775975578175e-01   +9.820443923974763e-02   +9.442714585981177e-01   +3.634059975308066e-01   +3.210702480141424e-01   +6.212033732913382e-01   +8.748650236234964e-01   +3.093674571251020e-01; +5.276520646538067e-01   +8.577698805692439e-01   +4.610695779216098e-01   +7.781377826395514e-01   +7.899107686148624e-01   +7.729397289395591e-01   +7.825191111719988e-01   +6.701488435229014e-01   +3.036341079860412e-01   +9.262321929314313e-01   +4.261737411297042e-01   +5.243682493228096e-01   +3.928952484353198e-01   +8.894963266728638e-01   -8.709855009686915e-03   +3.283120396555437e-01; +3.287819533352953e-01   +5.165611348388225e-01   +3.769216450972843e-01   +8.150770848836478e-01   +4.131856049432210e-01   +9.635272548794698e-01   +7.629484233878853e-01   +6.203211829058812e-01   +3.074762662653121e-01   +1.213773284781615e-01   +1.937214506028633e-01   +9.254410682424735e-01   +8.148439579214325e-02   +4.090857127263070e-01   +6.796097453703304e-01   +9.185617650920035e-01; +7.469892359549578e-01   +9.418843620776604e-01   +8.607010813990456e-01   +1.602436754001743e-01   +2.467566758504016e-01   +6.783434303659653e-01   -9.947415116898320e-03   +2.650793877425856e-01   +3.562160782222125e-01   +2.093076671556837e-02   +6.448127278946164e-03   +4.313065848768308e-01   +5.026254942339852e-01   +9.840195967207268e-01   +4.998091907554829e-01   +3.469234586898352e-01; +2.803162081067551e-01   +5.080945493347843e-01   +7.508757475901624e-01   +6.318482109523743e-02   +5.036008827263269e-01   +9.763104754743940e-01   +6.069848352441095e-01   +4.636724336245911e-01   +1.978189628368753e-01   +1.027219936082015e-01   +6.799003273523485e-01   +4.069815937003375e-01   +5.021646443575379e-01   +8.154782137060371e-01   +3.298211003891345e-01   +5.782867719990578e-01; +7.810045566388563e-01   +2.365797241842897e-01   +9.760975635930367e-01   +3.612552749047050e-01   +5.794039734383631e-01   +9.594607259835228e-02   +5.248779144857848e-01   +8.871384776356365e-01   +9.219922286263246e-02   +4.394864734845585e-01   +9.981659260533637e-01   +3.743002169630218e-01   +6.496713756840695e-01   +4.071028533425493e-01   +9.795377624089127e-01   +1.000000000000000e+00; +6.187408410382723e-01   +4.233898209061235e-01   +6.535156466071053e-01   +7.645520708447522e-01   +5.323850551785793e-01   +4.667213274360429e-01   +2.658325594949750e-02   +3.036105700226613e-02   -6.104414798626499e-03   +7.047177494752631e-01   +1.975421321614524e-01   +4.320937282223296e-01   +9.138588496674532e-01   +2.297055624669388e-01   +4.277298904020866e-01   +9.298835065539137e-01];
L2I_L2E_iAMPA_netcon = [+2.491038920755719e-01   +7.257625765598779e-01   +6.887295549329773e-01   +9.937565772101400e-01   +4.718168216955961e-01   +6.287364263107935e-02   +5.248249934466833e-01   +7.941724418957342e-01; +8.326955593471725e-01   +3.097482298139241e-01   +2.849777129399648e-01   +8.517208417266456e-01   +6.060740787781443e-01   +3.165380887178407e-02   +9.905757953454050e-01   +6.421285166740640e-01; +7.626770918317614e-01   +8.928041079295731e-01   +4.260165463627052e-01   +5.404430724758237e-01   +1.572433203761743e-01   +3.715988851230449e-01   +4.860944621360364e-02   +8.759097034487096e-01; +5.298644766279902e-01   +1.465864101735583e-01   +3.924598848679252e-01   +6.244791241531629e-01   +7.546185161695133e-01   +6.327372276456847e-01   +7.966746204243926e-01   -3.590674173193736e-03; +8.919217480754750e-01   +6.919583064768073e-01   +7.580327026916792e-01   +5.837239339264654e-01   +8.941965532790989e-01   +3.762219110707130e-01   +2.992256854839592e-01   +6.580466357531448e-01; +5.284757441205572e-01   +8.355267927723204e-01   +1.947088479761502e-01   +5.136665336964184e-02   +3.995500320130261e-01   +1.470794231542736e-01   +8.934138099110664e-02   +5.762243676847918e-01; +9.057528985557608e-01   +3.363850547229771e-01   +4.730135354983446e-01   +4.270044761570266e-01   +9.129599736059950e-01   +9.389663527240292e-01   +5.316912421734233e-01   +3.273281333381222e-01; +1.583906181657968e-01   +3.083705251014879e-01   +1.129863938935541e-01   +4.406830548631315e-01   +8.200016917588785e-01   +5.817954997985560e-01   +5.052288621262280e-01   +6.637690160672477e-01];
L2E_L2I_iGABA_netcon = [+6.321333131812296e-01   +6.416674880798204e-02   +7.519982665203300e-01   +6.178069662254386e-01   +1.318048668770196e-01   +1.108344972614723e-01   +7.597415845409746e-01   +4.292087421397923e-01; +6.754497340414770e-02   +4.756960006931915e-01   +4.020119540021809e-01   +4.202904571422573e-01   +9.790940880052101e-01   +7.278691058371551e-01   +1.979966158614932e-01   +8.350685339767787e-01; +4.922421604834364e-01   +9.119146329462317e-01   +3.396528387783349e-01   +5.391995583775997e-01   +2.152913586632939e-01   +3.697419399799587e-01   +5.961861442311640e-03   +2.851603556974155e-01; +1.155421638205753e-02   +2.008785967491986e-01   +4.910414679280034e-01   +5.338981780813857e-01   +8.274796397690412e-01   +7.144179735342812e-02   +6.508756347494227e-01   +1.535542954225443e-01; +5.004870454644968e-01   +7.915141293668129e-01   +3.321098693854120e-01   +6.080778870551801e-01   +1.361764635029394e-01   +1.662396879336066e-01   +2.688095100475467e-01   +8.568180981616077e-01; +9.069132876988191e-02   +4.432352638531660e-01   +5.477413409678679e-01   +1.105684001188765e-01   +9.032363441969034e-01   +1.130125756827089e-01   +5.384586073511379e-01   +2.374304629595521e-01; +1.592286003947998e-01   +6.273537294636314e-02   +3.213867424867221e-01   +7.324842091972841e-01   +2.161069030602920e-01   +8.569217432475353e-01   +5.814427359234449e-01   +8.690527716822147e-01; -4.705509828482762e-03   +2.586495063393610e-01   +5.000628367870138e-01   +4.440443420817962e-01   +6.725039214247999e-01   +7.919467353995109e-01   +1.514489301669403e-01   +3.627644771793410e-02];
L3E_L2E_iAMPA_netcon = [+2.266004669474544e-01   +6.990035651023003e-01   +5.197187771501651e-01   +1.791143675974741e-01   +6.072058838945341e-01   +1.061263320902798e-01   +9.736586585672015e-01   +8.611131388305173e-01   +7.140344073928998e-01   +4.051591183286101e-01   +4.985484247661991e-02   +1.130125352838790e-01; +7.413728192295188e-01   +7.444288352715760e-01   +3.977494631798307e-01   +5.782655852373526e-02   +1.243900381142253e-01   +8.207503634715034e-01   +2.598835227070004e-01   +3.312873578891805e-01   +1.637252959225356e-01   +1.036888520175608e-01   +4.026124132657266e-01   -3.037763039696339e-03; +4.391360254086718e-01   +9.132544305000126e-02   +8.654296702919660e-01   +7.699652403124022e-01   +3.647411984659568e-01   +1.000000000000000e+00   +5.789061069396024e-01   +9.590023623583891e-01   +4.879759364960033e-01   +8.910380573650652e-02   +3.361137733985189e-01   +5.961846971998727e-01; +1.711717311070948e-01   +6.015123474839774e-01   +1.094344077001104e-01   +2.872775642421323e-01   +6.646581788431943e-01   +9.916899116695385e-01   +6.888193378027538e-01   +2.797922518323880e-01   +7.532956353207958e-01   +4.634164401338092e-02   +1.002425163430041e-01   +2.256962177489786e-01; +2.648712178483295e-01   +9.635304273943530e-01   +7.042444539326851e-01   +1.956662738974827e-01   +9.603170418587691e-01   +4.523385879785694e-01   +4.990453950492453e-01   +9.134357898055082e-01   +4.725477258693608e-02   +1.494684221721327e-01   +1.833376426879290e-01   +9.744440407112351e-01; +2.193547140296328e-01   +9.028378558632036e-01   +1.916217829314611e-01   +7.445850073742341e-01   +6.806725491205150e-01   +4.494687358460931e-01   +5.692835925453885e-01   +5.133241260206642e-01   +2.901528374106685e-01   +5.689914501205102e-01   +1.457909938525954e-01   +4.459461226141203e-01; +2.868919368278765e-02   +4.811507326256312e-01   +6.267171581581891e-01   +3.709112802149571e-01   +3.625748813623991e-02   +3.718005425755823e-01   +8.680897922545471e-01   +5.693823588377502e-01   +8.937812327067347e-01   +6.099186113001205e-01   +2.666290446839232e-01   +6.687143402275474e-01; +4.899042974979209e-01   +1.102480366955811e-01   +6.059758015569268e-01   +6.531252146561211e-01   +7.080267015732791e-01   +9.052885815764378e-01   +3.861215749548754e-01   +8.065386155060211e-01   +8.846188407240081e-01   +6.960818616364135e-02   +8.036781723086064e-01   +2.457490493471501e-01];
L3I_L2I_iGABA_netcon = [+3.067386224572369e-01   +7.183793304970288e-01   +4.130871746400951e-01   +7.975496445409757e-01   +2.419703467403270e-01   +6.748014764743694e-01   +3.955213543488714e-01   +1.158589815591260e-01   +2.429592999603342e-01   +3.996578120350504e-01   +7.664711022771309e-01   +9.416131494128497e-01; +1.731941775059896e-01   +2.689755498945788e-01   +7.395753194443025e-02   +7.245581934936294e-01   +2.452511470053160e-01   +8.979055273118947e-01   +8.245090183294974e-01   +1.557330263023842e-01   +8.327707779550808e-01   +5.715858284568525e-01   +6.526910678908865e-01   +2.639009312790869e-01; +1.177457368475411e-01   +4.386427725740488e-01   +8.148567138316589e-01   +4.261676812281855e-01   +6.034383923329532e-01   +4.255095610059871e-01   +2.435458544119539e-02   +9.126440138466384e-01   +5.170149610221729e-02   +3.997753704232716e-01   +9.804788386889021e-02   +8.831702504688180e-01; +8.375441722655825e-01   +7.616019306027971e-01   +4.424954511061928e-01   +4.979738104568943e-01   +5.882796102526509e-01   +1.899662522152801e-01   +4.353394609521555e-01   +6.629861419674746e-01   +8.676369792134397e-01   +1.948510610516292e-01   +3.776184535974850e-01   +3.482331107916156e-01; +1.936344118013207e-01   +8.158697948484769e-01   +4.906791758594899e-01   +5.350340815950567e-01   +9.551626283727853e-01   +2.290519944539039e-02   +8.482208482291100e-02   +5.471347649691671e-01   +6.142311184173159e-01   +8.752637205729507e-01   +9.311598521404721e-01   +5.502547902580636e-01; +1.506397224175297e-01   +6.662856125065898e-02   -5.608370172839892e-03   +8.740776417535537e-01   +9.852208044313808e-01   +7.678650479098366e-01   +2.884313199666790e-01   +6.804439545128915e-01   +1.402319102452479e-01   +6.983802308120570e-01   +6.072199654959786e-01   +9.163544845701963e-01; +6.938968875508136e-01   +5.345425581594304e-01   +8.209161727985612e-01   +5.179639001162873e-01   +1.000000000000000e+00   +2.224480872611468e-01   +9.348771269222990e-02   +6.969139703581999e-01   +2.690560649438787e-01   +5.065863211079111e-01   +2.184260587962175e-02   +7.658882422891204e-01; +1.726277253407884e-02   +7.003664261406555e-01   +6.731940247537325e-01   +8.237856344418937e-01   +4.399465687781847e-01   +3.787351577358651e-01   +1.103838960720076e-01   +1.949089510216016e-01   +3.202711277729638e-01   +1.756580848763757e-01   +2.975497182934940e-01   +4.204930929335785e-01];
L2E_L3E_iAMPA_netcon = [+7.502543385062387e-01   +7.345391843208682e-01   +7.840464413173004e-01   +3.255818803784354e-01   +9.574808779737131e-01   +9.957928394227664e-01   +4.709029887818547e-01   +2.664030323144115e-01; +7.056178674913942e-01   +7.051503533479021e-01   +1.239956124955645e-02   +1.728035874249051e-02   +4.611491204946577e-01   +2.450779356844427e-01   +1.661384374512425e-01   +2.575050782731754e-02; +5.559344357078336e-01   +3.452891090670510e-01   +1.488076443186075e-01   +5.817812266945457e-01   +8.678253267843519e-01   -1.650124847678822e-02   +6.045247922074203e-01   +6.173758535209486e-01; +3.929422282573266e-01   +1.000000000000000e+00   +5.727721710081881e-01   -1.487015354004412e-02   +2.265684577195222e-01   +8.495871394077698e-01   +3.848537667816966e-03   +7.765649329169364e-01; +1.686811240865606e-01   +6.667535398670826e-01   +4.926687349693899e-01   +3.924150902244027e-02   +8.976732384987310e-01   +5.674277042018984e-01   +9.671447184508976e-01   +9.670518268294425e-01; +2.210902753017262e-02   +2.153668848465552e-01   +2.243869685016321e-01   +9.776501139044736e-01   +3.728251038157634e-01   +6.433539608143793e-01   +4.041066234966470e-01   +9.940455926016203e-01; +4.201425243190574e-01   +3.043387844958800e-01   +3.963414940658211e-01   +7.915240158832543e-01   +7.058633196670364e-01   +7.565477835642080e-01   +3.996828429897751e-01   +4.030995336963579e-01; +1.895062163236144e-01   +4.641571099591563e-01   +1.462429328958659e-01   +7.993910495652254e-01   +2.229437913199898e-02   +2.432795398994284e-01   +9.930044259221993e-01   +6.464121290660275e-01; +2.284054302001523e-01   +8.785130957598760e-01   +1.201562234518861e-01   +5.220175416031322e-01   +3.453793503602635e-01   +1.680457738940577e-01   +8.435099475533602e-01   +2.085726597224830e-01; +3.559737655489238e-01   +1.387614248023429e-01   +2.875955948326469e-01   +7.397264269272084e-02   +6.293600787982947e-01   +3.022057324869497e-01   +7.794754250878420e-01   +5.837176269413497e-01; +2.550957685260461e-01   +2.553203858867280e-01   +3.416936903780265e-01   +9.396919101080606e-01   +7.664044855145107e-02   +5.604182528535422e-02   +3.509034626217501e-01   +9.018441602955328e-01; +6.537583193198457e-01   +1.232275568129593e-01   +3.630678084506483e-01   +1.407249986146019e-01   +5.797500187657544e-02   +9.657133466073066e-01   +4.011171646081422e-01   +6.925038981028520e-01];
L2I_L3I_iGABA_netcon = [+8.845178918938351e-01   +2.102571372260102e-01   +8.294915907757622e-01   +9.622727045732850e-01   +6.745831840363243e-01   +3.087093102742308e-01   +5.838644246487525e-01   +7.895942480158865e-01; +9.276063302977459e-01   -1.179518017529138e-02   +8.275861211682943e-01   +4.824236043862866e-01   +6.342379371049787e-01   -7.766735613223138e-03   +7.154930615333398e-01   +7.516885691233345e-01; +2.279152778255542e-01   +2.566120905258811e-01   +6.791728766886703e-01   +5.361504463845210e-01   +6.046555020572233e-01   +6.243648844735562e-01   +2.084272997407903e-01   +9.663659507836663e-01; +9.198993502955067e-01   +9.024802858172494e-01   +1.099370492787814e-01   +5.437560931309787e-02   +3.348030439408867e-01   +1.387095262968662e-01   +8.280291335216122e-01   +6.890536223371243e-01; +2.053639237224717e-01   +3.376147104303155e-01   +2.877901647610514e-01   +4.713595704885475e-02   +8.542986525013533e-01   +8.129670879728341e-01   +7.641047585470846e-01   +5.132922936783989e-01; +8.748094840376489e-01   +7.679712965527213e-01   +4.246814100917543e-01   +7.559935537230263e-01   +7.332305254896473e-01   +8.134050362262416e-01   +5.300723202337327e-01   +2.191265362995274e-01; +7.602235837625642e-01   +4.864330859029370e-01   +2.548333637486024e-02   +7.974147966172269e-01   +2.717959722174252e-02   +1.361108583559599e-01   +5.821224762148989e-01   +2.285515862372152e-01; +8.290328827925504e-01   +7.959821071837040e-01   +2.484491146095295e-01   +4.071837381224491e-02   +7.165256670555409e-01   +9.391598129668285e-02   +9.014783984023791e-01   +4.515457012082038e-01; +3.893448894329486e-01   +6.445924364747589e-01   +9.455007509990983e-02   +2.061683772182693e-01   +6.093111489407591e-01   +9.265696565312657e-01   +6.140417086448751e-01   +5.654162733169108e-01; +5.934077857553099e-01   +8.431985581407900e-01   +9.624985981309479e-02   +1.014149704101325e-01   +2.404701121642782e-01   +2.847077229994851e-01   +9.195225702085286e-01   +3.240688529627818e-01; +2.796390952676314e-02   +8.814923822679468e-01   +6.806609486633938e-02   +2.718698981565069e-01   +4.042455367125449e-01   +7.582937905771098e-01   +1.225842624773595e-01   +4.923359386738611e-01; +7.465900279378270e-01   +2.862472038710752e-01   +6.136318235131869e-01   +5.485231213415130e-01   +1.467766802457303e-01   +3.240562477723225e-01   +9.107901635959361e-01   +1.757746627112627e-01];
L3I_L3E_iAMPA_netcon = [+1.928420533510336e-01   +8.035533731494940e-01   +1.776685418953028e-01   +9.405008224905947e-01   +7.426662832159630e-01   +8.426320467965864e-01   +1.711512463455896e-01   +5.534582310963841e-02   +7.704117778500098e-01   +4.042405938235185e-01   +1.006724242916125e-01   +5.383554054328895e-01; +9.346163064067396e-01   +2.342475914558923e-01   +1.835359384962902e-01   +7.516352224898397e-01   +3.419166867302656e-01   +8.020924748707448e-01   +5.500156474093606e-01   +4.101713829818945e-01   +2.182208130474590e-01   +4.128510947297771e-01   +7.027595143664364e-01   +6.234299658085265e-01; +7.432836372529803e-01   +7.321381975127290e-01   +7.134499337353674e-01   +2.252304589358244e-01   +1.464592672495000e-01   +6.607625975382907e-01   +4.448144790774948e-02   +5.738639701521775e-01   +3.085049911753393e-01   +2.405791796088558e-01   +3.322979485620455e-01   +4.129329076380080e-01; +1.774565494229761e-01   +1.878285450071335e-01   +5.429464652383644e-01   +4.827984929149562e-01   +7.073803283128186e-01   +8.535708604889260e-03   +6.914932671822024e-01   +2.146866093300074e-01   +2.204090223956891e-02   +1.229211894410452e-01   +3.480911003143478e-01   +7.464992876993231e-01; +2.590272566793627e-01   +7.200119160372944e-01   +3.726738938568115e-01   +6.450251696711992e-01   +5.541846992088141e-01   +5.369597661399083e-01   +1.297990452463071e-01   +3.407578599546176e-02   +4.459762276257407e-01   +5.365052417526214e-01   +9.007230662429776e-01   +5.691599565186969e-01; +9.961731845189279e-01   +3.714208581714597e-01   +2.701532995827471e-01   +8.960446603984004e-01   +2.208469427658598e-01   +7.246793584130420e-01   +4.738423452804664e-01   +4.680256319436460e-02   +8.153085729627597e-01   +1.710768852473473e-01   +8.729648408363994e-01   +2.939692358127221e-01; +8.484570938183110e-01   +8.011363416096394e-01   +9.274818401822936e-02   +3.104731726363996e-01   +7.533481105329570e-01   +3.314717394895633e-01   +6.887917998162236e-01   +8.295106906055209e-01   +1.786330561382730e-01   +3.656952386907458e-01   +3.522937558752491e-01   +7.698996689447458e-01; +6.795784368229857e-02   +6.327805430500860e-01   +9.055450520464388e-01   +7.809933312997742e-01   +3.611191569893610e-01   +5.671230128077872e-01   +8.133849484181779e-01   +6.642503037324868e-01   +3.092359602676543e-01   +2.886412476375356e-01   +2.614210864468450e-02   +5.962150563483799e-01; +1.992609903447134e-01   +5.106413562840830e-01   +4.132715423135075e-01   +2.593762144179326e-01   +2.138801378914219e-01   +7.714479769714422e-01   +3.463306398074006e-01   +9.016159886977712e-01   +2.526240922644601e-01   +1.465339514028790e-01   +3.193284831848602e-01   +4.167602082455413e-01; +4.197025841609651e-01   +3.556056604284831e-01   +4.371357843805018e-01   +5.639148172307016e-01   +5.810583444354142e-01   +5.145584715437895e-01   +5.540809105298902e-02   +2.755231193660675e-01   +7.685781176850948e-01   +9.412101944794293e-01   +8.146850044322071e-01   +8.942424199182499e-01; +3.470653925556021e-01   +9.323111188898520e-01   +9.084316146971011e-02   +3.469856318647156e-01   +5.026412024779688e-01   +3.224946919226710e-01   +5.512671910849885e-01   +6.451970946077403e-01   +4.627256060467941e-01   +6.981186181569533e-01   +5.518716751197033e-01   +1.000000000000000e+00; +9.525827122190310e-01   +5.017264849893782e-01   +6.829384583094136e-01   +6.927563661360669e-02   +1.952353891965128e-01   +7.101177721623312e-01   +5.840864032343644e-01   +8.888046763415787e-01   +6.851330165717239e-01   +5.088853001825699e-01   +4.518258635908022e-01   +4.640765189961822e-01];
L3E_L3I_iGABA_netcon = [+8.578140903590369e-01   +3.104383031007386e-01   +2.962221134307934e-01   +3.495404387906066e-01   +3.952389778984440e-01   +4.073259706144271e-03   +7.772630967186813e-01   +6.409900098235091e-01   +8.173270522182087e-01   +9.629119697680070e-01   +5.824061201321468e-01   +6.274976483851593e-01; +7.736283740067315e-01   +4.292645056162876e-01   +3.440074576874563e-01   +8.767789424512484e-01   +8.599432787162424e-01   +5.479173126350230e-01   +9.009508791855241e-03   +2.080167275723516e-01   +5.750453074507802e-01   +2.937477308541022e-02   +7.196592610216046e-01   +5.943596003892613e-01; +5.534513527864330e-01   +7.566172759938267e-01   +6.311258657297530e-01   +9.746843853790484e-01   +1.191208830025911e-01   +5.382156986312524e-01   +6.908612214889884e-01   +3.717876144373788e-01   +5.595379680813480e-02   +8.553000185019513e-02   +4.968576777029768e-01   +6.314818523301482e-01; +8.172537599909198e-01   +6.434523471036223e-01   +7.873273679632418e-01   +8.283863517919293e-01   +2.678169804370103e-01   +4.717553387545147e-01   +1.570038580530326e-01   +9.066450036894766e-01   +5.841854349077462e-01   +5.155507624951384e-01   +6.451864312250517e-01   +7.796415438110323e-01; +4.469601201701133e-01   +1.063318510442690e-01   +7.247318050157983e-01   +5.035929617842848e-01   +1.726017494198470e-01   +8.767695111251580e-01   +4.692053177958717e-01   +2.486960438504577e-01   +6.863178615012097e-01   +9.315514657026286e-01   +8.055933548153561e-01   +5.613753508656985e-01; +9.368949561944878e-01   +2.067097426142713e-02   +1.490961301984685e-01   +9.388790298798423e-01   +1.841357744764345e-01   +5.883932236674518e-01   +5.851084458287250e-01   +1.083214929673205e-01   +9.308717330968980e-01   +4.525322199113332e-02   +6.435040086712999e-01   +8.361564538919487e-01; +2.071398241103572e-01   +2.136141861351993e-01   +3.501822424728144e-01   +3.333924254119448e-02   +4.007737497577890e-01   +1.532011430578223e-01   +8.581030346504001e-01   +3.669720483283281e-01   +6.733975083619900e-01   +6.529273690720806e-01   +5.725713105102664e-02   +6.602459381139681e-01; +4.254102027637643e-01   +4.627554857691206e-02   +5.111985193871342e-01   +6.726614186623636e-01   +8.418085405312556e-01   +5.322823739885585e-01   +5.535626097732225e-01   +7.221625013423548e-01   +9.620705779811725e-01   +4.905137851113804e-01   +9.219527800427647e-01   +5.964380955943380e-01; +9.588300920009521e-01   +2.107210378081795e-01   +8.491732170728816e-01   +3.037701029069190e-01   +9.130082403094318e-01   +7.144266368889091e-02   +4.207477036164501e-01   +6.004692536361900e-01   +8.599461246701695e-01   +2.427155953844148e-01   +6.806769330212687e-01   +6.650151376451502e-01; +4.234398113072965e-01   +7.023221060357407e-01   +5.236514455386709e-02   +4.073202618895427e-01   +2.802955647806594e-01   +3.000048822570645e-01   +7.805727934282767e-01   +3.102141032443120e-02   +6.171166585643584e-01   +6.069056337768918e-01   +7.163748155526193e-01   +7.569421640629054e-02; +9.453519043839107e-01   +3.541591187067182e-01   +4.907935938045536e-01   +7.678319735921042e-01   +4.881191466041048e-01   +4.596147707306212e-01   +3.013714436583743e-02   -1.547747919542191e-02   +3.152629272431133e-01   +5.799097058547370e-01   +9.835700635187299e-01   +8.597842465670068e-01; +7.605601497975087e-01   -6.001958244570969e-03   +1.365652401295551e-01   +8.387544022180095e-01   +1.576466384713255e-01   +2.482474762130920e-01   +8.300284444394290e-01   +6.253666897297144e-01   +8.836848801632756e-01   +4.394114736746339e-01   +5.563362643657597e-01   +9.271962384745742e-01];
L2E_Input1_iAMPA_netcon = [+9.946054049365565e-01   +9.881792190731589e-01   +9.639406354769322e-01   +9.735384631356179e-01   +9.606655361957708e-01   +9.771813396847487e-01   +1.000000000000000e+00   +9.829171287043996e-01];
L2I_Input2_iAMPA_netcon = [+9.944665548837841e-01   +9.955739850300687e-01   +9.609957885904195e-01   +9.695657287350460e-01   +9.737058693165515e-01   +1.000000000000000e+00   +9.816019738539425e-01   +9.713153455665803e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
