function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.070828760536664e-01   -1.973488586626508e-01   +1.572123881877282e-01   -3.815415590240664e-01   +1.977777701422671e-01   -8.456484722784738e-02   -5.806110895051594e-02   -1.309563881237509e-01   -1.329190919890628e-01   +3.714753373375242e-01   +5.502126881572057e-01   -5.216736441727840e-02   +2.943104454398036e-01   +1.127329605778765e-01   +2.266613443523214e-01   +1.235057609597002e-01; +1.202612543486696e-01   +3.581076450263249e-02   +1.501651771808390e-01   +1.240683734460710e-01   -3.804135584926507e-01   +1.900819994136145e-02   -5.937094073628688e-02   +1.609530532323081e-01   -1.801851716037423e-01   -5.795454617548586e-02   +1.522187066729246e-01   -7.220982047414018e-02   +2.792105129219689e-01   +2.450657753374623e-01   +1.068407321863762e-01   +2.342227195528955e-01; +1.500925920918258e-01   -2.574867251512847e-01   +2.205932801118611e-01   -6.390957784397516e-02   -4.137997598162397e-02   -2.670891323382925e-01   -2.238373201094030e-01   -2.915465683188217e-01   -1.032882767892191e-01   -1.455805648225611e-01   +1.028247463221760e-01   -2.383711245179611e-01   +1.921392889271516e-01   -4.795516614955339e-01   -2.621133455212559e-01   +2.684716017099070e-01; +1.831926355517599e-01   +2.253830637821248e-01   -1.009241735951140e-01   +2.433590910131390e-01   +3.540340280982924e-01   -3.191323123411339e-01   +2.177537391936978e-01   +3.231889863553078e-02   +3.393434087693958e-01   -1.226422685361446e-01   +2.558630934849511e-01   +2.021282098032967e-02   +2.534168756606279e-01   +1.205805082786667e-01   +7.940206520561265e-02   +9.791850921159466e-02; +3.022130156735274e-01   -4.785857936002503e-01   -3.777769278160846e-01   -2.430326392723561e-01   +2.416347622888668e-02   -2.544088086398338e-02   +2.037467384801614e-01   -3.425974920886972e-01   -2.292600419204421e-01   +1.373103957191060e-01   -2.468501509174259e-01   +2.481227663973330e-01   -2.437044459561928e-01   +3.822215922810556e-01   +4.261710636178637e-02   -8.756112642517838e-02; +1.430418842901928e-01   +2.972302802741931e-01   -2.335881376078256e-01   -8.024195624519140e-02   +3.413304333083430e-01   -7.233961193332569e-02   -3.005596590162927e-01   -1.555798520123945e-01   -8.741123282939972e-02   -4.119610415878698e-01   -7.843507336160024e-02   +2.433787549483022e-01   +3.713010427242462e-01   +4.546827519157055e-01   -1.430689945431053e-02   +7.423052179327033e-02; +2.830816631944477e-01   -2.341986943509878e-01   -2.626627587897534e-01   +2.263877491867003e-01   -6.394991527738023e-02   -3.336811588027100e-01   +2.580571159794877e-01   -1.154681079370625e-01   -3.325062596033089e-01   +1.186585894922737e-03   -6.287596317415518e-02   -2.220351966681166e-01   +3.476333939693976e-01   -1.399238148614043e-01   +4.205610790582263e-02   +7.894063991517224e-02; -3.984417276449349e-01   -1.703229328768077e-01   +2.086987192438706e-01   +2.668159114776235e-01   -6.180724127677922e-03   -2.746410676770922e-01   +4.437820993897791e-01   -3.750674246825030e-01   +2.307004582814297e-01   +2.016691105929411e-01   +6.140095161048489e-01   +3.817622351424838e-02   +1.689748299994712e-01   +2.734761873455879e-02   +2.897390125618310e-01   -1.221902251439092e-01; -4.883690173489650e-01   +4.757678764932469e-01   +3.271487282142422e-01   -2.009184674469169e-01   -4.780211511231730e-01   -8.294229702432729e-02   -2.047151389294887e-01   +1.559268821063977e-01   -7.870012041697233e-02   -3.154130049224371e-02   -1.665820791094286e-03   -1.159184771811768e-01   +2.553203474953220e-03   -1.979673152363503e-01   -1.046939727777618e-01   +6.706612217106667e-02; -3.297666255332903e-01   +2.485944224601560e-01   -1.065867158815160e-01   +1.341167216108477e-01   +2.721945393030019e-02   +8.190584480713414e-03   +1.535901079715686e-01   -3.983763788663793e-01   +2.002417178720321e-01   -1.331557133463972e-01   -2.586605128179076e-02   +2.499875257006694e-01   +3.335002276859224e-01   -2.226272259124150e-01   +1.427486174640461e-01   -1.098091274936844e-01; -1.505604632690474e-02   -1.891428178717888e-01   -2.654346452486646e-01   +3.469289266239797e-01   -1.314029617700342e-01   -2.467526913291429e-02   -3.877585546896748e-01   -4.443836255303828e-01   +1.108326460437467e-02   -2.722528385346870e-01   -2.399846769972089e-02   -1.449846089841864e-01   -1.383315552671763e-01   -3.010308749455661e-01   -1.374816001724312e-01   +7.840145281289825e-02; +6.239850217700539e-02   -4.918003648228113e-02   +2.608765125719877e-01   +3.584611388112894e-01   +7.132827325805390e-02   +4.441898131968702e-01   -1.275686004394488e-01   +1.782521486782467e-02   -3.064400368242896e-01   +2.214275097462910e-01   -2.714838190047519e-01   -1.744243270548775e-01   -4.088581185141072e-01   -3.422725866436063e-02   +2.174788460441771e-01   +1.258701366874880e-01; -9.600203734878181e-02   +8.047787395571436e-02   -2.361603107488594e-01   -1.395363839005535e-01   +1.182807858474745e-01   -9.924551401014610e-02   -4.008401084755012e-02   -2.773331310120895e-01   -1.540829460346473e-01   -2.055187417564902e-01   +8.733613096284606e-03   -1.653471654535759e-01   -4.189127707541758e-01   +3.783506676869947e-01   +1.485662446056683e-01   -7.261395070614098e-02; -2.165108458650728e-01   +5.584550048494642e-02   -4.557413933823431e-01   +3.500576189963820e-01   +2.479616487493810e-01   -1.869565215647688e-01   -8.590616332514382e-02   +1.885796352286495e-02   +1.585516546377455e-01   -2.975430966706057e-01   -2.400156439541336e-01   +9.431785477493321e-03   +4.073711412809616e-01   -2.377234431377163e-01   +2.940774469020913e-03   -5.236419631612159e-01; +2.530391683891614e-01   -3.359656431565867e-01   -2.953523789527661e-01   -1.829877099453477e-01   +3.154429223826064e-01   +4.710256946525153e-01   +3.866371127056690e-01   +2.200905180103884e-01   -9.220449806815642e-02   +6.060306553719325e-02   +3.503927435805846e-01   +2.071152838590860e-01   +5.696795948930855e-03   -2.387638414228141e-01   -3.971158575083684e-01   -1.384016456315793e-01; -1.613766032772183e-01   -2.283374090905291e-01   +3.147677495475837e-02   -3.109502202605138e-01   +8.740988365983464e-02   +2.717071337662892e-01   -2.385754159843851e-01   -1.775448439333621e-01   +2.848762255354870e-01   -2.581322439502184e-01   +2.708952017556260e-01   -2.405042504529120e-02   +3.049711738929488e-02   -4.981476030794073e-01   -2.235392540265225e-02   -7.844715160488112e-02];
L1E_L1I_iGABA_netcon = [+4.651277910340309e-01   -1.284221719879658e-03   +1.421255981144736e-01   +2.927564938512781e-01   +8.570795617852532e-02   +4.440872006585300e-02   -4.163994552179499e-01   -2.556334680234819e-01   -6.540958669620697e-02   -1.758309596475716e-01   +1.960252667144252e-02   +2.208770689905701e-03   -2.523926918578680e-01   -1.563215741905705e-01   -2.796442586440031e-01   -3.358341320984758e-01; +2.745973316903497e-02   +2.490557848147378e-01   +3.626208694604387e-01   -2.968975819594246e-01   +1.384356498260557e-01   +3.431764588118150e-02   -1.278107881680018e-01   +1.921598873800772e-01   -4.660211290627158e-01   -2.269254399630449e-02   +2.187591600744706e-01   +4.879652745248493e-01   -7.129213719740499e-02   +8.410238649911916e-02   -3.858955378102612e-01   +4.490596725949654e-01; -2.304673289523365e-01   +1.182352261115760e-01   +1.477922483336998e-01   -1.350599878252963e-01   +1.654720545936290e-02   -2.128312407464369e-01   -5.631129292804210e-02   +4.774227648551677e-01   +1.551670180699815e-01   +4.679605566377724e-01   +9.205052705382744e-04   -6.540245182050000e-03   -1.706123220589417e-01   -1.240511652027455e-01   +2.070719352584280e-01   -6.806377148792070e-02; -1.702117809020116e-01   -2.800590600857427e-01   -9.119844701160937e-02   -1.828074882363126e-01   +1.675266640838055e-01   -1.529598737877824e-01   +2.809241657421265e-01   +2.575926506394651e-01   -2.263539851726920e-01   -1.473953238249372e-01   +3.873644235245480e-02   +2.913614282962658e-01   -3.001235953023533e-01   -3.243030996935181e-03   -4.257521208520226e-01   -5.709955715439692e-02; -1.632275729868053e-01   -9.398638589759303e-02   -2.219426933710040e-01   +8.582684935070806e-03   -2.425681366056110e-01   -8.319849071328315e-02   +1.387860902449833e-02   +2.356839526835434e-01   +1.705527102931241e-01   +3.368670317994116e-01   -5.801927118085110e-02   +2.272942347095729e-01   +1.906689269427308e-01   +1.482782177165322e-01   +1.572563632380538e-01   -1.426960812927159e-01; +1.894916068603546e-01   -8.218394767451337e-02   -9.103578327387724e-02   +2.260602397833456e-02   +1.288279872431522e-01   +3.845622715500610e-01   -3.687996693452829e-01   +3.617301792018021e-01   -7.383670634399615e-02   -5.038057923517150e-02   -4.384264581336728e-02   +1.652392763456759e-01   -9.256916088585862e-02   -1.721178973104852e-01   -1.250853916222922e-02   +4.029626113820337e-01; -2.567717832297473e-01   +3.414199933750738e-02   +2.250789100270440e-01   +5.456665728412902e-01   -3.863152153316722e-01   -1.793457901863870e-01   -2.223150535112475e-01   -1.554026695722658e-01   -5.448164845174848e-02   -4.291387640196702e-01   +2.508312568833777e-01   +8.286590697728276e-02   -3.449288348024619e-01   +2.205392480420964e-01   +1.549423062411354e-01   +1.739270450201122e-01; +2.728694984691321e-01   -3.702855878137447e-01   -1.572301699170227e-01   -1.637509189909632e-01   -1.944705286636454e-01   +2.313378428778034e-01   -3.763307234581168e-01   +1.032753496045664e-01   -3.616188875447821e-02   +3.074198828702921e-01   +1.987413731063890e-01   +2.477669756141992e-01   +2.954313595883334e-01   +4.108499146986333e-01   +2.390522185936294e-01   -5.461266479335657e-01; -3.525846440347066e-02   -1.641515785966027e-02   -2.203095031239715e-01   -7.783558668030394e-02   -1.323733577393218e-01   +3.521978052564716e-01   +3.392762574864319e-01   -8.300467475808987e-02   -1.081191974840139e-01   +1.056104609387197e-01   -3.060783642769449e-02   +8.518191841265888e-03   +1.646008003673194e-01   +5.347900563502586e-01   -6.286280324704754e-02   +3.541375721359595e-01; +3.770822054113882e-02   -2.723262995582362e-01   +2.991235243575114e-01   +4.383490402091966e-02   -2.874844433398987e-01   +4.636295141014501e-01   +1.738608778039830e-03   +4.210313333813204e-02   -1.638517444665605e-01   +3.725453606491536e-01   -2.907652921126515e-01   +2.666523085935953e-01   -1.478477087526101e-01   +5.474561067393261e-02   +6.342765487929417e-02   +6.359566712746229e-02; +8.370148525206690e-02   -3.550004869398694e-01   -8.025756058972983e-02   -2.000352166657839e-01   -4.407814335138914e-02   +1.017846826040744e-01   +2.291112527470430e-01   -9.176610757183537e-02   +3.340181153524071e-01   -3.069811838319851e-02   +6.581880775369768e-01   +7.026847326513233e-02   +3.998347563253326e-01   -1.700743580455895e-01   +3.409913550538268e-02   -3.139604699999088e-02; -4.544864924144260e-02   +4.714992533499499e-01   -9.394430588133379e-02   +5.543128255846471e-01   -3.129252996195906e-01   +3.548142804706798e-01   +4.511076441543574e-02   -2.005122933737876e-01   -9.043819713697701e-02   -1.546986099620201e-05   +4.651712627885440e-02   +1.727906043839187e-01   -3.627618259624379e-01   -4.614043508557555e-02   +2.097637352096650e-01   -5.817967219071490e-02; +1.083039059603662e-01   -1.444436925507922e-02   +1.238395792196097e-01   +2.822269311696950e-01   +4.681518802031190e-01   +1.193248858678488e-01   -3.082797312838039e-01   +3.233550103809342e-02   -1.877924146781705e-01   -2.056968001064220e-01   -2.969058146562724e-01   +5.272281873870457e-01   +2.137727259034047e-01   +2.310877301187723e-03   +6.253465444807882e-02   -4.732527115032806e-02; +1.250799750406591e-01   -6.918090422858560e-02   +1.510120017239903e-01   +1.956992416572252e-01   -7.801756236111304e-02   -2.336424347077734e-01   +9.712431311675526e-02   -9.235179943555759e-02   -1.409372983262870e-01   +9.939820736293684e-02   -2.163461471535372e-01   +4.083707954752291e-01   -2.529741319020802e-01   -1.472996791361653e-01   +2.060265485417856e-01   -1.717127855437131e-02; +1.076671045914810e-01   -9.229398278107440e-02   +2.738989157467885e-01   -2.512819359134165e-01   -9.317059036913142e-02   -9.032200786088486e-02   +3.354370755730518e-01   -4.082084455444455e-01   -1.326182365270985e-01   +7.103097220142740e-02   -2.049197502307023e-01   +1.740254487418850e-01   -4.350393244527655e-02   -3.218070206791657e-01   -6.406268401505484e-02   +1.361339287533763e-01; +3.356004994166352e-01   -1.713796348617519e-01   +2.750837586966285e-01   -3.287542542053195e-01   -3.804012822448758e-01   +2.892198976728123e-01   +3.305857832926806e-01   +3.816089615206992e-01   -2.841213108681100e-01   +1.642255723686228e-01   +8.528077482450606e-03   +1.891486448327680e-01   +1.024030163841718e-01   -5.013073496652656e-02   +3.319633586189308e-01   -2.028715443728920e-01];
L2I_L1I_iGABA_netcon = [+6.377041520926982e-02   +6.199742073048942e-02   -2.932780294229543e-01   +2.590584314158432e-01   -2.428850978220595e-02   -1.355077485062835e-01   +4.894579659279910e-01   +2.268495166820168e-01; -2.693041890175398e-01   +9.884256503043895e-02   -1.394965812304677e-02   -1.216684158062694e-01   -1.334475293157087e-01   +2.241800124127163e-01   +1.598499690738640e-01   -1.567531044509178e-02; +4.197330830120190e-02   -3.672068293729139e-01   -2.637420552596375e-01   +4.284106295572748e-02   +3.103371389521258e-01   -2.895939908921812e-01   -3.853440608188385e-02   +1.612742735361719e-01; +5.095099210332699e-02   +2.745677495747894e-01   -1.626045870139359e-01   +3.940937759010334e-01   +1.721311177798448e-01   -2.612064766140489e-01   +3.373464927646682e-01   -3.892884547689787e-01; -2.343934248930431e-01   +2.140200363124869e-01   +5.786398393620595e-02   +4.327079179979589e-01   +2.403460718780403e-01   -2.701585018057251e-01   -2.445173121154270e-01   -1.803892366054203e-01; -1.671982730943797e-01   -4.796228337538378e-01   +4.371986124043966e-01   +1.644672662549881e-01   +2.605257019020062e-01   +4.741388419420736e-02   -8.209829695159247e-02   +3.272765442774385e-01; +1.579736041449680e-01   -4.855672401155371e-01   -2.745362493206947e-01   -1.873715883461799e-01   +3.289196768278532e-01   +2.527004338532796e-02   +5.563735904794930e-01   -2.170448840869684e-01; +5.401531825460142e-01   +6.124870818240716e-02   +1.106506961534710e-01   +1.040426245571698e-01   +1.200925001108680e-01   -6.565210259285942e-02   -3.597313943702478e-01   -7.421939387987947e-02; +2.864379141054532e-01   -2.029698947422262e-02   -5.977663836460922e-02   -2.464953718030229e-01   -1.114887700281196e-01   +1.184947593931679e-01   +5.991022565733912e-01   +4.752590798779503e-02; -2.959591576183505e-01   -5.749052599748146e-02   +3.042093564135607e-01   -4.944440568218686e-01   -1.409800536796285e-01   -1.331015702451831e-01   -4.316555943822341e-01   -4.733361514739355e-02; +2.301823669213752e-01   -2.283839268505425e-01   -2.271371164847214e-01   +4.321185007135860e-01   -8.758628000893290e-02   +7.989507423055864e-02   +2.537178811191524e-01   +1.672050222660140e-01; -2.263503111170577e-01   -2.438483919139001e-01   -1.410148195145274e-01   +2.723862983031847e-01   +3.764495614773748e-01   -1.874129987495374e-01   -4.204966039923297e-01   +3.374423743020527e-01; -2.636843178188896e-01   -1.717291749602007e-01   -2.985515947977270e-01   -2.190524560733108e-01   -4.321963387049708e-02   +7.488357426654008e-02   -4.269797213218355e-01   -9.774412750663226e-02; +3.910794723292594e-01   -3.104897686665918e-01   +2.405067221974384e-01   -2.710911949181988e-01   +5.869288425302741e-02   +2.022572982171518e-01   +4.352897216228782e-01   +3.345104354152744e-01; -2.423102524100102e-01   -1.234851551980173e-01   +5.507573805887571e-02   -1.694500638373450e-01   +1.145120413786172e-01   +1.384796879250058e-01   -3.916115913689885e-01   -3.481491116002533e-01; -2.406940043844162e-01   +9.056622291311947e-02   +1.517678978804452e-01   -3.619332955643022e-01   -1.968254857323344e-01   -2.017135418407744e-01   +1.338047900196634e-01   +1.472480418266473e-01];
L1I_L2I_iGABA_netcon = [+1.864893901332365e-01   -2.357727557152394e-01   +2.135556754620780e-01   +3.222817227454794e-01   -4.252544730509589e-01   +2.011064539432737e-01   +2.293860126042100e-01   +2.210161688980904e-01   +2.285114380365284e-01   +2.787634866937719e-01   +1.352154674120981e-01   -2.748731523090953e-02   -1.889123098607821e-01   -7.274003504782241e-02   -1.644998469591838e-01   -3.410378201438036e-01; -3.570583754196043e-01   -3.810866182838926e-01   -7.495768092398100e-02   -1.115313854300495e-01   +7.700939034789148e-02   -7.560074836819448e-02   +5.965776560669100e-03   -2.335349047185775e-01   +1.117713151489818e-01   -1.780468302957340e-01   -7.166720128104254e-02   +2.500374834548452e-01   -1.525012203658822e-01   -2.888663765247598e-01   -1.132299681193229e-01   -5.737418313703116e-02; +1.542528900339129e-01   -1.280268122269005e-01   +2.754620507674306e-01   +2.429650085306722e-01   -1.388062746405110e-02   -7.726829275168412e-02   +1.958910349458183e-01   +3.328436212043616e-01   +3.532804338512936e-01   +1.633926892134735e-03   +1.439175117497282e-01   -2.304168273327787e-01   -5.066609440906116e-01   +8.831963459800571e-02   -1.870865440533621e-01   +3.471795793242757e-01; -8.896351166082583e-02   +1.066547400961380e-01   +5.792679245094182e-02   +3.176085060374932e-02   -5.724310945576766e-03   +2.979355137739083e-01   -5.031621589978840e-02   -1.751590195326073e-01   +1.106775442795663e-01   -1.368854900537924e-01   -3.521806425706083e-01   -1.992945398963154e-01   -1.817281070188254e-01   -4.152989083540698e-01   -3.012950656955579e-02   -3.991240114049799e-01; +1.839467698961590e-01   -2.076322369816655e-02   +1.282067559878680e-01   -7.131007381612238e-02   -2.194438799773813e-01   +7.491750243653064e-02   -5.219144085791450e-01   +6.336240030505705e-02   +4.527823474177720e-02   +1.080823476148386e-01   -2.239333024425266e-02   +2.941647216935115e-01   -6.961803603454711e-02   +9.490550992489147e-02   +2.316393613456082e-02   -1.296875593466061e-02; -4.837641038057810e-01   -1.420152452571841e-01   -1.865743575626217e-01   -3.975008067110208e-02   -3.303140262731134e-01   +8.428191125876394e-03   +4.529781370228043e-01   +2.711645437245728e-01   +1.588362708905764e-01   -1.815666090612256e-01   -1.243529280954669e-03   -3.665504706827672e-01   +4.152410260983026e-02   -7.262430735451136e-02   -2.088166423620251e-01   +5.342801723148966e-02; +5.035756232108558e-02   +4.150852259151834e-01   -4.440379569924190e-01   +1.904004746715364e-01   -7.727338561987998e-03   +1.313199482112754e-03   -5.232280580047619e-02   +1.748308026109346e-01   +3.799873121560807e-01   -4.799102736354828e-02   -1.761334619521532e-01   -4.088495087645946e-01   +1.022757379098316e-01   +3.201135408724266e-02   -2.358267195005109e-02   -7.330846723949956e-02; -3.279160730535773e-01   -8.387776247467246e-02   -2.201227621360423e-01   +1.350604491416056e-01   +7.526006276063932e-02   +5.580145523304895e-01   -6.429950020029915e-02   -3.350161494980401e-01   -1.379902354786424e-01   +1.805544204976974e-01   -2.968755167044065e-01   +2.086474412431094e-02   +2.554474793689572e-01   +1.433710400573114e-01   -2.164442253283688e-02   -6.834975966595024e-02];
L2E_L1E_iAMPA_netcon = [+3.542753010805620e-01   -2.611395214149296e-01   +2.382547924540686e-01   +1.050934781136216e-02   +2.322686755068876e-01   -7.012222082489532e-02   +3.527444790380803e-01   -5.660741442239847e-02; -3.076187889775788e-01   -3.773560652343245e-01   +3.115954857014192e-01   +4.634632494259932e-01   -1.246263641130321e-02   +1.498158000201767e-01   -2.272765769054322e-01   -4.230692156123799e-01; -1.656153069403743e-01   +4.416913761710797e-02   -1.353336086201803e-01   +1.844096335111822e-01   -1.225493867615851e-01   +4.956447628719824e-03   -8.545589936637024e-02   +1.499827417460555e-01; -1.772405595961092e-01   -1.405083483832737e-01   +1.291849733803885e-01   -3.581976759631806e-01   -1.952053282564834e-01   -4.208960368196417e-01   -5.061103882419107e-02   +3.731856506389658e-02; -3.242211572263793e-01   +1.586599591701670e-01   -4.401701468168150e-01   +4.208342165202952e-01   +3.740283567879248e-02   +5.865063825247822e-02   -3.927839288749308e-04   +5.753699547296623e-02; +1.473279301321365e-01   +2.926091113756207e-01   -1.934583260870072e-01   -4.649566511097958e-01   +2.155193500881351e-01   -3.185568050025761e-01   +2.573109820023700e-01   -1.152744652317303e-01; -1.575915107710852e-01   -9.124449559913328e-02   -1.004263778257132e-01   -4.104512061711635e-02   -4.355363909458036e-02   +1.330125571610985e-01   -2.045215146928313e-01   +9.724139305441423e-02; +1.792163588837535e-01   +3.900782878887505e-01   +6.934698773058984e-02   +2.130092281620777e-01   -2.314019317126419e-01   -8.335134583475071e-02   +3.387282515075285e-01   -3.922711579504745e-03; -3.177340099281360e-02   -3.261849187334470e-02   -6.812335902620241e-02   -1.565496420800396e-01   +3.740392783854392e-02   +6.000059563500726e-01   -3.919414883318198e-02   -1.037931218842896e-01; -2.580136850229496e-01   -3.132459206207839e-01   +6.716530612657884e-02   -4.699861443398191e-01   +1.742764379192609e-01   +1.966079680274380e-01   +3.627046679204678e-01   +2.661695978671624e-02; +5.606983811216284e-01   +6.716428125945187e-02   -1.905544524593438e-01   +2.541724759291547e-01   -7.225094111530564e-02   +1.802876179437268e-01   -2.243297444970551e-01   +2.737646211817914e-01; -1.862606583709592e-01   +9.878295742538651e-02   +1.371838785138445e-01   -2.355824934718478e-01   +1.039209558638379e-01   +2.819879828861130e-01   -1.510109060822932e-01   -2.980924504939383e-01; +2.839039112065096e-01   +9.998637713077113e-02   +1.435355307293941e-01   -1.529121997535546e-01   +2.798098962832160e-01   +1.603592456069064e-02   -3.654842852794610e-01   +2.871051162095914e-01; +2.166512218863686e-01   +1.350901701507440e-01   +2.567793464145667e-01   -5.075939219161705e-01   +2.150073012431532e-01   -1.188250597817338e-01   +1.192002999596356e-01   -3.756132222103961e-01; +1.845542233522114e-01   -1.861098495395475e-01   -3.872368046664133e-01   -2.064738203220034e-01   -6.732210660056964e-02   -2.165114237276689e-01   +2.449215670866220e-01   +1.426489420426604e-01; -4.090794571983229e-01   +7.966869776660751e-03   +1.178597988067407e-01   +1.570915286870885e-01   +7.438325477259997e-02   +2.565164095376165e-01   +6.895942357337467e-02   -3.826445002931643e-01];
L1E_L2E_iAMPA_netcon = [+8.908240353588867e-02   -3.276561615344554e-01   -9.400062959395081e-02   -1.108716986395062e-01   +3.715265750821926e-01   -2.652214437919198e-01   +1.211008669143638e-01   -3.458080873017705e-01   +4.135197250397685e-01   +1.042513529580796e-01   -4.799653652997273e-02   -1.692544804750252e-01   -2.070711055898741e-02   +1.783163886885626e-01   +1.153420764885354e-01   -6.561967677346880e-02; -1.822814690180677e-01   +3.132109814843806e-02   -2.574791828192817e-01   -3.258502947771502e-01   -1.385784460753098e-01   -1.585615731351901e-02   -5.330688699411467e-01   -1.021263865377673e-01   +1.124721235972507e-01   -1.009661683800663e-01   -5.311550730585024e-01   +5.010462707773060e-01   +1.221476352566609e-01   +3.325836394210888e-01   -5.523383625772733e-02   -4.056452198812375e-01; -8.157163744111068e-02   +2.569092647432077e-01   +4.223928302449215e-01   +2.390504119163425e-01   -3.927238253804258e-01   -2.904701650649947e-01   +2.345370333411940e-01   +3.375573186326740e-01   +2.535356641481856e-01   +7.335350151113609e-02   +4.324233911153750e-01   +3.988334152011958e-01   +1.766310369768179e-01   -1.029648962131501e-01   -5.481616366243869e-01   -5.409100210074966e-02; +1.159601592708559e-01   +3.823412275610537e-01   -2.855054249703172e-01   -3.029494538789027e-01   +3.546916575446317e-01   -1.724621491535547e-01   +4.156652683763528e-01   -2.282815676757071e-01   +4.051131281290937e-01   -4.199678222576940e-02   -9.015862055934312e-03   -8.210900986023544e-02   -6.075107244254131e-02   +2.504233077328060e-01   +3.507449509049645e-02   +4.648074976281308e-02; +2.757608130605391e-01   -9.465114320761794e-02   -3.885572751877466e-01   +9.869052290172090e-02   +1.696324791513631e-01   -7.862913919574135e-02   -2.076659986960228e-01   +1.264273554278240e-01   -1.439476029656145e-02   +8.856669728351260e-02   +1.140271365354840e-01   +1.917557387272961e-01   +4.505985299483128e-01   -2.639191245829817e-01   -6.677039229184473e-03   +1.956562787067131e-01; +3.882097611218812e-01   +3.148390705838527e-03   -4.809955625053668e-02   +8.068619965181004e-02   -4.240210913972950e-01   -3.473776222610428e-02   +2.005571431063297e-02   +1.362752560987256e-01   +1.032216531861041e-01   -1.532165195278920e-01   -1.478991524136333e-01   +2.842490480316835e-01   +1.674273982347613e-02   -3.255621795987260e-01   -5.532195310262637e-02   +1.355042443794527e-01; +3.416710200065128e-01   +3.244561958486759e-01   +3.447368109864035e-01   -2.487862987292172e-01   +3.258778931717277e-01   -1.267236130345435e-01   -7.622720055739861e-02   -7.621113703941614e-02   +2.607559227028820e-01   +5.322548621924478e-02   +1.826280908078851e-01   +3.102236732138799e-01   +3.323800816767665e-01   +6.687860765090584e-02   -2.707857587444191e-01   -2.053955899533617e-01; +1.049336509862030e-01   +2.014930338810201e-01   -7.615496831209709e-02   +1.010438078479678e-01   +1.197368683817665e-01   -1.315243447428956e-01   -1.535260406662078e-01   +2.756385881214419e-01   -6.250636757067535e-02   -1.882359909493048e-01   +1.752152460084015e-01   +1.490909414570391e-02   +2.881952716656876e-01   +2.349597302687872e-01   -4.574668501272022e-01   +1.441932598490462e-01];
L2I_L2E_iAMPA_netcon = [+2.362765853978371e-01   +6.317276527440102e-02   +1.998356058785792e-01   +3.335711539811652e-01   +8.780161014756195e-02   -2.835966562102188e-01   +1.001322297890126e-01   +1.672710070680207e-01; +4.354674633175360e-02   +3.109573025265863e-01   -2.371369105520998e-01   -3.412141147708640e-01   +2.023326681223393e-01   +5.271906863730618e-01   +1.781979036740669e-01   -2.794851683069285e-01; -8.116130132463241e-02   +5.223117119198022e-01   +2.572428776353984e-01   +9.596345113632582e-03   -1.543392951779054e-01   +5.637856559343074e-01   +3.319329434739646e-01   -2.532869371808382e-01; +4.925578847027779e-01   -3.917258712729019e-01   -5.447276198029287e-01   -2.654740882158336e-01   -3.447058693129844e-02   -1.449546450673669e-02   +4.818556039461571e-01   -4.585961921134089e-01; +3.935573341509702e-02   -3.055011928966600e-01   +4.957023215591394e-02   -9.526811121450672e-02   -3.243136383086955e-01   -2.260750012324887e-01   +3.521668376469606e-01   +3.311130853386515e-01; -2.618677594961094e-01   +2.872841240816588e-01   -1.949356417694052e-02   -1.480289231767875e-01   +1.210623938656262e-02   -3.405287944887350e-01   -2.526603089106563e-02   +1.438533437408500e-01; -1.478324798161297e-01   -2.439549682206606e-01   +5.327985796541523e-02   +4.689712628375558e-02   +2.494836396325253e-01   -1.151097298501952e-01   -2.853058721190108e-02   +9.215627844918032e-03; -4.788673426403294e-01   +2.607778951588777e-01   -3.843532186139940e-02   +2.227051031078784e-01   +5.262488635158258e-02   -4.021470425146371e-01   -5.023691829423544e-01   +3.965232305142337e-01];
L2E_L2I_iGABA_netcon = [+2.711274057870384e-01   +2.584137722864048e-01   +2.809110140993509e-01   -1.809618724830100e-01   -2.244097645064483e-01   -8.294771821264729e-02   -4.066890153189239e-01   -2.546726269846281e-01; +1.574887660189041e-01   -1.813788639310219e-01   -1.054413450354360e-01   -4.209919459298021e-01   +2.156576195973349e-01   -1.992170409652926e-01   +2.358781767317489e-01   +3.990934519451531e-01; +1.132454924221251e-01   +2.847520029406043e-01   -2.626876088893567e-01   +1.186051795176439e-01   +5.762055012939664e-02   -3.713859727782395e-02   -6.854739447075553e-02   -2.357830678025754e-01; -7.394490150447494e-02   +1.532273557694065e-01   +4.772503369618164e-01   +4.431017793945502e-02   +2.156108087913292e-01   -1.719495029082748e-01   +4.625897357815287e-02   +2.040200872452876e-01; -2.008014021376476e-01   -1.848988163034448e-01   -7.961436891403828e-02   -2.756468121889963e-01   +3.942778632081413e-01   +3.681897896123291e-01   +1.607011553329433e-01   -4.414408685385483e-01; -3.933910838602468e-01   +4.375677656893542e-01   +6.400339689167370e-02   -2.812590538735945e-01   -2.766830760247954e-01   -2.402198951506774e-01   -1.617029391023548e-01   -1.228199581142435e-01; +2.719535433985515e-01   -1.405134502604621e-01   -3.243663239669412e-01   -4.448191933260635e-01   -1.233741495545905e-01   -3.057997246514664e-02   -1.134624467505381e-01   -8.755112182381952e-02; -4.632573717586300e-01   +3.188860900204059e-01   +2.535742849707193e-01   +9.082402913222663e-02   -4.349876652775152e-02   -3.512544379892463e-01   +1.262295350247557e-02   -1.305362218024779e-01];
L3E_L2E_iAMPA_netcon = [-3.253380748355493e-01   -2.426406281700963e-01   -2.226350547325803e-01   +1.264553863531631e-01   +1.922864121901262e-01   +3.323312236550153e-01   +3.143751076274698e-01   -1.486887765904953e-01   +6.954205538617811e-02   -8.753325732413057e-02   -6.300109013901506e-02   +1.588260675351480e-01; +4.908530784770204e-01   +3.306946124645215e-01   +2.445917153561211e-02   +2.693393356051204e-01   -4.981649912532697e-01   -1.027040655714281e-03   -3.784462803769522e-01   -9.905077658526024e-02   -3.924357156921358e-01   -5.324163027552470e-02   +1.716760419981494e-01   -2.720916764669047e-01; +1.858984714800530e-01   +2.516135621622347e-01   +2.260791496478379e-01   -1.003186207299627e-01   +6.911704860068026e-02   -4.138344549678463e-02   -1.056768050858335e-01   +5.305984349946637e-02   -2.254553840227536e-01   -1.352034846471832e-01   +9.858207829123926e-02   -1.505687259217788e-01; +9.518666100798098e-02   -2.908947327878565e-01   -3.447793409217768e-01   -2.153035337101636e-01   -3.533149941350784e-01   +4.631252118901151e-01   -2.932342573927093e-01   +2.546826375301912e-01   +2.158746223047124e-01   -3.572420351954302e-01   +2.002791428885498e-01   -2.013968834869692e-01; +1.247925340827231e-01   +1.082307976781535e-01   -1.651964317028664e-01   +3.161567279800126e-01   +9.093586575242474e-02   +1.266991240359132e-01   -5.314648070489756e-01   -4.113637055818918e-01   +6.121383356632557e-02   -1.325879358041236e-01   +2.147945558431733e-02   -1.383069108532338e-01; -3.620958977626785e-01   +2.096140536236340e-01   +2.881826039509352e-02   +5.158559857545004e-01   +4.996401458551196e-01   +1.636713107380329e-01   -1.559475886478305e-01   -3.851003909308053e-01   -2.575361318854957e-01   +1.633887429369643e-01   -2.401018240591280e-01   +4.336451699871696e-02; -1.359116955345762e-01   +6.219775073934748e-02   +2.886451657925346e-01   -1.606831355004240e-01   +1.207653518413025e-01   +1.900085077357422e-01   +2.962776402661546e-01   -2.443788191887811e-01   +2.044308866755720e-01   -1.883600164439185e-01   +2.490244016270546e-02   -2.011096891884660e-01; -3.318834962923778e-01   -1.682669960241437e-01   -2.379123898558570e-01   +3.010074757843628e-01   +3.293763417491821e-01   +2.158625249618917e-01   +3.943511304155933e-03   -2.803565398833263e-02   +3.916633483037772e-02   -3.085096881598559e-01   +3.082557208854707e-01   -3.834546169635115e-01];
L3I_L2I_iGABA_netcon = [+2.581657067215700e-01   +4.562179901153958e-01   -6.072218743257658e-02   +2.493493167998677e-03   +2.807292385918123e-01   -3.544745756179580e-01   +5.953106372169601e-02   -2.133776661508475e-02   -6.381199038932292e-03   +1.005348842724915e-01   +3.608499466504328e-01   +9.807555009663133e-02; +2.984072048949131e-01   -4.332980527477824e-01   -5.061911618330979e-01   +6.401999755464949e-02   +3.942199377540073e-01   -1.788114298773421e-01   -3.079078325620715e-02   -3.527705612024218e-01   +3.197323041492294e-01   -4.707148056122140e-01   +2.312809273142266e-01   -2.809060995401813e-02; -3.264013415067352e-01   -1.338400075088586e-01   +4.377653476172562e-02   +3.268463101542382e-01   -2.777973320450302e-01   -1.422276409822020e-01   -1.003825311138552e-02   -3.868938138651729e-01   -2.012387382749706e-01   -2.048025077800757e-01   +4.673802835679110e-01   +4.624671894210866e-01; -2.113225610321380e-01   -3.252649391916220e-01   +3.939024014699661e-01   -4.588444892069879e-02   -3.448244729411966e-01   -2.058051004547232e-01   +4.187850704327931e-01   +2.516141879170133e-01   +1.581851238381130e-01   +6.891850855450277e-02   -1.135042023295284e-01   +1.726824268469826e-02; -2.694278922389745e-02   -6.308639534788400e-02   +7.910605615119665e-03   +3.983533990764659e-02   +2.224061505744758e-01   +4.780465451751352e-01   -2.983660334537758e-01   +4.003152171035901e-02   -5.758342109056089e-01   -1.217510140889252e-01   +3.456073334360539e-01   +3.225586650211729e-01; -3.601643104578823e-01   +2.627919648446021e-01   -8.724760932292658e-03   +3.686731657458625e-01   -1.996996908662398e-01   -1.470661818846796e-01   -2.982960291215633e-01   +4.172419484665403e-01   -1.583827043255959e-02   -1.105605551550229e-01   -1.727228445035625e-01   +1.562252164759713e-01; +2.500612804686450e-01   -8.995927145546101e-02   -1.057490246275579e-01   +4.336542931790827e-02   -9.998770463097029e-02   +1.163709225798818e-01   +1.357243458704591e-01   -1.774876026669416e-01   -6.449557833005233e-02   -5.606860969666059e-01   +1.349497413187812e-01   -2.252807444987286e-01; +9.124306150055750e-02   +1.018950697085257e-01   +6.205344506698991e-02   +9.532777675863333e-02   +4.638653745266998e-01   +1.079886593620403e-01   -1.367526121082853e-01   -7.305908922774949e-02   -4.209817820719716e-01   -3.803848824293720e-01   +6.205458127363821e-02   -3.821182557643211e-01];
L2E_L3E_iAMPA_netcon = [-2.710276003712081e-01   +3.288730644663755e-01   -1.012400331598905e-01   +1.389633623493375e-01   -6.579580817442135e-02   +3.666231414519919e-02   +2.753627294237777e-01   -4.241185847791690e-01; -5.013448305407034e-02   -3.639018382231100e-01   +1.982384157804393e-02   -5.996365481985724e-02   +1.133244692095292e-02   +1.606939966886329e-01   -5.030148218093331e-01   +3.484712378552395e-01; +8.712513741204364e-02   -8.818909498274907e-02   -8.443476439838196e-02   +1.750462084886396e-01   +4.705069467188536e-01   -1.426311240842746e-01   -3.813047872962533e-02   +7.170161358267249e-02; +3.003580463959690e-01   +3.316896721561277e-01   -2.473109479302577e-01   -8.451291853730220e-02   -3.485171359700362e-01   -1.910298839697040e-01   +5.629016362166811e-02   -1.590891309057689e-01; +2.957083984344867e-01   +1.105181958885557e-01   +4.337184375597293e-01   +3.813417990378331e-01   +6.325112768607033e-02   +2.140698397265826e-02   +4.215772602920914e-01   +2.126020503128833e-01; -3.194314609306529e-01   +1.775379330603316e-01   +1.798276049612511e-01   +4.881004400208352e-02   +5.020482121996606e-02   -3.037223509129937e-01   -2.019605917323442e-01   -1.123557764468440e-01; -3.620535377216598e-02   +2.368897195133293e-01   -1.014403404357124e-01   +2.445417973820319e-01   -4.728924689934817e-01   +1.225788906783438e-01   -1.675704053757375e-01   -8.447035986588514e-02; -2.331189160918007e-01   +3.882836892630255e-01   -3.182235386612677e-01   -2.813215772295153e-01   +2.126649092187451e-01   -1.857067491826868e-01   -2.074806002195968e-01   -1.335963511736391e-01; -2.053142343643234e-01   -1.727942129135619e-01   +1.099552811977529e-01   +5.423085258407238e-01   -6.751408259416883e-02   +2.812867892792830e-01   +5.562964394524574e-02   +2.339307177236023e-01; -8.452545375953174e-02   +1.183027167003690e-01   +1.172517106010763e-01   -1.529008731286916e-01   -3.027101951240257e-02   -1.275117791387920e-01   -1.925223116264577e-02   +8.585231124655811e-02; -1.791787743848773e-01   -2.115054635314075e-01   +1.146063547890924e-01   -2.220888491590770e-01   +4.143172363954001e-01   -1.802508970747637e-01   +1.183153340924984e-01   +3.110585965801331e-01; +1.150345470101141e-01   -1.753345018134353e-01   -2.951169522516068e-01   +2.609747581305890e-01   +1.478992317225576e-01   +4.392501326030779e-02   +3.964166560682739e-01   -9.226922177375299e-02];
L2I_L3I_iGABA_netcon = [-3.787931891332064e-02   +1.352275376211797e-01   +7.368553318391363e-02   -1.591248305292401e-01   -1.420815579817575e-01   -9.326584932483201e-04   -6.536426051757609e-02   +1.220927069347831e-01; -9.018447281436760e-02   +1.153371407596070e-01   -1.046316529650214e-01   -3.085076631435834e-01   +2.781744098376247e-02   +4.877556020746436e-02   +1.585086856039812e-01   +2.082551251512346e-01; -1.464678850503378e-01   -2.375209123127871e-01   +3.018998782971077e-01   -1.545797108417547e-01   +5.009341748276035e-01   -1.320044390107125e-01   -5.117083142044806e-01   -5.960220196617964e-02; +8.682174478518270e-02   +1.577177067088778e-01   -2.628541575649353e-01   -1.221756333073306e-01   +1.319956458500870e-02   +5.122015899211468e-02   +2.450997185305606e-01   -1.172886236036118e-02; -2.071168380524831e-01   -3.462211979785421e-01   -1.643211945609314e-01   +1.717417260114434e-01   -1.855877710371356e-01   +2.222013566864824e-01   +2.977484036871269e-01   +4.994025464984404e-01; +5.287190901886382e-01   +5.733504224130470e-01   +1.761503177452768e-01   -5.946346782460403e-02   +3.094608122721512e-02   -2.038285808215093e-01   +5.371197992471469e-02   +1.222770151170645e-01; -9.625530348600979e-02   -1.446110756221944e-01   -2.122440566189979e-02   -1.771791668047640e-02   -9.783173857469644e-02   -3.015786429816026e-01   -4.375027308614891e-01   +5.248209603776255e-02; -1.753608162620076e-01   +6.394023370420709e-01   -4.924688076289869e-02   +1.516975188063885e-01   -3.865801424168431e-01   -1.558378447804880e-01   +6.549040177602766e-02   -2.447941003368154e-01; +1.782614307410071e-01   -1.353084959161784e-01   -2.714431278441921e-01   -3.088618093934369e-01   +1.566255529699146e-01   +3.683007230236102e-01   -1.857149921484529e-02   +3.405492608580939e-03; +3.124593038430455e-01   -2.025035871915477e-02   +4.749437212889669e-01   -2.373633605697939e-01   -5.051618814874304e-02   +2.046859005746791e-01   +2.402893017930589e-01   +5.089520187850718e-01; +6.575122190271160e-02   +3.034970696050544e-02   -3.768460580406494e-01   +9.053328989385864e-02   -1.357341183893602e-01   -1.833932961216558e-01   -2.853738361343922e-01   -1.230967529748865e-01; -2.094119048354001e-01   +8.160040815750064e-02   +3.327884251182799e-02   -1.742581214620096e-01   +4.443409247998130e-01   -3.756621599781519e-01   -1.949104816379494e-01   +1.015204132406208e-01];
L3I_L3E_iAMPA_netcon = [+2.883860876025079e-01   -1.136468730478714e-01   +2.867299755392472e-02   +2.165358519087767e-01   -8.697607975917707e-02   +2.436719892372496e-01   -2.010000816400975e-01   +8.679629359114951e-03   +1.470218508933052e-01   -2.381770642589336e-01   -3.722897073604035e-01   -3.996335395592229e-01; +2.853917011392146e-01   -4.099384268230201e-01   +1.290007075496658e-01   -2.346334601102598e-01   +2.596844438819779e-01   -2.237868277938576e-02   +3.005834554467073e-01   -1.358948417240768e-01   +4.234862869250464e-01   -1.678512693261595e-01   -6.711337844564405e-02   -3.126349514517738e-01; +1.022261283352434e-01   -2.953469901134150e-01   -3.798889195895322e-01   +5.750560808016880e-01   +8.522612124599618e-02   +2.111772518720172e-01   +2.122075565697839e-01   -2.205980121941604e-01   +2.402601938070739e-01   +1.381737983141822e-01   +1.948608068283328e-02   +2.346872714480401e-01; +2.961444565916315e-01   -2.408420290645529e-01   +3.846007882313729e-01   +1.513931698324854e-01   +1.408735899767483e-01   -2.983096309755109e-02   +2.240165741403419e-01   +3.248385711793639e-02   +1.540083916449190e-01   -1.237792917917594e-01   -7.110609820900660e-02   -2.481136151789958e-01; -1.225436287786111e-01   +2.522988317208030e-01   -1.451208296347737e-01   -1.077592411672627e-01   +1.738163526073746e-01   -5.909596337978101e-02   -4.333580737158586e-01   +1.047187244603398e-01   -5.028509587824814e-02   -2.413222425694364e-01   -4.191722667155798e-01   +2.254883945337527e-01; -9.332372996036398e-02   +1.174021318158216e-01   -2.213977266628344e-01   -1.899765460010899e-01   -1.343251339730231e-01   +7.646083168598511e-02   -2.555472513764691e-01   -3.011125771271453e-03   -1.633437620609157e-01   +1.555244664819102e-01   +2.114564384429669e-02   +1.219870988459847e-01; -1.592526498572643e-01   +1.881741234860051e-01   -4.119067105771169e-02   -1.800890795651220e-01   +6.071874458409474e-01   -3.073228440625195e-01   +1.468236982854490e-01   -3.331806423643792e-01   -2.219058843619152e-01   -9.652576717368758e-02   +2.065813838096918e-01   -1.669073827544125e-01; -3.914872105656741e-01   -3.037273015732908e-01   +3.016669386773236e-01   +3.172491143335083e-01   +8.065252010119232e-02   -9.261442554934554e-02   -9.570521693247599e-02   -5.165844727542244e-02   -3.361230018451348e-01   +3.108127209604801e-02   +6.564554316820111e-02   -1.311333423205059e-01; -8.036742135319301e-02   +3.929162077696394e-01   -1.018890600320787e-01   +2.120129932849240e-01   +1.309677732034946e-01   -1.286913191918614e-01   -3.922690692846599e-02   -6.299732728494142e-02   +1.060250881862563e-01   +4.805681485333486e-02   -7.917335299862938e-03   -7.387163827231663e-02; -5.905263278429913e-02   +7.972425983867781e-02   +4.012009792261533e-01   -1.624244875434774e-01   -3.727969195540548e-01   +3.042197791408698e-01   +8.661367763428221e-02   +3.231305962944325e-01   +4.460510114178099e-01   -1.249787844933744e-01   -7.065005980406748e-02   -4.339152838111462e-01; +2.312591557990260e-01   -3.024481674324421e-01   -4.661205489531504e-02   +9.919919664551245e-02   -2.869162991023145e-01   +1.905440077129536e-01   -4.738658303917745e-01   +3.812735529161654e-01   -1.371334698711530e-01   +2.941679202768136e-01   +2.716250929288040e-01   +3.769690233695938e-01; +4.326533163452837e-01   -2.970792454168072e-01   -2.527657734791453e-01   -2.473274935817489e-01   -2.958347562141080e-01   +5.656126466767086e-02   +3.169886994120714e-02   -1.038768754709320e-02   +2.126163181019586e-01   -4.209697609782508e-01   -2.727894285442037e-01   -4.073090716459601e-01];
L3E_L3I_iGABA_netcon = [-1.973639018760873e-01   +3.340124867477625e-01   -1.031157341805453e-02   -3.232235235049913e-01   +4.214546687086601e-01   +2.185757026253572e-01   +1.958144123429695e-01   +6.788814899556958e-02   -3.357708098352092e-01   -3.075441011093952e-01   -2.613427370062257e-01   +7.160864805299036e-02; +2.784259599817909e-01   +3.681609203532972e-01   -1.677471978613608e-01   +5.723878071339332e-01   -4.563063458614646e-01   -4.627900635864940e-02   +1.587418870083203e-01   -1.140630306904297e-02   +2.580498554893086e-01   -4.365028131504214e-01   +3.451082174985231e-01   +5.255811477883235e-02; +7.191742808131331e-02   +1.806458485980177e-01   +1.441191005369129e-01   +1.562708315710881e-01   +9.960454723291381e-02   -2.101344630733104e-01   +1.818879742398406e-01   -5.391204336362548e-02   +3.710480956088085e-01   +3.216005308155993e-01   +2.482507251859035e-01   +2.676155176910464e-01; +3.205928354457955e-01   +2.387279181740969e-01   +2.918479987326882e-02   -1.194072655194903e-01   -7.814112759666932e-02   -2.086473796775608e-01   -2.441494978170116e-01   +3.651844314127933e-03   -1.487526203050842e-01   +2.472259025906120e-01   -9.790942341040315e-02   -2.945291694296162e-01; +5.182855585649018e-02   -1.157834134060226e-02   -8.127507257752792e-02   -9.735035521837396e-02   +1.816556276795727e-01   -2.558231379710829e-01   -3.142049519426425e-01   +1.212684684071027e-01   +2.184519121897431e-01   -5.318019938378786e-01   -2.010291331630812e-01   -3.702653457448299e-01; -4.993562430214067e-01   +2.690366416820503e-01   +1.447293765436326e-01   -3.012014197471813e-01   +4.465233394765418e-01   +4.808658978283539e-02   +2.023193144163311e-02   -1.790760452771993e-01   +5.187840338661751e-01   -2.911891323405338e-01   +5.041022810415668e-01   -2.315142076220659e-01; -2.418254165498030e-01   +2.187831953755868e-01   -9.743471749750154e-02   +4.604367112990496e-01   +3.661442968761752e-04   -4.451007643649620e-01   -7.824461662663329e-02   +1.992536536679654e-01   +6.582018197489113e-02   -8.410955583054115e-02   -6.583229412749825e-02   +5.254911522204680e-02; +9.991250543315272e-02   -4.109094593138065e-01   +2.774729500305588e-01   +1.361481411163556e-01   -9.580189319981100e-03   +8.838283628433050e-02   +2.069008132587090e-01   +2.942856899268687e-01   -4.336261653929682e-01   +5.060603316096678e-02   -1.353666903984024e-01   -1.411756882231574e-02; +1.816486726995575e-02   +2.414560164315820e-02   +2.747541787039025e-01   -1.282878251784076e-01   -5.088538589037211e-02   -1.273277110649714e-01   -2.056506295081641e-01   -9.534501305587997e-03   -3.636218570800933e-01   +1.723564650515964e-01   -1.397834625860936e-01   +1.349581880537294e-01; -5.356388230961859e-01   +3.725797262482478e-01   -2.079604326091134e-01   -1.299086322002481e-01   -1.086248648114066e-01   +1.777899024257262e-01   -4.110408446381402e-01   -3.523282445118953e-01   -3.367572534760539e-01   -1.686610155049192e-01   +2.064871877824058e-02   +3.831913350309396e-01; +2.741106090200995e-01   +1.481679761679054e-01   +2.551686848159520e-01   -2.881525401877866e-01   -8.577047245929545e-03   +1.034193067363452e-01   -2.799032744374611e-01   -2.904765305995004e-01   -3.881004970528518e-02   +4.364968555035348e-03   +1.286399541657380e-01   -3.989467296776321e-01; +4.650046725445357e-02   -2.292599592929749e-01   -2.672816930587458e-01   +1.589119347412504e-01   +2.630563507755667e-01   -1.282318809708817e-01   +2.442136866378427e-01   +5.990904462757600e-01   +1.239050883889271e-01   -2.820473571437202e-01   +4.062175610980132e-01   -2.102182779243367e-02];
L2E_Input1_iAMPA_netcon = [-6.037954001184066e-02   +4.669513075797510e-01   +3.314409405177978e-01   -2.138222118293622e-01   -5.723989578201480e-02   +1.650180529149690e-01   -4.997170786692911e-02   +2.848577002327907e-01];
L2I_Input2_iAMPA_netcon = [+3.817151255800612e-01   -2.126093283652657e-01   -2.250367812117169e-01   -2.355948670941352e-01   +3.946274802334175e-02   +8.114350699774441e-02   +4.539476422415720e-02   +2.820078566474857e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
