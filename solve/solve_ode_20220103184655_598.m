function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.144714271939677e-01   +9.463112650630875e-01   +6.988932138738975e-01   +1.553341446515872e-01   +9.218065183909361e-01   +2.199134080346120e-01   +7.410650011206885e-01   +3.021193866113627e-01   +5.330997144491494e-01   +8.289048393732522e-01   +9.685548632083832e-01   +9.642087539209182e-01   +6.958853378650529e-01   +3.712805496701689e-01   +2.973857094698867e-01   +3.786009860630741e-01; +3.451516933907503e-01   +1.310527186996660e-02   +1.413528792958795e-01   +1.756323415899290e-01   +7.110282926108430e-02   +8.071752260758384e-01   +7.948724704568776e-01   +7.585580836730245e-01   +7.843548238114584e-01   +1.810012037845783e-01   +4.666546376056462e-01   +6.562695321164856e-01   +3.755404468093419e-01   +2.748626917471076e-01   +6.850570279970325e-01   +9.535045719547696e-01; +2.071702074347627e-01   +4.678084924333172e-01   +8.371666987136782e-02   +7.032815500929629e-01   +3.139770741657038e-01   +3.820387489769412e-01   +6.635882293818441e-01   +9.530466936065290e-01   +4.858765875662825e-02   +9.262514110038257e-01   +8.698189045180424e-01   +2.094799448058946e-01   +5.411846926677899e-01   +7.537499881079597e-02   +7.724327192429410e-01   +8.115317622051599e-01; +2.480218071979684e-02   +4.899702632067358e-01   +4.329222664967959e-01   +8.320161320978751e-01   +6.279962510664940e-01   +8.564804245785556e-01   +4.414577308688434e-01   +8.730624750658439e-03   +4.628834712563359e-01   +4.207730973217373e-01   +9.463293351892217e-01   +8.974107879373817e-01   +5.182559332674395e-01   +1.512961591675530e-01   +7.208812770048163e-01   +8.919207181401467e-01; +7.659729599331641e-01   +5.154670215894284e-01   +8.946854937562674e-01   +8.111815898816868e-02   +9.053533266520121e-01   +3.238575091541341e-01   +5.755241779938600e-01   +4.074905906451601e-01   +9.379908060499077e-01   +3.008992602821013e-01   +2.325117965972340e-01   +4.879815881684540e-01   +7.642538414118165e-01   +3.648757850123053e-01   +2.789449550707082e-01   +6.839974458201041e-02; +5.708608497489933e-01   +2.869542125279206e-01   +7.321931526753890e-01   +8.354415904558747e-01   +7.968803600554035e-01   +3.791310113613294e-01   +5.183246570990594e-01   +1.515170193134450e-01   +4.727454333120548e-01   +3.489247202363549e-01   +9.184241087880428e-01   +6.619218310059890e-01   +7.940110992644484e-02   +7.181328904355935e-01   +1.388695420746812e-02   +9.026583174771510e-01; +5.761649345998057e-01   +5.645026025741389e-01   +6.806782052887086e-01   +5.409822817344050e-01   +6.431502178885475e-01   +6.369944906754246e-01   +7.248634466150565e-01   +8.212935794723647e-01   +7.787886322274700e-01   +9.718169564445668e-01   +6.348344816829996e-01   +5.260032344578119e-01   +5.437593214019864e-03   +5.323610739638651e-01   +1.484833164584403e-02   +6.679686180486853e-01; +3.903185314703670e-01   +5.095381744201584e-01   +2.013452263048506e-01   +9.625142247714120e-01   +4.404771050679555e-01   +3.877323417749043e-01   +2.220355102982983e-01   +2.879506293877748e-01   +1.092361261756297e-01   +5.304601775171655e-01   +2.840844452351515e-01   +7.085214670645237e-01   +4.008675757151846e-01   +2.322249765254209e-01   +9.365128173105379e-01   +3.469464252103966e-01; +5.564683508299112e-01   +6.779239917204092e-01   +5.298213370152830e-01   +6.775978445902099e-01   +7.482406849114309e-01   +6.752796357235273e-02   +9.982073886694723e-01   +9.779596057606673e-01   +5.223041291082210e-01   +7.899630055744906e-01   +8.556918264264535e-01   +7.188568877010525e-01   +6.621907209386949e-01   +4.701637276800441e-01   +9.339005093497423e-01   +8.370967784575185e-01; +1.832530411925421e-01   +6.158358448044364e-01   +8.305184646590569e-01   +3.362783686600463e-01   +8.252063796960519e-01   +1.710690711343464e-02   +6.197985262585681e-01   +6.250266632759960e-01   +6.357776111091822e-01   +7.941376826109735e-01   +1.657793209663610e-01   +2.944120771392581e-01   +3.683546967844434e-01   +7.168236822768487e-01   +3.746371726531038e-01   +1.982844760010987e-01; +1.183208059626366e-01   +5.652705535392216e-01   +1.750235189248289e-01   +2.211080251755624e-01   +3.409910256827407e-01   +8.794753299073872e-01   +9.798279165486774e-01   +7.438651698400346e-01   +5.785339471703304e-01   +1.448175472342702e-01   +8.280675638275344e-01   +1.168058174499861e-01   +3.926316932390970e-01   +5.147458794945144e-01   +1.090337786072427e-01   +8.419823977793626e-01; +5.898267427024128e-02   +5.042792477090740e-01   +5.181353464267792e-01   +5.691457370565579e-01   +1.388726140850115e-01   +1.572442465920365e-01   +4.951565161985586e-01   +8.722889377568468e-01   +8.349858094130567e-01   +4.565393484279212e-01   +2.166523668520708e-01   +3.251753606766637e-01   +1.345738872954443e-01   +5.138317996639705e-01   +7.191179789180665e-01   +4.248755499786860e-01; +9.329508199350340e-01   +6.679903672067852e-01   +3.561176322629645e-01   -1.691113957001954e-05   +5.041014500721336e-01   +9.140141155948004e-01   +5.225976290929661e-01   +3.288015565271581e-01   +1.157494053392796e-01   +4.585883572251668e-01   +2.682171024128542e-01   +4.570584104084998e-01   +3.384716949046864e-01   +3.858903033586290e-01   +4.494665720101902e-01   +5.589104240383116e-01; +7.452819705298485e-01   +6.329676865550483e-01   +6.451648462463633e-01   +5.888535858315205e-01   +4.138553743253784e-01   +5.559371228463862e-01   +8.543607282208666e-01   +9.923244196173682e-02   +5.189194156544539e-02   +9.541972423122345e-01   +8.671599678204324e-02   +7.168555482755155e-01   +1.223689870496949e-01   +4.793242133719534e-01   +1.256428601509499e-02   +4.481217760053474e-01; +2.427183427719329e-01   +1.450210768498813e-01   +2.815183013842273e-01   +8.913599195751030e-01   +1.717118680629858e-01   +9.221716391716490e-01   +2.538409365938102e-01   +4.504686393957131e-01   +5.177931559648651e-01   +5.332948460079589e-02   +9.169440395771883e-01   +4.053380540543675e-01   +3.688666579121958e-01   +7.396496767749730e-01   +1.239177329973066e-01   +7.597517480546835e-01; +2.045374563306958e-01   +1.788659330866779e-01   +4.368891384783006e-01   +2.548242034290503e-01   +4.941383030966518e-01   +5.977432085991465e-01   +5.828248252825303e-01   +2.393702825443890e-01   +6.974076821210045e-01   +3.640870813141014e-02   +7.259836577120714e-01   +2.419093675507827e-01   +2.505864638532633e-01   +7.015065594335894e-01   +6.590119993164325e-01   +9.587805044130636e-02];
L1E_L1I_iGABA_netcon = [+8.441886832655039e-01   +7.525071200309628e-01   +8.743851129504586e-01   +4.349953683680127e-01   +9.178844890380052e-01   +7.792769442088371e-01   +3.216838213498764e-01   +6.411170282342802e-01   +9.411852447241818e-02   +2.688143216526877e-02   +1.289921397122814e-01   +5.200442103770120e-01   +8.700870541079395e-01   +5.762510924675650e-01   +1.658999897993712e-01   +6.273149775425650e-01; +6.214852304256596e-01   +9.952890050129188e-01   +3.092301374811747e-01   +1.474649309999183e-01   +8.832608837458876e-01   +2.732498848765577e-01   +9.629116917862632e-01   +4.290782741124804e-01   +2.923303772586565e-01   +5.140064240644853e-01   +4.248797413280478e-01   +2.043025051071188e-01   +8.026578987909185e-01   +2.878527875794140e-01   +5.462535125554642e-02   +3.366146911941761e-01; +6.714203969178073e-01   +3.708418720834811e-01   +4.331750379443858e-01   +6.540818636134845e-01   +5.862160495198343e-01   +5.270832819027751e-01   +3.522983733944892e-01   +4.781556816603267e-01   +3.264899924385595e-01   +8.629269734489100e-01   +4.805457002785569e-01   +7.747804314596012e-01   +6.466683625164356e-01   +1.320518779421749e-01   +2.113784406421854e-01   +1.564156608024618e-01; +7.822300763299599e-01   +5.024066905913243e-01   +3.819051902065357e-01   +7.213574708753199e-01   +8.354510998852621e-01   +4.031594151438493e-01   +3.205983870495854e-01   +1.001836312215618e-01   +4.832926559039447e-01   +5.814693189370534e-01   +6.743095065780060e-01   +3.907564845991663e-01   +7.348374663107974e-01   +4.996848768611892e-02   +2.042276216034513e-01   +4.018381706051283e-01; +3.086608583224826e-01   +7.584408907151575e-01   +6.565102568943060e-01   +1.617822883918784e-01   +7.763844835042530e-01   +7.788976425251700e-01   +9.082395470872677e-01   +8.069604196020376e-01   +2.413925123126617e-01   +4.224261088360244e-01   +3.571665671595753e-01   +6.652943783028341e-02   +6.671136229101778e-01   +6.245507086571055e-01   +2.171947527971903e-01   +9.130176528118563e-01; +3.302613663920361e-01   +1.272385217063560e-01   +2.373432981891801e-01   +3.427594559374455e-01   +7.850229145421362e-01   +2.541485874400129e-02   +8.851601736069812e-01   +6.499135975115734e-02   +4.539047644395542e-01   +7.132691592912723e-01   +4.986642849450532e-02   +7.559073415626619e-01   +8.807351393232578e-01   +6.056556846943916e-01   +5.784909348114856e-01   +1.490885635291050e-01; +6.340537761310442e-01   +5.177157670531900e-01   +6.858139838470122e-01   +1.060852107352818e-01   +7.013471318233800e-01   +4.122397563729736e-01   +3.525447284175153e-01   +9.547509518107294e-01   +7.582446302898969e-01   +2.338939488029256e-01   +2.904855668662891e-01   +4.533886329633552e-01   +8.530539885358934e-01   +3.715631924117767e-01   +3.380371673322447e-02   +4.644029834135742e-01; +9.017231124182072e-01   +9.058215798796274e-01   +3.264339851710677e-01   +4.160208493214519e-02   +1.832296475781035e-02   +8.265066607279734e-01   +7.499142084176402e-01   +7.731339871375073e-01   +7.185676077862996e-01   +5.899173594510605e-02   +7.942356997520559e-01   +3.192734939080289e-01   +4.034920161428316e-01   +8.316141696978157e-01   +7.958543144134335e-01   +7.818751770750319e-02; +3.713696775850889e-01   +9.936346141718677e-02   +8.809083934998110e-01   +4.786683490393084e-01   +3.307871284686930e-01   +5.924599630685907e-01   +1.263185693014622e-01   +4.404243884583355e-01   +2.380794408027144e-01   +9.759390070438054e-01   +6.515454810792790e-01   +2.780078083130478e-01   +1.055149019631028e-01   +5.195797535604147e-01   +1.345890823348507e-01   +3.424290128324234e-01; +8.819255048763708e-01   +1.786000973413307e-01   +9.987847701809327e-01   +4.772978104273331e-01   +9.473628637466754e-01   +2.131579303801116e-01   +5.996770098925657e-01   +1.656476163334299e-01   +6.994110785844267e-01   +9.693380664981426e-01   +7.097797656445461e-01   +5.836740735524482e-01   +4.031620337689584e-01   +8.007746541017288e-01   +5.826485300061948e-01   +4.962741092853203e-01; +1.242568036538897e-01   +1.731765649162131e-01   +6.808808185267405e-01   +5.458680198936725e-01   +3.990999801797861e-01   +2.962889001118366e-01   +4.371055721726645e-01   +8.066087822976829e-02   +3.051623327835993e-01   +1.365896086777452e-01   +7.652574447166817e-01   +9.120487761618528e-01   +3.402825379518844e-01   +5.703344906205249e-01   +8.547823182153910e-02   +4.894906016825204e-01; +8.885489274792700e-02   +5.342360221126224e-01   +3.449171381539008e-01   +6.517044483909261e-01   +6.318143395879831e-01   +2.682299179243685e-01   +9.591993927105054e-01   +7.420779623451845e-01   +4.697755594816465e-01   -2.184280661735127e-04   +3.840266384628634e-01   +4.511242497757122e-01   +1.145161300309224e-01   +7.147103282910230e-01   +2.288996359663203e-01   +1.279043993054349e-01; +5.457591407130884e-01   +9.789565698074211e-01   +5.608507176273919e-01   +3.486140430434245e-01   +8.591108267739130e-01   +9.283783131738016e-01   +9.639585361146810e-01   +5.441593593269346e-01   +4.446308980873046e-01   +9.364135760407996e-01   +3.620200750352003e-01   +9.805086991699612e-01   +8.521035886084978e-01   +7.330788184661980e-01   +4.520690011751206e-01   +8.562424833575520e-02; +6.108372066704345e-01   +8.428107175020143e-01   +8.904573401628364e-01   +2.559811503513248e-01   +3.770751556898771e-01   +5.527448227903385e-01   +2.425898273509930e-01   +4.860341625029537e-01   +7.342003844845358e-01   +7.411126014424068e-01   +8.102344498889159e-01   +1.110109213041945e-01   +8.920714937338659e-01   +4.548127204603216e-01   +1.789398417032348e-01   +6.740975370107929e-01; +7.273421467535313e-01   +6.731399550019583e-01   +6.465810465317916e-01   +1.761868775999214e-01   +2.050567735812557e-01   +4.324842843830987e-01   +7.705909639930478e-01   +8.958343431068312e-01   +8.763183967648400e-01   +4.328878790797838e-01   +3.858291439916879e-01   +4.157148152640788e-01   +6.858733271431293e-01   +2.831372501990629e-01   +4.144924724633526e-01   +1.216952789217686e-01; +9.918444238134745e-01   +8.990789031762909e-03   +3.771262070832206e-01   +4.784918285448725e-01   +9.117540787491109e-01   +3.280606921545517e-01   +7.125570267885025e-01   +5.826317287014352e-01   +9.136958296105587e-01   +9.438609640118716e-01   +8.716847601459640e-01   +3.829184426364499e-01   +7.432500872384905e-01   +1.516818407445938e-01   +9.650178232998808e-01   +9.890622593859150e-01];
L2I_L1I_iGABA_netcon = [+5.745235200530927e-01   +5.645599404370412e-01   +1.078351168118601e-01   +4.595521897254979e-01   +7.969687255443628e-01   +9.781392654138571e-01   +2.237750328195155e-01   +7.587553541045939e-01; +5.583740437905291e-01   +9.531004882910958e-01   +1.189727266843601e-01   +5.671218431408379e-01   +5.419052317490270e-01   +4.227481746307668e-01   +6.646725483379894e-02   +5.059786427917973e-01; +6.108397347629198e-01   +9.028719851750498e-03   +4.336911613754017e-01   +8.170952452482294e-01   +2.574886528220018e-01   +3.928674511749619e-01   +8.357393108723198e-01   +8.280824633654175e-01; +4.668590296726222e-01   +1.262635351801760e-01   +9.325929730682780e-01   +3.554349099068301e-01   +7.811300231220926e-01   +4.608210348905538e-01   +4.157492376881761e-02   +9.278054893135600e-01; +4.346338334097096e-01   +8.535845802606071e-01   +1.396396271448303e-01   +2.482537257573493e-01   +7.790056732477322e-01   +1.213669418810541e-01   +9.095284961700058e-01   +7.109053832071720e-01; +6.272344482347227e-02   +2.180628905410885e-01   +8.263520761540423e-01   +7.715817428173322e-01   +1.442594472225509e-01   +4.545328580244768e-01   +4.497069428301860e-01   +7.979077822917326e-01; +6.466333320132818e-01   +7.095073417805575e-01   +9.327359220986191e-01   +1.889633697419568e-03   +8.231193995841335e-01   +2.650138133612920e-01   +2.848411894447155e-01   +9.587053227041188e-01; +4.261572261436184e-01   +7.744347447419663e-01   +5.729731231232883e-01   +2.762742483990490e-01   +6.236934461667147e-01   +9.316713563603006e-02   +7.552858983167720e-01   +9.511556628070240e-01; +7.564205123031265e-01   +4.211527178688406e-01   +4.988103887406722e-01   +2.335375504423599e-02   +4.569786977187132e-01   +6.617339930606280e-01   +9.270258443069463e-01   +2.952792620623516e-01; +3.064113884066590e-01   +7.256396030224530e-01   +9.311945482830095e-01   +6.700602526639433e-01   +4.838363053765612e-01   +9.452101936590583e-01   +1.406885193403585e-01   +3.524433601255163e-01; +5.976071345027401e-01   +4.579937942243672e-01   +8.627216818713296e-01   +9.672720496085775e-01   +2.193898289415107e-01   +7.649666908208380e-01   +9.554089255600698e-01   +5.414327011304926e-01; +3.347582078710190e-01   +8.046676275985412e-01   +2.534179125824908e-01   +9.453723749811771e-01   +8.579924395892804e-01   +4.340904598734894e-02   +3.042868912640573e-01   +2.131589498456236e-01; +6.430837802263244e-01   +4.280283963446176e-01   +4.583424642594756e-01   +4.662545231815159e-02   +8.796776730554265e-01   +2.611988773823979e-01   +2.092985364654394e-01   +8.059355546378524e-02; +7.515379975956954e-04   +1.492736718895002e-01   +7.405777885353021e-01   +2.865201514939973e-01   +8.455875192992603e-01   +6.349486299864824e-01   +4.635717349783761e-01   +5.064894643065874e-01; +1.443901607674072e-01   +8.048342708290094e-01   +7.522649442090268e-01   +4.876630787204725e-01   +4.429413982580526e-01   +8.979721001285690e-02   +5.971940778495235e-01   +1.948617231732867e-01; +2.477207351164945e-01   +3.813827351535961e-01   +2.303242593878863e-01   +8.874071914034852e-01   +5.425807873972737e-01   +7.507913872010380e-02   +5.521309751652449e-01   +1.456152279453161e-01];
L1I_L2I_iGABA_netcon = [+6.990353567217430e-01   +8.675289966092844e-01   +6.142996687495760e-01   +5.500166298601498e-02   +1.435918753928574e-01   +2.346548774512230e-01   +8.383991137137997e-01   +3.709185261641586e-01   +7.063652160371735e-01   +3.842856755061125e-01   +2.391756254735852e-01   +6.664378704839103e-01   +1.679258537470183e-01   +5.697953302053020e-01   +4.365260964165654e-02   +4.888524299511018e-02; +5.982344370240354e-01   +7.980055864815224e-01   +6.104428775052706e-01   +5.762615343654132e-02   +7.443389955176151e-01   +5.565542282430320e-01   +1.980709453995192e-01   +5.588780851126730e-01   +1.872012331289516e-01   +7.198028352268954e-01   +5.134234987133940e-01   +3.292512298365871e-01   +1.151823255412425e-01   +8.094187468752087e-01   +4.423435019605848e-01   +9.215463444458730e-01; +1.626604857064098e-01   +6.269144822282838e-01   +3.138902040436687e-01   +5.971907220099532e-01   +9.514065523097320e-01   +1.136189468096061e-01   +6.177870419323984e-01   +8.298851455469712e-01   +2.307893320351276e-01   +6.417975629386916e-01   +7.322427878916453e-01   +5.516247993729927e-01   +7.358462694916014e-01   +6.738389986929889e-01   +9.167890786671508e-01   +1.743057769154265e-01; +4.833352599681228e-01   +4.725190860891260e-01   +1.421761415125230e-01   +6.569535205858543e-01   +2.656995914645299e-01   +8.182986906068566e-01   +1.545727675060220e-01   +7.071167320765708e-01   +9.986326328609032e-01   +1.013176703209625e-01   +7.706393396545315e-01   +5.323890218355708e-01   +2.109863181852865e-01   +4.438068163235450e-01   +8.847619225855492e-01   +7.440962512193241e-01; +2.855497085601234e-01   +1.894627754108585e-02   +6.048420050359630e-01   +4.804156794241521e-01   +9.500307897320619e-02   +6.506280546573113e-01   +5.834089143114315e-01   +1.160629788285317e-01   +9.054455965098910e-01   +4.916554168276730e-01   +6.769868920930537e-01   +9.015329091031558e-01   +4.836655090253930e-01   +8.935537455620494e-01   +9.227839639128863e-02   +4.758465998155668e-01; +4.033718166662939e-01   +1.177419437992626e-01   +8.896413565779691e-01   +9.780016732324839e-01   +2.315623533960094e-01   +2.378688316945197e-01   +5.450918824905486e-01   +7.406432964339826e-01   +1.158536295445916e-02   +5.616541101884506e-01   +8.128804911579083e-01   +2.839784777179211e-01   +5.037543701744544e-02   +7.829695554427181e-01   +6.751262107514902e-01   +2.462740419826044e-01; +4.912153372747873e-01   +7.193398451951007e-01   +5.629135692685563e-01   +8.641589027363137e-01   +8.961545060299561e-01   +3.016133707060092e-01   +6.816585719396393e-01   +9.240403835405508e-01   +8.344452202079949e-01   +5.594693755975819e-02   +4.186252077115606e-01   +1.392405515503795e-01   +5.715190869513618e-01   +5.813942030363113e-01   +9.831231731085369e-03   +6.636243956139405e-01; +8.627060799338646e-01   +6.822913082161115e-01   +6.333096193297851e-01   +9.542710247943920e-01   +1.999947523256365e-01   +3.300308143756138e-01   +6.986497033008158e-01   +9.232777660007218e-01   +2.527517543285206e-01   +8.915392177884746e-02   +4.974370748899515e-01   +9.572456809290661e-01   +4.909475676816868e-01   +6.165654103113389e-01   +1.210270490266008e-01   +6.092635788324561e-01];
L2E_L1E_iAMPA_netcon = [+3.677332384364927e-01   +5.620056339142779e-01   +2.008657467567574e-01   +5.141618032031908e-01   +2.902555998006098e-01   +7.430397752959411e-02   +2.785716994256908e-01   +2.672419033780497e-01; +4.373618124305946e-01   +1.931300050099267e-01   +1.367666933172264e-01   +6.854576292847266e-01   +6.202262683952445e-01   +5.938600907477595e-01   +9.292595043845746e-01   +9.044190565907748e-01; +7.179399286812579e-01   +6.128138843596271e-01   +8.161249633352513e-02   +2.072990991974547e-01   +8.626989618781231e-01   +7.615985209504134e-02   +7.636471515825983e-01   +1.593740144523726e-01; +1.914870087748103e-01   +7.405054681752024e-01   +9.100181665363212e-02   +9.720724226490618e-01   +8.204106806894641e-01   +3.970720134934827e-01   +2.623456539285876e-01   +5.538759104453260e-01; +4.028801298020181e-02   +8.315192123113386e-01   +5.512376513853103e-01   +3.506021818946488e-01   +2.061438562527149e-01   +5.928823361280354e-02   +2.428554970306707e-01   +4.224349942535680e-01; +3.149072413706918e-01   +2.770622937447580e-01   +7.318185848414943e-01   +1.850214953072295e-01   +7.505073992867082e-01   +1.288844125325795e-01   +1.657038183221618e-01   +5.471109853718231e-01; +7.900799066684731e-01   +6.081283055728200e-01   +5.439509978502864e-01   +2.384703220949342e-01   +1.984780992145198e-01   +2.443888589617400e-01   +2.875407464590711e-01   +7.544214383581181e-01; +4.701855697775457e-02   +5.479597030405868e-01   +5.483110876919056e-02   +2.541345114777285e-01   +5.776989854426168e-01   +9.439795330273447e-01   +5.645041523608079e-01   +1.349874903663391e-02; +2.164005303708550e-01   +2.742014945712606e-01   +6.321541175730619e-01   +2.227431696842577e-01   +8.772253125610517e-01   +2.034664916174608e-01   +4.051336207540004e-01   -1.252303324878102e-03; +2.738969114292522e-01   +3.402519535565669e-01   +9.941003212928725e-01   +3.618698394785665e-02   +7.139860497580883e-01   +3.273517011277489e-01   +9.867019380274403e-01   +2.158987447912084e-02; +7.894912804026195e-01   +5.665911917995644e-01   +9.153755073110313e-01   +3.566211753408238e-01   +7.005512196285902e-01   +8.665532531920035e-01   +5.443371803146930e-01   +3.589193995184663e-01; +9.903251100035143e-01   +7.437483789313327e-01   +7.682244042709433e-01   +8.985753105096357e-01   +4.673141630996864e-01   +9.223308054339021e-01   +9.287041421079172e-01   +4.267462599312534e-01; +9.493601015554766e-02   +7.717306822198717e-01   +1.913636387035747e-01   +1.399422654389640e-01   +5.045475548403693e-01   +2.364908812283037e-02   +9.920957491193509e-01   +5.450980100028237e-01; +1.962134321391261e-01   +3.982357235547528e-01   +3.177623155924438e-02   +9.554257934367995e-01   +7.964454516428707e-01   +3.648912357073786e-01   +8.364167535050901e-01   +4.924442481928545e-01; +1.165228053867944e-01   +1.490317285050029e-01   +3.731874039415961e-01   +9.020977539838643e-01   +9.398507257968637e-01   +5.281549884822134e-01   +1.808182034620096e-01   +9.205778051020815e-01; +6.474506867708046e-01   +2.078620070643750e-01   +5.753537544176219e-01   +4.102270525575928e-01   +7.816805770084678e-01   +4.063794766961676e-01   +3.134898660848174e-01   +4.162322662951335e-01];
L1E_L2E_iAMPA_netcon = [+4.972851133430048e-01   +4.498447069109478e-01   +6.166334051930890e-01   +4.902500188799099e-01   +2.302028399390638e-01   +7.209899733295992e-01   +6.945974210476787e-01   +6.325774350707131e-01   +5.222123452567222e-01   +2.414471061500297e-01   +8.767878792828344e-01   +1.738854695772815e-01   +1.378301944932718e-01   +2.436625481524110e-01   +1.831295378208270e-01   +2.384441048895014e-02; +8.382389531637208e-01   +3.690151527147973e-01   +1.035872343680640e-01   +6.610059604508568e-01   +8.360859876036039e-01   +3.803118490386692e-01   +9.791998865357282e-01   +6.267697127545442e-01   +6.729462704286079e-01   +7.290549331922791e-01   +6.590061619608523e-01   +3.029407604413315e-01   +2.827594693966374e-01   +7.486640001746899e-01   +1.461183207274541e-01   +2.510663323270804e-01; +1.852440284811065e-01   +3.007440068463054e-01   +7.522807220534999e-01   +1.787446572504874e-01   +7.346931092863056e-01   +3.842045352707900e-01   +7.506181331204126e-01   +4.075261043142370e-01   +7.775209317489183e-01   +1.362447157569150e-01   +5.383707229125999e-01   +1.092605782870120e-01   +7.174333751946827e-03   +9.369066220483239e-01   +1.327787320859996e-01   +9.893263731062216e-01; +3.365582284797101e-01   +2.324410453412924e-01   +5.361441827737158e-01   +4.791767334687197e-01   +4.893434466941899e-01   +7.159914136438433e-01   +5.533218129188124e-01   +4.252816727811259e-01   +4.635410740838085e-01   +4.104710086615838e-02   +2.521710430450041e-01   +4.513305214206205e-01   +3.059128528013494e-01   +2.969218205404744e-02   +1.718876000511066e-01   +6.294960344992471e-01; +6.929680580729909e-01   +1.370497449720556e-01   +4.440015364703282e-01   +4.989936759820524e-01   +8.489134123154799e-01   +8.389122133071834e-01   +2.951411852366091e-02   +5.104908991074038e-01   +9.077049047776582e-01   +6.497768220424560e-01   +1.053673047167672e-01   +5.841684469190572e-01   +9.053586789167855e-01   +4.353450749682917e-01   +9.230815828357138e-01   +3.576237164566045e-01; +6.926647900044453e-01   +9.956645110276639e-02   +7.430650468321786e-01   +6.008099326510284e-01   +7.149147462929551e-01   +6.675859410747763e-01   +1.950579278861667e-01   +2.598346286000701e-01   +2.505743931653385e-02   +2.001938880563125e-01   +9.711636554123541e-01   +2.244301549477432e-01   +2.944995429689731e-01   +8.309777589324497e-01   +2.594195977131642e-01   +9.389139026674576e-02; +3.678104643206478e-01   +2.266865993410418e-01   +3.873344161237958e-01   +2.407221991874932e-01   +5.215539072570879e-01   +6.509884537065330e-01   +9.416208152725336e-01   +4.233559052591101e-01   +4.799069540943968e-01   +9.731560528280776e-01   +5.969571013898198e-01   +1.107704524857267e-01   +8.330995418348675e-01   +9.994003902633172e-01   +2.055077161820142e-01   +4.092067274153911e-01; +3.467716589255198e-02   +3.464308794380678e-01   +5.258617116789766e-01   +5.173311144657672e-01   +9.373749886020389e-01   +5.639509270059483e-01   +3.970568830958552e-01   +5.233265866402588e-01   +2.712140290153522e-01   +8.207829736797424e-01   +8.190318814791675e-01   +5.605997380814325e-01   +7.454939600126719e-01   +9.204502486674241e-01   +6.132848146681504e-01   +9.310504056970378e-01];
L2I_L2E_iAMPA_netcon = [+6.775765308588214e-01   +6.148846221732615e-01   +4.177651765948747e-02   +7.923628626565081e-01   +5.236801403944462e-01   +8.265872979745418e-01   +6.442516070834465e-01   +3.859356414888546e-01; +2.295499641924359e-02   +9.451737047272781e-01   +5.488049279563970e-02   +9.293019374236521e-01   +5.411053312678882e-02   +1.081909661529787e-01   +3.934947758560162e-02   +1.670196589644794e-01; +7.339494053674080e-01   +9.641496126096525e-01   +4.014195399435446e-01   +9.362141831257428e-01   +2.874394641824526e-01   +2.347058334683125e-02   +5.683172829478136e-01   +4.444352601777098e-01; +2.131804852596896e-01   +3.689388718398007e-01   +9.838527723728920e-01   +1.462090788843726e-01   +7.098775372268874e-01   +1.178200468436557e-02   +3.044313124081672e-01   +8.731933790552332e-01; +8.603299244311069e-01   +7.952447058734218e-01   +7.119448692126796e-01   +3.195534615814230e-01   +8.780415603169200e-01   +3.365939405617281e-01   +2.612831019262526e-01   +4.112855061487488e-01; +1.568909843806130e-01   +7.282325312161474e-01   +9.889265167921473e-01   +4.284703267880946e-01   +3.662294001963494e-01   +6.637670728887002e-01   +7.216579113820853e-01   +1.627733279101496e-01; +6.690193025429412e-01   +9.536542193325901e-01   +6.456614299776774e-01   +7.014820542371164e-01   +5.607128626764525e-01   +5.952985888059652e-01   +3.055080843043073e-01   +6.622518979147830e-01; +9.359877852204108e-01   +1.099766525674257e-02   +5.019144807494113e-01   +6.148567026657890e-01   +8.834299388284186e-01   +8.004064365569827e-02   +8.954367248393218e-01   +9.255475157612781e-01];
L2E_L2I_iGABA_netcon = [+5.972686107580830e-02   +5.194785452084715e-01   +3.523250689307963e-01   +2.617977360378552e-01   +4.206211069463987e-02   +8.903368066566899e-01   +3.444599577564877e-01   +4.510555120045328e-01; +3.541223966724239e-01   +6.942030221350642e-02   +5.566068167712193e-01   +9.841145109028406e-01   +3.604753094013655e-01   +5.403287341684836e-01   +9.353926816976150e-01   +6.718694805873044e-01; +9.325179816430162e-01   +1.844632774583408e-01   +6.923238777123902e-01   +3.492760018155703e-01   +3.582291012324784e-02   +7.171643368713668e-01   +9.186278100900080e-01   +7.694346075598221e-01; +2.417740320107181e-01   +3.172289457712875e-01   -6.388461673595581e-03   +4.025648823488195e-01   +4.861609938133519e-01   +7.106608393207191e-01   +7.250070869602544e-01   +9.270978919016785e-01; +1.022818791118675e-01   +2.434873423702300e-01   +4.790040027571107e-02   +7.523669593709995e-01   +7.236635524443967e-01   +1.694608336131165e-01   +4.422492541880473e-01   +6.581284005150972e-01; +7.159955345502775e-01   +3.222436355113734e-01   +3.083773673137175e-01   +1.013033309224487e-01   +1.424069596684381e-02   +3.522806364912632e-01   +1.513808669197086e-01   +5.015619832540851e-01; +5.490027269422191e-03   +8.788508042718155e-01   +8.689471577420160e-01   +5.908322100174821e-01   +5.170272165780602e-01   +3.795316824627865e-01   +8.316765583751796e-01   +3.422762470016199e-01; +1.850528950852798e-01   +3.011961551617763e-01   +6.272357478273298e-01   +1.232032066189157e-01   +2.393045702488284e-01   +7.582402719052505e-01   +2.566989142966011e-01   +9.464941969855967e-01];
L3E_L2E_iAMPA_netcon = [+7.938069617554083e-02   +1.544849801223789e-02   +3.686190110565349e-01   +4.965179304041357e-01   +1.802788860163825e-02   +9.558494477280135e-01   +3.592528000347404e-01   +1.404612527031441e-02   +2.040340402801082e-01   +6.205187943969430e-02   +2.433745445997268e-01   +9.991153059132407e-01; +9.522360795646478e-01   +9.769686854618311e-01   +1.160615851114167e-01   +6.564290246104976e-02   +8.062217404946359e-01   +3.871165251063532e-01   +2.242996327654692e-01   +1.214347627824662e-01   +3.562004533067688e-01   +7.419017794881770e-01   +5.335959894651566e-01   +3.449089731245052e-01; +6.622686645056437e-01   +7.246682855127783e-01   +5.141616223934113e-01   +8.619883913755642e-01   +7.917850033101543e-01   +6.645733648944187e-01   +7.247839903434711e-01   +6.699383203124715e-01   +8.875943074246833e-01   +9.906711938754027e-01   +3.334742335132030e-01   +8.224508327298906e-01; +1.685957911212062e-01   +8.715981269039824e-01   +6.777235095882637e-03   +9.966738984855439e-01   +4.236370028890298e-01   +5.852334195199053e-01   +7.728595955590774e-01   +5.083259313981809e-01   +8.089126568220700e-01   +7.676583496670916e-01   +6.745448903185709e-01   +1.095299300735251e-01; +1.967818371215860e-01   +8.147883404122991e-01   +8.684041528341704e-01   +1.228347632343114e-01   +6.301812469418069e-01   +5.962537353162058e-02   +3.419149027888921e-01   +7.082677265477164e-02   +3.197481785607639e-01   +8.815046457161945e-01   +8.751904923874819e-01   +7.735747194739241e-01; +9.950693661177114e-01   +3.053892098486480e-02   +9.040330320896667e-01   +9.969543937709546e-02   +5.681295228347153e-01   +7.607268520483812e-02   +5.763851770185543e-01   +5.356148101122213e-01   +6.008112505819193e-01   +3.618575981687174e-02   +9.828790877413500e-01   +1.500330257232512e-01; +9.256378902584607e-01   +9.686739861324624e-02   +1.134971521763106e-01   +1.487737649367603e-01   +8.958756676290277e-01   +2.275922386849871e-01   +6.427105351083700e-01   +6.781868775038158e-01   +6.984263485067880e-01   +7.940838112436149e-01   +1.456953360688692e-01   +7.313407611948398e-01; +9.819224192004025e-01   +8.537397294548356e-02   +4.406239998570007e-02   +1.289749140020285e-01   +7.487226178881836e-01   +4.206556041345348e-01   +3.661823195542070e-01   +5.882501063605107e-01   +1.779062389311210e-01   +7.067892629368989e-01   +8.775853783563429e-01   +1.090934172367876e-01];
L3I_L2I_iGABA_netcon = [+7.677181747410661e-01   +5.355106539699197e-01   +5.966167292217700e-01   +3.043187201311435e-01   +9.658804309208503e-01   +1.150280307020934e-01   +2.979535574927343e-01   +7.953033414073519e-01   +9.136690869615374e-01   +9.951532324946326e-01   +3.097388786550421e-01   +9.962808463654522e-01; +6.369741544565432e-01   +4.530930112020775e-01   +5.629275783663756e-01   +7.628082253726924e-01   +5.442854473578629e-01   +7.051585728011348e-02   +1.678445486771799e-01   +5.250647099139378e-02   +3.855359612992552e-01   +2.872848411871211e-01   +4.421247052298667e-01   +9.151115424109377e-01; +7.964623825201566e-01   +1.142684031800250e-01   +6.818065487258293e-02   +6.478045922288168e-01   +9.822931667406490e-01   +5.094391674534253e-02   +7.245726147033986e-01   +1.809530007882900e-01   +7.505742883452050e-01   +5.157533807993553e-01   +2.086919184145446e-01   +6.911372672228828e-01; +9.597705265262100e-01   +7.208541203460310e-01   +7.684371039259107e-01   +3.322975362264933e-01   +1.249004391299867e-01   +1.302799485776011e-01   +2.982856190975173e-01   +2.459749874249780e-01   +8.786637013157630e-01   +3.588035974358936e-01   +9.409690278252421e-01   +2.209780723966963e-01; +7.165568270649875e-01   +1.857396249915803e-01   +8.684533445190765e-01   +9.709307796962944e-01   +1.682720274818338e-01   +4.913795301406537e-01   +6.777974462917125e-01   +2.616954965512789e-01   +3.928657607397666e-01   +5.172319853541897e-01   +2.897460019619856e-01   +3.142829634458775e-01; +6.437094270988781e-01   +3.245418326417384e-01   +7.088729593598611e-01   +5.315883221788609e-01   +3.340915867702081e-01   +4.676878750522285e-01   +7.465676005868996e-01   +6.474718913521246e-01   +1.675821831423095e-01   +5.008979762665527e-01   +1.224920115581970e-01   +2.369214438746019e-01; +5.124629382523779e-01   +9.670440907433424e-01   +1.083251823551403e-01   +7.516634916946385e-01   +5.314416809480689e-01   +1.582437915472844e-01   +7.454639457359592e-01   +9.801277345209547e-02   +4.369773314436264e-01   +1.883292931179086e-01   +6.972275093405066e-02   +7.079811827102113e-01; +9.522428702491157e-01   +7.003856582239961e-01   +6.662276727894347e-01   +2.704392132408046e-01   +6.926461414967345e-01   +1.383206711185408e-01   +7.843574422292083e-01   +4.686991916415083e-01   +8.581839651162009e-01   +4.771225332757587e-01   +7.288542648542656e-01   +3.756061956206964e-01];
L2E_L3E_iAMPA_netcon = [+6.567502550601548e-01   +3.866386520030572e-01   +2.345704982018498e-01   +4.638129801471200e-01   +9.047318861101393e-01   +9.501752000674036e-01   +7.618459625912914e-01   +3.548185570695255e-01; +3.841632413168714e-01   +2.327976079412521e-02   +9.051509870976153e-01   +2.834799446306943e-01   +6.794426776764286e-01   +2.638915739988395e-02   +9.028523521410674e-01   +6.638680071759248e-01; +3.085319690127027e-01   +3.294777312810274e-01   +4.875782779656279e-01   +2.757106926163853e-01   +8.424349092770833e-01   +5.021446374938703e-01   +7.968495863920663e-01   +5.923365398938210e-01; +1.575242205070722e-01   +4.843721822398975e-01   +5.957414155312643e-01   +1.424426599403577e-01   +9.471505722436785e-02   +3.391593556984458e-01   +9.567624438063081e-01   +5.410176348591802e-02; +7.778079383004182e-01   +2.626017352500135e-01   +9.549398613262947e-01   +1.395197981581670e-01   +7.350856148612167e-01   +6.725532533695484e-01   +5.349212616582515e-01   +2.164833938149057e-01; +7.089952337034322e-01   +5.262270340337696e-01   +8.461100636953481e-02   +2.649349623021519e-01   +5.439277510428346e-01   +1.673087774536156e-01   +1.639176347177813e-01   +6.017410500467721e-01; +1.725674176114415e-01   +4.164156404754458e-01   +2.220094356447960e-01   +6.106656441127448e-01   +2.569732637291784e-01   +2.269589357619990e-01   +1.345240495971635e-01   +2.697538482404677e-01; +4.480524535829302e-01   -4.265404605137872e-03   +1.518664565753091e-01   +1.064868528825153e-01   +7.151266762611073e-01   +1.179381108430131e-01   +3.396799957340509e-02   +1.099215049603128e-01; +8.377511327633756e-01   +8.942866174294556e-01   +3.898811879769534e-01   +4.847375957665504e-01   +3.605596212054105e-01   +9.931710737688600e-01   +6.809191502504695e-01   +2.111445792257990e-01; +6.980886533109296e-01   +2.392331138695138e-01   +1.853915244193842e-01   +8.933695945515674e-01   +8.540641721885722e-01   +1.395551348089516e-01   +5.867986574776355e-01   +8.731326235931035e-01; +7.660096768048270e-01   +7.917745931728453e-01   +7.638905238702920e-01   +1.880475110037492e-01   +8.187430702645014e-01   +7.693252185938133e-01   +2.987091342135795e-01   +4.591011546403192e-01; +9.805325689557980e-01   +5.785027874592860e-01   +2.285285793810122e-01   +5.150374333750279e-02   +6.104804104382486e-01   +6.339768899328891e-01   +7.433444670490649e-02   +7.267418014000535e-01];
L2I_L3I_iGABA_netcon = [+5.889828100513593e-01   +1.475381412628869e-01   +3.444206304793362e-01   +3.699346241114052e-01   +5.998131984632837e-01   +5.067881498592356e-01   +7.728280291776395e-01   +2.648780824193118e-01; +8.456262504109723e-01   +9.901415152357407e-01   +4.647847667334903e-02   +5.374335260969966e-01   +4.791403088702738e-01   +2.366750580864028e-01   +1.787130102381146e-01   +5.853084127491905e-01; +6.052286762844129e-01   +4.807945251185554e-01   +9.420073690082789e-01   +9.742895977850869e-01   +3.765175389161248e-01   +2.718456560144427e-01   +4.543402430358996e-01   +6.788856564782005e-01; +7.448918231620559e-01   +3.532193656984541e-02   +8.668861076975984e-01   +9.967835361620996e-01   +9.783844682261048e-01   +4.054110403978172e-01   +3.056414753955766e-01   +4.154954499328805e-01; +8.490967078644434e-01   +2.696582312662574e-01   +1.339305985482510e-01   +4.145038357018546e-01   +1.385404329561185e-01   +2.601503811582368e-01   +3.875763428258605e-01   +5.109810302663726e-01; +1.464086278615706e-01   +6.761546141882833e-01   +5.904097142524963e-01   +4.507714674535007e-01   +2.708020459718932e-01   +8.542264250690451e-01   +8.036595823734614e-01   +8.149014036946937e-01; +7.417594974575416e-01   +1.467083763765070e-01   +6.203641583473297e-02   +2.547140994351046e-01   +2.256707012368904e-01   +4.789053928209928e-01   +7.778239436565578e-01   +5.441311677548719e-01; +1.711881542218171e-02   +7.737503561327213e-01   +9.468342483149477e-01   +6.006619127369688e-01   +7.912922631498406e-01   +3.411661344900587e-01   +6.458833454447634e-01   +5.890072922180810e-01; +2.278329367908777e-01   +2.674501290094642e-01   +4.967547115261211e-01   +7.788575159684277e-02   +8.176242525385053e-01   +6.391366100257552e-01   +2.419906432907689e-01   +5.349827595923017e-01; +5.375746040097359e-01   +8.805870337395095e-01   +2.643132968715886e-02   +9.122655979267011e-01   +7.920142854411443e-01   +4.156265220425021e-01   +6.088771947943116e-01   +5.411942841939369e-01; +7.207251351035819e-01   +3.686665473604290e-01   +5.736513704795673e-02   +4.731795423901239e-01   +1.127594145107479e-01   +5.435860233195909e-01   +4.195629944954088e-01   +1.515338358303133e-01; +4.335382481988810e-01   +1.039688971268143e-02   +3.007939700040522e-01   +5.077860970530664e-01   +6.329873136894815e-01   +3.394347852788150e-01   +2.941909328595927e-01   +7.033831196801910e-01];
L3I_L3E_iAMPA_netcon = [+6.415898897127963e-02   +7.731624685391705e-01   +5.550088587035749e-01   +5.730137620392354e-01   +9.204953342175907e-01   +8.346878772544787e-01   +8.490830044548224e-01   +8.628691553745286e-01   +5.336954264443708e-01   +9.883684795885186e-01   +4.814733937030578e-01   +3.505680006064966e-01; +9.224202982444738e-01   +8.385900448533381e-01   +8.440807863048644e-01   +9.355382198431627e-01   +5.925567217781135e-01   +3.926861142551313e-01   +6.282730697036185e-01   +8.562751633012685e-01   +5.670611002130330e-01   +7.010721427519730e-01   +7.394010538776271e-01   +4.001128361832806e-01; +1.805113534333944e-01   +5.931342776271904e-01   +9.696027899348681e-01   +7.788749732735611e-01   +5.756182055950202e-01   +7.031181612577099e-02   +4.445539975312622e-01   +9.493019475400526e-01   +9.805765669574867e-01   +8.442376488316542e-01   +5.948725238988015e-01   +9.881082698366241e-01; +5.430741612090029e-01   +7.671278459727966e-01   +4.663927996129447e-01   +5.965756925146535e-01   +6.584418546104794e-01   +3.738621897767647e-01   +2.345688222943308e-01   +6.936387916159844e-01   +9.678513527343855e-01   +7.379989538267056e-01   +2.629196162077792e-01   +2.972018611307181e-01; +3.971872760895335e-01   +6.585678676545215e-01   +7.767303117147397e-01   +5.818372717441202e-02   +4.361304145959544e-01   +8.491376704833073e-01   +5.151533102551705e-02   +3.629784935132983e-01   +5.600828090103119e-01   +9.958414065566670e-01   +6.072004544184031e-01   +2.244575094471414e-01; +8.818121363844317e-03   +5.891810668096411e-01   +2.201139554275976e-02   +5.433345589801821e-01   +9.349661362117926e-01   +2.448069259601973e-02   +7.126360793253145e-01   +3.734805684248212e-01   +5.322254606150558e-01   +5.074782689867773e-01   +2.320678722208387e-01   +3.305058586439496e-01; +1.024778519617232e-01   +2.688213251012886e-02   +6.778301349817334e-01   +8.650515894220121e-01   +1.027932221030220e-01   +4.214376214034536e-01   +8.482028917526290e-01   +8.423814029013699e-01   +4.791749656481964e-01   +1.893235429598775e-01   +1.948212384522553e-01   +1.647264199554708e-01; +8.560955901608315e-01   +6.924895372837424e-01   +8.351744326289096e-01   +3.385219088510238e-01   +4.095172203311110e-01   +2.545194273103527e-01   +4.044095064031445e-01   +3.843852976242860e-01   +9.008237547278480e-01   +9.595926646002076e-01   +2.176683245704305e-03   +3.839058183555276e-01; +3.375784694916019e-01   +3.273680200753426e-01   +6.844551944630297e-01   +1.784563199278335e-01   +8.925203259443435e-01   +7.457373359192722e-02   +2.868478657233597e-01   +7.702157450287700e-01   +4.825752502124868e-01   +4.517130494549128e-01   +6.460104466390318e-01   +5.260709450149584e-01; +1.497259191670021e-01   +7.628078458191177e-02   +8.954754895989789e-01   +8.810370968418232e-01   +7.388437186344911e-01   +9.205361093953097e-01   +2.630580143345133e-01   +7.727051116250702e-01   +4.869979161257417e-01   +6.061449503795079e-01   +3.997683973647186e-01   +5.953285799073654e-01; +8.074160712726508e-01   +7.438832623054823e-01   +9.551989227491102e-02   +8.413324364285966e-01   +9.590302170818797e-01   +2.680557072397971e-01   +5.051702732044400e-01   +4.332469225654724e-01   +3.139628477443669e-01   +6.444729978854297e-01   +2.723235091815803e-01   +1.699561230256589e-01; +6.557373833645396e-01   +9.650043631166434e-01   +7.088009971625139e-02   +8.340391020322185e-01   +9.699789510798260e-01   +1.008493916742457e-01   +1.170561285796584e-01   +4.875405506903972e-01   +8.595138102555955e-01   +7.660555418466990e-01   +4.043352275815500e-03   +7.279840809950416e-02];
L3E_L3I_iGABA_netcon = [+4.376815219191214e-01   +7.071207486033020e-02   +5.752653984423991e-03   +4.953216005474523e-01   +5.438990057638686e-01   +2.522798989213127e-01   +7.180749890196613e-01   +7.613756927575032e-01   +3.787715764148539e-01   +4.492999683269805e-01   +2.005941329708630e-01   +6.490881972541162e-01; +5.776809648691233e-02   +8.082529057262992e-01   +1.323580485561548e-01   +1.931574301657512e-01   +2.108942066945662e-01   +3.344214231072221e-01   +2.223646149226078e-01   +8.888198402203393e-01   +6.105788705717238e-01   +3.945972334282893e-01   +8.277271921206687e-01   +8.985286022867833e-01; +6.257064438137100e-01   +9.095780964165366e-01   +3.080401330694245e-01   +6.421997713850314e-01   +2.700826312688729e-01   +5.916986193652363e-01   +4.986172529861456e-01   +7.307723424941243e-01   +1.683165760982402e-01   +6.680416117130136e-01   +4.468293370157546e-01   +8.388283199352878e-01; +7.986481433164213e-01   +4.258983078886999e-01   +2.384155947427155e-01   +2.554717874248317e-01   +1.322837684828938e-01   +4.817481078119394e-01   +4.755482405583060e-01   +6.980039189880378e-01   +1.056794561626064e-01   +3.332095875413721e-02   +4.211717322649431e-02   +1.700375166789963e-01; +4.009970779536198e-01   +1.839291436559568e-01   +6.495076531164092e-01   +9.482101389028720e-01   +1.597849765277213e-02   +8.975528953330938e-01   +4.310553708772387e-01   +6.464349824141483e-01   +6.263495514893954e-01   +7.871115403977532e-01   +7.685474574729549e-01   +1.610507722800407e-01; +8.839221091912349e-01   +1.833877754348477e-01   +8.080208159036467e-01   +2.878391356326835e-01   +1.494054099266906e-02   +2.949079094713410e-01   +5.564884397433068e-01   +6.201915988273228e-01   +9.523591251711108e-01   +3.786404705571217e-01   +9.786570758466009e-02   +1.356110890352354e-01; +7.219523486174624e-01   +6.723852404484956e-01   +7.402990674294179e-01   +1.495189855209283e-01   +9.792746195742897e-01   +7.872631462739689e-02   +2.068508511119049e-01   +7.859021964287602e-02   +6.650186518813658e-01   +6.515506990246236e-01   +6.523155556568740e-01   +1.588098025490886e-01; +1.972037273306314e-01   +5.246230320545761e-01   +1.226672119956001e-01   +8.705762798484521e-01   +6.476364378638240e-01   +3.922768420147318e-01   +2.772267300556488e-01   +5.486919139069795e-01   +4.730247725426520e-01   +4.967326926071974e-01   +2.709777682374723e-01   +3.946701014999581e-01; +3.748755890373575e-01   +7.761922595199706e-01   +1.725881819971572e-01   +8.862586212892377e-01   +8.158820775044668e-01   +1.991231264875555e-01   +8.126236115345358e-01   +8.838662350289063e-01   +3.406178895319643e-01   +2.130769000279430e-01   +4.367659164986608e-01   +6.670500189681233e-01; +2.121238407472713e-01   +2.994238061770166e-01   +2.738841346451703e-01   +6.681510534720936e-01   +2.758766726004658e-01   +7.224134410845332e-01   +9.580910546237249e-02   +9.872351242959585e-01   +5.909776833321888e-01   +2.165827734137176e-01   +8.485090806946506e-01   +2.231460339357664e-01; +2.596213514419056e-01   +4.744663566467272e-01   +8.150084489742699e-01   +9.973488991471960e-01   +1.527364157323608e-02   +4.220174211119378e-01   +3.296371580178285e-02   +7.081273403070863e-02   +5.460331687160175e-01   +4.517046411315199e-01   +9.023379755218852e-01   +6.438411204320593e-01; +9.925674034945408e-01   +7.068798127415173e-01   +5.917491440485430e-01   +2.678850446165297e-01   +1.007749201597618e-01   +2.683123501953859e-01   +6.493044195526429e-02   +3.312497638288914e-02   +3.928135299264560e-02   +6.296003878086461e-01   +2.853370552536628e-01   +6.118171697398246e-01];
L2E_Input1_iAMPA_netcon = [+9.923618366992827e-01   +9.893491879731163e-01   +1.000000000000000e+00   +9.880304137111321e-01   +9.849759328280131e-01   +9.995301000138800e-01   +9.837582994532145e-01   +9.970146818433137e-01];
L2I_Input2_iAMPA_netcon = [+9.922431957798346e-01   +9.987575245633972e-01   +9.851413375293473e-01   +9.947864851432131e-01   +9.892410464385184e-01   +9.899939378632696e-01   +9.958015216892483e-01   +9.966983528781886e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
