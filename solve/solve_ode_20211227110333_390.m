function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.405041453496772e-01   +2.566978598956309e-01   -9.278608701516963e-02   -3.764528631935694e-02   +1.982288975654532e-02   +3.283007393125279e-01   -8.794674065823668e-03   -1.515017240196588e-01   +2.005813398687926e-01   +1.786714551213962e-01   +2.120124776268902e-01   +2.548051568434377e-01   +1.509945343957224e-02   +3.146283711019942e-01   -1.174413182178292e-01   +5.309621966108063e-02; +1.725619488246384e-02   +3.622953488251410e-01   +1.454857220132798e-01   +2.080731908937619e-01   +5.679661434659672e-02   +1.391312586068155e-02   -3.268866109370412e-01   -1.016764026075472e-01   +1.072405086373693e-01   -1.341667778286157e-01   -8.145273671566423e-02   -4.327581240503813e-01   -1.502810765258942e-01   +9.000374834253044e-02   +2.538808301189379e-01   -1.762019803483944e-01; +2.325752961723798e-01   +4.097179109278091e-01   +1.290668979659150e-02   +4.503216943300301e-02   +1.062077665338921e-01   +2.027000090539313e-01   +9.002013988702406e-02   -1.481738937103544e-03   +1.997395138452223e-01   -4.037342907307623e-01   -3.523699081170476e-02   -6.903242911387683e-02   -2.423246305015080e-01   -1.595699977955405e-01   -5.549664819904164e-02   +2.058308388964622e-01; -6.346141099013575e-03   -1.190625306177485e-01   -7.272382396402866e-02   -8.739552601778836e-02   +9.741934436842650e-02   +1.489026367117967e-01   +4.529003871558532e-02   +2.876562378780900e-02   -1.124295137005855e-01   +1.793931590109219e-01   +1.821443841160993e-01   +2.027540928699884e-01   -1.293843590823573e-01   -1.088848908190415e-01   +1.934364671581310e-02   +2.446882935439625e-01; -2.799147810586864e-02   -6.203479239937076e-02   -1.452648790995958e-01   +3.242459710186307e-02   +2.995173106372933e-01   -4.518650717764816e-02   -1.832293100272341e-01   +1.918909490533812e-01   +2.948166541560294e-01   +2.207502541225509e-01   -2.162551500377835e-01   +6.296571730433750e-01   -1.349744612002550e-01   +3.375341053058544e-01   +1.522145470558963e-01   +5.558327326503272e-01; +2.912517648565573e-01   +3.707965844093638e-01   -1.424097467618332e-01   -2.048011449968782e-01   +1.459583929854160e-01   -5.001889038458213e-01   -3.720190074344513e-01   +7.487078704014065e-02   -1.296633149210863e-01   +1.023587766477365e-01   +6.289691887854949e-02   -1.631709825466876e-01   -5.437618621461509e-03   +1.410284750273647e-01   -4.166481286077586e-01   +1.098130296389601e-01; +2.652356905239968e-01   -1.942478820504259e-02   -4.832461569069813e-02   -2.413583299519745e-01   -3.052440914932376e-01   -1.881339752827456e-01   -2.973995922686721e-01   -1.190294086285708e-01   -8.758269817891920e-03   +2.409102517551903e-02   -1.543329368931828e-01   +1.559719702390737e-01   +3.096483160643592e-01   +7.828262290552229e-02   +5.691847714154516e-02   +6.877701801166225e-02; -1.812337717794470e-02   +4.982879328241457e-03   +1.415330094088351e-01   -7.971187361049210e-02   +3.848678875477154e-02   -1.469644319501847e-01   -3.610876655593274e-02   -9.478156555877561e-02   -1.519805022768031e-01   +1.653060511047367e-01   +6.362824457504486e-01   +2.544992905175212e-01   +1.198584022188730e-01   +1.734695935936980e-01   -1.164577670457607e-01   -3.614935290226329e-01; +1.073026717126375e-01   -1.890225356588300e-01   -7.897540972286726e-02   -1.263772219605296e-01   +5.274006534483927e-03   +8.712969726613155e-02   +1.913316824070768e-01   -5.630713830946883e-02   +1.167835013611573e-01   -8.784604159234854e-02   +3.752034283929356e-01   -3.230539695666255e-01   +1.525682011397970e-01   +4.335168414464907e-03   +1.332686039082575e-01   -1.509997882802742e-01; -2.992284771092557e-01   -2.829571603567599e-01   -1.258968228864832e-01   -1.022129144637203e-01   -1.185972731579213e-01   +1.330144421559154e-01   +3.731097696626944e-01   -3.237318836748627e-01   -4.126006639311978e-01   +2.157810564241185e-01   -1.149236693254775e-01   +2.853755883692024e-01   -2.179188698937205e-01   +1.180684530220626e-01   -3.647091760842226e-01   +1.916733873397961e-01; -2.712255329163462e-01   -5.058413843673835e-02   +1.070016752178168e-01   -2.287000624805249e-01   +1.214748061309128e-01   -1.807129180502790e-01   +8.268170339599573e-02   +1.699585422648288e-01   +1.486047482151069e-01   -3.240671655862952e-01   -3.452953836371502e-02   +1.612797379524193e-01   +1.702739889610948e-01   +1.687353703807624e-02   +3.179708245534686e-01   +6.554088331967967e-02; -3.682987481110196e-02   -1.169298537963269e-01   -8.994215862973529e-02   -9.320726596022416e-02   -2.302845883867706e-01   +4.552425972806741e-02   -1.882333904715195e-02   +1.071483012681511e-01   +8.418919047777529e-03   -2.421364861224088e-01   +2.184539355139155e-01   +6.618923827354417e-02   +2.938955205122318e-01   +5.256450411940437e-02   -3.775979231578064e-01   -2.724485923139120e-01; -1.917373010346454e-02   -4.464084827448349e-01   +2.273546737806198e-01   -1.622875576034732e-01   -2.576743307062792e-01   +7.528141652473624e-02   +2.528061521838664e-01   -2.967053485635432e-01   -2.202771772416818e-02   -2.114483101456621e-01   -2.482685544464897e-02   +2.822758357041318e-01   -1.610672506345371e-01   +5.265844464579619e-02   -3.336596507823971e-02   -8.881243313017918e-02; +1.172113871772584e-01   -1.041227801135756e-01   +2.004218526851467e-01   +3.907102538703543e-01   +2.669054258970558e-02   -1.307324952848023e-02   -4.422966199439055e-01   +2.832076880567861e-02   -3.141164616434078e-01   +6.811523416852176e-02   -1.668656729568920e-01   +2.369137773930117e-01   +4.153179136939794e-02   -3.393135445657219e-01   +5.859058722356807e-03   -1.142238462723840e-02; +3.033231953277460e-01   -1.030846411650548e-01   -2.756343283393061e-01   +1.692312140344342e-01   -3.131904181900960e-02   -1.304103139727516e-01   +3.250767861216963e-01   -2.059431163612727e-01   +2.448750431517380e-01   -8.585530267518078e-02   +5.697162131870570e-02   +2.218943064880077e-01   +1.634150755665262e-01   -3.258477452678914e-02   +6.654440601492842e-02   -1.272440435401910e-01; +4.063812585796360e-01   +2.628076928295068e-01   +2.811443609415955e-01   -1.458232763186671e-01   +1.599102470107131e-01   -6.735790887129858e-02   -1.426811076315078e-01   -1.572411126453686e-01   -1.494854113030376e-01   +9.786771950078188e-02   +3.434380419738008e-01   +1.011874299120485e-01   +1.209954994791753e-01   -2.577002765817529e-02   +3.935184838181407e-01   -1.943032268915724e-01];
L1E_L1I_iGABA_netcon = [-2.531140259913886e-02   -1.212381112895322e-01   -3.088836968528341e-01   +1.702393668326189e-01   +4.394238089889629e-01   +2.256113413314972e-01   +1.625453102246978e-01   -2.168363897741082e-01   -1.266039937633896e-01   +3.709545413412252e-01   -1.401947251477706e-01   -1.454995963315937e-01   -2.747392471414787e-01   -1.745577460741473e-01   -4.222883451716936e-01   -1.732395471794222e-01; -2.755714850373192e-02   +1.546927238646650e-01   +4.093098352925370e-02   +1.875126304727295e-01   +7.174712602763551e-02   -3.097570153823124e-01   -1.417973885740565e-01   +5.153900470055747e-02   +1.453497518201326e-01   -2.631957128499264e-01   -2.045814540004420e-01   +3.269284741970266e-01   +1.101619705325091e-01   +2.017129512595568e-01   -2.945595794303266e-01   -1.684582583273788e-01; -2.530124635400431e-01   -3.660796517674299e-02   -1.068057155384136e-01   +2.328000480065553e-03   +1.669965693792888e-01   +1.010273670288529e-01   -2.687575423906631e-02   +1.976436479824577e-01   -1.334067995123583e-02   -3.047641262907964e-01   +9.560633328741278e-02   -9.023890913983661e-02   +1.328389780181760e-02   -2.258001332802259e-01   +1.685191510247170e-01   +6.144241006248094e-03; +5.200193133080346e-02   -3.150953131975297e-01   +1.724654914043142e-01   -2.586836678389163e-01   -3.644869332261752e-01   -1.182963417708386e-01   +1.111116527181952e-01   -1.517773360853605e-01   +3.350486483505787e-02   -3.808739572875402e-01   +2.416693872981822e-02   +3.480123269622822e-01   -2.906905302542468e-01   -7.026999496101308e-02   -9.806188908387538e-02   -3.875146463141675e-01; -1.756584453820113e-01   +1.713457526191896e-01   +9.832119982050164e-02   +1.877251247412626e-01   -2.891555163074433e-03   +1.277154848659637e-01   +2.370179036324157e-01   -4.126675513507705e-03   +4.742957679038830e-02   +1.945180757301117e-01   -4.220901325741261e-02   -9.820027510145432e-02   -1.116767135269781e-01   -7.621599713625792e-02   -1.122116148518550e-01   -1.513260125825579e-01; +2.331907161555620e-01   +1.862963524235746e-01   +1.096440861855004e-01   -1.060387362556912e-01   +4.360783780291352e-01   +8.700199533443631e-02   -4.155952859674278e-02   +1.283090772534391e-02   -1.673440659233488e-01   +2.226862918811779e-01   +5.850946962071661e-02   -2.639734851546155e-01   +2.538020399594905e-01   -1.595964469711831e-01   -5.323839362580729e-02   -2.576959842195978e-01; -3.123347735090178e-01   +3.843117867208679e-01   +2.613328019671285e-01   -2.607959672157142e-01   -1.161962422097705e-01   -1.737728625620218e-01   -6.532430536697043e-02   +1.301920865954305e-01   +3.863182278369549e-01   -1.142927077524306e-01   -2.991116673927721e-02   -2.338409551063306e-01   +1.162260880618899e-01   -3.507045117039443e-01   -1.261748111319524e-02   +3.691954723265730e-01; +5.646104783902187e-02   -1.298598453259549e-02   -7.036745818372567e-02   +3.370035138692851e-01   +2.517321980590411e-01   -1.802378380949549e-01   +9.212836617902842e-04   +4.541833721767169e-01   +2.323474283883479e-01   +1.160502419705408e-01   -2.978702897005530e-01   -9.085319767648781e-02   -3.768033052297165e-01   -8.655394629846908e-03   +2.577311537698314e-01   +1.836655344811242e-01; +8.874887470094661e-02   +2.616382399911465e-02   +1.422886959589572e-01   +1.817432593820864e-02   -2.603870304790334e-01   +5.123302776366205e-01   -1.921574924744709e-01   +6.359633555844250e-02   +6.845473415207315e-02   +2.084185111255267e-01   -1.904495353799971e-01   -1.396377098375947e-01   +1.324009877637804e-02   -1.090819166520789e-01   +8.075399772015147e-02   +1.710711627679214e-01; +4.541167613688065e-02   -4.454534082483189e-02   -7.286979450857323e-04   -2.522322959986887e-01   +3.024350641472269e-01   +1.212343244867674e-01   +9.589985588781495e-02   -1.289663580151933e-01   -4.289191089091396e-01   -3.071394213482398e-01   -3.172627651943311e-01   +4.698252582894904e-01   +2.209097013624078e-01   +1.647185136378319e-01   +1.700972271973853e-01   +4.190167464608587e-01; +1.410914365300970e-01   -2.744342629450156e-01   -2.259697840280315e-01   +4.389309907657456e-01   +7.839070520645497e-02   +8.472615317124688e-02   +2.012172067686491e-01   -6.412001276477498e-02   -2.139161849903216e-01   -2.236706784464191e-01   -1.560054725346126e-01   -7.401922600093486e-02   +4.085391971692825e-01   +1.523047077216268e-02   -1.053282254404712e-03   +4.259484126949193e-02; -1.686467548847570e-01   +1.894147191664644e-01   +1.156989957666435e-02   -2.173453325833723e-01   +3.118378849089798e-02   -2.440937807377933e-01   -7.617809037132012e-02   +1.228630096799577e-01   +2.087316764941529e-01   +8.711876252340303e-02   +2.144505912170936e-01   +3.081614761414158e-01   -1.135211278822086e-01   -1.860859263471466e-01   -8.508030866880748e-02   +1.333167197463028e-01; -9.930908318864842e-02   -1.642040380852646e-01   +2.611822932175053e-01   -1.310041271672644e-01   -1.811315174513239e-02   +8.422473853756496e-03   +1.497665309561561e-01   +9.209414610974989e-02   -4.052199106423593e-02   -5.762425133404619e-03   -3.394840992944931e-01   +3.328830605799076e-01   -2.559458579948565e-01   -2.190117726048835e-01   +1.645072880576932e-01   -1.227180934910628e-01; -2.109482273429927e-01   +1.087089127916852e-02   +1.563016438822653e-01   -2.755894200722317e-01   +9.467868890355566e-02   -1.568725500893995e-01   +1.058699807565497e-01   -2.343422709767771e-01   +1.432877290925982e-01   +1.731909886863868e-01   +1.281704316943305e-02   -2.287591886246752e-01   +1.812377495558230e-01   -7.174818805285012e-02   +1.616572069468095e-01   -2.677680420941602e-01; +2.986668755392539e-01   -1.964270929762288e-01   -1.716361054580366e-01   -3.854811815617884e-02   -1.081270609627861e-01   -2.361298313435528e-01   +1.747702202364800e-01   -1.692799092730899e-01   +5.847106485916612e-02   -3.288192666180110e-01   +8.471877945680972e-02   -3.731916698320174e-01   +6.409473475587661e-02   +6.343909668393699e-01   -2.066127082375450e-01   +2.499629855523145e-01; -1.607357780674806e-01   -1.819335654229072e-01   -1.014380830649170e-03   +3.094423247956221e-01   +7.557915016756067e-03   -1.765909136643451e-01   +9.374410437623674e-02   -1.587097246899100e-01   -2.017214606451065e-01   +7.764917922209599e-02   -1.543407183467861e-01   +2.394653211567875e-01   +3.681227058427345e-01   -3.588525995646022e-02   -3.360262038880916e-01   -5.788853030215192e-02];
L2I_L1I_iGABA_netcon = [+6.923494098368498e-02   +1.820847291255354e-01   +8.597535034241378e-02   -5.553017144616781e-01   -7.056071474849557e-02   -4.241337264144726e-02   -1.558590369255184e-01   -2.485835568381956e-01; -1.367193594743263e-01   +2.365194362623789e-01   +8.471034116589878e-02   +1.070647853836399e-01   -4.469275566474256e-01   +1.260690196473281e-01   +7.047462586455934e-02   +1.937859850790469e-01; -1.519698009975676e-01   -4.167718247377344e-01   -1.866946528759240e-02   -3.370816557885961e-01   +3.801828243129565e-01   -1.184632623147305e-01   -3.593584134206779e-01   +7.001726774396649e-02; -3.532481305137952e-02   -5.212945522430323e-02   -4.821121171248320e-03   +1.734450644120193e-01   -8.702403728831812e-02   -4.750929807695939e-04   +3.754809288693965e-01   -3.882199776128419e-02; -5.973985760887959e-02   -3.654493177031534e-01   +1.274343106227536e-02   +1.735390289949344e-02   +5.793838332043945e-02   +1.709325731692243e-01   -2.059269439825945e-01   -2.052165656004884e-01; +5.790598136486608e-02   -2.338972808628267e-01   -5.030225312601400e-01   -4.593880252987431e-01   -1.786240661137095e-01   -1.686630210048579e-01   +2.611004294546655e-01   -1.065260314856600e-01; +2.494774977912079e-01   +3.353028071508870e-01   -2.623724110311858e-01   +3.463021562676983e-01   +6.915284916232753e-02   +1.271748364094609e-01   -1.929154741802409e-01   -9.296568641154845e-02; +1.647355117301315e-01   +3.237127107359727e-01   -5.312641452563537e-02   +6.271745826634899e-02   -1.709793661293137e-01   +2.689879273244042e-02   +3.918828905442379e-02   +7.547791840104401e-03; -2.752704371835446e-03   +2.462895721508990e-01   +2.186813456607125e-01   -4.894927547029505e-01   -1.806227260083688e-01   -1.146780281200346e-01   -4.285877381823375e-02   -4.858810203634167e-02; +2.438950540544898e-01   -1.477375873332657e-01   +3.090802618602616e-02   +9.563983658144368e-02   +9.577026267239844e-02   -2.747174791196132e-01   -2.073766222340922e-01   -1.662008581854379e-01; +1.198066453212268e-01   +2.172041652886257e-01   -1.499751679470399e-01   +2.532764678219785e-01   +1.505136438483978e-01   -4.723326193841548e-01   -5.566169356581236e-02   -1.981024833607727e-01; -2.587970348036780e-01   -3.777524312775135e-01   +3.704129064796703e-02   -6.398126480519567e-02   -8.311075517654781e-02   +1.072949542287095e-01   -2.370197268601052e-02   +3.785912801765762e-01; +3.477113237172148e-01   -1.642812720898045e-01   -3.444057692258445e-02   -6.676641592635263e-02   +3.223203327479141e-01   +1.409660921990049e-01   -1.575469112208464e-01   -2.493195350692270e-01; +2.885158757057683e-01   +2.689261396785714e-01   +2.416955811868401e-02   -1.138144959982897e-01   -1.012012675093510e-01   -4.924883831128207e-01   -2.958382634302231e-02   -6.682150142373049e-02; +3.328648220624258e-01   -3.874254440501516e-01   -1.927671754373677e-01   +9.607942321459334e-02   -3.260598108701597e-01   +3.745730276214459e-02   +8.310586703664584e-02   +4.448832183270300e-01; +1.269881959637321e-01   +3.640609265652850e-03   +1.919369897079038e-01   +2.120079722710740e-01   -1.305088031740995e-01   +9.013455567775419e-02   +3.933122329024733e-01   -4.067237512706149e-01];
L1I_L2I_iGABA_netcon = [+9.312341516635633e-02   +6.860259425711279e-03   +4.236649451837368e-01   +1.025576031051313e-01   +3.263703152182493e-02   +2.480655114912152e-01   +2.032328570005986e-01   +1.202852804829908e-01   -2.209919086913961e-01   -7.620499551413666e-02   -3.232978446361462e-01   +2.830699843350444e-01   +1.992974387569950e-01   -3.135518527194942e-02   -2.912721929748009e-01   -1.475566099720929e-01; -3.947645669249308e-01   +1.533596892545779e-01   +2.404452334326091e-01   +4.671863759808818e-01   +1.685202081898477e-01   +1.164693389671822e-01   +1.737411529955425e-01   -3.708537731413357e-02   -4.378046340302616e-03   -7.151564812339481e-02   +6.864390252195739e-02   -3.010066060614404e-02   -4.422524556349598e-02   -3.252690661689117e-01   -2.144677624221354e-01   +3.975795035534885e-03; -1.771448659930325e-01   -1.325973622723627e-01   -6.632967807773331e-02   -8.817249720212511e-02   -1.911043354893377e-01   -5.736283285759752e-01   -5.830453974478669e-02   +1.575347058071946e-01   +8.545809325153303e-02   -3.814589491782230e-01   -8.531633648153678e-02   -5.772172673589482e-02   +1.394458664425912e-01   -3.019130128573474e-01   +3.772226424964248e-02   -3.464318146257114e-02; -2.096548971844570e-02   -7.250966440090761e-02   +1.175358507912459e-01   -1.068615688098086e-01   -7.576725262124333e-02   -2.041921280191822e-01   +1.076208955103777e-01   +2.011891566621418e-01   +1.468401855655512e-01   -2.228248068597325e-01   -1.538981847010640e-01   +2.200809813854462e-01   +1.892288961796441e-01   -3.793229035256604e-01   +1.124076825075671e-01   +9.222417588455931e-02; +2.719114811122647e-01   -1.418597586793953e-01   -9.687382829798760e-02   +2.171579092826989e-01   -4.663620699702589e-01   +2.683086373012261e-03   -2.346263505977438e-02   +1.885586587140295e-01   -2.650598762980325e-02   -1.966085819372572e-01   +2.690862800901211e-01   -4.487212009525415e-02   +2.108672665203092e-01   +4.502958643457693e-01   +7.411113948834713e-02   +3.814899934156047e-01; +3.329759937605954e-01   +4.957961059244353e-02   +9.159419755518659e-02   -4.041094387051682e-01   +5.176746519405017e-02   +1.699701267111735e-01   +1.901613864495996e-02   +2.377151863918321e-01   +3.247201742296950e-01   -3.723042627170715e-02   +1.820359414039029e-01   +1.654235134869149e-01   +9.567833003404633e-02   +1.830859421327039e-01   +2.539323764842627e-02   -3.310831894733633e-01; +3.591215169732374e-01   +3.055619759785530e-01   +1.093643163553025e-01   +1.446795212850374e-01   +2.431884623460512e-02   -2.278742157403250e-01   -2.494538458099068e-01   +1.140907038822166e-01   +1.633757133480809e-01   +1.040981697569690e-01   +7.269558300632963e-02   -2.357785812023082e-01   -3.613758638667618e-01   -2.000696868219354e-01   -6.702838271096581e-02   -4.489088297393594e-01; +1.122964426192306e-01   +1.607759525230069e-01   +1.877319287968207e-01   -2.634568563801881e-01   +3.121008075027389e-01   -9.994295548462383e-02   +2.035893944531937e-01   +3.263680818531087e-01   +2.201555517727299e-01   +3.285308990879090e-02   +1.410748094734694e-01   +6.538422740059349e-02   +1.331020421353181e-01   +4.587052283626474e-01   +1.553307846127566e-01   +3.075622450559222e-01];
L2E_L1E_iAMPA_netcon = [+1.267352684306668e-01   +2.175272551088082e-01   -3.555911539513592e-01   -2.191625034885544e-01   -4.828059251512791e-02   +3.241459039550681e-02   +2.591459727149678e-01   -9.822052068941323e-03; -2.010055058940909e-01   +1.593296118139431e-01   -5.304151148051487e-01   +7.556137397513955e-02   -9.293719943700487e-02   -4.580211213561562e-02   +1.531806770533796e-01   +9.054220927630295e-02; -2.023818219426111e-01   -1.510666207450022e-01   -1.421723756205046e-01   -7.496000476167473e-02   +2.848955090984776e-01   -2.123478372560443e-01   +6.113645903563378e-02   -2.265042743540823e-01; -1.104696166019634e-01   +2.308007014882109e-01   +4.923459999004690e-02   -2.139811479520176e-01   -8.989247529821856e-02   -3.083643774816239e-01   -2.270111546940746e-01   -5.543035309777154e-02; +2.101240545000192e-01   +2.474287223108915e-01   -1.568165966672086e-01   -8.904819723957053e-02   -5.853145973571594e-02   -1.794708606776934e-01   -4.534509860552056e-02   +2.274343686778864e-02; -2.553530857638949e-01   -1.101708496384673e-02   +1.604887357031168e-04   +4.762691378944822e-02   +1.086184308171958e-01   +2.729564318697593e-01   +1.750390873065278e-01   -4.073077381918235e-01; +9.765235572792141e-02   +1.479985768682849e-01   -1.057013284228507e-01   +9.370671184171959e-02   +1.211762093821747e-01   +2.021028795846887e-01   +1.813179119878706e-02   +4.103214483091672e-02; +1.655195381443046e-01   +1.841257625720371e-01   -1.075236391874503e-01   +9.553792324676449e-02   -2.407514072698166e-01   -2.284967237879447e-01   -1.466901989437115e-01   +1.897790646255644e-01; +1.575151089189992e-01   +3.048776119137344e-01   +3.931688862819607e-02   +2.428595022945196e-01   +3.883644809206521e-01   -2.003827505718790e-01   -4.862638427217320e-01   +7.902742497655367e-02; -1.514319163471688e-01   -3.420912384962663e-01   -1.609631751196437e-01   -6.310081780266649e-02   +4.821030420813632e-02   -2.636090003803578e-01   +1.351181266523835e-01   -1.037951364690707e-01; -7.303569733092712e-02   +6.104797295005630e-01   +3.059514435824279e-02   +3.797181422811227e-03   -6.063169688670889e-02   -2.362892707926207e-01   -1.158626309623577e-01   -1.448004640576773e-01; +9.825102587630372e-02   -1.782752740691693e-01   -1.318426633322217e-02   +2.336098014916383e-01   -4.783287365968705e-02   -2.696768624629260e-02   +1.926245028914653e-02   -1.461422706412896e-01; -4.328644349976210e-01   +2.295114676566192e-01   +1.039204766969432e-01   +3.313250116333349e-03   -2.093009838388855e-01   -4.825018695822643e-03   +2.249946732091930e-01   -4.460102857342033e-02; -3.602112855440469e-01   -7.326922259352894e-02   +4.163773305273884e-01   +4.918295549047877e-01   +1.113323928498246e-01   -2.334314782742076e-01   -1.150323726258644e-01   -1.354021602923467e-01; -1.079555060575999e-01   +8.503809116053396e-02   -3.734911167614757e-01   +7.347282027609763e-02   -7.105412656592258e-04   +1.362575451797047e-01   +1.388557801636795e-01   +2.338017598305349e-01; +3.464413539498214e-01   -4.194848511241367e-02   -1.964538040713766e-01   +8.435779752423492e-02   +4.525438015410720e-01   -2.185390730207604e-01   +1.885123356056674e-01   -5.447481581653418e-02];
L1E_L2E_iAMPA_netcon = [-3.002092717669623e-03   -1.434551469942610e-01   +3.664210871764206e-01   +5.776951691074919e-02   +1.945427723076296e-01   -1.300927283092941e-01   +3.781462254039994e-01   -3.969558433905424e-01   +3.536577466625354e-01   -3.103271087839822e-01   -2.440154694190241e-01   +3.007962307069528e-02   +2.399956935367369e-01   -5.443190596543371e-02   +5.814918745340462e-02   +1.038773516830342e-01; -3.949587119487458e-01   -1.805005898236413e-01   +8.263886767552422e-02   -3.866253963665714e-01   -1.885524562689674e-01   -3.498387527377600e-01   +5.866160487151367e-02   -1.312515185737694e-01   -1.848396377368733e-01   -1.454926046906987e-01   -5.199461088745845e-02   +7.637101185376194e-03   -4.400290507554622e-01   +6.175065306761748e-02   +3.504517782039742e-01   -2.989277368269067e-01; +1.386043622989430e-02   +1.862939924026297e-02   +4.641499246943268e-01   +9.114978221853920e-02   +1.740579896726525e-01   -6.329866014382529e-02   +2.039656489060663e-01   -9.563600895608243e-02   +2.651706448751699e-01   +5.784901824930844e-02   -4.938051859452931e-02   +3.303507250920574e-01   -1.586994192960156e-01   +3.541083008257334e-01   +1.780933846630011e-01   +7.119022050977974e-03; +2.756603308966226e-01   +3.160720245886469e-01   -1.874122018433817e-01   +2.123128289150388e-01   +1.983190040717774e-01   -1.989567331595842e-01   +1.047196312327582e-01   -2.421380992278271e-02   +8.139986449826087e-02   +6.587199346294856e-02   -8.396011080352955e-02   -2.805665364685673e-02   +2.548044820990833e-01   -1.164790211086620e-01   -1.635998852701204e-01   -9.887656385149102e-02; +1.265168052311191e-01   -1.944286500488925e-01   -2.115933704046851e-01   +2.093283042889559e-01   +3.154269917400127e-01   -5.004219756248374e-03   +5.103921633933056e-03   +1.905928199727351e-01   +1.082403900722646e-01   -1.979020949808594e-01   +6.908015202825277e-02   -1.046843037705264e-01   +4.567184747845758e-01   +1.088667893425233e-01   +1.203881727258269e-02   +2.949823966151822e-03; +2.424552932366511e-01   -2.572193582650838e-01   +6.078778184465782e-02   +9.495030299023072e-02   +4.120179978810016e-01   -4.488333969286712e-01   -1.199116566618386e-01   +1.129517516646270e-01   -9.098778950907133e-04   -4.323542400705356e-02   +2.401401827604596e-02   -5.325196585616754e-02   -1.021617876732311e-01   +1.346261207395137e-01   +7.088236165908550e-02   -4.056762603113533e-02; -3.798332630577303e-02   +3.169193338877775e-01   +6.713973140920390e-02   -1.270096704607102e-01   +1.886201534938833e-02   -1.831150819903646e-01   -3.909230159608137e-02   -2.125782550247305e-01   -4.429641600640061e-02   -4.509657273730691e-02   +3.456438620030569e-02   -1.885904381304427e-01   -6.458579385539405e-02   -6.184361696133836e-02   -4.134290677001555e-02   -6.159525334363290e-02; -8.230284241361747e-02   -3.233267942431302e-01   +4.842256085337160e-02   +5.124555110826404e-02   +1.517892899854038e-01   +4.284836969460556e-01   +1.151566091563993e-01   +9.580218730050169e-02   +3.016460481954088e-02   -1.835540279597023e-01   +1.418607233056548e-01   -1.215016167221052e-01   +2.790881510137095e-01   +2.488830024017924e-03   +3.151952263459897e-01   -2.140620142898890e-01];
L2I_L2E_iAMPA_netcon = [+7.218361371009427e-02   +5.766929836771884e-01   +1.631633850227451e-01   +6.921889782847163e-03   +6.800894255608447e-02   +2.956117604048522e-01   +1.436840391369130e-01   -8.235116593045563e-02; +1.147600291806770e-01   -2.037138270702744e-01   -3.643859398120142e-02   +1.529338428833226e-01   -2.775875172231447e-01   +3.344343537368549e-01   +1.247285403424340e-01   +2.452723825366199e-01; +3.110404647424632e-03   -2.365511495550406e-01   -1.717403898283960e-01   -5.149662634616017e-02   -1.556665121143087e-01   -1.669817699290135e-01   +4.341882231355043e-01   -1.965205949696600e-01; -1.701520388099100e-01   -2.404713478205851e-01   +7.411425433033200e-02   -1.270118991382768e-01   +9.648984310983666e-02   -2.713998845674424e-01   -1.211392782287833e-01   -1.678807317256058e-01; -4.512962286220945e-01   -3.702361926249764e-02   -5.540351622698753e-02   -4.392361471607385e-01   -2.739447193686687e-01   +1.186135490115993e-02   -2.491216052971854e-02   +2.281160672959082e-01; +6.507201627841463e-03   -2.339351550690276e-01   -1.624308706958445e-02   -4.645379001823903e-01   -7.892515051862919e-02   +2.584510234257248e-02   -1.339732576730071e-01   +1.554112505465955e-01; +3.749860309663958e-01   +1.651235076592182e-01   -1.820356962804761e-01   +2.709145409605027e-01   -1.823986961446960e-01   -2.319486484089323e-01   -1.573912417079797e-01   +2.528320157740877e-01; +7.026541545483281e-03   -7.216132854429472e-02   +1.961890094839933e-01   -1.597248315756204e-01   +8.858716430367106e-03   +4.034838941934846e-01   -9.375080173497104e-02   -1.794011120360768e-01];
L2E_L2I_iGABA_netcon = [+1.305897988598622e-01   +3.516131318135510e-01   -5.495693533488308e-02   +3.210041019454203e-01   -1.786479866590292e-01   -2.567020663610453e-01   -2.355347456930514e-01   -4.259811256317714e-02; +2.182365838303852e-01   -6.147130803552327e-02   +2.644209148778734e-02   -1.040802397619213e-01   +1.002322495052602e-02   +9.989593758387803e-02   +1.905578572736523e-01   +9.216010129880806e-02; -2.240426881973819e-01   +6.920313111842741e-03   -3.587950566367474e-01   +1.077074536541552e-01   -1.722559247553657e-01   +8.833223282776367e-02   -2.871330970504672e-01   +2.957619403481270e-01; +6.130485464430456e-02   +2.284390344816797e-01   -8.979402807656929e-02   +1.333962766285632e-01   +1.772521055960380e-01   -5.539984347100979e-01   +7.944895786621117e-02   +3.475129940099675e-01; +3.858779770858373e-02   -1.221525832662734e-01   +3.918661760785543e-01   -4.619901851645559e-02   +5.573837577122484e-02   +1.901521784273005e-02   -1.167528969313278e-01   -2.820342499099838e-01; +1.688856639973202e-01   -4.849199472111304e-02   -1.613270734118590e-01   -1.160747618135215e-01   -1.679044273231826e-01   -6.392546830805984e-02   -6.092377714781955e-02   -1.645206953887263e-01; -4.595830214074362e-01   -4.760406439305768e-01   -1.237583980730143e-01   -3.280278144266707e-02   +4.228977837612696e-03   -2.350410858556717e-01   -2.161163156228859e-03   +1.031295236827589e-01; -1.603588298460560e-01   -1.084339837435535e-01   +1.783536562404852e-01   +8.555273269286752e-02   +1.704306912735538e-01   -1.370240353472283e-01   -1.903042721021403e-03   -2.585021338827348e-01];
L3E_L2E_iAMPA_netcon = [+1.435882746899598e-01   +5.280016844683693e-02   +8.307965143161916e-02   +1.466058270076852e-01   -4.160011361833852e-01   +4.156074307297275e-01   +1.658554438497489e-01   +4.753739870647886e-01   +9.075029272139293e-02   -4.085229550825231e-02   +2.760133407970240e-02   -4.697751367438985e-01; -1.784781484285890e-01   +5.490582162824428e-02   +1.739631967917141e-02   +2.847161862186949e-01   +3.282285971835794e-01   +1.330520121492169e-01   -3.197860747219948e-01   -2.084018725578882e-01   -2.043494168089310e-01   +3.328724535884117e-02   -3.646996157035609e-01   -1.245044897913236e-01; +4.058772788074255e-02   -2.009357925538888e-01   -3.941250638978768e-01   -5.782742334758229e-03   +4.291924256207650e-01   +2.855259178734649e-01   +3.068524151763036e-01   +2.668803530576592e-01   +8.305388736293437e-02   +9.812824652117055e-02   -1.861150776877126e-01   +1.374123534784741e-01; -1.535539401638444e-02   +2.469514139297110e-01   +4.641778854981832e-02   +5.899566209734998e-02   -1.607222826183536e-01   +3.642330880433226e-01   +1.256871724566390e-01   +2.576212458447742e-01   +2.787655681692936e-01   +1.582713427462100e-01   +3.379770071935125e-01   +5.369728099760186e-02; +9.619951741895644e-02   +2.306453424746861e-02   +7.707766032403865e-02   -1.740873966471624e-01   -5.934105904415563e-02   -9.279973289641991e-02   -2.360393454346817e-01   +1.665765518544271e-01   -1.978959493029630e-01   +6.527417618685843e-02   +8.383889721486940e-02   +8.484977883491035e-02; +2.916273780728873e-01   +1.033621934982839e-01   +1.237124848082383e-01   +1.795450126484496e-01   +1.938193896093719e-01   -1.484247422712651e-01   +1.977128234985994e-01   -4.915152689697451e-01   +1.863637182143545e-01   -2.394955145320702e-01   -1.783355897722341e-01   -1.748963090603600e-01; +2.167008349064381e-01   +4.038458907128448e-02   +2.990302732550252e-02   -2.568022667980012e-01   -1.736494838660306e-01   -4.513880185937282e-01   +1.987104028691206e-01   +4.780824525416150e-01   +8.704271899974358e-03   +2.797596835870844e-03   +1.931856617627065e-01   -9.828819248947861e-02; +3.546487593546774e-01   -1.646893976469765e-01   +4.418946266004838e-01   -9.050227160340207e-02   -2.377055595545326e-01   -5.485639791165053e-02   +2.891818806402427e-01   +5.739217761180182e-02   +7.154419080353275e-03   -2.407598319605906e-01   -4.195955019872198e-01   +2.482324299574562e-01];
L3I_L2I_iGABA_netcon = [+3.182481318513589e-01   -1.732564832081681e-01   -9.900719188725561e-02   +1.683748991496214e-02   -1.728752487856557e-02   -3.177210562741758e-01   -3.366799173401036e-01   +3.438627436056279e-01   +2.150205439592101e-01   -2.076083072862216e-01   +4.901470726704685e-02   -1.670181774586371e-01; -4.255682177055405e-02   -1.146869750542322e-01   -2.454149142015555e-03   -1.073084199637741e-01   +9.684879496319436e-02   +1.433643572400731e-01   -2.297093558993218e-02   -4.166340832686420e-02   -4.779325204732164e-02   -1.031003714904602e-01   -1.986801372726118e-01   -1.450534855149719e-01; +1.213108535411650e-03   -5.754677868438618e-02   -5.738489161432961e-02   -1.399281878779188e-01   +1.698425419363310e-01   +2.751029004038813e-01   +3.825592848980963e-01   +2.071209966416464e-01   -1.346990225160960e-01   +3.173995591712900e-01   +3.066062390015961e-02   +2.975757308116828e-01; -2.124513954391955e-01   +1.871713140077199e-01   +1.309376214483210e-05   -1.126448971914728e-02   -6.833149268760452e-02   +1.625958578004317e-01   -1.379917860385144e-01   +2.434404750563602e-01   -3.224067188192542e-03   +1.686193370920652e-01   +1.579862292338109e-01   +2.511399310915710e-01; +3.576126722982527e-02   +1.114218312945951e-01   +2.472439544168915e-01   +2.572784420887380e-01   -8.426280162917116e-02   +1.345042429693448e-01   -7.869246506831656e-02   -3.133796933081279e-02   +1.443797500221585e-01   -7.981184504682381e-02   +2.528169728482783e-01   -2.186165485608018e-01; +1.128833176623915e-01   +4.883883674206729e-02   +5.549434819648752e-01   +3.684806226678969e-01   -1.131959634656380e-01   -3.096813866533840e-01   +2.185331655267910e-01   +4.676215276087415e-01   +3.820564604844130e-01   +1.249378295304447e-02   -3.637491086333339e-01   -4.708277779331065e-01; -1.771582144414208e-01   +3.027601603026601e-01   +2.005728656389515e-01   +4.121937952748649e-02   -4.103602067281467e-02   +1.275544558985163e-01   -2.896365593273060e-01   +1.730064021123898e-01   +8.326014540183937e-02   -2.726467746384463e-01   +3.787585601650832e-02   -1.306676516860925e-01; +8.192690032115146e-02   -5.087446907596929e-02   +3.129317522525761e-02   -3.124694960935253e-01   +1.268540006611865e-01   +1.880570752330832e-01   -1.207665276649635e-01   -6.504280708082454e-02   +2.896592101406376e-02   +4.691399868337280e-01   +2.601860808385921e-01   -3.535491458582708e-01];
L2E_L3E_iAMPA_netcon = [+2.430339532174611e-01   -1.690156434441872e-01   +9.217453079380207e-02   +1.345370252471580e-01   +2.123150770099179e-01   -3.501827683479707e-02   -3.414582417961699e-02   +2.969438747838110e-01; -1.990302718933190e-02   -4.586768268094341e-01   +3.169148622627793e-01   -3.912140762165631e-03   -8.361976765386905e-02   -3.334872258396560e-02   -4.598064146376307e-01   +6.795703195896784e-02; +3.877640119121285e-02   +2.652028110108580e-01   +3.572534696371449e-01   -2.281600426999256e-02   +2.072699661067661e-01   -2.172660758947421e-01   +8.245085183271383e-02   +7.629447876943107e-02; -1.500219066505507e-01   +1.940776265570424e-02   -1.974063007896412e-01   -1.307636499253577e-01   -2.866279863177010e-01   +3.371318921501171e-02   -2.608781100236236e-01   +2.623424441285448e-01; -4.141854190579833e-01   -2.990861998441229e-02   -3.028474238020287e-02   +1.128723693643360e-01   -1.467387067002839e-01   -1.221687139136589e-01   +1.366062373690272e-01   -1.323804196784514e-01; +2.925604464406598e-02   +8.062913474583820e-02   +2.673282923461842e-02   -1.331644567402064e-01   -1.615188342385242e-01   +3.915310371995653e-02   +7.763008135350989e-02   +1.002957647530296e-01; +7.949497319938464e-03   +9.286623178596806e-02   -2.986354940656135e-01   -8.133027120706587e-02   +2.983445299349334e-01   -3.305906218362596e-01   +2.881757449914146e-02   -2.067194832869895e-01; -8.714250673220056e-02   +2.809237358669192e-01   -2.623478885140723e-03   -1.210451167123244e-01   +4.467421189850205e-02   -1.601014506677173e-01   +1.532644042503915e-01   +2.016878513718592e-02; -5.402930992788318e-02   -2.370522794211370e-01   +5.255420191382066e-02   +3.690761219062131e-01   +1.627789387562456e-01   +1.055172723226364e-01   -3.519508053821190e-02   -2.913292215179292e-01; +1.006623747936617e-01   +8.937320888185415e-02   -6.275067167781667e-02   -4.798197642990084e-01   -4.588879672976299e-01   -7.114131692627775e-02   +1.720675435382013e-01   -1.629895349108002e-01; +1.694574263463063e-01   +2.612794561295815e-01   -1.746123367647022e-01   -8.200102852902172e-02   +2.446385948433741e-01   +3.495164456808725e-03   +2.127271164232718e-01   -2.842653993323636e-01; +3.687764488169976e-02   -7.042345229576372e-02   +2.428270506142717e-01   -1.085976131705219e-02   -1.164536949024394e-02   +1.878329202633910e-02   +6.721257217110278e-02   +2.622829097945409e-04];
L2I_L3I_iGABA_netcon = [-1.713735498138756e-01   -3.535421668089095e-01   -3.918599779445969e-01   -2.993124008466950e-01   -4.731868817851799e-01   +1.662175159981189e-01   -1.742995208024739e-01   +2.292390945840230e-01; +1.167900042655490e-01   +1.605506405592213e-01   -2.733635593163311e-01   -1.279546290453166e-02   +3.202807736975771e-01   -2.003666530568366e-01   -1.818832311397116e-01   +2.902285065104848e-02; +2.781622058479343e-01   +2.380086753331489e-01   +3.070487131317431e-01   +1.270955649910345e-01   +2.693831356138544e-01   +1.890921229205572e-01   +9.636503779685873e-02   -1.176020475921565e-01; +2.857518474360030e-01   -1.061897817714316e-01   +3.939045250630492e-02   +4.649291268849757e-01   -7.654139652244041e-02   +9.519495769970295e-02   -1.246623167246109e-01   +2.308732125097156e-02; +1.547324885886341e-01   +4.593203448835972e-02   +4.399545151534417e-01   +3.140667424428084e-01   -1.475501972343247e-01   +4.286712856882708e-01   -2.673742522702877e-01   -4.042702569210102e-01; +3.461489435686799e-02   +1.284663448495673e-01   +1.529855128952051e-01   +7.417521357897805e-04   -2.774337971686329e-01   +4.059367164759639e-02   -3.583788445221702e-01   +1.057889455537950e-01; +1.240090031254722e-01   +1.597925806093430e-01   +1.799648368304844e-01   +2.295167551837556e-02   -3.217775366172008e-01   -2.486289494618909e-01   -2.206149439251674e-01   +1.778223788282425e-01; +1.100625357456593e-01   -1.935285715627080e-01   -1.526571979853814e-02   +9.202393643869955e-02   +1.356890259864150e-01   -2.346395633031433e-01   +3.989282707270730e-01   +3.074864201368853e-01; -2.210737918938157e-01   -7.182144391213963e-02   +8.273905982370940e-02   +2.126158097585944e-01   +5.198864330372538e-02   -1.102581349664903e-01   +1.366554817023694e-01   +3.769296282891698e-01; +1.980368121206235e-01   +4.565225827830392e-02   +1.492226302952609e-01   +2.339717123373996e-01   +1.017847690358697e-01   -1.094272462182481e-01   -1.630501696037581e-01   -2.040532579394138e-01; +4.329299429949127e-01   +6.958084320132858e-02   +5.603332310438267e-01   +2.970416460481962e-01   -1.769756811393714e-01   -2.433895589044061e-01   -1.375649755222257e-01   -1.023271955442817e-02; +1.993571677688823e-01   -2.511608043828479e-01   -4.186668856225123e-02   +3.261920278816363e-01   -9.932643377324359e-02   -1.469985708071866e-01   -1.779007613722348e-01   -1.082795709416513e-01];
L3I_L3E_iAMPA_netcon = [-2.492370001613546e-01   +5.381687348189478e-01   -1.736125875356716e-02   -1.033305512947444e-02   -1.864068075999325e-01   -3.359996160955955e-01   +1.421095442433328e-01   -1.353465248562271e-01   -1.547197063986964e-01   -5.708695610666586e-03   +8.619403049060755e-02   -1.786537418714930e-01; +2.970240569237358e-01   -3.266885074542932e-01   +1.100578230274301e-02   -2.387904399900657e-01   +3.248699702841873e-02   -2.621702736942361e-01   -1.489455722178050e-01   -6.648480705545548e-02   -7.076001870656734e-02   -2.454777128248162e-02   -1.638884743438291e-01   -9.030005047862039e-02; -3.126763484592183e-01   +2.431450783596288e-01   -1.419449437651120e-01   -2.491973818575386e-01   +2.946724662745874e-01   -2.257001647651745e-01   +4.929840801366882e-02   +1.086498691894014e-02   -2.463131803207615e-01   +7.611844038673857e-02   -1.937556933177440e-01   +2.180849734899081e-01; -7.096946392265996e-02   +9.993842656050209e-02   -3.676335514590284e-01   +5.570341086358845e-02   +1.325752004729016e-01   -3.732674543249170e-01   +3.197357621425770e-02   -5.474860474985033e-01   -4.160552754036860e-01   -1.359405707399119e-01   +3.023906228819266e-01   +1.848410366500062e-01; -1.756797729327411e-01   +2.980270146242235e-01   -9.255778090529056e-02   +4.023825310911191e-01   -6.779727238039496e-02   +1.686848778568253e-01   -1.176554397843925e-01   +3.463267451222063e-01   +1.674394207248135e-03   +2.814551541384432e-01   -1.385164189801205e-01   -1.044423299222875e-01; +1.977286890140270e-01   -9.708053516583413e-02   +1.927250942947142e-01   +8.763037613681231e-02   +2.237726618988193e-01   +2.158167454477962e-01   +3.258441506363891e-02   +1.584998719817158e-01   -2.296438884169656e-01   -2.810856554242387e-01   -2.241224289969702e-01   -1.489130258038385e-01; +9.637753438757395e-02   -3.613041995088622e-01   -1.305448979757091e-01   +3.968216636307033e-01   -2.617353737930068e-01   +1.230960592157469e-02   -3.071115966096569e-02   -1.030270657232231e-01   +1.094815749089366e-01   -1.475714346259399e-02   -1.826550801166058e-02   +2.666113599811244e-01; +2.525584469395556e-01   +9.207954009468919e-02   -1.836009935641888e-01   -1.892601711929052e-01   -6.898850858593725e-02   -4.149989170317588e-01   +1.562275031930005e-02   +1.071559329196187e-01   -4.626130515942473e-01   -5.092790912970482e-02   +1.784801368244154e-02   +5.768984140345640e-02; -1.898312316291970e-01   +2.842505954808316e-01   +2.773787554755747e-02   -1.823088132512118e-02   -2.421978796448776e-01   -2.858576232786106e-01   +1.573513504955265e-01   -2.305793148461043e-02   +1.201136699608061e-01   -3.604140324018801e-01   +1.250923201783090e-01   +3.008607309349848e-01; +3.000833275010265e-01   +9.900318298081225e-02   +3.959630044587806e-01   +3.598168284273656e-01   +2.768707039743893e-01   -3.186201419643449e-01   +2.077858130111215e-01   -2.770568012316754e-01   -1.099361001710493e-01   -1.974051494595025e-01   -6.939079377923915e-03   -5.365755753697769e-02; +1.766865448322083e-01   -1.198502572756829e-01   +2.845265050788490e-02   +1.397777943779954e-01   -2.421393131696115e-01   -2.362432519673144e-01   +1.794415734528450e-01   -1.646435574537044e-01   +2.121222215111461e-01   -2.189965851760679e-01   -4.603234334543888e-01   +1.245636579181976e-01; +2.035552937924753e-02   -2.577549937660526e-01   -6.911834180558522e-02   -2.625208190804295e-01   +3.536625604309792e-01   -2.879177706278098e-01   -1.383052735419885e-01   +2.196112523181774e-02   +2.291231731110033e-01   -9.740051726077320e-02   -5.623251624113417e-02   +2.162847466260917e-01];
L3E_L3I_iGABA_netcon = [+1.381401256564538e-01   +1.229250047500970e-02   +1.910598160579842e-01   +1.122854161732689e-01   -5.158954041254260e-02   -3.598006072319826e-01   +1.426777799414084e-01   +2.475695659036516e-01   +1.135907487804372e-01   -2.629252647113707e-01   +3.541510378401435e-01   -1.188918116538081e-01; +2.787621387036568e-02   +1.390178329162149e-01   +1.418203333205773e-01   +1.450935589090509e-01   -1.008162877188234e-01   -2.995905088883318e-01   +1.918392851179889e-02   -3.559068128542968e-02   +4.063483046068631e-01   -3.520561805262521e-01   +2.315399961150035e-01   +4.853614193789435e-03; -2.198222071259969e-01   -3.699806474163216e-01   -3.981265680745430e-02   +2.656753047659963e-02   -2.865080838826179e-01   -2.709946521787460e-01   -2.632925017205774e-01   -8.562415517097792e-02   -1.106442673539702e-01   -8.290901897524461e-03   +2.089926099656529e-02   +1.424318272072131e-01; -4.040411957128964e-01   -1.575307150344454e-02   +2.224695263902257e-01   +2.533206092800250e-01   -1.703470065972578e-01   -1.909876853414731e-01   -2.325304008223755e-01   -2.585065515043255e-01   -1.009676308539240e-01   -8.684196423149566e-02   +5.036214196373137e-02   -3.052986830089655e-01; +1.629866544797609e-02   +2.825090595238280e-01   +1.693528299372906e-01   -1.235510779711919e-01   +2.549598204497732e-01   -3.184424371192363e-01   -1.988610643733152e-01   -3.634497664509394e-01   +2.614997955682191e-02   -5.202325229110435e-01   -1.354872694807381e-01   +1.426502971622438e-01; -9.895640712377002e-02   +2.798617495371409e-01   +1.578424871473926e-01   -3.220519604099397e-01   +6.294022066290336e-02   +9.587742089583019e-02   +1.029879518629299e-01   -1.931798912030688e-02   +1.207291395824945e-01   +2.945019405863075e-01   +2.033632971954744e-01   -1.738571249334926e-02; -8.089486578039061e-02   +4.588252176913938e-01   +1.151646987652108e-02   -4.140614327528464e-02   -3.953346629531324e-02   +3.312860230958487e-01   -1.870866700364966e-01   +3.344641755941700e-01   -4.239863845987513e-01   +4.762048549542375e-03   +3.413671567143621e-01   +2.069707214952026e-01; -2.947364386023835e-02   -8.789046510964232e-02   +2.010371094303923e-02   -1.018222514507496e-02   +5.532682870239919e-03   -1.359617680752279e-01   -8.256305233709918e-02   -2.693898256882519e-01   -9.495018900095115e-02   +2.121078746547240e-01   -1.746009227963474e-03   -3.376661567644120e-01; +1.056962719656766e-03   -3.145448147014506e-01   +2.558602217232711e-02   +1.915640863386688e-01   -1.693959001773558e-01   -2.157765169320936e-01   -2.116717671200618e-01   +3.257261102509688e-02   +6.050646679341921e-02   -3.752036812866941e-01   -1.207531110865646e-01   -4.779438745550411e-01; -6.078533765036421e-02   +8.487841486618064e-02   -9.615402339532050e-02   +9.971700497121165e-02   -1.996142647662624e-01   -1.385703487367566e-02   -2.340798263315380e-01   -2.682740267954339e-01   -2.356618834876545e-02   +4.193806744881923e-02   +2.594723447505471e-01   +7.269357557808132e-02; -3.883754953066479e-01   +6.525606598136030e-03   +9.646919112261484e-02   +1.442491957561481e-02   +1.848152629702088e-01   +8.549609680551740e-03   -2.286517288323833e-02   -3.720319807715365e-01   +1.178609378044413e-01   -2.300149550203469e-01   -1.542404983780458e-01   +2.783438036998463e-01; +5.053332669922012e-02   +5.004829157187370e-02   -1.067071265196584e-01   +3.514539810207192e-01   +6.586536235915066e-02   +9.974768094061420e-02   -3.818241877472335e-01   +3.425720751740409e-01   -5.827651160559838e-02   -2.173702663653639e-03   +5.817159592010678e-02   -2.139040919446572e-01];
L2E_Input1_iAMPA_netcon = [+4.152186215677744e-02   -1.619106845362991e-02   +3.023097672656736e-01   +9.997329275054034e-02   -1.070508982617411e-01   -3.230085204438727e-01   +8.941683578110149e-02   -3.477640015790503e-01];
L2I_Input2_iAMPA_netcon = [-5.094694531526847e-02   +2.310976233497540e-02   -1.018727406092490e-01   -2.998913837831895e-01   -2.911858548925192e-01   +3.882524017345626e-01   -4.954722276162463e-02   +6.046469803179105e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
