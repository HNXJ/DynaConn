function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-8.854080632847993e-01   +2.845158751273716e-01   -6.610958356850709e-01   -6.632496590121928e-01   -1.661013305509041e-02   -3.062325318062833e-01   +2.021316421879443e-01   +4.417244532566055e-01   +1.596844764990986e-01   +1.257305000635188e-01   +1.974753359058610e-01   +3.581185478181639e-01   +2.775003820713705e-01   +2.231877133837699e-01   -6.267066814833561e-01   +4.505755756981235e-01; -6.609217692812360e-01   -9.075626526021528e-03   -1.797848610784995e-01   +3.530468980937481e-01   +1.687179266620428e-01   -8.239224907211966e-02   -5.511337995313639e-01   -3.579037438858861e-01   +8.967859177520533e-02   +7.257049189799029e-02   -5.421327603812776e-02   +2.331024914230395e-01   -6.374976895065442e-01   -2.987390792664552e-01   -4.024161104611048e-01   -5.619215634587900e-01; +5.496055818672374e-01   -1.751287652834075e-01   -9.315025829847598e-02   -4.965448013412933e-01   -8.806836173395787e-01   +9.456212601216886e-04   +1.387441908321845e-01   -1.737652283199558e-02   +4.466307260501361e-02   +3.586363002028681e-01   -3.815461878427048e-01   +1.364419284814349e-01   +6.666568621767990e-02   -1.539033307946196e-01   -2.852299278638512e-01   -8.538668887362993e-01; +6.561155056978328e-01   -3.369400137027889e-01   -3.480057831746659e-01   -3.973983373551973e-01   +3.387695359528762e-01   -2.262043240539733e-01   -1.174124908281139e-01   -7.157850083715791e-01   +1.945916485210889e-01   +1.753180622683425e-01   -4.520280103727233e-01   -8.230641598751433e-02   -4.963309684094861e-01   +1.037139617567672e-01   +4.003006615607443e-02   -3.545176163339113e-01; -1.257317382243233e-02   -1.896035123809079e-01   -4.724398552440199e-01   +3.814846638506798e-01   -4.006161781914666e-01   +3.298314778301871e-01   +1.167677278028796e-01   +2.304936026702591e-01   -1.178843560466929e-01   -6.826876760539030e-01   -2.268790506750785e-01   -4.228108326396719e-02   +1.217317304206275e-01   -5.531727187487206e-01   +4.605476820719496e-01   -5.760152922457012e-02; -8.401812719761093e-01   -7.238781574883858e-02   -8.416846509259234e-01   -8.228507321319284e-02   +3.759163692939851e-01   -6.309191251807821e-02   -2.509187968217995e-01   +4.365893785422325e-01   -7.786222946724141e-01   +1.997991461143716e-01   +3.325040543610364e-01   +3.654588060593268e-02   -5.412563977805401e-01   -1.780092403882303e-01   -3.534344336396247e-01   +3.883471001650168e-01; -4.115509991755926e-01   -3.328008662809920e-01   +4.710482358003248e-02   +5.649657211327632e-02   -1.854148785661660e-02   -3.064708101689174e-02   -2.297603126357261e-01   +1.857539573430453e-01   -8.273711787682912e-02   -5.141933668849914e-02   +1.090977306895666e-01   +9.995646810491264e-02   -6.081788446809840e-02   -1.794638998826007e-01   -1.979211202838600e-01   +2.163880470401853e-01; +2.800451334263805e-01   -1.953753712050122e-01   +1.446990095516401e-01   +3.466597669555826e-01   -5.242814115644536e-01   +4.707970587068538e-01   +8.240599519894141e-02   -3.733579789624112e-01   -5.043928006647396e-01   -2.545016701808916e-02   -5.424657789545537e-01   -4.608898494409065e-01   +1.664001000135214e-01   -4.484112439821109e-01   -1.853480420061920e-01   +8.112945834393823e-02; +4.228270098052065e-01   -1.808281502340293e-01   +2.536756127932717e-01   +7.310871673447622e-01   -3.821931801768204e-01   -5.811411639125076e-01   +7.694529724138981e-01   -3.994835503652060e-01   -1.619963025741751e-01   +6.349767565567100e-01   +3.025901842243936e-01   +4.354360826208706e-01   -4.472130064590433e-01   +1.534929570605053e-01   -1.279030838276767e-01   +7.020315343046246e-01; -1.286474928006794e-01   +3.214713400201550e-01   +2.972472049061077e-01   +3.977315107646215e-01   +1.440353977569999e-01   +5.749135701198000e-01   -6.875025236848674e-02   -3.930440205977875e-02   +4.226515734134286e-01   -6.575204146785320e-02   +8.148319744667547e-02   +4.448189600501540e-02   +8.831804225732608e-02   -2.951860165946237e-02   +1.541522628029387e-01   +6.326866649392172e-02; -5.574105467516759e-01   -5.620010922996501e-01   +5.619056512615523e-01   -1.817307262357737e-02   -8.588365799938538e-02   -2.915012862868733e-01   -1.071974132554285e-01   +1.288003325231470e-01   -1.440103671695081e-01   +3.467038483004127e-01   -1.781851544883361e-01   -4.512205364978605e-01   +1.852386351879545e-01   -8.885976208776454e-02   -3.523625614489585e-01   -5.780026456477045e-02; +4.155174933081754e-03   -1.485569828816401e-01   +6.305221376453015e-01   +3.422854642401029e-01   +3.644819567884790e-02   +1.803934152392216e-01   -2.269158646007796e-01   -1.160355947487634e-01   -4.218560071072271e-01   +5.804136238122456e-01   -3.707131588387691e-02   -4.767736631260631e-01   +5.533448265180007e-01   -4.771523042322807e-02   -4.746361485724050e-01   -3.141392266187918e-01; -4.447624554664422e-01   -2.638194391144492e-01   +1.506648616155036e-01   -1.044413015416593e-01   +1.083412635432626e-01   -1.214467770610881e-01   +5.186728691297743e-01   +4.047572188440995e-01   -4.229212111849752e-02   +3.726602368124068e-01   +3.734265984928196e-01   +2.281894865731330e-01   +8.023059121572550e-02   +2.170591601180925e-01   -6.101966764672508e-01   +3.007159249427727e-01; -2.179017381409308e-01   -1.614665691721783e-01   -5.403629122506647e-01   -4.361838286218551e-02   +3.970857682880090e-01   -1.000000000000000e+00   +4.894638361110348e-01   -4.075623183078618e-01   -3.055822277086595e-01   -4.545525904149950e-01   +1.981223378545058e-01   -7.689794018869468e-01   +2.072515437109077e-01   +4.671215146660168e-01   -2.704170099972257e-01   -9.377617476700996e-02; +1.664454228542031e-02   -5.521176081334688e-01   +9.862431944183316e-02   -5.511560422110723e-01   +1.973395716917835e-01   -2.849809138098787e-01   -1.968309869985012e-01   +6.953490584850637e-01   +1.806435424584605e-01   -4.263848665493336e-01   +3.495859996715382e-01   -2.974090240139141e-01   -2.296058006378226e-01   -1.261255057273225e-01   -3.985548098844391e-01   -3.985704634857715e-01; -3.434047017023483e-01   -4.388653010996691e-01   -2.370402525713056e-01   +1.295498829738910e-01   -3.184901007852824e-01   -1.854634250350654e-02   -1.540447400271857e-01   -5.707095607774456e-01   -4.848450576092397e-01   +5.505460480646628e-02   -3.012536891258407e-02   -4.510658506676447e-02   +7.739786394573379e-01   -5.614999724236074e-02   +9.173300438633386e-02   -1.339505940549014e-02];
L1E_L1I_iGABA_netcon = [-6.297501441253334e-02   -1.228535824655194e-01   +1.060199986979179e-01   +2.509915372773694e-02   -4.408971799054886e-01   +1.445313316095734e-01   +5.924247796285456e-01   -3.824829025138711e-01   +4.711152276838108e-02   -1.562168347946847e-02   +2.402182404118100e-01   -8.747516562723825e-02   -2.044839735035115e-01   +3.369454231252325e-01   +1.838072122934401e-01   +8.522453198764016e-02; +6.691860671403702e-01   +4.582808808983513e-01   +1.302046857517462e-02   +5.999154165689194e-01   -6.822115371703865e-01   +3.287034381870388e-01   +4.500932797216723e-01   -7.028180317834113e-01   +3.235034472774324e-01   -4.332916136238262e-01   -3.126378937775133e-01   -3.798717528957049e-01   +2.104600067147091e-01   +8.941077692328317e-02   +1.755784032765911e-01   +3.841082328814498e-01; -2.942938212512087e-01   +4.863497211208772e-01   -9.220614622192230e-02   -2.516669846910227e-01   +6.805443734873750e-01   -2.822843306087868e-01   +5.140271036526606e-01   -8.749881940120602e-01   +1.061793476756189e-01   -3.005460556410858e-01   +3.883429541071657e-02   -3.909333447771325e-01   +2.775852710632274e-02   -6.114098395652882e-01   +2.819999221950037e-01   +1.809069388415994e-01; +2.044236384483540e-01   +5.066248928950722e-01   -3.152456145715342e-01   +1.108251900158732e-01   -5.439803249603825e-01   +4.792803677532633e-02   +1.863033474004896e-01   +3.103910735183641e-01   +1.209206496665033e-01   +8.463368773889905e-02   +4.197152836302651e-01   -2.552522188987493e-01   +9.964984276058873e-02   -5.949509275476933e-01   -1.471855602347595e-01   -3.418762278773236e-01; +2.918812839648037e-02   +3.044066376029315e-02   +1.709451268626508e-01   -2.746133949112497e-01   +5.088147144919437e-01   +7.183561332878347e-02   -1.261355432271530e-01   +2.883581141690285e-01   -2.040761207498719e-01   -2.527193927214169e-01   +3.732047110750754e-01   -3.445534783861111e-01   +8.692501574339172e-01   -1.150723022464961e-02   -1.320378089431632e-01   -6.869725460295472e-01; +1.809702380022112e-01   -7.355043722992066e-02   +6.670866980267899e-01   -1.388092681130564e-01   -9.665706569745944e-03   +2.084013413142448e-01   +1.272489453657898e-01   -2.502470330729236e-01   -7.785455359040836e-01   -2.718515059215335e-02   -2.278191239784866e-01   -6.759027436782555e-03   -3.408482146353583e-01   +2.073887117659779e-01   +3.099636357845085e-01   -4.206601922922424e-01; -1.842105160435479e-01   +2.534231721584007e-01   +1.166871518711151e-01   -1.640178304598789e-01   +3.317910649744502e-01   -4.185940701747256e-01   -5.071046405913787e-01   +4.485961376624156e-01   -1.069081155491851e-01   +4.034373434405916e-01   +8.621910873103777e-02   -6.301740453532862e-01   +5.320196373358349e-01   +4.299723425087699e-03   -6.113386355041257e-01   -5.423912521217653e-02; -5.102899829185732e-01   +8.745412242574763e-02   +2.661591930394978e-01   -2.418411184515487e-01   +1.261137997451357e-01   -1.659900625197314e-01   -4.409184596848345e-01   -5.354403720085344e-01   +4.341828897892360e-01   -5.411418405379663e-01   -3.042286654355835e-01   +2.890595914563767e-01   +3.614200513496383e-01   +4.184763955351563e-01   +4.842668805612297e-01   +1.496433425445665e-01; -2.686748912151259e-01   -2.323084561100372e-01   -1.651675860041885e-01   -6.569229379030986e-02   +4.633441016242830e-01   -7.304110981933504e-03   -5.674219720716451e-01   -3.536872929028854e-01   -6.755355364903043e-02   -7.068148798727820e-02   +3.998008747738414e-01   +2.335978899166130e-01   +2.918268657949921e-01   -2.364678779628125e-01   +9.373664087544671e-02   +4.966528361158782e-01; -4.076798011375023e-02   -2.414720812477199e-02   +3.918205411695268e-01   -3.364875729690072e-01   +1.585800730199254e-01   -2.425729288852487e-01   +2.111386245753193e-01   +3.473427808360953e-01   -1.529408296786783e-01   +1.066144991645300e-01   -1.340350127829282e-01   -1.555034068906097e-01   -9.069306292778684e-02   -9.731550885023113e-02   -6.373755412333467e-01   +8.592916712654709e-02; +6.023139260979901e-01   +1.150380600239501e-01   +3.057444661170209e-03   -5.916821248017264e-01   -7.000255927998783e-01   -2.191286589587197e-01   -1.527655973433065e-01   -5.061811690575239e-01   +1.568384778862845e-01   -1.470858190139458e-01   -1.728975390845438e-01   -1.035863091812142e-01   +5.167741260105165e-01   -1.247248458572530e-01   +3.085296752175510e-01   -3.087917188131973e-01; -4.991984804517863e-02   -6.966812030237991e-01   -3.808310679074380e-01   +1.364044839350534e-01   -6.134639345796637e-02   -5.703659728960896e-01   -7.332404578084895e-01   -2.672825018742542e-01   +4.237826784595777e-01   -1.463849585529278e-02   +2.632110142569361e-01   +3.827277233215710e-01   +3.148606171663659e-01   -5.837524013444195e-01   -2.067862940229486e-01   +5.024023514466973e-01; +3.190257894380692e-03   -2.500231596086782e-01   +1.577214997290269e-01   -4.761402300401212e-02   +7.846585318079866e-02   +2.527127576201637e-02   -1.437231650715505e-01   +6.955973952569288e-01   -5.224467730830810e-01   +2.224265888715597e-01   -1.021322310310223e-01   +6.222710839130403e-01   +5.049788571154306e-01   +2.096769622665895e-01   +2.638454226638943e-01   -5.925417295036670e-01; -5.731594638189161e-02   -1.319221230195143e-01   +1.120746337795414e-01   -6.862249396018775e-01   +8.099185626439249e-01   +5.834084818990569e-02   +3.531970405808748e-01   +1.556587573846349e-01   -2.353739971456011e-01   -2.344560525543380e-02   -3.372757147479599e-02   +3.696657263472679e-01   -2.350623057278117e-01   -2.643952685213710e-02   +4.393623254597652e-01   +1.303973403049049e-01; +4.862088237045348e-01   +5.460637058415930e-01   +7.144122269173442e-02   +1.025920923139659e-02   +8.413563242797446e-02   -3.176248987528602e-01   -1.170781087278699e-01   -4.086974636780961e-02   +6.118927817519791e-01   -3.363494568094529e-01   -1.324082309686439e-01   +2.238194534113585e-01   +7.696811279190880e-05   -3.739844213408678e-01   +2.017322617785030e-01   +8.368104769547186e-02; -5.290171575799416e-01   -3.297668330405123e-01   +3.699088579221056e-01   -2.166400735621312e-01   -2.246992345983821e-01   -5.840479585258019e-02   -1.188588728038232e-01   +5.727787203800138e-01   +8.055391430946318e-02   -8.656208187556442e-01   +2.347646710271943e-01   -2.792572324797608e-02   +1.000000000000000e+00   -5.822580923432236e-01   +4.790659127787725e-02   +2.547373100828087e-01];
L2I_L1I_iGABA_netcon = [+6.176211329828072e-02   +2.852907669679119e-01   -1.759009963064433e-01   -2.276081182912305e-01   +8.108735125252752e-01   +3.676147089635860e-02   +3.835771125285383e-01   +4.942347078946529e-02; -4.868186064815802e-01   +1.157209174667597e-02   +9.354634667928005e-02   +4.087424666781593e-01   +9.236691580599121e-02   +2.263267372041537e-01   -1.137610479907502e-01   +4.621661656730078e-01; +3.623800374172421e-01   +5.996501868210327e-01   -9.391911130265129e-01   -3.490719808768249e-01   +4.229834305562677e-02   -3.195030491208622e-01   +1.177483777884223e-01   +2.039491867360364e-01; -8.156213145861070e-02   -7.967473878020481e-02   +4.304334769033823e-01   +6.518539157703901e-01   -2.942557335644527e-01   +3.365902478488905e-01   +3.427173840058263e-01   +2.529741647030589e-01; -7.523675922158035e-01   +1.728178379389934e-01   +4.540554774040242e-01   +3.987092537764655e-01   +4.929984130370895e-01   +6.796767900025387e-02   +6.331766754613095e-02   +1.909428132551109e-01; -1.350169307930156e-01   +4.660275312112447e-01   -2.982404119077447e-01   +3.394025160920476e-01   +2.805712323560110e-02   +4.915568657233060e-01   +2.141411993292694e-01   -4.320105074485445e-02; -3.290291957867126e-01   -6.624756212299593e-01   -7.588642658508966e-01   -4.053892725459207e-01   -4.855015449092649e-01   +6.651026150932222e-02   -3.276161507243067e-01   +4.721475556702747e-01; -2.460523754360349e-01   -4.771655233363714e-01   -1.903376930550163e-01   +2.293427731466633e-01   +4.240877129252603e-01   -5.852895494411035e-01   -1.754059906395220e-02   +4.092578785141402e-02; -1.759696329752525e-01   +1.741551194280612e-01   +1.095094928622455e-01   +4.444708929598299e-01   +5.990214123670792e-02   -2.652247200173411e-01   +1.468570229466463e-01   -2.909426223091152e-01; +4.590383336211657e-03   +5.020525520707584e-01   +5.034933212004631e-01   -4.423360362863884e-01   +4.328859893606463e-01   -5.579930277631104e-02   +2.657412367065620e-01   +1.070853486600203e-01; -1.338982052577474e-01   -3.019725451734203e-02   -5.308615724582030e-02   +2.853661627193887e-01   +5.757236871774982e-02   +6.666160242809739e-01   +3.890782471936467e-02   -1.549503541987168e-01; -5.880744618280457e-02   -5.317453011090183e-02   -2.892856189226971e-01   +1.323214946242769e-01   -2.656075698732025e-01   -5.728373903933765e-02   +4.264530352645082e-02   +1.172327261242040e-01; +1.658008557850833e-01   +1.756633334051314e-04   +6.901213477967815e-01   -5.999274385025259e-01   +3.441785045644805e-01   -5.074841085297276e-01   +7.950371721218366e-01   +2.422963138661906e-01; +5.758472405670029e-01   -6.584371461214025e-01   +2.133873924038345e-01   +3.076331253392899e-01   -2.896868848025118e-01   +2.447766467404193e-01   -4.560637982069053e-01   +1.348447211311412e-02; +6.628308079098962e-01   -7.220550642244729e-02   +1.684309761337480e-01   -3.365210610481593e-01   +7.295956703191573e-01   +1.745185685355582e-01   +4.822697247327276e-01   -8.577291509507570e-01; -5.452894331464682e-01   +1.000000000000000e+00   -1.600117413856248e-01   +8.553923439509262e-01   -2.371167170463040e-01   +4.409343371842511e-01   -3.793742338666494e-01   +3.981474275915036e-01];
L1I_L2I_iGABA_netcon = [-6.685376658536615e-01   +1.793626214052715e-01   -3.988247706494340e-01   +2.057453037823117e-01   -2.754188380460623e-01   +3.998951189403284e-01   -9.377530488924112e-02   +3.997963610733578e-01   +2.525341511102334e-01   -4.868052418755387e-01   +1.835491126210502e-01   +6.147835380963815e-01   -6.344877699778856e-01   +1.367760234153023e-01   +7.054143565928980e-01   +4.342276237289302e-01; +5.386867014708592e-01   -7.088912479721388e-01   -1.031909716789683e-01   +1.931949131437288e-01   +8.411589221437173e-01   +1.975728153291862e-02   +5.135465892948684e-01   -5.767024201307532e-01   -1.742457323251610e-01   +1.682299031913804e-01   +8.588987834736822e-02   +5.188315297045855e-01   -7.818543838696533e-01   +3.444382497852092e-01   -4.175696275743412e-01   +2.804620741344571e-01; -2.970514778914131e-01   +4.269792424277091e-02   -1.988191992905305e-02   -5.054423493053836e-01   -2.946635813494963e-01   +1.611268427907064e-01   +1.017371068713468e-01   -1.139903370951505e-01   -2.418442265413131e-01   +1.658932569820444e-01   +7.085896155342612e-02   -9.491643185073880e-01   +4.421320564919439e-01   -4.827286202279474e-01   -6.497711036538764e-02   +5.520278232810617e-01; +3.673316949757786e-01   -3.493567073892193e-01   -1.953180328931821e-01   -2.301037047240629e-01   -5.526221959978214e-01   -8.131777297021763e-01   -2.678545140290245e-01   -3.045592653028183e-01   -8.008037719445297e-01   +1.949770640556511e-01   -2.149364684653979e-01   -3.193771001600199e-01   -8.048663565485542e-01   -3.739061247969428e-01   -3.779428463100107e-01   -5.979936456701646e-01; +4.532779500273179e-01   +1.718343574342981e-01   -2.402922418226278e-01   +8.220458091365801e-01   +4.389647212869698e-01   -2.715134285749798e-01   -4.262460425885861e-01   +1.477952817077468e-01   +2.916707472051751e-01   -5.901383362348941e-01   +5.495935504129414e-01   -1.865729096876873e-01   -1.885252557635689e-01   -2.748723672596927e-01   +3.143234892926237e-01   -3.234749573132724e-01; -6.448515270013841e-02   -1.834874656545502e-01   +8.293063802132856e-01   +1.962858556697246e-01   -1.498680297527946e-01   +3.324657785558101e-01   +4.735358544665927e-01   +2.683719252757464e-01   +2.622988463493793e-01   +1.978623110529239e-01   -2.327873613680168e-01   -3.688851158958560e-01   +8.441701437249476e-02   -2.353205210725337e-01   +3.227104858901534e-01   -9.724727411425305e-02; -3.191090759561288e-01   +2.464549959404307e-01   -2.783245549619296e-01   -3.228355508911131e-02   +2.507086600420687e-01   -4.877437246872872e-01   +1.915735279585331e-01   +5.641759541686218e-01   -1.000000000000000e+00   +5.075956463860759e-01   +4.224790305879484e-01   +7.120412383511324e-02   +8.625901119810352e-01   +6.404632895225415e-02   +5.601742184124860e-02   -3.357077085057330e-01; +3.004690333225912e-01   -4.070582572700827e-01   +3.518696737605099e-01   -4.440296254857262e-01   -3.543011539425588e-02   -5.676850925781109e-03   +4.318686575359462e-02   -3.789862358729669e-01   +5.973104061780471e-01   -4.789117906667620e-01   +3.477009314722253e-01   -3.912469070667260e-01   -1.159821394951246e-01   -5.944979880107554e-01   -2.422025466537207e-01   -9.596160863419875e-02];
L2E_L1E_iAMPA_netcon = [+2.367547433547275e-01   -4.193617617487208e-01   +2.088029081091773e-01   -1.508278270626983e-01   +2.894478927754025e-01   -6.190396181312050e-02   +3.345303191131293e-03   +3.370987128657839e-01; +4.014983893015590e-01   +2.295239472102708e-01   +3.403026508468336e-01   +2.442770071732124e-01   -2.582431439570977e-02   +2.746137960724863e-01   -6.333987287813596e-01   +3.162500555637850e-01; -3.923929978443605e-01   +4.295177004991471e-01   -4.606955170604767e-02   -3.761820077259646e-02   -7.271694205037453e-02   -1.137725193724013e-01   +1.174164456496570e-01   +1.554520655898187e-01; +3.667018573832955e-01   +6.821009274727595e-01   +2.660310975250190e-01   +7.307312314773734e-01   +2.050601618471388e-01   +1.298860974900877e-01   +1.891653614647769e-01   +1.028060494396839e-01; -1.371742837457798e-01   +3.688072395836102e-01   +8.561326744577040e-01   +1.618064346394104e-01   -3.228545685184755e-01   +3.522834934516930e-01   -1.500929155278196e-01   +4.428809971795106e-02; -5.024678083934678e-01   +4.834826437946818e-01   +1.285668494269262e-01   +1.971722656738438e-01   +3.321991273819940e-01   -1.077047654622409e-01   +1.241050746359642e-01   -1.125664270010774e-01; -3.119298032421548e-01   -7.138965504059668e-02   +4.097365081717441e-01   -5.996415289822529e-02   +2.260837884852116e-01   +6.347974259886632e-01   -4.305282069770505e-01   +7.180920803180569e-01; +5.065690319993079e-01   +2.413945786978116e-01   -1.758532428962399e-01   +9.354366006940742e-01   +1.714698370043903e-02   +4.520391171334922e-01   +3.227407042177463e-01   -4.641727009463319e-01; -6.399396476465004e-01   -1.997616506622955e-01   +4.791000651558340e-01   -1.850791513210655e-02   -2.764679668959024e-01   -2.493460809148317e-01   -1.113891796299393e-01   -1.290505892672298e-01; -4.996890949696005e-01   -6.925660693995475e-01   -2.549072466278902e-01   -1.854364200535920e-01   -6.042781306688371e-02   +7.443056729891724e-01   +2.890775195701171e-01   +2.339638967556943e-01; +3.001042509346349e-02   +6.993977775491721e-01   -3.853835992679251e-01   +1.001904961765042e-01   -3.026770375946520e-01   +4.602518701958123e-02   +7.956072159942554e-01   +4.183696352184616e-03; +6.730868485931461e-02   -4.720033513341992e-01   +2.122429397012145e-02   -1.977432966515549e-01   +2.406395502113117e-01   +1.260212467920175e-01   -4.488438099458686e-01   -3.311464020774805e-01; -7.790383210636638e-01   +9.645917801152487e-02   +1.931057046026730e-01   -5.754683771813951e-01   -4.087079823936127e-01   +5.738872974484743e-01   +1.000000000000000e+00   +1.997559802361828e-01; +3.017456605947506e-01   -2.323158963938748e-01   -1.134872581062853e-01   +2.671796483576642e-01   +5.780413799446832e-02   -3.996221807024066e-01   -4.851673203045379e-02   -6.023276792871651e-02; -6.377601394827397e-01   +2.322245044493324e-01   +2.860490464018167e-01   -6.327177099305524e-01   -1.096538053319004e-01   +2.454366051658312e-01   +2.028699439880235e-01   +1.962755154482292e-01; +7.592923625077104e-01   +4.137812203441687e-02   +9.341197309384720e-01   -2.880989233140845e-01   -6.296776062060330e-01   +8.712415188918236e-02   -1.031797771839273e-01   +4.460614385029861e-01];
L1E_L2E_iAMPA_netcon = [+4.842465764790238e-01   +1.418909087705679e-01   +6.945724904867334e-01   -7.517765396516914e-01   -4.032414877348317e-01   -2.095431246560954e-03   +4.299867488156030e-01   -2.826973881982627e-01   -2.846932925190686e-01   -1.815110172870788e-01   -7.803835251031893e-01   +1.750657436534287e-01   -2.356522669854003e-02   -6.915706991126964e-01   +3.597710615256001e-01   -3.670897092911559e-01; -3.971443282239925e-01   -8.562062799576101e-02   +6.132334330978333e-01   -1.669173975547099e-02   +2.486483363660216e-02   -2.578530625008004e-01   +4.736265312864714e-01   +3.493011157210126e-01   +2.139705614875257e-01   +3.601887037663193e-01   -1.521750320416113e-01   +5.128334909956453e-01   -6.788133786204603e-02   +2.316518647362589e-01   +3.243535451206574e-02   -1.524113793752425e-01; +4.958346494283487e-01   -1.351454365820713e-01   +1.903765742613532e-01   +1.402309748451235e-01   +5.544745100328308e-01   -6.545923493483981e-01   +5.895198230154242e-01   -6.518297337998723e-01   +1.653084314123421e-01   -6.500381907636075e-01   -3.627172082611639e-01   +6.622627746423146e-01   -1.540076983437195e-01   +1.073890557084831e-01   +4.198768905104727e-02   +4.418560233563898e-01; -4.376072485411309e-01   -1.569197540318409e-01   +3.854797481295026e-01   +4.300160251003511e-01   -9.182952433823008e-02   +5.765731289200888e-01   -1.851225114133841e-01   +2.576811930424896e-01   -2.692134240217123e-01   +5.593807643506159e-02   -1.975004728586709e-01   +4.607898441202481e-01   +7.537589113722143e-01   +2.838768164193058e-01   +9.234997654919362e-01   +5.337619532959110e-01; +2.073898191245368e-01   +2.110984889753919e-01   -3.073565952794342e-01   +3.588950542236974e-01   -2.198071363870375e-01   +4.597490829317515e-01   -4.230374464367440e-01   +8.479695915945260e-02   +2.767267063764158e-01   +5.501158579456864e-01   +5.698404599386966e-01   -5.934648294697217e-01   -2.154446880531862e-01   +2.908586985163530e-01   -5.669074909227913e-02   -8.847816842280107e-02; -5.757449697186904e-01   +1.902722634237713e-01   +1.705927700619224e-01   -2.199313441603506e-01   +8.620466299870642e-02   +4.057769305304081e-01   +3.496077151249612e-01   +2.179426616786844e-02   -3.889477249593203e-01   -3.190446236691241e-01   -6.519978777375086e-01   -5.437598793362719e-01   +1.749058692550087e-02   -5.960280067877854e-02   +5.634177258035219e-01   +3.175321554961132e-01; -1.378392048953918e-01   -4.045172735030154e-01   -1.245161549829386e-02   +4.528506847354318e-02   +3.601102897200922e-02   -1.955823254097484e-01   -4.313421375212763e-01   -3.629690990240270e-01   +8.999360531018985e-02   +1.646470165488088e-01   -5.241657296919203e-02   +3.535735779854126e-02   -2.911874430464096e-01   -5.388238329824999e-01   -3.561785640932920e-01   -4.215814497064785e-01; -3.897551957738443e-01   +1.000000000000000e+00   +2.844625294403222e-01   -6.644406677446153e-01   +4.983937105850275e-01   -5.483112772852427e-02   +8.978339904952709e-01   -1.292081636457295e-01   -5.487094357309016e-01   +4.182521459571783e-02   +6.156112934652810e-01   +1.707059047078298e-01   -3.524383447248458e-01   -3.273178149847855e-01   +2.336207508465213e-01   +1.393420957028589e-01];
L2I_L2E_iAMPA_netcon = [+2.944460403389829e-01   -2.791515659301471e-01   -2.144843576322457e-01   +1.064763099471256e-01   +3.201427032640158e-01   -3.110195807639828e-01   -3.615755756234174e-01   +9.894019346006311e-02; -1.537282240864402e-01   -6.330439793404891e-02   -5.315257472750651e-02   -4.493675535269417e-01   -5.132918133358083e-01   -4.764822617537430e-01   +3.042996962305271e-01   -2.259043708306164e-01; -4.785072014778440e-01   -1.900608796728212e-01   -5.791669745779366e-01   -3.863236696613268e-01   +2.974652677795505e-01   +1.227788790801030e-01   -1.357329630129242e-02   -2.814311377225260e-01; -1.411293269603851e-01   -4.999594135800640e-01   +6.991432676405583e-01   -2.806663030679123e-01   +4.752518198687792e-01   -4.275867553473974e-01   -3.846034023086899e-01   -1.142218750306992e-01; +8.795108610663430e-01   -1.331534294900497e-01   -5.801979886025377e-01   +5.429764748843295e-01   -3.789756731708465e-01   -1.529341319896358e-01   -2.609220049611323e-01   -7.079603871256979e-01; +8.315622889297598e-01   -1.232674000229124e-01   -1.725011289352633e-01   -1.719238851938631e-01   -2.963201627729347e-01   +2.567712740236769e-01   -2.001457742073604e-01   +2.400527856834981e-01; +5.781420150689330e-01   -4.943681406741181e-01   -8.583546312892327e-01   +2.123891691747726e-01   +1.698532316676964e-01   +1.529297423121045e-01   -1.361890203621072e-01   +1.792605446327087e-01; -1.297420398497936e-01   -2.928912269251523e-01   -5.440524752449384e-01   +4.570583692116346e-01   +1.023553858172783e-01   +2.038266202023268e-01   +2.736820005146585e-01   +1.565370989000262e-02];
L2E_L2I_iGABA_netcon = [-1.589737362448908e-01   +3.486273299626907e-01   +5.400047599114182e-01   -2.343484123831242e-01   +9.202121934362171e-01   +5.356458283680355e-01   +5.353193343913487e-01   -3.436182014471996e-01; +2.736385328463205e-01   +1.072013637041060e-01   +1.764304346623097e-02   +7.259499033707798e-01   -4.178021016406361e-01   +1.039356264980723e-01   -4.265767849720515e-01   +1.830224998577978e-01; -1.088632632977990e-01   -2.615862584390485e-01   +7.966370864159317e-02   -8.409589389440155e-01   +8.277645145330209e-01   +6.929624391048662e-01   -8.300471547864605e-01   -1.926942556947929e-01; +2.652667816739860e-01   +1.759429108753984e-01   +1.169421932706680e-01   -7.580685566328349e-01   +2.235169804072462e-02   -2.476747502721793e-01   -1.804200583857865e-01   -2.558481768153134e-01; -2.240176765293541e-01   -1.400579006623613e-01   +4.800907033376176e-01   +3.893322347143273e-01   -8.386935011757901e-01   +3.578611257233695e-01   -7.393339785799141e-01   -2.878046095752270e-01; +1.606396049787216e-01   +2.127316370592965e-01   +1.722671558131260e-01   -4.130445541235614e-01   +4.920447320645602e-02   +6.341755084562617e-02   -1.828693638966919e-01   -5.821198651748042e-01; -1.583047994645014e-01   -2.340607054372446e-01   +5.953702685101196e-01   -3.511337840208000e-01   -4.966180971402016e-01   +4.980931169524180e-01   +2.031605986467029e-01   -4.480995124993276e-02; +1.216740901383968e-01   +6.512318866381144e-01   -3.814577129479329e-01   -5.211617878572339e-01   +2.799751798210764e-01   -2.363321423870197e-01   -3.804593143581776e-01   -8.060043273175781e-01];
L3E_L2E_iAMPA_netcon = [+5.876643482959466e-01   +5.721142907542134e-01   -2.734478448399252e-01   +8.525617970979771e-01   +1.289644473547864e-01   +5.466133395286874e-01   -4.998751748142835e-01   +1.549308156029392e-02   -6.052247291843666e-01   +5.173856220656393e-01   -5.459376083943142e-01   +1.581948849247802e-01; -1.733470211930354e-01   -3.340959342882604e-01   -4.077904132498861e-01   +8.730542079131313e-02   -5.098376484963482e-01   +5.798411231264915e-02   -7.866224656295341e-02   -4.127782474928696e-01   +4.863459631793844e-01   -4.830254373358272e-01   +6.059425788044317e-01   -2.313261516314206e-01; -1.784376803864623e-01   +1.082209018913095e-01   -5.258117052513330e-01   -6.029088795479705e-01   +5.775188041210187e-01   +5.518217655458558e-02   +1.653229908601720e-01   +4.877887618532501e-01   -1.793342875406422e-01   -6.147298320407530e-01   +6.154100202153873e-01   -9.284734469231148e-02; +1.017593034907389e-01   +7.022901851673587e-02   +2.238029117471972e-01   +5.196078760869342e-01   +1.450036248755047e-01   +6.041553271711776e-02   -1.976290082874202e-01   -9.042156364220408e-02   +1.550249763606065e-01   +2.323915478692740e-01   -5.254819752839984e-01   +2.993701807633698e-01; -7.434778490144271e-02   -4.416128279965508e-01   -4.533035201360485e-02   +2.441715686879196e-01   +2.606008177634371e-01   +4.727957576274985e-01   +6.125860121552126e-01   +2.762367594582889e-01   -1.979135012359366e-02   -2.522980712111945e-01   +7.882732683576352e-02   -3.445436141502011e-01; +2.295467568215335e-01   +2.473813017783905e-01   +3.542176840354986e-01   -3.486089446574631e-01   -1.783115017419618e-01   -4.476020508862886e-01   +5.118638571096361e-01   +2.047162666861225e-01   -7.331028253280446e-01   +3.571644137231128e-01   +1.049744993944202e-02   -2.712501456639657e-01; +3.090967613510933e-01   +4.534385961911719e-01   +1.472249889264708e-01   -1.399236091879500e-01   +1.088777765982539e-01   +1.770468793048078e-01   -4.946303891102067e-01   +1.796724341055860e-01   -4.022758194753538e-01   +1.000000000000000e+00   +2.060197282469988e-04   -5.289883031304524e-01; +1.884248185801708e-01   +6.793155346524378e-02   -2.906114135616967e-02   +2.310521865800613e-02   +2.299348298367866e-01   +6.389452780739012e-01   +2.263476701911217e-02   -1.741283604392810e-01   +7.514107128288616e-01   +6.763662030015650e-01   -1.460638671287465e-01   -3.854497716725971e-01];
L3I_L2I_iGABA_netcon = [-3.777834502786351e-01   -5.069802534101994e-01   -2.953553200549675e-01   +7.750499600618126e-02   -3.861656791056580e-01   -2.373048361052223e-01   -8.144000021102158e-01   -5.813090195100620e-01   -1.667102540643370e-01   -3.150906333068820e-01   +2.627296159125397e-01   +4.938236252845613e-01; -3.956114207222961e-01   +1.585627862382569e-01   -8.410265254916761e-02   +5.345350308057688e-01   +3.303528323580984e-02   +2.846732436935097e-01   -1.389350186635761e-02   -2.569293630031996e-01   +5.905778122426595e-02   -7.318266248406096e-01   -6.508270034058513e-01   -3.896811065482600e-01; -6.648191851794959e-01   -6.734973116480425e-01   +8.469578805236465e-01   -2.933105620423561e-01   -2.720905085739151e-01   -4.480387994965619e-01   +8.231820271312633e-02   -2.120674037856113e-01   +3.152303891880047e-01   -4.868262522094904e-01   -1.100571920500255e-01   -4.263771010946724e-01; +1.150368116827038e-01   +6.272919929093214e-01   -8.594037905014524e-01   +1.000000000000000e+00   -2.383478220358266e-01   -7.009808278964996e-02   +6.570207931147093e-01   -3.737154677428292e-01   -2.017922862023175e-02   +3.698340267123976e-01   -2.471348947905433e-01   -8.937779283537078e-01; +9.028722430429723e-02   +3.941391680578738e-01   -2.383255800232938e-01   -8.812076182046361e-02   -9.734880375065801e-01   +7.033685637889801e-01   -4.963596383119538e-01   +2.119040007030825e-01   -1.193699097344951e-01   -3.016663078503950e-02   -3.916299166898344e-01   +2.783689354369785e-01; +1.403100609048040e-01   +2.996131972647263e-01   +6.080850661372758e-01   +3.751191543179465e-01   -1.778985857447130e-01   -1.486379716887194e-01   +7.537267359699643e-02   -6.227489891508471e-01   -4.937048242638693e-01   -2.686827727025823e-01   +2.195975301847263e-01   -1.895102425078932e-02; +2.889599315074207e-01   +8.717458758292975e-01   +3.720399048747162e-01   +6.308038502621368e-01   -6.040514495793913e-01   +5.837245983365092e-01   +3.355713676618292e-01   +1.473380402103204e-01   -7.028211163939396e-02   -1.777169964295972e-01   +2.861627330003324e-01   +6.616772998972840e-01; +1.704195650815623e-01   -1.370913587958446e-01   -1.336868401883296e-01   +8.294402187926709e-01   -1.639456414215354e-01   -1.799197179545478e-01   -1.330532642426797e-01   -4.515224040335343e-01   -3.475439161259470e-01   -3.194687945943402e-01   -3.171217504244778e-01   -6.569401778891512e-01];
L2E_L3E_iAMPA_netcon = [-6.563205805568466e-01   +1.356933410417050e-01   -1.608846837994444e-01   +6.476869245992815e-01   +7.497439418233809e-01   +1.501721346444057e-01   -5.238377518099978e-01   +1.936119607810853e-01; -2.328589458728323e-02   +7.140821244281012e-01   +8.755446015293952e-02   -4.628681515502028e-01   -1.323442764055512e-01   +3.758161377575035e-01   -2.150137121842357e-01   +7.349410839947429e-01; +3.482154198396340e-01   -9.409672262141259e-01   -4.236861333787879e-01   -3.981160140415315e-01   -2.069657827759918e-01   +3.144891927601828e-01   +3.151765693805542e-01   -2.469848958966728e-01; +1.912307853052360e-01   +1.650630253793958e-01   -4.918562192652107e-01   +6.751787932448354e-01   +8.287169764634117e-02   -1.298931995388081e-02   +1.998229315622231e-01   -3.211430481485827e-01; +9.322963626811851e-01   +2.999930015250338e-01   -2.951384245207384e-01   -5.136625709857695e-01   -2.316346896934954e-01   +2.474495429366042e-01   +9.471177555556998e-02   -7.768827800390635e-01; +1.168357578849799e-01   +8.627988292871841e-02   +3.869986795502728e-01   +4.200275671996599e-01   -7.503354232384155e-01   -8.083913206334306e-02   +2.615180975758354e-01   +3.142465620287454e-01; -9.528802869410652e-02   -4.284443803831513e-01   -1.040403809116014e-02   -6.172607238169647e-02   +6.557687696747874e-01   +1.622745167178590e-01   +4.600759207288737e-01   +9.833164268053232e-02; -1.816257131866339e-02   +3.833294433048917e-03   +8.029959025108736e-02   +1.898514723755411e-01   +3.451234087631440e-01   -8.707682036309156e-02   -4.876831216900099e-02   -5.706117547255812e-01; +1.349478129288310e-01   +7.881696019595437e-01   +2.640550197871061e-02   +5.258218233716728e-01   +2.503005454298705e-01   -4.705776746288697e-01   -2.269491827725189e-01   +7.037659258508769e-01; -3.421772265522229e-01   -1.194594271232336e-01   -1.109602625645184e-02   +6.146098464380884e-01   +3.023817275451612e-02   +8.065949525930127e-02   +1.078983889459858e-01   +4.957712478260881e-02; +4.380028860122742e-02   -1.725245505770203e-01   -2.322931746647283e-01   +4.943688490073248e-01   +4.497728866407352e-01   -2.933166131595146e-01   +3.773110584301813e-01   -2.589170098925916e-01; -1.443802192368331e-01   +2.822424391157599e-01   -6.242148683455295e-01   -1.602309304656128e-01   -8.142316337184149e-02   +3.512377959639297e-01   +5.290642194806289e-01   +3.838242128546288e-01];
L2I_L3I_iGABA_netcon = [-4.360122415042584e-01   -1.609360784482182e-01   -3.412502828754376e-01   -3.799752072172469e-01   -5.595115366660539e-01   +1.579361884963727e-01   -7.672725770216459e-01   +1.468499464159086e-01; +2.553903046194264e-01   -9.910767997996395e-02   +3.105592945390836e-01   +1.868810327533821e-01   +3.584792997985745e-01   +2.534284463487982e-02   -5.721304332976008e-01   -9.651379873464483e-03; +4.155458118491909e-01   +1.219351001937612e-01   -1.797048538646234e-01   +4.975169872476813e-02   +2.079460171375151e-01   +4.460248156211540e-01   +2.173262022686469e-01   -3.743944052011645e-01; -4.566986925638078e-01   -2.229312773619861e-01   +1.116905011963231e-01   -4.930805676878484e-01   -5.520659245177385e-02   -6.048339343173395e-01   +3.719273205387086e-01   +2.602913268320140e-01; -2.999246365200994e-01   -2.816026126881267e-01   -4.833302859593164e-01   +2.120170109979052e-01   +4.510475622649100e-01   +1.368994926412239e-01   +3.643505194303903e-01   -6.890004104132992e-01; +2.167470265682313e-01   -3.329060620754984e-01   +8.019908618446233e-01   +5.040699200282917e-02   +1.467826219973138e-01   +7.431149139688031e-02   +5.423499962649764e-02   +6.294758492268346e-02; -2.335072931873378e-02   +1.976645660536863e-01   -5.698792450271986e-01   -8.998498702362231e-01   +6.693911452256768e-02   -3.803908381469698e-01   -4.031017546472383e-01   +2.825004132307191e-01; -5.127483213401436e-01   +1.260891808206311e-01   -5.962966928794342e-01   -5.637883527724041e-03   -2.579711175735356e-01   +1.680862061525250e-01   +4.120963222595772e-01   +6.566569976401169e-01; -5.883357566215652e-01   +5.275798275031560e-02   +2.193571064381865e-01   -2.678977999294592e-01   -8.840320596445014e-02   +4.761589396077019e-01   +2.593646310349359e-01   -7.692662521456355e-01; -2.894076898656476e-01   -1.450045776262049e-01   -3.974776446402465e-01   -1.077439185444232e-01   -1.055423412255728e-01   +3.537420547241507e-01   +8.811071365313257e-01   +2.399358077841496e-01; +2.930662389128400e-01   -7.892233351668614e-01   +1.189997654016471e-01   +8.156986126681177e-01   -7.457276755950382e-02   +1.352285637453610e-01   +3.204995970628411e-01   -1.692864617290359e-01; -8.660909299300101e-01   -2.859304556937760e-01   +8.598409434300740e-01   -7.478709889902938e-02   -4.897519791324204e-03   -7.708595195261815e-01   +2.166277517374379e-01   -3.835624559299677e-01];
L3I_L3E_iAMPA_netcon = [-1.203485255846022e-01   -1.516975956013035e-01   +5.056064240854306e-01   -5.922246572358802e-02   -1.488286625764537e-01   -1.020619015103222e-01   -4.385189072959063e-01   +1.000000000000000e+00   +4.155602422683358e-01   -3.427518977476731e-03   -1.696530472827819e-01   +9.594760078093872e-01; -4.630049524270110e-01   +6.123982155072270e-02   -6.288925814567743e-02   +3.680251097512975e-01   +2.601539911259501e-01   +3.522002556927261e-01   +3.631349514703974e-01   +5.456159391903578e-02   -7.563430808520616e-01   -2.343620530468675e-01   -7.635511761563629e-01   -8.159269919071349e-02; +7.390858760324046e-01   -4.591881463895039e-01   +6.688187069519269e-01   -2.161701685045414e-01   -3.408464855606112e-01   +4.082966960056413e-02   +2.214628723368140e-01   +7.533265564980095e-01   +1.334377963376952e-01   -3.934893370972959e-01   -4.176501266842299e-01   +3.066742910090174e-01; -2.784842415439731e-01   -3.051060563279522e-01   -2.587988866519390e-02   +4.244188230910589e-02   +1.779370097717403e-01   +2.541700149472965e-01   +2.616531079167995e-01   -7.699262455286144e-01   -2.776106462463238e-02   -5.104697829713986e-01   -1.404830613283445e-01   +4.667389523449709e-01; +4.009279675789801e-01   +1.485050866642221e-01   -6.700231569657183e-01   +3.414529904214851e-01   -2.883579663216881e-01   -7.550479830360252e-01   -6.147595462982441e-01   +2.405403924057067e-01   +3.232198143323495e-01   -6.992906079227582e-01   +1.899432620728457e-02   +2.150944511757100e-01; -5.139010217786320e-01   -7.827573314794050e-01   -4.629023857198555e-01   -4.885349522941835e-01   +9.321526285017447e-02   +3.972757910303168e-01   +4.529457107343166e-01   +1.668208051428359e-01   -7.506566920643827e-01   +5.037907822562725e-01   -4.157973995303543e-01   +4.959365791827291e-02; +1.030215288853704e-01   -4.645865264530261e-01   +1.830307147782066e-01   +9.299367426056233e-03   +5.520851868614920e-01   -7.936066337049164e-02   -8.655515515502596e-01   +1.200721926806787e-01   -5.446492360255136e-01   -4.680656136463775e-02   +8.591521701347041e-02   -4.644780635824903e-01; +1.297624702033746e-02   +1.317552403089193e-01   -1.589873925396541e-01   -5.503349276762730e-01   -2.951004306289128e-01   +5.803916871583454e-02   -7.058181090744083e-01   -5.754799493358628e-01   -2.379532946744098e-01   -3.744687765868044e-01   +2.445642499163454e-01   -8.153070924139015e-01; -1.734348177742298e-01   -7.015539314027146e-01   +1.165542050240613e-01   -4.159978164899333e-01   +3.340295315414716e-01   -4.809081093810006e-01   +3.662301589897435e-01   -4.678921522778405e-01   +6.137680243256171e-01   -5.263581947017372e-02   +6.742417255364895e-02   +8.187386775183219e-01; +2.486948367940957e-01   -5.767421192150153e-01   +6.070054758691377e-01   +1.816894298161908e-01   +3.660072465862972e-01   +5.044960747578305e-03   -7.517669214401241e-01   +1.193379705473328e-01   -4.018261937998147e-01   -6.905395762810896e-01   -3.899577322127478e-01   +1.546176007035685e-02; +3.498598381471636e-01   -3.691502867714033e-01   +1.302747504685269e-01   +5.636745171048182e-01   -5.541487741778489e-01   +3.805676558824114e-01   -5.343477346003686e-01   +4.341669026475960e-01   +6.394700365610234e-01   +6.286457438936629e-01   +2.147421238852088e-02   +8.687146392083395e-02; -3.966549381109650e-01   -3.022961986053949e-01   +1.648222379011075e-01   +5.221128229761676e-01   +1.999590098234718e-02   -2.854665491125700e-01   +2.079606126390887e-01   +2.343481294253633e-01   +4.637158544206587e-02   +7.911769750139148e-01   +9.833754815749145e-02   +5.217570608085934e-01];
L3E_L3I_iGABA_netcon = [-6.281763291014205e-01   -3.114091132133517e-01   -3.915940953687503e-01   +3.460965422981968e-01   +5.942848927920037e-01   +4.732529205725101e-01   +2.590061984793902e-01   -3.270452041109467e-01   +3.511997671801942e-01   +1.391249265068895e-01   -5.428600479516266e-02   -2.093187490014104e-01; +2.920319879028804e-03   -9.049899226204804e-01   -1.976834251997794e-01   -5.956247322175886e-01   +2.643484792889427e-01   +3.800124324454077e-02   -3.209960056722122e-02   -5.447769856091610e-01   +2.636533323464070e-01   -4.768420844153102e-02   -3.382315681153398e-01   +1.214626558339781e-01; +1.147216042096282e-01   +3.872562506995309e-01   -2.931702512436239e-01   +1.678304160507802e-01   -9.835494507151125e-02   -1.871636115920624e-01   +4.504948292055461e-01   -1.488144753346775e-01   +3.188737682135266e-01   -4.997775319871356e-01   +1.506630438901543e-01   -6.620880576882739e-01; -5.160795208448198e-01   -7.180425282961089e-01   -1.421164515439373e-01   +2.750361331023376e-01   +5.954282175167843e-01   +3.904112766416316e-01   +3.162794509106280e-01   +5.011319484054888e-03   -9.613925190396320e-02   -5.697653602615562e-01   +3.139525605687482e-01   +5.100394032662271e-01; +7.679862897048413e-01   -7.633967845858021e-01   -3.634144640315711e-01   -4.440125801591735e-01   -1.477175782449858e-01   -3.983385702854392e-01   -1.630301609329436e-01   -4.964439140025004e-01   -2.066327295790802e-01   +3.266886027101198e-01   -5.967967187742994e-01   +5.099982181287407e-01; -4.177326018915704e-01   -3.384239959403968e-01   -2.180066474125231e-01   -1.291371871808744e-01   -3.260718525981542e-01   -6.142683532956134e-02   -3.618703667669167e-01   -5.564137292469409e-01   +8.900618553726857e-01   -3.856973942701264e-01   -2.720656621451021e-02   +2.232078405249838e-01; -8.380386615105668e-01   -5.070055790815471e-01   +5.481438781526268e-01   +4.108995402858380e-01   +3.547303009428386e-01   +5.260382689985618e-01   -6.120722452377230e-01   +1.721974099116113e-01   +3.537360076903607e-01   +2.346136136304014e-01   +7.189445458018914e-01   -6.453585716390733e-01; +9.025365237654640e-01   +1.706090315418662e-01   +2.688423717404083e-01   -1.000000000000000e+00   +1.350921968427422e-01   +5.622438994553967e-01   -3.457074066297380e-01   +3.786164433972090e-02   -9.327999292489958e-03   +2.012220781563338e-02   -4.809549954950528e-01   -8.084080238023075e-01; -5.524348443652058e-02   +9.583599846391292e-01   -1.644865555110336e-01   -9.178790658282765e-02   +9.468033635423567e-02   +3.240389613722032e-01   -2.850081859321148e-01   +6.694057097479629e-01   +2.476898209937070e-01   -3.721312788317697e-01   -2.689559231004390e-01   +7.025209613544497e-02; -4.346453093423355e-01   -5.618302234688199e-01   -1.315023621519880e-01   +9.308425981865352e-02   +3.364088124459475e-01   +2.278218566253013e-01   -5.295807965058719e-01   -3.342424619797844e-01   +4.842399777218419e-01   -2.528016061013462e-01   -8.446219888338077e-01   -5.496948661609777e-01; -7.046533289555408e-02   -1.309119517015536e-01   -7.846465201920376e-02   +8.944207381922201e-01   +5.797072720077143e-02   -5.643737719722013e-02   -1.882415157227152e-01   +3.900207411961763e-02   -8.316388819390298e-01   +6.550290860348478e-01   -2.278878209162679e-01   +3.251141100225670e-01; -9.187717226134849e-01   +2.226707474868681e-01   -9.703467833532775e-01   -4.059990421987006e-01   -8.876218227421113e-02   -2.405545524717173e-01   -3.126278929484195e-02   -7.481150888666316e-01   +9.161278368336070e-02   +4.345932553719100e-01   +3.091989421175180e-01   +7.092282131869255e-01];
L2E_Input1_iAMPA_netcon = [-3.284250220223365e-01   +5.806466264349604e-03   -2.880674234452464e-01   +1.000000000000000e+00   +8.613803690285836e-02   +2.153406440690762e-01   -8.683235691754376e-02   +6.458031700645722e-01];
L2I_Input2_iAMPA_netcon = [+1.152036068473414e-01   -4.343780139854661e-02   +4.661758716465810e-01   -1.130119762456450e-01   +1.588049806284800e-02   +9.909096844658256e-01   +6.063050338987356e-01   -6.940724126647079e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
