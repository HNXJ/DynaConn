function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.417307406299646e-01   -2.644835342220975e-01   +8.636829494454427e-02   -5.407367626718083e-02   +1.065886262778678e-02   -7.627785832461485e-02   -1.535616630501607e-01   -1.259626218443221e-01   -3.166398527658292e-01   +8.566717245449244e-02   -1.845925423621845e-01   +1.334029536111549e-01   +1.701165952028625e-01   -1.467048419015675e-01   +8.393714519555658e-02   -4.148913652112124e-01; +1.336919784150660e-01   -8.039848114588827e-02   +1.792341974312307e-01   -8.172185319569202e-02   +5.427155236800735e-02   -4.256038619043512e-02   +2.316946482173365e-01   +1.051864049032793e-01   +1.293321989942979e-01   -1.477390559268021e-01   -4.350734670073410e-02   -1.959280304115059e-01   +5.438125648506745e-02   -8.500047573624561e-02   +2.623586519523387e-01   +3.657764056172983e-01; +1.413528345931533e-02   +2.225012976970138e-02   -2.716318635727955e-02   +1.339201123960408e-01   -5.724690396105842e-02   +1.606640633470127e-01   +1.108187802872397e-01   +1.424761202407798e-01   -2.920742059023695e-02   -2.373955225785138e-01   -1.562982432605693e-01   -9.306677332574619e-02   -3.041151026827159e-01   +1.278771586643820e-01   +1.294501989129005e-01   -2.037233222794324e-02; -2.837675024704775e-01   +1.564255933229312e-01   +2.777513667118504e-01   -1.263629073332797e-01   -3.738981831586621e-03   -2.750332745807793e-02   +2.741426571841154e-01   +1.752079628852001e-01   +3.866458831906187e-02   +1.563599087589796e-01   -1.382202552736462e-01   -7.413121863018782e-02   -1.208471262656842e-02   +3.880754599175595e-01   +1.794302350042884e-01   +9.263397241597743e-02; -1.095471270179539e-01   -1.539354212735692e-01   +7.270333408794288e-02   +3.372864474343090e-01   +3.886826312224703e-02   +2.026431736595373e-01   -4.298629420657846e-02   +1.162191897342789e-01   -6.816104937578019e-03   -6.224129523609712e-02   -9.440671791437498e-02   +1.968060461630782e-01   +1.132910463293095e-02   +1.653316504502693e-01   +9.910692305853920e-02   +1.371787440217749e-02; -9.892947487107073e-02   +1.375474948058523e-01   -3.293318452229693e-01   -1.399987904080381e-01   -9.019137988136650e-02   +1.229169962478110e-01   -2.354609666552643e-01   +9.904298983281676e-02   +2.396812909456308e-01   +1.298813641712385e-02   -5.646831757049919e-03   +1.892481306230197e-02   -1.675386142327305e-01   +1.724290378400975e-01   +2.199847990258031e-01   +2.085251714449858e-01; -1.966512567806801e-01   +3.867581572478870e-02   +8.508352267364477e-02   -7.221199013069290e-03   +5.489145100541826e-02   -1.955614074765518e-02   -3.367950200866512e-02   +4.365206703047306e-03   -2.579373911402385e-01   -1.206534991193209e-01   -5.643864516931463e-02   +2.158582863230869e-02   +2.755394505409686e-01   +2.438700878436785e-02   -7.248205665725448e-03   -2.003187485013460e-01; -1.510228834731487e-01   -4.914518483258037e-02   -6.156329892438454e-02   +1.916230689386831e-01   -1.136045668149766e-01   +2.408511548070276e-02   +2.296283965314399e-01   +1.162619957808496e-04   +1.066542870817984e-01   -1.982983953786607e-01   -1.995399444360846e-01   +4.638205699415148e-01   +1.860215684765517e-01   -4.304858751725048e-02   -1.921710626813161e-01   +3.499177051756269e-01; -9.317457051530625e-02   +1.619019817642113e-01   +1.260517361218763e-02   +1.331876981573243e-01   +1.487641031041803e-01   -2.861956712319347e-02   -2.095855155662659e-01   +1.722983552109967e-01   -6.808449349768387e-03   -1.947332419900367e-01   -1.377423847049623e-01   -3.291780226296095e-01   +9.933767510164183e-02   +3.726265869961203e-02   +1.613182094330359e-02   -2.281018052681175e-01; -1.762635797077541e-01   -1.919801711609384e-01   +9.421785625851667e-02   +4.894783507439528e-04   -2.006819978470486e-01   -1.540962422679364e-01   -1.540903041871330e-01   -3.089178466108498e-01   +8.385313120757304e-02   -2.448584640152294e-01   +2.424840429972085e-01   -3.543382081196416e-01   +4.037027734351358e-01   +2.790009080343764e-01   -3.214686309764355e-01   -7.522364266814219e-02; -8.796039205765160e-02   +7.868605258651042e-02   -1.549852380145099e-01   -1.306331551972272e-01   +1.154317809821932e-01   -2.738258060140213e-02   +1.221472325608394e-01   +2.267945266454814e-01   -1.754486230710088e-01   +8.806238319660474e-02   +2.873354985210420e-01   -3.739711598874906e-02   +1.620727780129654e-01   -1.713661014313191e-01   +2.709553018188922e-01   +4.283020810198629e-02; +2.351349127336294e-01   +4.817394038292866e-02   -5.011412426062738e-02   -1.898772176759622e-01   -3.201252273556947e-01   -1.397419041531860e-01   -2.611601084285596e-01   -1.796045839568255e-03   +6.996134248150508e-02   -9.296229567865996e-02   -1.463486824407836e-01   -3.447760083825807e-02   +3.907709311171403e-04   -1.102665740895013e-02   +4.016563418629847e-03   +1.174937717293083e-01; +9.544547392785283e-02   -9.984187178051523e-02   +4.674362303473156e-01   -3.297860051166235e-01   -1.088875549562009e-01   +7.589480790025299e-02   +1.535103960101088e-02   -2.443223004881554e-01   -9.289514236730913e-02   -1.893305556133704e-01   -3.599039373720727e-01   +1.777271644924835e-01   -2.377015179188206e-03   -1.392561708530679e-02   +1.074706351098001e-01   +1.234878025901422e-01; +4.671564592358148e-02   -8.128569573089889e-02   -2.147836221206563e-01   -1.939911758058834e-01   +3.690425253834000e-02   -1.290939422288246e-01   +1.250124729042225e-01   +9.175813641884992e-02   +1.028325639851587e-01   -1.147911479986592e-01   +2.497349958885892e-01   +1.814804919088879e-01   -4.483377718662541e-02   -5.516091788741301e-02   -2.636229628962284e-02   -8.679103606614599e-02; +3.096437846835040e-01   -9.200686514362033e-02   -4.349680236535449e-02   -2.411804560912476e-01   +9.457717885142937e-02   -4.941123611148603e-02   +8.457027122646215e-03   +9.626307025485375e-03   -5.236464881452380e-02   +1.599563943738319e-01   +2.416422716159081e-03   -2.101995168632582e-01   -1.598902083612935e-01   +8.272226779507322e-02   -1.324375389138557e-01   +2.421642703601196e-01; +4.294265734452461e-02   +2.701897994920210e-01   +2.205117936526429e-01   -4.164201801806782e-01   +2.533026917709499e-04   +1.709628328687494e-01   +1.182277825326494e-01   -1.710177351167758e-01   -1.414874324236736e-01   +1.630928502150022e-01   -1.025147044853253e-01   -1.549614932688422e-01   -7.667115126631976e-02   -2.056982911177914e-01   -4.172443746792862e-02   +2.167892910715390e-01];
L1E_L1I_iGABA_netcon = [-1.065059816874136e-01   +1.216997527872240e-01   +1.439664660424877e-02   -2.959567652109250e-01   +1.653091390411009e-01   -6.037394242195748e-02   +8.702263651335779e-04   -5.044798821192508e-02   +6.083814964446207e-02   -2.356261154387344e-02   -4.918860108415593e-02   -2.079637899766965e-03   -5.640310444131689e-02   +3.608792983600681e-04   -2.208690000502039e-01   +3.337567638987110e-02; +2.382445296593319e-01   +1.574883755370235e-01   -1.045205851989461e-01   -2.482804500775308e-01   -2.686266657382180e-01   +1.763903085483186e-01   +1.874710789172233e-01   +2.565695167451342e-01   -1.251084712174103e-01   -9.273667273779902e-02   +1.160110571056606e-01   -2.242185517200143e-01   -5.966389396866734e-02   +8.528599756650358e-04   -2.654467432363329e-01   -2.298845683479086e-01; -1.751172388854008e-01   -8.403787953839727e-02   -1.216375583830610e-01   -1.305710351884983e-01   +2.822423254626606e-01   -2.406531720499741e-01   -1.688132022455375e-01   +1.703712515254165e-01   +1.969553549846689e-01   +1.016903460236070e-01   +1.409676873201587e-01   +2.653473954640012e-02   +6.810867744865674e-03   -2.166309651995903e-01   -2.543366459789755e-02   +2.037713914444257e-01; +1.718084911141390e-01   +2.329432294857604e-01   +2.726178212784564e-02   +2.130459969597725e-01   +3.716315808037541e-03   -4.711339029185335e-02   +3.318228259983564e-01   -1.646720364715650e-01   +3.313731439576360e-02   -1.305471590588060e-02   +5.097349365841920e-02   -1.311528860328151e-01   -1.720814668501419e-02   -3.899391929449410e-02   +1.294807863119853e-01   +1.994164606150651e-01; +1.833706650661807e-01   -5.930903639965070e-02   -1.742601479725501e-01   +1.323535341599120e-01   -2.217140781182776e-01   -1.698740589991714e-01   -1.686549592388982e-02   +2.574235072039108e-02   +1.925560261124187e-02   -2.939181543981904e-01   -2.463455005882283e-01   -1.091056432774731e-01   -3.763290084851240e-01   -1.244483148793245e-01   -9.600296818649101e-02   -1.713223143704463e-01; -1.244227949188738e-01   +3.103165657845113e-01   -3.351995481166293e-01   -1.580602993729098e-01   -3.408572314255452e-01   -9.287744583164627e-02   -6.111758630809464e-02   -1.030773778183791e-01   -2.686333932040848e-01   -1.067665158506287e-01   -8.237760959097783e-02   +2.367937467962934e-01   +1.935813767469940e-01   -6.632306939873771e-02   -1.933703830648972e-03   -8.113042138435256e-02; -1.265923174201434e-02   +2.578400593752601e-01   -1.055911233175903e-02   +3.847739950244267e-01   -1.379724347282571e-01   +5.240627587614062e-02   -1.901017041658745e-02   +1.051971895719113e-01   -1.438317244854220e-01   +2.155894365916793e-01   -2.488110941668293e-01   -3.314659437591215e-02   +2.275201902780592e-01   -1.497297124950963e-01   +1.249811018080734e-01   +3.106688007476568e-02; +5.019054997489554e-02   -3.300043022919855e-01   +2.025955207440980e-01   +3.473078119636324e-01   +7.999945004331506e-02   +1.821922587476045e-02   +2.445828681941445e-03   +1.475893728163424e-01   -6.143293326425683e-02   +2.322875059080615e-01   -1.043999676946021e-01   -1.096706411811902e-01   -1.274693214334878e-01   +9.096883162293365e-02   -2.006890799962965e-01   +1.290672024301440e-01; +2.769376566677244e-03   -5.378555261313753e-02   -3.085461700454092e-01   -2.128545558823666e-02   +1.112948084037154e-01   -2.555186901295166e-01   +1.131858944763405e-01   +1.623620813454046e-03   +6.775818857822935e-02   +6.169665701137070e-03   +4.734780605718990e-02   -1.223295980455961e-01   +2.718031038982069e-01   -1.804277794142041e-01   -1.112932140197338e-01   -1.129492806207054e-01; +1.120486042901436e-01   +3.888971256327669e-02   -7.179621953009009e-02   +2.610274317659895e-01   +9.382468190798399e-02   -1.396839608106359e-01   -1.743034814340487e-01   -1.400412651753500e-01   +2.641102378106712e-01   -5.621719158340160e-02   +7.710366471310716e-03   +1.938528470393337e-01   +4.901273248705947e-01   -1.148518517999060e-01   -3.921128062246318e-01   -9.212906383981394e-02; -1.764406251331814e-01   -2.935345819073436e-02   -1.461458335373628e-01   +1.448501651396894e-01   -1.413053243767560e-01   +1.226670105698315e-01   -2.456999195022901e-01   -3.625646810844711e-01   +3.093171362232404e-02   -2.996022035351435e-01   -5.546034445018116e-02   -9.534012667620043e-02   -2.038010782551407e-02   +2.941593365402633e-01   +1.618844534623378e-01   -5.525837417000705e-02; -3.180003039169475e-02   -8.874982837775089e-03   -1.018668597415006e-01   +1.033410071186670e-01   +5.410304135069018e-02   +1.354552307788652e-01   +2.114889934077172e-01   +7.178040469980722e-02   +1.867799934276145e-01   +8.492966564253276e-02   +8.868629404313989e-02   +2.084333223204768e-02   +2.461517186680881e-03   -2.701730333851903e-01   -2.181101519726306e-01   +1.113153954895548e-01; -4.206290749491534e-02   +1.357019181324728e-01   +1.627897674837576e-01   -9.640821581361610e-02   +2.470440311256936e-01   -2.383420804440714e-01   -3.958486286071706e-01   -1.407166184611836e-01   -2.055945437788960e-01   -2.112428492801140e-01   -2.637859202826937e-01   -1.012058700580938e-01   +6.584014147140094e-02   -2.845510643482632e-01   +3.077553097429509e-02   +1.453123695759674e-01; -2.434184488719663e-01   +1.985433773126232e-01   -1.806261693392456e-01   -9.143920146740510e-02   +1.335866821011240e-01   +3.841191399587827e-03   -8.311098093641855e-02   -4.658190356687224e-02   -1.010279051120706e-01   -2.092942068861551e-01   -7.926885408170617e-02   -2.681088107210039e-01   +3.822600332136195e-01   +1.538207592328883e-01   -6.434016169600594e-02   +2.040560594016975e-01; -5.706995080254758e-02   +7.221547075656735e-02   +2.461178299657756e-01   +3.317425133930336e-01   +1.546618739965461e-01   +2.235090353058272e-01   -9.670698869267830e-02   +1.777173292910456e-01   +6.512600155016481e-02   -3.068048911746775e-02   -4.733160614608537e-02   +6.706379325829179e-02   +8.875362082240851e-02   -5.884415918315192e-02   +3.104628631310371e-02   -2.182297365696501e-01; +5.946778494418228e-02   -2.192485326429007e-01   -2.473234789609303e-01   +3.769824865457288e-01   -1.900393637122041e-01   -1.420363673138654e-01   +6.821734671698836e-02   +2.424436109363162e-01   +3.851498228625998e-02   +9.026911298701419e-02   -1.530737320888946e-01   +9.721029986217600e-02   +4.425255316765717e-02   -1.208294766015772e-02   +2.315808974011778e-02   +6.579978437025256e-03];
L2I_L1I_iGABA_netcon = [-5.775200967022483e-02   -2.887435352458101e-01   +1.701119000993280e-01   +1.009688914842933e-01   -1.324053298485354e-01   +2.155219334313310e-01   +8.432324000519771e-03   -3.220346936902112e-01; +5.173681908570862e-02   +1.869928222998377e-01   -1.032825342417331e-02   -1.690016113832756e-01   -2.929903028404036e-01   +2.416138010780381e-01   -7.621465612742678e-02   +1.192853813228287e-01; +1.558508501159057e-01   -1.803881090150820e-01   +9.351252143816159e-02   -1.620845137589711e-03   +1.065258329670372e-01   +1.619576685121640e-01   +1.897808164307766e-01   +2.378055298548575e-01; +4.467521019016284e-03   +3.771047916943405e-01   -1.313012549449269e-01   -5.018569485121506e-03   +1.315720820139317e-01   -1.866260274477363e-02   +6.681445962148554e-02   -1.968710881774790e-01; -9.397066626631058e-02   -3.849345368615791e-02   +1.405151968784223e-01   -2.856651766707265e-03   +1.191965799842948e-01   +2.081114051813441e-01   +1.415600627931029e-02   +4.556877822129812e-02; +1.869373633189126e-01   +2.259176450728771e-02   -5.387534482528399e-02   +1.115782957796643e-01   +6.220573125818470e-03   -1.348306109591271e-01   +7.526101529204196e-02   -6.312894322242794e-02; +2.329904287423106e-01   -1.502088276287648e-01   -1.329223793227750e-02   -4.592789540857694e-02   +2.980357440351140e-02   -4.283517470343131e-01   -2.871364655592628e-01   -1.370147949676242e-01; -1.872345802707742e-01   +1.579981832215472e-01   -9.535436789661914e-02   -6.178027315176450e-02   -1.253507576244495e-01   -2.689237714416954e-01   -2.500271264770955e-02   +9.320092599918689e-02; -2.378390594307106e-02   +5.941440153378919e-02   +1.554464199005423e-01   -8.354760059163442e-02   +1.600415968081623e-03   -1.366420008482581e-01   +3.028733106076956e-01   +2.917486426323749e-01; -1.411552657195431e-01   -2.073262960086746e-01   +1.206789835247144e-01   -1.362776082907834e-01   +4.846067451002269e-02   +4.712834759617183e-02   +2.060974480435912e-01   +6.453943868012432e-02; -1.036803709641651e-01   +1.689730182465040e-01   -1.960242520672124e-01   +1.727368153972841e-04   -1.053309344678933e-01   -1.175392964994835e-01   +9.045853850518946e-02   +1.310439038044415e-01; +2.280755865190679e-01   +2.518598186293450e-01   +1.420303926252193e-01   -8.105602324081029e-02   +1.552999297308534e-01   -2.358491520355792e-02   +3.207414358635035e-01   +1.679477433126031e-01; -2.413661829853709e-01   -1.566682201148108e-01   +1.897450012198786e-01   -2.676429841602428e-01   -1.226405957734125e-01   +1.549602032077286e-01   +9.741121459582688e-02   +1.078167634622434e-02; -6.270937400197762e-02   -3.005366921279277e-01   -4.411675216671881e-02   +2.741656082831042e-01   +5.772519017649333e-02   -1.985306707863073e-01   -2.116994589363276e-01   +2.719819518875333e-01; -2.343568854011620e-01   +1.057413374999646e-01   +2.260414874305397e-01   -8.861454116175721e-02   +2.625881296702217e-01   +1.537285220263382e-01   +3.784153663694711e-01   -1.154493950687348e-03; +3.062027840552168e-01   -8.131254464651082e-02   +1.985891747137505e-01   +4.511234782581959e-02   +2.140352336337275e-01   -1.461688649836697e-01   +3.445733715823158e-01   +6.359249188044074e-02];
L1I_L2I_iGABA_netcon = [+9.516813987437650e-02   -9.553084168043526e-02   -2.144923393440124e-01   +2.107902047437282e-03   +4.589664337928875e-02   +2.440470926286961e-01   -5.496093491468557e-02   +2.939307939058144e-01   -2.495038698531440e-01   -7.594792852065445e-02   +1.355361965726065e-01   +2.364058022526468e-02   +1.639731422843131e-01   +1.880189250043509e-01   -7.595200096723324e-02   -8.689110789252269e-02; -2.257459698746830e-01   +1.386223659645654e-01   +1.309777842515439e-01   -8.289256412492221e-02   +4.961347632958461e-02   -3.074710947098022e-01   -6.290174301710719e-02   -4.537822100843503e-01   -1.032211974301252e-01   -4.426649095940980e-01   +2.351664716781075e-02   +1.459819453162788e-01   +7.942694356299832e-03   -6.549286858477332e-02   -3.059820631730396e-02   +1.244465145861179e-01; -3.080556100856980e-01   +7.340726467671087e-02   -1.725422901486604e-01   +4.090880028609763e-02   +1.040063558875910e-01   +1.436953936687038e-01   +8.534898936778775e-03   -7.750936183892954e-02   -1.634587149569384e-01   -6.135657693573269e-02   -1.428883850867238e-01   -5.287237889055473e-03   +1.696920681449852e-02   -2.461155799827090e-01   +1.993680071737715e-01   -2.699709653745030e-01; +3.569553953116990e-01   -5.565264938373984e-02   +1.852993732599892e-01   -1.521611438952117e-01   -1.574364732629030e-02   -3.478860753714269e-01   -1.462553102746603e-01   +2.256601920484742e-02   +5.709855287441334e-03   +5.468727378745292e-04   +2.490702468533849e-01   +1.669478771211670e-01   +3.844384064998965e-02   -1.336324773607093e-01   +2.053175811095275e-01   +1.813376856729009e-01; +2.301227487971844e-01   -7.890278369837705e-02   +3.975071978343638e-01   +2.842951323008876e-02   +1.163841987199982e-01   +5.752721302402196e-04   +1.896873116485367e-01   +3.615734199039235e-01   +1.187241123283620e-01   +1.784436134334688e-01   -9.703036919572661e-02   +1.610951770672919e-01   +2.392258638889571e-01   +1.610933963241917e-01   -1.599430577234470e-02   +1.743923146596794e-01; +1.890466093519137e-01   -1.152307358902921e-01   -4.585059423324928e-02   -8.245654313828454e-03   +6.854709353508802e-02   +1.734658356540019e-01   +1.789895234678343e-01   -4.554711890512545e-02   -9.797418627224561e-02   +2.019623644586008e-01   -3.068578038997333e-01   +9.294679289199291e-02   +1.625459811863668e-01   -3.610304228396337e-01   -1.322414591772056e-01   +9.730722724941190e-02; +8.321776815777213e-02   -1.040449240447452e-01   +2.231134502211353e-01   -2.517198385072478e-01   -6.617608256370225e-02   -1.582641471686980e-02   -1.882921804204455e-01   -9.433674688845900e-02   +2.088333789256826e-02   +5.603815541191182e-02   +1.404559426059851e-01   -1.312079460545567e-01   -1.250428655436264e-01   -8.219220095451757e-03   -1.577061963499986e-03   +1.861853448859708e-01; -3.022915953572387e-01   +7.857525069286443e-02   +3.471390339365097e-01   -1.658251575835964e-01   -5.044540986971729e-02   -2.936935749627432e-02   -6.661605388269835e-02   +1.682929264703236e-01   +1.649205243630256e-01   -1.586485041826486e-01   -1.886668983799203e-01   -8.071175628692097e-02   -1.769774018530367e-01   -3.251952964482394e-01   -1.281627294178567e-03   -2.800019379875920e-01];
L2E_L1E_iAMPA_netcon = [+2.143180169270730e-01   -5.444618809653818e-02   +8.982209593590967e-02   +4.734553203104935e-02   +1.127114277402811e-01   +2.684252369499197e-01   -1.209269417426086e-01   -1.805746354272976e-01; +1.949863095552161e-02   -7.060439145126463e-02   +1.086969524852493e-02   +2.534700196524944e-01   -8.957548996217565e-02   +2.586075685156623e-02   -9.706605925730385e-02   +1.422780105218047e-01; +1.970187036209595e-01   +4.208046223690527e-02   -6.088987803274582e-02   +1.800231336386292e-01   -2.874843522515582e-02   -2.293464902652630e-01   +9.119912039737843e-02   +2.278855102994473e-02; -1.327207006460142e-01   -1.829585021049956e-01   -1.103847745703103e-01   +4.078261661637291e-02   +3.200845580897272e-03   +4.706453017328310e-02   +1.704735118912624e-01   -6.014834835879486e-02; -3.613930634453430e-02   +7.742172573669755e-02   +6.472543984049305e-04   -1.283075208863056e-01   +4.186088049522452e-02   +4.228647803766978e-01   +1.423079813116874e-01   -3.360140285740709e-02; +3.112578229653076e-02   +8.691553775067162e-02   -7.907461316650422e-02   +1.100084244269657e-01   -3.269025152845662e-02   +2.710579322952939e-01   -3.038200318911567e-01   +1.565249522658094e-01; -1.592140792710089e-01   +1.071884572956514e-01   -6.806792524595533e-02   +2.193166480904536e-01   +7.509718301518749e-02   -2.401153433622593e-02   -2.496693560486463e-01   -4.529091553614861e-03; -1.073642400277343e-01   -1.535130489583595e-02   +2.845405752445140e-02   +4.020001921891503e-03   +4.067702252281881e-01   -1.517392195108846e-01   +1.837315506548030e-01   -4.594626653176877e-01; +2.327666609312215e-01   -1.664286578748894e-01   -1.278836986935281e-01   -8.889823795624123e-02   +1.826324130891118e-01   +1.801234947484930e-01   -2.016702820797633e-01   +2.352117794880157e-02; +2.971215343664588e-01   -1.813133067746026e-02   +1.419139234450579e-01   +5.913690716164400e-02   -3.316505195282095e-01   +3.014357210669694e-02   -2.676523930833783e-01   +2.306816513770900e-01; +1.908612276353104e-01   +5.173483928385476e-02   -2.425815205151683e-02   +1.315690539455990e-01   -3.454932299491608e-01   +1.907342110099266e-01   +1.782735915443072e-01   +8.863402249880173e-02; -2.235407267484550e-01   +1.526200667822659e-01   -1.876442267645204e-01   +2.745053105157917e-01   -3.837017069297257e-02   -4.096149152220659e-01   +1.848977884851011e-01   +9.724231668398377e-02; -3.601088210904947e-02   -1.548176977604358e-01   +1.517161253752381e-01   +6.334753159142691e-02   +1.646128524366726e-01   -1.243165254049320e-01   -2.762281944706430e-01   -4.667177377819727e-01; -1.105239117983991e-01   -1.164503223952331e-01   -2.845147348010920e-01   -1.512031050942962e-01   -9.589138851820110e-02   +9.927629470403060e-02   +1.868350151987975e-01   -1.844657282228076e-01; -1.922326014309576e-01   +9.690990006573737e-02   +1.220928865611858e-01   +8.342844377060531e-02   +1.100492989415754e-01   -1.466971988785384e-01   +2.458792039587454e-01   +1.139149203779403e-01; -2.358022492319162e-01   -1.223490934513158e-01   +6.119746247586491e-02   +1.376919943169863e-02   -2.989452311994444e-01   +2.300419473798182e-01   -9.281661566292117e-02   -9.014204874650299e-02];
L1E_L2E_iAMPA_netcon = [+5.933854720528929e-02   +2.153867541051756e-04   +7.067129980171949e-02   -9.637294514726567e-02   +1.519612344454232e-01   +4.044519027653289e-03   -1.714096216923090e-01   -8.484076887376403e-02   +9.888525214451979e-03   -2.171532670773010e-01   -1.261437946923235e-02   -1.032366963414725e-02   +1.180027624727107e-01   -1.246577651946139e-01   +2.345231478336067e-01   +1.004579641278312e-01; -7.069874399849493e-02   -9.866201569079404e-02   +1.618999927755519e-01   +7.950725334534953e-02   -1.273191730570625e-01   -6.600764690456505e-02   +5.633268022421485e-02   -2.338829651408493e-01   -2.520597714548909e-01   +1.923042845326152e-02   -1.307086299723989e-01   -4.762840817633088e-02   +2.093430901643749e-01   -2.150543672704373e-01   +2.634911640921442e-01   -1.489044630524758e-01; +9.203076026126990e-02   +1.767085891748734e-01   +2.021837783190963e-02   +8.094900049101184e-02   -2.366192133886806e-01   -1.037474095855316e-01   -1.110739912746080e-01   -1.199083946440264e-01   +1.040364713808923e-01   +9.656391893911838e-02   +2.376800119888736e-01   -1.214235748962355e-01   +2.204206434335563e-02   +1.645362218069065e-01   +9.180294330556019e-02   -4.789568108069211e-02; -8.116187976717254e-02   -2.230352448685145e-01   +2.949320229979242e-02   +9.963588362928402e-02   +2.921739792466232e-02   -2.947594042532738e-01   -2.085283857129222e-01   -2.376922435583494e-01   -2.088652876238255e-02   +1.473725228916814e-01   +8.145789406132213e-02   -2.221769363022348e-01   +4.823863342257957e-02   +1.084284719446673e-01   +4.569776268786337e-02   +1.877911048570355e-01; +1.788115182257672e-02   -1.010522446085148e-01   +9.231167790374914e-02   +6.024163059015948e-02   +4.037688488496894e-01   +2.983788621414243e-01   -1.280617474325531e-01   -2.317677271375678e-01   +4.569514327027193e-01   -3.009058425634468e-01   +1.819973032903262e-02   +2.622223409576837e-01   +2.751141746141192e-02   +5.501892350538808e-02   -1.119682616639577e-01   +1.141618437248191e-01; +1.763013434238957e-01   -1.338657958168627e-01   -2.471823685923573e-01   -2.131617356487868e-01   +1.727885698203934e-01   +6.260760640931613e-02   +1.130828944510249e-01   -2.906125108885356e-02   +9.611986839021437e-02   +2.863374480088235e-02   +2.187714271779119e-01   +1.420660617729981e-01   +6.079344258732197e-02   -1.044176069842305e-02   +2.775468102291954e-01   +2.587041215083533e-01; +2.432261896850560e-01   -2.028217701383373e-01   -6.497789453620711e-02   +1.078554741545802e-01   +4.331372856106726e-02   -1.742773201499448e-01   -2.693732684912328e-01   -8.483768107163739e-02   -1.598002674891784e-01   -9.384886595221183e-03   +2.709343242268999e-01   -1.005849734014080e-02   +1.379206236754530e-01   +3.284042337434594e-02   +1.662120382732652e-01   -6.730470792546417e-02; +3.381934557690963e-02   +3.516130316353402e-02   -1.361480846735144e-01   +6.051062463429895e-02   +1.825312783102745e-01   -1.184904817107548e-01   +5.758004087521657e-03   +7.885302912356298e-02   +4.154081859935204e-01   +3.988366526610583e-01   +2.664872203257130e-01   -2.989423502383213e-01   -3.228757772020954e-02   +1.128085249361003e-01   -6.393276950651780e-02   -3.454084406505444e-02];
L2I_L2E_iAMPA_netcon = [+3.875409358028264e-01   +1.447589225312947e-01   -1.233262785763561e-01   +1.693303865643339e-01   +1.463134453355481e-01   +3.489448912392738e-01   +3.895686347911433e-02   -2.848184196161741e-02; -2.358126788387596e-01   +1.983653688599662e-01   +6.111782552794578e-02   +2.346668775134858e-01   +1.850326748569354e-01   -1.336659868878840e-01   -7.510452750921665e-02   +1.971441785308015e-01; -2.295808536489620e-01   -9.487942952413277e-02   -4.316342517927306e-03   +9.529609335332662e-02   +2.105463040407988e-02   +1.438694996943719e-01   -1.216427533456645e-01   +2.071531737480428e-01; +1.552204157771437e-01   -3.965249299365191e-01   -3.138021761229050e-02   -2.849874376475817e-02   -9.449765933576082e-02   -1.372553099275193e-01   -1.455553375748278e-01   -2.377196045671010e-01; -1.568478851239321e-01   +1.243272551498066e-01   -3.194201810055469e-01   +3.063953657109099e-01   +1.606236487653539e-01   +2.415124121923355e-01   -3.517751302548994e-01   +2.870889341539938e-01; +6.137409746762226e-02   +7.406546148685417e-02   -7.896563270278831e-02   +3.252843834714965e-02   +8.193125980245645e-02   +1.236603802916089e-01   +5.990664459071714e-02   +3.646845902913691e-01; +1.449978639708137e-01   +5.411970735921135e-02   -1.253147026465254e-01   +2.909757879328336e-01   -2.622237648167624e-01   -6.691959032240238e-02   -1.812399086628474e-01   -2.278578991243837e-02; +2.824124780496786e-01   +2.843264711688723e-01   -1.510264589132411e-01   -2.055464149098859e-01   +2.783313838441799e-01   -1.490663941237179e-01   +1.086613628419158e-01   -1.535631224695325e-01];
L2E_L2I_iGABA_netcon = [+1.447643715511948e-01   -5.940592594704942e-02   -5.364303859781516e-02   -9.481375969083983e-02   -6.559418834526837e-02   -1.818624018528325e-02   -7.008031973600101e-02   -3.847485632055499e-01; +2.295170923750018e-02   -1.578357214021497e-01   +7.315540792717048e-02   +2.236186691591423e-01   +2.043201889255034e-01   +1.814764965830933e-01   -1.012721801207069e-01   +7.757855079143182e-02; -1.048669481008705e-01   -2.253864552322539e-01   -8.951677457954157e-02   -2.989245848817678e-01   +8.405275995990190e-02   -1.025120305559684e-01   -2.087683076006711e-02   +3.076404358934629e-01; +3.363361756350878e-01   -1.732143963948933e-01   +1.359195041587898e-01   -1.092447833412969e-01   +1.123696102798034e-01   -1.056271455366670e-01   -4.677744240059527e-02   -2.148621127011471e-01; -5.969767668436568e-02   +1.454746966126890e-01   -1.926022815622386e-01   +1.047450126933749e-02   +1.929028470304641e-02   -1.436091667978300e-01   -5.010691351666995e-02   -2.352100012497680e-02; +3.663503618047851e-01   +5.439694013940190e-02   -8.571433868934136e-02   -2.432396519375067e-01   -1.241069113798475e-02   -5.131869805368279e-02   +1.238786587486427e-02   -2.776476875279241e-02; -3.714685662425755e-01   -2.467863798510439e-01   +3.570560009344426e-01   -1.469539495155082e-01   +2.052820335893143e-01   +2.079747319456814e-01   +2.292176433434814e-03   -2.799473136025083e-01; -1.018239063265870e-01   -2.481523451801301e-01   -3.383471832302322e-01   +1.197663617022828e-01   +1.942530065931526e-01   +1.111093408191479e-01   +1.695565934898552e-01   +2.690133509118385e-01];
L3E_L2E_iAMPA_netcon = [+2.283288105684741e-01   -9.727655325884429e-03   +2.640509205852661e-02   +2.369854174896664e-02   +5.907171479917558e-02   +8.929040326588955e-02   -2.150791037782510e-01   -2.589176553711289e-02   -3.951839425094295e-01   -1.610694344089016e-01   -4.218362777407990e-02   -3.115954313291476e-01; +1.870412842594317e-01   -3.115987291466485e-02   -3.829760462831785e-02   +8.196597608177714e-02   -1.515503251734672e-01   +2.119772682772482e-01   +4.622238959426810e-01   +1.122579163810938e-01   -1.703630160929909e-01   -3.928426662935313e-01   +9.909705298942541e-02   -1.617853054344549e-02; +2.211156749217161e-01   -1.254968852989478e-01   +3.146213932489026e-01   -1.996000379410853e-01   -2.591988713712386e-01   +4.082219858392570e-03   +8.200083646348061e-02   +8.423655599432894e-02   +1.132519650862265e-01   -9.306409788379474e-02   -1.725622731851731e-01   -1.533911013841698e-02; +7.680206123510015e-02   -1.315700186041682e-01   -1.907095849168073e-01   -1.890286651337859e-02   +1.270694695085356e-01   +2.653721355141045e-01   -2.193197965935495e-01   -5.938612490673979e-02   -7.502386189780591e-02   +3.707837690068874e-02   +1.199654274691467e-01   +2.407538901714281e-01; -1.566593718580356e-02   -7.052452097414919e-02   -4.526890914410515e-01   -6.899698884214368e-02   +1.738266159981910e-02   +7.073014666190519e-02   +2.958445811809850e-02   -3.086331369161116e-01   -1.641146588599533e-01   -3.727655081772832e-02   +1.276389625825067e-02   -2.600366243573582e-01; -2.233013693714763e-01   +1.386801176950444e-02   +1.477468087912317e-01   +1.998863363914513e-01   -3.474271216591980e-01   -9.514247787426390e-02   +8.272791401893458e-02   +4.127571404362451e-01   -1.131712288652584e-01   -1.656421235738980e-01   +1.986093012092877e-01   -1.708465442835002e-01; -2.320123749355226e-01   -9.123123487363827e-02   -3.538494071832753e-02   -7.943305387074082e-02   +6.105831643437924e-02   -2.029229316600723e-02   -8.872978578859989e-02   -3.294007713843882e-01   -3.426009783646738e-02   +1.182921233521458e-01   -2.145389231674616e-01   -1.484291777376356e-01; -3.374076177492212e-01   -1.050724666720215e-01   +1.385721960903845e-01   -2.422977051216790e-02   +2.546584113472101e-01   -1.161194991744147e-02   +1.041657336110218e-01   -1.231928539467769e-02   -6.712719291031681e-02   +8.415778382859042e-02   -2.505030367483544e-01   +1.073749931596607e-01];
L3I_L2I_iGABA_netcon = [-4.925863764256026e-02   -3.671811929606463e-01   -2.294112800748816e-01   +8.667969329517701e-02   -6.065644419840307e-02   -5.070099147003106e-02   -4.001920322543420e-01   -1.029641794400666e-01   +2.356978099990220e-01   -2.573901183533135e-01   -1.802439670758156e-01   +2.330300077522296e-02; -2.413860281822812e-01   +1.583274613238351e-01   -2.694527041397261e-01   -8.491743206015374e-02   +3.034686206725593e-01   -4.195705142993339e-02   +1.747262772695350e-01   +2.257558717394132e-01   -3.148700722997727e-01   +1.400351293497658e-01   +1.402177493556635e-01   +4.153672618192296e-02; -2.235744743963445e-01   -7.884424215880870e-02   -1.566000739060747e-01   -3.487688870161634e-02   -1.969569863015526e-01   -6.697584226673652e-03   -2.351592683178174e-02   -3.090985339658727e-01   -1.086028166500067e-01   -7.321335251535849e-02   +2.661556442334314e-01   +3.041742511270163e-01; -3.296445961977871e-02   -2.304715255379156e-01   +1.793750479998145e-01   +3.020058484311496e-01   -2.635075410562971e-01   +5.231215173774392e-02   +2.134960931477199e-01   -4.026979576842001e-03   -3.001990908753978e-01   +4.037162252645293e-02   +5.646617974618191e-02   +3.019889042141231e-02; -1.139405918685013e-01   -9.937871348210883e-02   -1.250535885125320e-01   -1.113607413042368e-01   -1.211890618122072e-02   +9.778160477080265e-03   +2.119362888548180e-01   -5.726858027750992e-02   -2.130661690653173e-03   +8.298130660570224e-02   +5.010462194162126e-02   -2.481605979683557e-01; +4.719863661873457e-03   +6.605084132031669e-02   +8.396433545489457e-02   -1.592135001679812e-02   -1.205322396528778e-01   -2.580941751282710e-01   +3.682690781242310e-01   +2.940920005529097e-01   -1.651618346544963e-01   +1.585164498666253e-01   -8.705703422397987e-02   -6.471870402950791e-02; -3.342625832749762e-01   -4.588862609041847e-02   +7.753450255929153e-02   +2.147382111263231e-01   +8.178875901330640e-02   +1.769855992552256e-01   -1.266290108072922e-01   -2.149182351390268e-01   +9.988669694453965e-04   +9.770827853074956e-02   -9.787750220363814e-02   -3.875010270478923e-01; +7.700791709088455e-02   -2.255014104274351e-01   -1.063846266227479e-01   -6.963176923777030e-02   -1.093057053837560e-01   -2.392346449668912e-01   -1.752506571694853e-01   +8.148243981831889e-02   -7.160417542143072e-02   -2.167872032711985e-02   +2.848621606002739e-01   -1.817205961313825e-01];
L2E_L3E_iAMPA_netcon = [+1.247814695619644e-01   +1.270143350550643e-01   -1.075509114188054e-01   -7.601925300148529e-02   -1.135229805490149e-01   +1.319972064057628e-01   +1.479653016836190e-01   +1.596401877872194e-01; -1.586048819222046e-01   +8.319138437265326e-02   +1.513336962136842e-01   -2.146138824942546e-02   -1.197235124001693e-01   -2.238493336314803e-01   -1.676246463677710e-01   +3.449930225645041e-03; -7.719013717477465e-02   -4.230709409360182e-01   -2.101588642572305e-01   +7.356788878532498e-02   +3.023578344386590e-01   +1.594591461968616e-01   +5.298415158154968e-02   -1.386199201601822e-01; +1.805229046345535e-01   -8.465892680382639e-02   -2.501098576003706e-01   +1.136123018131598e-01   -1.110176701757169e-01   +3.884115156738557e-01   +1.513813797064913e-01   -1.786763763907649e-01; +9.047184810704681e-02   -2.262414369989912e-02   +2.949546863787028e-02   +2.817401702883891e-01   +1.452811137540893e-01   -5.806840980498072e-02   -2.522466201719414e-02   +6.624234912767013e-02; +4.937855520344521e-02   +1.248229491428696e-01   -9.109121990344934e-02   -1.167735476340326e-01   +6.862879374117520e-02   -3.181449018533195e-01   +1.153478970298150e-02   +1.474460578685851e-01; +2.033374548713617e-01   -2.298759208292143e-01   +1.882636095604240e-01   -2.520903180864263e-01   -9.878460593178953e-02   +2.934587793662471e-02   +1.285707329477308e-01   +2.212203360958329e-01; -3.678553231394775e-02   -5.788134442081782e-02   +4.203347929047727e-03   +1.239973236282224e-01   +1.569377024354150e-01   +5.313612131431198e-02   +1.626453682063423e-01   +5.250936787642679e-02; +8.083440077774803e-02   +2.655000403175460e-01   -6.694475387693386e-03   +2.303272604134806e-01   +1.266388255512790e-01   +2.927115865527883e-01   +1.037920761475629e-01   +1.703035156854684e-01; -1.399999723647992e-01   +3.071653545314569e-02   -2.862444556404584e-02   +1.893550731485865e-02   +9.509462047691322e-02   +1.315149192675944e-01   -9.936206746772695e-02   -2.336278240511518e-01; +1.803332121285919e-01   +2.129703820289253e-01   -1.322007487835333e-01   +3.352053076204326e-01   +1.188355073119322e-01   +1.841379308266343e-01   -7.756397259709165e-03   -9.664270534408759e-02; +7.141369581027984e-02   +1.290020435345951e-01   -8.034079827844853e-03   +2.506153304522988e-01   -3.215081141134373e-01   -1.787095516655837e-01   -9.340735831481744e-04   +2.215371789496366e-01];
L2I_L3I_iGABA_netcon = [+6.831840139150841e-02   -1.785524955757717e-01   -9.699958138583813e-02   +3.677320290674239e-01   -3.396339700893763e-02   +1.531710805062219e-01   +1.762099014643801e-01   -4.812492734932092e-02; -9.011099153088852e-03   -1.761581412723682e-01   +2.006774796408064e-01   +7.636795181565231e-02   -1.993423835093267e-01   -1.766316781804901e-02   -1.034931211338551e-01   -2.056213577682467e-01; +6.207678388071889e-02   +1.648125510567469e-01   -1.643605168169030e-01   -2.023670649997039e-01   +4.096130662275020e-02   -1.369677572781870e-01   +1.252779957691706e-01   +1.940587520872659e-02; -2.336753156533896e-01   +7.060719706790321e-02   +2.588110388826014e-02   -1.730798291204372e-01   +2.973783545231937e-01   +1.494933358450499e-01   -6.369656867127085e-02   -1.340464965398453e-01; +1.017397677214568e-01   +8.075814075920346e-02   -1.097576084327653e-01   +2.057300791354835e-01   +1.392031600747760e-01   +1.892849426416371e-01   +2.497288320317567e-01   +1.173616467564613e-01; +1.511972385041881e-01   -9.396298207724400e-02   -6.077418417274317e-02   -7.840038209656820e-02   -1.543285188788447e-01   +1.381638148460773e-01   -2.338871361269127e-01   +1.891452495210310e-01; +1.197046479716469e-01   +1.932611631414035e-01   -7.291265433950488e-03   -1.428055648564718e-01   +1.767521338611097e-01   -1.632277927586973e-02   -1.959844259352136e-01   -1.906942621063155e-01; -7.549494997224812e-02   -4.836508040836522e-02   -1.719111053959929e-01   +2.087496533840828e-02   +1.638657877409027e-01   -3.501059259666386e-02   +2.179574272595935e-01   +4.017172862040001e-02; -3.749683754912549e-02   +3.634615044410532e-01   -1.905214553534814e-01   -2.559226651245710e-01   -1.454640318487338e-02   +8.665616053114261e-02   -1.037079638864359e-01   -9.587723505743406e-02; +3.508411410226670e-01   -4.123567321667461e-02   -4.265159322660002e-01   -4.613550994513500e-03   +5.523595656929543e-02   -1.637472945220145e-01   -2.075541553007531e-01   +2.441815509347183e-01; -3.381853103307413e-02   +4.997082996003290e-03   +1.035327555000558e-01   -1.203633732342405e-04   -5.798839943144257e-02   +2.009924759741872e-01   -1.454875356545057e-02   -1.371583611266535e-01; +4.041854230770801e-01   +2.404142877932756e-01   -1.377705620989863e-01   -1.910213443526993e-01   -1.994943711624967e-01   +3.104015332561729e-02   +2.506077964471847e-01   +3.142124292714292e-01];
L3I_L3E_iAMPA_netcon = [-3.454129575539647e-02   +1.543865536531527e-01   -2.071807584652574e-01   +1.954267521087860e-01   +5.896720974828096e-02   -2.322280474344638e-02   +1.467337190751237e-01   +1.557914125655404e-01   -3.755694527182031e-01   +2.179720671836372e-01   -9.518653732759325e-02   -1.212925482032066e-01; -1.100289824374522e-01   -2.057031023571028e-01   -1.552186031138105e-01   -8.419589875391797e-02   -1.878940329522827e-02   +1.442915818684596e-01   -9.851764172777532e-02   +5.545493186722834e-02   -1.341496622686383e-01   -2.403102296873728e-03   +1.228031908451523e-01   -4.005624781494915e-01; -1.408323223314463e-01   -1.262518381596545e-01   -6.878205343666131e-02   -2.174242748894820e-02   +7.767475036406991e-02   -9.712473568836748e-03   -9.660541448394069e-02   -3.444131564623910e-01   +2.488619262504194e-02   -1.354472444324279e-01   -1.275529176779058e-01   -2.610357149511093e-02; +2.368935049446150e-02   +2.875981708471579e-01   -3.165695980270553e-01   +2.256687420700673e-01   -1.963854512246446e-01   -1.455846065354435e-01   -1.262674541949654e-01   -1.494453785636798e-01   +5.581557323689827e-02   +3.688463256814056e-02   +3.595739100139653e-01   +1.241386009086967e-01; -6.888503557375276e-02   -1.967896090288722e-01   -2.619401652169650e-02   +2.009212750078304e-01   -9.162461552079111e-02   -5.883705945144792e-03   -3.484397472063970e-01   +9.061535697688754e-02   +3.024544571913802e-02   +2.338602923665700e-01   +2.106744437629468e-01   +8.703587474574048e-02; -1.002410244980424e-01   +2.285308346509279e-01   -4.565790598392325e-02   +2.125457081877488e-03   -8.944178665703573e-02   -4.702666405061465e-03   +7.122594827078887e-02   +1.614633508934464e-02   +1.662972115201130e-01   +4.883835215720971e-02   +1.142691048730601e-01   -2.923817925617049e-01; +1.987003668921074e-02   -3.731233581763203e-01   +2.150997642086609e-01   +2.477619980377415e-01   +2.671039370450784e-02   +1.666048476252259e-01   +1.719431276343175e-01   -3.204097815777112e-01   +2.735608791022733e-02   -2.863416480419335e-01   +1.592159388875609e-01   +1.737804289257117e-01; -1.673725015414386e-01   +9.707621117003470e-02   +5.938995363409131e-02   +1.231690415173371e-01   +1.448160884858934e-01   +1.295897689913599e-01   +1.089354188582781e-01   -1.711445361692271e-01   -8.720330743267585e-02   +1.041324788746111e-01   +1.999260689970037e-02   -2.401805623883948e-01; +1.377059283983060e-01   -1.518793871200704e-01   -1.067968777218226e-01   +5.176227565392093e-02   -2.371040773034484e-01   +1.594886795708269e-01   -2.252085782962063e-02   -8.685304157844326e-03   -9.887214683431024e-02   -2.117822177353973e-01   -3.978982532148159e-01   +4.109442030252115e-02; +2.931206823995248e-02   -1.067096831208189e-01   -2.575649603730341e-01   +2.954298536084603e-01   -1.115910958528681e-01   -1.306537700691353e-01   -1.667969949042038e-03   +1.633409551361910e-01   +2.489146442909272e-01   -2.075530701424335e-01   +2.021816085637780e-01   -1.466238248812534e-01; -1.271937441105269e-01   -2.905227953746822e-01   +2.593728583352727e-02   -2.640736344083343e-01   +1.821792783753307e-02   +1.888789046191308e-01   +2.787945301623885e-01   -6.688115558836716e-03   +1.379365037985804e-02   -1.146701274349852e-01   -5.650766777088070e-02   +3.580918692611786e-01; -2.945929624799557e-02   +5.864824687517872e-02   +1.517019520469650e-01   -3.881014392069568e-02   -8.863675207298602e-02   +1.008849365320998e-01   -1.095521436696090e-01   +2.322079909245715e-01   +8.182091117858975e-02   +6.441393603204956e-02   -1.357640879228728e-02   +1.993411118304051e-01];
L3E_L3I_iGABA_netcon = [-1.603556920159896e-02   -1.052279369754493e-01   +6.195450213778413e-02   -2.823666342460999e-02   -8.793588498782215e-03   -2.889204837995173e-01   +3.025969407552247e-01   +1.595893973937173e-01   +9.046497818861743e-04   +2.417268432303271e-02   -2.719532111350874e-01   -1.325559632414964e-01; +2.724161193660618e-02   +8.511546243152988e-02   -8.658951326366005e-02   -2.172013126407982e-01   +1.033172736872021e-01   -4.817927838302596e-02   +2.556217478454765e-02   -3.405262905048130e-01   +2.549067914034097e-01   -1.061693420119394e-01   +1.594503642248853e-01   -7.911276881933077e-02; +1.871634508683138e-01   -3.235492763658566e-03   +1.926380133464955e-01   -2.291148528770156e-01   +2.204213610279372e-01   +1.981230806698845e-01   -3.548150767490062e-02   -1.530017764027729e-01   -2.537440106944139e-02   +5.017302183828228e-02   +1.412156643042378e-01   +1.154083378410804e-01; +1.377839856321888e-01   -1.811776488584406e-01   -5.130786627924361e-02   +1.144794559426787e-01   -3.806902185162095e-02   +1.255489287974539e-01   -2.201426336868590e-01   -3.464668747885238e-01   +1.823398036306356e-02   -4.648685322967060e-02   +8.172107698950046e-02   +1.051145011788567e-01; +1.602353294879618e-02   -9.676554092318233e-02   +2.268173544679753e-01   -1.389063419980092e-01   +1.065675320421900e-01   +2.691670757455596e-01   +1.922532571318637e-01   +7.756263207945541e-02   -1.327886808782342e-01   +2.064994144281559e-01   +4.217182515066798e-02   -1.619754905912780e-01; -1.287036789439069e-01   +1.185267089978241e-02   -4.133169791186890e-01   +1.431415834350128e-02   -7.248830103271844e-02   +3.251960650628624e-01   -9.488335335527817e-02   -1.250091898954709e-01   +8.474362635943379e-02   -1.354957758515701e-02   -1.142104693429762e-01   -1.923431554149196e-01; +1.936651339494644e-01   -2.591395287624932e-02   -2.238713206721805e-01   -1.615743350854911e-01   +6.546274664114395e-02   -2.560277333592598e-02   -2.705823062312075e-02   +6.578470381227736e-02   +2.547536690725687e-02   +1.378509531869427e-01   -1.063982778035530e-01   +1.568753538210646e-01; +1.019022257561167e-02   +8.506216919360120e-02   -8.012996134110462e-02   -1.716090796860886e-01   +9.675925419807505e-02   -1.673244619026380e-01   -1.579754091926689e-01   +3.573754098683811e-01   -2.306856255029844e-01   +1.391329450281933e-01   +1.403313452341363e-01   +2.103974104248955e-01; +1.067268276809141e-01   +2.161617498432775e-01   +8.377900697886943e-03   +7.574326457756735e-03   -2.080641806549186e-01   +9.836236018249689e-02   +1.497527259967013e-01   +2.002056446416910e-01   -1.158254492113529e-02   +1.407023114528273e-01   -3.163813676565219e-02   -2.135507182008972e-01; +2.937585954738307e-01   -1.185562735187983e-01   -1.413857286257170e-01   -1.125701955023168e-01   +3.171051898534065e-01   -1.810486915977476e-02   +2.545727211479867e-01   -1.384123378084565e-01   +1.146870529538403e-01   +2.296514675689795e-01   +6.919864254182861e-02   +1.499210888949949e-02; +3.065224170670567e-01   +5.122181990589579e-03   -1.060862664226941e-01   +3.554554367527964e-01   -2.198717656760117e-01   -2.244355368186324e-01   +1.286372277619751e-01   +1.681923934248233e-01   -1.007497867054323e-01   +2.222121726811696e-01   -3.465294361409678e-01   +9.724670472984534e-02; -1.563064082177274e-01   -2.640610148785326e-01   +1.513182876521647e-01   -1.966842455396149e-01   -1.411692589830705e-02   +5.502210548928091e-02   -1.724771283653528e-01   -1.184486212366109e-02   -1.980212353574591e-01   -1.551283871079285e-01   +2.817445723448525e-01   -1.571190853036127e-01];
L2E_Input1_iAMPA_netcon = [-3.953023324163581e-01   -6.085768425625470e-02   +5.993802210493527e-02   +8.583749101333707e-02   +3.015755061871679e-01   +4.736300487964002e-02   -1.210365665229938e-01   +2.248020978224667e-01];
L2I_Input2_iAMPA_netcon = [-4.917218890586222e-02   -1.628386666886521e-01   -5.562581635041376e-02   +4.378773974529914e-01   +1.672729931628910e-01   +1.023144424206305e-01   +1.500321227039449e-01   -1.568108028921084e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
