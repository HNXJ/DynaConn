function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.194706944511324e-02   -3.378611511084350e-01   +6.613754444970282e-01   +5.681873134953179e-01   +1.140696326384594e-01   +4.902541577096752e-01   -1.978445555123874e-01   +2.587308381120787e-01   +3.159236994320663e-01   +6.297882889369170e-01   +3.067781539768922e-01   +4.623594017061469e-01   +3.570088114080814e-02   -9.090839463949080e-02   -2.787631454172128e-01   -6.007358120000894e-02; +2.913179347794025e-01   +1.153104873731703e-01   -1.302690720667649e-01   +6.179013621929719e-01   -1.293208511537876e-01   +3.822078982383145e-01   -3.510416457433030e-01   +3.314295279136475e-01   +6.006632713303618e-01   +1.555301467400679e-01   +6.264768464427495e-01   +4.445710955277922e-01   +2.530130061309614e-01   +8.978544602808425e-02   -3.678474432349951e-02   -3.636522800487237e-02; +6.748730244977157e-01   +3.150294911785017e-01   +9.873506747885205e-02   +1.597600186261730e-01   +1.974777900980380e-01   +1.622763221510226e-01   +3.463879712847129e-01   +2.903983632792630e-01   +2.085618355375291e-01   +3.467803809439535e-01   +3.099250975008569e-01   +3.933230276522008e-02   +5.352973734313506e-02   -2.420317235068422e-01   +1.778939780346343e-01   -8.089462673593656e-02; +1.766167474153548e-01   -2.152627683787512e-01   +1.457561242038896e-01   +4.650098366168051e-01   -1.933334839823869e-01   +2.043760784681451e-02   +4.755148600217408e-01   +8.035897715412723e-01   +5.272906081134157e-01   +9.826488024010095e-02   +4.473793142694073e-01   +5.581774194453883e-01   +1.407724925007617e-01   +6.817589585817867e-01   +3.659323651923094e-02   +7.373532007027960e-01; +7.763922234096428e-01   +3.973021563341025e-02   +2.673609375578786e-01   +7.773123904238501e-01   +1.926023803136319e-01   +5.136663192415167e-01   +1.257418501565086e-02   +5.466995133244902e-01   -1.003461146108322e-01   +2.354000325549626e-01   +4.918908870290590e-01   -3.551584404870929e-01   +4.330597988248632e-02   +4.687793443856812e-01   +4.870284949180627e-01   +1.276464138710981e-01; +2.510990229758131e-02   +5.701961687124506e-01   +2.659908691207934e-02   +1.670824045551313e-01   +8.292377493718051e-01   +2.712691018244068e-01   +7.409111587021195e-01   +2.959203140232557e-01   +2.993122615082077e-01   +2.938993382033878e-01   +2.258757364238989e-01   -2.027925733725856e-01   +1.606182037670027e-01   +2.475378233137786e-01   -8.863182717672632e-02   -1.006113792025304e-01; +4.580164158077046e-01   +6.219408314763994e-01   +2.975205872937143e-01   +4.164813491814177e-02   -2.762644231649029e-02   +4.165423993061343e-01   +3.505235168523109e-01   +3.694690995903695e-01   +3.349069810315440e-01   +2.815591948123203e-01   -1.396977825712472e-01   +5.580004078456364e-01   +3.183341325472416e-01   +1.757142408406653e-01   +4.370244746533491e-01   +4.304789717041783e-01; +2.287370583844832e-01   +5.049571428934716e-01   +4.655901083067676e-02   +6.491426808339255e-01   +2.227866009185439e-01   +1.297717858964651e-01   +2.308526069847295e-01   +7.543892053161150e-01   +8.120923383086778e-01   +4.417306047440222e-01   +1.800212306600079e-01   +3.885636413717181e-01   -5.912516577502067e-03   +1.172149242440223e-01   +3.686331010804222e-02   +2.793486914075788e-01; -3.797140059657397e-02   +6.064310950736340e-01   -3.120802550855226e-01   +2.149104176825649e-01   +2.732868894241843e-01   +5.031315974702057e-01   +2.082437658744879e-01   -2.216329200771924e-01   +4.408649776506426e-01   +1.554025042260634e-01   +6.218585000127378e-01   -3.984944325591497e-02   +4.992041277517997e-01   +4.441871869550680e-01   +2.790315432672544e-01   +1.197290988272716e-01; +2.076102689044838e-01   +2.858862748899040e-01   +2.906346797644487e-01   +3.310935937166804e-01   +4.468191195269176e-01   +9.826437258485513e-02   +4.677327878225139e-01   +5.669109183231478e-02   +4.598338988454607e-02   -7.890802071991183e-03   +7.655771155415153e-02   -5.991206755814276e-03   +8.749905434866380e-01   -1.901129235260786e-01   +2.329647238309071e-01   +5.367847403484017e-01; -8.050788745448050e-02   +5.857164550171378e-01   +9.989251314181594e-02   +2.270844641327289e-01   +4.405568699429577e-01   +4.928815887740209e-01   +7.579954061765282e-01   +7.033226109912172e-02   +1.491802662205923e-03   +4.201612778474215e-01   -8.047640012504104e-02   +5.255766377332081e-01   -4.914887428160494e-01   +4.001895709324314e-01   +5.370015739979036e-01   +2.490146887641363e-01; +6.715991172684348e-01   +4.462567568487674e-02   +3.336733281076085e-02   -3.925215313763341e-02   +3.003880836705750e-01   +4.709185618076776e-01   -1.184606925673429e-02   +4.154341371447759e-01   +6.123095213658348e-01   -1.738029500936226e-01   +1.546991331368206e-01   +4.384059325220904e-01   +5.187012515557251e-01   +5.088011936227194e-01   -3.144328242101683e-02   +2.623350574950923e-01; +1.819965086343839e-02   +5.259819005182096e-01   +6.821310656911703e-01   +2.574523792458761e-01   +5.970026457037620e-01   +4.752057968364357e-01   +2.166743129458905e-01   +7.175272196580024e-01   +7.202715686296922e-01   +3.205404807213300e-01   +2.114209478473205e-01   +2.930424122355814e-01   -4.107645712539373e-01   +2.721730877041432e-01   +1.649737284927992e-01   +3.452564228002485e-02; +6.887001071782586e-02   +3.980579358165476e-01   +3.258096721313932e-01   -4.868610198545396e-01   +1.327533813432757e-01   +7.600816554815150e-01   +6.769487080591371e-02   +2.202242713234052e-01   -6.582513605682150e-02   +1.067493199450148e-01   +6.216944695490587e-01   +3.879178128588804e-01   +4.428249370747240e-01   +5.658899036193148e-01   +9.354591205116222e-02   +3.306261330537489e-01; +2.303429332614614e-01   -3.411596068135262e-02   +3.566914900361632e-01   +7.271582326999385e-01   -2.335981340309972e-01   -6.380279283643316e-02   +7.573006476092901e-01   -1.568395798850443e-01   -2.628555288227868e-01   +3.279577284647385e-01   +1.661418459432281e-01   +2.645425915816242e-01   +7.288423156680325e-02   +1.194355615238554e-01   +1.966524489816134e-01   -2.145031338186143e-01; -2.390402275194400e-01   +3.563162431218672e-01   +5.251960614833183e-03   +4.171378591489275e-01   +1.000000000000000e+00   +7.719436980282665e-01   +2.007975121273904e-02   +8.129824570819866e-01   -2.387492364429965e-01   +6.587764112330167e-01   +6.757175791802872e-01   +4.424919644304465e-01   +2.332575287429908e-01   +5.185390198020429e-01   +6.418299190115853e-01   +3.335181419352102e-01];
L1E_L1I_iGABA_netcon = [+1.867751611501989e-01   +3.970178895837611e-01   +2.944072158606384e-01   -1.562860190245504e-01   +3.767715931395988e-01   -3.793501062306120e-01   +1.646923925070801e-01   +1.426990494340827e-01   -6.732757188089139e-02   +3.786470749567195e-02   +3.025184463149027e-01   +4.278819996425173e-01   +8.208942568750014e-01   -3.041189248416265e-01   -3.002324322353772e-02   +9.670004181285246e-01; -1.136529047964511e-01   +5.988586641096579e-02   +3.555529158722834e-01   -2.283591539803020e-01   +7.609140552891251e-02   -1.931734202846487e-01   +6.457139754884069e-01   +3.376152384309338e-01   +5.254172330566060e-01   +1.779382989592026e-01   +5.819223741013388e-01   +1.982663115131932e-01   +5.992541948948286e-01   +2.946449735199581e-03   -1.223761141571525e-01   -8.747167170079638e-02; +3.259799128527038e-01   -2.135978368192094e-02   +1.429337265830311e-01   +5.755513943339114e-01   +4.124692990993503e-01   -8.251376127473858e-02   +2.674921327202943e-01   +2.480872788380893e-01   +6.647191243192693e-02   +9.612694366944613e-01   -1.234082771068540e-03   +2.198270060903252e-01   +5.797318394446178e-02   -6.753393821735670e-02   +3.724732549611670e-01   +5.397234649838152e-01; +5.592568692895996e-01   -2.756192630196536e-02   +3.011250896606320e-02   +1.302607055550055e-01   +2.572431953463299e-02   +1.444440907121776e-01   -1.053257917350946e-01   -2.955950069921928e-01   +2.298316016581294e-01   +5.618757098893538e-02   +1.287441846503314e-01   +4.807232721463136e-01   +2.960025774217924e-01   +2.834289547737718e-01   +1.025273183717801e-01   -1.418286573431904e-05; +2.413257033116840e-01   -3.615767524070543e-02   -1.581445254083848e-01   +1.918947684001972e-01   +6.610122001527020e-01   -3.241042256777038e-01   +2.834374626422695e-01   -2.310681016051245e-01   +2.069715393520264e-01   +2.097900538794956e-01   -2.699894529583107e-01   +5.252488000500066e-01   +1.777863713682066e-01   -5.839752545079219e-02   -1.335515829744732e-01   +4.916860828725224e-01; +7.416089950599331e-02   +2.828293663842760e-01   +3.055588581303482e-01   +1.166709393775925e-01   -3.580671447365559e-02   +3.858558647069801e-01   +1.986520316650824e-01   -6.846110981272899e-02   -1.800204535732025e-01   +3.283107863336037e-01   -5.442463143928289e-02   +4.378878055843463e-01   +3.076579868141026e-02   -1.533488218496924e-01   +3.748671011893258e-01   +4.487011365107800e-01; -4.402005889834379e-02   +2.167243111280114e-01   -4.333362615351347e-02   -1.798874506098143e-01   +1.800164540822735e-01   +1.462970245596059e-01   +4.912331848038671e-02   -2.062772849510746e-01   +1.608713954516318e-01   +1.523002663309054e-01   +5.700087123766218e-01   +2.186859130186720e-01   +2.969720165723062e-01   -1.797548704720772e-01   +8.716332427470982e-01   -1.343320523001949e-01; +2.367223739048451e-01   +4.220039477971825e-01   +9.795404104556490e-02   +2.817800851724801e-01   +6.386441397071276e-02   -2.299423364336979e-01   +6.869207923066090e-01   -2.973776786284772e-01   +6.879796707238617e-01   -9.338062505622033e-02   +2.451592731011124e-01   -5.590201313911786e-02   +2.495646327983918e-01   +3.380575934486264e-01   +1.991927448223516e-01   +2.384061188812174e-01; +3.911414422435245e-01   +6.983769536082359e-01   +4.527350869930988e-01   -1.161112614739511e-01   +6.067134590994380e-02   +1.558433852693344e-01   +3.994893972361603e-01   -9.373282669431868e-02   +3.466849762330873e-01   -9.281651106788895e-02   +1.636417836951956e-01   -2.488123234255209e-02   +1.628588311044119e-01   -2.001275432065162e-01   +6.452083949055587e-01   +9.937574338888738e-02; +5.635619958544730e-02   +5.402544536689626e-01   -1.168769586515896e-01   +3.136204929649221e-01   -1.396981282227968e-01   +3.852761343946401e-01   +1.296269159617375e-01   +1.479337748639796e-01   +4.158928602618536e-01   +1.681081392469683e-01   -2.772286880048888e-01   +8.755837279934317e-02   +2.677517009294419e-01   +4.313828233655332e-01   +2.010375497779272e-01   +2.128327970893147e-01; +2.777380524000604e-01   +2.982325339093499e-01   +7.120211920411614e-01   +3.284992775684042e-01   +3.648570807091357e-01   +1.861002116270148e-01   +1.468093795582039e-01   -1.312539200551580e-01   +3.343769799188322e-01   +1.343045838459740e-01   +1.736747750908962e-01   +6.477175798089934e-01   +7.364929579801771e-01   +2.274687908565742e-02   +6.536605009395291e-02   +9.002348526667969e-02; +3.410949854895858e-01   +2.321673286737162e-01   +1.043642578899777e-01   -3.251513807121080e-01   +1.745833728698789e-01   +3.959478388976440e-01   +3.210727227129796e-02   +1.696377607676210e-01   -2.755479015090352e-01   +1.918376522508727e-01   +3.867316311275562e-01   +4.640688628457123e-01   +5.582927873878364e-02   +1.032652585554325e-01   +2.180491339782022e-01   +1.672588690832334e-01; +2.827710999920775e-01   +2.603998454698908e-01   +2.443426870225524e-02   +9.794980039498067e-01   -5.429391383691927e-03   +1.836594270192073e-01   -7.833022749600363e-03   +3.816023869000285e-01   +3.600654361476302e-01   -2.713374592181401e-01   +3.974620649853119e-01   +2.560898003957837e-01   +3.332742226403183e-01   +2.950367859076219e-01   +5.500764691060733e-01   +1.838721667997819e-01; +2.983609423010712e-01   +1.637312118987023e-01   +1.308209997263329e-01   +2.934431742938828e-01   +2.199857922470727e-01   -1.381034726433395e-01   +2.579489763601731e-01   +1.750158136986260e-01   +2.856546365336874e-01   +4.720974354367509e-02   +3.189505337207093e-01   -2.499180132920604e-01   +2.781639172747795e-01   +6.427956278499058e-02   +4.510482219616060e-01   -1.910330281661412e-01; +3.640808287762839e-01   +4.891508162929270e-03   +6.348917306935803e-02   -2.080360370598131e-01   +1.597289086649235e-01   +2.789268009231975e-01   -7.452383139366636e-03   -6.611364758389858e-02   +4.159063271700987e-01   +1.610287733209372e-01   +2.815511144361593e-01   +3.895423895732137e-01   +2.098129117782225e-01   -1.667828167638022e-02   +3.671489545113638e-01   +2.423728735005732e-01; -8.387689447143618e-02   +2.837008957852620e-01   +3.685882767226241e-01   -1.850899733622912e-01   +2.806543898925783e-01   +3.727687575942239e-01   +3.005535491819425e-02   +2.195400935309618e-01   -1.901069943858920e-01   +1.527071024450382e-01   +2.404292039026683e-01   +3.327613129415964e-01   +3.571523870092390e-01   +5.310803260725665e-01   +4.148741563222205e-02   +3.859270939181418e-01];
L2I_L1I_iGABA_netcon = [+3.095601884569538e-01   -1.183969540840478e-01   +9.609795527529787e-02   +4.763808120821407e-01   -1.758133682992840e-01   -2.587736960843373e-01   -3.066176188968623e-02   +1.483543114545814e-02; +3.751007516562548e-01   +6.333251859411342e-01   -2.732677870619784e-03   +3.920191577680342e-01   +9.768859726513228e-02   +2.640117575858598e-01   +3.161319476599854e-01   -2.571290019621110e-01; +4.237378390534746e-01   +2.180212587491799e-01   +3.488218320535353e-01   +1.216815445423020e-01   +3.067682149688415e-01   +2.134032301876621e-01   +2.584067108886552e-01   -3.856191586237256e-01; +6.845626300021637e-01   +2.012660858727493e-01   +4.093399420871480e-01   +1.694835382637819e-01   +7.888788858494826e-01   +4.329627559574735e-01   +6.216972547264776e-01   +3.940885908687153e-01; +2.464524820437805e-01   +2.803750748197631e-01   +2.623376074189563e-01   +3.087214105167131e-01   +2.846205198184429e-01   +1.828362647755622e-01   +9.434477923801372e-02   -3.882670390359162e-02; +3.386380799759512e-05   -6.238221570600059e-02   +3.538560881844927e-01   +3.955655099491394e-01   +1.160100807864532e-01   +4.174582876513691e-01   -1.461280221447278e-01   +5.276299534136594e-01; +4.290889987979199e-01   +2.268794080671372e-01   +2.727781979078143e-01   -1.188180195555239e-01   +4.553334377244310e-01   +1.561473824557527e-01   +4.711588645030095e-01   +1.226017630618556e-01; +5.996220668349005e-02   +3.364859466542309e-01   +5.192315853214908e-01   +1.589914201102793e-01   +3.437798020581300e-01   +2.708942104077269e-01   +7.513351421378282e-03   +2.881680269412143e-01; +4.151461741130200e-01   +8.875958174523644e-01   -2.079552500710748e-01   +4.859388397261284e-01   -1.956201211593224e-01   +1.037472316202964e-01   +9.411233532905483e-02   +5.293176688705010e-01; +1.687158875377826e-01   -2.137361144305972e-01   +2.566313838090882e-01   +2.997910541977288e-01   +4.219007733658119e-01   -1.095099126042057e-01   -1.066161772628182e-01   +4.169604420231384e-01; -1.083750776562545e-02   +1.674214402257221e-01   +5.438810565666879e-01   +2.526385533994307e-01   -3.292623496978134e-02   -9.825764575887506e-02   +1.672490462859297e-01   +1.941451927682518e-01; +1.147191516881421e-01   +5.149752324893802e-01   +4.578763489313474e-01   +2.738390824728115e-01   +1.293711569672883e-01   +1.187154913653820e-01   +3.694016664632349e-01   +4.832958964140684e-01; +2.526876412930676e-01   +6.132662030999043e-01   +5.568530246118650e-01   -2.317312210460009e-01   +2.194888097172173e-02   +9.368125811749610e-02   -1.768309917914895e-01   +2.657386837841089e-01; +1.995841975170712e-01   +1.019707360908628e-01   +1.890818650958585e-01   -4.801743117243406e-02   +6.241456397737203e-01   +2.011783639429744e-01   +4.902371714170285e-02   -5.340692136845644e-02; +3.339265305123176e-01   +3.044515560628148e-01   +3.184044668094274e-01   +5.184430264395166e-01   +2.629410033332292e-01   +1.000000000000000e+00   +1.498052613151055e-01   +4.953332449012998e-01; -1.098964879879218e-01   -2.365855982866579e-02   +3.427018853293443e-01   +1.538914457475088e-01   +4.514079944073020e-01   -1.451297860880936e-02   +8.024579404402729e-02   +2.277311153866907e-01];
L1I_L2I_iGABA_netcon = [+3.638233863085195e-01   +1.374970218832883e-01   +5.996948979683223e-02   +4.901421477620206e-01   -1.591595365421452e-01   +5.041324896323145e-02   +1.324557114189928e-01   +3.963212386778944e-01   -4.446137888882492e-01   +6.767574300093222e-01   -9.611860609958320e-02   +1.082656205859316e-01   +5.349856028015550e-01   +3.943673361923989e-01   +4.261994120666194e-01   +3.271970121390395e-01; +3.803798476594448e-01   +2.660027222987305e-01   -3.690257626531754e-01   +1.257920612237048e-01   -1.813552444861373e-01   +2.121013065532540e-01   +5.901320244765715e-01   +4.263023296397390e-01   +5.408755335024350e-01   +8.418998728096846e-01   +2.181281887563141e-01   -2.979386381859510e-01   -1.546000928051653e-02   -5.293036315877165e-01   +2.397131523715255e-01   +6.718796473680021e-01; +6.443934190780716e-03   -3.933652005499758e-02   +4.659811874534882e-01   +1.617809195076524e-01   +2.077974802837260e-02   -2.837007231174063e-02   +5.249522902615277e-01   +4.471154628397382e-01   -3.183709910529036e-01   +4.890179050954142e-01   -3.403748402911322e-01   +5.073463571843640e-01   +5.731664391593665e-01   +4.531046450953671e-01   +6.252898454040806e-01   -1.420122790607529e-01; +6.970994346408474e-01   +2.426486049466048e-01   +2.385918925927638e-01   +1.002275926376574e-01   +8.161505473494272e-01   +2.111964719188678e-01   +6.871128901926253e-01   +6.230837178306624e-01   -3.913373960321183e-01   +5.999155681906030e-01   +6.270028251621029e-01   +4.711404473655409e-01   +3.755543668731724e-01   +2.564657730414855e-01   +1.857808488752323e-01   +1.802797877591805e-01; +1.320517901270722e-01   +1.753283694500407e-02   +1.442318272774637e-02   +2.599429463386592e-01   -1.061535125486667e-01   +8.047805582503633e-01   +6.496527356710721e-01   +1.807359379318230e-01   +6.105009106596130e-01   +5.598137331891292e-01   -1.521377447548698e-01   +4.416673044995212e-01   -3.055526172307693e-01   +3.216300196534340e-01   +1.173994565049468e-01   +7.163438443185557e-01; +5.908243095079801e-02   +4.247619819499581e-01   -1.094307215116053e-02   +6.614179678322240e-01   -2.468620093896806e-01   +3.656637245573062e-01   +3.686618384463164e-01   +3.107589750517316e-01   +2.058514510169666e-01   -3.842503500579054e-01   +4.854859881678129e-01   -2.882019177157623e-01   +7.406516626664358e-01   +7.730332891848777e-01   +4.482484118267949e-01   +3.173405310509594e-01; +3.098894721566389e-01   +7.038134721407453e-01   +1.021576431693810e-01   +2.891594116487138e-01   +1.849183599575756e-01   -2.969516953514170e-01   +5.265720316056779e-01   -1.278430820948124e-01   -1.707258780367897e-01   +6.234240169646060e-01   +5.328993745039831e-01   +2.902882697331223e-01   +9.588709228980086e-02   -1.120115792786134e-01   +2.373910428727249e-01   +7.019806012464208e-01; +3.903549014027703e-01   +1.427395594619468e-01   +1.614425166208721e-01   +1.851482277245077e-01   +1.507231505554616e-01   +5.811379147179561e-01   +4.397047611035236e-01   +3.051356316975571e-01   -9.887208051875296e-02   +1.790541805827039e-01   +9.660551842886246e-01   +5.249896323005071e-01   +3.334272309968840e-01   -1.036375213364811e-02   +3.219638652659547e-01   +3.343302074738534e-01];
L2E_L1E_iAMPA_netcon = [+4.777878368521598e-01   -4.002199773808744e-02   +1.720677939946786e-01   +4.067411963225517e-01   +8.831877091657420e-01   +4.055331447704850e-01   +2.389062907972894e-01   +5.254120372412190e-02; -3.366692616786299e-01   +4.202509675568689e-01   -1.162692856311592e-01   +5.147023096050361e-02   +5.477389125071207e-01   +1.142025340551059e-01   +5.326948874278823e-01   +5.437570958722876e-01; +2.780871146110705e-02   +5.846298691390925e-01   +6.501484552571920e-01   +1.759904464364561e-01   +1.207248591869732e-01   -6.538864688467552e-02   +6.071088008298587e-01   +1.891939421352724e-01; +5.426005047839235e-01   +2.679916895916927e-01   -2.027736510561993e-01   +5.367395000606047e-01   +4.055998134388651e-01   +2.420497267912051e-01   +3.051827741703257e-01   -2.910478728428301e-01; -2.840136073326855e-01   +5.850695771771006e-01   +3.964515658189458e-01   -6.702492109330520e-02   +3.471682611306243e-01   +7.986176056151000e-02   +5.410570326687786e-01   +6.021001351673002e-01; +3.776578569395089e-01   -1.570267581937575e-01   +3.784882869884256e-01   -9.610579349018843e-02   +6.381245542630372e-01   +8.011215219503884e-01   +2.435432651445614e-01   +1.501984535696976e-01; +9.830853783505140e-02   +4.510351432662441e-01   +2.215083302508034e-01   +2.140457540550202e-01   -3.009352094662568e-01   +5.960210436586934e-01   +1.000000000000000e+00   -1.772341564940482e-01; -7.619209546730822e-02   +4.694735461030287e-01   +7.552658760062372e-01   +2.084652052479226e-03   +3.893198399475762e-01   +7.195997522217559e-02   +3.321294535697446e-01   +3.310202278646754e-01; +6.245834551831668e-01   +1.425388067131228e-01   +3.541671419376313e-01   +7.717791203632728e-01   +5.126194965102771e-02   +5.032749429840219e-01   +3.258496116942318e-01   +9.743006865965342e-02; +1.806688829452275e-01   +2.579507616313506e-01   +1.153016874923852e-01   +6.877308593813305e-01   +2.043769227653375e-01   -2.825767690061148e-02   +4.528989258936846e-02   +4.737434029016405e-01; -1.778919847376428e-01   +4.700180900051951e-01   +3.737798052123054e-01   +5.324331571017326e-02   +2.102551143812098e-02   +6.213223009619431e-02   +2.229626199905915e-01   +4.729662788079103e-02; +4.482333485103090e-01   +4.119264006842269e-01   +8.625915376830650e-01   +6.866513388105734e-02   +9.604523916240271e-02   +3.191726944776087e-01   -2.860836483986156e-01   +2.170339462975892e-01; -2.294044787562145e-01   +4.858158585147666e-01   +2.997054860383381e-01   +9.280013561751413e-02   +7.575291875449417e-04   +1.270142376999479e-01   +2.389027697066002e-01   -2.007009745103525e-02; +1.840813601086988e-01   +3.938316733278460e-01   -2.023119711362421e-01   +5.278741397142584e-02   +3.010916791423790e-01   +1.643549473941553e-01   +1.052762362468743e-01   +3.634359473912073e-01; -9.248495877690244e-02   +3.043216620651074e-02   +2.674733242027921e-01   +5.355910841846411e-01   +1.294961198126278e-01   +2.700408427919807e-01   +2.965915608454686e-02   -4.157230022833296e-02; +2.862952771886741e-01   +3.036709976840247e-01   +6.751889519419432e-02   +8.527463460852152e-03   +5.018433594506994e-01   +2.570339572571899e-01   +3.914217891706692e-01   +4.547622444592612e-01];
L1E_L2E_iAMPA_netcon = [+1.281096812241863e-01   +3.390283122683165e-01   +8.889904150611865e-02   +2.828150456014472e-01   +2.225335699918516e-01   +5.256141033847948e-01   +2.176862320261148e-01   +3.131645087114049e-01   +2.287606008787623e-01   +2.211887519221171e-01   +4.393389073187947e-01   +3.988529697612416e-01   +5.501241479589390e-01   -1.761466797957517e-01   -1.990921536870895e-01   -4.650246983133317e-02; +3.592973463490157e-01   -1.977465199642395e-01   +6.906517755173884e-01   +1.989821778946060e-01   +1.880205162568838e-01   +1.070246008769296e-01   +4.927626001378567e-01   +2.663961224486841e-01   +2.043954131053390e-02   +5.507404188410031e-01   +4.192546402329324e-01   +2.320194389800832e-01   +3.332561843290114e-01   +1.894925450026058e-01   +3.764440751586651e-01   +1.068817155208725e-01; +6.246733699033228e-01   +1.618031923339169e-01   +3.410425339844602e-01   +2.676656671851362e-01   +1.921152574867227e-01   +5.734770275785428e-01   +2.956709307297181e-01   +2.494607507481971e-01   +1.477989132702813e-01   -7.446687670652080e-02   +2.707017491497504e-01   +4.830421578280408e-01   +4.491923026411516e-02   +5.185969104427518e-01   -7.345857736380952e-02   -3.483514198975319e-01; +2.944234407044267e-01   -4.726856079783458e-02   +2.428630521051742e-01   +4.976944775214746e-02   +2.340692822588684e-01   +4.274180995193890e-01   +1.000000000000000e+00   -1.108639421906194e-01   +3.686000924782132e-02   +5.379065266867607e-02   +4.803908048889090e-01   -1.879416238952234e-01   +1.244516469600334e-01   +7.027597895483847e-01   +2.808129191717746e-01   +3.937542208551018e-02; +9.334585637263288e-03   -4.103337143137445e-01   +4.982916779148041e-01   +2.074786255979160e-01   +5.914811799339171e-01   +1.103218858462301e-02   +4.046293817927953e-01   +1.788149001104760e-01   +1.880419671911686e-01   +2.781347701471172e-01   -1.107636225390725e-01   -2.345410880904489e-01   +3.793335695080390e-01   -9.673656669533270e-02   +8.222878330505613e-01   +1.222947210306086e-01; +5.840987022375290e-02   +5.521970088119214e-01   +4.279340536902079e-01   +5.055774356643171e-01   +3.662610176777314e-01   +9.235169839453015e-02   +6.022213334837352e-01   +3.266108119174527e-01   +6.997093914103593e-01   +1.994829019325780e-01   +4.335751168511200e-01   -7.194867689524714e-02   -8.479815173055789e-02   -3.089268722401233e-01   -3.353627975618311e-01   +4.705996889280507e-01; +4.269616946006300e-02   +1.687474581758625e-01   +4.716317423594427e-02   +5.630476799312825e-01   +2.590004487524551e-01   +1.693535005367948e-01   +6.657666715086525e-01   +1.105400080002496e-01   -1.770335232976270e-01   +1.526135284479184e-01   -4.511640564242201e-02   -1.189084948714047e-01   -1.977273121715038e-01   +2.229291506138891e-02   +6.552470703575914e-01   +1.786618796466543e-01; +2.872313153257413e-01   +1.481107159629564e-01   +2.022444425066749e-01   +5.985053149984458e-01   +3.303916086032050e-01   +9.117944881034047e-01   +4.081078742262198e-01   +3.476463773202246e-01   +2.976568602595344e-01   +3.262842611969370e-01   +2.035913470091711e-01   +3.862788061875618e-01   -2.049251360581400e-01   -1.694320815621650e-01   +3.966331521688941e-01   -2.148502094507112e-01];
L2I_L2E_iAMPA_netcon = [+2.945470910886510e-01   +5.825007592347060e-01   +6.172892947353029e-01   +8.470231082900109e-02   +1.192730337683358e-01   +7.791131197260577e-01   +2.331797111133733e-01   +4.662608506581485e-01; +4.694739888797153e-01   +3.166277301717632e-01   +7.496029154417206e-01   +6.171484835210708e-01   +4.120875023083873e-01   +6.525480772727266e-02   -1.796042569308012e-02   -5.892245473307024e-02; +1.203053364049745e-01   +4.217699044527350e-01   +2.116799787848097e-01   -9.757249810361690e-02   -3.270567135302335e-01   +1.266648271069991e-01   +4.473375850683270e-01   +3.332717135452160e-02; +1.159383678805386e-01   +2.698256625352198e-01   +1.783994156778476e-02   +5.202630208890454e-01   +2.843981508248102e-01   -1.071893998377896e-01   +1.277675692407794e-01   -6.462000706766505e-03; +5.465641333177527e-01   +3.754049322989746e-02   +1.391822376003433e-02   +3.896762831624293e-01   +1.975480989011754e-01   +1.271488689984486e-01   +6.236977629397258e-01   +1.303107108238106e-01; +2.553517746792988e-01   +2.999260720289427e-01   +7.607027749925606e-02   +4.395231349097010e-01   -1.167900428000915e-01   +3.723348662469245e-01   +1.424262794292429e-01   +5.024389068497086e-02; +4.389201354144530e-01   +1.114813224774817e-01   +1.716060856612701e-01   +5.535715940795469e-01   +2.246292250194926e-01   -1.293954942583818e-01   +9.014121647874906e-01   +1.349743570891364e-01; +3.845594364445892e-01   +4.866547676947823e-02   -1.950762212603978e-01   +2.769761346199399e-01   -2.970153176282321e-02   -2.905879738359696e-02   -7.200116460937681e-02   +3.803719387308814e-01];
L2E_L2I_iGABA_netcon = [-2.132734874640775e-01   +3.199943151172910e-01   +5.939170040493345e-01   -1.915673362059096e-01   -1.775189234802964e-01   +2.142705952253089e-01   -1.645108895118025e-01   +3.403113535551867e-01; +1.660998961906562e-01   +2.973500925850253e-01   +9.626589030103166e-02   +4.787137315011306e-01   +6.270670095660116e-01   +2.296302764136242e-01   -5.646433214919609e-01   +3.274778166771104e-01; +7.388019553383009e-02   +7.465515659894595e-01   -1.397665789724470e-01   -9.433175775551728e-02   +3.464724977915855e-01   +5.885959830746119e-01   +1.296603123109062e-01   +7.420306584970545e-01; -8.990853653687414e-02   +2.786503076722717e-01   -1.880683465920216e-01   +6.395553901650752e-01   +7.334559795391331e-01   -1.273670211427842e-01   -2.961579230008228e-01   -2.038508753661136e-01; +2.724398100331481e-02   -2.069102636492000e-01   -8.567102583211135e-02   +2.950242083391447e-01   +8.672342368931709e-01   +3.956507032212514e-01   +1.328349986162823e-01   +1.767045016020953e-01; +4.182586589914822e-01   +3.518662468290574e-01   +2.186379773747097e-01   +3.270874754310985e-01   +2.119214979172446e-01   -1.817517059970145e-01   +3.457195599735257e-01   -8.362178947393636e-02; +9.230049599606346e-02   +4.679188123639649e-01   -1.659121513596475e-01   -2.125455019379477e-02   -1.123620571919923e-01   -5.837286584152133e-03   +7.555252316452077e-02   +6.987562271397122e-01; +6.017982995674487e-02   +4.779588613505058e-01   +6.282063708438683e-01   -1.097511088856675e-01   +3.847596780567522e-01   +3.024108432052152e-01   +3.400879627496153e-01   +5.629513165921836e-01];
L3E_L2E_iAMPA_netcon = [+5.076965434891417e-01   -3.837537078671134e-01   +1.890220490472851e-01   +2.697670662278001e-01   +5.560092604620978e-01   +1.706701575469589e-01   +2.134218614095336e-01   +5.365840936776535e-01   +1.314645741343130e-01   -1.575377784919959e-01   +1.429191722223153e-01   +1.074856980800228e-01; +4.067770850502876e-01   +8.301744219416655e-01   +1.322816133204943e-01   +4.776711570576201e-01   -1.132904097238473e-01   -4.976394591507753e-01   +1.229311034445524e-01   +2.143409889977612e-01   -2.104889371134384e-01   +6.685503840902612e-02   -6.488145653708879e-02   +4.925990934532246e-01; -2.541160349089248e-01   -9.293354125934496e-02   +1.928543400775174e-01   +1.627049318794998e-01   +8.515219973183428e-01   +5.159485237267379e-01   +4.733710991334684e-01   +3.523776122678860e-01   +6.410062664269376e-01   -1.977861628730367e-01   +3.150336434073404e-01   +6.529897433378512e-01; +3.277185854283698e-01   +2.954130498973287e-01   +2.384243703637795e-01   +1.321101021987863e-01   +5.405760179372350e-01   +2.393591230065702e-01   +1.996914469172448e-01   +1.001626843696341e-01   +1.629413051214011e-01   +3.736883010203931e-01   +1.746309263067160e-02   +3.086004924924097e-01; +3.391834577044392e-01   +2.269433643010749e-02   +1.791177838616978e-01   +2.205381590346888e-01   +8.663639907731691e-01   +2.136883106349877e-01   -1.096107251756647e-01   +2.674960608935016e-02   +3.727751553141911e-01   +6.187059131663133e-01   +6.882614451960047e-01   +7.234984160526436e-01; +5.987985348803652e-01   +6.730671235916130e-01   +1.351397570098015e-01   -1.743929658840294e-01   +2.231564383901763e-01   +5.078186911901394e-01   +2.001321313816643e-01   -2.689477270930571e-01   +1.163037025848544e-01   +5.759073377114254e-01   -2.818298088763050e-01   +3.319832810295566e-01; +3.359681148789206e-01   +7.245120816173453e-02   +8.500325310426040e-01   +9.874532084377317e-02   +2.472131559232073e-01   +4.275676339633362e-01   +1.179584039933199e-01   +2.644803137447592e-01   +4.391100972115822e-01   +5.723931695513944e-01   +1.090112489281087e-01   +1.656216092949048e-01; -1.813099955641371e-01   +8.723670271145182e-01   +5.043305167685797e-01   -2.758134009186687e-01   +8.625024749798246e-01   +5.319525417672097e-02   -1.804661264515801e-02   +5.233566737336030e-02   +4.474780876346524e-01   +4.593722164444658e-01   +5.579575697341796e-02   -1.121683647223829e-01];
L3I_L2I_iGABA_netcon = [+5.332832490420154e-01   +5.620929650832022e-01   +2.042282741257364e-01   +2.700287011995481e-01   -1.645270225225900e-01   +2.803947958882279e-01   +7.254583704061524e-01   +5.850180333706047e-01   +7.698652046736661e-01   +1.654083031378149e-01   +1.878094096060398e-01   +4.625796018621786e-01; +3.983188721469845e-01   +1.763421295731116e-01   -6.488322916120057e-03   +1.266150545823208e-01   +5.403272256329810e-01   +4.401962493530819e-01   +6.222275589692602e-01   -2.048307627220732e-01   +2.535498687530037e-01   +2.066272922553209e-01   +3.788893726924012e-01   -1.428759286394991e-01; +1.616461464104164e-01   +3.917954463503882e-01   +3.129237617153824e-01   -1.713520170665076e-01   -2.123388863364087e-01   +1.570437395474614e-01   +4.628051650219880e-01   +4.220306046424304e-01   +3.207952872727212e-01   +9.164620780014172e-02   -1.991527272636510e-01   +7.981440259473767e-01; +3.573336581071140e-01   +3.577415917718432e-01   +6.071705060199568e-01   -6.904204347248435e-02   +8.930557171998280e-02   +9.736947607168926e-02   +2.522564660839303e-01   -7.689255879115621e-02   +4.314406463145791e-01   +2.149058883525739e-01   +6.357372846508639e-01   +2.395220789876956e-01; +3.644692309230802e-01   +2.770762177069150e-01   +1.264111313955068e-01   +3.607585670792605e-01   +5.211303751470929e-01   +5.322633924653005e-01   -6.257414464419404e-02   +1.000000000000000e+00   +7.003922570635597e-01   -3.433131576335968e-02   +2.285042537048488e-01   +3.019334426005979e-01; -1.622115196415235e-01   +2.245260544046860e-01   +1.876792925684889e-01   +2.702301579509549e-01   +7.243842598205925e-01   +3.359492080541867e-01   +3.374059173301918e-01   -1.021576728936782e-01   +5.741431668993123e-02   +2.519130175946170e-01   +1.541968481334185e-01   +5.506911750016881e-01; +4.737720812151824e-01   +8.488566910482691e-02   +3.349716055468644e-01   +2.887861359217315e-01   +1.198036801912399e-01   +5.117768346951872e-01   +3.685860641622315e-01   -8.075724857880896e-02   -3.020879007405724e-01   +6.897991330549371e-01   +4.168055411342962e-01   +3.642420697137500e-02; -1.860184908494046e-01   +2.205023191325234e-01   +4.774453053259742e-01   +6.382312621002107e-01   -1.175070861240741e-01   +5.530719702334804e-01   +5.557177783247347e-01   +3.098532011320419e-01   +5.030431328920080e-01   +3.009692274757736e-01   +5.485334502873702e-01   +4.789600756299818e-01];
L2E_L3E_iAMPA_netcon = [+5.781786194194808e-01   +2.573239804401938e-01   +2.963640795070622e-01   -2.358858854748719e-01   +1.095314729690914e-01   +1.803682457139518e-01   +3.808958213366627e-01   +1.287721749162666e-01; -2.313873262520047e-02   +6.368860753334157e-02   +3.980742662370313e-01   +4.236762602817745e-01   +4.930306529791251e-01   -2.961444758706128e-01   -6.662594442919526e-02   -4.919128557570909e-01; +3.711938145827148e-01   -6.803836709756139e-02   +2.694078957397554e-01   +5.955201584453599e-01   +3.653099576056663e-02   -6.146162513714378e-02   +1.794318795056170e-01   +1.039212758296157e-01; +1.530190242870690e-01   +2.056017160908754e-01   +7.208746776781286e-01   +9.418504792746251e-01   +4.613716384878535e-01   +5.873405563831268e-01   +7.239738240606479e-02   -1.005144370301345e-01; +1.837394778602851e-01   +1.264552225486199e-01   +1.412844970235150e-01   +8.860120038051202e-01   +4.142394204738122e-01   -2.825184925594411e-02   -1.113096395281694e-01   +1.146469955540451e-01; +3.688271401813655e-01   +7.888952979078759e-01   +6.479365829095288e-01   +5.159258519023886e-01   +5.885268711706886e-01   +1.160623747956413e-01   +5.163509417273555e-01   +8.692114377833035e-02; +1.322855622787675e-01   +3.592267940984738e-01   +5.062206618240963e-01   -1.388376024736936e-01   -1.173151999399992e-01   +1.375939693184502e-01   +6.007915521597266e-02   +3.954774092758506e-01; +4.438403986017699e-01   +2.849047263291311e-01   +2.623894343532032e-01   +2.363994694032899e-01   +4.273861284117626e-01   +3.715033168322734e-01   +3.323358665736880e-01   +6.920248710124420e-01; +5.047683659754413e-01   +4.309653516910201e-01   +5.063762824727180e-01   +1.255752399266052e-01   +2.332745360850477e-01   -2.295465355473093e-02   +7.123580089309131e-01   -2.005969342026168e-01; +3.679551713049592e-02   +2.286487062395361e-01   +3.958049990023695e-01   +1.789544929527752e-01   +9.912242264304323e-02   -2.682672652077525e-02   +4.873544463630528e-01   +2.149697649958166e-02; +4.229412804385903e-01   -2.556510026749730e-02   -1.435761947184288e-01   +8.998669181204398e-01   +2.965650287939965e-01   +2.482090641390360e-01   +2.471243679682965e-01   +5.084975343064769e-01; +5.445917042775592e-02   +8.663503717013318e-01   +4.843719357831128e-01   +5.587585273688953e-01   +2.129763125807474e-01   -4.801828425479243e-02   +1.187827018823622e-01   +4.766843747746318e-01];
L2I_L3I_iGABA_netcon = [-1.686451882689921e-01   +1.886620169382724e-01   +3.918923507214126e-01   +3.812874668462987e-01   -2.533489435788715e-02   +7.480680063478682e-01   +2.753795056419050e-01   -2.938062793075938e-01; +1.954431909708294e-01   +1.750345694969436e-01   -1.202033351334597e-01   +1.365062864132990e-02   +2.993264622668520e-01   -4.453878235322223e-02   +3.149432152468060e-01   +2.386371964512043e-01; +7.833922257649726e-01   +7.303009143531821e-01   +1.740273923156346e-01   +6.261674195010009e-01   +6.878948330263164e-02   +8.180533020591902e-01   +2.300487674805500e-01   -6.545183045636735e-02; +1.794876087663366e-02   +4.468576070886923e-01   +7.477152967363794e-01   -3.955366365082550e-01   +1.485201384635471e-01   +5.756392160815889e-01   +8.746372645535881e-02   +4.859129337753177e-01; +7.332728678611260e-01   +3.074291807353124e-01   +7.762551815966368e-02   +3.869985134862166e-01   -2.438827985512960e-01   +2.355601548886294e-01   +1.519995044738932e-02   +6.749735100800303e-02; -2.834335445581779e-01   +2.994022988669179e-01   +7.581436296549923e-01   -2.587807250204209e-01   +3.633866547362962e-01   +9.687988520258649e-01   -2.687049851042081e-01   +2.480911817683787e-01; +5.375238419678794e-01   +1.162210960307949e-01   +2.542563087313185e-01   +2.157605052326113e-01   +3.339409188928442e-01   +6.560130566359658e-01   +8.388430881840298e-01   +4.970892872044500e-01; -3.304329015612907e-01   +6.768525339376935e-01   +3.121147496666265e-01   -1.567313924841222e-01   +1.354613562304909e-01   +2.962549762202635e-01   -1.800418287214055e-01   +7.844064962356916e-01; -7.998589167946131e-01   +8.243254090124055e-01   +7.394277903883131e-01   -2.403668067189031e-02   +8.647544155418482e-02   +4.724189628562188e-01   +4.377614675596864e-01   +3.322785057230072e-01; +3.086756786007360e-01   -4.125269615827728e-01   +1.801577269614354e-01   +2.510165892094721e-01   +5.736557307218761e-01   +5.493711189072576e-01   +1.743359779025109e-01   +4.836988280232392e-01; +8.462416977997843e-01   +4.401543481233755e-01   -4.031958987586950e-01   +5.803919427154625e-02   +4.111891855287182e-01   +1.128736114676115e-01   +5.057343524816341e-01   +8.843059805097200e-01; -4.034284898614600e-01   +7.367226042108180e-01   -2.095504592186110e-01   +6.239180434494155e-01   +6.087100986130728e-01   +3.645417046178783e-01   +2.287037052309554e-01   +1.422742637274341e-01];
L3I_L3E_iAMPA_netcon = [+4.899196284300101e-01   -8.938360284321371e-02   +3.169829003044070e-01   +5.442172050828797e-01   +2.839278724975859e-01   -1.870947443825008e-02   +7.415671644306493e-02   +2.100231679428665e-01   -2.394954631751613e-01   +4.441164688467343e-01   +1.596090771475322e-02   +4.624489838812480e-01; +1.485095511877117e-01   +9.431551866245454e-02   +1.837168710626749e-01   +5.946087525863030e-01   +3.247990653010064e-01   -8.620023046858853e-02   +2.284606581220313e-01   +3.212152705466351e-01   +5.122623846962053e-01   +5.926618499999479e-02   +3.360016838414272e-02   +1.495009776203216e-01; +3.966172375041265e-01   +6.111062312391446e-01   +5.031706697914190e-01   +2.751046297193886e-01   +7.134012998426983e-01   +2.062427483627917e-01   +6.658749846532512e-01   -1.282722719099413e-01   +3.729633531273570e-01   +4.631809742413265e-01   +8.824988490966590e-02   +4.810295457453732e-01; +4.797067093327262e-01   +3.926170565348305e-01   +5.451876563570802e-01   -6.412721290267273e-03   -5.568788637086051e-02   +8.944593179317617e-01   -2.430834857473811e-01   +3.462716092741141e-01   +3.341213747881855e-01   +3.476718261051367e-01   +1.000638757005510e-02   +4.001228145916964e-01; -2.728397346590518e-01   -1.641889405574399e-01   +9.211586801816680e-01   +3.380588804881413e-01   +4.399114412476238e-01   +4.628669197794654e-01   -2.190953101560867e-01   +3.722184606637707e-01   +5.155578637341186e-01   +6.689422367706486e-01   +2.613289924696964e-01   +4.686770087252904e-01; -2.247430405527746e-01   -1.232494138604298e-01   +1.516488032012944e-01   -3.624271023633025e-02   -1.988633605416229e-01   -4.177291508284599e-02   +2.809265972806398e-01   +3.080296053607101e-01   +2.416446944330586e-01   +6.254765803523370e-02   +3.099712909743989e-01   +4.176493719054972e-01; -8.478388619165028e-02   +2.096752474382981e-01   -1.453339471365553e-01   -3.734169209613095e-02   +4.365637813594290e-01   +4.506911939605965e-02   +6.181302479338401e-01   +5.209455762427870e-01   -1.669228400227784e-01   +3.187423198276724e-01   +4.919475550308641e-01   +3.018757612533286e-01; +3.186114536647913e-02   +3.257499586818253e-01   +1.339827870397669e-01   +6.924175643632700e-02   +8.217279442324510e-02   +7.945185387247662e-02   -1.364768911163766e-01   +4.856692536703516e-01   +5.901875384706702e-01   -3.473848095961835e-01   +1.234766292478734e-01   +5.929092452755095e-01; +7.517949086059275e-02   +7.538689161489999e-01   -7.237293005712636e-02   +2.182002231142693e-02   +2.351574042526046e-01   +8.185691812675934e-01   +2.583040575440776e-01   +6.745462921109547e-01   +9.455156577546148e-02   +1.406507182350424e-01   +5.398485274428525e-01   +1.000000000000000e+00; +7.783235887160453e-01   -6.425678196092660e-01   +8.934116426600717e-01   +2.704432080321083e-01   +3.581411038810070e-01   -3.205135810986695e-01   +4.482398442789235e-01   +9.324320698916010e-02   +1.057244352906546e-01   -5.720110536593857e-02   +9.771420241233417e-01   -8.106233535118910e-02; -5.028999529024297e-01   +3.341451224007262e-01   +8.316460457068474e-01   +4.539021531908121e-01   +1.963356106093105e-01   +1.811667293669522e-01   +3.736129558844510e-01   +2.665013022856578e-01   +7.997581578600940e-01   -2.465708108082736e-01   +1.570243571146736e-01   +3.910709190895683e-01; -3.161747364363670e-01   +1.160371170001864e-01   +1.223942040647107e-01   +2.318275527133674e-01   -2.320644967630260e-01   -2.611056214838465e-01   -2.540832673238440e-01   +2.711060691706238e-01   +7.244822812283511e-01   -1.898057171327429e-01   +1.356492028900488e-01   +1.905646251575545e-01];
L3E_L3I_iGABA_netcon = [-7.205085329793399e-02   +2.006844969979355e-01   -1.767998066206892e-01   +2.056875178865428e-01   +1.075180423299600e-01   +1.045916802495282e-01   -4.982944998467141e-02   +2.765898490982895e-01   +1.593656679559136e-01   +2.742065493934494e-01   +2.597590773858627e-01   -5.977484218753811e-04; +3.972827236500076e-01   +2.466608405451067e-01   +9.657246326698957e-02   -2.172215471654370e-01   +3.455218333697828e-01   +1.041485081995402e-01   +6.629567065090125e-02   +3.047395706246495e-01   -2.965326351775373e-01   -4.732045261896434e-03   -1.211760690933486e-01   +2.456391311303487e-01; +7.821775078555045e-02   -4.552598752051801e-02   -1.563357508932137e-01   +2.457325912440987e-01   +2.791938349471808e-01   +9.469939239242908e-02   +9.906748987981738e-02   +2.089341275459020e-01   -9.293459267572178e-04   +4.517704156290266e-01   -4.027448478594504e-02   -1.618680560978904e-01; +1.338690660692003e-01   +3.205866839328477e-01   -2.442997769963712e-01   +2.007551871575664e-01   +5.436714918701531e-01   +2.554126997769038e-03   -3.433392158573929e-02   -1.081889919872920e-01   +7.711205694568452e-01   +4.559349080440407e-01   +1.794141234772817e-01   +1.467894113511557e-01; +2.128680339132183e-01   +4.613837718688988e-02   +1.633736456950279e-01   +2.254424874951320e-01   +2.299828168940267e-02   +1.698421785139384e-01   -2.880991003135138e-01   +6.229322694981051e-01   +5.469883780787659e-02   +4.002939382509849e-01   +5.125099464188215e-01   +3.962439272433150e-01; +5.429541010706735e-01   -7.513800636067685e-04   -1.442576220613198e-01   +6.230534776938852e-02   +1.530199061151895e-01   +1.883854757946328e-01   +5.942442245140164e-02   +3.138680748632223e-01   +3.971362021446780e-01   +3.431576596533435e-01   +1.350160490151074e-01   -3.389879478959106e-01; +7.081332630753520e-02   +2.675831815636820e-01   +4.842938254347633e-01   +1.000000000000000e+00   +2.920749068259011e-01   +2.303891692692934e-01   +5.901806274450413e-01   +2.594082316887969e-01   -1.135009455427541e-01   +3.920725147721562e-01   +4.506836164053774e-01   -2.726164080154248e-02; +2.336134765068702e-01   +1.410200918272423e-02   +6.458925560506421e-01   +1.842315905975755e-02   +2.266195137436533e-01   -6.611539351756270e-02   +3.083828229657353e-02   +4.268826845447415e-01   -6.014518835769841e-02   +8.555100091480658e-02   +2.522156365910051e-01   +3.422945004244208e-01; +1.914396335899570e-01   +1.492514509953281e-01   +3.067158322906259e-01   -1.590515743842012e-01   +1.281983626773287e-01   -1.315541841630217e-02   -1.636790099189077e-01   -8.314342354802717e-02   +3.292418093113099e-01   +5.325786239623368e-01   +4.597723510939600e-01   +5.128732351168600e-01; +1.149991816341271e-01   -1.058355600638244e-01   +4.999453784466601e-01   +1.986611204204099e-01   -2.711088851812507e-01   +4.084820341513852e-01   +2.727114745209308e-01   -9.471817463985865e-02   +2.230106994600525e-01   -3.272089967055563e-02   +1.717764123022804e-01   +2.786833423466480e-01; +9.375045954335570e-02   +2.195408518156182e-01   +4.044372286460649e-01   -1.394595672981921e-01   +3.038437694979267e-01   +7.854883899513808e-04   +3.151892049005839e-01   +1.418538497406291e-01   -1.569388807683175e-02   +6.697176488431018e-02   +3.326663323719851e-01   +2.760747661173694e-01; +4.156227960945753e-02   +3.817177898578971e-01   -4.786918963663740e-02   -3.361342574088408e-02   +8.245703383404676e-01   +3.552170573588931e-01   +5.356721107899318e-01   +1.406471055093566e-01   +8.038368045759051e-02   -2.873238692536001e-01   +2.790281714739049e-01   -1.300239554707683e-01];
L2E_Input1_iAMPA_netcon = [+6.807386287323123e-01   +8.188394051696842e-01   +9.223422796367396e-01   +8.156655682485338e-01   +7.494974537811210e-01   +8.244976218541726e-01   +7.313166938400220e-01   +7.425777100747121e-01];
L2I_Input2_iAMPA_netcon = [+7.186714333003521e-01   +6.640025282290173e-01   +8.246408820372697e-01   +9.564793005856034e-01   +2.447254855176029e-01   +9.278448065708187e-01   +1.836139855047558e-01   +1.861223738872831e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
