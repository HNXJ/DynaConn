function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.259239605560333e-01   -3.678726113732487e-02   +1.353205770190448e-01   +2.380137864639537e-02   +1.379806766310311e-02   +8.208611206863797e-02   -7.924363762751449e-02   -1.717486955950844e-01   -3.516884478623729e-01   -8.810098524521506e-02   +2.127225925924164e-01   +1.610707195466370e-01   +4.199996115933820e-02   -1.580074524750829e-01   +8.790087104282152e-02   -1.638055515196568e-01; +2.653101453065052e-01   -1.652729178068454e-01   +1.602932585744592e-01   +1.043858768975228e-01   -1.788082805500683e-01   -6.668363000016186e-02   -2.299079999648913e-01   +9.429426050513665e-02   -2.858390789087722e-01   -7.297051834185880e-02   -6.357265280975496e-02   +1.106819418020741e-01   +7.306864358094854e-02   -7.600708956466351e-02   +5.723612398234577e-02   +4.251329660525735e-01; +1.454339249535878e-01   -3.468537479023960e-01   -1.286331926037324e-01   +6.593981584376957e-02   -2.260507664282249e-01   -1.049268792761929e-01   -1.008337957865228e-01   -1.353950083080494e-01   -3.621272433900481e-01   -1.743238737612737e-01   +2.637348652372088e-01   +1.493415045665106e-01   +3.721312901553661e-01   -1.273411029010469e-01   -1.467377194209358e-01   -5.558574869966649e-02; +9.728180894417932e-02   -3.558381683170714e-02   +4.313846510574421e-02   -2.337393295327254e-01   +3.000265943775086e-01   -3.853962483139408e-01   +2.413387716267479e-01   -1.416813281695273e-01   +1.731001984739785e-01   -2.199039065737421e-02   +2.992842919213159e-01   +5.413821061052589e-02   +2.480815282258918e-01   +9.209254292776585e-02   +2.740863289303905e-01   +1.594265083532605e-01; -3.538922605825353e-02   -9.440864216729328e-02   -3.450182305846480e-01   -2.401940550962299e-01   +7.212042962513898e-02   -1.978734635576079e-01   -1.762969227006728e-01   -6.247888353938220e-02   +1.313036786567212e-01   +2.731699431625476e-01   -5.520947641348967e-02   -5.212447704682547e-03   -1.666021956946599e-01   +2.082057202160503e-01   +1.232286593028983e-01   +6.610708926401634e-02; -7.372593834428906e-02   +1.105428306947664e-01   -1.819751208887823e-01   -1.820835140791652e-01   -1.426130646970774e-01   -4.616876798812411e-02   -3.228694746896602e-01   +6.241177954444311e-02   +1.205910410406647e-01   -3.094481993545842e-01   -6.914180399024286e-02   -1.527801995939660e-01   +3.282564072617968e-02   +8.041861367358921e-02   -2.932237007194968e-01   +2.378390480222785e-01; +7.072626168167868e-02   +6.857039088409267e-02   -3.816845279651991e-02   +1.849168864051034e-01   -1.490472433116547e-01   -3.420078278480517e-01   +2.233077039772143e-01   -1.008237370170719e-01   -2.749141146651244e-01   +3.469574179235353e-02   -8.935552858488177e-02   -1.882409627183693e-01   +1.334238874294510e-01   -1.021425482367053e-02   -1.319824599899687e-01   -4.957651877775347e-02; -9.386748028795031e-02   -9.962812930497494e-02   +1.426238549244268e-01   -1.056092921820367e-01   +1.305991190753886e-01   -1.285828673648901e-01   +4.458199907458548e-01   -7.755649723593748e-02   +3.031469089624221e-01   +1.225396756229630e-02   +1.966279455706823e-01   +2.176607642818899e-01   +2.042887335836641e-02   +6.445910614880095e-02   -2.027730104051968e-01   +1.903280393367115e-01; -2.256154267450406e-01   -1.816858970741408e-01   +3.125435253552878e-01   -2.361976370600717e-01   -1.906330266374421e-01   +1.699002421197549e-01   -2.084976034034688e-01   +1.113345018064561e-01   +3.692962489599174e-02   +1.657069628249297e-02   -6.970700643530330e-03   +1.429551308800051e-01   -6.929505333363203e-02   -3.750957219721518e-02   -2.835529446167195e-02   +2.765615176611433e-03; -1.555138758066302e-01   -6.909448036317786e-02   +6.418682012791491e-02   +4.082722940653755e-02   +1.960059532548345e-01   -2.388383610887958e-01   -9.019992885220204e-02   -4.391486527132908e-01   +1.810870342120947e-01   +5.496411850583598e-02   +4.192829196792165e-02   -3.121996895201604e-02   -2.203319382335566e-02   +1.594801561985781e-01   -7.036504051176859e-02   -1.142939432407767e-01; -2.401380162938366e-01   -2.331660765717396e-02   -1.698227988723630e-01   +2.586350194686394e-01   -2.951918996298830e-01   +2.297851384631298e-01   -1.779896324183126e-01   -1.671925215761166e-01   +5.081455917357224e-03   -2.123445817300033e-01   +1.085446872383095e-01   +9.898193246506427e-02   -3.549884790423352e-01   -2.670311261599770e-01   +5.613682082745781e-02   +1.162097756496436e-01; -1.522514322120186e-01   +8.426547220569677e-02   -9.195746143811452e-02   -3.219433603923885e-02   -7.514537093097381e-02   +3.252018285621983e-01   +3.557032319248773e-01   +1.208673512829432e-01   -1.773136386212985e-02   +3.687479116164244e-01   -2.055131719827863e-01   -2.878526271180107e-01   -1.495876722725663e-01   -9.209207318971052e-02   +7.415014925365539e-03   +1.914490886285174e-02; -4.746071566623268e-02   +1.002015085995415e-01   -1.337998953678901e-01   +2.341754995855746e-02   -2.978176423179815e-02   -4.026044915068158e-02   +1.349809948390341e-01   -1.002349601825963e-01   -2.906901626033854e-01   -3.868340252202910e-01   +1.592493960859152e-01   +1.132238065848919e-01   -1.227339464053818e-01   +1.521236793861533e-01   +2.016106282503478e-01   +8.094606203397219e-02; -2.428965243788777e-02   +1.695133424044537e-03   -1.818560383520748e-01   -1.729656583755033e-01   +1.042663154074258e-01   -7.118340169043723e-02   -9.913589491692917e-02   -3.216795688954001e-01   +7.043032924324850e-02   +6.926764814236012e-02   -1.043286324552552e-02   +1.061062037273794e-01   -2.995932941946685e-02   +7.365837830725597e-02   -1.945537966710568e-02   -1.736848596022198e-01; +2.472004217369631e-01   -1.654474590628749e-01   -7.372590172776144e-02   -1.332949551207914e-01   +3.070781853158527e-01   +3.125548946676863e-01   +1.061024970351797e-01   -4.016117245445332e-02   -3.599567928982266e-01   -5.257878632099580e-02   +1.622212364479595e-01   +2.399847380885511e-01   -1.539875862103737e-01   -1.222104906046863e-01   -3.474794362811466e-01   -3.924847001334757e-01; +5.476507859469251e-02   +1.439266168666972e-01   -1.905463319704129e-01   -2.725449820061881e-01   -6.374028199593539e-02   +1.143185919270490e-01   +2.251861400817272e-02   -3.657110508208810e-02   -3.007187081837364e-02   -2.785511744357400e-01   -2.973128084564413e-01   +1.902112738359434e-01   -6.904009467283351e-02   -2.527399500590979e-01   +2.821978530857605e-02   +1.526768021059461e-01];
L1E_L1I_iGABA_netcon = [+1.402021384796305e-02   +1.176692833891072e-01   +1.390856813485246e-01   -3.601503116313418e-02   -6.108404281819559e-02   -1.185275423085762e-01   -3.414780815776119e-01   -2.496916299733782e-01   -3.873965371710843e-02   -1.407525810200223e-01   -1.089242542726196e-01   -1.709842603788515e-01   -1.587711959257339e-01   -7.181364832649778e-02   +1.424497217179975e-01   -1.528043153628724e-01; -1.279339707559460e-03   -1.071969844170866e-01   +5.913131701808190e-03   -9.943176951308771e-02   -2.100715959687050e-01   +4.897233758023493e-02   -1.928193083145029e-03   +9.859622386218153e-02   -1.292702175125545e-01   -5.225870455896153e-02   +2.339592543504618e-02   +2.916845100154576e-01   +1.639344545351190e-01   -3.051996404646352e-02   -2.882120111259506e-01   -6.130069360537912e-02; -3.385182118953606e-01   -3.020079002742163e-04   -2.124842991204336e-01   +2.935374349125814e-01   -9.586902933779461e-02   -2.107763670885188e-01   -1.203790823538329e-01   +4.155679084946745e-01   +3.192622181985450e-02   +1.371350705113100e-01   +1.117514828111724e-01   -2.400875190186021e-01   -2.805397058312563e-01   -5.796527285034333e-02   -1.157933458506713e-01   -9.725971626424013e-02; +1.323824257540233e-03   -2.064869318657283e-02   -1.231453763878027e-01   -6.793462012460141e-02   +1.895958380377974e-01   -2.079448077781205e-02   +1.204309882678101e-02   -6.127329664901800e-02   -2.237720890259937e-01   +1.684304523167992e-01   -9.232852491964370e-02   -4.440710429867682e-02   -1.135143409093177e-01   +3.531395149484255e-02   -7.240353613014198e-02   -1.654074769918566e-01; -2.195906317156471e-02   +1.552552901371955e-03   -2.087461676152193e-01   +5.434613879619980e-02   +1.508713278917884e-01   +9.942438241276026e-02   +2.565760736701504e-02   +1.956436718889981e-01   +1.875741566518559e-01   +4.395569940831588e-01   -1.938373594357088e-02   -1.158284680153031e-01   +2.426177692074933e-01   +2.692986833816038e-01   +9.004495205087838e-02   +1.073691694071177e-01; +1.692438422168563e-01   +1.929144587243116e-02   +1.238284793199079e-02   +5.358767829288633e-02   -2.318451379282806e-01   +8.309717378481198e-02   -6.277158042809171e-02   +2.465117288035714e-01   -3.734172557344159e-02   -1.196062006757242e-01   -2.154962636081889e-01   -1.065741992425702e-01   -7.363729536844320e-02   -2.270468312016011e-01   -3.665040271571410e-02   +2.646870426069949e-01; +2.071577383373122e-03   +1.006757208661476e-01   -1.670190709951131e-01   +2.366378578011273e-01   +1.927351599719643e-02   +3.996657442164844e-02   -2.067936801529560e-01   +9.383155276100624e-02   -4.207679090660287e-02   +1.005323050935007e-02   -7.824502473100918e-02   +1.676710686917177e-01   -1.350260099860207e-01   +8.550934827538177e-02   +1.137747081446046e-01   +1.122623689907724e-01; +2.816928399016853e-01   +1.151307800270397e-01   +2.515069905124111e-02   +1.220460636084177e-01   -4.468114868987591e-02   -2.720098803039684e-01   -1.848758688311255e-02   -1.510423172698730e-01   +1.018566048079927e-04   +1.833868494366137e-02   +2.110930281155444e-01   +6.807109250922577e-02   +8.173930773538721e-02   +2.193944140270819e-01   +2.146746410486613e-02   -3.741640697654379e-01; -1.104104828401500e-02   +2.468278582676384e-02   -4.532226998570305e-02   -2.243877380738832e-01   +5.183358403749157e-02   +4.977804418105140e-03   +2.536206977126917e-01   -1.704567621867544e-01   -2.554295408502100e-01   -1.758249164091980e-01   -1.685186884547506e-01   +1.044495380582529e-01   +3.714438886384391e-02   +1.215522295161514e-01   -2.127662451692820e-01   +3.193247545009506e-01; +2.036665826243163e-02   -1.089703942134539e-01   -2.820622264854948e-02   +1.730156986983766e-01   -9.752379949208280e-03   +8.317201491898055e-02   +1.706953210045947e-01   +2.431113851161002e-01   -2.858452389850408e-01   -1.731135059483749e-02   -1.500328553015025e-01   +4.442862828196288e-02   -4.423859371318925e-02   +8.325729857608852e-02   -1.095520023253015e-02   +6.230078123590617e-02; -1.086682288681377e-01   -2.218590166070225e-01   -2.314742392502172e-01   -1.710463907986324e-01   -2.217471575657746e-01   -2.017103719706407e-01   +2.368439816137302e-01   +3.303613971301702e-02   +1.107471564188398e-02   -3.049734475904625e-01   +2.916948798013231e-01   -8.725867352008193e-02   +9.668338324016557e-02   -2.215081109245275e-01   -4.764483956261305e-02   +1.562675896501613e-02; +1.783317395220331e-02   +1.016577663595992e-01   +1.269279188840892e-01   +1.479591120085166e-01   -1.313287397203250e-01   +3.167453141183662e-01   +2.022803258917634e-03   -1.306010339513299e-01   +2.376531846452320e-01   +1.339970801542940e-01   -9.077157975763311e-02   +5.504169414834569e-02   -6.179012841657754e-02   +4.441005117608753e-02   -2.653395109814673e-01   -1.118161474318140e-01; -2.070270500332820e-01   -1.084186161022115e-01   +8.905412541892249e-02   -5.468649750164155e-02   +2.015109920089408e-01   +1.480818665121412e-01   -2.797771735508501e-02   +8.854070004643863e-02   -3.033102516145090e-01   -2.692192181502593e-01   -1.643545301557050e-01   +1.317405116072367e-01   +4.382035511888223e-02   +2.757723324997914e-03   +2.804009616601841e-01   +6.466814971934610e-02; +1.858723918245476e-01   +1.024813028224722e-01   +2.759566901889455e-01   +7.207430262762138e-02   -1.116992854467497e-01   -1.641010915549743e-01   -1.467015150645838e-01   -5.574789406292819e-02   +1.760787703589455e-01   -2.697767525062052e-02   -1.949866580172108e-01   +5.490142372290342e-02   -1.471036428331185e-01   +1.221177944013974e-01   +2.657331975929171e-01   +1.946745612210303e-01; +7.616672819304444e-02   -9.997126669533597e-02   +3.880740751290097e-01   -9.549613079118344e-02   -4.560151512489886e-02   +9.015805957820354e-02   -1.647176631022040e-02   -5.402545949695680e-02   +9.268962607462773e-02   +4.320724106835358e-02   -1.268200076845052e-01   +6.509073929128943e-02   +2.852995670582805e-01   -1.959397148032583e-01   -2.792720329825529e-01   +1.830494377137878e-01; +2.249827383828290e-01   +6.189431013731951e-02   +2.309808962270900e-01   -1.161165749529409e-01   -1.207105535567944e-01   -1.234112916348308e-01   +2.964406283101752e-01   +1.219628726241177e-01   +1.133225014733980e-01   -2.756459389615695e-01   +2.411114979860334e-01   +1.733384028270536e-02   +1.385507745087102e-01   -1.001971626570200e-02   +8.647736423009332e-02   -1.284424031009737e-01];
L2I_L1I_iGABA_netcon = [+2.638725551588929e-03   +3.609382381697964e-03   -1.877106678872764e-01   +2.069139834351049e-01   -1.890614562102743e-01   -2.227334181227362e-01   +1.977048036602099e-01   +3.790586300168529e-02; +4.824458737520864e-02   -1.285377508287404e-01   +8.616186640900235e-02   -1.583866408640548e-01   -1.614526620924694e-01   +2.099776430877062e-01   +2.970766732281441e-02   -1.816030700836345e-01; -1.849256729858967e-02   -2.820239461204115e-01   -1.331915147937394e-01   +3.918780781258728e-03   -6.449138333244094e-02   +9.806780315578446e-03   -2.974786923922219e-01   +5.649651930496488e-02; -1.622276260779491e-01   +2.365308762167082e-01   -3.188838404578158e-01   +3.745792785087887e-01   +1.292461099399732e-01   -6.281509635083955e-02   +1.648514179238715e-01   -1.708094582996990e-01; +6.801591674462688e-02   +5.403231483662713e-02   -6.395538881960298e-02   +1.526619496123348e-01   -4.549218152537782e-03   +5.906338222575585e-02   -2.296307294259748e-01   +1.530961953149277e-01; +3.102257264431422e-01   -1.552587866816436e-01   +3.562636811667596e-01   +1.405016609733885e-01   +2.158514805456243e-01   +3.223543917061866e-02   -1.336038054031706e-01   -3.859493979108456e-02; +2.871106805182189e-01   +1.082991461789677e-01   -5.158938741106493e-02   -1.836042380997524e-01   +2.742746152280243e-01   +3.445889682524260e-03   +3.174112153684733e-01   -2.193172552347002e-01; +1.824767718169031e-01   -2.693039801696427e-02   -1.031448460252852e-01   -2.013370819429127e-01   +3.458474789263895e-01   -1.451555304073732e-01   -2.929151099529207e-01   -4.398730678957189e-02; +5.536168127426101e-02   -2.839957924523187e-01   +6.845099722305281e-02   +1.207059377392229e-01   -2.006308627669637e-01   -4.060285654371311e-02   +1.621572725645235e-01   -5.717702063560974e-03; +1.193277276745913e-01   +3.166544345139952e-01   +1.129302173372037e-01   -2.894197839171377e-01   -5.906452714604567e-02   +1.486319774647308e-01   -1.058966045851992e-01   -5.013414626107572e-02; -1.266164736447340e-01   -1.534975183455733e-01   +9.093686315493027e-02   +4.107396050533017e-01   -1.937394975709327e-01   -2.160403553563697e-01   +1.305094227769271e-01   -3.504498162229121e-02; +2.158623441717563e-01   -1.344384501481577e-01   -1.299473653624895e-01   -9.057800444392404e-02   +2.460717892602745e-01   +2.678842352258778e-01   -2.243305093427859e-01   +7.787057845927044e-03; -2.877212970162369e-01   -5.371380240401048e-03   -1.577681635975375e-01   -9.994773660153529e-02   -2.487599589360300e-02   +1.877936772528509e-01   -2.315738356632717e-01   -1.411935074833900e-01; +2.454252321697403e-01   -5.939106880392290e-02   +7.009893176592832e-02   +9.418672816242279e-02   -1.123560933315429e-01   +3.653014370265609e-01   +3.628428810469581e-02   +2.073638196080314e-01; +2.064761671897968e-01   +1.308996507788370e-01   -5.494156744403256e-02   +2.453022281513166e-01   -2.332805675832629e-02   +1.732104954160432e-02   -1.372724922134838e-01   -1.710943673186068e-01; +1.334275021194088e-01   -1.277035142080376e-01   +2.356064699333418e-02   -2.965087211237047e-01   +6.395544474683040e-02   -1.692962994522113e-01   -1.634728667967530e-01   -1.457724369994862e-01];
L1I_L2I_iGABA_netcon = [-7.182899302945260e-02   -7.174946038128420e-02   -6.777156641469756e-02   +1.234718241932320e-01   -1.907608239045367e-01   -1.537100727609941e-01   +1.403443240622081e-01   +6.323612980421567e-02   +3.064042350866563e-01   +8.081569844591052e-02   +1.818054403382448e-01   +2.289349214872554e-01   -1.941121044993722e-01   +9.454457562889029e-02   +2.271099001073446e-03   -2.447149206012070e-01; -2.774802846766804e-01   -2.622033780343360e-01   -9.635717698521454e-02   -2.469140887340616e-01   -2.066351893364464e-01   -2.873531727018761e-01   +1.749003030188181e-01   +7.459715766132656e-02   -6.628302032275615e-02   +7.187343551790384e-02   -1.601965033144825e-01   +1.595463047796760e-01   -1.034835673505279e-01   -4.100927605728714e-01   +1.131001059372056e-01   +1.080135327194743e-01; +2.625824076125486e-01   -2.374360287364917e-01   -9.421602149646827e-02   +1.022726544251175e-02   +3.392907640076159e-02   +2.389021868286756e-01   -4.109410737867338e-02   -1.739994304443820e-01   +2.011064206645654e-01   +1.508653829140577e-01   +1.114636844163985e-01   -1.297437021115906e-01   -1.544583627852853e-01   +2.586446939386923e-01   -2.837547196915053e-01   +8.508315702269582e-02; -2.853200883918944e-01   +4.060153256058033e-02   +1.428484095471904e-01   -3.843362523693305e-02   +1.456449717903170e-01   -1.352785628718411e-01   -6.788238838410526e-02   -3.163552856599733e-01   -6.119868393091635e-04   +9.967631909123822e-02   -1.932874005825005e-02   +2.555731242812725e-01   -1.338795217114967e-01   +8.522583313282703e-02   +8.213291956602933e-02   -4.147717149341317e-01; -5.337502262544661e-04   -7.176983088015204e-02   +4.201753985014048e-01   -3.035160021529058e-01   -5.567874147257519e-02   +4.745744393784782e-02   -1.946531114081647e-01   +2.193205314478409e-01   -7.726542056803169e-02   +1.578961685698172e-02   -8.562912542576906e-02   +2.654911958914263e-01   +1.832637935142916e-01   -5.439562249416584e-02   +1.462698938893762e-01   -2.265249317495816e-01; -6.965565046878107e-02   +1.605878312532062e-01   -1.502149789214192e-01   -3.614016574595108e-02   -1.869451635861377e-01   -2.285192786837378e-01   +1.192769734239205e-01   +1.517941259450887e-01   -2.480701821471669e-01   -1.969499373388805e-02   +2.095414966484315e-02   -1.260301622811008e-01   +1.699821781132059e-01   +1.432344807391247e-01   -3.157759190492442e-02   -3.525687659057365e-02; -6.248632753201369e-02   +1.399229702660862e-01   -2.422411200809096e-02   +3.498628976896255e-01   -3.592251555915821e-02   -6.526829408958436e-02   +2.121667327320745e-01   -2.473587322997218e-02   -5.660053328958173e-02   -2.739038485693506e-01   -9.164102128314038e-02   +1.114139578307399e-01   +1.441258098781405e-01   +3.643881694911579e-01   +6.674628774575873e-02   +1.513394575414615e-01; -7.075973742140933e-02   -1.260254848032523e-01   +1.120253979468909e-01   +2.601417419542050e-01   +2.158105709161351e-02   +2.340465637263736e-01   +3.272688337105343e-01   -1.311863914949005e-01   -5.570564379226755e-02   +2.054126561292663e-01   +1.691294874539581e-01   +8.725375370463012e-02   -9.962840337250407e-02   -1.270971150163114e-01   +1.016066579012583e-01   -1.978114905858851e-02];
L2E_L1E_iAMPA_netcon = [+1.740197431171500e-01   -3.228316957183179e-01   -7.311049254204899e-02   +2.560232085150579e-01   +2.094176265203032e-01   +3.737573546724814e-02   +1.383431211643592e-01   -3.884707207016246e-02; -2.123691007584823e-01   +2.218985995007200e-02   +1.684002640821435e-01   +5.432187136577706e-03   +9.510953949788131e-02   +1.241092551297952e-01   +8.549289507560480e-02   -2.386329958423693e-01; -8.938867800057976e-02   -1.987155504445786e-01   +1.073515595577539e-01   -4.217378119021088e-02   +3.599906509668886e-02   +4.324444289838688e-02   +1.041970033743929e-01   +1.207146229061360e-01; -7.812594622740653e-02   -4.192206490177174e-02   +3.316995938564909e-02   +1.016897755170022e-01   +1.750861972661159e-03   +2.167673485510605e-02   -1.671848293818475e-02   -3.039700639552190e-02; +9.977574380328338e-02   +2.605475000336245e-01   -2.988802844949169e-01   +1.203103446588477e-01   +1.050797643065118e-01   -1.238086572475590e-01   +8.999461731948009e-02   +1.435525326928953e-01; +1.110528474281296e-02   -8.146122194895705e-02   -1.173912041665706e-01   -3.393481006940708e-01   -1.787252437148235e-01   +3.371049563995610e-02   -1.438203098493164e-01   -5.191562103589586e-02; +1.249723163461903e-01   +2.510258542936276e-02   -1.207699412489664e-01   +6.916977381039807e-02   -1.279684969893508e-01   +7.887190232646271e-02   -2.445442490157236e-01   +6.014636378803689e-02; -4.957007957019536e-03   +4.015320775653210e-01   +1.158683146769199e-01   +1.077488597676844e-01   -1.207153975635086e-03   -2.162772219919408e-01   +4.148808450123007e-01   -1.005013183975327e-01; -3.027993865399392e-02   -8.699452508689978e-02   +1.787050351069874e-01   -2.243432462979745e-01   +2.913033455567164e-01   +2.769910354935101e-01   -1.089621720632818e-01   -1.871518728814202e-01; -2.968102380345428e-01   -3.419568947830517e-02   +5.239303929166010e-02   -6.913664925533826e-02   +2.581629535353250e-01   +2.272435607873817e-01   +3.391536967066006e-01   +4.074976051840602e-02; +1.535741491883399e-01   +1.347036048653550e-01   -2.977706700353429e-01   +4.740995669762347e-01   +1.299221388084276e-01   +3.646783980863715e-01   +3.340286022383259e-02   +2.022297638381156e-01; +1.264278238627841e-01   +3.882502947855013e-02   +1.911305612736283e-01   -1.995136550453078e-01   +1.277040539844407e-02   -1.768966164845832e-01   +7.701062588081370e-02   -1.213908337789402e-01; +2.010292198017438e-01   -2.768785689923625e-02   +1.402044788021527e-01   -1.312556121791322e-01   +2.051775728804827e-02   +9.731844680500451e-03   -1.698665874653523e-01   +2.375696979736567e-01; -1.376943531390286e-02   +8.096779270620615e-03   +6.121425295056399e-02   -8.983746285964681e-02   -2.578721223773637e-02   +1.119116569670077e-01   -6.631495912505085e-02   +1.301462318269553e-01; -1.681166493456904e-02   -2.620959932228519e-01   -2.803432954231211e-01   -2.324302296024126e-01   +2.083596673406467e-01   -2.502858509956968e-01   -3.043406011941816e-02   -7.033751639445769e-02; -1.767825672415994e-01   -1.129363427344574e-01   -5.800496769949463e-02   +1.403762952870666e-01   +1.122136688021245e-02   +3.242139089457431e-01   +2.228003542952353e-01   +3.893719300889553e-02];
L1E_L2E_iAMPA_netcon = [-2.037108668356450e-02   -2.021065397558353e-01   -7.157861687458780e-02   +1.530978913219798e-01   +4.084495760261988e-01   -2.665348807656833e-01   -1.923393141926759e-01   -7.384711898447117e-02   +7.028592071995715e-02   +7.769529115725779e-02   +2.721990815374044e-01   -5.980873231399594e-02   +1.974771083196961e-02   +2.319173257361499e-01   -1.055278642203075e-01   -5.919042732527047e-02; -2.549683491140750e-01   -9.597567069562372e-02   -1.447656341674369e-01   -8.386144290669365e-02   +1.920601818188349e-01   +1.609610395291693e-01   -1.762975457874147e-01   +7.800462532614043e-02   +1.948843507756231e-01   -1.560291012603869e-01   -1.862985938084022e-01   -6.612188781179050e-03   +2.649488608987354e-01   +5.781276763107378e-02   +3.276825497709178e-02   -9.541682685350544e-02; +1.783973217210726e-01   +1.691870736630561e-02   +1.795025693174267e-01   +1.379866059969573e-01   -2.743571278748587e-01   +3.616045108228135e-02   -1.434767940792535e-01   +1.081398504514745e-01   +6.173016945828558e-03   +1.151467584596183e-01   +1.710921808787805e-01   +9.276273222762069e-02   -7.615449646970231e-02   +5.180356209659733e-02   -2.102648284729269e-01   -2.264473170489094e-02; +8.144284823795890e-02   +3.278904304898513e-01   +9.992275548037274e-02   -9.751593794090976e-02   -4.573113342636511e-02   +1.523659262906011e-01   +5.101094301494362e-02   -1.756344048769065e-01   +3.238031778249130e-01   +1.013555278541345e-01   +2.301361015056292e-01   -1.325395927373017e-01   +1.381904059489865e-01   -1.686038568087696e-01   +1.415469748473434e-01   +9.416980552513107e-02; +1.889204287166046e-01   +4.325120248851240e-03   -2.374320450081459e-01   -2.048424451896050e-01   -2.492309735289963e-01   +1.424865475106337e-01   +2.538406469099516e-02   -1.218603886477871e-01   -7.795765712547453e-02   -1.830141331724703e-01   +2.753005360142787e-01   +3.000076603027412e-01   +4.802069219309268e-03   +1.430882653229977e-01   +1.934175127235632e-01   +1.205510014963772e-01; +1.761531614407637e-01   -2.667585340008962e-01   -3.936616911509501e-02   -3.922737008374522e-02   -1.473968898900098e-01   -2.363691315691338e-01   +3.192483433908800e-01   -1.543336791023153e-01   -2.276527481604657e-01   -2.196514790129999e-01   -4.659745626267808e-02   +8.238434879782232e-02   -1.087522793295583e-01   -1.574040033006575e-01   +3.240244881674259e-02   +1.415070190129053e-01; -2.003157235650473e-01   -9.387250342350946e-02   +1.576038009787567e-01   -1.361001082032361e-01   +1.872200718158190e-01   -2.104171071092314e-02   +3.391912770162060e-04   -1.660073649569555e-01   +2.969665451551501e-01   -1.523722263694981e-01   -8.320855064167805e-02   -7.791762827299484e-02   -3.139087743433115e-02   +3.462094745548923e-01   -1.972164359776696e-01   +1.963273405612295e-01; +9.593900780303768e-02   -2.235873186944054e-01   +2.427414902773364e-01   -6.453100351925388e-02   -1.358806881691069e-02   -1.013566815319542e-01   -5.482064005402376e-02   -8.087647041994425e-02   -2.468013105459722e-02   +1.051428612304993e-01   +2.295374647208826e-02   -2.970853300040412e-02   +3.316644652260847e-02   +3.331162046807833e-02   -7.762274317759246e-02   +3.085330677699986e-01];
L2I_L2E_iAMPA_netcon = [+2.863338413277087e-01   -1.717020995860191e-01   +9.194568536386520e-02   +8.262705912938317e-02   +6.827335128061171e-02   -2.494372491759552e-02   +2.342370829743718e-01   +1.626892920104007e-01; +1.846580191870138e-04   +1.385714818592577e-01   -3.813013101288612e-01   -2.211379840188784e-02   -3.495456579234178e-02   +9.363223973177742e-02   -3.008975592550796e-01   -2.874812159997555e-01; -3.182199404261532e-01   +8.621431326384944e-02   +5.437503391946217e-02   +1.236597758687545e-01   -2.679488399951384e-01   +1.922856721066227e-01   +9.744497370953178e-02   -2.342492372458561e-01; +1.597247815947698e-01   -2.338449716570520e-01   -1.661439833479673e-02   -4.623140775054301e-02   -9.174435353663624e-02   +2.360631130347288e-02   +3.939254474757401e-02   -1.113533910471025e-01; -1.465938783381747e-01   -6.126199093154946e-02   -7.160362376556928e-02   -7.093458731124595e-02   +5.271310780022560e-02   +6.281792773052233e-02   +1.504484450350784e-01   +1.387249047546121e-01; -3.774062416983413e-02   +1.812751240373144e-01   -1.220701445000787e-02   +2.819667934771418e-02   +2.067669303492927e-01   -2.216012539065081e-01   -6.239333850873001e-02   +6.104916239305667e-02; -9.515384571746932e-02   -1.509708762165098e-01   +1.919023699833199e-01   +1.232362304057018e-01   -1.458656927731227e-02   +1.192530679945022e-01   -2.970828927709480e-02   -2.136556882854966e-01; -6.481565333906772e-02   +3.939825784760959e-02   -6.243405882527866e-02   -6.478292604432379e-02   +2.853656556537311e-01   -1.442662520314676e-01   -2.078183635062432e-01   +2.479173898847902e-01];
L2E_L2I_iGABA_netcon = [-9.628783888903239e-02   -3.180504611426321e-02   +3.797702931639847e-02   -2.536982025239295e-01   +1.186138964628461e-01   +1.038799206476843e-01   -4.038110322247655e-02   -1.824128078733563e-01; -9.826274222532333e-02   -3.277867689631923e-01   -2.842913434792212e-02   +3.023328543168392e-02   +1.000535446214305e-02   -4.207145594738919e-01   +1.068166535099647e-01   +3.161630212554807e-01; -2.236759717854470e-01   +1.612409250814879e-01   +1.862447147802876e-01   +1.509144835195068e-02   +1.034968242058572e-01   -2.463657448042624e-01   -1.141007445737808e-02   -1.237885206772848e-01; +1.747240593907328e-01   +2.788226255375341e-01   +2.183529024365482e-01   -1.568384440526386e-01   +1.114205951251648e-01   -3.109536559750538e-01   +1.951742284840917e-01   +1.020490441558905e-01; -1.306753821014820e-01   -4.003633698992308e-01   -9.825496966512250e-02   +9.654579123177051e-02   +4.021797000049510e-01   +2.103118477090394e-01   +2.049494553763388e-01   +1.663261362069265e-02; -1.925414327798002e-01   +6.236912793613181e-02   -7.007231922808518e-02   +4.214759505874219e-03   -2.321192470810337e-01   -1.131739397052620e-01   -3.034248259162665e-03   +9.335084728349569e-02; +1.375594538686545e-01   -1.478290455014495e-01   -2.530767025490253e-01   +1.319887230302486e-02   +4.009416892120354e-02   -8.772341894306100e-02   +1.818246696072849e-02   +1.268005786487818e-02; -7.659775948022465e-02   +3.283928018881542e-01   +5.934671773139712e-02   +1.204888546144294e-01   -8.424002749909484e-02   -3.364155737730819e-01   -2.948747509621780e-01   -2.047766429256610e-01];
L3E_L2E_iAMPA_netcon = [-1.085495402912612e-02   -1.764724399112405e-01   +2.791147716057514e-02   -3.627773506957966e-01   +4.134282651012065e-02   +2.482181495910343e-01   -1.467438764388546e-01   -2.634678228214716e-01   -2.654188814498181e-01   -1.040589624779466e-03   +1.517123543816861e-01   +7.146727629802521e-02; -6.442899597495558e-02   +2.568976243052151e-01   +2.367309939136023e-02   -1.294819404719396e-01   -3.125815405744755e-01   +7.807077106081786e-02   -8.136657156180860e-02   -2.725936085097510e-01   +2.913105073594102e-02   -1.941984334175376e-01   -6.848049524358982e-03   +5.523557272001033e-02; +2.053305076506180e-01   -3.107860025556651e-03   +2.204637407240704e-02   -7.838129404833916e-02   +4.236874655888926e-02   -1.857013913355916e-02   +2.025437375202988e-01   +9.170683722033568e-02   -1.333161056761990e-01   -5.299427751336681e-02   -2.944263503079380e-01   -1.718464821081725e-01; +6.190752340329259e-03   +2.867360598774551e-02   +1.746184640875560e-01   +7.150090401743983e-02   +5.118489034848689e-02   +4.626937756913997e-01   -1.096399370205123e-01   +3.251169357027140e-01   -1.055509457969614e-01   -1.492667361152824e-01   +3.403905796348642e-01   +1.243585063337894e-01; +2.113417734727278e-02   +3.177661228686837e-01   +1.942348311302471e-01   +8.753179680063120e-02   +1.546294367787874e-01   -7.260019074109052e-02   -4.204878079754942e-01   -1.769830082710118e-01   -5.508314549555042e-02   -2.570908030820541e-02   -1.004887231995192e-01   -1.285606753990899e-03; -1.634121875586867e-01   +1.929828633213037e-01   +9.252797711596421e-03   +2.783156531990054e-01   +5.182515357780926e-02   +1.006554763169046e-01   +8.161453769432225e-02   -1.197045083995738e-01   -3.060514336345465e-01   -9.652197617957298e-02   +6.814398591426207e-02   -1.243008105878087e-01; +9.941505532278651e-02   +8.241165473461373e-02   +2.508956782435265e-01   +1.022918030455258e-01   -7.332619531532872e-02   -1.504801264137644e-02   -1.605764971504904e-01   -3.164253848117166e-01   +2.892193777494879e-01   -4.962513900376874e-02   +1.634243401439996e-01   +7.909194486286043e-02; -2.018490527645976e-01   -3.085760922374311e-01   +9.086548585484173e-02   -1.087323519775713e-01   +1.490198872287067e-03   +1.507706265872349e-01   +5.493392465288142e-02   +3.166084303209013e-02   +2.172441141978791e-01   -6.279866543569224e-02   +3.086169573410529e-01   -2.852869011646776e-01];
L3I_L2I_iGABA_netcon = [+3.298545582097654e-01   +2.690563678954559e-01   -1.783216801687067e-01   +1.473216970895178e-01   -2.302381518283128e-01   -3.281728971284261e-01   +1.686040434612329e-02   -1.208034958335333e-01   +9.956828851960536e-02   +1.350835853740679e-01   +2.248128220528476e-01   +2.698055510541107e-01; +2.518254722794262e-01   -1.380829891832095e-01   -1.900691097085039e-02   +2.773184771006050e-01   +1.577556790165494e-01   +6.629165688983070e-02   +1.221234104442052e-01   -9.185743249961076e-02   +6.647936624464572e-02   -5.436467141008763e-02   +4.115921511704569e-04   +2.851761375753806e-02; -1.902222467719254e-01   +1.981473874945808e-03   -7.105601787460857e-02   -1.405997216440177e-01   -6.667301155061537e-03   -8.502032595535641e-02   +6.116739321224281e-02   -1.584118959777104e-01   -1.317510809356239e-01   -2.673667687636928e-01   +7.290566242579002e-02   +2.306459767352552e-01; +6.790599950207410e-02   -5.691387999827310e-03   -1.256381404816055e-01   -4.126436339090679e-02   +2.297368640867936e-02   +1.259777654102261e-01   +2.875718257391466e-01   +1.151945088607392e-01   +3.126646678949942e-01   -7.647956788379269e-02   -9.051125208016628e-02   +1.094910208799360e-01; +2.045422391382232e-01   -6.555661805602048e-02   +1.957535504878979e-02   +1.690821258764119e-01   +9.372803144120670e-02   +3.163561830116082e-02   -3.342682254098777e-01   +2.828501120462811e-02   -3.865597646893321e-01   +1.872826952902162e-01   +2.820384712993092e-01   +3.102337415600631e-01; -1.583833829725314e-01   +2.387268287783197e-01   -8.202222578980978e-02   +4.735999582749997e-01   -3.395025954631654e-01   +5.738251957313305e-02   -2.872295581732633e-01   -1.457592806602800e-01   -1.753839496454491e-01   +5.265256129183514e-03   -1.150439945170034e-01   +3.062658355650386e-01; +2.702785012719641e-01   -2.041209115492516e-02   +3.576475862207999e-03   -1.466392895598034e-01   -8.908164676570227e-02   +1.456287981401256e-01   -5.246747108438608e-02   -8.757493052417442e-02   -2.257088859099284e-02   -1.295730053861448e-01   +3.938501759938497e-02   -2.531820021282666e-02; +5.539922106931244e-03   -8.851582903936421e-02   -7.351998912939578e-02   +7.692219888953590e-02   +3.863882379424396e-01   +2.171050124582317e-01   -9.066940860854691e-02   +1.210233092599678e-01   -3.712123436633925e-02   -1.870469957411861e-01   +2.238709115591973e-01   -1.002181123119571e-01];
L2E_L3E_iAMPA_netcon = [-9.892718936992737e-02   +2.015874341806146e-01   +1.169601517961997e-01   +3.992156410928684e-01   -1.307881264182049e-01   +2.351489324127549e-01   +2.098474241424406e-01   -3.327984644935050e-01; +1.522065842003347e-01   -2.782815908700178e-02   -2.096475265185759e-01   +3.577197981321535e-03   -1.276123452418006e-01   +2.072242442491948e-01   -1.854569210987634e-01   +5.034764585644354e-02; -3.278540901345283e-02   +1.534779092212754e-01   -9.507294916455042e-02   +2.947343883194610e-01   +2.455928757803379e-02   -8.900289980241564e-02   -1.862788813491254e-01   +2.637904733789412e-01; +3.049370216379694e-02   +5.700814432772131e-02   -1.337800464272461e-01   -2.411165421598920e-02   +7.696822851714374e-02   +9.645946218723273e-02   -1.546243544708786e-02   +1.035863892023046e-01; +1.419898869503421e-01   -1.417970144771482e-02   +7.054754321288646e-02   +8.258521736810551e-02   +8.862310097083964e-03   +1.759228247590945e-01   +1.444018106764335e-01   +8.276498985884392e-02; -5.349763014687647e-02   -6.742473111647841e-02   +5.027738004269026e-02   -1.348566061726964e-01   +1.285521731290958e-01   -4.919186332898513e-02   -2.534586895238357e-01   +1.204235589521330e-01; +2.106435628133448e-02   -8.491676166290775e-02   +8.327355182838853e-02   +7.704618467265203e-02   -8.315055708356812e-02   +1.276255419113328e-01   -2.649818848521796e-01   +6.340960440759184e-03; -1.064940438457232e-02   +1.122362400249342e-01   -1.106202834126372e-01   +5.253672456117545e-02   -1.639220438479126e-01   -9.236232977164695e-03   -1.513081929566784e-01   -2.992135960047313e-02; +6.337220808532711e-02   +3.489488838419443e-02   -2.016660676125313e-01   +2.854597057884447e-01   +5.804900480864495e-02   +1.833674604334369e-01   -1.703881038035510e-02   -1.211166600457814e-01; -3.454051506170230e-01   +2.052011942833548e-02   -1.096611145660251e-01   -1.570668602150287e-01   -6.643481951132707e-03   -7.540627269932115e-02   -3.174553525648139e-02   +2.404691712734680e-02; +3.834753735111149e-02   -1.057170640494564e-01   +1.647731390897003e-01   +1.829754280557688e-01   +3.199086513448310e-02   -1.305077301448213e-02   +2.768045282565690e-02   +1.462730150307304e-01; +7.942636116495884e-02   +8.966726823664301e-02   -8.240870845411859e-02   +1.067674890175068e-01   -5.425662072029369e-02   -1.275718734334987e-01   +1.559797831907262e-01   -7.123099150199652e-02];
L2I_L3I_iGABA_netcon = [-4.349339938938603e-02   +8.845190936087416e-02   +6.398330775660677e-02   +9.529541320985067e-02   -1.634955729765457e-01   -1.337866719147655e-01   -2.084737064728325e-02   +5.710370772709535e-03; +4.665757181134918e-02   +1.099204621863040e-03   -3.871695820914502e-01   +4.373998668449090e-02   -6.644171602354365e-02   +7.611059869496689e-02   +1.517846636196043e-01   -1.969116532381436e-01; -1.387409449894745e-01   -4.467692644736700e-01   +1.174625031880389e-01   -1.014171538884105e-01   +4.371703922746907e-01   -1.902373137194431e-01   -3.409186699597405e-01   +6.085848949195884e-02; +1.015058549962964e-01   +5.331408593497338e-03   +1.824538955861498e-02   -7.360059208248151e-02   -2.442147166880322e-01   -6.203782812612013e-02   +2.122568597759499e-01   -5.841030898050251e-02; -3.383388380473399e-01   -1.261227835035337e-01   -8.311940253423561e-02   -1.727094090337616e-01   -1.399880129073210e-01   -6.594466448074919e-02   +7.101269786315659e-02   +3.519972310337353e-02; +1.898195566102767e-01   +2.726968417604305e-01   -4.318193294399052e-02   +2.915595379254280e-01   -1.887859948801223e-01   +1.519537562193555e-01   -2.944202714140365e-01   +2.109080701233966e-01; -1.020841747916572e-02   -1.508440637283658e-01   -9.365438352240971e-02   +7.100395892578988e-02   +3.544505601489379e-01   -1.745942371054086e-01   -3.259091499300477e-01   +2.253632681259990e-01; -3.853281488534480e-02   +2.402523668007172e-01   +7.714111491903899e-02   +2.014344056729510e-01   -8.049561521851765e-03   +1.364026344918928e-01   -3.394737096302013e-02   -1.264321623340862e-01; -1.162285085697441e-01   -2.282477558406636e-01   -2.381509709775161e-01   +7.887780545473291e-02   +3.561361923636351e-01   -2.666735620432143e-02   +1.504268728640383e-01   -7.973618918450477e-03; +7.875044649433281e-02   -2.354871357268328e-01   +9.337095126085788e-02   -1.645344897093374e-01   -9.921537687469459e-02   +5.054895029455472e-02   +5.957537488419990e-02   +2.210541274916729e-01; -3.038217023208389e-02   +6.424826208794615e-02   -1.371640633547239e-01   +9.970879570900638e-02   -4.266925638160567e-01   -1.658304037073332e-01   -3.698406721244649e-01   +1.177878548732244e-01; -9.762678728461376e-02   -2.283939038219469e-01   -6.355486343001079e-02   -1.349129923610331e-01   +2.462007548069880e-01   -1.525937635644681e-01   -4.766693250247099e-02   -4.345041099901056e-02];
L3I_L3E_iAMPA_netcon = [-6.551229842290394e-02   -8.486362640466069e-02   +2.496743261204904e-01   +1.534546113772391e-01   -8.733371664538440e-02   +1.618859500276063e-01   -1.826384349148370e-01   -1.112139817422732e-01   -4.156018497948921e-02   +1.751686022600143e-01   -2.705142080317176e-01   -2.213432346668950e-01; +1.315177869623124e-04   +8.170754503487768e-03   +2.678693452080328e-01   -2.627340264716203e-02   -1.233676480470339e-01   -2.259963964418373e-01   +3.919150280593486e-01   +1.662138630224288e-02   +3.249236953082868e-01   -5.867267695799424e-02   -9.137513230909791e-02   -2.093349193289812e-01; +7.367747103220486e-02   -2.696179712556378e-01   -7.250153775898587e-02   +2.070279291525542e-01   +1.189565633183741e-01   -1.014982628716800e-01   +1.026929917371508e-01   -3.111690109447106e-01   -4.175518504028192e-02   +1.185384075961519e-01   +1.373419090082784e-01   +3.813939216656171e-01; +8.392531054655671e-02   -1.053819856262439e-01   +2.676508229940739e-01   +8.561874624391527e-02   -2.014958493691738e-01   -1.854371575402576e-01   +1.460289098673085e-01   +9.612902676573788e-02   +8.492200861250469e-02   +3.898649078998569e-03   -8.225775393789088e-02   -1.218534425732320e-01; -1.996317270744448e-01   +1.419458452064432e-02   -1.405683180717816e-01   -3.041207910315339e-01   +2.405248933819208e-01   +1.962198197777848e-03   -8.451582927917321e-02   -4.446878714657955e-02   +1.878906935286522e-01   +7.181646578817585e-02   -1.303725930021476e-01   +9.492603466727365e-02; +1.090662677848937e-01   +1.401653905456405e-01   -1.402063800237728e-01   -3.937834293419614e-02   -1.107113914190814e-01   -9.057774977482644e-02   -1.660654683284059e-02   +3.113215295658854e-01   -3.423150312766123e-02   -1.402382621981074e-01   +7.630774493332419e-02   +1.049594461839953e-02; +9.852981237779274e-02   -1.664200087164460e-01   +5.206277604809436e-02   -1.404643205870285e-01   +4.475847221627766e-01   +1.627879315467190e-01   +1.729006085276073e-01   -1.938884707430903e-02   -9.555136582557822e-02   -2.766896550119091e-01   -1.351260090459192e-01   +4.201175609897097e-02; -3.401855476212202e-01   +1.303236951194311e-01   +1.912842511527005e-01   +3.139918326844233e-01   +1.396532774292894e-01   -3.597985767030981e-02   +1.260365748810691e-01   -5.851720525483191e-02   +6.532093468560932e-02   +1.618103043103329e-01   +1.439250998671972e-01   +1.208753029387665e-01; -5.834110630187433e-02   +1.828888687158914e-01   -1.895678978196302e-02   +1.798257832098092e-01   +2.559292436376039e-01   +2.616113544045516e-01   +1.301309553682008e-01   +1.086324033453800e-01   -1.403455565897543e-01   +1.381612830619385e-01   +1.511878264026476e-01   -1.079706911542122e-01; +1.703978008537385e-01   +2.619167965028049e-01   +1.381310216244859e-01   -3.275567073813334e-01   -1.718934894209179e-01   +4.830686369259850e-02   -9.239090871397890e-04   -2.251864621984879e-01   +2.057767267701007e-01   -2.331269063257254e-01   +9.848664536632994e-02   -3.006419678625821e-01; -1.686757106212397e-02   -2.982267769872510e-02   -2.016168850256934e-02   +1.207971615027845e-02   +1.811523570490414e-01   +2.428461127431511e-01   -7.420564049492817e-02   +8.441798235895991e-02   -8.644164076586189e-02   -9.795593010118561e-02   -1.024268259469185e-01   -6.419814740090179e-03; +2.932279932128337e-01   -1.248610493198681e-01   -2.718151475184646e-01   -3.465268799245507e-01   +9.953142600938032e-02   -7.099532238927661e-02   -4.157539258498360e-02   +2.378964578733877e-01   +1.990354248451506e-01   -6.062674900135556e-02   -1.406454730317908e-01   -3.391249423001497e-01];
L3E_L3I_iGABA_netcon = [-1.524143578597954e-01   +3.268525344769673e-01   -2.137601802547065e-01   -3.011669801275580e-01   +6.414990729865047e-02   +3.454868990432079e-02   +1.439476982599588e-01   -4.264350135352857e-02   +1.870890992079175e-01   -1.125713927724425e-01   +4.507054703354976e-02   -1.441921055750494e-01; +1.328801995343499e-01   +1.811525304360920e-01   -1.249029175035438e-01   -6.336189114054244e-02   +1.553101301156955e-02   +1.766115886757124e-01   +3.782517567888485e-02   -2.240263849777737e-01   +8.043267756600692e-02   -1.874912182412745e-01   +4.184526400645898e-01   -1.187848006702437e-02; +2.641247495867825e-02   -1.485842537783676e-01   +2.755943423919759e-01   -5.289510686292676e-02   -5.309039361875039e-02   +7.674085136283273e-02   +1.554954609565372e-01   +1.089910662813961e-01   +1.714856539982808e-01   +9.343290914106230e-02   +1.523832134643019e-01   -2.062200856732302e-02; -6.462809185712644e-02   -1.039342014199437e-01   +6.519084125334716e-03   -1.115143416912624e-01   -1.777493683997300e-01   +1.372377933189649e-01   -1.383684827842424e-01   +7.902190310409837e-02   -7.367651748382434e-02   +2.441627898685863e-01   +7.881221116714529e-02   +2.656811256789101e-02; -1.847652480977355e-02   +3.862171643862322e-03   -8.842158959738437e-02   +8.638435204893252e-02   -1.022620944118147e-01   -1.276887754064374e-02   -2.793266585747112e-01   -5.100632800154423e-03   -4.426091498334765e-02   +4.243264965583004e-02   -2.595959165487714e-01   -7.959067390729641e-02; +9.129496796703468e-03   +1.056329929156141e-02   -9.573405057521933e-02   -1.152843572608924e-01   +8.306482891525929e-02   +1.244096045255376e-01   +3.189797804560450e-02   -1.548269411053616e-01   -1.965030321709127e-02   -4.826027953439255e-03   +1.889551937186259e-01   -1.461692154097040e-01; +3.162283621592488e-08   +3.849023834232555e-02   +7.854477381355213e-02   +5.773324021667887e-02   -2.130337224539954e-01   -2.539484888351012e-01   -2.851630961250197e-03   +7.140493620001116e-02   -2.138006837381949e-01   +1.788689531714891e-01   +1.500419823852788e-01   -6.752676734474823e-02; -2.654745796064879e-02   -3.477449050705305e-01   -4.856431435054259e-02   +7.347549217636054e-02   -7.471760071868797e-02   +1.382077675816814e-01   +2.658496875458616e-02   +1.164605639314004e-01   -2.202523767308031e-01   +3.239840127646800e-01   +2.102712053960794e-01   -6.068720805361931e-02; +9.675256663398915e-02   +1.455250464514393e-01   +1.622252725682312e-01   -7.013734667165243e-02   -1.237553517336609e-01   -3.481437191074785e-01   -3.156806401519215e-01   +3.919737807486400e-02   -2.695061348770740e-01   +2.658178123146669e-01   -9.149035828396344e-03   -1.595994534360418e-01; -6.850457666743950e-02   -5.364080202388662e-02   +1.678546924393747e-02   -1.080429666519256e-01   -2.057980952463186e-02   +1.667530066788108e-02   -3.668296214521047e-01   -4.561175517719306e-02   -2.408607916208602e-01   +6.226265218627805e-02   +2.073172858720014e-01   +3.205642742565815e-01; +3.473532846607097e-01   +5.311802947590654e-02   -1.636572362163192e-01   -1.964633104343317e-01   -2.525968962224557e-02   +4.796269497221872e-02   -1.009314481278949e-01   +6.204758059068159e-02   -2.905737410892255e-01   -1.234330271123111e-01   +2.016365820385677e-02   -7.293094291078225e-02; +2.704226865354148e-01   -2.671821303710564e-01   +7.636340195711473e-03   -3.857193127044350e-02   +2.577434554600802e-01   -1.821367642853314e-01   -1.198053105274447e-01   +3.198595620029882e-02   +1.933846005895178e-01   +1.676477625977148e-01   -1.773682690085017e-02   -9.040818735209769e-02];
L2E_Input1_iAMPA_netcon = [-1.452726049393693e-02   +3.697263598731372e-01   +4.467292243276311e-02   -7.080953552636549e-03   +1.033013326564236e-01   +2.814097296136545e-01   +1.165493454746020e-01   +1.574587794600641e-01];
L2I_Input2_iAMPA_netcon = [+2.369780561662518e-01   -1.954951055028477e-01   -1.622937413872684e-01   -2.101048714869726e-01   +1.925574669035012e-01   -7.584161464168196e-03   +8.719114995511443e-02   -1.351577312901098e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
