function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.207409426619814e-01   -2.027062556311498e-01   -1.678737889849499e-01   +1.426876008078440e-01   +6.740100971896279e-02   -2.547141116231655e-02   -4.302322727193694e-01   -3.137688242137481e-01   -4.569749665837773e-01   +2.368686162123819e-02   -2.150867686012424e-02   -1.606668831457478e-01   -2.974357791486747e-02   -2.862645533622569e-01   +3.012050619453927e-02   -2.894949345418506e-01; +3.472460051219013e-01   +5.712176374004796e-02   +4.476068973890154e-01   -1.745866689631234e-01   +1.379322551193788e-01   -2.431429625903304e-01   +1.630857328966510e-02   +4.279270913376019e-01   +2.437590054932593e-01   +1.009160129550421e-01   +7.585874264214429e-02   -1.617250334867711e-01   +1.252101488149187e-01   -1.512917317238021e-01   +3.164307071782621e-01   +3.370708201528979e-01; +1.506373382055539e-01   -1.728482137716919e-01   +2.062883964247959e-01   +9.925599814230476e-02   +1.085407340178395e-01   +3.248752880833506e-01   +4.692525780058778e-02   -2.385778049406413e-02   +1.164548315859683e-01   -9.938874935123305e-02   -2.129859557289926e-01   -1.373676934284695e-01   +6.214493024630085e-02   +1.604394356765297e-01   +1.230113964915129e-01   -1.652809874625990e-01; -4.643158744165447e-02   +1.385383851595584e-02   +1.648977673536825e-01   -1.415140043808021e-01   -1.184052965687545e-01   +2.233662751713452e-01   +5.037362202565945e-01   +1.658489910328064e-01   -2.962778014673777e-01   +3.087247345601842e-01   -3.186421376779324e-01   -3.272932209394011e-01   +1.158687945767489e-01   +3.181689205116185e-01   +9.491583108481533e-02   +1.985685523048576e-01; -2.630607633745843e-02   +3.016665470973562e-02   +3.983284037584373e-01   +4.042013594550121e-01   -2.754844773228318e-01   +1.903461714967276e-01   +2.828440826899038e-02   -1.017358947553836e-01   +4.111417416042226e-01   +3.128429842862980e-02   -1.382811060099067e-01   +2.336566084500196e-02   +1.139677404082455e-01   +9.984355116849809e-02   -1.581664543350658e-02   -1.976540612217693e-01; +3.786140393364085e-03   +2.444277679198885e-01   -1.850401083123226e-01   -2.031150909621062e-01   +2.997838145132478e-03   +2.390184388150305e-01   -2.199318000352625e-01   -2.503032445596296e-01   +2.160841951386197e-01   -3.697383873455432e-03   +3.490042121969372e-02   +2.565090854768403e-01   -2.468086806315037e-01   +2.434221324730032e-02   +2.726462581811098e-01   +5.288362406434395e-02; -1.977728607135189e-02   -1.284795974915310e-01   +2.546095199507831e-02   +2.853540155471794e-02   -1.895323513572336e-02   +1.783281385783523e-01   +7.955183053131279e-02   +1.228966522678964e-01   -3.512135012090403e-01   +1.534736522015029e-01   -1.981180761302478e-01   -2.378730173749877e-01   -2.948100417859215e-03   +5.168513264884560e-02   -3.055428388999558e-01   -1.083696326507445e-01; +5.316153503290905e-02   +6.454283183921239e-02   +3.320470710595269e-01   +1.396742991670686e-01   +1.459120668820343e-01   -3.300078104231817e-02   +9.854077759740894e-02   +1.625950418679782e-01   -1.013323777352085e-02   +7.806600833315397e-02   -3.069348161931879e-01   +2.839249978449052e-01   +2.688704839787354e-01   -9.837167431923968e-02   +2.094290299170849e-01   +4.937543680749038e-01; +2.724834908401469e-01   +2.812301004036543e-01   +7.738291626577515e-02   +3.800851292017716e-02   +2.343770535134826e-01   -7.555308860004872e-02   -2.663974449779314e-01   +2.161675352273981e-01   -1.166028194514194e-01   -1.692415759493181e-01   -4.558116299455220e-02   -4.037407324113383e-01   +1.813304705329080e-01   -2.183971829527450e-01   -1.068559116124029e-02   +7.275099164400493e-02; +1.482036466047207e-02   -5.835470661968935e-02   -8.337892005699650e-02   +1.636808141795960e-01   -3.550564586255536e-01   -3.068581760669026e-01   +1.100750644563298e-02   -2.643607883446363e-01   +3.009886982206261e-02   -4.032537508992788e-01   +9.730975823363489e-02   -3.771552726145608e-01   +2.665535620617465e-01   +1.636031396685299e-01   +1.466284365464636e-01   -3.145233718728967e-01; -3.452192260075705e-01   +1.572977825198746e-01   -1.631829150458226e-01   +7.563318051867572e-02   +1.269783420641760e-01   -1.554774751368400e-01   -1.224292787958139e-01   +3.905436680171319e-01   -1.091562998755816e-01   +9.182298168443111e-02   +3.264347878887324e-01   -3.540631050291815e-01   -1.106834823787789e-03   +1.378114392377111e-01   +1.568666487102785e-01   -2.506650642584265e-01; +1.667366760295910e-01   -6.133343792224793e-02   +7.887684909357291e-02   -2.282456752320312e-01   +3.093082368756384e-03   -1.020316022872701e-01   +1.635161378050614e-02   -3.156130851505014e-01   +9.352600369164518e-02   +4.680133601858574e-02   +8.407250405317938e-02   -2.085180749967957e-01   +1.289823937565339e-01   -2.765843794317865e-01   -1.941906613970498e-02   +6.997291249800291e-02; +2.561728036420904e-01   -2.515061574672590e-01   +6.297435169767596e-01   +1.289194358645776e-02   -1.034075455140668e-01   +4.384488486160230e-01   +1.378898042296411e-02   -1.088048410031868e-01   -3.356539051198146e-01   -4.950982121177222e-01   -4.918137769506473e-01   +5.226534150107631e-01   -1.727034112393076e-01   +6.074105723157829e-02   +1.426758621845805e-01   +8.114750750734548e-02; -1.769634310965562e-01   +2.289954843497787e-01   -3.069356225594772e-01   -9.866680401572070e-02   +2.347366313476765e-01   -1.929921894316886e-01   -8.579997064408901e-02   -9.428153262596970e-03   +2.276085309189971e-01   +1.078955831234861e-01   +6.532041413030598e-02   +2.562074530802488e-02   -2.294433063874687e-01   +8.775589080714391e-02   -1.494989319376191e-01   +1.762441317526213e-01; +2.468799286417609e-01   +1.518347888364262e-01   +2.428273452653775e-01   +4.225382056632510e-02   +3.492412552126345e-01   +2.908666850292286e-01   +9.629306412244708e-02   -5.501686024162658e-02   -3.673241145694152e-01   -5.410574717091970e-03   +2.039845899917202e-03   -3.523517170357565e-02   -1.767371273393318e-01   -3.437270281331603e-02   -1.564288410478415e-01   +2.669642913860115e-01; -1.298707617013012e-01   -5.270702312800088e-02   +2.812797095098224e-02   -2.018398395255493e-01   -3.190936076273247e-01   +1.040669216650059e-01   -1.115676404936522e-01   -5.283530929735770e-02   -6.620538290560096e-02   +3.062016233024359e-01   -1.610312644170693e-02   +9.580880228450682e-02   -1.602930830799274e-01   -3.321627681719282e-01   +2.042038567999012e-01   +2.860322860470951e-01];
L1E_L1I_iGABA_netcon = [-2.718958107619922e-01   -5.772047612597779e-02   -6.968210329593995e-02   -2.349462687477305e-01   +1.982467063254153e-01   -1.001566323502719e-01   -1.102694546758630e-01   -1.042443985914559e-01   +2.148390432269170e-01   +1.255146431442333e-01   +2.455969488053132e-02   +2.104760622479472e-02   +6.118002754259894e-02   -1.550044233272289e-01   -3.825282665285465e-02   +1.966381462686005e-01; -1.932102806371202e-02   +2.327132743169365e-01   +2.322136455067766e-01   -4.911712227459757e-01   -3.709026340293851e-01   +3.667677647088489e-02   +3.734764334662720e-01   +4.430033101793660e-01   +9.514118264910677e-02   +2.217180791929614e-01   +5.443547837035850e-02   -2.283019115453716e-01   -3.394653290142930e-01   -7.344515630919965e-02   -6.122597578268529e-02   -3.516249049629603e-01; +6.262392923957276e-02   +1.280541514305189e-01   +1.643213118517854e-01   +1.108239213308673e-01   -1.384025785962808e-01   -1.649493694181371e-01   +1.488740502319933e-01   +5.905277626359540e-02   +2.785114446436773e-01   +3.040491292230048e-01   +1.408683792395781e-01   +1.777524017360377e-01   +2.214948593199480e-01   -2.356507513058432e-01   -2.625937358706595e-01   -2.668388303199246e-02; +4.807220317461528e-01   +3.622738804181626e-02   -4.233714710082037e-02   +3.858290078764798e-02   +1.940110005233067e-02   -1.562095397052791e-01   +5.312830109469764e-01   -1.847971620805516e-01   +1.030128849398593e-01   +1.075258929459982e-01   +2.295672852398679e-01   -4.209990317291018e-01   -1.104105772220414e-01   +6.603576923771168e-02   -3.039406405602960e-02   -3.273069658199208e-02; -1.109892368009068e-01   -2.011794692124264e-01   +1.269114865185580e-01   +1.820688929044063e-01   -1.370507284465210e-01   -8.238550760542826e-02   +8.448177462494094e-02   +1.407876901511392e-01   -1.707601525934794e-01   -2.922924187559947e-01   -1.002218717099814e-01   +2.739153884086064e-02   -4.552075232444839e-01   +2.271767350182253e-01   -1.320074413677202e-01   -1.134424229021815e-01; +1.044908535458984e-02   -1.496792358961767e-01   -4.844425805856609e-01   -4.831888006106402e-02   -1.800289633164625e-01   -1.238792623122763e-01   -1.611031282654325e-01   +1.831318230664392e-01   +1.942914012963094e-01   -2.610855949193064e-01   +1.652327986331249e-01   +3.882687712343765e-01   +1.332098827587867e-01   -1.002310697372610e-01   +4.152386852564582e-02   +1.133704643797106e-01; +7.327204707249446e-02   +2.178350249723427e-01   +3.391260640435438e-01   +1.600350361782030e-01   +1.983838229267265e-02   +8.426852646831114e-02   +1.910503910916466e-01   -2.172754281849668e-02   -1.384250818306571e-01   +3.016927361607861e-01   -1.440078644387192e-01   -3.310764555554303e-01   +1.213296367879276e-01   +3.869018056475796e-02   -1.939659276936298e-01   -7.425958831257387e-02; +1.206204459643204e-01   -3.289775904316168e-01   +3.416600690781617e-01   +6.015545566925495e-02   -1.499346622990871e-01   +1.020865706808094e-01   -1.933504814262353e-01   -5.533316327754027e-02   -3.095486002429810e-01   +4.367008514954894e-01   +1.388515146367414e-01   -6.817785921791883e-02   -2.750341148369019e-01   +3.026974425373243e-01   -5.676894607144710e-02   +7.200584652082553e-02; +3.167732242748967e-01   -2.998773180201664e-01   -2.920213388534549e-01   -3.488674207323512e-02   +5.322966551825010e-02   -3.604481850152727e-01   -8.313191122220137e-02   +2.369026961854330e-01   +3.801709601185722e-02   +8.168853345289884e-02   +1.657933483493220e-01   -1.789771355507319e-02   -1.330295341261959e-01   -5.575384956749628e-02   +9.260221608395153e-03   +1.102864954601398e-01; -8.667467090142758e-02   -9.020449944614167e-02   -1.646541320605690e-01   +4.491934897425748e-01   +1.208309305799036e-01   +2.095746723038380e-01   -1.961412411169454e-01   -8.179383106910165e-02   +2.096561293837093e-01   +1.273214740162727e-01   +6.766685218492785e-02   -8.634106079238622e-02   +3.471238058646658e-01   -3.080479033478389e-01   -1.769203529366105e-01   -1.888823960044175e-02; -2.407251887403432e-01   -3.444527700702343e-01   +1.025744783326617e-01   +2.436140762212345e-01   +2.837996974618009e-01   -2.465491563946420e-02   +1.332312366193782e-01   +5.199271663707239e-02   -9.711239678833516e-02   -5.003935055359969e-01   +2.766199569940451e-01   -3.697665806835803e-01   +2.898017909694046e-02   +9.436405674513383e-02   -5.539386013347811e-02   +1.538378461192887e-01; +2.736423907117140e-01   -3.701382714540641e-02   -1.309520158907036e-01   +9.963653876404761e-02   -3.434910508201111e-01   +1.407287613063851e-01   -1.975373187541586e-01   +2.612253994051518e-01   +2.860494953208745e-01   +4.611628693303474e-02   -1.462750647909365e-01   -2.592098414673307e-01   +2.542219185042442e-01   +1.724373150161329e-01   -2.345748674706117e-01   -1.029611236612944e-01; -2.519334347250947e-01   +5.830884815059983e-02   +1.413565631620791e-01   +2.187447961038947e-01   -1.524771184048713e-01   -4.083388126498952e-01   -2.925468386111638e-02   -9.494400981351792e-03   +1.687514818381983e-01   +6.874586489688163e-02   -5.939801784913357e-02   -3.967065341300321e-02   -4.008116095133971e-02   -3.184693926592154e-01   -2.067646650974532e-01   +3.167262162292208e-01; -3.229169247608331e-01   +9.089798092024451e-02   +2.823225951616097e-02   -3.016561889935671e-01   +2.907488869052098e-01   +7.759079662126837e-02   +1.497671689348509e-02   +3.557088017972190e-02   -3.233956538297686e-01   -4.478333344478497e-01   +4.831070593257827e-02   -9.483702773394989e-02   +1.864773507789412e-01   +6.249555548998530e-02   -2.019790777295364e-01   +2.238793902994718e-01; -1.275457134490668e-01   +1.688342829218820e-01   +3.749128554594612e-01   +2.529868419667974e-01   +2.986891489535469e-01   +1.903364829726868e-01   -1.701566710762033e-01   -1.757222939370757e-01   +1.129062108860201e-01   +2.809436471805161e-01   -1.622494466413859e-01   -4.631860624749859e-02   +4.192919332459077e-02   +9.331774206524993e-02   -1.258863121720820e-01   -2.982404532748761e-01; -1.670716535568796e-01   +6.211486293849670e-02   -4.161615409024558e-01   +1.297137001017034e-01   +2.756298685151642e-01   -4.215046466716947e-02   +2.571545770898800e-01   -7.788144549848390e-02   -2.279972561026569e-01   +1.593375428971930e-01   -1.192567212471306e-01   +2.594517727322913e-01   +1.119967904845013e-01   +1.703579503869741e-02   +2.233097620997748e-02   -1.675098119500499e-01];
L2I_L1I_iGABA_netcon = [+2.030020730343782e-02   -1.902869771677323e-01   +3.902725043531894e-01   +2.217604275354499e-01   -1.916073946873829e-01   -4.519458368819727e-02   +6.644844993373286e-02   -5.109183079757598e-01; -5.403334620949313e-02   +9.121092345271739e-03   -6.517052602858765e-02   +1.616366387499043e-01   -3.394484094704970e-01   +1.621111243819846e-01   -2.059327745965346e-01   +2.702012086625626e-02; +8.093605230407115e-02   -1.906174411805338e-01   +3.819326197416902e-01   -1.343754769484612e-01   +2.556742436281603e-01   -5.353444878646295e-02   -8.623104487280972e-03   -2.085994714492662e-02; +2.687556503525854e-01   +4.071559948818840e-01   +1.804626016149897e-01   +1.292836870569307e-02   +1.433367704757351e-01   -4.677204073836710e-02   -5.773322308089582e-02   -2.015405073666883e-01; +1.824152068164441e-01   -1.861050268512370e-01   -6.730202350239738e-02   +1.787637082506497e-01   +3.479978757862776e-01   -9.002792474874788e-02   -1.812714313251139e-01   -2.479622989292211e-01; +2.860518158788622e-01   +9.761594017420983e-02   -2.497553692163858e-02   -2.401479905532560e-01   +1.833756023263650e-02   +4.588561204932143e-02   +8.864988453434547e-02   -2.297305488986750e-01; -8.674394764646740e-02   -1.322595945981676e-01   -5.306981383726020e-02   +1.858570780185134e-02   -8.483529631676731e-02   -4.397449252917637e-01   -1.522216854509120e-01   +3.821517487237632e-02; +1.172201836862673e-01   +1.268729371381420e-01   -1.454989808101870e-01   -8.549831666243786e-02   +5.694531418684956e-02   +9.725084925508151e-03   +1.152501696680051e-01   +2.810381707668113e-01; +4.989849276256748e-02   -2.092151103136621e-01   +4.198449021557329e-02   -2.510084497122426e-01   +2.288590585910644e-01   -1.647085831024352e-01   +1.949622784353305e-01   +2.131554423831177e-01; -1.020008829296380e-02   -1.327642785967723e-01   -1.878307879732572e-01   -1.388325184483362e-01   -1.143462852891060e-01   -3.720983039692274e-03   -2.048749258486707e-02   -8.893068659876999e-02; +6.145634144050276e-02   +2.230980270727646e-01   +7.381890269436350e-02   +4.649468065385604e-02   -1.626248129188846e-01   -3.540640348375198e-01   -8.325103268317818e-02   +5.159714713210718e-02; -1.479896713542273e-01   +8.663735049170829e-02   +4.117650137120175e-01   -9.295829865065887e-02   +2.014963547088127e-01   -2.294490390652574e-01   +1.361423907659886e-01   +3.036618675537457e-01; -2.081377731966752e-01   -2.042958343510556e-01   +2.431367934535331e-01   -4.022933334345185e-01   -1.051070604508212e-01   +1.417891793568100e-02   -4.105351095416706e-02   -5.550125106697557e-02; +2.867566814673692e-02   -2.430985097208158e-01   -1.535865552153621e-01   +2.659670482717151e-01   -3.808537576636346e-02   +2.909649130899052e-02   -2.313666542382619e-01   -3.353386526567835e-02; +3.822674138060797e-03   +1.559208563916015e-01   +9.932210949469944e-03   +1.501762973221091e-01   +2.573509091172159e-01   -1.258907858864003e-02   -6.849130285036027e-02   -4.719583575694994e-02; +1.756238229945393e-01   -5.179946614986495e-02   +4.740466638584664e-01   -2.228780969091553e-01   -8.289444232071719e-02   +1.332395850467428e-01   +2.504639114047716e-01   +1.733177309874633e-01];
L1I_L2I_iGABA_netcon = [+9.587859126295878e-02   -2.890075993245989e-02   -9.288302175109822e-02   +5.802876223104242e-03   +2.954036966944250e-01   +4.143218774960379e-01   -2.464273693940108e-01   +2.815322049406794e-01   +9.209146689504846e-02   +1.794499760723434e-01   +1.518066888835678e-01   +1.463606828859045e-01   -2.284366046006759e-01   -1.731934539473215e-01   +8.189118735000302e-02   -1.924027221822340e-01; -1.250899972774450e-01   +2.714421428501357e-01   -8.825753426161356e-02   -6.630259519784233e-02   +6.310720055634794e-03   -3.068216399917401e-01   -1.391697944025909e-01   +1.460968627242240e-02   -1.502110520492771e-01   -3.820363850661395e-01   +7.031092387487668e-02   +4.981169316877837e-03   -9.079077265244667e-02   +1.913655103766397e-01   -2.276178630834455e-01   +1.042045024468570e-01; -2.226720701070684e-02   +1.222013205407120e-01   -1.667382554628294e-01   +4.009139750712620e-01   +4.011058960355340e-01   -8.926993836862840e-02   +8.289513922505519e-02   -3.757455886215915e-01   +6.663693113261204e-02   +5.606332050198878e-02   -4.201828864161876e-01   -1.488210323491559e-01   +1.469101271194628e-01   -4.372043947874534e-01   +2.205737480557232e-01   -1.215879233628528e-01; +1.029973097694749e-01   +2.710255740960296e-02   +2.405383349936888e-02   -1.496968912322689e-01   +5.154053756678635e-02   -5.469004138608734e-01   -1.060500328514279e-01   -1.632950922486001e-02   +1.552190248267598e-01   -2.150638439899624e-01   +2.489822980895740e-01   +2.122389172936295e-01   +6.851256809746245e-02   -3.012904045975766e-01   +1.025364031592890e-02   +3.411882051749342e-02; +1.833253295667942e-01   +1.030964170071911e-01   +4.791100495994339e-01   +5.772812926743920e-03   +4.139978849786998e-01   +2.788815788009751e-01   +9.116196226205121e-02   +1.900835959964305e-01   +5.726508800872353e-02   +3.317578674695869e-01   -2.413510945172978e-01   +3.162063904887901e-01   +1.472062086186028e-01   +2.670458174467458e-01   -1.725898384818677e-02   -4.124026568423642e-02; +1.892214328913618e-01   -4.267924102591616e-02   +8.510997875700362e-02   -1.469840562150140e-01   +1.271233564882719e-01   +2.755189305119764e-01   -2.113656793027098e-01   -9.973127919917521e-02   -1.660292498837903e-01   +1.402643481075648e-01   -1.753504310353470e-01   +5.506203998440104e-02   +3.793077170069133e-01   +4.839179434538050e-02   -4.461612287595349e-01   -1.521435292294851e-01; +7.453844174832375e-02   +3.288838970146504e-02   -6.617636573467055e-02   -4.081641335538154e-01   -7.949637282684989e-02   +3.861408557720244e-02   -4.211746679174227e-01   -1.742918646032573e-01   -7.597082767202007e-02   -2.128933605896272e-02   +1.219715323281544e-01   +3.280407107047540e-02   -5.813710578259769e-02   +8.806707458997268e-03   +2.877889415503970e-01   +2.904290538025838e-01; -3.060063795027925e-01   -1.812319256335523e-01   +4.431386035195967e-01   +1.151717164540951e-01   +3.619458311122550e-02   -3.680500577351827e-01   -8.575529156986247e-02   +3.407465233545548e-02   -1.892117222715722e-01   -2.743903156381640e-01   -3.359243679407075e-01   +1.431695332332251e-01   -2.041742800207546e-01   -1.706245767710921e-01   -3.730172649329316e-03   -2.179408622047002e-01];
L2E_L1E_iAMPA_netcon = [-7.032387454719061e-02   +8.426943865572872e-02   +1.188332129416539e-02   -1.587867564221994e-01   -1.017078968647095e-01   +1.551562575621506e-01   -2.456150531332835e-01   -2.187362544799394e-01; +1.127805246301980e-01   -1.212111176910581e-01   -1.247309187975500e-01   +5.397918106078136e-01   -1.973174680017593e-01   -3.875180927328615e-02   -1.552856301506986e-01   -8.220038985720524e-02; +7.001267247580725e-03   -1.391958645002129e-01   -5.256403663101906e-02   +1.413867736408221e-02   -2.470558176605746e-01   -1.492089201367658e-01   +3.578406952554241e-01   -1.520136829792260e-01; +1.668460661286774e-01   -9.511296424746087e-02   -1.301481760181720e-01   +3.366356303703635e-02   -1.403659076196356e-03   +6.319658173317561e-02   +4.289929514920506e-01   -4.851229132956454e-02; -2.806277020165076e-01   +6.143188643677047e-02   -3.455924971095352e-01   -1.256676699808351e-01   +2.787966331284309e-02   +2.261984844391795e-01   +4.508780627412536e-01   -3.313837447438815e-01; +6.137501972562357e-02   -2.851980666104855e-01   -5.449704008070187e-02   +1.405483632993812e-01   -1.227057328459860e-01   +5.258323709150057e-01   -5.940828118883874e-01   +8.539260307262699e-02; +1.060962319342764e-01   -4.689457502336432e-02   +2.190337953569329e-01   +1.877070889492979e-01   +7.507460063450488e-02   -1.141919495370837e-01   -1.720844194783178e-02   +1.081638568322613e-01; -3.406372533584373e-01   -2.700595797457505e-01   +3.372287485679837e-02   +7.692650667464275e-02   +4.715519204772614e-01   -2.980535199614091e-01   -4.971328242388773e-03   -3.039045966417424e-01; +2.265273927608621e-02   +6.534783570596671e-02   +1.558978652552070e-02   +6.891476927896958e-02   +4.198228354862800e-01   +4.644970952498649e-01   +6.734520699358573e-02   -5.313294953648229e-02; +4.100963166962956e-01   -4.544003094551768e-02   +3.183090400964720e-01   +3.883982189408727e-01   -1.300996337700979e-01   +3.583059989520747e-01   -1.703873257433109e-02   +2.352489302585397e-01; -1.950516519672605e-01   -3.055334727097292e-03   +3.221053112853719e-01   -1.528928053420166e-01   -4.911939635705402e-01   +3.147783264180253e-01   +3.832065652529021e-02   +2.569101469005236e-02; -1.314946263135940e-01   +2.844968791815276e-01   -3.880919490105416e-01   -6.385881099736093e-02   -3.598604551903197e-01   -1.435005338339456e-01   +3.074462817914574e-01   -5.302981058045617e-02; -6.262106589163859e-02   -4.659558360300071e-01   +1.168458007928639e-01   -3.484983744602384e-02   +2.527264227921771e-01   -1.935366137392553e-01   -2.526824505748640e-01   -1.877982155492312e-01; -1.521831407017228e-01   +5.023065462526611e-02   -2.989233950667202e-01   +1.116354272719519e-01   +3.892389531452879e-02   -4.307829886140016e-04   +6.414962805975769e-02   -4.210673247318998e-02; -1.988879600840822e-01   +2.593327277891582e-01   +3.394380566169148e-01   +1.286215708265402e-01   +9.651049685398123e-02   +9.347977942054832e-02   +2.221714828411956e-02   +9.590180903378358e-02; -4.296181051642692e-02   -8.523325416254343e-02   +3.220642255769405e-02   -2.633697787652136e-01   -8.093433822819085e-02   +2.751312646258197e-01   -9.077695452499208e-02   -1.064271897620507e-01];
L1E_L2E_iAMPA_netcon = [+5.973961173506807e-02   +2.491286168187686e-01   +1.728051654034188e-01   -3.174319863653839e-01   +3.433116355211652e-01   +1.777349958892918e-01   -1.522241502846005e-01   -9.050942922455890e-02   +1.134747326087995e-01   -1.026123361007431e-01   -1.162520030341904e-01   -5.095181159326306e-03   +6.914956394694177e-02   -4.971417592178810e-02   +1.575283958370132e-01   +2.261625167740475e-01; +8.225887981734720e-02   -3.143954787341159e-01   +2.919450205736975e-01   +3.896200994874555e-01   -2.123293116513215e-02   -1.843473850502964e-01   -2.015781208898461e-01   -3.757054385297166e-02   -9.749626566110078e-02   -3.097615389138049e-01   -2.776577668823387e-01   -1.842615203258389e-01   +2.522262397924607e-01   -1.982355595223570e-01   +2.182198271513382e-01   -4.407044246541388e-02; +2.106503251022587e-01   -2.455376656917413e-01   -6.404655325430407e-02   -4.937394516433935e-02   -5.215377353782649e-01   +2.776820720514094e-01   -4.292530919326432e-01   -1.810216928667665e-01   -1.508249843896534e-01   +7.916157502282098e-02   +8.292006145788021e-02   -4.261318684042451e-02   +9.900801423019256e-03   -1.007497071019418e-02   -7.697229390923298e-02   +2.663410424725313e-01; -2.621534265502866e-01   -5.425718947760886e-01   +2.935300673779322e-01   -5.634666418470265e-03   -2.534566325885433e-01   -1.998703149047535e-01   -2.144890049744949e-01   -1.443015288959919e-01   -2.702700328185836e-01   +2.525326683563268e-01   +6.965701225238412e-02   -2.200669795862107e-01   +7.819737208777763e-02   -1.676897925015158e-03   -1.470588480087810e-01   +1.029338890442008e-01; -8.941406860858696e-02   +2.460502932156458e-02   +4.632572220878987e-02   -1.028552690566765e-01   +2.731141349789389e-01   +4.498464960658333e-01   -2.355608105186761e-01   -4.606934194259320e-01   +4.736429872403101e-01   -1.094952932449615e-01   -1.339114940362042e-01   +1.361416196064436e-01   +3.642167103132093e-01   +1.468643598479957e-02   -6.992372561730226e-02   +4.212740936680319e-02; +1.138059250128675e-01   +1.929260669830841e-01   -2.415941870722839e-01   +8.814727326009639e-02   +2.972730149045109e-02   -5.895477781642539e-03   +3.436175852400296e-01   -3.470803499608673e-01   -2.858422605909645e-01   +7.949468346901162e-02   -7.617774740762878e-02   +2.051665809202951e-02   +2.697951567695900e-01   +1.618474882557741e-01   +2.780835614702983e-01   +3.616094539716553e-01; +3.870505719026955e-01   +1.128182315162651e-01   -1.576936357420634e-01   +2.894194834301234e-01   -1.914335577880852e-01   -4.955790947427257e-01   -4.352031355708120e-01   -2.031161174159563e-01   +1.370844074990892e-01   +9.421411784214695e-02   +2.043314196904696e-01   +6.463720844564677e-02   -2.745093112335377e-01   +3.245356629677203e-02   +2.230421266276031e-01   +2.435265749407032e-01; +4.326441600297018e-02   +2.741287291660447e-01   -6.032586211393859e-02   +2.130068827260067e-01   -1.753006558426715e-01   -3.599626009580563e-01   +3.320570062525413e-01   +1.393092623175956e-01   +1.784285426758819e-01   +1.193540781439842e-01   +2.486778209276116e-01   -3.938610731540577e-01   +4.691521779211083e-02   +3.363937491970247e-01   +5.561875272437861e-02   +1.703578691513958e-01];
L2I_L2E_iAMPA_netcon = [+3.650958052756187e-01   +2.532531070410812e-01   -1.066923339934575e-01   +3.503436528286912e-02   +5.755462514147991e-02   +6.001860429552626e-01   +2.195316274744937e-01   -2.339514862776818e-01; -2.378039590837216e-01   +3.120466188067161e-01   -2.674613116882875e-01   +3.369087360805707e-02   -8.269255387582476e-02   +1.523835610589113e-01   +8.716168607740157e-02   +3.387279935356752e-02; -3.115321411837644e-01   -8.487951823240489e-02   -1.840140155788241e-01   -2.027934336324212e-01   -1.767394628219610e-01   +3.795453781574965e-02   -2.388123211756923e-01   +1.803703670453633e-01; +1.134740085723372e-01   -3.835253959307950e-01   -1.747102985413670e-01   -1.682456482866042e-01   +1.748067785046006e-01   +5.142724938558492e-02   -1.170234421924290e-01   +1.903446046987559e-02; -2.836474197309863e-01   +6.309798359567491e-02   -1.932039749423053e-01   +1.617396493897241e-01   +2.392106294612341e-01   +2.136078351207777e-01   -7.436811849154661e-02   -9.952120934508997e-02; +1.154756067504368e-01   -3.388125453224754e-02   -1.930052200283862e-01   -1.863723665171469e-01   +1.070489540800457e-01   -1.795532368929945e-02   +1.132999070629716e-01   +2.890687809921856e-01; -1.717838458261428e-01   +7.586352652545222e-02   +3.594243811891901e-02   +2.586512552064443e-01   -1.644206394902142e-01   -1.898902312023674e-01   +7.161628415581457e-02   +5.536416943681190e-02; +1.277620620236287e-01   +3.162157195607284e-01   -2.196099333760153e-01   -2.333089993159251e-01   +1.715879021577824e-01   -3.938055821833401e-01   +1.790748432746556e-01   -3.802088789569799e-01];
L2E_L2I_iGABA_netcon = [+1.058301987716722e-01   +6.266492933679965e-02   +9.877567359513011e-02   -1.504887374051930e-01   -1.211676308295863e-01   -1.415620404063320e-01   -3.960407911294164e-03   -2.405470605324354e-01; +8.707814956419598e-02   -2.541792138937058e-01   -1.741703114626325e-01   +2.504558416916877e-01   -2.252016827824949e-01   +1.280914364706179e-01   -1.183929276999297e-01   -2.491999409871037e-01; +2.103012976589111e-01   -6.701175630188620e-03   -2.331273986946791e-01   -1.753611838883543e-01   -1.281213645644735e-01   +1.170458427889353e-01   +2.030624876513707e-01   +8.565611246222982e-02; +3.981679757767713e-01   -2.966758026382844e-01   +2.339194380739180e-01   +2.088317859151840e-02   +8.922664859093413e-02   -3.061813993909185e-01   +1.066210865657519e-01   -7.844584085171147e-02; -1.820512591460975e-01   -3.350781925322663e-03   -1.977831935031360e-01   -3.454610224892454e-02   +6.641031283699841e-02   -6.521753545367527e-02   +2.982267297169741e-01   +2.752850487027583e-01; +1.618983680368047e-01   +1.566727374293731e-01   +2.820237784455548e-02   -1.356693352294773e-01   +3.339459880613906e-01   -4.882497064416938e-02   -3.288190297837963e-02   -3.327148536680019e-01; -3.657407687176486e-01   -2.519140643613246e-01   +2.539762288195273e-02   -4.133355093023821e-01   -2.022305343545728e-01   +6.916600163053745e-02   +9.036106659661058e-02   -1.584198229782512e-01; +2.022986878039487e-02   +3.337523954638939e-02   -2.640139639143713e-01   -3.973597766842810e-02   +2.213922026910299e-01   +2.282474177638832e-01   +2.176050748835480e-01   +4.235439319128381e-01];
L3E_L2E_iAMPA_netcon = [-1.451531528000955e-01   -3.700367320327513e-02   +8.172318729829189e-02   -1.942905901799296e-01   -5.206148942037682e-02   -1.718480967435876e-04   -1.004867429516134e-01   -2.495455259493588e-01   -1.629707624336026e-01   -2.602572591919545e-01   -2.319006103847374e-01   -2.105383989661526e-01; +2.233596676067992e-01   -9.683595362736923e-02   -2.948253090539447e-01   +1.269802187635453e-01   +2.001518285499838e-01   +8.586573306335568e-02   +6.415117253587207e-01   -1.943293628622315e-01   +6.223006092107072e-02   -5.750905848743333e-01   -2.845421962232025e-01   +1.886452875728702e-01; +2.404447101730225e-01   -4.914989486953822e-02   +3.799633353116624e-01   -6.316102157897131e-02   -2.642524580727768e-01   +2.622083765943114e-01   -8.182783639030294e-02   +2.209419366750049e-01   -1.443430463877527e-01   -1.462894960315257e-01   -2.400377980206475e-01   -5.380124554337125e-02; +3.552712997445790e-01   -8.554066102449091e-02   -2.135718898790978e-01   +1.621035171962047e-01   +4.889892309695129e-02   -1.021479388450161e-01   -1.022876407360301e-01   -1.136608160110193e-01   +1.438445420428648e-01   -3.862765996718655e-02   +2.475739745049804e-01   +1.521187518049980e-01; -2.171874697435616e-01   -1.964565936392750e-01   -5.302290149705260e-01   +9.439988813193186e-02   -1.167077434830005e-01   -3.021896479739759e-02   -1.061584855642757e-01   -3.675871521429172e-01   -2.499789588860753e-01   +1.614853667752992e-01   -3.780255492429069e-02   +1.144508217748865e-01; -3.712393844989343e-01   +1.206144620739522e-02   -2.241930696595837e-02   +4.204424873961012e-01   -1.902987006433285e-01   +1.989829071823964e-01   -3.528171791870210e-02   +3.244160629150530e-01   -2.042188512144752e-02   -3.000275366853556e-01   +1.229601596534599e-02   -2.332933637205381e-02; -1.139251430599436e-01   -1.379982914140384e-01   -1.143880078240408e-01   -2.895599376442875e-01   +1.634676385631884e-01   -7.467036805482870e-02   -1.656859324787748e-01   -3.766201569792403e-01   +9.241843978904776e-03   -2.583504481000832e-01   -1.084806337979495e-01   -1.337235054459484e-01; -1.168727089758169e-01   +1.595755333339754e-01   -2.877193520405588e-01   -7.193106952665157e-02   +5.793288171196390e-02   +2.486193393445376e-02   +3.822823468946988e-03   +1.211160506822295e-01   -1.903900857621714e-01   +9.022377765215317e-02   -1.376718397814793e-01   -1.327812627545518e-01];
L3I_L2I_iGABA_netcon = [+1.719817144162735e-01   -2.932316873922122e-01   -5.020766019890183e-03   +1.383050494918914e-01   -2.387997894676548e-01   -1.121372232386484e-01   -2.453749695200649e-01   +2.286064579352026e-02   +2.591767450751419e-01   -3.623179974965448e-01   -3.697688980057491e-01   -1.652483266986103e-01; -1.286987026118774e-02   -1.646087157559731e-02   -1.996929744826430e-01   +6.359088739629543e-02   -1.998580236833197e-02   +3.097883771151790e-01   -1.714043027784954e-01   +4.698644670765441e-01   -3.230247644350474e-01   +7.336070090560130e-02   +2.657364235800563e-01   -7.623697820135115e-02; -3.684393834145111e-01   -1.834535277310967e-01   -2.241039622542706e-01   -2.558299355040012e-02   -3.964910442034154e-02   +2.281937415245077e-01   +9.277422340179836e-02   +2.080602297205558e-02   +1.197027622061181e-01   -1.693820356651108e-01   +3.574163475618989e-01   +1.948308427959233e-01; -1.480923547018151e-01   +5.337762429908382e-02   +2.606348477120132e-01   -1.089060572379553e-01   -5.167116155486222e-01   -1.297664012628530e-01   +3.314117226738731e-01   +8.090060650757945e-02   -3.100053034759871e-01   -2.091456299991316e-01   +1.089032007281540e-01   -7.316430137702029e-02; +1.011460470546655e-01   +4.907609992886293e-02   -3.169955801540362e-01   -1.291353603284946e-01   -3.361927229869905e-01   -1.218652016345845e-01   +3.543762192076287e-01   +1.609988110061147e-02   +3.631537473698182e-01   -2.395573964409304e-01   -3.392058872380041e-02   +5.571247764672677e-02; +2.600633834170751e-01   +6.766719143036347e-02   -1.022563147696968e-01   -1.177850979988899e-01   +7.255825318707512e-02   -2.011029009558679e-01   +2.137903418855583e-01   -9.638110546550485e-02   +1.067560087190840e-01   +4.422772349803392e-02   -3.453355761170134e-02   -2.285463786299701e-01; -3.301559525797031e-01   -4.539084981590594e-02   -2.313434577004644e-02   +2.054024607192044e-01   -1.763358159351416e-01   -5.919414405114176e-03   +1.739147211548528e-01   +1.084311453184618e-01   -1.293957246815322e-01   +1.384060877163502e-01   +3.684379660367684e-02   -1.242039875287904e-01; +4.125790916197104e-01   -1.306793086947747e-02   -3.802045616309344e-01   -1.982344271385710e-01   -1.441855711080408e-01   -1.731232337895204e-01   -3.297508419521913e-01   -1.125494848355787e-02   -2.618283361421168e-01   +1.012887413240055e-01   +3.229228783763917e-02   -5.071915522118260e-01];
L2E_L3E_iAMPA_netcon = [-6.684769061767117e-02   +1.698921113172899e-02   +5.588874804442539e-02   +2.502522656884382e-02   -1.266118212667529e-01   -1.329064255758419e-02   -3.946345101481742e-02   -2.437481165966199e-02; -1.270226760872590e-01   +1.915113587126834e-01   -1.731885231010852e-01   +9.254197682301778e-02   +1.668616044373218e-01   -2.120370605254306e-01   -3.301639275596872e-01   -1.294014543615372e-01; +8.247630159160374e-02   -4.383889785651540e-01   -6.550415960466105e-02   -1.009959985831515e-01   +1.943965768520421e-01   +7.561338969287582e-02   -1.241666745212191e-01   -2.898288747569019e-01; +2.047627448643172e-01   -3.740231285631924e-02   -1.758444788636309e-01   -2.519693149815475e-01   +1.506000935901943e-01   +5.449329360385692e-01   +2.762189736672083e-02   -5.573039180164661e-02; +6.147776411855228e-02   -1.682946265341954e-01   +3.620523726659883e-01   +1.127257002333479e-01   +2.301553075426431e-01   -5.811264491376563e-02   +7.627155182699291e-02   -1.131660272574841e-01; -1.583296304580814e-01   -2.794762054462746e-01   -2.778955375678830e-01   +1.976500673617925e-01   -1.891032849362508e-01   -1.336998043353558e-01   -1.512777251564585e-01   +2.190546274577637e-02; +9.048476237150595e-02   -4.722055847492346e-01   +2.031834901827698e-01   +2.134672310472791e-01   -5.371976961595057e-02   -3.504464825276891e-02   -1.955963915535966e-01   +2.356548963711966e-01; -1.599803594812404e-01   +5.844376966306528e-02   -1.933727023918116e-01   +5.127027902978279e-02   +1.063510894077620e-01   +5.545964704567474e-03   +4.320941122196845e-01   +2.110923877143239e-01; +1.892618223866026e-02   +3.203592028565087e-01   +3.074966441856676e-01   -2.808381566516423e-02   -1.456780538089585e-01   +3.072184233813802e-01   -3.467753750517522e-02   -1.106445574908792e-01; -3.059914074770556e-01   +1.257953644299996e-02   -3.537471266697477e-01   -6.382812244968436e-02   +6.831790905659937e-02   -2.098279662013615e-01   -3.605483274359991e-02   -6.656327286739890e-02; +3.691702536219479e-01   +1.472914757269983e-02   -2.082581628522870e-01   +1.399272862604761e-01   -4.906986929173771e-02   -9.829152078725516e-02   +4.204156736466915e-03   +5.669769557529064e-02; +7.129922601112068e-02   +3.478719275376203e-01   -2.065883281940183e-01   -1.261090498830769e-01   -4.242705307647183e-01   -4.223159382474584e-04   -8.012177170315710e-02   -2.454664735885814e-02];
L2I_L3I_iGABA_netcon = [+2.806365058345825e-02   -2.493440219609647e-01   +1.113432793120385e-01   +4.402189087429874e-01   -7.896175416622747e-02   +4.214495940458471e-01   +1.057327714132547e-01   -3.133966986732754e-01; +9.845338589168881e-02   +9.305913100902340e-02   +2.585987784074943e-01   -1.120481912184707e-01   -4.432389289178001e-01   +2.732110576586991e-01   -3.939263908382790e-02   +5.201764467781107e-02; +7.722235765709906e-02   +3.565527866192357e-01   -2.353313106532564e-01   +1.181106429085330e-01   +8.399968045229220e-02   +3.149741818636487e-02   +2.312138251294934e-01   -1.009853406689014e-01; -2.776879968177144e-01   -5.018023691605476e-02   +5.409080756247234e-02   +1.878894932711928e-03   -2.137135996210025e-02   +3.359158933727056e-01   -1.348943957230942e-01   +5.078768847326692e-02; +1.400576533885080e-01   +1.968801033281693e-01   -1.568430918776908e-01   +3.575789313030986e-02   -3.229189143697553e-01   +3.613853869658030e-01   -1.098739914297413e-02   +2.135561985969639e-01; +3.380385853895643e-01   -3.305261749577865e-01   -1.765901045660066e-03   -1.149802473028790e-01   -1.894290822574873e-01   +2.510534299776589e-01   +4.216800976368906e-02   -1.314646409273456e-01; -1.158310933549588e-01   -7.037478104719866e-02   +2.733890987135243e-02   +1.363378631398001e-01   +3.218458414634964e-01   -2.071390925242996e-01   +7.120304282288489e-02   +3.723334206151618e-03; +1.308435180732313e-02   -1.976824610034606e-01   -1.028730667695227e-01   -3.643225432049283e-01   +2.031111271035272e-01   -1.334978925756014e-02   +4.810915420451614e-01   -2.218432175906447e-01; +1.203916648872803e-02   +3.454586710486610e-01   -4.536746031867018e-01   -1.385482031200021e-01   -1.585765700315973e-01   -2.429762338463097e-01   -2.893881779056105e-01   +1.817333260472865e-01; +1.526967090210605e-01   -2.889773269386025e-01   -4.428733122555995e-01   -2.963449489096911e-01   +1.779833503188356e-02   +4.637576772766691e-02   -3.213180921529717e-01   +3.147858232279196e-01; -4.189000310605074e-01   -7.815404654979205e-02   +4.135839850662318e-02   +7.906183455414222e-02   -8.814682722216427e-02   +2.880607144501903e-01   -2.026623931847870e-01   -3.716200098102241e-01; +2.252424843963098e-01   +2.278156236981795e-01   -2.791435483412694e-01   -4.898305953034663e-01   -4.331184792019904e-01   +1.521773321848569e-01   +2.273194197205489e-01   -3.646429987201813e-03];
L3I_L3E_iAMPA_netcon = [-1.265490021155333e-01   +2.946269421444081e-01   -1.624980148751057e-01   -1.430292815393253e-02   +1.921724557999988e-01   -2.835867303489090e-03   +7.773985413082883e-02   -2.259584995625515e-02   -3.672370571629370e-01   +1.612074575527361e-01   -5.463426552407427e-02   -2.211574222441925e-01; -1.145693494744257e-01   +1.427639851647968e-01   -1.417697004757795e-01   +1.377150270491939e-01   -1.389954899801055e-01   +6.274402252741033e-02   -3.124745240838222e-01   +1.542304104799307e-01   -1.067989749981114e-01   -2.082396084040049e-01   +4.009844371967450e-02   -4.403781800788679e-01; -3.424341220782913e-02   -1.320328287229030e-01   -2.760220785403097e-02   +5.729904654577138e-02   +1.939413937683886e-01   +1.275409292682368e-01   -4.502602076360348e-01   +1.053938321044438e-02   +3.186973287890051e-01   -8.007859144895797e-02   +1.693524173794895e-01   +2.380542851879016e-01; +9.334073206836760e-02   +1.918327349211999e-01   -7.872314483745282e-02   +5.155722835432589e-01   +2.012790170070363e-01   -3.168784548628639e-01   -4.797801113584733e-01   -1.978901878892578e-01   -8.024151134174567e-03   -4.801980634821784e-02   +5.988092256473392e-01   +1.576361775034939e-01; -1.317761365517273e-01   +1.281920179117408e-01   +1.123605067207287e-02   -1.418119219431559e-01   -5.670523743927273e-02   +1.254362545083846e-01   +6.868547917521851e-02   +1.429267532528800e-01   -8.462295329455516e-02   +1.463407938036339e-01   +1.131378224968716e-01   +5.716651385116722e-02; -2.201690927611841e-03   +1.714154142541161e-01   +2.572244953379618e-02   -2.621472627059674e-01   -2.465097227979857e-01   -9.086435912708433e-02   -8.065223846771322e-02   -5.027989141519107e-02   -2.054401602275709e-01   +3.980003258938446e-01   +6.308264749735298e-02   -9.627792864046422e-02; -1.498878078562736e-01   -1.637817843447781e-01   -1.618490068007222e-02   +1.653059904789360e-02   -1.430293172616357e-01   -1.720626830407413e-01   +1.124613361558094e-01   -2.683225797368077e-01   +1.045312984772280e-01   -5.789594769298425e-01   +3.098204824128480e-01   -3.692427051444004e-02; -1.000678010213378e-01   +1.289156235275545e-01   +2.494583591847982e-01   -1.438200379535387e-02   +3.918822504582692e-02   +1.261244964640062e-01   +1.149460109018220e-01   -2.438907318117584e-01   +1.732474634468895e-01   -1.811289838560123e-01   -8.991913467976023e-03   -2.225075573905218e-01; -2.001123953036880e-01   +2.113722167544994e-01   -2.808815996328969e-01   -7.366849001039229e-02   +1.114980761986318e-01   +5.386116681848581e-02   +1.780895904835556e-01   +1.965324118272940e-01   -6.783153159751722e-02   -3.074162120700540e-01   -1.900209328965395e-01   +1.681558866809755e-01; +1.040490239319110e-01   -2.036003622950297e-02   +1.846488429249076e-01   +3.457112079608854e-01   +1.471402761247886e-01   -7.189393891158627e-02   +2.079273737254462e-01   -1.455758509070275e-01   +7.825560219376698e-02   -2.642784871040470e-01   +1.391250441268574e-01   +1.224933612210864e-01; +2.477968921704305e-01   -4.990418062216562e-02   -2.276315546805682e-01   -3.604971200099030e-01   -1.428199448739081e-01   +1.329413533374664e-01   +3.358957725853419e-02   +5.175944928801962e-02   +2.030900073450261e-01   +6.842432720632402e-02   +8.015844097831046e-02   +2.634352534756657e-01; +2.240696820216471e-01   +1.349043174043148e-01   -1.450814501211427e-01   -6.332058523013874e-02   -1.550489537796190e-01   +2.194145340281255e-02   +3.957941575539903e-02   +1.135065079778037e-01   +1.182481444182422e-01   -6.853317460550612e-02   -1.694795279705144e-01   +2.774835931581449e-01];
L3E_L3I_iGABA_netcon = [+1.315176570638422e-01   -1.596292482609367e-01   +1.476229148058366e-01   +8.806374479608690e-02   +2.191398874615451e-01   +1.220253010069634e-01   +1.022053538902170e-01   -1.982843156443591e-01   -3.460981350847707e-02   +1.527332550899298e-01   -4.929973338730231e-02   -4.891840110849829e-01; +1.539675725137103e-01   +3.151212289040945e-01   +1.883371467156263e-01   -3.723164572144431e-01   +1.541531971437113e-01   +9.517981442538273e-02   +2.734524918843932e-01   -1.462239578255196e-01   +1.422379759868696e-01   -1.225814710804603e-01   +1.784330779059518e-01   -2.500665833790499e-01; -2.581590353037908e-01   -6.819599003863397e-02   -5.089677397277677e-02   -1.538323802004243e-01   +1.329567032126211e-01   +1.714211789549744e-01   +4.337114366358501e-02   -3.542777247564198e-01   -2.810466924145760e-01   -3.042096970935793e-02   -1.575358616503883e-01   +1.100643435690219e-01; +3.425155830434571e-01   -4.001094879843639e-01   +1.378776465201481e-01   +6.313844937489539e-02   +1.147237788527841e-01   -1.072866852911898e-01   -2.706663649837238e-02   -5.011508889705714e-01   -1.102691586119262e-01   +1.787448757591966e-01   +5.409256906147415e-02   +1.203361021431951e-01; +1.608704354988700e-01   -1.640795662653819e-01   +3.956788010968856e-01   -6.900846532282083e-02   +3.267855379091895e-01   +4.040835000792559e-01   +2.416021402909322e-01   +6.577789556154717e-02   +5.401549887798826e-03   -2.214398962774261e-01   -3.082669400087200e-01   -2.900077740754338e-01; +2.091141925675983e-01   -9.121294046110015e-02   -4.890530993761681e-01   +2.696514644700947e-01   +4.606882808170708e-02   +2.830597478406923e-01   -1.861218182590790e-01   +2.494111519789913e-01   +1.549357106035658e-01   -1.183728935389523e-01   -1.531409524754293e-01   +1.017222283133439e-01; +1.120573457151900e-01   +4.678517887574793e-02   -1.255034448497164e-01   -8.816829570209940e-02   +4.266303287127900e-02   -9.207230641198988e-02   -5.655406716898505e-02   -1.053954593401723e-01   +2.331687429770875e-01   +5.574944262833600e-02   -2.384840988351984e-01   +1.004171621027280e-01; -1.209777752885899e-01   +3.064243937244890e-01   -1.624080894752733e-01   -8.087903233435997e-02   +6.054073749066557e-02   -6.237081731574638e-02   -2.487735098760990e-01   +5.358652813457964e-01   -2.255101466210210e-01   -2.835616134717761e-02   -3.371158734397955e-02   +1.832212037196230e-01; +1.600566611112514e-01   -1.505008676752766e-01   -1.009610879514972e-01   -1.904349192377654e-01   -1.908286844807006e-01   +8.168621038737206e-02   -1.447660473451793e-01   +7.321923085047154e-02   -2.858495188005933e-03   +3.425836011203616e-01   +1.950534811321844e-01   -4.921950755477447e-01; +1.017791825220311e-01   -1.949994261736125e-01   -1.060924443475061e-01   -3.447182636758702e-01   +2.268497924862813e-01   +1.106841999758785e-01   +1.618552138237152e-01   +1.180832854158505e-02   +2.797777511472498e-01   +1.271232415203779e-02   +1.148771384022704e-01   -9.279466155421741e-02; +4.720632987844376e-01   -2.445635698622249e-01   -5.856624040998751e-03   +1.723511498882965e-01   +3.008214956804767e-02   -1.174258218805037e-01   +1.425279372832661e-01   +1.807849263768644e-01   +5.217550026574380e-02   -2.096482854691897e-03   -3.183373033118386e-02   +1.573103403181695e-01; +4.790093774981975e-02   +7.472806883838314e-02   +3.496633197308259e-01   -1.796738225608470e-01   -1.106831205323378e-01   -2.159006112800771e-01   -9.848432537842630e-02   +3.413486334105347e-01   -4.637713072158604e-02   -9.643818374896057e-02   +3.100251606816885e-01   +1.338686487614199e-01];
L2E_Input1_iAMPA_netcon = [-7.623151165729350e-02   -2.176136146784791e-01   -1.319912154362758e-01   +3.682356976155195e-01   +1.625784216292140e-01   +2.543122316653053e-01   +2.254767696422370e-01   +3.187208374159480e-01];
L2I_Input2_iAMPA_netcon = [+2.653310526783480e-01   -2.706864562258677e-01   +1.241991216261193e-02   +3.202749532545668e-01   -2.709595880265653e-01   +1.656144932258848e-01   +1.150239240877554e-01   -4.654155553679837e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
