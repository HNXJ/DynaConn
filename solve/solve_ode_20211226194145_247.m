function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.055360360626198e-01   -4.876115163792066e-02   +4.776617718784228e-01   +5.051444300605688e-03   -8.464970588473031e-02   +9.661724644557086e-02   -7.468012908711093e-02   -7.910986873617637e-02   +3.037556786219098e-01   -6.482865846588911e-01   -2.093004006842671e-02   -2.649349715555920e-01   +2.904715275608750e-01   -2.405224424752928e-01   -1.898782287147974e-03   -1.932186375103324e-02; +2.433743412073943e-01   -1.515848142406515e-01   +2.629143662937762e-02   +1.587725741291460e-01   -2.973925928334143e-01   +9.826277953076251e-02   +4.506193239221317e-01   -2.439254312452887e-01   +3.773519924407030e-02   -1.199998956320628e-01   +9.297825826279785e-02   -2.009011200558388e-01   -3.102039650699722e-01   -2.289710173047200e-01   +2.191853825448243e-01   +1.162709509839957e-01; -2.234555279102436e-01   -4.354589794265342e-01   +8.867938436935699e-02   +4.828894950617173e-01   +5.825038916411579e-02   -3.588256973467494e-02   +4.389475411460020e-01   +4.565309397622073e-01   +1.493035040809429e-01   -7.150695296364316e-02   -1.327955845211655e-01   -2.812928732450524e-02   +6.278078515504411e-01   -1.338777330059097e-01   +8.630663968559586e-02   +6.479534630037849e-01; +1.641525231717558e-01   -2.340743126103079e-02   +3.148411794807147e-01   -3.087426485972160e-01   -1.323838768519926e-01   -2.380743074252840e-01   -2.039697400643142e-02   +3.703107269791175e-01   -1.362575980914086e-01   -1.232709424905865e-01   +3.003013223059664e-02   -2.781034983696384e-01   -2.843981349987054e-01   +9.371530459646207e-02   -1.503888220197449e-01   +1.822803653445289e-01; -2.523067137093586e-01   -3.736355869702571e-01   -1.154789661038398e-01   +1.223973887414628e-01   +5.058735843623308e-01   -1.796887022366219e-01   -6.319073249017284e-01   -4.223098070204059e-02   +9.777459305984228e-02   -4.967092141186956e-02   +4.044151046568439e-01   +2.793877139210157e-01   +2.461785385723507e-01   -9.905519594128827e-02   +1.326798719085705e-01   -9.034416718441510e-02; -9.575118745287170e-02   -3.894451003253544e-01   +1.014770131755625e-01   -1.413425288274608e-01   -2.898136495689516e-01   +1.152973272384850e-01   +3.907498580684685e-01   +2.086574562956647e-01   +1.035391867143528e-01   +9.472159987476217e-02   +4.614336877511560e-01   -4.435932640471607e-01   +1.884832980444008e-01   -3.164189019125354e-01   +4.064941120129958e-01   +1.265382510196557e-01; -2.505345829366333e-01   +7.738877168233071e-02   +3.343682897594525e-01   -1.332173964976420e-01   -2.858102889833023e-01   +3.623609246509641e-01   +2.591631020410574e-01   -3.874277209480959e-02   +1.021183392164941e-01   +1.183526196113725e-01   -3.785445362987819e-01   -3.848483383957411e-01   +4.519783069581117e-02   +2.278995830067582e-01   -3.143095962321527e-01   +3.520511963083834e-01; -4.721870990649231e-01   +9.878248176384383e-02   -2.891920861801227e-01   -8.235540858671758e-03   +5.146792070415944e-01   +2.844774995191210e-01   -3.269533423530790e-02   +2.686919312472427e-01   +2.721354278023372e-01   -4.010542873391874e-01   +3.063259061900650e-01   -2.644958633314598e-03   -5.359103309168830e-02   +5.135226396778430e-01   -3.249019886562143e-01   +1.189372013588265e-01; -2.034600922972537e-01   +1.733224314014924e-01   +2.296301200902267e-01   +4.175562470090118e-01   +5.872807935556434e-01   +4.699080957029965e-01   -2.297110883881910e-01   +2.615553659093372e-01   -3.960856497777765e-02   +2.220597540096966e-01   +9.677806032121913e-02   -2.345039690123147e-01   -6.589163449902602e-02   +1.680563676089106e-01   -2.391554823782713e-01   +2.762867428894273e-01; -2.741848753893604e-01   +4.512454508030740e-01   -4.086062716035964e-01   +2.624790306369565e-01   +3.604865344212977e-01   +4.510162536386897e-02   +2.229870822341874e-01   +8.998984809849056e-02   +9.563553468722853e-02   -2.706989929510496e-01   +3.890172325750144e-02   +4.108231762205595e-01   +4.133974323510370e-02   -6.617978294887972e-02   +5.852504934101470e-02   -1.327401053426926e-01; +3.535211222374661e-01   -3.041876678710207e-02   -1.029950410430742e-01   -1.591167420079833e-01   +2.751871219427970e-01   -1.685756579349408e-01   -1.688823190553647e-01   -2.374235010480016e-02   -1.087938960891578e-01   -6.172344197950111e-02   -1.594882691704549e-01   -1.012895126795989e-01   +1.040461671021481e-01   +5.804446066845851e-02   -7.684104440949976e-02   +4.119773663938463e-01; -5.452277476298074e-02   +4.789496108682800e-01   +4.602843549533767e-02   +1.363942926170451e-01   -2.612244150230228e-01   +1.928019158511103e-01   +3.402290474282058e-01   -2.016821228632416e-01   -2.710665384773326e-01   +1.903156787416873e-01   -2.083846265917384e-02   +5.017494944367785e-02   +1.721648303441119e-01   -7.413048430944948e-02   +2.077840796365500e-01   +7.352596876730499e-01; +3.989817054374952e-01   -2.651164327654880e-01   -3.025337328209471e-02   +1.687801772533007e-01   +2.075845428278033e-01   +4.346409348264201e-01   +3.593790772126029e-01   -4.793266028239405e-01   -4.388072614474736e-01   +1.160684354223523e-01   +2.163391734367274e-01   -3.887351182567254e-01   -1.678853399918870e-01   +3.545967868581348e-02   -1.072718671912115e-01   +1.931210645315768e-01; +1.526426489853771e-01   -1.469133389652067e-01   +5.296684583362928e-02   +9.347334108543962e-02   +4.547904345005083e-01   -4.287159304345847e-01   +2.295932527801704e-01   +1.509691885616805e-01   -1.216700241676030e-01   +6.005841795253293e-01   -1.448593343209137e-01   -1.336031685223592e-02   +8.372660816977825e-02   -1.747479192666564e-01   +4.975944432281839e-01   -4.757774364986721e-01; +9.695350120761337e-03   +2.030880993451534e-02   +1.195805536009435e-01   -1.816896914012632e-01   +3.104511475750087e-01   +3.084567362140437e-01   -9.543599011460674e-02   +7.132111744284569e-01   +3.452197107271540e-01   -8.065523637236896e-02   +1.348691742756308e-01   -3.124971780163954e-01   +2.923151118555257e-01   +1.284771050756466e-01   -3.792582443657241e-01   -2.288111264002818e-01; -3.829841783874442e-01   +2.512989874742987e-01   -6.675582191313750e-02   -2.644401227957939e-02   -8.485564676338461e-02   +1.157724728281712e-02   +2.942126195458494e-01   +1.338450204685297e-01   +1.198261272310398e-01   +4.477357430239786e-01   +4.693761632920639e-02   +4.151291821676448e-01   -2.479020567603931e-01   -4.097655816214187e-01   +2.592479539480809e-01   +2.811152427169131e-01];
L1E_L1I_iGABA_netcon = [+9.224180883160672e-02   +3.217882441735568e-01   +4.991088868976982e-01   +2.007725292074024e-01   +6.103058379459284e-02   -2.146776390515173e-01   +3.865934143843669e-01   -3.130766482760262e-01   -2.051872918318769e-01   -1.872643012668177e-01   -2.520996926148705e-01   +1.672230164772578e-01   -1.931667082154185e-01   -1.686151252056853e-01   +5.966471783949592e-01   +6.766497337449642e-02; +7.032658745363335e-02   +4.743636232893261e-01   -2.546184785408504e-01   +4.107425672395937e-02   -9.969003747214655e-02   +6.450916419145036e-02   -1.625506491900282e-01   -6.154712911333227e-01   -1.244146864145274e-02   -4.059118744738550e-01   -5.775744006596827e-02   +9.992642095020152e-02   -1.911960728809894e-01   -5.135723966638892e-01   -2.819529722477492e-01   -4.358987564361929e-01; +4.476918831853416e-01   +1.941543316069643e-01   -2.465769982099703e-01   -1.451064535519070e-01   +4.386023835886140e-01   -7.647300483307579e-02   -1.291870066991579e-01   -1.816176576831119e-02   -2.639426329002748e-01   -6.782142368551477e-01   -1.194498055006588e-01   -2.282591790500511e-01   +2.022540329145178e-01   +2.702228439118346e-01   +1.890378733408037e-01   -1.552352011693720e-01; +4.858288162661629e-01   -6.593583561621123e-02   +2.614205713749422e-01   +1.127881318547557e-01   +2.393689272929063e-01   +6.731980483575216e-02   -3.635463070542886e-01   +1.135164924963914e-01   -3.491519323715392e-01   +9.908134468684715e-02   -3.732906795502750e-02   +3.637536106005261e-01   -4.636591627551984e-02   -7.859118741292026e-03   -1.441713185794375e-01   +1.380329723456461e-01; -4.566707341731964e-01   +8.653566506104694e-02   +2.199138976066410e-01   +1.790179481172689e-01   -1.908291030457575e-01   +3.077083852120563e-01   -4.159885452054510e-01   +5.211193605122708e-01   -7.442550405074611e-02   -3.397154439188672e-01   +4.848363868193720e-02   +2.886596964840315e-01   +4.542839822995457e-01   +3.751074407373814e-02   -1.883500416856763e-01   +6.317242360659983e-01; -1.340436508293634e-02   -1.642813919004069e-01   +2.810081197244920e-01   +1.369961951165075e-01   +4.147457360650960e-01   -1.256761281135179e-01   +3.693066012986163e-03   -4.596549914244339e-01   -4.762129485657063e-02   -1.897276112238595e-01   -1.198770741067342e-01   +1.084758498020690e-01   -5.577600220702069e-01   -1.199273935096921e-01   +3.260408987020660e-01   -3.847771173731185e-01; +2.806935719109906e-01   -1.689313681468091e-01   -4.082340625210208e-01   +4.305875522626957e-02   -3.188572372664669e-02   -2.848931283419157e-01   -3.298697056379277e-02   -6.625302502168660e-01   +6.092022442159385e-02   +1.379753741929025e-01   -4.337166440491225e-01   +1.062971321871820e-01   -2.691716974289268e-01   +3.537277120308314e-01   -3.185033559219200e-01   +1.845230521410633e-01; +3.794161163478322e-01   +3.162745637883905e-01   -7.716194384721391e-02   +3.926279782227844e-01   -4.011343704217303e-01   -1.668998877763885e-01   -2.046877536918590e-02   -7.277953028457228e-02   +6.092058845457688e-01   +1.656960321310554e-01   -8.056406944152508e-02   -2.495902030836092e-01   +2.545400504686954e-01   +5.344693859443364e-02   -1.177982254885090e-01   -1.173554288732788e-02; +1.668909276885635e-01   -1.862061944540140e-01   +1.606174122079245e-01   +6.102820691422360e-01   +9.066046692293206e-02   +1.517175760812150e-01   -1.264054262364711e-01   +2.764726003420205e-01   +3.822341540831663e-01   -3.632417389435823e-02   -1.526498566220974e-03   +3.241304686839862e-01   +5.159573413760983e-01   +2.878153667884734e-01   +2.503618613187618e-01   +2.033857936697181e-01; -3.819258218445537e-02   +1.631252943027817e-01   -2.622060624320296e-01   +2.800343815488361e-01   +2.595103125683199e-01   +4.056181922430808e-01   -1.460831595895952e-01   -1.615217506417332e-02   +2.843985992519119e-01   +2.299703773536494e-01   +2.058507023422596e-01   +5.843215035937266e-01   +2.228687232465689e-01   -2.896684546543105e-01   +2.672772687257066e-01   -5.070279970160489e-01; -2.454517482427990e-01   +2.535049621698561e-01   -8.701526861680556e-02   -3.125895831418902e-01   +6.580910024607252e-01   -5.363274535727158e-01   +7.124211720150100e-01   +4.647711531391888e-01   -3.629031272370845e-01   +4.826304611843892e-01   -1.495092914710032e-01   +1.547230036610440e-01   -1.788162046586006e-01   -2.255358209538136e-01   +1.653206539967171e-01   +2.665402594769425e-01; +1.090645075371553e-01   +1.435692915743857e-01   -4.981909897423330e-01   +1.203824605342513e-02   +3.096900193931713e-02   +3.827528789394713e-02   +7.480075269313996e-02   -1.133363542828041e-01   +3.039071710143219e-01   -1.976397692515028e-01   -4.659094003196576e-01   +1.825563233051565e-01   +9.633763813329319e-02   -1.568527738269326e-01   -1.485495040830576e-02   +5.805574402987622e-01; +1.963936663199322e-01   -3.406126661536624e-01   -2.385294806574440e-01   +1.598894782764058e-01   +4.181662961014588e-01   +2.479912827910245e-01   +2.117392151103296e-01   +3.112036114446756e-01   +4.853521479591762e-01   +6.348948150963022e-01   +6.642764731748434e-01   +6.562003605084161e-01   -2.170403771723972e-02   -3.180994933392064e-01   +2.493136247291276e-01   -3.252930114554168e-01; +5.228662160717290e-01   +5.381291103584075e-02   +1.459770536890336e-01   +1.360963252673655e-02   -2.271847701521612e-01   +9.662150989376547e-02   -2.521263170220336e-01   -3.374396408048021e-02   +1.031759132707050e-01   +3.393616148299763e-01   -3.881821217470365e-01   +2.477988013735771e-01   +3.980748484409712e-01   +3.733383282784680e-01   -1.874133463571391e-01   -1.340386383405755e-01; -7.103788990600787e-02   -4.442621845534803e-01   +1.975175163625369e-01   -3.456030520468100e-01   +3.167471542335753e-01   -3.901076809564728e-02   -1.216382879587435e-02   +1.749989693647382e-01   +3.764272801908654e-01   -6.101330734286015e-02   +1.930714009531780e-01   +9.629143135952306e-02   +1.025153790556304e-01   -2.624691231351537e-01   -1.992915263485801e-02   +2.049878659493725e-01; +5.314699701831041e-02   -2.843335745582345e-01   -1.073713205074289e-01   +7.900652071620685e-02   +4.560667490569476e-02   -1.786455443376375e-01   -2.973195200403459e-01   +4.487504245214592e-01   -1.045128124422422e-02   -1.433235556009239e-01   -1.283185590576413e-01   +2.831904038678712e-01   +9.501882093947313e-02   -2.562832806690902e-01   -1.161805138497366e-01   -3.791442374556762e-01];
L2I_L1I_iGABA_netcon = [+5.880551549777117e-01   +3.583031347394380e-01   +1.739402948081700e-01   +2.767989725640324e-02   -3.869687818905245e-01   +2.384168726314049e-01   +3.548085787983570e-01   +4.506357491400983e-01; +3.963331484113841e-02   +1.507962311396627e-02   -1.958412820788100e-01   -2.489862425481258e-01   +2.486810166023382e-01   +1.359522640356052e-01   -1.333466718860596e-02   -1.224568874082118e-01; +1.224553425144205e-01   +5.174439836688692e-02   +1.009509377030109e-02   +1.977221495243556e-01   +4.085512881900965e-01   -1.678275074385934e-01   +1.267668630347454e-01   +4.283689316423185e-01; -5.925639520035011e-02   -2.624522080648684e-02   -2.308707960463130e-02   -7.011716199794485e-02   +4.135881659968673e-01   -5.873232093366803e-02   +8.297455029389780e-02   +1.786921274373985e-01; -8.117165535798393e-02   +1.722773446470950e-01   +1.130537145941568e-02   +2.395845220307631e-01   -4.870899033668613e-02   +3.662498758576603e-01   -7.393634157226914e-02   +3.509449880604512e-01; +3.038029438808765e-01   -2.752006921474933e-02   -2.908597994259301e-01   -4.016681283582139e-01   +1.846713579073199e-01   -2.803772779953014e-01   +5.545017567704893e-01   -1.775951736036436e-01; +2.367023565427679e-01   +7.798063871198384e-02   +2.008499559831190e-02   +1.013519546374965e-01   +2.144061556666584e-01   +2.659695346460614e-01   +1.080279715267787e-01   +4.834095679308760e-01; +5.517017200143525e-02   -1.356363318318430e-01   +2.894140288162997e-01   +3.597349867417847e-01   +1.351655434752043e-02   -1.248627255721302e-01   -5.333947301172870e-03   -2.284001952787762e-01; -2.301589662958435e-01   +4.573436133009151e-01   +1.699917287457643e-01   -1.213142662908683e-01   +1.440175112859060e-01   -3.406892182904021e-01   -5.843638764192275e-01   -1.687626321635453e-01; +1.697918061755750e-01   +1.382771118107204e-01   +3.412035354138879e-01   -8.344322730668099e-01   +3.490384549983835e-01   +2.523661122675858e-01   +2.230298682737057e-01   +2.139843002141652e-01; -8.844081020427377e-02   +3.265826728425921e-01   +1.135123631459542e-01   -2.794714980218904e-01   -4.220507615328403e-01   -4.421625909679919e-01   -1.725991091429049e-02   +3.774517504274247e-01; +2.214253983046105e-01   +2.344634721403946e-02   -1.032379951137601e-01   -1.681451183961024e-01   +2.556340308926403e-01   +2.368629840525197e-01   -3.623508333511038e-01   -4.268155196858709e-01; +6.402250233001044e-02   -3.082618571679342e-01   +8.604933752078414e-02   +3.542286326084661e-01   -3.683405116160153e-01   -5.274445041054734e-02   -6.328722894461315e-02   -6.567635686537643e-02; -8.551257655801238e-02   +3.139721985343651e-01   -5.129815449939323e-02   +4.465068152888815e-01   -1.187598260480038e-01   +4.199997588022424e-02   -4.015539383287262e-01   -3.550976122802973e-01; +2.727106327728023e-01   +2.603010619542648e-01   +7.432746790332745e-01   -3.940807520164135e-01   +2.148096068618552e-01   -1.738392177352283e-01   +4.459613257052307e-01   -6.427192760750811e-02; +2.159203508433587e-02   +4.921751249340031e-01   +1.728237001915675e-01   +2.267954490387291e-01   -3.580299197159009e-01   +1.613582380568746e-01   +7.052676462035291e-01   -3.569078274014686e-01];
L1I_L2I_iGABA_netcon = [-2.389744794861214e-01   -2.284047274701624e-01   +5.390041991028196e-01   +1.781636851253016e-03   -1.238124003219089e-01   +8.209659219561999e-02   +1.964983046195431e-01   +1.235202164740767e-01   +1.588526128207581e-01   +3.919130955533298e-01   -3.290738943305673e-01   -5.196950242390642e-02   -3.020822515792564e-01   -1.501843062793983e-01   +7.458225275758133e-02   +5.985957470948966e-01; +1.216346327857824e-01   +1.485423268417315e-01   +4.697095555114658e-01   +2.037584839951778e-01   -2.677203956129904e-01   +4.178487138160004e-01   -2.354167081342691e-01   +1.445410129552037e-01   -3.787960052195594e-02   -1.778162494615207e-01   +2.559269800176306e-01   +1.152812538178766e-01   +4.164719694293565e-01   -1.615391325676513e-01   +1.078683435031053e-01   -2.247418586609225e-02; +2.105114290897220e-02   +6.330166300474110e-02   +4.677842455701460e-01   -2.770612037546251e-01   -2.637876469145753e-02   -4.376305576449796e-01   +4.239789419110802e-01   -2.671365472929813e-01   -4.005878740004124e-02   +1.520528561335342e-01   -4.330114490725821e-01   +1.628799238263353e-01   +9.382082810531761e-02   -2.925040301595935e-01   -5.091021110373569e-01   +1.274447271732051e-01; +2.201075962218463e-01   -1.177239455401535e-02   +1.751709236495632e-01   -1.325511500349991e-02   -8.660024990965470e-02   +1.092052186705684e-01   -4.887696944435746e-02   +1.141095170114381e-01   -5.712281030537153e-01   +2.867410563838587e-01   +9.795712875406748e-02   -2.067946849219106e-01   +5.622020013533853e-02   +1.229517388213418e-01   +3.351301927578955e-01   +2.132556965690333e-02; +7.014172376666015e-01   +1.811380396575248e-01   +2.796761803530600e-01   +6.239373097146313e-01   +1.545554841984919e-01   +2.953760810538253e-02   -5.367284531583024e-01   -1.141715290828390e-01   +1.755126869504367e-01   +8.223202725765755e-02   +1.000493421168299e-01   -1.543183094148557e-01   -1.138170932437079e-01   -1.693247733460789e-01   +2.359196378224508e-01   +5.805457188398530e-01; -4.184608146924384e-01   +8.763285328514224e-02   +1.226979431424495e-03   -3.696597675622793e-01   -1.275347151573108e-01   +1.526496723997017e-01   -3.695891418153342e-01   +2.420992649461355e-01   -2.091352905294219e-02   -2.148405762800886e-01   +4.414438958769140e-04   +2.473406544414527e-01   +2.315722531770449e-01   +5.819837363994935e-01   +2.011244460278006e-02   +9.802286069281807e-02; +2.720750676186190e-01   +4.850683814275826e-01   +2.118155702340802e-01   +1.103137154843953e-02   +5.670040882887313e-01   -9.429336639917848e-03   -1.095440678284050e-01   -3.946304078043454e-01   +3.284894939137822e-01   +2.083958337263969e-01   +5.526796909520506e-01   -1.846701655846381e-01   +1.492536243170488e-01   +2.219236446222971e-01   +2.767078712098400e-01   +1.331324595556560e-01; -9.430459828873604e-02   -2.099062377091224e-01   -3.695869555850025e-01   -1.465222594566053e-01   -2.968574573834344e-02   -1.544871404609382e-01   -7.609554562122889e-02   -3.429778376055993e-01   +4.766138741755839e-01   +4.410485841220161e-01   +3.709867858346649e-01   +6.253864446848734e-02   +1.546019365412811e-02   +1.710579325520204e-01   -2.018276708518812e-01   +2.441039056704541e-01];
L2E_L1E_iAMPA_netcon = [+6.670446650107759e-02   -3.916911829554999e-01   +9.559518554894832e-02   -2.709324707796158e-01   -3.958817207659625e-01   -7.337716370732555e-02   -3.562028578938125e-01   +6.174442046398727e-03; +4.315779386116279e-01   +8.210706623807371e-02   -4.322650624573718e-01   -4.632657160048786e-01   +4.105921696808403e-01   +1.479210084504746e-01   -5.303671440444025e-02   -2.292404236551730e-01; +8.481904561802202e-02   +2.268637771761556e-01   -8.919162019755722e-02   -2.639100725874239e-01   +1.905124159452711e-01   +9.938190467528907e-02   -1.849105858188745e-01   +2.725574989576349e-01; -5.106199416302980e-03   +1.793336989160607e-01   +4.662660297522369e-01   +3.060593191030059e-01   +7.169782087088763e-01   -7.700820658662141e-02   +2.895862730951726e-02   -1.530659858111382e-01; +4.379611746976558e-01   +6.468678771013370e-01   +3.844482258889533e-01   -1.328115325718449e-01   +2.198096945167330e-03   +2.116036003249360e-01   +4.240505823515338e-01   +2.909563046672362e-01; +4.508931745155537e-01   +1.803224746817900e-01   +6.271924185881114e-01   -2.494289191287320e-01   +1.396392799683029e-01   -1.148641300505691e-01   +4.022726164886223e-01   +7.325522872740946e-01; -6.046125777873904e-02   +9.177685832120547e-02   +4.805794872616131e-01   -2.866839785858570e-01   -3.456872396899791e-03   -6.342261257676460e-01   +2.782605367898002e-01   -4.240248905701607e-01; -2.504048809624079e-01   +6.060134798467537e-02   +2.606809771035697e-01   +2.495719095703244e-02   +5.106112632529433e-01   +1.324636464614947e-01   +2.313857589731177e-01   -7.754763178741365e-02; -3.466363813165462e-01   +1.013671339250497e-01   +6.603356412534889e-02   -1.715890089797130e-01   +3.964186472416070e-01   -5.944194493975137e-02   -2.302507924721184e-01   +6.114192489645327e-01; +2.527967252540512e-01   -2.180072720471192e-01   -5.259220428693710e-02   +3.276713634088615e-01   -1.149964236278719e-01   -1.619368469189411e-01   +1.802173950878434e-01   +2.968119806306013e-01; +6.262462348747571e-01   +8.122012388679375e-02   +3.617504832372000e-01   -3.336306859737861e-01   -3.524142128254841e-01   +3.014469538756040e-01   -6.784401608957480e-02   -8.379078308370549e-02; -1.003378998169698e-01   -2.440790222665327e-01   +1.928247769860814e-02   +4.463632842547838e-01   +4.165256500027054e-01   +1.936817266840150e-01   +3.110808993432800e-01   -1.766520023600199e-01; +3.416442203968318e-02   +4.421693397625208e-01   +3.080453981964172e-01   +2.443814239028083e-01   +7.267579165884752e-02   -3.129507585674625e-01   -7.364697881406257e-04   -3.616748174030049e-01; -4.774515442216476e-02   -2.020855661166248e-01   -1.324070880118371e-01   +3.677172173245559e-01   -6.013719769627526e-01   +3.012874950844552e-02   +4.702449533475248e-01   +1.811193386634766e-01; -5.838020603343294e-01   +7.539048995981965e-03   -3.524771734382113e-01   -8.161260842299822e-02   +2.387905466953084e-01   -2.632333376558219e-01   +2.848268038514416e-02   -3.371130801748508e-01; +1.386532724743036e-02   -1.567537737043952e-01   -1.072423772952905e-01   +7.772551220219170e-02   +2.522623481613770e-02   -3.441958597224350e-01   +1.326903426212773e-01   +1.121353600702822e-01];
L1E_L2E_iAMPA_netcon = [+5.581293454522639e-01   -1.687023551631656e-02   +2.408816916161258e-01   -1.105250500453064e-01   -1.770757335046440e-01   +9.649381616578144e-02   +3.123548263368064e-01   -1.216918866830917e-01   -5.288742530718131e-01   +3.594007870833133e-02   +1.444245494454562e-01   -1.263209749969077e-01   +1.083945917759847e-01   -3.104078255774412e-02   -4.731901805430606e-02   +1.432518013644263e-02; +1.356637304530015e-01   +6.033333275414972e-01   -2.698876785518264e-01   +1.608953635924375e-01   +3.165826625980294e-01   +5.570272033532284e-02   +3.849021497248163e-01   +1.709660791207226e-01   +5.239359450339962e-01   -4.332643561036903e-02   +4.939751422489638e-02   +7.475498373349979e-01   +2.922158120584342e-01   -4.019996094011032e-01   +3.647517652027023e-01   -1.857658892916609e-01; -1.753701419895321e-01   +2.811361817869782e-01   +3.938422806866110e-01   +1.613172739346280e-01   -2.173682672033105e-01   -3.330595208726883e-01   +2.056772206178614e-02   +3.017293159472532e-01   +5.486494443093574e-02   +5.722987955594960e-02   -5.859090850436268e-01   +8.104738880491763e-02   +1.035135380035704e-02   -2.549464998694288e-01   -2.873533362358411e-01   -4.127672682313012e-01; +2.675723329746717e-01   +3.379244178470370e-01   +6.136444789453008e-01   +3.357293193798049e-01   -2.564957677321296e-02   +2.880204307479924e-01   +2.101218772306606e-01   -3.256087227299593e-01   -1.080141856951290e-01   +1.448281535454472e-01   -5.738935946140167e-02   -2.628715580083426e-01   +6.788190031341296e-02   +5.507966257093442e-01   -4.321683656948801e-02   -4.461835996478873e-01; -1.456770576815865e-01   -2.738836766961711e-02   +1.770346573226494e-01   +1.931120878172663e-01   +7.694485316787811e-02   -9.371617645685898e-02   +2.647552642546765e-01   -1.969251661944562e-01   -2.005740539779224e-01   +3.273389913788474e-01   +5.934328027190923e-01   -1.400487453847780e-01   -1.256536873434358e-01   -6.368968128336201e-01   +3.191464737452122e-01   +1.326121652994378e-01; +3.515948432377123e-01   -2.121619134518334e-01   +3.458306151352959e-01   +2.567535776268925e-01   +3.876627159565016e-01   -7.058666567603626e-02   +1.064666160732632e-01   +7.138587798274540e-02   +9.835595747973652e-02   -9.092045161240260e-02   -5.563678174114755e-01   -1.712158766609269e-01   +2.519093681761171e-01   -9.684360588020197e-02   +4.920108193450963e-01   +8.736097345559513e-02; -1.864617149029976e-01   +1.698875456752105e-01   -3.669187680655766e-01   +4.300892846702847e-01   -8.629177112488867e-02   -1.207242797752806e-01   +1.834407377677397e-01   +3.909974776170999e-02   +3.995555404761105e-01   -7.412623020075676e-02   -1.159535055132707e-01   +3.322786081851743e-01   +1.438313169990576e-01   +3.511883080255481e-01   -3.657075442537052e-01   -1.075806615930494e-01; +6.270133145638479e-02   +1.986660538418655e-01   +3.259785696700773e-01   +2.909886808424955e-02   -2.943536255102275e-02   +2.173815736772818e-01   +3.153865686989047e-01   +8.365935699535591e-02   -2.972560177290943e-01   +4.850761620185547e-01   +3.824117535791924e-01   +6.347018778806446e-04   -8.054963467042246e-02   -5.223803122700262e-01   -8.190213965752410e-02   -1.760984301445742e-01];
L2I_L2E_iAMPA_netcon = [+3.264362580709653e-01   -6.406885390826593e-01   +2.407589386890084e-01   +4.610485452077140e-02   -1.900086606360525e-01   +2.360352101469607e-01   -2.607336040552032e-02   -3.941177299663430e-01; -2.779939653114661e-01   +5.892257094457913e-02   +2.504731641959118e-01   -3.401891749963468e-02   -3.228095647849384e-01   +3.564086091346517e-01   +2.250226297822525e-01   -9.947158935347580e-02; -3.902599114904901e-01   -4.151937738625919e-01   -3.326266892414520e-02   -2.232047471431651e-01   +1.326748319842920e-01   +3.607707064729616e-01   +1.354483972884332e-01   +4.201218722299334e-01; +1.925796655317677e-01   +3.921290925884689e-01   +3.790832893047692e-01   +4.144311873874443e-01   -4.500411958280734e-02   +3.670947941640879e-01   -1.697573859750945e-03   -2.345312572182006e-01; -5.575263296305668e-01   +2.091891064375384e-01   -6.532951397286275e-01   +1.028828452726097e-01   +2.553788335495980e-01   -2.466058748230291e-01   -1.329452884960498e-01   +2.856598188316133e-01; -7.976330549250907e-01   -1.730458450172196e-01   +1.547141372387727e-01   -9.475191776497588e-02   +2.394768655139277e-01   +3.094707777302796e-01   +2.405357995809423e-01   -2.595802362430435e-02; -1.544780969864259e-01   +1.954187548836096e-01   +1.730548802511551e-01   -9.989374883546788e-02   +2.657147104022968e-01   -5.182383799756045e-01   -3.668000560935988e-01   +5.252972230777190e-01; -1.855357145735188e-01   -8.590202142190417e-02   +1.467454489718744e-01   +2.516684057855406e-01   -2.226975984244171e-01   +6.748248932122622e-01   -3.138352497982894e-01   -3.635173468083387e-01];
L2E_L2I_iGABA_netcon = [-3.446319810884559e-01   -2.957005533156221e-01   -1.580188328753602e-01   -4.332983771930067e-01   -5.374529020523297e-02   +3.707454405972435e-01   -1.692293162973680e-01   -1.135708363486355e-01; +2.788397197692898e-01   -7.932630062536866e-02   +4.131837057977582e-02   +5.490115317460507e-01   -2.788238329100002e-01   +2.114472555027581e-01   +1.492203814027385e-01   +1.674385531311561e-01; +6.900204459157708e-01   -3.200625040180898e-01   +3.292723778850192e-01   +2.871532320480912e-01   -1.145135909870780e-02   +1.059040255606498e-01   +3.552791945214597e-01   -3.947372090202214e-02; -1.267814275843299e-01   +3.791625868981184e-01   +1.470802306335703e-01   +1.309873718278951e-01   +2.307706321670486e-01   +1.203243051311072e-01   -2.884694296640969e-01   -3.189239117710188e-02; -5.222243027984461e-02   +6.020797246812262e-02   -3.113753167646452e-01   -5.759085417666296e-01   +7.384028290888114e-02   -5.578773793150953e-03   -3.584494874036110e-01   +1.586283419214861e-01; +1.379082495948130e-01   -2.124204612571209e-01   -9.557624810662063e-02   -7.172949527274362e-02   +1.644908954576093e-01   +1.517087868546008e-01   +4.353874038762896e-01   -1.899213914190066e-01; +5.801623768170618e-01   -3.170870673687652e-01   -2.989190484558556e-01   +3.090665790154232e-01   +5.372960866969307e-01   -1.534449040515117e-01   -3.024628974950847e-01   -1.851228401010657e-01; +1.344880009336544e-01   +5.486686493978137e-01   +9.577203055990866e-02   +2.372754646741240e-01   -1.240156626263213e-01   +1.517740131990326e-01   -2.923529992051144e-03   +2.858633522250343e-01];
L3E_L2E_iAMPA_netcon = [+5.192883836653966e-02   +1.518948025410847e-01   +5.796554568566051e-02   +1.458911049382639e-01   +1.956987968883647e-01   +6.674526257605184e-01   -7.555794112849090e-02   +3.933306592049988e-01   +1.936654284778083e-01   +3.065197405955160e-01   +3.665887239625367e-01   +2.092331516986660e-01; -4.518603375412211e-03   +1.537259967782115e-02   +1.131867414448590e-01   +5.327470947326776e-01   +1.827655607966100e-01   +7.741799525078447e-02   +1.368221679390592e-01   -1.724241380998093e-02   +2.707077275270620e-01   -4.189084088202416e-02   +5.328353447473372e-02   +1.831716142702290e-01; +1.857268484308276e-01   +1.850362609685852e-01   -1.579203419120864e-01   +3.448144530402914e-02   +4.544731454736085e-01   -3.741003322262710e-01   -2.472089993869719e-03   +6.488331889258563e-01   -5.409594310394942e-01   +4.028226357663968e-01   +3.454786211276211e-01   +3.253170635179410e-02; -3.724556310413999e-01   +1.218671493926989e-01   +2.391614120310576e-01   +2.130656394904925e-01   +5.388877936688349e-01   -1.371132963498838e-01   -1.931675852293719e-01   -2.650279003714859e-02   +4.347215441367925e-01   -1.389861938864103e-01   +1.029355037482419e-01   -6.115444401135874e-02; +1.257470752491228e-01   +4.435939760393944e-01   +9.541289730302063e-02   -3.387857241744925e-01   -4.998689688862085e-01   +2.249370415316112e-01   +1.011927096301079e-01   +6.159576418829649e-02   +2.948566718826864e-01   -1.462121106742333e-01   +2.061267748034493e-01   +1.190833158948673e-02; +5.496906612749658e-02   +1.321721511936109e-01   +6.830833576483944e-02   +1.248926430523358e-01   -3.747544982246337e-01   -4.862335250970942e-02   +2.716268254341212e-01   -3.084548384765068e-01   +3.948750739814412e-01   +1.996172019252729e-01   -1.253880084830582e-01   +1.801549628038189e-01; +7.317259275858769e-02   -6.827655327485367e-02   -1.078988058723474e-01   +2.189440598019794e-02   -8.875815668999153e-02   -3.823497095771121e-01   -2.548653345748684e-01   -2.379190515057171e-01   +1.392057130485452e-01   -4.482387100928992e-01   +1.258364785159463e-01   +1.297004354305608e-01; -2.041350100152946e-01   +1.641224228830206e-01   +6.414244600860072e-02   +2.812565822120855e-01   +7.130405331054743e-01   +5.607343261239948e-02   -1.130750193411833e-01   +2.862622072776537e-01   -2.302956070656882e-01   +9.011268797067949e-02   -2.022647511312303e-02   -1.707366212464752e-01];
L3I_L2I_iGABA_netcon = [+4.712980091607828e-01   +1.795560257414377e-01   -4.669326620481269e-01   +2.844875723820803e-01   -5.123635574697460e-01   +9.520686377523492e-02   -3.289385847915406e-01   -3.254796150585187e-01   +2.628300632783996e-01   +6.728113062426283e-02   +8.012803497055346e-02   -3.276167044774861e-03; +1.500367919115412e-01   -2.210128200569873e-01   -1.620977542023011e-01   +3.699443327393731e-01   +9.704151708322109e-02   +3.013708281609325e-01   -3.917574272584644e-01   -1.503352179399713e-01   -3.266177041407836e-01   -3.992550200116191e-01   -3.059436162199790e-01   +1.768784303108904e-01; +1.248696037972530e-01   -1.295893935038696e-01   -9.040770732421161e-02   +5.448208696767888e-01   +2.111366331126277e-01   -5.712284399027290e-01   +2.555748418589771e-03   -3.409349549537772e-01   -1.203134596025780e-01   -3.901000281025322e-01   +3.716664114474056e-01   +4.334636116403995e-01; -1.087231837813586e-01   -5.983937978715433e-02   +8.798330626998585e-02   -1.405889460546882e-01   -1.994463680382966e-01   +3.074192478223989e-01   +6.030930437589594e-02   -4.615817717320132e-01   -1.901058372720520e-01   -5.171018883352521e-01   +4.693497901194007e-01   +2.681551974297203e-01; +4.627998401448636e-01   +2.121524568670839e-01   +3.666555726435762e-01   -1.243343106300579e-01   +2.704280569288580e-01   +2.855033545455038e-01   +4.588457205927728e-02   +2.113413181888081e-01   +3.718607156604168e-01   +1.650645449542432e-01   +1.239463855310666e-01   +7.387351491707319e-01; +2.148576717073790e-01   -1.459939470923012e-01   +2.151111227690728e-01   +1.647530348662508e-01   +1.598277085094743e-02   -5.046715740197044e-02   +1.059094464165974e-01   -4.200780612105160e-01   +3.295848860216776e-01   -4.371574427844298e-02   -2.229006207729839e-03   -3.343373906934587e-01; +5.396852672356074e-01   +4.309142255999735e-01   -2.366126314810239e-01   -2.396169898495265e-01   -1.983346514000227e-01   +7.596578757950084e-02   +3.582351677202647e-01   -9.936462218196773e-02   +5.249001097405980e-01   +2.658083350039213e-01   -1.277522990033375e-02   -6.875656940480043e-02; +1.964123883925868e-01   -1.758340532585402e-01   +3.399930770214440e-01   +6.419087759093535e-03   -1.869905002194005e-01   +5.415055320139780e-02   -2.368164860056518e-01   -3.454745614984092e-02   +3.003421350327480e-01   -5.979119225977575e-03   -5.310017975844576e-01   -2.929754393006799e-01];
L2E_L3E_iAMPA_netcon = [+2.935070025497933e-01   +2.315595215815299e-01   +2.866482499027404e-01   -5.328289394157240e-01   -3.948325373384543e-02   +1.653946996340065e-01   +2.659941712501566e-01   +2.461978629396086e-01; +1.353082956088761e-01   +3.676873836652130e-01   +3.239415195594746e-01   +3.087608170533376e-01   +3.537915701640165e-01   +2.217891322465144e-01   -2.653260850221000e-01   -5.857140131496105e-01; -2.344928497077533e-01   +4.860903116426832e-01   +2.752775946714936e-01   -4.656354174809991e-01   -2.992731518136250e-01   +3.731489532646852e-01   -1.634204050497924e-01   +3.838611191417184e-01; +5.168441263258630e-01   -2.085048358327317e-01   -5.589907156151072e-01   +3.737697392510709e-01   +1.111491862749755e-01   +4.012723109815718e-01   -2.555011307073871e-01   +1.023921951454595e-01; +4.526391339253260e-01   -2.247204004030789e-01   -1.427716060897918e-01   +1.954318453698602e-01   +5.655251617439839e-01   -1.437461937987375e-02   +1.313632736338616e-02   -1.786005950533037e-01; -2.067036572022576e-01   +5.634200944453507e-02   +1.684591718508247e-01   +1.474147654945069e-01   -3.329436218730960e-01   -3.945836125961324e-02   -3.094090664861421e-01   -8.840147701750567e-02; -3.161905781276172e-01   +1.470024159770070e-01   +6.638579139936585e-02   +1.141361071038965e-01   +1.852401782223326e-01   +2.922795237390319e-01   -4.823984563223233e-02   +3.379916218053027e-01; +4.454692566566791e-01   -1.029988658204589e-01   +3.924737020158325e-01   +4.460158935791104e-01   -1.691014378114891e-02   +2.302574596856409e-01   +2.730128035090666e-01   -1.012000845471780e-01; +5.086291034164998e-01   -8.839557324401894e-02   -2.216274860298448e-01   +2.947479131917760e-02   -3.842860181288218e-01   -2.161716153419317e-01   -2.035600048256485e-01   +2.877360600685071e-01; -1.878980657306829e-02   +2.304857142630302e-01   -2.480032335257829e-01   -2.402779654794373e-01   -5.034500359520104e-01   -1.079229888050013e-01   +1.299226425519802e-01   -2.024637505899737e-01; +2.205190752829039e-01   -2.769354068193362e-01   +3.249403201178952e-02   +1.341500691296646e-01   -2.223236585239743e-01   +1.790166490084646e-01   +6.113189880324584e-01   +7.855386388674279e-01; -8.479967758187999e-02   +3.481087450505374e-01   +1.835802930291642e-01   -2.832271346103360e-01   +2.237571943299144e-01   -4.277386627107978e-02   -1.659138147941461e-01   +1.991190087808357e-01];
L2I_L3I_iGABA_netcon = [+2.682493060324589e-01   +2.387093125616661e-01   +1.068796375358634e-01   -2.287620051197354e-01   -2.669842887464688e-01   +2.332418776481281e-01   +3.311796559114705e-01   +2.139883551190755e-02; -3.891886178636410e-01   +7.879938683016924e-02   +1.533598107370338e-02   -7.535785846324028e-02   +1.519446536189560e-01   +1.432158273651577e-01   -1.553849953062013e-01   +1.722830341500736e-01; -1.743550803824908e-01   +1.251604820434974e-01   +5.533874810056998e-02   -3.255813270416879e-01   -2.747403452688925e-01   +1.187750552699841e-01   -3.452756973666327e-01   +1.361419842489856e-01; -2.439513248574146e-01   +2.396876088356712e-02   -2.607204529436548e-01   -1.176262791317406e-02   +3.602753475327001e-01   +8.968971390801889e-02   +1.765142420857684e-01   -3.643849057446961e-01; +3.585398573417211e-01   +3.222813197660038e-01   -9.132759895988427e-02   +1.000920686892649e-01   +1.192102935787010e-01   +1.624590530541332e-01   +1.794154073631624e-01   -3.777909701365044e-01; +8.526168417672730e-03   +5.069084058370219e-01   -2.133619740018446e-01   -1.012959448642689e-01   -3.903585616802190e-01   +4.794969234615090e-01   +1.582949252370936e-01   +1.574192708742535e-01; +1.189035864275706e-02   -1.376741753699321e-01   -3.627426612751238e-01   -1.180160893015966e-01   +1.026469125376060e-01   +4.335816674503101e-02   +3.228504829249913e-01   -1.852579568076142e-02; +5.188124981868135e-01   +6.622303926404713e-02   +5.300180727813707e-02   -4.691576458370990e-01   +4.002336418190248e-01   +6.572506308664462e-01   +5.522150158117500e-02   -5.679406489110658e-01; -9.904576235292301e-02   +2.370855033237449e-01   +3.113385775723240e-01   -6.234687253063448e-03   +3.287950590127522e-02   +7.929053939422893e-01   +6.903174813425247e-02   +5.831702916510725e-01; -1.478849970172990e-01   -1.037564837159755e-01   -2.061461909445267e-01   +4.875729030967330e-01   +2.176835681217042e-01   +6.551022509044779e-01   -4.012104816084373e-01   +1.264781305141989e-01; +6.109831239556036e-01   +4.483715182264655e-02   +2.325884533696865e-01   -2.125995300722229e-02   -5.670440372148240e-01   -3.224100374383168e-02   +2.453583743859010e-01   +6.103127948813440e-01; +1.358743542759880e-01   +9.192260818208682e-02   +9.089391938770622e-02   +1.484150522478976e-01   +2.314861272336355e-01   -4.065855349762956e-02   -6.704184103936772e-02   +1.934202020985998e-02];
L3I_L3E_iAMPA_netcon = [+7.261063621168587e-02   +1.485284796665896e-01   -5.137979016463620e-02   -3.695357170629738e-01   +1.426937012200910e-01   -8.333276004865764e-02   -2.512635363428429e-01   +1.190837384079649e-02   +3.771741229132675e-01   +4.223233966161796e-01   +2.950838250624181e-01   +3.700395163825326e-01; -1.088551027666626e-01   -2.865218298822719e-02   +4.379004130929333e-01   -5.940618232202721e-02   +1.805207247614229e-01   +4.432767541550537e-01   +7.398418004617188e-02   +4.911283808218592e-01   +1.440422762451831e-01   +2.363765905931712e-01   +5.127575062246055e-01   -1.386705747978486e-01; -1.567915748795908e-01   +2.656374576438863e-02   -1.928885641534455e-01   +3.267426589661477e-01   -1.418710067987234e-01   +7.452916740168009e-02   +8.663253112413963e-02   +2.494084395488505e-01   -7.067448374637901e-02   -3.588372839521853e-01   -1.370682200479341e-01   -3.224351526668272e-03; +6.016291026610789e-01   +3.343001175324317e-01   +1.543751544212124e-01   +3.008655394222541e-01   +3.671105114671076e-01   -1.967617514913205e-01   -2.178561636455261e-01   +3.564465117728288e-01   +5.385163953438021e-01   -3.157558012028792e-01   +1.820467106701747e-01   -5.397452573871170e-03; -6.026094429836952e-02   +7.079354027188001e-02   +1.692878219920502e-02   +7.377567730199033e-02   -2.875495262017355e-01   +7.014182533519766e-01   +3.599781550357771e-01   -2.322072975412217e-01   +2.407106165298765e-01   +6.711860320120938e-02   +1.942252753898457e-01   -2.109154734873703e-01; -8.866972255685034e-02   +5.310923051408760e-01   -3.866052019044466e-01   +4.097337627778688e-01   -1.626156672859974e-01   -6.348094911616844e-02   +3.203256613180346e-01   +9.252932853689272e-02   +8.854589100357957e-02   +4.005507670275122e-01   +3.315495949049544e-01   -4.467218279466094e-02; +4.396290734647738e-01   +8.993240719263521e-02   +3.647101771422179e-01   +2.499335949774458e-01   +1.730539661282444e-01   +2.106503969603896e-02   -3.890220541789325e-01   +2.598261911188001e-01   +2.316783271374314e-01   +3.496116848695622e-01   +1.434610190371339e-01   +1.493577536000177e-01; +1.809847471765835e-02   +1.827497651104032e-02   +9.539367911181820e-02   -4.039718491450759e-01   +5.962087854189779e-02   +2.851169365976208e-01   -1.106679388278518e-01   -3.074654614743075e-01   +2.788435312369675e-01   +3.076027359161700e-01   +6.409470275556006e-02   +2.991570359890230e-01; +1.411834725813401e-01   +4.318900944794695e-01   +4.437316724860424e-01   -1.014047926519660e-01   -6.488745748386557e-02   +7.562353407228303e-02   +7.143144398502055e-04   -2.406863221478087e-01   +2.113819797501856e-01   +1.962438294130459e-01   -3.031085293235608e-02   -1.325864491714057e-01; +2.781957321250804e-01   -5.905491763410958e-02   +1.967553898745723e-01   -5.012382999086595e-01   -1.625691275461041e-01   -5.436851707400254e-01   -1.367018789068752e-01   +1.563801970115107e-01   +1.710043851048453e-01   +3.542076798249297e-01   +3.945097454402595e-01   +4.863628111589484e-01; -2.074191612280765e-01   -2.916754474849731e-01   +3.198795204157762e-02   +3.447760516885442e-01   +4.714838195898646e-02   +2.673748197958197e-01   -2.188318293911197e-01   +2.036810375032058e-01   -1.985718091340329e-01   +1.044948493560691e-01   +3.264415250681994e-01   -7.015202560729511e-02; +1.621785455142342e-01   +4.833956522386905e-01   -4.619934660395505e-01   -3.632810498559904e-01   +1.508895695971180e-01   +1.122470966301852e-01   -4.471197596738965e-01   +6.514166747412240e-01   +6.030738031359828e-01   +2.839185170255465e-02   +1.436776484217364e-01   +7.714398316120405e-01];
L3E_L3I_iGABA_netcon = [+5.035764240840450e-01   +4.519159731904746e-01   -2.061808850624433e-01   -3.348493953604560e-01   -3.210397916347170e-01   +3.004176745183522e-01   +1.776784244894379e-01   +1.573944712525960e-01   -1.612419676366922e-01   +3.590779293441664e-01   -4.735839948612166e-01   +2.425559197244053e-01; +3.999175495007329e-01   +3.253025083593425e-01   +7.206008234350697e-02   +4.162019877532713e-01   +1.267877101397595e-01   -2.138551904999116e-01   +1.111606139070474e-01   -2.368425880230887e-01   +4.979036888251370e-01   +1.255720864997548e-01   +3.421073512741334e-01   +9.601089134906819e-02; -2.883115577079071e-01   -2.489447112158140e-01   +2.765294600242502e-02   -3.530452939219366e-01   +5.183124315350172e-02   +3.425103007011266e-01   -9.066077929424307e-02   -1.513431636727738e-01   +3.952710672791792e-01   +1.716042855440460e-02   +1.818401034875431e-01   -1.552428322124199e-01; +4.143712934470134e-01   +1.297638652577512e-02   -2.826767318229584e-01   -2.786520832233923e-01   +3.077977572193369e-01   +4.260435659643411e-01   -5.413519585889218e-01   -1.954205933262816e-01   +2.604004690516855e-01   -2.670306342349196e-02   +1.685932558573739e-01   -5.148545869289090e-03; -2.573461505548079e-01   +4.402305902678474e-02   +6.655392836941740e-02   +1.178004005114939e-01   +8.866834633141341e-02   +6.827604271368481e-02   +1.063794774958484e-01   -3.168311607831354e-01   +1.028302386807209e-01   +2.612963632410585e-01   +1.877193119395243e-01   +4.273463514941099e-01; +3.952450250724331e-01   -3.397300720826661e-02   -1.843385201286723e-01   -1.771010539127121e-01   +3.307199595262623e-01   -3.618500104128503e-02   +3.198921748224136e-01   +1.550178107642820e-01   -3.540079054952544e-02   +6.504439849096461e-03   +3.721618079203854e-01   -1.586481907950083e-01; +2.370124729761250e-01   -2.945598800175839e-01   -2.102234191230573e-01   +7.891438577307713e-02   -9.360918822901917e-02   -2.687207853659734e-01   -1.048166370492419e-01   -4.431442098793869e-01   -2.803665648806429e-01   +8.981142936304187e-02   -2.550042058512373e-01   -2.346002469536883e-01; +2.555460404069441e-01   -7.898122871364904e-02   +2.685170569666597e-01   +2.823627070500623e-01   +7.073312062999651e-02   +3.399314359218787e-01   +2.854307301070403e-01   -2.962441308844943e-01   -6.269174259050179e-01   -3.574090609376669e-01   +1.278244990314421e-01   +5.267408174903544e-01; -1.923179748502522e-01   +3.917187429293986e-01   +2.686012007422980e-01   -9.667494526430193e-02   +2.000096548641480e-01   +3.082422561686064e-01   +2.844268099028808e-01   +9.987207404664974e-02   +3.006369433870032e-01   +5.146470498136022e-01   +1.387313191990728e-01   -1.860546363463132e-01; +3.502451613781776e-01   +4.254191454270342e-01   +7.061903662675837e-01   -8.478841981234267e-02   +1.517349305926008e-01   +8.601789649628437e-02   +3.680870260988689e-01   -2.303174345736718e-01   -8.374394786277031e-02   -7.595554266686042e-02   +2.731714663693705e-02   +5.011743602141258e-01; -3.107901621030791e-02   +2.119631771990696e-01   +1.648685198614288e-01   -2.850845892747641e-01   -4.501136741106419e-01   -3.650397439501666e-01   -1.896444844284956e-02   -2.965993012560507e-01   -1.603881773501526e-01   +8.294257751224249e-02   -1.736071227898413e-01   +1.393762664684386e-01; -5.553242748306193e-02   -1.039171657992984e-01   -1.599331613013659e-01   -3.337917203254869e-01   -1.809635381181900e-01   +5.831937245096924e-02   +2.849174457994278e-01   -2.367453827846358e-01   -1.466634807750764e-01   -3.860155155629690e-01   -1.769263110849781e-02   -3.035691532968679e-01];
L2E_Input1_iAMPA_netcon = [-1.411472846611761e-01   -1.961477626253698e-01   -7.212539474802715e-02   +2.589355505223270e-01   +3.029154146875747e-01   -1.975595236588082e-01   +2.783462961061397e-01   +3.887574534872582e-01];
L2I_Input2_iAMPA_netcon = [-8.567677807190989e-02   +1.502605524324304e-01   -4.926450697659375e-01   -2.298864309530478e-01   +1.484391166433029e-01   -3.775660284387052e-01   +4.123618529038828e-01   -7.361227991401191e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
