function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.925251260220642e-01   +3.078864571393197e-01   +2.116879035703190e-01   -1.528822949949915e-01   +1.247540669526587e-01   -2.416020812466708e-01   +2.442000570672564e-01   -1.447021785550584e-01   -7.048428981980973e-02   +2.490280453006978e-01   -2.668996163145267e-01   +1.759458979020629e-01   +3.273970929954902e-01   +3.308647918450983e-01   -2.357599736327669e-01   +1.627344402752106e-01; +1.947605552188873e-01   -3.654584229032062e-01   -4.138865952701564e-01   -2.232625962690282e-02   -3.020563241992828e-01   +2.702484292671119e-01   +2.677057613142721e-01   -2.651961381093806e-01   +4.868877623248091e-02   +4.113655175989314e-02   +1.369093142926477e-01   -3.069837921164568e-01   -4.383989892342308e-01   +1.536251260946326e-01   -2.446435281395210e-01   -3.137926780671216e-02; +3.565363387536887e-01   +2.185289602739330e-01   -1.707855796353648e-01   -3.332470329198098e-02   -2.727341444742290e-02   +1.815227678995620e-01   -7.671725716892949e-02   -2.461320001404853e-01   -1.241382570609015e-01   -4.611615289710497e-02   +2.739763422900937e-01   +1.685637014771956e-01   -6.506196427784151e-02   -1.148791539706819e-02   -1.441456893046962e-01   -2.824535671776092e-01; -2.434935953729520e-01   +3.124593204507685e-01   -3.663516705906411e-02   -2.757247000712972e-01   -1.074027234002382e-01   +3.866793233144705e-02   +1.988894307008538e-01   +2.160546278058130e-01   +2.570023106251576e-01   -1.143918861554064e-01   -2.132836828195549e-01   +2.306048229718790e-01   +3.006997791161707e-01   -2.997865595018431e-02   -5.352582688597587e-02   +5.865356442556505e-02; +2.118540188208085e-01   +3.952696192582814e-01   -2.463650612856443e-01   -4.250704987638263e-01   -5.122589160909449e-02   -1.236371922134014e-01   +2.220584491711372e-01   +4.462556077229494e-01   -1.015508066855061e-01   -4.921371198689403e-02   +7.631396407159724e-02   -6.466401184050581e-02   +2.091348546765398e-01   +1.616485939206256e-01   -2.780287733007140e-01   +1.624700161016761e-01; +2.095250626164193e-01   +1.700443645631522e-01   -2.981197493995760e-01   -2.438866691517498e-01   +3.835540622790790e-03   -1.365378654317300e-01   +2.352101430417566e-01   -3.914269317464114e-02   +1.584314496363012e-01   +2.351588943956464e-01   +2.728068636227543e-02   -1.402375424742840e-01   +5.932347590409774e-02   +4.738649886497064e-02   -2.257055190874359e-01   +9.296095444589089e-02; +3.470743713361834e-01   +1.506645939090482e-01   +2.600657730525231e-01   +4.070540258184374e-01   +1.162607113153867e-01   -1.515867080514689e-01   +7.155369812943367e-02   +2.169622126131042e-01   +1.635607254821702e-01   -4.059179535095445e-01   -1.975889032523437e-01   +2.552576392673153e-01   -4.787893807477819e-02   -1.862419175846043e-01   +2.061043434051097e-01   +1.249529675971751e-01; -5.066878500954048e-01   +3.799904055246732e-01   +7.110048545492889e-02   -3.385837171967235e-01   -2.784693173748891e-01   -3.196005549914085e-02   -4.423695060338179e-01   -5.665352633225942e-01   +3.794964190345220e-01   -2.935610878022882e-03   -2.929911944396658e-01   +1.827729890897071e-01   +1.538716860424553e-01   -5.967542529216259e-01   +4.812269650267065e-01   -3.849654218377949e-03; -2.453091776181715e-02   +1.205913729238065e-01   +2.090093730433590e-01   +2.917096400115949e-01   +8.031930155396526e-02   -5.200495400072207e-02   +8.589386515468100e-02   -2.755389424355371e-01   -1.568562799967159e-01   -3.525473556925578e-01   +2.578528187228415e-01   -9.240744072558212e-02   +2.811556158073919e-02   -2.698646326188380e-01   -3.005921054785295e-01   -1.334528769591782e-01; -2.571431429888693e-01   +2.177919864280647e-01   -1.312304861715719e-01   +1.443984700497134e-01   +4.007198650250380e-01   -1.633448757111221e-01   +3.607110818580228e-01   -7.058271851704681e-02   -3.279207298055187e-02   +1.098396525376881e-01   +2.127552559951507e-01   +2.015475690561456e-01   -4.008474897549433e-01   -9.642277499864196e-02   +2.041870048046200e-01   +1.146944874595176e-01; -3.774897113977957e-02   +8.313546215320518e-02   +3.541570720158609e-01   +1.751792895184864e-01   -4.951214207888792e-01   -3.435778164524534e-01   +5.571421967615984e-02   +2.929253373690272e-01   +1.247582433915637e-02   -4.896796550329621e-02   -3.248472725919584e-02   -1.475271925998625e-01   +2.583134648048631e-01   +1.753339661974561e-01   +2.304152345641612e-01   +3.479734243782159e-02; -3.235222488816050e-01   -4.357275169630656e-01   -2.295511537151430e-01   -3.213491640206897e-01   -2.701321134067716e-01   +3.067847195606717e-02   +2.751427564563309e-02   +1.734845482612329e-01   +4.070323580068583e-01   -4.409367531390607e-02   -3.588367516357200e-01   -3.833258815314934e-01   -2.411909990996422e-01   -1.763767661287971e-01   -1.511231081411494e-01   -2.277466652776246e-01; -2.684992448440833e-01   +2.004636198309881e-01   +4.522460567303666e-01   +4.067048052511822e-01   -1.809923759284530e-02   -5.830506549644189e-02   -1.968583149797932e-01   -1.356146927723810e-01   +4.299416092264857e-02   +2.271511044057281e-01   +4.996081699257159e-02   -7.323362825642321e-02   -8.868954833079123e-02   +8.349368770679615e-02   -1.848956503792520e-02   +2.607641746283511e-01; -2.921481202592087e-01   +7.957719295044340e-02   +2.920326722641957e-01   +3.385988189648386e-01   +1.693461585303812e-01   -4.691665522988092e-01   -2.199021369624798e-01   +7.854761554861643e-02   -3.002603535347298e-01   -6.736471722506590e-02   -2.242448498771114e-01   -3.315061480837646e-01   -1.036821075821319e-01   +1.394934274941887e-01   -2.630223188110741e-02   +1.344451149922314e-01; +2.633899410837214e-01   +1.478578583575752e-02   +2.616994654619419e-03   -1.466444352982138e-01   +1.362322858953844e-01   -1.212721909151491e-01   -1.151657450644736e-01   -1.938797240723146e-02   -1.204211324883621e-01   +2.306276862008612e-01   -3.803175172927504e-01   +5.060471300163402e-02   -7.617213661780653e-02   +2.540779772894947e-01   -1.235621242049744e-01   -4.416500992513634e-01; +4.517066361737415e-02   -2.883844623850570e-01   -9.364692047544955e-02   -1.538816135549937e-01   -1.684823390779973e-01   +1.519744803664297e-01   -7.961565130701687e-02   -6.713341783294189e-01   +2.268227510636091e-01   +1.720272745115417e-02   -1.364920776204756e-01   +2.374381880938988e-01   -2.040108396627286e-01   +1.942196273722231e-01   +1.525108267941075e-01   -8.061641063779898e-02];
L1E_L1I_iGABA_netcon = [+2.172790785293578e-01   +1.334991101074393e-01   -1.713108103750321e-01   +3.884458395667359e-02   -2.758196265284424e-01   -1.744285677819895e-01   +2.880172881648584e-01   +4.807150949010685e-01   +2.163565661083970e-01   -2.126325103361041e-01   -2.624613907510431e-01   +5.743899880724090e-02   -8.764218898332350e-02   -2.915649787760841e-01   +2.553546662100877e-01   -1.234770230427292e-01; -5.335526961270249e-01   -9.284542860196829e-02   -1.164514804548834e-01   -9.900920942653332e-02   -4.810522948590482e-02   +2.182502278438409e-01   +2.323320225371264e-01   -1.203442241394717e-01   +4.150282511662773e-02   +1.301337612471632e-01   +1.839882687035734e-01   +9.071957099765771e-03   -1.645353072882394e-02   -9.935869676892918e-02   -4.057123601831283e-01   +2.263078040171348e-01; +3.767591748481873e-01   -1.743642580128378e-01   +1.496921943614219e-01   -7.150334209872870e-02   +2.282538658413731e-01   -4.580123634674385e-01   -2.383151054660502e-01   +2.588004443006139e-02   +2.581610134230814e-01   -6.991686301581920e-02   -4.741246221832746e-01   +3.924995545073328e-01   -1.993794200077203e-01   -8.797044779678520e-02   -3.658729198267288e-01   -5.977923266268234e-02; -1.199145651091436e-02   +7.931382537343881e-02   -1.420774523990390e-01   +1.192670082865531e-01   +4.308760212952881e-01   -1.302667402607141e-01   +7.585708298383750e-02   -3.050115108954309e-02   -1.191338042434196e-01   -5.127099784879272e-01   +3.663323755744648e-01   -4.460944510481839e-02   +1.801223755961581e-01   -1.038883482365664e-02   +1.643174922215236e-01   +2.687052652340679e-01; +1.939487290750137e-01   -3.123835683039491e-01   -1.969501383073181e-01   +1.921080271871310e-01   +1.237576129939529e-01   -1.254758311499506e-01   -1.987518598531679e-01   -1.712270233986778e-01   +8.826115203688462e-02   +1.409413766460351e-01   -1.877360178858043e-01   -1.178179461329715e-02   +4.411219185310090e-02   -1.245213772102344e-01   -2.619282078922723e-01   +1.942047199690311e-01; +8.552877268923020e-02   +3.680574652100530e-01   -2.388985110146698e-01   +2.123845007477087e-01   -3.445997948109583e-03   -2.076439682322292e-02   -5.857117999222160e-02   +1.335893221995946e-01   -2.788180992825374e-01   -1.071360207260581e-01   +1.156527947903910e-01   -9.329596695664519e-02   +1.451747250228896e-01   +1.452884260579019e-01   +2.164974421339132e-01   +7.625119037767666e-02; +2.296965045519613e-01   -2.506022797643286e-01   -5.503643834145139e-01   +4.617246045733446e-01   -2.540742487368838e-01   -2.666644813719833e-01   +3.295889477964878e-01   +2.849360986759276e-01   -2.642631936948285e-01   -1.529440034881949e-01   -1.128513361752121e-01   -3.513350032378215e-02   +4.809631575717663e-01   +2.765882849711934e-01   -1.907104500853031e-01   -1.157015489150930e-01; -6.303633087014160e-02   -1.649710856509223e-01   +3.143992454194581e-01   +1.631778106484650e-01   +2.652520545361279e-01   +1.380659769772267e-01   -1.143574142576045e-01   +3.297472877803665e-01   -3.398827749105318e-02   +4.600456832429620e-01   +2.161860420889359e-01   +4.494386796178128e-01   +3.874165487412376e-02   +2.121524812762316e-01   -2.288317932378519e-02   -2.973012437424863e-02; -7.906615592935148e-02   +3.431299562232191e-01   -4.145304921133107e-02   -1.827013760815247e-01   +1.754574327784495e-01   +3.802746020895011e-01   -3.317318642148663e-01   -1.465434726834527e-01   +8.391959070160904e-02   +3.905893614288208e-02   -4.044942208139612e-03   -2.121726273524366e-02   +7.102095784677070e-02   -1.505487177030187e-01   +6.598352424869221e-02   -1.530316022941819e-01; -3.749677611857040e-01   -2.068775352751454e-01   +1.504415334457032e-01   -9.928406789335242e-02   -2.325083051108925e-01   +3.343453932667367e-01   +6.307172186010959e-02   +3.243872503539486e-01   -5.165973385799696e-01   -6.281322797054822e-02   -2.948932079189808e-01   +1.024621620158230e-01   -5.131609950412487e-01   +9.930934631461580e-03   +3.024606018479551e-01   -6.445295488966626e-02; +3.896441856450800e-01   -1.833018398541928e-01   -1.205041062546363e-01   -1.704008068394043e-01   +3.638100859585206e-01   +2.642632490232265e-01   +2.207434390435919e-01   +8.064022981725294e-02   +2.496332234647712e-01   -2.671775956840840e-01   +4.792436202421524e-02   +2.591336365491561e-01   -5.323972650475700e-02   +5.119464595407384e-02   +4.405657547646163e-01   -8.383690269868328e-02; +3.871454147383891e-01   +2.312367733155141e-01   +2.815629224767996e-01   +1.234801812192488e-01   -2.043260097922280e-01   +3.487109499189797e-01   -3.055087452854982e-01   -3.965465038430395e-02   -3.928357997888447e-01   +1.297668018257553e-01   +9.689099560253954e-02   +2.752601090735662e-01   +2.246066310250249e-02   -7.004271861357991e-02   -2.235882994942272e-01   +2.406803522588744e-01; -3.331230323544801e-01   -8.729422508796703e-02   -2.340982034096056e-01   +1.448520348421131e-02   +2.377649055154942e-01   -2.203056110610345e-02   +7.395289020943119e-02   -2.687886458653778e-01   -1.669537060087522e-01   +9.124660573308824e-02   +1.684134688076744e-01   -1.315106339744496e-01   +3.223615114592995e-01   +2.054890684359921e-01   +1.081355163115681e-01   -2.976605237659599e-02; +3.030156288586551e-02   -3.189770397652000e-01   -4.401802297771894e-02   +2.733062253849993e-01   +7.626646797352446e-02   +5.476088130283238e-02   -6.887405742444094e-02   +2.488791675753411e-01   -1.534287120222028e-01   -5.309432971351480e-02   +1.071538819217296e-01   -1.443402772866222e-01   +1.264088315157361e-02   +2.421244813542443e-02   -3.517290794136559e-01   -3.871893610583503e-01; -3.036559833698255e-01   +2.736649872397444e-01   +2.002322289739203e-01   -4.091778282208368e-02   -2.312278540622347e-01   +4.236557374818785e-01   +1.775031417588140e-01   -1.472594283909814e-01   -1.104282087113903e-01   +1.578787188089724e-01   +3.248172079489173e-01   -1.954264894717389e-02   +1.111901291605893e-01   -1.818717739786604e-01   +9.106038421785284e-02   +2.159713007504603e-01; -1.198345171754274e-01   +7.877988246609166e-02   -9.442560689260221e-02   +3.135607604240074e-01   +1.474658510415893e-01   -4.382560430872776e-02   +1.618886572605530e-01   +1.135034270933526e-01   +1.286546946452356e-01   +2.041234364631313e-01   -1.955701351663422e-02   -1.468003988047289e-01   +2.285684864216781e-01   -3.469406365821100e-02   +4.185664102218054e-02   +5.997232816455314e-02];
L2I_L1I_iGABA_netcon = [+2.215937332474492e-01   +6.747742259716610e-04   +1.617804425467202e-01   -3.397714123748692e-01   +5.018109985185112e-01   -2.672894160505888e-01   +1.209636972891820e-01   -1.013097004503514e-01; +5.675671968756740e-02   -2.027872456919750e-01   -5.425820164207291e-02   +2.123630797703663e-01   +1.625863422907323e-02   -1.325349341026202e-01   +1.671148840241886e-01   -2.127462123025151e-01; -1.381205832839345e-01   -6.525565922028473e-02   +1.444039622418033e-01   -2.951667522175114e-02   +1.732054993936391e-01   +2.653586986390011e-04   -5.389801677519733e-02   -4.599772533548193e-01; -6.219741920838512e-02   +6.139191018391409e-03   +1.777281947041163e-01   +7.432235011141218e-02   +1.822849304326123e-01   +1.713435711501888e-01   -8.913800945988667e-02   +1.229035156093801e-01; -1.515633218241690e-01   -1.822303593284807e-01   +4.860299471146192e-01   +1.831912538733370e-01   -1.206909077046162e-01   +2.226635585862655e-01   -1.578398763641639e-01   +4.765183700708640e-01; -3.910724922181755e-02   -5.512966161537899e-02   +4.425556411416794e-01   -7.687433104748682e-03   -1.149038691356249e-01   -1.837200071850985e-01   -1.098387090831893e-01   +1.273069378417872e-01; +4.510560318660697e-01   -2.441606148005134e-02   -4.332414240734495e-03   -1.562086812080397e-01   +2.372061781727230e-01   +1.363614501891033e-01   -2.680066956596707e-01   +6.587955067478146e-02; -5.976668300319987e-01   +4.220754478091443e-01   +2.489256953980372e-01   -1.244494980506628e-01   -4.303064526681999e-01   +2.706001889409235e-02   +1.398815702424867e-01   -2.574391373968154e-01; +1.990928414193009e-01   -1.149959755465584e-01   -5.715862932946968e-02   -6.340342777791162e-02   +1.126717842495193e-01   -2.914255230243007e-01   -1.635742111189395e-01   -3.055331574932599e-01; +9.341230217054652e-02   +1.591872654718822e-01   -2.373616429076927e-01   +2.215633390332382e-01   -3.439863483964115e-02   -1.139548692008064e-01   +2.398623349595514e-01   +2.322806829256144e-01; +2.932780635802227e-01   -3.839392273309199e-01   -1.380729776690499e-01   +1.279540731406979e-01   +4.331478803272483e-03   -1.259782669073012e-01   -2.327983014709297e-01   -2.328737494688676e-01; +3.914057047448503e-01   +2.543669940143958e-01   +2.242959393107046e-01   +1.567444138155708e-01   -3.282289304435287e-02   -2.526559264693029e-03   +1.565474887799206e-01   -4.708986314005604e-01; +9.747476020081527e-02   +2.663390959991672e-01   +3.405363482453574e-01   +1.098456187161193e-01   +3.516036113479812e-01   +2.550382881219553e-01   +3.392624623892844e-02   -1.487797656541651e-01; +2.355083732341208e-01   +1.965035024095894e-01   +1.719467653054931e-01   -4.509484717633922e-01   +1.791833382904947e-01   -2.400533775655325e-01   -6.842426334879198e-02   -3.913499912426767e-02; +2.518823173287192e-01   -3.493778244293402e-01   +2.444807963155027e-01   +3.906910327863565e-01   +1.044365627677738e-02   -1.348378479892347e-02   -5.019083645152411e-01   -2.755823449973398e-01; +1.190917025698930e-01   +1.413001467655768e-01   +1.300160328588941e-02   +2.473244142395504e-01   +1.677244890652715e-01   +1.831331233999297e-01   +4.213918898884157e-01   -5.876933751263691e-03];
L1I_L2I_iGABA_netcon = [-9.506754018946045e-02   -5.964961609718891e-02   -3.366157000447709e-01   +7.757061846177758e-02   -3.494313449160137e-01   -9.078185434804187e-02   -2.113261522322850e-01   -5.345352060234307e-01   -2.487395663283787e-01   -1.056560937405237e-01   +4.204989246962088e-01   -2.318299342601031e-01   +1.178610918289756e-01   -1.243746031488503e-01   +3.704575368210539e-02   +1.678828816524507e-01; +2.264653154447938e-01   -8.850971613083847e-03   -1.435626312855313e-01   +2.073933181791658e-01   +1.653862593765203e-01   -7.956766778319074e-02   +2.413397791965513e-01   +1.224486530792909e-01   +3.106178133400566e-01   -1.298708824236921e-03   +1.725881588499694e-01   -2.619260438004657e-01   +4.560091951802097e-02   -2.587515148009026e-01   -6.960086023066116e-02   +1.189042081184346e-01; -3.120813600539311e-01   +1.041013217973806e-01   +1.109987629299860e-01   +6.600467807755514e-02   -2.415693688132546e-01   +2.084327686248383e-01   -1.484408247877234e-01   -1.913813743039905e-01   -2.586072673720998e-01   -2.479627247376227e-01   -1.032137038139138e-01   -3.377843501134630e-01   -2.197106515391050e-01   -1.170783772538846e-01   -1.178992626667116e-01   -3.255880635642042e-01; +2.711139324280241e-01   +1.672834872578171e-01   +8.180692940511748e-02   -4.514506824954226e-01   -1.340263696523857e-01   -2.829183327469388e-01   +1.210857961927067e-02   +2.202667860772727e-01   +1.517043332576832e-01   -2.220537300035361e-02   -8.279242442267584e-02   +5.581827832990063e-01   -3.606474055859982e-01   -2.765942391198243e-01   -2.175745597365953e-01   +1.683021287609464e-01; +3.623968372431270e-02   +3.944175392114856e-03   +1.290960459015230e-01   -5.118727397728658e-02   -6.846724111681074e-02   +3.250709587785048e-01   -1.315999628921792e-01   -1.993210255009349e-01   -1.073615896883771e-01   +1.237109317800321e-01   -1.987487434794475e-01   -2.096901202912972e-01   +1.285310406426316e-01   -1.050490353746451e-01   +1.568893467833021e-01   +9.442967354923952e-02; -1.575447176554680e-01   -2.213574959626433e-01   +2.607404576942185e-01   +1.044891950424295e-01   -4.337371973084522e-01   +6.867897979051660e-02   +2.239062362637751e-01   +1.355616638808137e-01   -1.235225109633852e-01   -1.218388701810450e-01   -1.374221115023267e-01   -1.603622027324659e-01   -1.702951150556658e-01   -1.783144656532773e-01   +2.891339549405768e-01   +2.825717553207133e-01; -5.810141106775585e-02   -4.356772382398116e-02   -4.074092255126685e-01   -5.720224071192828e-01   -9.420143175420582e-02   +2.472962965427098e-01   +2.290644341707256e-01   +9.399773226816632e-02   +1.601302372706868e-01   -2.682489986236998e-01   -3.882980707618586e-01   -3.181170830657613e-02   +6.000473410136064e-02   +2.588752434534800e-01   +4.096421821613060e-02   +1.006096233379989e-01; -2.868476288984115e-01   +1.278645775699471e-01   -3.658263037450751e-01   -1.758357696141988e-01   +1.205979413298724e-02   -1.152273526495606e-01   +1.916784519658182e-01   -2.057547657016989e-01   -3.614447243143358e-01   +3.677688916355616e-01   -2.340910868920350e-01   +2.501977382634887e-01   +5.541614357152851e-02   -1.432905031791337e-02   +3.700176711044836e-01   +2.674372038879497e-01];
L2E_L1E_iAMPA_netcon = [-1.068766007978555e-02   -1.732523280679597e-01   -3.110932349553992e-02   +2.538566812260382e-02   +3.142176614846133e-01   +4.655965895484935e-01   +1.136819036984867e-01   -1.251017892808372e-01; -2.237269753966047e-01   +5.699246643291200e-02   +1.433286925010362e-01   -5.067605857628639e-02   -2.415690354677063e-01   -1.072032335825241e-01   +6.155168398785989e-02   -1.844536635160012e-01; -1.332930889942118e-01   -2.467426125393335e-01   +7.177184922190913e-02   +1.717410390232710e-01   +1.681643415402740e-01   -1.547808636372019e-01   +2.005722280252476e-01   +9.425450067250035e-02; -6.828837132949001e-02   -7.074574975652530e-02   -2.728628753252276e-01   -8.899562673251482e-02   -1.817356434144042e-01   -3.043497989523929e-01   +2.892127421110639e-01   +9.875291233092542e-02; +2.189000722795195e-01   +5.028521261259303e-02   +5.938716077386508e-02   -2.202379754725362e-01   -2.443115908957662e-01   -3.004986595874548e-01   -5.949316390716292e-02   +2.174833924423304e-01; -1.185723162227649e-01   -5.153230340939866e-02   +1.661962201898321e-01   -4.068606829893598e-01   +1.603782472714615e-03   +7.038316081820881e-02   -2.321645210626262e-02   -1.054464700866364e-01; +3.569952047341997e-01   -1.047828006477050e-01   -7.381206964415937e-02   +1.095907444781379e-01   +3.008511178308487e-01   +6.832100774276234e-03   +3.109338239745362e-01   +1.766752276252951e-01; -1.553261585220970e-01   -4.860357146676551e-02   -2.275722777215420e-01   +6.241683585853652e-02   -1.521971551594011e-01   -4.578537277274953e-01   +1.072362089106707e-01   +2.757250785128497e-01; +1.071613719654899e-01   +7.918303619216767e-02   +6.968880022577394e-02   -2.434209642592238e-01   -1.744100550991095e-01   +3.016172487651262e-01   +1.425296165996618e-01   +7.150474767853107e-02; +1.150600054605131e-01   +1.548270784827836e-01   +1.452177224827471e-01   -2.650679166570150e-04   +4.167529109250542e-01   +4.784579578744945e-02   -2.543743778859459e-02   -6.661109239585625e-02; +2.169105663968871e-01   -2.326318925293155e-02   -1.900742728385089e-01   -4.329287617596931e-01   +4.411938224593901e-01   -3.201844631827298e-01   -4.465824674918612e-02   -4.124921993463438e-01; -3.173364109953811e-02   -4.793929822237836e-01   -1.631475459333259e-01   -3.665980535070738e-01   -8.055712454190676e-02   -4.631932009969335e-02   +4.898716237367313e-02   +1.536989285977926e-01; -3.493747221473885e-01   -1.646673182397273e-01   +2.548450305649891e-02   -7.012709584615812e-02   +3.171455802157886e-01   -3.438040690426859e-01   +2.401637768269601e-01   +1.384365885428007e-01; -4.499100205810754e-02   +1.607695293687926e-01   +1.821419213903404e-01   +1.085942059593728e-01   -2.967895891708341e-02   -8.501943588958263e-02   +1.750020781545503e-01   +1.387377015180508e-01; -6.733573771029676e-02   -1.759424916289869e-01   -1.166604446993280e-01   -9.159280509436202e-02   +3.127132974043836e-02   +1.161225714925919e-01   +1.202826716031729e-01   +3.676835879041597e-01; +1.376204873040683e-02   +2.147551831222079e-01   +2.071805850837179e-01   +2.526502072215812e-01   -3.518020368703592e-03   +3.580327017890638e-01   +3.545463126846281e-01   -1.006980038793309e-01];
L1E_L2E_iAMPA_netcon = [-2.832467082568488e-01   +3.159744509276282e-01   -4.686112765673198e-01   -1.635961228855508e-01   -1.275641485081817e-01   -3.015528483981539e-01   +2.275248697326868e-01   +2.974740477466685e-01   +1.454789911262833e-01   -9.397560019445417e-04   +8.248023361345294e-02   -2.103772941582507e-02   +3.160700019243348e-01   +1.161278723251773e-01   +1.752635652711630e-01   -3.604175749624453e-01; +1.544949460071128e-01   +1.360959102245493e-02   -3.184622868343222e-01   -7.659016816135607e-02   -8.641116645333692e-02   -4.118800765307275e-03   -2.290063193319963e-01   -1.282092303546488e-01   +1.141671494614632e-01   +1.406754943151587e-01   -2.413453774581204e-01   +9.586126426976449e-02   -1.371780653967953e-01   +5.918305562710310e-02   +5.056186187265322e-01   -3.365531406267230e-01; -4.293159019719262e-01   -1.867830593379360e-02   +1.397655583707554e-02   -1.788296400621789e-01   -2.324797938718191e-01   +2.327679140289537e-01   -7.531207386775761e-02   +2.145439536407049e-01   +2.660020523365548e-01   +2.956948758764485e-02   -5.038593158619083e-02   +2.076632722790923e-01   -2.669626006405095e-01   -6.599778885800620e-02   +1.076356883453866e-03   -2.264491482805560e-01; +1.626731516556109e-01   +1.519686962551780e-01   -7.776363722490748e-02   -1.279441007501878e-01   -5.368454804608738e-02   +8.477522937112579e-02   -2.949230953177428e-01   +2.145041846476997e-01   +3.305004621058115e-01   +6.708302033449941e-02   +1.675204392270567e-01   +2.606764502442567e-01   -4.122947994627222e-01   -3.412242092051762e-01   +3.126202146959842e-01   +1.471285118246246e-02; -1.308871536527239e-01   -2.139908682445928e-02   +3.544974177604530e-01   +1.266596080457626e-01   +3.629814829103607e-02   -1.889097876583327e-02   -3.506153975002836e-01   +2.730003624201862e-01   -2.620331340613499e-01   +4.963245185913943e-01   -1.325177686219575e-01   -3.560965447863209e-01   +4.099477543745378e-01   -1.513599651270062e-02   +1.287450701324530e-01   +1.775007889444575e-01; -3.506138588844022e-01   +2.659414532366229e-01   -5.181580880454743e-02   -5.596816055197378e-02   +3.530781059067153e-01   -8.033998346160913e-02   +1.771175287950885e-01   +1.329693871383934e-01   +5.432544849859346e-02   +1.235636294212051e-01   -4.368792376059515e-01   +1.041921968158916e-01   -6.877192496612396e-02   +4.193181184066312e-01   -9.356203259202778e-02   -3.075561316776016e-02; +1.313185486470999e-01   +3.894746240256844e-02   +6.102251229604133e-02   +7.946513366681665e-02   +1.758650231091252e-01   -9.955593902136138e-02   -2.169517786181863e-01   -1.385667970742321e-01   +2.591634519316467e-01   -3.368559043049335e-03   -2.679949846716123e-02   -6.127636471155479e-02   -2.401567181045335e-02   +4.435337703853004e-02   -7.735755806664826e-02   +2.082282627200094e-01; -1.299851220965610e-01   -1.614498527628303e-01   -1.151132535413193e-01   -1.619899224633727e-01   -4.257838834425122e-01   -3.578705261551623e-01   -7.535007961434645e-02   +9.205558837322250e-02   +2.642518238259993e-01   -1.120332605826954e-01   +1.409288571977205e-01   -3.244977659268276e-01   -9.738212047767232e-02   -6.248440378230009e-01   -2.419552450869899e-02   -8.044182441878080e-02];
L2I_L2E_iAMPA_netcon = [+2.757557769951326e-01   -1.184259674196850e-01   +2.801655145409500e-01   +2.007393831661418e-01   +2.954291316491393e-01   -1.475004748600248e-01   -1.299249479659899e-01   -1.655548268145378e-01; +4.303705482864767e-02   -9.085413939955551e-02   -4.519605849656524e-02   -1.469706807329909e-01   +1.995828303413745e-01   -1.873197863680456e-01   -3.139331310264821e-01   -1.079515775268167e-01; -2.539169218886483e-01   +1.122391566013312e-01   -3.232081617604997e-01   -1.582866542426106e-01   -4.592064609901741e-01   -1.271571661095099e-01   +3.510619029499955e-01   -3.908144966004917e-01; +6.213718011678061e-03   -1.211017900315195e-01   +2.372950522511819e-02   -1.419310156912518e-01   +4.700395027811111e-02   +4.189102996013434e-02   +3.258251469892368e-02   +1.357377653543268e-01; -2.932702019760008e-01   +2.174081428833230e-01   -2.571652217131052e-01   +1.682095668839726e-01   +3.696329699670088e-01   -1.583960043335428e-01   +4.023578133594348e-01   -1.910047387378807e-01; +9.626109520854620e-02   +1.501680700020324e-01   +3.508171664063511e-02   +2.661311429459174e-01   -2.723220471981460e-01   +7.900081938613528e-02   +2.191740926422510e-01   +4.452525942246468e-01; +2.423446222227605e-01   -2.326955823671137e-01   +3.302757570053216e-03   +3.095496445307580e-02   +1.605154917698318e-03   -1.345929718258583e-02   -5.533448247735996e-02   +3.448080855661728e-01; -1.150988325268331e-01   -3.054114655743255e-01   -4.237689571253842e-01   +2.082447605827722e-01   -8.937501457337266e-02   -9.898359956585109e-02   -2.393333219493921e-02   +6.187251746572184e-02];
L2E_L2I_iGABA_netcon = [+9.176901268619561e-02   -5.015315778617877e-02   +1.046865502007585e-01   +2.701914757647337e-01   -2.417862049600804e-01   -2.667048352828444e-01   -1.903774640212150e-01   -2.234598794454959e-01; -3.911372136194285e-01   -6.624020974853551e-02   -1.258268328770512e-02   +1.317492349180317e-01   +3.599589659128124e-01   -8.708685871679869e-02   +3.344224416183705e-01   +1.086652530884226e-01; +2.050527429532322e-01   +2.711188761147239e-01   -4.576230702791600e-02   -2.415203051905850e-01   +1.773680151883426e-01   -1.313930202521668e-02   -8.070565904584809e-02   +2.313164228477804e-02; -2.899582474914430e-01   -2.551147351691088e-02   +5.888438405598734e-02   +3.001306779766997e-01   +7.478783900466464e-02   -1.607751325468845e-01   +3.806393011724446e-02   -1.751614940959845e-01; +4.419626799473150e-01   -3.501446436098500e-01   -6.582460475301952e-02   +1.702727904758021e-01   +1.329241790554927e-01   +4.551221889289918e-01   -1.734586083026653e-01   -1.165127246182894e-01; +2.593727239008718e-01   +3.054828021497552e-01   -1.111778184067949e-01   -1.908370910309697e-01   -2.925739328977439e-01   +2.831393190213625e-01   -2.710713716826999e-01   +9.156342388517301e-02; +1.207623868571593e-01   -1.279712922084606e-01   +2.829454963054305e-01   +1.342120309506740e-01   +8.950673013191507e-02   -2.545118285981773e-01   -9.682953671292510e-02   +1.692218066468541e-02; +9.025507307331475e-02   -7.052013743310162e-02   +1.394394577517859e-01   -6.802765441776017e-02   -1.463215023737184e-01   +2.733940793953810e-01   -4.029423124237266e-02   +2.857122223753428e-02];
L3E_L2E_iAMPA_netcon = [+3.236637692473737e-01   -2.865694342954750e-02   +1.845441780002437e-01   -9.597105927319710e-02   +1.521773074462236e-01   -2.129695004608756e-01   +6.417768306193021e-02   -1.556068138429040e-01   -5.066263785306740e-01   +7.386468493997070e-02   -3.297462040499769e-01   +2.027612070999180e-02; +4.440558000243752e-01   +2.477808603238874e-03   -2.343911546268789e-01   -3.444626962790945e-01   -4.686988700683063e-03   -1.332988307478477e-01   +1.288744133018445e-01   +1.174416545764385e-01   -1.887549419805153e-01   +1.952653312115016e-01   -8.280828286779711e-02   +4.009264255925173e-01; -1.381908241220818e-01   +7.089920326508534e-02   -8.020064277560407e-02   +2.303826060044140e-01   +1.454574816176693e-01   +3.533178374140125e-01   +1.620820177992023e-01   -7.933209825947402e-02   +2.318264009400178e-01   +3.377489185145242e-02   -4.074924208642685e-01   -1.464098061941149e-01; -4.823937125723686e-01   +1.947793812149490e-03   +7.376803708988855e-02   -1.250845907132215e-01   -1.408034241016586e-01   +1.112590937222598e-01   +5.387132969314739e-01   -3.690913730650747e-02   +1.113365186356513e-01   -1.757793583714994e-01   +1.209843698707505e-01   +6.860607949869232e-02; +2.475908283147816e-01   -3.126316725621135e-01   -1.562463106115292e-01   +3.436139941062309e-01   +2.355901261869988e-01   -2.056381920616361e-01   -5.356838765029325e-01   +3.880940440539185e-02   +1.197458950771597e-01   -6.676179148899891e-02   -1.874538938559275e-01   +2.511768551070094e-02; +1.595464338973516e-01   -6.093081776358179e-03   -3.303519465722368e-02   +3.612057975050265e-02   -1.484243053555333e-01   +2.609067148306813e-01   -1.824975162666418e-01   -1.394970738128127e-01   +6.493499948867174e-02   -4.682444287807752e-02   +3.639992197019197e-01   -2.983357563859119e-01; -9.233838823055807e-02   +8.437950845991357e-02   +1.210434638992740e-01   -1.646641538530894e-02   +1.413574806593142e-01   -2.860378888052871e-01   -1.927014240404669e-01   +3.785549031344191e-01   +7.063417364595333e-02   -3.030459362994954e-01   +5.109831414161543e-02   -2.692337175741435e-01; -6.837876230574940e-01   -6.109133552029952e-02   +1.686450565351023e-01   +3.145074759474284e-01   -1.874375274403989e-01   -2.050021658396249e-01   -3.732547915339345e-01   -2.215411547929309e-01   -2.672919995710738e-02   +1.351367083151062e-01   -9.650927516675709e-02   +1.418142445555741e-01];
L3I_L2I_iGABA_netcon = [-2.832806065255694e-01   +2.656126823019053e-01   -1.087489338522735e-01   +6.650998039456500e-02   +1.656883695371272e-02   -2.498666316718628e-01   +2.203806506743146e-01   +2.669257651775699e-01   +2.649924742230772e-02   -1.823099174528966e-02   +3.030420384820400e-01   +1.043159841107426e-01; +4.368538007173429e-01   +3.051123723229616e-01   -2.760152116418356e-01   -1.795922491781976e-01   -2.673762713517924e-01   -5.886547448230216e-02   +4.036618605697405e-01   +3.111444524489079e-01   -3.048019506710509e-01   -2.089083643178160e-01   +1.832053171881047e-01   +3.019374150851926e-01; +1.152209631743993e-01   -2.084016335417886e-01   +1.106044636611166e-01   -4.910355243671554e-01   -6.732132988827441e-02   +2.933325371425497e-01   +3.154869414114785e-01   +1.532238836632109e-01   -1.852981993972249e-01   -3.801338334064033e-02   +8.519241218219598e-02   -2.112651241833639e-01; +1.320259392496453e-01   -3.602850796528152e-01   +3.860334206710279e-01   +1.298587143196887e-01   -2.261656778413774e-01   +6.503611295547053e-02   +4.714878136219812e-02   +1.032257083530042e-01   +2.319079696311444e-01   -3.446479032849170e-01   +3.490398360566292e-01   +2.690872791576249e-01; -6.915006284025244e-02   -3.524104621979330e-01   -1.438165708879883e-01   -8.575197654163993e-02   +2.461830538927633e-01   +2.446799626589130e-01   -3.107940519286461e-01   +1.582652940561747e-01   +3.423979678228700e-01   +2.101071758553645e-01   +2.998506714032684e-01   +3.252399568111385e-01; +5.005160924088408e-01   -3.448973600391302e-03   -2.622440647522353e-01   -2.067429036754261e-01   +2.050416562085482e-01   -8.096221913848901e-02   +5.631803046578247e-02   -3.567029676320866e-01   -2.435498109237542e-01   -8.914295994847257e-02   -2.625021871930958e-01   -7.157177842878717e-02; +2.442264284933653e-01   +2.081501850452072e-01   -9.586891109143467e-02   -2.230955605308748e-01   -4.486222012732876e-01   +9.604349620056915e-02   +4.409612135104222e-01   -8.754448170534501e-03   -4.242760507857923e-02   +1.303048252728098e-01   -2.409162404797047e-01   -4.316723588943360e-01; -5.487297411883660e-02   -5.810874058402804e-02   +1.345103275640033e-01   +2.211536373458385e-01   -6.958615278724942e-02   +9.434006909868856e-02   +1.762009332080683e-01   +6.312963545662326e-03   -5.080004840394899e-01   +2.589140020080818e-01   -5.881212488382576e-02   +8.309236197893349e-02];
L2E_L3E_iAMPA_netcon = [+1.155385408074386e-01   -4.268948813683782e-01   +1.035102207109621e-02   -1.406065185356999e-01   -2.324877481442624e-01   -4.943397198493182e-03   +1.185453955400843e-01   +2.253273149213927e-01; -1.890058220168520e-01   -3.997092766503127e-02   +8.560401257148520e-02   -2.063007653167491e-01   +4.443984681382024e-02   +1.702561205139605e-02   -2.108201085037871e-01   +8.020055255501660e-02; +1.850339667692284e-01   +3.505202405457186e-02   -1.626418006610673e-01   -4.687556276362553e-02   -8.863066004407197e-02   -2.245777893371712e-01   +3.326779635360031e-01   +4.755219014692488e-02; +1.636918023940189e-01   -3.316794289210220e-01   -7.105161086788209e-02   -6.528809101918628e-02   -1.286728367310239e-01   -9.773548567294327e-02   -4.800197823439553e-01   +1.947920704387262e-01; +1.709757773514851e-01   -1.528206160520744e-02   +1.480973504999940e-01   +2.645613136597408e-01   +1.014444007342972e-01   -2.208775002532885e-01   +1.101581564959168e-01   -4.043626318435375e-01; +4.193784241039050e-02   -7.623878540535511e-02   -3.300178325088861e-01   -4.053156239573724e-01   -3.858171173695939e-02   +2.880501380701810e-01   -9.899385444328902e-02   -4.325931498783355e-01; +1.179557526704445e-01   -1.160913263859227e-01   -3.511174447549424e-02   -1.341497164394880e-01   -1.097748954778731e-01   -1.977013631970626e-01   +1.891337204268121e-01   +1.081919282329772e-01; +2.157090055679854e-01   +1.386006862453517e-01   -2.350128497869326e-01   -6.599672120769448e-02   -1.571666994620023e-01   +1.820288986761002e-01   +1.026669694757461e-01   -8.092699692374944e-03; +2.436916942836001e-01   +3.975408735715474e-02   -5.342923747887349e-01   -6.233691158697555e-02   +5.273527544055461e-01   +1.792711232111411e-01   -1.711650989357210e-02   -3.415928527477896e-01; +1.021005902863206e-02   -9.596754412250381e-02   -3.284421410361511e-01   -1.059287887255259e-01   +2.296022454070054e-02   +1.439474969478499e-01   +4.920723672092689e-02   +7.119949761948963e-02; -8.696216638526563e-02   -2.930544322728725e-01   +8.061721409767518e-02   -1.391718542150084e-01   +4.333502112227788e-01   -3.138295042006436e-01   +5.052361583191310e-02   +1.142219110821075e-01; -1.652956516616883e-01   +2.873552006135027e-02   +2.206912889077639e-01   +2.945591977844270e-01   +1.323663469192810e-02   -3.834456860537940e-01   -2.488482351503784e-01   -3.051625107111225e-01];
L2I_L3I_iGABA_netcon = [-2.524140742811553e-01   -1.409530903984598e-01   +6.326895475749339e-01   -2.892249181464146e-02   -1.794902676104645e-02   +1.865189123233049e-01   -1.571814398879636e-01   -3.862794037063391e-01; -3.565816794316728e-02   -3.606117126560021e-02   -2.377531999198624e-01   +3.261393849090569e-01   -2.383952510955770e-01   +2.078594696993025e-01   +1.787747946674874e-01   -2.821856615813085e-01; +2.875194115948930e-01   +1.327379022281400e-01   +2.519978530778060e-01   -1.897889362867276e-01   -4.050253425091625e-02   +4.030073692471494e-02   +3.060631333281032e-01   +3.549129658711355e-01; +1.951972483100432e-01   +2.775153525101233e-01   -4.608356171719769e-02   +3.783409505818375e-01   +1.160941773763575e-01   +6.018912987909850e-02   +3.411254131058570e-01   +4.404265586495261e-01; +6.557385100567886e-02   -1.904496141288019e-01   -7.031110104913862e-02   +3.849505954567644e-01   +2.051504378570164e-01   -3.967773277562184e-01   +1.375520667855063e-01   +1.308156353056592e-02; +7.056988577126563e-02   +1.354803950966135e-01   +8.865881516823311e-02   -2.314284823041823e-02   -2.559166705280525e-01   -1.133675900450458e-01   +1.532314662239876e-02   +1.148651424424675e-01; +3.045206680537137e-02   +2.046729358335658e-01   +1.613937540109308e-01   -2.782862666340926e-01   +3.382663904165976e-01   +4.145937441015755e-01   +2.469135710208646e-01   +1.856105699447427e-01; -1.727304971680528e-01   -2.240644442866095e-01   +3.537221358245982e-01   -2.646400314332532e-01   +4.638943374637733e-01   -1.207470221831118e-01   +1.273769168485717e-01   +7.250061953359593e-02; -3.639600383052469e-01   +1.846289801318307e-01   +3.232261207481837e-01   -1.199318945499524e-02   +8.140489022158706e-03   +3.177127106131473e-01   +8.184489168125067e-02   +1.776085447498146e-01; +7.526543571503180e-02   +3.305495212570910e-01   +7.012916320564477e-02   -3.373680816488080e-01   -2.280149164375613e-01   +2.933873246129520e-01   -2.543605752735910e-01   +6.058915823539117e-02; +1.251392861965918e-01   +1.180223577432371e-01   +4.566626753502747e-01   +7.610212227408045e-02   +1.884248277486794e-01   +2.719882541458293e-01   -3.707006620221974e-01   +1.441967377745728e-01; +3.517010448566836e-02   +6.696025511455042e-02   +4.644518441358968e-02   +2.032830034124625e-01   -2.623107354242310e-01   +2.352810966421695e-01   -1.525366193014527e-01   -1.094443030250599e-01];
L3I_L3E_iAMPA_netcon = [+3.390252131556875e-01   -1.101664706841100e-01   -1.335465582295219e-01   +2.587483873462686e-01   +1.460579797065805e-01   -1.107207785732120e-01   +7.256228012758481e-02   +2.285322531857284e-01   +2.077314835672043e-01   -3.231794448888313e-01   +7.336751584288620e-03   -2.666432230826316e-01; -1.146925247920846e-01   -5.556477367636321e-02   -5.130813021429981e-03   -9.955775163385011e-02   +2.392149263985451e-01   +2.719339720660498e-02   +8.015002840064432e-02   -2.601805957767562e-01   +3.493407896448782e-01   -2.727650107491185e-01   -2.948659604689361e-01   -1.257197306385160e-01; +1.382513784180400e-01   +2.086589993151555e-01   +2.109864616880551e-01   -1.008824309437645e-02   +1.356541287946058e-01   +8.126738624794505e-02   +1.802627147019894e-02   +1.378313907135282e-01   +2.556968592465680e-01   +3.442693116002131e-02   -2.166158072295707e-01   -4.315335666093938e-01; +3.289785239297704e-01   -1.373153909868111e-01   +2.057945065153434e-01   +3.276293662926978e-01   -9.656457790199639e-02   -2.306819051548004e-01   +1.883256028456595e-01   +1.346228398118476e-01   +3.725592110086323e-01   +2.366298119303162e-02   +1.761272567976857e-01   +1.392655288636133e-01; +2.107654412474801e-01   -5.159023743681719e-01   +1.069717681584153e-01   +3.818308413979470e-01   -1.646333938346941e-01   -3.575192494552060e-01   -1.041282747641041e-01   +4.304754086452660e-01   -1.586014412135968e-02   -7.316386741595431e-02   +2.054610393283622e-01   -1.362989814994843e-01; +3.740231757439222e-01   +2.369279466403310e-01   -2.920826026603915e-01   +4.042978609210640e-01   +2.457841869371314e-01   -4.978849408453297e-01   -1.049639916879496e-01   -2.892340792399160e-01   +8.704714159246486e-02   +2.141624436430253e-01   -4.585208691072176e-01   -2.760712633870389e-01; +3.620220274206062e-02   -2.303345377821575e-02   -2.732597430125743e-01   -2.941280545900674e-01   +1.509529801498974e-03   -3.224452503720453e-02   +2.173060762417997e-01   +1.192528164892452e-01   -2.509143124336977e-01   +2.007303873781106e-01   +2.051352910237445e-01   -2.533278763010338e-02; +3.210296936551754e-01   -2.321972738496178e-01   +1.753717618316406e-01   +6.389016876888429e-02   +2.913027936849994e-01   -1.085632074055605e-01   -2.909318570268667e-01   -1.260731711771698e-01   +2.258627306208644e-01   +1.561096998891209e-01   +1.141607653424664e-01   +3.627437554903194e-02; +2.295041034821347e-01   +3.194957775944406e-02   +1.772081657044521e-01   +7.066864764342606e-02   +2.040538749512925e-03   -2.579966985562528e-01   -8.851043768895184e-02   +1.544243674202149e-01   -3.732399664050224e-01   -3.102088094882362e-01   +1.199206535892647e-01   -7.582910038339646e-02; +2.404274405462554e-01   -2.241631230081444e-01   -2.141621921041902e-01   +1.432371024458527e-01   -4.156639725640880e-01   -1.516505610500215e-01   -1.082099484036743e-01   +3.032532627815007e-01   +2.141765978327059e-01   -9.486811633039557e-02   +1.987081989311234e-01   -2.757417183724917e-01; +1.319312680181560e-02   +2.338091138159656e-01   -6.295006661564753e-02   -1.150899347430893e-01   +1.628136545647910e-01   -1.156507003972756e-01   +9.086917389897474e-02   -3.149700246301318e-02   -4.226054170422487e-01   -7.325372446809850e-03   -1.955179366039100e-02   +2.181518031084194e-01; +1.960345243304931e-02   -2.609911669194271e-01   +1.395457112381109e-01   +2.426864841105622e-01   -1.881612790452925e-01   +3.413985619243126e-02   -3.234839439847625e-01   -9.949918492680471e-02   -1.338589867016182e-01   +1.513474166372989e-01   -2.342187665101205e-01   -4.100467834113810e-02];
L3E_L3I_iGABA_netcon = [-1.439181169278524e-01   -4.697002987978129e-02   +3.351524461463019e-01   +3.544087696683780e-01   +2.890577363569024e-01   -4.751805355999956e-01   -1.367461012120351e-01   +4.015204112666798e-01   +2.565688995703554e-01   +2.895107558708300e-01   -7.029280391216311e-02   -1.262395885705734e-01; +2.421906221275758e-01   +6.603870631940005e-02   -2.626930851384726e-02   +1.443725631796480e-01   +6.463694176598969e-02   -2.014213627289258e-01   -7.107459362887011e-02   -1.505129466531845e-01   -1.811039520764111e-01   -2.718343100450070e-01   -3.684450934726295e-01   +2.466697090015335e-01; -2.780730631600712e-02   -9.954170262128531e-02   +1.837588550434313e-01   +8.245880806817267e-02   -4.280402730235112e-02   +1.608241428810202e-01   +2.006122778630542e-01   +2.544372109528497e-01   +4.289531136041771e-01   +2.681273937726684e-01   +2.353864467610689e-02   +1.591574624064074e-01; +1.967408147909902e-02   -2.204617870836488e-01   +7.799027016625452e-02   +2.395392728502572e-01   +1.420693075368587e-01   +5.060048126488681e-02   -8.905590897826729e-02   -3.833854012122265e-01   -7.303610005518145e-02   +1.362997217541936e-02   +2.402414323419562e-01   +1.536140907622791e-01; +4.973575577119360e-03   +1.684620858413657e-01   +2.291260392203432e-01   -2.056181166217298e-01   -9.934138323960839e-02   +1.017156061921981e-01   +2.789803657338551e-01   -4.494081137810599e-01   -4.176610694777854e-01   +1.311383758827121e-02   +3.746123979902046e-01   -3.575279383084353e-01; +2.203064393386648e-01   -1.637668083677707e-01   +1.620678183072644e-02   +3.751782292967428e-01   +1.043640836641932e-01   -1.948675763108860e-01   +3.476220725842343e-01   +2.140901857999988e-01   -8.091741127253424e-02   +1.412619591565429e-02   +2.058659968470241e-01   +3.061902732780081e-01; +1.396489266432598e-01   -3.736471134706425e-01   +4.028829891328236e-01   +1.179226120358108e-01   +3.281562487461720e-01   -8.870241857672642e-02   -5.078025736773673e-02   +1.176297578294179e-01   +7.600927490431272e-02   +3.146162343695116e-01   +8.851098754275359e-03   -1.264392992156947e-01; -9.606106441141822e-02   -2.925022878481464e-01   -2.413128143749368e-01   +6.475578440893659e-02   -5.016497423089847e-01   -3.810998156125869e-02   +1.101829304020970e-01   +2.334640209042422e-01   -9.234955380820592e-02   +9.822382108576455e-02   -4.895985555790341e-01   +2.104509781359739e-01; -2.420785215756162e-02   +3.516125327781998e-01   -3.815057613626270e-02   +2.937630482498529e-01   +2.915909295406369e-01   +1.419593964086621e-01   -3.264615351516450e-01   +3.886544163075296e-01   -1.695246169185710e-01   +1.072096313863079e-02   -7.205058551327338e-02   +1.063122852333620e-03; -1.958189027513655e-01   -1.150240157067946e-01   +2.679799962072751e-01   -6.204072547238943e-02   -1.169357306375906e-01   -3.422260413685619e-01   -2.203755779619390e-02   +3.522158685082855e-01   -1.462615670021860e-01   -1.001591204385236e-01   +3.416850584013181e-01   +3.486602071730108e-01; +4.400110098879137e-02   +1.101069245369423e-01   +1.504381862543401e-01   -9.316769421444364e-02   -2.906918104437517e-02   -1.001066456582321e-01   -4.803760884850123e-01   -1.939440819644104e-01   -3.718398154222995e-01   -1.980687546072272e-01   -4.162395350711070e-01   +1.262531403720998e-01; -4.603004781913677e-01   -1.549326214652135e-01   -4.225771811249108e-01   +3.389412513350459e-01   +3.897275929490723e-01   -2.611910573061037e-01   +6.040138468442666e-02   -3.873387708855204e-01   -1.318992745001116e-01   -1.315963123278955e-01   -9.328476982619163e-02   -3.227997327376202e-01];
L2E_Input1_iAMPA_netcon = [+3.673620806184127e-02   +1.010112745448849e-03   -8.118026352079064e-02   +7.204916638661710e-02   +2.102541862502240e-02   -1.308276578420687e-01   +5.758883160134776e-02   -4.851310441559898e-01];
L2I_Input2_iAMPA_netcon = [-1.966663535884390e-01   -5.368693680426173e-02   +1.824506761626676e-01   -7.367664397587020e-02   +9.175883699401852e-03   -1.417439264066982e-01   -3.238456992310796e-01   -6.915118311227153e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
