function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.635374482278964e-01   +7.294177574899940e-01   +8.581536283935088e-01   +2.351982940281580e-01   +2.962223706547490e-01   +6.527663984775349e-01   -7.188003545718649e-02   +4.018195743798514e-01   +2.869262380705370e-01   +1.461629730290429e-01   +4.063623969148215e-01   +1.647038326566850e-01   +4.557085852458529e-01   +2.607568555744414e-01   +2.498973166027656e-01   +2.598744535354339e-02; +7.753551857368207e-02   +8.611230915989978e-01   +7.800856021612627e-01   +6.785722947771465e-01   +2.960012607388149e-01   +6.647177470914450e-01   +6.392553587422497e-01   +2.135945598394809e-01   +1.406437467276940e-01   +7.234390698492770e-01   +5.186242704088458e-01   +6.100612191681778e-01   +3.914412748729638e-01   +2.681828603844759e-01   +5.720050292058844e-01   +3.178945434721597e-01; +2.200349255178951e-01   +2.503595107749393e-01   +4.239114878722133e-01   +4.519449909195085e-01   +6.136661510373621e-01   +4.104906618732639e-01   -2.679079867852826e-02   +5.947958025104596e-01   +3.193882146916251e-01   +4.725880269916983e-01   +7.709646696533126e-01   +2.486104124909330e-01   +3.669712132106517e-01   -8.242512901464903e-02   +3.079840065641367e-01   +8.428630896842215e-01; +2.029673807477216e-01   +6.264867201450890e-01   +1.428826299114322e-01   +2.480356290130531e-01   +7.904585251551165e-01   +7.738223501952339e-01   +1.781980244690624e-01   +5.663154159257138e-01   +6.445793271369457e-01   +4.286943642387458e-02   +1.666407895995005e-01   +7.430441017019705e-01   +5.022630455487624e-01   +2.110402140144360e-01   +5.644618740488611e-01   +4.110850700291488e-01; +6.041603141471702e-02   +6.268582307823891e-01   +7.477448863213758e-01   +7.107184403775856e-01   +4.589734939630732e-01   +3.426402775569706e-01   +4.257602901769494e-01   +3.187757713567231e-01   +3.123555396670764e-01   +4.693853923083913e-01   +1.823176825395138e-01   +6.145120131297195e-01   +3.232403085594918e-01   +7.210119841869478e-01   +1.947503824233994e-01   +8.455968529742309e-01; +1.365765661723997e-01   +1.451264695348701e-01   +7.228055866747889e-01   +7.770962149327526e-01   +5.666687488001695e-01   +7.934077908077917e-01   +2.831812667819159e-01   +3.904190498571206e-01   +8.425115726208648e-01   +8.486201698087710e-01   +7.965893695118638e-01   +6.515339361602779e-02   +4.170726961647243e-01   +9.915765992863593e-02   +8.312624189750640e-01   +3.756735426216480e-01; +3.219417885614640e-01   +6.496401326612007e-01   +6.569183820732807e-02   +3.210457933603867e-01   +7.152211387067301e-01   +4.865678210730036e-01   +3.803450027481218e-01   +5.326855739054738e-01   +8.917011723365456e-01   +8.502605366488151e-01   +5.723577229504710e-01   +1.196362892809248e-01   +3.443785430234747e-01   +4.235141370924774e-01   +6.622526060268172e-01   +7.928891952977777e-01; +5.944340358661406e-01   +6.361824475381468e-01   +7.443661048286644e-01   +3.743932783583257e-01   +5.439448936596930e-01   +5.175778285610808e-01   +9.815735137257026e-02   +4.597640598965879e-01   +1.000000000000000e+00   +7.672865417953381e-01   -2.274080457899789e-02   +6.982039686930951e-01   +7.187582799927484e-01   +5.429026448118808e-01   +2.532836645162133e-01   +7.886517805492980e-01; +4.341646963257517e-01   +3.983724719174134e-02   +1.971662997248889e-01   +2.161289378983656e-02   +3.595901113377182e-01   +1.254300459334125e-01   +6.228250587852419e-03   +5.252614517283030e-01   +5.058823857888194e-01   +7.005472367291191e-01   +6.734918586643724e-01   +4.472935807212441e-01   +2.429692230704375e-01   +1.525081082728115e-01   +8.823054350574265e-01   +7.461577038904597e-01; +6.171394499730954e-01   +5.067653989771422e-01   +5.147296853049480e-01   +2.039591471609597e-01   +4.559305710104322e-01   +2.498074521983070e-01   +2.420938057395419e-03   +2.328729312673163e-01   +4.522174010886508e-02   +7.406253981622207e-01   -1.136967752786885e-02   +1.341626443838091e-01   +3.302244289993004e-01   +7.050184510080365e-01   +3.217292392031355e-01   +6.547223626501800e-01; +3.220082260468022e-01   +5.321852932067304e-02   -1.492805416667392e-04   +2.149753017399052e-01   +8.065755254941800e-01   +5.777047760807643e-01   +1.715674214866251e-01   +1.764729409972898e-01   +1.664720836077248e-01   +8.147680476503949e-01   +8.572917248464357e-02   +7.265895260741121e-01   +4.757425949992306e-01   +7.575132237873105e-01   +4.232065124984144e-04   +8.210702579939329e-02; +1.608226924518682e-01   +8.400829446008330e-02   +8.461534817277663e-01   +4.753445920469003e-01   +6.033983445238106e-01   +4.708290397356811e-01   +6.547167717028358e-01   +2.905250811948643e-01   +6.372081968454129e-01   +1.203621971677984e-01   +2.105683054191036e-01   +7.115146037252280e-01   +2.392122539414187e-02   +4.722235841177683e-01   +3.660895365284791e-01   +6.387468809813844e-02; +3.377275909540786e-01   +3.165126287413696e-01   +5.674967173566429e-01   +2.058725710285690e-01   +1.245905034244186e-01   +4.162534479179632e-01   +3.858164623794388e-01   +6.268113008879620e-01   +2.732946575322483e-01   +8.585607294229201e-01   +1.988502657079191e-01   +4.012362317715190e-01   +2.164598477339024e-01   +2.092069192216380e-01   +2.517014210904747e-01   +1.860525278343717e-01; +1.088173688026671e-01   +8.408149975925306e-01   +6.635075085159576e-01   +6.418915935731129e-01   +7.362216657885248e-01   +5.381297088202289e-01   +2.339662704042844e-01   +7.402669462873430e-01   +3.628595689446569e-01   +4.188631903441803e-01   +7.335345384370181e-01   +5.670419227705297e-01   +5.441785225477708e-01   +4.330548811780888e-01   +6.365018077636778e-02   +3.723263813308238e-01; +1.257536512534601e-01   +2.171584400344140e-01   +8.153809681196732e-02   +3.744463838142837e-01   +3.026184762800628e-01   +7.488022721458546e-03   +5.917549669159561e-01   +2.530106299942689e-01   +7.335194176469725e-01   +4.185549048972860e-01   +8.477377234123629e-02   +6.999019704927566e-01   +5.630292067590483e-01   +1.508066216056572e-01   +6.265890158830802e-01   +1.437139279364760e-01; +4.982496006026355e-01   +2.024218539670239e-01   +2.975001670186445e-01   +5.939805403691275e-01   +4.584904974638910e-01   +5.663527681719257e-01   +2.352031653781890e-01   +1.227851677395364e-01   +5.631474556656310e-01   +3.909943422306616e-01   -1.522351250724379e-02   +3.303130232408806e-01   +1.657626845325430e-01   +8.739236232187256e-01   +8.536545337231426e-01   -4.737823335767332e-02];
L1E_L1I_iGABA_netcon = [+9.739974401716860e-03   +2.615264851226549e-01   +9.050358837713186e-01   +1.619424061215027e-01   +4.335615860873882e-01   +1.294326587584577e-01   +2.562671267379024e-01   +1.366507824932328e-02   +2.012783227231924e-01   +1.227880866009296e-01   +4.194140031728606e-01   +9.379673194523294e-01   +1.736524590105404e-01   +7.393342517691061e-01   +8.774103845141729e-02   +3.811946178261508e-01; +7.844944324807893e-01   +7.221667503522157e-01   +5.555835192173474e-01   +8.189932478893198e-01   +6.456644505325100e-01   +7.969761398393438e-01   +5.799225283070486e-01   +7.677295551667696e-01   +8.455116085170488e-01   +8.979585980846500e-01   +1.555292792177309e-01   +7.941657554666523e-02   +5.573609745161954e-01   +8.696655647458071e-01   +9.801798939158085e-01   +1.972625103486269e-01; +2.205166645711423e-01   +8.371770499442927e-01   +1.029483774949130e-01   +7.391810863107029e-02   +1.095801916350039e-01   +2.248076168602775e-01   +5.561705580324952e-01   +5.691465533463950e-02   +6.683263574098659e-02   +1.263869778317819e-01   +5.228120226048991e-01   +4.250465962441191e-01   +7.706422795722293e-01   +7.633206343299902e-01   +7.793456516925367e-01   +7.392067691997767e-01; +3.499490773668882e-01   +5.812078530893536e-01   +6.042881692668911e-01   +7.481421478343400e-01   +6.720012482504573e-01   +5.944644883434907e-01   +6.168528631270869e-01   +8.262213202987020e-01   +1.063253802073828e-01   +2.805794167663055e-01   +4.669721852544124e-01   +3.272695370219297e-01   +7.706032739326653e-01   +4.681079502187157e-01   +8.795831772108091e-01   +5.018489245238629e-01; +7.114557790513488e-01   +5.680265372881752e-01   +8.605328736710016e-01   +3.869178728055068e-01   +8.870686840840970e-01   +5.093814166134956e-01   +3.422141592519752e-01   +4.396661555733451e-01   +2.625123644348287e-01   +4.643060598710323e-02   +3.956377914997291e-02   +5.900162041929944e-01   +8.759965124942540e-01   +8.093661897418457e-01   +5.126733335576616e-02   +1.092960050287446e-01; +2.036558505596612e-01   +1.664889140186285e-02   +3.198339471858013e-01   +1.834612746833915e-01   +7.667305658509775e-02   +4.536109315026090e-01   +8.251895294204841e-01   +3.149130828028686e-01   +5.516490154105018e-01   +4.441299817082511e-01   +9.073182566415229e-01   +1.397566584543329e-01   +2.055588237036873e-01   +2.004772522783158e-01   +6.825296571407861e-01   +3.317351036963733e-01; +6.726076489158364e-01   +5.321003124777840e-01   +3.131945618193275e-01   +7.341951623019087e-01   +3.203021194905168e-01   +8.198359025734178e-01   +6.187410689300904e-01   +5.399796384492304e-01   +7.810275931336881e-01   +6.109356536384204e-01   +7.763346263164200e-01   +2.105424733393602e-01   +7.646740124229833e-01   +5.512413433978086e-01   +9.222626120599066e-01   +7.835971605140742e-01; +9.303478343670581e-01   +1.103081283179715e-01   +5.960273885044859e-01   +4.380733485494192e-01   +6.584322816049382e-01   +2.150319351029552e-01   +3.082562212285678e-01   +5.549269623118043e-01   +1.806937251627827e-01   +8.314116932728837e-01   +7.036813521292442e-01   +7.784731528243496e-01   +2.579431397355235e-01   +6.607448851329578e-01   +4.783639032714703e-01   +5.700852248120689e-01; +5.437343087391490e-01   +9.946107001093437e-01   +3.907996147326528e-01   +9.169860061242837e-01   +1.881373884835271e-01   +6.549954573655142e-01   +5.504309599190466e-01   +8.689258840408840e-01   +8.672089871206399e-01   +7.374786980851566e-02   +1.826989633940793e-01   +1.936352689968103e-01   +8.838665607569628e-01   +1.898728070748727e-02   +7.632975624270898e-02   +4.342821900809378e-01; +2.196856413748286e-01   +3.609414098421203e-01   +5.309547103885647e-01   +2.234949321855125e-01   +8.709779736387208e-01   +3.735681626816072e-01   +3.153946297338442e-01   +9.117856786401159e-01   +8.647005848015387e-01   +8.894400368961576e-01   +8.218868208209518e-01   +9.568905107290505e-01   +4.626145994597295e-01   +3.788446851362619e-01   +3.258851571352495e-01   +7.461772287898603e-01; +1.892490959312930e-01   +1.875088589269441e-01   +7.164638055101242e-01   +7.979404054250566e-01   +2.325389667694419e-01   +5.925436886999681e-01   +7.147170129376104e-02   +4.365423480053119e-01   +4.034134367847982e-01   +5.993852371647170e-01   +3.607822168709124e-01   +8.481806176437998e-01   +8.736656673816071e-02   +4.548458807893687e-01   +4.524403794088324e-01   +3.587113853477263e-01; +1.678964997150584e-01   +9.441543483392243e-01   +7.338999271520729e-01   +5.341100449546028e-01   +4.614104245796442e-01   +9.576422518284727e-02   +1.566049007427110e-01   +3.928105410820708e-01   +1.632112936482951e-01   +4.927122681706137e-01   +2.011891019660865e-01   +3.826655293560199e-01   +3.499388688352960e-01   +8.539330976304558e-01   +6.118472200194155e-02   +4.940801685676273e-01; +9.087890381190044e-01   +1.514693501589675e-01   +4.992785311981917e-01   +4.863070575647318e-01   +5.586943720104554e-01   +5.694577578906230e-01   +1.749933175877909e-01   +4.526641152838413e-01   +4.324425110956670e-01   +3.416020260580402e-01   +8.843487470317156e-01   +9.102582700508979e-01   +7.938062396201090e-01   +5.652057623390895e-01   +2.719280226130818e-01   +7.061216940589855e-01; +4.558629222127868e-01   +8.300372921589917e-01   +3.565390903382013e-01   +3.592585169524068e-01   +7.188794191731752e-01   +2.155056219202750e-01   +2.694023294164262e-01   +5.623626838322419e-01   +3.164083506889590e-01   +4.521651771280035e-01   +1.644472296019506e-01   +1.471485561860666e-01   +2.910885523906548e-01   +2.428941480508220e-01   +5.207158981007389e-01   +8.589967741294219e-01; +5.361102573720719e-01   +6.198680093321385e-01   +6.700681655917862e-01   +6.135977083542837e-01   +6.687061943670682e-01   +1.244060643243229e-01   +8.690651016677930e-01   +2.437069869051037e-01   +8.265804910877730e-01   +5.162215824742231e-01   +7.026473694251708e-01   +5.055215669352617e-01   +2.945604738222160e-01   +4.704183409271158e-01   +7.860481154362051e-01   +4.226168695616316e-01; +3.408944978208238e-01   +5.847433169018825e-01   +5.506118207184795e-01   +2.454715505516818e-01   +4.258105361123362e-01   +2.669228304518257e-01   +5.160526235320205e-01   +2.481325012631710e-01   +8.266069256116302e-01   +2.615540827630228e-01   +2.662062148852040e-01   +1.907461126139525e-01   +5.631298808544873e-02   +4.366254017694877e-01   +9.925110806310917e-01   +9.343446167548561e-01];
L2I_L1I_iGABA_netcon = [+6.415524155762276e-01   +4.144669240462128e-01   +6.415641436782178e-01   +5.773855076912635e-01   +8.957510012111396e-01   +6.014631190814506e-01   +8.833284191049500e-01   +8.879194045966286e-02; +4.348813144729060e-01   +1.716639409297547e-01   +2.330268738493327e-01   +9.388989662677839e-01   +2.498926797352071e-01   +4.939532341996320e-02   +7.926743926095906e-01   +6.041128846634105e-01; +9.881341550595564e-01   +5.227232051106332e-01   +5.662544162567892e-01   +7.143869577654798e-01   +7.109809203036009e-01   +6.609638279913662e-01   +2.780254706718808e-01   +2.808749204319198e-01; +3.414856922410655e-01   +1.857062927599167e-01   +8.514689839284335e-01   +4.370903787706139e-01   +7.397117931671855e-01   +3.443260876507578e-01   +9.280936421585951e-01   +1.700703627034756e-01; +6.826249141947832e-01   +4.633380103065768e-01   +6.340444642779148e-01   +1.977713294848780e-01   +9.525279186746841e-01   +3.055626604100571e-01   +5.413171434790973e-01   +2.149560417522434e-01; +5.619194417078597e-01   +5.726109296101712e-01   +7.186351834516944e-01   +1.556968915303157e-01   +2.098781577589602e-01   +8.211689435027918e-01   +8.544485218241662e-01   +5.066572958449760e-01; +7.730117418482804e-01   +5.034730605278414e-01   +2.263879048404492e-01   +2.727528761389989e-01   +7.202131473706730e-01   +1.442091887406538e-01   +6.519195655500100e-01   +3.964804086362707e-01; +9.162972114117609e-01   +4.104253773961509e-01   +6.137295932221518e-01   +8.151728446749362e-01   +8.304162322786526e-02   +4.495334015263859e-01   +4.209987777604006e-01   +2.876880247683452e-01; +7.198395062394112e-01   +1.407647883330048e-01   +4.534734330328331e-01   -2.052422333790420e-02   +7.155068360554295e-01   +3.518652237965772e-01   +7.323922929172352e-01   +6.937732417781176e-01; +4.366850365309369e-01   +7.605786952437358e-01   +6.159827665942260e-01   +7.811746753948389e-01   +3.867846071629184e-01   +8.268908787563847e-01   +7.526854007660619e-01   +2.299917694634948e-01; +5.426358731896357e-01   +5.361298846978440e-01   +5.306081535312029e-01   +3.321544287578742e-01   +8.256009766502434e-02   +8.258148362800302e-01   +5.434061742317490e-01   +4.213946195197392e-01; +7.868180773199308e-02   +3.913720775885907e-01   +4.095984982584179e-01   +4.447209021141302e-01   +3.793536710323104e-01   +4.395495327003184e-01   +2.473259065449995e-01   +5.197459038935169e-01; +3.555000406518914e-01   +1.598411148678894e-01   +6.426606966820159e-01   +7.429826232764729e-01   +2.033489559957105e-01   +6.899452449131258e-01   +3.568434599830649e-01   +7.267905947120978e-01; +4.568477392820071e-01   +4.432864903932589e-01   +6.217836549896834e-01   +3.264310867591299e-01   +7.901243126825795e-01   +3.521300365976171e-01   +3.567159927597659e-01   +2.945764017722702e-01; +5.722122512060436e-01   +1.284832627809623e-01   +2.013693096823045e-01   +1.989789767324894e-01   +6.068534459548602e-01   +5.598960799480202e-01   +2.717795566065371e-01   +6.981456761289986e-01; +7.317401597172386e-01   +6.522492876136880e-02   +6.436792466106909e-01   +3.823501627787657e-01   +3.417280187157569e-01   +5.010241695635699e-01   +1.849501590562905e-01   +3.252301611213219e-01];
L1I_L2I_iGABA_netcon = [+4.791765174149192e-01   +1.828929339308628e-01   +8.059140665426462e-01   +2.759415161740176e-01   +4.908218927455839e-01   +2.457958792264838e-01   +8.462072253292634e-01   +2.475346556917017e-01   +4.930287275867011e-01   +8.186272336027443e-01   +3.703028717097058e-01   +3.771555438150102e-01   -5.620628531154690e-02   +6.901135122885225e-01   +6.009744453739985e-01   +4.426873084262622e-01; +3.953411690743781e-02   +1.380778963955000e-02   +3.056683654272355e-01   +2.626344062755440e-01   +8.967628966086358e-01   +3.727567411173373e-01   +2.624990430850481e-01   +1.722606478703240e-01   +4.645375471237058e-01   +2.305751064011306e-01   +3.293543071696880e-01   +2.769278276354689e-01   +9.708757728432583e-01   +1.924573471064918e-01   +7.656082645350125e-01   +2.425822660034227e-01; +3.372657688015890e-01   +6.130393584966056e-01   +3.006610628695887e-01   +6.658654756346338e-01   +2.730193305170072e-01   +5.909352554073540e-01   +7.712014864482194e-01   +8.204173938183847e-02   +7.304170654031302e-01   +4.846646164531809e-01   +5.475290964938947e-01   +8.608582477259429e-01   +9.394579684405362e-01   +6.423711941473266e-01   +3.636283643068012e-01   +2.061439205024356e-01; +8.881421842782592e-01   +9.018837335638778e-02   +6.398090001012241e-01   +9.309412095825057e-01   +4.404031831504596e-01   +8.415271063607995e-01   +6.198139779832689e-01   -1.673644939643576e-02   -2.054162925800991e-02   +2.848323375963265e-01   +3.829795810558453e-01   +4.503184033204118e-01   +3.109466281147183e-01   +4.822054709941825e-01   +1.911455393312434e-01   -1.571109276725449e-04; +8.747270401642481e-01   +8.343451698959170e-01   +7.992536392588253e-01   +5.671820633051550e-01   +2.849711225371327e-01   +6.741404812788020e-01   +6.668065881310884e-01   +6.266525591694867e-01   +1.246907125028224e-01   +6.740262837623003e-01   +2.404777775114586e-01   +4.918252921122658e-01   +8.347203940900418e-02   +2.069100039668612e-01   +7.077847226103889e-01   +9.503004104174430e-01; +5.420979690203018e-01   +5.127469723663389e-01   +1.316057023744980e-01   +3.164914167566523e-01   +9.012734499676920e-01   +1.344975948020228e-01   +7.029781289755039e-01   +6.284345336620992e-01   +4.646024768971288e-01   +7.130713979949120e-01   +3.119725939510661e-01   +4.889866357716031e-01   +9.255057805291897e-01   +1.275021206625708e-01   +2.357038893569755e-01   +8.407399816691913e-02; +8.824475835835496e-01   +9.582803866675517e-02   +4.388556814043196e-01   +3.186009896264643e-01   +5.406446277620511e-01   +8.544663367379267e-01   +1.019914627469436e-01   +2.482305577209459e-01   +7.548660221601721e-01   +9.272342776515015e-01   +9.186662370694391e-01   +7.902120959755438e-01   +1.389885254495203e-01   +2.165335018238594e-01   -4.940353676854893e-03   +5.252118173257970e-01; +8.942581726761603e-01   +3.912978181754997e-01   -1.550991203733559e-02   +8.598024505996382e-01   +1.598386492511322e-01   +9.311118956420675e-01   +7.621956792031885e-01   +9.297391295986407e-02   +8.125399942368979e-01   -2.250752574326911e-03   +9.010413827789509e-01   -6.752121892541641e-03   +8.139897523677637e-01   +9.452336547789345e-02   +9.486261013104327e-01   +6.789989169727388e-01];
L2E_L1E_iAMPA_netcon = [+3.350839954957364e-01   +9.283859902474302e-01   +6.233683109740383e-01   +4.394873016485600e-02   +3.631405428838371e-01   +3.259386596569663e-01   +3.763373062130747e-02   +5.912650422667355e-01; +1.704256361184288e-01   +1.715389712926607e-01   +7.380993276749394e-01   +8.537670347849273e-01   +3.888095017381017e-01   +5.456042134773267e-01   +2.019643590566500e-01   +9.249722464703553e-02; +5.087304886644884e-01   +8.606378790822500e-01   +7.339493143011145e-01   +2.512974777543326e-02   +6.082988972437865e-01   +4.157336377992461e-02   +4.101898086365238e-01   +8.653332026466161e-01; +4.148620702288522e-01   +6.625014896520112e-01   +2.846802026653374e-02   +5.852164446615773e-01   +2.318494610510584e-01   +6.192961593772059e-01   +1.765603583056666e-01   +4.709830405197843e-01; +8.554277980979611e-01   +6.387741462375963e-01   +7.651720293572623e-01   +4.948500762825058e-01   +7.089118761653542e-01   +3.765229727140945e-01   +3.989163331742939e-01   +5.210689289090839e-01; +4.752688496304043e-01   +6.165127215049613e-01   +3.461281444580151e-02   +6.155262160991940e-01   +6.573638698142066e-01   +8.408876195821962e-01   +2.949061750212087e-01   +7.598205572142538e-02; +4.178286972143622e-01   +3.059057124657869e-01   +2.463733808588970e-01   +3.987001451013831e-01   +4.308986537227423e-01   +2.549367748077568e-01   +5.577284509308563e-01   +2.483433016742828e-01; +7.227314883356798e-01   +1.811247872566097e-01   -1.000843174782860e-01   +9.979969978141657e-01   +5.818591169868281e-01   +3.878677380088899e-01   +5.830220615190344e-01   +6.212373077988941e-01; +8.062955909244823e-01   +6.294473478705321e-01   +6.716800920450970e-01   +1.232459731721615e-01   +3.491960296925467e-01   +1.982705704464012e-01   +9.237614635426272e-02   +9.750747009697172e-01; +5.210481118983925e-02   +1.718127777829427e-01   +1.741978513438365e-01   +2.285451009048524e-01   +1.303087085711205e-01   +5.445330667101974e-01   +8.979186886185881e-01   +8.942167129445034e-01; -1.433713872157611e-02   +2.038719139050127e-01   +5.716263363244851e-01   +4.048604494599042e-01   +1.901759671129146e-01   +4.310611822260562e-01   +2.295152656718149e-01   +6.992155200846697e-01; +3.325321863977111e-01   +6.019516362191342e-01   +5.788418132847593e-01   +4.444513758698675e-01   +6.581010065451425e-01   +3.184759659139184e-01   +6.607741185546379e-01   +4.863650693264204e-01; +6.765270341498161e-01   +7.183234195491861e-01   +5.512849819984942e-01   +1.838048380366551e-01   +2.047513432698827e-01   +1.383590587526877e-01   +6.076566715090020e-02   +5.497460383646599e-01; +6.824838619049773e-01   +8.147229227807646e-01   +7.154595893595475e-02   +9.188962459345977e-01   +5.192032133010478e-01   +7.590959715557851e-01   +2.963681296809914e-02   +1.633702064490143e-01; +9.157237872101374e-01   +2.257113275986675e-01   +5.228378206069541e-01   +5.876633596177455e-01   +3.305080391157847e-01   +2.123697292205693e-01   +6.331039751518822e-01   +4.835517084806693e-01; +7.900351729201420e-01   +5.903817259481108e-01   +7.451201089088937e-01   +3.541966831323467e-01   +4.750672975222939e-01   +8.168906387898779e-01   +7.112095971955309e-01   +1.648324386028988e-01];
L1E_L2E_iAMPA_netcon = [+7.913077767727438e-01   +3.836772449660896e-01   +5.731023287637064e-01   +1.734176976513846e-01   +9.011586616415567e-01   +1.951517512604171e-01   +4.976870531718694e-01   +4.617869000638899e-01   +9.805558583368453e-01   +5.002504126095531e-01   +5.414563207444556e-01   +4.442637773863845e-01   +5.142315228432626e-01   +2.925725366923703e-01   +5.650433736940198e-01   +3.164011823935260e-01; +7.443087879186023e-01   +1.763042020554635e-01   +1.634258158519583e-01   +5.231490996546191e-01   +7.945619327870775e-01   +5.593887634684356e-01   +9.025406545024121e-01   +2.423694509639974e-01   +3.166058087572357e-01   +3.018014946076237e-01   +6.088383826738427e-01   +6.087999684483146e-01   +5.902128054551569e-01   +8.417508101221022e-01   +3.637910413531272e-01   +5.388389317329244e-01; +7.316793448873479e-01   +1.036995151731968e-01   +1.559654707217914e-01   +9.337066105578042e-01   +2.372184770526634e-01   +3.371165356971896e-01   +8.549983865855216e-01   +3.269933533405475e-01   +2.240085873880515e-01   +5.838282233089429e-01   +7.406096076124256e-01   +4.382053065407661e-01   +7.356531357102859e-01   +8.663185221108818e-01   +7.468903627717393e-01   +5.920080006821440e-01; +6.135099612790207e-01   +6.612023994107230e-02   +5.168512813071086e-01   +3.078774273625060e-01   +3.719646571448913e-01   +7.658162817163068e-01   +2.148767833913390e-01   +1.357233824238497e-01   +5.431939146285448e-01   +5.216632456454583e-01   +4.137432794575902e-01   +9.364302428089688e-01   +6.755718168740804e-01   +2.881773835377703e-02   +7.432099690794008e-01   +7.662267431368698e-01; -3.261448373763580e-02   +2.191694584117767e-01   +1.596748366042975e-01   +6.773416121016186e-01   +1.151589592752436e-01   +4.040718915158187e-01   +9.421908465616290e-01   +3.556124919945038e-01   +1.111397197612314e-01   +7.382700904627695e-01   +9.180887946599239e-02   +4.994794228294471e-01   +4.707571798636136e-02   +6.063090496111017e-01   +4.487731740628602e-01   +2.079171881054800e-01; +6.226709049265009e-01   +3.663349764147061e-01   +3.976337304272465e-01   -1.742735086908929e-01   +8.389501105033018e-01   +1.029953361218109e-01   +4.508201740213514e-01   +2.017898354586734e-01   +7.382328274958172e-01   -4.521903058001766e-03   +6.840232768132437e-01   +4.005414062396543e-03   +6.728050306793986e-01   +5.181156746224588e-01   +6.868277803319471e-01   +2.938245444648857e-01; +2.509855772908791e-01   +7.108885433094618e-01   +3.312840463235430e-01   +3.733993317653193e-01   +2.224358955822361e-01   +7.906044379701290e-01   +9.310963069465720e-01   +3.887563931904138e-01   +6.270617679691776e-01   +7.376707251994357e-01   +1.524005095833917e-01   +1.353906839191265e-01   +9.638458384161350e-02   +3.088195851879487e-01   +2.689360900568151e-01   +7.625152056797595e-01; +1.515903895706935e-01   +3.549480543934422e-01   +2.624820997334295e-01   +4.375255859069188e-01   +1.000000000000000e+00   +4.228719533738982e-01   +8.883490075765235e-01   +7.878078071345160e-01   +3.968432334301433e-01   +2.966738494072861e-02   +3.649277323371773e-01   +4.226113570086327e-01   +3.015355833910108e-01   +6.469776984044998e-01   +8.250085871293906e-03   +4.779424279874409e-01];
L2I_L2E_iAMPA_netcon = [+3.100591490195594e-01   +2.641574251019865e-01   +3.372968272306057e-01   +5.646326652753039e-01   +1.644725010690899e-01   +7.957035206027125e-01   +6.876625676422534e-01   +2.248246537667204e-01; +4.796910189963660e-01   +1.656282630503045e-01   +6.926726356475119e-01   +2.654863365508087e-01   +6.497587736797324e-01   +8.439236548835040e-01   +6.475440533676337e-02   +4.647746027678809e-01; +6.068473141295869e-01   -2.814833567638571e-02   +6.863889800652891e-01   +5.614916964355937e-01   +1.637242121062331e-01   +5.842081839587148e-01   +7.696944764283097e-01   +1.919417748230553e-01; +5.086432050876900e-01   +2.418114691677148e-01   +3.036356107755518e-02   +9.516591167630725e-01   +3.298376799940679e-01   +6.365406062615424e-01   +9.285246783519971e-01   +1.883787488012632e-01; +7.293313503218013e-02   +3.697683820104832e-01   +4.936313198606588e-01   +8.386529774004136e-01   +8.460391879994933e-01   +5.500484334159925e-01   +7.096400727170159e-01   +1.762109938498493e-01; +8.208453731933669e-01   +4.544147065152033e-01   +8.904459726352920e-01   +8.901175975734714e-01   +6.634443916504279e-01   +7.850194614647114e-01   +8.353194502796287e-01   +5.143498207889241e-01; +9.053398138999463e-02   +5.660171554537241e-01   +8.591007402041435e-01   +8.035091049987979e-01   +9.174732979902239e-02   +7.283049634925960e-01   +1.976115543918306e-01   +1.402889365064687e-01; +5.824191946728398e-01   +4.216520790302669e-01   +1.806697377486193e-01   +3.207538165194869e-01   +6.525446719342666e-01   +4.294733481355123e-01   +1.000000000000000e+00   +6.904322429284084e-01];
L2E_L2I_iGABA_netcon = [+4.283122993824175e-01   +6.243737312356250e-01   +5.692168235840674e-01   +2.075804778396487e-02   +4.259437603179059e-01   +4.906641319957504e-01   +2.672382989473095e-01   +7.017169365248156e-01; +5.324885553841510e-01   +2.945728830819713e-01   +5.561692270757836e-02   +4.938976373762953e-01   +4.746662310797373e-01   +6.564042735009741e-01   +5.108320651811175e-01   +4.217768591521183e-01; +5.637396183279918e-01   +5.556109961082322e-01   +4.130567361938019e-01   +6.199497052859759e-01   +3.378112438086016e-01   +3.132929189294811e-01   +1.260009276417051e-01   +9.256057421501968e-01; +6.613511551659282e-01   +5.577920740904080e-01   +4.096254183662215e-01   +8.738605258625418e-01   +2.299313320777137e-01   +7.028798272718195e-02   +1.267262920794749e-01   +4.090681308358487e-01; +4.999861656165163e-01   +7.811240270726612e-01   +4.831724618623158e-01   +7.077813257527431e-01   +4.253420855074543e-01   +7.488376517534255e-01   +6.148214901948938e-01   +4.106086550801007e-01; +3.292244448657387e-01   +2.535639915551932e-01   +4.370577435735091e-01   +3.941519450441336e-01   +7.403618811378625e-01   +8.165560860649005e-01   +3.186140992043293e-03   +4.212177476036078e-01; +7.611299152072207e-02   +4.540390733879944e-01   +8.097456944493340e-01   +5.614442100502001e-01   +5.153829746530408e-01   +4.207951211772129e-01   +9.011831166762717e-01   -8.650943324636766e-02; +8.516856203995501e-01   +5.616498737916130e-01   +8.428227158771290e-01   +4.975903360935634e-01   +9.087220444244851e-01   +5.256033485449054e-01   +3.073144922999008e-01   +3.197303928220965e-01];
L3E_L2E_iAMPA_netcon = [+2.417732293901746e-01   +8.813343917062539e-01   +4.694382529169600e-01   +6.776749315299062e-01   +2.028133134238106e-01   +4.021262334577148e-01   +2.995483835549446e-01   +8.968661545934042e-02   +1.289386488271736e-01   +5.037303680117755e-01   +1.279935117556208e-01   +5.054307028093940e-01; +2.736570715203132e-01   +4.361469598099965e-01   +1.473618230879635e-01   +2.316362661534119e-01   +5.164694322655760e-01   +8.782002026880396e-01   +7.047629123115338e-01   +5.427535008587208e-01   +2.632349293888908e-01   +4.583976736347478e-02   -1.199673595734941e-02   +8.194452521415005e-02; +7.967095569719754e-01   +3.544550019084660e-01   +5.229152036156898e-01   +1.005320732770614e-01   +8.153280655110781e-01   +9.156318205271626e-01   +5.579980570820627e-01   +6.520350376014314e-01   +7.267809668372829e-01   +3.232287072659755e-01   +3.537149819449207e-01   +9.018997022225603e-01; +1.054909407868910e-01   +4.484954277729509e-01   +2.095137708027651e-01   +7.789476640749367e-01   +4.961892692463615e-01   +5.763708334656503e-01   +8.423109325576488e-01   +3.375356177226405e-01   +8.424899272437157e-01   +7.438665880611309e-01   +4.303921071531320e-01   +1.080982269225129e-01; +1.431005538587644e-01   +7.345948536664789e-01   +4.408110485554212e-01   +3.386917752092897e-02   +1.478082673373447e-01   +9.277690600380445e-01   -3.827867948732707e-02   +6.307671914446947e-01   +1.266470328705455e-01   +8.571275466360337e-01   +2.354927517609110e-01   +2.286765903135157e-01; +2.693311106912408e-01   +3.840464546387385e-01   +8.422274441620169e-01   +9.702502506359091e-01   +4.073324666128249e-01   +8.829911722517101e-01   +2.126180708166222e-02   +3.252391884137893e-01   +5.343267613258916e-01   +7.417238242872591e-01   +5.733109601228426e-01   +7.838259529409072e-01; +2.560020107709358e-01   +4.857561449607303e-01   +5.552621755075291e-01   +1.380297460233140e-01   +6.393663043167208e-01   +5.010600958700097e-01   +6.762654285802501e-01   +1.266618693102443e-01   +3.749926603160826e-01   +4.248040850236615e-01   +9.615343580676081e-01   +6.924128888787616e-01; +5.296943595291157e-01   -5.611113816843713e-02   +3.465326623180640e-01   +1.273887243047853e-01   -1.446494737355577e-02   +8.705824947513738e-01   +3.831729547508727e-01   +4.515238365844876e-01   +8.795380594010971e-01   +9.838225134019369e-01   +8.668504832260894e-01   +2.726986976931012e-01];
L3I_L2I_iGABA_netcon = [-1.743313908151477e-03   +3.670840472910018e-02   +9.806401565640402e-02   +6.126940805610297e-01   +9.214740007306677e-03   +5.054746826712863e-01   +7.695586224134190e-01   +4.224276758623802e-01   +3.673780015725149e-01   +8.548128206098988e-01   +8.206696434833470e-01   +6.511685437112263e-01; +3.981174873044608e-01   +3.783425223061507e-01   +2.677291965846906e-01   -6.945737171157572e-02   +4.870053573138411e-01   +6.119553586012454e-01   +4.641266469948598e-01   +9.039434191774789e-01   +1.716731743642644e-01   +8.959778115231134e-01   +2.286321744451427e-01   +5.854570603032249e-01; +3.317907067301682e-01   +6.121117702230898e-01   +2.642753426904392e-01   +7.414029191380783e-01   +2.909143173603606e-01   +8.296804001353305e-01   +8.790694058332669e-01   +1.073453937346021e-01   +6.274543063032879e-01   +4.516471482557741e-01   +1.249834983536894e-01   +5.469666292963945e-01; +5.384918618552134e-01   +1.000000000000000e+00   +2.493091002607200e-01   +1.765620524282166e-01   +1.662249757885905e-01   +6.066708998595616e-01   +1.904626053994699e-01   +1.909000233911809e-01   +4.692693944271584e-02   +3.628018227713300e-01   +5.328316988373580e-01   +7.736000396538449e-01; +8.922305531213639e-01   +1.242345922623686e-01   +4.566125406205867e-01   +8.677071115293751e-01   +4.395601367095956e-01   +8.502214408076613e-01   +1.275930529390611e-01   +4.785882418255514e-01   +5.361886265865430e-01   +7.073401371668420e-01   +7.024413495234260e-01   +4.245136594156870e-01; +8.568180951684904e-01   +2.229722214076079e-01   +1.671795557463259e-01   +7.343173389869874e-01   +8.762842541599593e-01   +7.684811220635627e-01   +9.167394379960798e-01   +6.033506692393431e-01   +1.294279497238601e-01   +7.861827467754696e-01   +3.401575473215523e-01   +5.818866222172678e-01; +1.057942497957374e-01   +4.554900199150032e-01   +8.955889876155233e-01   +5.913034533681465e-01   +9.387401323642576e-01   +7.133481960284794e-01   +8.061830408617140e-01   +6.936918223530453e-01   +5.429320836658930e-01   +3.638317371176582e-01   +3.239357920051882e-01   +4.843559611143425e-01; +4.098742165464026e-01   +1.412296010422451e-02   +7.361922841212585e-01   +2.163693865512497e-01   +4.173392259279901e-01   +1.163249089472208e-02   -3.488899876987554e-02   +8.416354518339251e-01   +4.160328331788842e-01   +7.928799929601921e-02   +7.437729073878656e-01   +1.292591636301213e-02];
L2E_L3E_iAMPA_netcon = [+9.542972163503110e-01   +1.885984941251220e-01   +4.663526505200625e-01   +7.281061849835113e-01   -6.041983574383002e-02   +6.346150091623285e-01   +7.726575851667778e-01   +1.667404731761395e-01; +3.677312037180951e-01   +4.963231195491131e-01   +6.993659945810622e-01   +5.849417523100798e-01   +2.572723259551832e-01   +1.454899760560528e-01   +8.284675817884868e-01   +8.112814402447435e-02; +5.772247491881671e-01   +5.009363373233182e-01   +8.662056428694630e-01   +5.110137490399163e-01   +9.182117343231637e-01   +4.601692391269889e-01   +9.654748884162774e-01   +4.265958935033384e-01; +2.253671758290514e-01   +9.048847739159773e-01   +8.578635163358007e-01   +3.571682167669808e-01   +3.068798605035247e-01   +9.711102665478674e-01   +2.515503903028051e-01   +4.925296427212348e-01; +6.410455764033053e-02   +2.058038046462859e-01   +7.060821427297446e-01   -3.423722594502574e-02   +2.317106794082956e-01   +5.171465817505482e-01   +4.522450479792363e-01   +5.619003989729913e-01; +3.321545128328921e-01   +8.278102880676883e-01   +1.634100012392498e-01   +7.798617451157784e-01   +6.298072354790094e-02   -6.387919799362477e-03   +4.467084777780319e-01   +1.719012965141702e-01; +4.255662916322920e-01   +7.405429512010473e-01   +6.899454809318620e-01   +2.292248747981847e-01   +7.411032111167146e-01   +2.036661820333259e-01   +6.791040901465412e-01   +8.740586075644364e-01; -3.076947694468864e-02   +4.894750343693656e-01   +8.897488199452305e-01   +3.899537486109184e-01   +1.272673567298140e-01   +7.368356927939036e-01   +7.838874352048883e-02   +3.227741614492761e-01; +9.760788355364535e-01   +8.989594163170860e-01   +1.000150632433782e-01   +1.128826011071324e-01   +7.674909786107967e-02   +8.665811509165975e-01   +2.615575991612012e-01   +8.883904498181519e-01; +1.695114837442104e-01   +3.612333487231045e-01   +7.889701884250027e-01   +3.243147978611624e-01   +3.860180461395983e-01   +8.371652592548585e-01   +7.789952463657274e-02   +8.369741101258064e-01; +6.734979542441769e-01   +3.355662989906940e-01   +3.050762025944683e-01   +3.083459937937442e-01   +1.232705131141129e-01   +3.193768591022698e-01   +1.468262702353237e-01   +1.627234010812579e-01; +9.776962136867590e-02   +5.806314035482191e-01   +8.104517983860900e-01   +4.635566533527379e-01   -3.192002785425677e-02   +6.921290399511789e-01   +7.874620611255025e-01   +7.350265859904201e-01];
L2I_L3I_iGABA_netcon = [+3.391364270009986e-01   +7.006948475537046e-01   +3.219448916520378e-01   +6.799324626738926e-01   +5.246713973502065e-01   +3.424824350309802e-01   +3.990074858080277e-01   +4.642711719529619e-01; +3.413871430078390e-01   +7.183624610928742e-02   +2.210294647670871e-02   +8.000477569219567e-01   +7.160735201321612e-01   -1.144430759601438e-02   +1.031034084299405e-01   +6.207838249102984e-01; +3.321121277837081e-01   +5.726438686135986e-01   +3.594676220308277e-01   +3.989762220352351e-02   +7.807189526464984e-01   +6.668859579049078e-01   +2.515643847047665e-01   +8.082588155797076e-02; +5.950659602906534e-01   +8.063562098729312e-01   +5.379435239196954e-01   +4.888075895414674e-01   +5.263439386658197e-01   +6.431357581751540e-01   +3.765726707256675e-01   +7.007742656220416e-01; +6.082560443057689e-02   -4.818494439162799e-02   +1.231636223377051e-02   +7.079676340639500e-01   +2.308819013179757e-01   +6.577872836898212e-01   +4.355527730189224e-01   +2.441186082826099e-01; +5.920681431990297e-01   +4.098113493253219e-01   +4.195480341911996e-01   +7.334605450786739e-01   +2.873120094581565e-01   +8.066393144209615e-01   +5.171236357893969e-01   +1.448562661738670e-01; +2.378903618813107e-01   -4.024210835454072e-02   +3.809370156818705e-01   +9.940150552946607e-01   +7.493304200919022e-01   +5.694850233725229e-02   +2.665133120235491e-01   +8.269831417633908e-01; +2.152881509107928e-01   +8.783598690019414e-01   +8.721270036804836e-01   +9.262115420406789e-01   +5.207449941315819e-01   +1.488210953067482e-01   +6.471756619759902e-01   +9.696863102488183e-02; +2.939311446987409e-01   +5.505925025648005e-01   +2.434272013101537e-01   +1.721536797530566e-01   +4.037553941162473e-01   +3.706953573432181e-01   +6.004315378368000e-01   +5.016748549910051e-01; +3.936593007308231e-01   +1.896908435871356e-01   +1.947562897462440e-01   +4.072054731395013e-01   +9.394455839760616e-01   +5.018909139862568e-01   +4.879282770354400e-01   +9.627329805211429e-01; +5.288691756458893e-01   +1.074116828342434e-01   +2.517279159350609e-01   +5.961497045894748e-01   +5.142084100279072e-01   +6.911855960626162e-01   +9.320908764456397e-01   +6.218939478698098e-01; +3.949349634657489e-01   +1.722100769608264e-01   +6.495909208688133e-01   +3.509687083017340e-01   +1.283548229953038e-01   +4.794723565728621e-03   +3.831265064991867e-01   +5.979041854511253e-01];
L3I_L3E_iAMPA_netcon = [+1.350717516302061e-01   +5.531676543241912e-01   +4.430463414765447e-02   +1.725774520426578e-01   +1.802806597223269e-01   +6.900570951866163e-01   +4.813854995038772e-02   +3.537321892815020e-01   +4.636623513754199e-01   +3.358614732670590e-01   +5.214592811432983e-01   +8.739903830004383e-01; +3.076601333634587e-01   +7.466342021184248e-01   +2.289527295463405e-01   +2.733937862519312e-01   +6.910996704537923e-01   +4.589161514485695e-01   +3.360202426565937e-01   +3.369275372129404e-01   +6.266121434261669e-01   +2.409345464375801e-01   +6.791218921728585e-01   +2.340975126958033e-01; +4.422102074184985e-01   +2.857038440380282e-01   +6.689754184511487e-01   +8.318962043520136e-01   +5.419278925711312e-01   +6.203349912644381e-01   +9.794646632151414e-01   +4.470613688825253e-01   +2.788456164643657e-01   +3.791873665173470e-01   +8.183022697078647e-01   +8.655909168979936e-01; +4.817130642179349e-01   +1.120859694721159e-01   +5.642704444682286e-01   +6.864242101630891e-01   +4.426665586185516e-01   +5.879645233449090e-01   +5.532392665536455e-01   +6.360270462651089e-01   +4.960247758200257e-01   +1.915448279941476e-01   +3.592468206195083e-01   +4.958276677735529e-01; +8.664747243173514e-01   +7.704986198246982e-01   +5.364249702166672e-01   +4.545552883635145e-01   +2.146128207334020e-01   +2.805422215606327e-01   -2.090308650534047e-02   +2.552936920214376e-01   -1.665776938265612e-02   +1.967189746460664e-01   +2.675333814193627e-02   +4.197154504435395e-01; +3.255431052633149e-01   +1.418998104297745e-01   +6.322181408371418e-01   +4.545161379270105e-01   +9.661956383123367e-01   +5.763092026445684e-01   +2.180389019636079e-01   +1.646160429099063e-01   +1.679053707059432e-01   +5.487109430415650e-01   +2.583507514085997e-01   +1.171962503175399e-01; +5.044377895407479e-01   +2.714030615541272e-01   +7.715575071328262e-01   +8.460031524899887e-01   +1.699665741076337e-01   +1.278283455365604e-01   +3.699684933853287e-01   +8.499324893815838e-02   +8.699780661885620e-01   +7.012846671745018e-01   +3.153983896056107e-01   +1.311796775613662e-03; +3.178362988710347e-01   +4.017243251312925e-01   +3.289981706218787e-01   +6.179032041001287e-01   +7.616793251150452e-01   +1.815829561229488e-01   +3.264497264668333e-01   +2.885864372159335e-01   +2.654064023128727e-01   +2.728442631838499e-01   +5.963772745194805e-01   +5.009010919361796e-01; +3.598046186547316e-01   +4.473101815748159e-01   +3.755887828501200e-01   +6.111438325536951e-01   +5.600632162810018e-01   -7.683911932861041e-02   +1.014855544305393e-01   +3.225748270128426e-02   +3.194393100303355e-01   +2.447995869271117e-01   +7.665326606747432e-01   +9.361822032033734e-01; +6.885203771127890e-01   +5.902934531380467e-01   +5.417227846210355e-01   +4.059538724352238e-01   +4.589605692885732e-01   +3.530407078074959e-01   +1.588901079517801e-02   +6.418947532722907e-01   +6.883220903128623e-02   +8.093600552166110e-01   +3.780787596844477e-01   +1.011401809383227e-01; +9.946449189290299e-02   +2.465095393669910e-01   +6.015932920455848e-01   +2.117189063708601e-01   +3.351622519436307e-02   +5.084123488620350e-01   +4.728793401299358e-02   +7.004151167781485e-01   +6.417860217170519e-01   +1.820676730454561e-01   +6.229543520305220e-01   +2.828979416588258e-01; +6.175671109026963e-01   +7.167653436773327e-01   +3.896868260695958e-01   +5.823540413119974e-01   +6.476995347783563e-01   +3.219057787008962e-01   +3.038744116026099e-01   +8.332124322439386e-01   +5.584038521499877e-01   +2.897896098902690e-01   +4.411205021473202e-01   +4.362692700614983e-01];
L3E_L3I_iGABA_netcon = [+3.418969432511507e-01   +7.642411133649755e-01   +6.365753584794771e-01   +9.213787559870000e-01   +4.851638917335891e-01   +9.254257969583128e-02   +2.647741311493598e-01   +6.893236546050665e-01   +6.580539375663810e-01   +3.498450835405839e-01   +4.574699435665980e-01   +2.820222156767143e-01; +8.843060638140108e-01   +3.707602808213668e-01   +5.960353732309553e-01   +1.005361562001055e-01   +8.260671728923051e-01   +3.580832498884384e-01   +8.705775205308200e-01   +6.309360745651168e-01   +5.591058781479704e-01   +7.732534630266833e-01   +2.451813758835329e-01   +4.766589475218957e-01; +7.201852254384199e-01   +3.773604269672698e-01   +4.423908941411070e-01   +5.468224836888386e-01   +5.420457727651015e-01   +4.924972402592265e-01   +2.625889435662793e-01   +8.870146433507167e-01   +4.952295088216243e-01   +2.398730293721511e-01   +8.054655031965299e-01   +8.586133907187271e-01; +1.907428178167773e-01   +6.195782807952437e-01   +3.046545895790248e-01   +3.584686954301446e-01   +8.468821185403093e-02   +6.039369528725647e-01   +2.932583098082405e-01   +8.601176416984062e-02   +2.467704051676503e-01   +5.258013015014191e-01   +7.781265460217589e-01   +6.054641542330692e-01; +3.134662753833307e-01   +6.267344954604792e-01   +5.838078609870763e-01   +3.049230229943985e-01   +1.273640922039646e-01   +6.860659485423068e-01   +8.088759752654203e-01   +2.814434414246952e-01   +2.185641469158330e-01   +7.707885755959664e-01   +5.786003531815379e-01   +2.440879379773044e-01; +4.459163498761188e-01   +7.567500389121340e-01   +6.929130647759512e-01   +4.656065176191007e-01   +7.081481481616498e-01   +6.160927380509359e-02   +3.259352907922820e-01   +1.903272749165350e-01   +8.990955672963244e-01   +8.723172425693038e-01   +8.053554705785750e-01   +2.477277635485610e-01; +6.056693351475092e-01   +7.605629893365536e-01   +2.161599680686402e-01   +6.855702755192990e-02   +4.208216817523234e-01   +5.896545531898242e-01   +6.144449449163729e-01   +1.592869575455367e-01   +9.427803652466404e-01   +5.923012481044990e-01   -4.548501339870158e-02   +2.861941758520315e-01; +5.209123750747148e-01   +3.798369077523236e-01   +8.845389145885243e-01   +4.313908722473104e-01   +1.493704002266467e-01   +5.334958144877687e-02   +5.844636132039293e-01   -3.530691225660884e-03   +6.182590937533917e-01   +7.724778575628501e-01   +2.585550139014462e-01   +9.804980416439442e-01; +2.924396544205892e-01   +5.418301852944968e-01   +3.059366478586439e-01   +7.726193106665348e-01   +7.685494006148049e-01   +9.172969165005274e-02   +3.449270653025252e-01   +6.226736179962690e-01   +5.850992821493957e-01   +7.648488046345662e-01   +6.996735895182001e-01   +6.402215444340020e-01; +2.725851581575096e-02   +1.155028857022562e-01   +3.194280049828914e-01   +5.516505198923660e-01   +6.833893122277702e-01   +2.085253727916028e-01   +4.598963069926687e-02   +3.261977556944488e-01   +7.149151652905772e-01   +2.183563195094135e-01   +5.848979328106014e-01   +6.590014334369475e-02; +8.953278103603824e-01   +9.384761573983662e-02   +7.206608568752656e-01   +5.374161474762218e-01   +3.747115012816992e-01   +8.739505369844444e-01   +1.574177100434636e-01   +8.198011414926629e-01   +2.647055709858792e-01   +8.787192947807644e-01   +5.541945756120181e-01   +7.258178074934255e-01; +6.597375301515964e-01   +7.922181339953797e-01   +5.046909108089409e-01   +8.528143865197058e-01   +8.334591110847210e-01   +5.193851427841889e-01   +8.780266715468519e-01   +8.937885205258380e-01   +5.189540759542536e-01   +8.029441099613049e-01   +4.437175543625340e-01   +8.844480242100926e-01];
L2E_Input1_iAMPA_netcon = [+9.292803354720016e-01   +9.807079722632861e-01   +8.706796583590203e-01   +9.187439931056035e-01   +8.602879506995696e-01   +9.846871312756363e-01   +9.025403745553811e-01   +9.307823547510238e-01];
L2I_Input2_iAMPA_netcon = [+9.213611374813436e-01   +9.032089601083575e-01   +9.924410608778564e-01   +8.961558021200926e-01   +8.407166131585299e-01   +8.887091762129729e-01   +9.182246293061477e-01   +9.422809415844240e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
