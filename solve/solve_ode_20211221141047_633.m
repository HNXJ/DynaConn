function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.002594806408909e-01   -1.082971325066295e-01   +3.555307730312922e-01   -4.786176559029061e-01   -4.270693143066055e-01   +8.531839810991082e-02   -6.233793811250471e-01   +1.059365608763675e-01   +3.254309084682616e-01   -4.192946189879275e-01   +6.845379927550443e-01   +7.291651531245771e-02   +6.061060009217606e-01   -6.896681627689236e-01   -3.141515945769717e-01   -6.537532569194696e-02; +1.430383425553932e-01   -4.416482266787254e-01   -3.074562958879806e-01   -3.787598260852315e-01   -3.551134266269712e-01   +2.327634248162676e-02   +3.364500751069512e-01   +4.607482357709285e-01   +4.831952900072019e-01   -7.718646502268667e-01   +9.790503065794740e-01   -3.938688559415496e-01   +3.363868300607413e-02   -5.030577192785891e-01   +3.114065778089851e-01   +1.554326640279026e-01; +2.172450913078474e-01   -1.007728484189014e-01   -2.073881475523521e-01   +5.306732677606345e-02   +4.550643955248027e-02   -1.035581527879728e-01   +1.275901780395539e-01   +6.516183054148014e-01   +7.974815784763794e-03   +6.609835445953675e-02   -2.160842594395870e-01   +5.786456268570858e-01   +7.492320910585829e-01   +8.266203637798490e-01   -5.017777785277265e-01   +3.342964983709519e-01; +1.802053402829177e-01   -5.992623013493602e-01   +9.340990220559175e-01   -5.641872170368225e-01   +2.763516912284512e-01   +2.085974220190278e-01   +3.952359445775512e-03   +2.341209199684555e-01   +5.449812400419595e-01   -6.182221770180280e-02   +4.206211445815092e-02   -2.314104088245875e-01   +9.055857698343368e-01   -7.244137334470232e-01   -5.091474116347551e-01   +2.112902637079859e-01; -2.471578445951075e-02   -3.328254441279846e-01   +6.891987794121068e-01   -4.487505215365041e-01   -4.418766682829366e-01   +4.248941554586809e-01   -1.771210540652675e-01   -2.971548330751537e-01   +3.767612226650595e-01   -4.459729765180588e-01   -1.909990666068217e-02   +5.162228549473281e-01   +9.952584373234757e-01   +4.092115957687492e-01   +3.187727646782776e-01   -6.709628116462945e-01; -7.039068234593917e-01   +6.037937791441338e-02   +4.842309223164716e-01   -4.665033185209049e-02   -7.535577580390604e-01   -2.192516655378152e-01   +1.204469853876401e-01   -7.743315905502517e-01   -1.946836175977493e-01   +4.019593667586219e-02   +5.440419088805479e-01   +8.615015241883188e-02   -4.470848035413093e-01   +8.383216930341737e-02   +8.946149185081211e-01   -1.720272152712198e-01; -3.055140584747981e-02   -1.859706859359812e-01   +5.660525475501801e-01   +5.787441994293405e-02   +3.672026414171090e-01   +9.329086025818287e-02   +1.000000000000000e+00   +1.820482866473804e-01   +2.849592055352196e-01   +6.214820359035059e-01   -4.302831772623680e-01   +5.845191993071822e-01   -2.512680173035529e-01   -2.798089772935503e-01   -5.424162072918577e-01   +3.569433162136278e-01; -4.224741819286130e-01   +7.538915311866224e-01   +4.149822566997386e-01   +3.006278945527008e-01   -8.698067669133841e-01   -5.857579040376733e-02   +2.595459049252475e-01   -3.341876078928706e-01   +4.007505861413893e-01   -3.876430608461384e-01   +8.217166367803689e-01   -3.878784908808364e-01   +1.917178475718627e-01   -2.389020364277302e-01   -3.040877151278047e-01   -2.774233241632774e-01; +4.427077782187473e-01   -7.970846093260303e-02   -1.519639221369143e-01   -2.287156134170299e-01   -4.691561412856042e-01   -6.266680608147126e-01   +1.189766687783489e-01   -2.714259064243347e-01   +6.573030961718740e-01   +2.106314201258960e-01   -2.297349535087010e-01   +1.667591069916630e-01   -5.631778149275143e-01   +5.372010443166062e-01   +3.013796709370885e-01   +1.895468059069561e-02; -9.127363312565265e-02   +5.170217135051209e-01   -5.178126867403940e-02   +9.891501321351047e-02   -6.746042602638050e-01   +8.582883760195729e-04   -3.082063179267591e-01   +3.417038064299174e-01   +4.656438969449966e-01   +2.999024364795009e-01   +1.415175955773281e-01   +8.102940124674017e-01   +1.405645731342526e-01   +3.652068870654763e-01   -6.031405679160016e-01   +6.971812266568896e-01; -4.794611697412092e-01   -1.766685234673642e-01   -2.452431420521544e-01   +8.001625226704601e-01   -3.847317717455111e-02   -1.615596602590623e-01   +4.061860520397177e-01   -6.473610252352272e-01   -8.835649012167889e-01   +2.023006955421482e-01   -1.883077987232865e-01   +1.017423824865777e-01   +8.036220096056019e-01   +6.897425552269811e-01   +6.019743720608338e-01   -8.102187975129755e-01; -3.136177127666031e-01   +8.769232534571900e-01   -3.848426652682147e-01   -2.665545205795433e-01   +1.069288847007306e-01   -2.122918590230191e-01   -3.959674030775321e-01   -8.122943585940944e-01   -2.919788625859541e-01   -3.487841026988200e-01   +2.483435151458952e-01   -2.708582219991411e-01   +3.014188804828986e-01   -3.546573530618589e-01   -7.520667251231994e-01   -7.966941474913757e-02; +5.785292164899114e-01   -3.754586273732866e-01   -6.031460093516872e-02   -1.107420402981550e-01   +1.159261674463645e-01   +4.743015945095865e-01   -1.313037144649976e-01   -3.641719761209488e-01   -5.932636362384527e-01   -4.344819699522919e-01   +4.860837720921983e-01   +6.612042902687705e-01   -7.002022134777490e-02   -4.946943695732876e-01   -4.137526604685182e-01   +2.630175862104752e-01; +5.059018512313771e-01   -9.995268298711700e-02   +1.088935084968304e-01   -5.434396010916740e-01   -1.153705386319812e-02   +6.757818073950030e-02   +5.739679399787966e-01   -2.124203589992519e-01   -4.021710679009236e-01   -6.398981180794719e-01   -5.619885920801899e-01   +6.425646327818191e-01   -3.363855644925232e-01   +6.839382737567006e-01   +6.916091912006117e-02   +8.822390195572523e-01; -4.555994216301468e-01   +8.737356903711887e-01   +4.361503197054498e-01   +6.157057875694099e-01   -5.047621302863219e-01   -1.081174129333682e-01   +1.124880564561412e-01   +7.755287792300242e-01   -3.155521869460892e-01   +4.569540463375616e-01   -3.802206424432691e-01   -5.074879122278807e-02   +3.828947550709463e-01   +4.087200771666435e-01   -5.821309599259772e-01   +2.580355369291687e-03; +7.366601408846932e-01   +1.839594798209922e-02   +7.069319807294103e-01   +3.576679993873238e-01   -5.155373824453652e-01   +9.791492290271686e-02   -8.269247790894013e-01   -2.255866519173390e-01   +4.644975545054181e-02   -5.344616741990239e-01   -8.097420507705734e-01   +2.446835853249033e-01   -1.382277904883102e-02   -3.009640054396550e-01   -2.415074605286259e-01   -3.837968135059282e-01];
L1E_L1I_iGABA_netcon = [-6.269816154208937e-01   +7.308287260182051e-03   +3.989472677417273e-01   -4.481648129632037e-01   -3.811821896956459e-01   -7.454680052054629e-01   +2.986223004747741e-01   +4.933549209701978e-01   -1.508338363562855e-01   -4.234554011657997e-01   +1.149222979988874e-01   +4.017379080280053e-01   -2.774888030214282e-02   +2.908975093482439e-01   +6.377128773386604e-01   +2.310381229797116e-01; +1.738395499471857e-01   +5.263163879761963e-01   -3.890701439508303e-02   +4.683315986686443e-01   -2.809887787499011e-01   -1.668075131797693e-01   +2.880386318833393e-02   +2.083375500774138e-01   +2.151280891671053e-01   -5.285986637296779e-01   +1.381808826887510e-01   +4.271385091477472e-01   +6.580131096151782e-01   -4.603103460360820e-01   +1.843270697223213e-01   +6.282191823887318e-01; +1.588938832448727e-01   +2.933396088258370e-01   +2.071427553005299e-01   +2.514865878733702e-01   -4.575231061095074e-01   -9.599986894216374e-02   +3.232661900609857e-01   +1.063911830558505e-01   -7.822474185068178e-01   +6.314886046476158e-01   +1.961739258673597e-01   -2.677312355127655e-01   +2.067004190959617e-01   +6.053587138434192e-01   -8.459167863998935e-01   +4.889496163411848e-01; +5.796362515684380e-01   -9.413090302760249e-04   +3.192060826019069e-02   +5.411843276586925e-01   +4.837903380280477e-01   -2.575643045471248e-01   -5.890343451760406e-01   +3.274669899626513e-01   +2.939236790325215e-01   +2.728930838400142e-01   -1.371151295922620e-01   +4.245417423973103e-01   +8.716801698930313e-01   +2.652239732912275e-01   -2.556822302941110e-01   +4.272750439683414e-01; -4.192992083323446e-01   +2.445462973014292e-01   +1.960327940762148e-01   +2.796424900413411e-01   -4.306112277683128e-02   +7.635176021457704e-01   -6.194658950340373e-01   -3.138427678561451e-01   -4.584635852789704e-01   +3.261332381599737e-01   +2.667786854849948e-01   -5.051798562347792e-01   -8.110542562835699e-02   +2.758242866507442e-01   +2.165590860951222e-01   +1.257705433179721e-01; +3.581818748048291e-01   -5.155581624295597e-01   +3.428214121842592e-01   -1.451246895783549e-01   -3.099021220395743e-01   +3.198695728166748e-01   +1.872581951404294e-01   +4.813050646189015e-02   -3.239450062030189e-01   -6.311181592805956e-02   +1.461126152993559e-01   +1.000000000000000e+00   +1.878322572451798e-02   +5.322454068795146e-01   +5.318080617171317e-01   -7.657849805306920e-02; +5.417881458814906e-01   +4.958422161344864e-01   +5.241908645126152e-01   +6.403037675754851e-01   +3.418974039555190e-01   +7.096567405043903e-01   +9.608261551554803e-02   +1.050315257668279e-01   -9.530693690444143e-02   +4.169557301830367e-01   +4.460167633438156e-01   +5.829570658454433e-01   -1.736042516232656e-01   -5.150810630432208e-01   -4.594617278917890e-02   +3.806926879498623e-01; -3.744230541770509e-01   +2.235922960121244e-01   +5.513801605439353e-02   -4.925198363197119e-02   -4.010428177836964e-01   +6.904179486778128e-01   +3.213530524230827e-01   +2.640666999721319e-01   +1.614301570908647e-01   -6.880532272429954e-01   -4.939374681311125e-01   +4.225985981056637e-01   +2.116267259579320e-01   +7.178674287539135e-01   +3.664137272955220e-01   -2.964254183814442e-01; +5.267213766033305e-01   -1.173831208879529e-01   +4.416960796684681e-01   +6.927759832701375e-02   -4.389363386574423e-01   -8.034507900996687e-01   -4.422392733451241e-01   -8.453969452385008e-01   +2.776025099676845e-02   +4.774791526966181e-01   -2.836723477020196e-01   +1.564499251414714e-01   +6.116935364103570e-01   +4.636561594327204e-01   +3.461717000903474e-01   -5.998549683049472e-01; -2.635012276765604e-01   -1.145212511460963e-01   -1.596881921964280e-01   -2.191646366391918e-01   +2.246075839730602e-01   -3.772399980620511e-01   -2.070168411363033e-01   +3.682510664082942e-01   +9.571317880809248e-01   +4.969928787426088e-01   +8.047790980832153e-02   +2.058705188077948e-01   -4.030445267817470e-01   -4.320820770446491e-01   -5.747256218492704e-02   +7.954748875566101e-01; +4.318968456391140e-01   -8.079114705870087e-02   +5.013472696711019e-01   +9.218506928666502e-02   -2.975208207855411e-01   -1.685846422393148e-01   -2.424008713946868e-01   -5.864557834881072e-01   +2.095007990407177e-01   +2.543662783106909e-01   -3.622904051083670e-01   +6.964090776612774e-01   +5.023256683545690e-01   -8.857471939777022e-02   -3.200929722472727e-01   +4.119572775060052e-01; +4.580737884537153e-01   -6.291586160147729e-01   -2.973664850708535e-01   -4.010199348575512e-01   -5.041472240939594e-02   +6.116739456695491e-01   +7.906389495365745e-01   +5.116977324961928e-01   +3.413890635145695e-01   +7.520115004497737e-01   +5.105818562314681e-01   +5.622142219139147e-01   +2.525396787797405e-01   +3.037348397654502e-01   +2.617248638940406e-01   -5.565394379598678e-01; +1.398584084803467e-01   -1.238454856490956e-01   +2.223259295365160e-01   -5.809205829365540e-01   -1.246176440927621e-01   +5.791334201097933e-01   +7.362907102019683e-01   +7.616444880617875e-01   -2.960302621821874e-01   +1.670709599991321e-01   +3.402187495313333e-01   -2.089542352685308e-01   -1.525932445596568e-01   -1.516969216767472e-03   -5.480650977403942e-01   -3.583225544554251e-01; +6.745649610928306e-02   +7.083301401243218e-01   -4.524589758446291e-01   -2.682147421182098e-01   -8.529180037469564e-02   -4.842381756948086e-01   -6.392198623236728e-01   +1.655140403145179e-01   -7.956680989995354e-01   +4.989637783326453e-01   +5.198367098297640e-01   +2.105683767437348e-03   -5.286954953032008e-01   -3.788985156215100e-01   +4.947910594328415e-01   +1.891944411402934e-01; -4.951948343365051e-01   +1.326226739464306e-01   +3.116911592669395e-01   -1.223927606716004e-02   +3.573712801140922e-01   -3.790045269529542e-01   -4.008131364801247e-01   -2.827311959523722e-01   -5.747307426458723e-01   -1.300199786244174e-01   -1.551170009768487e-02   +9.434208406217652e-02   -2.140563034995854e-01   -3.625791806943594e-01   +7.498119812971082e-01   +3.854408951027140e-02; +1.137091388837156e-01   +6.185248112988865e-01   -4.821487555732884e-01   -2.423899195167756e-01   -7.254588756502033e-01   -3.097473618221422e-01   -7.178502747750056e-01   +3.326720217863166e-01   -4.709870848137674e-01   +4.266251833263202e-01   -2.255883433295264e-01   -5.013043373123028e-01   -4.809406284556768e-01   -7.794913913653219e-01   +9.106350219854510e-01   -2.732106519583705e-03];
L2I_L1I_iGABA_netcon = [+2.557142233775622e-01   +1.976546361037460e-02   +2.138209413663740e-01   -9.601400468440384e-02   +4.627264339019217e-01   -3.968962315901772e-01   +6.453822439010993e-01   -5.193612692454841e-01; -5.759587322043226e-01   -1.388741350479991e-01   +3.554724337104275e-01   +1.000000000000000e+00   +6.327837174457827e-01   -2.859933493104942e-02   +1.215840809723811e-01   +7.840491497377862e-01; +6.123715874874334e-01   +3.656756181904112e-01   +3.614637196471300e-02   -2.053358541656585e-01   +6.142392697782615e-01   -4.709404504663470e-01   +6.617992150273041e-01   -7.503179656472447e-01; +6.265382791657905e-01   +1.265815655183798e-01   +5.369825457983984e-01   -3.407719768126115e-01   +1.042837007884051e-01   -1.507364218017571e-01   +8.959324939157535e-01   -9.299591123082964e-01; +1.022261410751394e-01   -3.258408160811364e-01   -4.584169370144805e-01   +7.581998250471702e-01   +3.527221764114842e-01   -6.156531098067883e-01   +4.541302109479114e-01   -4.081133866760588e-01; -4.153635902683373e-01   -5.258865066181556e-01   -8.174476215991170e-01   +8.735660913141088e-01   -5.522945830946280e-01   +5.584555228868092e-01   +6.928638650411743e-01   +2.703422458612633e-01; +1.162732392541574e-01   +1.028958603762928e-01   +5.424221088145409e-01   +6.802134300974380e-03   +3.801229705831354e-01   -4.491723041070927e-02   -3.395577300366260e-01   -7.871010651624332e-01; +6.317536943391025e-02   +3.546342057090875e-01   -6.159523724462321e-01   -4.269968066122071e-01   -3.625121412687422e-01   +5.211462054042918e-01   +7.426463747945456e-01   -5.060061816406727e-01; -1.353490551433787e-01   +3.952063237815899e-01   -1.545413183155208e-01   +6.575116937105506e-02   -2.981282453819318e-01   -2.595599948579694e-02   +2.999810611790896e-01   -3.459341512340267e-01; +5.719030839311415e-01   -3.207372181653319e-02   -3.003255039415488e-01   +4.805556014954431e-01   +2.270726627555456e-02   +3.242763709145473e-01   -6.743668072142398e-01   -8.426925662358675e-01; -5.304188216071371e-02   -2.010215389721179e-01   +1.301735807837951e-01   +5.210162807370067e-01   +8.114921738894361e-01   -3.832116663348403e-01   +4.396133461653357e-01   +1.306147006012113e-01; +3.635184237825010e-01   -1.788885041937375e-02   +7.847787584332182e-01   -3.388310873202709e-01   -6.308042744542756e-01   +3.815435643981943e-01   -2.554520633775846e-01   +7.592274886780400e-01; -5.145221310246237e-01   +4.422967400736050e-03   -4.243487512935242e-01   -7.783409588403262e-01   +5.452892379085968e-01   -9.185010846002789e-02   +4.341850104178932e-01   -7.281265995456128e-01; -8.369707992750772e-01   -2.431107293015172e-01   +5.388649435342872e-01   +5.660762350460465e-01   -5.942452746467242e-02   -1.780385117824462e-01   -7.397686152520840e-01   +9.007666238060211e-01; -1.718913350698026e-01   +6.713515484445650e-01   -3.888859361373284e-01   -3.178178255380140e-01   +6.000020101194646e-01   -4.189182031133776e-01   +4.670073117504024e-02   +2.910449950920155e-01; +1.173663853871407e-01   +8.566679548116587e-02   +1.973472990695695e-01   -9.358273315838046e-02   -4.032910743101831e-01   +4.193244843040868e-01   +3.511260210143509e-01   -5.453815234874767e-01];
L1I_L2I_iGABA_netcon = [+3.605990500137159e-01   -4.356677891470176e-01   +2.263158767200309e-01   +9.611745051445292e-01   -4.477040041778751e-03   +4.036173224044688e-01   -3.846645564292375e-01   +1.000000000000000e+00   +6.197722648096926e-01   -8.341139254781824e-02   +1.033534734070097e-01   +5.081650000734572e-01   +8.583049842283903e-03   -5.769644884145103e-01   +9.786704529062390e-01   +9.144631862269172e-01; -4.050030238737463e-01   -7.621083975277393e-01   +3.502674469644917e-01   -5.968505895631194e-01   +9.313037202229747e-02   +8.145726474107443e-01   -2.812718836709570e-01   +2.418095967982166e-01   -6.309456372205405e-02   +8.662876580207513e-02   +7.208585493482041e-03   -1.884921380503304e-01   -7.154720389873907e-02   -1.109406677587286e-01   -3.144427464837783e-01   +1.748957131325400e-01; +2.657032316446714e-01   -1.042707748447038e-01   -6.026301479647241e-02   +1.699064182231362e-01   +3.099812548244496e-01   -4.031324864109543e-01   +5.157662952074049e-01   -2.015506787491503e-01   -1.898674257246950e-01   +2.608559238636289e-01   +4.199564202595930e-01   +2.515214814795538e-01   -8.084865322055047e-01   +6.091964768411393e-01   -5.079539464627394e-01   -1.632902739880302e-01; -2.119499378178205e-01   -4.611340304056965e-01   +2.537609810197589e-01   -3.640627722801764e-01   +9.130881838899420e-02   +1.581921130971351e-02   -1.812991445735081e-01   +5.136609719426232e-01   -2.517211581424041e-01   +6.163675749375039e-01   -2.902675791637682e-01   +5.795836117069866e-01   -8.599679268498004e-03   +4.162584795447271e-01   +4.608918085292905e-01   -3.767583911730655e-01; -5.874203863137313e-01   -1.779866195897541e-01   +7.893192413712186e-01   +2.013990109077209e-01   +3.336348619955450e-01   +2.322181569741303e-01   +2.947893485897831e-01   -2.790710080519810e-01   -8.262738629975713e-01   -4.044214115465243e-01   -3.661068225325654e-01   +3.861202158267510e-01   -4.402570699389708e-01   +2.994729523031767e-01   +2.320737071004719e-01   -2.877589777269156e-01; +7.414066335519544e-01   +7.503520085054191e-01   -3.433152142972981e-01   -2.764675031718141e-01   -1.124891311686742e-01   -4.199385325087374e-01   -5.745225085453911e-01   -5.380555730606718e-01   +8.107688462020074e-02   +3.811410464643591e-02   +6.111405311489390e-01   +1.416013202139968e-01   +4.191456835319429e-01   -2.207876321059506e-01   -2.373403161614016e-01   -3.626608324135424e-01; -7.009802295774241e-01   -4.935576961700730e-01   +1.661591208610664e-01   +5.220958880073479e-01   +7.126736857740974e-02   +1.501818966785957e-01   +5.883113455523808e-01   +8.578849661348910e-02   +1.518522841638440e-01   -4.759061030156352e-01   +4.981315780695026e-01   -1.894302176894704e-01   +6.522281778264671e-01   +1.513675282014608e-01   -2.923416176726646e-01   -1.760635691568985e-01; +8.375936332649161e-01   +8.043751843140731e-01   -5.676253926910404e-01   +2.783355887172004e-01   -6.366305347017731e-01   -2.173868371890778e-01   -6.145513103066448e-01   +5.723707696904191e-01   +4.445989929734238e-01   -2.333344722968569e-01   -1.499667184932567e-01   +1.577424716747948e-01   +3.199949294774087e-01   -1.153886889814140e-01   +6.687239191625465e-01   -3.250631403788223e-01];
L2E_L1E_iAMPA_netcon = [+4.563786442863391e-01   +6.762183541249061e-01   +1.822047650315036e-01   +2.935359648782784e-01   -5.737825272426831e-01   +1.458664957312878e-01   -7.250387217388128e-02   +4.436814056394612e-01; +6.492470624566733e-02   +6.452931911810931e-01   +4.370514919156445e-01   -7.110275329228465e-01   -5.625022086036913e-02   +2.437687336720851e-01   -6.530593449294587e-02   -2.144123528308849e-01; -4.520718565809019e-01   +1.054979162055616e-01   +3.950212824874728e-01   +4.462906878497518e-01   -2.999347076100415e-01   +5.997051423250278e-01   -1.029570663651021e-01   +7.113108593449606e-01; +3.330838463778190e-01   -1.585600433832082e-01   -2.217038316448960e-01   +3.294770230737894e-01   +1.584393364854673e-01   +2.664727567880043e-01   +6.348318968535032e-01   -2.807496297874720e-01; +3.095467013870991e-01   -1.847415293137635e-01   -2.292510062540082e-01   +2.455606748217740e-01   +1.066666497464937e-01   +3.934741855592259e-01   +5.292999890612871e-01   -1.370788114599975e-02; +3.298481468066505e-01   -5.399556492596850e-01   +3.718572961324317e-01   +3.255610858378097e-01   -1.211559133949906e-02   -3.969395835419532e-01   +4.736057032656156e-01   +6.969678285894886e-02; +5.712796294989111e-01   -1.232812440127775e-02   +2.735502161515765e-01   +4.239866660775486e-01   +3.630112195135008e-01   -5.358489199281438e-01   -4.964456298845144e-01   -7.364448998685512e-01; +1.709616663164265e-01   -1.258720674763756e-01   +4.510283143392205e-01   -2.590538271909171e-01   -3.890404446017393e-01   +3.521669305599447e-01   +5.421585083414994e-01   -3.494748848038192e-01; -7.479128482188805e-01   -2.059190091609630e-01   -2.808602956787687e-01   +5.346835032926954e-02   -3.063160786932676e-01   +5.087245211902022e-01   -5.177947812809325e-01   -4.751400799895357e-01; -1.172642600546082e-01   +1.632753847887361e-01   -2.403726676460359e-01   +6.971936461776320e-01   +5.239183888587192e-01   -1.146378530627237e-01   -8.059232058520467e-02   +4.255340694402310e-01; -8.051273802922975e-01   +4.525967719830402e-01   +8.289705377430556e-01   -4.417499770650294e-01   -2.394955039759837e-01   +5.427765811967190e-01   -2.992932368924436e-01   +1.851466568195893e-01; +8.569574870028707e-01   -4.732344191306914e-01   -6.225175115018350e-01   -1.185839194284508e-01   +5.241161098076161e-01   +4.741974290489128e-01   +2.976590549005571e-01   +3.376449370631383e-01; -4.119744403077850e-01   +9.572866496270268e-01   +1.000000000000000e+00   +2.133586610507230e-01   -4.781805976970841e-01   +2.727691482446781e-01   +9.056844975759891e-02   -1.965185604293581e-01; -8.118558891318362e-01   +1.507815458604986e-01   -1.292361446969578e-01   -3.516462784870473e-01   -2.984237264891226e-01   -2.572504429021681e-01   -3.982808085390317e-01   -7.604008046287390e-01; +1.880232810875508e-01   -2.999615284305898e-01   -2.189686197419844e-01   +1.252882788232633e-01   -1.116442573764413e-01   +2.457238842235495e-01   -4.078917273527896e-01   +4.909816529663172e-01; +2.845453746980839e-01   +4.889747265361189e-01   +1.745305277386957e-01   +3.958753439233271e-01   -6.622406591271155e-01   -7.790707048856856e-01   +1.625837473405695e-01   +2.200821937073904e-01];
L1E_L2E_iAMPA_netcon = [-1.145293726546699e-01   +3.065241012310247e-01   +1.971882971758947e-01   +4.652263200626690e-01   +3.882609488857969e-01   +6.235049511077224e-02   -1.520031407519493e-01   +2.229085950666016e-01   -2.334301914699222e-01   -7.350282598208114e-01   -1.311024164723095e-01   -4.415165631618797e-01   -2.543073944692808e-01   +6.165341912694999e-01   -1.349386577938217e-01   +3.569723992653874e-01; +2.084883197670566e-01   -2.900913841790980e-01   -4.659207240222207e-01   -4.239797950862523e-01   -5.647885198147718e-01   -2.718371303958693e-01   +5.877390169019057e-03   -1.980807374555548e-01   +5.914455307984215e-01   +6.651569454568440e-01   -5.445905520903603e-01   +3.306751907365217e-02   -4.316262666671800e-02   -1.167072680738911e-01   -1.778515913113091e-01   +1.226558987503510e-01; -8.089997004886810e-01   -5.245910261472543e-01   +1.744029248553854e-01   -2.271251807403013e-02   -2.164689442965176e-01   +2.180522611073096e-01   +3.334943935707466e-01   +3.475469585757405e-01   -4.186447956110549e-01   +6.594928342733941e-02   -2.461179088935036e-01   +7.074959753506791e-01   +6.737732961185326e-01   +1.036416535246525e-01   -3.005897384992630e-01   +7.703412196357406e-01; -4.854946750598036e-01   +2.077943555312509e-01   -3.638556229637667e-01   -1.380637974007193e-01   -5.269899236505244e-01   +4.738714857089844e-01   +8.233386446280784e-02   +3.419162933749541e-01   -5.227064054764379e-01   -2.938467902989263e-01   +3.508300019186663e-01   +9.454068568730112e-02   +2.849602619914933e-01   -1.381850741589579e-01   +7.803341295138369e-03   +3.029017001436026e-01; +3.695735895859126e-01   -4.187875133504239e-01   +1.824997141388734e-01   +3.703245689798166e-01   +8.923910408684036e-01   +1.198139906556081e-01   -1.383608760257116e-01   +2.585355763141527e-01   -2.737860065119047e-01   -5.374086957684991e-01   -1.422676905401793e-01   +5.661868215475628e-01   +1.703479217562688e-01   -4.053910227643872e-01   -2.809232816674003e-02   -3.481183790079630e-01; -1.098084821146452e-01   +4.893966512048355e-01   -1.130085143589371e-01   +3.588973977193940e-01   -5.506775856942183e-01   -4.219172358607566e-02   +5.297860571558277e-01   +3.095249076702830e-01   +6.074980697722109e-01   +4.992741317000149e-01   +4.050994179221637e-01   -3.469379045392260e-02   -5.948911997440962e-01   +1.348455934863774e-01   -4.485911060695192e-01   +3.619934271383788e-01; -1.181343646578218e-01   -2.120440213075273e-01   -3.721564908094445e-01   +4.613072317299320e-01   -2.097713609254228e-01   -9.593121797255630e-02   -3.521775299681690e-01   -9.846678014821322e-01   -2.051646769929597e-01   -1.523645779943956e-01   +1.000000000000000e+00   -6.309360335139100e-01   +1.210460047591528e-01   -1.801446542942318e-01   +1.447176701665853e-01   +6.274271395870532e-01; -4.818699404723730e-01   -1.292817405632672e-01   -2.773561558883111e-01   -5.683412643668621e-01   -1.352052155719582e-01   -3.043430737087895e-01   +2.373790519961808e-01   -3.720659928319101e-01   -2.251573780993781e-01   +4.045988374279263e-01   -1.216246463923047e-01   +4.756360920511170e-01   -2.265717692418819e-01   -5.138775820455385e-01   +1.821277964340381e-01   -3.769321343228094e-01];
L2I_L2E_iAMPA_netcon = [+3.711703575728176e-02   +4.961649231464944e-01   +4.317689158868367e-01   +2.074542955914526e-01   +2.007095640210326e-01   -3.920048977548212e-01   +2.970686729808283e-01   -3.561918674377174e-01; +4.319855641621917e-01   +3.313296542974197e-01   +8.701591701357974e-01   +1.976956167169364e-01   +1.686343181874556e-01   +8.727600701026279e-02   +4.225862025545136e-01   +6.508379643720709e-01; +7.121790789553635e-01   +5.262762589023556e-02   +2.039106602031638e-01   +8.350503959215411e-01   +2.357874856199796e-01   +2.110544961726985e-01   +6.284505117530207e-01   -5.271560071863648e-01; +4.351789565759441e-01   -7.116821727758460e-01   +4.809909241306830e-01   -4.201961743951715e-01   -6.979949623137621e-01   -4.392636140195849e-01   +7.376782920579764e-03   +3.447438413477003e-01; -6.630477915348955e-01   -4.904419605121259e-01   -4.083159165919284e-01   -6.416539153633435e-01   +3.187323948740005e-01   +3.636411433397386e-01   +5.921314714419823e-01   -6.614636479907393e-01; +4.184529578646167e-01   -9.155124353865226e-01   +3.800767309243666e-01   -4.509248304754264e-01   +1.000000000000000e+00   -1.646458954325452e-01   -4.876651187554903e-01   -2.483167718836812e-01; +1.547562333318702e-01   -7.004429044114293e-01   -2.981844864113258e-01   +2.311049466844638e-01   +3.853678387223960e-01   -6.796617431676990e-01   -8.833610934089375e-01   +1.908897638471001e-01; -9.623892061583535e-01   -1.065515449606487e-01   +1.129283273636914e-01   -2.271037405001922e-02   +6.795269185035679e-01   -9.194890712678491e-02   +9.690026917211300e-01   -4.202022865001899e-01];
L2E_L2I_iGABA_netcon = [-1.755337498274520e-01   +4.883597490438439e-01   +1.633460365379764e-01   +2.033287366549727e-01   -6.800943159577845e-02   -3.186296071858853e-01   +2.471011107798148e-02   -3.382796088144445e-01; -3.323621231189451e-01   -4.650202652271349e-02   +3.086974409666958e-01   -4.509009813168908e-02   -1.211477122323887e-01   -2.362755379179305e-01   +6.440538200858792e-01   -1.197892142832948e-01; +4.138990472057081e-01   -2.857146874291565e-01   +8.369330597499811e-01   +3.281932052732807e-01   +5.611415773104052e-02   +1.000000000000000e+00   +5.904782990927818e-01   +2.089602711845073e-01; +5.374054665863456e-01   +1.650109052916885e-02   +5.456780937143403e-01   -7.349304173463461e-03   -2.976606594940233e-01   +1.627711165790779e-01   -3.016474188747356e-01   -3.135406246119445e-01; +7.856312282612518e-01   -3.819871282507144e-01   +4.939136168092347e-01   +3.891205412983100e-01   -1.738792626709141e-01   -2.351243531555466e-01   -5.338338709516616e-01   -1.829584695087279e-01; +2.177822055230885e-01   -6.081951875729836e-01   +5.175671176699043e-01   +1.727316512003216e-01   -5.150647551312253e-01   +4.106252576736381e-02   +1.474339341862465e-01   +6.774797274765760e-01; -2.549732577989809e-01   +1.165895126363840e-01   +1.598534200580068e-01   +5.973936114008357e-01   -1.271146636735875e-01   -1.900667511681765e-01   +3.833006494757788e-01   +2.197356343186919e-01; +1.014535844594706e-01   +1.392541006834401e-01   +6.107728406771422e-01   +7.174506086288229e-01   +2.168237247484218e-01   -5.464868447029326e-01   +6.916937548864295e-02   -1.995553478203796e-01];
L3E_L2E_iAMPA_netcon = [-1.319276259008898e-01   -1.657091074085638e-01   -2.347566820929968e-01   +7.144877938780163e-02   -2.345811606667280e-01   +4.890560135299426e-01   -2.097905212068616e-02   -7.501572672392016e-01   -4.803347685838335e-01   -2.995450060901451e-02   +1.381142209510736e-01   +2.420464704401554e-01; +6.811233893171682e-01   +6.212861406152896e-01   +4.113018508966967e-02   -5.427764275451831e-01   -3.391504595506193e-01   -6.467120357158044e-01   +2.919812250847691e-01   +9.236927355430977e-01   -1.200687634920326e-01   +1.637540773924231e-01   +1.698033139945703e-01   +4.827538625082111e-01; -5.165622212847419e-01   +3.159505140991112e-01   -2.096443033557467e-01   +1.259332747424992e-01   +8.457227453466915e-01   +1.822446433102678e-01   -4.916421773696507e-01   +4.567801659607588e-02   +5.074746589002599e-01   +2.698503515272727e-01   -5.914217863907032e-01   +7.791899950772014e-01; +3.344259061368053e-01   -7.419065456767803e-01   -4.217179218636667e-01   +1.895259140947457e-01   +2.172295916550705e-01   -2.883365025836486e-01   -1.469914197344611e-01   +4.656251307898136e-01   +4.408142437189988e-01   -9.363232217011420e-01   +5.617807787069211e-01   +9.185455821237781e-01; +2.347816390800584e-01   -7.838378644292970e-02   -1.859722570767523e-01   +6.778707874593458e-01   -4.218336237902604e-02   -4.248146683833277e-01   -1.350949089075060e-01   -6.955650086711204e-01   +9.172086787705178e-03   -6.844229645678397e-01   +1.994148881033324e-01   -5.526799377155346e-01; +1.700734846134440e-01   -2.678415373390065e-01   -5.397710926961227e-03   -1.493650578384748e-01   +7.082005000682622e-01   -1.460692040963829e-01   +5.107941803223034e-02   +7.138338842951506e-01   -8.076118323188286e-01   +5.830916265551018e-01   +4.810263568813225e-01   -8.767993135465334e-01; +5.923164192946053e-01   +1.312191844917935e-01   -1.198779391059486e-01   -4.209152183044590e-01   +3.587790058676861e-01   +2.458087428950854e-01   +4.727622234341428e-02   +4.007655078943174e-01   +1.000000000000000e+00   +1.249102218966673e-02   -4.443791167285692e-01   -1.257058721161763e-01; -2.582924492571630e-01   +7.299023348078419e-01   +1.201276404298575e-01   +2.179926721214258e-01   +6.132462152672312e-01   -5.221865758578885e-02   -3.196337744132707e-01   -6.951566660471853e-01   -3.137657241979899e-01   -4.252403043462079e-01   -2.731772535606222e-01   -3.664794214196555e-01];
L3I_L2I_iGABA_netcon = [-1.437278008517018e-01   +4.117899166139562e-01   -3.329164257655968e-01   -8.373438427150482e-01   -8.795666948442739e-02   -7.696689130603888e-01   -7.094187093495450e-01   -3.564696349590598e-01   +6.711703283088184e-01   -5.336545585891382e-01   -1.922414598553511e-01   -1.000000000000000e+00; +3.974515291179883e-02   -1.035274247070113e-01   -3.250172507486256e-01   +2.268732232115333e-01   -7.168661259648319e-02   +3.662220677059433e-01   +1.902983765962712e-01   +3.079018196733810e-01   +6.841914521092335e-01   -5.817749252263088e-01   -4.327801434149622e-01   -1.436277135448062e-01; -4.068819316426713e-01   -4.947520139135111e-01   -2.228425369312893e-01   -3.451934483681561e-01   +1.186921546815302e-01   -1.378072905408736e-01   -5.727623757963731e-01   -1.129291298102880e-01   -4.113954082030027e-01   +9.194412218061981e-01   -2.898114990610792e-01   +7.751052544095386e-01; +2.107883126424618e-01   +3.417675430125383e-01   +5.489780824965459e-02   +3.660019810244648e-01   +1.366952315028393e-01   -2.592815655913744e-01   +2.467584009661079e-01   -6.123953065859501e-01   +2.978553957672356e-01   +2.704474756038452e-01   -5.767724952602317e-01   +2.455046438308428e-02; +4.830082382495726e-01   -3.213117461748718e-01   -1.996132380072252e-01   +7.208391506884715e-01   +3.782329077917391e-01   +3.757091796102768e-01   -4.190821758475948e-01   +3.087770361657985e-01   -1.885045897943439e-01   -5.808109148948754e-01   +1.429418105598766e-01   +2.631998716066429e-01; -5.824373499925783e-01   +7.236851172559322e-01   -4.725353449850981e-01   -6.212723536807077e-02   -5.689178339372863e-01   +9.849756290250973e-02   +1.687085933285602e-01   -1.544524678057316e-01   -5.932402466649473e-01   -4.254944227550371e-01   -8.136884776961615e-01   +5.438694570074102e-01; +3.061438972901638e-02   -5.190781422242209e-01   -4.216823496633829e-02   -1.773301500533589e-01   +3.993361272865750e-01   -5.386078263191527e-01   -9.911687002192578e-01   -5.459179592345950e-01   +7.785940109821811e-01   -2.471502066351243e-01   +3.193003686903731e-01   +7.860280454683694e-01; -5.906258598224575e-01   -5.789498092069032e-01   -2.261583592217775e-01   +3.143683793547983e-01   +7.080673372027235e-01   +3.131905563024519e-01   +4.043079906814853e-02   -5.973373523122307e-02   -4.630289931090558e-01   +6.082125611671578e-02   +4.029537297459951e-01   +3.437197735417108e-01];
L2E_L3E_iAMPA_netcon = [+5.072257920613795e-01   -5.153877521724550e-02   -1.879804296733165e-01   -3.284889175166187e-02   +5.866950343215327e-02   -4.603443856322498e-01   -2.277105283535889e-01   +1.703223486829606e-01; +6.028433458678384e-01   -2.584457415890269e-01   -1.889264720850655e-01   +2.164342771018315e-01   +7.908139982645240e-01   -1.235136714333640e-01   -5.141882984453334e-01   -5.300231207804369e-01; -2.424277922626944e-02   -8.878616097210387e-01   +5.912143997878820e-01   -2.826342638348703e-01   -4.058034256193034e-01   +9.368885672119278e-01   +2.366701347843613e-01   +1.000000000000000e+00; -1.320091583097482e-01   -3.067924362293061e-01   -2.388045261985112e-01   +1.679364953865832e-01   +1.993277569835785e-01   +2.544889860551034e-01   -2.914613951584314e-01   -8.892724474415639e-01; +7.421720195730815e-02   +6.669977646336762e-02   -5.198301380195684e-02   -4.084707821276554e-01   +5.146329887368479e-01   +5.977802985679179e-01   +6.670453342417154e-01   -3.672780826928936e-01; +1.837931728798241e-01   -8.426327074256567e-01   +7.339850636680161e-01   -1.340749551601822e-01   +6.706756001391636e-01   +1.326953374512530e-01   -3.775298799260154e-01   -9.270900226013197e-02; -5.581204717498518e-01   +1.652968143984517e-01   +4.106460739759341e-01   +6.343055139328402e-01   +1.953549729800049e-01   -6.802984695210039e-02   -4.849027551318686e-01   +4.634542458594002e-01; -6.396132146584899e-02   +6.789271638916704e-01   -5.147838839579265e-01   +1.814803324849038e-01   +6.127832099181054e-01   +1.140207890439992e-02   -7.451328208380387e-02   +9.367828668945667e-02; -6.994324496805802e-02   +6.142835810767476e-01   +4.484066989590389e-02   -1.101904642177001e-01   -2.591935521537031e-02   +4.844727225325921e-01   +1.179150007993406e-02   +5.963201067705054e-01; +2.901537556713312e-01   -6.674829179506699e-01   -5.938695422890276e-01   +2.552540617441796e-01   -1.875143158562942e-01   +8.145069507654192e-02   +6.747732894838528e-01   -3.382778365700527e-01; +8.378645181448166e-02   +9.108297051147094e-01   +1.198385647530114e-01   +7.650900349625896e-01   +6.473773189429329e-02   +3.894018929817384e-01   -1.912824955527939e-01   +3.296268881867527e-01; -1.085283788308801e-01   -8.489820380965001e-01   +4.437596802423514e-01   -6.276954278755605e-01   -3.591587808039147e-01   -5.219510819209351e-01   -4.957198438293570e-01   +5.277756637417893e-03];
L2I_L3I_iGABA_netcon = [-3.285015562831302e-01   +1.735771294532252e-01   -3.157264784977966e-01   +5.930970091102604e-02   -4.183508209324192e-01   +5.439449237869372e-01   -6.705090435010389e-01   +1.804376064117941e-01; +2.972350628982275e-01   +1.201827284884369e-01   +7.532935542993302e-02   -4.279498198606216e-01   -8.350359693918052e-02   +4.976096780292800e-01   +1.711362681618798e-01   +4.065745410219676e-01; -3.213057678352770e-01   -3.061580981639166e-02   -3.348674461996518e-01   -2.874292441103961e-01   +6.085607547529512e-01   +7.058729657581203e-01   -3.669170936039344e-01   +1.000000000000000e+00; +1.690121789496509e-01   +1.672370641440971e-01   -7.464270873044024e-01   -8.771182306218449e-02   +9.541375044132816e-01   -8.073091672096955e-01   -5.732155228814189e-01   +4.449443998434666e-01; -3.841083400675216e-01   +8.416784721872311e-02   -8.010264612681819e-02   +1.776996736197256e-01   -3.555819846682268e-01   -7.760376588120785e-01   +5.151957494273764e-01   +3.812639907397666e-02; +5.265574910502453e-01   -2.169840458185341e-01   -3.898579395642806e-01   +2.041878655884938e-01   +5.214958799773900e-02   -4.629443933569552e-01   +2.923587873283215e-02   +3.893067576170235e-01; -3.391611537382445e-01   +6.538390249250012e-01   -4.071818916947171e-01   +7.093610421784539e-02   -3.614342111405870e-01   -2.323724057782853e-01   +3.270471179393879e-01   -1.170478197342485e-01; -7.211909886751861e-01   -3.698853129577441e-01   -7.404864055021599e-01   -2.644729192066236e-01   +9.277412852487525e-01   -2.773806406808246e-01   +8.191476982845350e-02   +2.365940162422914e-01; +5.853733634594879e-02   +6.970655905974034e-01   -3.579117137814117e-01   -8.529841038619010e-01   +2.988230484242280e-01   +5.046763235244679e-01   -1.641472731608138e-01   +2.402382235501149e-01; +1.081786087068977e-01   -3.632963487241021e-01   -4.951035342383617e-01   +3.313330209223008e-01   +3.375624376642644e-01   +2.871194511980433e-01   +1.555041932774404e-01   -4.202877182159246e-01; -1.197866818426890e-02   -3.982139572301235e-01   +4.876213476763894e-01   -3.034457006823401e-01   -6.321836489094791e-01   +2.032304532148056e-01   -4.772203683530788e-01   -6.322400671261111e-01; +7.826841685295817e-01   -3.678573623272825e-01   -2.126036332170771e-01   +1.864028212476350e-01   +1.732301102062241e-01   +2.905656222844668e-01   -3.772456964319045e-01   +4.457869206756523e-01];
L3I_L3E_iAMPA_netcon = [+5.266088995366195e-01   -6.910480548170922e-02   -5.876281500484181e-01   +2.333756004263061e-01   -1.644103781834632e-01   +7.444409132487064e-01   -6.529907277773916e-01   -4.488956476066681e-01   -1.758132646229945e-01   -5.609732026619538e-01   -6.593759284709841e-01   +6.100375856343416e-01; -8.220765171119229e-02   -8.502077976772268e-01   +5.052370903672997e-01   -5.973579378147709e-01   -7.164214101687018e-01   -1.091005166895488e-01   -3.291447413275300e-01   -3.002590656859463e-01   +4.605044341198045e-01   -5.007105599912798e-02   +7.505148055210238e-01   +8.896252161155936e-02; -6.659548191987820e-01   +9.259293898697633e-01   +6.321857443912098e-01   -3.877567889885290e-01   +5.212260624693601e-01   +9.402020399086448e-02   +6.371321635570975e-01   -5.865658129713632e-02   -2.667628543419799e-03   +2.500683132449682e-01   -8.000089102356914e-01   -1.040268718977079e-01; +4.115660069424517e-01   +1.807150941404680e-01   +1.667871517706150e-01   +3.576264711632113e-01   -4.944012614929842e-01   -8.148904203109603e-02   -5.840870133712965e-01   -4.882445426809091e-02   +8.219224541660865e-02   -7.920035711121572e-02   -2.970974137584578e-01   -8.376432627391529e-01; -3.530755160690665e-01   +4.517225024513118e-01   +5.099767029104332e-02   -5.029112694771153e-01   -8.671229602995129e-01   +3.142290146759371e-01   +5.915456829586961e-01   +5.793976587024890e-01   -6.041190409866820e-01   +1.558206509326575e-01   -2.441358664145283e-02   +3.655179972661262e-01; -5.382445016501238e-01   +3.308754819661737e-01   +1.860165707687443e-01   +7.236963440032799e-01   +1.104301902790637e-01   -5.000059969858823e-01   -3.563617022578846e-01   -2.440583991044133e-01   -3.852467578873693e-01   +3.940938594866409e-01   +3.194614524516545e-01   -1.328993785001823e-01; -6.568009980420694e-01   +5.821401120711460e-01   -4.804094596437702e-01   +3.677885406143704e-01   +1.609759778257764e-01   +5.700292104725678e-01   +4.206301740794462e-01   +4.800758970515620e-01   -2.729776236001938e-01   -5.469518657043027e-01   +2.403482193688122e-01   -4.709744887932669e-01; -6.883888012462945e-01   -1.769730797731090e-01   +1.543606383134424e-01   +6.767540936881571e-01   +3.479109600081246e-01   +4.894522905902068e-01   -6.298911773047780e-02   -6.021709801263427e-01   +3.637258669486496e-01   +2.427572225900801e-01   +2.423973648454418e-01   +7.096110163279675e-01; +6.615859796955340e-03   -3.412766512400742e-01   -1.196549584325518e-01   +1.000000000000000e+00   -8.566507755206474e-01   -9.197242171610894e-01   -3.020649744521702e-01   -5.557684923992124e-01   +1.684753861691507e-01   -1.296235821646126e-01   -7.236566564427417e-01   +2.226602214650331e-01; -4.870697269408959e-01   -3.949465974846060e-01   +4.660064465568003e-01   +1.889367513663521e-01   -3.376016368681496e-01   -5.267831163778010e-01   +4.194927290153126e-01   -4.177074117087270e-01   -1.295904034636311e-01   -7.907749070260547e-01   -8.267538746626062e-01   +6.981857072809100e-02; -7.344625429553072e-01   +6.162513392601846e-01   -5.292085614094328e-01   +5.614186299381871e-01   -4.772297941218542e-01   +1.256252986061298e-01   +1.546469209921834e-01   +5.068194643998097e-01   -5.076352173594640e-02   +5.086128941378038e-01   -1.538012596256901e-01   +1.630350670157669e-01; -7.676347317473542e-01   -1.747604428752849e-01   -6.649420096582225e-01   +3.020382160986217e-01   +4.141596437389509e-01   -5.799375046341275e-01   -3.349999869119614e-01   -1.041751873787153e-01   +3.472911545667138e-01   -2.539740176102376e-01   -2.104387713082980e-01   -3.839526393314532e-01];
L3E_L3I_iGABA_netcon = [+6.323795158157168e-01   -5.044116125997266e-01   -4.728819257038033e-02   -6.445019997156788e-01   -4.885033031051605e-01   -1.000000000000000e+00   -5.959904225939268e-01   +5.345968372528027e-01   +6.672193140583792e-01   +6.572304353218293e-01   -4.676248827849921e-01   +5.411619571089263e-01; +5.175262711726446e-01   -5.912081455062420e-01   +3.721143091820669e-01   -1.009561267239502e-01   +1.415312251267223e-01   +1.462533674563512e-01   -4.188811017711447e-01   -4.875439995680823e-01   +1.368474662239867e-01   -1.638832227598438e-02   +2.897232830758466e-01   +8.195601127707150e-02; +1.860642854539402e-01   +2.520736556158023e-01   -1.348278139587695e-01   -4.565347070684951e-01   -1.475783598741426e-01   +1.077617438566561e-01   -2.656299854067018e-01   -2.909015668070299e-01   +5.436977566543497e-01   -7.354037904041013e-01   +2.701875908348650e-01   -2.849263356518734e-01; -8.836596000857930e-02   -7.321346861442803e-01   +8.769123273675559e-02   -5.791429658653948e-01   -2.203645780645394e-01   +6.756006903665100e-01   +4.633407349268227e-01   -2.773493940183344e-01   -3.651127369162826e-01   +1.230620190859349e-01   -5.466168383693867e-01   +1.399326171793455e-01; +5.314681455255102e-01   +2.167655271695079e-02   -2.491888647763883e-01   +8.426212418495083e-01   +6.560271294842985e-01   +2.395649587658916e-03   -3.983694036214080e-01   +4.564663738428936e-01   +4.208389698139118e-01   -5.164423216912040e-01   +2.484945327894870e-03   +7.294945520064351e-01; -1.575715228267533e-01   -3.840988971052511e-01   -4.644426347758606e-01   -5.818321492107283e-01   +3.411804120639532e-01   -2.686225392228105e-01   +2.461184419086558e-01   -1.295730707208790e-01   +8.056692294259945e-01   -2.184051226228027e-01   -1.626016712876225e-01   -3.916379585435916e-01; +3.253875529296350e-01   -5.376343653264797e-01   -1.615270757638559e-02   -3.873546537792918e-01   -7.584126058198016e-01   -1.575127476632030e-01   +2.581358184716669e-01   +3.070855109158501e-01   -2.208357093173601e-01   +3.037003918996583e-01   -8.696142509732578e-02   -3.496760644045541e-01; -4.065185929332659e-01   +5.301220216357153e-01   +4.201337907129265e-01   +5.385127914453889e-01   -1.100287330009430e-01   +4.361450636574626e-01   -4.681066840523762e-01   -4.095819416749527e-01   +6.731935141730422e-01   +5.604037638572814e-01   -6.637787321579053e-01   +3.473167296426764e-01; +3.930055772165483e-01   +5.985109790062134e-01   +3.817050537405018e-01   +6.343522095733787e-01   +4.680253037205451e-03   -6.066541232156922e-01   +1.844818748850566e-02   +3.278061466957197e-03   -3.521349860685566e-01   +5.104089104488828e-01   -1.894807137229777e-02   -8.636140827604011e-01; -3.940920356855772e-01   +6.088634200718763e-01   +7.213584724358931e-01   -3.284805414899665e-01   +2.995510916360919e-01   +1.219026352825336e-01   +5.058064640058789e-01   +5.942566637044223e-01   +3.363505437714701e-01   -4.909670073396395e-01   +5.129272601864785e-01   -6.092592387837360e-01; +5.996394467493137e-01   -6.911640876246391e-01   -7.959916578122183e-01   -1.148367258864464e-01   +9.866742996351241e-01   +1.528716921823614e-01   +3.238215884179237e-01   -1.861242489702850e-02   +5.057059090329200e-01   +5.476742458238787e-01   -3.490286606271759e-01   -3.139497377860928e-01; +6.101509859987285e-01   +2.804716520228631e-01   -7.495157526688341e-02   -6.605721542059334e-02   +6.695199528107084e-01   -7.243261576250495e-02   +1.146837867640579e-01   -3.004172728049727e-01   -3.363798769193305e-02   +7.408805161752906e-01   -3.394160664119068e-03   +1.532712082768629e-01];
L2E_Input1_iAMPA_netcon = [+5.615747966591719e-01   +1.812067418540615e-01   -1.000000000000000e+00   +8.134332633992447e-01   +2.708878141283477e-01   +4.902189957172694e-01   -5.106594982879373e-01   +5.220868554623731e-01];
L2I_Input2_iAMPA_netcon = [-7.866597641113902e-01   -1.273868097019205e-01   +6.286162389603751e-02   +4.528804326843686e-01   -6.354591014072123e-01   -4.383212234901480e-01   +9.774342963312012e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
