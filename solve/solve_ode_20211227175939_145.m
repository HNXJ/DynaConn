function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.368636898555207e-02   -8.962160703336291e-03   +9.064921909154311e-02   +1.663898580962337e-01   +3.780481734640344e-01   -1.395002690603812e-01   +2.455670671117058e-01   +1.840762075034932e-01   +4.733423210338757e-01   +9.508219659381377e-02   +2.844027085408942e-01   +1.804144778217726e-01   -6.413073584978402e-02   +1.639383469810983e-01   -5.752011172958007e-04   +6.357999573627340e-02; +6.301659331605548e-02   +5.903507826603956e-02   +2.500623503514188e-01   +7.185435302663438e-02   -1.864864878465749e-02   +1.941232999360276e-01   +5.478159114750230e-02   +1.969516348254705e-01   +3.534815964505778e-01   -1.205266087079289e-01   +9.046438805605928e-02   +1.509929183528098e-01   +1.213541872980022e-01   +2.060394207348764e-01   +9.330331194420602e-02   +2.257093985555599e-01; -6.929481487026369e-02   +1.588535125055232e-01   +1.624129995303471e-01   +1.159963791058100e-01   -7.980060231797953e-03   +1.842205939484635e-01   +5.793044128693998e-02   -9.014125782407295e-02   +3.739203297392486e-01   +1.392876110835145e-01   -1.440462259646869e-01   +1.928448795376050e-01   +8.148210796218948e-03   -4.189975561291198e-02   -7.059016806182148e-03   -9.386574565529899e-03; +1.201352415257266e-01   +1.429385598344145e-01   +3.259657144411146e-02   +1.359945203364079e-01   +1.106539499137724e-01   +1.989748987689951e-01   +4.249704163015179e-02   +2.564229700036313e-01   +1.684107546508363e-01   +2.326692501432603e-02   +1.983545438722357e-01   +6.668456049330834e-02   +1.569293167805243e-01   +1.662359465199654e-01   +9.094948968581525e-02   +2.962184712796152e-01; -1.017611601978663e-01   +1.178129993102537e-01   +1.457135402370512e-01   +6.409763267357133e-02   +3.073529647466446e-02   +1.611508770784763e-01   +2.089487652712385e-01   +8.621924495493692e-02   +1.913422283179755e-01   +7.407672368214621e-02   +5.367874605862460e-02   +6.030581958599567e-02   +8.905795585247636e-02   +1.399744569954903e-01   +9.100375551527233e-02   +1.485383122979919e-01; +4.503039871173062e-01   +2.071457031885083e-01   +7.760831467908014e-02   +3.589981045058706e-01   +1.593894910032981e-01   +2.283917315571513e-01   -6.343631180848487e-02   +1.588206033008136e-01   +2.658950286751781e-01   +2.143558254260249e-01   +2.549048324835818e-01   +9.814727421381375e-02   +1.151114245640886e-01   +2.167446737456932e-01   +2.534098662777229e-01   +1.971742601071526e-01; +1.312041486538178e-01   +2.971497653220883e-02   -5.411365247915946e-03   +9.320119796615227e-02   +2.757710737742971e-01   +4.363976767152495e-01   +1.007368387264160e-01   -8.853960748604381e-03   +7.736993279587603e-02   +7.038150871801735e-02   -5.993558980796121e-03   +2.504268972060145e-01   +3.867775432425672e-01   +3.214950259364175e-01   +1.166841303380525e-01   +2.353154370950940e-01; +9.483176408980371e-02   +2.139044142509797e-01   -3.299651156440379e-02   +1.701902045207971e-01   -8.092798130476889e-02   +1.982783460044392e-01   +1.113838412733726e-01   -8.750267290039687e-02   +2.284126971254870e-01   +3.075500770927861e-01   +1.829306534294243e-01   +8.223122036674346e-02   +8.575084356821537e-02   -3.742883270646363e-02   -1.711142778510406e-02   +2.212594688238451e-01; -4.290289281146133e-03   -3.739551770930640e-02   +2.903417413987415e-01   -3.485192822311253e-02   +1.134972817013709e-01   +1.377367381483618e-02   +2.414095494169055e-01   -4.797957949182335e-04   +6.744732526727427e-02   +2.801062993162277e-01   +1.235589770306457e-01   +2.597120759518191e-01   +8.314850238020434e-02   +2.293603137577546e-01   -5.682341445460385e-02   +1.745148046712581e-01; +1.253913186108429e-01   -1.381503016660646e-01   +2.077795130629323e-01   +2.101874904483261e-02   +1.104554723440134e-01   +2.091898267584908e-01   +1.167073007644857e-01   +2.075005363702577e-01   +2.763066247534439e-02   +1.511501582545139e-01   +1.621009203174668e-01   +3.023406379357297e-01   +3.776579490094254e-01   +2.564587059247776e-02   +1.833379840377856e-01   +7.957422139421209e-02; +7.818383703900290e-02   +8.538186912313840e-02   +1.191427209270633e-01   +5.164544874115378e-02   +3.076191715651044e-02   +1.397070259596304e-01   +1.185882987106174e-02   +2.386591844368545e-01   +2.061066845744760e-01   +1.357036763545088e-01   +2.102422129459056e-01   +2.926707508494304e-01   -1.292937634300403e-02   -1.387980737594227e-01   +1.629089995814451e-01   +2.971003308895151e-02; +2.142311668312658e-01   +8.888895733767585e-02   -8.021394563196076e-02   +1.110070672941875e-01   +3.570038361411236e-01   +2.240682509178492e-01   +2.367394986234499e-01   +9.971738473865759e-02   +1.547664334589042e-01   +1.281525491851831e-01   +2.065647195593469e-01   -7.664717613897094e-03   +1.356063068495304e-01   +2.466561696024735e-01   +2.958295173563947e-01   +2.417261711476117e-01; +6.225487194811638e-02   +2.741593626750142e-01   +4.720508756910244e-02   +2.207793527258348e-01   +3.848670624973142e-01   -1.726341107554082e-02   +9.311150868581063e-02   +2.055763214317052e-01   +3.246196519034714e-01   +4.967692125747036e-01   +1.892102780565522e-01   +4.503647515100424e-02   +3.765953816374123e-01   +2.750550334078272e-01   +2.850169112026582e-02   +2.166563538104326e-01; +1.833872089065173e-01   +8.118674292376205e-02   +2.479174285192470e-01   +2.070594796033206e-01   -7.294832120066730e-02   -2.463804558312066e-02   -6.642277752018279e-02   +1.417489302065775e-01   +2.096622982014808e-01   +1.762376559974193e-01   -4.904604425147108e-03   +2.353692602774125e-01   +1.824750712451566e-01   +2.783013072277021e-01   +2.555530749873500e-02   +1.905250047867706e-01; +1.335727399564894e-01   +3.372665999228343e-01   +2.486706814730907e-01   +2.072883389078139e-01   +3.453803618998884e-01   +2.565203884037101e-01   +1.545426364218879e-01   +1.737012634005551e-01   +2.506198715615815e-01   +1.527244890208325e-01   +3.179786486664572e-02   +2.897473374131226e-01   -1.763052727820200e-02   +1.720319365951068e-02   +9.788564226047346e-02   +3.695359451427597e-01; +3.634322141269815e-02   -6.541341067713771e-03   +3.055928358386836e-01   -8.719279302522673e-03   +8.329105143161397e-02   +9.363068739663773e-02   +3.589485003014600e-01   +1.724298866996643e-01   +5.016815491570672e-01   -1.327626596229309e-01   +7.942151468979693e-02   -3.706368234702826e-02   -9.825454837224815e-02   +2.416631135430354e-02   +1.509070226241394e-01   +2.678326940364211e-01];
L1E_L1I_iGABA_netcon = [+1.765269917520476e-01   +2.188497946817389e-01   +1.710766193208042e-01   +1.013356665876336e-01   +2.035334844962529e-01   +5.110219758957357e-02   +2.561868342255030e-01   +2.442757991854851e-01   +1.310672024600246e-01   +1.199579642720166e-01   +4.849351089396356e-02   +1.990574562642551e-01   +3.649330558993795e-01   +1.141087694694499e-01   +1.305730208493431e-01   +1.976153916352813e-01; +2.777648646622836e-01   +3.908454579275567e-02   -3.683796094672769e-02   +1.479095744253431e-01   +2.262657950876202e-01   +2.006121460510776e-01   -9.763055366615989e-02   +2.377988911995333e-01   +2.366163659169580e-01   +2.451862401594557e-01   -2.499998621634895e-02   +2.581839863843479e-01   +5.389856824158146e-02   +1.983878326538862e-01   +1.970734358008485e-01   +1.522876717066258e-01; +2.017327487592402e-01   +9.779930455378862e-02   -7.663905665704045e-02   -3.175307436298001e-02   +1.183446947320085e-01   -3.204362466481504e-02   -8.666293144277093e-02   +1.508209671172211e-01   +8.187371529513380e-03   +6.393290636655953e-02   -8.384375069382653e-02   +1.113765502172215e-01   +1.400156893193157e-01   +2.621209242282887e-01   -3.292953206790404e-02   +1.150938281809373e-01; +1.406847241310547e-01   +1.824561443107748e-01   +2.074281646590693e-01   +1.995093026626668e-02   +2.451228933870477e-02   +1.749130391002194e-01   +1.564363043216970e-01   +1.135089804335715e-01   -1.011497726765526e-01   -2.056535686260848e-02   +2.490885539756671e-01   +9.560748119723445e-02   +1.320980288173029e-01   +6.863803579847300e-02   -1.898841141993817e-01   +4.053949142719390e-01; +4.426887245475473e-01   +1.207276562616868e-01   +2.758147469335784e-01   -4.336092241149166e-02   +1.596218780291877e-01   +2.122594976176567e-01   -3.600143623266584e-02   +2.213582633816103e-01   +1.101664890208533e-01   +3.148593641206507e-01   -4.664127857780337e-03   +8.492875018520968e-02   +2.733291672547287e-02   +1.218188439826831e-01   +6.801533286242414e-02   +5.112519823507288e-02; +2.635404374525427e-01   +2.609085734740453e-01   +1.109714927925755e-01   +2.148078353519313e-01   +1.940327499533253e-01   +3.631710104498891e-01   +1.775366854527304e-01   -1.281445585004065e-01   +3.356814692538801e-01   +1.948696774377117e-01   +9.082613025478445e-02   +2.998739367930360e-01   +1.830833745595507e-01   +1.238864915741185e-01   +2.983099871811067e-02   +1.197611389281020e-01; +2.544737080542520e-01   +2.213146289356855e-01   +2.605901949099816e-01   +2.172826620714074e-01   +3.146443725323166e-01   +7.918987968089290e-02   +2.205767396833975e-01   +9.720442001995862e-02   +5.197153564041952e-02   +7.183090162222158e-02   +1.558963391896487e-01   +2.154629496834781e-01   +1.380063776938699e-01   +1.468082523377889e-01   +1.864890197708963e-01   +1.896027281112043e-01; +3.286391113245184e-01   +8.642051318193832e-02   +3.817813910451235e-01   +1.438208770617428e-01   -1.988808835057684e-03   -5.789879504909508e-02   +1.441714645398566e-01   +6.741148841808428e-02   +9.532318982573998e-02   +1.341491644854490e-01   +6.586829273670043e-02   +1.548824338587800e-01   +1.573506300899381e-01   +4.340234212274970e-02   +2.094290054056504e-01   +1.396799956733779e-01; +1.120877293101651e-02   +4.561267494562036e-01   +2.975185845345938e-01   +9.374794139954035e-02   +1.878839032780200e-01   +9.690286981236240e-02   +3.203792844872175e-02   +4.476556132920433e-02   +2.245644847826064e-01   +1.135129180721368e-01   +1.212622018545912e-01   +2.130386039179243e-01   +2.747858084384371e-02   +2.742074796402011e-01   -7.053319255494897e-02   +1.303690534958071e-01; +6.028397613337583e-02   +3.187157768348460e-01   +9.226627216170584e-02   +5.102523563504335e-02   +2.083728692264100e-01   +3.266662275587341e-01   +7.810000774988060e-02   +8.593263919743699e-02   +9.994058105887786e-02   -1.032235718773039e-01   +1.259453363410094e-01   +1.581586175657466e-01   -1.269895713149647e-03   -8.844840068093268e-02   -1.498343226308760e-01   +7.069058787737158e-02; +2.069807818940819e-01   +1.114983533718363e-01   -6.489419087792267e-02   +1.776254553748863e-01   +1.070570664560485e-01   -2.222046246859683e-01   +3.812608580090070e-01   +2.506608147954255e-01   +1.146023831021250e-01   -2.923818465693759e-02   +1.912297454247562e-01   -3.385048578475769e-02   +1.066541522468941e-01   +7.119136737071662e-02   +2.750150344982300e-01   +1.084093243355687e-01; +1.451358017921290e-01   +2.292144119153583e-01   +1.966993606673725e-01   +5.137735357079234e-02   +2.374604280661839e-01   +1.624681768465926e-02   +2.064753415252183e-01   +2.284703291616334e-01   +2.357368516955256e-01   +1.334555824714249e-01   +4.336696308033380e-01   -9.830129613391335e-02   +1.494956449720846e-01   +3.998644012435340e-02   +1.370781928992235e-01   +1.884416018983600e-01; -1.107571337880177e-01   +2.898547888591839e-01   +1.645145984541649e-01   -8.005476113230187e-03   +2.735684459202662e-01   -1.099400512424767e-01   +2.042049863485154e-02   +1.923993474322408e-01   -1.085779743991363e-01   +1.778045777688625e-01   +2.280427948432097e-01   -7.590081834793651e-02   +2.355410531394571e-01   +9.352243514403032e-02   +4.057498928913316e-01   -3.596785344929501e-02; +1.758983239856601e-02   +3.083153595075152e-01   +2.139944706869318e-01   +3.557508719487330e-01   -1.614400599976052e-02   +1.885364838112737e-01   -7.798846198719769e-02   +3.080112546373028e-01   +2.798496809344538e-01   +1.115851809700545e-01   +6.568999953366729e-02   +3.002601881123734e-02   -1.057684271871379e-01   +3.147779198383943e-01   +2.925863635231289e-01   -5.170953334894918e-02; +2.146967974076709e-01   +1.337098046967024e-01   +8.918690108003191e-02   -1.274641442119145e-01   +6.197389359655441e-02   +2.408718914633650e-01   +2.249993964259477e-01   +3.029029504458564e-02   +2.160698235633070e-01   -2.735832912228603e-01   +1.496479266123588e-01   -1.693103804192257e-01   +2.250188619029028e-01   -4.869378267852487e-02   +1.714038854704020e-01   +1.677619007558805e-01; +7.339690226887384e-02   +4.710988149810149e-01   +2.004559846137257e-01   +8.993636930060023e-02   +1.085589809776443e-01   +1.886515956094240e-01   +2.185435379460348e-01   +7.470619256956421e-02   +2.419983716188275e-02   -9.925370824596977e-03   +1.568052186652430e-03   +1.158326657895783e-01   +2.664170219168386e-02   +1.850142794423895e-01   +5.133617906161157e-02   +2.979892567249060e-01];
L2I_L1I_iGABA_netcon = [+1.942597928124935e-01   +1.845326704553545e-01   -5.780392175575080e-02   +1.148459177698301e-01   +1.102649873979520e-01   +1.585376790943722e-01   -5.184315634070849e-02   +5.588648164199833e-02; +4.616731388368973e-02   +5.106583354728082e-02   +1.656260815682083e-01   +1.449227386235145e-01   +1.522617678069234e-01   -3.762608351066963e-02   +3.932952901923680e-01   +2.201457886112502e-01; +1.211617206169482e-01   +2.737282967161889e-01   +3.984324403761629e-01   +9.344093858859101e-02   +1.480801488996581e-01   +2.178429749445875e-01   -2.111239837090591e-01   +4.342448952417290e-01; +7.876032662606944e-02   -2.793311895574278e-02   -2.997228747187881e-02   +3.729941693507716e-01   +7.854305253931328e-02   +4.018385417400755e-02   +3.528477668932029e-01   +9.612822242800709e-02; +1.109774682833077e-01   -2.946910503372456e-02   +2.547396038543466e-01   +3.429910167369037e-01   +1.512956185838453e-01   +2.469330680546296e-01   -1.954476704868723e-02   +4.730181976129692e-02; -2.888620206280823e-02   +3.475747197001586e-02   +2.871593604947669e-01   +4.410448403624197e-01   +2.985548240538589e-01   +2.488311945881709e-01   +2.005084377193366e-01   +2.069363648912604e-01; -7.160060150450924e-02   +1.441512560883054e-01   -4.328841239037731e-02   +2.999794932181424e-01   +1.777745521623930e-01   +2.830546925662834e-01   +1.486878304244455e-01   +4.903688717595694e-02; +1.285377552791625e-01   +1.601137697514644e-01   +1.477658257235170e-02   +2.078818619834261e-01   +2.559851790627847e-01   +3.022169237029243e-01   +8.756068580181864e-02   +2.890527397276509e-02; +2.322394569400247e-01   +8.814697170945331e-02   +1.592780190475118e-01   -1.520634370223371e-01   -7.811371717658890e-02   +1.951105932201371e-01   -1.840392892588197e-02   +2.539335866760992e-01; +1.795816526461501e-01   +2.796151722837704e-01   +2.120947857835875e-01   +1.360629844180149e-01   +1.663472210936123e-01   +3.291902743275800e-01   +1.719677880262665e-01   +1.521785587768474e-01; +9.496186738911257e-02   +2.744885811224470e-01   +1.388739024339179e-01   +2.614594831289607e-01   +8.116388614023447e-02   -4.786436417568794e-02   +1.298690830962942e-01   +1.550546616264840e-01; +2.394150259931080e-01   -2.458970320184765e-01   +2.755924253310293e-01   +9.634181818263801e-02   +2.125686450300266e-01   -7.814605406551668e-02   -3.245827712737512e-02   -1.090455581676930e-01; +5.207728271571028e-02   -1.483893512081973e-02   +9.064218521029642e-03   +2.126456695293293e-02   +2.710109690075592e-01   +2.716655602118320e-01   +1.259911223452291e-01   -2.771279062059585e-02; -4.498165485144757e-02   +2.748649730771877e-01   +1.460808286237560e-01   -1.023623577413174e-01   -5.793584139539745e-03   -6.841570746822388e-02   +3.194347936542323e-02   +2.356669955987037e-01; +2.677493458446984e-02   -4.980857453925216e-02   +2.746474375102692e-01   +2.043607293447268e-01   +1.356367949290619e-01   -1.497069700479733e-01   +1.579890586394553e-01   +3.765958683800136e-02; -1.361332003001114e-01   +1.554141882891253e-01   +1.663440110556010e-01   +3.372653496897272e-02   +2.164924707217192e-01   +2.508380230554924e-01   +2.734590874270724e-01   +1.886391098289831e-01];
L1I_L2I_iGABA_netcon = [+2.675885741088231e-01   +7.935334650745268e-02   +3.019385798532808e-01   +6.177388598482278e-02   +2.022319195926005e-02   +2.529886917064992e-01   +6.887657128860378e-02   +3.357511233269686e-02   +1.495214050154393e-01   +1.537022944171731e-01   +3.042344354120217e-01   +2.294254456266607e-01   +1.156502512154202e-01   +4.172815352790296e-01   +4.021098856552322e-01   +2.601026021323704e-01; +1.631641228947840e-01   +1.801798676513024e-01   +9.653786665556532e-02   +2.777830239880182e-01   +6.692423297437691e-02   -1.137412008642430e-01   +9.749155246361947e-02   +3.812274023692086e-01   +1.250705286256910e-01   +7.391755909600634e-02   +2.614726677088778e-01   +1.491391704553100e-01   +4.454996509772978e-02   +3.045048422138263e-02   +1.542479979576326e-01   +1.678208013640109e-01; +9.313906741043257e-02   +1.326400364760137e-01   +7.193616949538080e-03   +1.142798090491037e-01   +8.619202682290610e-02   +1.110248800258638e-01   -3.642159940379151e-02   +2.774791960861619e-01   +1.966693993385024e-01   -3.926415377026200e-02   +3.995473876191156e-01   -1.162346852067872e-01   +1.933697675449244e-01   +1.004375567904134e-01   +1.585946325440228e-01   +7.335077300969214e-02; +2.446386168637455e-01   +9.400346356298471e-02   -8.120369603810439e-02   -1.394127062989446e-01   +3.181192086461525e-01   -1.201029827659771e-02   -7.162033287571007e-03   +2.519320698111090e-01   +2.032866019120164e-01   -5.615090658084007e-03   +4.379069095109323e-02   -5.448124613522112e-02   +2.706391036282215e-01   +1.578104481468622e-01   +9.075992027354474e-02   +5.372019080763510e-02; +3.951366765040833e-02   +1.716146376990870e-01   +1.545135095412089e-01   +2.290424034913365e-01   +3.518450667786629e-01   +1.182227361080961e-01   +5.801193078393156e-02   +3.029098880683893e-01   +1.554896972011164e-01   +3.239275910544610e-01   +2.814603457083940e-01   +2.301838248963264e-01   +8.882147669533756e-02   +1.095406866012787e-01   +3.066095960429244e-01   +2.099048661951488e-01; +8.301629053863815e-02   +2.466221981957899e-01   +2.731547817503746e-01   +4.983528674090532e-01   +1.822393181667556e-01   +2.441057700998549e-01   +1.700358939299618e-01   +2.007645029375399e-01   +6.231088175804005e-02   +1.215143122696205e-01   +1.133490837677219e-01   -1.599643340232227e-02   +3.841141541082942e-02   +4.243076875210657e-02   +7.404921895844610e-02   -1.990634769008265e-03; -6.965380014401801e-03   +2.938776044910931e-01   +2.444657315694708e-01   +1.663790101162301e-01   +1.884766094340403e-01   +3.621341272189199e-01   +3.052154913079123e-02   -4.094576150811885e-02   -1.937736039990894e-02   +2.027173847319386e-02   +2.050186276070026e-01   +4.646923120644096e-02   +2.856997980160290e-01   -8.829400288293854e-02   -4.569773875891757e-02   +2.758460059370540e-01; +2.885376329350837e-02   +1.204654151255291e-01   +3.802600099969172e-01   +1.348866134101191e-01   +1.329734722247579e-01   +1.608697541147232e-01   +1.793936113748975e-01   +1.428127253247636e-01   +1.563422273473151e-01   +1.793904976135218e-01   +8.134339530975014e-02   +2.504314509475488e-01   +3.151340181065020e-01   +1.642837862361645e-01   +2.713370700790195e-02   +2.130015657534389e-01];
L2E_L1E_iAMPA_netcon = [+2.944913813766284e-01   -6.560862261541765e-02   +4.693864380427467e-02   +2.868477946765671e-01   +2.623171332805474e-01   +1.189962329646630e-01   +3.537289988090626e-01   +1.930012474825809e-01; -4.302613388765881e-02   +1.366755868235394e-01   -1.018111254742772e-01   -8.862039839761021e-02   -1.095411820714567e-01   -4.474389738028317e-02   +2.493409290286636e-01   +9.717240019202755e-02; +3.919304396459862e-01   -1.377771131346342e-02   +1.109529947188648e-01   +1.344052522289815e-01   +1.589996470357932e-01   +2.943454388088697e-01   +9.821757751130054e-02   +1.806440887751234e-01; +2.047097413588871e-01   +1.277248179122727e-01   +2.180623183233031e-01   +6.422921412038059e-02   +5.477186711056034e-02   +1.579692143456294e-01   -6.076942218972811e-02   -1.435010585182928e-02; +3.779029676613173e-01   -1.268146740807079e-01   +1.057954005685909e-01   +2.616525616810740e-01   +3.437730531723319e-01   -5.159379403805034e-02   +2.763525885658834e-02   +8.042075582811441e-02; -1.149202220344439e-01   +1.415014544803337e-01   +1.945372443148388e-01   +1.432877617161936e-01   +2.645039085920620e-01   +3.050016474842016e-01   +3.414317676235948e-01   +2.563460602156383e-01; -5.209941063625868e-02   +1.910071622506455e-01   +3.298904767143778e-01   +5.225199792564825e-02   +1.015089170201687e-01   -6.005938473194586e-02   +2.487374926603109e-02   +1.794859397873121e-01; +1.956585547268245e-01   +1.657688521494612e-01   +2.449679439858588e-01   +4.418994502644671e-01   +1.410679281092696e-01   +1.280944548328057e-01   +1.054662927483588e-01   +8.815487254072832e-02; +2.312931265793798e-01   +2.573476593709962e-01   +1.783041776853089e-01   +1.076717657653966e-01   +1.937823156931453e-01   +5.452361836911362e-04   +7.287348702966090e-02   +2.123592427717473e-01; +8.033988496454303e-02   +1.138085703521284e-01   +2.993064145738406e-02   -7.715198264174286e-03   +7.566026381202375e-02   -4.083087539029450e-02   -5.419521061554701e-02   -1.263554927716176e-02; +2.336595712665697e-01   +2.989611384833590e-01   +5.239999600531030e-03   +2.540689694490064e-01   +1.308753236141590e-01   +1.338728767238808e-01   +1.491162184005637e-01   +3.091623247859014e-01; -1.354519244756693e-02   +1.310454320905251e-01   +2.457126435120884e-01   +7.989884291939900e-02   +2.710991014371850e-01   +2.094303895793295e-01   +3.530739044497408e-02   -1.857362767322777e-02; +2.111460619981195e-01   +9.837726893590178e-02   +8.786202416569391e-02   -8.600505558620243e-02   +9.300898212379126e-02   +3.620956133201969e-01   +2.055310430514780e-01   +9.883426718618793e-02; +1.091972263845123e-01   -1.411697113212893e-01   +1.970320379187541e-01   +1.617555410572179e-02   +3.106276168893340e-01   +2.119564445979630e-01   +2.536803723860581e-01   +1.092738038760179e-01; +2.043162323586961e-01   +2.741352647990128e-01   +1.172446585925573e-01   +3.525771095979777e-03   +8.216588818367565e-03   +2.931463875536916e-01   +1.205917790237897e-01   +5.724548429916031e-02; +2.960735050540745e-01   +8.508064449423898e-02   +2.327371094851370e-01   +6.837188930609049e-02   +1.288427095955206e-01   +1.699027400809132e-01   +1.988531842303196e-01   +1.486635150878619e-01];
L1E_L2E_iAMPA_netcon = [+7.737007278190394e-02   +2.850101715345255e-01   +8.600844387714657e-02   +2.767510655273957e-01   +2.573285099290238e-01   +1.832709085991905e-01   +1.802429489911551e-01   +7.004915962888696e-02   +3.301155657785295e-01   -3.684334235469324e-02   +3.039150440840262e-01   +2.610632461138215e-01   +2.871826478990672e-01   +6.239386800253872e-02   +3.027282433779155e-01   +6.678305732084089e-02; -5.600134090716033e-02   +2.355350950793071e-01   +1.308018292092246e-01   -9.816209358535143e-02   +2.873270498195481e-01   +9.461949772698230e-02   -8.615210389931283e-02   +1.747056866756767e-02   +9.489707906843378e-04   -4.220245054635896e-02   +3.602565881877103e-01   +5.297226744720358e-02   +1.472634250873270e-01   +1.494023757433219e-01   +9.518924491188081e-02   +1.639391278997381e-01; +3.165084880257271e-01   -9.367786271571582e-02   +7.410551360394370e-02   -4.599056773572288e-02   +1.906959731555588e-01   +1.603301147803963e-01   +1.385533525953558e-01   -4.833491735047046e-05   +2.147781051339757e-01   +2.857398278809880e-02   +3.351374378595207e-01   +1.305010475299433e-01   +3.929638569869591e-01   +2.299409542799886e-01   -4.342658877705791e-02   +1.990561161364524e-01; -1.396379404706891e-01   +3.076235746348604e-01   +2.905953659397412e-01   +7.956783899594991e-03   +1.571766086798607e-01   +1.670201545210382e-01   -9.653102094834427e-02   +1.562412457607225e-01   +1.662456265754465e-01   +2.878013600010243e-01   +1.159435677303786e-01   +2.628129531622562e-01   +2.202110630134311e-01   +2.526860011304043e-01   +2.234015377440590e-01   +1.737579323648645e-01; +2.110952341436547e-01   -8.624234876318883e-02   +1.725303268565273e-01   -1.192997163229753e-01   -9.091944899796883e-02   +1.834507482870310e-02   +2.914057910370794e-01   -3.489562454761445e-02   -3.336342835806354e-02   +5.421072195809794e-02   +2.043037942100332e-01   +1.517022802944397e-01   +1.605373884527563e-01   +1.789907367194989e-01   +2.272629247317980e-01   -2.609414808002719e-02; +3.663507319450243e-01   -2.388121500573671e-02   +2.803712823150434e-01   +7.288633019334438e-02   +6.991296926259585e-02   +8.996444475839577e-02   +2.179260293545853e-01   +1.159990331700273e-01   +2.188944531229137e-01   +1.631410019424362e-01   +1.570577535695529e-01   +8.029788037264335e-02   +3.533551657182673e-01   +1.759143163547314e-01   -1.805501556171263e-03   +1.172282711176643e-01; -1.719645954250705e-01   +1.802716997423902e-01   +1.431132668943750e-01   +1.661603051059451e-01   +9.403007650276596e-02   +3.090363726704616e-01   +1.769340119816143e-01   +2.348580635760266e-01   +6.328860278503039e-02   +4.351171414939790e-01   +1.765831967161784e-02   +1.346763336664467e-01   +1.158104400883712e-01   +6.316370000340382e-02   +1.086329321868923e-01   +3.214975193871540e-01; +4.469174900719258e-02   +2.251767619088045e-01   +1.074196585856376e-01   +2.785199321114329e-01   +2.541092108363216e-02   +1.251942780531132e-01   +1.342100679736056e-01   +3.763967508084775e-01   +2.298843028720580e-01   -7.099054343978119e-02   +1.961143601009565e-01   +8.977787327494000e-02   -1.355660886276746e-01   +4.376958880585664e-01   +1.308281966536880e-01   +1.798544737713026e-01];
L2I_L2E_iAMPA_netcon = [+3.636554499671826e-01   +5.455584746381677e-02   +2.455677379552778e-01   -9.522532712743878e-02   +3.313556021780192e-01   -8.929156357153978e-02   +1.235248989891699e-01   +1.076094708490673e-01; -3.910190152379598e-02   +1.194619256181181e-02   +2.287563380897594e-01   +3.163659661193472e-01   +5.500008459515743e-02   +2.317334539593515e-01   -1.945017433015842e-02   +2.400095006261856e-01; +3.495431420423900e-02   -1.196675744957817e-01   +1.626810629501727e-01   -5.683583889036929e-02   +2.992431295796284e-02   +9.459123019684770e-02   -1.409555979144594e-01   +3.105836216269370e-01; +2.583454990920532e-01   +7.495459616003923e-02   -3.015127500962578e-02   +6.297818929586536e-02   -3.882116906916445e-02   +2.961033512318053e-01   +1.476769742576414e-01   +2.687612537111396e-01; -1.379678423724237e-02   +3.588527161205398e-01   +3.321762567264008e-01   +2.103724825559956e-01   +9.934922762777740e-02   +2.669604663552705e-01   +9.221346670536562e-02   -3.318907735760965e-02; +2.523115294484399e-01   +1.565540936912307e-01   -4.816459286556139e-02   +1.350981326995001e-01   +2.230655216786231e-01   +2.691690492325903e-01   +5.615134398422982e-02   +3.557299439823675e-01; +2.917667072715073e-01   -1.145190021658261e-01   +1.937200037359516e-01   +2.601805125607373e-01   +3.911322471631058e-01   +1.102187536861731e-01   +1.261386941769981e-01   +1.155342301423230e-01; +1.321552210225496e-01   +2.784346853273342e-01   +3.197639178080007e-01   +1.288545554772519e-01   +1.796420830973899e-01   +8.077404195539850e-02   +7.231385950185019e-02   +1.313803322302986e-01];
L2E_L2I_iGABA_netcon = [+8.477693806045551e-02   +1.011721492073997e-01   +2.767542493839473e-01   +9.779923704006664e-02   +1.192337247570937e-01   -3.796274528985892e-02   +9.447868319206183e-02   +1.919686769411014e-01; +2.089691490758006e-01   -1.315545358771775e-01   +3.518890899741588e-02   +1.894654315209161e-01   -6.351739162817759e-02   +2.158837421296003e-01   +2.147667223084432e-02   +1.874380831285365e-01; +2.054737550186638e-01   +1.096270064279790e-01   +2.412500125533727e-01   +2.125997682706128e-01   -4.629239387294352e-02   +2.249855414884862e-01   +1.309970478499528e-01   +2.969637561799700e-01; +1.091656659970125e-01   +4.834004431414042e-01   -7.828768882059606e-02   +5.300319542030991e-02   +1.263821944980484e-01   +2.666736102445783e-01   -5.847535146195121e-02   -2.965749497684082e-03; +1.376970367462879e-01   +1.991569145055657e-01   +2.889721278927916e-01   +1.092775136553509e-01   +1.952011716034392e-01   +1.645420474332813e-01   -2.428457179029824e-01   +3.968603420215857e-01; +5.291063198977167e-02   +2.228290393296491e-01   -3.952452287095704e-03   +2.352580591507145e-01   +1.628420209047527e-01   +2.222886219304154e-01   -4.919254580920009e-02   +1.255696750179864e-01; +1.598635201575930e-01   +2.597967359803959e-01   +2.727757152147917e-03   +3.485193038142597e-01   +1.278985862016528e-01   +5.643604150140134e-02   +3.474412204571384e-02   +1.667373979033285e-01; +3.751038116836991e-01   +1.731402184296094e-01   +9.656808807256162e-02   +1.070165282396478e-01   +1.728445295749599e-01   +3.308341333043440e-01   +1.577701491967508e-01   +1.333289717674933e-01];
L3E_L2E_iAMPA_netcon = [+5.707073688006913e-02   +2.607307491572384e-01   +1.223300661059810e-01   +1.271681621568369e-01   +9.914571299313379e-02   +2.356209250506446e-01   +1.570028828873247e-01   +1.996451581948609e-01   -2.665730327250055e-03   +1.335350429112067e-01   -1.197864844816113e-01   +2.405032272257370e-01; +1.845919403492653e-01   +2.074988309057604e-01   -1.510290503599107e-01   +1.186324894105488e-01   +1.381989534469449e-01   +1.406427357042033e-01   +2.067585905875954e-01   -1.866844575216387e-02   +2.552998307126224e-01   +2.950276513233395e-01   +5.000574146540679e-02   +1.958106923385082e-01; +1.376228018230665e-01   +2.855121103029273e-01   +3.614189079211249e-01   +3.001393414278435e-01   +2.361079973937093e-01   +4.935161491560872e-01   +2.951615759967535e-01   +1.393167418870460e-01   +1.012121121577115e-01   +3.887583028921442e-02   +1.090363969572956e-01   +1.695181962351426e-01; +9.503003251607647e-02   +1.518616184351385e-01   +1.981145274101890e-01   +2.447713303138981e-01   -5.338398747206297e-02   +1.787594708450399e-01   +9.996313258660758e-02   +1.106485782941766e-01   +8.232767886759926e-02   +1.545116459058877e-01   +3.768691930021401e-01   +3.071119770622477e-01; +1.724308776771262e-01   +3.263401667599772e-01   +1.817960908185651e-01   -1.628749137858529e-01   +1.782583319409007e-01   +1.689134061582151e-01   +1.943205961539823e-01   +2.777580485221357e-01   +1.663373235336333e-01   -1.339077129025192e-01   +3.109253557573853e-01   +7.046106491093669e-02; +1.066799475106441e-01   +4.334282279257270e-02   -7.112408931631421e-02   +9.381973621475720e-02   +1.804932145592458e-01   +3.157229976387540e-01   +9.610999421636959e-02   +1.998760083422161e-01   -1.048320501161877e-02   +8.448595366163270e-02   -5.859413973191100e-02   +8.613469306658107e-03; +4.077533554313714e-01   +1.584536156347610e-02   +4.594715228955853e-03   -1.221530690978830e-01   -1.392029815914268e-02   -4.193525962310209e-02   +1.201457722192337e-01   +2.392628357183836e-01   +2.212609010108780e-01   -6.664275353936150e-02   +1.778434615247398e-01   +2.118291896484460e-01; +1.434321733666244e-01   +1.197740815883318e-01   +1.561191394270748e-01   +9.138082298597383e-02   +1.794159618532349e-01   +7.621360580941919e-02   -4.329662794393693e-02   +1.374048806433590e-01   +3.324159671487216e-01   +1.000072426131960e-01   -7.558831067279168e-02   +2.174252993758643e-01];
L3I_L2I_iGABA_netcon = [+2.080718813235415e-01   +5.982490247940252e-02   +1.675331572961731e-01   +3.835985809618665e-01   +2.380211216060899e-01   -3.827581638014416e-02   +4.735811012271311e-02   -8.198358230249649e-02   +6.344285838812469e-02   +2.536236865773950e-01   -1.767319196461507e-01   +1.059409267001799e-01; +6.749780056703268e-02   +1.011370500654883e-01   +1.629919119925619e-01   +2.180278125901277e-01   +1.953615890556941e-01   +1.042361857218521e-01   +9.192416647683677e-02   -9.119583667900963e-02   +2.970322141705724e-01   +2.118685175226381e-01   +2.494734532076161e-01   +2.829119668591911e-01; +1.049325710346307e-01   +2.896700125656936e-01   +5.229165721676600e-02   +2.743458359149097e-01   +2.582671362376628e-01   +1.018002567487050e-01   +2.262786593747083e-01   +2.560042984081092e-01   +1.112957368730467e-01   +3.566094730053845e-01   +2.730069051636207e-01   +4.062892411910696e-02; +1.924073387659501e-01   +3.678415937417805e-01   +2.590850136805208e-01   +8.230403794107170e-02   +3.306227990331447e-01   +6.885100839901521e-02   -2.927977416499716e-02   +1.124068682546163e-01   +1.398335853462051e-01   +5.867249413805342e-02   +1.154086490213521e-01   +1.258116799497934e-01; +2.581227598766621e-01   -1.116408373660846e-01   +2.175454897090096e-01   +1.631289864644334e-01   +1.171082992671069e-01   +1.403162921577955e-02   +2.447548364210045e-01   +6.073883791435353e-02   +2.197646719234992e-01   +1.120943998926842e-01   -4.496589230223053e-02   -4.609195639282101e-02; +9.494327764215449e-02   +2.980528580978579e-01   +2.678762675539348e-01   +1.247445947751861e-01   +2.250602781128350e-01   +2.451874170260290e-01   -6.991987172709442e-03   +2.050083006494593e-01   +2.937070958538581e-01   +1.996752983939210e-01   +1.341734845454157e-01   +1.388203740912079e-01; -7.191020129219418e-02   +2.658637526924424e-01   +3.387576204672378e-01   -6.615645997898678e-02   +9.971367654054875e-02   +2.435037360215601e-01   +2.337225129165266e-01   +2.853576276854444e-01   +1.960611578508078e-01   +1.891334921506494e-04   +1.925622188759946e-01   +1.263902745077587e-01; +9.804427561105769e-02   +8.166110926556430e-02   +7.858987506923980e-02   +3.288829567583670e-01   +1.719533613447741e-01   +1.155759870428513e-01   +1.743894422620882e-01   +2.256166912040349e-01   -1.501916025498486e-02   +1.056586175289700e-01   +3.563666341719179e-02   +1.621414382745238e-01];
L2E_L3E_iAMPA_netcon = [+4.247513825951026e-02   +2.823553769498099e-01   +2.667272738659663e-01   +9.530194348268546e-02   +2.380151961287811e-01   +1.281418322903864e-01   +3.525091798275864e-01   +7.732089470500078e-02; +1.151659715604407e-01   +1.810740987252843e-01   +2.137003225974951e-01   -1.100033951112183e-01   +2.202690013102891e-01   +1.605971834420324e-01   +1.993142837580114e-01   +4.203022720505813e-02; +4.154611535506192e-02   +1.870553775023399e-01   +1.765576312130059e-01   +3.468114163027020e-01   +1.763020046609079e-01   +3.889857995849519e-01   -1.720110759666678e-02   +6.437711376688737e-02; -1.752892794644183e-02   +7.755442142285324e-02   +5.128210755099710e-02   +5.439646126033761e-02   +2.922449747876978e-01   +2.234641669188391e-01   -9.663109936392980e-03   +5.538361151867394e-02; -4.003319646856327e-02   +2.961445639516918e-02   +1.948567870443988e-01   -5.849687896896116e-02   +1.048584506792773e-02   +1.089154508336338e-01   +2.518209465578363e-01   -7.507194359024305e-03; +1.014539533571528e-01   +3.772456515031444e-02   +9.800799339634780e-02   +1.698578560879314e-01   +8.281629459331803e-02   +2.319044962838808e-03   +4.375682063605316e-02   -1.844146389731983e-01; +1.248840853750940e-01   +1.630991223409314e-01   +2.589660080429673e-01   +1.997165126045264e-01   +1.076044722337337e-01   +2.415553436901721e-01   -1.354513414306039e-01   +2.125227762970419e-01; +1.956617050802884e-01   +1.644543901396459e-01   +6.291404622451857e-02   +1.637455494851123e-01   +1.759486189287711e-01   +5.101253731641991e-02   +5.863475502473831e-02   +5.606896984834091e-02; +1.204711171086199e-01   +2.642443918214925e-01   +9.914446891201421e-02   +2.010601459131051e-01   +1.781093535198473e-01   +6.050747090169233e-02   +2.311485526468932e-02   +1.071754314469859e-01; +1.514207609204970e-01   -5.147971124349651e-03   +8.669388565858729e-02   +3.471248669958016e-01   +1.491352064849989e-01   +5.213902000414136e-02   +2.752061474766755e-01   +8.812742456192457e-03; +1.857693775829293e-01   +2.245850064946279e-01   +2.383180748981474e-01   +1.959567772475173e-01   -1.397427153910508e-02   +5.020409303266514e-02   +2.110032808162310e-01   +1.605199974708706e-01; +2.274413115239351e-01   +3.025553184680467e-01   +1.439145869879404e-01   +2.693808727072290e-01   +1.170422253343134e-01   +3.323478844629107e-01   +1.454517476020606e-01   +2.435635504082852e-02];
L2I_L3I_iGABA_netcon = [+3.925895682381704e-01   -1.024959754081737e-01   +1.594345755583321e-01   +8.849519044785005e-02   +2.168328783671938e-01   +1.911102556294774e-01   +2.590501687670240e-01   +4.456211733701436e-01; +2.577794710269756e-01   +9.562705842239524e-02   -4.797877998459477e-02   +1.828204935550250e-01   +5.320210983152480e-02   -5.092725152825511e-02   +1.782260623041019e-01   +5.099497506069171e-02; +2.195140752417914e-01   +1.194920572858565e-02   +2.471924675445399e-01   +2.019290963996938e-01   +1.089480725521840e-01   +1.559278115984891e-01   +2.960295219374122e-02   +2.149108006442713e-01; +5.039140977742494e-02   +3.245145966050529e-01   +2.699756975202889e-01   +2.176918740997472e-01   +9.205022207772952e-02   +3.240270741333287e-01   -6.235666409530533e-02   -1.637400726363654e-01; +4.745687317425897e-01   +3.456040591058905e-01   +1.411033929086635e-01   +2.208366538182530e-01   +2.426345176596069e-02   +7.030635446067275e-02   +5.655583569458943e-02   +2.018708280208286e-01; +4.030266797811172e-01   +2.209977284592068e-01   +2.665077163794187e-01   +1.513055839779057e-01   +4.510262520906457e-01   -7.959318800159992e-02   -1.107171965608509e-01   +2.511343273536470e-01; +9.760224166012069e-02   +1.794392785318969e-01   +2.168301491623558e-01   +3.783818542368774e-01   +9.560092598483751e-02   +1.615707109039526e-01   +1.085998795119486e-01   +6.950108058361802e-02; +8.052177882531192e-02   +8.835651836718349e-02   +1.193498590041420e-01   +1.768825092989269e-02   +1.102555754889211e-01   +1.064842112556373e-01   +8.727895581252929e-02   -1.463624385576303e-01; +2.312831445923403e-01   +1.932380444052544e-01   +5.545198926931619e-02   +1.345386229856650e-01   +2.153514537465355e-01   -1.295694727128413e-02   +2.254856921639497e-01   +6.246078306504995e-02; +1.437632053904101e-01   +6.060114024729628e-02   -1.263284652075610e-01   +2.054790482253306e-01   +7.141583640003915e-02   +1.230175587254652e-01   +2.211415839162814e-01   +8.705028577673112e-02; -1.723295063925620e-02   +2.611952128497298e-01   +9.374634315285349e-02   +1.932628586331760e-01   +1.405054615236004e-01   -4.636577375127667e-02   +2.924175125806387e-02   +9.005684934909067e-02; +1.539608890674703e-01   +2.162931317849218e-01   +1.341802324400791e-01   +2.606881036110809e-01   +1.964035497275152e-01   +9.800618561277757e-03   +4.876029927894205e-02   +6.116584807084986e-02];
L3I_L3E_iAMPA_netcon = [+8.631265389891071e-02   +2.816329219884576e-01   +1.382582092900445e-01   +1.641103678119977e-01   +1.971990752193428e-02   +9.464445417449414e-02   +7.945085716225378e-02   +7.694645589589826e-02   +1.584556417959274e-02   +1.807644257537508e-01   +3.060702713952156e-01   +1.157289168617830e-01; +3.155370374750001e-01   +1.695838731684419e-01   +2.519584777046661e-01   +1.841185663943812e-01   +2.571274231546978e-01   +1.074161454486694e-02   +3.006846641605003e-02   +8.183681872092183e-03   +2.838082448367774e-01   +2.070272542655847e-01   -3.345837751908649e-02   +1.664517896839884e-01; +1.289355592272771e-01   +2.270889973365187e-02   -4.996844770919787e-02   +2.384344679628704e-03   +1.150691438311487e-01   +3.346397895228678e-01   +3.960459682444027e-02   +1.908096512731929e-01   +9.723652224953606e-02   -8.763250602233133e-02   +1.953183976156775e-01   +3.470195382612482e-01; -9.318875830070789e-02   +6.491403881729592e-02   +2.088614740308894e-01   +2.066918681443438e-01   +3.043334911232443e-01   +1.077771279093103e-01   +2.550217570286430e-02   +1.602938475456938e-01   +9.034065854232964e-02   +9.716566162063506e-02   +8.679357376872480e-03   +1.903309730851364e-01; +9.604211165353294e-02   +1.073511504847569e-01   -1.771046330562270e-02   +1.286597824920904e-01   +2.173486810296341e-02   +1.624347051763805e-01   +1.856621350377839e-01   +9.294506515921547e-02   +1.480330279490933e-01   +4.734764852599566e-03   -1.381971787287077e-01   +3.748650072730531e-01; +2.529198577931753e-01   +1.431406381788545e-01   +2.235699522385665e-01   +1.036459867386322e-01   +1.521521282037781e-01   +6.633088065683898e-02   +1.682234583088570e-01   +1.674418970840933e-01   +2.568019720288990e-01   +3.943072391575313e-02   +4.051881218109966e-01   +3.213170886967983e-01; +2.511484397489718e-01   +3.390200053890466e-01   -1.197150302991153e-02   +1.462736441263649e-01   +2.702764789294235e-01   +4.550761871906514e-02   +1.067428322058590e-01   +6.906442629357094e-02   +6.795275182109581e-02   +5.500347175587846e-02   +9.863244752203672e-02   +4.181444019789389e-01; +9.937228582684192e-03   +1.030445268797349e-01   +9.810182156737844e-02   -1.357835925642829e-02   +3.037663135984215e-01   +1.281722902959437e-01   +8.488414014650018e-02   +1.639934920138898e-02   +5.385414869110164e-02   +2.811050331866651e-01   +3.152743533364583e-01   +1.684166955853735e-01; +2.183846304557424e-03   -1.906932621613349e-01   +1.233621448036585e-01   +2.541648279490683e-01   +1.420968222633743e-01   +6.152745915570364e-02   +1.519917088195264e-01   +1.569369424002474e-01   -1.602332109238334e-01   -7.072654884948633e-02   +2.123237396655679e-02   -1.893815828477056e-02; +1.863333631052815e-01   -1.857876418615042e-01   +6.871976253871673e-02   +2.475299902397768e-01   -7.590738521283608e-02   +2.234067928781519e-01   +1.651773291375996e-01   +1.991353204143685e-01   +2.632710236233282e-01   +1.696858078605948e-01   +3.588042101312002e-01   -1.841460484850167e-02; +4.892706725514770e-03   +2.322357661541594e-01   +2.269210402722864e-01   +4.086265267197713e-02   +3.302264062990320e-03   +6.020482581590218e-02   +3.416414120159275e-01   +9.790737767824256e-02   +5.252803450436275e-02   +7.831012668403253e-02   +1.386831119085569e-01   +6.590477418024709e-02; +6.603495390754832e-02   +2.114284523281378e-01   +3.241803845998891e-01   +1.939272827297274e-01   +2.415143095051766e-01   -1.380531997216607e-01   +1.921121938704972e-01   +3.068124736562565e-01   +2.400248063318019e-01   +4.694922201026343e-02   +1.836411249319399e-01   +2.456211813599500e-02];
L3E_L3I_iGABA_netcon = [+3.983387114772630e-01   +1.929847677521933e-01   -2.967035047753151e-02   +3.752132692377916e-01   +6.418226600194683e-02   +9.118267761594792e-02   +1.860843839271640e-01   +6.628901075503511e-02   -1.687363582343735e-01   +3.529757805071050e-01   +3.233615251801389e-01   +2.576952915795567e-01; -1.398811480735587e-01   +1.220162621149601e-01   +1.730814996385950e-01   +1.557088567863305e-01   +2.062115151599824e-01   +1.828657009288583e-01   +3.081868914077724e-01   +2.122134160077097e-01   +2.107087004981307e-01   +1.410846310165645e-01   +3.065358043796606e-02   +2.597093172231681e-01; +1.425831025602241e-01   +2.939231298398434e-01   +1.759208656040326e-01   +1.757782890284890e-02   +1.495022023819057e-03   +4.318078295829680e-02   +1.353408560964042e-01   +1.912802388791255e-01   +2.990792641276495e-01   +5.319089484592299e-02   +3.505870863538731e-02   +8.947113253763232e-02; -8.345098337679439e-03   -6.493405647488446e-02   +1.080535774420554e-01   +1.212394225264464e-01   +9.599680685852702e-03   +2.294643480174211e-01   +9.401795609316820e-02   +4.100002846322710e-01   -2.336378543002871e-02   +1.130554590209260e-02   +2.128121621808622e-01   +1.358293996555142e-01; +8.865286840793982e-02   -1.349863893667693e-01   +3.547868777641641e-01   -1.852024570914965e-01   +2.265448821055634e-01   -1.457267926984019e-01   +2.734433530555422e-01   -2.468895184056621e-02   -1.018882665086399e-01   +1.442099087249528e-01   +5.037992215807556e-02   +4.774274181587784e-02; +1.116096759937106e-01   +1.535594365929876e-01   -8.062137502970446e-02   +1.997599376952960e-01   +1.534740345662974e-01   -4.674320215520433e-02   +1.534276270072690e-01   +2.953102634340780e-01   -6.033549971035151e-03   +1.091869139469608e-01   +8.036734539324299e-02   +2.000340448676715e-01; +4.940703611739536e-02   +2.222366491765236e-01   +3.267489260004517e-01   -5.124838247249388e-02   +1.684253150155123e-02   +7.696046097277577e-02   +8.724343941117954e-02   -3.113539762173093e-02   -3.134975985409379e-02   +1.184742736690551e-01   +2.251681396552257e-01   +1.842989530621897e-01; +1.059934991940533e-01   +8.316827649008235e-04   +2.208148526992744e-01   +8.779977942935786e-02   +4.130678153644483e-02   +2.010963197081574e-01   +1.969288535846694e-01   -1.084001807774109e-01   +1.633865161810300e-01   +1.688557694375811e-01   +8.028712390542861e-02   +2.122721836190151e-02; -1.404983291892523e-02   +1.618835164256067e-01   -2.752732494140459e-03   +1.034095608714773e-01   +1.926542136958982e-01   +9.284684707479193e-02   +9.051490052228668e-02   +2.622770345574200e-01   +1.295592562959064e-01   +1.208083861263136e-01   -1.074112891696840e-02   -7.722484582369780e-02; +1.605569602867942e-01   +3.992851819261084e-02   -1.199377129048447e-01   +1.641848101318302e-01   +2.734655487215544e-01   +2.319958535296053e-01   -2.704176081523115e-02   +9.146011681204656e-02   +3.806803641308842e-02   +3.038614137045966e-01   +6.925897245670463e-03   +3.743513899510660e-02; +1.048449248614061e-01   +1.313685747593324e-01   +4.931848458906125e-02   +5.413915909114050e-02   +2.070276985238469e-01   +2.192502463409899e-01   +2.114762288668439e-01   +2.994463141944393e-01   +9.823742490798155e-02   +1.989465519393881e-01   +1.163111697028129e-01   +6.672939366696905e-02; +9.643505873922020e-02   -4.299429516074023e-02   +1.601857670664795e-01   +2.756023795181762e-01   +1.210017164723396e-01   +1.012063284286739e-01   -5.772594284142202e-02   +1.461232727702214e-01   -1.220587672366056e-02   +2.230139671791375e-01   +2.373951914751434e-01   +1.611424774836566e-01];
L2E_Input1_iAMPA_netcon = [+5.143446690414629e-02   -1.832131310026811e-02   +5.578461052122000e-02   +6.441374456800610e-02   +2.861941306227584e-01   +3.232808277762775e-01   +1.793754201160982e-01   +2.127814969817347e-01];
L2I_Input2_iAMPA_netcon = [+2.950524762061557e-01   +9.423449857496805e-02   +3.225182688811732e-01   +2.669268221683319e-01   -1.380449170014735e-01   -6.716830905617333e-02   -1.473078449139115e-02   -1.340449787491478e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
