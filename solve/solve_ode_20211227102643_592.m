function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.684188942488072e-01   +2.191076258618616e-02   +1.550991419881812e-01   -2.724379449439661e-01   +1.904869024749129e-01   +1.834636271249317e-02   -2.015358658466939e-01   -7.585386634518368e-03   +1.314545567910263e-01   +1.241357872954115e-01   -1.425839200895574e-01   +2.732911402146139e-01   -3.042061475162193e-01   -4.252743423245649e-02   -2.208672039884963e-01   +2.487832244798102e-01; -3.141193100709098e-01   -7.651448897925546e-02   -1.242567013343467e-01   -3.217344248022488e-01   -1.007134517156236e-01   +3.454118241076252e-01   -3.544411515610546e-01   +7.885041672989788e-02   -1.138343532893618e-01   -2.933545868796585e-01   -2.687528748484211e-01   -1.205120177800072e-01   -1.703862832655529e-02   +1.083871668046874e-01   +2.688976168644188e-01   -2.435843524453603e-01; -3.299052441466613e-01   +1.717302392553990e-01   +9.120597700100831e-02   +1.382062823382676e-01   +6.786449309607120e-02   +1.419207321603086e-01   +1.413917138405185e-01   -5.745257636619427e-01   -6.368292175062093e-02   +9.242092136847432e-02   +1.673483005577251e-01   -9.322343757323270e-03   -1.587512150546108e-01   -1.760791984130327e-01   +1.678118407299524e-01   -2.970559256086696e-01; +3.307031275955330e-03   +4.249390661220279e-01   +3.094138108284621e-01   +1.651081864903216e-01   -4.174038021978937e-03   +1.354668543813443e-01   -2.624495177600819e-01   +4.226080291503728e-01   -3.280809381661581e-01   +7.600451842135926e-02   -1.578669703093988e-01   -4.364369421320477e-02   -4.752909585698399e-01   -9.791113640466974e-02   -5.045313458549988e-01   -1.609099618740347e-01; +1.798087224352818e-01   +1.821148720934765e-01   +2.059412909494304e-01   -1.652476866415215e-01   -3.195001352274283e-01   +3.523236601043384e-01   -3.205670740841250e-01   +4.786655198133835e-02   +1.959633879115915e-01   +3.272241136984822e-01   +1.694661968707301e-02   +1.316024806658844e-01   +2.908806493361327e-01   -3.587542313595318e-01   -1.604404099516131e-01   +4.974222180325527e-02; +2.461590008716905e-01   +1.193292912881480e-01   -3.358424197079465e-01   +3.186539129199316e-01   +4.965991018810071e-01   -1.298810426320821e-01   -1.598659106974924e-01   +2.652385504140716e-01   -3.053529428273282e-01   +1.744930031834081e-01   -4.018415531753980e-01   +4.014407407383402e-02   +2.527502748696346e-01   +4.351127104579124e-01   -4.449601103133738e-01   +1.841508715354888e-01; +1.410859590743382e-02   +3.251089977822217e-01   -7.416368160588369e-02   +1.146534972564602e-01   +2.642493757522089e-01   +4.920899430725353e-02   -1.220149188186759e-01   +3.770041193071597e-01   +2.940175517092071e-01   +3.974467864112707e-01   +1.307256920556733e-01   +2.301764410995543e-01   +2.145020933298507e-01   +3.061494186492038e-01   +4.161642831036313e-01   -1.116427611233070e-01; -3.692808604137146e-02   +1.806078015318183e-02   -1.076222833936519e-01   -1.138351047998964e-01   +1.297771015508809e-01   +2.833273685234451e-01   -2.028211113446777e-01   -1.369647663669664e-01   +2.699123092381282e-01   +9.293391174823171e-02   +1.710922768655368e-01   +6.690137423084637e-02   -4.174324152441186e-01   +4.101312814035492e-01   -8.341296127817735e-02   +2.950365237013871e-01; -1.216133350593612e-01   +1.443688036329652e-01   -9.696111092177699e-02   +2.171823233587187e-01   -4.523735901074613e-01   +2.938784488044589e-02   -3.539819324237301e-01   +3.494982804232991e-02   -1.240562408715562e-01   -4.003200375571950e-01   -2.057050537628847e-01   -3.763912247575485e-01   -5.022280860404897e-01   +1.601120293343224e-01   -6.406242670034107e-02   +2.384761785539896e-01; +3.039990889117622e-01   -9.164221768683582e-02   +2.604994611490914e-01   -1.171716054887120e-01   -1.416358047241851e-01   -8.967554146551091e-02   +1.635235259641800e-01   -5.278810379008545e-01   +8.423565103926869e-02   -1.320316918696436e-01   -2.486276618989637e-01   +8.071522488627574e-03   +2.557731946344743e-01   -1.146241087716201e-01   -1.062596978893563e-01   +2.178727691307712e-01; -3.524412475177575e-03   -1.662157926320973e-01   -7.251294322765856e-02   +3.083177466690231e-01   -4.332844791897279e-01   +2.838218821724895e-01   -1.090630468339997e-01   -1.309510089680258e-01   -3.832983915380382e-01   -2.404781691682143e-01   +2.944890430083734e-01   -7.255990945814850e-02   +1.194348198279324e-01   -2.266996722988236e-01   -1.303097845267442e-01   +1.343993567329260e-01; -1.033558594819025e-01   +5.449672045895176e-02   -7.946678705654872e-02   +1.414688583245030e-01   -2.141190133058878e-01   -4.851296622516166e-02   -2.005221598981719e-01   +1.944104589581765e-01   +7.394597438986933e-02   +1.565112025281344e-01   -1.527563913999809e-03   -1.916727480909017e-01   -3.152823169567515e-01   -1.089055024214648e-01   -2.254917293163199e-01   -2.612579834405396e-01; -2.538815438142588e-01   +3.034921469123135e-02   +3.597668335412242e-02   +2.118853163904744e-01   +5.454639084379762e-02   +5.185837583156516e-02   -2.483875962148097e-01   -5.674219044390719e-02   +8.500983262089262e-02   -1.191457407925945e-01   +2.878974914782322e-01   +1.540467133155920e-01   +5.568568255554227e-03   -9.840837700120919e-02   -3.457904246990254e-01   +2.850236661780460e-01; +3.939152611250082e-01   +3.809435487989045e-01   +9.437270881046234e-03   +1.228974947789965e-02   +2.930834802721145e-01   -1.312514535340351e-01   -3.607601884844324e-01   +1.545724522406343e-01   -1.453845498072041e-01   +1.639639567959384e-01   -1.237791296576955e-02   +8.723825358909654e-02   +7.618606909921607e-02   -2.154323006007537e-01   -1.164004761844117e-01   +3.340404786822634e-02; +2.161595935268076e-01   -1.479037601406494e-01   -3.837415720955808e-01   -1.398899385881548e-01   -3.393430469923771e-01   -7.154041293000524e-02   -3.372657093115305e-01   -1.391751037935809e-01   -1.364138506022172e-01   +3.399579144701269e-01   +1.861547915999814e-02   -2.281729269607143e-01   -2.209403095944047e-01   +4.195833754452719e-01   -2.757112688793639e-03   +1.256778771255980e-02; +2.291806547626109e-01   -5.570838900769367e-02   -5.725201336787859e-02   -2.367354492384346e-01   +1.999710116943338e-01   -1.680674139339870e-01   -1.998763011090857e-01   +2.131300446433766e-01   -4.745129130360459e-04   -2.904348491711161e-01   -3.767047104679365e-02   -1.694560988553094e-02   +4.318548616102318e-02   -2.246556563740205e-02   -5.431408972741942e-01   -9.389413916218095e-02];
L1E_L1I_iGABA_netcon = [+1.786742965632934e-01   +8.507379260857637e-02   -4.547037092472134e-01   -9.669320946099526e-02   +2.206009954789781e-01   +4.435497371540090e-02   +9.758454912902682e-02   -2.646388123297622e-01   -4.056930489566783e-03   -2.041521498592994e-01   +1.106628057434872e-01   -1.582884322477128e-01   +3.391730975745649e-02   -4.529570789131211e-01   -2.009909589264124e-01   +2.072792066187829e-01; -2.861115731471482e-02   -3.201343788059605e-02   +1.969292360425855e-01   -2.928939097520257e-01   -7.477874390629397e-02   -1.879727888605111e-01   -1.967257349551204e-01   +3.305192701817293e-01   +1.027601311388886e-01   -2.984212404167372e-01   -3.070499988532820e-01   -3.383338631056541e-01   +3.288846439410431e-01   +8.784914511203350e-02   -3.269558771084278e-01   -1.668400652971875e-01; -2.325345540792189e-01   +3.409758979297921e-01   +7.316261164003901e-02   -2.183997021975517e-01   -2.872388593119918e-01   +1.092437167009006e-01   +3.853775340024963e-01   -2.541493276580347e-01   -1.388791527937878e-01   +2.024751580393062e-01   +3.114762973312806e-02   -2.264250579775230e-01   -1.270233438065138e-02   -1.031879034835844e-01   -2.690682183795706e-01   +6.284268374770280e-02; -1.957940774455049e-01   -2.071775996584244e-03   +5.212422263769019e-02   -1.076886244470802e-01   +2.082266463397824e-02   +1.946569481760432e-01   +2.224483687436266e-01   -3.455170935624890e-01   -2.118777332483284e-01   +7.157407754157463e-02   +2.572960983874282e-01   +3.502982512377871e-01   -7.070294349385566e-02   +1.972879064895689e-01   -2.066678300735157e-01   +1.418591983120670e-01; -1.251669921616566e-01   +2.415550215346046e-02   -2.389008387347675e-01   -2.440440475560648e-01   +1.139636730985219e-01   +8.442543620176299e-02   -1.091923238656759e-01   +2.996442483779398e-01   -2.554611400000127e-01   +3.434475089466896e-01   +2.746739083061610e-01   +4.439174131654089e-02   +3.615492855416647e-01   +3.626618956760213e-01   -2.888842658528309e-01   -9.110344300944967e-02; -1.935610935889048e-01   -2.795596292782132e-01   -1.777062691019383e-01   -1.099652761954176e-01   -1.958932355462397e-01   -1.799914165333182e-01   -2.230689697113617e-01   -2.250310271078682e-01   +3.690323948933497e-02   +7.727666034517781e-02   +4.280506146252170e-02   +1.437728689020727e-01   +5.535497492389741e-02   -3.345282939381303e-01   -2.927080336314677e-01   -3.370174185327232e-01; +2.227201755755500e-01   -3.347451045635291e-01   -6.157236112687822e-02   -4.096784013959621e-01   +6.467734962219283e-02   +1.294647315480792e-01   +3.173527476194899e-01   +1.733648515227238e-01   +1.152602929684735e-01   +1.263306347474474e-01   +2.331566468989443e-01   -3.493635644740592e-01   -3.273961854800736e-02   -2.680587849702196e-01   +1.965083349721876e-01   -1.894153334004728e-02; -3.125223124113118e-01   +1.837114139467811e-01   -4.978653761873733e-02   +3.789520430437319e-01   +1.208979551956830e-01   +1.059621276843227e-01   -7.380896967503456e-02   +1.179626956897110e-01   -8.225289138517125e-03   +4.220157522565759e-01   -2.229236482352528e-01   -5.586959428264114e-02   -1.754306526784019e-01   -2.242384450757498e-01   +6.560805689409341e-02   -1.833378776018163e-01; +1.740984597577330e-01   -5.391731172620404e-02   -1.645548546293695e-01   +3.818440750675417e-03   +1.967570204459581e-01   -2.155296914219597e-01   +2.147275782525421e-01   -4.202463835033904e-02   -1.800092733712766e-01   +3.092090504554201e-02   -2.066018230312161e-02   -1.121003898255197e-01   +1.477959101982796e-01   -1.694607656681520e-01   +2.069698208919720e-01   -6.206219781802282e-02; -5.503397552558062e-02   -1.801037874324503e-01   -2.130866329782132e-01   -1.716060033141033e-01   -8.192223106573342e-02   +3.323118052534226e-01   +3.130414413830964e-01   +1.189205808280173e-01   -1.516175818944806e-01   -1.815976835073421e-02   -1.742030933622131e-01   +3.482582397314475e-01   -3.251335942386885e-03   -4.242443998713939e-02   -4.719158161856554e-02   -1.821453544648971e-02; +3.981953826887137e-01   -3.579783646502836e-01   +5.874056286957090e-02   +2.593802040513026e-01   -3.382749677520080e-01   -8.097921584604817e-02   -5.319991109892820e-01   +6.705886170768047e-02   -1.621811577624585e-01   -2.204402351616684e-02   -3.443076057280161e-01   -2.984298414677071e-01   +1.468732849063736e-01   -2.695721323690002e-01   -1.031599051642393e-01   -2.738137520311349e-01; +3.179035671222535e-01   -4.741587554558661e-01   -2.896741709791616e-01   -1.408734852972702e-01   -9.828254220982491e-02   +2.076049159327265e-02   -9.949087093909448e-02   +2.840025254937207e-01   +7.553522238797385e-02   +3.569467496000781e-02   +6.444215204562681e-02   +1.194796166131269e-01   +3.020181049842655e-02   -1.258564198274677e-01   +3.543800382636578e-01   +1.588797571763305e-01; +1.418860944951560e-01   -2.593275604243347e-01   +2.515907402629397e-02   +7.275529125739578e-02   -3.413040880440005e-01   -3.406566048220412e-01   -1.253278137850816e-01   +2.964550978690631e-01   -6.292006191006965e-01   +2.270366933951972e-01   -2.736263279682954e-01   -5.012189871718901e-01   +2.453610033361117e-01   +1.496771720419855e-01   -1.073453922774213e-01   -4.110252280026967e-02; +6.975397536630404e-02   -1.870378069525607e-01   -9.582865979871263e-03   -6.066862475512616e-02   -3.594881154853282e-01   -3.776375340798002e-01   +4.619353557847319e-02   -2.202647940771739e-01   +2.568884554610558e-01   +4.001371687678477e-02   +8.166103570715839e-02   +1.856722873043192e-01   +1.999948849294762e-01   +9.623544388658892e-02   +7.380116616174767e-02   -2.375831828246981e-01; +1.033800702833578e-01   +1.264162626383366e-01   -1.432620189876683e-01   -1.660940243110918e-01   -4.191195143230936e-02   +2.954695839967427e-01   +2.344267507610120e-01   -6.309877023725133e-02   -2.289800163639741e-01   +7.113990200912562e-02   -1.722029914915927e-01   -4.708540376367192e-02   -8.597544846660053e-02   +3.193654716099831e-01   +2.083155817678085e-01   -5.646752995942331e-02; -2.264812455484060e-01   -5.308605498768950e-01   -3.558507489999341e-01   +2.856676262041912e-01   +1.217871027806770e-01   +9.603895631921569e-02   +2.977368806613548e-01   -1.387934635523965e-01   +1.840618896289470e-01   +1.447380888021726e-01   +3.259942707088833e-01   +2.757982278379814e-01   -8.925866465753882e-02   -1.433123504153871e-02   -3.847539318286582e-01   -1.610574800521977e-01];
L2I_L1I_iGABA_netcon = [+8.567230504270122e-02   +3.684138584909408e-01   +4.460567590599206e-02   +9.119358590583720e-02   -2.339615617204107e-01   -1.735982754949376e-01   -4.503594793675830e-02   +7.465055697322746e-02; -2.076790962523322e-01   +8.219727357645590e-02   +1.178225646796478e-01   +2.723242773244878e-01   -2.979447960105321e-01   +7.478738558767642e-03   -2.587985649638923e-02   +1.664929251496881e-01; -2.827861182860645e-01   +4.357254380427340e-02   -2.952546858534116e-01   -2.575722617613719e-01   -8.414727046275446e-02   -1.577799431086144e-02   -1.844635950362271e-01   +1.447834368131488e-01; -2.401547173388692e-01   -1.601021903455514e-01   -2.045920355683694e-01   -1.744470062866482e-01   +1.960784048360467e-01   +3.650401954917258e-01   -3.380151489108357e-02   -1.193007130845053e-01; -1.935549685107511e-02   -3.291921082335008e-01   +1.038668305289882e-01   +2.004248309657015e-01   +8.503991036148548e-02   -3.994916331444666e-01   -2.198525625360714e-01   -4.925693029268398e-01; +4.193074353624122e-02   -1.568071490610660e-01   -1.615368615276586e-02   -9.760212093194884e-02   -3.725031539786776e-01   -2.785803038467161e-02   -5.346305844994295e-02   -1.234774337220754e-02; +1.363956106678752e-01   +1.305712741018262e-01   -1.514011365238355e-01   -5.096706565303282e-01   -6.857764615307207e-02   +4.631297105507862e-02   +1.537675305770529e-01   -1.142441207071056e-01; -1.067485486567797e-01   -7.869505821688932e-02   -1.118907548005427e-01   -1.841502166596606e-01   +3.347122207595835e-02   -2.343684862300774e-01   +3.795629619882689e-01   -3.769790794780176e-01; -1.472178777159887e-01   -3.396404411912604e-01   -1.213204632040737e-01   -1.908715609581016e-01   -1.933505713745032e-01   +8.509999181378611e-03   +2.965905310614915e-01   +2.420485053365673e-02; -7.264283455624994e-02   +1.165748413096298e-01   +2.435201850794021e-01   +3.932299772253858e-01   +1.631445442205932e-01   -6.765886506974267e-02   +1.911169648896488e-01   -5.601272341312721e-02; +2.800777730439330e-02   -1.557517888846304e-01   +2.611708358556664e-01   +2.138443644362751e-01   +1.372272601255347e-01   -7.481660918480992e-02   +1.442733115680678e-01   +1.401906738997881e-01; +1.959560366034216e-01   +1.110066538067952e-01   -1.289134887736261e-01   -2.887109676170794e-01   +3.255565541234641e-01   +3.165395826611295e-01   -9.475708548406980e-02   +3.393131738525941e-01; +3.572041117158128e-03   +3.663568499673325e-02   +6.927613984505286e-02   +1.222441134441697e-01   +1.504389654883593e-01   +1.747731114574527e-02   -3.888303181188774e-01   -9.288168823902826e-02; -4.348465819537814e-02   +1.022761140725060e-01   +3.282720802654222e-01   +4.860585708456019e-01   -1.744892789575654e-01   -1.516587952958752e-01   -6.394450241873753e-03   +9.930407198968400e-03; -2.277942319384216e-01   -2.003284546768425e-01   -3.111703595669306e-01   -2.180473039150626e-01   -1.913459076094028e-01   +2.882821883944083e-01   -2.844803953368466e-01   +2.028532086638327e-01; +5.067021897438337e-03   -2.640475923628803e-01   -3.052546113473382e-01   +1.998080577208627e-01   -2.758030017048384e-01   +1.870198534525381e-01   +3.689343726264468e-01   -2.169540563718355e-01];
L1I_L2I_iGABA_netcon = [+1.975344277461260e-01   +2.979013087678900e-01   -1.593766938803551e-01   -1.531688939645096e-01   +3.275345829089695e-01   +5.020110417737002e-02   +6.541541169004089e-02   -7.399341043552105e-02   -9.836487864938659e-02   -3.366872156255264e-02   -1.302724742024844e-01   -1.267729381560613e-02   +1.981559735207785e-01   +2.801444084081692e-01   -1.051484766118119e-01   -4.173898617135811e-01; +2.780523382807338e-01   -3.616435942043043e-02   +8.900068586772032e-02   +4.113973448589514e-01   +3.575938371421497e-01   +1.613608472806161e-01   -2.540390138350309e-01   -3.889431977963423e-02   -3.266317935601586e-01   +3.113467608960514e-01   +9.467430007897805e-02   +2.591389853494183e-01   -1.992530247450984e-02   +3.678966257030611e-03   +2.035868551443877e-01   -2.329281323516099e-01; +2.864242485447443e-01   -8.215006104758665e-02   +1.471143126829227e-02   +4.127541710842529e-01   +2.515284927346186e-01   +4.163758383682265e-02   +1.804153922505001e-01   -3.099888856583660e-01   +2.186430968318225e-02   -2.922585353763868e-01   -5.190037668872607e-01   +6.049152942779049e-02   +1.837413547942531e-01   +1.282033528977339e-01   +2.056686662952502e-01   -2.295688331482762e-01; +9.807846240512286e-02   -2.053003131952574e-01   +2.766763286058555e-01   -8.744311313351710e-03   +2.191112921238106e-01   -9.913159577783628e-02   -1.709992664816827e-01   +1.943238090882922e-01   +1.379209115185444e-01   +2.894184198470559e-02   -5.167546335823747e-01   -8.212201867574834e-02   +3.869551771368133e-01   -3.817368776268074e-01   -2.566528011276458e-01   -1.714377406151229e-01; +1.097676793990009e-01   +3.082853342561468e-01   -2.987943500056540e-01   -3.837207637134242e-01   +2.040511662161298e-01   +3.080891854343434e-01   +2.052307773208657e-01   +5.426419204832245e-01   +9.239041355908889e-04   +2.113696102206372e-01   +1.685101118096783e-01   -1.100947398076319e-01   +1.848702186278593e-01   -3.009631881249760e-01   +2.816039737428370e-01   +1.513870292490383e-01; -9.794365369160826e-02   +3.554745789266175e-01   +2.824270437704732e-01   +1.215579158394919e-01   -8.329248696207137e-02   -2.580578294173355e-02   -2.490456243398952e-01   +2.532495019941657e-01   -9.501655289154498e-02   -2.189853822767907e-01   -3.093559947727353e-01   +1.994138331332447e-01   +1.314672746323617e-03   +2.700372587258345e-01   +1.947029783396156e-01   +7.068700092148487e-03; +8.297811016627044e-02   +4.540506623828738e-03   +4.503500664106992e-03   +1.954230966532786e-01   -2.322061384750235e-01   -1.984784830975467e-01   +2.129602129522759e-01   -2.574037939277692e-01   -1.155718412606821e-01   -2.188618928375738e-01   -7.333010569278346e-02   +1.039733490502273e-01   -4.182794339991130e-02   +1.671867715750050e-01   -1.250221476683941e-01   -3.033957392281044e-01; +2.220237257004226e-01   +1.419021151778742e-01   +2.272177026808516e-01   -4.320332610206316e-02   -3.770545445588345e-01   -2.567017079852531e-01   -9.684927045743101e-02   -1.032620569392091e-01   +5.051684815466791e-01   -3.130910934009141e-01   -3.286091675368182e-01   +2.291764897815664e-01   +4.515475626239509e-01   -5.344807184196956e-02   +4.117183970411463e-02   +1.478487998177204e-01];
L2E_L1E_iAMPA_netcon = [-3.487927243884845e-01   -2.406903240872079e-01   -6.720874433903146e-02   +2.199978471152126e-01   -2.907720805669173e-01   +1.591871675021125e-01   +2.848418834032184e-01   -3.903420925632080e-01; +2.219616538299935e-01   +8.707979366319837e-02   -3.949079696738288e-01   -3.830886607522104e-01   +3.521418650038952e-01   -7.647924311759149e-02   +3.632159364363188e-02   -1.142219520297222e-01; -2.573454219747195e-01   -6.834371157736047e-02   +3.484451553863008e-02   +7.913875815025702e-02   +3.375223352938865e-01   -9.923438034123683e-03   -2.046926118945749e-01   +1.325442224625712e-01; -7.325714170718363e-02   +9.298504698477474e-02   -2.678746956841790e-01   -1.983881176638709e-01   +6.472390539799255e-02   +4.182793230677511e-01   -3.690144579273925e-02   -4.267661529100319e-02; -8.401175028128371e-02   +1.455232259648684e-02   +5.709324340743568e-02   +1.585488578460755e-01   -3.930103677267435e-01   +2.347006920401164e-01   +7.704451431971657e-02   +5.554338120095044e-03; +7.786745952052662e-02   -2.822321028381314e-02   -1.010890669995406e-01   -8.934989976084666e-02   +4.955490713042834e-01   +3.109599541796864e-01   -3.296178268044336e-01   -2.470154525419968e-02; -6.511869524747989e-02   -1.512864138566567e-01   -1.136007034368106e-01   +2.549728048289661e-01   -1.873821861129818e-01   +3.976578236210164e-01   -1.216343177850897e-01   -3.738859827930845e-01; +5.542878596195565e-02   -2.639328315460258e-01   +1.630485040066522e-02   -1.285591881315178e-01   +2.539640799197043e-02   -9.570620671089103e-02   +1.310381691591900e-01   +5.282395875033459e-02; -2.088761823291010e-02   -2.194111046242446e-03   -3.180182664104587e-01   -3.350171321520048e-01   +4.497533234446018e-01   -3.415445996955788e-02   +1.164120772883218e-01   +3.060243541431836e-01; -4.428995528402237e-01   -7.051622096607425e-02   +3.106288223130128e-01   +3.296558019774740e-01   +3.404355233958092e-01   -4.174921704026575e-01   +9.003838619383302e-02   -2.070531937514277e-01; -1.578398068467535e-02   +3.202610599207412e-01   +2.201641234454707e-02   -3.458357293035988e-01   +4.397344858953967e-01   +2.793759537529997e-01   +2.668107026599491e-02   +2.329393325871149e-01; -9.525755506328767e-03   -7.871912149896342e-02   -6.538725531046749e-02   +1.029992316095410e-01   -2.336153402357433e-01   +3.046429951081516e-01   -6.523859057201084e-03   -3.393087421436674e-01; +9.380720853228293e-02   -1.643533556547817e-01   -2.626193685357857e-01   -4.879159234784294e-02   -6.286009071060758e-02   +2.430066604045134e-02   +4.659975496626393e-01   +2.996764542750433e-01; -2.011059882019473e-02   -1.299873568526737e-01   -1.860511368711238e-01   +3.944173202777212e-01   +2.391580247149166e-01   -3.545977124218268e-02   +2.255724742713615e-01   -2.029829505778058e-01; +3.512307436207411e-01   +5.751176995417294e-02   +2.081063953573534e-01   +7.712571562669940e-02   -7.668083199116771e-02   +2.271375996163718e-01   -1.945689492094141e-01   +2.063270880818826e-02; -6.258049643804969e-02   +1.077273916731140e-01   -2.776765323562544e-01   +1.618147010253273e-01   -5.025409286899911e-02   +5.236744782080582e-03   +1.749772585996912e-01   +6.370852021116337e-02];
L1E_L2E_iAMPA_netcon = [-1.241526475721462e-01   -2.605144339782637e-01   -4.472741071893583e-01   -4.345958016913783e-01   -3.877463152162671e-01   -2.299230526634778e-01   +2.527691181112339e-01   -6.911026513323112e-02   -2.895449018557031e-01   +2.230937713732005e-01   +1.334170466670628e-02   -7.154687183046343e-02   -1.117960247384768e-01   +1.030577913114321e-01   +7.054143890694134e-02   +1.914610275513545e-01; -3.071491288929830e-02   +7.479803935378659e-02   -9.529700845677266e-03   -8.696760710721718e-02   +1.758426679134424e-01   -3.677063167233471e-01   -2.824908555051965e-02   +4.502824324100788e-01   -1.336951332318516e-02   +4.476132810359890e-01   -2.243402614009363e-01   -2.895210233921187e-01   -4.503795479450405e-01   -2.310199139745368e-02   -6.424266445026930e-03   -2.550155997620841e-01; +2.565992315668569e-01   -6.489620462467910e-02   -5.741400552906420e-02   +7.542076331004435e-02   -4.162572756878803e-01   +4.742361894897960e-02   +1.608908156437156e-01   -2.140801246758873e-01   +2.574122343005348e-01   -3.393272343505674e-01   -1.765513278932802e-01   +2.597133173238833e-01   -2.040346663970007e-01   -2.026741308262575e-01   -1.398837389533667e-01   -8.416181088588447e-02; +1.749623922951113e-01   -3.383592037024772e-01   -1.138432430515213e-01   +2.270004499026627e-01   -5.214833663048886e-01   +2.485604306749065e-02   +2.376524757869178e-01   -2.369755063386476e-01   -5.668478841601347e-02   +1.300491707327020e-01   -3.668138949306016e-02   +1.130896703574103e-01   +2.180591740207827e-01   +6.064256290745583e-02   -8.777070206509588e-02   +1.219455163699069e-01; +4.274690254111545e-01   -6.726224112975643e-02   -2.196433551267121e-01   -2.169452878841406e-03   +9.474550242681679e-02   -8.285042384357684e-02   +1.604096190350844e-02   -4.395118149851807e-02   -1.167981584116756e-01   +1.276906363371064e-01   +1.722553012452550e-01   +2.519222903496525e-01   +2.648394323958588e-01   +5.092586006920216e-01   -1.777215569790864e-01   -7.587749462859299e-02; -1.370021881327795e-01   +1.548766447746425e-01   +2.210082347298715e-01   +1.200656680635219e-01   -1.296012928573111e-02   +2.469411358227364e-01   +2.589741235770631e-01   -1.723224897105912e-01   +3.531092736360985e-01   +1.657783143462321e-03   -8.846660150869087e-02   +2.283885446048702e-01   +2.065636111161122e-02   +1.790673186060625e-02   +2.525469071123635e-01   +2.505825070459395e-01; -9.483060816685343e-02   -3.712896784321215e-02   +2.571602909163754e-01   +1.304617494497030e-01   -1.908581368392425e-01   -2.205828461450635e-01   -1.128225072212769e-01   -1.037973159695164e-01   +2.705402645712003e-01   +1.160524367060110e-01   +3.600383719304879e-01   +8.045381095203569e-02   +3.230722690493016e-01   -1.151056785104873e-02   -4.255797959821820e-01   -4.740097974317905e-02; +1.333317516448704e-01   +1.129460208889743e-01   +2.393635431383395e-01   -4.438495386025377e-01   -2.124413335978970e-02   -2.357726088835761e-01   +9.768853026026648e-02   -1.534419053426764e-01   -9.353769026772117e-02   -7.999615907953826e-02   +4.882311389749902e-01   -1.429080248644539e-01   -1.250914172736763e-01   +9.755599912307823e-02   +1.479181145175404e-01   +1.405437575525473e-02];
L2I_L2E_iAMPA_netcon = [+2.329587246761422e-01   +2.768605351030202e-01   +1.503250329196262e-01   -2.166443401141081e-01   -1.141998455374800e-01   +4.579225940251164e-02   -1.241079694682646e-01   +2.092525971124589e-01; +4.329486779752737e-02   +5.182843247453338e-02   -2.661972566708246e-01   -1.157430617158835e-01   +1.254059813611492e-01   +5.811460389524196e-02   -2.067445287196146e-02   -3.603645577155152e-01; -7.277911652554563e-03   -5.865269469524245e-03   -1.740106799424083e-01   -2.782340984059387e-01   -4.361211164305732e-03   -1.071662968972919e-01   +4.734225748261759e-01   +8.267782787575731e-02; +1.573389544245554e-01   +5.588152746007877e-02   +3.295819506156802e-01   -1.126317636839516e-01   +5.958237857734730e-02   +3.366811008964846e-01   -1.131250651608183e-01   +2.635781722710859e-01; -2.547987183610931e-01   -4.129849738315023e-01   -4.422811275829132e-02   -3.041082630864904e-01   -2.601564190369657e-01   -5.765321959042391e-03   +5.536847798930310e-02   +1.539758688497295e-02; -6.825416997505257e-02   +7.032706831641589e-03   -2.536244943885187e-02   +5.276458320503621e-03   -6.874724088532663e-02   +1.344345065099503e-01   +8.835663387395110e-05   +2.459607644804829e-01; +4.373649027480263e-01   -9.014028683653343e-02   +6.157751946524363e-02   -2.089965698370446e-01   +1.373144527819588e-01   +5.624882802137293e-02   -2.350281315016616e-01   +1.226467667734294e-01; -1.829332216195282e-01   +7.424893503840468e-02   +8.236242252444503e-02   -1.967501274863285e-01   -7.226851456545766e-02   +2.469954312036531e-01   +7.839391606481508e-02   -3.247254687243046e-01];
L2E_L2I_iGABA_netcon = [+2.538081793849012e-01   +1.358289945992331e-01   +1.854621824484289e-01   -1.015745345419368e-01   +4.441336800230090e-01   +4.729203658114502e-02   -4.486147284504028e-01   +5.233869965838015e-02; +1.566833115034612e-01   +1.971800338861290e-01   +2.727009897437350e-01   +3.552150990116933e-01   -7.401371356080412e-02   -2.869495378281143e-01   -4.963953306991332e-01   -4.028855517101693e-01; +4.581903417403083e-01   +1.374551326575529e-01   -1.053518756911848e-01   +3.656723564764631e-01   -2.842757556147611e-01   +4.053351452338703e-01   -2.991336644817870e-01   -2.718294250855646e-02; -1.966893704801031e-01   +2.044956552916691e-01   +1.030881490752199e-02   -1.737025912707540e-01   -2.030743904048932e-01   -3.268564598238438e-01   +5.911767877065248e-02   -4.970517843673614e-02; -8.714126224509011e-02   -4.124319491085965e-02   +3.231429042821808e-01   -6.245221510370355e-02   -1.187205920219214e-01   +1.507354554841969e-01   +9.679542521690834e-02   +1.366332198323239e-01; -1.294007753730913e-01   -1.247314006688499e-01   -2.283134566983756e-01   +1.580129872497943e-01   +2.451681736192791e-02   +3.188183049240765e-01   -1.428404749620615e-01   -8.924019797008292e-02; -2.706683808244466e-01   -1.635544343000664e-01   -2.613400171969957e-02   -1.235154143016362e-01   -1.261690077592472e-01   -2.356485861970118e-01   -5.184335549439203e-01   +7.938654013253713e-02; +1.545008385299151e-01   -4.002184874329159e-01   +1.614442266046151e-02   -2.458324162816927e-01   -3.686678254582861e-01   +3.289046704386266e-02   +2.384376348818588e-01   +3.178616202182556e-02];
L3E_L2E_iAMPA_netcon = [-2.337021911522136e-02   +2.120072895222844e-01   +1.126971850807630e-01   +5.719468153359059e-02   -1.384086261330938e-01   +8.391708846757169e-02   -7.077091842603020e-02   +3.253075699386747e-01   +5.818963356167988e-02   +1.999568183850622e-01   +7.618783602914345e-02   +5.120780942235924e-01; +8.851567883486272e-02   -3.978773726018639e-02   -8.277648476300536e-02   -1.842126345726091e-01   +1.132258425108144e-02   +3.206798288335458e-01   -3.741539841744682e-02   +2.441982593268974e-01   -2.086834555788546e-01   +2.165958983661694e-01   +1.850159898604056e-02   +6.084799181276124e-02; -1.922982062828093e-01   -2.595433033184052e-01   -2.633811739112722e-01   -3.146801754471559e-01   +1.763205597527084e-01   -3.979572226527082e-01   +1.447006625925759e-01   +3.546879508189864e-01   -3.052438661594479e-01   -3.216003654704214e-01   -2.920727905144671e-01   -2.158340044858722e-01; +3.142089292594848e-01   -3.508973671006562e-01   -1.496260535753549e-01   -5.570822936843613e-02   -4.830828358371632e-02   +3.057685865142608e-01   +4.576081685221020e-02   +1.510511245931085e-01   +1.703326813189676e-02   -2.997458028139904e-01   +2.274190873498650e-01   +3.410410225809222e-01; -1.481941122963271e-01   +1.980218055492016e-01   -3.679357290176638e-01   -1.088575208284236e-01   +1.891447361387654e-01   +4.890372562632815e-01   -9.766384908503289e-03   -1.630943960533829e-01   +9.963285003616873e-04   -3.016697812845089e-01   +4.349315228432074e-01   +3.531083096142414e-01; +1.906534755920506e-01   +3.028755835553273e-01   +3.318045489861491e-01   -1.328526785993078e-01   -9.163344839882115e-02   -3.333680520550532e-01   -1.117654264860888e-01   -3.307197114798601e-01   -2.189247051930413e-01   -4.621850952047455e-01   +1.489574991766777e-01   +2.197085890277513e-01; +1.452943450205927e-01   +1.794261410098684e-01   +1.908164627534888e-02   -1.374177857620831e-01   +1.129718052910185e-01   +1.193544768620064e-01   +3.126180087551261e-02   +2.974511831553862e-01   -1.493726115024962e-01   -2.521898108229414e-01   +2.251106050877311e-01   -9.075163737317332e-02; -1.025596143088249e-01   -1.305218149852440e-01   -3.475014483685779e-02   +2.643288488196590e-01   -5.382922048405745e-01   +9.037486123898916e-02   -9.667344887748207e-02   +4.877348898158385e-02   -1.046458294601335e-02   -3.551001133339968e-01   -9.407140583199483e-02   -2.688307557089308e-01];
L3I_L2I_iGABA_netcon = [-1.068270943383362e-01   +4.221349498270807e-02   -7.202881102007150e-02   -5.972143686321149e-02   -1.309436771104298e-01   +4.860778765536639e-02   -6.074953502698649e-02   +1.570233138453264e-01   +1.354789868622019e-01   +4.826049983549914e-01   -9.736837598249619e-02   +4.307293567978344e-01; +2.058939968206481e-01   -2.151391011302459e-01   -8.563843001917310e-02   +2.513617089057611e-01   -6.715887740739707e-02   +8.126453386569046e-02   -1.234729749104928e-01   +2.054381218875043e-01   +1.276590224055216e-01   +1.248000483697107e-01   -2.827226196726879e-02   +4.268657376028804e-01; -1.043304915704256e-01   -1.184644932348754e-01   +1.875289514614281e-02   -1.175956095994680e-01   +5.464323566093198e-01   -1.820974781427916e-01   +2.978256043536597e-01   -3.801811465779154e-01   -7.479687656456027e-02   +3.888572685420250e-01   +1.267342834473273e-02   -4.021412037464529e-01; +6.664073169157450e-02   -2.443967815844139e-02   +2.613563068033842e-01   +4.492835619087450e-01   -2.411958535687344e-01   +1.971753291588712e-01   -2.088354108440409e-01   -1.473578558419136e-01   -1.250934291840332e-01   +4.139818742773420e-01   +1.888693854375901e-02   +1.750445731532669e-01; +2.100016624293722e-01   +3.817624015879861e-02   +1.397591388702603e-01   +4.301752913637917e-01   +1.337445433431061e-01   -1.021961589101238e-01   +8.126579733565548e-02   +2.966368890633513e-01   +3.246482365822359e-01   +4.377290385152001e-01   -1.894553364852814e-01   +2.431125653812916e-02; -2.895581486830009e-02   -3.090278413046991e-01   +8.236505210929337e-02   +2.188650459836269e-01   +1.239122016020223e-01   -1.212101617642486e-01   -3.531479639212143e-02   +1.564348965380539e-01   +1.435839073396423e-01   -1.870216379956189e-01   -1.905275107847157e-01   +1.197125451665041e-01; +2.504124995811865e-01   +2.453232188130737e-01   -5.675346287671593e-02   -6.859337960566712e-02   +1.550440160478334e-01   -1.649417621631778e-02   +1.203938294422260e-01   +7.338891142491351e-02   -2.574740196145093e-01   -6.739475288859069e-02   +3.777901693948041e-01   +1.989490252246826e-01; -2.637319760886374e-01   -1.935358386880714e-01   -2.546503207133722e-01   -1.190687407176295e-01   -1.091966938112236e-01   -2.785083953877984e-01   +3.051716290280760e-01   -1.273515351800437e-01   -2.672812038400811e-01   +2.672017868157338e-01   -3.642589069112745e-01   -3.143152694475352e-01];
L2E_L3E_iAMPA_netcon = [-2.302111699863553e-01   -4.162180048072925e-02   +1.256272269113059e-01   +3.887483334491857e-01   -4.491296226503195e-01   -1.488580271488012e-01   -1.348473230996491e-02   -2.084735448361355e-01; -1.979013342105273e-02   +6.635989936647566e-02   -5.060635961014817e-02   -6.447457907845247e-02   +5.291137625265665e-01   -2.091173954262880e-01   +1.274758429685634e-01   +1.511535658780997e-01; -1.851783811862318e-01   +1.302002073540005e-01   +2.445428090887803e-02   +2.622150119953514e-01   +1.999670925833237e-01   -1.729083776381823e-01   +5.409685157240731e-01   -2.775646020244326e-01; +1.591245899486380e-01   -1.069341244654535e-01   -1.060017528271540e-02   +1.662913991590077e-01   +6.445289634946227e-03   +3.032568975948709e-01   +1.995611194824219e-01   +4.367463809901062e-01; -3.579757786661721e-01   +3.425792583168077e-01   -2.352188297726233e-01   +5.015828675949487e-02   +2.636089335239066e-01   +2.047233038681280e-01   -1.464560907057548e-01   -2.576580059041771e-01; +1.189230331364283e-01   +2.487664377025661e-01   +3.338567421339756e-01   +2.707014650032200e-02   -2.369770109082274e-01   +6.848075537490030e-02   -1.875317634274530e-01   -5.538372508638138e-02; +9.492425734027531e-02   +1.860162530673365e-01   -1.225624022105972e-01   -1.522120713063811e-01   +1.618033490097079e-02   +2.323384240121024e-01   +8.062455040402594e-03   -2.130753487310618e-01; +5.113599934345103e-02   +1.895820882159195e-01   -2.222540954590718e-01   -1.896512081544665e-01   +2.037391430277056e-01   +2.610977354636052e-01   +1.019827594154321e-01   +1.122142140204732e-01; +3.970553513485874e-01   -1.682247385047115e-01   -1.313516967098361e-01   +3.816444505615838e-01   +2.638729933847423e-01   +4.053157780069365e-01   -4.645974050058004e-01   +3.670156526783673e-01; +3.768050686526025e-01   +3.423857910506088e-01   +2.726596671306039e-01   -4.338817619254876e-01   -1.675716825264714e-01   -3.148385369342760e-02   +7.996725688706052e-02   +2.600207923354396e-01; +4.307993436286153e-01   -1.407835733018294e-01   +1.055535240998345e-01   -1.714191111653693e-01   -2.476771539249159e-01   -2.434456699092490e-01   -2.428291542669031e-02   +2.029197473920466e-01; +3.715576066350865e-01   +6.978687424970695e-02   -3.321161676691275e-01   -1.113937218672729e-01   -4.192456210826379e-01   -2.539415279067826e-01   +1.005158928949701e-01   -1.460860560481354e-02];
L2I_L3I_iGABA_netcon = [-1.417139400463110e-02   -2.386967393037357e-01   -5.169473282753739e-02   +2.488696087555204e-01   +8.706762418947965e-02   +1.011180424553391e-01   +1.038799712599315e-01   -7.815524326866394e-02; +2.688156155545326e-01   +3.484816332783319e-01   +3.948590143810361e-02   +1.306393327698109e-01   -1.736975993042335e-01   +4.289439906700281e-01   +3.735120855542263e-01   -8.339713836882751e-02; -1.080924534305149e-01   -1.273463595922664e-01   +1.836213070813258e-01   +2.553458838211237e-01   +3.018182975363066e-01   +1.258824367358604e-01   +3.308643494417766e-01   +2.165441084325070e-01; +3.813398782115097e-01   -8.013748520015582e-02   -4.012514728943460e-01   +1.637551969987497e-01   -3.182392128931676e-01   -2.039570118799157e-01   +9.028376787885262e-02   -1.423824196037095e-01; -3.162041285497753e-01   +2.267957031441679e-01   +2.589024728898027e-01   -1.846231987618661e-01   +9.546939758261522e-02   +2.602997337357227e-01   -1.297733049636480e-01   +8.977751070472498e-02; +2.316284461583818e-01   -3.497687085376220e-01   -1.856106351179550e-02   -3.972892282263191e-01   +1.630462138971137e-01   -7.670639425068981e-02   -1.401659866001232e-01   +1.068568256253586e-01; -4.162990880098492e-01   +5.535579230876347e-02   -4.225381924050687e-01   -2.913211495076699e-01   +2.020463663160978e-02   +2.773917734893736e-01   -3.179286638329754e-02   +3.948602783396371e-02; -1.821564297548708e-01   -2.108390545216619e-01   +1.249184841271899e-01   -2.323899377775996e-01   -3.060796388376179e-02   +3.746038680954558e-01   +1.027683318620188e-01   +2.399532173585626e-01; +1.150273349013369e-01   -4.052161699905407e-01   -2.937565794354173e-01   +3.065437624951642e-01   -2.545385537320826e-01   -2.810146256305011e-01   +1.463329900518466e-01   +3.865969611347159e-01; +1.540467637169950e-01   +9.758629326531826e-02   -2.572068344310619e-01   +3.347718973312839e-01   -2.824351570213809e-01   +5.693905897506710e-01   +1.692124363445262e-01   -2.914867160029913e-02; +5.208986222315098e-02   +9.762066861125579e-02   -2.445349061610605e-01   -2.845759059886008e-02   -2.496208762303933e-01   -2.953684657450276e-01   +3.964887940628494e-01   +2.548060103025628e-03; -2.425875480560786e-01   +1.208927938156881e-01   -6.172276352580455e-02   -3.047353684289450e-02   -1.096623094623686e-01   -5.825071099565740e-02   +2.013727149686723e-02   -9.526873199253938e-02];
L3I_L3E_iAMPA_netcon = [-3.779105942884178e-01   +2.081614721433409e-01   +2.264674374677740e-01   -1.293644630071490e-01   +1.616640353646643e-01   -2.657970860892904e-01   +5.676827332740410e-02   -1.500477424016180e-01   -1.994305645055235e-02   -2.927805139146183e-01   -8.294307631897863e-02   +1.082711836764423e-01; -2.610715918661725e-01   +1.944635291810674e-01   -2.651592257065473e-01   -3.486459139920439e-01   +8.141783141682984e-02   -3.337842648875723e-01   -2.912196146663267e-01   -1.937044552273819e-01   -3.563427740405356e-01   +3.408703917775185e-01   -1.038350319599132e-01   +2.945051529616669e-01; -1.046820362665822e-01   -1.665107377431958e-01   -3.633715775636101e-01   +3.304706584719907e-01   +2.713668345763963e-01   -3.473962432271389e-01   +3.124025310192539e-02   +1.120897273007490e-01   +5.121746163900306e-02   -1.891477200676175e-01   +2.392978525706328e-01   -2.417647400713466e-01; +2.408296372373074e-01   -1.813825582962881e-01   -2.193792184126215e-01   -1.488000061103484e-02   +2.551594775506590e-01   -3.228957486674753e-01   -2.159768874164265e-01   -4.144947766712979e-01   -1.639950555081709e-01   -4.340406049006229e-01   +5.240495507198676e-02   +1.258003166385681e-01; +2.855934524025255e-02   +1.857707688959750e-03   -4.590743779599425e-01   -1.624254038262637e-01   -3.212993607554104e-01   +1.032615530420481e-01   -3.782039826718089e-01   +3.163255708432878e-01   -6.006823552274522e-02   -1.196439832826992e-01   -6.013096840981855e-02   -2.651001160295397e-01; -3.046670177492684e-01   -2.255561110977339e-01   +7.571044842563104e-02   +2.951358390393343e-01   -8.890096273349782e-02   +1.806127159098128e-02   -3.712295239305241e-02   +2.993758776209842e-01   -3.716926127656136e-01   -3.191878953856550e-01   +3.003322675688343e-01   +2.001396853962168e-01; -2.023285764806179e-01   -6.271560454666933e-02   -2.658747255029086e-01   +4.877599502488555e-02   -1.139813389047052e-01   +2.981648590630666e-01   -1.497003474662288e-01   -2.072335561800384e-01   +2.890277845867069e-01   -5.514515509604133e-02   +1.460173240139975e-01   +1.454665780677570e-01; +9.954579350372772e-02   +5.603749576702618e-02   -1.185376393058695e-01   +2.492309475252971e-01   -3.104890691715226e-01   -2.448313478017899e-01   -1.921244492351204e-01   +1.589760262270274e-01   +1.965930822996053e-01   -3.597228678509379e-01   +1.227282781572903e-01   -1.014242420964303e-01; +1.459092711827777e-01   -1.225127605796035e-01   -1.441835367056304e-01   -5.608512191740882e-02   -1.248871189560148e-01   +4.717374380008660e-01   -1.642471761980510e-01   -1.970278033818086e-01   +2.618803287564415e-01   -1.529652305954879e-01   -2.432160128708381e-01   -2.678224153812821e-01; +5.235866824769703e-04   +8.768209048933209e-02   +2.586602105027038e-02   +2.066341972764638e-01   +6.269718881492157e-01   +2.474029305123541e-01   -5.772275469299250e-02   +3.359979845361277e-02   +2.107148916424835e-02   -6.191756714506444e-02   +3.074303728158184e-01   +2.241786312574709e-01; -1.153374900045545e-02   -3.332330882627159e-02   +8.495558641593189e-02   -1.118446844963406e-01   -1.476676378497986e-02   -9.116908053646286e-02   -2.070037605859330e-01   -2.735697217163886e-01   +3.189723097839646e-01   +2.676415491006782e-01   +6.116075177638317e-02   +2.881564146145201e-01; -1.599318463257304e-01   +4.606980067483415e-02   +2.609832348284036e-01   -1.265604830439582e-01   -5.993822235884011e-02   +2.940611911097075e-01   -3.280777326105132e-01   +1.152193501857776e-01   +8.684700961784905e-02   +3.685619337581925e-02   -2.169724942642017e-01   +2.327500537217010e-01];
L3E_L3I_iGABA_netcon = [+2.711263743218997e-01   -1.906216387329709e-02   -6.227757891802077e-02   +7.735171900164992e-02   +1.416519386700607e-01   +3.703556836629418e-01   -5.394496853117316e-02   +9.882659526708620e-02   +2.364159142034079e-02   +4.943329966489929e-02   +1.197037902394862e-01   +3.442860540805854e-01; -1.466138465171569e-01   -3.503974389570034e-01   -3.903941994966780e-01   +3.619381394241999e-02   +2.678975936579320e-01   -1.809060293213946e-01   -3.063978977974411e-01   +3.744806019699079e-02   +1.104168393431726e-01   +4.833849382461979e-01   +3.061935659324381e-01   -1.717203294079506e-02; -1.264568333954982e-01   +8.625033207797361e-02   -2.478871455152493e-01   -1.142420663444267e-01   -2.745411802617837e-01   +2.042114149234813e-02   -2.620691602851595e-01   +1.544540337187819e-01   +2.146759691195163e-01   +3.273674960188575e-01   +1.085458978211153e-01   +3.948314683827979e-01; -3.617511814346903e-01   -1.763469984638806e-01   +1.927639636785345e-01   +6.211626207502430e-02   -2.548669717567719e-01   -8.521330811504693e-02   -3.195235499409272e-01   +1.968729339647297e-01   -1.920346299384042e-01   -2.243844173648849e-01   -1.186132969232159e-01   -2.141612475630345e-01; +2.063254342243394e-01   +2.834499762024861e-02   +1.157972726842326e-01   -9.474280840290258e-02   +3.398835037655112e-01   -1.636736652437322e-01   +7.506633594039996e-02   -4.714419205626624e-01   -2.258514684832955e-02   -1.802407271981964e-01   -2.251265745831267e-01   -3.493737069215867e-02; +1.465563571702701e-01   +8.804809483361414e-02   -1.627116844390678e-01   +4.817112314898585e-01   -3.195870823961331e-01   +1.383995830011477e-01   +1.021539308514659e-02   -1.967174865806059e-01   +3.052869856971466e-02   -2.291445450712502e-01   -1.375008334886318e-01   +1.280401036081978e-01; +1.276495564594813e-01   -2.534074707725276e-01   +7.674247128505544e-02   -3.216543026567521e-02   -2.975320820454584e-01   +1.521423805742147e-01   +2.743253435538653e-01   +2.818406245898683e-02   -7.342591532206041e-02   -1.325823988876211e-01   +1.550816759170946e-01   -6.640544351471458e-02; -3.135135474533185e-02   -5.516811885746362e-03   +1.476197706715665e-01   +2.168367452093375e-01   +3.968695575089276e-01   +1.707914518747716e-01   -3.534815686331962e-01   +2.409653334754102e-01   -3.380426824104327e-01   +5.964548992434336e-02   -2.739354881889809e-01   -7.957466959401982e-02; +1.439674921905853e-02   +3.614063504896886e-02   +5.960531799498228e-02   -1.073915031761209e-01   -8.060376099703279e-02   +2.017321960967369e-01   +7.115870369185164e-02   +1.636507195519545e-01   +3.188484872554254e-01   -9.111302775868566e-02   +1.948269522708443e-01   +3.330718172014110e-02; +1.495538173665805e-01   -4.472798457523088e-01   +2.981889729868820e-01   +1.704143661110903e-01   +1.183622381916283e-01   +4.795958034855406e-01   -1.433579412728558e-01   -1.297881028486060e-01   -1.315243285491192e-01   +7.797917969049842e-02   +4.012559292359650e-01   +2.492933185410136e-01; -3.624095988421020e-01   -2.923633186135663e-01   -1.177601230718478e-01   +8.033144080806137e-02   +4.226025731595801e-01   +1.048909783225512e-01   +3.184844339065285e-01   -1.314261226126249e-01   -9.124847622788484e-02   -1.626572277927240e-01   +7.994266144296319e-02   -5.078369408196798e-02; +7.168208633876932e-03   +1.465082686414752e-01   +1.268487006560974e-01   -4.909768203457688e-01   +2.379474445723203e-01   -5.762598377162309e-03   -1.909040874038929e-01   -3.711172004819081e-01   +2.525656804434395e-01   -3.651090348603045e-02   -2.022309211223338e-01   -1.754589431268976e-01];
L2E_Input1_iAMPA_netcon = [-1.461612453745750e-01   +1.463609786130460e-01   +5.583288069372289e-02   -2.264315398694871e-01   +9.326286497684133e-02   +2.878426248443623e-02   -2.003575567682955e-01   +1.592743000762447e-01];
L2I_Input2_iAMPA_netcon = [+9.514670451583107e-02   -1.669527995469427e-01   +3.440660104551523e-01   -1.275368537187030e-01   -5.818122060662326e-02   +2.129613103363853e-02   -1.240199686885242e-01   -1.212380415242122e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
