function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.580572346647929e-01   +7.040809317428209e-01   -3.747034667288728e-01   +3.492163380896896e-01   -6.230493914504605e-01   +1.718223980204414e-01   -5.082245967660044e-02   +2.059819078131229e-01   +2.735109193928718e-01   -1.096197359515841e-01   -2.822706906473174e-01   -1.108878049655174e-01   -2.249869035988200e-01   -3.298326811776617e-01   +3.820825941873937e-01   -4.381288847609245e-02; -2.680580043782754e-01   +8.589262458388496e-01   -1.000000000000000e+00   -8.656396332610805e-03   -2.129115225197713e-01   -8.340120881255164e-01   +2.722329169287090e-01   +4.565887768640153e-02   -8.090376683524819e-01   +1.328040905047544e-01   -3.634099964471406e-01   +7.343373583337376e-02   +5.429010216924983e-01   +4.866155006299382e-01   +2.995245386982521e-01   -2.841910680567196e-03; +3.425118367018228e-01   +5.443444982705516e-01   +8.446296219056000e-01   -2.258079640604093e-01   +4.551951661035897e-01   +6.218724837677351e-01   +2.824861121152730e-01   +1.634364620424717e-01   -9.300382734702614e-02   +9.011955893634692e-02   +2.684342935320670e-01   +8.754605388998314e-01   -4.028747298186431e-01   -1.625097818513602e-01   -1.929173406377259e-01   -5.043478841018021e-01; -3.827220911441663e-01   +1.547612161958405e-01   +7.667028574762608e-01   +5.851451622353933e-01   +3.746575317919272e-01   -3.988778936747812e-01   -2.912264264997064e-01   -6.558027263646887e-02   +2.919880156245245e-01   +4.195303109106199e-01   +3.940628766883043e-01   +2.431810449541645e-01   -4.963886834148557e-01   -1.348843980522116e-01   +4.782417964413120e-01   -9.002916653281743e-01; +4.738842222174451e-02   -3.022504210916346e-01   -2.137614978754981e-01   +4.102499415845209e-01   +6.885956305943038e-03   +3.131063167181734e-02   -4.919336296150709e-01   +3.855611223300957e-01   -2.237457269857553e-01   +6.977423140377430e-02   +4.389588596837281e-01   -2.079801953254935e-01   +7.176853175843543e-01   -5.432882538241965e-01   -1.850227724701189e-01   +6.928724285065022e-01; -2.725533157779624e-01   -3.906383145495008e-01   +1.087165987190732e-01   -2.355092544840672e-02   -1.161039437827493e-01   +4.553195637215861e-03   +4.832208970331571e-01   -5.520131964332051e-02   -2.058545637497191e-01   +2.475668423678839e-01   +8.475591092027382e-01   +3.478180256666436e-01   -1.539949416717749e-01   +3.371059650130027e-01   -2.392822924457405e-01   +5.341104447188082e-01; +2.159825448271358e-01   +1.103694377831261e-01   +6.107856598016808e-01   +2.616090392112720e-01   +7.522083007157035e-01   +6.208683986344127e-02   +5.933605203885645e-02   -6.910862499764120e-02   -3.262413336705945e-01   +8.344601685857893e-02   +6.032084672451955e-02   +3.713316207735473e-01   +3.049371415162786e-01   +4.847258178632292e-01   -2.638810455667878e-01   -4.454318095555467e-01; +9.610097929092630e-02   -2.339120649209904e-02   +5.562942542019010e-01   -5.862796439988490e-01   +7.768557437742750e-01   +2.915571289083316e-01   -3.806724220171403e-02   -2.189108957596055e-01   +2.226336709225549e-01   -1.537809655282698e-01   +1.577569369699270e-01   -3.865028594998900e-01   +5.460415381241525e-01   +4.981861994447835e-01   +3.393538877122795e-02   -6.806793121228760e-02; +4.455954500223465e-01   -4.627809015617348e-01   -6.197483479543345e-01   -5.815136420631855e-01   -5.296876758964282e-01   +3.359577440902423e-01   +6.953935951768221e-01   +5.104098754945890e-01   -1.827192151929844e-01   +6.436343871311319e-01   -4.245706741780912e-01   +1.044810534019320e-01   +4.907845954380378e-01   +7.284726476870695e-01   -4.289928385060943e-01   -4.988964490681962e-01; -3.500643259647017e-01   -3.074329939337584e-01   +2.081652160722000e-01   +2.747238463439348e-01   -7.342951868692611e-01   -4.774728615403043e-01   +1.759997696389996e-02   -9.166827246118158e-03   +4.926151280237355e-01   +2.552899307004974e-01   -3.107420747430688e-01   -2.241787997446150e-01   +2.239165670864139e-01   +5.075712975500789e-01   +3.403042792097420e-01   -3.572724976739689e-01; +6.990590494883779e-02   +3.613060540933993e-01   +5.560319819786784e-01   -4.133129080071159e-01   -3.359487398146963e-01   +4.746504392178615e-01   +4.279247871351050e-01   +7.015388403373692e-02   -3.301882295669338e-01   +4.800136277710600e-01   -3.453409223439857e-01   -5.986021385793465e-01   +3.018351807337019e-01   +2.435197308001138e-01   -6.137564346263840e-01   -7.695309395302455e-01; -2.844743862000469e-01   -9.923925777828301e-01   +3.336187606970282e-01   +1.672586679083136e-01   +3.475480449078040e-01   +3.036337335094597e-01   +2.653901678602406e-01   -4.315766271278104e-01   +3.051576675875926e-01   -1.084204782746932e-01   +2.479679533352440e-01   +2.990832439278485e-01   +3.936468659814830e-01   -8.061375360279756e-01   +4.813960101736245e-01   +3.298566543464725e-01; -2.064301624191882e-01   +9.177082989437388e-01   +4.395924197375476e-01   -7.827919198606059e-02   +4.613091441381017e-01   +1.280124093746138e-01   +7.898158433931028e-02   +2.568452406098130e-01   +2.527583441579970e-01   -7.741625983090972e-01   +1.347465489995105e-01   -3.733459310624737e-01   +4.731704098419020e-01   -2.093657998643225e-02   +1.929920223207403e-01   +2.709739276502381e-01; -1.714541983632213e-01   +2.633067376168573e-01   -1.263656617780061e-01   +5.038310798656945e-01   -3.632722912870005e-02   -5.923282208158515e-01   -5.251274149065411e-01   -1.349358741718057e-01   -1.596263393334631e-01   +1.290012931518675e-01   -5.710234885851164e-01   -2.240594775830266e-01   +2.102439425737639e-01   -1.514729778963064e-01   +6.237850513578131e-01   -4.384630724728496e-01; -5.059852010299249e-01   +2.282544585067895e-01   -3.264501606293383e-01   +3.670517760257194e-01   +3.690698546565306e-01   -3.007689233763626e-01   -1.606815848182060e-01   -3.948721211556355e-01   +7.779180299013566e-01   -1.766691798963179e-01   -6.466821192933454e-02   +7.467178049959998e-01   +3.723632013505744e-01   +1.395447249225062e-01   +2.135171386078558e-01   -2.485081714204556e-01; +1.318759048247427e-01   -1.434517797358835e-02   -2.750654086086778e-01   +3.260808579834044e-02   -4.466297428315581e-01   +4.896589976943631e-01   +7.269132051247981e-02   +1.067645686235465e-02   -1.159714514444932e-01   +2.864632651114707e-01   -3.355114006171911e-01   +5.029550971865857e-01   -1.705208737933057e-01   -7.251078347257867e-01   +6.002683416318366e-01   +4.025812719931488e-01];
L1E_L1I_iGABA_netcon = [+4.645596102077058e-01   +5.590367863440477e-01   -2.260346648074329e-01   -5.029705507965450e-01   -1.049279454364948e-01   -9.885329756207096e-01   +6.760305140687324e-02   +4.798163412023732e-02   +9.035038931367683e-01   +9.282730362607146e-02   -2.940401673164074e-01   -6.098195475135036e-01   -1.745050207272117e-01   +3.035083165301133e-01   -3.244435300253392e-01   -7.090916297099604e-01; -5.027200583808911e-01   -5.587189058835464e-01   +1.146618544171268e-02   -2.603364031904856e-01   -5.471619092330957e-01   +8.174285938900504e-02   -2.261668278823525e-01   -1.096650738097358e-01   +4.972904876566279e-01   +3.903526187770715e-01   +4.310589208318795e-01   -8.303638260678876e-02   +2.791368177438685e-01   +5.260569175456290e-01   +1.456149346771348e-01   +2.740461937151832e-01; +6.839615693931478e-01   +2.470905581928443e-01   +5.746560299271245e-01   -4.537758727528814e-01   -3.212992344533181e-02   -2.026835499582404e-01   +4.890222720722792e-01   -6.858901621593961e-01   +3.039551271113540e-01   -2.191247356024243e-01   -2.852731584297273e-01   -1.896332824304368e-01   +3.210001736656524e-01   -1.469988525276854e-01   +2.819260929896645e-01   -1.927834307260809e-01; +6.289982665788144e-02   -8.306333772380100e-01   -3.513038041222755e-01   +4.398969250067911e-01   -7.043717599352782e-02   +2.996717359746624e-01   -2.934774028243967e-01   -6.535391933082403e-01   -3.403717516756594e-01   +2.264327323061698e-01   -7.071245553121106e-01   +4.473784905071616e-01   +1.563546537415920e-01   +2.027459040835205e-01   +2.445519607092682e-01   +2.431398344319006e-01; +4.286106444210765e-01   +5.682020110732894e-01   -1.387412604465827e-01   -1.358724431411898e-01   +3.850474585834798e-01   +2.438718057336797e-01   -4.092602609002540e-01   +2.672876222927788e-01   +7.608400313119891e-01   +3.565864586937321e-01   -6.725329059317057e-01   +1.857799818077974e-01   +9.634223149705633e-02   +5.741892729543734e-01   +3.764443327222727e-01   -5.812524781522895e-01; -2.588392128468083e-01   -5.303953135328543e-01   +3.592244501968411e-01   -4.076335047249175e-01   -5.709827536221036e-01   +5.755794200164431e-01   -7.600326266989412e-01   +1.375249848419371e-01   +3.165063106265672e-01   +1.486402878367079e-01   +2.612285932634278e-01   +7.019117286891985e-01   -5.373091128450220e-02   +3.151619849842803e-01   +4.189114950756343e-02   +1.047846446245505e-01; -2.260163727455237e-01   +6.371783391406309e-01   +6.755441536404780e-02   -1.332678800806338e-01   -3.564543313553739e-01   -6.577567632734300e-01   +8.693434747824604e-03   -4.222157948221841e-02   -4.964717206598954e-01   +4.304672028839457e-01   +5.918022242798956e-01   -6.887352631031787e-01   +6.667801612934308e-01   -1.435001918039687e-01   +6.976244871852199e-01   +5.032270359959173e-02; -1.892413846975635e-01   +5.542713618493661e-01   -1.526000980565185e-01   -4.571118757285429e-01   +1.268764089291386e-02   +2.814059447655709e-02   +5.782180640782482e-01   +4.951428456047648e-01   +3.684414177001570e-01   -4.018800786556004e-01   -5.581304930967863e-01   +5.016409179146426e-01   -1.322401674090830e-01   -3.114929342368379e-02   +2.868688706736064e-01   -2.547955568448662e-01; +4.168352919490084e-01   -9.307647824109137e-02   -6.660376188649987e-01   +4.560024638477895e-01   +5.599660157190933e-02   -7.506657823174744e-01   -8.813808902140920e-01   +2.782386960761738e-01   +3.928184612682886e-03   +1.354757509028880e-01   +9.579720326948395e-01   -2.754792002853862e-01   -1.413823537972001e-01   +5.063891009526704e-01   -6.318589804062607e-01   -5.890858534656462e-01; -6.261542304784216e-01   +5.701398492190793e-01   -3.708915282772580e-01   -4.805052020952548e-01   -4.464067077014475e-02   +6.029880821153529e-01   -3.100715288231960e-01   +4.196681134283659e-01   +1.758944994790273e-01   +4.418395526054854e-01   +7.162753286120103e-01   -4.315636809568547e-01   +4.771142188304722e-02   -3.742355542640546e-01   -4.156023050768013e-01   -4.399478563336742e-01; -5.408587757529304e-01   -6.565245159658417e-01   -3.029626030019252e-01   +4.622144799105323e-01   +2.734649312566905e-03   +6.820381769473571e-02   +2.773692512080053e-01   +5.027941352251467e-01   -6.043165005298947e-01   +5.372692680935134e-01   +4.380817029589620e-01   -4.945109357252215e-01   +5.397211162780505e-01   -1.978608876436277e-01   +2.691864654604956e-03   -2.594058569545303e-01; -2.577316915098189e-01   -6.826713276414340e-01   -6.106228810253630e-01   +1.595546602886424e-01   +5.552212199271915e-01   -3.991628788643532e-01   -1.267707865512383e-01   -3.472813562036663e-01   +1.228562237549155e-01   +7.825153787994674e-01   -1.014046841716168e-01   +3.389502160806747e-01   +5.002258146569202e-01   +8.068080172751564e-02   -1.533567633795405e-01   -3.395461433343746e-01; -3.104108153841157e-01   +1.458060743058225e-01   +2.370470826712089e-01   +8.660092297047812e-01   +1.292754170151292e-01   +2.296430862206713e-01   +2.075018657209005e-01   +3.568109409343220e-01   +1.493989328239791e-01   +2.306168250574000e-01   -5.186812020650318e-01   -5.485060671976526e-01   +5.767254363339237e-01   +9.218327025318825e-02   -5.593906452417342e-01   -4.847853339435371e-01; +1.223057997235223e-01   -3.469796933675606e-02   -1.003814219061080e-01   +2.484990752386315e-02   -5.802261962517563e-01   -6.184088356654296e-01   +6.047867007593539e-01   +3.771523057798650e-01   +1.495438218221563e-01   -2.666015169855392e-01   +4.438467102068400e-03   +1.928016539658977e-01   +3.263153287040407e-02   -2.992714509718996e-01   -6.397743389273571e-01   -7.435057428830126e-01; +4.339581226812388e-01   -6.449423823915804e-01   +7.691566504013879e-01   +1.484245259972627e-01   +9.975148032041381e-02   +2.254994893865551e-01   +2.541548317274852e-01   -4.643438437298299e-01   +6.554261274511392e-01   +1.020621192606460e-01   +4.896860940850136e-01   -1.000000000000000e+00   +1.917708551413697e-01   +1.093240480240674e-02   +2.681910688889840e-01   +2.641988347436227e-01; +5.122286282507781e-01   +5.096788312419820e-01   -4.557806394564863e-01   -1.636589320692861e-01   -7.449126106239191e-01   +8.524667095793222e-01   +2.948930451405535e-01   +3.082651963160464e-01   -2.606335936345102e-01   -9.722266084604002e-02   -7.211684686438787e-01   -3.152605397210044e-01   -4.983396862832706e-01   +5.662721409393796e-01   +2.451778339659043e-01   +1.953608802068054e-01];
L2I_L1I_iGABA_netcon = [-5.106309802821465e-01   -6.131246208999873e-01   +1.098069608106539e-01   +6.434837343232165e-01   -2.256069641320962e-01   -4.089575691377278e-01   +5.238958656349290e-01   -3.264298746865182e-01; -6.338276243584402e-01   -1.796781678623227e-01   -8.513880759147268e-01   +2.956331836856676e-01   -4.551758921016415e-02   -1.767412639048753e-01   +5.052705637019378e-01   -4.119537751943607e-01; -1.870088276140378e-01   +2.327222495554042e-01   +8.884762884559792e-02   -2.172642424377337e-01   -3.059324091954815e-01   -5.375033982937476e-02   +2.938722286275140e-01   +3.037983003183991e-01; -5.829626239599692e-02   +1.602300398891552e-01   +4.311872123952623e-01   +2.150061985408855e-02   -5.392301525491517e-01   -3.166775435129986e-01   -5.281965790912525e-01   +2.298554721116032e-01; -5.775699751667909e-01   +1.650609519812454e-01   +1.898594311112562e-01   -6.361805934104146e-02   -1.980349816855627e-01   -2.053281727500023e-01   +1.000000000000000e+00   -4.712225031794568e-01; -5.436757257466774e-01   -1.906824656470951e-01   +7.666742890711085e-01   -1.885755962584348e-01   -4.004539689509917e-01   -4.487884706915666e-01   -1.761234601324518e-01   -3.762237648125327e-01; -2.793443975311631e-01   +4.993415405772280e-01   -4.105722544636754e-01   -8.789222214328284e-01   +4.845541970094072e-01   +6.907770362740426e-01   +5.136988397551252e-01   -6.010898412766429e-01; +4.461391149044835e-01   -6.546462871324885e-02   +1.832891110765450e-01   -1.280855666360426e-03   +6.073558064864917e-01   +6.368226149040366e-01   +5.039662089545973e-02   -3.728632932316069e-01; -2.634872863332148e-01   -2.235654625234299e-01   +1.061195842887453e-01   -4.532931183579211e-02   +2.482544233649705e-01   -1.452176575464758e-01   +1.512526889497718e-01   +8.310896503252695e-02; -3.292421158483457e-01   -1.742614326326111e-01   +9.878255476921919e-03   +2.241711350910857e-01   +7.517054320449005e-01   +1.651973112605979e-01   -9.796143499980299e-02   +4.559386928176401e-02; +5.728465428853623e-01   -1.990977984437976e-01   -5.492354029979949e-02   -1.874607683728121e-01   -4.311428798421573e-01   +3.517041618822764e-02   -1.525493283300842e-01   -3.279699220529546e-01; -7.072586766147057e-01   +2.783163165170633e-01   +6.755541953655596e-01   -3.589981033061528e-01   -1.089996604077419e-01   +9.421296442304060e-02   -6.361495655185612e-01   +4.889336727164468e-01; -6.388539428236932e-01   +2.371365350262771e-02   -7.277995360809510e-01   -5.308621941353073e-02   +3.020382706042598e-01   +7.705525219539269e-02   -3.161644551547544e-01   +3.732495936119984e-01; +3.444762210558774e-01   +1.988863820009811e-01   +1.915330004975332e-02   +1.203095060033342e-01   -8.052910339401961e-02   -4.527504197354397e-01   -4.018578044008477e-01   +6.176216396351220e-02; -3.847341415550699e-01   +6.730803257300605e-02   +5.292853671893359e-01   +1.519399426133104e-01   -1.153103793539031e-01   +1.909174675301162e-01   +3.815380775819460e-01   -4.234396345336443e-01; +1.523013550893645e-01   -8.958766066449148e-01   -1.325485051528407e-01   -3.677323276399305e-02   -1.931552388501630e-01   -4.265448563296222e-02   +2.080882466898949e-01   +1.093437218564108e-01];
L1I_L2I_iGABA_netcon = [-3.014323736481964e-01   +3.420479186610804e-02   +4.229635963289125e-01   +7.353647007352179e-01   +3.190633224204911e-01   +1.736040091934135e-01   +4.848964485366986e-01   -6.157620635468057e-01   +2.875100123389402e-01   -5.024441032006722e-01   +1.337636256096773e-01   +6.818166991711144e-01   -1.996020663144598e-01   -3.189529843757281e-01   +6.799109946744157e-01   -5.938610890578839e-01; -3.844945096829908e-01   -8.512169883472849e-01   +4.642452047798207e-01   -1.000000000000000e+00   +6.403137106558312e-01   +2.032849340292338e-01   +7.548350336107074e-01   -4.429530947123065e-01   -2.026864939789448e-01   +8.417508940708180e-01   -6.049109176699673e-01   -4.048805798592151e-02   -7.917106140346039e-01   +6.037630507635925e-01   +7.074442010293462e-01   -9.022104626388842e-01; +3.034706957246484e-01   +7.555088805878641e-01   +1.150266523312716e-01   +5.751006758161485e-01   -7.156933723088775e-01   +1.612010387978397e-01   +5.819209070616871e-01   +3.185463115601774e-01   +1.271713127291392e-01   +5.179260838059697e-01   +4.726010895704787e-02   +8.850736761209834e-01   +2.290754991849963e-01   -6.432440016154649e-01   -1.402162616103910e-01   +1.936093406722041e-01; -3.982766745487692e-01   -2.379014490402286e-01   +2.038713299561495e-01   -7.898299314612810e-01   -5.317294540926080e-01   +5.255502072686534e-01   +4.374388461369418e-01   +6.361358662611994e-01   +2.883817596528037e-01   -1.205329834973496e-01   +3.659491620980154e-01   -1.919442072672922e-01   +2.933729450441905e-01   -1.400559990096235e-01   -5.388968626640870e-01   +7.300539504178658e-01; +1.414047719860365e-01   +6.084930499761403e-01   +7.872286233380226e-01   -1.816387542727437e-01   -5.913308407108653e-01   -2.308289841008750e-01   -8.723806813427308e-01   -5.393338930426825e-01   +6.123389470280784e-03   -3.420876791745102e-01   -4.516120155711983e-01   -7.300058390653053e-01   +1.018216646235437e-01   -7.296078218010071e-01   +5.098211628511981e-01   +8.514245775884718e-01; +6.327882628368837e-01   -1.615382440016344e-01   -1.475115877989190e-01   +6.809157855993665e-01   +7.668852539896895e-01   -2.713464631309291e-01   -2.529517966591063e-01   +4.474559039512194e-01   -3.063944709069844e-01   +4.096712874024233e-01   +6.572055304219053e-01   +5.816430733545479e-01   -2.630993512073367e-01   +1.312337537693775e-01   +3.259839251465216e-01   -9.682394455740420e-03; +4.129607701043135e-01   -1.710740442488770e-01   -8.960031209695632e-02   -6.295438035887484e-01   +4.213029178102096e-01   +5.229502399947379e-01   +2.049605020676588e-01   -2.043173937642757e-01   -2.440075164570966e-01   +1.858154453459397e-01   +3.311239438491272e-01   -9.819156764237609e-01   +1.138082199816723e-01   -8.322649115461530e-01   +4.826779811882836e-01   +3.729057400517537e-01; -2.607336493030516e-01   -1.308727501890710e-01   -1.006101068247423e-01   +4.804215390174688e-02   +4.866439954232198e-01   -2.378296380550102e-01   +6.375003663158753e-01   +3.216175174671247e-01   +4.683534800650176e-01   +4.510049690280125e-01   -1.348560061907092e-02   -1.835006388273743e-03   -4.665873218537636e-01   +6.015253786418515e-01   +2.307978398338162e-01   +5.501922162786156e-01];
L2E_L1E_iAMPA_netcon = [+1.715567384627980e-01   +2.583491015634492e-01   +4.366136990510129e-01   -7.747880457470250e-01   -6.552623890185110e-01   +4.230315819956528e-01   +1.982264732739635e-01   +3.770942831414201e-01; -1.504022295605273e-01   +5.800223615032423e-01   -2.176101928904013e-01   -2.768555710168960e-01   -5.213343435159047e-01   +2.551233901931674e-01   -1.321734600600343e-01   +2.464636145738832e-01; +5.909503390398372e-01   -8.544770515817633e-01   -2.912011755699942e-01   +4.338450601598954e-01   -8.194464984535789e-01   +4.450503555951044e-01   -6.735504986012625e-02   +7.719219567623496e-01; -1.397514580464615e-02   +1.019893470043598e-01   +3.009537092983716e-02   +5.550754409789642e-01   +1.792169927160313e-01   +5.858654759172224e-02   -4.226115843978377e-01   +5.531484114278639e-01; -1.286892570468169e-01   +5.525586574539851e-02   +3.696850875632348e-01   -1.989497413910249e-01   +5.009856362055853e-01   -2.123170847009401e-01   -2.800501057602693e-01   +4.000879138789562e-02; -2.772708268448142e-01   -4.694996208787665e-01   -6.901274603437793e-01   +1.914760121995563e-01   +6.171056642688414e-01   +3.572383986588082e-02   -5.440025389077062e-01   +1.768131388405617e-01; +2.710304096716147e-01   -5.109952928577335e-01   -3.776308492149331e-02   +4.069570108846496e-01   +1.988822492858656e-01   -4.433751355937572e-01   +3.228618608206575e-01   +6.608129603321882e-01; -4.795268468431146e-01   -3.060513631085497e-01   -4.850876213375119e-01   +4.317214355477525e-01   -1.205464772199040e-01   -6.759958857318058e-01   +1.412045806314825e-02   +1.660124512047338e-01; +8.242007222692770e-03   -1.910507735643572e-01   +4.570550526057789e-01   -7.787792492338970e-01   +2.521287037802550e-01   -1.929489471595568e-01   -7.664515028439057e-01   +3.371024170037788e-01; +1.432399926159752e-01   -5.062964044953236e-01   +6.538122538163347e-01   -4.334770315562418e-02   +2.376488737925473e-01   +1.436517802922583e-02   +5.283509385623512e-01   +4.795583985310460e-02; -1.957041906058885e-01   +7.128036996654382e-01   +2.757105237384976e-01   +8.289068892430965e-01   -8.538825324187644e-03   +2.353072506203998e-01   +2.107426815129772e-01   -3.405283429871069e-02; +2.326802046703310e-02   -1.675351951308216e-01   +1.670899776618061e-01   +7.421751683883776e-01   -6.389332311155131e-01   -4.242776587519957e-01   -2.862889804125572e-01   +5.861085197737991e-02; -8.760289880864585e-01   -1.521310473654011e-01   +4.416385998699785e-01   -2.978378026703036e-01   +2.554195155994836e-01   +1.312490007648811e-01   -1.901366404371896e-02   +1.117694211515772e-02; +4.221839055108592e-01   +6.004235878638595e-01   -2.121888559414943e-01   -2.122154732030812e-02   +3.780541051427511e-01   -2.700389611144172e-02   -9.112808429613679e-01   +9.363269364765879e-01; +7.724477976463434e-01   -2.784892679465079e-01   +3.754993262798939e-01   +3.488922098737961e-01   +1.000000000000000e+00   +4.708313259449143e-01   +2.632171429280060e-01   -8.759361602961533e-01; -2.260073905328080e-01   +2.518771408646937e-01   -1.633657658194676e-01   -2.469097928883294e-01   -4.351760984014202e-01   +2.593484699358840e-01   +3.788650583843625e-01   +2.787652484104757e-01];
L1E_L2E_iAMPA_netcon = [+2.153846781528796e-01   -2.714243387156973e-01   +7.257589242494682e-01   +3.432605943122252e-01   -2.037012265413983e-02   +6.779258179431764e-01   +2.011033510606601e-01   -4.693651647103124e-01   -1.242640804668074e-01   +5.680623359287303e-01   -5.472078402407662e-01   +6.043604731760818e-01   +4.767672369543374e-01   -1.868959404492865e-01   +4.188062641275412e-01   -7.393662232077314e-01; +9.632694911704397e-02   +3.509448861469979e-01   +1.588029328503789e-01   +4.918455931631757e-01   +2.803456401967102e-01   -8.426832211615920e-02   -5.190013848878926e-01   +5.675995109932258e-01   -4.218029101279421e-01   -4.730293550194070e-01   -5.051144371485795e-02   -2.360635493747024e-01   -6.737409183314084e-01   -5.241924466727035e-01   +9.513347121055324e-01   -3.870040487513465e-01; +2.310937529394358e-01   -2.826096841702217e-01   +1.693873548431286e-01   +2.934712672523785e-01   +1.144470808626834e-01   +1.251649538902638e-01   -2.283201642038772e-01   -5.296203555442712e-01   -8.439194509910652e-02   -4.036405403673403e-01   +1.461365279662725e-01   +3.246250690611717e-01   +3.194214670320313e-01   +9.993754876650179e-02   +4.921226909475870e-01   -3.001475295048924e-01; +1.462794203819387e-01   -7.319791490936211e-01   +4.999541023838742e-01   +2.680838256170411e-01   -1.243933569044588e-01   -1.512647548525910e-01   +4.021809756717708e-02   -2.807857341467118e-01   -9.391700024152456e-02   +3.744151088440758e-01   +6.925087420701524e-01   +3.398003440135994e-01   -5.361768974573095e-01   +8.852206664322206e-02   -2.208197977154008e-01   +4.788139201621979e-01; -4.394711917632333e-01   +7.045726319556060e-01   +1.556073547136905e-01   +5.574615939075250e-01   -7.440539553026486e-01   -6.230031598471809e-02   +8.542379805236676e-01   +7.220726200364778e-01   -6.406022152007657e-01   +5.843417187971827e-01   -3.190057925279864e-01   +5.369435961202114e-01   -1.220577022030267e-02   -3.149482879609485e-01   +2.701861339541848e-01   +6.899641011991879e-01; +4.927903406358127e-01   +1.612227714899174e-01   -4.368974968662406e-01   +4.862085377025423e-01   +2.470570269233334e-01   +1.054612597792810e-01   -3.646833608795004e-01   -2.226567912673501e-01   -5.517304202390813e-02   -2.288021309307567e-01   -1.573587912186682e-01   -5.918801988933819e-01   +6.301085794981663e-01   +4.475552244484350e-01   -2.119659387805066e-02   +2.102311309911360e-01; -3.193293725458982e-01   -5.326961540060374e-01   -6.102962914066256e-01   +3.010767135395890e-01   -7.616866387322874e-01   +2.195237359942988e-01   -6.059345056665221e-01   +3.509364171375135e-01   +6.441926302305104e-01   -3.942769882752316e-01   +7.327779709085773e-01   -2.433331218969562e-01   +1.338698967722777e-01   +3.655989438762727e-01   +1.819070743252771e-01   +7.803373839509754e-01; +7.737633036337958e-01   -4.612050728267639e-02   -6.039871629746825e-01   -3.403257834324442e-01   -6.078016910100847e-01   -3.379044707950700e-01   -1.976007693178505e-02   -3.272422732554240e-01   -6.510625895063836e-01   +4.817126454754542e-01   +1.000000000000000e+00   -4.423826509068173e-01   -2.939339599977632e-01   -2.433912894589782e-01   -4.582965753423585e-01   +3.484354096319414e-01];
L2I_L2E_iAMPA_netcon = [-3.601140514300266e-01   -5.017102520202945e-01   +1.223824846235430e-02   +6.495059628467280e-01   +3.892191663525605e-01   -2.457795883137478e-01   +1.015455792542544e-01   -8.799030258213795e-01; -6.873237343412829e-01   +2.506082391259233e-02   -8.979953813587056e-01   -8.008204287409822e-02   +1.767506868310573e-01   +4.604927393830041e-01   -2.084742432775633e-01   -2.829926101204596e-01; -3.854609210096452e-01   +5.362279823706123e-01   -1.673882249134434e-02   -4.583199621430593e-01   +1.119228104391102e-01   +2.446090015937709e-01   -8.734898870961517e-01   +9.987025798789964e-02; -4.634258610952963e-02   -6.681149414666142e-01   +2.422592377615748e-01   -1.810235643706418e-01   +7.426879669440070e-02   +2.070022785830206e-01   +4.194137883425228e-01   -7.150710374994128e-03; -1.000000000000000e+00   +2.881059450076642e-01   +3.714990065589132e-01   -1.410728156074759e-01   -4.780970202261343e-02   -6.390601452134695e-01   -2.695970034059044e-01   -7.929197948828794e-02; -7.182819734762064e-01   -2.951365926196767e-01   +2.446521481676496e-01   -4.814742197024668e-02   -8.545729329889205e-01   +2.208973767664217e-01   -1.339718962623870e-01   -9.266646746185075e-01; -3.269244727652565e-01   -5.573249915966575e-01   +3.523809396787433e-01   -6.232296087022364e-01   -2.802208744917049e-01   -1.059943450220231e-01   -6.471543721973922e-01   -8.165699457138691e-01; +5.728748908547652e-01   -5.378911199395865e-01   +1.725433991457721e-01   -2.102010253128371e-01   -1.843601993114087e-01   -1.349255707850061e-02   -2.220022789282433e-01   -4.066729569050289e-01];
L2E_L2I_iGABA_netcon = [-5.823351805956891e-01   -4.684161475271473e-02   -4.565517011415025e-01   -6.948881269421144e-02   +6.101370057126045e-01   -1.990423235846294e-01   -9.101925097962987e-02   +2.289783127652444e-01; -2.305371481482846e-01   +2.183912441819485e-01   +4.941232341326722e-01   -3.199345234767669e-01   -9.050157304004440e-01   +5.523952756277103e-01   +3.046278816642325e-01   -3.870608876600580e-01; +5.164878173320843e-01   -7.273572850732917e-01   -3.409055216925052e-01   +5.382671353732688e-02   +3.241465716670204e-01   +1.644739532871750e-01   -3.391149352457584e-01   +1.157006807506549e-01; +9.509514379188764e-01   +3.014957466310160e-01   -3.420227442575937e-01   +4.616899784008435e-01   -4.939666118333639e-01   -6.838958752740715e-01   +2.680095061423908e-01   -3.117970955668623e-01; +2.895103766961298e-01   +6.316096193935409e-01   +1.765301856943057e-01   -1.812562355123369e-01   -2.966519203093557e-01   +4.903791732152626e-01   -9.434189119277063e-01   +4.311759211903421e-01; +4.977292805498759e-01   +5.319941123336186e-02   -1.608776808253599e-01   +5.370568476223615e-02   +2.133766181905757e-01   -8.017924356544820e-01   -3.213360881885926e-01   -4.207829770577695e-01; -5.466247749619462e-01   -5.192378177843204e-01   -5.314347534351750e-01   -5.416438484854429e-01   -3.928154386889696e-01   +1.094943975692086e-01   -5.549269824353686e-01   -1.533248944564226e-01; -5.245740754534123e-01   -3.001882456612465e-01   +6.792658068416162e-01   -2.153049907779634e-01   +5.422284748698711e-01   +4.557827970488565e-01   -6.020313029668199e-01   +1.000000000000000e+00];
L3E_L2E_iAMPA_netcon = [-7.537434450465693e-01   +1.000201316484600e-01   -3.956521026578174e-01   -3.922379916831980e-01   +5.397773014587327e-01   +2.311411056342633e-02   -4.089594387902363e-01   -1.626113027735302e-01   +2.869082264763374e-01   -2.982508044284483e-01   -1.338729421811517e-01   +7.289576056103024e-01; +4.066462772521613e-01   -4.534854970792716e-02   +2.642081508179351e-01   -4.208918382645967e-01   +4.229207428656735e-01   +1.050868014299822e-01   +5.184671851518130e-01   -2.305727578400386e-01   +4.942943249578795e-01   +1.666417794234713e-01   +5.966403120150428e-01   -3.050590397979046e-01; +2.305421143241275e-01   -4.988191554032831e-01   -1.551418051399790e-01   +9.831403941515481e-02   -5.807118614727674e-01   +1.508269810998642e-02   +2.662639532157115e-01   +1.324756104432067e-01   +8.777093274528404e-01   -3.352710099788269e-01   -4.525498286460183e-01   +1.555180609996184e-01; +6.022805586719079e-01   +2.542612106568266e-01   +2.406436045330985e-01   -4.076359641630879e-01   -9.948475398584235e-03   +4.643275948147210e-01   -6.005840160090524e-01   -4.574712967185843e-01   -3.648885028977580e-01   +4.533553117256849e-02   +6.561536669840679e-03   +2.146133835953040e-01; -8.000216289617059e-01   -4.648645443281507e-01   -2.369468826371106e-01   -2.598785391395930e-01   +3.937018927373786e-01   +4.323150604902795e-01   -5.408782359514864e-01   +3.401473182706062e-01   -5.115117723854534e-01   +6.119443761557817e-01   -2.144751936384712e-01   -5.220714967959721e-01; +1.959895407987470e-01   +9.562604579671222e-02   -4.184688550649420e-01   -1.000000000000000e+00   -1.406850425969303e-02   +1.103703098411823e-01   -4.742999322796597e-02   -1.033372045311491e-02   -4.938433051243606e-01   +1.942412173557433e-01   +7.993684110754661e-01   -4.467082724864630e-01; +8.867103186286265e-02   +3.287998521178965e-01   -4.614126564956370e-03   -4.037167783443152e-01   -5.801465803138361e-01   -2.793908475987467e-01   -3.747854437923586e-01   +1.088895318333848e-01   -4.031803610156569e-01   -8.443729447127681e-01   -1.880405045645994e-01   +5.793649436996209e-01; +6.355336561976928e-01   -2.482518868805683e-01   +2.453310032074077e-02   +1.953874391347964e-01   -1.957408825855368e-02   +5.324725901936296e-01   -3.577758697436121e-01   -1.458079770752791e-02   -9.283185791040479e-01   -1.843403835974107e-01   -3.248277319316173e-01   +3.438194067763427e-01];
L3I_L2I_iGABA_netcon = [-4.990029283064556e-02   -4.235303427114769e-01   -1.909512555843153e-01   +1.878944069447387e-01   -1.142378651993195e-01   +2.933494147498230e-01   +6.852054525967263e-02   -3.541566673504912e-01   +6.316182982576121e-01   +3.291377091394315e-01   +3.483096920792408e-01   -5.305064780277755e-01; -5.625671034128507e-01   -3.449507863921482e-01   +1.184416480919352e-01   +7.586671924724692e-01   -2.059536214392780e-01   -1.306506933870432e-01   -5.151310350064970e-02   +6.337500881209344e-01   +3.145168931239078e-01   -6.483357789005308e-02   -1.586165913567375e-01   +8.315226698974855e-01; +1.808888354460511e-01   +2.652171235753393e-01   +8.303289913041491e-01   -3.483248881670871e-01   +4.433227531398081e-01   +3.736230753565130e-01   -9.492244077182524e-02   -1.254630272984646e-01   -1.110819206097300e-01   -7.308215871555994e-03   -2.372228641966373e-01   +2.923708532577821e-01; +3.851778096749165e-01   -5.275962074406992e-01   -4.262198919822096e-01   +1.879303867769856e-01   +4.231051191331676e-01   -6.934248828391475e-01   +5.330215128652515e-01   +1.295816444052584e-01   -4.817558779213167e-01   -5.927065000044686e-01   +5.571662763622929e-01   -4.159249239692180e-01; -1.259093982067370e-02   +7.293145833445515e-02   -1.689777130223643e-01   +7.020942153724332e-01   -4.484215442199859e-01   -4.643003092040900e-01   -5.534118575656820e-01   -8.276700318669513e-01   +8.550173907157478e-02   -9.902396190823034e-01   -4.327569614347258e-02   -7.021439903801386e-01; +3.973795542277893e-01   -5.214140583501348e-01   +6.212218868518755e-01   +2.735425021976884e-01   -5.501861498063231e-01   -5.746092323668147e-01   +5.179787278208592e-01   -3.800425598766967e-01   -8.275914873821528e-01   -1.247292029297174e-01   -6.049027606499787e-01   +4.171042607426917e-01; -7.144115775242066e-01   -4.115077836100987e-01   -1.000000000000000e+00   -2.577211699722887e-01   +1.291103548109918e-01   -1.270684332112670e-02   +4.567477427160944e-01   +4.085099122856243e-01   +2.443180942990745e-01   -6.612465907768449e-01   +4.676966446763056e-01   -4.212557516546695e-01; -4.677279308552102e-01   +3.444406070908060e-01   +2.475016266479121e-03   +7.374162961997739e-01   -6.251600723600552e-01   +4.902202555956562e-01   +5.217097827452533e-01   -1.296479794821734e-01   -3.905098346327889e-01   +8.045836192735238e-02   -1.587934702087903e-01   -4.656283424306716e-01];
L2E_L3E_iAMPA_netcon = [+8.836597364036129e-01   -1.384947487778794e-01   +7.202667137904017e-01   -7.461789556675014e-01   -8.241034010979136e-03   +6.527282934340950e-01   -6.208872162028893e-01   -5.678089027586996e-01; -8.306315543721218e-01   +4.316522882079643e-01   +6.078524444485105e-01   +1.996163136806042e-01   +6.415021953074543e-01   -5.343863475670522e-01   -2.000983214373327e-01   -3.867461861362137e-01; +6.934187440870446e-02   -5.107026376149335e-01   +1.319855549649204e-01   -6.089625396091503e-02   +7.353574647081450e-01   -3.684323101527315e-01   -2.673852633338430e-02   +5.753140565116049e-01; -7.168439391235940e-01   -2.816436903505908e-01   -1.261402471860236e-01   +5.147778636816742e-01   +4.767737141199491e-01   -9.864288287687091e-01   -1.522771531060889e-01   -1.559276797326658e-01; +2.373014847763779e-01   +4.387102064547433e-01   -1.891457277003606e-01   +4.454914338841061e-01   -5.672549653679093e-01   -1.425924021519157e-01   +6.464918802676449e-01   +2.193064404429283e-01; -3.229168776133496e-01   -3.245724373927865e-01   +4.653206151164819e-01   +3.371679214910913e-02   +2.042122753398324e-02   -7.043478981789275e-01   -7.483722471495041e-01   -7.518936279061471e-01; +2.836121757533334e-01   +5.387097297252406e-02   -2.514959816106752e-01   -1.995908636016953e-01   -1.746159387753431e-01   +1.228121449326770e-03   +4.673876413456654e-01   +3.272722359020896e-01; -3.710059878411496e-01   -3.585555152389592e-01   +8.884951549449184e-01   -2.218858717350892e-01   +1.145520448107757e-01   +5.456682835558142e-01   -5.263122663232823e-01   -5.207530369979197e-01; -1.638026136466452e-02   +3.721243409295321e-01   +6.836037742170687e-01   +4.288762061196931e-01   -2.298738512127504e-01   -7.041793800428817e-01   +3.958553685148812e-01   +3.836687788109558e-01; -1.000000000000000e+00   +3.176127415538579e-01   +2.679367501266908e-01   +1.940385423729719e-01   +2.771278861121666e-01   +7.425886983765002e-01   -4.202396812416743e-02   +2.864516674365022e-01; -1.061256266787751e-01   +7.414447841450779e-01   -7.380195616867754e-01   -5.482019927248050e-02   +7.733594970157486e-01   -3.858160253614552e-01   +2.454702380183557e-01   +3.039211856374260e-02; +1.560385235791668e-01   -4.068268459894196e-01   -7.817559724948689e-01   +1.204383830262147e-01   -4.466840912377396e-01   -4.047177699614120e-01   -7.528165897047256e-01   -7.564764818936139e-02];
L2I_L3I_iGABA_netcon = [-3.333485146442535e-01   -3.508140056828378e-01   -1.029097790161730e-01   +4.076042862245493e-01   -7.487952709866311e-01   -1.192462259925483e-01   -3.316486132196449e-01   +3.821113524213551e-01; -2.723701956965900e-01   +6.408118944985826e-01   -5.523931419053316e-01   -7.357200673430175e-01   -7.131748259977634e-01   -5.316986459470663e-01   -1.780408271981520e-01   +3.152668149920281e-01; +9.895340516932966e-01   -4.747749081505946e-01   -2.074780107307691e-01   +5.932279432223764e-01   -5.796162040112407e-01   -9.868469475569779e-01   -5.047715194770785e-01   +2.235519056535164e-01; +8.814947447734981e-01   +1.587340222572694e-01   +1.638104480197886e-01   -6.195064846995393e-01   +5.991842169493894e-01   +2.283741047970022e-01   -4.133221641666506e-01   +4.932695896766585e-01; -5.105499668600775e-01   +9.792870978141727e-01   +6.050485613161457e-01   +7.659578253886870e-01   -4.316908893995449e-01   +4.826507308044140e-01   +7.412280592782632e-01   -5.086193160772290e-02; +1.857599470515452e-01   +1.948989053826347e-01   +5.749619527801226e-01   +2.299106481223202e-01   +1.492738876533173e-03   -6.519804425447652e-02   -1.385272616466806e-01   +6.147909219127552e-01; +6.848791817240892e-01   +3.797879802499469e-01   +5.194487445954693e-01   -2.720623789943356e-01   -3.029290395100470e-01   -2.689148815589663e-01   -1.165946860960321e-01   -2.627117884433950e-01; -7.755316931056851e-01   -1.349705242126513e-01   +2.209302352416739e-01   -1.345025752068502e-01   -4.665882028062918e-02   +5.656742338406862e-01   -4.472030799727583e-01   +7.800726209563907e-02; +1.285470063303717e-01   -6.185256194227747e-01   +8.980271304141011e-01   -2.699728053411118e-01   -5.512235091089637e-01   +3.102905807232558e-01   +2.219641738345720e-01   +1.614581302668524e-01; -4.157570874005502e-01   -8.247117964892909e-01   +1.707205074694204e-01   +1.708118795422962e-01   -8.729086056957691e-02   +1.151455558148912e-01   -4.381052427261810e-01   -8.809106702931082e-01; +6.851761471546209e-01   -4.068130887815075e-01   +7.735953346222360e-01   -1.415118978365795e-01   -3.694912240209628e-01   +2.162301586094412e-01   +1.880981667545631e-01   +3.740039824860001e-01; +1.830703814351962e-01   +2.545825885768837e-01   -3.182262470099557e-01   +4.005101038607471e-01   -8.973652507083043e-01   -7.574220462873088e-01   -3.649593592212698e-01   +8.307653113510780e-01];
L3I_L3E_iAMPA_netcon = [-6.932508712683191e-01   +1.485893776144006e-01   +2.479635276531783e-01   +5.556831158900156e-01   +1.469353480896813e-01   +5.395909810120673e-01   -1.063399335281288e-01   -4.728519706062519e-01   +4.337229018125311e-01   +6.859538710776902e-02   +4.658230794001973e-01   +3.926323915138717e-01; +2.099382455619974e-01   -4.424933790108088e-01   +3.952194908729872e-01   +4.945602411455299e-01   +4.729550028015964e-01   +9.524949713854217e-02   -3.830732286200367e-01   +2.046655821253634e-02   -4.177613871477688e-02   +6.470676260789301e-01   -4.982089687668256e-01   +1.853772088205837e-01; +2.528875262845249e-01   -6.778167813134647e-01   +5.508711124280007e-01   +4.868590842483588e-01   +4.070822822480509e-01   -2.315950138758849e-01   +6.772004114519841e-03   +7.633126588249329e-01   +5.879299357312489e-02   +5.348514432159134e-01   +2.149258504898903e-01   +2.556514246327688e-02; +7.353111214509199e-01   -7.254076854961983e-01   +1.539196656022863e-01   -6.499894815509551e-02   -1.260098887176883e-01   +3.449028101511448e-03   +8.639225427752276e-01   -5.516225233881318e-01   +1.984194585470095e-01   +1.908348010635953e-01   -1.857762833927935e-01   -3.612634244644682e-01; +4.629563695315492e-01   -6.197281305709331e-01   -4.672694297611591e-01   +8.206691477262711e-01   +1.594985562877076e-01   +6.001046395203690e-01   -3.308693508808572e-01   +5.328974329809173e-02   -2.736796708543996e-01   -5.337362569770252e-01   +1.302553254174672e-01   +4.663538538792285e-01; +3.485017891479016e-01   -5.850380467496514e-01   +5.999886325619755e-01   -6.878555257420475e-02   -5.415046590198310e-02   -4.367916601808082e-01   -3.455375258574177e-01   -7.985844276875548e-01   -2.377659270033811e-01   -2.767414363483073e-01   +8.109437737701639e-01   -4.449678551113531e-02; -8.581550805176499e-01   -2.102822095391931e-01   -4.128082992222279e-01   -5.536387777544932e-01   +1.288958273522982e-01   +4.634158956987032e-01   -2.277313865882813e-01   +1.449623573994047e-01   +7.599804911779319e-01   -4.099321894008993e-01   +2.549993595652340e-02   -5.079099209934514e-01; -5.738472086983275e-01   +4.379431472359655e-02   +5.714691107177943e-02   +5.768835707085904e-01   +6.405367846146658e-01   -3.651143087246612e-01   -6.921139311464052e-01   -4.356385271825214e-01   +1.327137240103314e-01   +4.634262872415503e-02   -5.184233203823867e-01   +4.763106135058237e-01; +1.074025002560500e-01   -1.714178860759870e-01   +4.177955881493050e-01   -1.000000000000000e+00   +2.568582534692348e-01   -4.420995046069485e-01   +3.631388001785587e-01   +2.402453508385646e-01   -3.214408254775414e-01   +1.090046378924075e-01   +2.272604810943293e-01   -6.109573120947492e-01; -9.681412750458217e-02   -3.646502289042658e-01   +2.150295782895991e-01   -2.526472187065152e-01   +1.893929252093533e-01   -9.188983262984568e-02   +4.493182135632853e-01   +6.273687959843393e-01   +2.156909532977398e-01   -4.403520670857307e-01   +8.202448188330481e-01   -5.063725741174818e-01; +6.630142158728225e-02   -9.949522679786681e-02   -4.293228548861995e-01   +4.355723338198987e-01   -3.482797383264928e-01   -6.490956347088613e-01   +7.064350854743237e-01   -5.191686938193355e-01   -3.774404350448101e-01   +2.548795451708344e-02   +2.867614464533207e-01   +3.157036063404519e-01; -5.180138490115374e-01   +9.214695339885981e-02   -4.504844196786391e-01   +2.460264530599515e-01   -6.384193903589944e-01   -1.863019606021183e-01   +1.718220865984972e-01   +4.197253742484892e-01   -6.199260630112343e-01   -5.574598506389221e-02   -1.071335244190393e-01   -1.678499197980975e-01];
L3E_L3I_iGABA_netcon = [+2.716243928172512e-01   +6.124132084857185e-01   -4.873151010361581e-01   -7.495960452981445e-01   -6.928630116649169e-02   -3.418773342847714e-01   +3.093836588679257e-01   +3.249643515294279e-02   +4.425732041079680e-01   +6.382663946123724e-01   -5.849736824382396e-01   +4.503762781264010e-01; +2.781927939914576e-01   -2.798945034412661e-01   +1.045181692094744e-01   +4.668813584831115e-01   -2.464153690671562e-01   -1.868575641307020e-01   -1.212779609748151e-01   -1.873056746925215e-01   -1.703901652865437e-01   -2.768285438458222e-01   +3.392540770079475e-03   -1.925921513884322e-01; +3.867412401264033e-01   -1.026831321549097e-01   +1.239904555252949e-01   -4.184498577560269e-01   +1.812469914606279e-01   +1.235461946047026e-01   -1.608903336529284e-02   +7.877966456374201e-01   -7.467750422874844e-02   -4.871190650452574e-01   +2.148140573682711e-02   -4.712500966820054e-01; +2.584617258406191e-01   +3.672856181676786e-01   -1.313187568373267e-01   +2.924518410289203e-01   -3.253211594124802e-01   +5.666628595148958e-01   +5.839968109020879e-01   +1.269703147636217e-01   -4.451628640603388e-01   +1.736240994725871e-01   -1.132540407490600e-01   -5.526568282088206e-02; +2.967068449864051e-01   +7.090350346616000e-01   +2.087763767850914e-01   -6.389345624447748e-01   +5.360743608307343e-01   +6.684164069956039e-01   +6.481164558545155e-02   -2.120247196273979e-01   -5.714112561146705e-01   +1.844157145827522e-01   -2.840629515000607e-01   -9.860553327486077e-02; -9.823696534425666e-02   +8.486501860784922e-02   -4.617621740755734e-02   -5.365383600035042e-02   +3.177176729550169e-01   +1.000000000000000e+00   -5.020482698969370e-01   -4.751914669466050e-01   +3.807860264381995e-01   +8.994652982337370e-02   +9.449022923044115e-02   -3.059616668816966e-01; -2.632042343561152e-01   +1.170634263686782e-01   -6.577633888047507e-01   -4.024134156525197e-01   -3.067702884291157e-01   +3.626770219201940e-01   +2.183846335030648e-01   -7.353238661243863e-01   -3.603078751908665e-01   +7.209139758918113e-01   -3.261992092725844e-01   -2.139769714926521e-01; -1.761002964328378e-01   +2.452496881512485e-01   -1.006245490146464e-01   +5.072636464571780e-02   +1.209026748694343e-01   +6.044773053925984e-01   -1.693115017691591e-01   -3.337836033727803e-01   +7.246653114173442e-01   -7.280617335769881e-01   -3.869880892397571e-01   -2.344707170239068e-01; +6.694387659406568e-01   +9.626801900149025e-02   +1.941759346079670e-01   -4.327641393313764e-01   +2.264197677052986e-01   -7.921454658799443e-02   -7.178282590120184e-02   +1.770714632955491e-01   +9.243959580025965e-02   -2.865772440110496e-01   -3.778989423195008e-01   +6.209948218379659e-02; +1.705905800008849e-01   -7.309834910545584e-01   +3.848886692960307e-01   +2.561152238303442e-01   +2.925305120112095e-01   -5.650883463606215e-02   +1.791574065967941e-01   +4.617063823806343e-01   +6.312041411216094e-01   +5.052745009324652e-01   -6.177618510697720e-01   +1.717824451683631e-01; +2.017986771313050e-01   -3.003286253490664e-01   -1.478492210847348e-01   -2.424976016403074e-01   +3.099702389130439e-01   +5.230246378889036e-01   +8.426491865274397e-01   +7.765682249962402e-01   +2.954088373243279e-01   +3.409686591080318e-01   -1.879662989382603e-01   -5.486174693303820e-01; -2.984814663375242e-01   +3.278416472092540e-01   -4.443190143093464e-01   +5.467814751095100e-01   -5.047625551060152e-02   +5.437882148578432e-01   -2.144454760350425e-01   +6.458893761419530e-01   -3.107691639687701e-01   -2.473779027540315e-01   -1.213993258876049e-02   +3.246854843568480e-02];
L2E_Input1_iAMPA_netcon = [+3.832899586666266e-02   +2.887477270977409e-01   -3.695431441524998e-01   +1.000000000000000e+00   +1.317661716926910e-02   -2.159178929524400e-01   +3.217656970804222e-01   -7.742025693595752e-01];
L2I_Input2_iAMPA_netcon = [+2.263074065494342e-01   -7.109769440191100e-01   -4.759722280170585e-01   +4.530021773411607e-01   +8.593992289249253e-01   -7.244953058434139e-01   +1.000000000000000e+00   -2.372069071240752e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
