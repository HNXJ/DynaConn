function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.489478571706915e-03   +1.669074451016806e-02   +2.874195818278579e-02   +2.800012979222853e-02   +2.827018791860246e-02   +4.011574595903063e-02   +1.718185227376099e-02   +9.345102104751346e-03   +1.012957621861169e-02   +1.632363922036799e-02   +2.379622043489459e-02   +1.261362977629836e-02   +1.872969857873016e-02   +2.929483621510448e-02   +1.854401140365587e-02   +4.200014312768436e-04; +1.886272020802860e-02   +1.445440491376109e-03   +1.759512930014711e-02   +2.726161869655099e-02   +5.816215232830994e-03   +1.098193951742092e-02   +3.662125265362250e-02   +3.738308048210829e-02   +3.140315108907088e-02   +1.315749329882805e-02   +4.124082811370007e-02   +4.764552913302507e-03   +2.818429547809765e-03   -3.048834232039237e-03   +1.673223265349538e-02   -2.423704381647115e-03; +2.033653937932988e-02   +2.320082806707473e-02   +2.995557144822621e-02   +2.321581460942143e-02   +3.061634065471075e-03   +3.828202773014974e-02   +3.238947392279763e-02   +1.790193775884412e-02   +1.564408224913695e-02   +1.308835898215636e-02   +2.266907348547952e-02   +8.684113939840117e-03   +5.408159816023959e-03   +7.141623980355697e-03   +3.264211034819597e-02   +2.568819848109963e-02; -3.936177235905489e-03   -2.466262039372359e-04   +1.575712707162773e-02   +2.572538365018186e-02   +7.460517091982318e-03   +2.569727735873398e-02   +2.054246276666274e-02   +3.500427919855671e-02   +1.661873599221460e-02   +5.462060736135993e-03   +3.306808176965026e-02   +3.106053358309001e-02   +1.198088814134639e-02   +3.466866902257543e-02   +1.208463953714905e-02   +6.683687855083828e-03; +2.163926041410359e-02   +2.091011475584618e-02   +2.676167281389030e-02   +3.032235382551059e-02   +2.035810746140516e-02   +3.646654623394396e-02   +1.761427182829446e-02   +1.250111228212908e-02   +2.394154426019014e-02   +3.977806891114331e-02   +1.935719598156820e-02   +2.545453098722310e-02   +1.006232983526273e-02   +9.580751552038738e-03   +3.865952935595185e-02   +7.693909096492806e-03; +1.774590873180695e-02   -7.197990040328343e-04   +3.362448113044984e-02   +5.022701986275769e-03   +1.892273870202188e-02   +1.465772731402368e-02   +1.581450101016169e-02   +9.584819321639930e-03   +1.871191792742807e-02   +2.265992111817961e-02   +3.102286970294605e-02   +1.252372925181191e-02   +1.824067020589525e-02   +1.344627035174265e-02   +1.771974466252977e-02   +2.851288353594028e-02; +8.550781319144860e-03   +2.497102599431307e-02   +3.360530333920798e-02   +2.806529591377184e-02   +2.171438305664304e-02   +1.847051314176797e-02   +1.003254330437593e-02   +3.729415665225918e-02   +3.339668723844533e-02   +1.150298451076818e-02   +1.907138336397935e-03   +9.884902592849437e-03   +1.701246413467052e-02   +3.078188636423719e-02   +2.677440197288620e-03   +5.065753678595964e-03; +2.454426978902709e-02   +1.491745718697532e-02   +2.850441308747181e-02   +2.813378184694608e-02   +2.290601950941130e-02   +2.958143647277528e-03   +2.348272595798275e-03   +1.994314713097940e-02   +2.990780918894682e-02   +2.303982764407023e-02   +9.376591599092135e-03   +2.694430796173419e-02   +1.141991482081882e-02   +7.479812087518479e-03   +2.676340603363567e-02   +2.549751073240405e-02; +2.312215540540627e-03   +2.769638172440378e-02   +1.976585036914337e-02   +2.549290087907386e-02   +5.177303291232985e-03   +3.197731597803943e-02   +1.364257455264161e-02   +1.789600681803857e-02   +1.655868341534921e-02   +1.572016145654553e-02   +1.032236614499522e-02   +3.515448449645216e-02   +6.962857230247355e-04   +2.697850150956719e-02   +1.012760840188910e-02   +1.234962144349122e-02; +1.993135920423398e-02   +5.600762143045570e-03   +3.421195286323498e-02   +2.788636448543601e-02   +2.338917907234220e-02   +1.245319670447314e-02   -3.795652480156225e-05   +4.585538229396531e-03   +2.639899385615826e-02   +1.606070795451808e-02   +5.897758039675165e-03   +2.498505287909615e-02   +3.274516974580366e-02   +1.533057879969079e-02   +3.836210766013071e-02   +2.363231468703818e-02; +1.490924697223761e-02   +1.753465803501524e-02   +1.805883225980732e-02   +3.374278833330924e-02   +2.995770881534964e-02   +5.088049838019961e-03   +2.425730049740106e-02   +3.007613963831238e-02   +7.145674266747122e-03   +1.356219190743904e-02   +2.679051803844255e-02   +3.264665212726584e-02   +4.232392710305240e-03   +1.898606273157727e-02   +3.082996195573154e-02   +1.156336802353332e-02; +2.208818893620252e-02   +9.680768682860833e-03   +2.129380162319057e-03   -1.227010623790731e-03   +3.156694487810882e-02   +3.722818691531660e-02   +7.810812726794791e-04   +2.728983103426196e-02   +2.488962770217805e-02   +8.928108805928411e-03   +3.518113582946545e-03   -3.011622125967809e-04   +3.511840720405939e-02   +5.701642476025888e-03   +2.352514039608944e-02   +2.150398833855976e-02; +2.868977567371332e-02   +2.742795711979133e-02   +2.713774060679725e-02   +1.094642767425174e-02   +3.085072746177862e-02   +1.926628626816246e-02   +2.857441425529332e-02   +2.747734666203063e-02   +3.253386119248192e-02   +1.764525004847263e-02   +1.368318572380789e-02   +3.885397357520046e-02   +2.915219486412431e-02   +2.270418567992896e-02   +2.140322627199750e-02   +3.521527407363041e-02; +3.481637074769475e-02   +2.913186738110602e-02   +1.134384140747977e-02   +2.267310314740032e-02   +5.337013854782582e-03   +1.194652545256979e-02   +4.387296800709688e-03   +6.546612893679110e-03   +6.049816627435914e-03   +2.952376681281486e-02   +8.125972001411682e-03   +3.717796279630706e-02   +2.676721966938797e-02   +2.091620201564147e-02   +1.414584969420160e-02   +1.625619981754599e-02; +1.355418797469024e-03   +2.212156029768135e-02   +3.451538938706460e-02   +1.674482395427736e-02   +1.518923853526576e-02   +6.574954452604560e-03   +1.086014592954205e-02   +2.330280751821483e-02   +7.451004447761013e-03   +3.585298143308036e-02   +1.647651624990709e-02   +3.723058771390539e-03   -4.293835092884330e-04   +3.352207603683163e-02   -3.989134830778182e-03   +2.242691477305714e-02; +3.283223984577581e-02   +1.031227868086505e-02   +8.862087180196574e-03   +3.713621378631916e-02   +1.685576667813579e-03   +2.806650436139597e-03   +2.887942374987701e-02   +6.307435153123759e-03   +1.383159372141336e-02   +3.849938363690238e-02   +2.713500231315166e-02   +6.153960492841603e-03   +3.035395830066252e-02   +2.995040084584698e-02   +3.744269214275588e-02   +3.207183949880223e-02];
L1E_L1I_iGABA_netcon = [+1.936767122323694e-02   +2.670308443019423e-02   +3.105160096780243e-03   +1.284459573848290e-02   +3.265609073374051e-02   +1.332641696051580e-02   +1.764193270405550e-02   +1.109295961707809e-02   +3.669987260905253e-03   +1.261530707400066e-02   +1.054000360335848e-02   +1.855957328071854e-02   +1.378025375526117e-02   +3.684580754507644e-02   +3.510798876831259e-03   +1.331235230234854e-02; +7.914321473491829e-03   +2.862400452583935e-02   +1.810396826240945e-02   +3.222116403953725e-02   +1.562062177441021e-02   +1.968862024423293e-02   +7.890323193301945e-03   +2.370318265043177e-02   +2.087041027821606e-02   +4.461842471414595e-03   +5.795627377068150e-03   +3.067746224002211e-02   +1.183129167287104e-02   +2.569532109782774e-02   +1.918966849315438e-02   +3.206489231434132e-02; +2.117661338198470e-02   +4.235044022191389e-02   +3.026860240273917e-02   +2.824119352872088e-02   +4.484833000411882e-03   +1.954144573902493e-02   +2.547576414811813e-02   +3.050238784757177e-02   +3.557592423313993e-02   +3.528947905257412e-02   +2.106982972634936e-02   +2.153674515000161e-02   +3.810558226308012e-02   +2.822649178526517e-02   +1.620064345542864e-02   +2.410405380177452e-02; +2.033690045355591e-03   +5.308306345519805e-03   +3.561469193991778e-02   +5.258388408753777e-03   -5.276827674863586e-04   +2.406492393282420e-02   +2.872303157825794e-02   +1.503198988163553e-02   +1.690359199933229e-02   +3.748828764313880e-02   +2.514024131530332e-02   -9.530588431584544e-05   +1.805192854500214e-02   +1.323557480044027e-02   +4.712943373927136e-03   +3.533552824585086e-02; +5.631207701867366e-05   +3.688211164296415e-02   +1.710027917288763e-02   +4.145459791962834e-03   +1.990008291365454e-02   +3.027599641296033e-02   +2.420024148611425e-02   +1.593662531286590e-02   +1.083531647113520e-03   +2.781811791432065e-03   +3.081368443832129e-02   +6.075290047315302e-03   +3.065338704532701e-02   +2.028425633271589e-02   +2.463889606358096e-02   +1.437768293249277e-02; +3.078587143214386e-02   +3.017340057221489e-02   +3.589260219160215e-03   +2.775358555142824e-02   +1.387460451355093e-02   -1.658117644783210e-04   +2.761537028571171e-02   +1.223360900038427e-02   +3.183083427321886e-02   +6.009857573544541e-03   +3.034124540337758e-02   +4.490783395300975e-03   +1.566278159856029e-02   +4.641724559024116e-04   +2.455079032627741e-02   +3.950253683198096e-03; +1.935218530527971e-02   +8.310150741759424e-03   +5.180250484158818e-03   +1.334990230416103e-02   +5.362750385525765e-03   +1.426580211133326e-02   +1.144107856236093e-02   +1.547513868986473e-02   +3.544414226185235e-02   +9.499754944612479e-03   +3.559003825950839e-02   +3.985743427816276e-02   +4.569031790385460e-02   +2.654127343007833e-02   +2.147314199676143e-02   +1.161409615826088e-02; +1.154034068983951e-02   +5.370128338160850e-03   +3.665902715564493e-03   +8.463822003577608e-03   +2.186148806136101e-02   +1.774079638292572e-02   +1.813964418545285e-02   +2.255490180875626e-02   +9.648784383366920e-03   +1.304781957708598e-02   +3.095218132357655e-02   +4.525655051072152e-02   +1.935812896149393e-02   +1.716298369734220e-02   +4.997950866602105e-03   +2.733838608861924e-02; +1.246170020340620e-02   +2.012203588371829e-02   +1.181103371753042e-02   -6.939204993468061e-03   +1.172794706547016e-02   +2.529004050125015e-02   +3.440782433253618e-02   +3.890157180128594e-02   +1.590387571945388e-02   +3.631723119522966e-03   +3.056197303375523e-02   +1.428434460877679e-02   +3.270802967771040e-02   +3.560886680196172e-02   +2.028772451007060e-02   +9.232134886709454e-03; +4.510447166724806e-04   +1.408040535190386e-02   +6.076144700307064e-03   +2.163975128765113e-02   +1.129457257254136e-02   +3.015052922364681e-02   +1.409681781795051e-02   +7.928730987994731e-03   +3.396749833464938e-02   +3.510028281401360e-02   +6.048081361427302e-03   +2.225174521522303e-02   +3.483340837772975e-02   +1.078399462683356e-02   +2.403841445380026e-02   +1.405886947653382e-02; +3.818298329324811e-02   +4.258394742978132e-03   +1.083792920753098e-02   +1.620191661074171e-02   +2.588138416168914e-02   +1.995220919476058e-02   +2.193346529156426e-02   +3.917587358085272e-02   +1.549979786561430e-02   +1.377612423799243e-02   +2.233776461276719e-02   +2.257426090602035e-02   +9.725103561599290e-03   +3.759524495045825e-02   +3.178745925815432e-02   +1.041058377117408e-02; +1.186670973325339e-02   +3.842332399114571e-02   +2.105826146243930e-02   +3.210898355078102e-02   +3.883715165388002e-02   +2.846781717937873e-02   +1.668280486884227e-02   +5.452297734997360e-03   +2.734185593595887e-02   +1.983656546060121e-02   +4.973436249537496e-03   +3.235222248458902e-02   +2.580662153320939e-02   +2.745897770948988e-02   +2.714449697868835e-02   +7.100078385612160e-03; +3.246641192123472e-02   +5.062506564152621e-03   +2.421728304050654e-02   +1.794998202600791e-03   +1.859396517615105e-02   +2.236985510194661e-02   +2.167437466495391e-02   +8.144155619060560e-03   +3.249421704385418e-02   +3.309793446307104e-02   +9.582736817941660e-03   +2.727976323966380e-02   +3.976094299120476e-02   +2.733266440611647e-02   +9.642855703743970e-03   +4.115286931053798e-03; +9.944630591383166e-03   +8.633945495447765e-03   +3.168148113610621e-03   +2.185017330733733e-03   +5.915250967438832e-03   +3.386457285416535e-02   +3.686932293008807e-02   +3.196042671112699e-02   +1.376133051994801e-02   +2.391027872427937e-02   +3.091398588211943e-02   +2.607276555144820e-02   +2.354027969526027e-02   +3.264371483021691e-02   +2.540514026916986e-02   +2.787381114738097e-02; +1.926822068811131e-02   +6.283821522907551e-03   +1.797428448854812e-02   +3.059789308073461e-02   +1.952402580333315e-02   +1.697559918391901e-02   +5.268857096915761e-03   +1.395727485965187e-02   +9.968700186868058e-03   +2.644961312886667e-02   +9.576284491595559e-03   +1.892857478290884e-02   +1.110442033895044e-02   +5.904831503788624e-03   +5.232351569082460e-03   +1.345450699448655e-02; +1.757931640546649e-02   +6.136622230382526e-03   +7.370644691924735e-03   +3.047122773046887e-02   +3.600782169191969e-02   +6.040310966441373e-03   +1.010233259077790e-02   +3.226513662895551e-02   +2.928757716288598e-02   +4.257668646412218e-03   -5.411689304412291e-04   +1.921932713470840e-02   +2.574718592171287e-02   +1.902519172843630e-02   +1.649147203345433e-02   +2.235904790816971e-02];
L2I_L1I_iGABA_netcon = [+3.713088739590655e-02   +1.135819077515252e-02   +9.356465930556260e-03   +3.723740132271828e-02   +4.325906266391475e-02   +3.189810878451686e-02   +1.689922912792892e-02   +3.066297486617417e-02; +3.281232703663568e-02   +3.418979955713008e-02   +2.464850718929389e-02   +1.272184659861926e-02   +1.981215049161157e-02   +2.553430710570853e-02   +3.258432139709237e-02   +1.017364790767944e-02; +5.004840358054033e-03   +9.850701646185419e-03   +1.065429084645180e-02   +2.693880376517116e-03   +3.191560240497254e-02   +3.901252563036879e-02   +4.536412038809967e-03   +2.230731166540286e-02; +1.209880980240472e-02   +3.359158015900190e-02   +2.420387177706582e-02   +2.647347466076717e-02   +1.960609910860188e-02   +1.573266886750947e-02   +1.484323097696986e-02   +3.437391039804213e-02; +7.110548399793679e-03   +7.243101554144950e-03   +2.399783258027915e-02   +2.249731824276407e-02   +1.440655352399468e-02   +3.214424059096114e-02   +1.703002240597665e-02   +2.719010673757856e-02; +2.740758963931306e-02   +2.385004446889695e-02   +3.573161209239544e-02   +2.081170603620540e-02   +1.324864708516000e-02   +2.472847918608156e-02   +1.897766862291165e-04   +2.791947565556804e-02; +1.218376817282123e-03   +1.427746647713619e-02   +1.489389795019055e-02   +1.268397587030580e-02   +3.036070904007337e-02   +1.098678016301663e-02   +1.069187676662574e-02   +2.791728741593106e-02; +2.179402537223544e-02   +1.784516577954457e-02   +2.952123536484404e-02   +1.648475257276119e-02   +1.046778141936233e-02   +2.714901635452502e-02   +2.021726797865663e-02   +9.202143942975359e-03; +1.989002594322881e-02   +2.314976321721758e-02   +1.002192606882782e-02   +7.617308217850068e-03   +1.215288394141990e-02   +5.227039321726966e-03   +1.537259566581581e-02   +3.707553925750189e-02; +1.586110504883986e-02   +2.369628504010811e-02   -1.916872603213444e-04   +1.615807287355182e-02   +8.624465835505080e-03   +2.434034906910520e-02   +3.600485241357894e-02   +2.791173002966245e-02; +1.339923678489372e-02   +3.515830537633052e-02   +3.395880547823295e-02   +1.462211168886591e-02   +2.528221845167787e-02   +3.019622875059092e-02   +8.710726121030682e-03   +1.512803664685936e-02; +3.353504213731322e-02   +1.654903479480592e-02   +2.567749148636135e-02   +1.674903191223172e-02   +3.463335478701697e-02   +9.004367093108423e-03   +2.465313198008988e-02   +1.082308327003719e-02; +1.245674912104540e-02   +3.360536083085808e-02   +3.625802129424096e-02   +4.384038137428679e-03   +2.129469328696330e-02   +9.351676395246648e-03   +1.446243609222972e-02   +2.491846070303262e-02; +3.181171921448703e-02   +1.075511897714917e-02   +3.736499923446158e-02   +2.354777300539009e-02   +3.141087082573676e-02   +1.277918233146454e-02   +3.389908670202702e-02   +1.025015416740588e-02; +4.000931726205088e-02   +1.296334149937414e-02   +9.167951708653017e-03   +4.261525071396937e-02   +2.953154438284810e-02   +2.953463786715850e-03   +1.636327580854348e-02   +2.978866196085452e-02; +8.647450316037938e-03   +2.790133850488447e-02   +2.163705385535450e-02   +2.310566171351645e-02   +3.318276778550874e-02   -6.790160203423276e-04   +3.499477226853675e-02   +1.273940847115407e-02];
L1I_L2I_iGABA_netcon = [+2.197966882655601e-02   +2.301426573419997e-02   +1.575980314902062e-03   +3.635696749699285e-03   +2.004808861263459e-02   +1.625412013530091e-02   +3.627414778926140e-02   +2.381341855565140e-02   +1.515615684241531e-02   +3.445617087763930e-02   +3.779455982300596e-03   +7.975912533729052e-03   +5.882601259902046e-03   -2.036649867851484e-03   +1.010350934740000e-02   +3.369628165015984e-02; +3.325401608639601e-02   +2.183696248382001e-02   +1.875863152857705e-02   +1.731641026065740e-02   +3.481456247953750e-02   +1.936777267718208e-02   +1.860239109380873e-02   +3.825869363082285e-02   +1.990426864232354e-02   +3.789889341551512e-02   +2.624760885433159e-02   +1.590366297347953e-02   +2.025832836173048e-02   +3.531422704083768e-03   +4.655702857774406e-03   +3.203300869897741e-02; +3.131781453224042e-02   +2.368284937706613e-02   +6.101538087711023e-03   +2.900028967129874e-02   +1.490653306678354e-02   +3.757104817225185e-02   +2.427526833161881e-02   +2.407938693927187e-02   +1.409707131403619e-02   +2.259118741984241e-02   +2.269455357670478e-02   +1.731043990101893e-02   +1.902159911490400e-02   +5.139575371916300e-03   +2.403450237352307e-02   +7.440956262319040e-03; +1.676436938031290e-02   -5.178395411111187e-04   +2.529701718653765e-02   +3.181014166692016e-02   +7.354481014604752e-03   +2.784998200983321e-03   +1.460782600878355e-02   +1.280280813030387e-02   +2.251460218607470e-03   +2.778040716100308e-02   +1.689625797881377e-02   +1.331568095842236e-02   +9.780940055728687e-03   +9.380658692558527e-04   +2.479752455296853e-02   +1.811914343820196e-02; +9.039741619163167e-03   +3.259414981780172e-02   +3.159778709658231e-02   +2.605518014885461e-02   +2.502370514733414e-02   +2.541698392732901e-02   +2.355742361914407e-02   +3.729305059183768e-02   +2.001512118253848e-02   +4.793444455216000e-03   +1.002152281984227e-02   -7.153363808096764e-04   +8.900051365653071e-03   +3.872202293417144e-02   +7.396445155598869e-03   +2.378550830119811e-02; +2.392970302243253e-02   +2.580736883569501e-02   +3.890608431772692e-03   +3.782630961859362e-02   +2.071955967887676e-02   +3.987801820357609e-02   +2.889254805124056e-02   +3.470533938795288e-02   +2.651850586368721e-02   +2.616428497908417e-02   +3.257798944694214e-02   +2.642435405445494e-02   +5.452581774008980e-03   +3.771281065162198e-02   +2.562341646224441e-02   +3.240941562458374e-02; +3.533204527345259e-02   +8.540758165496258e-03   +3.065367922314203e-02   +3.575011150261742e-02   +1.391601504128810e-02   +4.123339164510530e-02   +2.056511515553758e-02   +1.709133606328929e-02   -1.855099098016744e-03   +2.275516027094064e-02   +1.377495036220485e-02   +1.049277192678504e-02   +3.190437860960836e-02   +1.465069094937396e-02   +3.488509765814548e-02   +2.259682607747607e-02; +2.729268944607145e-02   +3.517601072850342e-03   +3.515366081417133e-02   +2.853283976946695e-02   +3.571213208018487e-03   +3.111332379309888e-02   +2.915497058798915e-02   +2.765015268102191e-02   +1.571290309617837e-02   +3.364956483044481e-02   +7.421160400536193e-03   +1.712708966763525e-02   +1.956844488889824e-02   -5.505790878112005e-03   +3.359283266145520e-02   +2.048668323135050e-04];
L2E_L1E_iAMPA_netcon = [+3.421540086320988e-02   +1.190926431701523e-02   +7.418777523033513e-03   +4.207814233196311e-02   +7.461373912381619e-04   +1.495972595289276e-02   +2.754379390475446e-02   +4.602344610747030e-03; +2.865129803577752e-02   +3.707823784130404e-02   +2.404454462572142e-02   +1.167093599838475e-02   +2.132468119888391e-02   +1.339709467874529e-02   +3.601741645420727e-02   +1.836030242278528e-02; -2.301950644448118e-03   +5.249590959408515e-03   +5.426689923754730e-03   +1.137481256073568e-02   +2.345154975322798e-02   +3.751397542601467e-02   +1.764829533123666e-02   +6.570495972894246e-03; +9.799956472885622e-03   +3.085613502682689e-02   +1.403607274729077e-02   +2.608964632444606e-02   +3.405969058846915e-02   +1.223666876215815e-02   +3.072458509455706e-02   +3.673480538430609e-02; +9.332140672247129e-03   +3.762610255349057e-02   +1.193897125194208e-04   -3.479906324114617e-03   +3.549016127578030e-02   +3.705207003487389e-02   +2.807460800089877e-02   +1.627963235374465e-02; +2.406119177397476e-02   +1.486003109966550e-02   +3.378018947557544e-02   +3.148314770402943e-02   +2.263808959087724e-02   +7.933832799254378e-03   +2.338554873019395e-02   +2.859306285345098e-02; +7.476846513236652e-03   +1.441673991776521e-02   +4.704236968615889e-03   +1.160582746244277e-02   +3.171219121333213e-02   +1.641487607687128e-02   +6.633591259950371e-03   +1.486078727705410e-02; +7.213926079792253e-03   +2.771381200517562e-03   +1.970453279934436e-02   +2.432501556059798e-02   +1.243824163683899e-02   +3.636646041673901e-02   +3.424108593034061e-02   +3.044127805572988e-02; +1.348911225317253e-02   +3.265264106854422e-02   +2.745603431935554e-03   +9.907692362880598e-03   +5.698286263071054e-03   +3.898071460613027e-02   +1.483654612483603e-02   +6.959697449105106e-03; +1.074880250739461e-02   +8.241782528969033e-03   +3.559363188764900e-02   +1.485996214498146e-02   +4.147465599204445e-02   +4.130329553115688e-03   +7.654937321238784e-03   +2.896131173145099e-02; +2.426218356422914e-02   +1.547276374261737e-02   +2.116263892596691e-03   +2.425107849090581e-02   +1.459855128632997e-02   +1.066110496329019e-02   +2.714221647611346e-02   +2.665725589437466e-02; +8.224602535789313e-03   +1.584076832579237e-02   +3.379853002173358e-02   +2.435316158580347e-02   +2.092919626805713e-02   +7.119335878700158e-03   +3.381148636572465e-02   +6.309003437758199e-04; +2.243064956795320e-02   +2.789981709160294e-02   +4.709301983397850e-03   +5.075449095832281e-03   +3.592214826866282e-02   +2.566441337914032e-02   +1.813736779351877e-02   +3.909685573544971e-02; +1.890268308792653e-02   -4.621948568153594e-04   +3.232610320212496e-04   +3.133161682265215e-02   +3.202093206325106e-03   +8.409581903881349e-03   +1.631562119177738e-03   +3.072815950463760e-02; +1.258922209602711e-02   +9.362053352854269e-03   -2.558495530059607e-03   +3.485470780821935e-02   +9.300336770629056e-03   +2.434250243768898e-03   +1.486901535616190e-02   +4.580456501777919e-03; +1.052877914724113e-02   +1.833340112930654e-02   +3.465923408239516e-03   +1.671953221052681e-02   +3.751249186510784e-03   +2.316461488491614e-02   +3.526460029180614e-03   +3.246407935906678e-02];
L1E_L2E_iAMPA_netcon = [+6.047125663695010e-03   +8.766561851305230e-03   +3.544807921119190e-02   +3.323885572217781e-02   +1.432900662259971e-02   +3.725083544662650e-02   +2.018243474684612e-02   +4.134302527623639e-02   +7.931701879456861e-03   +2.074131236594584e-02   +1.930077404067352e-02   +2.536996407711962e-02   +1.341028793665749e-02   +2.292394675658585e-02   +2.563723675415152e-02   +2.265172102932598e-02; +1.427995295248919e-02   +2.583542628864595e-02   +2.034382689656724e-03   +1.199842347562056e-02   +1.733693510594330e-03   +2.661879641796012e-02   +4.717667342951972e-03   +7.451850785655270e-03   +1.044678557586227e-02   +1.433863061501705e-02   +1.462006426199278e-02   +3.536055516176807e-02   +3.159531813022969e-03   +1.061716383997914e-02   +1.862278589159751e-02   +1.160246149155799e-02; +1.502843231822468e-02   +2.433884577882836e-02   +3.772743943184108e-02   +3.105242950329400e-02   +3.654816431425429e-02   +7.021939010168336e-03   +1.452676421755868e-02   -5.517746487692405e-03   +1.737285445986265e-02   +2.300547007096299e-02   +1.157782610439876e-02   +4.389590594677053e-03   +2.509008516203905e-02   +2.125733008130053e-02   +3.771549853776930e-02   -1.607484406297492e-03; +2.721238351800708e-02   +1.566709509736666e-04   +4.783653681063571e-03   +9.123274348946921e-03   +2.930100588949540e-02   +1.058441890789780e-02   +3.643351158498668e-02   +3.710002877076753e-02   +2.936969848701499e-02   +2.920303655065282e-02   +9.397823584674742e-03   +1.755516925923956e-02   +3.876541827431596e-02   +1.344321994629632e-02   +3.649717860934358e-02   +3.700086605780502e-02; +3.908616435029464e-03   +4.408127178901325e-02   +2.575368738713754e-02   -3.056152158673248e-03   +7.061035069367732e-03   +2.938274975648338e-02   +3.298484853847267e-02   +2.078581422781190e-03   +2.426452767259938e-02   +1.123132345334442e-02   +1.562906880993602e-02   +2.958302547036973e-02   +9.169273673505151e-03   +2.241819624470005e-02   +3.610674427064135e-02   +1.069868611626846e-03; +2.272620443511377e-04   +3.199171961896383e-02   +1.266085531974914e-02   +3.684227054019763e-02   +3.729622646670507e-02   +3.476226901816572e-02   +1.482003484579754e-02   +3.013348726798717e-02   +1.309923778633164e-02   +1.726669498307576e-02   +2.992841769537446e-02   +3.824216054414888e-02   +3.524817994726465e-02   +2.644704599406663e-02   +9.242338045388057e-03   +1.810526270026789e-02; +7.767729068632516e-03   +1.005054991341906e-02   +2.603680366581360e-02   +7.688137142385335e-03   +1.410876198103964e-02   +1.821688532924297e-02   +2.558888249335234e-02   +2.457013328341683e-02   +2.354366410737015e-02   +2.888311800715801e-02   +2.871698941740733e-02   +5.931926185770145e-03   +1.410202933899759e-02   +2.683921481857021e-02   +1.206946178187418e-02   +1.052124089343657e-02; +4.821751750262500e-03   +2.056614608613051e-02   +2.257056580066854e-02   +1.493314768871050e-02   +2.610928410695903e-02   +3.734187103811105e-02   +3.402739839135810e-02   +2.364023289803178e-02   +3.597416930410614e-02   +1.737782178628576e-02   +1.215641602451025e-02   +3.755881946691050e-02   +2.946133194033474e-02   +2.914427138262438e-02   +1.081452533527239e-02   +7.554714476730131e-03];
L2I_L2E_iAMPA_netcon = [+2.209358837686261e-02   +1.365946696366855e-02   +3.368765724649109e-02   +2.070298193626862e-02   +3.379571022210988e-02   +2.655224821230050e-03   -1.541073869689683e-03   +3.166086404144700e-02; +6.809339456573430e-03   +5.639323872808081e-03   +6.053865300153410e-03   +2.884344987007596e-02   +2.850144399097823e-02   +1.461843365000403e-02   +2.908005340064612e-02   +2.241445042042540e-02; +2.856492356124481e-02   +3.090114620006710e-02   +3.262454042838631e-02   +2.660912712650391e-02   +1.992644108086512e-02   +1.867552043025320e-02   +1.323777583238614e-02   +2.527878874028895e-02; +1.177528076186687e-02   +1.242070385387848e-02   +3.643124485792919e-02   +1.399098034512742e-02   +3.679098207748686e-02   +6.686301681378615e-03   +8.714514839204959e-03   +3.475137176776814e-02; +2.488949418464172e-02   +3.519455852724782e-02   +1.625901977012690e-02   +2.201127566246819e-02   +3.291075948593329e-02   +2.429022411108670e-02   +1.539950014319449e-02   +2.541509223306244e-02; +2.894681114688836e-02   -3.360971586476585e-03   +3.383348771160195e-02   +2.935770452046296e-02   +1.964465628472841e-02   +1.182795633770241e-02   +6.055235368475557e-03   +3.126586325732222e-02; +3.536733981637664e-02   +1.871506499809756e-02   -1.246228435852165e-03   -2.094457565679041e-03   +8.912427173967633e-03   +6.888815014229079e-03   +8.353857102524630e-03   +1.100082200306149e-02; +3.519888375226055e-02   +7.610613958233052e-03   +1.758232526969252e-02   +1.883431316972213e-02   +3.315857802760090e-02   +9.717378067054656e-03   +5.802360468210859e-03   +7.594948892509957e-03];
L2E_L2I_iGABA_netcon = [+3.609988956840186e-02   +8.029796180510633e-03   +6.661842577028641e-03   +7.511594508904794e-03   +3.113483013716041e-02   +1.652157727292811e-02   +2.585304205816212e-02   +3.867765746339578e-02; +1.476327719201896e-02   +1.716889629133824e-02   +9.352833359968286e-03   -1.578231500085046e-03   +3.798616351221137e-02   +3.137338815797405e-02   +2.853925402115072e-02   +2.101423824658820e-03; +2.183987239435203e-02   +1.031228500385249e-02   +1.990922960412962e-02   +3.953783464095909e-03   +1.173477653432435e-02   -4.430693830660810e-04   +4.281498828610480e-02   +3.041993542671157e-02; +2.690915460874805e-02   -3.796400584206079e-03   +6.797647450811828e-03   +2.602704391755022e-02   +3.156319500023799e-02   +3.330457363868178e-02   +1.443440071727884e-02   +2.251634734693660e-02; +4.050158922197534e-03   +2.829817919719913e-02   +2.911493372621440e-03   +2.784969683452029e-02   +1.444366408666740e-02   +1.486104997261768e-02   -8.161079101323407e-04   +7.207913900743374e-03; +2.535293911632289e-02   -7.614499593217796e-03   +2.266977654571637e-02   +3.189086140486785e-02   +3.379589856648416e-02   +1.680850060191266e-02   +3.852697562282709e-02   +3.212744706959329e-02; +6.437185452584517e-03   +4.456791962266585e-02   +1.170066197778394e-02   -3.746209615755037e-03   +3.183608384974538e-02   +1.364624753875996e-02   +1.761308707540080e-02   +1.817022344195842e-02; +2.956343032448998e-02   +1.227220187105436e-02   +1.869407189525208e-02   +1.264663322366477e-02   +1.481393018506036e-02   +3.006614941742344e-02   +3.170198587523792e-02   +2.625069648312296e-02];
L3E_L2E_iAMPA_netcon = [+1.649160951913807e-02   +2.596055415451901e-02   +5.478743935011249e-03   -2.012534603980538e-03   -1.033051340151692e-03   +3.907539543291970e-02   +1.606783907090003e-02   +3.151887990147383e-02   +1.994833599416071e-03   +6.152726315435223e-03   +1.643878751204702e-02   +3.365198547749902e-03; +7.820044283865422e-03   +3.722448053832858e-02   +1.310772048855638e-02   +1.682385732274612e-02   +2.511945671010949e-02   +2.223633540815507e-02   +3.393570936682476e-02   +3.369832709439450e-02   +2.238293696296318e-02   +3.702778771312367e-02   +1.428455468908113e-02   +1.118107664802479e-02; +6.664985215183486e-03   +3.460738122962136e-02   +3.880938164268822e-03   +3.010978234887157e-02   +1.762025417678295e-03   +4.672594270875852e-04   +2.322340263094987e-02   +3.714988989702955e-02   +2.256895215119713e-02   +1.656986924434699e-02   +8.709620809953265e-03   +2.411624592146248e-02; +2.421410633219816e-03   +1.612662717805769e-02   +3.226428810977758e-02   +1.578082773282281e-02   +5.093256444243196e-03   -1.449763388695072e-05   +1.342819919340167e-02   -1.924255178560695e-03   +7.017156810070402e-03   +1.396603200724204e-02   +9.331118266999663e-03   +1.470100219016538e-02; +3.450851635966230e-02   +1.173031993859671e-02   +1.474424610248890e-02   +3.260668567191311e-02   +2.737400818830787e-02   +1.171406413332115e-02   +3.300126607738081e-02   +7.566693959725668e-03   +3.128742355269642e-02   +1.807626909364375e-02   +3.245462546419736e-02   +1.431847209702515e-02; +3.164746325582969e-02   +2.405640197846924e-02   +2.734571969302744e-03   +1.562485833168174e-02   +2.023641757724086e-02   +3.634192059464873e-02   +4.130268573811101e-02   +1.184248805259488e-02   +2.043968417750880e-02   -1.266260970304327e-03   +2.537432126208605e-02   +4.312040088292808e-03; +2.973496622778215e-02   +1.326339621865656e-02   +1.945670144899978e-02   +8.291805881431278e-03   -3.666862145322016e-03   +1.838647166627052e-02   +5.408106402459303e-03   +1.874121905884002e-02   +1.012589766411972e-02   +1.850036175584293e-03   +6.472607236787622e-04   +1.882674961340140e-02; +2.978604807752496e-02   +6.738361469248566e-03   -8.678363791215090e-04   +1.379040952575292e-02   +1.777182872145242e-02   +1.337893367071778e-03   +5.869256250123782e-03   +1.278740736047637e-02   +1.996384080306200e-02   +3.062969755227106e-02   +3.490789047823572e-03   +2.180146410720282e-02];
L3I_L2I_iGABA_netcon = [+4.071415210658037e-02   +2.385705131100959e-02   +2.548038852408264e-02   +1.626289218694340e-02   +3.375833945786576e-02   +2.120583134124688e-02   +5.515367195380436e-03   +9.272855851067015e-04   +3.707202972291695e-02   +1.927344354445258e-02   +4.245132915103567e-03   +2.967487411049629e-02; +2.836590286064509e-02   +4.348040577205746e-02   +3.136669932633832e-02   +9.468105513607812e-03   +1.731114996828671e-02   +2.418049826039100e-02   +3.267326394266296e-03   +3.827134102478350e-03   +2.260401629290041e-02   +2.511996660527670e-02   +4.326756143640284e-03   +2.591541437987609e-02; +4.668628653995296e-03   +2.671748866061633e-02   +3.383826939178484e-02   +4.809855772491406e-03   +2.784468801595604e-02   -1.201814924059250e-03   +2.950912935343439e-02   +3.979256164493895e-02   +2.726754079048530e-02   +2.688893164549518e-03   +2.139659505826771e-02   -8.557060250670770e-05; +3.691795776923537e-02   +2.049313919461176e-03   -4.178913370421807e-03   +2.768018399554757e-02   +3.522934500822687e-02   +1.936543819218449e-02   +2.756443040256854e-04   +3.094305604048394e-03   +3.896955714878458e-02   +2.909263484792565e-02   +3.563796631070280e-02   +2.672103530386553e-02; +1.069512756930776e-02   +4.528515423089435e-02   +8.715813346996820e-03   +1.282838490292150e-02   +2.065245390449274e-02   +3.991060333870104e-02   +1.017583000158818e-02   +4.192175169959994e-03   +3.450968973223863e-02   +2.379100754778606e-02   +5.133367740861945e-03   +9.523015826383865e-03; -1.579403049825670e-04   +2.450175858368870e-02   +1.344816359558361e-02   +2.499399228585599e-03   +1.257981504494745e-03   +2.261207476083819e-02   +2.763930042399131e-02   +2.493207137391047e-03   +3.151484508303690e-03   +2.698263689885457e-02   +2.467567055438767e-02   +7.452955491038497e-03; +2.516691872222837e-02   +3.026272567390074e-02   +2.398010912944092e-02   +2.803799953818045e-02   +1.955971366562984e-02   +9.426736416228158e-03   +1.997955723883433e-02   +4.095271982924698e-03   +3.509723237884630e-02   +1.177475619864134e-02   +2.052981293672359e-02   +2.641290311518745e-02; +2.119654896757363e-02   +2.898594928026902e-03   +1.227674539702017e-02   +2.136647931468941e-02   +1.738126829001904e-02   +4.873215057215371e-04   +6.568219022745671e-03   +9.076367518699875e-03   +2.362836789668647e-02   +3.562646403266095e-02   +7.150213614011203e-03   +1.184106851927523e-02];
L2E_L3E_iAMPA_netcon = [+2.735130749224963e-02   +1.887610482128145e-02   +1.366515437522757e-02   +2.976417112514371e-02   -1.511790741257609e-03   +2.555231287186845e-02   +3.087081034712067e-02   +3.550466597714698e-02; +2.165619674296678e-02   +2.817725294795873e-02   +2.664912820803909e-02   +2.289446541002011e-02   -7.317704745307945e-05   +2.239229572983630e-02   +3.593410559470227e-02   +2.582910025264600e-02; +2.781514653380962e-02   +3.392097304406141e-02   +3.488902558830605e-02   +3.564459388179877e-02   +2.944872219606840e-02   +3.011194756554136e-02   +2.867899510764725e-02   +2.465763450900002e-02; +1.450850497646079e-02   +3.530343556990187e-02   +3.250264063375596e-02   +2.147546467398653e-02   +1.708518002567786e-02   +1.764558884191832e-02   +1.048009672811757e-02   +3.385065091307806e-03; +6.208841426343278e-03   +2.030440315800528e-02   +8.665294072085921e-03   +5.105861743340931e-03   +6.319613770908772e-03   +2.044654360866340e-02   +3.602182523161574e-02   +3.043403911693498e-02; +1.905277391125294e-02   +3.928695882839233e-02   +3.215954119120610e-02   +2.399994143527195e-02   +1.856939820283829e-02   +3.734355472579316e-02   +2.258925256540050e-02   +3.341925238856994e-02; +1.393666006246695e-02   +1.808500469494229e-03   +2.050134387259668e-02   +7.373084708563044e-03   +1.463200553643099e-02   +3.674625854122478e-02   +9.131295146340359e-03   +2.544104544195093e-02; +3.277254215743015e-02   +2.330176979802461e-02   +2.058569112315825e-02   +3.126956054485742e-02   +1.422633366088905e-02   +3.166274526948637e-02   +2.416744039853391e-02   +1.729752118781494e-02; +1.014752712740710e-02   +2.270228855953783e-02   +4.070531989383770e-02   +2.410169870647234e-02   +2.141157853037349e-02   +5.760982832028054e-03   +2.565864237790513e-02   +2.607567666199549e-02; +1.306462534094809e-02   +1.177131531719705e-02   +3.075527870236114e-02   +3.326778171330226e-02   +4.050384818276738e-02   +1.917015512021146e-03   +2.416281170353996e-03   +2.713825290315815e-02; +2.024964786954551e-02   +9.364274670293023e-03   +2.925386209351125e-02   +2.602984877485669e-02   +3.647994674611617e-02   +4.256963215045872e-02   +9.973589804378579e-03   +1.245023062302169e-02; +9.738868481412720e-04   +2.773164533353077e-02   +1.310155849121618e-02   +3.060825606364229e-02   +1.825951292970299e-02   +2.855121744320630e-03   +3.047277454909065e-02   +3.215621874841560e-02];
L2I_L3I_iGABA_netcon = [+3.305700510390996e-02   +1.361088148438573e-02   +1.064572550532907e-02   +2.054211170706630e-02   +3.433038041265937e-02   +3.482713572139049e-02   -4.914085943151803e-03   +1.863764552688702e-02; +1.838858197080918e-02   +1.886370389511836e-02   +2.940033456010301e-02   +8.747240969001186e-03   +3.032554656788029e-02   +3.047600383672912e-02   +2.089086557155942e-02   +1.340997628917067e-02; +2.848773979243181e-02   +3.116871681778991e-02   +3.459449032473153e-02   +2.575472650578327e-02   +2.055686009811300e-02   +2.205182106596713e-02   +1.568000583277391e-02   +1.436477013838281e-03; +6.391092202698802e-03   +3.388943028523748e-02   +3.825601345047099e-03   +1.449107793492994e-02   +1.323806968269918e-03   +1.149992847892815e-02   +1.869983835910745e-02   +3.815156276304384e-02; +1.612054415825320e-02   +1.689278938629710e-02   +2.016944245909676e-02   +1.827138592400313e-02   +1.485370709517471e-02   +1.910864943994862e-02   +2.729500505185532e-03   +8.010012193505077e-03; -1.875864678075491e-03   +5.776555571844017e-03   +1.519833733054238e-02   +6.200371281245624e-03   +1.340392539729013e-02   +2.199377399824013e-02   +1.373591590565104e-02   +3.206185581847994e-02; +1.368169553964146e-02   +1.534557028001599e-02   +3.747795517852327e-02   +2.868003994155354e-02   +2.949577042272645e-02   +9.024167184809355e-03   +1.613615285070951e-02   +1.367034282414898e-02; -7.582453640286792e-05   +3.572555033242865e-02   +8.086000172357879e-03   +2.837192592835892e-02   +6.408472363522369e-03   +3.165407142709972e-02   +2.425857515906654e-02   +2.533335522884516e-02; +2.859253767261100e-02   +1.356449880090421e-02   +3.507858774911458e-02   +3.331703675627040e-03   +1.877456492331777e-02   +7.606857422639344e-03   +1.198029610227622e-02   +2.094230128393458e-02; +2.945764706836617e-02   +1.967150268712628e-02   +1.640308546221384e-03   +1.742472099702640e-02   +1.623153095972818e-02   +6.022062101828154e-03   +7.044766257397619e-03   +9.709794226961986e-03; +2.734677587403055e-02   +3.879120848192331e-02   +2.368055307093736e-02   +2.473800940131451e-02   +1.358668591063819e-02   +1.489817471293380e-02   +3.533450479854983e-02   +9.738410712251828e-03; +2.691456462875445e-02   -4.823899695033130e-03   +1.417218770560681e-02   +4.699767675962678e-03   +8.146135226473391e-03   +3.528012620953868e-02   +2.508952514994955e-02   +2.595642794939331e-02];
L3I_L3E_iAMPA_netcon = [+1.704713102266659e-02   +3.638196437428428e-02   +5.945289355397495e-03   +2.406230284802044e-02   +2.682289089486548e-02   +2.045999429027056e-02   +1.608317088558727e-02   +2.026534555341637e-03   +2.071303423014044e-02   +1.420589043717250e-02   +9.613193118665941e-03   +5.204615678293380e-03; +1.774543437678022e-02   +2.985193139630360e-02   +1.434773353245121e-02   +3.785285536530887e-03   -7.484416967695303e-04   +2.063979148218521e-02   +2.490734110818411e-02   +1.371240808293535e-02   +1.199535648421513e-02   +1.667802647628538e-02   +3.053107202548198e-02   +2.197241637067109e-02; +3.353012501859928e-03   +2.021254612977267e-02   +1.475460551204541e-02   +2.479289030488445e-02   +2.057366059173785e-02   +1.690362433839176e-02   +1.888097985934665e-02   +1.073622087082695e-02   +1.564444735861753e-02   +2.080285667678565e-02   +1.224062141456083e-02   +2.203971185907216e-02; +1.912394479614711e-02   +2.818020914498015e-02   +2.496366941172224e-02   +1.568011697923462e-02   +2.375713545066964e-02   +3.216476659683337e-02   +2.924427180867892e-02   +7.387161727321196e-03   +3.538800610496532e-02   +3.385712149254557e-02   +1.341472968298115e-02   +2.234505181489211e-02; +3.129160137202909e-03   +1.336734714981985e-02   +7.312065090047660e-03   +3.129813477756068e-02   +3.075536736151622e-02   +1.927688548253786e-02   +3.645816815437906e-02   -1.755207879374912e-03   +3.229433138387384e-02   +1.701921096036276e-02   +9.674126417147847e-03   +2.799097812289909e-03; +9.680188335344172e-03   +1.707662736792260e-02   +3.476750412338110e-02   +2.357239896604436e-02   +3.803386861886524e-02   +6.157203450428558e-03   +2.799960506445864e-02   +1.090305084896207e-02   +2.535008265458036e-02   +3.935410668775963e-03   +5.886184288456040e-03   +6.721467798329860e-03; +3.064631571687257e-02   +1.512121591861553e-02   +1.105092383738430e-02   +1.379682026147718e-02   +1.762189129875652e-02   +9.218155219260300e-03   +1.942346324947006e-02   +3.752114348707059e-02   +3.530136670443559e-02   +4.249559440678012e-02   +1.668512736060765e-02   +2.906208574676997e-02; +3.298666380859808e-02   +1.738145698975414e-03   +2.965378934283812e-02   +2.746702614705438e-02   +4.037707335542882e-02   +2.361650750216728e-02   -1.211281448696473e-03   +2.310568623913924e-02   +2.406664875967898e-02   +8.780490595005148e-03   +1.023712121042928e-02   +3.926672401989126e-02; +3.150572885827093e-03   +3.373366688782777e-02   +2.694449676174140e-02   +2.245759270241254e-02   +1.418837372460115e-02   +2.765183849584372e-02   +1.159589039786537e-02   +3.182757507364178e-02   +2.576744358344657e-02   +1.682146628797542e-02   +1.333599758457928e-02   +6.905036014215282e-03; +3.124942055354069e-02   +3.225035150860889e-02   +1.753034161679771e-02   +8.734532475679343e-03   +2.164892834083617e-02   +3.042479840896225e-02   +2.267210235441667e-02   +3.695097850555726e-02   +2.984166846114945e-02   +1.562387789701081e-02   +3.292072664155018e-02   +8.504796629699975e-03; +1.613560374291644e-02   +1.712378557044350e-02   +3.635188199161600e-02   +3.352865798629403e-02   +2.840193980714986e-03   +2.471520713598861e-02   +1.888088364981082e-03   +7.688857842758801e-03   +1.954239454052828e-03   +3.518779092180160e-02   +2.476791541818783e-02   +9.987653576039476e-03; +2.894849804676314e-03   +8.100450457855582e-03   +2.600804530399985e-03   +2.224516448096102e-02   +1.621875619770553e-02   +1.496811878281875e-02   +3.256438866122650e-02   +6.952895337672326e-03   +1.339087299035568e-02   +6.919790016000596e-03   +2.805015043592304e-02   +1.318966553329709e-02];
L3E_L3I_iGABA_netcon = [-2.975838272549529e-03   +1.738058146660144e-02   +1.126898683033117e-02   +4.097727969140315e-02   +2.792851747574812e-02   +2.668688536949829e-02   +1.672779398501377e-02   +2.361114483956847e-02   +2.103236271089300e-02   +3.001334283654008e-02   +2.304928323928374e-02   +1.053366707237438e-02; +2.961637867497693e-02   +2.870630373770454e-02   +1.448341332069674e-02   +1.270693656047640e-03   +9.953434516097317e-03   +2.685567172197789e-02   +2.436701446101996e-02   +4.145019985750530e-02   +2.900458490453887e-02   +1.782948356763205e-02   +6.732190221223412e-03   -9.732307443148788e-04; +2.160653997331181e-02   +3.570451013952582e-02   +3.250208801641530e-02   +3.399567441318545e-02   -7.350139877882292e-04   +2.554199446356625e-02   +2.324334882844612e-02   +2.726915832406597e-02   +1.265796684412021e-02   +1.362625689290964e-02   +1.122498618857939e-02   +8.787571212093713e-04; +1.087411877620937e-02   -3.420637541088935e-03   +4.751851831829425e-03   +3.037996321498829e-02   +2.638519024041679e-02   +1.115825081199951e-02   +9.963124994576314e-03   +2.047981173319035e-02   +3.898328728222903e-02   +1.263836412535665e-02   +3.661978218533125e-03   +2.282691307267481e-02; +1.596472209172559e-02   +1.697000558175640e-02   +4.190666865041794e-02   +5.410237851962499e-03   +1.405838702306906e-02   +2.971806671110808e-02   +3.803359562515434e-02   +3.553927769733783e-02   +1.260359348557776e-02   +2.522823674001198e-02   +3.609719595505520e-02   +6.209179001186529e-04; +2.545217837048527e-02   +1.342290679981657e-02   +2.888111115896740e-02   +4.983198520333723e-03   +1.054278635351777e-02   +3.895242904645339e-02   +4.399760793497402e-03   -7.154020377345967e-03   +2.812125816103916e-02   +2.640018366764701e-02   +7.170645167007345e-03   +4.390478500847571e-03; +2.011533451322730e-02   +1.394933375871557e-02   +2.006591294879015e-02   +2.438957050650376e-02   +2.255682422338451e-02   +1.615174593105579e-02   +1.022670955148163e-02   +2.660939983164114e-03   +2.098421785165927e-02   +6.715196712904568e-03   +1.215374389317746e-02   +2.492132571733532e-02; +6.249843172290236e-03   +4.830597723863263e-03   +6.572373606969144e-03   +3.603020559388983e-02   +1.390592406589098e-02   +2.588594104216006e-02   +1.910597615160411e-02   +2.572999297455561e-02   +2.818040197108673e-02   +3.223485054838128e-02   +1.126738688736502e-02   +2.383354878256199e-02; +1.140413476898889e-02   +3.862078630735978e-03   +3.365082329557397e-02   -2.421023454558015e-03   +4.051841433027905e-02   +3.215005785401805e-02   +1.274272569616564e-02   +3.003806186810302e-02   +3.267301282627841e-03   +9.151501783949294e-03   +1.363732140229013e-02   +2.204671309447920e-02; +3.214622084792815e-02   +1.179294985685866e-02   +3.390881462786555e-02   +9.045807887969666e-03   +1.047895304516964e-02   +4.257987397255655e-02   +2.452901436876723e-02   +2.069620996110411e-02   +4.017490058410644e-02   +3.651084679717134e-02   +7.313200919063099e-03   -3.431549867860111e-03; +1.818306147176619e-02   +3.945840596185675e-03   +1.454404763317717e-02   +2.663552486624462e-03   +2.078745786489022e-02   +1.939108207253997e-02   +3.717394362246317e-02   +3.025777816507546e-02   +2.161067161540712e-02   +5.141706114379966e-03   +3.098569482695215e-03   +3.182015218742579e-02; +2.702524065811779e-02   +2.069061673554394e-02   +3.553797500505128e-02   +2.489307567399273e-02   +6.814412224440677e-03   +1.435674462796833e-02   +3.561860678291193e-02   +2.816038368952432e-03   +3.137900018000578e-02   +1.928585680624443e-02   +2.170867414486915e-02   +1.363383886515167e-02];
L2E_Input1_iAMPA_netcon = [+3.754209819738935e-02   +3.628321285928515e-02   +3.026830903199330e-02   +3.743910221585490e-02   +4.338322529667669e-02   +4.243985438459142e-02   +3.849935505595272e-02   +3.353512404247786e-02];
L2I_Input2_iAMPA_netcon = [+3.429521122428297e-02   +3.924929082762865e-02   +4.261652618961341e-02   +3.489701033563887e-02   +3.157712105514662e-02   +4.096328298187527e-02   +3.835131545858328e-02   +3.253525372133035e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
