function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.898944260811524e-01   +4.548371547086817e-01   +6.807796450631438e-01   +1.534674787976625e-01   +4.342703141111807e-01   +8.660250181437853e-01   +7.673886755345025e-01   -1.605300386990561e-01   +7.373004614626082e-03   +1.757759797665180e-01   +5.836757080401642e-01   +5.605150986661716e-01   +3.521913712495697e-01   +3.675341850436096e-01   +8.085353147158739e-01   +4.683902703364066e-01; +4.904406506659549e-01   +1.882402935541080e-01   +4.738605641615454e-01   +3.600943038994692e-01   +4.235105031946097e-01   +1.802318699151402e-01   +3.450161059246488e-01   +5.832423112578499e-01   +1.125983242849522e-01   +7.608244185218291e-01   +5.075476082405177e-01   +7.293321912215405e-01   +8.910500195516845e-01   +2.320609335345945e-01   +7.274313874725340e-01   +4.026152648372378e-01; +1.108438872219795e-01   +3.081624286812695e-01   +6.458156548907259e-01   +8.413868319040595e-01   +9.123532525620286e-01   +2.885767307663369e-01   +1.929440166905516e-01   +5.139445315664896e-01   +1.903167905746110e-01   +4.728050431263695e-02   +5.098168799582489e-01   +8.532026163500310e-01   -9.773190074770366e-02   +2.204571015371079e-01   +6.890074819779604e-01   +1.581719978406829e-01; +5.254595650987935e-01   +8.528923573024043e-01   +6.987355748651261e-01   +8.532945028717316e-01   +1.625195457357865e-01   +5.254643154800447e-01   +9.249032660316282e-01   +5.167855241633756e-01   +8.455363835123667e-01   +3.681682190273082e-01   -3.893772021838323e-02   +6.011174539674083e-01   +6.298818140750906e-01   +8.457614041046667e-01   -1.200840713492041e-01   +4.944107231412645e-01; +2.725522354658515e-01   +7.390125217543202e-01   +2.776580394714608e-01   +4.212638233956729e-01   +3.286809633963437e-01   +1.551094071565630e-01   +3.834709905193909e-01   +4.870278928483373e-01   +8.499168263565735e-01   +3.584485842907090e-01   +5.873121620824561e-01   +6.369058499570915e-01   +2.072742166251930e-01   +6.660384249132412e-01   +4.676857355353483e-01   +2.338412082198980e-01; +9.378585993930144e-01   +8.926849821553189e-01   +5.412858404176720e-01   +2.979161560317866e-01   +2.064480228208267e-01   +6.825814309229521e-01   +8.482936559845626e-01   +2.639824378654515e-01   +1.762760784178162e-01   +7.070526751455135e-01   +3.007815730294457e-01   +7.535119234391461e-01   +6.364422082300226e-01   +5.500156129311367e-01   +9.293604758418302e-01   -6.846731996064770e-02; +6.466301854502517e-01   +7.010229660127908e-01   +5.965509977573422e-01   +3.988212741790103e-01   +5.795774608776199e-01   +3.786746941961173e-01   +5.915487030330022e-01   -1.716939681528935e-02   +1.858903041306620e-01   +2.003454278506279e-01   +4.492570174044386e-01   +4.499606604939602e-01   +8.490375220258097e-01   +4.841387505198300e-01   +7.039405442928759e-01   +1.552404146881197e-01; +5.881068919753598e-01   +5.653839290181599e-01   +1.269838670557819e-01   +2.338859376420118e-01   +3.887161218296945e-01   +2.760704600556930e-01   +6.673395150215597e-01   +4.124586421153564e-01   +1.325550289746431e-01   +2.286670030558105e-01   +4.701755998340772e-01   +3.691038819611345e-01   -4.202376982647703e-02   +6.743657750899175e-01   +3.522288353357312e-01   +9.420856101329624e-02; +7.609761588151935e-01   +3.620035095035053e-01   +7.201596927415053e-01   +1.169529175129871e-01   +6.593388149113011e-01   +5.846118833241470e-01   +8.017387999667892e-02   +2.496911000975013e-01   +5.217258650290910e-01   +2.206933039473461e-01   +3.714604073708494e-01   +6.412064636547928e-01   +6.643379835295211e-01   +7.093067071388512e-01   +5.401906932226007e-01   +6.840674532231610e-01; +1.420265483230494e-01   +6.925860035442862e-01   +4.358144685758183e-01   +4.534991149612916e-01   +6.446095247337372e-01   +9.496492296182317e-01   +6.119217734342062e-01   +5.050372256183877e-01   +2.595226441430679e-01   +1.144136867716437e-01   +3.220894154043545e-01   +4.869499724229184e-01   +2.103440892774521e-01   -3.592325266150984e-02   +3.905759403855672e-01   +3.824471346636438e-01; +2.581010501502526e-01   +1.018186957562477e-01   +3.815105244606514e-01   +4.288106809199163e-01   +7.045031768588420e-01   +8.443558339860504e-01   +8.118715770611085e-01   +3.740314798900108e-01   +8.877172543439625e-01   +3.198153379389306e-01   +5.790854153060850e-01   +5.851559328791054e-01   +1.333975297613946e-01   +1.046577868242835e-01   +6.491135727270336e-01   +2.165190731405865e-01; +4.686401313319756e-01   -2.488400391570830e-02   +2.644648341631715e-01   +3.428187383715512e-01   +2.079681272358142e-01   +7.904488650087673e-01   +3.810573731823280e-01   +8.567163754692178e-01   +7.092130701387798e-01   +7.864635096208445e-01   +4.458632821978861e-01   +7.879411294284809e-01   +4.812008495610367e-01   +3.104315159049226e-01   +6.344117640759748e-01   +7.517834521971886e-01; -1.384083261814078e-02   +1.361683060190021e-01   +8.067518277121739e-01   +3.271440939586621e-01   +1.003266783169447e-01   +6.616011335906220e-01   +6.740854782766167e-01   +6.083620230336659e-01   +8.129072148223320e-01   +9.118356135568592e-01   +2.342634342477602e-01   +6.158120196928090e-01   +6.609892556489195e-01   +5.995107882772009e-01   +9.118621770441240e-01   +3.220941751173035e-01; +5.991925337080109e-03   +8.782884154804046e-01   +5.221535732798356e-01   +1.537695700390979e-01   +3.646860823493227e-01   +6.428506028499735e-01   +6.281572074961452e-01   +7.896027631732911e-01   +1.344170877161901e-01   +7.447866760039004e-01   +7.024046307656101e-01   +4.332660384255492e-01   +7.535285446448103e-01   +5.776884845140225e-01   +1.113789544026492e-01   +7.895074183728670e-01; +3.760859022775874e-02   +3.530728601767847e-01   +7.750803685622275e-01   +2.137244101103867e-02   +1.513276627260621e-01   +3.294115321729385e-01   +9.167814625065103e-01   +7.164050456578140e-01   +9.800932473433738e-02   +9.796934933918376e-01   +2.626574527642747e-01   +2.033902126957779e-01   +3.412460175613340e-01   +1.281055432455290e-01   +4.983904093540508e-01   +5.655401354878562e-01; +4.977999023101681e-01   +7.711060987366810e-01   +7.729122914376907e-01   +6.754209883151114e-01   +7.859843201879322e-01   +4.924732503699561e-01   +2.236752323234981e-01   +5.781977031248751e-01   +5.844747408967093e-01   +8.153319778172871e-01   +1.665518308640589e-01   +5.149399673100672e-01   +4.052842522196494e-01   +8.412657094911437e-01   +6.178935411783320e-01   +8.289369368437189e-01];
L1E_L1I_iGABA_netcon = [+4.150490044709036e-01   +2.298656151290323e-01   +1.383895389153277e-01   +4.185642509273992e-01   +2.815075000029917e-01   +4.367264824773332e-01   +6.795756793698393e-02   +4.064763793865472e-01   +5.626836402505353e-01   +2.261612017973730e-01   +6.136585167401650e-01   +5.350677205216987e-01   +8.293910334747731e-02   +5.541846356101819e-01   +5.446238005693665e-01   +1.763034049693870e-01; +2.743282983789235e-01   +1.017702865868236e-01   +6.820386394944927e-01   +5.270168790767980e-01   +3.357592157822903e-01   +2.424485996679205e-01   +5.574045299513086e-01   +3.448454273019832e-01   +1.128604609517324e-01   +3.375327730431431e-01   +2.911172117587645e-01   +4.277740282730647e-01   -9.006378679889850e-02   +2.772025369832265e-03   +5.674600832029943e-01   +3.437943336639085e-01; +4.985370023310776e-01   +7.869133094772445e-03   +4.812443631815622e-01   +5.930498615956747e-01   +5.433273256696796e-01   +4.737974796678198e-01   +4.570065247901577e-01   +5.452289811090080e-01   +2.134876585496720e-01   +2.368396326991673e-01   +4.826331013757110e-01   +3.278931092400461e-01   +9.472533039840333e-01   +5.517719647754946e-01   -4.365211204127543e-02   +5.891360315393336e-01; +8.094260310643485e-02   +8.054104988302891e-01   +6.472760089206813e-01   +3.132165330546931e-01   +6.577071398944482e-01   +6.414396201063675e-01   +1.486460510687024e-01   +5.128435169021464e-01   +1.324047191274796e-01   +1.907576323982130e-02   -4.113872583950550e-03   +3.298523612658328e-01   +1.592823600441871e-01   +3.935141868295737e-01   +1.963386548911583e-01   +4.920347861522425e-01; +2.238848335022262e-01   +1.494214562953192e-01   -1.147659997727431e-02   +3.687644967233200e-01   +1.392607312527658e-01   +5.317372113026579e-01   -4.887622816679578e-02   +5.272540650555030e-02   +1.622903849483877e-01   +1.296588495994925e-01   +1.172530115731482e-01   +7.360312034658885e-01   +3.075275231450316e-01   -3.013025900666793e-02   +6.119235751720726e-01   +8.774636197026670e-01; +4.289497237539457e-01   +9.436632327189068e-02   +4.644829051742678e-02   +1.764196022749274e-01   +2.950807445558411e-02   +5.372157565942689e-01   +1.629041990911335e-01   +6.768161111914234e-01   +4.396357560389412e-01   +8.703930207041684e-01   +7.504092269303521e-01   +7.955345869662961e-01   +5.602517663643263e-01   +5.065393180799347e-01   +4.320378364051248e-02   +3.035080631080758e-01; +5.963267476966275e-01   +1.019590855122992e-01   -2.193329647110488e-02   +5.109793175725670e-02   +7.604193326021611e-01   +5.309277418296763e-01   +6.121296048154625e-01   +3.704509133422388e-02   +2.609713748715265e-01   +8.241743554618073e-01   +6.008458734265401e-02   +5.957123118976877e-01   +4.333522066067771e-01   +5.357910720532721e-01   +3.260094165369872e-01   +2.124469647640879e-01; +4.562837273543240e-01   +1.336557969966358e-01   +6.149171013312648e-01   +1.000000000000000e+00   +1.838369931760003e-01   +4.981847382248605e-01   +1.567703693764889e-01   +7.503113770366268e-01   +3.420081525992904e-01   +3.197468654038835e-01   +1.011351213249528e-01   +7.815068323786442e-01   +4.761247965124878e-01   +1.466413325503462e-01   -6.556209430742470e-02   +6.343647185443161e-01; +2.206896090370696e-02   +7.164676066173452e-01   +5.138105234244168e-01   -4.960153482745170e-03   +6.775044010781662e-01   +3.315385002376707e-01   +4.082053492253578e-01   +4.226595992158074e-01   +2.523326797447391e-01   +8.099188568718505e-01   -1.667232558074934e-01   +8.884394126642720e-01   +1.297737191544641e-01   +2.720876689205037e-01   +6.936671697001023e-02   +4.064415947799273e-01; +2.717565063814646e-01   +5.525127758321553e-01   -9.169309251678823e-02   +1.858187336256517e-01   +6.612737922180312e-01   -5.493248471554098e-02   +5.874554605261050e-01   +8.021294493386234e-01   +6.586021019522532e-02   +6.345239419528650e-01   +1.437506892737153e-01   +7.325346363601096e-01   +2.447154119880419e-01   +2.963446919090643e-01   +3.462331425357613e-01   +8.381042906258013e-01; +8.107236381791758e-01   +5.377316274289502e-01   +5.975747716420338e-01   +7.962686813549769e-01   +7.014732584767099e-01   +5.107810929863950e-01   +7.855127656850117e-02   -3.314086969955632e-02   +4.931528514129662e-01   +1.923441182243665e-02   +4.608304071849376e-01   +4.809694713649275e-01   +1.448522404378095e-01   +9.700900625975091e-01   -1.425481660344978e-01   +5.666816222435801e-01; +4.055667619520410e-02   +5.063480043427873e-01   +4.332349922912974e-01   +8.144206679014923e-01   +4.088320571340055e-02   +2.115408232932511e-01   +3.249146578501481e-01   +4.043989344208465e-01   +8.326590033110098e-01   +3.960630963292991e-01   +5.924731118364424e-01   +7.700707306165313e-01   +2.535758707127928e-01   +7.252324267110818e-01   +5.362018282281253e-01   +4.757774097695328e-01; -3.048268709181883e-02   +5.783397177413053e-01   +2.257916596706257e-02   +5.540429677165477e-01   +1.547751215362214e-01   +5.765132062290194e-01   +4.832035723021785e-01   +4.643995453160534e-01   +4.992291205471299e-01   +6.527644305150244e-01   +3.251109891739992e-01   +4.298040994942682e-02   +2.731006739157919e-01   +1.758003433224602e-01   +2.455424347907851e-01   +7.444134511274112e-01; +8.158846136149426e-01   +4.144250984036188e-02   +5.577727437808233e-01   +5.535768914827105e-01   +4.396438833390822e-01   -7.252798251188046e-02   +2.835306909358510e-01   +6.231719282180626e-02   +5.842713953513793e-01   +5.912790586386481e-02   +3.891597341918674e-01   +6.588660348349198e-01   +4.784319695324314e-01   +7.411629170277618e-01   +5.192277741852962e-02   +2.953849702130470e-01; +1.673361683888850e-01   +4.269119936855906e-01   -3.617245254367384e-02   +1.100906872442567e-01   +5.608600893923539e-01   +3.179160381678034e-01   +7.324179276713914e-01   +6.415112638663248e-01   +7.477359767849829e-01   +7.364107839341292e-01   +6.723527693636068e-01   +4.061854649389124e-01   +2.753480950836366e-01   +7.386090213557336e-02   +3.284463015341400e-01   +3.107703713341988e-01; +4.233898137722202e-01   +1.652122343730124e-01   +5.605765015470158e-01   +7.073483896962275e-02   +4.186851323450201e-01   +6.784669143289482e-01   +3.843261274322971e-01   +1.929022477752359e-01   +7.301066291632843e-01   +8.229232746114035e-01   +7.092787028928962e-01   +5.194470461858175e-01   +4.728692370114461e-01   +2.030684471093368e-01   +2.828895375155020e-02   +2.941336150365822e-02];
L2I_L1I_iGABA_netcon = [+4.475877909480045e-02   +4.788036590100174e-01   +6.068608349226037e-01   +6.546160685267408e-02   +5.740202402020741e-01   +3.112294719241279e-01   +4.634845228711744e-01   +6.849402808076704e-01; +1.295479661877391e-01   +3.103286948353245e-01   +2.507200672423150e-01   +1.367385957395632e-01   +8.311153032761937e-01   +1.896272367574292e-01   +5.768458441749142e-01   +8.205582650861648e-01; +1.028120388131211e-01   +6.337267293867207e-01   +5.460744005556755e-01   +4.972661053360846e-01   +5.106385075599547e-01   +3.787486936002616e-01   +1.864351350389466e-01   +5.376230713540568e-02; +4.711122205670978e-01   +4.146626954848001e-01   +4.700129195826448e-01   +8.210705289415859e-01   +2.736189736432855e-01   -1.108045019567826e-02   +4.017534898841945e-01   +4.834385109594558e-02; +9.405276936777525e-01   +2.151905938467094e-01   +2.929115081833630e-01   -5.689352926465517e-02   +5.535544065301946e-01   +1.282202485178376e-01   +9.729018085328631e-01   +1.873791236218592e-01; +4.838411941133485e-01   +4.420645652882501e-01   +6.839935733943209e-01   +7.755309002090007e-01   +7.836072279734357e-01   +6.920293591961518e-01   +2.589410281600714e-01   +6.340699144964431e-01; +8.876622119000680e-01   +1.519002714907905e-01   +3.851957528767499e-01   +1.990627444634452e-01   +6.018309034886331e-01   +3.157826918233604e-01   -9.761961245759193e-02   +5.843193924174418e-01; +5.487192735102083e-01   +3.787244760540510e-01   +8.617027989622059e-02   +6.271810776513823e-01   +6.492343194547936e-01   +7.566551227375355e-01   +4.058809397789549e-01   +3.292981815264406e-01; -1.502640336539641e-01   +4.728492027249076e-01   +1.069059384409660e-01   +3.256518801122882e-01   +3.557046747628503e-01   +5.425098355877436e-01   +5.396627350095137e-01   +1.861881112243632e-01; +6.043235308244811e-01   +8.643425827643969e-01   +2.902874041148053e-01   +5.750050934872355e-01   +1.792259232350888e-01   +1.812297065091251e-01   +4.622567363886004e-01   +2.369466201062007e-01; +2.582204340922075e-01   +1.684932883044047e-01   +5.393267748777466e-01   +5.506222213295570e-01   -5.393478024381020e-02   +8.639924698290594e-02   +4.500167711214144e-01   +1.223052781373254e-02; +1.317988749339665e-01   +1.959349159867905e-01   +2.164417845902516e-01   +5.452483094368827e-01   +1.688164816880273e-01   +4.620528371134158e-01   +1.657098303247943e-01   +1.947011597534537e-02; +6.535530474250676e-01   +7.762184551170357e-01   +2.080537402901752e-01   +5.110869150539840e-01   +2.791635021355234e-01   +1.889854447211947e-01   +7.027371050997172e-02   +7.165826278371108e-01; +3.365985462313433e-01   +7.308919099357527e-01   +3.635515629400254e-02   +1.960576154089417e-01   +4.146867551585598e-01   +4.979456245973134e-01   +5.501344207634991e-01   +4.805332823053415e-01; +3.170162615431355e-01   +3.184815199566468e-01   +3.975845202122682e-01   +2.300534378196402e-01   +5.500077484733593e-01   +1.547657592960626e-01   +1.008996353812374e-02   +4.247161647028437e-01; +6.509002406395032e-03   +2.351945377113992e-01   +3.070315788704340e-01   +8.528213433770626e-02   +5.051299202935875e-01   +6.842760226437118e-01   +2.570759708495423e-01   +2.343855756082809e-01];
L1I_L2I_iGABA_netcon = [+1.055393555210018e-01   +6.071697325533528e-01   +1.801606786987861e-01   +1.952973828269449e-01   +8.241369009725048e-01   +7.255079540648451e-01   -1.467157965122207e-01   +1.881858459998350e-01   +3.801001586709040e-02   +6.540891096405416e-01   +5.995089135596205e-01   +4.233145523508395e-01   -1.129250352676623e-01   +2.729765025076102e-01   +3.740464739184922e-02   +6.947869529290190e-01; +7.901602502148837e-01   +4.724543000077717e-01   +4.526692544204298e-01   +3.269667614504358e-01   -1.707270749751380e-02   +2.536889791465656e-01   +4.912092221466888e-01   -7.658186632906346e-02   +2.981545850230017e-01   +3.092842892452040e-01   +4.770255285156894e-01   +1.461873806763694e-01   +5.890682018642798e-01   +6.024280235139556e-01   +1.000000000000000e+00   +1.137398834927735e-01; +4.156262724126185e-01   +4.506481052845859e-01   +8.193091758700882e-01   +3.744521036835158e-01   +1.304832205180380e-01   -5.027477251588860e-02   +7.025177789476786e-01   +4.766726425838643e-01   -1.611466118317054e-01   +6.277457291182058e-01   +2.321570496018548e-01   +3.666780654841573e-01   +7.152566823792839e-01   +6.730523712920728e-01   +1.965714951810490e-01   +1.073703127976877e-01; +6.272946854143195e-01   +4.985967125916799e-01   +4.220979567191898e-01   +2.839695824147704e-01   +6.235887513454407e-01   +4.897037802648585e-01   +4.586307318974457e-01   +1.185543031559740e-01   +4.543444544602796e-01   +2.546644224904540e-01   +2.567574843431072e-01   +2.525554162975555e-01   +2.739807391180188e-01   -2.022354773292377e-01   +4.195071741590942e-02   +4.395792107830136e-01; +7.386632059338140e-01   +4.651978443509051e-01   -8.505522774687377e-02   +8.838313836349325e-01   +6.213553401573413e-01   +3.048044756045615e-01   +5.577394413593528e-01   +9.297811616272998e-02   +7.992269094069648e-01   +4.502363804482284e-01   +6.375347448571208e-01   +8.088738033012487e-01   +7.368677979960568e-01   -8.742575786880373e-02   +5.506046393342239e-01   +6.950230581227197e-01; +3.204470409935078e-01   +2.349663675293600e-01   +8.344142022975044e-01   +1.233140302794322e-01   +1.593443648854669e-01   +4.203906230627682e-01   +5.070373692945154e-01   +6.568231855583035e-01   +5.614629752646020e-01   +4.493134270048209e-01   +8.139252628864864e-01   +5.784182793733362e-01   +5.344150933679317e-01   +6.440707213655497e-02   +2.692153598185798e-01   +7.951159732374156e-01; +2.950842368094510e-01   +7.517596258266140e-02   +1.548326652199985e-01   +6.460640350224330e-01   +4.799530004789789e-01   +5.117392243459060e-01   +2.015393411447021e-01   +3.079545516454850e-01   +2.101732198995568e-01   +2.554010809127820e-01   +3.618297346192877e-01   -2.744999387044527e-02   +5.777762802294383e-01   +3.958136210443333e-01   +5.935878446485195e-01   +1.358150984086375e-01; +4.493559346221424e-01   +6.499216618552489e-01   +6.207080032156351e-01   +2.359954085556532e-01   +4.916225534208706e-01   +2.017184539988309e-01   +6.372606003319441e-02   +5.773045159256014e-01   +5.468644877945067e-01   +2.767265221630917e-01   +1.199103302293446e-01   +7.661216811199907e-01   +3.651053103841516e-01   +7.066348477649915e-01   +2.783794509873719e-01   +4.200438076943077e-01];
L2E_L1E_iAMPA_netcon = [+2.576373507322268e-01   +5.133150529266468e-01   +6.442706860974426e-01   +4.359780060360553e-01   +3.620332428185787e-01   +6.934873949710303e-01   +6.859373582374944e-01   +6.327619826967668e-02; +2.838189762108623e-01   +1.779731098635109e-01   +1.968538690552918e-01   +1.233592024908706e-01   +3.789273068127632e-01   +3.823475771971735e-01   +6.993258823834150e-01   +1.819290522143525e-01; +1.164726443792398e-01   +2.685104370041555e-02   +8.848728214868895e-01   +4.734191129894542e-01   +3.838424000129487e-01   +4.240662131747158e-01   -1.430762665277026e-01   +4.525614458103400e-01; +9.077528807836269e-02   +1.372870028999687e-01   +8.234618089399999e-01   +1.911562803683380e-01   +3.127350409807036e-01   +6.765827260154478e-01   +2.278185700529602e-01   +3.592713200789436e-01; +5.808503108177044e-01   +1.282089268044881e-01   +5.983183633551936e-01   +6.642673892675870e-01   +2.304427208933197e-01   +5.186516894435128e-01   +5.963790428770267e-01   +7.439233620610404e-01; +7.571809182727807e-01   +3.101957916885540e-01   +5.738126723871987e-01   +4.633333380763735e-01   +2.415563625649393e-01   +8.454375201889301e-01   +5.772231835142310e-01   +9.303228383875028e-01; +7.829700567041813e-01   +8.209087658592964e-01   +7.983732319163170e-01   +6.706502399431553e-02   +3.616393750210411e-02   -1.192663357450457e-01   +6.601307234555586e-01   +6.852978935642622e-01; +5.181268382144016e-01   +8.709348664621986e-01   +5.630507783623562e-01   +4.448842947212481e-01   +4.246336926317495e-01   +6.807617470991311e-01   +6.477199339877029e-01   +5.403032793723781e-01; +8.950944310409803e-02   +3.091301891298723e-01   +5.701720060910819e-01   +5.070468826191439e-01   -7.542946612484713e-02   +5.901601548880712e-01   +5.425784440955767e-01   +1.000000000000000e+00; +1.035244707497179e-01   +1.091569381294779e-01   +4.014112055368997e-01   +2.645947874782147e-01   +5.364584838481683e-01   +2.339115970126657e-01   +3.059365726380477e-01   +6.166926000701277e-01; +5.874949046013220e-01   +7.954988386707188e-01   +4.213052975613497e-01   +1.247815582739737e-01   +2.485200442080313e-01   +7.390363878176019e-01   +7.311195544137433e-03   -3.031658769710569e-02; -1.073822858957270e-01   +4.081180975472384e-01   +7.117036812337145e-01   +1.670306503930771e-01   +2.039263715238231e-01   -4.870892417332617e-02   +5.326697876089650e-01   +4.266583908002796e-01; +2.137612599845257e-01   +5.507141474411436e-01   +9.467514616540389e-01   +1.717210378920768e-02   +3.993604025163735e-01   +1.365890323217755e-01   +1.105523474590554e-02   +7.081939180431077e-01; +3.229251078398883e-01   +5.037859622910288e-03   +3.006443348445971e-01   +6.569199820257854e-01   +6.108488157179813e-01   +7.066040919315446e-01   +1.756903411495607e-01   +1.174744150335833e-01; +5.973732297475577e-01   +5.271356010893560e-01   +2.809624262887135e-01   +5.637838697938962e-01   +5.164766846507940e-01   +3.248023894582996e-01   +4.404128658311571e-01   +5.899643841614041e-01; +3.617400587803749e-01   +6.240344893482004e-01   +1.107694460255062e-01   +5.297463810586703e-01   +1.000391787233868e-01   +4.674784582689889e-01   +3.294540087504332e-01   +3.698284392429063e-01];
L1E_L2E_iAMPA_netcon = [+6.271009266256694e-01   +4.999138550965644e-01   +9.210311703060289e-02   +5.211687811872382e-01   +7.936517174656968e-01   +1.397266900447899e-01   +2.922995971864970e-01   +7.318501567534359e-01   +1.193195477673932e-01   +3.236085093570900e-01   +5.343914923918799e-01   +8.043882180454272e-01   +1.191305788244254e-01   +9.065265473230071e-02   +7.284139771782092e-01   +3.160295929769570e-01; +8.211806058780939e-02   +2.966511727345600e-02   +4.557866759973215e-01   +1.607998450274527e-01   +2.726250588761650e-01   +2.437695756194880e-02   +3.159368276267896e-01   +2.084588739717708e-01   +5.247023195144209e-01   +9.474025093120292e-01   +4.423632773177219e-01   +8.697741613523367e-02   +9.072249400960729e-01   +8.565737283648893e-01   +5.122841077174258e-01   +5.301230307871079e-01; +2.300864878444511e-01   +7.546240148873018e-01   +2.025924442679306e-01   +4.612354166232263e-02   +5.932715506566363e-01   +8.410084093636720e-02   +7.947765082548235e-01   +7.200100733073641e-01   +6.716167108320452e-01   +4.358207787302358e-01   +6.408415080794976e-01   +1.985397393882894e-01   +4.243439946037743e-01   +3.227417778219365e-01   +1.436940457708235e-01   +4.544273160044547e-01; +7.319638757280391e-01   +1.817947120999553e-01   +4.217269719394346e-01   +1.571499823127255e-01   +3.531393183925370e-01   +4.009737164627409e-01   -1.590703101085985e-01   +7.725326367440598e-02   +7.145810638740486e-01   +1.935670661955046e-01   +3.635654867851139e-01   +1.293755178419915e-01   +5.758313929784663e-01   +6.782534187024274e-01   +4.957558153673381e-01   +5.943556162564689e-01; +4.078170072310000e-01   +2.077920043026330e-01   +1.868396192470803e-01   +4.262364515878956e-01   +3.833081940580296e-01   +5.147446671174678e-01   +3.689290815779678e-01   +3.725213519912994e-01   +3.287412045646274e-01   +4.223163485290270e-01   +2.193574945769428e-01   -1.003458551161200e-01   -4.103475163131291e-02   +6.775123482124482e-01   -1.124212165120307e-01   +7.513470839579932e-01; +8.847517106636935e-01   +7.746153589764927e-02   +1.856903938645888e-01   +5.667365777172554e-01   +5.680104567146964e-02   +1.281864480918704e-01   +5.830533111499032e-01   +1.629853262011899e-01   +4.032134778690606e-01   +2.343331655376125e-01   +4.265951480065895e-01   +7.872321716541950e-01   -1.824491384412384e-01   +1.450946243923196e-01   +3.473511580635909e-01   +5.894083393282734e-01; +3.156627225926359e-01   +7.530316576134256e-02   +2.577615069688389e-01   +2.636553108307332e-01   +8.776034585426333e-01   +4.868359489571843e-01   +1.542004061621943e-02   +5.469664368267800e-01   +3.703268423258851e-01   +6.979710328098145e-01   +5.059602896082982e-01   +9.263904096690995e-02   +3.636412393777523e-01   +1.441101410053338e-01   +4.552666306543759e-01   +1.736407654508329e-01; +3.681272768896995e-01   +2.547546822798324e-01   +6.588571497564524e-01   +5.789666403827084e-02   +6.037127879499251e-01   +2.128111416710199e-01   +2.120697758116024e-01   -6.578293889454792e-02   +9.664859002788762e-02   +6.933547246807472e-01   +3.920791191952157e-01   +9.029082344796034e-02   +7.661298496591987e-01   +6.159367451609318e-01   +1.656211618232848e-01   +1.028376668232279e-01];
L2I_L2E_iAMPA_netcon = [+5.051713587175489e-01   +8.204097616591911e-01   +2.739914588611238e-01   +6.976998562427380e-01   +8.446101160518298e-01   +6.809149528170526e-01   +5.523954634229693e-01   +2.302452945147101e-01; +9.585408217626052e-01   -8.333572365989243e-03   +5.046382552788738e-01   +2.198184997793917e-01   +7.606672776903780e-01   +4.371277670446161e-01   +4.280193633409981e-01   +8.148765857048297e-01; +9.501592529025173e-01   +3.187285116097597e-01   +7.752103723279378e-01   +4.829536683866346e-01   +1.933018398341073e-01   +7.024929626090139e-01   +1.229912394584385e-01   +7.221179144191672e-01; +4.170083986033805e-01   +8.553883828173450e-01   +3.332867386168981e-01   +2.891960425293786e-01   +4.554406489975477e-01   +1.025155200030101e-01   +8.884009552746013e-02   +4.527601153272627e-01; +4.356228274452585e-01   +4.134098621633741e-01   +5.420998271811482e-01   -2.118547377368540e-02   +7.228247795124699e-01   +1.361721822418712e-01   +1.617365422326692e-01   +5.528632268584949e-01; +2.655830962678973e-01   +1.776621419927719e-01   +5.680418110070686e-01   -8.520679934415110e-02   +5.771470624741439e-01   +6.789590677956212e-01   -4.611886253264891e-02   +3.334935023061646e-01; +3.010329884221067e-01   +1.327826322488517e-01   +5.140788588984108e-01   +4.678601917704284e-01   +1.463927998314392e-01   -2.523580638839775e-01   +2.909802089002472e-01   +6.047655001869863e-01; +3.648042926069623e-01   +5.127685846474067e-01   +8.713176072682179e-02   +6.594842657492624e-01   +4.130647227122075e-02   +8.069646992090088e-01   +2.631009655206788e-01   +6.293003571436523e-01];
L2E_L2I_iGABA_netcon = [+1.396229333687212e-01   +3.618410157517085e-01   -1.021999908752585e-01   +8.920198373785932e-01   +5.098301059737029e-01   +9.757258877091568e-01   +7.336674055687818e-01   +2.404612867397543e-01; +6.060599897127787e-01   +5.976592375611560e-01   +3.525865227113579e-01   +4.468743664734155e-01   +6.096194264561020e-01   +3.874548659996145e-01   +1.794202237599051e-01   +9.888312168286586e-01; +3.505655006839620e-01   +4.960461650911749e-02   +5.975017586273941e-01   +5.765501159522555e-01   +2.375203983324684e-01   +3.154281801407901e-01   +2.051468751183470e-01   +9.079897802727207e-01; +2.557728343030304e-02   +7.486703057026021e-01   -6.925665044106549e-02   +7.213137969861478e-01   +3.838407729618326e-01   +4.668097467294990e-01   +8.548361292844148e-01   +8.642923327018833e-01; +4.303246517995718e-01   +4.350125808040368e-01   +2.352179289101096e-01   +2.564393564287538e-01   +1.098423114403413e-01   +6.453154899766129e-01   +1.291669328451644e-01   +5.507824473732273e-02; +7.577329597371703e-01   +8.033821536769116e-01   +9.585915987290963e-01   +9.944806958248346e-01   +7.884671992026518e-01   +5.339357018044000e-01   +3.409392199120446e-01   +4.768124814602624e-01; +1.092895021875733e-01   +2.736247681300004e-01   +2.271552526960047e-01   -8.487071267155168e-02   +2.930471454201334e-01   -1.273540548446790e-01   +2.381368216090826e-01   +6.760158488103880e-01; +8.551237717126620e-02   +6.860503170094400e-01   +6.855461173262503e-01   +1.808764619247382e-01   +4.169649150486028e-01   +6.007609516679131e-01   +5.077498253739724e-01   +8.007248159731225e-01];
L3E_L2E_iAMPA_netcon = [+4.059610089622386e-01   +6.407903034170597e-01   +5.425214988903676e-01   +7.966077009979772e-02   -2.676222338381154e-02   +8.857033377738691e-01   +9.068935597966050e-01   +7.797367597456449e-01   +6.154774450682848e-01   +7.455748948302825e-02   +3.273402039461354e-01   +1.712685870231392e-01; -8.379273664519313e-02   +9.041712015069202e-01   +1.023264967177441e-01   +1.100960450954565e-01   +4.523300614407308e-01   -2.296183113002450e-01   +4.799498086269435e-01   +1.895292278408277e-01   +4.042880602451788e-01   +5.558086412163172e-01   -2.680032959628374e-03   +2.200671554925970e-01; +2.637686485974979e-01   +2.654395991578763e-01   +3.361061496999361e-01   +5.662463465398601e-01   +3.604578140449558e-01   +7.674284709469451e-01   +6.985961487413914e-01   +8.234732280916047e-01   +2.035446543544577e-02   +7.876438465136290e-01   +5.057664583406511e-01   +7.328394765846703e-01; +7.466508701664797e-01   +4.364376791635796e-01   +7.054912565143108e-01   +5.508774214975386e-01   +3.858463536422502e-01   +1.000000000000000e+00   +3.879922884983513e-01   +2.060794821772818e-01   +6.041082360891114e-01   -2.155697003379825e-01   +3.275311264579862e-01   +7.704931018398038e-01; +6.518284646578364e-01   +3.014454579367562e-01   +4.270760192135419e-01   +5.567013548764861e-01   +9.170935712496879e-02   +4.209531342996643e-01   +4.111183801508622e-01   +6.551167275793872e-01   +9.235536677051771e-01   +3.027211867395797e-01   +7.020518403237607e-01   +2.400487579757228e-01; +2.621450705016486e-01   +2.294055743343210e-01   +5.069718084988053e-01   -3.393382986216642e-02   +1.117207905802848e-01   +4.571603911446388e-01   +4.807423706973752e-01   +7.888724172893892e-01   +5.366517896928287e-01   +4.535151455298193e-01   +5.492555826876907e-01   -1.708331131899541e-01; +3.443274250843276e-02   +1.553988907097265e-01   +2.645322126470674e-01   +4.275155607364770e-01   +9.839753496715959e-01   +6.809003607873493e-01   +7.303323828850770e-01   +3.307814838553174e-01   +5.212233950444891e-01   +3.078206275509893e-01   +3.085591747426960e-01   +4.397095401103724e-01; +1.953870172011975e-01   -1.130816413471530e-01   +6.156351643304019e-01   +8.370454237162368e-01   +4.742611472542045e-01   +7.529286345508399e-01   +6.763705596233544e-01   +2.453085346135965e-01   +5.892021974019228e-01   +2.255489623132069e-01   +1.006864462852749e-01   +4.030699662268316e-01];
L3I_L2I_iGABA_netcon = [+8.085132408254320e-01   -3.230858992718535e-02   +4.450609883663389e-01   +8.098499307778285e-01   +3.196648171111842e-01   -5.025038866783528e-02   +2.028957959855626e-01   +2.824404671116459e-01   +3.091462012910570e-01   -3.120216837891393e-02   +1.981854322120355e-01   +9.139308653767385e-01; +8.610744017300573e-01   -1.614978583042478e-01   +1.348407432251030e-01   +6.887963863357137e-01   +8.467529946391651e-01   +4.021393388965544e-01   +5.185473090743808e-01   +4.404780706215263e-01   +2.868293906755182e-01   +6.130441613266513e-01   +1.699083546562944e-01   +3.739967143473101e-01; +8.196414526611127e-01   +2.647441278585548e-01   +7.697006330674047e-01   -1.606843885377924e-01   +6.712152733528977e-01   +1.691616153032113e-01   +5.752708144718430e-01   +1.291264388949375e-01   +3.080451290751421e-01   +5.555562191111922e-01   +3.679850888667366e-01   +9.145714011520835e-01; +5.184656728336826e-01   +3.430011837568044e-01   +8.711845427020197e-01   +9.238169346138948e-01   +6.974071505866749e-01   -3.008962979700784e-02   +7.606029915074035e-01   +1.758505488001521e-01   +8.727188587663033e-01   +7.242494785254412e-02   +1.968292514495975e-01   +5.937623364812885e-01; +2.500799510824229e-01   +2.334150356736063e-01   +6.276391355583466e-01   +3.355044468333147e-01   +6.364542914951671e-01   +8.548359922966811e-01   +4.107278547113765e-01   +1.008851748438139e-01   -6.623862927774186e-02   +1.791324255784681e-01   +9.597126429741814e-01   +1.272828616207329e-01; +9.238265863133852e-01   +2.759165307740389e-01   +6.025283817371372e-01   +9.638283075753858e-01   +6.208395723059726e-01   +2.723608725040335e-01   +4.119723712764095e-01   +1.073664915445832e-01   +4.109632607826206e-01   +3.666018586929888e-02   +1.681100283249722e-01   +2.801128738889970e-01; +6.357922811853727e-01   +5.886789265760823e-01   +7.911752673785618e-01   +3.923965484947880e-01   +2.939267700038107e-01   +6.572337513866626e-01   +4.289094945860888e-01   +6.309852603302943e-01   +9.225568033272215e-03   +1.000000000000000e+00   +3.142889386696601e-01   +7.850124385884238e-01; -1.111554498471630e-01   +2.674505662289263e-01   +6.190313971511442e-01   +6.036523077832326e-01   +1.025490110878096e-01   +1.862765836714138e-01   +1.521946995688221e-01   -7.424871088246437e-03   +6.811535915621630e-01   +4.910547562237653e-01   +2.919639919503727e-01   +1.683133216593037e-01];
L2E_L3E_iAMPA_netcon = [+3.470075744758081e-01   +9.712666568144976e-01   +4.534232729429388e-01   +7.137814352838953e-01   +3.751614855457209e-01   -7.076494240724091e-02   -2.139038296392505e-02   +3.406190202073400e-01; +4.312019115204745e-01   +3.981092841748541e-01   +5.145144998097791e-01   +2.671867565378629e-01   -6.401530529746548e-03   +2.398155472172001e-01   +7.082877691170274e-01   +5.832964658415695e-01; +1.283703085403465e-01   +1.892483164135327e-01   +9.745868435404925e-01   +9.300250307700033e-01   +5.475894013930742e-01   +1.938293137536415e-01   +4.575546870081730e-01   +6.251214012205276e-01; +2.684439428036694e-01   +3.180846566336144e-01   +1.662302675800115e-01   +5.109904636392333e-01   +3.416019003481175e-01   +6.302629946264114e-01   +5.923370384498474e-01   +8.136432195175505e-02; +3.684030558034298e-01   +7.421310083244831e-01   +6.659907749028248e-01   +8.362465348770676e-01   +6.364591714243871e-01   +4.974232021889684e-02   +5.099510462728024e-02   +9.303333620751434e-01; +9.485459667746847e-01   +6.536108285458044e-01   +3.301182661176911e-01   +9.771664529732574e-02   +3.982082665894735e-01   +7.220330749147683e-01   +5.335147149883455e-01   +7.846033842636471e-01; +6.259225830163007e-02   +4.605463112159728e-01   +3.026809674641928e-01   -1.418259264460072e-01   +2.150527390245552e-01   +3.981472392521815e-01   +2.932097828006381e-01   +2.136918184446769e-01; +5.087565297656992e-01   +5.094296556958341e-02   +9.143739186415840e-01   +1.708582716042544e-01   +1.140306386134679e-01   +3.348375671878263e-01   +2.050871984490972e-01   -1.463150907669446e-02; +4.707507122392537e-01   +7.747716348139382e-01   +5.551684141453194e-01   -1.741508336646712e-01   +3.897245106390032e-01   +3.240155334633797e-02   +5.230305773201832e-01   +6.991926855841188e-01; +4.196992805658311e-01   +6.660580441425188e-01   +3.856977633457382e-01   +5.269080059258479e-01   +6.526915722003703e-01   +5.085085726113113e-01   +6.404438948303415e-01   +3.758772098133757e-01; +5.462518674910761e-01   +2.297332695736143e-01   +6.949279775872615e-01   +2.119048554716060e-01   -1.622777924875274e-01   +1.478810448166401e-01   +7.572361261830154e-01   +5.837021997588614e-01; +6.898914393303379e-01   +4.596732687934178e-01   +5.303948858058073e-01   +7.526787710265648e-01   +3.741676901691549e-01   +5.900783556364313e-01   +3.509148879545966e-01   +5.259297909934610e-01];
L2I_L3I_iGABA_netcon = [+2.034597640095942e-01   +2.412156635582378e-01   +8.345260464731303e-01   +2.523342407772324e-01   +1.171288232590404e-01   +4.069405401448666e-01   -1.246320117812098e-01   +5.009138539186037e-01; +1.416648577280273e-01   +9.775854716376403e-02   +6.414828933648007e-01   +5.780601656561177e-01   +3.352681223836899e-01   +2.868152769920470e-01   +7.468674968648763e-01   +4.491378362225459e-01; +2.860395736485911e-01   +7.279653858663603e-01   +1.053650120704173e-01   +2.514890688524702e-01   +1.107547257077550e-01   +8.065824638993135e-01   +3.381300545560430e-01   +4.713764481193902e-01; +4.888405981533399e-01   +3.052998000721132e-01   -3.128449474343714e-02   +4.009312967613173e-01   +5.402266794103924e-01   +2.406223286422027e-01   +3.278708622046992e-01   +9.490383189343297e-02; +5.290381059745344e-01   +3.382490633654708e-01   +5.117703011678708e-01   +6.729212754041441e-01   +2.023097798257840e-01   +4.419983775477822e-01   +1.616743629335693e-02   +1.723698334101865e-01; -2.502799563872824e-01   +9.730467886693539e-02   +4.791750412449882e-01   +7.223490189602114e-01   +6.797022262810343e-01   +6.538013450010220e-01   +7.078001462820585e-01   +1.225651094278371e-01; +2.645648851735151e-01   +1.712184847406695e-01   +3.405824835681704e-01   +5.043584552013950e-01   +1.241432491548789e-01   +8.101997810334784e-01   +7.251059505029036e-01   +1.000000000000000e+00; +4.207676585965988e-01   +5.348848660703639e-01   +2.333778529972394e-01   +1.977679120984275e-01   -8.457445504973596e-02   +1.912434133250822e-01   +1.944934930912356e-01   +2.564071157252809e-01; +1.659434244557304e-01   +2.366253097643574e-01   +9.960888094414727e-02   -1.343122175032783e-01   +5.836560351215136e-01   +1.112616844117974e-01   +1.097423484656102e-01   +2.328938540621284e-01; +2.490095664516830e-01   -1.087011565737183e-01   +5.645754378310280e-01   +5.257323494926345e-01   +6.676327306533009e-01   +6.458167656244406e-01   +7.491965699317955e-01   +1.664636570723804e-01; +4.189106053555796e-01   +2.944038615418558e-01   +7.186849193776145e-01   +5.827850789267151e-02   +7.757195282787134e-01   +3.740092699383765e-01   +7.408762232164354e-01   +2.103538357656592e-01; +6.937076530004904e-01   +2.170914421379669e-01   +3.006319038373719e-01   +1.895059855029548e-02   +5.786430418217295e-01   +7.362081481865222e-01   +3.489122418896217e-01   +5.345961875450105e-02];
L3I_L3E_iAMPA_netcon = [+3.991481481175584e-01   -2.506853246109524e-03   +3.665895115311414e-01   +1.000000000000000e+00   +9.886506572236359e-01   +1.419811879123749e-01   +3.724200344352574e-01   +1.345425684869626e-01   -3.238252515252681e-02   +1.554508097976427e-01   +4.769987518529984e-01   -2.943952941587283e-01; +4.394685741319015e-01   +5.796660872070853e-01   +3.731817477314508e-01   +5.504116784019176e-01   +2.398118928678971e-01   +6.740013641038378e-02   +2.949263119384558e-01   +2.141480904563844e-01   +1.398076516806204e-01   +5.764907797763592e-01   +3.732409186242178e-01   +7.372558028139682e-01; +4.446784348343084e-02   +9.598821016528286e-01   +5.942809434654613e-01   +4.494453089401463e-01   +6.179080476121261e-01   +2.200259157817747e-01   +3.434401632417431e-01   +4.998036287255690e-01   +2.729511213970092e-01   +3.392703816843531e-02   +8.731305404568654e-01   +3.078314105131176e-01; +6.651219592711278e-01   -1.189910410744684e-01   +6.629848789061629e-01   +1.853703773452123e-01   +8.856391573907696e-01   +2.664901485400668e-01   +2.338688204469277e-01   +3.815115340570144e-01   +5.099456156523304e-01   +4.171528201528335e-01   +4.506466960636489e-01   +1.048014213944639e-01; +3.078385268704193e-02   +8.048138272108019e-01   +9.042926375683299e-02   +2.827488903622818e-01   +6.835301732079681e-01   +2.324258193406379e-01   +1.384367385022034e-01   +1.624127843159223e-01   +7.250240100460802e-01   +6.869723230028668e-02   +5.456988755300670e-01   +9.743089326941784e-02; +1.991816537408227e-01   +2.431844962146064e-01   +8.386888735651988e-01   +2.847111419932850e-01   +2.861933183820966e-01   +5.869779016946459e-01   +2.653785836660155e-01   +2.714794513843571e-01   +6.028249454113064e-01   -1.043337353652244e-01   +3.280754022788775e-01   +8.045429806676173e-01; +1.005677142956822e-02   +7.930790298307511e-01   +7.208984202465864e-02   +4.216243597118817e-01   +4.416100500093112e-01   +5.702148712239544e-01   +5.581317375982595e-01   +1.911260320422466e-01   +6.373609912552919e-01   +9.828841296753746e-01   +1.949676264430850e-01   +8.138752725914599e-01; +1.656939252421921e-01   +5.724082608657625e-01   +7.354773283070808e-01   +4.934085635197479e-01   +8.942985840318733e-01   -7.563991424491478e-03   +9.797404969605443e-01   +2.323711732451177e-01   +8.087680340135844e-01   +5.863979669830258e-01   +8.077030828067190e-01   +4.462777141541442e-01; +7.526268677466341e-01   -2.724819587725652e-02   -3.664247617509592e-02   +6.847238148401056e-01   +8.736685526827125e-01   +9.669278117452104e-02   +9.408910471809889e-02   +4.208390575463225e-01   +4.140206688697722e-01   +9.394432652178801e-01   +4.697207021604926e-01   +3.530698979322198e-01; +7.093559953315303e-01   +5.926715876786468e-01   +4.759231634976958e-01   +4.642903700281058e-01   +3.089016205210735e-01   +9.803848969439502e-02   +9.694299596319987e-01   +7.084815860137790e-01   +4.550241035461799e-01   +2.089273686967108e-01   +1.605197831844674e-01   +6.170480251094609e-01; +2.280441233366896e-01   +5.335895590898774e-01   +1.596574821747308e-01   +5.223255031340596e-01   +6.633707513691666e-01   +1.944326542290081e-01   +6.841451772258691e-01   +8.771646952505484e-01   +1.760445462565232e-01   +7.112131460801664e-01   -2.722786416861788e-02   +9.152892893737284e-01; +4.736421445940031e-01   -1.021035079778723e-01   +4.256832825658202e-01   +8.747562269941651e-01   +8.849084020602717e-01   +3.582375075497384e-01   +2.224771287457958e-01   +4.485960615702523e-01   +8.427960158212162e-01   +6.315156192566156e-01   +2.739967048642601e-01   +4.958684444496221e-01];
L3E_L3I_iGABA_netcon = [+9.945655109123772e-02   +4.986468143634064e-01   +4.494247086736873e-01   +6.329085528541595e-01   +7.454309010283838e-01   +5.786869104447385e-01   +7.415244989430579e-01   +8.305265250254961e-01   +8.538795147060509e-01   +2.856747144674662e-01   +3.526736208419645e-01   +4.366469472662067e-01; +5.419615945420289e-01   +6.963388313552977e-01   +6.287448035800463e-01   +7.959850842890456e-01   +3.118012027398363e-01   +7.992409572628439e-02   +6.439348165999569e-01   +6.717089352135573e-01   +8.302296020529785e-01   +6.485406818043289e-01   +3.061774893449038e-01   +3.707841674816288e-01; +3.465752123795833e-01   +9.743805150603289e-01   +2.153412914881108e-01   +8.940030884532517e-01   +2.155636928834550e-01   +5.022758155354752e-01   +5.418673404436875e-02   +4.973556065547050e-01   +1.550673050403719e-01   +1.553903187739751e-01   +8.682038415748575e-02   +2.122293641901382e-02; +2.517544957249308e-01   +8.338718738296744e-02   +7.494264858658122e-01   +7.401624870078537e-02   +2.493545929037322e-01   +5.346341205205624e-02   +8.448706501332454e-01   +4.736021400826568e-01   +5.809905494734365e-01   +3.969571396873839e-01   +6.775242702734921e-02   +2.515315847381840e-01; +8.936622917672944e-01   +6.504038930011510e-01   +8.567424911985707e-01   +3.744981360831275e-01   +5.355267734047953e-01   +5.340929491410825e-01   +5.869727275595471e-01   +9.808897025832559e-01   +1.319558757523795e-01   +8.478197746362010e-01   +5.403367944676757e-01   +4.334736615867749e-01; +8.230899974595293e-01   +7.620331040023116e-01   +4.177524609327672e-01   +5.085782230821395e-01   +4.766524549688908e-01   +6.999100258881441e-01   +2.909882213065400e-01   +7.878936596244880e-01   +1.725342239611677e-01   +5.242944420999477e-01   +9.758688185896279e-03   +2.284490720723776e-01; +5.936861882729996e-01   +5.972271458625911e-01   +1.634633529303323e-01   +9.067084508923386e-01   +3.797542573545716e-01   +3.096958185373135e-01   +4.047005157597237e-01   +3.078981791864145e-01   +2.811094844288197e-01   +3.039137762538691e-01   +9.705410633960500e-01   +6.371700171283998e-01; +7.104399267432764e-01   +2.339230789202982e-01   +3.877883676945703e-01   +6.119875008727057e-01   +8.395039596723575e-01   +3.954829098559588e-01   +3.095453967148361e-01   +3.796141829922652e-01   +3.306400331853303e-01   +7.216298229299879e-01   +1.828068560627056e-01   +4.259472713121791e-01; +2.637742671121111e-01   +3.112401259955151e-01   +6.464538068768669e-01   +7.038375541194819e-01   +1.506254655899053e-01   +5.925318496770724e-01   +4.432978356453398e-02   +6.351281342794433e-01   +2.843428153508649e-01   +1.014118732149248e-01   +9.562787713004002e-01   +5.017136014851318e-02; +3.878502666831332e-01   +6.050007942786467e-01   +4.087685069244094e-01   +3.443328977094032e-01   +1.447357839916638e-01   +6.595469853811669e-01   +8.860534187134908e-03   +7.544762142107135e-01   +1.725375718676688e-01   +3.954228911634026e-01   -1.400512590484835e-01   +1.214325883970927e-01; +8.263959361951663e-01   +1.297195744941441e-01   +7.397077781510421e-01   +1.946147267913337e-01   -2.283731586123669e-02   +2.429136399994015e-01   +5.497513321985696e-01   +1.804799544670829e-01   +2.821207265377632e-01   +5.154006731915262e-02   +5.262861649667094e-01   +5.148431791810943e-01; +1.542032417452537e-02   +3.591290320969810e-01   +7.833152790016037e-01   +9.415938811770243e-02   +2.269091317356734e-01   +4.831988993408359e-01   +7.551478810139154e-01   +5.576671573374007e-01   +1.219491624078776e-01   +2.281593910078430e-01   +1.905375515155258e-01   +4.280709338743189e-01];
L2E_Input1_iAMPA_netcon = [+8.800759969701920e-01   +8.603777345904823e-01   +6.946002417146380e-01   +9.434257827174435e-01   +8.677767180160234e-01   +9.479012800383605e-01   +9.665736482631319e-01   +9.357456694169346e-01];
L2I_Input2_iAMPA_netcon = [+9.105170004970173e-01   +8.007371095634448e-01   +7.378379494703105e-01   +8.839444912375025e-01   +6.535818403974792e-01   +6.705439933436480e-01   +7.562951274671244e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
