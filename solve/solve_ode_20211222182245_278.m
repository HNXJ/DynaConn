function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.990032065636279e-01   +6.255951844827888e-01   -5.322410959380874e-01   +1.279979800919692e-01   -1.799400148623405e-01   +7.887462214432334e-01   +3.496971314696704e-01   -3.124108185203385e-01   -7.186359825957301e-01   -3.644639555666844e-01   -4.428517622226373e-01   -2.660862332543983e-01   -3.353270410953574e-01   -2.442849626538651e-02   -3.950750007654961e-01   -2.664932809037982e-01; +8.688811727084780e-01   -2.725346379525483e-01   -4.143342244670312e-01   -1.249675197230770e-01   +4.230636813172109e-01   +3.530536846423505e-01   -3.562268652945251e-01   -1.928585740435486e-01   +3.496407767441407e-01   -4.238741878313051e-04   -2.511010668831286e-01   -2.326979467813874e-01   -6.702328573195350e-01   +2.108892148867459e-01   +1.842339598593752e-01   -6.194017303905104e-01; +6.757564932896619e-02   -2.301623128137045e-01   -4.288471428533066e-01   +7.782271030813953e-01   +4.329963451166787e-01   +5.930578464465808e-01   -1.689744437872185e-01   +6.367258827787072e-01   +1.458256030492919e-01   +2.546152853241066e-01   -3.358019637445925e-01   +1.873013749910566e-01   +3.429844582328894e-01   +3.523610354806498e-01   -4.107931700685210e-01   -8.632680347801940e-01; +6.155676263177103e-01   +2.319506510387025e-01   +2.974240724549283e-02   +4.431202322102489e-01   -7.983956855751498e-01   +5.888402735953381e-02   +6.360624975184371e-01   -8.143408041414266e-01   -2.971841311562519e-02   +1.320146920653707e-01   +8.194236294746210e-02   +9.036263602693126e-02   -1.483913678499921e-01   -7.408579546550087e-02   +7.478361110160426e-01   +2.397773054346283e-01; -2.227724681459891e-01   -3.334653268961523e-01   -7.361657961851386e-01   +3.901967637893881e-01   -2.019588205547757e-01   +5.999996701215968e-02   +1.796104788165967e-01   +1.029557981112014e-01   +9.917135117578103e-02   +6.919464463157138e-01   +6.341130573971306e-01   -3.088164069253733e-02   -4.988357531993446e-01   +2.688143300621591e-01   -2.439312370216852e-01   -6.001482509644993e-01; -1.974746774333403e-01   +2.210038195848871e-01   -1.267933182423227e-01   +4.279748718103701e-01   -4.712512747569739e-01   +6.370453620630211e-01   -2.059690622465126e-01   +6.876766610150317e-01   +3.537977280409620e-01   +3.394365413356442e-01   +1.738601657761642e-01   +1.530204576867834e-01   +2.203047072954264e-01   +3.169789076869163e-01   -2.231367651137130e-01   -2.797121030371227e-01; -1.169271699054052e-02   +3.903905492727380e-01   -5.657222445156846e-03   +5.473641697181996e-01   +2.135779258912185e-01   +3.596535286049379e-02   -5.472651242240330e-01   +5.195001070153374e-01   +8.231649337864105e-01   +3.656367428078197e-01   -2.682121883294544e-01   +4.069687640811657e-01   -5.096549785261953e-01   -4.229998125459956e-01   +5.455899297805910e-01   +2.567449451276498e-01; -4.386289503125010e-01   -5.176614051969057e-01   +4.888845579646948e-01   +2.090749820925507e-01   +1.239395321068114e-01   +2.270941662521516e-01   +1.131332169367784e-01   -4.718497198210375e-01   -5.770803902247443e-01   +1.491342588428577e-01   -7.476472923513398e-01   -3.192265681009573e-01   +1.647313663451580e-01   -2.836274921471349e-02   +4.364448446370262e-01   -4.577232483875061e-01; -7.562625269753888e-02   -5.512244520641044e-01   +4.744192556366215e-01   +3.895480582184095e-01   -3.978510844431897e-01   -6.216133833626597e-01   +2.938573238607144e-01   +4.987974716509680e-02   +7.381355494525528e-01   +6.987115470606793e-01   +5.845811163095970e-02   -8.675343208992235e-02   +5.471470466569965e-01   +4.493347057932001e-01   -7.757534800416770e-01   +2.703639459267564e-01; -3.920651225912027e-01   -2.704745792976058e-01   -3.147662101592614e-01   +4.897097795886124e-01   -5.865018879292343e-01   +4.857886044314274e-01   -4.260166856529495e-01   -5.244145811276560e-01   +2.823586415468727e-01   +5.843145412004800e-01   -3.376529871537758e-01   -2.858088887230057e-01   +2.677602263125615e-01   +2.707322245752894e-01   +6.222858755270093e-01   -2.148204179630612e-01; -5.206166450577998e-01   +2.593869636652011e-01   -5.403000474877743e-01   -1.621063923658038e-01   -4.613673683863731e-02   -4.522002874141118e-01   -2.782615501258837e-01   -5.138027961342961e-01   +2.407865795051002e-01   -7.594642352261055e-02   +2.067223148255186e-01   +1.027929147750211e-01   +3.865871753062825e-01   +8.531249785822971e-01   -2.354480028593860e-03   +5.384728767676513e-01; +9.610546687827475e-02   +2.664897286769782e-02   +1.773528454174824e-01   -4.961233695667066e-01   -3.839165722891902e-01   -3.477064904575766e-01   -3.061598262456433e-01   -2.177110135526088e-02   +1.163123687200588e-01   -5.705447965782681e-02   +2.423271641925112e-01   -4.171376503972729e-01   +1.750515661148690e-01   +4.066317908690424e-01   +4.722889955785400e-01   +3.421418405387991e-01; +8.865801391730769e-01   -1.441869191221916e-02   +6.674454810090626e-01   -2.677875100806168e-01   +2.655022925504982e-01   +7.592754024711181e-01   +6.878161135668578e-01   -1.480223177047878e-01   -4.721899545894009e-01   -1.276924688084868e-01   +2.370869351699686e-01   -7.934910807649778e-01   +3.441174854854067e-01   -6.632286198354395e-01   +4.299983421387610e-02   -9.746494546156097e-02; +5.156901059814327e-02   +4.634664149459579e-01   +1.000000000000000e+00   +1.932725302512466e-01   -5.949669919336059e-01   +9.965427589233762e-02   -3.266522026872751e-01   -5.371097346655486e-01   +9.492599199431075e-02   +6.737486469341994e-01   -7.249704020982398e-02   -7.560831381559878e-01   -3.247037016335708e-01   -3.321375331055116e-01   -1.268545485810868e-01   +2.955427743622924e-01; +1.416793767981007e-02   +8.513582679639019e-01   -2.233125242778546e-01   -8.150450161163491e-01   -4.655492725490794e-01   -1.451107815599429e-01   -4.104094441979684e-01   -4.850075047802461e-01   +1.848237007829663e-01   +7.596010822039449e-02   -4.732991467065903e-01   -3.202453055616488e-01   +4.168618823344636e-01   -5.989694008433460e-01   +4.013223223605477e-01   +6.488228216656305e-01; +5.058702876146542e-01   -3.115908294648894e-01   +6.688063001198501e-02   +4.212755528661036e-02   +6.926562734392454e-02   -5.010124665281966e-01   -4.961047692629136e-01   +3.911644776680173e-01   -4.184488985876171e-01   -2.649743217435567e-02   -3.059686786509427e-01   -7.215972538305636e-01   +1.438696736931622e-01   +5.747537759203331e-01   -3.823935615580855e-01   +3.937039300075297e-01];
L1E_L1I_iGABA_netcon = [+5.950214818726767e-01   -8.049444844967782e-01   +5.545266910874032e-01   +6.909454150029350e-01   +4.367294667073238e-01   +4.130121186524032e-02   +2.037202598658484e-01   +2.019324733400234e-01   +4.775725796270729e-01   -1.922109828624790e-01   +7.232150374672106e-01   -2.694665815730514e-01   +3.004124873709842e-01   -1.555661523516411e-02   -7.586897452244066e-01   +4.194686082954444e-01; -1.340306800351066e-01   +4.007942225892710e-01   -5.063460551810601e-01   +4.476787427142157e-01   -2.697774752551602e-01   -1.008317981588498e-01   -2.385615783428706e-01   -3.943776064288891e-01   +9.759849104756811e-01   -2.599978142386178e-01   +6.609798588052821e-01   +2.909976544550176e-01   +1.593413407650467e-01   -4.209702532099152e-01   -4.063978822394413e-02   +6.672166432273116e-01; -4.268915131174417e-01   -5.597187934908603e-02   +1.000000000000000e+00   -2.893285514488932e-01   +4.328735954696251e-01   -2.572932575405387e-01   +2.833904548586728e-01   +3.594816570974174e-01   -2.893597481289988e-01   +3.679777874025790e-01   +3.933690920653456e-01   +6.941544844952650e-02   +3.472066203992258e-01   +4.423829449577663e-01   +3.005861788834117e-01   -2.025449215473102e-01; +1.206040762323725e-01   +6.525872940128205e-02   -1.311877495235687e-01   +2.457758755395796e-01   +1.749031422165013e-01   -4.117572416675626e-01   +8.817278884523917e-02   +6.011563286187768e-02   +3.593779732268734e-01   +2.757582608171862e-01   +5.528200309339614e-01   -6.248863581267456e-01   +2.473622621442390e-01   -5.521136313784760e-01   -6.198038659278622e-01   -1.431434013196969e-01; -1.353446468784716e-01   +4.051152120028722e-01   -3.750544184807290e-01   +6.258255370364461e-01   +2.509975109467572e-01   -2.396127221863577e-01   -4.839004184755699e-01   +3.961430436239010e-01   -1.022081437037470e-02   +1.882703190558913e-01   -1.045268439961248e-02   -4.592555977831258e-02   -3.086928656847890e-02   +7.080880778803954e-01   +4.664854601225912e-01   -2.242568849164991e-01; -3.176302057043536e-01   +3.888378916020745e-01   -3.280573019811891e-01   +5.004748511642179e-01   -3.770768446883464e-01   +4.358586537740591e-01   -4.680178642437024e-01   +3.685976417024638e-01   +4.595868074126017e-01   +3.091360091775228e-01   -1.284843149764976e-01   -1.791941509636295e-01   +1.778346757640236e-01   +5.425148568851479e-01   +3.237591471852929e-01   +2.359412806947672e-01; -2.528106029406384e-01   +5.850953540937789e-01   -5.731713103292683e-01   +5.374059850534140e-01   +4.889576080210497e-01   +5.060090862023489e-01   -6.557404300633315e-01   -2.364268669993726e-02   -3.393335541062478e-01   +7.067454654814233e-02   -2.834033327403743e-01   +4.954595052477676e-01   +2.967509624732186e-01   +7.514224590945004e-02   +4.722052925832789e-01   +1.860039478031699e-01; +6.003179013004556e-01   +2.122244278485078e-01   +2.719146910911002e-01   +2.045057236572582e-01   -2.631140461060109e-01   +1.704642650329267e-01   -3.914994851384411e-01   -1.834611440599119e-01   -4.436596172068004e-01   +3.172046209970644e-01   +3.574896624031451e-01   +4.494978978880266e-01   +1.359504163646705e-01   -4.759358726351512e-01   +4.621920993356029e-01   -5.321459323620271e-01; -3.419571378802644e-01   -1.745414911462793e-01   -7.298374895908209e-02   +4.275935183274711e-01   -2.402354097123004e-01   -6.875230333777150e-01   -1.721903530759980e-03   +5.662582871128571e-01   -5.487525941966748e-01   +1.743878441479482e-01   -3.737171134677718e-01   +6.639378558058510e-01   +5.335548593452129e-01   -2.424754211193859e-01   +7.596859234132253e-01   -8.692836841746389e-02; -5.699470999437040e-01   +1.273492380830005e-01   -4.949701764937790e-01   +2.938739565329752e-02   -5.004907452156586e-01   +1.275518026607636e-01   -5.279341309012349e-01   -4.149756413015796e-01   +1.313233461810972e-01   -3.168474679004559e-01   -7.896034855379920e-01   -6.817430897884446e-01   +2.804716575626026e-01   +4.922794604389627e-01   -5.533292667947172e-01   +7.048183802085468e-01; +4.563881533031423e-01   +1.208089506622964e-01   +1.050084236174906e-01   -2.660471082521683e-01   -3.794612983559393e-01   +4.513104385209067e-01   -5.287088967818973e-01   +1.333399974173506e-01   -1.518485488759345e-01   -4.484538295940592e-01   +4.197311565946903e-01   +4.761665677620166e-01   +7.211844705234608e-01   -2.918474446170106e-01   +1.775283073915308e-01   -2.696003066410358e-01; +3.831658233518221e-01   -1.788452105259191e-01   -5.291812858411025e-01   -4.095070634967627e-02   +3.169253147341046e-01   +4.143367869402970e-01   +1.810614232229356e-01   +2.892699531898471e-01   +1.939970247712927e-01   -1.612775695460996e-01   -4.532042101959589e-01   -3.716130454863570e-01   +4.502914779071507e-01   -2.802237624042299e-01   +2.970458693370960e-01   -3.641889431073697e-01; -2.639826011476118e-01   -4.814136318455368e-01   -4.494586286869885e-01   +3.806995934985956e-01   +2.795501113427743e-01   -1.653388081625500e-03   -5.013142196374031e-01   -3.423163552383672e-01   -9.978424742117394e-02   -3.174899247123342e-01   +8.049064230873615e-02   +6.599061374228401e-01   +7.097264687554673e-02   +3.933924285104983e-01   +1.726521040828251e-01   +4.721751315594964e-01; +6.715664055743824e-01   -2.098577987296062e-01   -4.186563880175665e-01   -7.100868942596115e-01   +5.066585458449678e-01   -7.534315419620792e-01   +4.857179653791215e-01   -4.361322903176411e-01   -4.218726072599825e-01   +5.047145223255480e-01   -7.072572087292083e-01   -1.240099391511264e-01   +7.417460764589534e-02   -5.394546389009339e-01   +8.436413834444761e-01   +3.678362819717958e-01; +2.371998133893976e-01   -4.430201704842991e-02   -6.662460339139795e-01   -9.033944677684085e-02   +3.858318394004162e-01   +1.172138962803368e-01   +2.065523727031251e-01   -6.099719458010625e-01   +3.666808173995020e-01   +2.513489624325430e-01   +3.488128491865072e-01   -4.504073300655296e-01   -3.558480197306084e-01   -5.019028160374818e-01   +2.543896949394710e-01   +6.480010290441682e-01; -1.116794736345932e-01   -2.535514368729996e-01   -5.083879716540708e-01   -2.380024747534656e-01   +6.181687210357195e-01   -2.771459970554823e-02   -1.398606931186901e-01   +3.925837647013655e-01   +6.753557415008697e-02   +1.785430682964756e-01   +5.574280448490736e-01   -1.104689111720235e-01   -2.785085362570741e-01   -6.035148312622465e-01   -2.483126405583470e-01   -3.068490981532341e-01];
L2I_L1I_iGABA_netcon = [-4.004207137426081e-01   -5.577269918575954e-01   +7.571577894109123e-01   +1.913689303635710e-01   +5.057210761534329e-01   -7.468381700426815e-02   +1.532878277054911e-01   +7.127928345092630e-01; -1.546382486191608e-02   +3.928651527549306e-01   -6.410118262062405e-01   -5.100237343954758e-01   +4.571043452633018e-01   +2.094846841230525e-01   +3.156385035902991e-01   +4.991254211707594e-01; +5.570096806349047e-01   +6.108605608609259e-01   -7.075431951682833e-01   +5.284852717088561e-01   -5.163269474064375e-01   -9.238919668445369e-02   +2.709702789173205e-01   -3.650788935833676e-01; -4.688539500743287e-01   +4.691214781301004e-02   -1.291410811621369e-01   +1.724102918130018e-01   -7.882651441053914e-01   -8.282165368974925e-01   +4.171780989253087e-01   +5.879880366977983e-03; +1.737145013802771e-02   -1.296161683700178e-01   +5.423913165529817e-01   -7.461803882203014e-01   +1.818313736235962e-01   +7.314569679491736e-02   +4.033951848408446e-01   -3.524975861776932e-01; -1.425225106494939e-01   -6.577261734995871e-01   -3.893766289871436e-01   -1.000000000000000e+00   +2.078826566870565e-01   +3.131320719408831e-01   -2.307786984029582e-01   +2.909992164542702e-01; +5.455070139575163e-02   +3.403805342329534e-01   -4.086775082134088e-01   +5.588088149752846e-02   -3.300826573695549e-02   -5.756193525885127e-01   +6.474112018218953e-01   -4.300463123490935e-01; -1.164146804182546e-01   +3.635970269279105e-02   -2.445024135124426e-01   -7.965786944812157e-01   +8.282212780649215e-01   +6.863168957299589e-01   +6.629038784469651e-01   -5.928512550139525e-01; +1.134899658102574e-01   -1.547913102511430e-02   -1.937541173939511e-01   +6.092257142144583e-01   -5.216551430454909e-01   +1.002682585739834e-02   +4.183488650648806e-01   -6.335492093037067e-01; -8.117972672500490e-02   +5.633004059543183e-01   +2.483546039050264e-01   -3.132745176018558e-01   -8.318620223620606e-02   -2.859318065084124e-01   -1.156261629461025e-01   +5.756361006769812e-01; -6.028343920234602e-01   -3.462171215004027e-01   +1.781319957331160e-01   -6.349497516149959e-01   -7.331331551488333e-01   +1.745256589239320e-01   -8.797245932480184e-03   +5.018765298710002e-01; -2.544037738953147e-01   +6.194709768923710e-01   -6.052939329177136e-01   -1.631499789455167e-01   +1.363163644798402e-01   -1.587483174140499e-01   -5.594017012848798e-01   +2.981998962089691e-01; +6.996177337168952e-01   +4.063823800659634e-01   -3.822299620867274e-01   -1.454721909448209e-01   -1.871290100949984e-01   -5.163826783423942e-01   -7.931207702472347e-01   +5.447338217421689e-01; -5.994828144379670e-02   -7.868665004845008e-01   +2.815677412292161e-01   -1.780322104224527e-02   +4.384058566116054e-01   +1.185502923779574e-01   +3.245037071206158e-01   +4.077420345623842e-01; +4.771050660339836e-01   -7.482506286218061e-01   -5.868787166970440e-02   -3.611249683515770e-01   +6.685279807441760e-01   +2.211215262655709e-01   -4.245534798425173e-01   +1.026380152537403e-01; +9.703793403420041e-02   -1.115613271878477e-01   -1.383303349440394e-01   +6.256469058622603e-02   +2.451703667535187e-01   -1.229703580797139e-02   +1.245417490599849e-01   +5.515564217646823e-01];
L1I_L2I_iGABA_netcon = [-7.566705328015624e-01   +5.300497760491969e-01   -1.762008382259949e-01   -2.685117441358454e-01   -3.906567912651392e-01   -3.722446869276826e-01   +4.029516603339939e-01   +3.960657615365595e-02   -6.823326990227528e-01   +5.788584380299215e-01   +1.909261664276704e-01   +1.036013563546264e-01   +1.962190054770533e-01   +3.887366750424564e-01   -4.038486428278705e-01   -1.266456353191036e-04; -2.942764531788942e-01   +2.250653624526535e-01   -2.754053715914580e-01   -3.025095535427197e-01   +2.063627473706231e-02   -1.273916371084795e-01   -5.462728455876135e-01   -4.328859129998237e-01   -6.527637604362908e-01   -9.457477769620234e-01   -2.624369456684127e-03   +5.703224410170140e-01   +1.850930212800480e-01   -6.664578778283399e-01   -1.291014247273976e-02   +2.198337614682609e-01; +4.118809546470526e-01   -5.483982371436632e-01   -4.176506158586880e-01   +3.542337512333205e-01   -7.786260548517534e-01   +1.055409112334474e-01   +4.230247607778145e-01   -2.805431592997914e-01   +3.973768934952991e-02   -5.910275132930369e-01   -6.865004819832990e-01   -2.848667289178535e-01   +3.255853813881642e-01   -2.356046093620792e-01   -1.097930476855860e-01   +7.250772390563021e-01; -1.903724586451869e-01   -7.746846339166875e-01   +5.094207955080293e-02   -2.865444142185426e-01   +9.915240375042982e-02   +3.132226591506455e-01   +6.833866077361928e-02   +4.268265010509302e-01   +1.072472483477682e-02   +3.873758086271592e-01   +9.790525821641807e-01   +2.678630137825486e-01   -2.597060530239569e-01   +2.494133302517836e-01   -3.221525006915055e-01   +1.354130368998134e-01; -7.548922556375117e-01   +4.042049071854617e-01   -3.924119454448639e-01   +1.972177056423280e-01   +2.471940686785985e-01   -7.335108372207881e-01   +5.082915804390735e-01   -7.679178534456594e-01   -4.052915966704708e-01   +3.107864231115474e-01   -4.135363841242440e-01   -2.109816245825046e-01   +6.327966506143353e-01   -4.677885564126961e-01   -5.201608949210842e-01   +1.634824229227801e-01; -4.696378427568962e-01   -1.835426849218311e-01   +1.354409293603202e-01   -4.587145188877724e-01   +3.102987865479923e-01   -3.341278163512253e-01   +4.090934805177977e-01   -7.408110781822592e-01   +5.085925055822170e-01   +7.380546215753182e-01   +5.555258341850803e-01   +6.051768330049990e-01   -5.476609926305938e-01   -4.138088241183438e-01   -3.399885961899520e-01   +5.599684233318363e-01; +1.000000000000000e+00   -9.211549467982865e-01   -6.196905670904845e-01   +6.028680872808385e-01   +5.010334396832025e-01   +4.275198811485029e-01   -3.493067752625097e-01   -6.558666276428017e-01   -5.150909183552972e-01   +1.095328880572585e-01   -4.023736204565696e-01   -9.015686181244063e-02   +3.964791901798135e-01   +2.215856575989535e-01   -2.516275545337043e-01   +3.477390308151981e-01; +1.202509391847177e-01   +3.158016523161467e-01   +4.063312147509996e-01   -5.225181544622891e-01   +1.943204427278691e-01   -7.214785810942541e-01   +3.932982383599791e-01   -2.789073630396622e-02   +1.615256275150658e-01   -1.691148864920379e-01   +2.830002894110523e-02   +4.544780822463187e-01   +3.519386069207662e-01   -1.724836161454381e-01   +9.963258471813450e-01   +2.363282601038832e-01];
L2E_L1E_iAMPA_netcon = [-4.462678634451907e-01   +7.420131206716647e-01   -6.032880272597636e-01   +2.151027024100785e-01   +5.555626603170152e-01   -1.575012248656029e-01   -2.501522711135867e-01   -7.094160483207295e-01; -4.208979895633574e-01   +5.199415747037506e-01   -6.162184442182171e-01   -1.983479743767513e-01   -6.726254312521067e-01   -1.133825943969437e-01   -4.576184155671731e-01   +2.843225948435125e-01; +4.821389038584338e-01   +4.637152232815771e-01   -6.622007658313758e-01   +6.193570184443267e-01   +1.977235530898323e-01   -3.303511588788779e-01   -3.113907399197718e-01   -7.008841791163526e-01; +1.907559942174371e-01   +2.560783690413287e-01   -1.513197822386064e-01   -4.783588916151997e-01   -5.075600342687321e-01   +3.128641388546086e-01   +1.125418174071745e-01   +3.976410719591978e-01; +4.689212616428092e-01   -3.838495654125946e-01   +3.414320360971016e-01   +4.142145934698077e-01   -7.486087354783688e-02   -2.133991489993182e-01   +4.736446246622125e-01   +4.099273059024682e-01; -6.793720535644988e-01   +4.528024828734633e-01   -4.342091399006510e-01   +4.721329900605348e-01   -2.859621381287166e-01   -3.633507785477526e-01   -5.198171285788158e-01   -1.220532993726928e-01; +1.447968140199166e-01   +7.522408268817508e-01   -6.291436389942655e-01   -3.088601131905618e-01   -9.856008979802255e-01   -4.629927304219273e-01   +4.534160663649522e-01   +2.686169811421691e-01; +4.928591546815179e-01   +1.803767719667979e-01   -6.352495984708553e-02   +6.391229901709198e-01   -3.122459877359385e-01   -6.775402797329817e-01   +5.603854544882260e-01   +1.866005218329428e-01; -4.541859420178251e-01   -1.527363365420440e-01   -1.414448465974026e-01   +3.628007363611113e-01   -4.010010491811309e-01   -5.644923433669743e-01   -2.449734777021205e-02   +1.000000000000000e+00; -8.264510480183450e-01   +7.578609993641815e-03   +2.918340898381439e-02   -3.053744027136334e-01   -9.954979281837523e-02   +5.147383387776014e-01   -5.608857913604646e-02   -2.040697254171182e-01; +4.178207329388067e-02   -1.571660586091429e-01   +3.849969664400293e-01   +2.392112820965458e-01   +1.596388905725100e-01   +3.948260564431695e-02   +5.047893895969592e-01   -7.603481636658975e-01; +4.788154076898453e-01   +3.005780007023109e-01   -3.130245895204896e-01   +2.491857127048716e-02   -4.208614046521561e-02   +5.762253407316494e-01   -8.343828879678483e-01   -9.176830919962249e-01; -6.132589431527983e-01   -2.063953866705578e-01   +2.557607026758122e-01   -5.579691861539980e-01   -6.274903715757968e-01   -4.100843990115783e-01   -1.995258025136959e-01   -5.759326840910790e-01; -3.117017999191711e-01   +2.247185223553614e-01   +1.703555842585058e-01   -7.203723128214977e-01   +1.077263871168753e-01   -9.153889396995732e-01   -1.650040640997804e-01   +1.713698379191895e-01; -4.089262330927429e-01   -8.101488454364649e-01   -3.234891635440136e-01   +1.086598858932517e-01   +1.635506176163814e-01   +4.598416141747063e-01   -3.073322268356564e-02   -8.393076674137800e-02; +4.864797647006638e-01   -4.329290307114962e-01   +1.244647679980359e-01   +7.033444399812951e-01   -3.942248216868692e-01   -1.109621745771173e-01   -8.243601393543469e-01   +3.453982777528158e-01];
L1E_L2E_iAMPA_netcon = [+6.491718996546441e-01   +1.866584429290173e-01   +3.733483321736713e-01   -4.592136212171464e-01   +7.727946163416367e-01   -4.667965928477374e-02   -3.657808645568630e-01   -8.708901028721525e-01   -5.081143648363821e-03   -5.118624205077236e-01   -1.432085045479343e-01   +7.218829291290321e-01   +3.079297445853540e-01   -4.700102878630033e-01   +4.101280856651824e-01   +6.873611871561455e-01; -1.479808155415342e-01   +6.678136898070565e-01   +3.122925631908733e-01   -5.753351273858884e-01   -4.198626168649768e-02   +3.542944986387987e-01   +1.550960185999775e-01   +1.156084130122393e-01   +3.352685132261694e-01   -4.029047189411792e-01   +5.662437000198449e-01   -1.981031807969558e-01   -1.501268467802562e-01   +6.793541095348117e-01   +2.732740650768340e-01   +5.238801078652180e-01; +1.428485593551428e-01   -6.921411825924420e-01   +1.000000000000000e+00   +4.605200694217639e-01   -2.498612974689428e-01   +4.085214282535420e-01   +1.548161060240792e-01   -5.595508540626823e-01   -8.921603448554129e-02   -2.203655325313573e-01   -8.906860789625693e-01   -3.399622573340672e-01   -1.095681151380680e-01   -7.385865988982098e-01   -6.497175419081749e-01   +7.093156144333608e-01; +5.595141967678319e-01   -5.120953942141574e-01   +4.054505735498021e-01   -6.057206590847780e-01   +8.086526550018870e-01   -8.612328871841976e-03   +3.064647467857495e-01   -2.546078882960209e-01   -1.548775759431398e-01   +9.131888311624624e-02   -2.650388603432777e-01   -8.470953205618882e-01   -2.193235119428029e-02   +2.076205634727341e-01   -3.912564168323972e-02   -1.311698936932207e-01; +1.108169850419369e-01   +1.298250521472371e-01   -1.076641438996442e-01   +6.547151250664303e-02   -9.172457692890353e-02   +5.130158696974508e-01   +2.045407616034919e-01   +1.873647072972979e-01   +6.628356414326060e-01   +1.035288472008519e-01   -3.095182652568671e-01   +7.181403271558017e-01   +9.177443059803793e-02   +5.306621598315580e-01   +2.425992591731575e-01   +1.483050041267268e-01; -3.039576006834158e-01   -8.077084689750994e-01   +2.656810816295705e-01   -4.697291876425060e-01   +1.114504969365383e-01   +6.394748406318633e-03   +9.884572352154196e-02   -2.096462756557621e-01   +2.574305973545811e-01   -9.495166299517069e-02   -1.949645573883448e-01   -5.160125722778934e-01   +7.756035090487957e-01   -8.378658190561618e-01   -4.084031514784549e-01   -2.160019320720676e-01; +2.737366510831256e-01   -1.402832775823673e-01   +5.202975884644204e-01   -3.379659777029304e-01   +2.896685636132859e-01   +5.746878674658067e-01   -3.501140782994635e-01   -5.036776229573308e-01   +6.349342419852813e-03   -1.929072157027737e-02   -4.508319048113911e-01   -4.411150292938908e-02   +7.713665300687192e-01   -3.732223972710712e-01   -3.795784921513837e-01   +6.333882513738645e-01; -6.560328821425950e-01   +3.802883545246456e-01   -7.773776404050693e-01   +8.261227261881499e-01   -7.587800636290063e-01   +3.407914106394620e-01   -1.789736851014775e-02   -5.659745237737864e-01   -2.830731993669582e-01   +1.423366111016986e-01   -3.903461095076272e-01   +5.512453557615559e-01   -7.185758292033634e-01   -3.932940029827033e-03   +6.211606139705644e-01   -4.499473980966422e-01];
L2I_L2E_iAMPA_netcon = [+7.404213776762764e-01   +2.647977496409807e-01   -1.317359589341684e-01   +3.061267362163922e-01   +2.369749224909456e-01   -1.859438034836687e-01   +1.523178055013440e-01   -3.244115058097346e-01; -5.484525447765541e-01   +2.805540273806921e-01   -1.111273148106593e-01   -6.120882549908728e-01   +7.733918392898208e-01   +2.672820880966076e-01   +6.231707407520465e-01   -4.135863892242339e-01; -3.886174583619693e-01   +5.425159722724500e-01   -3.654820250396230e-02   -1.204872972022829e-01   -2.809522341981120e-01   -1.086544449822454e-01   +2.484791836193114e-01   +2.097736568424494e-01; -5.084464474820239e-01   +2.461671095814431e-01   +8.998424771782140e-01   +5.648065325930676e-01   +8.409549966357111e-03   -5.964333854329303e-01   +6.445529460909197e-01   -1.239535655906107e-01; -3.110680331760420e-01   -6.266665284269635e-01   +3.969577571223595e-01   +1.127373383950211e-02   +1.071321098967589e-01   +3.300639553589397e-01   +2.668292133065290e-01   -6.477735850624129e-01; +1.589133228669229e-01   -5.542526610208363e-03   +3.296585608204740e-01   +4.968891542363869e-01   +9.313461916007608e-02   -3.515528993903929e-01   +2.598874289483262e-01   +1.000000000000000e+00; +4.680447045417085e-01   -8.029913507246217e-02   -4.815033787697344e-01   -3.639180519418960e-01   -1.634859268288768e-01   +4.039635055124223e-01   -6.850328322631606e-01   -1.070929261073478e-01; -1.120190815635438e-01   -3.628040275835201e-01   +2.945681166179622e-01   +8.844525452293235e-02   +8.550802182798863e-01   -5.866406574953109e-01   +3.748509691535802e-01   -2.924202079084347e-01];
L2E_L2I_iGABA_netcon = [-8.154544167060623e-02   +8.469637329658074e-01   -2.878700130749472e-01   -1.000000000000000e+00   -2.820151225599547e-01   +5.527809785032926e-01   +1.494949095408507e-01   -5.050920103155475e-01; -4.506778664075805e-01   +3.728334508912561e-02   -1.977516609283440e-01   -1.946711824935845e-01   -7.820571499322966e-02   +9.462055549335320e-01   +2.487714217725514e-01   +7.462390809168084e-01; -8.444098811657440e-01   -9.785633030503749e-02   -2.090843432102928e-01   -3.389642126834811e-01   -4.643771278873167e-01   -7.970124780298271e-01   -2.792517455398992e-01   +4.128092291246412e-01; +1.346914872256495e-01   +1.392111085988718e-01   -9.090842012905622e-01   -3.590928037395558e-01   -1.318346459449469e-01   -7.480644531856212e-01   +1.809090434115849e-01   +6.223578331356978e-01; +8.335886424337060e-01   -2.749456401035471e-01   +1.741824189276019e-01   -5.975995226718374e-01   +1.062528920854874e-01   +9.235038733408172e-01   +5.807183082622425e-01   -2.726885520175940e-01; -8.165773111680213e-02   -6.526750294098785e-02   +8.896123021550415e-01   -2.374063589122400e-02   -5.409997363609732e-01   +4.528393729885677e-01   +5.682507157666038e-02   +3.493211036149404e-01; +3.817901629038805e-01   -5.309172325882127e-01   +3.956384220246764e-01   +6.318646300489714e-01   -5.081354821218340e-01   -4.731011143425586e-01   -3.598677683719905e-01   -1.647315415843961e-01; -5.685155643889735e-01   +3.320657233433606e-01   -1.686571079599241e-02   -5.401280942152062e-01   +1.428283349643458e-01   -3.810628016320667e-01   +6.142485061406923e-01   +7.582672882085654e-01];
L3E_L2E_iAMPA_netcon = [-2.795242506981641e-01   +1.000000000000000e+00   -8.533419234342250e-02   +5.485707897370550e-01   -1.355958779634846e-01   +5.479906420212045e-01   -6.218037241085969e-01   -2.160376306007556e-01   -3.004256774386851e-01   -5.088372731754620e-01   +4.493563317241555e-01   +5.046759176977671e-01; +5.282504446867381e-01   +9.067685175298520e-01   -5.592695781846131e-01   +4.080418061378357e-01   -7.350437731055769e-02   +4.049774598754163e-01   -9.334226601660496e-02   -3.791531956016494e-01   -1.221383870948857e-01   +3.848720001655461e-01   -9.974708328048554e-02   -4.088968219669485e-01; -4.827086479062478e-01   -3.790439497214356e-01   +5.230450122153161e-01   -4.852454411278975e-01   +3.515828327430668e-01   -3.677300356226550e-02   +1.173159138847498e-01   -3.973123912215012e-01   -6.666220709528409e-01   +5.913360527333782e-01   -9.910904672548133e-02   +3.160016512552113e-01; -2.756294044260540e-01   -1.258232641643725e-01   -9.897079992453773e-03   +5.778927743570509e-01   +1.894511184666797e-01   +1.192811565451792e-02   -4.337113450473853e-01   -4.351351060844214e-01   +2.434236165192393e-01   +1.405359272865899e-01   -8.166045323600873e-01   +1.139761145056962e-01; -1.120023353674186e-01   -3.649221126189057e-02   +2.084344562932701e-01   -2.739553455178200e-01   +3.486199456584740e-01   +1.238584589256744e-01   +2.432131821953654e-01   +3.591587305436709e-01   -1.314384601536201e-01   -3.294947913137439e-01   -3.077808806470758e-01   +1.781635655512812e-01; +4.737397364829442e-01   +4.051115151623643e-02   -3.751410469988999e-01   +7.427723836126298e-01   +1.829445351795270e-01   +1.281499717291346e-01   +4.930388592473318e-01   +2.672292792243980e-01   +1.868586516274521e-01   +7.418519852156756e-01   +8.980486066606541e-02   -7.168365923590270e-01; +3.489599590803427e-01   +6.453339576433034e-01   -6.070794796076563e-01   -5.842133819352703e-01   -6.855623682264567e-02   -1.811574823969476e-01   -3.916832744878251e-02   -6.253511735012261e-02   +3.152690584949392e-01   -2.462555518367965e-01   +5.467593897088081e-01   +2.424537865814659e-01; -7.425157132755555e-01   -7.926430390875711e-02   +2.460519946977192e-02   +6.249228824622326e-01   -3.954258352015520e-01   +7.188792782590067e-02   +1.086450511512521e-01   +2.628606460996944e-01   +3.079850662552715e-01   -5.289058195288784e-01   -9.133577968321473e-02   -6.031083150948633e-03];
L3I_L2I_iGABA_netcon = [+8.179070216993742e-01   +2.929465697679655e-01   +3.214307716005837e-01   -6.502251431440496e-01   +1.549172761798209e-01   +1.441740001445167e-01   +2.032703272456441e-01   +4.087040030807697e-01   +9.813243565653899e-02   +4.719390003406180e-02   -7.805643037096232e-01   -2.772797601357358e-01; -2.705054746431757e-01   -2.294421231116245e-01   -8.070695094018864e-01   +2.382366265733827e-01   +3.310532055270798e-01   +7.407312341361558e-01   -2.949167246346545e-01   +4.257449706491436e-01   -2.802423425281490e-02   +2.387767793941379e-02   +4.705032691514071e-01   -1.422828387317976e-01; -5.644408519573444e-01   +3.409057464921322e-01   -5.357359058021097e-02   +1.483950168513897e-01   +2.480260704325994e-01   -5.235606237786618e-02   +2.564097908694469e-01   -8.533947687800186e-01   -4.193200887234923e-01   +5.583231164764373e-01   -1.922295120460108e-01   +7.356119060250746e-02; -2.018686234132425e-01   +1.436431635879170e-01   +9.110776526647907e-01   +2.893777257752003e-01   -2.027131818203051e-02   -6.469387070960945e-01   -4.984422132201909e-01   +5.227190240612224e-01   +8.828904632673739e-01   -7.622441984892654e-01   +3.389955893075062e-01   +6.224538819265577e-01; +5.184797828945474e-01   +2.256833341893773e-03   +2.371952226191858e-01   +4.932740312669605e-01   -3.317622212448291e-01   +7.630277195177991e-01   -5.130438527633444e-01   +4.469272196517908e-01   +2.374159237812988e-02   +9.149441899504460e-01   +4.619090283490854e-02   +2.419770872627383e-01; +7.728931429653295e-01   +3.765252151950518e-01   +1.513810381314282e-01   +1.316442782597867e-01   +4.712870323940243e-01   -2.338954305795343e-01   -4.778809839789231e-01   +5.673403435194448e-01   -4.893715316104224e-01   -1.260767364237093e-01   -1.506642333042406e-02   +9.419754462179220e-01; -4.768352947689046e-01   -1.479788096787501e-01   +7.542377774423500e-02   +2.481927613925589e-01   +5.982572889657145e-01   +4.318979774623112e-01   -5.689837645488863e-02   -4.902825855821720e-02   -2.160019645702629e-01   -9.849803165995031e-03   -1.008591027363820e-02   -2.745136788354286e-01; +3.594598099771864e-01   -7.878630051130244e-01   +3.612568641139088e-01   -5.932880168191577e-01   -3.357928599518083e-02   +2.550397121771240e-01   -3.348224410474029e-01   -3.554756771481202e-01   -9.707451626561321e-02   -4.829798242408545e-01   +1.000000000000000e+00   +2.559337311587985e-01];
L2E_L3E_iAMPA_netcon = [-2.124346574753480e-01   +1.802696066388935e-01   +4.122564012034304e-01   -7.486716065925905e-01   +4.617394889747639e-01   +4.038645427239092e-01   -9.793171582237663e-02   +1.393834787440597e-02; +4.248246721260791e-01   -5.819982923590669e-01   +3.485114456365097e-01   +3.850189774978801e-01   +6.464958081505143e-01   +3.018879161424086e-01   -1.475208262913153e-02   +4.280305271373719e-01; +1.000000000000000e+00   +3.577583438724534e-01   -1.854493834580613e-01   +4.733276868829649e-01   -5.390021911246780e-01   +2.271729558825442e-01   +4.587913681684274e-01   +4.733461713197039e-01; +3.857186217962325e-01   +1.430660545584644e-01   -6.845547031634378e-01   -1.695202822449981e-01   -4.129866046021596e-01   +6.458599927246468e-01   -4.062649300217414e-01   +9.747988475676630e-01; +2.653954193835592e-02   -3.124767220371079e-01   -7.434844239557398e-01   -4.241263038323295e-01   -1.317817089288761e-01   -7.212503971555936e-01   +4.670148688680200e-01   +1.465510523363724e-01; +1.073101137443651e-01   +8.219932552283550e-01   +4.732494903912960e-01   -1.671746363056462e-02   +4.137523565164337e-01   -3.690218801035178e-01   +1.277879259100114e-01   +2.525250394257581e-01; -3.885941088433668e-02   -4.950795948989592e-01   +7.704397320356308e-01   -2.773326634768361e-01   -5.678423946693666e-01   -9.703734167747615e-01   +5.583370355675387e-01   -4.280130049954537e-01; +4.624421591506301e-01   +3.800187921051110e-01   -3.270591519235358e-01   +3.056673290707747e-01   +3.358620686203976e-01   +1.189594447224238e-01   -7.207589456721852e-02   +2.610655556636822e-01; +6.698119232907724e-01   -3.314695343072127e-01   +2.796583586053263e-01   -6.011259758006783e-01   -5.930753866632271e-01   -3.234529177624622e-01   +1.632750818014207e-01   +8.436063724430647e-02; +4.253290591717236e-01   -2.548780695587944e-01   +1.967922040872440e-01   -4.506564227463951e-01   -7.381897181498827e-02   -2.781248302025568e-01   +3.009776745643454e-02   -7.682864344357138e-01; +4.457666247792234e-01   -4.134367402604502e-01   +5.702096358245620e-02   +2.600590588523626e-01   -1.018188606264693e-01   +4.968654207236460e-02   +4.340941184448367e-01   +4.363230529493003e-01; +9.364516538452955e-02   +7.214360627859497e-01   +1.315383928034304e-01   -3.058454059532366e-01   -9.902108651618321e-01   +2.946260558432319e-01   -4.736255935498394e-01   +3.752397050155371e-01];
L2I_L3I_iGABA_netcon = [+2.133336623151547e-01   +5.926232728170172e-01   +2.125124179699676e-01   -3.959521758755740e-01   -2.028497372503126e-01   +2.123501808515361e-01   +7.053676493821159e-01   +9.093663452503494e-01; -6.489511343701154e-01   -1.447737500376703e-01   -4.318372257665227e-01   +5.809662475495445e-01   -1.712455924003925e-01   +4.023566012903815e-01   -2.749119593800811e-01   +1.936142756866890e-01; -4.027357403871049e-01   -7.253154458666913e-02   -5.720990896990786e-01   -1.062684818362719e-02   -1.546226978377880e-01   +2.469837390450932e-01   +2.759220871491635e-03   +6.623745660720040e-01; +1.564826742513762e-01   -3.010145204696822e-01   -4.634082905875808e-01   -2.326597427430553e-01   -2.394093435089201e-01   -4.050674518615614e-01   -8.527950863068007e-01   -3.749911051510982e-01; +1.832496722007396e-01   -4.703932017999709e-01   +4.047804212982135e-01   +8.191884070769617e-01   -5.773082789808121e-01   +2.011413534155154e-01   -2.519293190489047e-01   -2.504988538897157e-01; +7.424641057428466e-01   -8.086197757187757e-01   +4.141870198440651e-01   +6.586445069482952e-01   +5.082315976916641e-01   -3.154517278579487e-01   -3.892436202229047e-01   +2.508375982649064e-01; -7.197274547285784e-01   -6.504757922158769e-01   +4.934060898438333e-02   +3.103561516887194e-02   -7.927578747962535e-01   +7.066294419283342e-01   +7.416330246274062e-02   +4.740858527893215e-01; -1.985169874003289e-01   +5.762487153592259e-01   -3.488673702255723e-02   +7.241174875043770e-01   +2.627324992018210e-01   +7.819270856988072e-01   -4.226046011222528e-01   -4.242488749399299e-01; -4.429189483265902e-02   +3.268661357564531e-01   -1.005839715101285e-02   -1.000000000000000e+00   -4.439031177404613e-01   +4.934055906886099e-02   +5.236792254591729e-02   +7.973766702637611e-02; -5.488736462409473e-01   -3.079991752563947e-01   +3.251860669064472e-01   +3.427623213773575e-02   -5.384222950331474e-02   +4.941788650202939e-02   -4.292811159866377e-01   -5.580447127120320e-01; +1.763547675861369e-01   -3.676090432001305e-01   -6.209750055718118e-01   -1.680483248224865e-01   +6.006198480736651e-01   -4.854608832706374e-01   -3.522687960361831e-01   -2.786241468957962e-01; +4.067844815469153e-01   -1.743536394620449e-01   -4.918483120630811e-01   +3.361801490915686e-01   -5.624452392127071e-01   -3.960293727057848e-01   +1.744717104897556e-01   -1.302956173376530e-01];
L3I_L3E_iAMPA_netcon = [+1.542499066576453e-01   -4.108550686914990e-01   -6.751991620665336e-02   +4.027236304704672e-01   +3.395642218862392e-01   -4.509931567246175e-01   -5.726875216593503e-01   +1.846381604370352e-01   +9.200187511995189e-01   +5.995412480751154e-01   -2.282973150241459e-01   +7.004328304427201e-01; -4.824901349991615e-01   +2.885046340030317e-01   +5.311497043787109e-01   -3.799604479721901e-01   +4.198237236018738e-01   -5.201915681390905e-01   +6.233721490795379e-01   -2.652842734447011e-03   -8.064143737617246e-01   -9.734761312354284e-01   +9.623670185696888e-02   -6.386872507844610e-01; -9.864725855141084e-02   -1.417364040430612e-01   +9.650868328724591e-02   -3.045882938766189e-01   +3.918146396124565e-02   +8.158245708087835e-01   +4.914130420535057e-02   +5.404369130327049e-03   +7.023202923236291e-01   +3.527805412369652e-01   -2.241953781683398e-02   -6.988093613395240e-01; +1.559584528559941e-01   -5.752437391278982e-01   -8.895803709470202e-01   -1.275848078784727e-02   -6.155251375171216e-01   -3.314446879056613e-01   -3.425406738599201e-01   +2.714021162976160e-01   -6.245322407282421e-01   +1.560267572118208e-01   +3.660791033233364e-02   +5.389431450388221e-01; -6.414491618274314e-01   +6.987655627399299e-03   +1.089210486222313e-01   +4.659850907098722e-01   +2.653124940223928e-01   -1.665460768323945e-01   +6.173139680128926e-02   -2.271750513485118e-01   +1.183922562614451e-01   +5.880761505267961e-02   -3.034562591879780e-01   -5.840636486914650e-01; +1.009771573610947e-01   -4.433187607645012e-01   -2.551051861251483e-01   -3.935633707840547e-01   -6.958040221187483e-01   +2.654918397648539e-01   -3.274137811270504e-01   +6.854880295379303e-01   -4.187747014836409e-01   +1.756411410055966e-01   -4.164283628467678e-01   -6.107052504110815e-01; +8.145324776179209e-02   -6.322248300695170e-01   -3.729925477353678e-01   +4.830548919016271e-01   -5.718414139695660e-01   +6.921564640582301e-01   +2.824064965718494e-02   +5.371117767832925e-01   +4.632625445323272e-01   +7.367324374776245e-01   +7.414845926335473e-01   +4.335799769251890e-01; -8.424404196423317e-02   +3.574955499023418e-01   -1.850581399048283e-02   -4.137640536718054e-01   -4.177544046340082e-02   -4.949027652008587e-01   +4.662261719981248e-01   +1.646606277408613e-01   +5.332317697641547e-03   +2.531960596270135e-01   +5.822494392826335e-01   -1.178729433376507e-01; -9.809653408989477e-01   +3.790670115725572e-02   -3.048553961372666e-01   +4.119417095745407e-01   -4.091946691743283e-01   -5.724543534389533e-01   -3.761554787698484e-01   -6.936646705527505e-01   +5.904983620056906e-02   +5.949550144067087e-02   +5.636858518274654e-01   -6.846873249439321e-01; +1.865088501998547e-01   -2.292588733669884e-01   +2.666827929016315e-01   +3.424622468260769e-01   -2.206380263066111e-01   +1.910503783621582e-01   -6.045365886838141e-01   -2.626804906321746e-01   -4.858067711932978e-02   +1.487556597668051e-01   -7.965837268340739e-01   -6.909645686944195e-02; -5.489221415964161e-01   +2.273735007826239e-02   -1.314264000235753e-01   -2.961412316758872e-01   -4.364435647611905e-01   +1.462994136113971e-02   +4.369240490056292e-01   -4.175417239029333e-01   +2.219836913781525e-01   -5.002049365353987e-01   +5.030162637981151e-01   -6.967089499271067e-01; -4.709827655701851e-01   -5.368257676309310e-01   -9.957809006773137e-03   -8.450347253966014e-01   -2.733469586094411e-01   -6.934602046015505e-02   -1.509696395702274e-01   -2.793486350021570e-01   +7.735489137997239e-01   -1.000000000000000e+00   +5.750624127187086e-01   -6.294666834305916e-01];
L3E_L3I_iGABA_netcon = [+7.040064669484728e-03   +3.835926078477015e-01   -5.118317206542444e-02   +7.429745353803416e-01   +3.733016289486571e-01   +5.236603244341552e-01   -1.362282741087904e-01   +7.607082296909855e-01   -2.693576767354524e-01   +3.216615466327633e-01   -5.290013043910782e-01   +3.855189908177279e-01; -5.829748249549002e-01   +4.158570673068938e-01   -2.812288529831753e-01   -2.532137976764256e-01   +5.050966309825552e-01   -2.927653193486310e-01   +6.766573735373911e-02   -9.796884113905241e-01   -2.668440849920803e-01   -2.681770908573072e-01   +2.131650823246344e-01   +3.394269122880854e-01; -1.647434098124177e-01   +2.210071652994700e-01   -5.866164536068528e-01   -9.191747862827419e-02   +4.060156671498104e-01   +3.580224272519414e-01   +9.552414383564325e-02   +7.312339317283576e-01   +3.745222654323948e-01   +1.351197202237895e-01   -2.629267100043436e-01   -2.911735116503097e-01; +7.411734145762267e-01   +7.424760373622981e-01   -9.752513817405859e-01   +2.931147122836372e-01   -6.438173109889597e-01   +4.592762850592217e-01   +9.267916285937052e-01   -8.944518016604397e-01   +5.662396887719396e-01   -8.955834582711590e-02   +7.067899581571421e-01   -7.060052213213776e-01; +3.569291279600582e-01   -5.926076271415985e-01   +4.236188019951911e-01   -2.557774819757228e-01   -4.985688020029446e-01   +2.500402330366666e-01   -1.213158945391368e-01   +2.297281504147297e-02   +5.770370650018686e-01   +8.740776473883938e-02   -2.617064356686052e-01   +6.842085173865923e-01; -1.021025924018491e-01   -3.945334656005381e-01   -4.242488528287637e-01   -4.622114488451779e-01   -7.365721250905550e-01   -7.333559191570871e-02   -4.803700891462161e-03   -6.516081465477569e-01   +2.484983484364707e-01   +5.477979979469692e-01   -2.953027381404856e-01   -1.840172267134224e-01; +7.058541875514454e-01   +2.859110079787764e-01   -2.768273567197849e-01   +5.187269161849047e-01   -3.868256264337322e-01   +4.117292527969935e-01   -2.139995091016747e-01   +1.396568502087738e-02   -9.771307987055041e-01   +2.429511344481517e-01   -4.880723566670808e-01   +2.067585212803478e-01; +1.445816505014332e-01   -1.116216548195362e-01   -3.567214184621588e-01   +3.436777868187278e-01   +4.216542468875111e-01   +3.815398014652294e-01   -3.352110215457743e-01   +9.911838607919109e-01   -6.441289594736804e-01   +8.627237015746528e-02   -3.853392865721354e-01   +2.813497989263994e-01; -5.866280191690808e-02   +3.077243524866241e-01   -4.477054846518767e-01   -5.247580808420860e-01   -6.123858120907385e-01   +3.068471025286370e-01   +5.322252105525084e-01   -1.315218125439692e-01   -4.928507673625295e-01   +1.009386573888525e-01   +4.158314328363886e-01   -9.050788349838149e-01; -3.156744706504462e-01   +8.322034315111055e-01   -5.311463154224203e-01   +6.806729930755741e-01   -9.804498032042253e-01   +5.598274938145440e-01   -4.655936448736024e-01   -4.640452879785068e-01   +3.437397995450618e-01   -1.012481074027463e-01   -5.095083941971931e-01   +1.922086469003391e-01; -1.964229406742546e-02   -1.932459320727667e-01   -1.896436624856060e-01   -3.255685337817656e-01   -7.419661412934029e-01   -5.428685270296407e-01   -6.829995987965134e-01   +6.791844836606624e-01   +7.030277993834548e-01   -2.716736075827541e-01   +1.856172506353450e-01   -5.093885514171198e-01; -6.504463214832514e-01   -1.000000000000000e+00   -2.256903216430440e-01   -1.212215574147619e-01   +6.350235090550436e-01   +6.233306404231843e-01   -9.191604374371437e-02   -2.779533446343276e-01   -1.523873179599017e-01   +4.808795844758024e-01   +1.646247329882279e-01   +2.194204738213651e-02];
L2E_Input1_iAMPA_netcon = [-6.845544405026005e-02   +4.077144236985589e-01   -2.854369751562277e-01   +4.096995607661801e-01   -5.215770878278436e-01   -3.411552406002172e-02   -6.336165264330742e-01   +8.982969441374772e-01];
L2I_Input2_iAMPA_netcon = [-5.555926616813799e-01   +1.158043504504160e-01   -4.461483090745843e-01   -1.000000000000000e+00   +1.973198572149219e-01   +8.853222485962344e-01   -4.051618802197232e-01   +7.610716270845773e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
