function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.104372327321857e-03   +1.940454536679207e-02   +3.202253051196216e-02   +3.160186209222712e-02   +3.121847484699793e-02   +4.464328584870743e-02   +1.935616259403119e-02   +1.076357639433336e-02   +1.174903077855477e-02   +1.675648836047084e-02   +2.567491137238596e-02   +1.370870090585852e-02   +2.015656549233955e-02   +3.235877576959174e-02   +2.092486688879073e-02   -3.716226119977301e-04; +2.013652019762688e-02   +7.240024054611252e-04   +1.866324888681513e-02   +2.906144156222989e-02   +5.204429484704836e-03   +1.179891637824808e-02   +4.033674369570064e-02   +4.268026506379991e-02   +3.384515106280531e-02   +1.521539940334943e-02   +4.467989572794673e-02   +4.334122149496179e-03   +4.008013328329835e-03   -3.969234413309090e-03   +1.830236150389831e-02   -3.123905789582548e-03; +2.347787871952005e-02   +2.479180910014534e-02   +3.355798603872305e-02   +2.656485265009184e-02   +3.227298401110425e-03   +4.153979000743947e-02   +3.620892860601405e-02   +1.935719922969068e-02   +1.799450007841058e-02   +1.498580501967268e-02   +2.408197000089744e-02   +9.290185278172103e-03   +5.151170213319324e-03   +8.045170189173875e-03   +3.510093342726528e-02   +2.882474827769717e-02; -3.455371509212682e-03   +8.030677934127292e-04   +1.888567173087999e-02   +2.969680385796964e-02   +8.554513670507091e-03   +2.794733402578822e-02   +2.270614844254337e-02   +3.814692606352023e-02   +1.972367944445004e-02   +5.872851014664504e-03   +3.566466092010825e-02   +3.583500762693455e-02   +1.213128852829127e-02   +3.807445609134907e-02   +1.381275326622060e-02   +8.338259229602981e-03; +2.297673424775317e-02   +2.324351672073258e-02   +2.838600340237740e-02   +3.311891734271899e-02   +2.150000254937263e-02   +3.997165432261551e-02   +2.030941076692794e-02   +1.378277859702134e-02   +2.658704021886540e-02   +4.333365118704195e-02   +2.083228305018559e-02   +2.954798027500161e-02   +1.052237847908552e-02   +1.186415793480481e-02   +4.339671218592397e-02   +8.988406425300188e-03; +2.107030030089378e-02   +3.864626610855337e-04   +3.853954033151480e-02   +6.811999263181587e-03   +2.204594704137153e-02   +1.695786233069996e-02   +1.663130850954522e-02   +1.000848899511058e-02   +1.946751185114936e-02   +2.403799809167043e-02   +3.399419374040235e-02   +1.374731858339454e-02   +2.130541191391734e-02   +1.600779136126618e-02   +1.864592054015399e-02   +3.204464157655543e-02; +8.535234549672172e-03   +2.638942409954294e-02   +3.722454961096857e-02   +3.065296323650135e-02   +2.439502346142005e-02   +1.965007495815729e-02   +1.165949786561203e-02   +4.280799544199324e-02   +3.679434472109949e-02   +1.255314863498136e-02   +1.641935329543364e-03   +1.220938376799766e-02   +1.900620702030669e-02   +3.494215296759921e-02   +2.110565506938154e-03   +6.264739728147207e-03; +2.680344860907967e-02   +1.600091041378412e-02   +3.048924915169451e-02   +3.096546006449084e-02   +2.500818110142538e-02   +3.567748754718623e-03   +1.803345147537855e-03   +2.283268495811453e-02   +3.297062813481202e-02   +2.627128315288508e-02   +1.128381196522738e-02   +2.864036744687400e-02   +1.197209540549020e-02   +8.144916683688108e-03   +2.981093683214922e-02   +2.732069097160932e-02; +2.604037642340254e-03   +3.152750589512328e-02   +2.097084688050452e-02   +2.781684013326205e-02   +5.404710510795833e-03   +3.545223540785226e-02   +1.555153986615059e-02   +1.884756847498232e-02   +1.874384589114721e-02   +1.800219904455494e-02   +1.015446983560052e-02   +3.830614217448098e-02   +8.291907189341006e-04   +2.970312899006847e-02   +1.110591039867033e-02   +1.275231014085247e-02; +2.163646790927641e-02   +7.508775322060664e-03   +3.687204581284268e-02   +3.180644468232570e-02   +2.541676051481816e-02   +1.389422781559164e-02   +5.002402380778370e-04   +5.423540673925291e-03   +2.859669062651830e-02   +1.734181152640003e-02   +5.325767546129092e-03   +2.664731722526089e-02   +3.682115572270802e-02   +1.692905062291217e-02   +4.188995477933905e-02   +2.557378489306840e-02; +1.759986527208719e-02   +2.058359717249625e-02   +1.881067968271884e-02   +3.708612408830726e-02   +3.198001692471482e-02   +5.524418515157222e-03   +2.561525941546195e-02   +3.304501259969594e-02   +8.021004438967607e-03   +1.474842249920138e-02   +2.985225863461278e-02   +3.761494979154658e-02   +5.211271417007455e-03   +2.010074289833566e-02   +3.439926709578869e-02   +1.175193647531065e-02; +2.357210540852618e-02   +1.158976143770608e-02   +1.763636347741495e-03   -1.202761834653382e-03   +3.561596998624709e-02   +4.052955181520024e-02   +2.204534193219600e-04   +3.059202678179361e-02   +2.838283916196378e-02   +9.355704507358344e-03   +4.774463251453760e-03   -5.288783678719156e-04   +4.011451986263054e-02   +6.266445279460504e-03   +2.598597378450451e-02   +2.517534074892399e-02; +3.203223584311570e-02   +3.111161556143714e-02   +3.123730291581340e-02   +1.080548774064240e-02   +3.428092596188160e-02   +2.132110734503842e-02   +3.267334432967907e-02   +3.119348636681383e-02   +3.480462900937396e-02   +1.844675975516169e-02   +1.451700173299761e-02   +4.242458646403460e-02   +3.309863356413274e-02   +2.564690082177790e-02   +2.339868640956491e-02   +3.994463273037636e-02; +3.752068090078069e-02   +3.177561851746859e-02   +1.280374070765300e-02   +2.504221247348199e-02   +5.908906819397791e-03   +1.308055990212364e-02   +5.370599711217619e-03   +7.441800720911749e-03   +7.348268917129834e-03   +3.253473925547017e-02   +7.793826656738253e-03   +4.023825938253102e-02   +2.955479783900006e-02   +2.451372826142835e-02   +1.456495271277813e-02   +1.675687718671331e-02; +2.400060774699641e-03   +2.348820751755125e-02   +3.769133693764229e-02   +1.981239460870474e-02   +1.627513471318804e-02   +6.257869530134533e-03   +1.140364219286905e-02   +2.579415972512134e-02   +8.700272284849304e-03   +4.073495610357203e-02   +1.767045891534223e-02   +4.279378830425680e-03   -1.069834344341967e-03   +3.644477125811124e-02   -4.242396475651023e-03   +2.476032926669901e-02; +3.569523762462751e-02   +1.022358992611065e-02   +9.154118787247706e-03   +4.255823221228505e-02   +2.546769625206221e-03   +2.044084952742573e-03   +3.288413622402330e-02   +5.914302906687849e-03   +1.584091447148944e-02   +4.140715704329667e-02   +2.923455244958892e-02   +5.586612395949617e-03   +3.311110465466880e-02   +3.454889912632409e-02   +4.120788176455989e-02   +3.659001493286316e-02];
L1E_L1I_iGABA_netcon = [+2.134112160907738e-02   +2.926686753683413e-02   +3.878995146174929e-03   +1.456987116471192e-02   +3.715349359035110e-02   +1.617534042901177e-02   +1.983660852332323e-02   +1.122112688037016e-02   +5.292151682886107e-03   +1.355309253047964e-02   +1.098862334491221e-02   +2.011766171054485e-02   +1.624819921801180e-02   +4.118196910775632e-02   +3.905983664196832e-03   +1.425143138037983e-02; +9.767609283446331e-03   +3.298267540440121e-02   +2.066826268983799e-02   +3.632444488290213e-02   +1.796019289534809e-02   +2.307343822201138e-02   +8.912397270462492e-03   +2.524901713123126e-02   +2.424641918998987e-02   +5.988038118858846e-03   +7.270293820078108e-03   +3.514471383386130e-02   +1.291875292146975e-02   +2.818917607475645e-02   +2.191266935699814e-02   +3.600645692823812e-02; +2.458113973394693e-02   +4.789444849118608e-02   +3.466608603526861e-02   +3.211583731242459e-02   +4.462004831843711e-03   +2.170023060387637e-02   +2.697679514757596e-02   +3.434457629422007e-02   +3.841758731769221e-02   +3.942378851419005e-02   +2.381226477654103e-02   +2.356867860906311e-02   +4.189792752482712e-02   +3.011297866686016e-02   +1.809193860217069e-02   +2.596337759803601e-02; +1.372801565622470e-03   +5.637733437555021e-03   +3.832458080945932e-02   +5.694696139329078e-03   -1.817500531215169e-03   +2.698004810376017e-02   +3.256571928570961e-02   +1.739669802145485e-02   +1.886491952034598e-02   +4.143917609535198e-02   +2.842608275068025e-02   +6.352208597679918e-04   +2.017525154468816e-02   +1.489283219104141e-02   +4.971187204489964e-03   +4.034894454662188e-02; -9.332097978950954e-05   +3.970523444663663e-02   +1.851563993519685e-02   +5.429665431285603e-03   +2.242758776521225e-02   +3.227710819535135e-02   +2.660368192039694e-02   +1.801982281392399e-02   +2.487653515860089e-03   +1.702093694359224e-03   +3.291382708320990e-02   +7.902570234385724e-03   +3.506784410319963e-02   +2.344384123736726e-02   +2.815449975859232e-02   +1.627369188022345e-02; +3.541616832221683e-02   +3.262393889854899e-02   +4.752956963603411e-03   +3.202400907028417e-02   +1.595557964913012e-02   -1.305489623119673e-03   +3.151767992295525e-02   +1.427331612893997e-02   +3.487972317828111e-02   +7.905241664116866e-03   +3.384256419877948e-02   +5.260057236547771e-03   +1.664266612100165e-02   +1.216153412887241e-03   +2.683997039874969e-02   +5.487473509742458e-03; +2.179442591026155e-02   +8.568469629916149e-03   +6.338625007227341e-03   +1.425213694550006e-02   +5.403733375133050e-03   +1.614625647015675e-02   +1.135979082342489e-02   +1.763418944771975e-02   +3.985204817797342e-02   +1.003056091613438e-02   +3.928457144920879e-02   +4.335109818610487e-02   +4.958592271139560e-02   +2.885388181881483e-02   +2.365038966979995e-02   +1.161566346586151e-02; +1.390581961212780e-02   +5.715005530906549e-03   +3.929627566512590e-03   +9.591977674413023e-03   +2.562564706078055e-02   +1.908627003227552e-02   +2.023268933529500e-02   +2.574793082994695e-02   +1.183124732536947e-02   +1.507055610647320e-02   +3.325967934388723e-02   +4.925334820305813e-02   +2.189657168125176e-02   +1.876924109329241e-02   +6.149306143376271e-03   +2.934213534951445e-02; +1.465818159647572e-02   +2.216928817987509e-02   +1.411370118536170e-02   -8.404750799491238e-03   +1.266644804304214e-02   +2.938909091919387e-02   +3.693990527968904e-02   +4.394717807971435e-02   +1.814573288294538e-02   +4.865141707157020e-03   +3.351190188577646e-02   +1.660296904317810e-02   +3.645609587321377e-02   +3.835098398737867e-02   +2.192921075074019e-02   +9.805696265889173e-03; +5.908493943164359e-04   +1.645478353315396e-02   +7.463503025832846e-03   +2.453304971629108e-02   +1.127505888112042e-02   +3.393185351277841e-02   +1.680129719253919e-02   +8.545849264333837e-03   +3.720493036623865e-02   +3.895461018047289e-02   +7.271211700744068e-03   +2.529544600508022e-02   +3.779334832171123e-02   +1.200301247693287e-02   +2.795566516141334e-02   +1.519407237080752e-02; +4.233253315048061e-02   +5.478918307360874e-03   +1.149153710194595e-02   +1.768314797855219e-02   +2.793895102041919e-02   +2.281062343120355e-02   +2.303729330827187e-02   +4.422042107137062e-02   +1.741885018774799e-02   +1.566223638460415e-02   +2.357072382464369e-02   +2.409631024143781e-02   +9.910685196814539e-03   +4.123321555584981e-02   +3.621299726078468e-02   +1.166612583414340e-02; +1.191615813696568e-02   +4.205430713665916e-02   +2.302061375938040e-02   +3.471360615629646e-02   +4.332349173462644e-02   +3.280614153673584e-02   +1.716094638124380e-02   +7.038456236740268e-03   +3.070182131402298e-02   +2.074666645240163e-02   +6.380000060313787e-03   +3.556010422765566e-02   +2.759385837794203e-02   +2.988973538040780e-02   +3.034434220508106e-02   +6.776682024033413e-03; +3.479890803778172e-02   +4.452977228047279e-03   +2.589432430153700e-02   +2.174717905242607e-03   +2.058484760404589e-02   +2.355094460220437e-02   +2.431839028885969e-02   +8.198965893913397e-03   +3.583743826839818e-02   +3.598864550702744e-02   +1.013912126904266e-02   +3.104410614532042e-02   +4.365736072944042e-02   +3.128350762239440e-02   +1.159654343092200e-02   +3.778367856576403e-03; +1.108224496609365e-02   +9.291422527820626e-03   +3.943926545453844e-03   +2.878164665671525e-03   +7.916368116930137e-03   +3.648788146707458e-02   +4.201110144017061e-02   +3.418655416786910e-02   +1.608856460234878e-02   +2.684522031478866e-02   +3.477531481257597e-02   +2.800708308847541e-02   +2.719880058896447e-02   +3.599762600299207e-02   +2.955882423809663e-02   +3.110585951649601e-02; +2.198050297988812e-02   +6.938710821242417e-03   +2.020102568986408e-02   +3.415494710904383e-02   +2.235284863360132e-02   +1.876421802892892e-02   +6.153841993768810e-03   +1.417956149704427e-02   +1.237507184907729e-02   +2.970711252140459e-02   +1.066696739313266e-02   +2.140548553601890e-02   +1.156151201747199e-02   +6.017548203907249e-03   +5.256299386628411e-03   +1.602335416226698e-02; +1.974255781898457e-02   +6.764351704690051e-03   +7.092927629916384e-03   +3.447007771579630e-02   +3.924565633267154e-02   +5.817639310811462e-03   +1.137944391715439e-02   +3.685047999051674e-02   +3.379584469027053e-02   +4.219422855059933e-03   +5.040233498869039e-04   +2.037214338425437e-02   +2.760199438819630e-02   +2.117472983391253e-02   +1.928515856392573e-02   +2.442428976625818e-02];
L2I_L1I_iGABA_netcon = [+4.221572692293286e-02   +1.282292407287856e-02   +9.937827735802041e-03   +4.245358250282118e-02   +4.708678221147597e-02   +3.516013471123715e-02   +1.795184501793620e-02   +3.281153876105133e-02; +3.528404906538111e-02   +3.922180589047979e-02   +2.757093233003577e-02   +1.478732482703732e-02   +2.066548621233488e-02   +2.835457162531911e-02   +3.645119890381869e-02   +1.208157878680935e-02; +4.585863732463447e-03   +1.025419148210105e-02   +1.202875231491027e-02   +1.985272751465728e-03   +3.569826664018966e-02   +4.354360743508368e-02   +6.182232667595748e-03   +2.473948717384230e-02; +1.259269732440250e-02   +3.707377272982143e-02   +2.748308868059076e-02   +3.010020427167466e-02   +2.092825326782760e-02   +1.784208119625633e-02   +1.617628026193740e-02   +3.905532071250584e-02; +8.029386188743617e-03   +8.392913757172949e-03   +2.673185116274886e-02   +2.524042519184982e-02   +1.672983674159114e-02   +3.510363407820822e-02   +1.909190946305217e-02   +2.886034387570511e-02; +3.080211228104383e-02   +2.532705989073820e-02   +3.970503449047696e-02   +2.311240112436604e-02   +1.489721097508734e-02   +2.635210366222383e-02   +1.491978052950025e-03   +3.040780861174941e-02; +2.417539113937795e-03   +1.580583415483157e-02   +1.621761080408081e-02   +1.325988807655851e-02   +3.341005005221175e-02   +1.238211746329595e-02   +1.059471687101052e-02   +3.221456726889828e-02; +2.302767295080131e-02   +1.960299361864539e-02   +3.190282536442962e-02   +1.753549567745727e-02   +1.046143981826399e-02   +2.885826261633263e-02   +2.301691089118360e-02   +1.054747912506230e-02; +2.255622454645009e-02   +2.489171765290875e-02   +9.840816933842294e-03   +8.905748456381004e-03   +1.484696200020827e-02   +5.315885941703972e-03   +1.778060844895686e-02   +4.174012024300718e-02; +1.802213339997646e-02   +2.599918494662090e-02   +7.377416117071880e-04   +1.925411130298012e-02   +9.126388083327492e-03   +2.723002863277020e-02   +4.010158269651794e-02   +2.987651408611515e-02; +1.524663104572880e-02   +3.886424594468204e-02   +3.852208341694426e-02   +1.506092336561188e-02   +2.869175414395311e-02   +3.454540296186747e-02   +8.668516695929020e-03   +1.594687647191349e-02; +3.677634159408072e-02   +1.814231424131687e-02   +2.837392645781297e-02   +1.838338306149059e-02   +3.732536402987024e-02   +9.037120227019829e-03   +2.841588401896704e-02   +1.337712230827031e-02; +1.402359614728817e-02   +3.839910756799650e-02   +3.977765910872812e-02   +4.546933349260281e-03   +2.273822108510569e-02   +1.005076483980063e-02   +1.575960663078076e-02   +2.837986538051692e-02; +3.439016546112106e-02   +1.075097391568903e-02   +4.113501303375654e-02   +2.582812231503403e-02   +3.489521345444759e-02   +1.289022692069567e-02   +3.754147769701027e-02   +1.271424640204123e-02; +4.513404545595315e-02   +1.328564628505162e-02   +1.036623884068984e-02   +4.716221255431176e-02   +3.172960204361677e-02   +3.461801850974396e-03   +1.702936402358352e-02   +3.261868795875207e-02; +1.029334677962089e-02   +3.161326606609929e-02   +2.446728355428402e-02   +2.646771820344676e-02   +3.572784890756143e-02   -8.062992172226664e-04   +3.787756642121883e-02   +1.400094288594955e-02];
L1I_L2I_iGABA_netcon = [+2.515377570460135e-02   +2.594355086753856e-02   +4.731528543350000e-04   +4.823113136179918e-03   +2.350990348513302e-02   +1.742953664230722e-02   +4.169158351357893e-02   +2.769066875555584e-02   +1.767543230438758e-02   +3.952747168401945e-02   +4.423564857438187e-03   +1.024597008531193e-02   +6.779235030470099e-03   -2.079846239658218e-03   +1.032319010663220e-02   +3.777643379650278e-02; +3.577606503503342e-02   +2.351634003390698e-02   +1.962483409467920e-02   +1.905246113027648e-02   +3.829985971320107e-02   +2.166354714126602e-02   +2.081340126107708e-02   +4.260127028259048e-02   +2.259736306264032e-02   +4.131871465768332e-02   +3.014138358439815e-02   +1.847921027636353e-02   +2.359165187725661e-02   +2.800782187231318e-03   +4.624637525297973e-03   +3.468423526072357e-02; +3.587773843905130e-02   +2.696739279853999e-02   +6.990522359791687e-03   +3.329629016439221e-02   +1.628610672799776e-02   +4.126193940940575e-02   +2.733400371341886e-02   +2.752829568790980e-02   +1.437773788999357e-02   +2.468314137818330e-02   +2.607418769939871e-02   +1.977234281876779e-02   +1.989840849083460e-02   +5.034606772892459e-03   +2.764983114419127e-02   +8.139081919889076e-03; +1.961789683555801e-02   -2.157446432271767e-04   +2.729086982687252e-02   +3.524177799003703e-02   +7.207498084449795e-03   +3.916825648641876e-03   +1.681564608731119e-02   +1.346106079948259e-02   +3.778044283502874e-03   +3.054580120305527e-02   +1.860637765033628e-02   +1.602040577719855e-02   +1.184357387430308e-02   +6.194443225252826e-04   +2.820194190764260e-02   +2.083957754747512e-02; +8.823506438301727e-03   +3.561933998864945e-02   +3.395015237347072e-02   +2.947755964806850e-02   +2.649437312039938e-02   +2.781607155812023e-02   +2.490965418797402e-02   +4.140268148142376e-02   +2.131269656562708e-02   +5.549394657237989e-03   +1.168597778884778e-02   -1.242811473248908e-03   +1.009325544401793e-02   +4.415520199183373e-02   +8.227232595829108e-03   +2.703457379347617e-02; +2.549335359477230e-02   +2.832798365465515e-02   +3.115849742229936e-03   +4.104329347504902e-02   +2.216400014567580e-02   +4.434648462659598e-02   +3.130351213518319e-02   +3.740092461216934e-02   +2.861960414159903e-02   +2.818278407001459e-02   +3.748520461722265e-02   +2.916960131866372e-02   +5.783091212125653e-03   +4.067534937436349e-02   +2.930108797185967e-02   +3.481685050167579e-02; +3.797991374614117e-02   +9.490765321172049e-03   +3.273114791783691e-02   +3.874442417134796e-02   +1.582081750396804e-02   +4.692453825885306e-02   +2.382245927402597e-02   +1.859182463868846e-02   -1.135227915717955e-03   +2.467196837865421e-02   +1.640643609468048e-02   +1.212441972480679e-02   +3.657795641914989e-02   +1.766421198141293e-02   +3.971837520665362e-02   +2.490134825183550e-02; +3.058580924353871e-02   +4.999965990745941e-03   +4.027948195776075e-02   +3.247196337699781e-02   +5.122709208552926e-03   +3.436533026857328e-02   +3.146093250508138e-02   +3.056702643462302e-02   +1.844128711533585e-02   +3.744478778938289e-02   +9.364466456269139e-03   +1.769708040978833e-02   +2.285377648546670e-02   -5.481363756788001e-03   +3.744286433348257e-02   +3.635686123167173e-04];
L2E_L1E_iAMPA_netcon = [+3.669559622732946e-02   +1.256097396911300e-02   +8.568348381680961e-03   +4.729735807074778e-02   +9.542821706351703e-04   +1.582866853623819e-02   +3.132339531538475e-02   +4.235416117816576e-03; +3.311698385023183e-02   +3.982354706855902e-02   +2.697027833967010e-02   +1.420561466659058e-02   +2.296642551692872e-02   +1.391645873395588e-02   +4.045664794418810e-02   +2.012441769424644e-02; -2.715728656961419e-03   +6.768226300296274e-03   +7.277741934278133e-03   +1.285395701882516e-02   +2.633022570736537e-02   +4.216243160298185e-02   +1.837536497466213e-02   +8.075923401875131e-03; +1.209666361234554e-02   +3.347586496863064e-02   +1.427067717071929e-02   +2.892703358037691e-02   +3.696283465424824e-02   +1.400662832364935e-02   +3.318378019212869e-02   +4.106331013883079e-02; +9.798402979247663e-03   +4.295739571654366e-02   +9.164356944967767e-04   -4.478698538017321e-03   +4.039810451298201e-02   +4.147852462459473e-02   +2.997451953409474e-02   +1.902492295726955e-02; +2.634279604590408e-02   +1.667734856105281e-02   +3.803227025238188e-02   +3.370568215873083e-02   +2.536310120965225e-02   +9.557308917001739e-03   +2.501824358686346e-02   +3.083523153991606e-02; +9.176704217450423e-03   +1.500315104603043e-02   +5.512570107507183e-03   +1.248105069738514e-02   +3.614174217146796e-02   +1.745194049415476e-02   +7.279963426440541e-03   +1.542855534312455e-02; +6.940240703845552e-03   +1.968626800679901e-03   +2.179897441725500e-02   +2.710654423599573e-02   +1.410662811588110e-02   +4.002736119317120e-02   +3.860382931782593e-02   +3.302088556256165e-02; +1.465941231503091e-02   +3.587362690975931e-02   +1.759703090711837e-03   +1.089028614703639e-02   +5.215747441884267e-03   +4.366862701626281e-02   +1.698317094908100e-02   +6.730466132111982e-03; +1.174012805404474e-02   +1.040945078841645e-02   +3.925163853726971e-02   +1.535405422628729e-02   +4.497628888576066e-02   +3.615908883196375e-03   +8.382922020040923e-03   +3.276194903787715e-02; +2.563682500090082e-02   +1.792090718686339e-02   +3.448260824101127e-03   +2.792025190924029e-02   +1.746940113752107e-02   +1.150378619998208e-02   +2.883011049283879e-02   +2.995561213062668e-02; +1.005132545528979e-02   +1.700323707371488e-02   +3.633422727725413e-02   +2.567816702975305e-02   +2.416112459963666e-02   +7.904380825848411e-03   +3.827590958778365e-02   +1.698287162973931e-03; +2.397416545405934e-02   +3.043416820879254e-02   +4.075660437207772e-03   +5.634497993305882e-03   +4.095500201650873e-02   +2.978541400098863e-02   +2.121601439369179e-02   +4.458829325683344e-02; +2.166960234389743e-02   +4.909718700644030e-04   +8.295124427579225e-04   +3.411490709277438e-02   +2.624522148773499e-03   +8.782551200488901e-03   +2.139566718191334e-03   +3.280079235432337e-02; +1.374114254990492e-02   +9.384107105594527e-03   -1.612493116567321e-03   +3.820372340736099e-02   +1.025065554044649e-02   +4.081041626276035e-03   +1.722616113855893e-02   +4.911958218070930e-03; +1.085194939761046e-02   +1.918905952003478e-02   +4.051120008546442e-03   +1.793353600844338e-02   +4.347533936225370e-03   +2.519826232118431e-02   +4.658636973357233e-03   +3.648795287551392e-02];
L1E_L2E_iAMPA_netcon = [+6.653405209372269e-03   +8.770918164400524e-03   +3.861950893036181e-02   +3.817599452699347e-02   +1.535097443529320e-02   +4.038995574025190e-02   +2.200280135912346e-02   +4.611161763441061e-02   +7.783004910088110e-03   +2.372246594188203e-02   +2.162425731520736e-02   +2.768769587254689e-02   +1.430610073911320e-02   +2.599110740140090e-02   +2.860690692996743e-02   +2.401237767934713e-02; +1.505839060444887e-02   +2.961041621017561e-02   +2.948135218274662e-03   +1.208283114425079e-02   +1.319547648174976e-03   +2.847290026269548e-02   +4.074034838201792e-03   +7.615988550985042e-03   +1.062279143752838e-02   +1.633406331226500e-02   +1.731998090719592e-02   +3.913080132298414e-02   +3.149579022854064e-03   +1.082506460596716e-02   +2.126280370861785e-02   +1.366181153629483e-02; +1.658266737569344e-02   +2.627906543505724e-02   +4.323286726809016e-02   +3.553902645917351e-02   +4.099204289665891e-02   +8.332352149320828e-03   +1.649533643224442e-02   -7.398206753903653e-03   +1.911348185958099e-02   +2.627283258893401e-02   +1.253444112435959e-02   +4.096449343942443e-03   +2.745289272141666e-02   +2.406638342613844e-02   +4.303692462529150e-02   -5.272354134613745e-04; +3.030796578027069e-02   +9.568137199871881e-04   +5.944581697968631e-03   +9.501697494934987e-03   +3.237246176561829e-02   +1.136211144045665e-02   +4.084381866518259e-02   +4.094765538811988e-02   +3.273360000280343e-02   +3.280341802039992e-02   +1.146112302600762e-02   +2.057540121089331e-02   +4.194510912401338e-02   +1.436093200533003e-02   +4.144073604172161e-02   +3.988300963411697e-02; +4.043713280896469e-03   +4.841776040503268e-02   +2.739663455608551e-02   -2.476028829677776e-03   +7.408315606820587e-03   +3.163275002491948e-02   +3.785228675028857e-02   +2.552098085687708e-03   +2.571330656807501e-02   +1.336795535740892e-02   +1.854584755535835e-02   +3.179259022863860e-02   +9.612914439698476e-03   +2.519333693416191e-02   +3.987263510927276e-02   +1.848181590940222e-03; +1.198106023588982e-03   +3.670437098948552e-02   +1.439092300416380e-02   +4.013522277741254e-02   +4.072639721298103e-02   +3.749613063423560e-02   +1.691719506412304e-02   +3.243133176136021e-02   +1.343963546265863e-02   +1.802495866422337e-02   +3.438355045974826e-02   +4.249755359690024e-02   +3.882928174898297e-02   +2.859552949435568e-02   +9.013906836296090e-03   +2.140967429008979e-02; +9.204994762987887e-03   +1.066403077116857e-02   +3.004079268901958e-02   +8.656836873793696e-03   +1.629099011715132e-02   +2.037205689506837e-02   +2.837533221128344e-02   +2.783196627815052e-02   +2.676623154111123e-02   +3.241403622004357e-02   +3.141944763740646e-02   +5.995877627817452e-03   +1.571832559794488e-02   +3.029886119407427e-02   +1.203081299304279e-02   +1.079948027276968e-02; +6.444111040615653e-03   +2.261732732319554e-02   +2.517280144099810e-02   +1.678976654917119e-02   +2.789553753610273e-02   +4.208380664302770e-02   +3.831452020958523e-02   +2.645534281617967e-02   +3.941422042807427e-02   +1.826306086657086e-02   +1.309720507918346e-02   +4.101852697472453e-02   +3.390470193959727e-02   +3.275804967892691e-02   +1.245755887744331e-02   +7.730441888015803e-03];
L2I_L2E_iAMPA_netcon = [+2.479215910378460e-02   +1.435445185772664e-02   +3.768926210748883e-02   +2.306896271763070e-02   +3.695054039675832e-02   +1.813119665421034e-03   -6.225280434764291e-04   +3.500711220741582e-02; +6.829685283902310e-03   +5.284040669013961e-03   +7.587545007683457e-03   +3.270398787910525e-02   +3.229143200045149e-02   +1.738237738217657e-02   +3.123183159975607e-02   +2.505028019507574e-02; +3.221090150875307e-02   +3.534481822118091e-02   +3.759135773156386e-02   +2.974058075038965e-02   +2.172166819880367e-02   +2.109180907201224e-02   +1.402357294486596e-02   +2.833961046319271e-02; +1.366491616574717e-02   +1.491796949019817e-02   +3.966458128995053e-02   +1.678391519375550e-02   +4.004545207060457e-02   +7.144849146553729e-03   +1.037089094009662e-02   +3.997442365085839e-02; +2.749561938595626e-02   +3.838494531990409e-02   +1.834445058667161e-02   +2.466926326051385e-02   +3.523404308387503e-02   +2.610547041434908e-02   +1.772847250974288e-02   +2.712772567764113e-02; +3.136775133373208e-02   -2.573426237084039e-03   +3.793475411523009e-02   +3.197891031925484e-02   +2.290411625127209e-02   +1.400499584708166e-02   +6.622399786673012e-03   +3.489187760173319e-02; +3.946510662513434e-02   +2.093174328658599e-02   -2.757539361895996e-03   -1.142762425710553e-03   +1.081081251920064e-02   +8.326768292169441e-03   +9.248299518859930e-03   +1.172960002356248e-02; +3.990338705228728e-02   +8.694096099806318e-03   +1.860488722148174e-02   +2.075776367777785e-02   +3.750688050610256e-02   +9.925173770007000e-03   +6.333285504590088e-03   +9.101411196177736e-03];
L2E_L2I_iGABA_netcon = [+4.090390902229116e-02   +1.017350065630446e-02   +6.227622868807823e-03   +7.376745461934223e-03   +3.524810354896930e-02   +1.702880850913274e-02   +2.850651027532821e-02   +4.251760799626851e-02; +1.543878878435024e-02   +1.864578954838992e-02   +1.114223736869011e-02   -6.119468663790952e-04   +4.298995767156081e-02   +3.444307236710920e-02   +3.118446968326942e-02   +3.032272624002165e-03; +2.460431908450357e-02   +1.240790622767769e-02   +2.169837225696377e-02   +5.506628853441692e-03   +1.431285772611112e-02   -1.501566036594469e-03   +4.818326609611232e-02   +3.329099179447568e-02; +3.107150250997130e-02   -3.050905208213591e-03   +8.247388456793930e-03   +2.985644391464129e-02   +3.640809791274578e-02   +3.720192070871088e-02   +1.681457248563142e-02   +2.443134270364150e-02; +4.950386720642818e-03   +3.129127020030812e-02   +2.994537982272717e-03   +3.080846692024306e-02   +1.696558458109744e-02   +1.517806343003880e-02   -2.027985033635700e-03   +8.999285368475636e-03; +2.952175328392397e-02   -9.420468330017955e-03   +2.406162478238772e-02   +3.495560692985470e-02   +3.822752525688361e-02   +1.758912432198233e-02   +4.170923118911583e-02   +3.455366832374668e-02; +5.904715710823269e-03   +4.939930351021200e-02   +1.366203878423903e-02   -4.492793933085631e-03   +3.594195249599409e-02   +1.613620880737734e-02   +1.832728039913227e-02   +1.924550934607802e-02; +3.398785308925598e-02   +1.480385672689574e-02   +2.170425760827840e-02   +1.508546097091888e-02   +1.720580318948095e-02   +3.473295443097147e-02   +3.627577994147851e-02   +2.787489156971829e-02];
L3E_L2E_iAMPA_netcon = [+1.919081237646401e-02   +2.770476392513389e-02   +7.201371603780232e-03   -1.180903762594346e-03   -1.003329844469731e-03   +4.243014484397941e-02   +1.870741647308369e-02   +3.538923578460441e-02   +2.738460199667950e-03   +5.990090073075154e-03   +1.711997989091538e-02   +3.283667646861979e-03; +8.451350788272966e-03   +3.999595396242263e-02   +1.343378503493029e-02   +1.952172570341669e-02   +2.698775973695228e-02   +2.472551357700499e-02   +3.883689653954969e-02   +3.821930043485591e-02   +2.510225255806578e-02   +4.098821651165264e-02   +1.558783229562464e-02   +1.111137661891192e-02; +7.097115778637229e-03   +3.819407400676419e-02   +3.555046977880918e-03   +3.368304567577019e-02   +1.007348146346025e-03   -7.692851744698768e-04   +2.491964409929136e-02   +4.145224025305578e-02   +2.639565388827499e-02   +1.932027414480363e-02   +8.736352321697368e-03   +2.581677888280357e-02; +2.294785148861671e-03   +1.839865238662358e-02   +3.680448100661556e-02   +1.625322216596294e-02   +5.980571158868150e-03   -5.364179258016142e-04   +1.439967555746914e-02   -8.798018962653598e-04   +7.710548599738604e-03   +1.456743638033315e-02   +1.076265887052045e-02   +1.565996804097083e-02; +3.885071201621752e-02   +1.402314284022455e-02   +1.653543592951364e-02   +3.622672487887556e-02   +3.002632695478153e-02   +1.282627378795484e-02   +3.641819167863451e-02   +9.350832161216786e-03   +3.456899910358044e-02   +1.991306423175570e-02   +3.669817960913257e-02   +1.621786932589537e-02; +3.500262318790330e-02   +2.674737781671834e-02   +4.220509138280468e-03   +1.872722520798977e-02   +2.304765911706963e-02   +4.046422856747309e-02   +4.455138694972456e-02   +1.221923224977644e-02   +2.243211397560211e-02   -2.620942091587598e-03   +2.774458986625847e-02   +4.060581250771630e-03; +3.244396419191962e-02   +1.443008449711808e-02   +2.198883523284323e-02   +9.997724394985254e-03   -2.808890822577966e-03   +2.165242198747849e-02   +5.940771991416212e-03   +2.053261919299502e-02   +9.863141020530273e-03   +2.742066738095886e-03   +1.541293866026872e-03   +2.014246399495112e-02; +3.237464860626710e-02   +6.759800592832800e-03   +3.636886732988579e-04   +1.416106536093502e-02   +2.074237880767211e-02   +2.175558355678107e-03   +7.021965011846674e-03   +1.467148289650898e-02   +2.166348226812775e-02   +3.494500424350936e-02   +5.076973177101829e-03   +2.521638060566898e-02];
L3I_L2I_iGABA_netcon = [+4.611253353963724e-02   +2.728390571621499e-02   +2.901934518817601e-02   +1.675511352786341e-02   +3.872438213610569e-02   +2.238009104553394e-02   +6.837980629387895e-03   -5.056815316381580e-05   +4.036129324251254e-02   +2.211071931730068e-02   +4.869805983248541e-03   +3.162381653428166e-02; +3.187917001531797e-02   +4.722770898989988e-02   +3.462046450943821e-02   +9.953321429485266e-03   +1.969299349354459e-02   +2.747434623219669e-02   +3.998352672286516e-03   +4.516659038760638e-03   +2.474735932809894e-02   +2.818030909486646e-02   +5.784209367512154e-03   +2.987175475182756e-02; +4.822023748812050e-03   +2.850834201777890e-02   +3.861727718097099e-02   +4.920779198717600e-03   +3.079221627391896e-02   -1.877159525212957e-03   +3.204770873587044e-02   +4.321554443515740e-02   +3.035288165283831e-02   +1.913488124750740e-03   +2.395925997851566e-02   +3.553401319971831e-04; +4.213635886056452e-02   +3.599060953833358e-03   -3.876668004651974e-03   +3.001287810928063e-02   +3.900864953240574e-02   +2.151813964022450e-02   -9.835697210352188e-04   +2.340900791896866e-03   +4.280114826973899e-02   +3.279636998500379e-02   +3.843601642125490e-02   +2.987534342084314e-02; +1.071717953169227e-02   +4.973709189259747e-02   +1.087030902792944e-02   +1.470555312263818e-02   +2.229912455902597e-02   +4.300891082419663e-02   +1.236384983088711e-02   +3.800803666347283e-03   +3.956046591610379e-02   +2.604245112050950e-02   +4.377652941026992e-03   +9.653320885533010e-03; -6.847528464500704e-04   +2.611387127516323e-02   +1.360553066806815e-02   +3.568867670753708e-03   +2.585547812072781e-03   +2.432458694720477e-02   +2.990994490537587e-02   +1.932745428551805e-03   +2.729845392792845e-03   +3.016647850913894e-02   +2.766716790613177e-02   +7.548286531956083e-03; +2.902423258053412e-02   +3.493683024052587e-02   +2.526369020683794e-02   +3.191588665407345e-02   +2.144675831083418e-02   +9.579106762458139e-03   +2.093552176230639e-02   +3.208852560812044e-03   +3.908929124890251e-02   +1.329664554518513e-02   +2.235753087708254e-02   +2.953833764569377e-02; +2.287378112665159e-02   +3.980599247433325e-03   +1.324475970919963e-02   +2.358998634598459e-02   +1.842927217204739e-02   +6.610416517126719e-04   +7.685565081372776e-03   +1.036096684005530e-02   +2.602547797398098e-02   +3.896540437384288e-02   +9.065679787350140e-03   +1.354341353881907e-02];
L2E_L3E_iAMPA_netcon = [+3.042683224719466e-02   +2.152216697804485e-02   +1.416517062368767e-02   +3.205634888766610e-02   -5.606681123987147e-04   +2.864389600530140e-02   +3.313806293507413e-02   +3.991314438115649e-02; +2.268691328477808e-02   +3.228528586726435e-02   +3.065658055098668e-02   +2.610904396931834e-02   +1.082742830161218e-03   +2.580771150422849e-02   +4.003058378262327e-02   +2.778871419608022e-02; +3.119913190860976e-02   +3.800219060733632e-02   +3.776816818351282e-02   +3.890517410558628e-02   +3.252684545349028e-02   +3.251065205335066e-02   +3.262271416206111e-02   +2.620297082085905e-02; +1.593107827081739e-02   +3.960535790338150e-02   +3.669265748114060e-02   +2.497400524092589e-02   +1.879659229934048e-02   +1.991863235452953e-02   +1.039836917022206e-02   +3.812713741719190e-03; +6.255401034304677e-03   +2.313834333491173e-02   +1.082046536053435e-02   +4.695566627280722e-03   +8.212248438354133e-03   +2.211996402372961e-02   +4.013138286539428e-02   +3.269185009596232e-02; +2.024018428809797e-02   +4.299148294111969e-02   +3.659341342008602e-02   +2.761730502690568e-02   +2.009215771841336e-02   +4.240297996861012e-02   +2.564147291577318e-02   +3.827949394719193e-02; +1.580667847536738e-02   +1.894056188482554e-03   +2.374513852432028e-02   +8.826787812805631e-03   +1.593092738962674e-02   +4.004519909367836e-02   +9.852239522509073e-03   +2.851079866310334e-02; +3.558172809722607e-02   +2.708694251468353e-02   +2.254875752997950e-02   +3.465810493083834e-02   +1.658584056445622e-02   +3.591772717195574e-02   +2.608876562332228e-02   +2.051479803403085e-02; +1.144375411629458e-02   +2.434342949357623e-02   +4.399912129975442e-02   +2.779264887318854e-02   +2.277361721871601e-02   +6.495302884391001e-03   +2.771144190647953e-02   +2.937251265086781e-02; +1.494083938389016e-02   +1.243532587723673e-02   +3.341121906066867e-02   +3.767157536501019e-02   +4.406244358066005e-02   +3.107940372815974e-03   +1.389476169100746e-03   +3.074302691795093e-02; +2.241968273022075e-02   +1.132875442185682e-02   +3.165477377124407e-02   +2.836561841304135e-02   +3.973752915486315e-02   +4.725518533087382e-02   +1.010746324270148e-02   +1.382921058978443e-02; +2.341355222281695e-03   +3.141941830073801e-02   +1.567827155303771e-02   +3.299406230516438e-02   +1.932187230569300e-02   +3.910766833337164e-03   +3.327592151223726e-02   +3.533072416911085e-02];
L2I_L3I_iGABA_netcon = [+3.669993938249380e-02   +1.579461331463126e-02   +1.279670285896101e-02   +2.400973525234967e-02   +3.844201112097630e-02   +3.897598184551730e-02   -5.327409115711352e-03   +2.073133408170643e-02; +1.979518350937511e-02   +2.077533367963640e-02   +3.219346961171080e-02   +9.390120386424491e-03   +3.294166947569244e-02   +3.253542335032939e-02   +2.267346251193349e-02   +1.513721623504840e-02; +3.118782476523000e-02   +3.519085142829740e-02   +3.900557894492198e-02   +2.730471654432880e-02   +2.154093474040368e-02   +2.584418080866180e-02   +1.717812100117838e-02   +2.270206847016237e-03; +7.518278579957227e-03   +3.646121024842015e-02   +4.620856078332975e-03   +1.629526789717924e-02   +7.820586008112690e-04   +1.281502647964590e-02   +2.134449999763335e-02   +4.284772391834995e-02; +1.747565412484440e-02   +2.013858377125476e-02   +2.193113829362064e-02   +1.941628461326051e-02   +1.584743878052765e-02   +2.092828873842302e-02   +1.737286242986585e-03   +8.530740484387657e-03; -2.452971155649610e-03   +7.409463989384059e-03   +1.662540001820688e-02   +7.078213463784490e-03   +1.428574702554753e-02   +2.321330329901665e-02   +1.608078264642420e-02   +3.668849856620417e-02; +1.482415796060532e-02   +1.621674818992353e-02   +4.258386235582495e-02   +3.263047118025576e-02   +3.277579468448624e-02   +1.119790066833257e-02   +1.714830864235637e-02   +1.656691234670171e-02; +8.860009319874625e-04   +3.846177965502643e-02   +1.007020144567221e-02   +3.105659391503535e-02   +7.867403437064545e-03   +3.439700636874560e-02   +2.716126015351150e-02   +2.928314002375339e-02; +3.041103732097180e-02   +1.603985253438040e-02   +3.868575529655906e-02   +4.716812912922454e-03   +2.186394227935640e-02   +7.197095619498377e-03   +1.368043681186301e-02   +2.380155284710092e-02; +3.227649452480297e-02   +2.211503976901830e-02   +2.150252905042268e-03   +1.958163782087239e-02   +1.812980840139308e-02   +7.639100829395009e-03   +7.492448846454470e-03   +1.212145573014292e-02; +3.147604903303060e-02   +4.389261182596368e-02   +2.731900096032564e-02   +2.875843472057858e-02   +1.563308214658382e-02   +1.656622116019598e-02   +3.853031127360732e-02   +1.198183478543713e-02; +2.922294914812587e-02   -6.415499941375372e-03   +1.459975462762637e-02   +5.818252680308516e-03   +8.957438180314758e-03   +3.835413742161291e-02   +2.663575238066633e-02   +2.799194483978143e-02];
L3I_L3E_iAMPA_netcon = [+1.872449484029350e-02   +4.023252414958130e-02   +7.583853794375550e-03   +2.611027259733032e-02   +2.885835850990525e-02   +2.265128129065803e-02   +1.713219771548322e-02   +3.628722536540402e-03   +2.210337027934058e-02   +1.457060478515581e-02   +1.126321884236934e-02   +4.968420243350135e-03; +1.874719102813689e-02   +3.230678644372079e-02   +1.546024906030441e-02   +4.046898050023947e-03   -1.749593076949332e-03   +2.240641504192918e-02   +2.781419569735587e-02   +1.521207929695621e-02   +1.342413007283116e-02   +1.787111362057972e-02   +3.310665551300145e-02   +2.430343755573390e-02; +2.926760558456124e-03   +2.358775625571631e-02   +1.732425094639071e-02   +2.786424532105710e-02   +2.250233067222131e-02   +1.854537557094358e-02   +2.181122261077353e-02   +1.297556319238066e-02   +1.660231107561958e-02   +2.273538496780866e-02   +1.319258692095748e-02   +2.478288197875297e-02; +2.250016664951431e-02   +3.026620187953937e-02   +2.833905709551521e-02   +1.621150792679706e-02   +2.585600711323004e-02   +3.440945629194499e-02   +3.344163750694272e-02   +9.249433843325367e-03   +4.049679424597825e-02   +3.653145878578476e-02   +1.403627186139767e-02   +2.415438283867783e-02; +2.510482437168868e-03   +1.616527812139597e-02   +7.308372850391237e-03   +3.456974560772575e-02   +3.374075061347383e-02   +2.006507518048605e-02   +3.954521965675321e-02   -9.486215158848820e-04   +3.594463504521181e-02   +1.983595580683322e-02   +1.131656579573106e-02   +2.325837105622287e-03; +1.122328682915387e-02   +1.885803212179099e-02   +3.880990807716059e-02   +2.481381392127207e-02   +4.195401992106503e-02   +6.621696612252323e-03   +3.141904019630967e-02   +1.097409898406279e-02   +2.702911710796582e-02   +5.757828029189663e-03   +7.639770000310960e-03   +8.057766420687130e-03; +3.364265389565299e-02   +1.580499652932767e-02   +1.294499922442385e-02   +1.397504062832590e-02   +1.900232807081583e-02   +9.372522683444908e-03   +2.199317462530962e-02   +4.157857863089783e-02   +4.054715724683609e-02   +4.654251004367566e-02   +1.886929318789210e-02   +3.230295311538924e-02; +3.648040622600499e-02   +9.623517605808619e-04   +3.186498413206802e-02   +2.984803419968451e-02   +4.380207204194470e-02   +2.603662403559094e-02   -1.546395867279019e-03   +2.443099490562859e-02   +2.595688542886118e-02   +9.674976975316803e-03   +1.000063963716422e-02   +4.389616274437698e-02; +4.248765042086445e-03   +3.670773508003371e-02   +2.981474062035900e-02   +2.443275227825414e-02   +1.562692967699363e-02   +3.167130185018679e-02   +1.347756179325974e-02   +3.431271093778188e-02   +2.972835879180672e-02   +1.733906493327904e-02   +1.390745026006891e-02   +6.993439525391371e-03; +3.610887931160187e-02   +3.591749566852193e-02   +1.918598003832685e-02   +1.075878673881291e-02   +2.289141671922413e-02   +3.444502841418672e-02   +2.515933875026083e-02   +4.164962433770136e-02   +3.217084328180029e-02   +1.684448313116083e-02   +3.690918395535554e-02   +9.414434987540739e-03; +1.660022000093843e-02   +1.797268372455173e-02   +3.916579730779119e-02   +3.618121898794919e-02   +2.852590260940088e-03   +2.655704456764030e-02   +3.025992123539076e-03   +9.670707684208911e-03   +2.824443094223805e-03   +3.878337353573973e-02   +2.825723482336980e-02   +1.155976644145410e-02; +4.551939903291231e-03   +8.009135962986672e-03   +3.579004142017255e-03   +2.434692338287971e-02   +1.856056188839153e-02   +1.571918773300752e-02   +3.718244210105597e-02   +7.835333440281214e-03   +1.381462885631532e-02   +8.589275971291346e-03   +3.236042748071539e-02   +1.575259625074941e-02];
L3E_L3I_iGABA_netcon = [-1.979705991287210e-03   +2.030581303580356e-02   +1.349690478041411e-02   +4.650353271438779e-02   +3.184508765800816e-02   +2.866855599752927e-02   +1.884146885232599e-02   +2.535264186612683e-02   +2.432073468743182e-02   +3.467674217905561e-02   +2.486262603468950e-02   +1.257006221407138e-02; +3.280497046340013e-02   +3.292379665420896e-02   +1.515108898023524e-02   +1.357743393700598e-03   +1.069517179037523e-02   +2.968714814630611e-02   +2.747003021319165e-02   +4.620237352534028e-02   +3.344066829959443e-02   +2.026636345913602e-02   +8.233392481644067e-03   -1.292247350815101e-03; +2.427504138195398e-02   +3.939626278436369e-02   +3.661646204007451e-02   +3.865519798446226e-02   -1.590465122473972e-03   +2.966078781790083e-02   +2.447704567490457e-02   +3.145378115953230e-02   +1.514732141443155e-02   +1.524624638321945e-02   +1.380175222872216e-02   +2.117879826466315e-03; +1.292815398411450e-02   -2.434624130748797e-03   +4.514774178320622e-03   +3.406406502580944e-02   +3.010854921530354e-02   +1.266925064498595e-02   +1.099012981907279e-02   +2.199553275452072e-02   +4.362790764389728e-02   +1.511021541430484e-02   +3.331433825365998e-03   +2.505422311819009e-02; +1.760212604414675e-02   +1.860648276161074e-02   +4.532330927330831e-02   +6.208538369660452e-03   +1.622897522660656e-02   +3.369314265996675e-02   +4.283349079252837e-02   +3.918640058121592e-02   +1.472431773482933e-02   +2.925341411260071e-02   +3.936006969740136e-02   +1.013872672400107e-03; +2.833440748525680e-02   +1.531547702972513e-02   +3.262850354849977e-02   +5.634576221747175e-03   +1.040507583907881e-02   +4.299133378083003e-02   +3.605615956853765e-03   -6.566593542321332e-03   +3.241673802177907e-02   +2.828820071448620e-02   +8.465644869574143e-03   +4.767542064920853e-03; +2.322554835987234e-02   +1.443362201058979e-02   +2.339057042627287e-02   +2.783155907853339e-02   +2.609748666729392e-02   +1.665278695761951e-02   +1.208758420063726e-02   +3.507565057904020e-03   +2.251802382725202e-02   +7.215726772969110e-03   +1.341020151391975e-02   +2.698331734342028e-02; +7.964838574996655e-03   +5.026497757507641e-03   +5.951774343826596e-03   +3.989442278385207e-02   +1.519948649752118e-02   +3.002722991318921e-02   +2.240310885781875e-02   +2.802830749687676e-02   +3.208652712821908e-02   +3.584650796614472e-02   +1.228823450755683e-02   +2.780923401988918e-02; +1.201934230122033e-02   +3.234136309428907e-03   +3.653657990928130e-02   -2.210403702056909e-03   +4.428262911538650e-02   +3.609606153268612e-02   +1.341319846509567e-02   +3.368229941531009e-02   +2.643168932504858e-03   +8.853370193613075e-03   +1.627148635946873e-02   +2.373793076580934e-02; +3.621517145580083e-02   +1.288980675369796e-02   +3.636941815032778e-02   +8.894969402018385e-03   +1.101125047160230e-02   +4.618498897275355e-02   +2.603698709901960e-02   +2.355716298287730e-02   +4.345184736988288e-02   +4.051954315753928e-02   +9.077578526722023e-03   -4.677669165261414e-03; +1.983153244884150e-02   +3.888187753355957e-03   +1.528681286759272e-02   +4.333916723781228e-03   +2.369380271749418e-02   +2.278788301036054e-02   +4.194608634432404e-02   +3.474380200970435e-02   +2.345917202620139e-02   +5.768298342481132e-03   +3.954045080635384e-03   +3.556179089997296e-02; +2.951188069965857e-02   +2.277781297526094e-02   +4.059137527857139e-02   +2.813159504680246e-02   +7.043948420419244e-03   +1.642337329171754e-02   +4.027069947303451e-02   +2.586601591429436e-03   +3.431556149022958e-02   +2.117554998456725e-02   +2.511449462299510e-02   +1.502768162983347e-02];
L2E_Input1_iAMPA_netcon = [+4.202649080207260e-02   +4.082019720307361e-02   +3.261940934240717e-02   +4.073881264241951e-02   +4.784908343665071e-02   +4.664182053184508e-02   +4.183548547504391e-02   +3.718656553188018e-02];
L2I_Input2_iAMPA_netcon = [+3.759698679173876e-02   +4.323181512497275e-02   +4.618943286764723e-02   +3.871345044829940e-02   +3.576334266132111e-02   +4.621362447150493e-02   +4.303647300477768e-02   +3.621558994921552e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
