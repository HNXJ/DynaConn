function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.968374547418612e-01   +3.621422648354135e-02   +1.843195833989049e-01   -9.373170087169376e-02   -2.035488189336944e-01   -3.532062597783852e-01   +3.133637634700393e-01   -1.547096887030228e-02   -1.785355229686784e-01   +3.707075616516609e-01   -8.139072440549652e-02   +7.682162947025770e-02   +3.757190060131625e-01   +2.433898197294428e-01   -1.301673455901603e-01   +9.506025170170657e-03; +3.577518557041642e-02   -6.325169977479145e-02   -4.446304542713048e-01   +1.981149018545065e-01   +1.051766448034029e-02   +6.532347981408854e-02   +3.628437479724300e-01   -2.088102384235981e-01   +2.413214922832950e-02   -6.489233111074057e-02   -1.584792083968932e-01   -4.007769435685198e-02   -1.613205767476358e-01   -2.105422188282892e-01   -3.437365662172537e-03   -1.161105537487404e-01; +9.558533291500332e-02   -1.729868970564891e-01   -7.252544873788998e-02   +3.025465408157249e-01   +1.606051384817165e-01   +1.431992136849530e-01   +3.312231948272821e-01   -8.300266808116979e-02   +5.479430184825959e-02   +2.854265970477616e-01   +2.596362072717477e-01   +2.155176667604330e-01   +5.763026906702888e-02   +1.927829441310105e-01   -1.684683752163156e-01   -6.659829567403799e-02; -3.453514004401010e-01   +4.667682487256178e-01   +3.552054896116806e-01   -8.812507216568934e-02   -1.315194035812875e-01   +3.678365489866611e-01   +1.427221502024524e-02   +2.238144029121696e-01   +1.158935941289917e-01   -1.013243225953394e-01   +2.089802606275663e-01   +3.339351396514881e-01   -2.259582169097510e-02   +2.305434237676514e-01   +2.040901501536885e-01   -3.794476973218774e-03; +1.944400945868134e-01   +2.719619155492241e-01   -3.063399620042948e-01   -2.243739784615914e-01   -5.698982791902965e-03   -8.105787128903222e-02   +3.898782953082432e-02   +3.214964985516199e-01   -7.472492289592687e-02   +6.137702318677717e-02   +1.589370506514841e-01   -1.470038777046509e-01   +4.956561988654978e-02   -2.159904517976219e-02   -7.202784133902397e-02   +3.333487996067750e-01; +2.180340426819175e-01   -6.268654071063162e-02   -2.096299106959927e-01   -1.390453439175289e-01   +8.278883843074619e-02   +9.207156053574500e-02   +7.499288152139497e-02   +2.626335913625431e-01   +4.609105699925465e-01   +3.462837793995821e-01   -3.304818441923928e-01   -1.590167187053780e-01   +1.576613718342796e-01   -1.335217164560928e-01   -1.606252413379390e-01   -1.094752311274750e-01; +4.380027499662995e-01   +3.660744827416801e-02   +5.215206623678419e-02   +2.615913422771045e-01   -1.193908824595471e-01   +1.909420965401660e-01   -7.190857220327126e-02   -1.625050975446822e-01   -1.623714694660723e-01   -2.145990551424108e-01   +1.444968327894662e-01   -1.979055619243109e-03   -1.771717576413770e-01   -3.320102949529960e-02   +9.158101790305517e-02   +2.676570084652489e-01; -3.609980024896228e-01   +4.078925743250549e-01   +1.028108101802301e-01   -1.275653962234707e-02   -2.305232920934283e-02   +6.007824336469833e-02   -2.402594525502818e-01   -3.979280757950117e-01   +2.102153026318252e-01   +2.666414834790193e-01   +8.462875897218147e-02   +1.035633017493736e-01   +1.862238579757504e-01   -4.582919371215385e-01   +2.959214520454703e-01   +1.265598032729771e-01; -2.709067015000869e-01   -4.756304981252618e-02   -1.170094551090058e-02   +2.217275235656418e-01   -7.169366684788743e-02   -2.231917456273610e-01   +2.346935741373175e-01   -6.054242525196105e-02   +4.484768586163340e-03   -4.962053330941719e-01   +2.151118829349156e-01   -1.547990739581008e-01   -2.416786757750520e-01   -3.945641917428758e-01   +5.734484477374710e-02   +2.064601222119963e-01; -2.350400963397956e-01   +2.231857986467782e-01   -1.085557980382819e-01   +1.270503291706385e-01   +2.668298019691913e-01   -5.132980852673709e-01   +4.362735035871567e-01   -2.135036549542344e-01   -5.907966872398104e-02   +2.439071318909958e-01   +1.914117893407081e-01   -1.519719395363273e-03   -3.100514805606516e-01   +1.082242931483089e-01   +8.198606641122345e-02   -1.710205964566978e-02; -3.739392967610002e-01   -1.187755354255499e-01   +2.117596187364440e-01   +1.748181062871157e-01   -3.214189700671697e-01   -1.946565508756555e-01   +5.102838306489121e-02   +9.048450555028631e-02   -1.559396190149940e-01   -1.936548360543700e-01   +5.281267478035498e-02   -1.980141429098065e-01   +3.803162985542675e-01   +1.159851545308207e-01   +3.781975909391916e-02   +6.862812514198310e-02; -8.160818521060981e-02   -2.114286656334086e-01   +9.789952481259639e-02   -3.723170536970083e-01   -6.770391929188593e-02   -7.507693461146372e-02   +1.060169052749405e-01   -8.365420896156500e-02   +3.695572360536333e-01   -2.537279066621511e-01   -2.350724516262930e-01   -2.704917242366381e-01   -7.328968238824587e-02   -2.208125781301611e-02   +1.056342144839132e-01   -1.355924335965211e-01; +7.917088021457747e-02   +1.557202257267402e-01   +3.123535548948118e-01   +2.143871099523497e-01   +6.341417940141611e-02   +1.206246557791920e-01   +9.895152963085060e-02   -1.173008253558145e-01   -1.198347464268723e-01   +3.902368534882737e-02   +3.141290110740630e-02   +2.169344262873374e-02   +9.801488370618124e-03   +8.889336233972755e-04   -9.945688882829735e-02   +1.666732284014300e-01; -5.857957237245519e-02   +2.331597502705811e-01   +1.106960094270115e-01   +1.179008041922995e-01   +1.552482061283451e-01   -3.768105686316270e-01   +1.067165803700845e-01   +4.224424563855577e-02   -3.985131135105335e-01   -4.477872896018449e-02   -9.195637329018912e-03   -3.171175335396619e-01   -1.073043695659937e-01   -3.972483246355324e-03   -4.342025201554881e-02   +2.459075909755229e-01; +7.017560726988070e-02   +1.364909561883012e-02   +7.013059383657742e-02   +2.407128980549241e-01   +1.610642798869121e-01   -2.094815249613732e-02   +1.398135544997009e-01   +2.130788454985526e-02   +1.536588917078955e-01   -1.403061364725253e-01   -1.848090268551241e-01   -2.886003396367779e-01   +1.166827268830000e-01   -9.270170244580131e-02   -3.536159708618668e-01   -2.001795147201922e-01; -4.103798219839963e-01   +1.523539753523383e-02   +1.180430337309197e-01   -8.745013871795712e-02   -4.068027275603468e-02   -9.489274871111458e-02   +2.349905367018062e-01   -5.964638439448752e-01   +3.186361362850921e-01   -3.869503648435888e-01   -5.003826026985774e-01   +7.696488947030067e-03   -2.182927790190955e-01   +2.158905628276414e-02   -1.396994645977415e-01   -3.325327257532174e-01];
L1E_L1I_iGABA_netcon = [+2.385550123212112e-01   +1.368151937453864e-01   +1.012652830365537e-02   -3.693719797096071e-01   -3.024048919200402e-02   -3.544953292575879e-01   +4.140734321363790e-01   +3.386706299668922e-01   +3.495998665083970e-01   +8.310063021537520e-02   -4.369625885712324e-02   +3.909088269199860e-01   -1.230522831285358e-01   -8.293519902914244e-02   -5.043606663881761e-04   -4.877226411546017e-01; -3.489381356849678e-01   +1.096766427950144e-01   -8.223291421796562e-02   -7.584548971442892e-02   +2.874547034368368e-01   +3.202577154505025e-01   +6.055103739123432e-02   +5.379620434050288e-02   +2.891832257148469e-01   +6.890375858747938e-02   +9.668262370759614e-02   -2.834373650603360e-01   +6.474623775560680e-02   -2.946021768382929e-01   -4.499763532197824e-01   +1.428422888518869e-01; +2.517379708852974e-01   -3.427234835046026e-01   +3.608822421218495e-02   +1.570098160693317e-01   +2.496535557580745e-01   -4.343638507185326e-01   -2.734111147060374e-01   +1.175106135668891e-01   -2.363563635589386e-03   +2.554539047423173e-01   -3.488073000048166e-01   +1.876191845510873e-01   -1.750365275887234e-01   +7.137329060368722e-02   -2.511373283291040e-01   +2.145010126380498e-01; -7.701273004576861e-03   -1.982081995349276e-01   -4.082145833914909e-01   -4.817951278080995e-02   +3.553551254773618e-01   -1.497559538851278e-01   +6.228657151008044e-02   +1.217772119811223e-01   -1.564236995355633e-02   -3.535445063917038e-01   +2.022148750991786e-01   -6.445279182442541e-02   +2.770482912234898e-01   -4.848885757804204e-02   -3.059033466132657e-02   +3.722784990138648e-01; -6.757642868213690e-03   -8.863160557049446e-02   -4.549520410838917e-02   +1.158561147067420e-01   +1.957261021959356e-01   +1.359302916017107e-01   -8.576313816273949e-02   +8.803652804190161e-02   +3.261086802844605e-02   -1.254321110346740e-02   +2.516311980228399e-02   +2.920568621599633e-01   +1.139164861088419e-01   -5.763019869394406e-01   -2.278227803799726e-01   -1.780488865852500e-02; -2.618750317782675e-01   +8.443213077562718e-02   +5.907480686357554e-02   -1.455259837955916e-01   -1.104473420863697e-01   -1.210794414728665e-01   -1.111261423184447e-01   -1.857626186386269e-01   -1.180296878852302e-01   -2.600392416604739e-01   +3.796436502732566e-01   +1.919870529943493e-01   -8.511719493126015e-02   +1.156446806798609e-01   +3.978809201083102e-01   -4.091018505982386e-02; +2.343261327194394e-01   -2.404071498216963e-01   -4.698558334589841e-01   +3.375655388840171e-01   +3.653268707456044e-02   -1.667466313535759e-03   +3.035727151981991e-02   +2.136440333385304e-01   -2.215666875982902e-01   -5.313760451712506e-02   +3.606372579300811e-01   +1.726000863835361e-02   +4.544499892223715e-01   +3.257499188551832e-02   -3.138687192865045e-01   +5.471247790646663e-02; -8.531685773264472e-02   +1.543898098933894e-01   +1.247691156434397e-01   +2.347956827735866e-01   -3.335521553426521e-02   +1.839468187253518e-01   +1.402253481365386e-01   +1.844488713147063e-01   -4.327928620865764e-01   +3.173153249571420e-01   +1.408989673892497e-01   +4.490681791668982e-01   -9.809617182614805e-03   -3.476317770512286e-02   -1.621373175745677e-01   +2.087834481917041e-01; -4.500359087863937e-02   +1.107743454009355e-01   +8.037441802586018e-02   -5.329299959046693e-02   +7.470512867384596e-02   +2.717974763085598e-01   -1.890311633205562e-01   -1.885646553242375e-01   -7.374223463379262e-02   -1.616091550663476e-01   -1.770323415434031e-01   -2.371632443401418e-01   -6.859642647896019e-02   +1.051563437757490e-01   +4.821677668806716e-02   +1.506012292206124e-02; -1.831124663233807e-01   +1.518298655452815e-01   +2.177997705655398e-01   -9.837905000015752e-02   +6.587273889671061e-02   +3.089435083294707e-01   -2.283379433157382e-01   +1.072866828673867e-01   -4.347272960127928e-01   +2.205884885371382e-01   -4.834015612861221e-01   +3.681066024828582e-01   -4.651344979271756e-01   -3.469052251492053e-01   +7.170382756448684e-02   -4.214704645682955e-01; +1.396583369999818e-01   +3.034512812876534e-02   -1.207594054331507e-02   -1.505252071349342e-01   +3.716112476747728e-01   -1.015582545278548e-01   +1.049376969596461e-02   -1.945636921352605e-01   +5.812596841479208e-02   +4.300652501569674e-02   -1.715449637508560e-01   +1.293410875721379e-01   -6.535982062840368e-03   -6.810754705121214e-03   +1.949762156874935e-01   -3.049967423776771e-02; +1.027013594800395e-01   +2.716081337860399e-01   +5.471460868333318e-02   -2.478478495230547e-01   +3.655688693172608e-02   +9.369266296145481e-02   -2.086591750334988e-01   +4.313084303038395e-02   -1.765956473349294e-01   +1.431272016073600e-01   +1.165366160158561e-01   +4.296257192123205e-01   +1.899055995536152e-02   -1.944292376616914e-02   -2.684754959846232e-01   +2.705060280403565e-02; -2.294576948361347e-02   +1.987230656729868e-01   +1.435248787559560e-02   -1.796838664732504e-01   -9.640400972590581e-02   +2.218646316320196e-01   -2.464234751682988e-01   -1.461909356344001e-01   -5.412344813909912e-01   +1.047228831622765e-02   +2.509321239457082e-01   +3.477009180735994e-01   -9.929401784225966e-03   +2.269825240987737e-01   +1.763136664318298e-01   +2.630444420754003e-01; +1.432207726514832e-01   -1.278486045811342e-01   -4.538765724607454e-02   +2.647317776816808e-01   -1.219055631922278e-01   -1.615963809056915e-01   -2.753189396368272e-01   +4.123529808333491e-01   -1.689372820124095e-01   +1.653726224100807e-01   +6.454242708231477e-02   -2.587999141960110e-01   -1.289500507457255e-01   +1.205526765624436e-01   -4.285771484670579e-02   -1.986285716942009e-01; -8.031189116070886e-02   +1.415106596298229e-01   +4.175938432356772e-01   -1.760622012524899e-01   +3.313132690429930e-02   +2.553840450960060e-01   +6.285167964546559e-02   -1.387969084185144e-01   -4.103633850492135e-01   -1.470954104632714e-01   +7.877717177709957e-02   -2.744139506923094e-01   -2.272553618661216e-01   -2.847179572510257e-01   +1.537954887222786e-01   -1.036611035919661e-01; +1.382485919488946e-01   -1.990503165716167e-01   -4.482003771174160e-01   +6.107808298046162e-02   -1.452364206171837e-01   -2.472171486267098e-01   +5.068265763022720e-02   -2.343524774005131e-01   -2.244182161868170e-01   -5.083014459677516e-02   -2.711804678066400e-01   +2.619843699955650e-01   -6.738925877567171e-02   -2.066237046695010e-02   +2.795865930062783e-01   -3.570696318068635e-02];
L2I_L1I_iGABA_netcon = [+6.350677068540016e-01   +2.268017699469028e-02   +2.338795171431851e-01   -2.095240411633523e-01   +3.446939576169533e-01   -1.918636164596690e-01   -1.088214108799805e-01   +1.315758769477705e-01; -2.788636291395827e-01   +1.665673194449767e-01   -2.144658600024041e-01   +1.497911814338090e-01   -1.078174273962437e-01   +5.509260241942238e-02   +1.775698431163700e-01   +1.907190078781379e-02; -1.793158446664135e-01   +3.325677881423791e-01   -1.310590914197872e-01   -1.008578470797260e-01   -2.359475212660103e-01   -1.583352471524393e-01   -3.948912750724916e-02   -1.979453136915401e-01; -3.870715007693244e-01   -1.091544782753892e-01   +9.737673994897691e-02   -2.559661868656447e-03   +3.339796590385660e-02   +1.175524679360992e-01   +2.326583348485807e-01   -1.326536669420225e-01; -1.667091884661565e-01   -1.392203545983781e-03   +3.855033381533235e-01   +1.095959983743325e-01   -3.119357018036933e-01   -3.950610793397133e-03   -6.149883997379772e-02   +4.777211290391083e-01; +2.195488790215434e-01   -1.783717243951916e-01   +3.404240280863816e-01   +6.663441062242841e-02   -2.422062453168414e-02   -2.356736013590357e-01   +1.200835227554898e-01   -1.197618102973273e-01; +2.265258104968784e-01   +1.359961437629344e-02   +1.221375156502608e-01   -4.101488002877116e-01   +2.054369219111847e-01   +3.895383338246698e-02   -6.311705612529589e-02   -1.519170379662100e-01; -4.688920967975168e-01   +1.654197577038738e-01   -9.283570844038774e-04   +2.856790884904150e-01   -2.741389073255741e-01   -5.070243662190625e-02   -7.827037316024138e-02   -3.503618612432795e-02; +6.810917999832958e-02   -3.175498573630167e-01   -1.605163579740260e-01   +7.640336634602397e-02   +9.556997403748352e-03   +2.933737029997469e-03   -1.926751655362999e-01   +1.406016127296678e-03; +2.559454836249609e-01   +1.886700301161591e-01   -2.812313164536275e-01   +4.345199686231574e-02   +1.360506904606858e-02   -3.168714619785030e-01   +3.454296472014234e-02   +6.569125593922504e-02; +3.087807388821027e-01   -3.784932824007723e-01   +9.272406181227746e-02   +4.480916712426019e-01   +1.095433120549187e-01   -4.116068223272887e-01   +1.158546663641953e-01   -3.817608532076299e-01; +2.117814125511495e-01   -9.436997500883260e-02   -1.070035173039658e-01   -1.575963412379674e-01   -1.968921718923266e-01   -2.852317425165049e-01   +1.130911840182077e-01   -3.612805223644263e-01; -1.341834128139262e-01   +7.459462104777523e-02   +4.130524523201163e-01   -1.984511571428964e-01   +1.780968375679192e-01   -8.395548158028301e-03   -4.009861142509057e-02   +5.626974643366367e-03; +9.236022102490357e-02   +2.028025756885690e-01   +1.569136008643859e-01   -2.504542648404858e-01   -1.138851387301146e-01   -1.622667887914896e-01   +2.800915989503443e-01   +6.454618658717018e-02; -7.269509998097338e-03   -2.108390372501711e-01   -1.005307431385208e-01   +2.591548734681773e-01   -3.198163790836744e-02   +9.490652844494796e-02   -3.914394431552050e-01   -4.558559331295407e-02; +6.270804580473738e-02   +1.626167234653124e-01   +7.506006138347746e-02   -6.655071706808088e-02   +4.497372492574748e-01   +8.389384508594792e-02   +2.598968673684416e-01   -2.204733137605138e-01];
L1I_L2I_iGABA_netcon = [-3.117438470117196e-01   -1.515756117279073e-01   -2.617666350770002e-01   +3.216130038947205e-01   -6.947124713600399e-02   -2.284743183507597e-01   -9.127884956212400e-02   -3.893357551118896e-01   -2.503244093708083e-01   -2.104057510057944e-01   +4.182408297329743e-01   -6.954254379496219e-02   +2.408837486947382e-01   -3.809512987211133e-02   +3.952010837090188e-02   +1.112181907417908e-01; +3.379160573471947e-02   -1.332598773037222e-01   -2.888224651631892e-02   -1.459069687183048e-01   +3.694565902454353e-02   +1.685018196058857e-02   -4.710090007201184e-03   -1.939279229455426e-02   +3.969026163760195e-02   +3.854557680158888e-02   +2.667892066294926e-01   -9.502019330831643e-02   -2.486245868705103e-02   +2.442973619180383e-02   +2.003586978778522e-01   -1.609082506059432e-01; -1.850848327520563e-01   +4.504680232704442e-02   +1.901831714942543e-01   +1.498186494410348e-01   +8.738079693981771e-05   +4.096146574146139e-01   -2.693976862873444e-01   -2.154718535616444e-02   +7.837263124810334e-02   -5.180872781172019e-01   -2.105289205736955e-03   -1.052445941464595e-01   +6.574674191047575e-02   +1.643516509014255e-01   -5.398711497699769e-02   -3.287513476344921e-02; +2.085600715194515e-03   +1.027005637167910e-01   +4.286232867138559e-02   -3.397058150037522e-01   +1.954426740735779e-01   -1.913297575137740e-02   -3.349475144793231e-01   +1.649765995218513e-01   +6.760758540282319e-02   +2.759410441949891e-01   -2.284950186724784e-01   +3.237990947683221e-01   -4.477902350347771e-01   -4.724711820575556e-01   +9.440556144167594e-02   +2.018002425626191e-01; +2.095481169925991e-01   -1.198172799273227e-01   +2.006376074036540e-01   -4.139363183027005e-02   -2.017535313253735e-01   +1.249912248139220e-01   +1.978960904207542e-01   +1.305859838184506e-01   +1.944903319837105e-02   +1.105145807504254e-02   -2.085038508751969e-01   +5.379059176453815e-02   +2.877509997841272e-01   -3.226530173493458e-01   -1.005402886225553e-01   +2.328620913496250e-02; -3.640503537197644e-01   +1.449974816982317e-02   -8.854886015531069e-02   +7.468837518510962e-02   -2.834541871556558e-01   +2.485184556722383e-01   +8.976100688728660e-02   +3.158269860654533e-01   +1.695233213686468e-01   -2.235003600572453e-01   -2.620810906003430e-01   -4.686454251248158e-01   +1.292588641598394e-01   -5.176225113006592e-02   +2.297026711015887e-01   +1.568573778448967e-01; +9.905500352199764e-02   +3.470244953384353e-01   -4.157518573941708e-01   -5.566494616076860e-01   -2.141089878628343e-01   -7.871348057992195e-03   +7.882318323215573e-02   -3.037052586702988e-01   +1.142216878514928e-01   +1.000403766287897e-01   -4.526181296077441e-01   -7.844930808979017e-02   -6.432043686583162e-02   +1.359818493765300e-01   +5.385997761879992e-02   -3.113569137310090e-02; -5.560856951366208e-02   -1.640315741704491e-01   -1.523694352720523e-01   -4.238911095100443e-01   -3.702006173815563e-01   -1.360308279989799e-01   -7.518801696380181e-03   +8.866858868709097e-02   -7.332144626554997e-02   +1.052212561386062e-01   -1.009807543230950e-01   +1.002255259153755e-01   -5.851317869331707e-02   +1.283552221961275e-01   +1.693501025375319e-01   -3.027344787032290e-02];
L2E_L1E_iAMPA_netcon = [-3.840638413911641e-01   -2.722169809315397e-01   +9.125535731583251e-02   +2.217485697969492e-01   +2.594853036334724e-01   +2.442580917349578e-01   +7.442070177150803e-03   +1.381383426301198e-01; -1.670291007120452e-01   +3.617370261715349e-02   +3.358274474945959e-01   -1.912622142206814e-01   +1.239357197078310e-02   +2.309082820298859e-01   -1.267954293683572e-01   +1.043789119838009e-01; -4.532846569969803e-02   -5.221926846718294e-02   -1.514043918037940e-01   -2.014683799545858e-01   +2.077257261348557e-01   +3.624870513621234e-02   -1.020825648456885e-01   -7.643070683282364e-02; -4.815066357332576e-01   -2.211656226369995e-01   -1.505336702119944e-01   -2.053893021070675e-01   +4.616614000118095e-02   -2.994387458128834e-01   +1.100942882823845e-02   +1.401547710412464e-01; +7.943224595877482e-02   -1.134895437048354e-01   -2.456499771998149e-01   -2.264274246000932e-01   -4.292924532367220e-01   -1.272492131847779e-01   +1.237891211646878e-01   +6.647755507493230e-02; +1.227359734099000e-01   -2.754799789548131e-01   -1.723255075497139e-01   -1.965308286655294e-01   +9.797606220615745e-02   -6.816328075210247e-02   -1.340859978296091e-01   +2.448271813105613e-01; +1.439410315843982e-01   -2.426100853173578e-01   -2.019405788803426e-01   +1.844761414138009e-01   +1.987842277197139e-01   -1.859405430492369e-01   +3.913295790688393e-02   +2.265876682388400e-01; -8.589885968402054e-02   +1.383428364187229e-01   -2.781598721023935e-01   -5.762647091175455e-02   -9.831968911331458e-02   -2.050197257236149e-01   -1.847234678512975e-01   +1.908084230140400e-01; +4.487929982801924e-02   +1.193954567838965e-01   +1.173471089141297e-01   -1.558529518585626e-01   -2.470376813406260e-01   +3.771091966425569e-02   +4.261348006586879e-02   +6.094886899632965e-02; -5.468872455058821e-02   -3.549889102550205e-03   +9.664429253630638e-02   +4.665397134515870e-02   +2.594186880180331e-01   +1.802223921567933e-01   +2.573835808132219e-01   -4.100904949053648e-01; -9.808888658793891e-02   +3.100517098195406e-01   -3.998489555366048e-02   -2.408775275370596e-01   +2.579086579901973e-01   -1.288479762704866e-01   -1.177458716276867e-01   -3.715260653003860e-01; -8.296913162527998e-02   -2.316596940520909e-01   -3.315823512409837e-01   -5.321359594212034e-01   -1.043860033298831e-01   +2.202198908370390e-01   +8.244211064278094e-02   -1.857363125850074e-01; -6.206800681965322e-02   -1.306486494092960e-01   -2.528924519957584e-01   +1.490757431306716e-01   +1.654944101898225e-01   -9.029713336607308e-02   +5.370080098017420e-02   +4.793921248335571e-02; +6.987786303860045e-02   +1.675193647932405e-01   +2.795261949712460e-01   -2.504263115532870e-01   +1.350096548270950e-01   +6.728833341262806e-02   -9.692347885782121e-02   -1.366335047380048e-01; -1.336937692659104e-02   -1.448578801248798e-01   +1.913803572558718e-01   -4.891086834914150e-02   -1.740358088097232e-01   -2.301574754952343e-01   -1.963344968575148e-01   +2.891811256137422e-01; +1.033193217280340e-01   +2.779672373925923e-01   +3.088754474456672e-02   +2.125194021786025e-01   +7.354058414973028e-02   +2.758249795225937e-01   +4.203046017543934e-01   +2.025376181377379e-01];
L1E_L2E_iAMPA_netcon = [+4.674033290154192e-02   +2.538289302251293e-02   -3.676139561094200e-01   +1.950182734479332e-01   -4.669568731974073e-01   -4.036976904161264e-01   +1.234167919960930e-01   +6.999004501706402e-02   +1.527101221622431e-01   +8.147487826048981e-02   -3.854100997524984e-02   +3.271278015075013e-02   +2.215637711590819e-01   +1.363338492915306e-01   -1.657926883322555e-01   -1.850399984895884e-01; -2.317119581078098e-02   +2.358685994060545e-01   -6.059247428474929e-02   +5.073973688036149e-02   +1.075778189295594e-01   -1.083937429746794e-01   +1.272439550628517e-01   +3.916497345576635e-02   +1.601083980634461e-01   +2.401784399263831e-01   -1.622579558824353e-01   +2.115022645085160e-01   -1.402308242660961e-01   +2.474320827267842e-02   +3.994685283235257e-01   -3.426568726986701e-01; -2.584012309080629e-01   +3.878518659206786e-01   +1.228537433224300e-01   +1.309134050849897e-01   -4.964588701931442e-01   +2.799373746218441e-02   -1.332688723605978e-02   -1.022836145133340e-01   +8.890285112779463e-02   +2.642933777558965e-01   +1.092634858466364e-02   +3.291426072838334e-01   -2.725706271967751e-01   -2.117964093452578e-01   +2.150401139893471e-01   -1.977043862816562e-01; +1.128911952537649e-01   +1.275132124113442e-01   +2.605945956178110e-01   -2.141081507335466e-01   -2.499118468707341e-01   +6.468540721440208e-02   +6.792499875027914e-02   -1.081024018414718e-01   +1.352932211742280e-01   +8.585254160223801e-02   -2.536437236266406e-01   +3.913357020395740e-01   -2.918965469224533e-01   -2.399570925804427e-01   -1.681862366297855e-02   -3.884786173325315e-01; +9.421038633477358e-02   +1.399060982726842e-01   +3.771832841322898e-01   +1.280757268047046e-01   -1.803876508451783e-01   -2.215519373507039e-01   -1.651807281031462e-01   +9.130463813787096e-02   -1.016622585095078e-01   +3.554602783154937e-01   -1.399138015638337e-01   -2.392703038962712e-01   +1.566654617457918e-01   +3.405604900952559e-01   +1.702669243711699e-01   -8.369421050739362e-02; -4.710679059198499e-01   +1.738921649531936e-01   +1.181339145564711e-01   +8.871389829892243e-02   +2.692437858701043e-01   -8.533402007357371e-02   -1.538033461616672e-02   -6.717446096838316e-02   +1.366591412784161e-01   +4.125369640484110e-01   -2.698585688358800e-01   -2.173898738516061e-01   -2.403621298400710e-02   +4.739305653204121e-01   +5.288645194082127e-02   +6.603306370430764e-02; +3.494171876437439e-01   +2.753773419231239e-02   -3.515881917410404e-01   -3.760972565495477e-02   -2.469494282062452e-01   +1.241540565148332e-01   +6.808449182026455e-02   +1.119114373143071e-01   -7.124589626003708e-02   +5.009277077879475e-01   -4.130181781374802e-01   +1.828821245034914e-02   +2.025674071434380e-01   -2.563955532526151e-01   +1.940652071603741e-01   +2.130385773745466e-01; -1.012504663362280e-01   -3.449904203292395e-01   +3.121525983945980e-02   +1.197830957445517e-01   -2.416448636043294e-01   -9.413286037814268e-02   +1.057550058386173e-01   +1.547933592882711e-01   -7.970682885580715e-02   +8.461434285799120e-02   -5.016638362097550e-02   -9.356562206814606e-02   -1.160860290628450e-01   -5.808713723858810e-01   +5.906568784703807e-02   -3.138372727063440e-01];
L2I_L2E_iAMPA_netcon = [+1.684618904337773e-02   -1.492821663473170e-01   +1.615429496611646e-02   +2.030015453092481e-01   +8.959020608182613e-02   -1.916502126946213e-02   +8.140589093283011e-02   +8.623759404777387e-03; +1.718415527337040e-01   +4.878465316904440e-02   -1.958232017279066e-01   +2.045786280267490e-01   +1.317002731045164e-01   -3.123508093430622e-01   -4.894795113021291e-02   -1.226596834851795e-03; +1.384618919357873e-01   +1.047208834354917e-02   -4.843864414767206e-01   -1.709558322206321e-01   -1.906664078551221e-01   +6.177274930878650e-02   +4.222586641874790e-03   -1.296456245901211e-01; +5.252825553096702e-02   +8.877130256763269e-02   -2.570321051424957e-01   -7.144796464821986e-02   -2.002991672986908e-02   -1.387605940420114e-01   +4.576318109418958e-02   +2.290945933214129e-01; -7.333972037990856e-02   -1.229393927651621e-01   -2.894486910314753e-01   +7.089086970119757e-03   +3.831261869304041e-01   -1.371022684663409e-01   +2.956393063018627e-01   -1.123392786308273e-01; +1.875992418590295e-01   +1.449386687317808e-02   -3.160584707789879e-01   +2.897833370119733e-01   -1.842510091494835e-01   +1.635844645388362e-01   +2.313202048749692e-01   +1.520707243199801e-01; +2.029194783830363e-01   +1.130667549079085e-01   +4.397772282024087e-02   +2.037714239370506e-01   -1.365449231689617e-01   -1.114668040088579e-01   +1.442092599328766e-01   +1.313713740842770e-01; +1.314131621683700e-01   -7.374850328718152e-02   -1.580645136660977e-01   +1.022832452059090e-01   +3.696502477806939e-02   +1.578729475123917e-01   +3.197201201327293e-01   -2.880802636344394e-01];
L2E_L2I_iGABA_netcon = [+1.497517209241378e-01   +5.002762294369992e-02   +6.485539341616071e-02   +7.409765707970804e-02   -9.684533295328433e-02   -1.982486232544612e-01   +1.500421177881626e-01   +6.579190918234162e-02; -6.218252190749226e-02   -3.696994886199498e-01   -1.338612131605417e-01   -1.691627225967707e-01   +3.808435903480155e-01   -2.134003691903907e-01   +1.778009228487575e-01   -6.617552572869276e-02; -1.624681857978834e-01   +9.935157206937016e-02   +1.514603451232367e-01   -5.692752539509222e-02   +1.995232790704819e-01   +4.377896059934064e-01   -4.157571736000697e-02   -2.613732124040262e-01; -1.091474725156818e-01   +2.754307935955267e-01   -3.202862017954816e-01   +1.593501241728696e-01   -1.403180053985597e-01   +1.273752475703596e-01   +1.412448044246580e-01   -3.404423852494688e-02; +3.282732406731604e-01   -1.739745122325930e-01   +9.321603328933638e-02   -5.825751634212117e-02   +2.806687018772908e-01   +1.688011590099673e-01   -9.502215575977080e-02   +1.116385253655867e-01; +7.613797221782562e-02   +7.389360535051417e-03   -1.977294558550826e-01   -3.508442247611253e-02   +2.258405616800740e-02   +1.884618563952497e-01   -2.505141369116821e-02   +1.861542171091228e-02; +9.830737440000722e-02   +1.041398342219398e-01   +2.315641226973354e-01   +1.900635479305948e-01   -1.579010956330980e-01   +4.548730263391577e-02   +2.308414026162957e-02   -5.341955030929289e-02; -1.295765528211912e-01   -4.918842423063965e-02   -2.107755104479319e-01   +1.209288970240496e-01   +7.360995692436405e-03   +4.865767530107623e-01   +4.205470865830974e-02   -5.252058139795385e-02];
L3E_L2E_iAMPA_netcon = [+8.268020389417924e-02   -4.630846727627250e-01   -5.173016924910620e-02   +5.370305958332688e-02   +2.891561131855103e-01   -2.312771384130579e-01   -5.953008357606279e-02   -3.002899923292616e-01   -3.875360781587572e-01   -1.999933882410394e-01   -2.792015812275190e-01   +1.582998497967345e-01; +3.656263104902923e-01   +1.377912814826330e-01   -7.269965483924404e-02   -3.027546374582650e-01   -3.348283554335191e-02   -7.753093925054527e-02   -1.113870981249804e-01   -7.824056862735240e-03   -3.416538400170623e-01   +4.855257972616353e-02   -2.159570591941614e-01   +4.308467140622425e-01; -1.109304191890406e-02   +2.755890810401211e-01   +2.461669687941497e-01   -1.574717487396529e-01   +1.699284311846183e-02   +1.530448657505667e-01   -2.889002344350178e-02   -1.890044773213659e-01   +1.118835569553089e-01   -8.316197950293333e-02   -2.913969376200702e-01   -2.418618283092763e-01; -4.913196823898609e-01   +1.870451071114119e-01   +5.369478601224935e-02   +1.012237668696632e-01   +8.768117212876902e-02   -1.542498153836512e-01   +4.374443961339735e-01   -2.293431512379111e-01   -5.749543379437456e-02   -2.339925651212637e-01   +7.980773862993557e-02   +1.829980795705985e-01; +1.569907981144211e-01   -1.344609815196601e-01   -1.353562992585831e-01   +1.187475071840282e-01   +2.137361091742670e-01   +1.330215982087963e-01   -3.800559968342845e-01   +2.503077222562961e-01   -1.463549552257826e-01   +2.471794860765242e-01   -1.890559091742940e-01   +7.755447769864782e-02; -6.953047043706732e-02   -1.208031898902370e-02   +1.303882021202153e-01   +3.277490961734258e-02   +2.480299433142217e-01   +2.241560394953109e-01   +1.281143205314496e-01   -9.779667823771637e-02   -2.403996061423031e-01   +1.339425060792634e-02   +2.795399816449013e-01   -2.231837742751457e-01; -3.256940156390499e-02   -2.259733865473429e-03   -7.164241205557662e-02   -3.750837056789335e-01   +2.551186847095067e-01   +7.991857856031281e-02   +1.946083266983215e-03   +1.924933902280306e-01   +2.313317298255079e-01   -1.320910607488370e-01   +2.501969258414546e-01   +2.483807693034845e-02; -5.465003901249885e-01   +1.785387795930220e-01   +1.587299263566854e-01   +5.292429918714392e-02   -1.396850190956835e-01   +6.423485220336117e-03   -1.959651922360937e-01   +6.826392338163613e-02   -1.243858229535037e-01   +1.369409461314427e-01   -2.880480174636271e-02   -3.072325257712379e-02];
L3I_L2I_iGABA_netcon = [-4.390784732937931e-02   +2.129494558319766e-01   -1.343496260806094e-01   +1.327644548358642e-01   +3.720209876851934e-01   -1.097503929097489e-01   -1.105443901493737e-02   +3.042730229466653e-01   -1.480543643362024e-03   -1.618644038143225e-01   +3.019763345031563e-01   +1.796462551382548e-01; +4.710567449388651e-01   -1.203010116364718e-02   +8.293123008222542e-02   +8.767001513959541e-02   -4.571745152173737e-01   +1.605737713226505e-01   +9.018855458379593e-02   +1.467393655599275e-01   -5.460383164396407e-01   +1.177513179413517e-01   +1.830714295250999e-01   +8.141663012694575e-03; -1.029897791492624e-01   +3.246232946484034e-02   -1.545266472262211e-01   -3.496827555368900e-01   +2.118238248203355e-03   -4.694489237012045e-03   +2.083633711340243e-01   +8.884887888696785e-02   +2.209924180673150e-01   +1.041968418113892e-01   +2.204500557569335e-01   -4.206006044189231e-01; -1.894928877158993e-02   -8.909733375455089e-02   +5.730743783666262e-02   +1.268738509315490e-01   +1.557790091524573e-02   +5.459362757723697e-02   -8.030845644172253e-02   +2.352403338888801e-01   -7.444995328071004e-03   -9.017921812230394e-02   +4.437887457343642e-02   +1.980038900491549e-01; -8.120376682923425e-02   -2.203815127252743e-01   +8.280922824224012e-02   +1.428448541929764e-01   -5.551532212214944e-02   +8.034521799761708e-02   -9.122903927874243e-02   +6.022123260433802e-02   +1.193357368930261e-01   +1.365372419502773e-01   +2.512821689088365e-02   +3.443783173731961e-01; +3.122086256274472e-01   -1.792215214995277e-02   -1.980953016779925e-01   -1.407272567625140e-01   -7.804528794401737e-02   -1.952144973730679e-01   -4.317890014008882e-03   -2.853401789762301e-01   +3.092943119673350e-02   -1.763505908882902e-01   +1.401233994932761e-02   +2.504644790098460e-02; +2.795979878163871e-01   -6.615222770989948e-02   +3.302594631553109e-01   -3.641012554073090e-01   -2.327884877735805e-01   -2.235232288333429e-01   +2.163707630872042e-01   +3.543912956996315e-01   +2.248122985378768e-01   +2.575016257091409e-01   +2.850815443575391e-03   -1.760842908962625e-01; +3.559144561126233e-01   -2.352180104292418e-01   +2.361115073746912e-01   -1.220881287190625e-02   +1.992954084737074e-01   -1.243982650796302e-01   +2.136563419874295e-01   -2.485722718088122e-01   -3.767436764586488e-01   +3.395841236076462e-01   +7.818666957332809e-02   -1.090678865671166e-01];
L2E_L3E_iAMPA_netcon = [-1.655835522314557e-01   -2.058442233129898e-01   -1.848567955427716e-02   -1.452374349663297e-01   -9.200765529773391e-02   -9.906712828765657e-02   -2.719363274801090e-01   +2.192901368416034e-01; +9.792957938380653e-02   +1.225989469142179e-01   -5.356312213832731e-03   -9.842493283484417e-02   -2.553019971860781e-01   +2.085892118659805e-01   +1.341674735589808e-01   -1.606304045205483e-01; +2.937827859434885e-01   +2.950600842316969e-01   +2.639628425621508e-02   +3.858654933972686e-01   +3.650175121175067e-02   +1.157978220314043e-01   +3.960316848446022e-02   +5.998519020061628e-02; +8.205442265895199e-02   -3.169078786029052e-01   -1.473986013178831e-01   +1.694708014685405e-01   -4.284722211549367e-01   -3.089910067567136e-02   -2.837584324741651e-01   +3.231367474788591e-02; +1.639103869657990e-01   +2.059842438497411e-01   +2.102257930733752e-01   +3.795891063564695e-01   +5.890726863493449e-02   -3.369147539456388e-02   -5.420890462172605e-03   -1.271489831110193e-01; +1.147848911768422e-01   -1.393708652123746e-01   -3.686795304390386e-01   -2.564570014159656e-01   -2.429310221787017e-01   +9.303917256001780e-02   +1.645291120048207e-01   -3.393131363809232e-01; +3.362482865599961e-01   -1.376653597718840e-01   -7.040434918777559e-02   -5.260840331075772e-02   +2.570116146842468e-01   -1.669373573150967e-01   +1.933478522480684e-01   +1.214121585205492e-01; -1.285222561952989e-01   +1.495078536718921e-01   -3.544765425863782e-01   -3.093604903072116e-01   +1.263940156439807e-01   -2.431187387534746e-01   -2.718725465323931e-01   -4.376676459725057e-02; +8.786844328881860e-02   -2.863494988959249e-01   -5.892116400271685e-01   +1.151468934929125e-01   +4.310479893678261e-01   -2.304588434938927e-01   -1.368170612039015e-01   -4.350978378161038e-02; -1.737511119826859e-01   +1.289010780849558e-01   -2.150549853613051e-01   -2.170786751452921e-01   +1.619558713280405e-01   +1.630290181993304e-01   -1.860014953553263e-01   -2.679926481699706e-02; +1.443281449505699e-02   -2.050786579020138e-01   +1.123920476796975e-01   -1.235411342669624e-01   +3.993504445926280e-01   -5.030022781317577e-01   +1.106713670698999e-02   +3.082158167429935e-01; +2.841095945997436e-02   +1.190885102095015e-01   +8.433617735588861e-02   +9.921192243320209e-02   +1.376780724348349e-01   -2.699806159261867e-01   -2.534469722168778e-01   -7.324319371433796e-03];
L2I_L3I_iGABA_netcon = [-2.410021063466795e-01   +2.500976034803433e-01   +5.397461834097596e-01   +3.592660788812486e-01   -2.889735949734734e-02   -7.026289615586948e-02   -4.717212218470496e-02   -1.977000591945758e-01; -3.391665841577901e-01   +1.537780525769348e-01   -1.935779400905125e-01   +3.905374014210651e-01   -2.866709254992308e-01   +3.901122169240428e-01   -8.083381697016095e-02   -2.323612856342472e-01; -5.395497701148970e-03   +3.186003124018226e-01   +2.037182474839815e-01   +1.076245790658812e-01   +2.455580444846735e-02   -1.176718353670305e-04   -2.266922145626002e-02   +4.631971623659743e-02; +3.714600834270368e-01   +8.175284011093932e-02   +2.277964164929596e-01   +2.248166176603158e-01   +3.181465862793305e-02   +3.181685503644121e-01   +4.417174719966093e-01   +2.142227653876661e-01; -4.195849835395229e-01   +3.710927535494934e-02   +3.847760340146226e-04   +1.667037226106893e-01   +4.307006691173504e-02   -1.637409026538633e-01   +3.938243816667392e-02   +1.959452698026005e-01; +2.147933708787611e-01   +2.868473636740018e-02   +1.014964950338411e-01   +1.979167855542911e-01   -2.218566358859678e-01   -3.681376577443809e-01   -1.214852703427882e-02   +1.924538513246778e-03; +6.955501232437455e-02   +2.316933058489152e-01   -1.987183474715421e-01   -1.069121414905245e-01   +7.427963073085653e-02   +2.260949417017349e-01   +1.547501372473839e-01   -1.802977684469501e-02; +2.014963498313645e-01   +1.094106925510032e-01   +1.337937362639466e-01   -3.956697165625521e-01   +3.050736034915111e-01   -5.409925409937968e-03   -1.487725865495191e-01   +1.485654058945066e-01; -1.313007413342438e-01   +1.039541330251054e-01   +1.607412043010518e-01   -2.511577314557492e-01   -1.334358656018639e-01   +1.694496050407019e-01   -5.523691224649172e-03   +5.717488137936484e-02; +4.313319431896356e-02   +4.084914153041171e-01   +1.444417935843680e-01   -2.245031434771657e-01   +4.936460225168104e-02   +1.915988059544372e-01   -2.626750600584137e-01   +1.596149599466010e-01; -2.744877665299123e-01   +2.358908874536413e-01   +2.860428372915114e-01   +2.630411375158803e-01   -5.922771652733216e-02   +1.784060614308076e-01   -1.046420442991964e-01   +1.013361693694154e-01; -1.302172934097249e-01   -1.385497276857712e-01   -4.231358477681407e-02   +2.359279638726857e-01   -1.745038239892005e-01   +7.906951007404045e-02   -3.413457793613363e-02   +2.126816053507443e-01];
L3I_L3E_iAMPA_netcon = [+5.731122061090368e-02   -3.844101686647003e-01   -1.312020910302077e-01   +3.752480308218258e-01   -5.274547010471936e-02   -2.502391117521530e-02   -2.825128565873423e-01   +3.023039264816477e-01   +6.033969184961259e-02   -2.881513324366956e-01   +3.702320160110251e-02   -3.589257380065011e-01; +2.730608162639326e-01   +1.199878241124221e-02   -2.534487354145531e-01   -4.004982492197826e-02   +9.812372189072475e-02   +1.631813029470769e-02   +5.229856166684657e-03   +6.187335835817648e-02   +1.539854403250858e-01   -3.837543911275909e-02   -6.377804474672691e-02   -9.901634468462731e-02; +1.936965031396803e-02   +1.316172018940739e-01   +2.868600975903609e-01   +3.467559860867986e-01   +3.279666490262087e-01   +2.797362071467659e-01   +2.755972839571545e-02   -1.875985703751385e-02   -3.519231972643599e-02   -1.645011883398793e-02   -7.636466303040748e-02   -4.746928424014195e-01; +4.008742379889993e-02   -1.301093622073589e-01   +1.830585073678519e-02   +1.985258207974842e-01   +2.253287603124440e-02   +1.275954506545877e-01   -1.304089483330766e-01   +2.594324482734919e-01   +1.779530084543369e-01   -3.074535048113048e-01   -1.349588026864351e-01   +2.561426150943986e-02; -3.240550987630574e-02   -3.676078851687413e-01   -1.010271918290036e-01   +8.187403828435759e-02   +1.083301770548444e-01   -1.982490103226506e-01   +2.666098260625164e-01   +1.914189157930864e-01   -1.389372178680455e-01   -2.464863603002745e-01   -2.010337004690559e-01   -1.545397792920617e-01; +9.942195520381605e-02   -1.878018320790201e-02   -1.604233359359924e-01   +2.222351034398070e-01   +2.088033150602137e-01   -3.429504623496442e-01   +2.771094431876155e-02   -6.539627018940516e-02   -5.195716095879092e-02   +2.036180763298575e-01   -2.156317949786925e-01   -1.900519467521133e-01; +2.838258144442415e-01   -7.769700817225342e-02   -3.668720058583908e-02   -7.738944654136343e-02   +1.100277764457804e-01   +7.154782242199090e-02   +1.984392658875807e-01   -3.020348293859540e-03   -8.728764004569955e-03   +4.670565491354278e-03   -7.656324065708070e-03   -2.356365968767596e-01; +5.286218528952098e-02   -4.695595695973514e-02   -1.418999470212394e-02   -2.347221616702533e-03   +3.164923807447040e-01   -2.160856824588157e-01   -2.147680580012162e-03   -4.896574675227815e-02   +4.888180747369342e-02   +1.959843582032533e-01   -8.372286083610275e-02   -1.319217526531188e-01; +2.727409807629726e-01   -1.312654611191030e-01   +2.200142649630104e-01   +5.112137963704988e-01   +7.158854607232976e-02   +1.424245005734562e-01   -2.410899367420663e-01   -7.690716926760914e-02   -3.425770340614528e-01   -1.693723879616039e-01   -1.281249135521922e-01   +1.060053034138705e-01; +2.584236259689091e-01   -1.717382836054568e-01   -2.362523910851382e-01   -2.470590871923012e-01   -2.680919448098085e-01   +5.658191238202709e-02   +8.825607042918387e-02   +1.536630159531248e-01   +9.340614423466972e-02   +3.940798788234858e-02   +6.182996809670153e-02   +1.299422154518731e-02; -1.500780863472380e-01   -2.484331329132716e-02   -3.895099642279934e-01   +2.367293052970292e-01   +1.122973049997272e-01   +1.543990012421129e-01   +8.730281583625776e-02   -2.409558056530734e-01   -2.932120900783405e-01   -1.507502902261159e-01   +3.274335302048670e-01   +6.984182687434579e-02; -1.972987764048212e-01   -2.390411626934388e-01   -2.425880973117875e-01   +3.977501962029242e-01   -4.456638965429612e-02   -2.014722501723843e-01   -3.622155660422264e-01   +2.523979669779138e-01   +3.295009462081240e-02   -1.998148190339366e-01   +3.772084202093948e-02   +5.888741806122150e-02];
L3E_L3I_iGABA_netcon = [+1.587735029567058e-01   +1.030953322272545e-01   +1.478249201990338e-01   +9.787995434385487e-02   +1.349467710910669e-01   -4.422605672838168e-01   -1.625832865084555e-01   +4.348597659397612e-01   -3.570326754817804e-03   +4.575229325774824e-01   +4.519695265435840e-02   -1.343504274884301e-02; -1.468596615118151e-02   +1.752768121179480e-01   +1.019901623345194e-01   +1.488902194365819e-01   -1.914351506625059e-02   -1.159143360009190e-01   +1.853227124764023e-01   +1.159000472267730e-01   -1.392917219947531e-02   -1.726204998671371e-01   -1.938181845838141e-01   -4.031726456761159e-02; -1.160841945949115e-01   -7.188162555121835e-02   +2.928100383477753e-01   +2.197760257848002e-01   -1.999003783377179e-01   -3.148408591852281e-02   -1.310160460782837e-01   +5.020190743345514e-01   +1.896430186449090e-01   -2.047917389215646e-02   -1.385800538664979e-01   +9.931835748224144e-02; +3.352920700363112e-01   +2.027652378009848e-01   +5.576624370935046e-02   -2.656688799960783e-02   +1.759103998391379e-01   +4.721027145207967e-01   -3.360435620365175e-01   -2.913968135763272e-01   +4.732659971455436e-02   +8.848517225124705e-02   +2.835421942471334e-01   +1.989675147900771e-01; +2.339757099086783e-01   -2.391360234130738e-01   -5.988041185899902e-02   -6.965334982050701e-03   -3.770846796938024e-01   +1.619393476982192e-01   +1.748861018817829e-01   -3.331927252723357e-01   -2.242322643769754e-01   -2.187611250340966e-02   +3.916528560356576e-01   -2.322072104772204e-02; -1.781130429213225e-01   +8.394747417903206e-02   -1.468828984510643e-01   +9.447460744856884e-02   +1.329176136331013e-01   -1.145095724302334e-01   +1.176603234005685e-01   +3.161352543881910e-01   -4.761359210807100e-01   -3.416381068887563e-02   +2.617361464047366e-02   +2.285762547767810e-01; +6.081753891939867e-02   -3.255530140108215e-01   +3.012478264238455e-01   +3.107254610742093e-01   +4.084962642529934e-01   -7.717087948214649e-02   +1.704166980137692e-01   +1.015880754081186e-01   -7.510871002777762e-02   +1.380474728973759e-01   -1.214580474667410e-01   -1.354456619818457e-02; +1.517192032974171e-01   -4.222673032317462e-02   -1.982258047570804e-01   -1.516999556848623e-01   -5.596503621682356e-01   +1.707582467315258e-01   +2.683401697509780e-01   +4.377338891880656e-02   -2.030505349551687e-02   +7.176748763913507e-02   -3.210832395348944e-01   -1.115798801159139e-01; +9.119202346335270e-02   +8.949069309780691e-02   +1.933660157029582e-01   -1.969603953361126e-02   +1.278790570968545e-01   -7.304088697395160e-02   -6.103405833473553e-02   +2.856667320429847e-01   -1.969819590647710e-01   -1.781041716753852e-01   -1.870437341823029e-01   +5.133392143919282e-01; -1.053291409352397e-01   +2.722862771195513e-01   +2.205134823323947e-01   -2.012283610877830e-02   +5.934990656990674e-02   -1.464281932854593e-01   +1.476147068238984e-01   +2.704921704434024e-01   -3.259317572731388e-01   +4.490949911330887e-02   +2.843150152434139e-02   +3.782428159105617e-01; -2.480963672588309e-01   -1.121963238751554e-01   -2.408964512868218e-01   -2.235665485514923e-01   -1.646060988725409e-01   +2.433620975692690e-01   -3.096789111783905e-01   -6.404991933887821e-02   -3.974865383938160e-01   -2.438233942494571e-01   -2.360006221120170e-01   +1.595992539516196e-01; -2.568214528578462e-01   +2.015581809703239e-01   -1.948667446279116e-01   +1.344027665277531e-01   +2.078640100956159e-01   -2.054714440011925e-01   +2.628591001576114e-02   -1.796103053178503e-01   +1.913651995228505e-01   -3.004806438532306e-01   +2.878477482178458e-01   -5.412218577140717e-03];
L2E_Input1_iAMPA_netcon = [+9.612159938839017e-02   -1.441475858259121e-01   +2.958778236128797e-01   +5.162399829689956e-02   -1.092880704242420e-01   -1.127856391546149e-01   -3.707700483635114e-01   -2.339367892464883e-01];
L2I_Input2_iAMPA_netcon = [-2.015329631646589e-01   -3.835812249658539e-01   -2.638100572954262e-01   +1.726720692030119e-01   -8.796739702607652e-02   +4.524985497563054e-02   -2.523184334246308e-01   +2.043327875159154e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
