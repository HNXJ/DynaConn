function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.145219645423424e-01   +9.477999346948555e-01   +7.000721777207251e-01   +1.634704383539786e-01   +9.193453943479672e-01   +2.122203942377041e-01   +7.424821935420124e-01   +3.056087990232605e-01   +5.388006253460308e-01   +8.387396596334675e-01   +9.734916344346844e-01   +9.721040620276431e-01   +6.983318522356996e-01   +3.673720480608084e-01   +2.972287270532544e-01   +3.848241200378201e-01; +3.508925862245708e-01   +9.284997573579371e-03   +1.398722229119161e-01   +1.704044029805557e-01   +7.795609899303149e-02   +8.111070969033845e-01   +7.962089344248635e-01   +7.558003049833496e-01   +7.921994577818858e-01   +1.901234516683790e-01   +4.749366048897947e-01   +6.639734144433631e-01   +3.674736784511346e-01   +2.756678916511930e-01   +6.902822813035995e-01   +9.633377524886281e-01; +2.007857203887247e-01   +4.749706993053033e-01   +8.299788117783594e-02   +7.068763255308909e-01   +3.175899902812848e-01   +3.802736478455017e-01   +6.589058667582510e-01   +9.536896704913361e-01   +4.858599571113860e-02   +9.265427051162503e-01   +8.732327365480722e-01   +1.994270310885014e-01   +5.480018330105075e-01   +7.469090333754427e-02   +7.810413875134913e-01   +8.099817217958003e-01; +2.703199163758014e-02   +4.883432694003897e-01   +4.281507984758410e-01   +8.376214910376087e-01   +6.331205559561995e-01   +8.595611976451026e-01   +4.412156372221543e-01   +3.868742892452982e-03   +4.589876364484430e-01   +4.190842007814605e-01   +9.415104295550688e-01   +9.018525459054789e-01   +5.138939696193012e-01   +1.597815372160779e-01   +7.119603756428711e-01   +8.940046013406101e-01; +7.659173894732946e-01   +5.159686424435901e-01   +9.000465936013163e-01   +8.504694646203929e-02   +9.047323361393963e-01   +3.233034268159073e-01   +5.791034268401625e-01   +4.014576933955145e-01   +9.391235530484024e-01   +3.022459286035086e-01   +2.425817405047036e-01   +4.813621466213782e-01   +7.672449600613694e-01   +3.626912814641342e-01   +2.728848306758722e-01   +6.515940684388313e-02; +5.695076165994386e-01   +2.893636098897155e-01   +7.176390845137214e-01   +8.341334106404087e-01   +8.001577712744755e-01   +3.804373349100633e-01   +5.140035943231790e-01   +1.558944804724269e-01   +4.774582899018741e-01   +3.581568796501678e-01   +9.193954826337611e-01   +6.676920262787684e-01   +7.439483483483879e-02   +7.155409311235270e-01   +2.126234496179858e-02   +9.008775068907061e-01; +5.803925135816408e-01   +5.593429290729457e-01   +6.833188097121953e-01   +5.521046342268177e-01   +6.475961514515347e-01   +6.451427325922153e-01   +7.287391215710214e-01   +8.310806118677327e-01   +7.778642161564528e-01   +9.754513458202901e-01   +6.343727255862639e-01   +5.304994808988025e-01   +3.636792176046769e-03   +5.422952117610075e-01   +1.469604013867980e-02   +6.727720335731310e-01; +3.883352999601268e-01   +5.187720427957971e-01   +2.049301696505476e-01   +9.662393106882482e-01   +4.437096764042029e-01   +3.939263991814647e-01   +2.238803725947043e-01   +2.870300785417779e-01   +1.105588441361330e-01   +5.381312393912973e-01   +2.856881266862432e-01   +7.066790699601441e-01   +4.014833371306716e-01   +2.331453381242520e-01   +9.284846295234229e-01   +3.471624982648590e-01; +5.536078126677014e-01   +6.744630343798834e-01   +5.249198856922631e-01   +6.714064245172487e-01   +7.486027354528887e-01   +7.182313341182200e-02   +9.992875935776309e-01   +9.799433863046825e-01   +5.213568867751052e-01   +7.968452064611242e-01   +8.491740171111720e-01   +7.137896333314370e-01   +6.638265176494371e-01   +4.678203463871662e-01   +9.342644343561822e-01   +8.406754066778778e-01; +1.858631031597030e-01   +6.176183258349289e-01   +8.250341403692496e-01   +3.380465481592155e-01   +8.291837802492079e-01   +1.722309729585785e-02   +6.191460270422979e-01   +6.199637258387868e-01   +6.374372258784843e-01   +8.013353548209935e-01   +1.651197642722104e-01   +2.982158213261837e-01   +3.734674062503703e-01   +7.154304093808621e-01   +3.737235387544073e-01   +1.954110965264368e-01; +1.153198333683919e-01   +5.673722272273874e-01   +1.842856290576310e-01   +2.145195217018711e-01   +3.483720679326764e-01   +8.769199134911680e-01   +9.926633765555218e-01   +7.455049635168680e-01   +5.763065292317706e-01   +1.360697107423188e-01   +8.274567450876908e-01   +1.113508990370931e-01   +3.974228818172137e-01   +5.187297478794878e-01   +1.026792328750686e-01   +8.447905137466885e-01; +5.204244933896081e-02   +5.102065098662274e-01   +5.168718607954698e-01   +5.705521353789877e-01   +1.514355405900672e-01   +1.599964236156479e-01   +4.913507686449438e-01   +8.854985655793975e-01   +8.406833745790304e-01   +4.528348135100004e-01   +2.213506370365112e-01   +3.323214336643515e-01   +1.371453188497452e-01   +5.135936484202833e-01   +7.227071909937823e-01   +4.297826823271111e-01; +9.350750815801300e-01   +6.680363945903472e-01   +3.574434975821754e-01   +4.407957095624782e-03   +5.055842009363486e-01   +9.195417624490901e-01   +5.281047274858925e-01   +3.360811110849289e-01   +1.171411976705389e-01   +4.537607188504424e-01   +2.760520520663646e-01   +4.631910897357236e-01   +3.389044629902066e-01   +3.939199643520818e-01   +4.587010567060371e-01   +5.547707094785836e-01; +7.447933683064736e-01   +6.376325774957144e-01   +6.523886532524029e-01   +5.935562893003691e-01   +4.110382232851885e-01   +5.643702034108931e-01   +8.565672908465136e-01   +9.226695009746305e-02   +5.031888582406527e-02   +9.601060588332092e-01   +9.051235683910121e-02   +7.172361910726250e-01   +1.211648895549552e-01   +4.806035414664998e-01   +1.453915289195386e-02   +4.463718032058607e-01; +2.385610744609592e-01   +1.425182725479950e-01   +2.815506117798742e-01   +8.975733191283135e-01   +1.758645764601641e-01   +9.232945306228250e-01   +2.558608325466574e-01   +4.455351497753169e-01   +5.181497370421843e-01   +5.230471936805045e-02   +9.173489742158702e-01   +3.990324303940224e-01   +3.676768289831711e-01   +7.433508345296330e-01   +1.159025771880619e-01   +7.621978049104053e-01; +2.013807340498841e-01   +1.804549409033669e-01   +4.339994865350895e-01   +2.582606282732228e-01   +4.952683859547616e-01   +5.955084848405865e-01   +5.761441773600531e-01   +2.386820670277523e-01   +7.027458457991093e-01   +4.018352186667193e-02   +7.310105807251885e-01   +2.406448726710576e-01   +2.461835060257757e-01   +7.045534220214571e-01   +6.635215748070876e-01   +9.387951115415058e-02];
L1E_L1I_iGABA_netcon = [+8.410227157008321e-01   +7.503996263096248e-01   +8.710340546626485e-01   +4.378427140459922e-01   +9.192010910645869e-01   +7.703012989039488e-01   +3.199101733281551e-01   +6.433733368122322e-01   +9.524590290653018e-02   +2.694694297074268e-02   +1.262394004056984e-01   +5.177582982163824e-01   +8.776183486165952e-01   +5.745158193361672e-01   +1.719707720186410e-01   +6.365667355024182e-01; +6.186505627394261e-01   +9.913509077675512e-01   +3.122302695299701e-01   +1.411254111644952e-01   +8.913207170796472e-01   +2.763962468793405e-01   +9.665899221609915e-01   +4.385926769766639e-01   +2.973120366865825e-01   +5.110436024874349e-01   +4.339138087382606e-01   +2.058615955324869e-01   +8.050484018687332e-01   +2.911831749613958e-01   +5.838296887260781e-02   +3.416943609343884e-01; +6.655534748009957e-01   +3.735587464180116e-01   +4.324796032734619e-01   +6.498630313652203e-01   +5.898899484243033e-01   +5.215662337967071e-01   +3.502103188937662e-01   +4.811731448010090e-01   +3.319885538041034e-01   +8.668747515728428e-01   +4.799197916131852e-01   +7.731649765559827e-01   +6.487321664897109e-01   +1.422220030543761e-01   +2.198828713210534e-01   +1.516259522490216e-01; +7.801751306200103e-01   +5.089426174474563e-01   +3.784927778197809e-01   +7.260634577178070e-01   +8.371584131996819e-01   +4.092622688697640e-01   +3.160845286615909e-01   +9.587320660147976e-02   +4.770113473089394e-01   +5.753800873973131e-01   +6.752550857789007e-01   +3.888196487383705e-01   +7.354799074132393e-01   +4.346541457727186e-02   +2.048234351819969e-01   +3.987040416571631e-01; +3.173196994128128e-01   +7.565743345949996e-01   +6.543231256919927e-01   +1.718178997747439e-01   +7.790132222105762e-01   +7.867598441116759e-01   +9.140472912935772e-01   +8.049210091785267e-01   +2.406675111764412e-01   +4.258994272727817e-01   +3.495466013266606e-01   +6.815279769767207e-02   +6.635668315594581e-01   +6.219763284328674e-01   +2.129495294108845e-01   +9.171674113800993e-01; +3.227834243955361e-01   +1.343656230489823e-01   +2.456963411980126e-01   +3.376380243280795e-01   +7.920329858405147e-01   +2.638206780850687e-02   +8.832443763606477e-01   +6.136930526324083e-02   +4.552874306877875e-01   +7.197154923982384e-01   +4.374440023833796e-02   +7.509838803307053e-01   +8.860985406301667e-01   +6.055133406104263e-01   +5.813290342214592e-01   +1.535939825942511e-01; +6.269754431482421e-01   +5.175363329643884e-01   +6.897624850618929e-01   +1.021505915807802e-01   +6.943173018614013e-01   +4.075285081984276e-01   +3.592847687535217e-01   +9.554430104413640e-01   +7.541791808278503e-01   +2.283874984550657e-01   +2.923602789468345e-01   +4.585620646027985e-01   +8.539456512166529e-01   +3.735165706597716e-01   +3.733392192558327e-02   +4.667371062218189e-01; +9.022175699554756e-01   +9.099815504739726e-01   +3.278673072413419e-01   +4.607455320029478e-02   +1.764638502759480e-02   +8.279260680761206e-01   +7.381049824704914e-01   +7.728570951573867e-01   +7.137248914321594e-01   +5.851297305882103e-02   +8.001390752319194e-01   +3.117530413549605e-01   +4.069538583052597e-01   +8.313287883593394e-01   +7.960216222108200e-01   +8.172680652156269e-02; +3.719812119101914e-01   +9.964328855114023e-02   +8.740152263327007e-01   +4.718132534287282e-01   +3.247106590027773e-01   +5.904814042290186e-01   +1.233810315123800e-01   +4.452532499816186e-01   +2.319888434551305e-01   +9.751090179143508e-01   +6.494877028742420e-01   +2.737804020528394e-01   +1.110943220661861e-01   +5.191495525362358e-01   +1.389186603283580e-01   +3.348394433147001e-01; +8.854230149458525e-01   +1.838927763018691e-01   +9.998451799855893e-01   +4.760736495408950e-01   +9.479954396927077e-01   +2.086677674809732e-01   +5.905277430817096e-01   +1.670667896444928e-01   +6.995239877307464e-01   +9.715158125372457e-01   +7.085414191036953e-01   +5.746303034181693e-01   +4.097361259908436e-01   +8.145867810637816e-01   +5.755954498196855e-01   +4.882099103759107e-01; +1.150325622723576e-01   +1.789650844937023e-01   +6.854351860358577e-01   +5.491737527064526e-01   +4.085638720769567e-01   +2.904981382243694e-01   +4.375577981312194e-01   +7.770471278278997e-02   +3.021182294082411e-01   +1.282139152429851e-01   +7.592584335437023e-01   +9.142107371305562e-01   +3.325921739594634e-01   +5.792734891700267e-01   +8.114800701754493e-02   +4.999283717557580e-01; +9.519704756398174e-02   +5.338049139730285e-01   +3.482143102631804e-01   +6.453787525337255e-01   +6.231246219987306e-01   +2.684679497206451e-01   +9.638623881715100e-01   +7.461472983715084e-01   +4.670180484749353e-01   +1.490439800022152e-03   +3.872923756580977e-01   +4.471063329490464e-01   +1.084145035283039e-01   +7.124450885970139e-01   +2.280893379234570e-01   +1.321419255317501e-01; +5.415670438258043e-01   +9.761573980318904e-01   +5.596120575883925e-01   +3.486574013108309e-01   +8.529547243620947e-01   +9.348885250443114e-01   +9.751280890152196e-01   +5.351076714365214e-01   +4.382327670913439e-01   +9.337936758845380e-01   +3.644130083446173e-01   +9.804343523111518e-01   +8.590500459863107e-01   +7.296581676826511e-01   +4.425899087478701e-01   +7.555250537576329e-02; +6.001944125053502e-01   +8.399602025014415e-01   +8.946575813858433e-01   +2.524256190112565e-01   +3.688110553392564e-01   +5.579001161249497e-01   +2.499821834668662e-01   +4.858241048659329e-01   +7.274478325522225e-01   +7.408873527728513e-01   +8.127648235058565e-01   +1.026130989700548e-01   +9.006507183588276e-01   +4.486842366556159e-01   +1.758140831281016e-01   +6.737051148101497e-01; +7.246102308925817e-01   +6.686737058584645e-01   +6.498885957301336e-01   +1.821528659849160e-01   +2.044549207216883e-01   +4.333895194282156e-01   +7.765654555467801e-01   +8.862775465949002e-01   +8.739875050347059e-01   +4.310286347914749e-01   +3.878423324756078e-01   +4.203363630790602e-01   +6.907922972091987e-01   +2.788878406153821e-01   +4.162399126961531e-01   +1.162512867477906e-01; +9.916496958824098e-01   +1.436359100698175e-02   +3.833997619590938e-01   +4.784854514717302e-01   +9.083626525956568e-01   +3.252566839828791e-01   +7.082054260456908e-01   +5.884871062338166e-01   +9.098862507551236e-01   +9.414048539622343e-01   +8.723162798020871e-01   +3.879459081181739e-01   +7.458852300730688e-01   +1.575760015841789e-01   +9.639668642646259e-01   +9.858393781087242e-01];
L2I_L1I_iGABA_netcon = [+5.725018211882799e-01   +5.674550579254385e-01   +1.062104085139215e-01   +4.559532895047670e-01   +8.019022604846785e-01   +9.746044241808623e-01   +2.235713696623872e-01   +7.576938703854559e-01; +5.608911180734134e-01   +9.522547269110007e-01   +1.337011257839338e-01   +5.656723472625300e-01   +5.462993972645755e-01   +4.238691592340694e-01   +6.475572134582708e-02   +4.987143433246921e-01; +6.044038851057065e-01   +1.214089765859017e-02   +4.380758893034472e-01   +8.192597173359812e-01   +2.583817361882190e-01   +3.913144470037179e-01   +8.290895725135569e-01   +8.253686865187156e-01; +4.656419995966459e-01   +1.218977322716409e-01   +9.290655955213245e-01   +3.608635681606099e-01   +7.776751472427378e-01   +4.603442995964664e-01   +3.931333451030664e-02   +9.160180079947136e-01; +4.368209977302759e-01   +8.535071204557564e-01   +1.356882847866103e-01   +2.414645387205517e-01   +7.775733402097570e-01   +1.318185269577097e-01   +9.097829850478369e-01   +7.069927280746925e-01; +6.886594320164521e-02   +2.201950567643064e-01   +8.206008888573080e-01   +7.666565401124341e-01   +1.481650226563844e-01   +4.633126168005371e-01   +4.543874614961184e-01   +8.017509071314729e-01; +6.374745165101688e-01   +7.011826786207394e-01   +9.330175109230593e-01   +2.373200555086392e-03   +8.280256193015461e-01   +2.670066800146121e-01   +2.825695291837984e-01   +9.594244388465046e-01; +4.268771673357956e-01   +7.776347713176787e-01   +5.758932237688450e-01   +2.785200325486432e-01   +6.212874034111544e-01   +1.008932044202804e-01   +7.560833153346438e-01   +9.489446753953370e-01; +7.557216617684707e-01   +4.282239660161107e-01   +4.996691805451392e-01   +3.145968487205617e-02   +4.663756778954708e-01   +6.589024673704468e-01   +9.301613920889901e-01   +2.946459559716292e-01; +3.023514418010912e-01   +7.328552050062730e-01   +9.249124766773886e-01   +6.676867898339410e-01   +4.880037448967281e-01   +9.379033927668875e-01   +1.388276265325889e-01   +3.540885994003011e-01; +6.000552294320383e-01   +4.521841240184081e-01   +8.602966271043212e-01   +9.750440459246440e-01   +2.207966364713275e-01   +7.679517691816022e-01   +9.438194696558252e-01   +5.435647950636423e-01; +3.304546494837168e-01   +8.029549723560374e-01   +2.525316749261496e-01   +9.462446774201059e-01   +8.551068887730271e-01   +4.473558496142192e-02   +3.140446910676678e-01   +2.098062804659197e-01; +6.460187507301669e-01   +4.323102141359883e-01   +4.573485250412627e-01   +5.006975074851133e-02   +8.758152134536751e-01   +2.586710788408689e-01   +2.075067557937061e-01   +7.782951670003666e-02; +1.680758394511163e-03   +1.495910547770529e-01   +7.384309820871031e-01   +2.904436440892985e-01   +8.370425695010650e-01   +6.431585799281199e-01   +4.633081793952352e-01   +5.097285605354758e-01; +1.482636396060320e-01   +8.004309579980126e-01   +7.509296855132667e-01   +4.827865458583023e-01   +4.404889660748464e-01   +8.788654078552055e-02   +5.971792496987908e-01   +1.967163341472882e-01; +2.486579996471335e-01   +3.764123257719109e-01   +2.407757089895290e-01   +8.859494049058482e-01   +5.430966584505684e-01   +7.225736223199146e-02   +5.474071907055401e-01   +1.412894356254102e-01];
L1I_L2I_iGABA_netcon = [+7.164183517762894e-01   +8.709366283256671e-01   +6.174582656202293e-01   +4.798000462187903e-02   +1.503169863831557e-01   +2.359058685918894e-01   +8.444856807100342e-01   +3.689471914241937e-01   +7.141937125516494e-01   +3.903747211211812e-01   +2.417520733608279e-01   +6.777492613101272e-01   +1.635407949178182e-01   +5.714730111129935e-01   +4.699932674651510e-02   +4.412333096566213e-02; +6.111817387535606e-01   +8.049605420561065e-01   +6.177561363582673e-01   +5.380907766410418e-02   +7.485629247417046e-01   +5.527012431045605e-01   +1.997858607090932e-01   +5.640056365382388e-01   +1.929524602523407e-01   +7.287854773886634e-01   +5.072485565987466e-01   +3.396443097907166e-01   +1.101704909291968e-01   +8.161671151168907e-01   +4.360307410497575e-01   +9.257123253855762e-01; +1.632885328332758e-01   +6.207696314311388e-01   +3.114684174451834e-01   +6.000488944494907e-01   +9.513911858238623e-01   +1.135812071218439e-01   +6.158030149918930e-01   +8.399382332309473e-01   +2.334157433960590e-01   +6.338831658969483e-01   +7.355722648878654e-01   +5.481934157581574e-01   +7.473198626280204e-01   +6.794552434477430e-01   +9.250738585053815e-01   +1.777218471448845e-01; +4.823618319415073e-01   +4.811058319067319e-01   +1.356640290768520e-01   +6.610503821195302e-01   +2.596638601434714e-01   +8.269034693834221e-01   +1.582051314454615e-01   +7.166356677073998e-01   +1.000000000000000e+00   +9.810213253858184e-02   +7.842097472236056e-01   +5.335511301549776e-01   +2.185358706287674e-01   +4.411541629804163e-01   +8.861563935103424e-01   +7.487442174957639e-01; +2.901328968206775e-01   +2.058890881913035e-02   +6.060404037153642e-01   +4.877825040653317e-01   +9.403154956430668e-02   +6.566864627266701e-01   +5.852693145200750e-01   +1.134132847959419e-01   +9.037191159635748e-01   +4.985213320876056e-01   +6.815357603939044e-01   +9.079305032916394e-01   +4.880768591902726e-01   +8.936272932768029e-01   +9.396291161305188e-02   +4.701084455769184e-01; +4.021353812406382e-01   +1.248806589965613e-01   +8.956871864279941e-01   +9.822802307115180e-01   +2.326635336230327e-01   +2.323324909916978e-01   +5.436557105164441e-01   +7.427264795682130e-01   +9.334320405127191e-03   +5.570688368082399e-01   +8.151412753759117e-01   +2.848981944061466e-01   +4.750733645467255e-02   +7.901798415762549e-01   +6.816248979922911e-01   +2.503341395460419e-01; +4.893777595703195e-01   +7.223347189351159e-01   +5.678893007049324e-01   +8.645333824146014e-01   +8.933988123276262e-01   +3.029194858794868e-01   +6.886055287235671e-01   +9.244779152928342e-01   +8.364663696363217e-01   +5.696869988747229e-02   +4.247828768168201e-01   +1.366345873092296e-01   +5.809169563899843e-01   +5.917347414385754e-01   +1.571778980893079e-02   +6.625065309606416e-01; +8.652077535547907e-01   +6.691147805160844e-01   +6.375456102779439e-01   +9.579642684636415e-01   +1.976882825336592e-01   +3.261265397995336e-01   +7.029637788659080e-01   +9.254784009005339e-01   +2.539503043734337e-01   +8.353536118835805e-02   +4.953931164037726e-01   +9.578350514342008e-01   +4.954527601220776e-01   +6.232362593389370e-01   +1.259272386833457e-01   +6.139031075334505e-01];
L2E_L1E_iAMPA_netcon = [+3.749883266090640e-01   +5.637539255586325e-01   +2.021085362619174e-01   +5.193788802107853e-01   +2.950158827441782e-01   +6.893035082800786e-02   +2.827034869690234e-01   +2.661173488268449e-01; +4.365828613881172e-01   +1.847155201912546e-01   +1.436531012318361e-01   +6.824687984978337e-01   +6.161745204824283e-01   +5.904161016680360e-01   +9.295958660382433e-01   +9.001234837624382e-01; +7.215564811636795e-01   +6.055509664556684e-01   +7.654095440926312e-02   +2.136626562476463e-01   +8.684609689787848e-01   +7.808019280493363e-02   +7.594909649065249e-01   +1.580070935438055e-01; +1.950770022448798e-01   +7.315276127379301e-01   +9.173214454438601e-02   +9.699545172662412e-01   +8.151823178976128e-01   +3.977836176819481e-01   +2.597228699323558e-01   +5.532272974753154e-01; +4.468081339969360e-02   +8.375427994482689e-01   +5.497329156376286e-01   +3.481964076665015e-01   +2.081359765496567e-01   +5.379142770919938e-02   +2.424329699193195e-01   +4.221711357714418e-01; +3.092947713953347e-01   +2.751071182813547e-01   +7.315367759801058e-01   +1.845242798989128e-01   +7.523910812177801e-01   +1.273492190159858e-01   +1.623010663324224e-01   +5.451501571447926e-01; +7.919595844961909e-01   +6.086171981788718e-01   +5.461517319169071e-01   +2.460672791639900e-01   +2.006171359097533e-01   +2.387492832970953e-01   +2.920018921483661e-01   +7.475281521988942e-01; +4.363989004136593e-02   +5.503924075098192e-01   +4.471585881243763e-02   +2.592184570611914e-01   +5.844355947295264e-01   +9.411796920547597e-01   +5.663726752422049e-01   +1.312136256419539e-02; +2.154741649328827e-01   +2.804039325197260e-01   +6.375502348203833e-01   +2.194180199767020e-01   +8.760758193242418e-01   +2.056143529334171e-01   +3.965737811978636e-01   +9.220991232834921e-04; +2.701205013113560e-01   +3.400849157795838e-01   +9.897403135243374e-01   +3.619836698550923e-02   +7.187511742660166e-01   +3.278555649411513e-01   +9.845256322377334e-01   +1.912714418988604e-02; +7.914768346237603e-01   +5.725662461003258e-01   +9.169127458065001e-01   +3.511078298215068e-01   +6.980153571770628e-01   +8.645206997704800e-01   +5.466483966385938e-01   +3.491014294099043e-01; +9.832024258344675e-01   +7.468179559371921e-01   +7.750801974681156e-01   +9.008503730120804e-01   +4.574577540693057e-01   +9.248257064783721e-01   +9.361896155507862e-01   +4.282808276519334e-01; +9.441618856856497e-02   +7.673494577012708e-01   +1.969576176142651e-01   +1.357635889710401e-01   +5.061893339688396e-01   +2.318309868083392e-02   +9.874703142477811e-01   +5.428209604959537e-01; +1.989155196659406e-01   +4.056995569712685e-01   +3.072234757396454e-02   +9.511875832773963e-01   +7.982500456023549e-01   +3.625301845831109e-01   +8.303076175055748e-01   +4.798610410588881e-01; +1.185341038433663e-01   +1.547252239814539e-01   +3.792123144793516e-01   +9.066976834434709e-01   +9.372544268417431e-01   +5.331645684359154e-01   +1.789655373208976e-01   +9.136223625567752e-01; +6.430129561637742e-01   +2.047638855583507e-01   +5.772003659932409e-01   +4.101985071747368e-01   +7.919984830983581e-01   +4.095202492570438e-01   +3.142418051384162e-01   +4.184888489289126e-01];
L1E_L2E_iAMPA_netcon = [+4.966480063262085e-01   +4.591869246732335e-01   +6.166506452580364e-01   +4.912648114391462e-01   +2.371344169334251e-01   +7.162480748046870e-01   +6.848961687868674e-01   +6.347657248204140e-01   +5.200239647540100e-01   +2.394302853706102e-01   +8.726567625759662e-01   +1.739491212258640e-01   +1.344803387983356e-01   +2.439983239016104e-01   +1.836247620497589e-01   +3.187991213214979e-02; +8.362281904828790e-01   +3.650748823199875e-01   +1.011044180779796e-01   +6.641911783189357e-01   +8.341487586519277e-01   +3.789521516072649e-01   +9.739546158474992e-01   +6.223525193727942e-01   +6.723053490286852e-01   +7.287681186197250e-01   +6.657954575742472e-01   +2.972576871569568e-01   +2.883256973083926e-01   +7.429271379157458e-01   +1.521946774442524e-01   +2.538425240155807e-01; +1.819712601602505e-01   +2.926971626739633e-01   +7.582291280710145e-01   +1.793408351688119e-01   +7.321184162671649e-01   +3.794689123350086e-01   +7.578485711726430e-01   +4.106852913910061e-01   +7.735199060222496e-01   +1.236744505757077e-01   +5.475443457691924e-01   +1.046632056445976e-01   +6.681634044731287e-03   +9.328032510145469e-01   +1.333283524726935e-01   +9.873686521604691e-01; +3.402437201164422e-01   +2.381633680220211e-01   +5.400215496723980e-01   +4.737788587246332e-01   +4.877696361512344e-01   +7.185807470629814e-01   +5.519129443877600e-01   +4.328826330336774e-01   +4.617553009271003e-01   +3.876952141909058e-02   +2.441228179568336e-01   +4.545563362494215e-01   +3.059696532954762e-01   +3.463182666085615e-02   +1.628778246306481e-01   +6.314868007039192e-01; +6.949349137552585e-01   +1.387804958825453e-01   +4.475462057223005e-01   +4.998180236148390e-01   +8.521360967594482e-01   +8.326571108994755e-01   +2.681892553295640e-02   +5.128019076855692e-01   +9.091999826726094e-01   +6.515067719660040e-01   +1.081310925369220e-01   +5.879954575119557e-01   +9.071122299438924e-01   +4.289394037522732e-01   +9.255201261851804e-01   +3.573101807245450e-01; +6.904210268185048e-01   +1.022827926535807e-01   +7.430205303523212e-01   +6.003283803100199e-01   +7.208977935200765e-01   +6.682244366042799e-01   +1.886164628886186e-01   +2.627585089248634e-01   +2.444793536282169e-02   +1.954988834530836e-01   +9.681102473626867e-01   +2.189846563924841e-01   +2.944393498254412e-01   +8.254302590436218e-01   +2.636756825903660e-01   +9.917536219439836e-02; +3.679025457423657e-01   +2.354889760241868e-01   +3.880061964414787e-01   +2.458216737221889e-01   +5.194157174517312e-01   +6.473456241184854e-01   +9.400006954735558e-01   +4.227101273813659e-01   +4.871789016926616e-01   +9.723736070587922e-01   +5.864673178758156e-01   +1.056054279950951e-01   +8.291316309494262e-01   +9.978937953802233e-01   +2.045938467869618e-01   +4.128904333460894e-01; +2.956749017438501e-02   +3.480995440648947e-01   +5.328871760716264e-01   +5.189739377048217e-01   +9.373984343685439e-01   +5.625695555801585e-01   +3.944920120261282e-01   +5.208349170964092e-01   +2.697934410989614e-01   +8.242251924806459e-01   +8.170807047275017e-01   +5.638466291683005e-01   +7.378380764816356e-01   +9.209760630988778e-01   +6.198524898528535e-01   +9.287256217550330e-01];
L2I_L2E_iAMPA_netcon = [+6.769302885293171e-01   +6.124620235826879e-01   +3.777819073549639e-02   +8.012540348931545e-01   +5.199947374623146e-01   +8.203953744248611e-01   +6.478657766796487e-01   +3.853736366603394e-01; +2.221643473708509e-02   +9.419770949934068e-01   +5.458335731802848e-02   +9.360094098909627e-01   +6.442351012504359e-02   +1.091974537312728e-01   +3.347830555754035e-02   +1.680893581856987e-01; +7.322555696750817e-01   +9.616753131585940e-01   +4.068894029348130e-01   +9.383772647712397e-01   +2.872681972194762e-01   +2.423652847608200e-02   +5.636451700113521e-01   +4.467076648550483e-01; +2.153841264915732e-01   +3.680690557932451e-01   +9.791615844662904e-01   +1.450982934180592e-01   +7.159058790421720e-01   +8.920373522196216e-03   +3.089925347234538e-01   +8.756513846069296e-01; +8.530733927956502e-01   +7.957679915750243e-01   +7.113685653087014e-01   +3.245525983819322e-01   +8.874562740796612e-01   +3.350066805052403e-01   +2.624864574107668e-01   +4.039239841586791e-01; +1.569736224769794e-01   +7.221884989307438e-01   +9.904471943115161e-01   +4.274291917996422e-01   +3.675928777377502e-01   +6.651194748000397e-01   +7.188125149829941e-01   +1.672396284898729e-01; +6.703447606377839e-01   +9.521264193440645e-01   +6.494433368265561e-01   +7.079387718719685e-01   +5.638969575261717e-01   +5.909772544933567e-01   +3.057250519149268e-01   +6.657437899546292e-01; +9.336021778008537e-01   +1.199425002651390e-02   +5.025672610553827e-01   +6.213115723717476e-01   +8.805255160357242e-01   +7.910117548067651e-02   +9.023459995349262e-01   +9.319333134732518e-01];
L2E_L2I_iGABA_netcon = [+6.460460675423720e-02   +5.247772644776052e-01   +3.449341176823398e-01   +2.584418468646403e-01   +4.662386553934073e-02   +9.031697035447586e-01   +3.430688190995719e-01   +4.547420881302162e-01; +3.542370726189629e-01   +6.171061429044677e-02   +5.576522999556779e-01   +9.845210499787814e-01   +3.641015730618419e-01   +5.534527217910959e-01   +9.352666588590759e-01   +6.685388386677482e-01; +9.279321358766447e-01   +1.820516746246093e-01   +6.886268586727763e-01   +3.482872549370823e-01   +4.191426502992350e-02   +7.108706756818000e-01   +9.113788981496560e-01   +7.714517672009719e-01; +2.400043116521206e-01   +3.176423231106479e-01   +3.392995304079288e-03   +3.932892583910281e-01   +4.918774380814344e-01   +7.171056284518917e-01   +7.302998589990108e-01   +9.271301462919876e-01; +1.127676607687465e-01   +2.449554559695047e-01   +5.015507877662550e-02   +7.516746026466575e-01   +7.308555208397403e-01   +1.739589382720398e-01   +4.446834175738359e-01   +6.509869052345747e-01; +7.111305064491413e-01   +3.188475464378189e-01   +3.048766162810428e-01   +1.092136888541654e-01   +1.457494955383910e-02   +3.545739228642092e-01   +1.466610766839823e-01   +5.025582467876645e-01; +2.415901068261378e-03   +8.712806766564418e-01   +8.756538938080510e-01   +5.949319935070809e-01   +5.058584679659818e-01   +3.739797539376822e-01   +8.317004858071976e-01   +3.420349903986018e-01; +1.792379509511870e-01   +3.015877763725331e-01   +6.260986018899848e-01   +1.242510127358687e-01   +2.489981930917870e-01   +7.586586775519196e-01   +2.460623994556632e-01   +9.427236167272743e-01];
L3E_L2E_iAMPA_netcon = [+7.671662226723648e-02   +1.630386468277129e-02   +3.696870305737126e-01   +4.917846092061284e-01   +1.962305667667047e-02   +9.647076584732579e-01   +3.586360396364658e-01   +2.213611258107660e-02   +2.036870791962053e-01   +6.827291603859967e-02   +2.418908667188678e-01   +9.985853136669676e-01; +9.550047645207393e-01   +9.851997221407895e-01   +1.213881714780310e-01   +6.716649008327716e-02   +8.074495582783402e-01   +3.894606132772891e-01   +2.283425102743431e-01   +1.287516659427213e-01   +3.561053640999325e-01   +7.502106057758052e-01   +5.429071694719857e-01   +3.398259975195086e-01; +6.650437956840008e-01   +7.222823913973290e-01   +5.102130835412677e-01   +8.711622904413219e-01   +7.976802320154295e-01   +6.628962135932143e-01   +7.244966642055218e-01   +6.708679469564077e-01   +8.942020375135817e-01   +9.959886278444064e-01   +3.355998673841369e-01   +8.313744893270102e-01; +1.690388410577940e-01   +8.792331796936781e-01   +7.632940377941491e-03   +9.995769633209031e-01   +4.180101188967832e-01   +5.847312426365944e-01   +7.751757004522614e-01   +5.100689958028056e-01   +8.192491319232327e-01   +7.712374442997615e-01   +6.697848569062468e-01   +1.117927128775644e-01; +1.994025605671589e-01   +8.155580649335002e-01   +8.726691165984347e-01   +1.200786293595066e-01   +6.384437116061976e-01   +5.025236530662252e-02   +3.365990745675531e-01   +7.572279261383816e-02   +3.176539934186203e-01   +8.928316252504800e-01   +8.792172421413037e-01   +7.817764606234985e-01; +9.917682318160733e-01   +3.379337911234241e-02   +9.083237795553980e-01   +1.054322879529293e-01   +5.675623075556311e-01   +7.672875187507633e-02   +5.732943847568590e-01   +5.359877933412420e-01   +6.007990433875828e-01   +4.384743422969548e-02   +9.773059516078110e-01   +1.519499834816480e-01; +9.361493412523418e-01   +9.368367495406063e-02   +1.122443319556992e-01   +1.477881146243005e-01   +9.105451349695332e-01   +2.291615208855626e-01   +6.362588029065442e-01   +6.875734448258635e-01   +7.049516928973503e-01   +7.989297909718169e-01   +1.350547984754719e-01   +7.311569098611372e-01; +9.809225170134184e-01   +9.481306239474170e-02   +4.140079059468674e-02   +1.307797391962684e-01   +7.552263534433304e-01   +4.154896777738117e-01   +3.660348423470200e-01   +5.906819941939268e-01   +1.786705734765835e-01   +7.149787745684103e-01   +8.821069780072415e-01   +1.166227184778468e-01];
L3I_L2I_iGABA_netcon = [+7.693086343325788e-01   +5.382870477573704e-01   +5.981766738499317e-01   +3.088274105329911e-01   +9.611107789775151e-01   +1.118618060216621e-01   +2.950455627725053e-01   +7.955661838026875e-01   +9.204821264127616e-01   +9.962318005515174e-01   +3.098095807951934e-01   +9.951504212346305e-01; +6.368105064396076e-01   +4.509633111967927e-01   +5.639709411008900e-01   +7.587863808054667e-01   +5.476995680018609e-01   +6.248949114074386e-02   +1.673009222635898e-01   +5.019893650790724e-02   +3.879176073230346e-01   +2.918736133777527e-01   +4.437330953274206e-01   +9.182688150231488e-01; +7.999635272483701e-01   +1.151987911206621e-01   +7.399716740661574e-02   +6.510036008567915e-01   +9.783229223909421e-01   +4.411128059794967e-02   +7.228717100063677e-01   +1.817897927736568e-01   +7.470053602725023e-01   +5.226510421068511e-01   +2.027316446398965e-01   +6.923666987021586e-01; +9.656577186202248e-01   +7.152107263176027e-01   +7.648019454894268e-01   +3.328691268652960e-01   +1.237024076303806e-01   +1.285855747059523e-01   +2.977064120171733e-01   +2.476567415206488e-01   +8.787966127910674e-01   +3.620275467891843e-01   +9.413564037225424e-01   +2.174596486968964e-01; +7.139752275847294e-01   +1.835837923366724e-01   +8.689796193572082e-01   +9.787489398139202e-01   +1.605807213680215e-01   +4.903670779065569e-01   +6.749656924769157e-01   +2.557605875222042e-01   +3.974057595101981e-01   +5.205193811251704e-01   +2.918542610866937e-01   +3.086290453697149e-01; +6.456517271726399e-01   +3.276926588115275e-01   +6.997075164923290e-01   +5.320021193307568e-01   +3.333420949266691e-01   +4.694871232005780e-01   +7.537298771583248e-01   +6.490313202396228e-01   +1.691205603140329e-01   +4.946732079879673e-01   +1.181040208524896e-01   +2.256311452454092e-01; +5.176657377385155e-01   +9.698108008413360e-01   +1.097058141427192e-01   +7.513663793690875e-01   +5.294458984927914e-01   +1.559239176116080e-01   +7.430606061185440e-01   +1.010358955446152e-01   +4.433860481668038e-01   +1.830576996663445e-01   +6.614803286884827e-02   +7.031441429652970e-01; +9.550258381250604e-01   +6.946198636500044e-01   +6.614373293254423e-01   +2.646774364395421e-01   +6.902875763247184e-01   +1.325142598876194e-01   +7.797154973292638e-01   +4.691522388456565e-01   +8.536182968032968e-01   +4.851226353256560e-01   +7.280356541939893e-01   +3.770219163236081e-01];
L2E_L3E_iAMPA_netcon = [+6.523898226649349e-01   +3.816009700196987e-01   +2.311800186442481e-01   +4.669478161834799e-01   +9.095434522780285e-01   +9.530253037314924e-01   +7.612024076043041e-01   +3.554842309464447e-01; +3.790246381752641e-01   +2.611639155306075e-02   +9.143758529629724e-01   +2.860868007955334e-01   +6.798665136640339e-01   +1.910810111689722e-02   +8.955707644082121e-01   +6.652419010282147e-01; +3.036158015145492e-01   +3.281697801978893e-01   +4.878988160770465e-01   +2.721513645434239e-01   +8.432386985501066e-01   +5.016453501179909e-01   +7.948190343829130e-01   +5.937273748819578e-01; +1.562572710715882e-01   +4.939008949812417e-01   +5.880598984957071e-01   +1.467614269243636e-01   +9.758855798909578e-02   +3.358869126656396e-01   +9.450899297452413e-01   +5.253281531776010e-02; +7.777295079401012e-01   +2.682307654133889e-01   +9.530765489041914e-01   +1.414304413187294e-01   +7.350958323960132e-01   +6.677323554023804e-01   +5.365022386923424e-01   +2.119956725419018e-01; +7.122393546187462e-01   +5.321125491380552e-01   +8.475313377198386e-02   +2.640640051169426e-01   +5.503287357620457e-01   +1.626673082731469e-01   +1.586647778265940e-01   +5.965405037658261e-01; +1.739811041903190e-01   +4.177792534422173e-01   +2.212070364981206e-01   +6.066229970535001e-01   +2.489785525071397e-01   +2.240561862879281e-01   +1.357756645712918e-01   +2.681716323320770e-01; +4.480371140565125e-01   +6.912671756863593e-03   +1.602885897906712e-01   +1.015416369202742e-01   +7.187842146508092e-01   +1.118645350129209e-01   +2.482157985753728e-02   +1.166733315010490e-01; +8.414341149752819e-01   +8.949044449013950e-01   +3.921490220979921e-01   +4.921542528899870e-01   +3.625592038809594e-01   +9.921466129368857e-01   +6.890810473118639e-01   +2.181571554873250e-01; +7.016025167323013e-01   +2.390214327951119e-01   +1.862955019946920e-01   +8.935415234935575e-01   +8.463661421662821e-01   +1.441529301643948e-01   +5.820538889806618e-01   +8.782422142494793e-01; +7.642912928422151e-01   +8.016934386306533e-01   +7.597396252920650e-01   +1.869301642229027e-01   +8.222782404229803e-01   +7.676697233589974e-01   +2.986328583467887e-01   +4.624654798175388e-01; +9.770205874957754e-01   +5.810469348595846e-01   +2.345555318810365e-01   +5.312321407616354e-02   +6.187012968178769e-01   +6.288693102429427e-01   +7.234955399734540e-02   +7.301011111313561e-01];
L2I_L3I_iGABA_netcon = [+5.900654495723706e-01   +1.436530038177037e-01   +3.460698157884022e-01   +3.720441190217675e-01   +5.969599573656444e-01   +5.126534278632509e-01   +7.738921353362085e-01   +2.662127625738028e-01; +8.428771245240547e-01   +9.894874624971952e-01   +4.301215036335142e-02   +5.367371872319725e-01   +4.766368206176950e-01   +2.419861836798630e-01   +1.824237057042899e-01   +5.957903170886424e-01; +6.055929685665493e-01   +4.781616400924068e-01   +9.480213436574471e-01   +9.723965210367392e-01   +3.765209951614174e-01   +2.680819007436541e-01   +4.514607881685296e-01   +6.849678113621037e-01; +7.470877306538538e-01   +4.204262688737451e-02   +8.589114169370838e-01   +9.975902705178366e-01   +9.799429646201473e-01   +4.127321596233904e-01   +3.054221439191189e-01   +4.146643400428117e-01; +8.551012605519601e-01   +2.695386022481598e-01   +1.371739000360061e-01   +4.106748863101907e-01   +1.408900852697323e-01   +2.640085779487349e-01   +3.800712076553497e-01   +5.152631392199518e-01; +1.438888582242248e-01   +6.739262132476463e-01   +5.818146555090600e-01   +4.480343689367893e-01   +2.714441068862889e-01   +8.543572856058756e-01   +7.952279036940882e-01   +8.130574896700266e-01; +7.387162095963453e-01   +1.425993226382078e-01   +6.267441854534933e-02   +2.429826736014309e-01   +2.259635128425481e-01   +4.803850422666887e-01   +7.809385018398362e-01   +5.412635015649467e-01; +1.468958053161549e-02   +7.732289332808219e-01   +9.526731462272090e-01   +5.956931420999289e-01   +7.938898755460039e-01   +3.332195880836663e-01   +6.436686624763792e-01   +5.914323712232309e-01; +2.302291226026811e-01   +2.670651719179083e-01   +4.987635982943152e-01   +7.499584526829560e-02   +8.176213786896481e-01   +6.297337999717076e-01   +2.410814986643532e-01   +5.382510665561069e-01; +5.379716239780890e-01   +8.814760290446609e-01   +2.476639802459147e-02   +9.107501463841812e-01   +8.036779597618492e-01   +4.164996496576172e-01   +6.042835744716584e-01   +5.438489859513360e-01; +7.115778981356627e-01   +3.621283764735490e-01   +5.498272636155749e-02   +4.747688681709170e-01   +1.186840169651856e-01   +5.421631606481039e-01   +4.185645500094851e-01   +1.523865429233088e-01; +4.352177394597561e-01   +1.495775716429033e-02   +3.080954455060435e-01   +5.029356214302031e-01   +6.424180229176057e-01   +3.383825755783308e-01   +2.992012747413391e-01   +6.971383417828483e-01];
L3I_L3E_iAMPA_netcon = [+6.033548304928654e-02   +7.770928117572398e-01   +5.563854766235354e-01   +5.668281085346681e-01   +9.131570927349614e-01   +8.345718834620738e-01   +8.503326306911855e-01   +8.632178846747178e-01   +5.291087255543770e-01   +9.926502214032231e-01   +4.806197077193656e-01   +3.522408325752978e-01; +9.204389566030083e-01   +8.322377992979201e-01   +8.491153406979629e-01   +9.351593991743560e-01   +5.899185617564200e-01   +4.015244614774918e-01   +6.270636227456233e-01   +8.534348001769707e-01   +5.701793796969892e-01   +6.991246879126537e-01   +7.401672711444760e-01   +3.961609866090326e-01; +1.836365811245463e-01   +5.945616669806658e-01   +9.699943469171044e-01   +7.760659334356128e-01   +5.757577548806386e-01   +6.827592624850155e-02   +4.413840382754939e-01   +9.473301640336080e-01   +9.789675581510459e-01   +8.369620497837612e-01   +5.921850433718419e-01   +9.932157271680573e-01; +5.339066445244318e-01   +7.583030098714504e-01   +4.685017512570752e-01   +5.983910442271039e-01   +6.525225874609473e-01   +3.778554612675349e-01   +2.270785426001858e-01   +6.959884487013472e-01   +9.592721103858154e-01   +7.309608160035205e-01   +2.543708473585967e-01   +2.902318528064126e-01; +4.000945549291545e-01   +6.596309090115083e-01   +7.743913419109516e-01   +6.514700387681584e-02   +4.314764683783960e-01   +8.603290355198936e-01   +5.003337482464953e-02   +3.596181570677711e-01   +5.554145475057178e-01   +9.989235223016431e-01   +6.113040277664410e-01   +2.354747551914098e-01; +9.635812055220277e-03   +5.848444327847586e-01   +2.403181007812996e-02   +5.319893057416613e-01   +9.396513915396348e-01   +3.057503100326433e-02   +7.046999554893595e-01   +3.816544611948592e-01   +5.204577883386817e-01   +5.049986980759400e-01   +2.298792556488826e-01   +3.294670689338366e-01; +1.067699471890991e-01   +2.387754883173297e-02   +6.773084748480321e-01   +8.594101406257622e-01   +1.020046644190623e-01   +4.237801906710821e-01   +8.492740044818241e-01   +8.527445010191523e-01   +4.724774253951132e-01   +1.934906243076245e-01   +1.926879441911999e-01   +1.673491916458687e-01; +8.544991122157422e-01   +6.861702685029105e-01   +8.393517348734014e-01   +3.408144776420683e-01   +4.106622193273890e-01   +2.482142364536778e-01   +4.019194043236955e-01   +3.859012776006281e-01   +8.939251255885731e-01   +9.505523385001857e-01   +5.282454257243377e-03   +3.848910102478140e-01; +3.358495712097509e-01   +3.221171921049952e-01   +6.901945587335502e-01   +1.799160118777327e-01   +8.940792358501579e-01   +7.108239503826383e-02   +2.890538243718973e-01   +7.721851784932525e-01   +4.816104568368788e-01   +4.524342691681214e-01   +6.521128052338789e-01   +5.270147665281308e-01; +1.446803897673063e-01   +8.701369481600738e-02   +8.990916673301849e-01   +8.829816913329078e-01   +7.366606442774329e-01   +9.184463218090263e-01   +2.566629963276016e-01   +7.784288719609860e-01   +4.907199766310536e-01   +6.011103724822606e-01   +4.013895572841160e-01   +5.931922336711586e-01; +7.969364226361253e-01   +7.480690459307576e-01   +8.983803394967854e-02   +8.442222114370570e-01   +9.577823372206371e-01   +2.665001452487558e-01   +5.118710398793292e-01   +4.263105672805426e-01   +3.105738951052872e-01   +6.441685177473131e-01   +2.706400894474307e-01   +1.656825396287622e-01; +6.534897223213922e-01   +9.679664500037597e-01   +7.870562464486254e-02   +8.262756964314719e-01   +9.755150067536157e-01   +1.088844900263372e-01   +1.199522053148054e-01   +4.896093293989555e-01   +8.564359185560422e-01   +7.564567215326745e-01   +6.790721436111206e-03   +6.242273299066463e-02];
L3E_L3I_iGABA_netcon = [+4.437735079974969e-01   +6.095890661454298e-02   +6.291721296219461e-03   +4.985553285496267e-01   +5.402254276382253e-01   +2.505537902392593e-01   +7.194404834304844e-01   +7.589386495910760e-01   +3.806473283788905e-01   +4.485762418250440e-01   +2.014709159449637e-01   +6.567119970388174e-01; +6.078607202855308e-02   +8.066026010165314e-01   +1.287171019657664e-01   +1.938821660546867e-01   +2.188057960958605e-01   +3.373247278803514e-01   +2.230858762025757e-01   +8.868090357129979e-01   +6.087458801030646e-01   +3.929963685333984e-01   +8.290413191870992e-01   +9.034150721478598e-01; +6.254615135111072e-01   +9.132675313751205e-01   +3.108825531175640e-01   +6.445652654278408e-01   +2.675406946117429e-01   +6.020332616618248e-01   +4.963435407692299e-01   +7.299648545554468e-01   +1.607652627582047e-01   +6.738374035635252e-01   +4.400220291961150e-01   +8.369319424815879e-01; +8.090208453179747e-01   +4.241147073498256e-01   +2.378037663335479e-01   +2.545836990549499e-01   +1.346289881201089e-01   +4.796365139676876e-01   +4.762824338879392e-01   +6.899816289166104e-01   +1.030714981265470e-01   +3.288292718008554e-02   +4.257257540095842e-02   +1.664599929333219e-01; +4.039801807159313e-01   +1.881595178618964e-01   +6.521169405208869e-01   +9.404623037885724e-01   +1.274720768382429e-02   +8.999752046447870e-01   +4.343452822034771e-01   +6.483194733428546e-01   +6.160450833193910e-01   +7.816925538956809e-01   +7.641972458091942e-01   +1.627989600836796e-01; +8.886847351343899e-01   +1.855934818718480e-01   +8.065365473594984e-01   +2.892471306686177e-01   +1.488060048973473e-02   +2.865839895420020e-01   +5.580169524452081e-01   +6.193998039013981e-01   +9.592694223467026e-01   +3.740006281674829e-01   +9.317269953785073e-02   +1.364099362749057e-01; +7.210306356282580e-01   +6.699512264974304e-01   +7.359233631957840e-01   +1.453824688896348e-01   +9.890568191168054e-01   +7.707794815290427e-02   +2.048625119590420e-01   +7.675992125100756e-02   +6.686651732850488e-01   +6.382503418447051e-01   +6.537269326731737e-01   +1.539213164133656e-01; +2.022352048920824e-01   +5.243635021792361e-01   +1.209374737513546e-01   +8.673968947802526e-01   +6.472576616516301e-01   +3.844311401757327e-01   +2.778180063247578e-01   +5.460305059699219e-01   +4.708824471409989e-01   +4.922094404811231e-01   +2.655513052017434e-01   +3.975630465001246e-01; +3.732403913493909e-01   +7.793581342853064e-01   +1.751234719155459e-01   +8.853880272370918e-01   +8.085697658633642e-01   +1.841062317915972e-01   +8.048024983539430e-01   +8.777234053746237e-01   +3.341088337484085e-01   +2.271699333056665e-01   +4.383838665353503e-01   +6.578151573359288e-01; +2.122512347961412e-01   +3.024466452885372e-01   +2.640338092900383e-01   +6.572642598137740e-01   +2.803409234362187e-01   +7.287778289935931e-01   +9.975858990425163e-02   +9.847287637252614e-01   +5.875764040103902e-01   +2.129258574195508e-01   +8.477576680453640e-01   +2.209495593475303e-01; +2.589803726788590e-01   +4.704367684491843e-01   +8.177062172906662e-01   +9.973324914330979e-01   +1.290016447972473e-02   +4.262026905085144e-01   +3.804467590276417e-02   +6.848185845930813e-02   +5.478149200992726e-01   +4.522534470482784e-01   +9.049457068673670e-01   +6.410029257788644e-01; +9.939450760059377e-01   +7.086621551631813e-01   +5.897227763781100e-01   +2.621348348421709e-01   +1.021722853505848e-01   +2.654918209393414e-01   +7.115603230470992e-02   +2.887646106741786e-02   +4.226514401785204e-02   +6.281561668369696e-01   +2.832068816397681e-01   +6.111094900751550e-01];
L2E_Input1_iAMPA_netcon = [+9.971452899911450e-01   +9.975152521854542e-01   +9.996520997205998e-01   +9.928078644041800e-01   +9.929403600134394e-01   +9.993607917749172e-01   +9.908541872333996e-01   +9.967875375586664e-01];
L2I_Input2_iAMPA_netcon = [+9.982509419988000e-01   +9.963979813022605e-01   +9.953756050748783e-01   +9.945249923427179e-01   +9.963380504338107e-01   +9.934305193040254e-01   +9.976205306655782e-01   +9.999449047273096e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
