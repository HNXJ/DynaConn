function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.325274496284159e-01   +3.815756398053305e-01   +5.652319055964327e-01   -4.469426674849904e-02   +1.883961580974595e-01   +7.228146248009069e-01   +5.018927754739123e-01   -8.073869332137339e-02   -8.426615152679709e-02   +1.224616729820530e-01   +4.779866622223554e-01   +3.000710014855753e-01   +5.976315664259346e-01   +3.199189064998984e-01   +5.301350099414990e-01   +3.897658535712698e-01; +4.309721304232865e-01   +1.510395184647183e-01   +3.391002798739198e-01   +4.669380045426086e-01   +5.381641974326143e-01   +1.865364094629315e-01   +3.064870139909913e-01   +2.316826807861453e-01   -1.596722255518715e-01   +4.285787348712711e-01   +4.383797471737480e-01   +4.997167156286039e-01   +7.245816459341046e-01   +2.654230153676648e-01   +6.243191685919092e-01   +4.122348538911793e-01; +1.137503274486847e-01   +2.624210401290442e-01   +4.732175924444926e-01   +7.095918535770585e-01   +5.371281980943060e-01   +2.526482449435060e-01   +2.767484674809080e-01   +3.158160409636709e-01   +3.128214058550298e-02   -9.633324459596004e-02   +4.681770040914444e-01   +6.981326897189645e-01   -2.099305531849444e-01   +2.089933254929799e-01   +4.999403652876853e-01   +2.467662714941247e-01; +2.781689709251951e-01   +5.637998475916230e-01   +5.523370355014972e-01   +7.855530412493459e-01   +5.573300104069457e-02   +6.081829717715531e-01   +7.171397755971478e-01   +3.860780213559320e-01   +6.015723824296803e-01   +4.717279382844517e-01   -1.735498001591112e-01   +3.949210871365282e-01   +5.004509844526495e-01   +4.403604536880499e-01   -1.462433251545712e-01   +9.476075554842606e-02; +7.090504699773342e-02   +3.907623694117927e-01   +7.935413033841091e-02   +3.980967123451664e-01   +1.265975129626631e-01   +2.129718188202624e-01   +3.616275833571914e-01   +5.027274122332488e-01   +6.753769929588245e-01   +1.872732876630482e-01   +7.356000821116895e-01   +3.793503602508387e-01   -1.130739976800953e-01   +6.090455920519968e-01   +3.384581512062468e-01   +7.159971222934225e-02; +6.338301552358556e-01   +7.946721253373452e-01   +5.142078844261692e-01   +2.861914926413424e-01   +7.109109780679818e-02   +5.582850261803174e-01   +4.481960748932919e-01   +3.420467223316874e-01   +9.380395696799171e-02   +6.585939684570161e-01   +3.131583356441406e-01   +5.509790639728593e-01   +5.214033254521111e-01   +5.391352237560547e-01   +6.753091282639794e-01   +7.736256529179622e-02; +6.279280321443484e-01   +4.721923096472604e-01   +5.645047136402930e-01   +2.847527272117970e-01   +3.811568082394567e-01   +3.577760990065648e-01   +2.841309758869169e-01   +5.416453612133700e-02   +1.892436926780705e-01   -2.887364786701162e-02   +9.872534292103841e-02   +5.730333326113277e-01   +4.131542301172815e-01   +3.273439555398309e-01   +4.921059859165958e-01   +1.423787908861612e-01; +3.133071251050548e-01   +3.139537121450838e-01   +2.712658426501817e-02   +1.645606651265241e-01   +5.524180472031882e-01   +1.265829516092593e-01   +3.985905354854332e-01   +4.463500998772582e-01   +2.241991886069361e-01   +2.447710774811795e-01   +1.868210971979078e-01   +2.713893801014930e-01   -3.081450452029580e-02   +5.197762513542247e-01   -1.347885068685942e-02   +3.853552304468358e-02; +4.993053406899092e-01   +3.120826081223639e-01   +6.284429740573616e-01   +2.736985359664326e-01   +6.336820962103846e-01   +4.525880525312334e-01   -3.960570632109590e-02   +9.197665128701149e-02   +3.083027851596092e-01   +1.753325242623633e-01   +5.250871084783774e-01   +4.899517589467636e-01   +4.583683385272926e-01   +5.904490620432039e-01   +2.546731504391496e-01   +3.702968433713106e-01; -4.137849440346412e-02   +5.736189762833226e-01   +3.635533150408116e-01   +2.014585249837993e-01   +4.151436042812816e-01   +7.957392330087552e-01   +6.087460462270596e-01   +2.430192021595304e-01   +4.665122289297782e-01   +2.876970224531998e-02   +3.210863296570752e-01   +5.735719951532285e-01   +2.325993085290083e-01   +1.022003973473612e-01   +3.345447549200426e-01   +1.324775171562939e-01; +5.538142578253100e-02   -1.596102850724110e-01   +5.578056994513815e-01   +5.078564792590654e-01   +2.955640812794048e-01   +4.127278302851142e-01   +7.198983950524310e-01   +1.962522283974844e-01   +8.955553952699471e-01   +1.174160899801148e-01   +4.393184380717680e-01   +3.323710620948170e-01   +1.397502922806950e-01   -1.531398418963849e-01   +5.811947703539008e-01   +6.686158786238525e-02; +1.941676100208099e-01   -1.132058864296347e-01   +1.875747329604888e-01   +3.781959000522204e-01   +1.822585780040401e-01   +5.185475731415286e-01   +3.106799980205904e-01   +7.246980223583449e-01   +5.311747479947269e-01   +3.545778173593607e-01   +1.687405553888879e-01   +5.561056096062093e-01   +4.222361100275738e-01   +1.919395171458325e-01   +6.167349481957746e-01   +7.287662685479916e-01; +6.196795663868512e-02   +5.663866254898815e-02   +4.405523758423850e-01   +2.117444085817339e-01   -6.072050648930100e-02   +5.809594745434155e-01   +3.692681837583640e-01   +3.221694815011484e-01   +7.397548083288688e-01   +6.393081801167048e-01   +3.178146288593497e-01   +7.247124413165240e-01   +4.667808670674951e-01   +6.477136364015601e-01   +9.563131860485168e-01   +4.152131742526799e-01; +1.809340261724822e-03   +6.387471835792926e-01   +5.847821528591870e-01   +4.264345671502844e-02   +7.580415132089771e-02   +5.033073671736138e-01   +5.535966746412295e-01   +3.881099946988563e-01   +3.422574666396894e-01   +5.439134475773653e-01   +5.343048357975196e-01   +3.887402937490989e-01   +6.130863580222069e-01   +4.623312801163051e-01   +4.957248591082043e-02   +3.726423356172782e-01; +9.879577058612162e-03   +2.733371477907817e-01   +6.652557647509230e-01   +1.765693165165052e-01   +1.917330090207010e-01   +7.065648937142874e-02   +6.144285600470791e-01   +4.828809064874404e-01   +1.327641030864660e-01   +4.704724909221131e-01   +1.257816729166640e-01   +4.987314517282081e-02   +1.947608510143942e-01   -5.015109590737878e-02   +4.781015940298472e-01   +1.968185346582104e-01; +3.160781227205928e-01   +3.399655948500750e-01   +4.810172459575909e-01   +6.481589200238288e-01   +5.410494615966526e-01   +3.299448228052546e-01   +9.403438833791034e-02   +5.410563604960033e-01   +2.083132993353481e-01   +5.647498643083052e-01   -7.836492011712627e-02   +4.071469763945623e-01   +3.957399388806607e-01   +5.070703542627216e-01   +6.639564282577209e-01   +6.103819617013186e-01];
L1E_L1I_iGABA_netcon = [+5.695474347373417e-01   +1.586935153578022e-01   +1.869644383661585e-01   +4.295953610833235e-01   +4.781099644531369e-01   +1.830705666676540e-01   +1.117795431986975e-01   +4.519447095344072e-01   +5.255461295184849e-01   +8.249543654477755e-02   +6.886786581641818e-01   +4.784561851718384e-01   +1.600549870439956e-01   +6.603122792055793e-01   +4.546078902060711e-01   +2.616878826106258e-01; +4.128870199362056e-01   +2.190109406714731e-01   +7.054795050394778e-01   +5.218786305412813e-01   +2.544805579806961e-01   +8.478168348751337e-02   +5.403922443002712e-01   +2.383984321414279e-01   +3.023368704196827e-01   +2.893003674887351e-01   +1.218764134610735e-03   +4.224115587887587e-01   +1.115657885379204e-01   -7.269717762129080e-02   +4.615809503254840e-01   +2.440517462585871e-01; +4.174331698061828e-01   +1.063100952580477e-01   +2.960229981812978e-01   +4.728624389301339e-01   +2.458757384533685e-01   +3.535198504993845e-01   +2.857229785019921e-01   +5.334814095958655e-01   +3.792652011411251e-01   +2.729615897336892e-01   +2.275883323347860e-01   +4.290393240794735e-01   +6.373116278569478e-01   +3.855335021010460e-01   -7.342833135732474e-02   +5.715890826458043e-01; -6.248596262886896e-02   +5.623733693058200e-01   +6.122354484527729e-01   +8.913586816706549e-02   +4.227797727902553e-01   +6.442490914424387e-01   +8.592180377507745e-02   +3.018520917595468e-01   +4.055597474428058e-02   -3.136977803609428e-03   +9.449915090760223e-02   +2.317490005980258e-01   -1.317399151203927e-01   +4.562310102347376e-01   +1.547148237315542e-01   +3.684160527722453e-01; +1.767966747332116e-01   -3.855224878051280e-02   +1.648410789537595e-01   +3.541340750427989e-01   +1.745962440343593e-01   +5.571975324816991e-01   -1.460662796117617e-01   -1.931339486689307e-01   +8.512871378824412e-02   +2.862671836076640e-01   +2.864266319508610e-01   +8.098397523394698e-01   +3.060901641439301e-01   -4.613270092103691e-02   +5.837589174554519e-01   +1.000000000000000e+00; +5.278660607730612e-01   -1.552845512935522e-02   +1.639719665276038e-01   +4.776131205300532e-01   -1.074900511756604e-01   +3.765043604618736e-01   +2.146711681717936e-01   +8.374150536707261e-01   +2.197414654080071e-01   +8.256963498571208e-01   +7.024367461533571e-01   +6.216151216812781e-01   +3.241614455717797e-01   +2.132697688527579e-01   +9.934991276437327e-02   +2.968832518642612e-01; +5.675051260371803e-01   +1.338260510270878e-01   -1.281946639833820e-01   +1.149960308616789e-01   +5.453637041414718e-01   +4.150811598432049e-01   +6.060787012325671e-01   +1.302113194279470e-01   +4.753733784508409e-01   +6.520420075661847e-01   -9.284037980567382e-02   +6.816700051873555e-01   +7.208307302448848e-02   +5.638905605312682e-01   +8.308626084124675e-02   +6.997636751731508e-02; +5.087058234550554e-01   -1.511099738571056e-02   +7.015560829220892e-01   +8.771348882824499e-01   -6.266490716600773e-02   +4.223936407777699e-01   +2.346740169428856e-01   +6.091862015500920e-01   +4.197474134237540e-01   +1.763010840126349e-01   +3.700737940014311e-02   +6.415933175839634e-01   +4.564458213823354e-01   +1.941257590963228e-03   -3.776713265108032e-01   +3.606156628405132e-01; +9.380665506797248e-02   +5.782911346954496e-01   +3.307621466114336e-01   +2.669814047704795e-02   +6.593428124958114e-01   +3.459960591499096e-01   +3.367311593021318e-01   +3.463823451950837e-01   +4.905985376124292e-02   +5.963987777282743e-01   -6.162701076027593e-02   +4.253252536294074e-01   +4.169601528326457e-02   +2.978462060856280e-01   -1.279802610392877e-01   +1.855426010350099e-01; +3.363929144450069e-01   +3.731305087758358e-01   -1.684541346206291e-01   +1.055115719220678e-01   +6.211397725291424e-01   -2.213265624460992e-01   +4.020640487702439e-01   +9.046078610191787e-01   +2.290510189399349e-01   +4.878496628251570e-01   +1.022401975016065e-01   +4.281906568468522e-01   +3.175505756942072e-01   +1.951408418954675e-01   +3.987411762371545e-01   +6.218462975460087e-01; +6.530453460963933e-01   +3.229954294520640e-01   +6.188266225270146e-01   +4.465564506862358e-01   +4.423670468892510e-01   +1.890169219686346e-01   -2.357548630756178e-02   +1.190798694968440e-01   +6.346257701546787e-01   -1.027189900615263e-01   +3.945581668254111e-01   +6.436699968315246e-01   -7.968842009215750e-02   +6.155114752248820e-01   +4.561580820676061e-02   +3.108333349886569e-01; +1.145482694673165e-02   +3.401918274234954e-01   +1.771177862470587e-01   +7.603301869594886e-01   -1.727549269990782e-01   +3.481293807730625e-01   +8.087794776641145e-02   +3.298282545243829e-01   +7.774330991507278e-01   +3.468436395007154e-01   +6.617774992695826e-01   +8.147783994817741e-01   +1.503190438102806e-01   +4.624757379021406e-01   +2.576192537286965e-01   +9.470254666137466e-02; +1.344252176965202e-03   +4.776724726274321e-01   -8.170352995204133e-02   +7.153118269525803e-01   +9.467744486940453e-02   +4.195400730129881e-01   +3.626376606575403e-01   +4.438674461269662e-01   +4.288959563783364e-01   +7.014067775471343e-01   +1.684181425423066e-01   +1.342259155740518e-01   +1.777582825460246e-01   +1.129519345733381e-01   +8.281926774191783e-02   +4.786272278149725e-01; +6.885306215117720e-01   -2.472688338984981e-02   +5.924844292777011e-01   +5.469645290563516e-01   +4.438284203571287e-01   +1.228246278443690e-01   +4.456021723545473e-01   -2.843198590866422e-02   +6.478374825571300e-01   -6.269411963946908e-02   +4.851974989996943e-01   +6.965611927471909e-01   +3.984262356753520e-01   +3.695388163456096e-01   -2.340034996613996e-03   +3.033485479806739e-01; +1.040670220709989e-01   +2.809536391881312e-01   +1.492581456540900e-01   +1.158969941960106e-01   +4.697463447277041e-01   +2.467822301354564e-01   +6.313679847218764e-01   +6.047693131167823e-01   +8.068482310485700e-01   +5.152071205949786e-01   +3.707847755493014e-01   +3.820959446204542e-01   +2.023051173760308e-01   -1.930132981084558e-02   +2.910080688890490e-01   +1.054836958521932e-01; +5.932738663977956e-01   -4.639051824320069e-02   +7.299577787275926e-01   -4.623385076052109e-02   +3.892686646939621e-01   +5.813125189698518e-01   +4.923107054353629e-01   +1.099597772821601e-01   +5.410647438372058e-01   +7.543740542747565e-01   +5.416802284892847e-01   +1.317925894462175e-01   +5.478703738687776e-01   +7.632107146296305e-02   +2.225272307916501e-02   +7.420154210462955e-02];
L2I_L1I_iGABA_netcon = [+5.091477907126106e-02   +6.268028359082719e-01   +8.690033592775547e-01   +2.293525477679106e-03   +5.734682666274880e-01   +1.984055250921264e-01   +3.436074331615052e-01   +4.396560258161822e-01; +1.711060493381864e-01   +5.083367784251454e-01   +4.636311588801317e-01   +1.660130485753786e-01   +6.039225811130623e-01   +1.051359609493291e-01   +5.442030525263200e-01   +8.949888117460643e-01; +3.143837439910055e-01   +3.346934860596960e-01   +5.691446709322001e-01   +7.680408069263014e-01   +3.480281278937393e-01   +3.883258488200744e-01   +1.939844130421274e-01   -7.940825973123615e-03; +4.829426652903631e-01   +2.870711636198053e-01   +5.678400471297314e-01   +8.943555162431527e-01   +1.826856179778613e-01   -1.061490572876365e-02   +4.251114531994836e-01   -1.272330302790514e-01; +9.659869009206721e-01   +1.131702895107380e-01   +3.100573356209176e-01   -1.532151320383082e-01   +6.607664805921121e-01   +1.462545852432384e-01   +9.193939884972291e-01   -4.151924521507062e-02; +5.530336361564322e-01   +5.537222848044902e-01   +8.267839619973500e-01   +8.582496463787065e-01   +8.233720694273791e-01   +6.722689773774424e-01   +6.839894091720411e-01   +6.374382624771021e-01; +7.143724332679906e-01   +5.115254605047983e-01   +4.794294363706584e-01   +1.542731927681038e-01   +8.195252022664531e-01   +4.420873948425008e-01   -3.096419144436623e-01   +5.663784447469299e-01; +7.216527088169703e-01   +3.468746471953775e-01   -1.053607943068252e-01   +6.874188682670623e-01   +4.846889754628570e-01   +7.087304168568345e-01   +6.929279848984056e-01   +8.429869872535933e-02; -2.045641444991610e-02   +5.026439234285406e-01   +1.188642796162178e-01   +2.283801692228770e-01   +4.003291839785016e-01   +7.148562513231934e-01   +3.883598272710443e-01   +2.873509849987009e-01; +7.617093615145089e-01   +7.586563126303313e-01   +5.727899857477396e-01   +4.829420941733472e-01   +2.942121978136080e-01   +2.415203848712889e-01   +5.340547944127512e-01   +2.421379483888706e-01; +4.572814392086249e-01   -7.616492975120223e-02   +6.314932951363912e-01   +5.765741212303616e-01   -3.607892968852886e-02   +2.488883102275097e-01   +4.100649179097318e-01   +1.173341773341142e-01; +3.936865164481675e-01   -3.271824984980976e-02   +2.377194167055105e-01   +6.971124538229858e-01   +1.647349202400719e-01   +5.846779875768907e-01   +1.181403225584688e-01   +1.510487536338269e-02; +7.425861855004777e-01   +9.532123434131627e-01   +3.121929726909778e-01   +3.409535274553590e-01   +3.685208300910867e-01   +9.097433725036205e-02   +1.170021713749164e-01   +7.115525917934090e-01; +2.753622675214584e-01   +8.255126673021980e-01   +1.682428125996683e-01   -8.701113464292096e-02   +5.694102013466936e-01   +7.265961504252213e-01   +6.158825221133868e-01   +5.976849269576557e-01; +2.062813772941058e-01   +4.718079374815944e-01   +4.685240507280245e-01   +2.486678737417157e-01   +6.945910155495997e-01   +2.666520003715527e-01   -2.424426528657558e-01   +6.192835614672090e-01; -6.064570561963109e-02   +2.215503951277157e-01   -9.631739050427210e-02   +1.379631522195617e-01   +4.113072776693747e-01   +7.182072130239229e-01   +1.655062488252945e-01   +3.934771397776720e-01];
L1I_L2I_iGABA_netcon = [-1.548210729419630e-02   +6.682838621001016e-01   +2.532475264045755e-01   +1.411848647407775e-01   +9.455701530428752e-01   +8.025585397582721e-01   -2.537760687670620e-01   +6.542352297168731e-02   +3.833298256542574e-01   +4.560179383423915e-01   +6.021642522058511e-01   +5.589408336839957e-01   -2.527277580716466e-01   +5.593020495062709e-01   +2.911773708253135e-01   +7.191575611745130e-01; +4.431417796605722e-01   +6.405650764526092e-01   +5.025607593757665e-01   -6.210069287654264e-02   +4.337269348915263e-02   +6.147572024528989e-02   +3.454076709155406e-01   -1.095274256818164e-01   +1.474646593016841e-01   -4.932985726364858e-02   +1.945043960238607e-01   +1.412718001388049e-01   +6.700833222603677e-01   +4.601683515207732e-01   +1.000000000000000e+00   -5.509893761207484e-02; +3.715099928740010e-01   +4.450626808059431e-01   +8.271254825794261e-01   +1.607573233736816e-01   +1.702996835428233e-01   +7.667945786835194e-02   +7.418686738089826e-01   +2.746165095521416e-01   -2.075716754289193e-01   +8.776465577165984e-01   +1.032373381831906e-01   +3.823995731283700e-01   +4.750828938707059e-01   +5.105925875701312e-01   +2.407255745211632e-01   +2.088700038781158e-01; +5.580907376131484e-01   +3.881567418688344e-01   +2.641022756572513e-01   +3.040298234651403e-01   +7.864399017517522e-01   +3.394952467540414e-01   +2.722172918346115e-01   +1.815116603353846e-01   +4.698634889820193e-01   +3.814670694543196e-01   +1.634603808861357e-01   +2.399014947110088e-01   +1.619703246995247e-01   -1.170720430768115e-01   -1.765790707627673e-01   +3.567133091791087e-01; +5.763576748923434e-01   +5.452558889196470e-01   -3.004203422529689e-01   +7.631534260108805e-01   +3.990440383280306e-01   +3.911801233586696e-01   +3.963164746985768e-01   -5.083352741064373e-02   +6.394854267384913e-01   +5.031439376892701e-01   +7.481395813345907e-01   +7.820908991207070e-01   +6.206937910703131e-01   -1.595098302820324e-01   +5.379895098840806e-01   +5.128705032605916e-01; +3.806275178118280e-01   +7.931740058931654e-02   +4.590107572176394e-01   +1.100933276847728e-01   +1.206806104399786e-01   +2.765926287895287e-01   +5.008646676629244e-01   +5.331712378159670e-01   +5.245548889264144e-01   +5.878650918251265e-01   +6.284294184580848e-01   +5.323859959722916e-01   +5.633148406724990e-01   +1.012891568038250e-01   +4.194972300483753e-01   +5.301609087333571e-01; +3.135460319768399e-01   +1.142250718996826e-01   +2.528269728337063e-01   +3.931068162944358e-01   +5.798877417582325e-01   +4.556474524340099e-01   +1.657080099703495e-01   +1.958303998923934e-01   +1.269729176418243e-01   +3.068501621657701e-01   +2.019013898283585e-01   -1.169211219196308e-02   +2.641207929851673e-01   +3.110203391880939e-01   +5.508219356690495e-01   +2.187278524380849e-02; +4.076316589482396e-01   +8.952574137127945e-01   +4.091039637164149e-01   +6.239156563492851e-02   +4.811633772285854e-01   +2.813777541912155e-01   +3.482397904519578e-02   +3.301843592364684e-01   +3.760806036097252e-01   +3.698228587777027e-01   +2.044320342460091e-01   +8.671619585091630e-01   +5.976354194853390e-01   +5.024771037182705e-01   +1.685002615611222e-01   +4.170327575682919e-01];
L2E_L1E_iAMPA_netcon = [+2.332140474290847e-01   +4.799245128580185e-01   +5.817280727815167e-01   +2.128809887129323e-01   +4.501386192580434e-01   +7.674027632917064e-01   +2.329106337616660e-01   -8.162160720090275e-02; +7.648953690714583e-02   +2.159036867348173e-01   +1.034521138500237e-01   -3.086922681462087e-02   +3.179607905365566e-01   +1.477868228234992e-01   +5.915648601446482e-01   +1.394059089934570e-01; -6.881164046079619e-02   +1.618861249236274e-01   +7.778527492614901e-01   +5.590157569092168e-01   +1.688017667745237e-01   +5.321337887965807e-01   -3.576333793694149e-02   +6.492185210599440e-01; -1.838072723488254e-01   +4.694617245713397e-01   +8.339216576955127e-01   +2.508642794646138e-01   +2.425384600569816e-01   +4.162369012342023e-01   -1.267999215028029e-02   +4.004554988816263e-02; +7.091323494813097e-01   +1.981614361322496e-01   +2.354556856886915e-01   +7.206333499117390e-01   +1.561563824922868e-01   +6.927789278672830e-01   +5.695728559668110e-01   +6.586251896930593e-01; +7.150168461689820e-01   +7.823819756178101e-02   +5.499731065965089e-01   +5.681749458549405e-01   +4.681798706008801e-01   +7.583317897835782e-01   +8.110211678760856e-01   +7.065056572260949e-01; +5.414661852322962e-01   +4.659067936524889e-01   +7.450959174005662e-01   +2.347862810340326e-01   +1.382709168550459e-01   -2.007643833062626e-01   +3.594006652910346e-01   +8.151996363971524e-01; +5.101125136617083e-01   +7.878357518499686e-01   +6.311864423268062e-01   +4.561830343033753e-01   +3.426849286085908e-01   +8.571021121104975e-01   +5.995621056335630e-01   +6.108595991806844e-01; +6.636608537658144e-02   +3.001679061064391e-01   +5.058594178853071e-01   +4.149239850832763e-01   -1.792959671092944e-01   +3.896913341950244e-01   +4.439877118651893e-01   +6.235605849156758e-01; +2.545374103120608e-01   +2.126505283959442e-01   +4.092441295811022e-01   +3.302213396662987e-01   +3.543656149400124e-01   +3.443206690371075e-01   +4.101077164031502e-01   +4.428577598773881e-01; +4.955366737049500e-01   +9.337465909116294e-01   +4.976447142361346e-01   -5.855937480783704e-02   +3.576395631903019e-01   +8.109035708681820e-01   -1.633747073668954e-01   -2.030312552129258e-01; -5.432601612639365e-02   +3.823049211157071e-01   +6.487490175662910e-01   -3.356296075405213e-02   +2.067387231881275e-01   -1.011691257680289e-01   +6.991082973008844e-01   +3.014180482661786e-01; +6.340317956303895e-02   +4.615122123316519e-01   +9.334242061498754e-01   -1.629464101362086e-01   +4.458385193967638e-01   +3.559562315195429e-01   -1.835979946960369e-01   +6.708817757981904e-01; +7.158899351855900e-02   -2.840941027021470e-01   +1.579886861916546e-01   +3.667040171643562e-01   +5.400505566422231e-01   +7.194537795988060e-01   -1.869987035762474e-02   +1.803880704721644e-01; +4.333553450517693e-01   +5.596388512993471e-01   +1.780339038465475e-01   +2.870448538942655e-01   +4.298505408854650e-01   +2.611183647269276e-01   +4.424404109197919e-01   +4.417454962332402e-01; +4.504343162902461e-01   +6.437092005738571e-01   +2.413987003888068e-01   +1.346633262501265e-01   -5.675976884670308e-03   +3.794806823529152e-01   +2.799769188652356e-01   +2.521908957417311e-01];
L1E_L2E_iAMPA_netcon = [+5.990842819521583e-01   +3.951283651055625e-01   +2.239196856983446e-01   +7.653682620025780e-01   +8.396837571529489e-01   -1.477652269690613e-01   +4.046371183768054e-01   +7.653303276982673e-01   +2.204109339878607e-01   +3.552017452779192e-01   +4.453747360684816e-01   +9.950935095595296e-01   -1.147971876570309e-01   -1.068291521814892e-02   +9.564025883766823e-01   +7.407791815099729e-02; +2.354437764487906e-01   +1.034943155082801e-01   +4.759049805644822e-01   +4.981491855698209e-01   +2.129368128100025e-01   -1.935226393991279e-02   +3.441266305611770e-01   +3.919818861766855e-02   +5.404057254496886e-01   +9.494868231279054e-01   +5.920172012674579e-01   +2.777306127879785e-01   +8.250208909065100e-01   +8.306740529769752e-01   +4.408967057148426e-01   +5.392122076254755e-01; +2.605545421785370e-01   +8.972786964538918e-01   +2.024309773554729e-01   +8.393037590300637e-02   +5.730768702854715e-01   -8.836022176072120e-02   +6.836200492524740e-01   +6.095564728327204e-01   +4.907256688749234e-01   +1.813204836584816e-01   +7.435850084640522e-01   +2.714059625326561e-01   +5.070988011492882e-01   +3.176142933211932e-01   +7.750609482499474e-02   +4.323065150879819e-01; +7.589484573174914e-01   +1.733338685958270e-01   +2.810559530887589e-01   +2.843968872027165e-01   +2.080835019621340e-01   +1.535253741895112e-01   -3.908096239857724e-03   -4.506158834678108e-03   +8.386686666637233e-01   +3.792139778104839e-01   +4.222654932968425e-01   +3.272362110060534e-01   +2.601401087454380e-01   +6.279210417422320e-01   +6.739261125453901e-01   +3.436990655084501e-01; +4.786827880841134e-01   +1.717962166201957e-01   +2.330149896199931e-01   +3.838260126403812e-01   +3.458474825655284e-01   +7.839766666705100e-01   +9.211181995611546e-02   +4.351584652932610e-01   +3.350799100924342e-01   +1.911836422506390e-01   +3.395816514945398e-01   +1.966405962142497e-02   -2.994229098650290e-03   +7.267309928920568e-01   -3.673069084833931e-01   +6.356609989817670e-01; +8.101342260028450e-01   +2.310951404333444e-02   +3.844317927985614e-01   +4.619113085860265e-01   +3.465386331706332e-02   +1.692938726071482e-01   +4.269122803717548e-01   +1.850881576163435e-01   +5.663272729671244e-01   +1.685539742858007e-01   +3.517572203437474e-01   +6.728892628546952e-01   -1.619765052447132e-02   +4.328501266581249e-03   +2.315433847344020e-01   +5.807493261654667e-01; +3.752588284355404e-01   +1.372450397356230e-01   +3.545573242847918e-01   +2.072416718426288e-01   +9.863608359957853e-01   +4.346670551199252e-01   -1.896378994040666e-03   +5.592356104019858e-01   +3.773344228758772e-01   +8.295566955492270e-01   +5.208878647899550e-01   +2.127856373248437e-01   +1.246009040139241e-01   +2.382449628643962e-01   +4.938938068527363e-01   +5.548663324717502e-02; +3.674232331036202e-01   +4.752186989351025e-01   +9.027424972772903e-01   +6.876157788445299e-02   +8.040050882215789e-01   +1.810764267438612e-01   +3.165846049589420e-01   +2.103236535183186e-01   +2.355473476557523e-01   +5.844054628865204e-01   +4.773586071129388e-01   +2.265862128762415e-01   +8.397946598911905e-01   +6.189293001182193e-01   +4.554800289941231e-01   +2.926113540626692e-01];
L2I_L2E_iAMPA_netcon = [+3.920067270247085e-01   +9.421321117208797e-01   +3.376012709316489e-01   +5.712608920341615e-01   +8.295869532890516e-01   +6.089578493369334e-01   +7.729699138202141e-01   +2.477652218810500e-01; +8.928892742893048e-01   +7.359941942152791e-02   +3.112705172998587e-01   +1.569123405892940e-01   +7.025738678385615e-01   +2.420322077429731e-01   +3.630302704836090e-01   +7.415113916582071e-01; +7.756954980491937e-01   +3.279922887381148e-01   +7.610416945160439e-01   +4.433719709133840e-01   +4.141418308882007e-01   +4.818919045412502e-01   +9.993096309012926e-03   +7.979197216385052e-01; +3.694953304486700e-01   +7.393305174447647e-01   +2.862967782619703e-01   +3.517233508322585e-01   +4.616058657426119e-01   +1.548433881004426e-01   +1.629709711640600e-01   +4.681013237918433e-01; +4.407466149475335e-01   +4.422841318781079e-01   +8.022183372180808e-01   +3.907684986502874e-02   +6.624676583971273e-01   -1.935325694619902e-01   +1.138188027589655e-03   +3.582184397146023e-01; +1.367443475174324e-01   +8.035758297540388e-02   +4.898599678970976e-01   -4.475435177920252e-02   +5.766560518323465e-01   +5.169829464436260e-01   -8.178388797358040e-02   +3.687160265993294e-01; +4.166208842851443e-01   +1.121427261494363e-01   +5.320564379811586e-01   +5.838948264441342e-01   +1.889429270569266e-01   +1.255801951199623e-02   +3.657158604533035e-01   +6.964487580639731e-01; +5.400009175072944e-01   +6.131741127171678e-01   -2.128435998532947e-02   +6.238131843995525e-01   +1.446311637736020e-01   +7.001254574622643e-01   +2.180001054150924e-01   +5.971287478625323e-01];
L2E_L2I_iGABA_netcon = [+1.961983043508622e-01   +2.550701668922298e-01   -3.122141266739407e-01   +9.095482154011469e-01   +4.358622645718589e-01   +6.366786154911560e-01   +5.926858337176685e-01   +2.617736497032098e-01; +5.392674158429978e-01   +7.819203607269868e-01   +1.454578550521876e-01   +3.035148324959393e-01   +5.646565101267111e-01   +4.545101286119969e-01   +5.075827797530211e-02   +5.400041985016503e-01; +3.397067905167902e-01   -4.511678359788809e-02   +3.548498137755993e-01   +4.829044719603016e-01   +2.485663255200678e-01   +2.311634973594839e-01   +1.596424416589061e-01   +4.070641764668471e-01; -7.125720156138156e-02   +5.041571073737224e-01   -1.277357488369953e-01   +8.615679684213005e-01   +3.366582994158161e-01   +4.168681084549492e-01   +8.293777067349380e-01   +8.354622753790036e-01; +3.116503005328877e-01   +3.536221915936283e-01   +3.233915627750315e-01   +3.053431797651930e-01   -5.902600383294925e-02   +3.613654322456162e-01   +1.874633173357012e-01   -2.789159650481472e-01; +5.419722014845763e-01   +8.472120775133993e-01   +9.921468402510774e-01   +1.000000000000000e+00   +6.199209882935506e-01   +3.520204162840635e-01   +1.191552234613432e-01   +5.109894297964305e-01; +1.993385138890154e-01   +2.501384923554886e-01   +7.290142691885190e-02   -1.360256354246498e-01   +3.599967596039259e-01   -7.806879373064468e-02   +2.542200722315084e-01   +4.201403804119839e-01; -1.202876750410510e-01   +5.604463630047519e-01   +3.874952391036910e-01   +2.014056916472698e-01   +5.418444301646541e-01   +3.095949118371319e-01   +5.741244005419279e-01   +7.784951470898959e-01];
L3E_L2E_iAMPA_netcon = [+2.774708568651442e-01   +3.297019710902415e-01   +6.084369965244776e-01   +1.027568417148531e-01   +4.410557800269543e-02   +6.459528332491250e-01   +5.601823639335410e-01   +5.578930856678854e-01   +5.169727289985160e-01   -4.957879053283416e-02   +2.595812184421933e-01   -2.448286569332389e-02; -1.111696156972811e-01   +5.762173855919661e-01   -8.959519256220842e-02   +5.609411859101709e-02   +3.160233780696657e-01   -4.829880300141276e-02   +3.517315077441279e-01   +1.891859032467349e-01   +2.881852401302534e-01   +2.226494140918891e-01   -8.612324969068082e-02   +3.389159648030594e-01; +2.229485216321749e-01   +8.338105788546331e-02   +1.740991211638932e-01   +4.986849028657244e-01   +3.872897552863201e-01   +5.866652185634270e-01   +3.826372856006980e-01   +5.779853551359136e-01   +7.963818052587474e-03   +5.505189904778699e-01   +3.015860886085456e-01   +6.394619182751278e-01; +7.713324870516176e-01   +5.671043702444403e-01   +5.754813355652801e-01   +3.074159124693337e-01   +4.271444564699981e-01   +9.344483847286450e-01   +3.096319470467535e-01   +2.731291833990401e-01   +4.705267999937940e-01   -3.422035350869897e-01   +3.200899488248614e-01   +8.188471199292365e-01; +3.436289541890885e-01   +3.557455980620669e-01   +1.629138281865441e-01   +1.526271509423527e-01   +1.039125789751377e-01   +4.491083944866003e-01   +1.662079080172797e-01   +6.399826755410939e-01   +8.604363444420715e-01   +4.350795473510093e-01   +4.850657851767574e-01   +1.297482520874670e-01; +2.164248731375868e-01   +1.424347717728551e-01   +5.629813745528424e-01   -7.174105086695165e-02   +9.423927391758269e-02   +4.957292194224197e-01   +2.458848087012479e-01   +4.484091573841826e-01   +3.143861991822769e-01   +5.513744703440675e-01   +2.693978516265884e-01   -6.275041597908732e-03; +2.808094544823292e-02   +2.115928687347842e-01   +1.969915163823170e-01   +3.734304786091223e-01   +9.579834615471461e-01   +6.291050174875674e-01   +7.150867471056284e-01   +6.133604531135612e-01   +5.754866685649155e-01   +3.348608315146671e-01   +1.976738131752807e-01   +6.027315204134885e-01; +4.070221188752231e-01   +1.803713826060120e-02   +3.680994878673467e-01   +5.678505211229461e-01   +2.349439227758706e-01   +4.571906169144679e-01   +6.698607996605032e-01   +1.936472257984091e-01   +5.455115762423967e-01   +3.292238879211614e-01   +1.280034619203071e-01   +5.619112323825389e-02];
L3I_L2I_iGABA_netcon = [+5.678419582577570e-01   +7.370898953489100e-02   +1.971408751639261e-01   +5.972235095262298e-01   +4.211089485498781e-01   -7.133459728470438e-02   +2.418939483039680e-01   +5.221399166361169e-01   +1.830371326064057e-01   -1.374332103482515e-01   +7.920218528671602e-02   +6.289322982781451e-01; +6.605348763978268e-01   -1.610857382088680e-01   +1.493108734473043e-01   +4.938139421996126e-01   +6.971965335973326e-01   +3.553031728665855e-01   +3.654381988568566e-01   +5.454542778605408e-01   +1.360994184229443e-01   +3.712593154667744e-01   +2.320349371091347e-01   +4.284637890052616e-01; +5.020618318800003e-01   +7.762765076547121e-02   +5.101166647618973e-01   -1.177412187174749e-01   +4.680872538939030e-01   +1.304572481820801e-01   +4.395407348484642e-01   +3.318731649462146e-02   +3.021421417448562e-01   +4.558430254762984e-01   +2.671815364251605e-01   +9.273377495744504e-01; +4.026916202963465e-01   +3.252836474909844e-01   +6.544086695340634e-01   +7.999959939691133e-01   +3.188575768152714e-01   -1.602489044785432e-01   +6.137125225595541e-01   +2.886256468122507e-01   +7.219563995832251e-01   +1.319948074646091e-01   +1.408221461310737e-02   +4.061354481659367e-01; +3.683052326242626e-01   +3.457827100315667e-01   +4.539501775212900e-01   +1.208568234985203e-01   +4.127361550815211e-01   +6.070839260437293e-01   +4.803635898766704e-01   +2.168770359425136e-01   +3.578476552630075e-01   +3.897484231603486e-01   +7.307609016566859e-01   +6.788367571336776e-02; +5.060732228276424e-01   +2.262962024881199e-01   +6.250717675210714e-01   +8.024668774924847e-01   +7.503128378978077e-01   -6.322735647792513e-02   +1.115781660483544e-01   -1.369887011120874e-01   +2.647596585281497e-01   +1.058715809221392e-01   +1.637796252858391e-01   +1.786327096431237e-01; +4.401635612906548e-01   +5.274087264782772e-01   +7.257767350958849e-01   +8.511497881434979e-02   +2.577752454458566e-01   +4.328350677338185e-01   +2.268276985635760e-01   +5.632581271189495e-01   +1.277373761391391e-01   +8.552056258128812e-01   +3.297632865865249e-01   +7.143127932559288e-01; +2.829682772783031e-01   +5.133795257301901e-02   +3.843148721239147e-01   +3.444007012282174e-01   -1.657434197128222e-01   -2.975175477584575e-02   +2.664862120556875e-01   -9.958652637921939e-02   +5.300205574271536e-01   +4.988753465021299e-01   +3.054136718732905e-01   +3.182532000785356e-01];
L2E_L3E_iAMPA_netcon = [+1.797381360953710e-01   +8.986675969381206e-01   +5.111543838349424e-01   +6.871122420718262e-01   +3.106272459438922e-01   +4.678546057728859e-02   +6.636830302596475e-03   +3.249945034309288e-01; +3.349162461681002e-01   +5.191922268795091e-01   +4.373722149670271e-01   +2.752753785539285e-01   -6.919803356258750e-02   -1.500819267422161e-02   +3.521557352659176e-01   +3.293598032467127e-01; +1.692301199896000e-01   -6.516795453866980e-02   +7.402838775767380e-01   +7.946419618563557e-01   +5.360574999431783e-01   +3.299947376908443e-01   +2.733948254217925e-01   +4.619722882814243e-01; +2.093995961974916e-01   +3.583147666607799e-01   +1.653461477668652e-01   +6.592656164088248e-01   +4.219599661448485e-01   +5.961642295816223e-01   +3.935594745474311e-01   +2.561680263441526e-01; +4.364669746487567e-01   +6.992610204532965e-01   +6.534631048158858e-01   +9.616087716893651e-01   +5.233366932724332e-01   +2.516884812273584e-01   +9.812463832050342e-02   +1.000000000000000e+00; +8.539652116768124e-01   +6.330020131290680e-01   +2.298595321052778e-01   +8.582809227979732e-02   +4.601987111530426e-01   +5.091618901708937e-01   +5.161781544763263e-01   +5.576285707218722e-01; -2.271321345424042e-01   +3.728699023901350e-01   +2.270044051751184e-02   -1.834299437733362e-01   +1.263839382621486e-01   +2.746666510023854e-01   +2.332329316312085e-01   +2.927210453264027e-01; +6.406813447446038e-01   +1.382845319280264e-01   +6.338603732391604e-01   +9.663607551089266e-02   +6.557932337425239e-02   +2.990748189171165e-01   +5.330055881768100e-01   -2.387138682621222e-01; +1.900371721217235e-01   +6.359574808520259e-01   +4.254944297370762e-01   -2.862840803726821e-02   +3.312074632424256e-01   +8.054542182008757e-02   +3.161918689363250e-01   +5.447526166649228e-01; +2.951984061935964e-01   +5.511448296213826e-01   +2.317196427595140e-01   +3.765296118859333e-01   +4.206236181277251e-01   +3.817709450961612e-01   +8.404578191579986e-01   +4.111660410304633e-01; +3.424486227779932e-01   +5.363900644684757e-01   +6.197569893892105e-01   +2.478511639966650e-01   +2.595092250825584e-02   -4.489616948780099e-02   +6.672370031679764e-01   +2.648091219855351e-01; +4.828796905969090e-01   +3.423655451054758e-01   +5.119205675523963e-01   +5.653329997810931e-01   +3.635156168857124e-01   +4.972130605996025e-01   +3.481410457334054e-01   +4.864019553102652e-01];
L2I_L3I_iGABA_netcon = [+4.624833312690938e-01   +2.436817855994294e-01   +7.216631227910026e-01   +3.685365483735537e-01   +3.702081977989641e-01   +4.879340089573338e-01   +1.184627520420151e-01   +5.743075872169964e-01; +1.027667869207607e-01   -1.344529310887276e-02   +7.707976578577027e-01   +4.498550015221736e-01   +4.615488303088857e-01   +4.400760730352549e-01   +1.000000000000000e+00   +5.047665934765373e-01; +1.765401385588342e-01   +5.486239975725203e-01   -3.772258285362499e-02   +2.893600145791194e-01   -1.366767845141905e-02   +7.849080790424655e-01   +3.458797379691245e-01   +5.659714862558347e-01; +4.104265447668716e-01   +3.477732536109320e-01   -1.499208741751872e-01   +3.205088599175482e-01   +5.533484992059229e-01   +5.777958962937354e-02   +1.538675862200417e-01   +2.159547884019795e-01; +6.037438313687774e-01   +2.710844820897938e-01   +4.213130707426011e-01   +7.015984358608676e-01   +3.285143018610033e-01   +4.690369222770960e-01   -5.141580081157642e-02   +1.792512599839717e-01; -4.308278628173577e-01   -5.031579423462482e-03   +4.744869216594637e-01   +5.201738270990652e-01   +8.068578602754009e-01   +6.030114595039163e-01   +5.106328060241270e-01   +2.203556002329682e-01; +5.785242209561439e-02   +4.016186018809182e-01   +2.083408758571344e-01   +4.370962807994855e-01   +2.044319257049172e-01   +6.986644466795646e-01   +5.702067854533815e-01   +9.088651277458395e-01; +3.821619414923917e-01   +4.911127218141818e-01   +2.996884265655323e-01   +1.848789685296697e-01   -2.938531295797144e-01   +2.787160149866271e-01   +2.901818319610845e-01   -1.140742544006091e-02; +4.595361949026909e-01   +1.395048488084600e-01   +1.263767732687866e-02   -5.745956284498123e-02   +4.084552318595328e-01   +2.056570683180522e-01   +1.693916830103596e-01   +2.777725826337392e-01; +1.200656935844366e-01   -3.145552771318491e-01   +5.980250288898349e-01   +4.490016694696224e-01   +7.669911593306898e-01   +6.522929101384903e-01   +5.510996622523652e-01   +2.968152277239993e-01; +3.068272420161893e-01   +3.760041416689788e-01   +7.151510818481841e-01   -1.409898552189660e-01   +6.640090624279670e-01   +4.368123199817389e-01   +4.779830585406097e-01   +1.060853182068075e-01; +5.976180953948508e-01   +1.531890032221035e-01   +1.273612093606488e-01   -3.772507414257949e-02   +4.375995898705928e-01   +9.177130729624400e-01   +9.688401437046977e-02   -2.190196436754949e-02];
L3I_L3E_iAMPA_netcon = [+2.028150696723787e-01   +1.144956850208123e-01   +2.281574439444457e-01   +7.775853110323708e-01   +6.448662822377491e-01   +2.478229374841178e-01   +2.670204560702882e-01   +8.049084847971068e-02   -1.861549834980142e-01   -2.945113748858881e-02   +4.071254730158337e-01   -2.363907237737081e-01; +2.904433812668719e-01   +5.055972039664645e-01   +3.289706800069568e-01   +3.124315346362785e-01   +2.911923470212356e-01   +1.625597238453781e-01   +3.157726881376777e-01   +7.551517116156076e-02   +1.967076488296200e-01   +2.758862160937507e-01   +4.021767135489145e-01   +7.106344006716239e-01; -2.096102102160626e-02   +6.944770019861104e-01   +5.255096818690218e-01   +1.902378211556296e-01   +2.248097012713776e-01   +3.775069132994676e-01   +2.117579133299841e-01   +3.358168157912128e-01   +3.601544895254878e-01   -3.258421803620566e-01   +6.427419259579749e-01   +3.366834752102994e-01; +2.776252243609259e-01   -4.434639740662027e-02   +2.768092355938617e-01   +1.791435358841958e-01   +5.878458552880312e-01   +9.513592511684452e-02   -3.607136518239790e-02   +1.582868347287438e-01   +5.089209850072860e-01   +4.059792542921662e-01   +3.194466148352614e-01   +1.586199306489289e-01; -2.909569954789826e-02   +7.153301985577067e-01   -8.725794216669108e-03   +1.326187214767855e-01   +5.231638889116061e-01   +2.886136127986008e-01   +2.123524650653363e-01   +1.886761023311583e-01   +6.051896092376964e-01   +1.675923436073885e-01   +3.085904352717431e-01   +8.541741283634052e-02; +9.291432119737149e-02   +1.726263754828312e-01   +8.037098547373163e-01   +4.099346498084240e-03   +1.885181991826882e-01   +3.002020476575671e-01   +2.565214082534698e-01   -6.440562946941739e-02   +5.939140179911889e-01   -4.001102315219381e-02   +2.985945019126736e-01   +9.195432357818557e-01; -1.380508930970415e-02   +7.730673628127799e-01   -9.981993166954454e-03   +4.957851237299267e-01   +3.739756050979653e-01   +3.475371700217150e-01   +2.283353144721061e-01   +4.998339434102886e-02   +6.173223890181806e-01   +7.352051708508159e-01   +1.786789112590852e-01   +6.955113844473626e-01; +5.120261210119587e-02   +5.466506310869502e-01   +5.207599883212805e-01   +5.004774895335682e-01   +9.179961959454471e-01   -3.273632526495245e-02   +1.000000000000000e+00   +6.089315878197120e-02   +8.806355219396752e-01   +5.908112683572913e-01   +5.782870818466710e-01   +4.678015717499320e-01; +5.194842836873864e-01   -1.991228345592718e-01   +7.422175327562497e-02   +6.614936733191351e-01   +7.283111710261709e-01   -1.593731943242922e-01   -4.845498021956037e-02   +4.825821827265490e-01   +5.726649379049802e-01   +8.623313633369701e-01   +4.128529718477023e-01   +1.485569080107479e-01; +4.564637256764745e-01   +3.476909317270794e-01   +4.317671676895646e-01   +3.840824737366392e-01   +1.353287936072352e-01   +1.501659883771666e-01   +7.071656523180725e-01   +6.151534962713182e-01   +3.440061001892396e-01   +9.880618074571958e-02   +7.723581361021033e-02   +4.711744733099132e-01; +2.939542957137465e-01   +6.282141442395022e-01   +9.692575771584733e-02   +5.333817243185538e-01   +6.637485419119447e-01   +2.284821473743347e-02   +4.830669695580140e-01   +7.424985388054897e-01   +1.987546401591085e-01   +3.825870639164423e-01   -1.604866513553502e-01   +9.058084260529569e-01; +4.042853380140270e-01   -1.212366548835639e-01   +4.496099671584706e-01   +7.249745197312449e-01   +6.474582385031133e-01   +3.874728383837875e-01   +2.456863047474848e-01   +2.349913218223969e-01   +6.702060317945181e-01   +3.427545519788852e-01   +3.160855404267248e-01   +4.123677197387126e-01];
L3E_L3I_iGABA_netcon = [+6.406913416165337e-03   +5.156572899404644e-01   +5.200861889428876e-01   +6.221876661941288e-01   +7.367302900058800e-01   +5.206048713559722e-01   +4.418248370703595e-01   +7.276150859344769e-01   +8.460821170353359e-01   +2.116551053615547e-01   +6.015970225953290e-02   +2.540758125003666e-01; +7.870492179724864e-01   +6.319556985122160e-01   +5.682995710195332e-01   +6.367967907015195e-01   +2.421947733242404e-01   +2.598195227001331e-01   +5.885030979004560e-01   +4.209958447724483e-01   +5.077510956189231e-01   +4.494469664087277e-01   +2.602247616589479e-01   +5.071255205268620e-01; +3.205129615409543e-01   +9.803003494884317e-01   +2.561636594506840e-01   +5.861999931543507e-01   +9.542227595028369e-02   +4.309974505368166e-01   -1.015786704216300e-01   +2.565859992255011e-01   +2.212633181183258e-01   +1.824488465964116e-01   +3.837383947573998e-02   +2.357052727060773e-02; +1.670690247028173e-01   +1.586458131509563e-01   +6.702255602266424e-01   +6.865012732326539e-02   -7.354465326341608e-02   +3.571676056139197e-02   +6.828737385114554e-01   +3.300589167138911e-01   +3.236218782280704e-01   +3.810425333019786e-01   +1.953655273170956e-01   +9.509864322808353e-02; +6.984238764261677e-01   +4.816346568453712e-01   +8.273695760757324e-01   +2.710914746582848e-01   +6.011305675202937e-01   +5.541157718456983e-01   +4.568835559958985e-01   +9.665343999067876e-01   +1.272072789482465e-01   +6.644963435688618e-01   +5.024962776323861e-01   +3.017761906749868e-01; +7.698577286668116e-01   +6.145431009617847e-01   +2.329660688556890e-01   +3.918186788184764e-01   +2.630416015607917e-01   +6.044435981406748e-01   +2.562889689130007e-01   +9.908077854234191e-01   +2.867631392208954e-01   +5.679680317844036e-01   -2.642894168532691e-03   +1.532928091746468e-01; +6.411582828728410e-01   +6.082579687823289e-01   +1.581899765497041e-01   +7.410210170376150e-01   +1.158519617186367e-01   +4.171446963488314e-01   +4.180373375270085e-01   +1.763694151371038e-01   +4.909082603872159e-02   +2.439381580053182e-01   +7.808057334126701e-01   +4.773683585283548e-01; +7.116120982609119e-01   -2.281984977027457e-02   +3.466967624472087e-01   +3.688467564634033e-01   +7.084403875017243e-01   +1.620781299856177e-01   +6.843598951288382e-02   +3.277760848100715e-01   +4.717457697544027e-01   +7.068624156256450e-01   -8.226630774372698e-02   +2.966913824645954e-01; +6.105393704642390e-01   +2.349333666425075e-01   +4.939824666066301e-01   +4.675070333125115e-01   +2.780235466405905e-01   +3.413384518799720e-01   -1.956982004280785e-01   +5.818916750252294e-01   +1.792053308842294e-02   +1.260349900975137e-02   +9.948597382066607e-01   -2.283293655115488e-01; +1.044167240337225e-01   +4.145881401340612e-01   +2.620819076153836e-01   +3.378621590596930e-01   -5.812338374497356e-02   +6.175872138257558e-01   -1.115771847033842e-01   +4.897543529636595e-01   +1.589024780313642e-01   +2.471730277259322e-01   -1.115691532568804e-01   +1.857300141644090e-01; +7.522890099256268e-01   +1.474747195424328e-01   +7.336225515843257e-01   +2.490921371344709e-01   +7.574205638451925e-02   +4.530655676727079e-01   +4.050025269122176e-01   +2.402625119629729e-01   +2.352587244873720e-01   +1.219711081172854e-01   +2.934427597420784e-01   +4.875269919775393e-01; -9.822136153315683e-02   +1.145750875226974e-01   +4.990802398199783e-01   +1.675887372664963e-02   +1.531274445408451e-01   +4.752411508535276e-01   +7.313199102880285e-01   +6.418070015203463e-01   +2.403519197780355e-02   +4.767899002614608e-02   +2.170156915779295e-01   +3.038533060853744e-01];
L2E_Input1_iAMPA_netcon = [+8.689028388720134e-01   +4.014709955906022e-01   +7.318803966381102e-01   +8.867304955045531e-01   +8.239415431897765e-01   +8.322270376554464e-01   +8.528434867914928e-01   +7.041201039175015e-01];
L2I_Input2_iAMPA_netcon = [+9.099695734487862e-01   +7.461023481148559e-01   +7.471481496077913e-01   +8.114467523907464e-01   +6.391332986581586e-01   +6.177016539406339e-01   +1.000000000000000e+00   +9.824845443610252e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
