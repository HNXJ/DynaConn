function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.485671231591844e-02   +4.331507984618242e-01   +7.446180901101276e-01   +5.661522562324042e-01   +5.055826862643316e-01   +7.809612986703430e-01   +4.060683441568222e-01   +1.374709106305375e-01   +1.593521362397392e-01   +3.601188007635753e-01   +4.704025889163975e-01   +1.612568775604764e-01   +3.138804675297040e-01   +5.397466838741610e-01   +3.601480314125673e-01   +6.315828200484278e-02; +3.057065968293983e-01   +1.048781875517310e-02   +4.203704684610436e-01   +5.068324161645505e-01   +2.254072128402109e-01   +2.586667558687092e-01   +7.376154611178639e-01   +8.066568913243628e-01   +5.553954770420084e-01   +1.659243666785074e-01   +8.061383759365763e-01   +1.704592935634533e-01   +1.571127282153054e-01   +2.499860925082795e-02   +4.361901694858602e-01   +2.661427403939124e-02; +5.403976483998482e-01   +5.770352547098466e-01   +6.815458161202991e-01   +3.877415193662035e-01   +9.138966750715324e-02   +6.890989708569307e-01   +7.159436368987110e-01   +3.489892597020414e-01   +3.796965468150157e-01   +3.461643664045269e-01   +3.688615724479205e-01   +1.195012836885943e-01   +5.557744562792077e-02   +1.120761267118195e-01   +6.755491137634310e-01   +4.760250621246329e-01; +6.496242302537209e-03   +1.841422092003647e-02   +3.728900681168318e-01   +5.065345222980189e-01   +1.670216470098185e-01   +6.535614837132381e-01   +3.761521151911447e-01   +7.833083310161602e-01   +3.979436435008561e-01   +2.465243579111426e-01   +7.320962109203394e-01   +7.319978064197941e-01   +1.020928268694032e-01   +7.461200332564252e-01   +1.844841148438780e-01   +2.542614150657896e-01; +3.897678447907880e-01   +5.175766747718900e-01   +5.119595654431056e-01   +5.612149620223816e-01   +3.186103651796072e-01   +6.807121337478093e-01   +4.065212301983708e-01   +2.134324642801333e-01   +4.517560747182991e-01   +6.794271412779391e-01   +2.973394294547461e-01   +5.557342958322009e-01   +1.961758450227349e-01   +2.647168268731803e-01   +7.233997147944247e-01   +1.315675752582512e-01; +3.902654965648449e-01   +1.207021130521182e-01   +6.806407015257518e-01   +1.352280491847415e-01   +5.183697409264097e-01   +2.430734523657110e-01   +3.682305552907357e-01   +1.513059167551283e-01   +4.033586499644037e-01   +3.892599685329184e-01   +6.178927208055720e-01   +1.974763591514473e-01   +3.940107028113727e-01   +4.325168253210450e-01   +3.941939141342934e-01   +5.739712836885194e-01; +2.604618573456863e-01   +5.419689899990954e-01   +7.575944142724321e-01   +5.340847282877860e-01   +3.026889599620755e-01   +5.042173251119242e-01   +3.018626445987893e-01   +6.774542294807149e-01   +7.836371548979277e-01   +3.193192956199526e-01   +1.188849987212747e-01   +1.372336499638346e-01   +3.459068907699533e-01   +7.525422439044868e-01   +4.468620451953585e-02   +1.953361634512265e-01; +4.646156517418603e-01   +2.856074999738121e-01   +6.298993581693970e-01   +4.990899573933213e-01   +4.725342023083167e-01   +1.292694713548557e-01   +6.580253401229710e-02   +3.518837443391595e-01   +6.226477248232086e-01   +5.540326137810517e-01   +2.388923216485006e-01   +6.115527459322050e-01   +2.512620009715409e-01   +8.652242029646022e-02   +5.807381798552583e-01   +4.944552595365641e-01; +1.248840459260220e-02   +5.484401408005937e-01   +5.422998619296755e-01   +5.641723112260629e-01   +6.531410002817861e-02   +7.436675114503872e-01   +3.639783652064859e-01   +3.567351228109702e-01   +4.039917852759075e-01   +3.905059401716795e-01   +1.389347885318134e-01   +7.211274327151872e-01   +8.452745205149402e-03   +6.260908953924872e-01   +2.996434448523062e-01   +3.912546677054639e-01; +5.803304484894499e-01   +9.480038907037741e-02   +7.198289879797691e-01   +6.645978410172271e-01   +5.191532241126716e-01   +1.503635647765739e-01   +6.213749317390724e-02   +1.244922332307857e-02   +6.092974848853323e-01   +3.175293841509887e-01   +8.751441169071555e-02   +4.443859463562960e-01   +6.734031271790792e-01   +2.075800459684153e-01   +6.911154490159601e-01   +5.330358196308498e-01; +3.114161887102473e-01   +3.958245425690651e-01   +4.213822924907936e-01   +6.408851608380207e-01   +7.275316250231713e-01   +1.494890980021001e-01   +5.075465554506143e-01   +4.943142763839212e-01   +2.057457656368967e-01   +2.408446034490848e-01   +5.861508619002305e-01   +7.730152691110580e-01   +9.752255166267439e-02   +5.730660116878588e-01   +6.162175719899433e-01   +1.512856319109228e-01; +4.267207809157255e-01   +2.429752699343983e-01   +7.636772487584197e-02   +2.552442681061225e-03   +7.916305004435287e-01   +7.446655358334183e-01   +4.096527887901519e-02   +5.658513425749118e-01   +5.662045127618380e-01   +2.357587810911500e-01   +8.963273458509702e-02   +2.188430382527317e-02   +7.421500249482296e-01   +5.612483483842515e-02   +4.379117372414344e-01   +3.296985987930548e-01; +5.348366323696006e-01   +6.006950215727966e-01   +7.069674299084359e-01   +1.240042473679182e-01   +5.394849049052047e-01   +5.737630099027859e-01   +5.746022777318647e-01   +5.157893080742230e-01   +7.292825419549354e-01   +3.586962026484976e-01   +3.334107559993819e-01   +7.112035630938827e-01   +6.786435700677540e-01   +5.876258000153521e-01   +3.607207254457488e-01   +7.319454030045578e-01; +6.810376616410991e-01   +5.397099473151223e-01   +2.497767328880641e-01   +5.013888410644060e-01   +1.063813654471134e-01   +1.950564281207235e-01   +4.762424722815817e-02   +1.866184336002719e-01   +2.823561435725461e-01   +5.560757193997979e-01   +1.592645431990508e-01   +6.353871038077190e-01   +4.516997108703548e-01   +5.078179685717767e-01   +3.258478548407417e-01   +2.614408662569276e-01; +3.151032987767542e-02   +4.287422867023540e-01   +6.769515151815316e-01   +4.331865254530762e-01   +2.189329787682902e-01   +1.421635805964918e-01   +2.222151118317290e-01   +3.123892719565562e-01   +1.932702821918072e-01   +8.042411831697782e-01   +2.927953762197040e-01   +4.866854573913242e-02   +1.551311539218402e-01   +5.979372887701958e-01   +2.665376389628818e-02   +5.589080173624077e-01; +6.390947099310073e-01   +2.939745012496638e-01   +1.704119882997224e-01   +7.900582291167886e-01   +8.631421627641327e-02   +1.142914040991017e-01   +7.232783218334601e-01   +1.224972253455503e-01   +4.902253714394829e-01   +6.096475952185214e-01   +5.352426332455348e-01   +1.356706459681334e-01   +6.056851664375731e-01   +6.544213156505194e-01   +7.725966970866690e-01   +7.330781495374198e-01];
L1E_L1I_iGABA_netcon = [+4.307588769840324e-01   +5.238640171800765e-01   +5.554434470759300e-02   +2.650281088315041e-01   +6.684365888448461e-01   +3.212021379905329e-01   +2.969724552096088e-01   +1.891849240845041e-01   +6.970005187457698e-02   +3.102855057115982e-01   +3.020086757010514e-01   +4.754456637658315e-01   +2.645627960348938e-01   +7.300012048338286e-01   +1.709403998008960e-01   +4.266119840780473e-01; +1.189029989162496e-01   +7.440063858132433e-01   +4.146201754326829e-01   +7.146337842570467e-01   +3.695130641249718e-01   +3.448743622333882e-01   +1.111075975067896e-01   +4.133795387177170e-01   +3.841314898024533e-01   +1.217155293412946e-01   +1.744567166889839e-01   +5.661084871733634e-01   +3.848729596020633e-01   +5.871058616017630e-01   +3.995556409161632e-01   +5.847012739231198e-01; +5.072043931778251e-01   +7.981128936565715e-01   +6.339591272088485e-01   +5.152206733969575e-01   +9.714806490401444e-02   +4.809312504738827e-01   +5.214510674535905e-01   +7.009628037237559e-01   +7.091976463563728e-01   +7.663965964609410e-01   +5.335212510036720e-01   +3.906685109003732e-01   +7.848105023998142e-01   +6.824207924584957e-01   +3.556078786048243e-01   +4.490056625109950e-01; +4.240914327956814e-02   +1.178782628767525e-01   +7.397033352379656e-01   +3.510699915873841e-02   +1.520662372258264e-01   +5.843251820218442e-01   +5.832569890640705e-01   +4.546610586412965e-01   +4.070576819373131e-01   +7.808186041932661e-01   +5.197760202267458e-01   +6.462767927598562e-02   +2.893798372892379e-01   +1.481205807349422e-01   +8.295473823571273e-02   +7.910243653650035e-01; +1.413673937101295e-02   +7.122324287452543e-01   +4.182965006751515e-01   +7.293189689153778e-02   +3.421854441223279e-01   +6.925123615592339e-01   +5.696137243589720e-01   +3.106468929153223e-01   -2.593480411672851e-04   +1.309963456300609e-01   +5.852928026925446e-01   +1.021617614136894e-01   +6.628224034993285e-01   +3.805463270631958e-01   +5.427393986419805e-01   +4.466329641452226e-01; +6.342572092082346e-01   +7.620021019922807e-01   +1.260894269829581e-01   +5.500693427994606e-01   +2.926832706559995e-01   +4.348350590974133e-03   +5.592607900255120e-01   +2.372691894252340e-01   +6.649374691973523e-01   +1.402787666885186e-01   +7.656445296858813e-01   +1.085933289293147e-01   +3.123176909222560e-01   +1.070783763842139e-01   +4.285666755786428e-01   +1.146868838208862e-01; +4.024493733331213e-01   +1.842670552796971e-01   +1.080992046051741e-01   +2.090564152400663e-01   +1.521763116117817e-01   +3.103633553703031e-01   +2.360093434468093e-01   +4.355840313104066e-01   +7.145522491936604e-01   +1.246944403711735e-01   +6.085300800134338e-01   +8.057347166339121e-01   +8.086392506970109e-01   +4.213627047121290e-01   +4.192150724958632e-01   +2.451383309897728e-01; +2.309986056517801e-01   +1.759398254383326e-01   +1.441275683713958e-02   +1.301105077269165e-01   +5.866544550447499e-01   +4.224373944844122e-01   +4.015181028406225e-01   +5.074500445673955e-01   +1.574708503161508e-01   +3.386342317005954e-01   +6.625510040691038e-01   +7.702386386848952e-01   +4.250115829931692e-01   +3.680169095996793e-01   +1.429650952891441e-01   +5.651785693776035e-01; +2.364012522948607e-01   +4.888045178221221e-01   +2.413734249183444e-01   +1.769595527712422e-02   +1.462550928179860e-01   +5.711090128849735e-01   +6.488574564234462e-01   +7.339230980723909e-01   +3.056547353417394e-01   +8.708887145014325e-02   +6.189408162256035e-01   +2.872153685469145e-01   +7.178062634712277e-01   +7.537661772271513e-01   +4.873007348124200e-01   +5.587492632579633e-02; +4.216038139258572e-02   +3.309391127371129e-01   +1.198038383053396e-01   +4.695621344523249e-01   +3.301470119580277e-01   +6.684303602224716e-01   +2.541525489112044e-01   +1.841873700226569e-01   +7.596007432753332e-01   +6.222867772212165e-01   +1.865838914318569e-01   +4.976068941366485e-01   +6.229721617738423e-01   +1.531856725642893e-01   +6.261521310333371e-01   +1.795526814260372e-01; +7.057011128381501e-01   +7.179772493953165e-02   +2.440695521273818e-01   +3.238547529205534e-01   +4.264607542326261e-01   +5.321857448486537e-01   +3.692447771833292e-01   +7.755517502647117e-01   +2.598736373979459e-01   +3.333813618154355e-01   +4.678019733578024e-01   +3.861959310608186e-01   +2.070621126391921e-01   +7.941828662267311e-01   +7.182604747874219e-01   +2.732713148863916e-01; +1.514931782176160e-01   +7.342018594850489e-01   +4.525453440759400e-01   +7.466259447491741e-01   +8.037470294878233e-01   +5.486293221117267e-01   +3.752560692752526e-01   +1.179755051494706e-01   +5.893578659593317e-01   +3.675474539934500e-01   +2.814576750605728e-01   +6.693823467029528e-01   +5.478458886784596e-01   +4.055143413913501e-01   +6.413263517458410e-01   +2.036064974506020e-01; +5.929611369189157e-01   +7.489353858198279e-02   +4.236632804603398e-01   +9.631707028515944e-02   +4.385950461111763e-01   +4.613240871936551e-01   +4.778500350455237e-01   +1.676748285744289e-01   +6.053819085158371e-01   +7.140767243529560e-01   +1.389568043895123e-01   +6.298812357609680e-01   +7.812442398931079e-01   +5.019816971791795e-01   +2.961044938349573e-01   +1.062372091781570e-01; +2.057266479913804e-01   +2.052843766973854e-01   +1.895441149127085e-01   +7.761216652739145e-02   +1.486359790206312e-01   +7.013501174769339e-01   +7.488319019125109e-01   +6.123242190344321e-01   +3.456850815079571e-01   +5.318227615952511e-01   +7.957980846990947e-01   +5.959010247727965e-01   +5.040735290127956e-01   +7.082286368538098e-01   +5.207349162585554e-01   +5.959845042157543e-01; +3.539257622181949e-01   +1.330393206657017e-01   +3.571936730498457e-01   +7.118820881135001e-01   +5.195462993372142e-01   +4.134304707452313e-01   +8.766301791913381e-02   +2.790245697922252e-01   +1.347908376079512e-01   +4.124098419966173e-01   +2.162045352277577e-01   +3.590436875324402e-01   +3.102124263745524e-01   +1.902781363725073e-01   +1.404136084366703e-01   +2.479278196898159e-01; +3.581109799817145e-01   +5.989546211323198e-02   +1.556231094677997e-01   +7.571991425561712e-01   +7.551499033659703e-01   +6.078312610405693e-02   +1.555657633270367e-01   +6.557144688392696e-01   +6.480937959821146e-01   +1.103786257774274e-01   +4.255924756507169e-02   +5.039074724753163e-01   +5.311552170611481e-01   +4.233361366987472e-01   +3.285458558294903e-01   +3.681051750167690e-01];
L2I_L1I_iGABA_netcon = [+7.910739804746513e-01   +3.920537981932454e-01   +2.303478817401762e-01   +7.073784238300769e-01   +7.575713361149961e-01   +7.519788040897878e-01   +2.931668907564615e-01   +6.408942200578011e-01; +6.381063331368635e-01   +6.998021305415595e-01   +5.723112300592152e-01   +2.265136045737031e-01   +3.469004491382896e-01   +5.442231321458957e-01   +7.307745852611847e-01   +1.755990140625787e-01; +1.683095200532078e-01   +1.953230356879297e-01   +2.184024893631079e-01   +2.723659538218418e-02   +6.420030199209207e-01   +7.810356706014437e-01   +8.593210594260889e-02   +4.962775814073212e-01; +3.091512319573245e-01   +6.372409532375266e-01   +5.439678384339188e-01   +4.988200853355149e-01   +4.834337475075064e-01   +4.935412049996606e-01   +3.954856507171230e-01   +6.491744968479918e-01; +2.529643767977003e-01   +1.484300035957948e-01   +4.843231185462329e-01   +4.561066518467773e-01   +3.563255516533234e-01   +6.285907492700576e-01   +4.025723399557817e-01   +4.816778350099667e-01; +6.374166132730823e-01   +5.825421149026224e-01   +7.323295088933512e-01   +3.302075042030650e-01   +2.373441244747871e-01   +5.688255237503768e-01   +8.312515159981956e-03   +5.505879753685522e-01; +1.189874229044633e-01   +2.933174661256694e-01   +3.115570830544250e-01   +1.875024831361243e-01   +5.613392799794424e-01   +2.194776131418986e-01   +1.848004199541156e-01   +5.462378290365918e-01; +4.725661320359282e-01   +2.731975093667746e-01   +6.329535140937659e-01   +3.157152338359291e-01   +2.222561931038773e-01   +5.567878954781049e-01   +3.638188046463682e-01   +2.473246431677991e-01; +3.269556232192926e-01   +5.756620666678337e-01   +1.604372098043527e-01   +1.918347499104619e-01   +2.576118762185781e-01   +1.317554879425855e-01   +3.349229414289271e-01   +7.742012814854953e-01; +4.311198366507625e-01   +5.520420986693437e-01   +1.660352233921491e-01   +4.409957786914231e-01   +1.677340479901920e-02   +5.659858178748907e-01   +7.287010094390158e-01   +5.621352558465327e-01; +4.141551102093405e-01   +6.348339367628689e-01   +6.815608525264474e-01   +2.973568259603289e-01   +5.769317308442967e-01   +7.917866555777022e-01   +1.490700535122163e-01   +2.231707243400598e-01; +6.404359138166666e-01   +4.242789352811853e-01   +5.017889765734362e-01   +3.399922766820961e-01   +7.849969303751541e-01   +2.203410534195895e-01   +5.086810202244945e-01   +2.628213999654219e-01; +2.485411935551677e-01   +7.731718608534920e-01   +7.424469327278000e-01   +1.648558978647287e-01   +4.540061602748804e-01   +2.409564461384328e-01   +2.523004288517610e-01   +4.021912879442372e-01; +5.622809147649511e-01   +2.060140009412168e-01   +7.984027916019700e-01   +4.215556363348811e-01   +6.694844553504861e-01   +1.497396697437999e-01   +7.844757609456831e-01   +1.737485453888674e-01; +7.750972772956811e-01   +1.752907739263352e-01   +2.198619299479949e-01   +7.318756899452474e-01   +5.261707964486014e-01   +1.153120427823797e-01   +3.186603762212368e-01   +5.584741417708505e-01; +1.472292287532950e-01   +5.568440043641505e-01   +5.841140401606044e-01   +4.996824653389705e-01   +6.658732757101864e-01   +1.009943961743800e-01   +7.904342566910967e-01   +2.454610492120108e-01];
L1I_L2I_iGABA_netcon = [+4.592408260140522e-01   +5.542883545906770e-01   +2.481809461510650e-01   +5.944621897558210e-02   +4.085241473559722e-01   +3.202347234707554e-01   +7.918333735054502e-01   +5.552201075704026e-01   +3.295522111901252e-01   +6.320752306843416e-01   +1.204411299177992e-01   +2.476824564198519e-01   +1.032824311412253e-01   +5.245002151158825e-03   +1.683443488913233e-01   +6.379597546257105e-01; +6.446049272032516e-01   +4.780185988298857e-01   +3.042182470288468e-01   +3.701572682204544e-01   +7.481597313693755e-01   +3.656444260548337e-01   +5.428296194380414e-01   +7.767914965149598e-01   +3.514002514629027e-01   +7.993868735633815e-01   +5.330030801062599e-01   +2.817843957969904e-01   +3.982886996051914e-01   +5.042924443761190e-02   +2.934299607597455e-02   +7.118021165254945e-01; +6.836044125476987e-01   +4.720737460600675e-01   +1.771903451867591e-01   +6.624834060574335e-01   +2.667387548559518e-01   +7.025958093121645e-01   +6.119167016924032e-01   +5.313326985386093e-01   +3.062115872664126e-01   +2.906180187154900e-01   +5.497029830406166e-01   +3.198982527394606e-01   +2.700919919956403e-01   +1.320670395400262e-01   +4.952743428626908e-01   +1.041023194797223e-01; +3.421000023855527e-01   +4.370600489367788e-02   +4.819963851899653e-01   +7.005912940827952e-01   +8.509619707552746e-02   +1.722154787509283e-03   +2.848707066727764e-01   +2.708587794625632e-01   +4.719200398483434e-02   +5.184848541998544e-01   +4.483615422569823e-01   +3.807828222082996e-01   +2.007402390267092e-01   +4.043746075655325e-02   +6.416073206363035e-01   +4.218060573973204e-01; +6.541680449120033e-02   +6.578320129650318e-01   +6.376882444068293e-01   +5.402111285251900e-01   +5.038497804336406e-01   +3.962803355316594e-01   +5.158174879567432e-01   +6.718093522857003e-01   +5.002656525821476e-01   +1.570120121708162e-02   +2.507135885408783e-01   +1.805957101826879e-02   +2.004344879179871e-01   +7.046509541767800e-01   +1.639226782834625e-01   +3.791363456965056e-01; +5.118422090408299e-01   +5.718256540172928e-01   +1.066496210956825e-01   +7.239273477859306e-01   +4.498880590488572e-01   +7.756264100291456e-01   +5.877447734631397e-01   +6.617773418030365e-01   +4.429594048065844e-01   +4.713777498438256e-01   +8.063853382476713e-01   +6.636817783459444e-01   +1.074902213078488e-01   +7.338299592829898e-01   +5.721905199357964e-01   +7.337880262850109e-01; +6.242360340706538e-01   +1.221362582823594e-01   +6.932685733791112e-01   +7.979383071454240e-01   +3.104436698985121e-01   +7.919465160398867e-01   +4.096654887975820e-01   +3.836619449866658e-01   +1.063702565042677e-02   +4.744307839045098e-01   +2.477084947493887e-01   +2.818561979848764e-01   +6.259700860645500e-01   +3.369828607725982e-01   +6.811049275394957e-01   +4.585885524631220e-01; +5.975060511783458e-01   +8.877649609669809e-02   +7.272298985510104e-01   +5.781722867836612e-01   +9.257745571231080e-02   +6.411690161243527e-01   +4.778262194685377e-01   +6.200004300718136e-01   +2.951940920670160e-01   +6.837473811439922e-01   +2.122427238168854e-01   +3.992183542040439e-01   +4.013482422390844e-01   +6.054222724040867e-02   +7.505723277888849e-01   +3.571896320954952e-03];
L2E_L1E_iAMPA_netcon = [+6.298717062770286e-01   +2.309805052074123e-01   +1.157515411311378e-01   +7.925770649570748e-01   +9.580798549484916e-03   +3.938114897673264e-01   +5.367717345057772e-01   +6.718002034555129e-02; +7.462995020087230e-01   +7.062180768963506e-01   +4.306043601191372e-01   +2.971399192124144e-01   +4.062126758631420e-01   +1.431655041513061e-01   +7.372199625931888e-01   +3.230474960048199e-01; +6.927507399947624e-02   +1.051063916138961e-01   +2.664157773140801e-01   +1.277816206647630e-01   +5.020531454249969e-01   +6.867330499130015e-01   +2.681999721668435e-01   +2.554381890263704e-01; +2.103084018038493e-01   +5.840817273118937e-01   +1.718494463804601e-01   +5.245801827292618e-01   +6.110479276816064e-01   +2.525765239358529e-01   +7.106312261973924e-01   +6.716401617772340e-01; +1.592157506945335e-01   +7.999908268351343e-01   +1.124838118184485e-01   +2.508346312803776e-02   +7.617083763224624e-01   +7.711268137879880e-01   +5.475117822363191e-01   +3.801380044024041e-01; +5.643295797292313e-01   +4.172313199292685e-01   +7.743698169945843e-01   +6.280691878056732e-01   +5.652566928627918e-01   +1.815064097290154e-01   +6.435676964040995e-01   +5.598165673734988e-01; +8.564706277664083e-02   +2.693685120188851e-01   +2.377979873938845e-01   +3.684887052397655e-01   +7.482878615534001e-01   +3.743103884646181e-01   +1.268749465615464e-01   +2.763043588775727e-01; +5.478085610507627e-02   +9.848223813581533e-02   +4.281401748688335e-01   +5.479418955537628e-01   +3.255268484858354e-01   +7.310193246141883e-01   +7.892811214372755e-01   +7.389951459344519e-01; +2.865227392428410e-01   +7.141179285181326e-01   +3.224420689480817e-02   +2.171902109464169e-01   +1.308665689392211e-01   +7.788991896995727e-01   +4.252943984903184e-01   +5.534336468694207e-02; +2.413356217086339e-01   +2.285050484861160e-01   +6.970671224324031e-01   +3.302159391023015e-01   +6.613257595671495e-01   +7.145955170938383e-02   +1.009584594190974e-01   +7.777630200532534e-01; +4.582884583600224e-01   +3.815677873337111e-01   +1.466997196391410e-01   +4.941857953222440e-01   +3.334546943794744e-01   +3.339558725090051e-01   +4.713039323777640e-01   +7.275763098258391e-01; +2.166377610779402e-01   +3.686728994192054e-01   +6.627795153210662e-01   +5.913299357487115e-01   +5.199870214418540e-01   +1.579483064829525e-01   +8.055242804795333e-01   +1.865274334354683e-01; +4.848314564867789e-01   +6.697964204710276e-01   +1.959380358259371e-01   +4.903842836102969e-02   +7.927917460076230e-01   +5.431020375263781e-01   +3.746213918983054e-01   +6.519587707983603e-01; +3.385608870178137e-01   +4.298879110382258e-02   +9.343858058106556e-02   +5.398266670770036e-01   +7.531199957863749e-02   +2.426855936435507e-01   +6.447112119406290e-02   +5.935633771182794e-01; +2.303889252882405e-01   +1.697043825780483e-01   +5.293196498794672e-02   +6.169190389881438e-01   +9.416863366934040e-02   +7.649699417343921e-02   +3.352220488423558e-01   +1.912152548596473e-01; +1.201506826443089e-01   +3.541739921326181e-01   +1.126662607453046e-01   +4.366119564988660e-01   +2.024693047124553e-01   +4.462008254661510e-01   +8.725009606682903e-02   +6.633169026856637e-01];
L1E_L2E_iAMPA_netcon = [+2.971195917529724e-01   +1.276823327531860e-01   +7.525669021799233e-01   +7.849043104239654e-01   +2.660195919725817e-01   +7.650982809409419e-01   +4.066204707884069e-01   +7.994060036832032e-01   +1.100723605880806e-01   +5.283224041628878e-01   +5.210589214299263e-01   +6.159030034114633e-01   +3.057889601208444e-01   +5.521483114845457e-01   +4.549730210450864e-01   +3.986992805933572e-01; +3.190572701567204e-01   +4.205825568150433e-01   +1.744063206286116e-01   +7.136464971030905e-02   +5.254161959157545e-02   +5.544340048593127e-01   +7.037917136475277e-02   +2.536448317488166e-01   +1.653253899315566e-01   +2.541278287077816e-01   +2.191004096996374e-01   +7.683621948006075e-01   +1.141833996552708e-01   +2.334589534989670e-01   +4.788823857037254e-01   +1.959781871304573e-01; +2.616381170440476e-01   +4.864321197641720e-01   +7.304671042099021e-01   +7.489724167736985e-01   +7.653209366069617e-01   +9.012081673160027e-02   +2.341217952147521e-01   +4.357689421872918e-02   +3.568016805111888e-01   +4.650058966371476e-01   +2.755841050762721e-01   +8.509757011027415e-02   +6.125748987050265e-01   +4.866452691874958e-01   +7.237915637672546e-01   +6.318276804180714e-02; +6.374225631103491e-01   +2.678845619722486e-02   +1.857896245516598e-01   +1.770081532058493e-01   +5.955051279561936e-01   +2.596292659978908e-01   +7.341637921549040e-01   +7.250349402420864e-01   +6.321596540999574e-01   +6.153419546359969e-01   +3.780575542736697e-01   +4.533104786469799e-01   +7.581032275300550e-01   +2.713939026080892e-01   +7.375216284004665e-01   +7.891144425634741e-01; +1.044929228198333e-01   +6.939297387758949e-01   +7.048174076226356e-01   +2.649840444026930e-02   +1.278919439917053e-01   +6.514743691506183e-01   +7.593049861986287e-01   +1.502957286683418e-01   +4.586016134045059e-01   +3.363711301155409e-01   +4.466812699633050e-01   +6.266930395223675e-01   +1.937772310666822e-01   +4.242991984276316e-01   +8.010664389487848e-01   +3.842775464667002e-02; +2.613596462671981e-02   +6.821911907251178e-01   +2.112877953320263e-01   +6.562855092014389e-01   +7.783061620905198e-01   +6.835924906339373e-01   +4.206214364649862e-01   +7.571866930676900e-01   +2.643307120672584e-01   +3.251049804034388e-01   +6.836834211892262e-01   +7.450013186975816e-01   +6.896638706373104e-01   +5.044226080788355e-01   +1.551881563878814e-01   +4.698511119644269e-01; +2.579130826994294e-01   +1.829019816270416e-01   +4.747384334474433e-01   -5.241968287832143e-04   +3.128059136114101e-01   +4.249869987786939e-01   +6.069277901345294e-01   +4.805105817925244e-01   +4.730499347818869e-01   +6.362915419923068e-01   +5.110075958444575e-01   +8.555414287797106e-02   +2.907585666724459e-01   +4.423599519579937e-01   +1.950535956590908e-01   +2.829571225836596e-01; +6.911206451800875e-02   +4.437387643907671e-01   +3.980558361740573e-01   +3.215977637111453e-01   +5.894066356642917e-01   +7.803124126950221e-01   +8.010145718136487e-01   +5.127293420161884e-01   +7.119046775861190e-01   +3.220291962767836e-01   +2.814428680099693e-01   +7.983164052696008e-01   +5.401614766996342e-01   +7.329348700929401e-01   +2.699779074947020e-01   +8.536620535458510e-02];
L2I_L2E_iAMPA_netcon = [+5.066239981169667e-01   +1.900738333530570e-01   +7.274725357988869e-01   +3.868116738583726e-01   +6.313049473770319e-01   +4.028331414377693e-02   +6.489810092149269e-03   +7.291825247523098e-01; +1.251036480417511e-01   +1.030517927401817e-01   +1.302561299387709e-01   +6.956327360529574e-01   +6.164168574503467e-01   +3.221012970541349e-01   +5.672354780955536e-01   +3.872006438589041e-01; +6.836043881567219e-01   +6.069366965603630e-01   +6.775268887526964e-01   +6.025653231407223e-01   +4.243729561109879e-01   +4.174866837040448e-01   +4.103319885718792e-01   +5.751533482053596e-01; +3.221436806638963e-01   +1.428198379415139e-01   +7.179096550840367e-01   +3.461034603258654e-01   +7.753005607775286e-01   +1.272639491037352e-01   +3.764042586803713e-01   +6.971522261160483e-01; +5.739165432228398e-01   +7.000815387903286e-01   +5.171335881819863e-01   +4.951102000070751e-01   +7.491768286385360e-01   +6.042499347992115e-01   +3.381300429300230e-01   +6.040466321394929e-01; +4.881344066988896e-01   +3.085840267227282e-02   +7.236814922813284e-01   +6.051260289913888e-01   +4.391603831234714e-01   +1.446390013803357e-01   +8.625033890786976e-02   +5.983359221557392e-01; +7.704851396696331e-01   +3.688433909568997e-01   +1.339017223311567e-01   +3.968413676062667e-02   +1.144697161998798e-01   +1.808002645881845e-01   +1.190152824873941e-01   +1.462569439922849e-01; +7.395370153180792e-01   +2.843079170457919e-01   +4.496961243814911e-01   +3.992768222303914e-01   +7.084729932103663e-01   +1.950990186310537e-01   +1.036909498080283e-01   +1.855525062327027e-02];
L2E_L2I_iGABA_netcon = [+7.487396743361868e-01   +1.926203216153050e-01   +1.679668592450863e-01   +1.547482257157712e-01   +5.390808110557033e-01   +3.013082300373909e-01   +6.655253743702542e-01   +7.671375573469834e-01; +2.042047639153490e-01   +3.481658930316397e-01   +1.013580906623305e-01   +1.236165301419393e-02   +8.029856450960718e-01   +5.660183363643611e-01   +6.206972408619675e-01   +5.758468774277474e-02; +5.302321859499636e-01   +2.929286329672364e-01   +4.474330805575972e-01   +3.814798585750854e-02   +3.161856671831051e-01   +6.230563580435341e-02   +8.005188468489647e-01   +6.727125435207034e-01; +6.992992762747384e-01   +5.617280152801789e-02   +2.071807988060993e-01   +5.978872969900932e-01   +7.453237868527193e-01   +5.233475275105030e-01   +3.488410057003434e-01   +5.371227697435462e-01; +1.301238313737453e-01   +7.350824053178270e-01   +5.009922815571759e-02   +6.860307637284622e-01   +2.466062571331972e-01   +2.958676711445963e-01   +3.415626318483792e-02   +2.199310284082848e-01; +6.078644203838336e-01   +1.277912406042031e-02   +4.430598091154538e-01   +6.429406467120332e-01   +7.170016310600180e-01   +2.132276533147467e-01   +7.710920110500266e-01   +6.345892608067203e-01; +1.287621462673403e-01   +7.893593850526121e-01   +2.314637553171562e-01   +2.353318451109112e-02   +5.838827716555511e-01   +4.230317178046845e-01   +4.876415519432454e-01   +5.026618459767166e-01; +7.017090250941402e-01   +2.521690108951762e-01   +4.003229092047617e-01   +1.677827398423229e-01   +3.806316013956718e-01   +6.349810369369259e-01   +7.691139449542780e-01   +4.910291494646597e-01];
L3E_L2E_iAMPA_netcon = [+2.854644391111196e-01   +5.130464185962509e-01   +1.257545817404452e-01   +6.744684763629033e-02   +4.872852128117901e-03   +7.923278140842244e-01   +3.176103166797736e-01   +6.997317425398070e-01   +9.750042222781095e-02   +2.391469897057964e-01   +2.351548203740436e-01   +3.990000064616458e-02; +2.138773354668780e-01   +7.206512898819087e-01   +2.349244427875834e-01   +3.006750271193924e-01   +3.737846782251640e-01   +4.557361063461497e-01   +7.424086437964917e-01   +8.007735002616807e-01   +4.535191253738773e-01   +7.824032479706797e-01   +2.867292332913621e-01   +2.095521556915908e-01; +7.876064761086121e-02   +5.990351451210010e-01   +8.483250393550677e-02   +5.949417769242952e-01   -3.086605196048794e-04   +1.101222697953468e-03   +4.391373376433194e-01   +7.966177886262510e-01   +4.770210780119145e-01   +4.951141188670117e-01   +2.004573865794659e-01   +5.775651284878572e-01; +2.392528420341586e-02   +1.639073887010423e-01   +6.588675275295898e-01   +2.116858872885751e-01   +2.195762425763285e-01   +1.198917018231539e-02   +2.714346574786072e-01   +5.295278153390084e-02   +1.736751898467821e-01   +2.557075857154754e-01   +1.617688806581265e-01   +2.692002561648258e-01; +7.323233876392236e-01   +3.018533971011842e-01   +2.757669728154657e-01   +8.011475470220830e-01   +5.466626372288547e-01   +2.984959601945120e-01   +7.897350190224199e-01   +1.353146627754778e-01   +6.804324800722932e-01   +3.930279816176045e-01   +5.544492212210528e-01   +3.282999934171036e-01; +7.171537513049226e-01   +4.799883200219765e-01   +8.772826409816882e-02   +4.010102826053158e-01   +5.132491504008044e-01   +7.342390807547603e-01   +7.225136475365672e-01   +3.114896887602504e-01   +3.772973582486165e-01   +1.540085360718620e-02   +5.143387670568766e-01   +2.060635133623426e-01; +5.052296181483161e-01   +4.151291627232759e-01   +5.089881218781416e-01   +1.701677482178009e-01   +4.750458954119377e-02   +2.915694803605960e-01   +8.064799412626793e-03   +2.801990437405562e-01   +2.305355918147410e-01   +8.815334196500829e-02   +4.874939589988353e-03   +3.781613686678269e-01; +6.855513425587031e-01   +8.045855170281772e-02   +7.351356725969300e-03   +2.141227931326757e-01   +4.513036772826410e-01   +7.247123010596471e-02   +2.454002955554943e-02   +3.963571757868091e-01   +4.008586603046855e-01   +6.966934335636635e-01   +7.085045320367046e-02   +4.994399405827271e-01];
L3I_L2I_iGABA_netcon = [+7.911921696108938e-01   +4.073650198140000e-01   +5.273149543522950e-01   +2.222324723540778e-01   +7.665111096552679e-01   +3.623091758398593e-01   +3.917159172703038e-02   +1.725382297238709e-02   +7.053585015224950e-01   +3.642256975550577e-01   +7.049962355224365e-02   +6.001391400363718e-01; +7.290989646083204e-01   +7.812508968461083e-01   +7.226324044467785e-01   +1.316191225269233e-01   +4.196681277856035e-01   +6.791154723503858e-01   +4.872602309612462e-02   +1.693456469403101e-01   +4.017519415570072e-01   +5.370809789598273e-01   +9.761771318389936e-02   +5.238778743481020e-01; +8.234498884083639e-02   +6.933502415859139e-01   +7.276320276795385e-01   +8.797468466951343e-03   +5.781443538356955e-01   +1.126075930884561e-04   +5.007034172829369e-01   +7.510560279337357e-01   +5.865419123006271e-01   +1.656306032754281e-02   +4.740808905076715e-01   +9.080845507890463e-02; +7.750330583237466e-01   +2.153205067909703e-02   +2.905867649879061e-02   +5.274851220038027e-01   +7.258081193385346e-01   +4.490136558008549e-01   +3.016834361143392e-02   +1.631913682981781e-02   +7.016292602899937e-01   +6.663000586131964e-01   +8.062143650238990e-01   +4.473476788502800e-01; +1.266225836147223e-01   +7.786188520524004e-01   +3.330469530967534e-01   +3.447539331117666e-01   +4.587146319411897e-01   +7.465633688653344e-01   +3.155590883333509e-01   +1.380821950768065e-01   +8.102804827420163e-01   +4.022211596305350e-01   +1.800482832130372e-01   +1.369751922706638e-01; +2.867177145481524e-02   +5.532087709046118e-01   +1.729358642809327e-01   +1.182922701985439e-02   +1.366957987313729e-01   +5.250441188959072e-01   +5.628243068048431e-01   +1.905793511151979e-01   +4.206669711783859e-02   +6.169170272497229e-01   +6.975715419127382e-01   +6.714738829835841e-02; +5.119632937487786e-01   +7.120158623574260e-01   +4.685717971974456e-01   +5.235761848790171e-01   +3.644041054136156e-01   +2.489688685669651e-01   +5.701299856749038e-01   +6.383438299934178e-03   +6.724530853691123e-01   +3.077140681070389e-01   +4.116099907501154e-01   +5.859547830523751e-01; +3.991731987460965e-01   +1.685551713816217e-01   +2.485892466698847e-01   +4.703583782493290e-01   +2.868882783873343e-01   +1.133302114594886e-01   +1.815204310485672e-01   +2.202828164030950e-01   +4.442643594236837e-01   +7.956627303771728e-01   +2.250332749615093e-01   +2.392507837281117e-01];
L2E_L3E_iAMPA_netcon = [+5.457179071850946e-01   +5.363434340364479e-01   +1.891433404554616e-01   +7.041873434735204e-01   +4.098249422312093e-02   +4.181735790913477e-01   +5.478528413959372e-01   +7.567332327974661e-01; +4.341979375105889e-01   +5.928501399608798e-01   +5.964292658735110e-01   +6.500939027768832e-01   +8.500343138100790e-02   +4.019038676956018e-01   +6.939143499009607e-01   +5.584422691733275e-01; +6.923276026425484e-01   +7.123318410312626e-01   +6.867681784871460e-01   +7.358776697346935e-01   +4.735206743292344e-01   +5.289853026142627e-01   +7.045212988401529e-01   +4.671319366252418e-01; +3.315812448608331e-01   +7.736037048501060e-01   +6.917116984489807e-01   +4.944641106461831e-01   +4.193848715247700e-01   +4.010388205237336e-01   +2.310824224197819e-01   +1.499630480043827e-01; +1.198319711881052e-01   +4.426923217081637e-01   +2.005981751098311e-01   +6.553324257316447e-02   +1.448411700433574e-01   +4.439691606098722e-01   +7.215768964482377e-01   +6.164132167225764e-01; +4.053495253616340e-01   +7.933003542079401e-01   +7.187638486754400e-01   +4.372531468148588e-01   +4.161169469434648e-01   +7.956779642130594e-01   +5.806884678645260e-01   +7.938141521506993e-01; +3.922263352281126e-01   +8.034459013969146e-02   +4.347001374061465e-01   +1.994090558663777e-02   +2.883723308893059e-01   +6.620972372391157e-01   +2.834086620509356e-01   +6.301532203624627e-01; +7.595172915565029e-01   +5.611498157923187e-01   +3.461249435058196e-01   +6.305281520934414e-01   +2.849797912028626e-01   +6.269212769288542e-01   +4.171294022017414e-01   +3.525463569206636e-01; +3.768926122659224e-01   +4.439429267708206e-01   +7.160249281242520e-01   +5.108627254623516e-01   +4.631015113528873e-01   +2.811556975594546e-01   +4.919972928185593e-01   +5.309394190365453e-01; +2.274288888726264e-01   +1.273581362357183e-01   +6.328678417695954e-01   +7.104302293437820e-01   +7.321397660752916e-01   +2.144930313471892e-02   +1.027840723116196e-01   +5.304361356444548e-01; +4.670803315720473e-01   +2.590776753597474e-01   +5.965576922438792e-01   +6.576104869403024e-01   +7.588746553652715e-01   +7.748935235705924e-01   +2.158656283487647e-01   +3.028382098806302e-01; +7.453661414375656e-02   +4.699694498703815e-01   +3.375612150069652e-01   +7.011369166696699e-01   +3.983030886334092e-01   +1.646869227640879e-01   +5.363901084490225e-01   +6.909690537075505e-01];
L2I_L3I_iGABA_netcon = [+7.661990885483464e-01   +3.235531063576900e-01   +2.275452946825992e-01   +5.689934458560064e-01   +5.944476289174027e-01   +6.819766189401837e-01   +3.432446646442609e-02   +4.166360434704634e-01; +4.515302111315004e-01   +3.853490008255342e-01   +5.746705001160562e-01   +1.350841831963444e-01   +7.154620936482659e-01   +6.670969732005529e-01   +3.786588595929594e-01   +2.063421491977357e-01; +6.368612765720768e-01   +5.935895376272949e-01   +7.600894188836750e-01   +5.094032202422207e-01   +2.906716573538832e-01   +4.954833959312970e-01   +3.249201954925052e-01   +1.404509475917194e-01; +1.753037348535096e-01   +6.783976886996215e-01   +1.728485632810621e-01   +4.017594605734994e-01   +2.536315947130920e-02   +2.953201412306352e-01   +2.997541836482336e-01   +7.928563776914637e-01; +2.480768136308011e-01   +3.125410473494403e-01   +4.271959309749289e-01   +3.882825681189805e-01   +2.908558992513328e-01   +5.298272063331066e-01   +8.014599724625794e-02   +1.029072300697109e-01; +5.385855255045006e-03   +2.049417868524415e-01   +3.529325852293389e-01   +1.472844780479782e-01   +2.928297147827759e-01   +3.208074232108840e-01   +4.285456508781377e-01   +5.721523299880177e-01; +2.871464472064903e-01   +3.860603042837639e-01   +7.597817615636145e-01   +5.174246191852420e-01   +5.914006648504579e-01   +2.449922110019479e-01   +2.598965584111239e-01   +2.472254931511871e-01; +2.909863010096688e-02   +8.016962494396678e-01   +2.496146634440772e-01   +7.136429627715049e-01   +6.388639657789250e-03   +6.137406115190759e-01   +4.617180025816007e-01   +6.125790934199788e-01; +7.149421839138752e-01   +2.366701665551566e-01   +6.770206952990265e-01   +5.602135513419081e-02   +4.025609737042417e-01   +2.114111965461394e-01   +3.337728702857437e-01   +3.644678830322829e-01; +6.298594928486350e-01   +3.997480993810705e-01   +2.003582653531028e-01   +4.033820458453359e-01   +5.048308344294079e-01   +2.775361152098598e-01   +1.703847106269806e-01   +2.489835347058798e-01; +5.832985921155379e-01   +7.843116689481213e-01   +4.366667618221544e-01   +5.573499220109709e-01   +2.341227193572166e-01   +2.855544940048606e-01   +7.645499363240580e-01   +9.927993318130582e-02; +6.192794415418922e-01   +6.244774010012804e-03   +2.721741294150549e-01   +1.215059448680108e-01   +1.172988798491103e-01   +7.835980406525647e-01   +3.948646163082793e-01   +4.463442352055982e-01];
L3I_L3E_iAMPA_netcon = [+3.628131555810876e-01   +8.065036997920655e-01   +2.251148597958621e-01   +5.005164084004283e-01   +6.305270086660653e-01   +2.587710796762527e-01   +2.367277857894727e-01   +1.825786271716003e-01   +2.677442336720229e-01   +2.306050830228945e-01   +2.189996865767182e-01   +3.758081524188735e-02; +3.268378739790200e-01   +6.942219256535537e-01   +1.802030176725176e-01   +1.103047889509792e-01   +6.368762863490576e-02   +4.372174714204710e-01   +4.541644639422595e-01   +4.488573163114430e-01   +1.855471274946943e-01   +3.929293152419818e-01   +6.131983446976624e-01   +4.580088908238716e-01; +2.653070151934870e-02   +5.065273178500258e-01   +3.654932898000062e-01   +4.804976252719083e-01   +3.965208115691222e-01   +3.704360661705877e-01   +4.044084511010076e-01   +3.742719452011765e-01   +2.780005025523886e-01   +4.682686724306427e-01   +3.755185807845379e-01   +4.499393958866768e-01; +3.176448485045191e-01   +6.028107683880671e-01   +5.061500169532734e-01   +3.414782163383732e-01   +3.596251082151691e-01   +7.240921468089344e-01   +6.209756748028643e-01   +9.779832818181194e-02   +7.469050018037519e-01   +7.376242606579587e-01   +1.376112638047780e-01   +6.012292748819613e-01; +8.613587669586760e-02   +2.671693244280813e-01   +2.500171620721778e-02   +7.053433998071676e-01   +6.155096930906256e-01   +4.491377806274865e-01   +7.709137653246870e-01   +3.972098410978779e-02   +7.138090853489507e-01   +4.591754825412721e-01   +3.038868753531237e-01   +8.762668985191809e-02; +2.712382963254538e-01   +5.349323202626168e-01   +6.740804525897908e-01   +3.503524633457860e-01   +8.000242597448041e-01   +2.653112557927389e-02   +7.345249700788946e-01   +2.025323444631813e-01   +5.472690701936549e-01   +2.270500855285451e-02   +2.783896828341576e-01   +1.201546758813390e-01; +6.637738693675613e-01   +3.037462875258598e-01   +3.221748353837873e-01   +2.279673139729703e-01   +5.414903600140373e-01   +1.534851483123651e-01   +4.635852907768617e-01   +7.469001594079603e-01   +6.781612211471939e-01   +7.969758592085461e-01   +4.238245701794308e-01   +5.759171622141696e-01; +5.877307953476162e-01   +1.694207156877549e-01   +5.909547378834766e-01   +4.788680752551772e-01   +7.956191939188947e-01   +4.758840663247633e-01   +7.863629439698062e-02   +3.931411254117479e-01   +3.470368464783493e-01   +2.343893124702283e-01   +1.965152548995799e-01   +7.766042987192766e-01; +7.593242462817024e-02   +6.833953179297997e-01   +6.009649672046202e-01   +6.567776060307055e-01   +3.018037535724332e-01   +5.867788531137182e-01   +1.483702013590195e-01   +6.320388366517017e-01   +6.743333607857095e-01   +3.710381738854105e-01   +1.742328799024364e-01   +1.942390783002552e-01; +7.443517904634235e-01   +6.276274700729911e-01   +3.288295497512820e-01   +1.962669574272844e-01   +4.616084534230709e-01   +6.271666360040621e-01   +4.073541398373378e-01   +7.091395905098117e-01   +5.371720510528961e-01   +2.815090918044820e-01   +7.153087367560315e-01   +1.742491458294519e-01; +3.658653458277462e-01   +2.820694459895251e-01   +7.933209696227028e-01   +7.634910842476899e-01   +7.529561158401589e-03   +5.023757823604488e-01   +6.565343625501679e-02   +2.089937295179320e-01   +3.071055747801383e-02   +7.770142907803801e-01   +6.284019075163518e-01   +2.886782436217015e-01; +9.023778968695244e-02   +1.440856199554068e-01   +2.019906145215484e-02   +3.664759748839522e-01   +3.516334850401796e-01   +1.949080705237238e-01   +6.389480053014014e-01   +1.686605814210285e-01   +2.613110386440095e-01   +1.986458371054018e-01   +6.348408393499509e-01   +2.158862184510967e-01];
L3E_L3I_iGABA_netcon = [+1.616572533807800e-01   +3.657988842230921e-01   +2.660618076567028e-01   +7.459864386085273e-01   +6.669918171485603e-01   +4.495563183929365e-01   +2.471680111628997e-01   +6.174853951675128e-01   +5.242112060823571e-01   +5.985688136657606e-01   +4.822318164192260e-01   +1.875548355259293e-01; +6.306116235755057e-01   +5.118437332900853e-01   +2.369967539474029e-01   +1.869273847706657e-02   +3.020938165133509e-01   +5.687036211303789e-01   +5.419959183600993e-01   +7.880156848990100e-01   +6.933644468044805e-01   +3.600844133123932e-01   +1.005845058533795e-01   +2.317983247486490e-03; +4.800086299466019e-01   +7.817638483398968e-01   +7.688158236271722e-01   +6.838518944236204e-01   +9.533767280410280e-04   +6.047821724934392e-01   +4.760914295651064e-01   +5.609822504431426e-01   +3.426114484987679e-01   +3.363042471759492e-01   +2.298483242074486e-01   +1.196144821749672e-01; +3.312269474233209e-01   +7.664553610364973e-04   +1.085293391837587e-01   +5.896050884609465e-01   +5.859452434065113e-01   +2.150615634461567e-01   +3.372490045078843e-01   +3.017771621741047e-01   +8.065663824389909e-01   +3.866280577371026e-01   +3.883814770865242e-02   +4.886267175606291e-01; +3.398505633704054e-01   +3.153140378128503e-01   +8.047016784408980e-01   +2.187711354401038e-01   +4.371971239747082e-01   +6.244006313879819e-01   +7.815125737598488e-01   +7.491535418590320e-01   +2.117640014838484e-01   +4.532455742990179e-01   +6.779982928145499e-01   +4.775925612670361e-02; +5.560530477079295e-01   +3.832640196074921e-01   +6.806693581853142e-01   +7.182137386386166e-02   +3.375392872383712e-02   +7.957077013210286e-01   +7.234941931319987e-02   +5.159730378191667e-02   +6.674152223398742e-01   +4.915716571183180e-01   +2.258965940754500e-01   +1.751658349318595e-01; +4.756248819827666e-01   +2.939415473887382e-01   +3.866460912571287e-01   +4.883729884945775e-01   +5.578942368659243e-01   +3.888953781026043e-01   +2.804983662803808e-01   +1.316857450539058e-02   +2.612541606706995e-01   +1.297702375408580e-01   +2.475569761903722e-01   +5.913350088768226e-01; +2.451454765549103e-01   +1.434601888166171e-01   +1.011179003140153e-01   +7.407836640701219e-01   +3.440526331127342e-01   +6.009607758936221e-01   +4.225821881611913e-01   +6.225537489709535e-01   +6.237517325383090e-01   +6.978020688466466e-01   +1.266480470658093e-01   +4.794031564369766e-01; +2.244186615640128e-01   +1.514144506870219e-01   +6.294618655781644e-01   +4.146957818408966e-02   +7.613095964624336e-01   +7.336978504352237e-01   +1.508229687620916e-01   +5.844231509235842e-01   +1.954786477496859e-01   +3.398458673057537e-01   +3.473693517358272e-01   +5.062705983360121e-01; +6.702028369253691e-01   +2.592458724077371e-01   +6.913955819016699e-01   +2.650318686783038e-01   +2.886099101491432e-01   +7.907784542074019e-01   +6.087849788583017e-01   +4.566326535488750e-01   +7.587669376003576e-01   +7.918173104778796e-01   +1.305769426918172e-01   +3.133176676233865e-02; +4.466159160410480e-01   +1.029112209707059e-01   +1.745765064902900e-01   +1.521171600957446e-01   +6.361801740457601e-01   +4.035153985710578e-01   +6.847498544392320e-01   +5.009761861394931e-01   +4.569115052088140e-01   +1.372941330281323e-01   +7.419489363585252e-02   +6.567663224949776e-01; +5.188608873667976e-01   +4.216410064173199e-01   +8.085566879706867e-01   +5.908424953982926e-01   +1.928056709851022e-02   +4.201740658160472e-01   +7.975701261984677e-01   +5.057321522441300e-02   +6.422266461397204e-01   +3.264256886662439e-01   +3.761516375621041e-01   +3.606975382086635e-01];
L2E_Input1_iAMPA_netcon = [+8.081205518925226e-01   +8.093229028463692e-01   +8.103003159371486e-01   +8.110697729403963e-01   +8.106467093365605e-01   +8.117952546961028e-01   +8.105915331783119e-01   +8.113357670275503e-01];
L2I_Input2_iAMPA_netcon = [+8.088253197387789e-01   +8.101202173029426e-01   +8.098976594891095e-01   +8.091429412966357e-01   +8.092834402025477e-01   +8.108070925010061e-01   +8.089992887929423e-01   +8.093375707884262e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
