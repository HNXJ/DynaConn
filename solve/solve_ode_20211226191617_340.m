function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.917518497132434e-01   -5.010862314418080e-03   -2.326535112572768e-01   +1.469183969702900e-01   -2.510608857802289e-01   -1.340709882369285e-01   -1.684909513461003e-01   +1.415998152820390e-01   -1.191666093246898e-01   +2.430031996791714e-02   +2.895935674031481e-01   -2.265649993278597e-01   -3.588299697367953e-01   -1.359440628552163e-01   -1.710783942932489e-01   -2.317363622388076e-01; -7.600302410090963e-02   -2.298051363281253e-01   +5.267861018595486e-02   +3.964988616145809e-01   -9.891706466473937e-02   +4.091414211472436e-02   +2.918396773300335e-01   -2.128111036608891e-01   -1.444083214195729e-03   +3.002331003626623e-01   -8.093242501768824e-02   +1.099920022488538e-01   +1.068254370255979e-01   -9.055123512393209e-02   +3.467826394961898e-01   +1.319069945318568e-01; -1.585514130896237e-01   +1.391312826787430e-01   +6.457382085064738e-02   -6.067590742616982e-02   -1.939599342884812e-01   +9.989749566405204e-02   +1.891382384631444e-01   -6.842572536204128e-03   -1.395011438691782e-01   +1.639048276311909e-01   +2.999515682940939e-01   +6.460730586657998e-03   -2.130668027573261e-01   +3.217113776143496e-01   +1.184033464430500e-01   -1.352610525523741e-01; -3.264682488853255e-01   +6.215665259745127e-04   -3.974068537374767e-03   +6.462821492249415e-02   +2.042524359146830e-01   +2.325965082324071e-01   +2.452844155354338e-01   -1.672489453402558e-01   +2.523243403597052e-01   -1.049808913987281e-01   +2.868144690966611e-01   -1.626898166479857e-01   -2.414878529406748e-01   -1.587187840772443e-01   +1.109067248043426e-01   -6.596412277328886e-02; -3.359979321134683e-01   +7.819408388147973e-02   +2.079511281576963e-01   -2.496800362657524e-01   +1.205584034667614e-01   +1.681637093766754e-01   -2.303477222692686e-01   -1.475745446515016e-01   -1.452906775414755e-01   +1.415684601183700e-01   +3.646383615104715e-02   -2.328398319677777e-01   +1.877879613607767e-01   +1.795896473893883e-01   +4.562557636558162e-03   +3.510908002462637e-01; -5.807011188283860e-02   -2.609161482671340e-01   +2.608061649726998e-01   +2.334478598200411e-01   -1.293950769473291e-01   +3.903126996872147e-02   +1.817770163799686e-01   +5.675447585540043e-02   +2.518041259068294e-01   +1.942000232102693e-02   +2.837248616259894e-02   +7.086624050144867e-02   +5.514482439379217e-02   -2.483752900013182e-01   +2.228446405941647e-02   +1.226117399992214e-01; -3.436974816477313e-01   -2.090157401871574e-01   +5.943610636203125e-02   +2.658628260277028e-01   -3.722484402573273e-01   -1.886561304789197e-01   -1.191247812798039e-01   -1.360528045434198e-01   +3.362991378468936e-01   +1.722312660334129e-01   -9.904028956970032e-02   +2.691834138072152e-01   +7.061994533577451e-02   -6.139989434920029e-02   +1.365803642797066e-01   -1.252134006665720e-01; -1.718846685499077e-01   +2.793147017863847e-01   +2.248603495136238e-01   +6.866971561106627e-02   -3.486658313352759e-02   -1.492290786988685e-01   +8.257900918777596e-02   -5.531574446290752e-02   +2.558108045041818e-01   -1.786194806309155e-02   -9.778107389403090e-02   +2.946931983310210e-02   +1.399784845741847e-01   +7.010674537908265e-02   -1.206616951006618e-01   -5.197736516497188e-02; -2.081161154273177e-01   +5.110700679102071e-02   -2.498583238399900e-01   -3.247509764318968e-01   +6.605352634769528e-02   -8.771799107095317e-02   +2.098929292087701e-01   +9.051661896505131e-02   -3.015254002375799e-01   -7.467812373675450e-02   +1.306695309006516e-02   +2.330912693972125e-01   +2.682198721094509e-01   -3.117903373862176e-02   -4.924810481252492e-02   -5.886903708308844e-02; -1.600357981919229e-02   +9.854491032904937e-02   -1.665750070227139e-01   +7.816939030913592e-02   +1.877045369984504e-01   +3.739107333369808e-02   +5.070545258304295e-02   -2.671837461248180e-01   -1.524697890256697e-01   -1.513920705361248e-01   -6.137961812435890e-02   -6.650092793538347e-02   -3.612214272678600e-01   -1.366145325556245e-01   -2.518451419438891e-01   -3.420083745125944e-01; +2.150274077006781e-02   +6.719145127569479e-02   -4.145150197865315e-01   -3.224665157727269e-02   +2.220095931639237e-01   +1.034041867220766e-01   +1.888887463061088e-01   +2.042624263902217e-02   -8.356131384666024e-02   -7.466661734569327e-02   -3.600143291827955e-01   +6.072985504494362e-02   +2.978633414770819e-01   +1.924256301177517e-01   -1.145767273021784e-01   +8.179529282718126e-02; +8.039023661700145e-03   +7.254080179912034e-02   -9.745341015611875e-02   -2.876829629285393e-01   +1.314896799433247e-01   -8.422834620492216e-02   +2.315550612505804e-01   +1.048704278551897e-01   -8.352584090029549e-04   -4.403144163892075e-02   +2.840608759549773e-01   -2.758605720651319e-01   -8.436278951161152e-02   +3.291120364117180e-02   +7.868736486355442e-02   +1.966602662558133e-01; +1.220161566714276e-02   -1.814174252881053e-01   -1.966198741766950e-01   +2.927213520409244e-01   -5.160856568908884e-03   +2.043672170794215e-01   +3.204444253419885e-01   +5.092391653441652e-02   -2.645670174502119e-01   -2.134637465708114e-01   +2.554901112839059e-01   -2.182751239842806e-01   -2.043971014689357e-02   +1.877783757316374e-01   -9.899930968365403e-04   +1.112634424776841e-01; -2.067093903474702e-01   +3.813972481064858e-01   +1.770505695436415e-01   +1.952728035309428e-02   -4.485970588662617e-02   +1.023951371318702e-01   -2.654787558986488e-01   +2.127391049512498e-02   +2.500308656793212e-01   -3.499565943581776e-01   -3.170087830994180e-01   +1.124965039227259e-01   -3.056004774809435e-01   -1.568083312213712e-01   +2.701348107934030e-01   -2.058125932409933e-01; -9.473643057594273e-03   +1.202609999548455e-01   +3.209070336597878e-01   +3.320008713252223e-02   +2.210182940977213e-01   -1.197060478601135e-01   -2.519733164776194e-01   +2.161758444782346e-01   +3.176749641338866e-01   -5.029982228721207e-01   +1.729436237673236e-01   +2.686933455445595e-01   +1.657416593960395e-01   +4.429474545550614e-02   -2.806845186424679e-01   -7.224446689176725e-02; -1.045358519814408e-01   +1.488421182497179e-01   -1.023407738790020e-01   +6.171406571349507e-02   -3.349249629342898e-02   +2.358077969154683e-01   -4.007487523162281e-02   +1.800045267188103e-01   -2.678784611766332e-01   -5.357860667566574e-02   +2.284960187217722e-02   +1.955706462856625e-01   +2.976421609564966e-01   +8.449027849115763e-02   +3.316768466251889e-01   -1.640604340824627e-01];
L1E_L1I_iGABA_netcon = [-4.613213657225633e-03   -1.086163341105333e-01   -1.597264819985535e-02   -2.994936898994940e-01   -3.759808626192450e-01   +6.046212027369356e-02   +1.806497500576632e-01   +1.262168608433886e-01   +6.881646233696891e-02   +1.376685220972994e-02   -1.051085270626219e-01   +2.235699070210529e-01   -7.425414437753231e-02   -3.779903667790863e-02   -1.704919505576635e-02   +7.892179665371460e-02; +2.103402402677181e-03   -4.498384797303634e-03   -1.115923796263427e-02   -2.285519901653331e-01   +2.267594918560831e-01   +1.366812386832315e-01   -1.993265591622703e-01   -9.475301332319966e-02   +1.527630562502760e-01   -1.098459399513044e-01   +3.850864382952526e-02   +1.244291125525967e-01   +5.606166503117777e-02   +1.223836939759834e-01   -6.304293252611595e-02   -3.873770801716943e-01; -2.162681628435226e-01   +3.999294817195411e-01   -1.658123216507956e-01   +2.912221537418403e-01   +3.646777392964052e-01   +3.820141109439631e-02   +2.168042494785734e-01   -3.517678219717047e-01   -2.633335105943314e-01   -2.173359597379404e-01   -9.090374150496858e-02   +8.827683914622464e-03   -4.857538091033087e-02   +1.413994472042427e-01   +5.078233769793178e-02   +2.140240456240923e-01; +3.989543967899991e-01   -2.600196229674859e-01   +1.672315674678460e-01   -3.238339969802602e-01   -2.688062225629168e-01   +6.531374613629920e-02   +8.355637903579788e-02   -1.909106934518844e-01   -9.928528219744530e-02   +7.048400729568106e-02   -1.471645836243403e-01   -2.479118679457143e-01   +1.516134434468733e-01   -2.759035674142022e-01   +3.503676554985511e-01   -3.317808501289877e-01; -1.157859673340565e-01   +1.536419998203433e-01   -3.936509526938387e-01   +7.581202878174870e-02   -2.602467400002463e-02   -2.040858828136895e-01   +1.734005489792710e-01   +4.435697134637413e-02   +1.333713805351282e-01   -3.309551285013128e-02   -2.558376127538846e-01   -4.414863265644403e-01   -1.127113127607815e-01   -1.954271164387303e-01   -3.571359421809611e-02   +6.404212115945714e-02; +7.649796004666244e-02   -3.452548293076227e-01   +2.741575759209108e-01   +1.409210320866342e-01   -2.357877462654061e-01   -3.386189438041421e-01   +2.096877325159882e-01   +1.279392751040159e-01   +3.377367608860343e-03   -1.495031491592013e-01   -2.255328551095861e-01   -3.510708870216881e-02   +1.155423502821724e-01   +1.511854429840434e-01   -2.111047596087617e-01   +2.545940454211675e-01; -2.319366884511394e-01   -2.796735959827609e-01   -1.434534445890848e-01   -3.157901575470367e-01   +1.905131021496981e-01   +3.236430997084850e-01   -1.583755987575862e-01   +3.855082769542790e-02   -2.202934587843099e-01   -3.895474821020062e-01   -1.890005225649473e-01   -2.319865403199284e-01   +2.253572873364882e-01   +3.029637356087448e-02   +1.671443937285930e-01   +3.993541969831681e-02; +2.093017638616069e-01   -4.627401209929435e-01   +9.068574745306775e-02   +3.954384805765426e-01   -2.749521188196173e-01   +3.957705671264575e-01   +6.884681265002983e-02   +2.993928254891019e-01   +1.657131055858764e-01   +4.814469893468398e-01   +2.654637290952427e-01   -1.701482180124375e-01   -2.440332585190302e-01   +2.871062412646994e-01   -2.563999003014025e-01   +3.630703352433937e-01; +2.513691575113615e-02   +3.283890751284955e-01   +4.067277913197079e-01   +2.961567778315691e-01   +5.019576052281829e-02   +1.873562701789792e-01   -2.257913866927345e-01   -2.324513219182885e-01   +2.593040306458213e-01   +6.949531658299546e-02   -7.391076353403386e-02   -1.659061739317248e-01   +2.976102736938245e-02   -1.599975296067278e-02   +1.383254603068573e-02   +2.986226564499289e-01; -1.092217553152696e-01   -2.208568363526881e-01   -1.648442025058886e-01   -9.437425996802984e-02   -7.698179514714323e-02   +3.064533125388213e-01   +5.592099447714216e-02   +1.051715200361694e-01   -8.532424348522664e-02   -2.833851181396995e-01   -6.162853194770985e-01   +1.583275425547992e-01   -4.019900287032649e-01   -1.282725567800823e-01   +2.818624417897075e-02   +4.248227921372886e-01; +2.931087605601834e-01   +2.704034692460580e-01   -8.755555133283946e-02   -8.214184368686657e-02   +3.228114230767169e-02   -4.331099118039016e-01   -1.827275771697723e-01   -1.800686031096234e-01   -9.572135111105381e-03   -1.385135041837245e-01   -1.254843324739947e-02   +2.420324492113129e-01   -1.953153549719067e-01   -2.519914307376643e-01   +2.206424899911931e-01   -2.419981603638603e-01; +9.899722460213978e-03   +5.886115060251496e-03   +2.544361867300772e-01   -1.985107105129605e-01   +2.998768022176519e-01   +1.016237323687767e-01   +3.832161105252023e-01   +2.572173582399273e-02   +6.212706932070697e-02   +2.297391605798746e-01   -2.057030393119972e-01   +3.267344066035957e-01   +2.402394797296440e-01   -4.813335855465627e-02   -1.332892185438470e-01   -9.125154963248719e-02; -3.675567195886451e-03   -5.558451050260989e-02   +1.236821128726812e-01   +2.441999507211542e-01   -1.572876130426656e-01   +3.942990700655357e-01   -4.462582302251348e-02   +3.762841444220778e-01   -1.751280774826786e-02   +9.100882643450564e-02   +7.240181322142787e-02   +1.257589107320622e-02   +6.784117809498814e-02   +1.774250023812527e-01   -8.898744559272823e-02   -1.332061323867838e-01; +1.898922099100268e-01   -1.218918524255650e-01   +1.896749191089886e-01   +1.054469816592414e-01   -5.164666303881620e-02   +3.306080566987649e-01   -2.278942363938880e-01   +3.723805968843969e-01   -1.398749048242196e-01   -1.387955772488571e-01   +4.632423897650523e-02   +4.339002085247734e-02   -1.576079109857856e-01   +1.005768754328396e-01   -7.158789556952300e-02   +5.714917753965503e-01; -1.795028906662230e-02   +4.534995699082157e-01   -1.087167486954591e-01   -1.701415833777107e-01   -2.730117507887262e-01   +1.659241425624285e-01   -1.139776870423705e-01   -2.739277138243109e-02   +4.431922892287827e-01   -9.053731665028997e-02   -4.000618987036737e-01   -3.613401652859114e-01   +5.071605914918650e-02   -2.379630233275497e-01   +3.086413914470956e-01   +3.272449491328855e-01; +3.148603278617026e-01   +4.314362482134693e-01   +4.912785849408046e-01   -1.180765787949686e-02   +1.199363115849284e-01   +1.295734595722657e-01   +1.504344365501349e-01   +1.068520401223917e-01   +1.365935527613293e-02   -1.705457572971261e-01   -1.843458642562246e-02   -1.406544883672418e-01   +2.722953519586150e-01   -4.062288023154337e-01   -9.849468683883422e-03   +2.697157729770874e-01];
L2I_L1I_iGABA_netcon = [-3.562823316566759e-03   +8.911595530201055e-02   +1.547116282915565e-01   -1.787897855358016e-01   +3.284996539518331e-02   +6.463402894259904e-02   -1.329884451572880e-02   +4.882564501649306e-02; -1.456635580603698e-01   +1.654651906398567e-01   -3.468835195036617e-01   +3.022597405648069e-01   +1.598484293520702e-02   -9.096122526263267e-02   +5.148137678257100e-02   -1.961043723620400e-02; -1.187333061080670e-02   +2.495341435168527e-01   -1.550064909810056e-01   -3.092158753543683e-01   +2.698895776088873e-01   +3.803967610236130e-01   +5.877568106555263e-03   -1.907832468166948e-01; -3.112510498855193e-01   -1.684292660175579e-01   +2.092300682910166e-01   +6.416025237973043e-02   +2.630068026807059e-01   -1.940593737246383e-01   -4.100897777769993e-02   +3.237854569386533e-01; -1.190817181977972e-01   +3.486749740466834e-01   -9.891461442072658e-02   +3.543937596868901e-01   +2.748072154933406e-01   -2.983826421811822e-03   -1.193566893491271e-02   +3.806458794322937e-02; -1.562431809887596e-01   +9.361673211001925e-03   -4.614257365973065e-01   -5.204893298147686e-02   +4.520186532374428e-02   -2.078847595425582e-01   -5.239141896729781e-02   +4.962011765472273e-03; +1.531153722212969e-01   -1.683725336438357e-01   -1.832838917593251e-01   -2.455483091614157e-01   -1.056143571518100e-01   -2.495186301569297e-01   +8.655544482798057e-02   -3.318777419379254e-01; +2.198910850083965e-01   +3.810633861004274e-01   -7.124550725968437e-02   +1.575809142430611e-01   -9.753510373252393e-02   +1.353237621837447e-01   +3.281231995598383e-01   -3.666620714612674e-01; -2.441530270141903e-01   +1.319278261117840e-01   -9.025000186605175e-02   -1.457888069395983e-01   +4.242961612954829e-01   -1.299700403571594e-01   -2.796480626715850e-01   -1.083093945527175e-01; +2.071451659191116e-01   -5.648583367593400e-02   -1.411638196496406e-01   +3.339719071299457e-02   -3.252319080941192e-01   -4.784198239788337e-02   -4.109206829470540e-01   -1.273015827451158e-01; -3.888042373727592e-02   -2.563498223748178e-01   -6.650329481954764e-04   +1.704231275746175e-01   -1.885828316339798e-01   -1.621303273697828e-01   -2.595387632517047e-01   -5.069723959981754e-02; +1.718111643985454e-02   +1.127230399711599e-01   -3.001337874511881e-02   +3.812732152598228e-01   +2.511583165230542e-01   -3.162774617348691e-01   -1.153128061382882e-01   +2.381501713217131e-01; -1.471434800521938e-01   +3.420949475482052e-01   +1.277977430638871e-03   +3.932248272784273e-01   -6.707518216462099e-02   -2.148601132375093e-01   -6.055524263326156e-02   -3.413138796157051e-01; -6.788362898800826e-02   +6.123068167056303e-02   +2.306828020031752e-02   +1.793913994475437e-02   -3.857426355637578e-02   +4.115380929225224e-01   -2.140114282307387e-01   -3.729017638030860e-01; -3.665811143736564e-01   -1.963036813629972e-01   -2.509883674394273e-01   +2.544030698830306e-01   +1.499190043475326e-01   +1.245532147457822e-01   +1.033592032668833e-02   -5.475089366827909e-02; -1.338148891276972e-02   -6.440188213490185e-02   -1.089763336858414e-01   +2.257192643307765e-01   -3.379883956508376e-01   +3.270441913273361e-02   -2.708165216299611e-01   -5.745483373320570e-02];
L1I_L2I_iGABA_netcon = [-5.788607568054719e-02   -8.504361466751266e-02   -2.715448370433761e-01   -2.839020122077667e-02   -1.314853649289194e-01   +2.275469585730050e-01   -3.730932065178752e-01   +2.295994475325177e-01   +2.258861108612416e-01   -1.792757096427214e-01   -4.575766089684423e-02   -1.049002897968070e-01   -1.392735506659727e-02   +3.300630737562283e-01   -4.969250394492113e-02   +2.172269296536544e-01; -4.728875139522198e-02   -1.194133219002656e-01   -2.969791944707689e-01   -7.949554504558097e-02   +1.359223173451436e-01   +2.703275804244155e-01   -2.625190437008469e-01   +4.006790674607531e-02   +1.235251277814173e-01   +1.618618143590980e-02   +3.316683282679783e-02   -4.577681619985520e-01   +3.304083396112906e-03   +2.351715253538890e-01   +4.792647390443602e-02   +1.762172125008881e-01; +4.766902094047930e-02   -1.647761474969919e-01   +7.081230231519135e-02   +1.479845083004678e-01   +2.263182111531686e-01   +2.898745272231672e-01   -3.544744870015509e-01   +2.660513536772906e-01   -2.604716138870569e-01   -2.173445440703414e-01   -2.237066343154616e-01   +2.457335357260252e-01   +1.722377609352392e-01   -4.839539060528712e-02   +1.320296026503672e-01   -2.217551376188399e-01; +1.712865111593763e-01   -3.800290827565190e-01   -1.962469240958556e-01   -1.448970058716905e-01   +1.674211139979821e-01   -1.515408247922740e-01   +4.886342663067455e-01   +6.701902179120223e-02   -3.759984231920043e-01   -2.347503534397493e-01   -2.215769310286175e-01   -2.940454486583998e-02   -2.403667804354809e-01   +1.779046358001973e-01   -5.598719901413439e-03   -9.919620272528802e-02; +1.373725486739003e-01   +1.121856850326949e-02   +3.673868727833056e-01   -1.372857221000214e-01   -3.183220811157901e-01   -1.534336217348946e-01   +1.709659592447023e-01   +2.840857052709000e-01   -4.592592787175585e-01   -4.057656733700968e-03   -1.524323789045634e-01   -2.097511466469621e-01   -2.009897552053292e-01   -4.087412060428623e-01   -1.037139368012817e-01   -7.257479892432496e-02; -8.104456561545426e-02   +5.161868355005464e-02   +5.811820593100731e-03   +9.721968798797899e-02   +1.075915345402449e-01   +2.176672349268171e-01   +1.036739928558316e-01   -1.663160194447594e-01   +3.392139908237416e-01   -7.691304000320523e-02   +6.470758384075496e-02   -1.406577236272055e-01   +1.402231470682524e-01   +1.712469202508174e-01   +2.381925208709501e-01   +8.748404377524305e-03; -9.495034804435280e-02   -1.935525095017965e-01   -2.454335810382975e-01   +4.549662400306357e-01   -6.917042698204280e-03   -2.676415580209082e-01   -1.382848776710092e-01   +1.585496982196326e-01   -8.060839474672843e-03   +2.261345665696676e-01   +1.183367146942360e-01   +4.578835041946713e-02   -6.982594383682514e-02   +3.758286868586602e-01   +2.622872802664117e-02   +1.626352250228438e-01; -6.624176072104376e-02   -2.016307048063715e-02   -2.621522902559034e-01   +1.119239924748645e-01   -9.321187103313813e-02   +3.376098950197328e-01   +5.421661471999618e-02   +1.212106376052661e-01   +2.059383343398152e-01   -7.734018725365333e-02   -3.145425058095960e-01   -2.392701760813261e-01   +3.009683325170625e-01   -3.379611044780509e-01   -8.290558339145926e-02   +1.314291238617171e-01];
L2E_L1E_iAMPA_netcon = [+8.129250289142506e-02   +2.297402972951250e-01   -2.526558486413742e-01   +1.127881543606544e-01   -5.320429802689045e-02   +8.611816253372809e-02   +4.461244485477812e-01   -2.091554580240146e-02; +7.338321269167207e-02   -3.586208739289175e-01   -1.863517086040723e-01   -1.279895936582415e-02   +3.063927779864773e-01   +1.970502759811267e-01   -2.215997517896885e-01   -2.758222134607327e-01; -1.617785656833855e-02   +1.100614976929757e-01   -2.021542472580170e-01   +4.393123551692287e-02   +1.540614489605921e-01   -2.249853397524484e-01   +3.713980049092754e-02   +1.892704277184105e-01; +2.007244433679259e-01   -3.855751811694874e-02   +1.273993939721146e-01   -2.343375147043013e-01   -4.899276967280469e-02   -2.195949224462241e-01   -1.250157421207386e-01   +3.512510214639096e-01; -2.610418100046862e-02   +1.148448716755354e-01   -7.815942771149496e-02   -1.496796299820305e-01   -2.618248189600562e-01   -1.925452746124171e-01   -1.802797031620280e-01   +2.043341530483948e-01; +1.025331181433890e-01   +3.245163449703548e-04   +1.829407168243382e-01   +1.339935339256858e-01   -9.160811166333485e-02   +1.909930208866544e-01   -1.373406967137123e-01   +1.232616476359733e-01; +1.275391811487208e-01   -3.331046719122027e-01   -4.364125499556998e-02   +3.096881292388952e-02   +5.979714974126069e-02   -2.462308676946166e-01   -1.887114690486369e-01   -2.473918580086276e-01; -7.519134220356294e-02   -4.428908772055586e-02   -2.827468573982912e-02   -1.140038280428115e-01   +2.378519686968269e-01   -1.724707221383720e-01   +3.014719419229403e-01   -2.293886037732857e-01; +2.772422151680957e-01   -9.917549205583415e-02   -4.896719740330886e-02   -1.718073919694315e-01   +2.652678465842346e-01   +1.500052007430547e-01   -3.882635110768121e-02   -2.531941863468360e-02; +9.931448108408708e-02   -2.844763009562491e-01   +2.818355303774881e-01   +2.630502099359960e-01   -2.777225044469863e-01   -1.338210085397178e-01   +2.465834140838205e-02   +8.769525149946465e-02; -8.585691870642426e-04   +3.201026465015756e-01   -4.134454068396186e-01   +2.668211823651910e-01   +1.998801106094079e-01   +4.486944136533346e-01   +2.447649063023739e-01   -3.964284515947930e-02; +1.692103520337966e-01   +9.087260340891593e-03   -7.603873286080605e-02   -2.178658159246175e-01   -1.237745098907851e-01   -1.098548090474990e-01   -2.501642369536577e-01   +2.683846887045321e-01; -1.697541835046362e-03   -4.656199606760273e-02   -4.778241751134652e-01   -5.297757772795998e-02   +3.343589869191480e-01   -3.396682154106071e-01   -6.703302340711270e-02   -1.746907798823105e-01; +4.000012589976538e-01   +1.347698527484572e-01   -1.700888822788182e-01   -1.421057695847178e-01   +4.283988491125584e-02   -1.152654630682473e-01   -2.980902364203754e-01   -2.638314522453993e-01; +9.958883089476514e-02   -2.860458584807891e-02   +1.785808053230845e-01   -1.582331252846336e-01   -2.763718387532101e-01   +3.340536366698746e-02   +1.408478952811505e-01   -8.050958431624899e-02; -3.117265110444701e-01   -8.653397766505029e-02   +3.837281532912343e-02   +1.143921465581240e-01   -2.631742604918855e-02   +1.324014549167273e-01   +2.847563200711975e-02   -1.120882415820681e-01];
L1E_L2E_iAMPA_netcon = [-7.243459685501312e-02   -1.219808760285297e-01   -2.387643749254528e-01   +2.261439130926289e-01   -2.692663255879420e-01   -9.327783391497434e-02   +5.378957604827370e-02   +5.730297122321214e-02   -1.814575534300664e-01   +2.454672931187693e-02   +1.310708625125289e-01   -3.082643911711357e-01   +2.556727461186515e-01   +4.269112336215595e-01   +2.448047551942047e-01   +1.816051413627479e-01; -6.269721580355446e-02   -3.201930261620261e-01   -1.083720401663842e-02   +1.212766863411795e-01   -1.054829766062875e-01   -1.320538989767293e-01   -7.548565464889580e-02   -1.499526593721021e-01   -6.548871969706037e-02   +5.110594974608457e-02   -3.482682994513312e-01   +2.494033471717796e-01   +1.245716073065163e-01   +7.160191780864555e-02   +4.099046985358937e-01   -3.798115680722364e-02; -2.341426317179543e-02   +2.927838975750831e-02   +1.088262480537072e-01   -3.667352198862537e-01   -1.890450108998134e-01   +7.100776399445584e-02   -1.096222626317165e-01   +2.865298803748575e-01   +2.220499697466021e-01   -1.029602373730911e-01   +3.175490308483384e-01   +3.207777440352796e-02   -1.340308499634777e-01   -1.685106825632207e-01   +3.080282100224297e-01   +1.384225324300369e-01; +2.162708991191055e-01   -1.055413253116482e-01   +1.849949648000714e-01   -1.210751738308281e-02   +2.648007463655563e-01   +3.275418013722460e-01   +1.578371882017238e-01   -1.054491624870133e-01   +1.308681175199617e-01   -1.670781332842736e-01   -3.517084596834736e-01   +1.340537806593517e-01   -7.016290322718205e-02   +6.381500954688089e-02   +3.240023514119181e-02   -7.555490158852962e-02; +2.985354011253173e-01   -2.747929574780433e-01   +1.058735249335835e-01   +1.140179129527501e-01   -2.609990133452467e-01   -1.500708510912729e-02   +9.312165613372041e-02   +3.852690748833835e-01   +4.824238731766498e-02   +1.535630773379053e-01   +3.290624153889874e-01   +5.213102014101703e-04   +3.808896012985901e-01   +6.096580571429444e-03   +1.692491147785480e-02   +2.139182149587511e-01; -8.540148188781665e-02   -3.626093117758925e-02   +1.206930703861676e-01   -1.599173687026413e-02   +1.972994450201236e-01   +6.494385711646081e-02   -7.529589321327625e-02   -9.492841457960620e-02   -3.337654671499422e-01   -2.719255937696906e-01   -2.350925029409531e-02   +3.159615797634671e-03   -4.576747162086132e-03   -2.580287239352176e-01   -1.505072113277619e-01   -1.958136285877715e-01; -3.048805933692084e-02   +2.360181104540325e-01   -4.920508042519637e-02   -3.161056421202991e-01   +1.027311016045517e-01   -6.654201403596971e-02   +1.886148898061987e-01   +3.073973287493388e-01   -1.011079216223134e-01   -1.062159593100694e-01   +1.978682530368814e-01   -6.325750057809508e-02   -1.703678869081914e-01   -1.793573932017679e-01   +2.115303868031791e-01   +1.870458648897099e-01; -4.354587552882315e-02   -3.958858678157626e-01   -8.790390904760183e-02   +3.736169477870640e-01   +2.477413396842040e-01   +2.909930390600611e-01   -9.930576073664903e-02   +3.938267912235793e-01   +1.601458265958541e-01   +2.768756026645240e-02   -5.650765982191082e-02   +6.583228320426841e-02   -1.931465290949627e-01   +1.499126099853456e-01   -2.250335073849637e-01   -4.938058125692413e-01];
L2I_L2E_iAMPA_netcon = [+2.959551088245388e-01   +4.981474220689090e-02   +4.184298628902353e-01   +1.438223853204846e-01   -1.387770868647851e-01   +9.311839148275587e-02   -3.669115664629656e-01   +8.486426494750089e-02; +1.136285111598821e-01   +2.381685288541475e-01   -4.686264445030189e-02   -6.011449437255614e-02   -7.070515770163140e-02   +2.098969666205204e-01   +2.801951472562487e-01   +1.865802329877187e-01; -1.224363400092107e-01   -2.015407469363774e-01   -3.425578404273926e-01   -2.056519857457400e-01   +1.960795104699673e-01   -4.278157131303556e-02   -3.583529240570176e-01   -1.617329655595551e-03; +2.846958633422561e-02   +4.274148811578422e-02   -2.762864339426850e-01   +1.167589144141029e-03   -7.999297676280211e-02   +7.516841767812540e-02   +2.640864623373498e-02   -1.460432994849407e-01; -1.543413861682504e-01   -1.159234411186185e-01   -3.565248378020724e-01   +3.489633805714209e-02   -3.910723744415166e-02   -1.560668439133009e-01   +8.966431605798800e-02   -1.658031430252601e-01; +3.843921724488457e-01   +2.666461767622976e-02   -5.702570456905698e-03   -6.788965152642185e-03   +2.596405587080632e-01   -1.118962735301994e-02   +2.505086953143588e-01   +1.161728540653773e-01; -9.829748732377792e-02   -1.168011889649320e-01   +6.866181341240998e-02   -2.092745965597931e-01   -6.797625348089860e-02   +1.110860444356370e-01   -3.049691024204145e-01   +1.852943574003987e-01; -3.993904815392969e-01   -2.122601532559495e-02   +3.739350509326089e-02   +5.600667549918952e-01   +1.335140214343009e-01   -2.596459561025022e-01   +6.376407160167651e-03   +3.387171538447777e-01];
L2E_L2I_iGABA_netcon = [-1.122868714342410e-01   -2.615898954746277e-01   +2.559037730487113e-02   -5.413681877341207e-02   +3.151442768472744e-01   -2.117548430651330e-01   +6.107581704507735e-02   +2.743937206847510e-01; -8.561884951777318e-02   +5.787805049521730e-02   -1.354219712606757e-01   +9.264406799905381e-02   -6.699545531954251e-02   -7.893292937647177e-02   +1.056200102617278e-01   +4.365790986914489e-03; +2.745563533581521e-02   -2.718113739646223e-02   -2.604492945918288e-01   -2.616781667986601e-01   -8.602162135162575e-02   +1.079640075020393e-01   -1.557657267009724e-01   +1.254068809389401e-01; -9.235332736208510e-02   +1.032914985892092e-01   -1.809091683065135e-01   +3.107708645204143e-01   -3.306368726915883e-01   -5.281950761858357e-02   -1.281735075545795e-01   +7.505550685719890e-02; -1.225750862673015e-01   +1.319233903927788e-01   +5.596336941504956e-02   -1.360565119933064e-01   +3.713320210831261e-01   +7.164670752393032e-02   -3.782745611674854e-02   +1.423030623976947e-01; -6.412998851700596e-02   +2.463851960043892e-02   -1.522764457115632e-01   +2.605688823281865e-01   -1.118273675447970e-01   +5.022842698511832e-02   +2.443833307000843e-01   -2.828510497244250e-01; -2.593133022724967e-02   +2.748394600237582e-02   +4.250398959868291e-01   +1.078144766266061e-01   +8.255012432063981e-02   -1.930607662517251e-01   -2.999477407320256e-02   -1.546958182386807e-01; +3.895171041695099e-02   +2.824513124918398e-01   +1.418336301917199e-01   +2.761114618653300e-02   +1.712666973269604e-01   +1.814754907761705e-01   -1.093235829662473e-01   +1.046095185171362e-01];
L3E_L2E_iAMPA_netcon = [-9.488133093207532e-02   -2.628272645000893e-01   +6.408884085554595e-03   -1.027945106747815e-01   +9.811737689050121e-02   -1.637644663055757e-01   +2.086560047939308e-01   -1.588133839429919e-01   +8.927022586195039e-02   -1.457478702040339e-01   +3.348519513961922e-01   +6.073930144776468e-02; +7.141142498475009e-02   +3.085155071361051e-01   +1.816743307300155e-01   +1.041259776968285e-01   +2.483360682497712e-01   +2.700943491530251e-03   +3.222304395547793e-02   +1.588377312204381e-01   -2.394173214413838e-01   +2.763199125896363e-01   +8.407703638972780e-02   +2.387317181513282e-02; +9.130768184204108e-03   +4.064065421641330e-01   +3.745769770102724e-01   -1.650291138607127e-01   -2.651743145926019e-01   +3.440249281370192e-01   -8.465434276665998e-02   +1.409297198546257e-01   -2.342134119378908e-02   -3.578513169694364e-02   -7.505599639282068e-02   +8.387042096510534e-02; +3.937673988397712e-01   -2.629198576325539e-02   -3.416946743192413e-01   -1.541462393641482e-01   +5.024548137524866e-02   +8.396407100581771e-02   +1.243873901872897e-01   -6.215339473147408e-02   +1.061490559501033e-01   +8.860890950711978e-02   -6.889049216604695e-02   +3.089398739746967e-01; -6.567381774605142e-02   +2.426084481973222e-01   +1.451732631489150e-01   -3.047615560873704e-01   -2.588124614995086e-01   +3.341165862752246e-01   -3.806711812648332e-02   +3.946449480552119e-02   +4.026870666631846e-02   -6.798521032899185e-03   +6.780870356416564e-02   +1.744972779669547e-01; -2.056775006536023e-02   -2.443401360045809e-01   -1.005621581163947e-01   +1.730568315833107e-01   +3.501821600374047e-01   +4.681724856621812e-02   -1.067755634922060e-01   -2.635077461291547e-01   +1.786856559155594e-01   -6.870584455633180e-02   +2.478094881937926e-04   -6.432588626100381e-02; -2.316110426468770e-01   +2.586763418716215e-01   +1.717503111342002e-01   +1.369503356461392e-01   -1.252564509811779e-01   +1.419602880831137e-01   -7.007680303445232e-02   +1.301407516817054e-01   +3.182951790542443e-01   -1.870216741443465e-01   -3.648269400789782e-01   +1.849155923282513e-01; -2.327865640826437e-01   +3.496743005852315e-01   +5.998924400738188e-02   +3.416327475484565e-02   +2.211870645298893e-01   -3.757103423301957e-01   -2.969914082997501e-01   -2.045573241908787e-01   +1.418546485105135e-02   -2.378219718724031e-01   -5.452871522498758e-02   -2.118251074207420e-02];
L3I_L2I_iGABA_netcon = [-1.328625809683000e-01   -1.244953035929832e-01   -4.635160071429539e-02   +2.623291054688593e-01   -1.639374918771412e-01   -1.204933041374540e-01   +3.097423808351621e-01   +3.123376354038920e-02   +2.835122628945406e-01   -3.412149660244485e-01   +1.768320048037010e-02   -1.477814384136777e-01; -3.178799181988026e-01   +2.758986982025751e-01   +1.720095283153456e-02   -2.716153886559436e-01   -1.649583354371161e-01   +1.952647047132782e-01   +1.455264767804392e-01   -2.730160247832979e-01   -2.413077149502446e-01   +7.422276136261147e-02   -2.481539887676755e-02   +2.039380401613677e-01; +6.233549123766552e-02   +5.775773126285649e-02   +1.014114568038413e-01   -5.165621553526681e-02   +1.008030505309669e-01   -1.245800497031828e-01   +7.423084385475914e-02   +3.119294377529020e-01   +3.677293724269594e-01   -9.090504358711972e-02   +9.097589467860359e-02   -2.398449734786032e-01; +1.248081732472703e-01   -5.932778891995311e-02   +1.634475545066025e-01   -2.594264833466521e-01   +2.185190565785850e-01   +1.788900731290677e-01   +1.801147935853373e-01   +3.549505169481881e-01   +2.988952274281564e-01   +2.351703371972373e-01   -3.310996660322067e-01   -4.314297084118617e-01; +1.547311642707972e-01   +2.370165865252680e-01   -7.842624788043639e-02   +2.220145064819141e-01   -2.065088194572883e-01   -2.586126971756999e-01   +2.976030042648907e-01   +1.088224064260228e-01   +1.114467995145533e-01   +1.046117973520775e-01   +1.890524646077466e-02   +2.113312476267885e-01; +2.652144441520611e-01   +2.478052297436465e-01   -2.936344469574648e-02   -3.510854785152459e-01   +7.666941207928810e-02   +2.593406891419295e-01   -6.341580440817782e-02   +2.013737068309714e-01   +7.775264401636109e-02   -7.459187124042921e-03   -2.004614975119932e-01   +3.073526238896188e-01; -3.939320221731472e-02   -3.804136610690391e-02   -1.890896214676258e-01   -1.849293101970483e-03   +4.335996661427360e-02   +2.008459122450479e-01   +1.810750464219776e-02   +1.692820425916260e-01   -2.866379127663219e-01   -1.092518231740301e-01   -1.162078836069325e-01   +8.080260833849132e-02; -2.433892878664868e-01   -3.602839620591273e-01   -9.603123809980058e-02   +3.798510308415642e-02   -9.722112031755510e-02   -5.171586635144577e-02   -8.155894243219482e-02   -4.112685302356639e-02   +1.565947395893592e-02   +3.020365575050907e-02   -3.873497991673575e-01   -1.021249595639511e-01];
L2E_L3E_iAMPA_netcon = [+1.219509025380681e-01   -2.698008487326475e-01   +1.816267123702150e-01   -2.603104749022710e-02   -2.315602528849436e-01   +1.127189022977899e-01   +7.814706210846921e-02   -3.940309521777559e-01; +2.986928861824221e-01   -1.224696365348784e-01   +8.691251570264030e-02   +3.117251863879543e-01   +7.479040850270016e-02   -1.208732359176446e-01   -9.548221375289095e-02   +3.809932168967271e-02; +2.931869408942456e-02   +2.151613686502605e-02   +7.082435653261056e-02   -1.885005330333715e-01   +7.829021587205338e-02   +6.289017008107212e-02   +1.597248112908828e-01   +2.664946986041306e-01; -4.734692930108213e-01   -2.192024250248574e-01   -1.344975911553428e-01   +9.737186855852745e-02   +1.897666596207562e-01   -5.545815375543869e-02   +8.549380028880502e-02   -1.008384596938448e-01; +2.204379991214694e-01   +3.279078922831921e-02   +1.410797122003860e-01   +9.642053436866252e-02   -1.167172736013763e-01   -8.885450290060623e-02   +9.175889914570048e-02   -8.927925680954799e-02; -6.169231888266236e-03   +1.029185486914543e-01   -1.360140770001171e-01   -4.326182715823577e-01   +6.884151966081690e-02   -1.543527137020656e-01   +4.094014773483559e-02   -2.224919751952988e-01; +1.111927097753111e-01   +2.660257375778465e-01   +1.727856156242298e-02   +9.893916000853638e-02   +8.447517191798495e-03   +4.054987188200028e-02   -2.022469782704880e-01   +2.899782676431388e-02; -8.119464423033509e-02   -1.243256798557928e-01   +2.080501173082205e-01   -9.138380221053291e-02   -6.176618970223274e-02   -1.439622856442453e-01   +1.015569477275004e-01   +7.563070434771910e-02; +1.253692041323636e-01   -2.444499890080449e-01   -1.498930666474872e-01   -1.555187486172408e-01   +3.064053481109288e-01   +2.125889930275094e-01   +3.979149761405810e-01   -1.715574940246905e-01; +1.180069780948043e-01   +5.074470139639366e-02   -1.731485969287930e-01   +8.939794344362489e-02   +2.379896939721440e-01   -2.916945008308153e-01   +1.077944917889805e-01   -1.009631396010197e-01; -5.535455634150221e-02   +4.378330702649980e-03   -1.513283977826285e-01   +1.647857917141316e-01   -1.607928600735387e-01   +1.355027731443817e-01   +1.213557354773571e-01   +6.892750099379276e-02; -2.458457194532601e-01   -1.081307137079432e-01   -2.151905521605146e-02   -2.408983898431993e-02   +3.040391129116465e-01   -1.228779031423830e-01   -9.882725154109834e-02   -1.013548056953541e-01];
L2I_L3I_iGABA_netcon = [-3.508238273591345e-01   +2.502264945120945e-02   +4.395118407714653e-01   -7.465172709008545e-03   +1.604924783737589e-01   +1.880257974644291e-01   -4.104552538469339e-02   -3.056785442867402e-02; +1.515285888674590e-01   -1.300823689316954e-01   -2.432838257236819e-01   -3.392604258639135e-01   -8.235507544107144e-02   +4.233787270568366e-01   +4.694363941463855e-02   -2.137809434595657e-01; -1.159960568689320e-01   +1.942313194379819e-01   -2.880116767245736e-01   +6.609903456908585e-02   +4.189652359228833e-01   +1.022667870095879e-01   +7.041779316639463e-02   -4.723629237423717e-02; +1.419763589264585e-01   +2.239015451855875e-01   +7.484206229556743e-02   +1.268272912650662e-01   -2.203026365288306e-01   -2.210948261225641e-01   -9.285788564404064e-02   +5.966472745629475e-02; +1.874294281053135e-02   -1.473904085333200e-01   +2.334245304175959e-01   +5.862235766841924e-02   -1.115894252384182e-01   -6.630406084737062e-02   +1.456219507874243e-01   -6.145704548952151e-02; +1.083547340208233e-01   -1.348486764068324e-01   -1.038638531317616e-01   -1.294529078508702e-02   -2.454145775774523e-01   +1.448936679616495e-01   +4.546802665059756e-02   +2.212148389763289e-01; +1.038144685238393e-01   +1.245381684994014e-01   +9.775049876004056e-02   +9.848100667282630e-03   -2.399135903375701e-01   -2.747477037576937e-02   +2.786164395366259e-01   -1.421850882879370e-02; -1.227038131867730e-01   +1.338835570432318e-01   -3.052406522980682e-02   -3.292966671263894e-01   -4.170198748402753e-01   -2.443422485898756e-01   +3.372282512990291e-01   +2.047000246192786e-01; -1.820138044745637e-01   -3.137090162158073e-01   -8.654785517831091e-02   +3.610412166230342e-01   -6.988808664967383e-02   -1.336553423600661e-01   +1.229632609109259e-01   -2.259787699644787e-01; +2.017597970250346e-01   -3.250491255083489e-01   -8.934926323670349e-02   -1.763923261867529e-01   +9.278121745278153e-02   -1.931812941720377e-01   -1.754323137237607e-01   +1.542471743852422e-01; -2.257364193768464e-01   +4.252403441780579e-02   -2.670827016846081e-01   -3.319918426481870e-01   -1.186137093357362e-01   +3.984386572176177e-02   +1.333537386322134e-01   -1.240072853756432e-01; +2.498752106622987e-01   +3.313992621350235e-02   +6.040227215899503e-02   +9.521599606271453e-02   +1.978819123783171e-01   +7.593717071346287e-02   +4.708526098624969e-01   -1.319284015415994e-01];
L3I_L3E_iAMPA_netcon = [-1.499619526939337e-01   -2.585537329310131e-02   +1.152143411789225e-01   +3.138229276794525e-01   -1.655524549138507e-02   -2.096998979008610e-01   -1.696155777669844e-01   +1.260875966676799e-01   +2.875816484001879e-01   +2.455191410027790e-01   -2.203737346984082e-01   +2.394043040318937e-01; -3.334016670127019e-03   -1.526181652921338e-01   -2.477826432184416e-01   -5.103033428389338e-02   +1.628634908367833e-01   +2.068972698924618e-01   -1.428648615764316e-01   +9.394845746478220e-02   +1.477597062201953e-01   +4.863175250621198e-01   +7.109552350651327e-02   +4.632012440279805e-01; -6.580919323522851e-02   -1.863667305175183e-01   +6.025641957022591e-02   +2.031231113027349e-01   +2.410732143020221e-01   -1.911421231722389e-01   +2.230815332209355e-01   +4.241999361275714e-02   -1.079666650619318e-01   +4.248547010013606e-02   -5.962875078051152e-02   +1.246037014647252e-02; -2.874999923318347e-01   +1.749211868212694e-01   -2.608795962807700e-01   -3.467773897461499e-01   -1.546425789157385e-01   +2.110479676950620e-01   -9.795569523002154e-02   -4.552195358031805e-01   +2.396695713518210e-01   -2.581957081962958e-01   -2.658226519241177e-02   -1.187507858668968e-01; -1.895507731941507e-01   +9.048346546073714e-02   -2.968353539202026e-01   +2.172254820952232e-01   +1.410227375927312e-01   -1.453443900267275e-02   +5.056612597200063e-01   +5.863496917240976e-02   +1.780339787183688e-01   -8.023975704769257e-02   +2.292508525823709e-01   -1.695862350002416e-01; -2.265558170181350e-01   +4.283847757344053e-02   -8.192949005716239e-02   +3.548280219915441e-01   -2.945575631247266e-01   +3.516241385963167e-01   +1.538343352776152e-01   +9.280317481390210e-02   -5.253142112618417e-02   -2.478464038485832e-01   +4.610112813423616e-02   +3.734436640541813e-01; +1.927908883787873e-01   +1.615324895908417e-01   -1.684670412773724e-01   +2.107660809915673e-01   -8.033608597321727e-02   -2.277390956210343e-01   -1.887073842429286e-01   -3.593408009786916e-02   +1.485218721926610e-01   -2.176246736012715e-01   -5.432725625310936e-02   -2.333371100807729e-01; +4.154861442687077e-02   -2.308534138326893e-01   -1.440373094365358e-01   +3.406736207478263e-01   -1.125041833820152e-01   -1.903115543504453e-01   +3.223844680538144e-01   +2.896374921071549e-01   +2.204627784568417e-01   +2.130442876291178e-01   -2.405115152800782e-01   -2.536075826502526e-01; +1.065370163896137e-01   -2.718130522237084e-01   +1.296586405884665e-01   +4.466279009198212e-02   +1.046041846477765e-01   -1.633737388940449e-01   -2.060112627248117e-02   +1.302876396395625e-01   -8.668670620953045e-02   +1.292882439203777e-01   -1.739681816026044e-01   +8.971047985601616e-02; +6.350039384189086e-02   +8.807487805358313e-02   -1.687430645345108e-01   -2.498432571033304e-01   -1.274409499636069e-01   -2.186634187802816e-01   +1.376234681889831e-01   +3.117286392784248e-01   +1.256233107505793e-01   +9.763643825087633e-02   +7.804937471833748e-02   +2.068819957473484e-01; -2.081942334495477e-01   +1.185402862157909e-01   -7.287316550821599e-03   -2.918583646274250e-01   +3.513732599307723e-02   -2.579038793553310e-01   +3.314357650788012e-01   -2.305420050857774e-01   +8.601914397375071e-02   -7.166867817095061e-02   +1.026501177415264e-01   -1.558810842936642e-01; -3.298249045268442e-01   -1.344262727148192e-03   +1.033190515081550e-01   +2.486765358516349e-01   -1.010715458872209e-01   +2.198946244113440e-01   +3.332537739861667e-01   -3.778061488579949e-02   -1.735804883738337e-01   -2.824667937906136e-01   -3.594630551567120e-03   -1.526752674394377e-01];
L3E_L3I_iGABA_netcon = [+1.057502602072019e-01   -2.976378337475879e-01   +2.618102119342127e-01   -2.129009470277733e-02   -5.319062201469696e-02   -2.450866515123354e-01   -1.214311543591012e-01   -9.770866282005372e-02   -2.880877028282273e-01   +1.296964682669761e-02   +1.386020239196665e-01   +1.732558049778915e-01; +1.635676365617704e-01   -1.690399297338080e-01   +1.742072480738994e-01   +2.591009218329471e-02   -4.370011125357087e-01   -7.835372672019586e-02   -1.193514154021987e-02   +2.645476114445778e-01   -3.224341983560116e-01   -2.929328838424492e-01   +9.221339054568428e-02   +8.834547801176079e-02; -1.515379490558692e-01   +1.378747825847265e-01   -1.314883812645906e-01   -2.193837506953647e-02   -3.897240583635919e-01   -2.151462071694494e-01   +1.288314711254793e-01   +2.678358930983832e-01   -1.253917677868328e-01   -6.600271015256977e-02   +2.364958654706759e-02   -3.537874819792619e-01; -2.034454009149551e-01   +1.922899974116938e-01   +1.501015233755904e-01   +2.046395944156544e-01   +1.225311428706577e-01   -1.221319145003814e-01   -5.960097908480755e-02   +3.639558580545147e-02   -6.265915429049392e-02   +2.343846627723949e-01   +1.497708892185620e-01   +1.088574121771445e-01; -6.985262668088479e-02   -2.135773849084801e-01   -1.562846844378903e-01   -8.716770028644558e-02   +1.053919964595877e-01   +4.118496731981020e-01   -3.964136765039211e-01   +2.377837774079218e-01   +1.595769581539127e-01   +4.809346058767319e-02   -3.447314299570152e-01   -7.930616883456798e-02; +1.462771729660189e-01   -3.515734065418022e-02   +2.070810045003410e-01   +6.732056323521590e-02   -8.260775464283875e-02   +2.726950586500881e-01   +3.789932885220661e-02   -1.796457713661865e-01   -9.466045429577988e-02   -2.983647233017829e-01   +3.543905433453991e-01   +1.398204796913436e-01; -1.125712915730783e-01   +4.041421870737774e-02   +9.307033488637462e-02   -1.088338464375001e-01   -1.611747990731672e-01   -1.052377922805188e-01   +6.414486087173424e-02   -4.209464273102390e-02   +3.084971062919928e-01   +1.419725130514293e-02   +3.007746765256736e-01   -1.064846162610791e-01; +1.233523356798513e-01   +2.556989258033295e-01   +1.502124257657491e-01   +3.681629509637448e-02   +2.197632662101801e-02   -1.861464750711118e-01   -7.395671940388940e-02   -2.922422481278338e-01   -9.036780549093720e-02   +1.337837571232234e-02   -8.872347834000810e-02   -1.456638991581483e-01; -1.428091164791324e-01   +1.335649197755697e-01   +8.296564490444153e-02   +1.244672756479977e-01   +1.289204807219031e-01   -1.873622709847124e-01   +3.494641874451049e-01   +1.126575222753558e-01   +1.123517152907872e-01   -5.429833910819248e-03   +1.872411332345086e-01   +3.549223959994724e-01; -1.170219712234149e-01   -8.015296798579739e-02   -1.015062553457372e-01   +2.647577137212436e-02   -1.911320497583357e-01   -3.827736668681661e-01   +4.148554302098512e-03   -2.256815697913423e-01   +1.385861934284746e-01   -1.141077449344420e-01   -1.100433003112278e-01   +3.633491576565052e-01; +1.541186252126954e-01   +3.751452825464821e-01   +7.192090135734158e-02   +1.418914266068181e-01   -2.517254360900326e-01   -2.100618267818308e-01   +6.926576145341887e-02   -7.238537703143777e-02   +1.844172869434501e-02   -2.473119411562372e-01   -4.281954603341439e-01   +3.624900710293059e-01; +2.003177257636916e-01   +1.989232740284676e-02   +1.028892566147098e-01   -2.104642562401712e-01   -4.201427761767397e-01   +9.737625443056516e-02   -3.769856520615505e-02   +2.937832819844429e-01   +3.175560329814937e-01   -2.687985456683074e-01   +7.485965877250038e-02   +2.423556951621263e-01];
L2E_Input1_iAMPA_netcon = [-2.022754448514498e-01   +2.811928102390896e-01   +6.035748524830425e-02   -1.679759785717072e-01   +1.331594363246563e-01   +1.126371760396785e-01   +1.676413327061714e-01   -2.041741547137676e-01];
L2I_Input2_iAMPA_netcon = [+7.683159724591251e-02   +6.903734907231034e-02   +1.515993028867876e-02   -2.391364041147704e-01   -1.398445677628336e-01   +2.687563282376204e-02   +2.691323392720372e-01   +1.170421511748357e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
