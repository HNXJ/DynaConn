function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.233705806137223e-01   +4.228052754931675e-01   +5.306105993526830e-01   +6.371984638674481e-01   +6.005484175955571e-01   +3.408130007938399e-01   +6.478573351989699e-01   +8.400218948180167e-01   +5.451440294280329e-01   +1.929365247935852e-01   +4.428153402628737e-02   +8.225562215630829e-01   +7.676926723792613e-01   +1.101981452222300e-01   -1.260328942641908e-04   +8.431407114913976e-02; +9.833646424880701e-01   +9.512345269870125e-02   +3.242013660914894e-01   +9.572386776039253e-01   +3.872454480950613e-01   +6.059457154650156e-01   +6.785592094151243e-01   +8.316825635975119e-01   +7.224584712036234e-01   +1.385613305659480e-01   +7.536836339273563e-01   +4.297899704810598e-01   +1.679904941038077e-01   +1.358082055064097e-01   +8.651541705756983e-01   +6.270962389756750e-01; +7.310304184062276e-01   +5.980761487130614e-01   +1.057448014064963e-01   +2.419049141112716e-01   +9.161566933325737e-01   +1.914441898687786e-01   +6.352469026141921e-01   +2.559419649158030e-01   +5.220303984046076e-01   +6.959625433767369e-01   +2.424464990439177e-01   +8.873320299833687e-01   +8.635684773834618e-01   +6.789542941223068e-01   +6.125396006140225e-01   +6.615815053634712e-01; +3.440720433366776e-01   +4.723616901328449e-01   +6.116249248792127e-01   +6.757856676858297e-01   +6.422907398243430e-04   +7.388964781998498e-01   +9.454627481440235e-01   +6.131822518814657e-01   +9.930575952048130e-01   +9.283009933208972e-02   +4.430717157986786e-01   +3.916142955228775e-01   +9.905983628630777e-01   +4.944844968267806e-01   +9.893012291457091e-01   +7.298728166411246e-01; +5.854596340822732e-01   +6.963691350779931e-01   +7.793753005210019e-01   +2.882713793321737e-01   +4.621677344871779e-01   +2.425677001757673e-01   +2.088953698270844e-01   +5.829611530739348e-01   +2.204773084810492e-01   +5.240963203235351e-01   +6.875334247162378e-01   +7.693904609672427e-01   +5.158291432496958e-01   +1.893301829791230e-01   +5.261746754426833e-01   +8.922002705851406e-01; +1.091753166751470e-01   +7.010584550817025e-01   +4.243754491809005e-01   +6.706776039290947e-01   +4.249111702465854e-01   +9.182882659643905e-01   +7.097953960874051e-01   +5.403074278158163e-01   +1.049584402987090e-01   +5.309847652988254e-01   +3.587561973054122e-01   +3.974268770781486e-01   +8.844698147206452e-01   +4.943502226481319e-01   +4.805643608764619e-01   +9.825506310761201e-01; +9.059523980531355e-01   +6.395203752478108e-01   +9.048459756513087e-02   +6.950687459708904e-01   +4.612052326368374e-01   +2.703945442526005e-01   +2.371053081242538e-01   +8.708744445738237e-01   +1.111409392669735e-01   +8.622842202674655e-01   +7.365221628036023e-01   +8.098886965752963e-01   +5.874083805069573e-01   +1.480291808044615e-01   +8.016397345835200e-01   +7.690349500949932e-01; +8.803313324536942e-01   +3.390806498794557e-02   +2.659076111427072e-01   +6.716966837717436e-02   +7.703963696311874e-01   +7.656506716540140e-01   +1.195545753571566e-01   +2.642138922468390e-01   +6.548561958287953e-02   +4.852571970783939e-01   +3.940121455097020e-01   +7.551179085153349e-01   +1.544724104431296e-01   +5.358564964816611e-02   +2.289709341333584e-01   +5.828239176320895e-01; +8.173870435326851e-01   +6.844014903260423e-02   +1.530079329809922e-01   +2.536696767698994e-01   +3.235321933828094e-01   +1.894254873844124e-01   +6.075517271451091e-01   +3.169120134046400e-01   +4.040573208324690e-01   +3.928575891594743e-01   +6.844990596271228e-01   +3.775023005898818e-01   +1.995511150742792e-01   +8.511242724445245e-01   +4.970588202077700e-01   +9.264637135572005e-01; +2.605119920304492e-01   +3.189403515283307e-01   +2.814545175373114e-01   +2.218932376320689e-01   +7.846664974554233e-01   +2.865425067105202e-01   +4.512264040800300e-01   +1.192895977021820e-01   +4.473216768105003e-01   +6.723384286895127e-01   +7.041406827674648e-01   +2.168663553515694e-01   +4.071137615289704e-01   +5.620114804802624e-01   +8.988701748571413e-01   +5.810543122610077e-01; +5.942055594792148e-01   +5.302095917133023e-01   +4.415049609677700e-01   +6.686541861762390e-01   +4.705844483099773e-01   +9.086574433204682e-02   +4.587081120417712e-01   +9.401787003545603e-01   +3.654475621521911e-01   +7.424665957662346e-01   +4.428381019295471e-01   +7.903542561943849e-01   +7.482718167505074e-01   +9.301035340861632e-01   +5.757380151600383e-01   +1.597345706756463e-02; +2.252415093277393e-02   +6.536060571003316e-01   +5.265203587328063e-01   +8.439066372389237e-01   +3.549321652842872e-02   +5.781190560006211e-01   +6.623171715092201e-01   +6.466820480919416e-01   +7.621894256183817e-01   +5.188522144779467e-01   +1.859004655094127e-02   +9.493761113334073e-01   +8.242907978057978e-01   +6.978226519257558e-01   +8.447861384606987e-01   +1.214344328458474e-01; +4.263003786155967e-01   +4.077766456344304e-01   +4.582952708215090e-01   +3.455283211756184e-01   +1.768708725819507e-01   +6.837247589804604e-01   +7.698926382518010e-01   +4.801314418577610e-01   +6.268644070056854e-01   +3.459162592861902e-01   +3.297688089876737e-01   +3.289783950680827e-01   +7.913364807851387e-01   +5.838690342096128e-01   +7.388481588226354e-01   +8.620572143610316e-01; +3.123367216466783e-01   +8.189860388476466e-01   +8.745891714415831e-01   +7.815763762991540e-01   +7.207133995619636e-01   +5.473386467300031e-01   +3.501655727098762e-01   +6.394924749251687e-01   +7.724603404610527e-01   +1.495105907491902e-01   +4.233996891474005e-01   +6.720659763156819e-01   +3.188109745603349e-01   +8.159142796323391e-01   +5.858844267948975e-01   +4.831677236004926e-01; +1.602608304525533e-01   +7.196548893207858e-01   +5.190924452547777e-01   +6.764406030740037e-01   +4.738771002948474e-01   +4.246994472442579e-01   +6.619817621789106e-01   +5.446220076953252e-01   +9.336548088401999e-01   +5.867693387093587e-01   +2.695041914508779e-01   +4.404693904790969e-01   +5.336609379467659e-01   +8.804908131304181e-01   +2.454921022763597e-01   +8.446624468035685e-01; +1.779509375847177e-01   +9.686358360771479e-01   +9.450510601131012e-01   +7.700693890231274e-03   +1.529562411472895e-01   +6.435743295917433e-01   +4.154392134737180e-01   +6.468210483556689e-01   +9.731834276565969e-01   +2.614584670188386e-01   +1.969523473256380e-01   +8.323231406426866e-01   +9.034025245060034e-02   +9.896193558248597e-01   +6.656280086196597e-01   +2.095783248298106e-01];
L1E_L1I_iGABA_netcon = [+5.511632311091358e-01   +6.946673118796487e-01   +1.049431725976687e-01   +1.771304597292432e-01   +5.547424233788582e-02   +1.790791986419200e-01   +5.960117993539492e-01   +9.964049996366178e-01   +3.389485406338401e-01   +7.790528163274952e-01   +6.827509953793414e-01   +3.652182872131321e-01   +7.826808058757785e-01   +4.326523122281578e-01   +5.942977787967034e-02   +9.750682766078768e-02; +6.312245217907472e-01   +4.991339173275877e-01   +1.421435805924412e-01   +3.984810885984872e-01   +1.777941417767421e-01   +3.604938075191136e-01   +3.005291851665011e-01   +3.304741563475400e-01   +2.937142088079473e-01   +3.381191070972520e-01   +1.312787782807430e-01   +3.689916279262218e-01   +1.008070742023478e-01   +6.548629824986034e-01   +3.148310178770292e-01   +1.418713485869690e-01; +3.259231224726543e-02   +5.348756662923824e-01   +1.664830403570226e-01   +1.333538194071856e-01   +6.614428931312286e-01   +5.648033109800933e-02   +1.341962304256744e-01   +2.970966154624566e-01   +7.455870491869583e-01   +6.075981481802371e-01   +7.223681287646566e-01   +6.841484963441675e-01   +2.934149035808575e-01   +1.109011067744838e-01   +7.721486852694820e-01   +1.692050265983794e-01; +6.147416998794003e-01   +4.435326852513365e-01   +6.220122210791704e-01   +2.956657062543978e-02   +3.319645268554956e-01   +5.219273077923402e-01   +2.114641298023470e-01   +6.293718174582348e-02   +1.080905632830208e-02   +7.409167283448992e-01   +1.103388967665401e-01   +5.978164119560316e-01   +2.362314665605805e-01   +9.326068118580941e-01   +6.956021730356079e-01   +1.950933852261690e-01; +3.633133697434150e-01   +1.237452841921428e-01   +5.737989048729824e-01   +9.381468124607744e-01   +8.982156404965468e-01   +3.345456621394071e-01   +8.961166107939612e-01   +2.977259152076744e-01   +4.781313570134003e-02   +1.052584876706391e-01   +1.166544003463823e-01   +7.882170606389185e-01   +5.304311307505151e-01   +1.856698545963400e-01   +1.247712846752207e-01   +3.175162204841378e-01; +4.986702275128526e-02   +4.912699176253344e-01   +5.269982563566483e-02   +3.018685975700276e-01   +1.174095029787787e-01   +1.743689001525713e-01   +7.191973719495762e-02   +4.483120852670608e-02   +6.677457298154951e-01   +1.269178973872154e-01   +6.399513427941359e-01   +3.681829975286932e-01   +9.216494623824252e-02   +2.672117672453611e-01   +1.283966838757230e-01   +3.172665953562386e-01; +4.879154027575577e-01   +8.521126483395058e-01   +9.322980281479429e-01   +2.961885011687185e-01   +9.888022256750614e-01   +2.100569033710819e-01   +2.432499274535896e-01   +5.052500143007421e-01   +6.041879908257646e-01   +5.492744188045293e-01   +3.288354724260724e-01   +2.060200308995964e-01   +4.058639894394737e-01   +7.981000196340741e-01   +9.225786013650140e-02   +2.170493340112751e-01; +1.921750968015382e-01   +8.745395550027958e-01   +7.278136926176265e-01   +3.346946625991572e-01   +5.419432997952326e-01   +9.057173091976330e-01   +5.423453109984160e-02   +7.610354317083935e-01   +5.266285857199553e-01   +4.852856367715882e-01   +6.538340169836699e-01   +8.727805444397399e-02   +1.035746014319688e-01   +4.879057367040202e-01   +9.023500144609706e-03   +2.512957906033290e-01; +1.222172488597749e-01   +2.704038068297511e-01   +7.375802083257336e-01   +4.684420086424450e-01   +7.057021532108702e-01   +6.749008004318714e-01   +4.405488371076355e-01   +6.320840809529042e-01   +7.288152314481966e-01   +8.904196417027987e-01   +7.504813934618731e-01   +7.721833053815982e-01   +1.114282388921854e-01   +7.693084993454069e-01   +4.235134451097359e-01   +8.938631562969409e-01; +2.063728588439464e-01   +2.090481041812466e-01   +6.288038194730827e-02   +6.476059178413796e-01   +9.989465156433778e-01   +4.682496372858777e-01   +1.428862624193355e-02   +9.056278649166072e-02   +7.077581701118264e-01   +7.996711361493835e-01   +5.840815791749161e-01   +2.074911258805056e-01   +7.856843601244464e-01   +3.970342683127223e-01   +6.551562704890188e-01   +7.024880493628429e-01; +1.467901195538676e-01   +5.638124920840806e-01   +8.595209660728053e-01   +2.423539625108386e-02   +2.885026738118315e-01   +9.123894362921425e-01   +8.966430175545230e-01   +8.034940346091947e-02   +7.808519382274287e-01   +7.347957411795255e-01   +7.412131215069319e-01   +3.889954175499387e-01   +2.913455252886730e-01   +2.731775647472588e-01   +7.229957638205853e-01   +5.549609083965786e-01; +1.889618529825481e-01   +6.388743836023620e-01   +9.331852677527385e-01   +8.426105651558203e-01   +4.134694004890552e-01   +1.034342152459943e-01   +1.949987763714405e-01   +7.756587070311851e-01   +2.885342053752121e-01   +5.282163423101506e-02   +2.341015587406557e-01   +5.519872998348385e-01   +6.039658854479113e-01   +3.757997551404507e-02   +5.301630651698797e-01   +1.845771869778206e-01; +4.331970152484189e-02   +4.162038241543318e-01   +9.837319867850161e-01   +5.578642977530435e-01   +4.663637203749617e-01   +7.440472564984848e-01   +9.315467680446719e-02   +9.056173163988959e-01   +6.904508742225535e-01   +7.234435707392878e-02   +7.345571157472348e-01   +2.289871640508594e-01   +9.635746311615634e-01   +6.738741270931380e-01   +1.079473931355738e-01   +2.113637852100421e-01; +6.355114768100019e-01   +2.066019340840253e-01   +8.572881126769197e-01   +8.540225742509354e-01   +7.644967146546002e-01   +7.373524779152355e-01   +3.073018201917134e-01   +5.328775636180464e-01   +5.562287565942353e-01   +8.717719349773190e-02   +9.707386993963268e-01   +6.416088836939731e-01   +4.319862298245073e-01   +4.297192142499128e-01   +6.328769347488361e-01   +7.731971191376198e-02; +2.819239388672541e-01   +9.485454673225587e-01   +7.859075142076221e-01   +3.486009592767056e-01   +8.172944122252931e-01   +5.615631898955182e-01   +4.559517890168234e-01   +1.084601782223219e-01   +3.954630266504751e-01   +7.966151438296387e-01   +8.673310405001581e-01   +4.834671238502783e-01   +6.952345417179716e-01   +4.505452959789695e-01   +1.283055239037494e-01   +9.142067669559986e-01; +5.378761352992992e-01   +8.089515533709889e-02   +5.141159500163878e-01   +4.459491423886983e-01   +9.983111612431336e-02   +1.854498268694401e-01   +1.016135272508720e-01   +8.277410633177239e-01   +6.193239644735611e-02   +9.426606188546180e-01   +8.617797577911092e-02   +1.517241264858549e-01   +7.577887259146521e-01   +6.085611399235303e-01   +1.342235733022571e-01   +7.065680913217194e-01];
L2I_L1I_iGABA_netcon = [+5.588136841149233e-01   +1.595444610625752e-01   +4.239409461939317e-01   +6.824001290968080e-01   +8.086304379196478e-01   +7.951317270033945e-01   +7.884168467172176e-01   +2.620207493315167e-02; +3.126850885034587e-01   +7.582389581124462e-01   +4.291638942666586e-01   +4.630721137406965e-01   +7.482910593724864e-01   +5.782093286013469e-01   +8.515208591111860e-01   +4.215164993162536e-01; +1.658616716792775e-01   +8.705920221883829e-01   +1.248904801584715e-01   +2.134944671288767e-01   +1.191665399807104e-01   +4.415652408311204e-01   +5.063112520431620e-01   +1.826813611909087e-01; +6.212917407374304e-01   +3.509145129408460e-01   +2.380442135036491e-02   +9.841576093459758e-02   +5.245809293779516e-01   +2.580063934557828e-01   +6.355854987460634e-01   +7.261375347299426e-01; +9.875092761628830e-01   +6.862467800217672e-01   +2.903899485424877e-01   +8.227481496996550e-01   +3.258954358352724e-01   +7.520055708070279e-01   +9.515515842640117e-01   +3.696684753101335e-01; +1.703796146097737e-01   +2.935879363161117e-01   +3.190231051131046e-01   +1.758139423967673e-01   +5.462598794430603e-01   +2.284181070808138e-01   +4.439875542110399e-01   +8.415910666962202e-01; +2.580001748928825e-01   +5.304803848362017e-01   +6.534760298349638e-01   +1.643477983935253e-01   +4.002802805285927e-01   +6.579394710857796e-02   +5.858987229792528e-02   +7.332770913200172e-01; +3.974691078562833e-01   +8.333628985285093e-01   +9.571308129258633e-01   +6.674586561089182e-01   +4.155071583449403e-01   +7.668668615287592e-01   +8.672492374162654e-01   +5.701166261447181e-01; +7.440521367800228e-02   +5.985175284123980e-01   +9.367315113288548e-01   +8.936960735387018e-01   +1.793647369905553e-01   +6.717771481452470e-01   +6.309567267714772e-01   +1.776569484566010e-01; +6.844597514785946e-01   +3.348828522636844e-01   +4.582195004255113e-01   +5.167849994357483e-01   +2.550013902219337e-01   +7.146290217249287e-01   +3.537419599700168e-01   +9.595871839929752e-01; +4.033839944284039e-01   +2.992089849271073e-01   +2.395711372753525e-01   +7.026762200216761e-01   +1.922168114265487e-02   +6.423832031667356e-01   +9.973102709907252e-01   +2.657383813916435e-01; +9.823768453428823e-01   +4.526597850493034e-01   +7.641651640474973e-01   +1.522694511268095e-01   +9.232349968167272e-01   +4.186953584859051e-01   +2.242819406506492e-01   +9.245946797109464e-01; +4.009798616188002e-01   +4.234124458609119e-01   +7.598319368152223e-01   +9.535105905710993e-01   +6.538894238421985e-01   +3.909035112107330e-01   +6.523123749267804e-01   +2.224647913235344e-01; +6.215380752216048e-01   +3.595241951113886e-01   +7.391448965213355e-01   +5.403428999988462e-01   +9.328029595589555e-01   +8.164314723098762e-01   +6.047570504560683e-01   +3.731764456672416e-01; +1.549766430343924e-01   +5.601633742476421e-01   +7.451220365787163e-01   +6.809618864936825e-01   +1.642550874484260e-01   +3.162597464966674e-01   +3.869206750775989e-01   +8.745728932786437e-02; +3.822523814598092e-01   +7.433936580087868e-01   +1.076736419183759e-01   +3.751811248197057e-02   +9.223633233222829e-01   +8.153960000004723e-01   +1.405165879501150e-01   +6.414242907182902e-01];
L1I_L2I_iGABA_netcon = [+1.817089398067828e-01   +9.110743000662247e-01   +2.756972626947295e-01   +8.696883951323472e-02   +5.337283070675274e-01   +1.070317693530797e-01   +9.886621229601070e-01   +4.117714595568864e-01   +7.199953910584008e-01   +2.181151386605883e-01   +9.220729164783512e-01   +6.744202385940284e-01   +1.063691698503801e-01   +5.568369659307774e-01   +6.300193764662972e-01   +4.841080364244527e-01; +4.593160590096101e-02   +8.002895102621379e-01   +2.479288382188081e-01   +8.028823475888128e-01   +8.867792249566070e-01   +6.149783664152609e-01   +7.672082083816664e-01   +6.012798099724999e-01   +9.966598992558636e-01   +1.266916620421558e-01   +7.704960175920365e-01   +4.777702059156461e-01   +1.812575971793433e-01   +7.719828143173232e-01   +1.010512598316484e-01   +8.946706175588535e-01; +7.230044550293780e-01   +7.443961975738816e-01   +4.517289867156848e-01   +9.894087235232794e-01   +8.977596666808354e-01   +9.405756321510168e-01   +3.365371805775421e-01   +7.498069637559726e-01   +3.547104347056714e-01   +3.083997820251399e-01   +4.311587545872831e-02   +6.239859961461189e-01   +9.975013840933086e-02   +3.124495999817957e-01   +3.917283736820264e-01   +1.381217354788316e-01; +3.480636923935365e-01   +8.129781864537321e-01   +2.268988417035963e-01   +6.697466675234912e-02   +6.254091044691182e-01   +3.528562072160810e-01   +6.627748927676687e-01   +5.842601063196632e-01   +9.715726161515892e-01   +7.253732181362447e-01   +3.788081112965199e-01   +2.370595598436749e-01   +4.905449908353529e-01   +1.784298298576682e-01   +5.544731123009895e-02   +3.890417488916968e-01; +6.604639364408817e-01   +3.835099833560348e-01   +8.045338102448418e-01   +9.401648628429418e-01   +1.372003897323247e-01   +4.106362692691162e-01   +2.459122801950017e-01   +5.515178322784478e-01   +3.474141260383994e-01   +7.832040283972577e-01   +7.046274803454671e-01   +1.780987818531236e-01   +1.926176771383124e-01   +3.385865925772744e-01   +5.008687087006300e-01   +9.275631854300669e-01; +3.844666579146124e-01   +6.176344009029376e-01   +9.860878027448441e-01   +1.684021856054532e-02   +2.184383139012818e-01   +9.841240662688688e-01   +2.943975500367038e-01   +5.814844216614105e-01   +8.863340538888703e-01   +6.927910686107618e-01   +7.275917002811186e-01   +8.289606745952364e-01   +8.939114657750701e-01   +2.097499494552438e-01   +4.314522956007647e-01   +9.185509698787278e-01; +6.281050704879925e-01   +5.763740649716054e-01   +2.942277727963726e-02   +6.844961177734831e-01   +1.817227650734447e-01   +9.450755295667211e-01   +6.790336907416558e-01   +5.108795399343298e-01   +4.546871705489661e-01   +9.098957788466333e-03   +2.257520477611747e-01   +7.654947781431553e-01   +9.992976672165689e-02   +5.102337547727132e-01   +9.973938159749595e-01   +7.144704439765028e-01; +2.276341536984316e-02   +5.280274279567240e-01   +5.359672606963987e-01   +7.829917952120101e-01   +4.289771282591648e-02   +6.770921181136912e-01   +5.265681047084485e-01   +8.200676774621368e-02   +4.146717289800353e-01   +8.446653743448449e-01   +2.694048470403301e-01   +9.343604157065049e-01   +4.462096861817649e-02   +9.052829733779704e-01   +8.103576679589743e-01   +6.176313554495415e-01];
L2E_L1E_iAMPA_netcon = [+3.430851435743822e-01   +7.579750306318841e-01   +5.889734880329873e-01   +5.021439324272577e-01   +8.482999930107087e-02   +4.687930848508577e-02   +9.234630055989741e-01   +4.754995084356958e-01; +9.364775609739049e-01   +4.139474810924366e-01   +6.609103092089222e-01   +4.891089779843594e-01   +9.738706890010815e-01   +3.437015113481356e-01   +8.011368504710349e-01   +3.640347857836613e-01; +1.239267748684149e-01   +4.927973425109515e-01   +4.841396596443034e-02   +8.781819616271723e-01   +6.513039247251999e-01   +7.370213197308769e-01   +2.864607839489155e-01   +7.879340847354058e-01; +7.308364750694266e-01   +6.958180717920687e-01   +3.486625952427658e-01   +3.525922514394125e-01   +2.310944515778696e-01   +7.957660467789759e-01   +5.441987331965310e-01   +7.810067526713528e-01; +6.468572617139194e-01   +9.737425995546120e-01   +4.494430707565942e-01   +4.490583412676528e-01   +4.024105608376214e-01   +5.449551683060671e-01   +9.842251112098777e-01   +6.677007431964452e-01; +8.331027530527848e-01   +3.279773438781808e-01   +2.393323927292004e-01   +9.638496128072249e-01   +1.210093626408925e-01   +6.868922953106825e-01   +7.149152259111229e-01   +1.330804405903504e-01; +3.971084221556512e-01   +8.376726237990085e-01   +7.149573551048434e-01   +4.249182945750423e-02   +2.691123088025965e-01   +8.944043501704245e-01   +8.384429114822731e-01   +2.048399225318369e-02; +7.497569489073532e-01   +7.403551687780774e-01   +8.560369964909740e-01   +9.740268951197741e-01   +2.561145649171593e-01   +5.404300873894977e-02   +4.345541123692845e-01   +5.595427976662173e-01; +8.349571226957435e-01   +9.536507500633300e-01   +2.825479007188261e-01   +1.875691313097173e-01   +3.332175421810488e-01   +3.041406748420076e-01   +4.713738362546863e-01   +3.014240499309643e-01; +3.237113147241761e-01   +3.286463979805092e-02   +7.307350107542387e-01   +6.666645328907128e-01   +1.506075337395677e-01   +4.555734857415260e-02   +5.612802801503178e-01   +9.392953670435430e-01; +5.513002066345414e-01   +3.558781987100835e-01   +1.394254914873692e-01   +5.870550780067975e-01   +3.483113499054556e-01   +1.953943090353930e-01   +2.695855316484087e-01   +9.816178951843297e-01; +9.807295169610898e-01   +6.617590885895761e-01   +8.383558408708053e-01   +6.754682235235683e-01   +1.202052700667730e-01   +7.184303621327162e-01   +7.484478814492985e-01   +2.869901645970611e-01; +5.486965757002978e-01   +2.814685340360216e-01   +1.388671908985332e-01   +3.598293658821328e-01   +8.832500586519619e-01   +7.223326587692389e-01   +5.043918169541144e-01   +7.997785987666409e-01; +3.304188980328573e-01   +2.303499005872844e-01   +5.875790330610108e-01   +6.198867598729066e-01   +9.533649053959178e-02   +8.775379670778758e-01   +6.474890357622107e-01   +8.950983270123558e-01; +6.193342586507807e-01   +7.104411499350052e-01   +3.668128307312383e-01   +8.112341332372077e-01   +9.309790333157845e-01   +5.805245822365124e-01   +3.073263176816848e-01   +5.977656309980894e-01; +3.615114138748312e-01   +6.235599539867945e-01   +8.055064930103030e-01   +2.050108611307129e-02   +3.999730113623245e-01   +7.233502357549221e-02   +1.392378925186413e-01   +8.840042323867788e-01];
L1E_L2E_iAMPA_netcon = [+9.439729499040703e-01   +3.720668772725131e-01   +6.679269788494193e-01   +4.851211564068818e-01   +2.473387079426522e-01   +4.514349932935592e-01   +1.233435442255855e-01   +4.973718149426391e-01   +8.830887351207369e-01   +3.247755397276901e-01   +5.143933604700445e-01   +8.562837362542892e-02   +6.316558178001255e-01   +4.292319208518634e-01   +6.131187648013566e-01   +5.040247469274435e-01; +5.486052250991904e-01   +9.368296645535428e-01   +2.083371645074153e-01   +7.573643889719015e-01   +7.850498115231447e-01   +2.053412269006379e-01   +4.065424513025152e-01   +6.934337794550794e-01   +7.196522715046644e-01   +2.457404371445703e-01   +6.576925694597114e-01   +1.633977790403812e-01   +8.589516460777034e-01   +4.921312376623390e-01   +8.196427505900015e-01   +6.125230586544019e-01; +7.285913105665216e-01   +8.295818529999133e-01   +6.529769090192075e-01   +4.167563692414100e-01   +8.830902716990906e-01   +8.988686585249132e-01   +2.757401404657238e-01   +8.338789796435173e-01   +1.946076276042931e-02   +3.431990927891151e-01   +9.519197797893842e-01   +3.241381047000733e-01   +9.757823047948495e-01   +7.088818425070408e-02   +8.863001469477448e-01   +8.195370752213755e-01; +5.767310176916004e-01   +8.496151415354182e-01   +7.176822886399388e-02   +9.722352642195042e-01   +9.127890166237397e-01   +7.632165113282749e-01   +7.171957074814684e-01   +6.114383138299810e-01   +6.748816837228765e-01   +3.750511348420599e-01   +7.226232671655263e-01   +3.017566574190356e-01   +5.697162096951981e-01   +8.869829380946231e-01   +9.305353803954670e-01   +5.318740190074385e-01; +2.575999756736021e-02   +3.713799940455204e-01   +4.069647417771754e-01   +9.892789665663444e-01   +5.579241854305756e-01   +8.839142309195966e-01   +2.823637621402303e-01   +5.750907187080169e-01   +4.384869807652820e-01   +5.453668030693795e-01   +3.995659128330249e-01   +1.107893879619422e-02   +9.969733890404965e-01   +6.468603712480726e-02   +1.918157009554222e-01   +2.023777012740295e-01; +4.478533582791887e-01   +5.926632664596128e-01   +6.663909417046625e-01   +8.641313932651558e-01   +5.986118516179020e-01   +2.865821284951108e-01   +8.957127568227046e-01   +3.246345044042832e-01   +4.365668644156998e-01   +5.632529026936285e-01   +8.336053537233794e-01   +5.409437741170540e-01   +5.535981083722957e-01   +4.363405134289566e-01   +2.586477000108827e-01   +4.549024354878284e-01; +6.472090190535791e-01   +8.740090920774263e-01   +9.358159249556355e-01   +3.886334607287333e-01   +1.475760128108121e-01   +6.717614529391168e-01   +8.266897391855283e-01   +4.556288822119391e-01   +1.158120285258035e-01   +3.954112998793033e-01   +1.346248197647275e-01   +9.596499331571753e-02   +5.151043573179150e-01   +8.257033594145715e-01   +8.970793067599117e-01   +4.284790741153492e-01; +5.218269151815531e-01   +9.340203385068271e-01   +8.099585694815700e-01   +4.537479111648371e-01   +9.008671570755862e-01   +6.639497080519717e-01   +3.904111169544320e-01   +7.148374615392653e-01   +8.141128853162162e-01   +3.974378298766849e-01   +6.046464438811230e-02   +1.473733864922109e-01   +3.315670915123977e-01   +3.930192304559489e-01   +5.936164938599908e-01   +9.657965474315475e-01];
L2I_L2E_iAMPA_netcon = [+6.187965327777426e-01   +6.952859489242131e-01   +7.333885417972169e-01   +5.904977497210251e-01   +6.695465716031895e-01   +5.483105713463580e-02   +9.863423180374353e-02   +8.486442775930276e-01; +6.967955843129393e-01   +4.260651351284103e-01   +4.298035244392835e-01   +4.589274487096756e-01   +5.002630383629758e-01   +1.530830328545123e-01   +9.078831814796759e-01   +9.168554789825422e-01; +7.214369238751085e-01   +8.370293891564301e-01   +6.943366486266002e-01   +5.114939222401003e-02   +2.186408001892041e-01   +2.034922967936246e-02   +1.097133904749398e-01   +9.872472776012565e-01; +3.469425101382138e-01   +7.307641801664496e-01   +9.455147008417190e-01   +2.286496762337157e-01   +5.729046967007302e-01   +4.344699034981224e-01   +5.173206844516962e-01   +5.036367907329795e-01; +5.178174830177541e-01   +3.603038660354462e-01   +7.835958843787851e-01   +8.339216687210730e-01   +1.219898281964587e-01   +8.316661183074677e-01   +1.434138327789182e-01   +2.708398078481906e-01; +5.571429065211253e-01   +4.544742217016731e-01   +7.059760380807876e-01   +1.483924708543855e-02   +6.713346053224180e-01   +6.160214406561110e-01   +5.592883342711596e-01   +1.009096083626562e-01; +1.575575312621506e-01   +3.868853237257312e-01   +1.094377024025258e-01   +8.641028808779767e-01   +5.998029083138213e-01   +5.196055008635542e-01   +4.661358949184283e-03   +5.078506318180894e-01; +5.634817392928985e-01   +7.750337286253948e-01   +3.900532320715702e-01   +7.913630507913841e-02   +5.583501895527506e-02   +8.637960582326347e-01   +7.671534015083574e-01   +5.841602825303406e-01];
L2E_L2I_iGABA_netcon = [+7.643566699864278e-01   +9.419612798609439e-01   +2.387526576773766e-01   +8.340463143400608e-01   +2.572300100176702e-01   +7.475971957868772e-02   +1.738252904719961e-01   +5.235166271774245e-01; +8.296331999506708e-02   +6.575565805857801e-01   +5.786600965409019e-01   +4.030604906572917e-01   +2.982476110736261e-01   +3.944528899158829e-01   +1.393000209828447e-01   +2.649283528551933e-01; +6.607592920113211e-01   +4.519445551404157e-01   +8.665615087497252e-01   +3.908508862160687e-01   +4.252950798925877e-01   +3.416122642813799e-03   +5.986182137479842e-01   +6.823110190510280e-02; +5.172470251733143e-01   +8.393226825829160e-01   +4.059703788545276e-01   +3.621524695519063e-01   +1.187572797888377e-01   +2.194235023454297e-01   +8.997995631121247e-01   +4.364669054028056e-01; +1.720000088028805e-01   +5.334903247884234e-01   +1.114417092866972e-01   +1.388114604703366e-01   +4.969797427969241e-01   +1.014208854260016e-03   +9.391961574243173e-01   +1.725167094851909e-01; +9.392615196098572e-01   +5.540062355161784e-01   +4.436748174673099e-01   +2.581765169116325e-01   +7.064696290547647e-01   +1.903245727372737e-01   +2.203288524124914e-01   +2.705841532808728e-02; +5.909076272813905e-01   +6.808579354369884e-01   +2.984624589803968e-01   +8.638427177773579e-02   +2.434813194671807e-01   +1.422408164631575e-01   +4.810077216633674e-01   +9.539905972094189e-01; +4.411633272413887e-01   +3.673242782007659e-01   +4.002742540453104e-01   +4.293022414300168e-01   +7.844491419773996e-01   +2.671861871028797e-01   +3.761170084587644e-01   +4.303156529168958e-01];
L3E_L2E_iAMPA_netcon = [+9.620379434587578e-01   +7.727897053253969e-01   +9.105517806640046e-01   +5.315693031133996e-01   +4.851497840848268e-02   +8.190744002155677e-01   +6.253187128454266e-01   +7.484425020713026e-01   +6.736953911414636e-01   +9.051459752364991e-01   +5.828392082495946e-01   +5.946749655073039e-02; +7.622097435008577e-01   +2.276050670714522e-01   +9.074100094566824e-01   +7.167192448666957e-01   +5.521034594516590e-01   +7.273003880972306e-01   +5.420753246462436e-01   +6.461079882664730e-01   +4.320819728956886e-01   +3.932694593895086e-01   +6.867392153054631e-01   +9.803091277164745e-01; +7.906322760455010e-03   +3.706441786587052e-01   +5.910758220010505e-01   +1.796839723330910e-01   +2.747071509250335e-01   +1.767977468278681e-01   +4.380534730814160e-01   +1.223306626937999e-01   +6.934782216774775e-01   +2.581407501902897e-02   +7.204204559930463e-01   +2.853853864029481e-01; +6.792918597457661e-01   +8.916470136508300e-01   +3.311788743426614e-01   +3.353146737251012e-01   +2.427691678073396e-01   +3.606967827689752e-01   +2.869914268930846e-01   +5.051813676643530e-01   +2.567374592269750e-01   +6.704452764782709e-01   +6.495149560681326e-01   +5.941784893745953e-01; +7.049095437086873e-01   +8.566208487458477e-01   +8.533985042411938e-01   +1.869434103759021e-01   +2.423552188807774e-01   +1.875618983273478e-01   +5.012895136017518e-01   +3.475138294950190e-01   +1.183511603268173e-02   +8.375872932456839e-01   +7.259275041752840e-01   +9.608701422734001e-01; +6.450394570561119e-01   +4.012208521962111e-01   +4.427284297409844e-01   +3.213309236995397e-01   +1.544225677658581e-01   +1.261230255584484e-03   +7.628939208591954e-01   +9.117893478655191e-02   +5.317039902531373e-01   +9.714992093389456e-01   +3.743436228565656e-01   +1.867519222640657e-01; +5.529213230892434e-01   +3.191114915751184e-01   +9.028073300897476e-01   +4.041885218277498e-01   +9.584740708678116e-01   +3.147671560256863e-01   +7.618540909438150e-01   +1.476575412981879e-01   +2.798522360216935e-01   +5.684256953011898e-02   +5.807214461621093e-01   +1.924182297843704e-01; +2.179116885620664e-01   +6.093016746784627e-01   +3.387847830935712e-02   +5.492604353346171e-01   +9.366265381794932e-01   +6.987587511063542e-01   +5.760962713187920e-01   +1.986820022984168e-01   +9.458824183581442e-01   +4.495384233361305e-01   +1.144531656956033e-01   +3.408909777286630e-01];
L3I_L2I_iGABA_netcon = [+9.336528172764729e-01   +9.273080471954523e-02   +6.171196169697593e-02   +2.784851655140567e-01   +2.551628971193792e-01   +4.037894054515710e-01   +5.295004347536658e-01   +1.087613054981755e-01   +9.125854677779218e-01   +5.851213778398486e-01   +2.085017919119214e-01   +9.085047297378969e-01; +3.903890447409236e-01   +6.160499679134285e-01   +4.948897413484551e-01   +7.458593651011881e-01   +8.576963490306284e-01   +9.886505498132829e-01   +8.291321202529379e-01   +2.710686350118334e-01   +6.389207006901124e-01   +2.840037943330762e-01   +3.174932779787518e-01   +5.515113337130371e-01; +2.725879076848488e-01   +1.138824808837604e-02   +6.433327045442089e-01   +2.380355055472818e-01   +9.112388584218071e-01   +9.005015483742182e-02   +8.572206719725554e-01   +5.234770984081963e-01   +2.547516787201326e-01   +8.274400442764620e-01   +1.334935137813490e-01   +3.406300115368355e-02; +1.527620726149397e-01   +5.733113868690962e-01   +2.222042851826204e-01   +9.572236072749544e-01   +6.991905185978584e-01   +3.218446520252944e-01   +7.883890259580018e-01   +9.726145139443859e-01   +9.032726453832055e-02   +1.919384896440885e-01   +6.725138884216673e-01   +5.404948097918932e-02; +3.970017487928823e-01   +7.883796538008846e-01   +8.376277139086697e-01   +6.213548111940995e-01   +7.265428495897910e-01   +5.125964145099104e-01   +3.185815387304101e-01   +7.091978874703856e-01   +8.382526472820527e-01   +4.415269162640840e-01   +5.705756128454292e-01   +8.056522085206408e-01; +3.751343008204592e-01   +2.361686651268367e-01   +9.706901369294673e-01   +6.009898631995194e-01   +2.293936777065827e-01   +5.971661509541245e-02   +4.520255136774532e-01   +3.104659637503606e-01   +5.843357846799083e-01   +3.933108331012555e-01   +1.706960509365152e-01   +4.514914283926437e-01; +1.294864500101805e-01   +4.479712899464252e-01   +8.468523543550914e-01   +1.735429414264100e-01   +5.745655079844962e-01   +7.254464412146353e-01   +7.523656807564476e-01   +2.931933702197422e-01   +9.480192531347970e-01   +8.268207056682367e-01   +1.478702490284258e-01   +3.812967944320758e-01; +4.347909058776652e-01   +5.692526370629440e-01   +5.060792522909300e-01   +8.984008225793785e-02   +8.108966913946161e-01   +5.575340016810140e-01   +1.108264624687513e-01   +8.493084442738035e-01   +6.126104420516190e-02   +6.779559415922546e-01   +4.754725146657306e-01   +7.901004503397802e-01];
L2E_L3E_iAMPA_netcon = [+3.652233728619519e-01   +7.566787551630663e-01   +7.363450576508747e-02   +5.178730986242505e-01   +7.573662290109378e-01   +4.326574725073410e-01   +1.999511345973497e-01   +8.759742493241928e-01; +5.309486155233059e-01   +9.972145594445627e-01   +5.916491953166562e-01   +9.952882756575721e-01   +9.957367717801333e-01   +5.434525210286641e-01   +1.937431259464868e-01   +7.863670908176765e-01; +7.129050817573094e-01   +1.873765869155617e-01   +9.110606547301314e-01   +8.565726346122468e-01   +9.627933006441225e-01   +7.120030089897950e-01   +3.262279383752272e-01   +4.657184739461548e-01; +8.708727949145524e-01   +7.811976717208003e-01   +1.915557026764799e-01   +9.613599364661506e-01   +5.352390372718799e-01   +1.574719414392742e-02   +8.792038417392308e-01   +8.130233140345186e-01; +3.285205624531851e-01   +1.949932482876395e-01   +4.322069633200795e-01   +6.783116865368017e-01   +9.649943117643702e-01   +8.011807932961439e-01   +4.707347971016344e-01   +8.975887824959236e-01; +6.493283368455801e-01   +9.921440414312249e-01   +7.490110378766754e-01   +4.024489289411671e-01   +1.168266880381892e-01   +1.422739319199075e-01   +4.040643462837008e-01   +4.284547937976209e-01; +9.760797096709660e-01   +8.017465811717674e-01   +3.948832282137386e-02   +9.337412893287567e-01   +5.032656387157315e-02   +4.789193311302691e-01   +1.798661801608580e-01   +3.344534417778032e-01; +7.647715788336497e-02   +4.243098516685176e-01   +9.465167725157859e-01   +4.797582557569846e-01   +3.028746238137256e-01   +2.549384786397633e-01   +9.685524630703348e-01   +5.962967342639064e-01; +5.880690100025366e-01   +7.281490967932298e-01   +7.632577292608927e-01   +2.306047119944643e-01   +5.809129766047670e-01   +3.692110849638440e-01   +4.081989395019950e-01   +9.004688515415729e-01; +4.127604303501539e-01   +4.972974923346085e-01   +5.579078194619639e-01   +3.962763657103665e-01   +5.320759797046588e-01   +6.615376021325607e-01   +8.437772480843244e-01   +7.019162477951909e-01; +3.090421900735937e-01   +8.087705361903278e-01   +1.834165936009581e-01   +7.048116844457192e-01   +9.005704425482940e-01   +1.681324613698344e-01   +6.163520028707751e-01   +3.782034427900112e-01; +2.635696990506534e-01   +3.565538799414721e-01   +4.997710939582201e-01   +5.585003354527160e-01   +5.399806004888831e-01   +2.795092742228727e-01   +3.754227864471645e-01   +7.350698386166856e-01];
L2I_L3I_iGABA_netcon = [+9.543855102177832e-01   +3.168716022052227e-02   +9.048160860479240e-02   +4.591536041769417e-01   +3.273006667290415e-01   +3.673113578354061e-01   +6.852969469474421e-01   +8.042284202518200e-01; +5.425759334142054e-01   +2.082899346126372e-01   +5.931029641759085e-01   +6.379283093355790e-01   +8.033030524429366e-01   +2.093505690301443e-01   +9.097556853208583e-01   +6.597961165408783e-02; +5.384215100218235e-01   +4.549545049595239e-01   +2.410261760311078e-01   +9.162334774713228e-01   +1.000000000000000e+00   +4.409695293302076e-01   +6.105368403648233e-01   +9.490371966732022e-01; +3.099052482061012e-01   +1.273183099954159e-01   +8.395870995839206e-01   +1.612762721609771e-01   +9.801420638836869e-01   +9.546940047134209e-01   +8.995403392504056e-01   +4.961812354375870e-01; +6.965966859167290e-02   +9.893182437723139e-03   +8.580047230146464e-01   +7.142157576778431e-01   +1.261912370612043e-01   +1.243415411860223e-01   +1.940069236530556e-01   +7.533715945103227e-01; +1.818831185838930e-01   +7.275960676109186e-01   +9.609043711595875e-01   +5.774496828516316e-01   +2.307849897672994e-01   +4.692944261133875e-01   +7.537100351875007e-01   +7.409861610127952e-01; +9.286589577682232e-02   +3.531632243209682e-01   +4.883380210562909e-01   +4.323356108466748e-01   +2.391368318912540e-02   +8.556212652829961e-01   +3.472697758579021e-01   +8.308517633812733e-01; +4.635456741186371e-01   +7.793755859373492e-01   +2.183007413176007e-01   +8.828231809826925e-01   +6.082855211041640e-01   +4.210762965958604e-02   +4.186330983626590e-01   +1.558587144160890e-01; +1.075290401059990e-02   +4.356118133535699e-01   +2.267030395786945e-01   +3.918721528613632e-01   +1.098383027202481e-01   +6.900920762636411e-01   +1.548062505990142e-01   +4.575930260699199e-01; +9.137620352863151e-01   +4.367937960217201e-01   +5.369477101548490e-01   +1.777275811110442e-01   +4.069993346288011e-01   +9.778769153336937e-01   +8.182330241907422e-01   +6.182367083177539e-01; +6.420434492449246e-01   +5.091566576154490e-02   +7.613018845269698e-01   +6.314491758590512e-01   +8.837305944659233e-01   +2.837345366844284e-01   +6.231184677993017e-01   +9.304011700562342e-01; +5.445793364699619e-04   +4.852302377740007e-02   +3.463954898681236e-01   +6.240126719035526e-01   +5.480278453982784e-01   +1.339509043747304e-01   +7.398565177499250e-01   +8.343464689980855e-01];
L3I_L3E_iAMPA_netcon = [+8.955521603941309e-01   +2.546353482071607e-01   +7.408198500061508e-01   +6.809545226635055e-01   +6.018308238149249e-01   +7.487582035967144e-01   +7.463783506179296e-01   +2.234465438136786e-01   +4.518973035669137e-02   +8.010212421701769e-01   +2.908152744868032e-01   +8.016424392717099e-01; +5.826483866571165e-01   +3.232403901590497e-01   +6.935071094015328e-01   +2.355590744385113e-01   +8.564954010800022e-01   +5.432266132897530e-01   +1.271015873963766e-01   +3.512001951051877e-01   +2.140754452566765e-01   +2.336162256629847e-01   +4.027911499284580e-01   +1.038995022552282e-01; +5.829134024535446e-01   +4.030480877879698e-01   +8.230584896887478e-01   +4.553901591734429e-01   +9.893599743532364e-01   +3.395034859396831e-01   +8.215270747282452e-01   +2.863553661117638e-01   +3.975617296597813e-01   +9.320776244582798e-01   +8.625042234458085e-01   +8.213723571005224e-01; +8.548464254369416e-01   +4.050429737928151e-01   +8.289769412890573e-01   +3.831768588864214e-01   +9.290552589843351e-01   +8.320017013913354e-01   +2.646451596374557e-02   +9.269270877747325e-01   +3.338679731457655e-01   +7.636988063758616e-01   +6.147354115351120e-01   +8.406451523909704e-01; +3.392704872929398e-02   +3.858671101912076e-01   +2.943626000761170e-01   +5.383399855355265e-01   +4.102769518913528e-01   +5.512310536778778e-01   +4.157603481549281e-01   +5.130018838568908e-02   +2.296894687454829e-01   +8.271074014899036e-01   +9.911227431460292e-01   +3.558862114905513e-01; +8.847479358854815e-01   +6.090452016961493e-01   +3.095257288347347e-01   +9.911196070114651e-01   +8.785717632606210e-04   +9.579427525836937e-01   +7.304313370420442e-01   +5.936649975171520e-01   +9.353536025647926e-01   +5.732990903359275e-01   +2.039285467937442e-01   +4.300000948256064e-01; +4.070522124385840e-01   +1.654784970131573e-01   +5.243436096875205e-01   +7.556729963524198e-01   +5.421345069258339e-01   +8.933873908115882e-01   +7.813147706861973e-01   +1.617458372523713e-01   +6.821422976794115e-01   +7.926857398355945e-01   +8.278396649157334e-01   +5.709677314511317e-01; +3.723464380672496e-02   +1.888601306595027e-01   +3.271021316863038e-01   +9.816196008297757e-01   +2.077799582192277e-01   +3.572006474024835e-01   +3.676428259856016e-01   +8.380223141862613e-01   +9.630829090280156e-01   +3.291049341738513e-01   +6.763991048781381e-01   +6.997146160930219e-01; +7.456659380900259e-01   +9.572863350375928e-02   +8.333942690974337e-01   +2.356295408679727e-01   +2.194960026591365e-01   +5.478936744626625e-01   +7.457893805317833e-01   +1.683035410194128e-01   +4.393854944799105e-01   +2.238018081399194e-01   +2.489739544318133e-01   +7.428654117071219e-01; +1.550420352545688e-01   +3.220547507399223e-01   +8.090047076561786e-01   +5.281192576202569e-01   +3.275296439811650e-01   +3.459783033195026e-01   +8.932572207147087e-01   +5.016772925654781e-01   +9.392399246096492e-01   +3.115697344118595e-01   +4.769552988173265e-01   +7.564603623508912e-01; +1.439520380621167e-01   +7.703268669879416e-01   +5.580489100059213e-01   +5.316380894426122e-02   +9.604971968897953e-02   +6.228140465639012e-01   +2.437557159226791e-01   +9.988017402588513e-01   +6.096526086074278e-03   +5.843699762161749e-01   +3.995808830416607e-01   +3.894353885221362e-01; +6.067155729398273e-01   +2.351890988843567e-01   +2.634181640389185e-01   +7.581109547191515e-01   +7.484321482196103e-01   +7.978584490169012e-01   +1.287361303324632e-01   +3.551892394859530e-01   +6.112576204146785e-01   +8.304790851761870e-01   +5.990255216001973e-01   +4.275880307734389e-01];
L3E_L3I_iGABA_netcon = [+9.555435642458534e-01   +8.847792545969625e-01   +8.004056802271260e-01   +9.859378860373390e-01   +9.016609021820140e-01   +9.611426791910883e-01   +6.533511311759068e-01   +5.008100594992086e-02   +1.079333729787077e-01   +4.519742119878346e-01   +8.297910567287293e-01   +5.804496737419543e-01; +5.728351364531177e-01   +4.379839373075205e-01   +9.870373339094064e-01   +5.597683230091948e-01   +9.944224281890188e-01   +5.419467043375313e-01   +6.669019616604770e-02   +4.663551006031640e-01   +4.610056802904861e-01   +3.339437415499778e-01   +6.258911608942084e-01   +6.361144024042380e-01; +8.498853589343254e-01   +7.819293547506163e-01   +1.593052851845900e-01   +9.334353921465520e-01   +6.524897867822234e-01   +3.169027866919610e-02   +2.750337374715938e-01   +3.244343946509395e-01   +4.511948100360860e-01   +5.867190342851803e-02   +5.397710420495226e-01   +6.507024099051282e-01; +2.761037879103424e-01   +1.493466917161703e-01   +2.369777057799807e-01   +7.203384297899105e-01   +1.077550825179505e-01   +6.961807608353893e-01   +2.818040516775657e-01   +6.309479854080979e-01   +5.506930139533913e-01   +7.403679122683436e-01   +6.502765232909578e-01   +8.643095167967911e-01; +6.227354755387641e-01   +6.209664211163729e-01   +7.019279466537656e-01   +4.849190249377521e-01   +3.719110040826095e-02   +5.197289414255319e-01   +8.798218222967507e-01   +2.288795751760657e-01   +8.055572985656165e-01   +5.066979576905548e-01   +7.259378785130003e-01   +5.618582001036994e-02; +5.900887728969272e-01   +2.600043307909334e-01   +3.765972083808681e-01   +6.395268432268908e-01   +6.183895126289718e-01   +6.081803223014506e-02   +4.450229416589430e-01   +5.796628532936722e-01   +7.013651507515107e-01   +2.005832465546284e-01   +9.441009392505678e-02   +8.177769461260558e-01; +9.641983110523157e-01   +4.453277385325482e-01   +9.747905792781353e-01   +8.879900458386045e-01   +5.664535761644571e-01   +8.890670086379175e-01   +7.573867452747388e-01   +6.036176736189339e-01   +8.724036868948424e-01   +4.267301965480077e-01   +8.786869530151634e-01   +5.283446743426263e-01; +8.659562035814614e-02   +8.447450923684364e-01   +9.710367206714949e-01   +1.980044315403427e-01   +9.624340307665388e-01   +3.301740257398879e-01   +6.020276120363902e-01   +6.000251446627560e-01   +5.219423991904008e-02   +1.675183666074667e-01   +1.284447265226803e-02   +6.953152236175526e-01; +5.010548286956953e-01   +1.970018393071357e-01   +6.428850802230273e-01   +3.961705565712801e-01   +7.474886610549734e-01   +2.287748102448831e-01   +7.826744315499782e-01   +4.482952283964858e-01   +2.183476564578694e-01   +7.511282977243691e-01   +2.921648088623973e-01   +2.127624853294396e-01; +5.214105986785602e-01   +3.030468630249694e-01   +8.598129555849122e-01   +9.923364509290342e-01   +6.626274497013690e-01   +1.134782945164117e-01   +1.143075013420954e-01   +3.403081667977536e-02   +4.592753789404838e-01   +3.671787220536262e-01   +1.789326459117896e-01   +5.438448941545340e-01; +9.078487558690315e-02   +4.812869170167451e-01   +4.011729236623965e-01   +4.018665556608710e-01   +5.234621175512733e-01   +3.120570891487099e-01   +9.780863570386353e-01   +5.129435478038781e-01   +9.584583507623387e-01   +9.425933597303845e-01   +9.261623290675040e-01   +7.036934650945927e-01; +9.055097475865512e-01   +3.377233244220406e-01   +6.307762638607555e-01   +6.581333541443570e-01   +2.598643767124590e-01   +2.279046637592853e-01   +8.484531289064589e-01   +4.073578898805409e-01   +7.915144680351857e-01   +1.532515810247402e-02   +6.841955275382963e-02   +9.559961969802800e-01];
L2E_Input1_iAMPA_netcon = [+9.978612760659340e-01   +1.000000000000000e+00   +9.980704705873459e-01   +9.985372785948502e-01   +9.969309060954452e-01   +9.982631699070217e-01   +9.973933870227697e-01   +9.967808202118509e-01];
L2I_Input2_iAMPA_netcon = [+9.983571905214222e-01   +9.985547822180856e-01   +9.994794621334239e-01   +1.000000000000000e+00   +9.995417079698544e-01   +9.978212585054854e-01   +9.996098258626522e-01   +9.976547594971720e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
