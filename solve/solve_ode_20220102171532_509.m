function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.851272289668004e-03   +5.185720237724213e-03   +9.983001600566978e-03   +1.157462909471907e-02   +8.574920802142789e-04   +7.802456714985279e-03   +2.513821053100133e-03   +1.479563512529927e-04   -4.719099732623596e-03   +6.826771526182330e-03   +6.488670922510245e-03   +6.654999253129449e-04   +7.972243696404965e-03   +3.963987148548937e-03   +3.209573225839202e-03   -6.078030075691358e-03; +6.461204483842306e-03   -1.106474394839910e-03   +8.448803482520159e-03   +1.101566560490649e-02   +7.485579890979538e-03   -1.315518058222147e-03   +7.351863185085570e-03   +2.500901708772094e-03   +5.177292435752653e-03   +9.107327120525229e-03   +9.395632983667889e-03   +2.894242602501140e-03   -5.798756103678394e-03   -4.065144037054998e-03   -2.614513239324915e-03   -2.125488523929699e-03; -2.981444843896845e-04   +3.753924850822436e-03   +6.844564710204330e-03   +6.232754888969775e-03   -2.123746447337320e-03   +5.360262860576935e-03   +7.478629557633521e-03   +1.119249779394686e-03   +1.279547550188536e-03   +5.800439767644300e-03   +7.929225455741954e-03   -1.924227549575245e-03   +7.268480561201855e-03   +1.731667860464676e-03   +5.896365369101622e-03   +4.518941401240114e-03; -2.226005925591268e-03   +1.998673887856950e-03   -3.638592002584210e-03   +1.361772770183826e-03   -1.306865469676706e-03   +5.036676044270282e-03   +6.087998917888573e-03   +2.570397489789667e-03   +7.756128850705393e-03   +3.563112714480369e-03   +7.566696771816567e-03   +6.137084551649710e-03   -2.227476644332006e-03   +7.056090413595383e-03   -1.762520438387663e-03   +3.348711420570053e-03; +7.924134671091418e-04   -1.151928049667901e-04   +7.292179696201924e-04   +3.212258870929951e-03   +1.218059470100655e-02   +3.285522196147173e-03   -8.514835468526787e-05   +4.120017907292197e-03   +4.761258474328219e-03   +1.092856892891381e-02   -2.264531401178877e-03   +4.429586205823299e-03   -1.121451370537643e-03   +1.023994481210194e-02   +3.781190800357606e-03   -1.322304436740933e-03; +7.976587599112283e-03   +3.140061757054761e-03   -5.800671182248972e-04   +6.923632939406402e-04   +5.368936720925029e-03   -6.058863887292770e-04   +1.892312073647821e-03   -5.130076113772929e-03   +5.791107365100651e-03   +4.370524048393609e-03   +3.132910556610296e-03   -1.781944632916642e-03   +1.205413472847092e-03   +1.594298144484089e-03   +1.672993534109944e-03   +8.995751964668947e-03; +6.968336213872601e-03   +5.187777867438643e-03   +2.711357416810616e-03   +6.426823308814204e-03   +5.652124358030349e-03   +2.382754535357308e-03   +7.159847454785660e-03   +7.444640674287037e-03   +8.087931937024994e-03   -1.040660417872136e-03   +2.474938871881516e-03   -1.882237567031283e-03   +4.205374843650382e-03   +1.961644525260829e-03   +7.307433468293356e-04   -3.679371322991894e-03; +2.343779705483929e-03   -7.773676330350787e-03   +6.995193869972869e-03   +4.467845981924297e-03   +5.203155176919353e-03   +2.043490531661811e-03   -4.090155899944894e-03   -2.247192072799555e-03   +4.514763845888088e-03   +5.635750313639447e-03   +1.649443930157124e-03   +8.428922413724869e-03   +1.808543198242501e-03   +2.062781897755423e-03   +4.846728041763428e-03   +6.331678222487434e-03; -1.643286759508183e-03   +3.633427132908439e-03   +5.134935189344840e-03   +6.377374308849243e-03   -1.176559005666341e-03   +7.326297352940643e-03   +1.723158498014029e-03   +6.150456371304980e-03   +3.633670483385563e-03   +5.908281574850986e-04   +6.747004205147856e-03   +6.138279650612078e-03   +5.644516949468997e-03   +5.401109317746107e-03   -7.666341704052030e-03   +3.523716982370929e-03; +7.093780633751671e-04   +7.115908293694176e-03   +1.361945784609626e-02   +9.692567307245638e-03   -8.115845204244212e-04   -2.369834408981467e-03   +3.835248981682064e-03   -2.717496434983338e-03   +5.681127802558762e-03   +2.035646514608332e-03   +5.148700689412906e-03   +4.723424475173515e-03   +2.108083945040062e-03   +2.352241833754144e-03   +1.331353707967577e-02   +5.810133423938535e-03; +8.222188920907682e-03   +6.483909034253706e-03   +9.473663412375365e-03   +5.994019237623468e-03   +2.339087909931276e-03   -1.705846976823140e-03   +1.028655017712022e-02   +1.162384745944633e-02   +2.493317619322299e-03   +5.176829874984223e-03   +9.006313835612179e-03   +1.430522110997384e-03   +5.936942161589643e-03   +7.017139409671279e-03   +9.276247856661509e-03   +5.298679830711620e-03; +4.653589929123288e-03   -5.380483913165148e-03   +1.418655699427561e-04   -1.527332133846858e-03   +5.918260931285372e-03   +7.210299604271567e-03   -1.839402665750489e-03   +2.321011951102686e-04   +6.140479756794052e-03   +2.520703443480370e-03   -7.402471445507972e-03   -3.332938161747592e-03   +1.891205092973820e-03   +2.359440032800074e-03   +7.606595781142192e-04   +3.339067404126200e-03; +4.107399399690605e-03   +2.857706501669948e-03   +1.531368821377854e-03   +3.356266240891866e-03   +9.534840427117431e-03   +1.320356706969165e-03   +5.535164510294022e-03   +1.344923129673094e-02   +2.786415435010318e-03   -2.667286990877170e-03   +1.477037672947486e-03   -3.744787460463235e-04   +5.955549278936326e-03   +3.787274646870907e-03   +6.119190120890142e-03   +8.447424028431854e-03; +3.878815510268852e-03   +6.360209845813336e-03   +8.861099710829004e-03   +2.763655481235573e-03   -5.212136046005792e-04   +5.292524687280451e-03   -2.954580253156657e-03   +7.782487250107017e-03   -2.522614318333856e-03   +3.957973240751944e-03   -2.613827433151718e-03   +1.020304499455800e-02   +8.834568347350727e-03   +5.417442900382870e-03   +1.473546802269136e-03   +3.463857926944418e-03; -2.011903878965063e-03   +6.217046821019520e-03   +8.677130154952174e-03   +2.925966007172936e-03   -1.347098562201655e-04   +4.424100858546550e-03   +4.116725564338645e-03   +5.524075079605428e-04   +1.042645145423438e-03   +8.736636006573687e-03   +1.964186203580707e-03   +4.100714686580497e-03   -1.816179553110635e-03   +1.312600456511808e-02   -4.043987203066317e-03   +6.744536156106289e-04; +6.888516610614560e-03   +7.669846555318350e-04   -1.952538222919416e-03   +6.913844164239772e-03   +3.835048419824526e-03   -2.034220518354540e-03   +4.823375699215884e-03   +6.009921060521192e-04   +1.526612436942547e-03   +7.858956058913182e-03   +7.195078777859763e-03   -7.349110014338324e-03   +2.926069706094348e-03   +2.871457144032395e-03   +9.952586822182818e-03   +7.269729747453345e-03];
L1E_L1I_iGABA_netcon = [+4.712601709337094e-03   +9.081705693152812e-03   +1.682813219361284e-03   +4.072666777101651e-03   +6.614376687413773e-03   +4.866808265181314e-03   +7.833878486778943e-03   -4.707946759421234e-03   +2.326843282144610e-03   -1.780277080068966e-03   +5.003115866236977e-03   +3.318515205671542e-03   +8.016202442464921e-03   +1.091218166239539e-02   +4.799511227284965e-04   +7.691831248562612e-03; +1.615259860269398e-03   -2.970882009598688e-04   +8.136799766002636e-03   +8.619515686937123e-03   +9.279481995522242e-05   +4.702685123618747e-04   +1.112877150426240e-03   +8.679721414194298e-03   +3.386415111129676e-03   -5.036960361263137e-03   -1.387242574068525e-03   +8.333224011594307e-03   -2.117597743835030e-03   +3.321270822976812e-03   -3.031012059110676e-04   +6.042496837512890e-03; +6.897249805255053e-03   +8.187986402545451e-03   +5.306219766644620e-03   +2.708229984091084e-03   +1.044411554567212e-03   +1.726364799331365e-03   -7.457119600051682e-05   +3.615170667774030e-03   +3.609102013940337e-03   +1.851061760420949e-03   +8.388759591358080e-03   +4.710533615120668e-03   +5.451813166028652e-03   +9.988179012378097e-03   +3.668638577993202e-03   +8.305937446288087e-03; +3.176773389666173e-03   +5.238121613397248e-03   +9.878183301119363e-03   +3.432426499568863e-03   -5.662332097208836e-03   +7.419071199805994e-03   +5.799185308480038e-03   +5.256645717566020e-03   +7.548219528890295e-03   +7.534955763067038e-03   +7.076264698296525e-03   +3.266431823915466e-03   +3.798370320669336e-03   +3.389748560769078e-03   -7.629986206827042e-04   +6.177238540191010e-03; +1.351148911596351e-03   +8.567421923127231e-03   +5.128589905937832e-03   +6.296299272278400e-03   -2.033805148475701e-03   +7.982946157040760e-03   +4.426061868941720e-03   +6.144293391485442e-03   -1.906777033346858e-03   +1.205776059631171e-03   +4.563206209493163e-03   +3.118695039126494e-03   -1.270097657805963e-03   -1.179175980184649e-03   +1.909575862912940e-03   +7.374311419446606e-03; +5.157551336716127e-03   +4.450914146804872e-03   -2.217541684562232e-03   +7.773624493770850e-03   -3.899197497583976e-03   -2.721895400988148e-03   +1.173390760021548e-02   +3.482795052780382e-03   +3.024912125131243e-03   +2.294562281686210e-03   +1.002834706419108e-02   +2.805770790027598e-03   +4.585560967497605e-03   -1.532887342456073e-03   -2.083033352325558e-03   +5.262410520456124e-05; +3.207857603190872e-03   +2.513430504627193e-03   -1.501851474006992e-03   +4.662723636258463e-03   +7.575012985113583e-03   +3.469817938461451e-03   +7.065522254513200e-03   +4.367536572471784e-03   +2.091450348239477e-03   +5.256575032279024e-04   +7.691309109608583e-03   +9.371897225502622e-03   +6.008072798966429e-03   +4.277625170416214e-03   +5.127739072762394e-03   +3.493215952378879e-03; +4.021066609480031e-03   +2.694553117399539e-03   +7.712344066308891e-04   +5.635544048462604e-04   +7.040701793023772e-03   +3.985263583944318e-03   +1.136539164913932e-02   +5.676586212921740e-03   -8.433957890768055e-03   +3.182218888356670e-03   +3.650022691428955e-03   +6.193782461586898e-03   +3.089670444843133e-03   +1.122008098926209e-03   +3.119210379356746e-03   +7.259840519660820e-03; +4.722366112194219e-03   -1.872683556467863e-03   +9.918760655516674e-04   -6.217722776525405e-03   +5.309896591848820e-03   +9.966133358782563e-03   +1.306295061374428e-02   +6.650255439047906e-03   +4.210803213485193e-03   +3.057771303992382e-03   +8.112704296999744e-03   +1.913571879276701e-03   +4.024805564238284e-03   +6.716686187093043e-03   -2.223120586293580e-03   +5.645528311170630e-03; -1.965204461900957e-03   +1.730592905718018e-03   -2.496043618046313e-03   +5.082472214603571e-03   +5.700716114703189e-03   +1.051906473047197e-02   +9.098629576255366e-04   -5.009976761781059e-04   +5.009166521595270e-03   +7.770192739275945e-03   -3.328043649727593e-04   +1.398307338000501e-02   +6.297703931732060e-03   +3.966674563133434e-03   +7.856148743522305e-03   +4.262814016818297e-03; +8.557367140184952e-03   -3.949511298490836e-03   +2.618844333296400e-03   -2.437940765878966e-03   +4.120665454024170e-03   +2.909154048778622e-03   +1.075812755125219e-02   +8.816151429872701e-03   +1.967352844396134e-03   -1.820611608171589e-03   +3.088582341414267e-03   +4.423185987197716e-03   -1.312401325465557e-03   +7.540184319166953e-03   +5.074759150398024e-03   +1.451451100102065e-03; +7.915238972805915e-04   +5.111455238444243e-03   +8.863643704129450e-03   +1.055187890625511e-03   +2.384969351760678e-03   -9.292575372898961e-04   +1.229947976653535e-03   +1.682513103537675e-03   +3.279729270934916e-03   +4.441318458442182e-04   -2.406343772062501e-03   +1.498077831501180e-03   +1.370602285781526e-03   +4.017002756113498e-03   +3.290986553889212e-03   -2.038597105408387e-05; +9.085037841076702e-03   +9.631310220227526e-04   +8.980390693891614e-03   -2.151434261109183e-03   +7.012888697354493e-03   -4.367813143998133e-04   +4.202186587453332e-03   -3.800376076800294e-03   +7.314931646889555e-03   +1.446202158842163e-03   -7.679418012472418e-04   +4.733565286805680e-03   +4.763043761624175e-03   -1.014968264628139e-03   +5.140583583538007e-03   +6.780341976739379e-03; -1.513082132806364e-03   +2.177997753309722e-03   +1.575217675007610e-03   -3.572124652557498e-03   -4.319467057747260e-03   +8.005202248309378e-03   +1.191885844116551e-02   +6.809598183654156e-03   +2.445861648219978e-03   +9.867013440408809e-03   +5.619800659466084e-03   +1.002789415858747e-02   +1.108764820598766e-02   +5.716311945636435e-03   +4.392317608115997e-03   +5.623124413043940e-04; +5.329929662110741e-03   -3.665254021579727e-03   -8.870398509112322e-04   +8.183173786457389e-03   +5.590284805625375e-03   +6.566406226497845e-03   -6.393224569577970e-04   +1.377659578986906e-03   -6.928259631891090e-04   +2.367004444513773e-03   +2.507600989508931e-04   +1.001426303666392e-02   -1.536058361982769e-03   -1.505526619886049e-03   +2.903091313730859e-03   +5.895341923484157e-03; +1.016911920910803e-03   +2.002716246192746e-03   -7.980916080865454e-04   +1.159836208124179e-03   +8.285395286017265e-03   +8.744492804111102e-03   +5.951549396355665e-04   +2.768756748332276e-03   +8.782684889378653e-03   +3.120138964680570e-03   +2.198642863281190e-05   +5.806815460598948e-03   +6.657059441143373e-03   +8.572240326282492e-03   +5.774983314947051e-03   +9.765674486072294e-03];
L2I_L1I_iGABA_netcon = [+1.047117042247717e-02   +3.614604742273988e-03   -5.404896607662710e-04   +9.795936758754899e-03   +6.521424722546856e-03   +5.101540732830029e-03   +4.662745774955913e-03   +8.410148625668162e-03; +4.408423018930701e-03   -3.028638005740399e-03   +1.565498824936974e-04   +3.486767641322038e-03   +3.955271571899489e-03   -1.802939573959498e-03   +5.007461780810794e-03   -1.636748506481002e-03; +2.836753433960248e-04   +2.184651773680979e-03   -5.172439287858679e-03   +4.662699739312841e-03   +1.012025067055294e-02   +1.407737971789034e-02   +4.788014336271266e-03   +6.575018953024466e-03; +9.008577827605256e-04   +2.125106614642435e-03   +6.074377280286549e-03   +2.200458356434096e-03   +2.746188366560016e-03   +4.604173688307140e-03   +2.243261543350426e-03   +1.072998118726810e-02; -2.594250021656914e-05   +2.627325975635108e-03   +3.885308024116306e-03   +7.461689619581199e-03   +2.936350378460025e-03   +6.718238626896520e-03   +3.545298603770858e-03   +2.456630755172763e-03; +1.289389869508950e-02   -3.692624606830164e-03   +2.427257556174973e-03   +7.714599221268397e-03   +4.803778114917107e-03   +6.263592276170249e-03   -3.355753153708372e-03   +5.982770746805454e-03; -9.179475125254532e-04   +1.294724406890809e-03   -4.473475515900595e-04   +4.632851130507746e-03   +2.511895138462392e-03   -8.287702313954469e-04   +4.797823719681110e-03   +5.790107847333067e-03; +8.943027289740542e-03   -1.971555258476702e-03   +2.913612157763447e-03   +8.624661649171538e-03   +9.095042033514235e-04   +1.303377899575051e-02   +2.907486525945751e-03   +2.038760884746916e-03; -2.559740586346138e-04   +4.686645758849263e-03   +1.170448662685127e-03   +3.365844833689139e-03   +1.259456010472558e-03   +3.824539111284738e-04   -9.637104378128759e-04   +1.049392185321373e-02; +3.269799842298958e-03   +9.014871115441249e-04   -3.213393770181516e-03   +5.038400540791773e-03   +1.295141503713037e-03   -4.153110981132367e-03   +7.238326606498297e-03   -3.879476523989372e-04; -7.181950424873215e-04   +8.719503957217852e-03   +8.284165783522281e-03   +6.734800566854656e-03   +6.960191098495671e-03   +4.960895634065232e-03   +4.713678565557012e-03   +1.903737492804742e-03; +9.894907535220453e-03   +3.303654497265544e-03   +4.494912500915718e-03   +3.780366813210426e-03   +1.081174988995317e-02   +2.913910790208860e-03   +6.373453132634246e-03   +6.583490680088482e-03; -5.605755996136872e-03   +5.121077304814708e-03   +4.461368200056074e-03   -2.434168607999808e-03   -1.296096800741923e-04   +4.683692836696898e-04   +5.130101919177620e-03   +7.179329713337829e-03; +3.562833729514487e-03   +7.065285988157822e-04   +8.918839100802954e-03   +2.447172583992244e-03   +3.657635730636063e-03   +7.351792351606614e-04   +9.018806077166762e-03   +4.354745479291482e-03; +1.082870525321423e-03   -3.732373610185321e-06   +7.947010740056194e-04   +8.193756249755381e-03   +8.475768359595199e-03   -3.477062562024676e-03   +8.595016623479567e-03   -9.278128342831097e-04; +2.141551116637962e-03   +6.233908649506259e-03   +5.675322790675433e-03   +2.136307524933402e-03   +9.027350796281386e-03   -2.492618397607578e-03   +3.182555840530494e-03   +2.618523925998555e-03];
L1I_L2I_iGABA_netcon = [+9.906683240711060e-03   +9.605150566853330e-03   +3.649755263262943e-03   +1.898110065434084e-03   -9.543752988171253e-04   +6.802808573899719e-03   +1.337399898356915e-02   +1.035482464183241e-03   +7.263637614682810e-03   +4.599169158093242e-03   -2.358252226069999e-03   -6.625124620715972e-04   +5.841059432099314e-03   +5.438431562567214e-03   -5.769556387032025e-03   +1.008098172591566e-02; +5.068153887025251e-03   +5.665820211274248e-03   -7.801589121971000e-04   +4.021656488108852e-03   +5.287389129297370e-03   +4.807292007921946e-03   +6.268416215188225e-03   +8.241836346360058e-03   +2.555298108143212e-03   +9.159133897971140e-03   +7.080686787550920e-03   +8.341719632895409e-05   +2.521044954150210e-03   +5.970764823723076e-03   +5.870155382530507e-04   +3.863690254360573e-03; +8.795171457423893e-03   +3.125565469980365e-03   -2.269182791650310e-03   +4.633057481766859e-03   -2.047131146882393e-03   +7.704214051282431e-03   +5.058191375321283e-03   +3.202652826344156e-03   +1.447193508297867e-03   +9.483612330736123e-03   +6.163054510329351e-03   -2.273224758118356e-03   +1.147469656487767e-03   -2.361405334846494e-04   +3.033112963326964e-03   +4.967933796535752e-03; +8.788408257096688e-04   -1.964378766483559e-03   +3.965517736852461e-03   +6.202749418435273e-04   +1.150784808515139e-03   -1.091405512321386e-03   +6.633111432123860e-03   +4.629565601625843e-03   +1.136909974559790e-03   -1.191370500851270e-03   +8.471736034820425e-03   +3.884169297575521e-03   +3.927287718902882e-03   -3.180109173639844e-03   +2.868640819211471e-03   +7.143576267208808e-04; +3.505821484339076e-03   +5.224258907619230e-03   +6.305554902067905e-03   +1.329086482930630e-03   +1.397867862194382e-03   +5.388181191790022e-03   +6.371206281326642e-03   +1.338861747566844e-02   +3.894900692699891e-03   +2.000485816587161e-03   +5.084976264872253e-03   +1.922974577512230e-03   +9.978618967295070e-03   +3.446638659791100e-03   -3.947433560758851e-04   +4.691321272016369e-03; +8.010531548212168e-03   +7.122647797362572e-03   -3.503594228042965e-03   +4.302602176565647e-03   +9.655013926941156e-03   +4.278151721219224e-03   +1.389310892689290e-02   +5.077145784697411e-03   +3.867090925849693e-03   -4.957367473961297e-04   +2.567900204236394e-04   +6.892053399308354e-03   +1.261021293595061e-03   +1.195522354435718e-02   +8.230327108779155e-03   +1.594306187560264e-03; +7.600276329652664e-03   +1.606054406002408e-03   +5.518559897980548e-03   +6.459033942883130e-03   +9.034581424426487e-03   +1.159331011634395e-02   +3.291381828846572e-03   +1.868679836256619e-03   +2.547554544575284e-03   +6.123031994467473e-03   +1.116356798187102e-04   -1.941732342929933e-03   +6.509990080041727e-03   -5.258079974722869e-03   +5.151196713891758e-03   +3.447382891533741e-03; +6.701553560750579e-03   +2.968210853580049e-03   +3.520749236186158e-03   +4.012945831801945e-03   +9.608749451204886e-04   +1.574809084637067e-03   +4.538381722793925e-03   +1.287743906359898e-03   -2.222952730248204e-03   +5.060375128806469e-03   +8.996287341552054e-05   -1.768925008966965e-04   -1.161273653559549e-03   -6.712273542134449e-04   +2.057605204183242e-03   +4.242235198547388e-03];
L2E_L1E_iAMPA_netcon = [+3.560982278715782e-03   +1.771962985222834e-03   +3.489999737161032e-03   +4.362055081975211e-03   -3.557870727862838e-03   -1.233994336769973e-03   +7.175208480096781e-03   +2.160686316857974e-03; +9.719498878832767e-03   +5.698258072186321e-03   +8.802434724485856e-03   +6.117163733683073e-03   +6.622087843753623e-03   -2.756695341455536e-03   +5.689844645505929e-03   +1.637998774665405e-03; -2.764809687641294e-04   +7.183802584496145e-03   +4.134171517416161e-03   +4.885775831742420e-03   +1.046708688090875e-03   +1.152913007432308e-02   +4.558701973611288e-03   +1.663559923812321e-03; -1.098920680884322e-03   +7.459971108885301e-03   +3.198920245631153e-03   +1.102809418068314e-02   +8.482388924570691e-03   +1.346620824511998e-03   +2.084142681219497e-03   +4.902789249242348e-03; -2.395375350147754e-03   +7.592075957206455e-03   +1.840215959092756e-03   -2.755878917098635e-03   +7.724797612104014e-03   +1.318081167697150e-03   +1.282026563290870e-02   -1.254116929867592e-03; +2.254018328410801e-03   +6.050384744532175e-03   +1.150103002337094e-02   +8.076389109504794e-03   +9.174781221541596e-03   -2.575761375669324e-03   +2.716065060919442e-03   +1.821152411533416e-03; +2.933674339741810e-03   +5.610228996227096e-03   -3.499680194938176e-03   +3.936031905677941e-03   +2.245245089648559e-03   +5.676294038575474e-03   -9.243301591990469e-04   +6.488235568691083e-03; -6.418698576271247e-03   -6.381291752787432e-03   +1.933240369308259e-03   +9.045622266230652e-03   +6.763334207900958e-03   +3.452338445344834e-03   +5.574703185053148e-03   +2.038497224389269e-03; +9.925669050671114e-04   +5.460063713209413e-03   -1.573216097444364e-03   +1.171781542347622e-03   -7.229368715913889e-04   +5.207902345132711e-03   +6.207061341085091e-03   +6.238192133523101e-03; +7.114945518643322e-03   -1.521151634202833e-03   +4.057039993426033e-03   +6.130310240545951e-03   +1.427594981530477e-02   +3.980884248031340e-04   -2.506697830674032e-03   +3.269128305504894e-03; +7.146754103458670e-03   +2.961592208231510e-03   -6.438721740053464e-03   +3.796576027193814e-03   +7.179134202379541e-03   -7.143820075884847e-05   +2.626829458801508e-03   +5.532891040342130e-03; -6.387203412280246e-03   +5.873136272245281e-03   +7.150881221333574e-03   +4.141580633017884e-03   +5.003777946124185e-03   -1.394909068087065e-03   +9.854684674672209e-03   +3.832679488555936e-03; +4.328779031993911e-03   +5.092087269872840e-03   +1.656736368392656e-03   +2.402798762734410e-03   +1.523513960326118e-02   +2.667058121872777e-03   +7.135879024119865e-03   +8.129816432180909e-03; +1.043015790463623e-04   +4.906326034072634e-03   +1.497099523219392e-03   +3.070705166342051e-03   -3.850656268285686e-04   +1.200270763103687e-03   +2.894025741438460e-03   +1.219979755763243e-02; +1.198927269372011e-03   +3.833491778188563e-03   +2.758875383606010e-03   +6.557564913457745e-03   +3.009396192771424e-03   -2.314606015508365e-03   +7.335141054814291e-03   +5.080940915034064e-05; +5.361288331623804e-03   +5.553448594372718e-03   -3.922178707362028e-03   +8.662861750146293e-04   -2.798350249956560e-03   -1.227019986295570e-03   +4.169038242927852e-03   +8.291442033290986e-03];
L1E_L2E_iAMPA_netcon = [-4.792158356478736e-04   +7.664507676445028e-04   +2.120385863218009e-03   +9.083782188663283e-03   +9.133389380163162e-03   +9.103968778985984e-03   +2.831769135497405e-03   +6.834695449355942e-03   +6.150452076894946e-04   +3.701301211215494e-03   +2.613621735562806e-03   -1.683278928219712e-03   +4.905534645976750e-03   +3.244569315898904e-03   +2.647012481310436e-03   +7.432815116215693e-03; +4.372844138161317e-03   +9.958318985661858e-03   +3.608464229523984e-03   +1.001418651725270e-03   +7.293991689977211e-04   +6.864277243591847e-03   -1.206055617231251e-03   +6.206155384179092e-04   -1.713755733592206e-03   +4.120063935021078e-03   +2.165989498941620e-03   +1.303654788578242e-03   -4.590310547358024e-03   +4.711043232505579e-03   +5.815939950371361e-03   +1.462096271517365e-03; +2.725137240460544e-03   +2.163597477969699e-03   +8.027335810537491e-03   +1.148137497719814e-02   +7.006377476412562e-03   +1.859165323253232e-03   -5.580125765898703e-04   +7.773957251059960e-04   +1.521648005347949e-04   +3.397527746749814e-03   +2.618560348057714e-03   -1.780393826081797e-03   +6.000064143174652e-03   +6.036500033932556e-04   +7.047456673941944e-03   +3.548056513889309e-03; +7.649971059676964e-03   -2.274465915247336e-04   -3.077317037653411e-03   -1.962070207800883e-04   +5.754087854898391e-03   +6.083606889537781e-03   +9.918664334239725e-03   +3.008582604348969e-03   +2.727985730579124e-03   +7.060822063262372e-03   +3.418114404633703e-03   +5.274122890980786e-05   +5.266917829996287e-03   +3.186937949847106e-03   +8.680879811695628e-03   +6.229199259996284e-03; +1.026154835512776e-03   +3.323592369011763e-03   +6.821583254667111e-03   -9.904797447925627e-04   +1.566375780682430e-03   +2.252874819237840e-03   +7.913060791857269e-03   +1.660876749800044e-03   -2.650389366350885e-03   +2.917507157446719e-03   -4.862913076882798e-04   +1.082203563082492e-02   +9.028076033555977e-04   -4.409009634391335e-04   +8.489860421022732e-03   +1.975170908183359e-03; +7.375799768732066e-03   +9.741113624082295e-03   +4.360816434973141e-05   +8.137919731500775e-03   +1.641876441046345e-02   +8.230691046349093e-03   +2.645999633402053e-03   +4.068024252445506e-03   +3.052148363955519e-03   +7.415909638164534e-04   +6.387182064965523e-03   +4.838739946626602e-03   +8.064497561893366e-03   -1.969407317779412e-03   +2.671509898053400e-03   +6.173485525772611e-03; +1.032493492649519e-03   +1.814951500437572e-03   +3.624003882661206e-03   -2.220892415838988e-03   -4.524495193785505e-04   -1.825110989850400e-04   +6.647862196042190e-03   +7.377709891251612e-03   +3.560477355904619e-03   +5.166112935823174e-03   +3.291609313313577e-03   -1.106129287149846e-04   +4.633035611457250e-03   +1.444241891562310e-03   +1.648093942507392e-03   +3.346184187631750e-03; -3.744340019387074e-03   +5.558788927047619e-03   +4.241580660359944e-03   -2.822172264370695e-03   -8.304090233500123e-04   +6.286653054754894e-03   -2.780182778385227e-04   +1.038909226573532e-02   +3.133296431564132e-03   +4.765164017055818e-03   -3.414993496313123e-03   +5.614866724021935e-03   +4.270245961691267e-03   +5.350055947968932e-03   -3.793593759086099e-04   +3.087959008471190e-03];
L2I_L2E_iAMPA_netcon = [+4.142871004316624e-03   +9.555026717984361e-03   +4.345826445101043e-03   +9.232402124092841e-03   +6.341046215711111e-03   +3.089361273830893e-03   +1.043018889070478e-03   +3.655184360230342e-03; -9.191024155543062e-04   +1.962313989628251e-03   -3.895704026687687e-04   +9.604909981581429e-03   +3.377292931685693e-03   -9.419953529142462e-04   +1.829582053514967e-03   +5.986632778020666e-03; +8.738528989086886e-03   +4.414367308064152e-03   +5.241428080328272e-03   -7.357031067617217e-04   +3.152688667759114e-03   +2.910694973553539e-03   +4.919132283534981e-03   +2.173514645749330e-03; -4.555666464327834e-03   +1.432058386087944e-03   +8.320114015979057e-03   +2.180902834463805e-03   +6.058877775638762e-03   +4.867102514319639e-03   +9.725371947039937e-04   +9.583235472192544e-03; +5.243661958705696e-03   +5.643445522652247e-03   +3.429084944467408e-03   -2.393740963714165e-03   +8.986025046907046e-03   +5.495090427422711e-03   +3.619108406003628e-03   +1.724111015636273e-03; +6.438532234540181e-04   +1.026823459327771e-05   +1.973002701207262e-03   +1.521194592141324e-03   +3.423306118835459e-03   +6.096247455426014e-03   -5.152122803037397e-03   +6.772735993786386e-03; +6.921565820586231e-03   +3.103411312601214e-03   -1.304401036563404e-03   +3.822569728389473e-04   -4.908669500821607e-03   +6.207077748366102e-03   -4.870416172012870e-03   +9.946905999236496e-03; +3.461384832639533e-03   -4.703548265458809e-04   +1.952889411461192e-03   +4.258400545917402e-03   +9.551596605132003e-03   +5.662391566755914e-03   +8.954954876081781e-03   +2.679212486353935e-04];
L2E_L2I_iGABA_netcon = [+3.450553889919376e-03   +8.951666553567905e-04   +3.702405436327701e-03   +2.282938796803747e-03   +1.041887992764756e-02   +2.359776433858951e-03   -2.361419599585749e-03   +7.006537832697913e-03; -4.001202185736083e-03   +3.853119894921913e-03   +2.990776896752680e-03   -2.959831918094807e-03   +7.674132372099816e-03   +6.150798710883291e-03   +1.008726366201212e-02   -2.208745905642680e-04; +1.700910462697695e-03   +7.567174962437248e-04   -1.205772402409831e-03   +5.806279674714962e-03   +6.116830474293838e-03   -4.611918710254835e-03   +6.559144684098915e-03   +7.361305179790095e-03; +7.779076742367645e-03   +2.625911318576237e-03   -1.302437782812426e-03   +4.366090989317100e-03   -9.800982581593537e-04   +4.409988198845371e-03   +6.533763980211219e-03   +2.077440054550834e-03; +1.096471175618117e-03   +1.049879722176326e-03   +7.326370485909277e-03   +7.020723260309018e-03   +2.641526472967010e-03   +1.136564026778271e-03   +7.836364479047977e-03   -5.768093438347395e-04; +6.019382491995672e-03   -3.606842710050543e-03   +4.384898537025794e-03   +1.026434650128298e-02   +6.036799738624424e-03   +1.699688429186946e-04   +4.594690910305297e-03   +6.035019400054798e-03; +5.621551093660573e-03   +4.423755228909271e-03   -3.228537361920490e-03   -4.506784767549122e-03   +4.052533094363923e-03   -3.508253524886594e-03   +2.041883766445318e-03   +2.013543121571849e-03; +9.814752221194880e-03   +2.867504531335059e-03   +3.993419714246225e-03   -5.747748196435656e-03   +4.441378891094820e-03   +6.894972004204062e-03   +1.851690426911193e-03   +5.576319604529510e-03];
L3E_L2E_iAMPA_netcon = [+3.002024464074154e-03   +1.255010026690283e-02   -2.482855647227965e-03   -3.276578553911049e-03   -2.220345188020280e-03   +2.370539944457754e-03   +5.201061649189814e-03   +7.250130025702733e-03   -1.080707518981661e-03   +9.738623003914935e-04   +8.972840362262440e-04   -2.286068289206416e-04; +2.755942989801641e-04   +1.045767710781007e-02   +9.099047855476109e-03   +2.002866978828876e-03   +1.047096072504360e-03   -7.673444648321210e-04   +1.044562446973834e-02   +8.037312458505981e-03   +8.959812920270488e-03   +4.154005970467115e-03   -4.929953227694565e-05   +4.083419128577528e-03; -1.250024087138884e-03   +6.685259533847113e-03   -7.184095565687134e-03   +4.279385596405919e-03   -3.260938908030580e-04   -3.291887703424860e-03   +5.337028914986627e-03   +8.116330630760175e-03   +7.531325518188342e-03   +3.675312588472053e-03   +5.647062187046706e-03   +4.435585768535960e-03; -1.308679074596780e-03   +1.443392905302404e-03   +4.807243098379512e-03   +8.438397562993558e-03   +6.348928419213492e-04   +1.435219554616728e-03   +2.434789243984360e-03   +2.000523462069575e-03   +5.619157816207023e-03   +4.670261479005644e-03   +2.566927897551589e-04   +2.642502023137304e-03; +3.032670431067132e-03   +3.080608027361469e-03   +2.171402613185765e-03   +1.054904270592538e-02   +3.486188740209755e-03   +2.949267531398570e-03   +8.746272802939646e-03   -4.452378009902423e-03   -2.357058842371719e-05   +1.240288351240803e-02   +7.056990188219867e-03   +5.714408062124190e-03; +7.738543233691770e-03   +3.251382838837695e-03   +5.102608299157838e-04   +2.145782011012682e-04   +3.778693788598058e-04   +1.279231522596283e-02   +1.308847665562410e-02   +7.402593925820695e-03   +1.037030771872071e-02   -1.237545428641546e-03   +6.990337173264453e-03   +2.414292598301109e-03; +6.111674255355325e-03   -2.484971178353182e-03   +4.805032634978244e-03   +3.176228915039614e-04   -3.455378936160884e-03   +3.351396800434279e-03   -9.974976942225843e-05   +8.297307260633392e-03   -2.845239026076518e-03   +2.695028061727116e-03   +2.670734433140210e-03   +4.095548850287903e-03; +6.507316369786449e-03   +3.557258783671401e-04   +2.670788778010086e-03   -2.034821154615800e-03   +8.998900947660081e-03   -1.124678802500951e-03   -2.295873142334701e-03   +1.893566617120132e-03   +3.389611902309102e-04   +9.492462602736382e-03   +5.249610642399948e-03   +8.942801679416528e-04];
L3I_L2I_iGABA_netcon = [+3.437588292562110e-03   +4.807775024671175e-03   +1.140778182677341e-02   +8.775735895283316e-03   +5.272734784123836e-03   -7.933228569388777e-04   -2.265114092538646e-03   -3.973543659132319e-03   +6.240275153841825e-03   +2.267431766006280e-03   -6.163893411623922e-03   +1.412439679332407e-02; +2.822411781777965e-03   +4.921025909412302e-03   +6.038845662962955e-03   -3.502993452010964e-03   +7.340090246497532e-03   +4.834377250913994e-03   +5.250410163284739e-03   +9.027652507064448e-04   +4.177778898141683e-03   +2.018751343117717e-03   -1.972260186152928e-03   -1.069509971566479e-03; +1.751595581576993e-03   -2.305558496527075e-04   +1.048483773561058e-02   -4.914800603390331e-04   -4.946167112628006e-04   -5.997006713031455e-03   +2.569991203325832e-03   -1.954424272805524e-03   +9.118539171182546e-03   +2.775902389209534e-03   +3.508464762119525e-03   +4.325295933714808e-03; +1.226448111647171e-02   +1.910488904325562e-03   -1.564020562511839e-03   +3.158324892636596e-03   +3.152332199297216e-03   +8.706512695675492e-03   -3.304975988229154e-03   +1.546011100179748e-03   +6.105043884601149e-03   -1.467057189245131e-03   +7.000070799870910e-03   +8.871350841088095e-03; +3.899620203516221e-03   +6.385618743723012e-03   +1.588424804933643e-03   -5.259748110914838e-03   -3.386384431612633e-03   +9.043493659820748e-03   -2.760639213480479e-03   -1.540478000229505e-03   +7.238691439840959e-03   +1.297653835136868e-02   -6.727543980658640e-03   +2.500676640311923e-04; -7.624828015811341e-04   -3.545868606918842e-03   +6.955901224130518e-03   -2.615651990458783e-05   +1.611338818278744e-03   +5.886134282636902e-03   +2.364809901013036e-03   +4.898183648894717e-03   -1.699971740062084e-03   +5.073409543151992e-03   +4.958325743689605e-03   +5.480108073582660e-04; +5.586346596205038e-03   +2.943541182327429e-03   +5.505372847097849e-03   +7.716232398177231e-03   +3.435530657226322e-03   -9.696710035856494e-04   +5.220133807622167e-03   +5.685541764056837e-03   +1.392078179613132e-03   +8.158337119624864e-03   +1.603966991721995e-04   +1.467633207378751e-03; -2.035796973006782e-03   -1.294741252904449e-03   -7.432334222585947e-04   +6.662094847047698e-03   +5.073679162069224e-03   +2.251463957176258e-03   -2.793147526649032e-03   +3.797644276474210e-04   +1.085993290766351e-02   -2.539284945917632e-04   +3.205759883985913e-03   +1.194642981123284e-03];
L2E_L3E_iAMPA_netcon = [+8.610544812504209e-03   +2.765396578268100e-03   +4.258227977494627e-03   +6.213335423654865e-03   -4.344632161346042e-03   +3.017596874576039e-03   +8.512939581494282e-03   +4.262404885295001e-03; +3.841375947877253e-03   +6.730827041707240e-03   +1.060343557528763e-02   +8.912509465010791e-03   +2.809019210143601e-03   +5.239532913941893e-03   +7.857580843034751e-03   +3.646337962605174e-03; +6.281483772950045e-03   +5.999672733335025e-03   +8.560765686202117e-03   +5.561129675518338e-03   +4.042205804937486e-03   +5.166003601146482e-03   +6.398385352236420e-03   +8.131795079501122e-03; +3.182918663776728e-03   +5.224130387234078e-03   +4.904891973818442e-03   +3.120993638488907e-03   +1.966383431543496e-03   +5.544097746261379e-03   -7.191363902241406e-03   +6.620417429356390e-03; +5.343262949254631e-03   +5.047405659952273e-04   -4.093967001930208e-03   +1.257992048978927e-03   +9.516035314461425e-04   +1.747330340898980e-03   +6.179911528006986e-03   +4.583083573970538e-03; +6.336638932080886e-03   +6.768665481265215e-03   +6.887818028615067e-03   -1.304059554684660e-03   +7.114804580118391e-03   +9.735205173648525e-03   +3.762974943015504e-03   +1.033402643594323e-02; +7.262221710711190e-03   +8.664091153965716e-04   +9.963566184064243e-03   -4.315650471475878e-03   +1.897692707380529e-03   +6.291442512410525e-03   +2.028404773337804e-03   +4.172945644842743e-03; +1.469230338627904e-02   -7.160047618173532e-05   +5.627211192623563e-03   +4.707058189384996e-03   +7.009110707586911e-03   +5.823795953495105e-03   +5.319940596995341e-03   +3.065489128712300e-03; +5.867586725522834e-03   +5.122874356697388e-03   +5.056030380371061e-04   +7.762577845570703e-03   +8.006123338385508e-03   -8.569561553984672e-04   +5.725172990265145e-03   -7.762544709997665e-04; -3.950017828172031e-04   +4.308075988074650e-04   -3.264332286341577e-04   +4.074632698328916e-03   +7.461363686822481e-03   +2.980026253325239e-03   +3.069597666396836e-03   +8.580768448872110e-03; +5.878184819090009e-03   +1.219535269247717e-03   +5.612824698121964e-03   +5.887086961902778e-03   +1.251848966042599e-02   +6.645768004172739e-03   -7.159486490059256e-04   -3.187422767778582e-04; +1.258048388844174e-03   +5.761470525148564e-03   +2.549268525786033e-03   +5.235147643271455e-03   +4.460752756648209e-03   -2.208804419780502e-04   +8.920025487511555e-03   +8.026564006115613e-03];
L2I_L3I_iGABA_netcon = [+1.019306694970349e-02   +5.184756999945918e-03   +7.120177838250204e-03   +6.974946328970071e-03   +8.022087930602183e-03   +4.055138627183074e-03   -5.096052241206112e-04   +3.884944848236867e-03; +3.816153230550810e-04   +2.863846107948572e-03   +8.088463949905748e-03   +2.843196812038440e-03   +4.307916239920313e-03   +7.191869269561644e-03   -6.090665822406475e-04   +8.086302977061996e-03; +1.674360390117157e-03   +5.738092605469931e-03   +9.909975590720972e-05   +8.927599792266931e-04   +1.862362732977619e-04   +3.608831225898193e-03   +7.468933008201140e-03   -1.560447339585749e-03; -8.541140778943526e-04   +1.124129993012757e-02   -1.169016521392721e-03   +2.805119716855575e-03   -6.778498108190165e-03   -2.756659029268831e-03   +6.080807584394374e-03   +5.502762700497641e-03; -2.511643748928470e-03   +8.839671633549661e-04   +1.638866028014390e-03   -1.231215929997227e-03   +8.373608394009101e-03   +5.315013828262507e-03   +2.339346228253586e-03   +1.207733555577543e-03; -4.442011523416880e-03   +1.310650850402999e-03   +3.634715624392904e-03   +4.594918060354902e-03   +1.524553372548640e-03   -1.886529083391042e-03   +4.471314133817502e-04   +1.006847090750156e-02; +1.447019868456243e-03   +2.374690338146190e-03   +7.589744216086326e-03   +5.970763294005454e-03   +3.033908412169450e-03   +2.949707948157572e-03   -1.729826811473723e-03   +8.005564448662862e-03; +2.571854805431286e-03   +7.532927881198701e-03   +7.648964360186025e-03   +3.507164735278185e-03   +2.294334024439953e-03   +8.503906862008500e-03   +5.968000176643791e-03   +2.777480159645417e-03; +9.447497222400698e-03   +4.219302668570863e-03   +9.540189704057147e-03   +3.652943529027232e-03   +2.693839253604263e-03   -2.883842156319549e-03   +1.076408533186035e-03   +4.602686575870429e-03; +6.296057664579781e-03   +7.271590988429956e-03   -4.169485814483544e-03   -8.441257557629127e-04   +6.107015448076957e-04   -5.998890013625001e-03   +3.318418365917784e-03   +2.014191267902993e-03; +3.513841049005346e-03   +5.616016228150932e-03   +1.430956663484979e-03   +5.273207132381568e-03   -5.083241125130970e-05   +6.821708945070717e-03   +6.182212846657524e-03   +3.982356004616302e-03; +2.869774185144544e-03   -5.276696707716475e-03   +3.196384328525443e-03   +4.365792119714613e-03   +4.634538416794155e-03   +6.118439115779604e-03   +9.316480809580936e-03   +3.622348626547413e-03];
L3I_L3E_iAMPA_netcon = [+5.870995751684677e-03   +5.205775580019418e-03   -7.569739544603692e-04   +9.534104637276282e-03   +7.953786617551436e-03   +2.267046315154686e-03   +5.281004525947985e-03   -5.764074120348541e-03   +5.882105902545645e-03   +1.692985849967156e-03   -1.850451178414096e-03   +1.994331930240827e-03; +4.370411874501660e-03   +3.009689696113147e-03   -3.538763205716612e-04   +2.089297842325877e-03   -3.810646191684232e-03   +2.221331815493148e-03   +2.790186030006574e-03   +5.144627819985193e-03   +4.536561302546612e-04   +2.347921016225264e-03   +3.687142505380486e-03   +6.566762544718416e-03; +3.509502156872984e-03   +5.703965646981999e-03   +1.736090751029728e-03   +2.991229191296387e-03   +1.856730115380538e-03   +5.307175972275275e-03   +2.740479843635499e-03   +3.981309148646420e-03   +4.057750843998351e-03   +6.062871352232026e-03   +8.045486466243311e-04   +1.170483856113652e-03; +7.262813176514284e-03   +1.287981757179955e-02   +4.579234987961246e-03   +5.307490646054899e-03   +5.328929158154454e-03   +5.947897196960282e-03   +7.305454493214269e-03   +5.388171453572826e-03   +6.135760352886291e-03   +5.934770169116946e-03   +2.532928371751351e-03   +9.164941956353742e-03; +3.475476914219653e-03   +3.042856055244190e-03   +3.025631405997072e-03   +4.458899557546523e-03   +5.614956669369386e-04   +7.081152101508317e-03   +7.922569699581846e-03   +1.426169905880696e-04   +3.164457304498639e-03   +1.879158491767879e-03   -2.579735129070249e-03   +4.067683527566604e-03; -1.059969517469635e-03   +9.152268590300657e-03   +3.598755407667223e-03   +1.123508876526123e-02   +3.021001997312900e-03   +2.885567191406738e-03   +5.522093639194500e-03   +1.784618885723945e-04   +5.337627768038387e-03   +2.558643690350416e-03   -5.491855000961966e-03   -3.656981003274005e-04; +1.947174580025051e-03   -1.016620000979620e-03   +3.456861831848158e-03   +7.855492782827794e-04   +7.312814230825511e-03   -1.677480732629659e-03   +3.881433638646106e-04   +7.401181816094305e-03   +1.354216452219476e-03   +7.267201611613999e-03   +9.215942450917284e-04   +7.402488943491407e-03; +4.892701762131069e-03   +3.541542540559187e-03   +8.844775336528197e-03   +6.187042105846880e-04   +4.484563184704025e-03   -1.078260703553586e-03   +8.351416502619194e-04   -1.250647583342426e-03   -1.084986275168567e-03   +2.367060956104573e-03   +5.516604204152385e-03   +3.110066408781113e-03; -2.026583566119907e-03   +1.383881439999303e-03   +5.003618455327186e-03   +4.608736777572422e-03   +4.122637805432545e-03   +7.810124479761738e-03   -5.207359404214948e-03   +6.242426441790516e-03   +9.463141854286690e-03   +8.494181311802880e-03   +2.967076810292339e-03   -3.190419015045655e-03; +7.348297519522230e-04   +4.755680934589790e-03   +6.566575776721038e-03   +2.861843188498312e-03   +4.891397970122660e-03   +7.283372321942701e-03   +1.864230196202284e-04   +1.145086243197762e-02   +7.665873017831462e-03   +6.411710143940907e-04   +6.675549901427664e-03   +3.924771803307068e-04; +1.984569627570423e-03   +2.942150017094280e-04   +1.404702780719230e-02   +5.613242643602981e-03   +5.856616788302159e-04   +3.402369143305953e-03   +3.194454890914250e-03   +5.075662469806089e-03   -1.320178549999435e-03   +5.146825714139218e-03   +3.809931156930667e-03   +3.512657443545313e-04; -8.066782586686231e-03   +7.068208043723016e-03   -1.282522555546218e-04   +8.852961513892173e-03   +8.227033136431562e-03   -2.123405836764039e-03   +1.192014490903657e-02   -6.582495939405590e-03   +1.450966586493665e-03   -1.812869933242824e-03   +9.400821703564294e-03   +2.877659094430181e-03];
L3E_L3I_iGABA_netcon = [-1.176565529067570e-03   -3.082401389296586e-03   +2.183294825841006e-03   +8.334472498945266e-03   +4.993196156375068e-03   +1.383874689334086e-02   +5.421892965942482e-03   +5.296940825811822e-03   +2.435003140576075e-03   +2.187910187071650e-03   +4.373434491269053e-03   -2.470873918421233e-04; +6.134891617961578e-03   +4.982765979918762e-03   +6.524871614345634e-04   +1.350616581032252e-03   +3.029974558470626e-03   +5.449849664200808e-03   +3.101737811694920e-03   +6.435668745673105e-03   +2.979806521518477e-03   +5.524565692889169e-03   -6.747844636791922e-04   +4.478011456722075e-03; +1.622649789130104e-03   +4.207680498995611e-03   +3.379046651823433e-03   +4.222821371902744e-03   -2.822799832684277e-04   +7.966272516535115e-03   +2.831245002868300e-03   +1.422149839628363e-03   +2.619160176743358e-03   -6.317557597190331e-05   +3.228276880800026e-03   -3.049508418977067e-03; +1.723650381457253e-03   +3.575359916881477e-03   -1.732766807600028e-03   +1.087367678795073e-02   +3.123693010116605e-03   +3.971984204057526e-04   +4.405768302492923e-04   -5.717227799214987e-04   +1.034772199431236e-02   -1.974572249365609e-03   -3.627081370491259e-03   +6.167003063760335e-03; -1.740629864868154e-04   +4.976200772354300e-03   +1.095792540126994e-02   +3.855049518758849e-03   +4.146832429926162e-03   +2.698674582779760e-03   +7.769460960300452e-03   +8.651348996247737e-03   +5.870449122173852e-03   +8.605543970180127e-03   +9.806016751154794e-03   +1.656680049112429e-03; +2.704178131117386e-03   +4.655466442141516e-03   +8.051526303794625e-03   +2.417591068070384e-03   +2.307103859041656e-03   +8.527198102065335e-03   +4.454739684831259e-03   -4.190430823483284e-03   +3.921003605334148e-03   +4.180166318588544e-03   +4.316476179868714e-03   -2.315048546640255e-03; +4.158971170436695e-03   +3.354315980474454e-03   +3.765981420675529e-03   +3.444644738613746e-03   +1.747581708778851e-03   +4.533403919101881e-03   -1.592675310460208e-03   -1.680579859360449e-03   +3.589630753856046e-03   -2.684603941449557e-03   -9.940241203919285e-04   +5.250388737041801e-03; -4.244641068268900e-04   +4.119317265650682e-03   +4.727846356170694e-03   +9.298138221147181e-03   -2.765095351423734e-05   +2.712949132279059e-03   +2.894241019834215e-03   -7.544837744447902e-04   +6.955694534536049e-03   +6.157389516885712e-03   -2.667430903147854e-04   +6.556089385199859e-03; -4.610143834658201e-05   +1.232637488313665e-04   +4.329638731122108e-03   +1.898928340405462e-03   +4.054720073508682e-03   +6.747337556919088e-03   +8.560852636773177e-05   +8.535338033261321e-03   +3.304750601042446e-03   +4.789414120110515e-03   +3.002320725426371e-03   +7.955262700437029e-03; +6.308337044924413e-03   -4.516211127187317e-03   +3.102357390313671e-03   -2.442329711560132e-03   -3.666522024685654e-03   +9.114290599117739e-03   +9.338230425430697e-03   +1.761234133815339e-03   +7.709675653574313e-03   +6.771046833318858e-03   +5.397011048243392e-03   -6.705044103910415e-03; +3.187406513931453e-03   +1.448264883826945e-03   +2.276752849497805e-03   +2.816799952531570e-04   +7.845266018304193e-03   +3.943349429102257e-05   +1.274129650882656e-02   +2.326104529619999e-04   +9.503266919112999e-03   +7.497314766682538e-03   +1.597000463027495e-03   +5.282830128135648e-03; +1.020432344589242e-02   +6.160859052721162e-03   -4.844309072682250e-04   +3.461034268188118e-03   -6.747499495535227e-04   +3.129352180935916e-03   +8.301482115716503e-03   -3.828285033479594e-03   +1.105429919546894e-02   +2.867912177087416e-03   +1.918307985049223e-03   +1.795479392875525e-03];
L2E_Input1_iAMPA_netcon = [+3.193467839647471e-03   +1.219771762397458e-02   +7.648629094050277e-03   +6.962511747889037e-03   +8.643815139353942e-03   +7.466077948991308e-03   +2.897656300830515e-04   +4.516112175731978e-03];
L2I_Input2_iAMPA_netcon = [+8.802567598155876e-03   +9.411880198021250e-03   +7.889410047841291e-03   +6.116310326636081e-03   +5.703864269015062e-03   +5.471894430921836e-03   +9.230769480377725e-03   +9.190324663756124e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
