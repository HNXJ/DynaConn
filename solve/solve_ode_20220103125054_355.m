function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.358799133881698e-01   +7.492764203697604e-01   +9.071579395242897e-01   +1.698399014451147e-01   +2.053949104457055e-01   +7.507757112529867e-01   -4.603803112548738e-02   +3.916641280927720e-01   +2.963325661947494e-01   +2.297037628856967e-01   +3.906273449471075e-01   +1.848381204033224e-01   +5.116222008040100e-01   +2.964551186561100e-01   +2.455193649093987e-01   +1.697007799688838e-02; +9.336802021577197e-02   +9.706149611445952e-01   +8.631508410321759e-01   +7.740461719432009e-01   +3.442209714064111e-01   +7.157728526171612e-01   +7.252849753419719e-01   +1.197283567738321e-01   +1.054564889051943e-01   +7.343123745420995e-01   +5.382210986214242e-01   +6.502529510592925e-01   +4.828274257249076e-01   +2.718619859769177e-01   +6.741924181924194e-01   +2.601358343889302e-01; +2.548372243414069e-01   +3.202814452060971e-01   +4.175790652818762e-01   +5.600490553852232e-01   +5.598350548956277e-01   +4.100201934551938e-01   +2.615131764644436e-02   +6.608501282488147e-01   +3.087242846189909e-01   +5.234771311080014e-01   +8.582772416648398e-01   +2.361640569915937e-01   +4.693883135311572e-01   +1.200194668264700e-02   +3.754282086126332e-01   +9.543418749187756e-01; +1.903937297426086e-01   +6.286989776120460e-01   +1.154114444206185e-01   +2.418645166665615e-01   +8.831446979933985e-01   +7.820634395181536e-01   +1.992769418440563e-01   +5.703014742098981e-01   +7.691370918567406e-01   +7.478700175427769e-02   +2.130586941587623e-01   +8.513437587647412e-01   +5.323751157567025e-01   +1.579781619679663e-01   +6.123629126026838e-01   +4.425654574623493e-01; +6.556503387479716e-02   +7.357542510533623e-01   +8.387908156425844e-01   +7.406845218491558e-01   +5.221233758391444e-01   +3.427280495419369e-01   +4.696367507962122e-01   +2.476664456769559e-01   +2.560118918509863e-01   +4.906574287507169e-01   +2.144455314824529e-01   +6.462066699563495e-01   +3.713626838025096e-01   +7.719846131496322e-01   +2.416472638338136e-01   +8.798394694071787e-01; +1.171965348170481e-01   +1.888612960351098e-01   +7.545524758997566e-01   +7.677308486934811e-01   +6.077987797330916e-01   +8.980821281523174e-01   +3.284912002189306e-01   +4.032775045718187e-01   +8.454942830794524e-01   +8.688370848047174e-01   +8.715590197359665e-01   +2.390371787982175e-01   +3.780187445307566e-01   +1.726223396294925e-01   +8.534979628517851e-01   +3.577724678905467e-01; +3.110340017510870e-01   +7.463954897068897e-01   +5.356117664535160e-02   +3.569985437837436e-01   +8.456156632186043e-01   +5.253115909210979e-01   +4.730361211035959e-01   +6.222691396473226e-01   +8.990097482272594e-01   +9.484506704611476e-01   +6.607878605541019e-01   +8.098765482781846e-02   +3.687527218920112e-01   +3.470502278511894e-01   +6.942547122910847e-01   +8.669407114598704e-01; +6.842101419633013e-01   +7.293663461085563e-01   +7.430529232027203e-01   +3.654318516586966e-01   +6.518052569235954e-01   +4.606099359181436e-01   +5.974815993925624e-02   +4.085463550143105e-01   +9.905994955197018e-01   +9.078009373506399e-01   +3.300692275163900e-04   +7.319282284186333e-01   +8.194830138225394e-01   +5.558389967448535e-01   +2.776512813376172e-01   +8.515686735701213e-01; +5.012872827175240e-01   +5.784043261416070e-02   +2.776076224306785e-01   +3.706175984081472e-02   +4.865872447816111e-01   +1.128678504138648e-01   +1.579509349765311e-02   +5.601756784883986e-01   +4.504385046152121e-01   +7.552821798880556e-01   +7.593563663121689e-01   +5.539302722093913e-01   +3.014916136188626e-01   +1.722346720318614e-01   +9.744397541385330e-01   +7.260132904950330e-01; +6.981794467445829e-01   +4.973845879494957e-01   +5.563419703508042e-01   +2.679551892637123e-01   +4.462154505577135e-01   +3.541722743174243e-01   +6.401389369353812e-02   +2.567435117280814e-01   +7.562631345496765e-02   +7.944789411734328e-01   +3.862401327370922e-02   +8.225411911777677e-02   +3.310082853977065e-01   +7.205444062745320e-01   +2.957756597243012e-01   +8.300679588750933e-01; +4.236123979627276e-01   +5.040569655257279e-02   +1.930009903862456e-02   +1.387680221003703e-01   +9.393898140883084e-01   +5.737922142690144e-01   +2.673149933715964e-01   +1.771443332223296e-01   +1.719329598597057e-01   +8.597047150812482e-01   +1.047455257077458e-01   +7.313361436322868e-01   +5.197416992215687e-01   +8.331382075642221e-01   +2.315541242789647e-02   +1.119692344515733e-01; +1.629222461812250e-01   -2.284718350023083e-02   +9.413825115593151e-01   +5.130399421275945e-01   +6.591683242997147e-01   +5.143107538712727e-01   +6.951490441496579e-01   +4.149703504680031e-01   +6.085835632573370e-01   +1.191519159753136e-01   +3.599073882682516e-01   +8.086690581763251e-01   +8.402273121998373e-02   +4.707338865620391e-01   +3.864905627871522e-01   +1.027119379425949e-01; +4.670780173331796e-01   +3.412741852214951e-01   +6.481757867090405e-01   +2.707827909746996e-01   +6.323822523949212e-02   +4.507029587011286e-01   +4.640061571796822e-01   +7.150196027825247e-01   +2.572368591058483e-01   +8.839006078931868e-01   +1.277401159895272e-01   +4.364317048213079e-01   +2.041375281575404e-01   +2.190354907215001e-01   +3.197628595768606e-01   +2.266461917791014e-01; +1.102748444974835e-01   +8.790945756411211e-01   +7.626059775278901e-01   +7.156153601443588e-01   +7.692421926653789e-01   +5.674021605253196e-01   +3.319804749455898e-01   +7.553421239929230e-01   +3.874690846523572e-01   +4.362217410286078e-01   +8.783687727282802e-01   +6.184511364705492e-01   +5.770665381789875e-01   +5.341757441682370e-01   +1.342000505248494e-01   +3.535541110809716e-01; +1.397812928894462e-01   +2.446579590413395e-01   +6.559738726106801e-02   +4.163913903043596e-01   +4.191658756159127e-01   +8.313099593682678e-02   +6.595671952278244e-01   +2.902947734692528e-01   +8.479488985409274e-01   +5.140742356497319e-01   +8.630997067801430e-02   +8.540633052496971e-01   +6.536127047168654e-01   +1.839460711380346e-01   +7.065189755387371e-01   +1.398784463985342e-01; +5.560332958551333e-01   +2.821080495974650e-01   +3.022122384540306e-01   +6.277941729299601e-01   +5.440246144592795e-01   +6.063259572602733e-01   +2.674186672758469e-01   +1.130781041187430e-01   +5.836873600933314e-01   +4.518297701822061e-01   -1.568111210529123e-02   +3.950625552925048e-01   +1.759369455812375e-01   +9.230706204090648e-01   +9.164230038321011e-01   -1.043443840256270e-02];
L1E_L1I_iGABA_netcon = [-4.623429499644780e-02   +2.926712665803065e-01   +8.916240237014931e-01   +2.478267296900495e-01   +4.395624242769794e-01   +1.116598904907109e-01   +3.311992178372504e-01   +2.115206223820272e-02   +2.292873151625461e-01   +4.728887479254395e-02   +4.210835895849815e-01   +9.759936942920009e-01   +1.656245945408187e-01   +8.074068731026172e-01   +9.352909402662116e-02   +4.272824780668005e-01; +7.797193423293457e-01   +7.689567139364829e-01   +5.322078283880879e-01   +8.495731822829731e-01   +7.318676704843027e-01   +8.517187832808040e-01   +6.442955932687388e-01   +8.561397297266274e-01   +9.154103736321333e-01   +9.383675684560890e-01   +1.276128268748171e-01   +1.059407263933802e-01   +6.089688325010775e-01   +9.389784610424107e-01   +9.878057784787883e-01   +2.625819976258828e-01; +3.116130900733781e-01   +8.412613118298995e-01   +1.250857694202387e-01   +1.041070578444655e-01   +1.207082432630595e-01   +2.195844238204185e-01   +5.900106563782567e-01   -1.957803974381884e-02   +6.257606742934889e-02   +1.360070510036683e-01   +5.351144441752579e-01   +4.436908090857172e-01   +8.366667864158579e-01   +8.223536558306110e-01   +7.956948379110030e-01   +7.473685388580109e-01; +3.433183499168605e-01   +4.860882899872958e-01   +6.319696995487569e-01   +7.643726778100337e-01   +6.697993511714504e-01   +6.050198947666333e-01   +5.700440120074317e-01   +9.022294232626231e-01   +4.196467327162336e-02   +3.162131752636700e-01   +5.456340813377130e-01   +2.542902052703591e-01   +8.352600054750973e-01   +4.052337719917530e-01   +9.311685290947245e-01   +5.257070540948616e-01; +7.063284538324395e-01   +6.031752182311484e-01   +8.695957700140733e-01   +3.635627299169258e-01   +9.741194346147221e-01   +5.321273713394041e-01   +3.425244418658056e-01   +4.472810761200239e-01   +3.192962362706246e-01   +8.047816524416909e-02   +2.197495220608295e-02   +5.979708732821426e-01   +9.307015731076612e-01   +7.843469989830036e-01   +8.439654940432868e-03   +1.771673724146750e-01; +2.336347256924969e-01   -1.128895165839559e-02   +2.853003955975504e-01   +1.764508112103566e-01   -7.916640734976591e-03   +4.661158714593672e-01   +8.817466085839768e-01   +3.237135068549326e-01   +5.533890072761730e-01   +4.409562521974294e-01   +9.147221766390971e-01   +2.086018446744946e-01   +2.455338405338774e-01   +2.127771676137490e-01   +7.292958726119816e-01   +4.168781653514304e-01; +6.920756071029120e-01   +5.373839162197129e-01   +2.974278691807851e-01   +8.051654679306605e-01   +2.743209351349353e-01   +8.702341927313930e-01   +6.666898167353784e-01   +5.518561759950884e-01   +8.333373806001279e-01   +6.209035494334837e-01   +9.089094065495038e-01   +3.148197926014623e-01   +8.314194138146769e-01   +6.059921398295243e-01   +9.515451083498089e-01   +7.956159624807804e-01; +9.568191954142361e-01   +1.663531582482537e-01   +5.902266566213072e-01   +4.763583777536093e-01   +6.180430240830301e-01   +2.030599597383488e-01   +3.404870930440719e-01   +5.828309083735521e-01   +2.160230340394915e-01   +8.451960741957204e-01   +7.465811214364553e-01   +8.941824887151291e-01   +2.718683710247742e-01   +7.543328392107230e-01   +4.666705578852802e-01   +6.009626936273644e-01; +5.247934311174867e-01   +9.608910178433662e-01   +3.735779541079169e-01   +9.530219379818056e-01   +2.534608848099164e-01   +7.061947955588865e-01   +5.908392623116722e-01   +9.731966798791560e-01   +8.650652204932945e-01   +9.066328977877690e-02   +1.859721222398450e-01   +2.148725713951591e-01   +8.690850371836560e-01   -4.525730260646196e-04   +8.536477580004322e-02   +4.575237152811801e-01; +2.600232929206578e-01   +4.117595138835831e-01   +5.501210119674588e-01   +2.954510029508703e-01   +8.202721466035532e-01   +4.193223695671719e-01   +2.995671114354679e-01   +8.458381084525699e-01   +9.385581037936603e-01   +8.921469826407721e-01   +7.964231965218859e-01   +9.458376014551763e-01   +5.251088378931209e-01   +3.909806826939151e-01   +3.537179473146225e-01   +8.086103402971827e-01; +1.333326973757736e-01   +2.538500987410626e-01   +8.242872753718529e-01   +9.051612883017071e-01   +1.812044837422274e-01   +6.215677846714790e-01   +5.148362721302834e-02   +4.606327194276639e-01   +4.210319798340039e-01   +6.549703576240872e-01   +3.087286574040700e-01   +9.119305186655694e-01   +1.130411488906910e-01   +4.582514898499781e-01   +4.218912931706443e-01   +4.734270208099298e-01; +1.553550469121779e-01   +9.513506235310685e-01   +7.672042593142380e-01   +4.592074212613947e-01   +4.597017364004378e-01   +5.231133056716061e-02   +1.924456107362207e-01   +3.674393496335683e-01   +1.322724963763792e-01   +5.680966742130650e-01   +2.751474031548028e-01   +4.338431551753146e-01   +4.205380338938820e-01   +9.068264683540519e-01   +3.073987796395784e-02   +4.942816399566287e-01; +9.027383470209773e-01   +1.564812879927620e-01   +5.077149894244067e-01   +5.533179239081696e-01   +6.575464373837495e-01   +5.786219512343141e-01   +2.194344550762273e-01   +5.386023725863730e-01   +4.837748867355390e-01   +3.423947649749275e-01   +9.567557071436252e-01   +9.628890679962637e-01   +8.743228402701404e-01   +5.919801985678346e-01   +2.638192685341387e-01   +7.633260456627177e-01; +4.367128408604076e-01   +8.513207183980843e-01   +2.943775165456429e-01   +3.765773939879183e-01   +7.710583739955652e-01   +1.992918215227973e-01   +3.491174215349647e-01   +6.261563277408109e-01   +3.279507105942520e-01   +4.533972784063143e-01   +2.189914129339401e-01   +1.533665918702398e-01   +2.828836212872391e-01   +2.693229320527173e-01   +6.048423078365525e-01   +9.087465876234672e-01; +6.215474929940717e-01   +5.991041733760714e-01   +6.670486950258276e-01   +7.355704393480550e-01   +7.811254559058531e-01   +8.887612557227129e-02   +8.236023647694986e-01   +3.081472956871995e-01   +8.449653286708400e-01   +4.843575069706130e-01   +7.031770071377688e-01   +5.709780617060284e-01   +2.520855247412366e-01   +4.552363376599665e-01   +8.899081584711006e-01   +4.821655437058704e-01; +3.888454846332891e-01   +6.178333168548333e-01   +6.510954839753794e-01   +2.531038481150243e-01   +5.046796202561812e-01   +3.403637566194808e-01   +5.495850202087624e-01   +2.548488361850968e-01   +8.315843416333304e-01   +2.739593080627284e-01   +2.737593018097703e-01   +1.102558371843142e-01   +7.021435698121392e-02   +4.990240380123047e-01   +9.287813436560937e-01   +9.614694656571194e-01];
L2I_L1I_iGABA_netcon = [+6.723214109403675e-01   +4.548799113531109e-01   +7.395958360961640e-01   +5.277367028792606e-01   +9.461090708502686e-01   +6.847739545416116e-01   +9.183032328571097e-01   +3.663745020998797e-02; +4.999153432460524e-01   +6.282495686672936e-02   +1.913125716731060e-01   +8.839665474396381e-01   +2.015231869208993e-01   +8.158576172545250e-02   +8.179288909515933e-01   +6.976493732232441e-01; +1.000000000000000e+00   +5.173602935496637e-01   +6.640805666104359e-01   +6.124680602876910e-01   +7.949150336319909e-01   +7.300435561455600e-01   +2.796984175694106e-01   +2.040533746706270e-01; +3.454841270041349e-01   +1.656933740596954e-01   +9.061868840058824e-01   +4.052560233043606e-01   +7.693389107195440e-01   +3.428632749081032e-01   +8.727115831283389e-01   +1.752667653868709e-01; +7.263458279573750e-01   +4.758104237911757e-01   +6.420533344606265e-01   +2.637639336375720e-01   +9.125047146859121e-01   +3.729724915285234e-01   +5.483498538353485e-01   +2.207151595212529e-01; +5.304097712673056e-01   +5.856691903921774e-01   +7.539979935213672e-01   +2.160234940049827e-01   +1.919727800322435e-01   +7.947598034478092e-01   +9.357078622506815e-01   +5.911380644585831e-01; +8.874304100924001e-01   +4.367543724858041e-01   +2.069363960288850e-01   +2.533905778939568e-01   +7.262680037356499e-01   +1.976148284749421e-01   +5.919455874449558e-01   +3.488397569439919e-01; +9.291453767952259e-01   +4.059150923668867e-01   +6.381564978015279e-01   +9.267396520982961e-01   +1.137692824372888e-01   +4.409764410071496e-01   +4.544089001118617e-01   +2.251412653608874e-01; +7.171838705867565e-01   +2.019052724635723e-01   +4.732951233531787e-01   +3.883657621081837e-02   +7.863297491271325e-01   +3.533268004858600e-01   +7.521027976807458e-01   +7.371301194870012e-01; +4.386670508170180e-01   +8.654361378519171e-01   +6.777792447240267e-01   +8.257762422967890e-01   +3.925652886590260e-01   +7.988558555716477e-01   +8.837341311743735e-01   +2.709444353146182e-01; +5.021578614923418e-01   +6.231587339929383e-01   +4.427225560952423e-01   +4.165527042857109e-01   +4.728373433988119e-02   +8.865679655358255e-01   +6.282472852690335e-01   +4.700002392296618e-01; +1.062385904342875e-02   +3.949676383013928e-01   +3.575298475931293e-01   +4.126764237939848e-01   +3.619884648000702e-01   +5.275757689321799e-01   +2.774798782644463e-01   +5.335187303872746e-01; +3.938731685547216e-01   +1.872442858305167e-01   +6.310976845375116e-01   +7.383657729833442e-01   +2.092173579490058e-01   +6.379726823152975e-01   +3.944321946246881e-01   +7.460978418698336e-01; +4.642016307667851e-01   +4.505748308589842e-01   +7.118644661145497e-01   +3.661684985270772e-01   +8.508839335196301e-01   +4.094938673765300e-01   +3.528563453194095e-01   +3.250468820531083e-01; +6.168440888450079e-01   +1.831214318833001e-01   +2.798850145752261e-01   +2.623173486144867e-01   +5.672056468457559e-01   +5.633410973894144e-01   +3.179607671103273e-01   +6.920984635977540e-01; +7.542837248698424e-01   +5.334527208366152e-02   +7.251993709079431e-01   +2.629818479506696e-01   +3.961754074004145e-01   +6.303908312825379e-01   +1.018949499674504e-01   +2.805296073027152e-01];
L1I_L2I_iGABA_netcon = [+5.213683991880871e-01   +1.892194591770970e-01   +7.725007651614380e-01   +2.923487182710586e-01   +5.757356361348069e-01   +2.870156916656485e-01   +8.688965543364325e-01   +2.104369639421321e-01   +5.865164963449273e-01   +8.995611848900729e-01   +4.083515051912397e-01   +4.050819974989412e-01   -2.258234222640240e-02   +7.678502481003041e-01   +6.262525207313999e-01   +5.142380454335862e-01; +2.453840325705097e-02   +4.150430133935012e-02   +3.217802022180427e-01   +2.996383625427536e-01   +8.902377822091341e-01   +3.364808153638942e-01   +3.523038939636053e-01   +1.457373204019471e-01   +4.343360557618162e-01   +2.527422961592151e-01   +2.953021121156540e-01   +3.020115263622242e-01   +9.258949204941779e-01   +1.966198579224876e-01   +8.391138987521315e-01   +2.561951057814662e-01; +3.936174942527900e-01   +6.455435552410962e-01   +3.660023598614983e-01   +7.386658249190148e-01   +2.674734755454544e-01   +5.216744676890699e-01   +7.513603189812867e-01   +1.005975714867046e-01   +7.579905131110927e-01   +4.863726206584214e-01   +6.375561732198591e-01   +8.452188813823444e-01   +9.861690604053592e-01   +6.732614707934481e-01   +3.365508330675249e-01   +1.561877402362616e-01; +8.390406699242134e-01   +1.358243241603526e-01   +6.502314165895601e-01   +9.342447448620188e-01   +5.041692587222768e-01   +9.169454502810741e-01   +6.314208597566151e-01   +3.066404043862028e-02   +6.600340599354941e-02   +3.170849689610720e-01   +4.263482690877743e-01   +4.543679333537749e-01   +3.391294613568699e-01   +5.356521416936658e-01   +1.712270450170260e-01   +1.061010131748198e-01; +9.512552381462149e-01   +7.424322542351796e-01   +7.157043147293334e-01   +6.707237117702126e-01   +3.233579344781906e-01   +6.767191927319406e-01   +6.676365837140047e-01   +6.326909756039175e-01   +9.635270244755727e-02   +7.003658639615464e-01   +1.795032723704177e-01   +4.224752355199399e-01   +3.826777095187941e-02   +2.040199158707652e-01   +7.128370717379393e-01   +9.493759729579915e-01; +5.681628928840330e-01   +3.790888856321343e-01   +1.245515860506980e-01   +3.765720529986022e-01   +9.679443988074952e-01   +1.572337024455525e-01   +7.198446361557862e-01   +6.412190945870185e-01   +5.329391410258221e-01   +6.924316940758458e-01   +3.368811344521886e-01   +5.000552699768955e-01   +8.904292143299060e-01   +9.720485647484506e-02   +1.912540520457587e-01   +3.803585812094234e-02; +8.328010253097938e-01   +1.213274734202507e-01   +3.884362276767895e-01   +3.015471101676300e-01   +5.670852755989798e-01   +8.927384143091310e-01   +7.669869891464466e-02   +2.188725623205618e-01   +7.335084689363429e-01   +9.015107851929300e-01   +9.329815089281971e-01   +8.820345912847523e-01   +1.352322622434732e-01   +3.080871529743021e-01   +1.024410255107854e-03   +6.031219003581859e-01; +9.012169311729274e-01   +3.887447594624522e-01   +9.304680826542346e-03   +9.012175770763108e-01   +1.523210231421063e-01   +9.813676831707844e-01   +8.143610451084201e-01   -1.513361038101798e-02   +8.104195028591843e-01   +7.965929808941805e-02   +9.097370907957522e-01   -7.216535689632032e-03   +8.144231489020861e-01   +5.952173840453740e-02   +1.000000000000000e+00   +6.813336541202872e-01];
L2E_L1E_iAMPA_netcon = [+2.762018551839178e-01   +8.929776193941065e-01   +6.418579239364123e-01   +4.366440401383282e-02   +3.159315165582938e-01   +4.036948142593125e-01   +7.879080814994313e-02   +6.471412861307090e-01; +2.328013574534880e-01   +1.933768538647548e-01   +7.965254746476649e-01   +8.932407952021890e-01   +3.338857343400963e-01   +5.291875979553718e-01   +2.807211579905260e-01   +1.332378667591178e-01; +4.993566591164886e-01   +8.830680137331310e-01   +7.938928567550279e-01   +4.938033516639450e-02   +6.506823722158187e-01   +1.192885801320131e-02   +4.236760322085930e-01   +8.356138918689185e-01; +5.147534056412686e-01   +6.537956921691113e-01   +5.156741191380294e-02   +6.103778531412016e-01   +2.842741195739031e-01   +5.060685802108694e-01   +2.057192595669588e-01   +4.865233004407303e-01; +8.760452175646138e-01   +7.341948011173843e-01   +8.002682127237831e-01   +5.379224693986722e-01   +7.616925689920121e-01   +3.880171623416435e-01   +4.533966237336661e-01   +5.035165008772476e-01; +4.817623612704642e-01   +7.007800863539723e-01   +5.632767044628546e-02   +6.101647594992343e-01   +6.851591638085555e-01   +8.652080912578262e-01   +2.885603176893865e-01   +5.293721590311538e-02; +4.505119743208142e-01   +3.290392269581661e-01   +2.067125579860440e-01   +4.299211328028233e-01   +3.985244228211781e-01   +2.677930902399316e-01   +5.934478811881757e-01   +2.940379152584324e-01; +7.103120964446241e-01   +1.668835243793563e-01   -2.925430862434662e-02   +9.861644256438298e-01   +5.108091218021668e-01   +3.514052078136943e-01   +5.826238382323027e-01   +5.882726022262390e-01; +7.711723868268328e-01   +6.115482992194101e-01   +6.693957665884163e-01   +1.193485534406181e-01   +4.150379496500569e-01   +2.609844977934812e-01   +6.139063411763070e-02   +9.760663402500673e-01; -8.843405079525378e-03   +1.340964905754890e-01   +1.612557142138935e-01   +1.643761412859502e-01   +1.751154783545231e-01   +5.852275041994260e-01   +8.793791929258541e-01   +8.106985358600755e-01; +1.509919256531303e-02   +2.489542284970742e-01   +5.729322317264705e-01   +5.216635670518117e-01   +1.251270197598967e-01   +4.334553314549450e-01   +1.841391148911541e-01   +7.160579275584181e-01; +3.504082149765804e-01   +5.554421332436942e-01   +6.159647340148457e-01   +5.181374106662533e-01   +6.885717956310864e-01   +3.181296344984850e-01   +6.709852764208148e-01   +4.306183997855803e-01; +6.736079529064143e-01   +7.136291872349089e-01   +6.338678841011445e-01   +2.335673434986235e-01   +1.836345175476723e-01   +1.172505993704949e-01   +5.605324394212970e-02   +5.330438913834750e-01; +7.119142033555531e-01   +7.948851389329382e-01   +3.842616531663673e-02   +8.881684634981534e-01   +4.923012421852117e-01   +8.382131103532117e-01   +3.177996203057285e-02   +2.290672913040730e-01; +9.212808985537958e-01   +2.165072891050993e-01   +4.429022158608239e-01   +5.675408074378442e-01   +3.357694357937890e-01   +2.188196875558040e-01   +5.885225054373258e-01   +3.677459685852696e-01; +8.187379429033634e-01   +6.385403762160146e-01   +6.996840744967059e-01   +3.518736813509236e-01   +4.724024299440593e-01   +8.822038422317430e-01   +7.336372707743367e-01   +1.345657243084596e-01];
L1E_L2E_iAMPA_netcon = [+8.794663657621156e-01   +4.681493319578551e-01   +5.890066459482921e-01   +1.288598056401038e-01   +9.624466167424484e-01   +2.986635807321946e-01   +5.653379682166902e-01   +4.880505290540833e-01   +9.065813370770346e-01   +5.476589469926536e-01   +6.476390065206358e-01   +4.831470646727518e-01   +5.024133871607382e-01   +3.329719640167896e-01   +5.689964715206693e-01   +2.543427308910294e-01; +7.868175758936760e-01   +1.944030022149681e-01   +1.235018636523967e-01   +5.639135120133447e-01   +8.280091866455959e-01   +5.779946902259531e-01   +8.771019424309260e-01   +2.241358592710606e-01   +3.674449789317281e-01   +3.285325904323205e-01   +7.103681341254001e-01   +6.856635612320983e-01   +6.866496347101686e-01   +9.108637256604757e-01   +3.749350557574196e-01   +5.385802778583053e-01; +7.922455358912993e-01   +1.239160919928627e-01   +1.573886447585257e-01   +1.000000000000000e+00   +2.282370348300681e-01   +3.927923659428399e-01   +8.986055965679030e-01   +2.727327021096488e-01   +2.109373569568034e-01   +6.187138555801591e-01   +7.961408960071112e-01   +4.895206785415947e-01   +8.363715429864592e-01   +9.511415813981933e-01   +8.042143111035843e-01   +6.356089138250693e-01; +6.951422540010868e-01   +5.656483656670350e-02   +5.203648171196439e-01   +3.469187304887611e-01   +4.368222032133044e-01   +8.635521144227288e-01   +2.175230555900094e-01   +1.436917088706205e-01   +5.924903678127071e-01   +4.660528741393171e-01   +3.637421848557516e-01   +9.475544274245447e-01   +7.355836329879716e-01   +2.652119766521680e-02   +7.429301259417003e-01   +8.319632279862743e-01; +3.446679640710415e-02   +2.213192964730243e-01   +1.413748048026777e-01   +7.828517632867955e-01   +2.150644226167739e-01   +4.558321030195472e-01   +9.661338692179081e-01   +3.326864178655590e-01   +7.889650164674245e-02   +7.688481340523637e-01   +8.316363960624881e-02   +5.373171541166628e-01   +9.178898946200385e-02   +6.154489931836352e-01   +3.798278770732298e-01   +1.498045042995304e-01; +6.173016560122102e-01   +4.649224444056435e-01   +3.676798865145502e-01   -1.040314697258754e-01   +8.801983262323498e-01   +1.017577482767268e-01   +4.764220629691909e-01   +1.694265691759179e-01   +7.206275469329407e-01   -2.093003682142348e-02   +7.462802321788261e-01   +1.369591973759276e-02   +7.471730299161312e-01   +4.897468901003080e-01   +7.281302348634032e-01   +3.194975028992548e-01; +2.670049009326851e-01   +6.276322244641220e-01   +3.599924942167637e-01   +3.794300875434720e-01   +3.603095949938400e-01   +8.580725296567359e-01   +9.211756973848858e-01   +4.313515294344068e-01   +6.671864499308416e-01   +7.558899434271588e-01   +4.753881963605103e-02   +1.422240842009863e-01   +1.003221192215213e-01   +3.899610847211344e-01   +3.244327071934600e-01   +7.793441073088787e-01; +1.657985673693766e-01   +4.514031694613052e-01   +3.029540555047885e-01   +4.718657541079216e-01   +9.362070913952339e-01   +4.630845762305206e-01   +9.931217379250250e-01   +8.545890911856080e-01   +3.957417377069939e-01   +4.330478856213674e-02   +3.819821906710062e-01   +3.675996610957692e-01   +3.333620332756374e-01   +7.300635087180081e-01   +8.449936526108531e-02   +5.135801554371614e-01];
L2I_L2E_iAMPA_netcon = [+3.698835786858553e-01   +2.617880653730801e-01   +3.548527818072462e-01   +5.886407505061073e-01   +1.909387425099410e-01   +8.412410702216578e-01   +6.952860622233841e-01   +2.821183788276662e-01; +5.101474087858665e-01   +1.922143405809611e-01   +6.683172789384924e-01   +2.781927173444390e-01   +6.862697516142189e-01   +8.324862886410631e-01   +5.606564372117285e-02   +4.780711036446122e-01; +6.446527685892490e-01   -1.181180971105386e-02   +7.148441981559123e-01   +6.141722505472624e-01   +1.326051430477590e-01   +5.825358723407267e-01   +7.581227051658117e-01   +7.499926844200086e-02; +5.316523041291905e-01   +2.686160487410539e-01   +5.927471177666439e-02   +9.513852928284474e-01   +3.583585565978742e-01   +6.312349680620618e-01   +9.844632058662671e-01   +2.001220176387744e-01; +1.396613246739614e-01   +4.253487937920694e-01   +4.252539389328985e-01   +8.484808448932335e-01   +8.648077369122668e-01   +5.740675130656457e-01   +7.283633877161966e-01   +2.908423345727038e-01; +9.165149245666560e-01   +5.022653092647554e-01   +9.160630080871434e-01   +8.909528156431302e-01   +6.865072400209101e-01   +8.724497775864407e-01   +8.903942858574948e-01   +5.244198157214527e-01; +1.519054272452833e-01   +5.494214330225894e-01   +8.930574579696866e-01   +8.693085101971728e-01   +9.405944327411532e-02   +7.272289080097122e-01   +2.412759327799181e-01   +1.170346671698972e-01; +5.631629838106147e-01   +3.837285427885847e-01   +1.850325453156657e-01   +2.775385248821953e-01   +7.636121921211942e-01   +3.867477073624749e-01   +9.779389279714032e-01   +6.083615933351367e-01];
L2E_L2I_iGABA_netcon = [+4.254597774627857e-01   +5.972015906625673e-01   +6.268936347845762e-01   +4.566991121469866e-02   +4.605472520203541e-01   +5.015320145322935e-01   +2.788808614193302e-01   +7.346406738529210e-01; +3.902285945529358e-01   +3.477250908080646e-01   +3.538800667745240e-02   +4.628970884009320e-01   +4.452076891338247e-01   +6.105669476386669e-01   +4.775929266518593e-01   +4.741543743653102e-01; +5.894318964285025e-01   +5.151288496655584e-01   +3.930829833826179e-01   +5.635497902344926e-01   +3.173063025265316e-01   +2.560741459514718e-01   +1.897175298585408e-01   +1.000000000000000e+00; +7.403256319342052e-01   +5.437874260393476e-01   +3.724001564570424e-01   +8.645212768074921e-01   +2.070632358331184e-01   +7.215351230270770e-02   +1.397643365907686e-01   +4.046531588151469e-01; +5.127177127555925e-01   +7.926160957880725e-01   +5.017249750655881e-01   +7.656175542906125e-01   +3.763088501157718e-01   +6.917683270058789e-01   +6.369993058624706e-01   +3.488203219839396e-01; +3.970353548501695e-01   +2.808480123283313e-01   +4.588781009423676e-01   +3.600036178397117e-01   +7.833603217981914e-01   +8.211247746052904e-01   -1.628328381060845e-02   +4.283783337661867e-01; +3.532299017011584e-02   +4.826014733388174e-01   +8.534562876389270e-01   +5.944775190529363e-01   +4.783896046183387e-01   +4.018527299062349e-01   +9.070289723113918e-01   -3.438250385914599e-02; +8.777576461915676e-01   +5.364331209347845e-01   +8.572572376595422e-01   +4.703588632810446e-01   +8.754206009605492e-01   +5.172054075068985e-01   +3.200171949205215e-01   +3.612167650104257e-01];
L3E_L2E_iAMPA_netcon = [+2.540951158432221e-01   +9.038146640109613e-01   +4.589896310305188e-01   +7.935596633235986e-01   +1.559587572397338e-01   +4.306715005055080e-01   +3.995395892545757e-01   +1.129963129519055e-01   +1.500979644517791e-01   +5.496630706524803e-01   +1.595295397740779e-01   +4.607114024129182e-01; +2.801731187196914e-01   +4.511654908923329e-01   +1.666433513924775e-01   +2.054626073025203e-01   +6.031839090856472e-01   +8.863676024155289e-01   +6.862219537136532e-01   +5.681726554919539e-01   +2.640628865588465e-01   +2.983927844144036e-02   +1.811800533050417e-02   +7.059793681010128e-02; +8.152895121438436e-01   +3.834142477354069e-01   +5.566715667990428e-01   +1.552537435252153e-01   +8.628409375941357e-01   +8.673373248196605e-01   +5.118763390694633e-01   +6.255945755516976e-01   +7.156779247411953e-01   +3.674588111933860e-01   +4.230031331952226e-01   +9.003125009372200e-01; +1.699993818378867e-01   +4.637310951270047e-01   +1.597227268553672e-01   +8.265079848652923e-01   +4.907653546453961e-01   +5.771635086936343e-01   +8.635144140823058e-01   +2.778151260560960e-01   +8.302382288286232e-01   +8.295664564320983e-01   +4.351918121525655e-01   +2.056383882819090e-01; +2.153220596984676e-01   +7.983735272585755e-01   +4.388938309043749e-01   +2.027021501825709e-02   +2.336437765235885e-01   +9.885749896615427e-01   +1.841374491543560e-02   +6.658416026610045e-01   +7.590069903370708e-02   +8.622297624610546e-01   +2.493163992120029e-01   +2.487587102999139e-01; +3.716710180108079e-01   +3.940621728295844e-01   +8.381958690661743e-01   +9.984628784667600e-01   +3.754564082514596e-01   +9.421642019643955e-01   +7.233136656501596e-02   +3.485630070937265e-01   +5.005583416646378e-01   +8.115260630334645e-01   +5.993265643100525e-01   +8.623812907715221e-01; +1.556593059889253e-01   +4.552597048397996e-01   +5.829615885015053e-01   +7.622059509230773e-02   +6.525434335167830e-01   +5.098563879373267e-01   +7.867775434596869e-01   +1.386840730070110e-01   +4.393779831729230e-01   +4.063173625276502e-01   +9.739168891064045e-01   +7.260520734079322e-01; +5.982140221362449e-01   +2.686648294520332e-02   +3.873075821744056e-01   +1.532358235618340e-01   +3.317217642742729e-02   +9.026130033392181e-01   +3.895261900058277e-01   +4.389175158239829e-01   +8.709803838735497e-01   +1.000000000000000e+00   +9.443267029882503e-01   +3.116204619165152e-01];
L3I_L2I_iGABA_netcon = [+2.192316428159598e-03   +3.141204217718654e-02   +9.356908841357804e-02   +6.760719676442691e-01   +2.642131486618161e-02   +4.935780164555909e-01   +8.242016031496917e-01   +3.824889388889461e-01   +4.507867030927158e-01   +9.554134942423353e-01   +8.328361081366564e-01   +6.223707845344193e-01; +3.794867626064437e-01   +4.488788831877242e-01   +3.023481211486689e-01   -8.664737993760552e-03   +4.752323561803606e-01   +5.948877414504926e-01   +4.822753750807457e-01   +9.218071058445498e-01   +1.353711559313538e-01   +9.119216417084269e-01   +2.882663146289409e-01   +6.564924483872818e-01; +3.575896086189055e-01   +6.687959945417699e-01   +3.066994851408786e-01   +7.862286444514771e-01   +3.402782414017878e-01   +8.587794994048603e-01   +9.619835181614833e-01   +9.170579491296984e-03   +6.649317188172744e-01   +4.997497381605247e-01   +1.449412706167890e-01   +5.842577651289811e-01; +6.485552101634170e-01   +9.781513070929901e-01   +3.239908579206448e-01   +2.513496932310796e-01   +1.528780496611228e-01   +5.738055174214907e-01   +1.879471243049296e-01   +2.664448653422484e-01   +7.874116550202138e-02   +3.296597891169829e-01   +5.248689503064572e-01   +7.951051801136191e-01; +9.794400310147546e-01   +1.143490697189122e-01   +4.808501171472297e-01   +8.582328995538806e-01   +4.798545833666961e-01   +9.004733570181442e-01   +8.034109725584811e-02   +5.490660238810023e-01   +5.870476943378418e-01   +8.138619298569968e-01   +7.646781189313187e-01   +5.197319516712724e-01; +9.288113847173159e-01   +1.539376706536906e-01   +1.520888198679993e-01   +7.564811617760513e-01   +9.115983364031490e-01   +7.411708425952125e-01   +9.457857400874730e-01   +5.682741349261854e-01   +1.243159692277515e-01   +8.225354487684414e-01   +3.406724679029494e-01   +5.959929116519481e-01; +1.072054141019383e-01   +5.342080999926202e-01   +9.543401663344587e-01   +5.393406834693729e-01   +9.585931081571744e-01   +8.051189733073135e-01   +8.327345992416568e-01   +8.086046475742662e-01   +6.329941240196308e-01   +3.984132142276073e-01   +3.224357941289814e-01   +5.653376945832094e-01; +3.264179424438812e-01   -9.554997146828309e-03   +7.526925154740995e-01   +1.917420986686969e-01   +4.706579354548635e-01   +1.762410923444144e-02   -4.111943799509045e-02   +9.621591604372263e-01   +4.973404394031940e-01   +9.104344880616097e-02   +7.084720661389979e-01   +7.617452881393225e-02];
L2E_L3E_iAMPA_netcon = [+9.350625971041587e-01   +2.499606252759175e-01   +5.521553870995126e-01   +7.147433164827638e-01   -1.487781328297126e-02   +7.275841698053193e-01   +7.780783271224160e-01   +9.020025516721761e-02; +3.204937572388302e-01   +5.722730093959570e-01   +6.969139569386865e-01   +7.112529927207217e-01   +2.374343194176650e-01   +2.296505778809703e-01   +7.954606650828356e-01   +8.657358998031613e-02; +6.019563963307836e-01   +5.367957053587153e-01   +8.647008017544143e-01   +6.194608191550455e-01   +9.090622509895459e-01   +4.448394561312750e-01   +9.989566897857582e-01   +4.715679423648043e-01; +2.265414575974811e-01   +9.120313197594141e-01   +8.739896055910480e-01   +4.159295110238933e-01   +3.968481748019449e-01   +9.907120425059938e-01   +2.659316678053794e-01   +5.148239025711014e-01; +8.578476535204452e-02   +2.031757989974165e-01   +7.078878611571136e-01   -5.479790740366532e-02   +1.876433488272343e-01   +5.236793364305787e-01   +4.803825468264241e-01   +6.504828080170832e-01; +3.806531586879329e-01   +7.779740626895458e-01   +1.436281851872827e-01   +7.921531015120276e-01   +6.747581281558206e-02   -2.434380267210848e-02   +4.993094692783054e-01   +3.065278224450164e-01; +4.841792905682159e-01   +7.579679190748780e-01   +7.936611234990285e-01   +2.522460032728028e-01   +8.338174966752445e-01   +1.761695877656035e-01   +7.258898894532602e-01   +9.162881685239724e-01; +2.399104094957900e-02   +5.611893534620160e-01   +9.178995887372247e-01   +4.745233941246339e-01   +9.675924548517396e-02   +7.034895919646685e-01   +1.091265090028829e-01   +3.253431160473189e-01; +9.821976397920880e-01   +8.802158840016812e-01   +7.708517728962204e-02   +1.746980253990926e-01   +8.453990947189294e-02   +8.725657803880346e-01   +2.844910496329097e-01   +9.151387529930772e-01; +1.536622497111608e-01   +3.696710873815642e-01   +8.320735542373153e-01   +3.343455283501064e-01   +4.152310850992915e-01   +8.722646465530225e-01   +4.901043968123837e-02   +9.317665864053020e-01; +6.605643914856151e-01   +3.558040924173006e-01   +2.748842124618658e-01   +2.643686109781421e-01   +1.548851900432218e-01   +3.162770423729627e-01   +2.070965542555463e-01   +9.244058571456634e-02; +1.101925200930755e-01   +6.334341781830578e-01   +7.985717713875324e-01   +4.221847762984084e-01   +3.508072183565991e-02   +7.451423485391624e-01   +7.618778954130166e-01   +7.948205419258642e-01];
L2I_L3I_iGABA_netcon = [+3.702795740555218e-01   +6.342570729634763e-01   +2.424628962092252e-01   +6.698448182650432e-01   +4.865846158709321e-01   +4.393691271999625e-01   +3.972039612027123e-01   +4.882077750996222e-01; +3.638604430730341e-01   +1.295560047400097e-01   +4.153633668481902e-03   +8.342798980734233e-01   +6.789637120890860e-01   +5.514067686439796e-02   +8.212547967778185e-02   +6.099182971531474e-01; +3.305011666523492e-01   +6.132642456530513e-01   +4.220720196066990e-01   +9.753357891668928e-02   +8.223143702897456e-01   +6.227073020301604e-01   +1.894748997636259e-01   +1.141242672944243e-01; +6.172542055735496e-01   +8.462046914253137e-01   +5.983151975397880e-01   +4.507784538003327e-01   +4.972862099521305e-01   +6.608658559105340e-01   +3.831113076305923e-01   +6.778407761650741e-01; +9.378919283469445e-03   -6.514086412196853e-02   +1.019329950561470e-01   +6.644953089780017e-01   +1.768142920685206e-01   +6.582945126855883e-01   +4.857464123930711e-01   +2.817751256799192e-01; +5.186793599666538e-01   +4.266785121318134e-01   +4.266046832585951e-01   +6.519867544099029e-01   +2.541155684795781e-01   +8.254487573238285e-01   +3.807547393713041e-01   +1.128404097636735e-01; +2.421612561093926e-01   +1.967191441652868e-02   +4.477713828930876e-01   +1.000000000000000e+00   +6.323230945052227e-01   +9.575392679526079e-02   +2.454819697177602e-01   +8.479563317667563e-01; +2.084799081439593e-01   +9.002029065123420e-01   +9.152947493953397e-01   +9.147088598267015e-01   +4.827368000824189e-01   +1.006742032986286e-01   +7.213109438117691e-01   +1.589840751962439e-01; +3.315987400008564e-01   +5.393325469043740e-01   +2.615797843620425e-01   +1.557168468242900e-01   +3.739329042104218e-01   +2.581201375159796e-01   +5.785313322122497e-01   +4.306514787961214e-01; +3.940354756818393e-01   +1.894556159330374e-01   +1.907323956189121e-01   +4.026804714442288e-01   +9.108744679881274e-01   +4.729777001624837e-01   +4.785092761464833e-01   +9.126385381046167e-01; +6.242805827349311e-01   +8.747296237633745e-02   +2.862253024154939e-01   +5.624260841754545e-01   +5.244525183266985e-01   +7.025511976073665e-01   +8.975577993628536e-01   +5.962765623361760e-01; +3.461462414428105e-01   +1.867195907759268e-01   +6.120665498252943e-01   +2.790377918569805e-01   +1.166360796569951e-01   +2.683757115614209e-02   +2.947622339600409e-01   +6.580464174590902e-01];
L3I_L3E_iAMPA_netcon = [+1.187482499887158e-01   +6.708696123105841e-01   +6.371371188806615e-02   +1.900399405868747e-01   +2.789078601093350e-01   +6.106873875366451e-01   +6.714284701139898e-02   +3.131354105090958e-01   +5.305747305920778e-01   +3.257895098172010e-01   +6.280290773890791e-01   +9.277877959875406e-01; +3.805214924806182e-01   +8.645590562879407e-01   +2.421629413715846e-01   +3.606468972933859e-01   +7.599108107782165e-01   +4.249107888609530e-01   +3.994103412460862e-01   +3.964013823745544e-01   +6.321989303834068e-01   +3.008446717270300e-01   +7.095499581698913e-01   +1.930688223131227e-01; +4.981264438637150e-01   +3.831297834375422e-01   +7.952937491436662e-01   +8.601003740035170e-01   +5.958414317955276e-01   +6.210321386667119e-01   +9.962522117485360e-01   +4.315071365706596e-01   +1.980444877638599e-01   +3.058046713934296e-01   +9.386278869705645e-01   +8.280376486711634e-01; +4.939199992797236e-01   +1.092608828587151e-01   +5.212009254437675e-01   +7.568658136150342e-01   +4.144929328615554e-01   +6.200208254688752e-01   +5.752838152384331e-01   +7.103151677755891e-01   +5.181543291460035e-01   +2.219230152453564e-01   +4.510179562613899e-01   +5.037269848669517e-01; +9.298110926706762e-01   +8.291601385871931e-01   +5.954401639204917e-01   +5.222705784583779e-01   +2.485197133504536e-01   +3.098526365333999e-01   +1.688898648906866e-02   +2.249626753231790e-01   +1.270430382309612e-02   +2.603878129936277e-01   +3.383717713482744e-02   +5.161598861880378e-01; +3.726072530376019e-01   +1.889601696468158e-01   +6.711261619376766e-01   +4.637034132269359e-01   +9.926636146771013e-01   +6.103093985368062e-01   +2.718677204318425e-01   +6.797368594375391e-02   +1.723368411794441e-01   +5.929990988338576e-01   +3.093941774057301e-01   +9.669559777832376e-02; +4.597905482147257e-01   +2.083774327133931e-01   +8.521904956278642e-01   +8.565389430244237e-01   +1.089017132294764e-01   +2.882922689998346e-01   +3.972571299337043e-01   +1.428880374062575e-01   +9.016507940224088e-01   +7.233396979060043e-01   +2.936213863798250e-01   +4.859858760957803e-02; +4.014792686479761e-01   +4.000645196640156e-01   +2.984978399696128e-01   +6.209014065637862e-01   +8.432749312328383e-01   +2.396109541735220e-01   +4.147657375519484e-01   +3.189653851127853e-01   +3.115912956023956e-01   +2.477990439910155e-01   +6.887191562346403e-01   +5.632663870127465e-01; +3.190274381615497e-01   +5.286399721244116e-01   +4.072731578612181e-01   +5.871735396338184e-01   +5.738143871427694e-01   -3.176498255377319e-02   +6.759389082455261e-02   +4.440178093333392e-02   +3.013108579677695e-01   +2.197461786520622e-01   +8.804981222387277e-01   +8.777247165137870e-01; +7.276355623155397e-01   +5.819169645717439e-01   +5.747848660520227e-01   +4.138382574660812e-01   +4.382317859664380e-01   +4.180271149044674e-01   -5.485133302118809e-02   +6.548829778360282e-01   +4.475952822430646e-02   +9.142292517695704e-01   +4.829329684645513e-01   +1.487077404856175e-01; +5.332611240327362e-02   +2.908151480112198e-01   +6.632097284969207e-01   +2.662926251151802e-01   +4.372909844292512e-02   +5.087198457618031e-01   +9.832695441185331e-02   +7.726105314769930e-01   +7.116134392463980e-01   +1.595429179199383e-01   +6.767816399838418e-01   +2.968742848328321e-01; +6.171790246122661e-01   +6.525387427192380e-01   +3.862765243066307e-01   +6.277002211444596e-01   +6.680791631267501e-01   +3.922523406018432e-01   +2.914724986920251e-01   +7.927351284113637e-01   +6.314275312914570e-01   +4.224248765281790e-01   +5.314109676744460e-01   +4.037920311973182e-01];
L3E_L3I_iGABA_netcon = [+3.327192981118193e-01   +6.900700503464950e-01   +6.571822700654323e-01   +8.386455602669578e-01   +4.551622304438447e-01   +1.162578861517999e-01   +2.436526321944565e-01   +7.248389050082977e-01   +7.426616395722332e-01   +2.846435828968820e-01   +4.678701490149916e-01   +3.029120614309124e-01; +8.466319625173535e-01   +3.478670196229359e-01   +6.367164947758577e-01   +6.773824907075421e-02   +8.545588485995419e-01   +4.154239675032195e-01   +8.087182967318459e-01   +6.879541772824125e-01   +5.887983851333234e-01   +7.059131507926302e-01   +2.367653624584117e-01   +4.672345998731725e-01; +7.922428412500614e-01   +3.209207589009457e-01   +4.277231214523116e-01   +4.582619369167339e-01   +5.798276118081079e-01   +5.405084242570758e-01   +2.262564890027054e-01   +8.360214564642616e-01   +5.310716642758914e-01   +1.588466085935386e-01   +7.326120187408365e-01   +8.485315333671909e-01; +1.421462760458322e-01   +6.537924739340770e-01   +3.205416115213986e-01   +2.733445414734602e-01   +1.061862447350703e-01   +6.879598784963282e-01   +2.717541986694839e-01   +6.911119140844556e-02   +2.960144479199067e-01   +5.028698772912917e-01   +7.409933669759093e-01   +5.720459500991754e-01; +2.046280099872490e-01   +6.988666989900105e-01   +5.676396299734934e-01   +2.767015944454462e-01   +1.342805424287437e-01   +6.001099118575598e-01   +9.201748024395751e-01   +2.842273441472120e-01   +2.429023085887909e-01   +8.387782047052630e-01   +5.872550050590567e-01   +2.060817565150163e-01; +4.693699690386257e-01   +8.324960957762557e-01   +7.230888423774217e-01   +4.862009873624897e-01   +7.568083415647777e-01   +9.927873412716051e-02   +3.683294573811174e-01   +2.928487472218557e-01   +8.573679729085372e-01   +8.373653503968947e-01   +8.041648166918348e-01   +2.748509413798867e-01; +5.591899880470815e-01   +7.450900486699739e-01   +2.053552668327165e-01   +3.263452396110960e-03   +4.169687575950350e-01   +6.153528747776623e-01   +6.026838245940622e-01   +1.733617771562435e-01   +9.522772906772567e-01   +5.645480504182298e-01   -3.168651348641377e-02   +3.493883238254008e-01; +4.568691050489787e-01   +3.904687605198233e-01   +8.642398979545671e-01   +3.784074653631961e-01   +9.077600374283022e-02   +1.105710736888749e-01   +6.086086763691706e-01   +6.569299980746671e-02   +6.223218885255696e-01   +7.737185010010617e-01   +1.815728248715213e-01   +1.000000000000000e+00; +3.082880346055322e-01   +5.281834802985621e-01   +2.755021069368114e-01   +7.370059059181900e-01   +8.276747322733637e-01   +4.638465941452158e-02   +3.594224317835156e-01   +5.742387168664587e-01   +6.183765537136133e-01   +8.568573795434016e-01   +6.708829025543771e-01   +6.402596820360621e-01; +5.369320988344929e-02   +3.261279787562770e-02   +3.219510358146302e-01   +5.703014708329895e-01   +7.633256924684774e-01   +1.879705480688991e-01   +2.807124081725423e-02   +3.285086014983521e-01   +6.514327209072497e-01   +2.647925473162043e-01   +6.001470685178910e-01   +2.091269184045163e-02; +8.621273517915460e-01   +3.991387097803050e-02   +7.063855136322282e-01   +4.951325486603658e-01   +3.761829086574016e-01   +8.394591678984015e-01   +1.370155287197863e-01   +8.187480696550524e-01   +3.162070946743760e-01   +9.467162613733584e-01   +4.922064152325629e-01   +7.010598621052624e-01; +6.204789362066040e-01   +8.294352957878658e-01   +5.103034783905231e-01   +8.812102966035127e-01   +8.306508789610458e-01   +4.727400654776884e-01   +9.338376168047247e-01   +8.605298782230694e-01   +4.299880166266781e-01   +8.633780849210069e-01   +4.970625587427456e-01   +8.678071617818153e-01];
L2E_Input1_iAMPA_netcon = [+9.667406391807201e-01   +9.700792646333246e-01   +9.305653014157412e-01   +9.607773552027056e-01   +9.111668930747733e-01   +9.943173359425844e-01   +9.215512065549945e-01   +9.614984087462255e-01];
L2I_Input2_iAMPA_netcon = [+9.152940473249653e-01   +9.434579435804589e-01   +9.814858911342575e-01   +8.793548105018077e-01   +8.912279375934301e-01   +9.407139532729401e-01   +9.372651910199871e-01   +9.722643290914255e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
